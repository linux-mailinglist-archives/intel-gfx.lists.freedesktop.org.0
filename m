Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id EA481FC648
	for <lists+intel-gfx@lfdr.de>; Thu, 14 Nov 2019 13:27:29 +0100 (CET)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id C53CA6E227;
	Thu, 14 Nov 2019 12:27:27 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from mga01.intel.com (mga01.intel.com [192.55.52.88])
 by gabe.freedesktop.org (Postfix) with ESMTPS id A5FFA89FE6
 for <intel-gfx@lists.freedesktop.org>; Thu, 14 Nov 2019 12:27:26 +0000 (UTC)
X-Amp-Result: SKIPPED(no attachment in message)
X-Amp-File-Uploaded: False
Received: from fmsmga003.fm.intel.com ([10.253.24.29])
 by fmsmga101.fm.intel.com with ESMTP/TLS/DHE-RSA-AES256-GCM-SHA384;
 14 Nov 2019 04:27:26 -0800
X-ExtLoop1: 1
X-IronPort-AV: E=Sophos;i="5.68,304,1569308400"; d="scan'208";a="257437568"
Received: from slisovsk-lenovo-ideapad-720s-13ikb.fi.intel.com ([10.237.72.89])
 by FMSMGA003.fm.intel.com with ESMTP; 14 Nov 2019 04:27:23 -0800
From: Stanislav Lisovskiy <stanislav.lisovskiy@intel.com>
To: intel-gfx@lists.freedesktop.org
Date: Thu, 14 Nov 2019 14:24:49 +0200
Message-Id: <20191114122449.26409-1-stanislav.lisovskiy@intel.com>
X-Mailer: git-send-email 2.17.1
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH v7] drm/i915: Enable second dbuf slice for ICL
 and TGL
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

QWxzbyBpbXBsZW1lbnRlZCBhbGdvcml0aG0gZm9yIGNob29zaW5nIERCdWYgc2xpY2UgY29uZmln
dXJhdGlvbgpiYXNlZCBvbiBhY3RpdmUgcGlwZXMsIHBpcGUgcmF0aW8gYXMgc3RhdGVkIGluIEJT
cGVjIDEyNzE2LgoKTm93IHBpcGUgYWxsb2NhdGlvbiBzdGlsbCBzdGF5cyBwcm9wb3J0aW9uYWwg
dG8gcGlwZSB3aWR0aCBhcyBiZWZvcmUsCmhvd2V2ZXIgd2l0aGluIGFsbG93ZWQgREJ1ZiBzbGlj
ZSBmb3IgdGhpcyBwYXJ0aWN1bGFyIGNvbmZpZ3VyYXRpb24uCgp2MjogUmVtb3ZlIHVubmVlZGVk
IGNoZWNrIGZyb20gY29tbWl0IGFzIGRkYiBlbmFibGVkIHNsaWNlcyBtaWdodAogICAgbm93IGRp
ZmZlciBmcm9tIGh3IHN0YXRlLgoKdjM6IC0gQWRkZWQgbmV3IGZpZWxkICJzdXBwb3J0ZWRfc2xp
Y2VzIiB0byBkZGIgdG8gc2VwYXJhdGUgbWF4CiAgICAgIHN1cHBvcnRlZCBzbGljZXMgdnMgY3Vy
cmVudGx5IGVuYWJsZWQsIHRvIGF2b2lkIGNvbmZ1c2lvbi4KICAgIC0gUmVtb3ZlZCBvYnNvbGV0
ZSBjb21tZW50cyBhbmQgY29kZSByZWxhdGVkIHRvIERCdWYoTWF0dGhldyBSb3BlcikuCiAgICAt
IFNvbWUgY29kZSBzdHlsZSBhbmQgbG9uZyBsaW5lIHJlbW92YWwoTWF0dGhldyBSb3BlcikuCiAg
ICAtIEFkZGVkIFdBUk5fT04gdG8gbmV3IGRkYiByYW5nZSBvZmZzZXQgY2FsYyBmdW5jdGlvbihN
YXR0aGV3IFJvcGVyKS4KICAgIC0gUmVtb3ZlZCBwbGF0Zm9ybSBzcGVjaWZpYyBjYWxsIHRvIGNh
bGMgcGlwZSByYXRpbyBmcm9tIGRkYgogICAgICBhbGxvY2F0aW9uIGZ1bmN0aW9uIGFuZCBmaXhl
ZCB0aGUgcmV0dXJuIHZhbHVlKE1hdHRoZXcgUm9wZXIpCiAgICAtIFJlZmFjdG9yZWQgREJVRiBz
bGljZSBhbGxvY2F0aW9uIHRhYmxlIHRvIGltcHJvdmUgcmVhZGFiaWxpdHkKICAgIC0gQWRkZWQg
REJVRiBzbGljZSBhbGxvY2F0aW9uIGZvciBUR0wgYXMgd2VsbC4KICAgIC0gSUNMKGhvd2V2ZXIg
bm90IFRHTCkgc2VlbXMgdG8gdm9sdW50YXJpbHkgZW5hYmxlIHNlY29uZCBEQnVmIHNsaWNlCiAg
ICAgIGFmdGVyIHBtIHN1c3BlbmQvcmVzdW1lIGNhdXNpbmcgYSBtaXNtYXRjaCBmYWlsdXJlLCBi
ZWNhdXNlIHdlCiAgICAgIHVwZGF0ZSBEQnVmIHNsaWNlcyBvbmx5IGlmIHdlIGRvIGEgbW9kZXNl
dCwgaG93ZXZlciB0aGlzIGNoZWNrCiAgICAgIGlzIGRvbmUgYWx3YXlzLiBGaXhlZCBpdCB0byBi
ZSBkb25lIG9ubHkgd2hlbiBtb2Rlc2V0IGZvciBJQ0wuCgp2NDogLSBOb3cgZW5hYmxlZCBzbGlj
ZXMgaXMgbm90IGFjdHVhbGx5IGEgbnVtYmVyLCBidXQgYSBiaXRtYXNrLAogICAgICBiZWNhdXNl
IHdlIG1pZ2h0IG5lZWQgdG8gZW5hYmxlIHNlY29uZCBzbGljZSBvbmx5IGFuZCBudW1iZXIKICAg
ICAgb2Ygc2xpY2VzIHdvdWxkIHN0aWxsIDEgYW5kIHRoYXQgY3VycmVudCBjb2RlIGRvZXNuJ3Qg
YWxsb3cuCiAgICAtIFJlbW92ZSByZWR1bmRhbnQgZHVwbGljYXRlIGNvZGUgdG8gaGF2ZSBzb21l
IHVuaWZpZWQgd2F5IG9mCiAgICAgIGVuYWJsaW5nIGRidWYgc2xpY2VzIGluc3RlYWQgb2YgaGFy
ZGNvZGluZy4KCnY1OiAtIEZpeCBmYWlsaW5nIGdlbjlfYXNzZXJ0X2RidWZfZW5hYmxlZCBhcyBp
dCB3YXMgbmFpdmVseSB0aGlua2luZwogICAgICB0aGF0IHdlIGhhdmUgb25seSBvbmUgREJVRl9D
VEwgc2xpY2UuIE5vdyBhbm90aGVyIHZlcnNpb24gZm9yCiAgICAgIGdlbjExIHdpbGwgY2hlY2sg
Ym90aCBzbGljZXMgYXMgb25seSBzZWNvbmQgb25lIGNhbiBiZSBlbmFibGVkLAogICAgICB0byBr
ZWVwIENJIGhhcHB5LgoKdjY6IC0gUmVtb3ZlZCBlbmFibGVkIGRidWYgYXNzZXJ0aW9uIGNvbXBs
ZXRlbHkuIFByZXZpb3VzIGNvZGUKICAgICAgd2FzIGtlZXBpbmcgZGJ1ZiBlbmFibGVkLCBldmVu
KCEpIHdoZW4gX2RidWZfZGlzYWJsZSBpcyBjYWxsZWQuCiAgICAgIEN1cnJlbnRseSB3ZSBlbmFi
bGUvZGlzYWJsZSBkYnVmIHNsaWNlcyBiYXNlZCBvbiByZXF1cmVtZW50CiAgICAgIHNvIG5vIHBv
aW50IGluIGFzc2VydGluZyB0aGlzIGhlcmUuCiAgICAtIFJlbW92ZWQgdW5uZWNlc3NhcnkgbW9k
ZXNldCBjaGVjayBmcm9tIHZlcmlmeV93bV9zdGF0ZShNYXR0aGV3IFJvcGVyKQogICAgLSBTbGlj
ZXMgaW50ZXJzZWN0aW9uIGFmdGVyIHVuaW9uIGlzIHNhbWUgYXMgZmluYWwgcmVzdWx0KE1hdHRo
ZXcgUm9wZXIpCiAgICAtIE1vdmVkIERCdWYgc2xpY2VzIHRvIGludGVsX2RldmljZV9pbmZvKE1h
dHRoZXcgUm9wZXIpCiAgICAtIFNvbWUgbWFjcm9zIGFkZGVkKE1hdHRoZXcgUm9wZXIpCiAgICAt
IGRkYiByYW5nZSBpcyBub3cgYWx3YXlzIGxlc3Mgb3IgZXF1YWwgdG8gZGRiIHNpemUgLSBubyBu
ZWVkIGZvciBhZGRpdGlvbmFsCiAgICAgIGNoZWNrcyhwcmV2aW91c2x5IG5lZWRlZCBhcyB3ZSBo
YWQgc29tZSBiYW5kd2lkdGggY2hlY2tzIGluIHRoZXJlIHdoaWNoCiAgICAgIGNvdWxkICJzdWRk
ZW5seSIgcmV0dXJuIGRkYl9zaXplIHNtYWxsZXIgdGhhbiBpdCBpcy4KCnY3OiBNaW5vciBjb3N0
ZW1pYyBjaGFuZ2VzOgogICAgLSBDaGFuZ2VkIGljbF9kYnVmX3NsaWNlc19yZXN0b3JlIG5hbWUg
dG8gaWNsX3Byb2dyYW1fZGJ1Zl9zbGljZXMKICAgICAgYXMgaXQgbW9yZSBjb3JyZXNwb25kcyB0
byB0aGUgYWN0dWFsIGZ1bmN0aW9uYWxpdHkuCiAgICAtIFNvbWUgc2ltcGxpZmljYXRpb24gd2l0
aCBzdXBwb3J0ZWQgc2xpY2VzIGZvciBCWFQgYW5kIEdMSwogICAgLSBza2xfcGlwZV9kb3duc2Nh
bGVfYW1vdW50IC0+IGljbF9waXBlX2Rvd25zY2FsZV9hbW91bnQgYXMKICAgICAgdGhpcyBpcyBu
b3QgdXNlZCBmb3Igc2tsIGFueW1vcmUuCiAgICAtIENoYW5nZWQgREJ1ZiBzbGljZSBhc3NpZ25t
ZW50IG9yZGVyIGZvciBUR0wgY2FzZQoKUmV2aWV3ZWQtYnk6IE1hdHRoZXcgUm9wZXIgPG1hdHRo
ZXcuZC5yb3BlckBpbnRlbC5jb20+ClNpZ25lZC1vZmYtYnk6IFN0YW5pc2xhdiBMaXNvdnNraXkg
PHN0YW5pc2xhdi5saXNvdnNraXlAaW50ZWwuY29tPgpDYzogTWF0dGhldyBSb3BlciA8bWF0dGhl
dy5kLnJvcGVyQGludGVsLmNvbT4KQ2M6IFZpbGxlIFN5cmrDpGzDpCA8dmlsbGUuc3lyamFsYUBp
bnRlbC5jb20+CkNjOiBKYW1lcyBBdXNtdXMgPGphbWVzLmF1c211c0BpbnRlbC5jb20+Ci0tLQog
ZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kaXNwbGF5LmMgIHwgIDI2ICstCiAu
Li4vZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kaXNwbGF5X3Bvd2VyLmMgICAgfCAgOTggKystLS0K
IC4uLi9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2Rpc3BsYXlfcG93ZXIuaCAgICB8ICAgMiArCiBk
cml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2Rydi5jICAgICAgICAgICAgICAgfCAgIDUgKwogZHJp
dmVycy9ncHUvZHJtL2k5MTUvaTkxNV9kcnYuaCAgICAgICAgICAgICAgIHwgICAyICstCiBkcml2
ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3BjaS5jICAgICAgICAgICAgICAgfCAgIDYgKy0KIGRyaXZl
cnMvZ3B1L2RybS9pOTE1L2k5MTVfcmVnLmggICAgICAgICAgICAgICB8ICAgOCArLQogZHJpdmVy
cy9ncHUvZHJtL2k5MTUvaW50ZWxfZGV2aWNlX2luZm8uaCAgICAgIHwgICAxICsKIGRyaXZlcnMv
Z3B1L2RybS9pOTE1L2ludGVsX3BtLmMgICAgICAgICAgICAgICB8IDM4NyArKysrKysrKysrKysr
KysrLS0KIDkgZmlsZXMgY2hhbmdlZCwgNDMxIGluc2VydGlvbnMoKyksIDEwNCBkZWxldGlvbnMo
LSkKCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2Rpc3Bs
YXkuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZGlzcGxheS5jCmluZGV4
IDg3NmZjMjU5NjhiZi4uYmQ3YWZmNjc1MTk4IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0v
aTkxNS9kaXNwbGF5L2ludGVsX2Rpc3BsYXkuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9k
aXNwbGF5L2ludGVsX2Rpc3BsYXkuYwpAQCAtMTMzODcsNyArMTMzODcsNyBAQCBzdGF0aWMgdm9p
ZCB2ZXJpZnlfd21fc3RhdGUoc3RydWN0IGludGVsX2NydGMgKmNydGMsCiAKIAlpZiAoSU5URUxf
R0VOKGRldl9wcml2KSA+PSAxMSAmJgogCSAgICBody0+ZGRiLmVuYWJsZWRfc2xpY2VzICE9IHN3
X2RkYi0+ZW5hYmxlZF9zbGljZXMpCi0JCURSTV9FUlJPUigibWlzbWF0Y2ggaW4gREJVRiBTbGlj
ZXMgKGV4cGVjdGVkICV1LCBnb3QgJXUpXG4iLAorCQlEUk1fRVJST1IoIm1pc21hdGNoIGluIERC
VUYgU2xpY2VzIChleHBlY3RlZCAleCwgZ290ICV4KVxuIiwKIAkJCSAgc3dfZGRiLT5lbmFibGVk
X3NsaWNlcywKIAkJCSAgaHctPmRkYi5lbmFibGVkX3NsaWNlcyk7CiAKQEAgLTE0NjE0LDE1ICsx
NDYxNCwyNCBAQCBzdGF0aWMgdm9pZCBza2xfY29tbWl0X21vZGVzZXRfZW5hYmxlcyhzdHJ1Y3Qg
aW50ZWxfYXRvbWljX3N0YXRlICpzdGF0ZSkKIAl1OCBod19lbmFibGVkX3NsaWNlcyA9IGRldl9w
cml2LT53bS5za2xfaHcuZGRiLmVuYWJsZWRfc2xpY2VzOwogCXU4IHJlcXVpcmVkX3NsaWNlcyA9
IHN0YXRlLT53bV9yZXN1bHRzLmRkYi5lbmFibGVkX3NsaWNlczsKIAlzdHJ1Y3Qgc2tsX2RkYl9l
bnRyeSBlbnRyaWVzW0k5MTVfTUFYX1BJUEVTXSA9IHt9OworCXU4IHNsaWNlc191bmlvbiA9IGh3
X2VuYWJsZWRfc2xpY2VzIHwgcmVxdWlyZWRfc2xpY2VzOworCXU4IHNsaWNlc19pbnRlcnNlY3Rp
b24gPSByZXF1aXJlZF9zbGljZXM7CiAKIAlmb3JfZWFjaF9vbGRuZXdfaW50ZWxfY3J0Y19pbl9z
dGF0ZShzdGF0ZSwgY3J0Yywgb2xkX2NydGNfc3RhdGUsIG5ld19jcnRjX3N0YXRlLCBpKQogCQkv
KiBpZ25vcmUgYWxsb2NhdGlvbnMgZm9yIGNydGMncyB0aGF0IGhhdmUgYmVlbiB0dXJuZWQgb2Zm
LiAqLwogCQlpZiAobmV3X2NydGNfc3RhdGUtPmh3LmFjdGl2ZSkKIAkJCWVudHJpZXNbaV0gPSBv
bGRfY3J0Y19zdGF0ZS0+d20uc2tsLmRkYjsKIAotCS8qIElmIDJuZCBEQnVmIHNsaWNlIHJlcXVp
cmVkLCBlbmFibGUgaXQgaGVyZSAqLwotCWlmIChJTlRFTF9HRU4oZGV2X3ByaXYpID49IDExICYm
IHJlcXVpcmVkX3NsaWNlcyA+IGh3X2VuYWJsZWRfc2xpY2VzKQotCQlpY2xfZGJ1Zl9zbGljZXNf
dXBkYXRlKGRldl9wcml2LCByZXF1aXJlZF9zbGljZXMpOworCURSTV9ERUJVR19LTVMoIkRCdWYg
cmVxIHNsaWNlcyAlZCBodyBzbGljZXMgJWRcbiIsCisJCSAgICAgIHJlcXVpcmVkX3NsaWNlcywg
aHdfZW5hYmxlZF9zbGljZXMpOworCisJLyoKKwkgKiBJZiBzb21lIG90aGVyIERCdWYgc2xpY2Ug
cmVxdWlyZWQsIGVuYWJsZSBpdCBoZXJlLAorCSAqIGFzIGhlcmUgd2Ugb25seSBhZGQgbW9yZSBz
bGljZXMsIGJ1dCBub3QgcmVtb3ZlIHRvIHByZXZlbnQKKwkgKiBpc3N1ZXMgaWYgc29tZWJvZHkg
c3RpbGwgdXNlcyB0aG9zZS4KKwkgKi8KKwlpZiAoSU5URUxfR0VOKGRldl9wcml2KSA+PSAxMSAm
JiByZXF1aXJlZF9zbGljZXMgIT0gaHdfZW5hYmxlZF9zbGljZXMpCisJCWljbF9kYnVmX3NsaWNl
c191cGRhdGUoZGV2X3ByaXYsIHNsaWNlc191bmlvbik7CiAKIAkvKgogCSAqIFdoZW5ldmVyIHRo
ZSBudW1iZXIgb2YgYWN0aXZlIHBpcGVzIGNoYW5nZXMsIHdlIG5lZWQgdG8gbWFrZSBzdXJlIHdl
CkBAIC0xNDY4MSw5ICsxNDY5MCwxMiBAQCBzdGF0aWMgdm9pZCBza2xfY29tbWl0X21vZGVzZXRf
ZW5hYmxlcyhzdHJ1Y3QgaW50ZWxfYXRvbWljX3N0YXRlICpzdGF0ZSkKIAkJfQogCX0gd2hpbGUg
KHByb2dyZXNzKTsKIAotCS8qIElmIDJuZCBEQnVmIHNsaWNlIGlzIG5vIG1vcmUgcmVxdWlyZWQg
ZGlzYWJsZSBpdCAqLwotCWlmIChJTlRFTF9HRU4oZGV2X3ByaXYpID49IDExICYmIHJlcXVpcmVk
X3NsaWNlcyA8IGh3X2VuYWJsZWRfc2xpY2VzKQotCQlpY2xfZGJ1Zl9zbGljZXNfdXBkYXRlKGRl
dl9wcml2LCByZXF1aXJlZF9zbGljZXMpOworCS8qCisJICogSWYgc29tZSBvdGhlciBEQnVmIHNs
aWNlIGlzIG5vdCBuZWVkZWQsIGRpc2FibGUgaXQgaGVyZSwKKwkgKiBhcyBoZXJlIHdlIG9ubHkg
cmVtb3ZlIHNsaWNlcywgd2hpY2ggYXJlIG5vdCBuZWVkZWQgYW55bW9yZS4KKwkgKi8KKwlpZiAo
SU5URUxfR0VOKGRldl9wcml2KSA+PSAxMSAmJiByZXF1aXJlZF9zbGljZXMgIT0gaHdfZW5hYmxl
ZF9zbGljZXMpCisJCWljbF9kYnVmX3NsaWNlc191cGRhdGUoZGV2X3ByaXYsIHNsaWNlc19pbnRl
cnNlY3Rpb24pOwogfQogCiBzdGF0aWMgdm9pZCBpbnRlbF9hdG9taWNfaGVscGVyX2ZyZWVfc3Rh
dGUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQpkaWZmIC0tZ2l0IGEvZHJpdmVy
cy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kaXNwbGF5X3Bvd2VyLmMgYi9kcml2ZXJzL2dw
dS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2Rpc3BsYXlfcG93ZXIuYwppbmRleCBjZTFiNjRmNGRk
NDQuLmE3OGJjOWI2MTg2MiAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxh
eS9pbnRlbF9kaXNwbGF5X3Bvd2VyLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxh
eS9pbnRlbF9kaXNwbGF5X3Bvd2VyLmMKQEAgLTEwMzEsMTUgKzEwMzEsNiBAQCBzdGF0aWMgYm9v
bCBnZW45X2RjX29mZl9wb3dlcl93ZWxsX2VuYWJsZWQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUg
KmRldl9wcml2LAogCQkoSTkxNV9SRUFEKERDX1NUQVRFX0VOKSAmIERDX1NUQVRFX0VOX1VQVE9f
REM1X0RDNl9NQVNLKSA9PSAwKTsKIH0KIAotc3RhdGljIHZvaWQgZ2VuOV9hc3NlcnRfZGJ1Zl9l
bmFibGVkKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikKLXsKLQl1MzIgdG1wID0g
STkxNV9SRUFEKERCVUZfQ1RMKTsKLQotCVdBUk4oKHRtcCAmIChEQlVGX1BPV0VSX1NUQVRFIHwg
REJVRl9QT1dFUl9SRVFVRVNUKSkgIT0KLQkgICAgIChEQlVGX1BPV0VSX1NUQVRFIHwgREJVRl9Q
T1dFUl9SRVFVRVNUKSwKLQkgICAgICJVbmV4cGVjdGVkIERCdWYgcG93ZXIgcG93ZXIgc3RhdGUg
KDB4JTA4eClcbiIsIHRtcCk7Ci19Ci0KIHN0YXRpYyB2b2lkIGdlbjlfZGlzYWJsZV9kY19zdGF0
ZXMoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQogewogCXN0cnVjdCBpbnRlbF9j
ZGNsa19zdGF0ZSBjZGNsa19zdGF0ZSA9IHt9OwpAQCAtMTA1NSw4ICsxMDQ2LDYgQEAgc3RhdGlj
IHZvaWQgZ2VuOV9kaXNhYmxlX2RjX3N0YXRlcyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2
X3ByaXYpCiAJLyogQ2FuJ3QgcmVhZCBvdXQgdm9sdGFnZV9sZXZlbCBzbyBjYW4ndCB1c2UgaW50
ZWxfY2RjbGtfY2hhbmdlZCgpICovCiAJV0FSTl9PTihpbnRlbF9jZGNsa19uZWVkc19tb2Rlc2V0
KCZkZXZfcHJpdi0+Y2RjbGsuaHcsICZjZGNsa19zdGF0ZSkpOwogCi0JZ2VuOV9hc3NlcnRfZGJ1
Zl9lbmFibGVkKGRldl9wcml2KTsKLQogCWlmIChJU19HRU45X0xQKGRldl9wcml2KSkKIAkJYnh0
X3ZlcmlmeV9kZGlfcGh5X3Bvd2VyX3dlbGxzKGRldl9wcml2KTsKIApAQCAtNDI1NCwzMSArNDI0
Myw1MSBAQCBzdGF0aWMgdm9pZCBnZW45X2RidWZfZGlzYWJsZShzdHJ1Y3QgZHJtX2k5MTVfcHJp
dmF0ZSAqZGV2X3ByaXYpCiAJaW50ZWxfZGJ1Zl9zbGljZV9zZXQoZGV2X3ByaXYsIERCVUZfQ1RM
LCBmYWxzZSk7CiB9CiAKLXN0YXRpYyB1OCBpbnRlbF9kYnVmX21heF9zbGljZXMoc3RydWN0IGRy
bV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQoraW50IGludGVsX2RidWZfbWF4X3NsaWNlcyhzdHJ1
Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCiB7Ci0JaWYgKElOVEVMX0dFTihkZXZfcHJp
dikgPCAxMSkKLQkJcmV0dXJuIDE7Ci0JcmV0dXJuIDI7CisJcmV0dXJuIElOVEVMX0lORk8oZGV2
X3ByaXYpLT5zdXBwb3J0ZWRfc2xpY2VzOworfQorCit2b2lkIGljbF9wcm9ncmFtX2RidWZfc2xp
Y2VzKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikKK3sKKwljb25zdCB1OCBod19l
bmFibGVkX3NsaWNlcyA9IGRldl9wcml2LT53bS5za2xfaHcuZGRiLmVuYWJsZWRfc2xpY2VzOwor
CisJaWNsX2RidWZfc2xpY2VzX3VwZGF0ZShkZXZfcHJpdiwgaHdfZW5hYmxlZF9zbGljZXMpOwog
fQogCiB2b2lkIGljbF9kYnVmX3NsaWNlc191cGRhdGUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUg
KmRldl9wcml2LAogCQkJICAgIHU4IHJlcV9zbGljZXMpCiB7Ci0JY29uc3QgdTggaHdfZW5hYmxl
ZF9zbGljZXMgPSBkZXZfcHJpdi0+d20uc2tsX2h3LmRkYi5lbmFibGVkX3NsaWNlczsKLQlib29s
IHJldDsKKwlib29sIHJldCA9IHRydWU7CisJaW50IGk7CisJaW50IG1heF9zbGljZXMgPSBpbnRl
bF9kYnVmX21heF9zbGljZXMoZGV2X3ByaXYpOwogCi0JaWYgKHJlcV9zbGljZXMgPiBpbnRlbF9k
YnVmX21heF9zbGljZXMoZGV2X3ByaXYpKSB7CisJaWYgKGh3ZWlnaHQ4KHJlcV9zbGljZXMpID4g
aW50ZWxfZGJ1Zl9tYXhfc2xpY2VzKGRldl9wcml2KSkgewogCQlEUk1fRVJST1IoIkludmFsaWQg
bnVtYmVyIG9mIGRidWYgc2xpY2VzIHJlcXVlc3RlZFxuIik7CiAJCXJldHVybjsKIAl9CiAKLQlp
ZiAocmVxX3NsaWNlcyA9PSBod19lbmFibGVkX3NsaWNlcyB8fCByZXFfc2xpY2VzID09IDApCi0J
CXJldHVybjsKKwlEUk1fREVCVUdfS01TKCJVcGRhdGluZyBkYnVmIHNsaWNlcyB0byAleFxuIiwg
cmVxX3NsaWNlcyk7CiAKLQlpZiAocmVxX3NsaWNlcyA+IGh3X2VuYWJsZWRfc2xpY2VzKQotCQly
ZXQgPSBpbnRlbF9kYnVmX3NsaWNlX3NldChkZXZfcHJpdiwgREJVRl9DVExfUzIsIHRydWUpOwot
CWVsc2UKLQkJcmV0ID0gaW50ZWxfZGJ1Zl9zbGljZV9zZXQoZGV2X3ByaXYsIERCVUZfQ1RMX1My
LCBmYWxzZSk7CisJZm9yIChpID0gMDsgaSA8IG1heF9zbGljZXM7IGkrKykgeworCQlpbnQgc2xp
Y2VfYml0ID0gQklUKGkpOworCQlib29sIHNsaWNlX3NldCA9IChzbGljZV9iaXQgJiByZXFfc2xp
Y2VzKSAhPSAwOworCisJCXN3aXRjaCAoc2xpY2VfYml0KSB7CisJCWNhc2UgREJVRl9TMV9CSVQ6
CisJCQlyZXQgPSByZXQgJiYgaW50ZWxfZGJ1Zl9zbGljZV9zZXQoZGV2X3ByaXYsCisJCQkJCQkJ
ICBEQlVGX0NUTF9TMSwKKwkJCQkJCQkgIHNsaWNlX3NldCk7CisJCQlicmVhazsKKwkJY2FzZSBE
QlVGX1MyX0JJVDoKKwkJCXJldCA9IHJldCAmJiBpbnRlbF9kYnVmX3NsaWNlX3NldChkZXZfcHJp
diwKKwkJCQkJCQkgIERCVUZfQ1RMX1MyLAorCQkJCQkJCSAgc2xpY2Vfc2V0KTsKKwkJCWJyZWFr
OworCQlkZWZhdWx0OgorCQkJTUlTU0lOR19DQVNFKHNsaWNlX2JpdCk7CisJCX0KKwl9CiAKIAlp
ZiAocmV0KQogCQlkZXZfcHJpdi0+d20uc2tsX2h3LmRkYi5lbmFibGVkX3NsaWNlcyA9IHJlcV9z
bGljZXM7CkBAIC00Mjg2LDQwICs0Mjk1LDIxIEBAIHZvaWQgaWNsX2RidWZfc2xpY2VzX3VwZGF0
ZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCiAKIHN0YXRpYyB2b2lkIGljbF9k
YnVmX2VuYWJsZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCiB7Ci0JSTkxNV9X
UklURShEQlVGX0NUTF9TMSwgSTkxNV9SRUFEKERCVUZfQ1RMX1MxKSB8IERCVUZfUE9XRVJfUkVR
VUVTVCk7Ci0JSTkxNV9XUklURShEQlVGX0NUTF9TMiwgSTkxNV9SRUFEKERCVUZfQ1RMX1MyKSB8
IERCVUZfUE9XRVJfUkVRVUVTVCk7Ci0JUE9TVElOR19SRUFEKERCVUZfQ1RMX1MyKTsKLQotCXVk
ZWxheSgxMCk7Ci0KLQlpZiAoIShJOTE1X1JFQUQoREJVRl9DVExfUzEpICYgREJVRl9QT1dFUl9T
VEFURSkgfHwKLQkgICAgIShJOTE1X1JFQUQoREJVRl9DVExfUzIpICYgREJVRl9QT1dFUl9TVEFU
RSkpCi0JCURSTV9FUlJPUigiREJ1ZiBwb3dlciBlbmFibGUgdGltZW91dFxuIik7Ci0JZWxzZQot
CQkvKgotCQkgKiBGSVhNRTogZm9yIG5vdyBwcmV0ZW5kIHRoYXQgd2Ugb25seSBoYXZlIDEgc2xp
Y2UsIHNlZQotCQkgKiBpbnRlbF9lbmFibGVkX2RidWZfc2xpY2VzX251bSgpLgotCQkgKi8KLQkJ
ZGV2X3ByaXYtPndtLnNrbF9ody5kZGIuZW5hYmxlZF9zbGljZXMgPSAxOworCS8qCisJICogSnVz
dCBwb3dlciB1cCAxIHNsaWNlLCB3ZSB3aWxsCisJICogZmlndXJlIG91dCBsYXRlciB3aGljaCBz
bGljZXMgd2UgaGF2ZSBhbmQgd2hhdCB3ZSBuZWVkLgorCSAqLworCWRldl9wcml2LT53bS5za2xf
aHcuZGRiLmVuYWJsZWRfc2xpY2VzID0gREJVRl9TMV9CSVQ7CisJaWNsX3Byb2dyYW1fZGJ1Zl9z
bGljZXMoZGV2X3ByaXYpOwogfQogCiBzdGF0aWMgdm9pZCBpY2xfZGJ1Zl9kaXNhYmxlKHN0cnVj
dCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikKIHsKLQlJOTE1X1dSSVRFKERCVUZfQ1RMX1Mx
LCBJOTE1X1JFQUQoREJVRl9DVExfUzEpICYgfkRCVUZfUE9XRVJfUkVRVUVTVCk7Ci0JSTkxNV9X
UklURShEQlVGX0NUTF9TMiwgSTkxNV9SRUFEKERCVUZfQ1RMX1MyKSAmIH5EQlVGX1BPV0VSX1JF
UVVFU1QpOwotCVBPU1RJTkdfUkVBRChEQlVGX0NUTF9TMik7Ci0KLQl1ZGVsYXkoMTApOwotCi0J
aWYgKChJOTE1X1JFQUQoREJVRl9DVExfUzEpICYgREJVRl9QT1dFUl9TVEFURSkgfHwKLQkgICAg
KEk5MTVfUkVBRChEQlVGX0NUTF9TMikgJiBEQlVGX1BPV0VSX1NUQVRFKSkKLQkJRFJNX0VSUk9S
KCJEQnVmIHBvd2VyIGRpc2FibGUgdGltZW91dCFcbiIpOwotCWVsc2UKLQkJLyoKLQkJICogRklY
TUU6IGZvciBub3cgcHJldGVuZCB0aGF0IHRoZSBmaXJzdCBzbGljZSBpcyBhbHdheXMKLQkJICog
ZW5hYmxlZCwgc2VlIGludGVsX2VuYWJsZWRfZGJ1Zl9zbGljZXNfbnVtKCkuCi0JCSAqLwotCQlk
ZXZfcHJpdi0+d20uc2tsX2h3LmRkYi5lbmFibGVkX3NsaWNlcyA9IDE7CisJLyoKKwkgKiBEaXNh
YmxlIGFsbCBzbGljZXMKKwkgKi8KKwlkZXZfcHJpdi0+d20uc2tsX2h3LmRkYi5lbmFibGVkX3Ns
aWNlcyA9IDA7CisJaWNsX3Byb2dyYW1fZGJ1Zl9zbGljZXMoZGV2X3ByaXYpOwogfQogCiBzdGF0
aWMgdm9pZCBpY2xfbWJ1c19pbml0KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikK
ZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZGlzcGxheV9w
b3dlci5oIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kaXNwbGF5X3Bvd2Vy
LmgKaW5kZXggMWRhMDRmM2UwZmIzLi5iNzA1N2Q2OGFkNzggMTAwNjQ0Ci0tLSBhL2RyaXZlcnMv
Z3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZGlzcGxheV9wb3dlci5oCisrKyBiL2RyaXZlcnMv
Z3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZGlzcGxheV9wb3dlci5oCkBAIC0zMTEsOCArMzEx
LDEwIEBAIGludGVsX2Rpc3BsYXlfcG93ZXJfcHV0X2FzeW5jKHN0cnVjdCBkcm1faTkxNV9wcml2
YXRlICppOTE1LAogCWZvciAoKHdmKSA9IGludGVsX2Rpc3BsYXlfcG93ZXJfZ2V0KChpOTE1KSwg
KGRvbWFpbikpOyAod2YpOyBcCiAJICAgICBpbnRlbF9kaXNwbGF5X3Bvd2VyX3B1dF9hc3luYygo
aTkxNSksIChkb21haW4pLCAod2YpKSwgKHdmKSA9IDApCiAKK2ludCBpbnRlbF9kYnVmX21heF9z
bGljZXMoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KTsKIHZvaWQgaWNsX2RidWZf
c2xpY2VzX3VwZGF0ZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCiAJCQkgICAg
dTggcmVxX3NsaWNlcyk7Cit2b2lkIGljbF9wcm9ncmFtX2RidWZfc2xpY2VzKHN0cnVjdCBkcm1f
aTkxNV9wcml2YXRlICpkZXZfcHJpdik7CiAKIHZvaWQgY2h2X3BoeV9wb3dlcmdhdGVfbGFuZXMo
c3RydWN0IGludGVsX2VuY29kZXIgKmVuY29kZXIsCiAJCQkgICAgIGJvb2wgb3ZlcnJpZGUsIHVu
c2lnbmVkIGludCBtYXNrKTsKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVf
ZHJ2LmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2Rydi5jCmluZGV4IDgyZTRlNmJmMDhj
My4uOTY3NDFlNjg2MzNhIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2Ry
di5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZHJ2LmMKQEAgLTUxLDYgKzUxLDcg
QEAKICNpbmNsdWRlICJkaXNwbGF5L2ludGVsX2J3LmgiCiAjaW5jbHVkZSAiZGlzcGxheS9pbnRl
bF9jZGNsay5oIgogI2luY2x1ZGUgImRpc3BsYXkvaW50ZWxfZGlzcGxheV90eXBlcy5oIgorI2lu
Y2x1ZGUgImRpc3BsYXkvaW50ZWxfZGlzcGxheV9wb3dlci5oIgogI2luY2x1ZGUgImRpc3BsYXkv
aW50ZWxfZHAuaCIKICNpbmNsdWRlICJkaXNwbGF5L2ludGVsX2ZiZGV2LmgiCiAjaW5jbHVkZSAi
ZGlzcGxheS9pbnRlbF9ob3RwbHVnLmgiCkBAIC0yNTg4LDYgKzI1ODksMTAgQEAgc3RhdGljIGlu
dCBpbnRlbF9ydW50aW1lX3Jlc3VtZShzdHJ1Y3QgZGV2aWNlICprZGV2KQogCWlmIChJU19WQUxM
RVlWSUVXKGRldl9wcml2KSB8fCBJU19DSEVSUllWSUVXKGRldl9wcml2KSkKIAkJcmV0ID0gdmx2
X3Jlc3VtZV9wcmVwYXJlKGRldl9wcml2LCB0cnVlKTsKIAorCS8qIFdlaXJkIGhhY2sgdG8gZml4
IElDTCBoYXJkd2FyZSBidWcsIGFzIGl0IHJlc2V0cyBEQlVGIHNsaWNlcyByZWcgKi8KKwlpZiAo
SU5URUxfR0VOKGRldl9wcml2KSA9PSAxMSkKKwkJaWNsX3Byb2dyYW1fZGJ1Zl9zbGljZXMoZGV2
X3ByaXYpOworCiAJaW50ZWxfdW5jb3JlX3J1bnRpbWVfcmVzdW1lKCZkZXZfcHJpdi0+dW5jb3Jl
KTsKIAogCWludGVsX3J1bnRpbWVfcG1fZW5hYmxlX2ludGVycnVwdHMoZGV2X3ByaXYpOwpkaWZm
IC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9kcnYuaCBiL2RyaXZlcnMvZ3B1L2Ry
bS9pOTE1L2k5MTVfZHJ2LmgKaW5kZXggN2UwZjY3YmFiZTIwLi5hMzk2OTc3YzljMmQgMTAwNjQ0
Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZHJ2LmgKKysrIGIvZHJpdmVycy9ncHUv
ZHJtL2k5MTUvaTkxNV9kcnYuaApAQCAtODA0LDcgKzgwNCw3IEBAIHN0YXRpYyBpbmxpbmUgYm9v
bCBza2xfZGRiX2VudHJ5X2VxdWFsKGNvbnN0IHN0cnVjdCBza2xfZGRiX2VudHJ5ICplMSwKIH0K
IAogc3RydWN0IHNrbF9kZGJfYWxsb2NhdGlvbiB7Ci0JdTggZW5hYmxlZF9zbGljZXM7IC8qIEdF
TjExIGhhcyBjb25maWd1cmFibGUgMiBzbGljZXMgKi8KKwl1OCBlbmFibGVkX3NsaWNlczsgICAv
KiBCaXRtYXNrIG9mIGN1cnJlbnRseSBlbmFibGVkIERCdWYgc2xpY2VzICovCiB9OwogCiBzdHJ1
Y3Qgc2tsX2RkYl92YWx1ZXMgewpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkx
NV9wY2kuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfcGNpLmMKaW5kZXggMWJiNzAxZDMy
YTVkLi44ZTg2YWY1MDU3MzAgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVf
cGNpLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9wY2kuYwpAQCAtNjE0LDcgKzYx
NCw4IEBAIHN0YXRpYyBjb25zdCBzdHJ1Y3QgaW50ZWxfZGV2aWNlX2luZm8gaW50ZWxfY2hlcnJ5
dmlld19pbmZvID0gewogCS5oYXNfZ3RfdWMgPSAxLCBcCiAJLmRpc3BsYXkuaGFzX2hkY3AgPSAx
LCBcCiAJLmRpc3BsYXkuaGFzX2lwYyA9IDEsIFwKLQkuZGRiX3NpemUgPSA4OTYKKwkuZGRiX3Np
emUgPSA4OTYsIFwKKwkuc3VwcG9ydGVkX3NsaWNlcyA9IDEKIAogI2RlZmluZSBTS0xfUExBVEZP
Uk0gXAogCUdFTjlfRkVBVFVSRVMsIFwKQEAgLTY1MCw2ICs2NTEsNyBAQCBzdGF0aWMgY29uc3Qg
c3RydWN0IGludGVsX2RldmljZV9pbmZvIGludGVsX3NreWxha2VfZ3Q0X2luZm8gPSB7CiAJR0VO
KDkpLCBcCiAJLmlzX2xwID0gMSwgXAogCS5kaXNwbGF5Lmhhc19ob3RwbHVnID0gMSwgXAorCS5z
dXBwb3J0ZWRfc2xpY2VzID0gMSwgXAogCS5lbmdpbmVfbWFzayA9IEJJVChSQ1MwKSB8IEJJVChW
Q1MwKSB8IEJJVChCQ1MwKSB8IEJJVChWRUNTMCksIFwKIAkucGlwZV9tYXNrID0gQklUKFBJUEVf
QSkgfCBCSVQoUElQRV9CKSB8IEJJVChQSVBFX0MpLCBcCiAJLmhhc182NGJpdF9yZWxvYyA9IDEs
IFwKQEAgLTczNyw2ICs3MzksNyBAQCBzdGF0aWMgY29uc3Qgc3RydWN0IGludGVsX2RldmljZV9p
bmZvIGludGVsX2NvZmZlZWxha2VfZ3QzX2luZm8gPSB7CiAJR0VOOV9GRUFUVVJFUywgXAogCUdF
TigxMCksIFwKIAkuZGRiX3NpemUgPSAxMDI0LCBcCisJLnN1cHBvcnRlZF9zbGljZXMgPSAxLCBc
CiAJLmRpc3BsYXkuaGFzX2RzYyA9IDEsIFwKIAkuaGFzX2NvaGVyZW50X2dndHQgPSBmYWxzZSwg
XAogCUdMS19DT0xPUlMKQEAgLTc3Myw2ICs3NzYsNyBAQCBzdGF0aWMgY29uc3Qgc3RydWN0IGlu
dGVsX2RldmljZV9pbmZvIGludGVsX2Nhbm5vbmxha2VfaW5mbyA9IHsKIAl9LCBcCiAJR0VOKDEx
KSwgXAogCS5kZGJfc2l6ZSA9IDIwNDgsIFwKKwkuc3VwcG9ydGVkX3NsaWNlcyA9IDIsIFwKIAku
aGFzX2xvZ2ljYWxfcmluZ19lbHNxID0gMSwgXAogCS5jb2xvciA9IHsgLmRlZ2FtbWFfbHV0X3Np
emUgPSAzMywgLmdhbW1hX2x1dF9zaXplID0gMjYyMTQ1IH0KIApkaWZmIC0tZ2l0IGEvZHJpdmVy
cy9ncHUvZHJtL2k5MTUvaTkxNV9yZWcuaCBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfcmVn
LmgKaW5kZXggYTYwN2VhNTIwODI5Li5mYmE1NzMxMDYzZDggMTAwNjQ0Ci0tLSBhL2RyaXZlcnMv
Z3B1L2RybS9pOTE1L2k5MTVfcmVnLmgKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9y
ZWcuaApAQCAtNzczNCw5ICs3NzM0LDExIEBAIGVudW0gewogI2RlZmluZSBESVNQX0FSQl9DVEwy
CV9NTUlPKDB4NDUwMDQpCiAjZGVmaW5lICBESVNQX0RBVEFfUEFSVElUSU9OXzVfNgkoMSA8PCA2
KQogI2RlZmluZSAgRElTUF9JUENfRU5BQkxFCQkoMSA8PCAzKQotI2RlZmluZSBEQlVGX0NUTAlf
TU1JTygweDQ1MDA4KQotI2RlZmluZSBEQlVGX0NUTF9TMQlfTU1JTygweDQ1MDA4KQotI2RlZmlu
ZSBEQlVGX0NUTF9TMglfTU1JTygweDQ0RkU4KQorI2RlZmluZSBEQlVGX1MxX0JJVAkJCUJJVCgw
KQorI2RlZmluZSBEQlVGX1MyX0JJVAkJCUJJVCgxKQorI2RlZmluZSBEQlVGX0NUTAkJCV9NTUlP
KDB4NDUwMDgpCisjZGVmaW5lIERCVUZfQ1RMX1MxCQkJX01NSU8oMHg0NTAwOCkKKyNkZWZpbmUg
REJVRl9DVExfUzIJCQlfTU1JTygweDQ0RkU4KQogI2RlZmluZSAgREJVRl9QT1dFUl9SRVFVRVNU
CQkoMSA8PCAzMSkKICNkZWZpbmUgIERCVUZfUE9XRVJfU1RBVEUJCSgxIDw8IDMwKQogI2RlZmlu
ZSBHRU43X01TR19DVEwJX01NSU8oMHg0NTAxMCkKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2Ry
bS9pOTE1L2ludGVsX2RldmljZV9pbmZvLmggYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pbnRlbF9k
ZXZpY2VfaW5mby5oCmluZGV4IDRiZGY4YTZjZmI0Ny4uYmEzNGUxYTVjNTkxIDEwMDY0NAotLS0g
YS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pbnRlbF9kZXZpY2VfaW5mby5oCisrKyBiL2RyaXZlcnMv
Z3B1L2RybS9pOTE1L2ludGVsX2RldmljZV9pbmZvLmgKQEAgLTE4MCw2ICsxODAsNyBAQCBzdHJ1
Y3QgaW50ZWxfZGV2aWNlX2luZm8gewogCX0gZGlzcGxheTsKIAogCXUxNiBkZGJfc2l6ZTsgLyog
aW4gYmxvY2tzICovCisJdTggc3VwcG9ydGVkX3NsaWNlczsgLyogbnVtYmVyIG9mIERCdWYgc2xp
Y2VzICovCiAKIAkvKiBSZWdpc3RlciBvZmZzZXRzIGZvciB0aGUgdmFyaW91cyBkaXNwbGF5IHBp
cGVzIGFuZCB0cmFuc2NvZGVycyAqLwogCWludCBwaXBlX29mZnNldHNbSTkxNV9NQVhfVFJBTlND
T0RFUlNdOwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50ZWxfcG0uYyBiL2Ry
aXZlcnMvZ3B1L2RybS9pOTE1L2ludGVsX3BtLmMKaW5kZXggMmQzODllNDM3ZTg3Li4xZWE4MWFi
OTI0MjkgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2ludGVsX3BtLmMKKysrIGIv
ZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50ZWxfcG0uYwpAQCAtMzU4NiwyNCArMzU4NiwyMCBAQCBi
b29sIGlsa19kaXNhYmxlX2xwX3dtKHN0cnVjdCBkcm1fZGV2aWNlICpkZXYpCiAJcmV0dXJuIF9p
bGtfZGlzYWJsZV9scF93bShkZXZfcHJpdiwgV01fRElSVFlfTFBfQUxMKTsKIH0KIAotc3RhdGlj
IHU4IGludGVsX2VuYWJsZWRfZGJ1Zl9zbGljZXNfbnVtKHN0cnVjdCBkcm1faTkxNV9wcml2YXRl
ICpkZXZfcHJpdikKK3N0YXRpYyB1OCBpbnRlbF9lbmFibGVkX2RidWZfc2xpY2VzKHN0cnVjdCBk
cm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikKIHsKLQl1OCBlbmFibGVkX3NsaWNlczsKLQotCS8q
IFNsaWNlIDEgd2lsbCBhbHdheXMgYmUgZW5hYmxlZCAqLwotCWVuYWJsZWRfc2xpY2VzID0gMTsK
Kwl1OCBlbmFibGVkX3NsaWNlcyA9IDA7CiAKIAkvKiBHZW4gcHJpb3IgdG8gR0VOMTEgaGF2ZSBv
bmx5IG9uZSBEQnVmIHNsaWNlICovCiAJaWYgKElOVEVMX0dFTihkZXZfcHJpdikgPCAxMSkKLQkJ
cmV0dXJuIGVuYWJsZWRfc2xpY2VzOworCQlyZXR1cm4gREJVRl9TMV9CSVQ7CiAKLQkvKgotCSAq
IEZJWE1FOiBmb3Igbm93IHdlJ2xsIG9ubHkgZXZlciB1c2UgMSBzbGljZTsgcHJldGVuZCB0aGF0
IHdlIGhhdmUKLQkgKiBvbmx5IHRoYXQgMSBzbGljZSBlbmFibGVkIHVudGlsIHdlIGhhdmUgYSBw
cm9wZXIgd2F5IGZvciBvbi1kZW1hbmQKLQkgKiB0b2dnbGluZyBvZiB0aGUgc2Vjb25kIHNsaWNl
LgotCSAqLwotCWlmICgwICYmIEk5MTVfUkVBRChEQlVGX0NUTF9TMikgJiBEQlVGX1BPV0VSX1NU
QVRFKQotCQllbmFibGVkX3NsaWNlcysrOworCS8qIENoZWNrIGlmIHNlY29uZCBEQnVmIHNsaWNl
IGlzIGVuYWJsZWQgKi8KKwlpZiAoSTkxNV9SRUFEKERCVUZfQ1RMX1MxKSAmIERCVUZfUE9XRVJf
U1RBVEUpCisJCWVuYWJsZWRfc2xpY2VzIHw9IERCVUZfUzFfQklUOworCisJaWYgKEk5MTVfUkVB
RChEQlVGX0NUTF9TMikgJiBEQlVGX1BPV0VSX1NUQVRFKQorCQllbmFibGVkX3NsaWNlcyB8PSBE
QlVGX1MyX0JJVDsKIAogCXJldHVybiBlbmFibGVkX3NsaWNlczsKIH0KQEAgLTM4MTIsMzYgKzM4
MDgsMzggQEAgc3RhdGljIHUxNiBpbnRlbF9nZXRfZGRiX3NpemUoc3RydWN0IGRybV9pOTE1X3By
aXZhdGUgKmRldl9wcml2LAogCQkJICAgICAgY29uc3QgaW50IG51bV9hY3RpdmUsCiAJCQkgICAg
ICBzdHJ1Y3Qgc2tsX2RkYl9hbGxvY2F0aW9uICpkZGIpCiB7Ci0JY29uc3Qgc3RydWN0IGRybV9k
aXNwbGF5X21vZGUgKmFkanVzdGVkX21vZGU7Ci0JdTY0IHRvdGFsX2RhdGFfYnc7CiAJdTE2IGRk
Yl9zaXplID0gSU5URUxfSU5GTyhkZXZfcHJpdiktPmRkYl9zaXplOwotCiAJV0FSTl9PTihkZGJf
c2l6ZSA9PSAwKTsKIAogCWlmIChJTlRFTF9HRU4oZGV2X3ByaXYpIDwgMTEpCiAJCXJldHVybiBk
ZGJfc2l6ZSAtIDQ7IC8qIDQgYmxvY2tzIGZvciBieXBhc3MgcGF0aCBhbGxvY2F0aW9uICovCiAK
LQlhZGp1c3RlZF9tb2RlID0gJmNydGNfc3RhdGUtPmh3LmFkanVzdGVkX21vZGU7Ci0JdG90YWxf
ZGF0YV9idyA9IHRvdGFsX2RhdGFfcmF0ZSAqIGRybV9tb2RlX3ZyZWZyZXNoKGFkanVzdGVkX21v
ZGUpOworCXJldHVybiBkZGJfc2l6ZTsKK30KIAotCS8qCi0JICogMTJHQi9zIGlzIG1heGltdW0g
Qlcgc3VwcG9ydGVkIGJ5IHNpbmdsZSBEQnVmIHNsaWNlLgotCSAqCi0JICogRklYTUUgZGJ1ZiBz
bGljZSBjb2RlIGlzIGJyb2tlbjoKLQkgKiAtIG11c3Qgd2FpdCBmb3IgcGxhbmVzIHRvIHN0b3Ag
dXNpbmcgdGhlIHNsaWNlIGJlZm9yZSBwb3dlcmluZyBpdCBvZmYKLQkgKiAtIHBsYW5lIHN0cmFk
ZGxpbmcgYm90aCBzbGljZXMgaXMgaWxsZWdhbCBpbiBtdWx0aS1waXBlIHNjZW5hcmlvcwotCSAq
IC0gc2hvdWxkIHZhbGlkYXRlIHdlIHN0YXkgd2l0aGluIHRoZSBodyBiYW5kd2lkdGggbGltaXRz
Ci0JICovCi0JaWYgKDAgJiYgKG51bV9hY3RpdmUgPiAxIHx8IHRvdGFsX2RhdGFfYncgPj0gR0Jw
cygxMikpKSB7Ci0JCWRkYi0+ZW5hYmxlZF9zbGljZXMgPSAyOwotCX0gZWxzZSB7Ci0JCWRkYi0+
ZW5hYmxlZF9zbGljZXMgPSAxOwotCQlkZGJfc2l6ZSAvPSAyOwotCX0KKy8qCisgKiBDYWxjdWxh
dGUgaW5pdGlhbCBEQnVmIHNsaWNlIG9mZnNldCwgYmFzZWQgb24gc2xpY2Ugc2l6ZQorICogYW5k
IG1hc2soaS5lIGlmIHNsaWNlIHNpemUgaXMgMTAyNCBhbmQgc2Vjb25kIHNsaWNlIGlzIGVuYWJs
ZWQKKyAqIG9mZnNldCB3b3VsZCBiZSAxMDI0KQorICovCitzdGF0aWMgdTMyIHNrbF9nZXRfZmly
c3RfZGJ1Zl9zbGljZV9vZmZzZXQodTMyIGRidWZfc2xpY2VfbWFzaywKKwkJCQkJICAgdTMyIHNs
aWNlX3NpemUsIHUzMiBkZGJfc2l6ZSkKK3sKKwl1MzIgb2Zmc2V0ID0gMDsKIAotCXJldHVybiBk
ZGJfc2l6ZTsKKwlpZiAoIWRidWZfc2xpY2VfbWFzaykKKwkJcmV0dXJuIDA7CisKKwlvZmZzZXQg
PSAoZmZzKGRidWZfc2xpY2VfbWFzaykgLSAxKSAqIHNsaWNlX3NpemU7CisKKwlXQVJOX09OKG9m
ZnNldCA+PSBkZGJfc2l6ZSk7CisJcmV0dXJuIG9mZnNldDsKIH0KIAorc3RhdGljIHUzMiBpOTE1
X2dldF9hbGxvd2VkX2RidWZfbWFzayhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYs
CisJCQkJICAgICAgaW50IHBpcGUsIHUzMiBhY3RpdmVfcGlwZXMsCisJCQkJICAgICAgY29uc3Qg
c3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUpOworCiBzdGF0aWMgdm9pZAogc2ts
X2RkYl9nZXRfcGlwZV9hbGxvY2F0aW9uX2xpbWl0cyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAq
ZGV2X3ByaXYsCiAJCQkJICAgY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3Rh
dGUsCkBAIC0zODU3LDcgKzM4NTUsMTQgQEAgc2tsX2RkYl9nZXRfcGlwZV9hbGxvY2F0aW9uX2xp
bWl0cyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCiAJdTMyIHBpcGVfd2lkdGgg
PSAwLCB0b3RhbF93aWR0aCA9IDAsIHdpZHRoX2JlZm9yZV9waXBlID0gMDsKIAllbnVtIHBpcGUg
Zm9yX3BpcGUgPSB0b19pbnRlbF9jcnRjKGZvcl9jcnRjKS0+cGlwZTsKIAl1MTYgZGRiX3NpemU7
CisJdTMyIGRkYl9yYW5nZV9zaXplOwogCXUzMiBpOworCXUzMiBkYnVmX3NsaWNlX21hc2s7CisJ
dTMyIGFjdGl2ZV9waXBlczsKKwl1MzIgb2Zmc2V0OworCXUzMiBzbGljZV9zaXplOworCXUzMiB0
b3RhbF9zbGljZV9tYXNrOworCXUzMiBzdGFydCwgZW5kOwogCiAJaWYgKFdBUk5fT04oIXN0YXRl
KSB8fCAhY3J0Y19zdGF0ZS0+aHcuYWN0aXZlKSB7CiAJCWFsbG9jLT5zdGFydCA9IDA7CkBAIC0z
ODY2LDE0ICszODcxLDIzIEBAIHNrbF9kZGJfZ2V0X3BpcGVfYWxsb2NhdGlvbl9saW1pdHMoc3Ry
dWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAogCQlyZXR1cm47CiAJfQogCi0JaWYgKGlu
dGVsX3N0YXRlLT5hY3RpdmVfcGlwZV9jaGFuZ2VzKQorCWlmIChpbnRlbF9zdGF0ZS0+YWN0aXZl
X3BpcGVfY2hhbmdlcykgewogCQkqbnVtX2FjdGl2ZSA9IGh3ZWlnaHQ4KGludGVsX3N0YXRlLT5h
Y3RpdmVfcGlwZXMpOwotCWVsc2UKKwkJYWN0aXZlX3BpcGVzID0gaW50ZWxfc3RhdGUtPmFjdGl2
ZV9waXBlczsKKwl9IGVsc2UgewogCQkqbnVtX2FjdGl2ZSA9IGh3ZWlnaHQ4KGRldl9wcml2LT5h
Y3RpdmVfcGlwZXMpOworCQlhY3RpdmVfcGlwZXMgPSBkZXZfcHJpdi0+YWN0aXZlX3BpcGVzOwor
CX0KIAogCWRkYl9zaXplID0gaW50ZWxfZ2V0X2RkYl9zaXplKGRldl9wcml2LCBjcnRjX3N0YXRl
LCB0b3RhbF9kYXRhX3JhdGUsCiAJCQkJICAgICAgKm51bV9hY3RpdmUsIGRkYik7CiAKKwlEUk1f
REVCVUdfS01TKCJHb3QgdG90YWwgZGRiIHNpemUgJWRcbiIsIGRkYl9zaXplKTsKKworCXNsaWNl
X3NpemUgPSBkZGJfc2l6ZSAvIElOVEVMX0lORk8oZGV2X3ByaXYpLT5zdXBwb3J0ZWRfc2xpY2Vz
OworCisJRFJNX0RFQlVHX0tNUygiR290IERCdWYgc2xpY2Ugc2l6ZSAlZFxuIiwgc2xpY2Vfc2l6
ZSk7CisKIAkvKgogCSAqIElmIHRoZSBzdGF0ZSBkb2Vzbid0IGNoYW5nZSB0aGUgYWN0aXZlIENS
VEMncyBvciB0aGVyZSBpcyBubwogCSAqIG1vZGVzZXQgcmVxdWVzdCwgdGhlbiB0aGVyZSdzIG5v
IG5lZWQgdG8gcmVjYWxjdWxhdGU7CkBAIC0zODkxLDIwICszOTA1LDcwIEBAIHNrbF9kZGJfZ2V0
X3BpcGVfYWxsb2NhdGlvbl9saW1pdHMoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2
LAogCQlyZXR1cm47CiAJfQogCisJLyoKKwkgKiBHZXQgYWxsb3dlZCBEQnVmIHNsaWNlcyBmb3Ig
Y29ycmVzcG9uZGVudCBwaXBlIGFuZCBwbGF0Zm9ybS4KKwkgKi8KKwlkYnVmX3NsaWNlX21hc2sg
PSBpOTE1X2dldF9hbGxvd2VkX2RidWZfbWFzayhkZXZfcHJpdiwgZm9yX3BpcGUsCisJCQkJCQkg
ICAgIGFjdGl2ZV9waXBlcywgY3J0Y19zdGF0ZSk7CisKKwlEUk1fREVCVUdfS01TKCJEQnVmIHNs
aWNlIG1hc2sgJXggcGlwZSAlZCBhY3RpdmUgcGlwZXMgJXhcbiIsCisJCSAgICAgIGRidWZfc2xp
Y2VfbWFzaywKKwkJICAgICAgZm9yX3BpcGUsIGFjdGl2ZV9waXBlcyk7CisKKwkvKgorCSAqIEZp
Z3VyZSBvdXQgYXQgd2hpY2ggREJ1ZiBzbGljZSB3ZSBzdGFydCwgaS5lIGlmIHdlIHN0YXJ0IGF0
IERidWYgUzIKKwkgKiBhbmQgc2xpY2Ugc2l6ZSBpcyAxMDI0LCB0aGUgb2Zmc2V0IHdvdWxkIGJl
IDEwMjQKKwkgKi8KKwlvZmZzZXQgPSBza2xfZ2V0X2ZpcnN0X2RidWZfc2xpY2Vfb2Zmc2V0KGRi
dWZfc2xpY2VfbWFzaywKKwkJCQkJCSBzbGljZV9zaXplLCBkZGJfc2l6ZSk7CisKKwkvKgorCSAq
IEZpZ3VyZSBvdXQgdG90YWwgc2l6ZSBvZiBhbGxvd2VkIERCdWYgc2xpY2VzLCB3aGljaCBpcyBi
YXNpY2FsbHkKKwkgKiBhIG51bWJlciBvZiBhbGxvd2VkIHNsaWNlcyBmb3IgdGhhdCBwaXBlIG11
bHRpcGxpZWQgYnkgc2xpY2Ugc2l6ZS4KKwkgKiBJbnNpZGUgb2YgdGhpcworCSAqIHJhbmdlIGRk
YiBlbnRyaWVzIGFyZSBzdGlsbCBhbGxvY2F0ZWQgaW4gcHJvcG9ydGlvbiB0byBkaXNwbGF5IHdp
ZHRoLgorCSAqLworCWRkYl9yYW5nZV9zaXplID0gaHdlaWdodDgoZGJ1Zl9zbGljZV9tYXNrKSAq
IHNsaWNlX3NpemU7CisKIAkvKgogCSAqIFdhdGVybWFyay9kZGIgcmVxdWlyZW1lbnQgaGlnaGx5
IGRlcGVuZHMgdXBvbiB3aWR0aCBvZiB0aGUKIAkgKiBmcmFtZWJ1ZmZlciwgU28gaW5zdGVhZCBv
ZiBhbGxvY2F0aW5nIEREQiBlcXVhbGx5IGFtb25nIHBpcGVzCiAJICogZGlzdHJpYnV0ZSBEREIg
YmFzZWQgb24gcmVzb2x1dGlvbi93aWR0aCBvZiB0aGUgZGlzcGxheS4KIAkgKi8KKwl0b3RhbF9z
bGljZV9tYXNrID0gZGJ1Zl9zbGljZV9tYXNrOwogCWZvcl9lYWNoX25ld19pbnRlbF9jcnRjX2lu
X3N0YXRlKGludGVsX3N0YXRlLCBjcnRjLCBjcnRjX3N0YXRlLCBpKSB7CiAJCWNvbnN0IHN0cnVj
dCBkcm1fZGlzcGxheV9tb2RlICphZGp1c3RlZF9tb2RlID0KIAkJCSZjcnRjX3N0YXRlLT5ody5h
ZGp1c3RlZF9tb2RlOwogCQllbnVtIHBpcGUgcGlwZSA9IGNydGMtPnBpcGU7CiAJCWludCBoZGlz
cGxheSwgdmRpc3BsYXk7CisJCXUzMiBwaXBlX2RidWZfc2xpY2VfbWFzayA9IFwKKwkJCWk5MTVf
Z2V0X2FsbG93ZWRfZGJ1Zl9tYXNrKGRldl9wcml2LAorCQkJCQkJcGlwZSwKKwkJCQkJCWFjdGl2
ZV9waXBlcywKKwkJCQkJCWNydGNfc3RhdGUpOwogCiAJCWlmICghY3J0Y19zdGF0ZS0+aHcuZW5h
YmxlKQogCQkJY29udGludWU7CiAKKwkJLyoKKwkJICogQWNjb3JkaW5nIHRvIEJTcGVjIHBpcGUg
Y2FuIHNoYXJlIG9uZSBkYnVmIHNsaWNlIHdpdGggYW5vdGhlcgorCQkgKiBwaXBlcyBvciBwaXBl
IGNhbiB1c2UgbXVsdGlwbGUgZGJ1ZnMsIGluIGJvdGggY2FzZXMgd2UKKwkJICogYWNjb3VudCBm
b3Igb3RoZXIgcGlwZXMgb25seSBpZiB0aGV5IGhhdmUgZXhhY3RseSBzYW1lIG1hc2suCisJCSAq
IEhvd2V2ZXIgd2UgbmVlZCB0byBhY2NvdW50IGhvdyBtYW55IHNsaWNlcyB3ZSBzaG91bGQgZW5h
YmxlCisJCSAqIGluIHRvdGFsLgorCQkgKi8KKwkJdG90YWxfc2xpY2VfbWFzayB8PSBwaXBlX2Ri
dWZfc2xpY2VfbWFzazsKKworCQkvKgorCQkgKiBEbyBub3QgYWNjb3VudCBwaXBlcyB1c2luZyBv
dGhlciBzbGljZSBzZXRzCisJCSAqIGx1Y2tpbHkgYXMgb2YgY3VycmVudCBCU3BlYyBzbGljZSBz
ZXRzIGRvIG5vdCBwYXJ0aWFsbHkKKwkJICogaW50ZXJzZWN0KHBpcGVzIHNoYXJlIGVpdGhlciBz
YW1lIG9uZSBzbGljZSBvciBzYW1lIHNsaWNlIHNldAorCQkgKiBpLmUgbm8gcGFydGlhbCBpbnRl
cnNlY3Rpb24pLCBzbyBpdCBpcyBlbm91Z2ggdG8gY2hlY2sgZm9yCisJCSAqIGVxdWFsaXR5IGZv
ciBub3cuCisJCSAqLworCQlpZiAoZGJ1Zl9zbGljZV9tYXNrICE9IHBpcGVfZGJ1Zl9zbGljZV9t
YXNrKQorCQkJY29udGludWU7CisKIAkJZHJtX21vZGVfZ2V0X2h2X3RpbWluZyhhZGp1c3RlZF9t
b2RlLCAmaGRpc3BsYXksICZ2ZGlzcGxheSk7CiAJCXRvdGFsX3dpZHRoICs9IGhkaXNwbGF5Owog
CkBAIC0zOTE0LDggKzM5NzgsMTkgQEAgc2tsX2RkYl9nZXRfcGlwZV9hbGxvY2F0aW9uX2xpbWl0
cyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCiAJCQlwaXBlX3dpZHRoID0gaGRp
c3BsYXk7CiAJfQogCi0JYWxsb2MtPnN0YXJ0ID0gZGRiX3NpemUgKiB3aWR0aF9iZWZvcmVfcGlw
ZSAvIHRvdGFsX3dpZHRoOwotCWFsbG9jLT5lbmQgPSBkZGJfc2l6ZSAqICh3aWR0aF9iZWZvcmVf
cGlwZSArIHBpcGVfd2lkdGgpIC8gdG90YWxfd2lkdGg7CisJZGRiLT5lbmFibGVkX3NsaWNlcyA9
IHRvdGFsX3NsaWNlX21hc2s7CisKKwlzdGFydCA9IGRkYl9yYW5nZV9zaXplICogd2lkdGhfYmVm
b3JlX3BpcGUgLyB0b3RhbF93aWR0aDsKKwllbmQgPSBkZGJfcmFuZ2Vfc2l6ZSAqICh3aWR0aF9i
ZWZvcmVfcGlwZSArIHBpcGVfd2lkdGgpIC8gdG90YWxfd2lkdGg7CisKKwlhbGxvYy0+c3RhcnQg
PSBvZmZzZXQgKyBzdGFydDsKKwlhbGxvYy0+ZW5kID0gb2Zmc2V0ICsgZW5kOworCisJRFJNX0RF
QlVHX0tNUygiUGlwZSAlZCBkZGIgJWQtJWRcbiIsIGZvcl9waXBlLAorCQkgICAgICBhbGxvYy0+
c3RhcnQsIGFsbG9jLT5lbmQpOworCURSTV9ERUJVR19LTVMoIkVuYWJsZWQgZGRiIHNsaWNlcyBt
YXNrICV4IG51bSBzdXBwb3J0ZWQgJWRcbiIsCisJCSAgICAgIGRkYi0+ZW5hYmxlZF9zbGljZXMs
CisJCSAgICAgIElOVEVMX0lORk8oZGV2X3ByaXYpLT5zdXBwb3J0ZWRfc2xpY2VzKTsKIH0KIAog
c3RhdGljIGludCBza2xfY29tcHV0ZV93bV9wYXJhbXMoY29uc3Qgc3RydWN0IGludGVsX2NydGNf
c3RhdGUgKmNydGNfc3RhdGUsCkBAIC00MDM2LDcgKzQxMTEsOCBAQCB2b2lkIHNrbF9waXBlX2Rk
Yl9nZXRfaHdfc3RhdGUoc3RydWN0IGludGVsX2NydGMgKmNydGMsCiB2b2lkIHNrbF9kZGJfZ2V0
X2h3X3N0YXRlKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKIAkJCSAgc3RydWN0
IHNrbF9kZGJfYWxsb2NhdGlvbiAqZGRiIC8qIG91dCAqLykKIHsKLQlkZGItPmVuYWJsZWRfc2xp
Y2VzID0gaW50ZWxfZW5hYmxlZF9kYnVmX3NsaWNlc19udW0oZGV2X3ByaXYpOworCWRkYi0+ZW5h
YmxlZF9zbGljZXMgPSBpbnRlbF9lbmFibGVkX2RidWZfc2xpY2VzKGRldl9wcml2KTsKKwlEUk1f
REVCVUdfS01TKCJHb3QgaHcgZGJ1ZiBzbGljZXMgbWFzayAleFxuIiwgZGRiLT5lbmFibGVkX3Ns
aWNlcyk7CiB9CiAKIC8qCkBAIC00MTY0LDYgKzQyNDAsMjQxIEBAIHNrbF9nZXRfdG90YWxfcmVs
YXRpdmVfZGF0YV9yYXRlKHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlLAogCXJl
dHVybiB0b3RhbF9kYXRhX3JhdGU7CiB9CiAKK3N0YXRpYyB1aW50X2ZpeGVkXzE2XzE2X3QKK2lj
bF9waXBlX2Rvd25zY2FsZV9hbW91bnQoY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNy
dGNfc3RhdGUpCit7CisJdTMyIHNyY193LCBzcmNfaCwgZHN0X3csIGRzdF9oOworCXVpbnRfZml4
ZWRfMTZfMTZfdCBmcF93X3JhdGlvLCBmcF9oX3JhdGlvOworCXVpbnRfZml4ZWRfMTZfMTZfdCBk
b3duc2NhbGVfaCwgZG93bnNjYWxlX3c7CisJY29uc3Qgc3RydWN0IGRybV9kaXNwbGF5X21vZGUg
KmFkanVzdGVkX21vZGUgPSAmY3J0Y19zdGF0ZS0+aHcuYWRqdXN0ZWRfbW9kZTsKKworCXNyY193
ID0gY3J0Y19zdGF0ZS0+cGlwZV9zcmNfdzsKKwlzcmNfaCA9IGNydGNfc3RhdGUtPnBpcGVfc3Jj
X2g7CisJZHN0X3cgPSBhZGp1c3RlZF9tb2RlLT5jcnRjX2hkaXNwbGF5OworCWRzdF9oID0gYWRq
dXN0ZWRfbW9kZS0+Y3J0Y192ZGlzcGxheTsKKworCWZwX3dfcmF0aW8gPSBkaXZfZml4ZWQxNihz
cmNfdywgZHN0X3cpOworCWZwX2hfcmF0aW8gPSBkaXZfZml4ZWQxNihzcmNfaCwgZHN0X2gpOwor
CWRvd25zY2FsZV93ID0gbWF4X2ZpeGVkMTYoZnBfd19yYXRpbywgdTMyX3RvX2ZpeGVkMTYoMSkp
OworCWRvd25zY2FsZV9oID0gbWF4X2ZpeGVkMTYoZnBfaF9yYXRpbywgdTMyX3RvX2ZpeGVkMTYo
MSkpOworCisJcmV0dXJuIG11bF9maXhlZDE2KGRvd25zY2FsZV93LCBkb3duc2NhbGVfaCk7Cit9
CisKK3VpbnRfZml4ZWRfMTZfMTZfdAoraWNsX2dldF9waXBlX3JhdGlvKGNvbnN0IHN0cnVjdCBp
bnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlKQoreworCXN0cnVjdCBkcm1fcGxhbmUgKnBsYW5l
OworCWNvbnN0IHN0cnVjdCBkcm1fcGxhbmVfc3RhdGUgKmRybV9wbGFuZV9zdGF0ZTsKKwl1aW50
X2ZpeGVkXzE2XzE2X3QgcGlwZV9kb3duc2NhbGUsIHBpcGVfcmF0aW87CisJdWludF9maXhlZF8x
Nl8xNl90IG1heF9kb3duc2NhbGUgPSB1MzJfdG9fZml4ZWQxNigxKTsKKwlzdHJ1Y3QgaW50ZWxf
Y3J0YyAqY3J0YyA9IHRvX2ludGVsX2NydGMoY3J0Y19zdGF0ZS0+dWFwaS5jcnRjKTsKKworCWlm
ICghY3J0Y19zdGF0ZS0+dWFwaS5lbmFibGUpCisJCXJldHVybiBtYXhfZG93bnNjYWxlOworCisJ
ZHJtX2F0b21pY19jcnRjX3N0YXRlX2Zvcl9lYWNoX3BsYW5lX3N0YXRlKHBsYW5lLCBkcm1fcGxh
bmVfc3RhdGUsICZjcnRjX3N0YXRlLT51YXBpKSB7CisJCXVpbnRfZml4ZWRfMTZfMTZfdCBwbGFu
ZV9kb3duc2NhbGU7CisJCWNvbnN0IHN0cnVjdCBpbnRlbF9wbGFuZV9zdGF0ZSAqcGxhbmVfc3Rh
dGUgPQorCQkJdG9faW50ZWxfcGxhbmVfc3RhdGUoZHJtX3BsYW5lX3N0YXRlKTsKKworCQlpZiAo
IWludGVsX3dtX3BsYW5lX3Zpc2libGUoY3J0Y19zdGF0ZSwgcGxhbmVfc3RhdGUpKQorCQkJY29u
dGludWU7CisKKwkJcGxhbmVfZG93bnNjYWxlID0gc2tsX3BsYW5lX2Rvd25zY2FsZV9hbW91bnQo
Y3J0Y19zdGF0ZSwgcGxhbmVfc3RhdGUpOworCisJCURSTV9ERUJVR19LTVMoIlBsYW5lICVkIGRv
d25zY2FsZSBhbW91bnQgJWQuJWRcbiIsCisJCQkgICAgICB0b19pbnRlbF9wbGFuZShwbGFuZSkt
PmlkLAorCQkJICAgICAgcGxhbmVfZG93bnNjYWxlLnZhbCA+PiAxNiwKKwkJCSAgICAgIHBsYW5l
X2Rvd25zY2FsZS52YWwgJiAweGZmZmYpOworCisJCW1heF9kb3duc2NhbGUgPSBtYXhfZml4ZWQx
NihwbGFuZV9kb3duc2NhbGUsIG1heF9kb3duc2NhbGUpOworCX0KKworCisJcGlwZV9kb3duc2Nh
bGUgPSBpY2xfcGlwZV9kb3duc2NhbGVfYW1vdW50KGNydGNfc3RhdGUpOworCisJRFJNX0RFQlVH
X0tNUygiUGlwZSAlZCBkb3duc2NhbGUgYW1vdW50ICVkLiVkXG4iLAorCQkgICAgICAgY3J0Yy0+
cGlwZSwgcGlwZV9kb3duc2NhbGUudmFsID4+IDE2LAorCQkgICAgICAgcGlwZV9kb3duc2NhbGUu
dmFsICYgMHhmZmZmKTsKKworCXBpcGVfZG93bnNjYWxlID0gbXVsX2ZpeGVkMTYocGlwZV9kb3du
c2NhbGUsIG1heF9kb3duc2NhbGUpOworCisJLyoKKwkgKiBDb252ZXJ0IHJlc3VsdCB0byBwZXJj
ZW50YWdlOiBnZXQgdGhlIGFjdHVhbCByYXRpbyBpbnN0ZWFkIG9mIHJhdGUsCisJICogdGhlbiBt
dWx0aXBseSBieSAxMDAgdG8gZ2V0IHBlcmNlbnRhZ2UuCisJICovCisJcGlwZV9yYXRpbyA9IHUz
Ml90b19maXhlZDE2KDEwMCAqIGRpdl9yb3VuZF91cF91MzJfZml4ZWQxNigxLCBwaXBlX2Rvd25z
Y2FsZSkpOworCisJRFJNX0RFQlVHX0tNUygiUGlwZSAlZCByYXRpbyAlZC4lZFxuIiwgY3J0Yy0+
cGlwZSwKKwkJICAgICAgcGlwZV9yYXRpby52YWwgPj4gMTYsIHBpcGVfcmF0aW8udmFsICYgMHhm
ZmZmKTsKKworCXJldHVybiBwaXBlX3JhdGlvOworfQorCitzdHJ1Y3QgZGJ1Zl9zbGljZV9jb25m
X2VudHJ5IHsKKwl1MzIgZGJ1Zl9tYXNrW0k5MTVfTUFYX1BJUEVTXTsKKwl1MzIgYWN0aXZlX3Bp
cGVzOworfTsKKworCisjZGVmaW5lIElDTF9QSVBFX0FfREJVRl9TTElDRVMoREJ1ZjEpICBcCisJ
eyB7IERCdWYxLCAwLCAwLCAwIH0sIEJJVChQSVBFX0EpIH0KKyNkZWZpbmUgSUNMX1BJUEVfQl9E
QlVGX1NMSUNFUyhEQnVmMSkgIFwKKwl7IHsgMCwgREJ1ZjEsIDAsIDAgfSwgQklUKFBJUEVfQikg
fQorI2RlZmluZSBJQ0xfUElQRV9DX0RCVUZfU0xJQ0VTKERCdWYxKSAgXAorCXsgeyAwLCAwLCBE
QnVmMSwgMCB9LCBCSVQoUElQRV9DKSB9CisjZGVmaW5lIElDTF9QSVBFX0RfREJVRl9TTElDRVMo
REJ1ZjEpICBcCisJeyB7IDAsIDAsIDAsIERCdWYxIH0sIEJJVChQSVBFX0QpIH0KKyNkZWZpbmUg
SUNMX1BJUEVfQUJfREJVRl9TTElDRVMoREJ1ZjEsIERCdWYyKSAgIFwKKwl7IHsgREJ1ZjEsIERC
dWYyLCAwLCAwIH0sIEJJVChQSVBFX0EpIHwgQklUKFBJUEVfQikgfQorI2RlZmluZSBJQ0xfUElQ
RV9CQ19EQlVGX1NMSUNFUyhEQnVmMSwgREJ1ZjIpICAgXAorCXsgeyAwLCBEQnVmMSwgREJ1ZjIs
IDAgfSwgQklUKFBJUEVfQikgfCBCSVQoUElQRV9DKSB9CisjZGVmaW5lIElDTF9QSVBFX0JEX0RC
VUZfU0xJQ0VTKERCdWYxLCBEQnVmMikgICBcCisJeyB7IDAsIERCdWYxLCAwLCBEQnVmMiB9LCBC
SVQoUElQRV9CKSB8IEJJVChQSVBFX0QpIH0KKyNkZWZpbmUgSUNMX1BJUEVfQUNfREJVRl9TTElD
RVMoREJ1ZjEsIERCdWYyKSAgIFwKKwl7IHsgREJ1ZjEsIDAsIERCdWYyLCAwIH0sIEJJVChQSVBF
X0EpIHwgQklUKFBJUEVfQykgfQorI2RlZmluZSBJQ0xfUElQRV9BRF9EQlVGX1NMSUNFUyhEQnVm
MSwgREJ1ZjIpICAgXAorCXsgeyBEQnVmMSwgMCwgMCwgREJ1ZjIgfSwgQklUKFBJUEVfQSkgfCBC
SVQoUElQRV9EKSB9CisjZGVmaW5lIElDTF9QSVBFX0NEX0RCVUZfU0xJQ0VTKERCdWYxLCBEQnVm
MikgICBcCisJeyB7IDAsIDAsIERCdWYxLCBEQnVmMiB9LCBCSVQoUElQRV9DKSB8IEJJVChQSVBF
X0QpIH0KKyNkZWZpbmUgSUNMX1BJUEVfQUJDX0RCVUZfU0xJQ0VTKERCdWYxLCBEQnVmMiwgREJ1
ZjMpICBcCisJeyB7IERCdWYxLCBEQnVmMiwgREJ1ZjMsIDAgfSwgQklUKFBJUEVfQSkgfCBCSVQo
UElQRV9CKSB8IEJJVChQSVBFX0MpIH0KKyNkZWZpbmUgSUNMX1BJUEVfQUNEX0RCVUZfU0xJQ0VT
KERCdWYxLCBEQnVmMiwgREJ1ZjMpICBcCisJeyB7IERCdWYxLCAwLCBEQnVmMiwgREJ1ZjMgfSwg
QklUKFBJUEVfQSkgfCBCSVQoUElQRV9DKSB8IEJJVChQSVBFX0QpIH0KKyNkZWZpbmUgSUNMX1BJ
UEVfQkNEX0RCVUZfU0xJQ0VTKERCdWYxLCBEQnVmMiwgREJ1ZjMpICBcCisJeyB7IDAsIERCdWYx
LCBEQnVmMiwgREJ1ZjMgfSwgQklUKFBJUEVfQikgfCBCSVQoUElQRV9DKSB8IEJJVChQSVBFX0Qp
IH0KKyNkZWZpbmUgSUNMX1BJUEVfQUJEX0RCVUZfU0xJQ0VTKERCdWYxLCBEQnVmMiwgREJ1ZjMp
ICBcCisJeyB7IERCdWYxLCBEQnVmMiwgMCwgREJ1ZjMgfSwgQklUKFBJUEVfQSkgfCBCSVQoUElQ
RV9CKSB8IEJJVChQSVBFX0QpIH0KKyNkZWZpbmUgSUNMX1BJUEVfQUJDX0RCVUZfU0xJQ0VTKERC
dWYxLCBEQnVmMiwgREJ1ZjMpICBcCisJeyB7IERCdWYxLCBEQnVmMiwgREJ1ZjMsIDAgfSwgQklU
KFBJUEVfQSkgfCBCSVQoUElQRV9CKSB8IEJJVChQSVBFX0MpIH0KKyNkZWZpbmUgSUNMX1BJUEVf
QUJDRF9EQlVGX1NMSUNFUyhEQnVmMSwgREJ1ZjIsIERCdWYzLCBEQnVmNCkgIFwKKwl7IHsgREJ1
ZjEsIERCdWYyLCBEQnVmMywgREJ1ZjQgfSwgQklUKFBJUEVfQSkgfCBCSVQoUElQRV9CKSB8IFwK
KwkJCQkJICBCSVQoUElQRV9DKSB8IEJJVChQSVBFX0QpIH0KKworLyoKKyAqIFRhYmxlIHRha2Vu
IGZyb20gQnNwZWMgMTI3MTYKKyAqIFBpcGVzIGRvIGhhdmUgc29tZSBwcmVmZXJyZWQgREJ1ZiBz
bGljZSBhZmZpbml0eSwKKyAqIHBsdXMgdGhlcmUgYXJlIHNvbWUgaGFyZGNvZGVkIHJlcXVpcmVt
ZW50cyBvbiBob3cKKyAqIHRob3NlIHNob3VsZCBiZSBkaXN0cmlidXRlZCBmb3IgbXVsdGlwaXBl
IHNjZW5hcmlvcy4KKyAqIEZvciBtb3JlIERCdWYgc2xpY2VzIGFsZ29yaXRobSBjYW4gZ2V0IGV2
ZW4gbW9yZSBtZXNzeQorICogYW5kIGxlc3MgcmVhZGFibGUsIHNvIGRlY2lkZWQgdG8gdXNlIGEg
dGFibGUgYWxtb3N0CisgKiBhcyBpcyBmcm9tIEJTcGVjIGl0c2VsZiAtIHRoYXQgd2F5IGl0IGlz
IGF0IGxlYXN0IGVhc2llcgorICogdG8gY29tcGFyZSwgY2hhbmdlIGFuZCBjaGVjay4KKyAqLwor
c3RydWN0IGRidWZfc2xpY2VfY29uZl9lbnRyeSBpY2xfYWxsb3dlZF9kYnVmc1tdID0geworeyB7
IDAsIDAsIDAsIDAgfSwgMCB9LAorSUNMX1BJUEVfQV9EQlVGX1NMSUNFUyhEQlVGX1MxX0JJVCB8
IERCVUZfUzJfQklUKSwgIC8qIHBpcGUgcmF0aW8gPCA4OC44ICovCitJQ0xfUElQRV9BX0RCVUZf
U0xJQ0VTKERCVUZfUzFfQklUKSwgICAgICAgICAgICAgICAgLyogZm9yIHBpcGUgcmF0aW8gPj0g
ODguOCAqLworSUNMX1BJUEVfQl9EQlVGX1NMSUNFUyhEQlVGX1MxX0JJVCB8IERCVUZfUzJfQklU
KSwgIC8qIHBpcGUgcmF0aW8gPCA4OC44ICovCitJQ0xfUElQRV9CX0RCVUZfU0xJQ0VTKERCVUZf
UzFfQklUKSwgICAgICAgICAgICAgICAgLyogZm9yIHBpcGUgcmF0aW8gPj0gODguOCAqLworSUNM
X1BJUEVfQ19EQlVGX1NMSUNFUyhEQlVGX1MxX0JJVCB8IERCVUZfUzJfQklUKSwgIC8qIHBpcGUg
cmF0aW8gPCA4OC44ICovCitJQ0xfUElQRV9DX0RCVUZfU0xJQ0VTKERCVUZfUzJfQklUKSwgICAg
ICAgICAgICAgICAgLyogZm9yIHBpcGUgcmF0aW8gPj0gODguOCAqLworSUNMX1BJUEVfQUJfREJV
Rl9TTElDRVMoREJVRl9TMV9CSVQsIERCVUZfUzJfQklUKSwKK0lDTF9QSVBFX0FDX0RCVUZfU0xJ
Q0VTKERCVUZfUzFfQklULCBEQlVGX1MyX0JJVCksCitJQ0xfUElQRV9CQ19EQlVGX1NMSUNFUyhE
QlVGX1MxX0JJVCwgREJVRl9TMl9CSVQpLAorSUNMX1BJUEVfQUJDX0RCVUZfU0xJQ0VTKERCVUZf
UzFfQklULCBEQlVGX1MxX0JJVCwgREJVRl9TMl9CSVQpLAorfTsKKworLyoKKyAqIFRhYmxlIHRh
a2VuIGZyb20gQnNwZWMgNDkyNTUKKyAqIFBpcGVzIGRvIGhhdmUgc29tZSBwcmVmZXJyZWQgREJ1
ZiBzbGljZSBhZmZpbml0eSwKKyAqIHBsdXMgdGhlcmUgYXJlIHNvbWUgaGFyZGNvZGVkIHJlcXVp
cmVtZW50cyBvbiBob3cKKyAqIHRob3NlIHNob3VsZCBiZSBkaXN0cmlidXRlZCBmb3IgbXVsdGlw
aXBlIHNjZW5hcmlvcy4KKyAqIEZvciBtb3JlIERCdWYgc2xpY2VzIGFsZ29yaXRobSBjYW4gZ2V0
IGV2ZW4gbW9yZSBtZXNzeQorICogYW5kIGxlc3MgcmVhZGFibGUsIHNvIGRlY2lkZWQgdG8gdXNl
IGEgdGFibGUgYWxtb3N0CisgKiBhcyBpcyBmcm9tIEJTcGVjIGl0c2VsZiAtIHRoYXQgd2F5IGl0
IGlzIGF0IGxlYXN0IGVhc2llcgorICogdG8gY29tcGFyZSwgY2hhbmdlIGFuZCBjaGVjay4KKyAq
Lworc3RydWN0IGRidWZfc2xpY2VfY29uZl9lbnRyeSB0Z2xfYWxsb3dlZF9kYnVmc1tdID0gewor
eyB7IDAsIDAsIDAsIDAgfSwgMCB9LAorSUNMX1BJUEVfQV9EQlVGX1NMSUNFUyhEQlVGX1MxX0JJ
VCB8IERCVUZfUzJfQklUKSwKK0lDTF9QSVBFX0JfREJVRl9TTElDRVMoREJVRl9TMV9CSVQgfCBE
QlVGX1MyX0JJVCksCitJQ0xfUElQRV9DX0RCVUZfU0xJQ0VTKERCVUZfUzFfQklUIHwgREJVRl9T
Ml9CSVQpLAorSUNMX1BJUEVfRF9EQlVGX1NMSUNFUyhEQlVGX1MxX0JJVCB8IERCVUZfUzJfQklU
KSwKK0lDTF9QSVBFX0FCX0RCVUZfU0xJQ0VTKERCVUZfUzJfQklULCBEQlVGX1MxX0JJVCksCitJ
Q0xfUElQRV9BQ19EQlVGX1NMSUNFUyhEQlVGX1MxX0JJVCwgREJVRl9TMl9CSVQpLAorSUNMX1BJ
UEVfQkNfREJVRl9TTElDRVMoREJVRl9TMV9CSVQsIERCVUZfUzJfQklUKSwKK0lDTF9QSVBFX0FE
X0RCVUZfU0xJQ0VTKERCVUZfUzFfQklULCBEQlVGX1MyX0JJVCksCitJQ0xfUElQRV9CRF9EQlVG
X1NMSUNFUyhEQlVGX1MxX0JJVCwgREJVRl9TMl9CSVQpLAorSUNMX1BJUEVfQ0RfREJVRl9TTElD
RVMoREJVRl9TMV9CSVQsIERCVUZfUzJfQklUKSwKK0lDTF9QSVBFX0FCRF9EQlVGX1NMSUNFUyhE
QlVGX1MxX0JJVCwgREJVRl9TMV9CSVQsIERCVUZfUzJfQklUKSwKK0lDTF9QSVBFX0FCQ19EQlVG
X1NMSUNFUyhEQlVGX1MxX0JJVCwgREJVRl9TMV9CSVQsIERCVUZfUzJfQklUKSwKK0lDTF9QSVBF
X0FDRF9EQlVGX1NMSUNFUyhEQlVGX1MxX0JJVCwgREJVRl9TMl9CSVQsIERCVUZfUzJfQklUKSwK
K0lDTF9QSVBFX0JDRF9EQlVGX1NMSUNFUyhEQlVGX1MxX0JJVCwgREJVRl9TMl9CSVQsIERCVUZf
UzJfQklUKSwKK0lDTF9QSVBFX0FCQ0RfREJVRl9TTElDRVMoREJVRl9TMV9CSVQsIERCVUZfUzFf
QklULCBEQlVGX1MyX0JJVCwgREJVRl9TMl9CSVQpLAorfTsKKworLyoKKyAqIFRoaXMgZnVuY3Rp
b24gZmluZHMgYW4gZW50cnkgd2l0aCBzYW1lIGVuYWJsZWQgcGlwZSBjb25maWd1cmF0aW9uIGFu
ZAorICogcmV0dXJucyBjb3JyZXNwb25kZW50IERCdWYgc2xpY2UgbWFzayBhcyBzdGF0ZWQgaW4g
QlNwZWMgZm9yIHBhcnRpY3VsYXIKKyAqIHBsYXRmb3JtLgorICovCitzdGF0aWMgdTMyIGljbF9n
ZXRfYWxsb3dlZF9kYnVmX21hc2soaW50IHBpcGUsCisJCQkJICAgICB1MzIgYWN0aXZlX3BpcGVz
LAorCQkJCSAgICAgY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUpCit7
CisJaW50IGk7CisJdWludF9maXhlZF8xNl8xNl90IHBpcGVfcmF0aW87CisKKwkvKgorCSAqIENh
bGN1bGF0ZSBwaXBlIHJhdGlvIGFzIHN0YXRlZCBpbiBCU3BlYyAyODY5MgorCSAqLworCXBpcGVf
cmF0aW8gPSBpY2xfZ2V0X3BpcGVfcmF0aW8oY3J0Y19zdGF0ZSk7CisKKwlmb3IgKGkgPSAwOyBp
IDwgQVJSQVlfU0laRShpY2xfYWxsb3dlZF9kYnVmcyk7IGkrKykgeworCQlpZiAoaWNsX2FsbG93
ZWRfZGJ1ZnNbaV0uYWN0aXZlX3BpcGVzID09IGFjdGl2ZV9waXBlcykgeworCQkJaWYgKGh3ZWln
aHQzMihhY3RpdmVfcGlwZXMpID09IDEpIHsKKwkJCQkvKgorCQkJCSAqIEFjY29yZGluZyB0byBC
U3BlYyAxMjcxNjogaWYgcmF0aW8gPj0gODguOAorCQkJCSAqIGFsd2F5cyB1c2Ugc2luZ2xlIGRi
dWYgc2xpY2UuCisJCQkJICovCisJCQkJaWYgKHBpcGVfcmF0aW8udmFsID49IGRpdl9maXhlZDE2
KDg4OCwgMTApLnZhbCkKKwkJCQkJKytpOworCQkJfQorCQkJcmV0dXJuIGljbF9hbGxvd2VkX2Ri
dWZzW2ldLmRidWZfbWFza1twaXBlXTsKKwkJfQorCX0KKwlyZXR1cm4gMDsKK30KKworLyoKKyAq
IFRoaXMgZnVuY3Rpb24gZmluZHMgYW4gZW50cnkgd2l0aCBzYW1lIGVuYWJsZWQgcGlwZSBjb25m
aWd1cmF0aW9uIGFuZAorICogcmV0dXJucyBjb3JyZXNwb25kZW50IERCdWYgc2xpY2UgbWFzayBh
cyBzdGF0ZWQgaW4gQlNwZWMgZm9yIHBhcnRpY3VsYXIKKyAqIHBsYXRmb3JtLgorICovCitzdGF0
aWMgdTMyIHRnbF9nZXRfYWxsb3dlZF9kYnVmX21hc2soaW50IHBpcGUsCisJCQkJICAgICB1MzIg
YWN0aXZlX3BpcGVzLAorCQkJCSAgICAgY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNy
dGNfc3RhdGUpCit7CisJaW50IGk7CisKKwlmb3IgKGkgPSAwOyBpIDwgQVJSQVlfU0laRSh0Z2xf
YWxsb3dlZF9kYnVmcyk7IGkrKykgeworCQlpZiAodGdsX2FsbG93ZWRfZGJ1ZnNbaV0uYWN0aXZl
X3BpcGVzID09IGFjdGl2ZV9waXBlcykKKwkJCXJldHVybiB0Z2xfYWxsb3dlZF9kYnVmc1tpXS5k
YnVmX21hc2tbcGlwZV07CisJfQorCXJldHVybiAwOworfQorCit1MzIgaTkxNV9nZXRfYWxsb3dl
ZF9kYnVmX21hc2soc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAorCQkJCSAgICAg
IGludCBwaXBlLCB1MzIgYWN0aXZlX3BpcGVzLAorCQkJCSAgICAgIGNvbnN0IHN0cnVjdCBpbnRl
bF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlKQoreworCWlmIChJU19HRU4oZGV2X3ByaXYsIDExKSkK
KwkJcmV0dXJuIGljbF9nZXRfYWxsb3dlZF9kYnVmX21hc2socGlwZSwKKwkJCQkJCSBhY3RpdmVf
cGlwZXMsCisJCQkJCQkgY3J0Y19zdGF0ZSk7CisJZWxzZSBpZiAoSVNfR0VOKGRldl9wcml2LCAx
MikpCisJCXJldHVybiB0Z2xfZ2V0X2FsbG93ZWRfZGJ1Zl9tYXNrKHBpcGUsCisJCQkJCQkgYWN0
aXZlX3BpcGVzLAorCQkJCQkJIGNydGNfc3RhdGUpOworCS8qCisJICogRm9yIGFueXRoaW5nIGVs
c2UganVzdCByZXR1cm4gb25lIHNsaWNlIHlldC4KKwkgKiBTaG91bGQgYmUgZXh0ZW5kZWQgZm9y
IG90aGVyIHBsYXRmb3Jtcy4KKwkgKi8KKwlyZXR1cm4gREJVRl9TMV9CSVQ7Cit9CisKIHN0YXRp
YyB1NjQKIGljbF9nZXRfdG90YWxfcmVsYXRpdmVfZGF0YV9yYXRlKHN0cnVjdCBpbnRlbF9jcnRj
X3N0YXRlICpjcnRjX3N0YXRlLAogCQkJCSB1NjQgKnBsYW5lX2RhdGFfcmF0ZSkKLS0gCjIuMTcu
MQoKX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX18KSW50ZWwt
Z2Z4IG1haWxpbmcgbGlzdApJbnRlbC1nZnhAbGlzdHMuZnJlZWRlc2t0b3Aub3JnCmh0dHBzOi8v
bGlzdHMuZnJlZWRlc2t0b3Aub3JnL21haWxtYW4vbGlzdGluZm8vaW50ZWwtZ2Z4

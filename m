Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id B63A39B0E4
	for <lists+intel-gfx@lfdr.de>; Fri, 23 Aug 2019 15:27:30 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 43A8D6EC9A;
	Fri, 23 Aug 2019 13:27:26 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from fireflyinternet.com (mail.fireflyinternet.com [109.228.58.192])
 by gabe.freedesktop.org (Postfix) with ESMTPS id EFA166EC9B
 for <intel-gfx@lists.freedesktop.org>; Fri, 23 Aug 2019 13:27:13 +0000 (UTC)
X-Default-Received-SPF: pass (skip=forwardok (res=PASS))
 x-ip-name=78.156.65.138; 
Received: from haswell.alporthouse.com (unverified [78.156.65.138]) 
 by fireflyinternet.com (Firefly Internet (M1)) with ESMTP id 18240604-1500050 
 for multiple; Fri, 23 Aug 2019 14:27:04 +0100
From: Chris Wilson <chris@chris-wilson.co.uk>
To: intel-gfx@lists.freedesktop.org
Date: Fri, 23 Aug 2019 14:26:55 +0100
Message-Id: <20190823132700.25286-11-chris@chris-wilson.co.uk>
X-Mailer: git-send-email 2.23.0
In-Reply-To: <20190823132700.25286-1-chris@chris-wilson.co.uk>
References: <20190823132700.25286-1-chris@chris-wilson.co.uk>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH 10/15] drm/i915: Pull i915_vma_pin under the
 vm->mutex
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

UmVwbGFjZSB0aGUgc3RydWN0X211dGV4IHJlcXVpcmVtZW50IGZvciBwaW5uaW5nIHRoZSBpOTE1
X3ZtYSB3aXRoIHRoZQpsb2NhbCB2bS0+bXV0ZXggaW5zdGVhZC4gTm90ZSB0aGF0IHRoZSB2bS0+
bXV0ZXggaXMgdGFpbnRlZCBieSB0aGUKc2hyaW5rZXIgKHdlIHJlcXVpcmUgdW5iaW5kaW5nIGZy
b20gaW5zaWRlIGZzLXJlY2xhaW0pIGFuZCBzbyB3ZSBjYW5ub3QKYWxsb2NhdGUgd2hpbGUgaG9s
ZGluZyB0aGF0IG11dGV4LiBJbnN0ZWFkIHdlIGhhdmUgdG8gcHJlYWxsb2NhdGUKd29ya2VycyB0
byBkbyBhbGxvY2F0ZSBhbmQgYXBwbHkgdGhlIFBURSB1cGRhdGVzIGFmdGVyIHdlIGhhdmUgd2UK
cmVzZXJ2ZWQgdGhlaXIgc2xvdCBpbiB0aGUgZHJtX21tICh1c2luZyBmZW5jZXMgdG8gb3JkZXIg
dGhlIFBURSB3cml0ZXMKd2l0aCB0aGUgR1BVIHdvcmsgYW5kIHdpdGggbGF0ZXIgdW5iaW5kKS4K
ClNpZ25lZC1vZmYtYnk6IENocmlzIFdpbHNvbiA8Y2hyaXNAY2hyaXMtd2lsc29uLmNvLnVrPgot
LS0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZGlzcGxheS5jICB8ICAzMCAr
LQogZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9mYmRldi5jICAgIHwgICA4ICst
CiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX292ZXJsYXkuYyAgfCAgMTEgKy0K
IGRyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9jb250ZXh0LmMgICB8ICAyMCArLQog
ZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX2RvbWFpbi5jICAgIHwgIDE5ICstCiAu
Li4vZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9leGVjYnVmZmVyLmMgICAgfCAgIDkgKy0KIGRy
aXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9tbWFuLmMgICAgICB8ICAyMSArLQogZHJp
dmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX29iamVjdC5jICAgIHwgIDMzICstCiBkcml2
ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fb2JqZWN0LmggICAgfCAgIDUgKwogZHJpdmVy
cy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX3Nocmlua2VyLmMgIHwgIDY3IC0tLS0KIGRyaXZl
cnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9zdG9sZW4uYyAgICB8ICAgNSArLQogZHJpdmVy
cy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX3RpbGluZy5jICAgIHwgIDEzICstCiBkcml2ZXJz
L2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fdXNlcnB0ci5jICAgfCAgMjcgKy0KIC4uLi9ncHUv
ZHJtL2k5MTUvZ2VtL3NlbGZ0ZXN0cy9odWdlX3BhZ2VzLmMgICB8ICAyMyArLQogLi4uL2RybS9p
OTE1L2dlbS9zZWxmdGVzdHMvaTkxNV9nZW1fbW1hbi5jICAgIHwgICAyIC0KIGRyaXZlcnMvZ3B1
L2RybS9pOTE1L2d0L2ludGVsX2d0LmMgICAgICAgICAgICB8ICAgNSArLQogZHJpdmVycy9ncHUv
ZHJtL2k5MTUvZ3Qvc2VsZnRlc3RfaGFuZ2NoZWNrLmMgIHwgIDE5ICstCiBkcml2ZXJzL2dwdS9k
cm0vaTkxNS9ndnQvYXBlcnR1cmVfZ20uYyAgICAgICAgfCAgMTIgKy0KIGRyaXZlcnMvZ3B1L2Ry
bS9pOTE1L2k5MTVfYWN0aXZlLmMgICAgICAgICAgICB8ICA2NiArKysrCiBkcml2ZXJzL2dwdS9k
cm0vaTkxNS9pOTE1X2FjdGl2ZS5oICAgICAgICAgICAgfCAgIDIgKwogZHJpdmVycy9ncHUvZHJt
L2k5MTUvaTkxNV9hY3RpdmVfdHlwZXMuaCAgICAgIHwgICA1ICsKIGRyaXZlcnMvZ3B1L2RybS9p
OTE1L2k5MTVfZ2VtLmMgICAgICAgICAgICAgICB8ICA3NyArKy0tCiBkcml2ZXJzL2dwdS9kcm0v
aTkxNS9pOTE1X2dlbV9ldmljdC5jICAgICAgICAgfCAgMjAgKy0KIGRyaXZlcnMvZ3B1L2RybS9p
OTE1L2k5MTVfZ2VtX2ZlbmNlX3JlZy5jICAgICB8ICAgNCArLQogZHJpdmVycy9ncHUvZHJtL2k5
MTUvaTkxNV9nZW1fZ3R0LmMgICAgICAgICAgIHwgMTAwICsrKy0tCiBkcml2ZXJzL2dwdS9kcm0v
aTkxNS9pOTE1X2dlbV9ndHQuaCAgICAgICAgICAgfCAgMzEgKy0KIGRyaXZlcnMvZ3B1L2RybS9p
OTE1L2k5MTVfcGVyZi5jICAgICAgICAgICAgICB8ICAyNiArLQogZHJpdmVycy9ncHUvZHJtL2k5
MTUvaTkxNV92bWEuYyAgICAgICAgICAgICAgIHwgMzQxICsrKysrKysrKysrLS0tLS0tLQogZHJp
dmVycy9ncHUvZHJtL2k5MTUvaTkxNV92bWEuaCAgICAgICAgICAgICAgIHwgIDU5ICsrLQogLi4u
L2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMvaTkxNV9nZW1fZXZpY3QuYyAgIHwgIDM2ICstCiBkcml2
ZXJzL2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMvaTkxNV9nZW1fZ3R0LmMgfCAgODggKysrLS0KIGRy
aXZlcnMvZ3B1L2RybS9pOTE1L3NlbGZ0ZXN0cy9pOTE1X3ZtYS5jICAgICB8ICAgMiArCiAzMiBm
aWxlcyBjaGFuZ2VkLCA2MTcgaW5zZXJ0aW9ucygrKSwgNTY5IGRlbGV0aW9ucygtKQoKZGlmZiAt
LWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZGlzcGxheS5jIGIvZHJp
dmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kaXNwbGF5LmMKaW5kZXggYjUxZDFjZWI4
NzM5Li5lMmQxNjZmMWRhNmEgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3Bs
YXkvaW50ZWxfZGlzcGxheS5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50
ZWxfZGlzcGxheS5jCkBAIC0yMDc5LDggKzIwNzksNiBAQCBpbnRlbF9waW5fYW5kX2ZlbmNlX2Zi
X29iaihzdHJ1Y3QgZHJtX2ZyYW1lYnVmZmVyICpmYiwKIAl1bnNpZ25lZCBpbnQgcGluY3RsOwog
CXUzMiBhbGlnbm1lbnQ7CiAKLQlXQVJOX09OKCFtdXRleF9pc19sb2NrZWQoJmRldi0+c3RydWN0
X211dGV4KSk7Ci0KIAlhbGlnbm1lbnQgPSBpbnRlbF9zdXJmX2FsaWdubWVudChmYiwgMCk7CiAK
IAkvKiBOb3RlIHRoYXQgdGhlIHcvYSBhbHNvIHJlcXVpcmVzIDY0IFBURSBvZiBwYWRkaW5nIGZv
bGxvd2luZyB0aGUKQEAgLTIxNjEsOCArMjE1OSw2IEBAIGludGVsX3Bpbl9hbmRfZmVuY2VfZmJf
b2JqKHN0cnVjdCBkcm1fZnJhbWVidWZmZXIgKmZiLAogCiB2b2lkIGludGVsX3VucGluX2ZiX3Zt
YShzdHJ1Y3QgaTkxNV92bWEgKnZtYSwgdW5zaWduZWQgbG9uZyBmbGFncykKIHsKLQlsb2NrZGVw
X2Fzc2VydF9oZWxkKCZ2bWEtPnZtLT5pOTE1LT5kcm0uc3RydWN0X211dGV4KTsKLQogCWk5MTVf
Z2VtX29iamVjdF9sb2NrKHZtYS0+b2JqKTsKIAlpZiAoZmxhZ3MgJiBQTEFORV9IQVNfRkVOQ0Up
CiAJCWk5MTVfdm1hX3VucGluX2ZlbmNlKHZtYSk7CkBAIC0zMDYzLDEyICszMDU5LDEwIEBAIGlu
dGVsX2FsbG9jX2luaXRpYWxfcGxhbmVfb2JqKHN0cnVjdCBpbnRlbF9jcnRjICpjcnRjLAogCQly
ZXR1cm4gZmFsc2U7CiAJfQogCi0JbXV0ZXhfbG9jaygmZGV2LT5zdHJ1Y3RfbXV0ZXgpOwogCW9i
aiA9IGk5MTVfZ2VtX29iamVjdF9jcmVhdGVfc3RvbGVuX2Zvcl9wcmVhbGxvY2F0ZWQoZGV2X3By
aXYsCiAJCQkJCQkJICAgICBiYXNlX2FsaWduZWQsCiAJCQkJCQkJICAgICBiYXNlX2FsaWduZWQs
CiAJCQkJCQkJICAgICBzaXplX2FsaWduZWQpOwotCW11dGV4X3VubG9jaygmZGV2LT5zdHJ1Y3Rf
bXV0ZXgpOwogCWlmICghb2JqKQogCQlyZXR1cm4gZmFsc2U7CiAKQEAgLTMyMzAsMTMgKzMyMjQs
MTEgQEAgaW50ZWxfZmluZF9pbml0aWFsX3BsYW5lX29iaihzdHJ1Y3QgaW50ZWxfY3J0YyAqaW50
ZWxfY3J0YywKIAlpbnRlbF9zdGF0ZS0+Y29sb3JfcGxhbmVbMF0uc3RyaWRlID0KIAkJaW50ZWxf
ZmJfcGl0Y2goZmIsIDAsIGludGVsX3N0YXRlLT5iYXNlLnJvdGF0aW9uKTsKIAotCW11dGV4X2xv
Y2soJmRldi0+c3RydWN0X211dGV4KTsKIAlpbnRlbF9zdGF0ZS0+dm1hID0KIAkJaW50ZWxfcGlu
X2FuZF9mZW5jZV9mYl9vYmooZmIsCiAJCQkJCSAgICZpbnRlbF9zdGF0ZS0+dmlldywKIAkJCQkJ
ICAgaW50ZWxfcGxhbmVfdXNlc19mZW5jZShpbnRlbF9zdGF0ZSksCiAJCQkJCSAgICZpbnRlbF9z
dGF0ZS0+ZmxhZ3MpOwotCW11dGV4X3VubG9jaygmZGV2LT5zdHJ1Y3RfbXV0ZXgpOwogCWlmIChJ
U19FUlIoaW50ZWxfc3RhdGUtPnZtYSkpIHsKIAkJRFJNX0VSUk9SKCJmYWlsZWQgdG8gcGluIGJv
b3QgZmIgb24gcGlwZSAlZDogJWxpXG4iLAogCQkJICBpbnRlbF9jcnRjLT5waXBlLCBQVFJfRVJS
KGludGVsX3N0YXRlLT52bWEpKTsKQEAgLTE0MzMwLDggKzE0MzIyLDYgQEAgc3RhdGljIHZvaWQg
ZmJfb2JqX2J1bXBfcmVuZGVyX3ByaW9yaXR5KHN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpv
YmopCiAgKiBiaXRzLiAgU29tZSBvbGRlciBwbGF0Zm9ybXMgbmVlZCBzcGVjaWFsIHBoeXNpY2Fs
IGFkZHJlc3MgaGFuZGxpbmcgZm9yCiAgKiBjdXJzb3IgcGxhbmVzLgogICoKLSAqIE11c3QgYmUg
Y2FsbGVkIHdpdGggc3RydWN0X211dGV4IGhlbGQuCi0gKgogICogUmV0dXJucyAwIG9uIHN1Y2Nl
c3MsIG5lZ2F0aXZlIGVycm9yIGNvZGUgb24gZmFpbHVyZS4KICAqLwogaW50CkBAIC0xNDM4OCwx
NSArMTQzNzgsOCBAQCBpbnRlbF9wcmVwYXJlX3BsYW5lX2ZiKHN0cnVjdCBkcm1fcGxhbmUgKnBs
YW5lLAogCWlmIChyZXQpCiAJCXJldHVybiByZXQ7CiAKLQlyZXQgPSBtdXRleF9sb2NrX2ludGVy
cnVwdGlibGUoJmRldl9wcml2LT5kcm0uc3RydWN0X211dGV4KTsKLQlpZiAocmV0KSB7Ci0JCWk5
MTVfZ2VtX29iamVjdF91bnBpbl9wYWdlcyhvYmopOwotCQlyZXR1cm4gcmV0OwotCX0KLQogCXJl
dCA9IGludGVsX3BsYW5lX3Bpbl9mYih0b19pbnRlbF9wbGFuZV9zdGF0ZShuZXdfc3RhdGUpKTsK
IAotCW11dGV4X3VubG9jaygmZGV2X3ByaXYtPmRybS5zdHJ1Y3RfbXV0ZXgpOwogCWk5MTVfZ2Vt
X29iamVjdF91bnBpbl9wYWdlcyhvYmopOwogCWlmIChyZXQpCiAJCXJldHVybiByZXQ7CkBAIC0x
NDQ0NSw4ICsxNDQyOCw2IEBAIGludGVsX3ByZXBhcmVfcGxhbmVfZmIoc3RydWN0IGRybV9wbGFu
ZSAqcGxhbmUsCiAgKiBAb2xkX3N0YXRlOiB0aGUgc3RhdGUgZnJvbSB0aGUgcHJldmlvdXMgbW9k
ZXNldAogICoKICAqIENsZWFucyB1cCBhIGZyYW1lYnVmZmVyIHRoYXQgaGFzIGp1c3QgYmVlbiBy
ZW1vdmVkIGZyb20gYSBwbGFuZS4KLSAqCi0gKiBNdXN0IGJlIGNhbGxlZCB3aXRoIHN0cnVjdF9t
dXRleCBoZWxkLgogICovCiB2b2lkCiBpbnRlbF9jbGVhbnVwX3BsYW5lX2ZiKHN0cnVjdCBkcm1f
cGxhbmUgKnBsYW5lLApAQCAtMTQ0NjIsOSArMTQ0NDMsNyBAQCBpbnRlbF9jbGVhbnVwX3BsYW5l
X2ZiKHN0cnVjdCBkcm1fcGxhbmUgKnBsYW5lLAogCX0KIAogCS8qIFNob3VsZCBvbmx5IGJlIGNh
bGxlZCBhZnRlciBhIHN1Y2Nlc3NmdWwgaW50ZWxfcHJlcGFyZV9wbGFuZV9mYigpISAqLwotCW11
dGV4X2xvY2soJmRldl9wcml2LT5kcm0uc3RydWN0X211dGV4KTsKIAlpbnRlbF9wbGFuZV91bnBp
bl9mYih0b19pbnRlbF9wbGFuZV9zdGF0ZShvbGRfc3RhdGUpKTsKLQltdXRleF91bmxvY2soJmRl
dl9wcml2LT5kcm0uc3RydWN0X211dGV4KTsKIH0KIAogaW50CkBAIC0xNDY2NCw3ICsxNDY0Myw2
IEBAIGludGVsX2xlZ2FjeV9jdXJzb3JfdXBkYXRlKHN0cnVjdCBkcm1fcGxhbmUgKnBsYW5lLAog
CQkJICAgdTMyIHNyY193LCB1MzIgc3JjX2gsCiAJCQkgICBzdHJ1Y3QgZHJtX21vZGVzZXRfYWNx
dWlyZV9jdHggKmN0eCkKIHsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0
b19pOTE1KGNydGMtPmRldik7CiAJc3RydWN0IGRybV9wbGFuZV9zdGF0ZSAqb2xkX3BsYW5lX3N0
YXRlLCAqbmV3X3BsYW5lX3N0YXRlOwogCXN0cnVjdCBpbnRlbF9wbGFuZSAqaW50ZWxfcGxhbmUg
PSB0b19pbnRlbF9wbGFuZShwbGFuZSk7CiAJc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNf
c3RhdGUgPQpAQCAtMTQ3MzAsMTMgKzE0NzA4LDkgQEAgaW50ZWxfbGVnYWN5X2N1cnNvcl91cGRh
dGUoc3RydWN0IGRybV9wbGFuZSAqcGxhbmUsCiAJaWYgKHJldCkKIAkJZ290byBvdXRfZnJlZTsK
IAotCXJldCA9IG11dGV4X2xvY2tfaW50ZXJydXB0aWJsZSgmZGV2X3ByaXYtPmRybS5zdHJ1Y3Rf
bXV0ZXgpOwotCWlmIChyZXQpCi0JCWdvdG8gb3V0X2ZyZWU7Ci0KIAlyZXQgPSBpbnRlbF9wbGFu
ZV9waW5fZmIodG9faW50ZWxfcGxhbmVfc3RhdGUobmV3X3BsYW5lX3N0YXRlKSk7CiAJaWYgKHJl
dCkKLQkJZ290byBvdXRfdW5sb2NrOworCQlnb3RvIG91dF9mcmVlOwogCiAJaW50ZWxfZnJvbnRi
dWZmZXJfZmx1c2godG9faW50ZWxfZnJvbnRidWZmZXIoZmIpLCBPUklHSU5fRkxJUCk7CiAJaW50
ZWxfZnJvbnRidWZmZXJfdHJhY2sodG9faW50ZWxfZnJvbnRidWZmZXIob2xkX3BsYW5lX3N0YXRl
LT5mYiksCkBAIC0xNDc2Niw4ICsxNDc0MCw2IEBAIGludGVsX2xlZ2FjeV9jdXJzb3JfdXBkYXRl
KHN0cnVjdCBkcm1fcGxhbmUgKnBsYW5lLAogCiAJaW50ZWxfcGxhbmVfdW5waW5fZmIodG9faW50
ZWxfcGxhbmVfc3RhdGUob2xkX3BsYW5lX3N0YXRlKSk7CiAKLW91dF91bmxvY2s6Ci0JbXV0ZXhf
dW5sb2NrKCZkZXZfcHJpdi0+ZHJtLnN0cnVjdF9tdXRleCk7CiBvdXRfZnJlZToKIAlpZiAobmV3
X2NydGNfc3RhdGUpCiAJCWludGVsX2NydGNfZGVzdHJveV9zdGF0ZShjcnRjLCAmbmV3X2NydGNf
c3RhdGUtPmJhc2UpOwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9p
bnRlbF9mYmRldi5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9mYmRldi5j
CmluZGV4IGQ1OWVlZTVjNWQ5Yy4uYTNkZWEzZjJkYWNkIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dw
dS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2ZiZGV2LmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5
MTUvZGlzcGxheS9pbnRlbF9mYmRldi5jCkBAIC0yMDQsNyArMjA0LDYgQEAgc3RhdGljIGludCBp
bnRlbGZiX2NyZWF0ZShzdHJ1Y3QgZHJtX2ZiX2hlbHBlciAqaGVscGVyLAogCQlzaXplcy0+ZmJf
aGVpZ2h0ID0gaW50ZWxfZmItPmJhc2UuaGVpZ2h0OwogCX0KIAotCW11dGV4X2xvY2soJmRldi0+
c3RydWN0X211dGV4KTsKIAl3YWtlcmVmID0gaW50ZWxfcnVudGltZV9wbV9nZXQoJmRldl9wcml2
LT5ydW50aW1lX3BtKTsKIAogCS8qIFBpbiB0aGUgR0dUVCB2bWEgZm9yIG91ciBhY2Nlc3Mgdmlh
IGluZm8tPnNjcmVlbl9iYXNlLgpAQCAtMjY2LDcgKzI2NSw2IEBAIHN0YXRpYyBpbnQgaW50ZWxm
Yl9jcmVhdGUoc3RydWN0IGRybV9mYl9oZWxwZXIgKmhlbHBlciwKIAlpZmJkZXYtPnZtYV9mbGFn
cyA9IGZsYWdzOwogCiAJaW50ZWxfcnVudGltZV9wbV9wdXQoJmRldl9wcml2LT5ydW50aW1lX3Bt
LCB3YWtlcmVmKTsKLQltdXRleF91bmxvY2soJmRldi0+c3RydWN0X211dGV4KTsKIAl2Z2Ffc3dp
dGNoZXJvb19jbGllbnRfZmJfc2V0KHBkZXYsIGluZm8pOwogCXJldHVybiAwOwogCkBAIC0yNzQs
NyArMjcyLDYgQEAgc3RhdGljIGludCBpbnRlbGZiX2NyZWF0ZShzdHJ1Y3QgZHJtX2ZiX2hlbHBl
ciAqaGVscGVyLAogCWludGVsX3VucGluX2ZiX3ZtYSh2bWEsIGZsYWdzKTsKIG91dF91bmxvY2s6
CiAJaW50ZWxfcnVudGltZV9wbV9wdXQoJmRldl9wcml2LT5ydW50aW1lX3BtLCB3YWtlcmVmKTsK
LQltdXRleF91bmxvY2soJmRldi0+c3RydWN0X211dGV4KTsKIAlyZXR1cm4gcmV0OwogfQogCkBA
IC0yOTEsMTEgKzI4OCw4IEBAIHN0YXRpYyB2b2lkIGludGVsX2ZiZGV2X2Rlc3Ryb3koc3RydWN0
IGludGVsX2ZiZGV2ICppZmJkZXYpCiAKIAlkcm1fZmJfaGVscGVyX2ZpbmkoJmlmYmRldi0+aGVs
cGVyKTsKIAotCWlmIChpZmJkZXYtPnZtYSkgewotCQltdXRleF9sb2NrKCZpZmJkZXYtPmhlbHBl
ci5kZXYtPnN0cnVjdF9tdXRleCk7CisJaWYgKGlmYmRldi0+dm1hKQogCQlpbnRlbF91bnBpbl9m
Yl92bWEoaWZiZGV2LT52bWEsIGlmYmRldi0+dm1hX2ZsYWdzKTsKLQkJbXV0ZXhfdW5sb2NrKCZp
ZmJkZXYtPmhlbHBlci5kZXYtPnN0cnVjdF9tdXRleCk7Ci0JfQogCiAJaWYgKGlmYmRldi0+ZmIp
CiAJCWRybV9mcmFtZWJ1ZmZlcl9yZW1vdmUoJmlmYmRldi0+ZmItPmJhc2UpOwpkaWZmIC0tZ2l0
IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9vdmVybGF5LmMgYi9kcml2ZXJz
L2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX292ZXJsYXkuYwppbmRleCAyOWVkZmMzNDM3MTYu
LjRmMzY1NTdiM2YzYiAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9p
bnRlbF9vdmVybGF5LmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9v
dmVybGF5LmMKQEAgLTEzMDMsMTUgKzEzMDMsMTEgQEAgc3RhdGljIGludCBnZXRfcmVnaXN0ZXJz
KHN0cnVjdCBpbnRlbF9vdmVybGF5ICpvdmVybGF5LCBib29sIHVzZV9waHlzKQogCXN0cnVjdCBp
OTE1X3ZtYSAqdm1hOwogCWludCBlcnI7CiAKLQltdXRleF9sb2NrKCZpOTE1LT5kcm0uc3RydWN0
X211dGV4KTsKLQogCW9iaiA9IGk5MTVfZ2VtX29iamVjdF9jcmVhdGVfc3RvbGVuKGk5MTUsIFBB
R0VfU0laRSk7CiAJaWYgKG9iaiA9PSBOVUxMKQogCQlvYmogPSBpOTE1X2dlbV9vYmplY3RfY3Jl
YXRlX2ludGVybmFsKGk5MTUsIFBBR0VfU0laRSk7Ci0JaWYgKElTX0VSUihvYmopKSB7Ci0JCWVy
ciA9IFBUUl9FUlIob2JqKTsKLQkJZ290byBlcnJfdW5sb2NrOwotCX0KKwlpZiAoSVNfRVJSKG9i
aikpCisJCXJldHVybiBQVFJfRVJSKG9iaik7CiAKIAl2bWEgPSBpOTE1X2dlbV9vYmplY3RfZ2d0
dF9waW4ob2JqLCBOVUxMLCAwLCAwLCBQSU5fTUFQUEFCTEUpOwogCWlmIChJU19FUlIodm1hKSkg
ewpAQCAtMTMzMiwxMyArMTMyOCwxMCBAQCBzdGF0aWMgaW50IGdldF9yZWdpc3RlcnMoc3RydWN0
IGludGVsX292ZXJsYXkgKm92ZXJsYXksIGJvb2wgdXNlX3BoeXMpCiAJfQogCiAJb3ZlcmxheS0+
cmVnX2JvID0gb2JqOwotCW11dGV4X3VubG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CiAJ
cmV0dXJuIDA7CiAKIGVycl9wdXRfYm86CiAJaTkxNV9nZW1fb2JqZWN0X3B1dChvYmopOwotZXJy
X3VubG9jazoKLQltdXRleF91bmxvY2soJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwogCXJldHVy
biBlcnI7CiB9CiAKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dl
bV9jb250ZXh0LmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fY29udGV4dC5j
CmluZGV4IDg2M2I1Y2MxZmZhOS4uMjNjNGE4ODgwNDFmIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dw
dS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fY29udGV4dC5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9p
OTE1L2dlbS9pOTE1X2dlbV9jb250ZXh0LmMKQEAgLTMxMyw4ICszMTMsNiBAQCBzdGF0aWMgdm9p
ZCBpOTE1X2dlbV9jb250ZXh0X2ZyZWUoc3RydWN0IGk5MTVfZ2VtX2NvbnRleHQgKmN0eCkKIAlH
RU1fQlVHX09OKCFpOTE1X2dlbV9jb250ZXh0X2lzX2Nsb3NlZChjdHgpKTsKIAogCXJlbGVhc2Vf
aHdfaWQoY3R4KTsKLQlpZiAoY3R4LT52bSkKLQkJaTkxNV92bV9wdXQoY3R4LT52bSk7CiAKIAlm
cmVlX2VuZ2luZXMocmN1X2FjY2Vzc19wb2ludGVyKGN0eC0+ZW5naW5lcykpOwogCW11dGV4X2Rl
c3Ryb3koJmN0eC0+ZW5naW5lc19tdXRleCk7CkBAIC0zNzksOSArMzc3LDEzIEBAIHZvaWQgaTkx
NV9nZW1fY29udGV4dF9yZWxlYXNlKHN0cnVjdCBrcmVmICpyZWYpCiAKIHN0YXRpYyB2b2lkIGNv
bnRleHRfY2xvc2Uoc3RydWN0IGk5MTVfZ2VtX2NvbnRleHQgKmN0eCkKIHsKKwlpOTE1X2dlbV9j
b250ZXh0X3NldF9jbG9zZWQoY3R4KTsKKworCWlmIChjdHgtPnZtKQorCQlpOTE1X3ZtX2Nsb3Nl
KGN0eC0+dm0pOworCiAJbXV0ZXhfbG9jaygmY3R4LT5tdXRleCk7CiAKLQlpOTE1X2dlbV9jb250
ZXh0X3NldF9jbG9zZWQoY3R4KTsKIAljdHgtPmZpbGVfcHJpdiA9IEVSUl9QVFIoLUVCQURGKTsK
IAogCS8qCkBAIC00NzQsNyArNDc2LDcgQEAgX19zZXRfcHBndHQoc3RydWN0IGk5MTVfZ2VtX2Nv
bnRleHQgKmN0eCwgc3RydWN0IGk5MTVfYWRkcmVzc19zcGFjZSAqdm0pCiAKIAlHRU1fQlVHX09O
KG9sZCAmJiBpOTE1X3ZtX2lzXzRsdmwodm0pICE9IGk5MTVfdm1faXNfNGx2bChvbGQpKTsKIAot
CWN0eC0+dm0gPSBpOTE1X3ZtX2dldCh2bSk7CisJY3R4LT52bSA9IGk5MTVfdm1fb3Blbih2bSk7
CiAJY29udGV4dF9hcHBseV9hbGwoY3R4LCBfX2FwcGx5X3BwZ3R0LCB2bSk7CiAKIAlyZXR1cm4g
b2xkOwpAQCAtNDg4LDcgKzQ5MCw3IEBAIHN0YXRpYyB2b2lkIF9fYXNzaWduX3BwZ3R0KHN0cnVj
dCBpOTE1X2dlbV9jb250ZXh0ICpjdHgsCiAKIAl2bSA9IF9fc2V0X3BwZ3R0KGN0eCwgdm0pOwog
CWlmICh2bSkKLQkJaTkxNV92bV9wdXQodm0pOworCQlpOTE1X3ZtX2Nsb3NlKHZtKTsKIH0KIAog
c3RhdGljIHZvaWQgX19zZXRfdGltZWxpbmUoc3RydWN0IGludGVsX3RpbWVsaW5lICoqZHN0LApA
QCAtOTUzLDcgKzk1NSw3IEBAIHN0YXRpYyBpbnQgZ2V0X3BwZ3R0KHN0cnVjdCBkcm1faTkxNV9m
aWxlX3ByaXZhdGUgKmZpbGVfcHJpdiwKIAlpZiAocmV0IDwgMCkKIAkJZ290byBlcnJfdW5sb2Nr
OwogCi0JaTkxNV92bV9nZXQodm0pOworCWk5MTVfdm1fb3Blbih2bSk7CiAKIAlhcmdzLT5zaXpl
ID0gMDsKIAlhcmdzLT52YWx1ZSA9IHJldDsKQEAgLTk3Myw3ICs5NzUsNyBAQCBzdGF0aWMgdm9p
ZCBzZXRfcHBndHRfYmFycmllcih2b2lkICpkYXRhKQogCWlmIChJTlRFTF9HRU4ob2xkLT5pOTE1
KSA8IDgpCiAJCWdlbjZfcHBndHRfdW5waW5fYWxsKGk5MTVfdm1fdG9fcHBndHQob2xkKSk7CiAK
LQlpOTE1X3ZtX3B1dChvbGQpOworCWk5MTVfdm1fY2xvc2Uob2xkKTsKIH0KIAogc3RhdGljIGlu
dCBlbWl0X3BwZ3R0X3VwZGF0ZShzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpycSwgdm9pZCAqZGF0YSkK
QEAgLTEwOTMsOCArMTA5NSw4IEBAIHN0YXRpYyBpbnQgc2V0X3BwZ3R0KHN0cnVjdCBkcm1faTkx
NV9maWxlX3ByaXZhdGUgKmZpbGVfcHJpdiwKIAkJCQkgICBzZXRfcHBndHRfYmFycmllciwKIAkJ
CQkgICBvbGQpOwogCWlmIChlcnIpIHsKLQkJaTkxNV92bV9wdXQoX19zZXRfcHBndHQoY3R4LCBv
bGQpKTsKLQkJaTkxNV92bV9wdXQob2xkKTsKKwkJaTkxNV92bV9jbG9zZShfX3NldF9wcGd0dChj
dHgsIG9sZCkpOworCQlpOTE1X3ZtX2Nsb3NlKG9sZCk7CiAJfQogCiB1bmxvY2s6CmRpZmYgLS1n
aXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fZG9tYWluLmMgYi9kcml2ZXJz
L2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fZG9tYWluLmMKaW5kZXggYjdiZTlhZDJiNjJjLi41
MWMyMmUwNDRlZWUgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dl
bV9kb21haW4uYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fZG9tYWlu
LmMKQEAgLTIwMiw3ICsyMDIsMTEgQEAgaW50IGk5MTVfZ2VtX29iamVjdF9zZXRfY2FjaGVfbGV2
ZWwoc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iaiwKIAkJICAgIGk5MTVfZ2VtX3ZhbGlk
X2d0dF9zcGFjZSh2bWEsIGNhY2hlX2xldmVsKSkKIAkJCWNvbnRpbnVlOwogCi0JCXJldCA9IGk5
MTVfdm1hX3VuYmluZCh2bWEpOworCQlyZXQgPSBtdXRleF9sb2NrX2ludGVycnVwdGlibGUoJnZt
YS0+dm0tPm11dGV4KTsKKwkJaWYgKCFyZXQpIHsKKwkJCXJldCA9IGk5MTVfdm1hX3VuYmluZCh2
bWEpOworCQkJbXV0ZXhfdW5sb2NrKCZ2bWEtPnZtLT5tdXRleCk7CisJCX0KIAkJaWYgKHJldCkK
IAkJCXJldHVybiByZXQ7CiAKQEAgLTI4OCw3ICsyOTIsMTIgQEAgaW50IGk5MTVfZ2VtX29iamVj
dF9zZXRfY2FjaGVfbGV2ZWwoc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iaiwKIAkJCWlm
ICghZHJtX21tX25vZGVfYWxsb2NhdGVkKCZ2bWEtPm5vZGUpKQogCQkJCWNvbnRpbnVlOwogCi0J
CQlyZXQgPSBpOTE1X3ZtYV9iaW5kKHZtYSwgY2FjaGVfbGV2ZWwsIFBJTl9VUERBVEUpOworCQkJ
LyogV2FpdCBmb3IgYW4gZWFybGllciBhc3luYyBiaW5kICovCisJCQlyZXQgPSBpOTE1X2FjdGl2
ZV93YWl0KCZ2bWEtPmFjdGl2ZSk7CisJCQlpZiAocmV0KQorCQkJCXJldHVybiByZXQ7CisKKwkJ
CXJldCA9IGk5MTVfdm1hX2JpbmQodm1hLCBjYWNoZV9sZXZlbCwgUElOX1VQREFURSwgTlVMTCk7
CiAJCQlpZiAocmV0KQogCQkJCXJldHVybiByZXQ7CiAJCX0KQEAgLTM4OSwxNiArMzk4LDExIEBA
IGludCBpOTE1X2dlbV9zZXRfY2FjaGluZ19pb2N0bChzdHJ1Y3QgZHJtX2RldmljZSAqZGV2LCB2
b2lkICpkYXRhLAogCWlmIChyZXQpCiAJCWdvdG8gb3V0OwogCi0JcmV0ID0gbXV0ZXhfbG9ja19p
bnRlcnJ1cHRpYmxlKCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsKLQlpZiAocmV0KQotCQlnb3Rv
IG91dDsKLQogCXJldCA9IGk5MTVfZ2VtX29iamVjdF9sb2NrX2ludGVycnVwdGlibGUob2JqKTsK
IAlpZiAocmV0ID09IDApIHsKIAkJcmV0ID0gaTkxNV9nZW1fb2JqZWN0X3NldF9jYWNoZV9sZXZl
bChvYmosIGxldmVsKTsKIAkJaTkxNV9nZW1fb2JqZWN0X3VubG9jayhvYmopOwogCX0KLQltdXRl
eF91bmxvY2soJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwogCiBvdXQ6CiAJaTkxNV9nZW1fb2Jq
ZWN0X3B1dChvYmopOwpAQCAtNDkxLDYgKzQ5NSw3IEBAIHN0YXRpYyB2b2lkIGk5MTVfZ2VtX29i
amVjdF9idW1wX2luYWN0aXZlX2dndHQoc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iaikK
IAkJaWYgKCFkcm1fbW1fbm9kZV9hbGxvY2F0ZWQoJnZtYS0+bm9kZSkpCiAJCQljb250aW51ZTsK
IAorCQlHRU1fQlVHX09OKHZtYS0+dm0gIT0gJmk5MTUtPmdndHQudm0pOwogCQlsaXN0X21vdmVf
dGFpbCgmdm1hLT52bV9saW5rLCAmdm1hLT52bS0+Ym91bmRfbGlzdCk7CiAJfQogCW11dGV4X3Vu
bG9jaygmaTkxNS0+Z2d0dC52bS5tdXRleCk7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0v
aTkxNS9nZW0vaTkxNV9nZW1fZXhlY2J1ZmZlci5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2Vt
L2k5MTVfZ2VtX2V4ZWNidWZmZXIuYwppbmRleCBiNWY2OTM3MzY5ZWEuLjA1YTNlMjQyNDhhNSAx
MDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX2V4ZWNidWZmZXIu
YworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fZXhlY2J1ZmZlci5jCkBA
IC01NDksOCArNTQ5LDExIEBAIGViX2FkZF92bWEoc3RydWN0IGk5MTVfZXhlY2J1ZmZlciAqZWIs
CiAJCWViX3VucmVzZXJ2ZV92bWEodm1hLCB2bWEtPmV4ZWNfZmxhZ3MpOwogCiAJCWxpc3RfYWRk
X3RhaWwoJnZtYS0+ZXhlY19saW5rLCAmZWItPnVuYm91bmQpOwotCQlpZiAoZHJtX21tX25vZGVf
YWxsb2NhdGVkKCZ2bWEtPm5vZGUpKQorCQlpZiAoZHJtX21tX25vZGVfYWxsb2NhdGVkKCZ2bWEt
Pm5vZGUpKSB7CisJCQltdXRleF9sb2NrKCZ2bWEtPnZtLT5tdXRleCk7CiAJCQllcnIgPSBpOTE1
X3ZtYV91bmJpbmQodm1hKTsKKwkJCW11dGV4X3VubG9jaygmdm1hLT52bS0+bXV0ZXgpOworCQl9
CiAJCWlmICh1bmxpa2VseShlcnIpKQogCQkJdm1hLT5leGVjX2ZsYWdzID0gTlVMTDsKIAl9CkBA
IC02OTcsNyArNzAwLDkgQEAgc3RhdGljIGludCBlYl9yZXNlcnZlKHN0cnVjdCBpOTE1X2V4ZWNi
dWZmZXIgKmViKQogCiAJCWNhc2UgMToKIAkJCS8qIFRvbyBmcmFnbWVudGVkLCB1bmJpbmQgZXZl
cnl0aGluZyBhbmQgcmV0cnkgKi8KKwkJCW11dGV4X2xvY2soJmViLT5jb250ZXh0LT52bS0+bXV0
ZXgpOwogCQkJZXJyID0gaTkxNV9nZW1fZXZpY3Rfdm0oZWItPmNvbnRleHQtPnZtKTsKKwkJCW11
dGV4X3VubG9jaygmZWItPmNvbnRleHQtPnZtLT5tdXRleCk7CiAJCQlpZiAoZXJyKQogCQkJCXJl
dHVybiBlcnI7CiAJCQlicmVhazsKQEAgLTEzODgsNyArMTM5Myw3IEBAIGViX3JlbG9jYXRlX2Vu
dHJ5KHN0cnVjdCBpOTE1X2V4ZWNidWZmZXIgKmViLAogCQlpZiAocmVsb2MtPndyaXRlX2RvbWFp
biA9PSBJOTE1X0dFTV9ET01BSU5fSU5TVFJVQ1RJT04gJiYKIAkJICAgIElTX0dFTihlYi0+aTkx
NSwgNikpIHsKIAkJCWVyciA9IGk5MTVfdm1hX2JpbmQodGFyZ2V0LCB0YXJnZXQtPm9iai0+Y2Fj
aGVfbGV2ZWwsCi0JCQkJCSAgICBQSU5fR0xPQkFMKTsKKwkJCQkJICAgIFBJTl9HTE9CQUwsIE5V
TEwpOwogCQkJaWYgKFdBUk5fT05DRShlcnIsCiAJCQkJICAgICAgIlVuZXhwZWN0ZWQgZmFpbHVy
ZSB0byBiaW5kIHRhcmdldCBWTUEhIikpCiAJCQkJcmV0dXJuIGVycjsKZGlmZiAtLWdpdCBhL2Ry
aXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9tbWFuLmMgYi9kcml2ZXJzL2dwdS9kcm0v
aTkxNS9nZW0vaTkxNV9nZW1fbW1hbi5jCmluZGV4IDU5NTUzOWEwOWUzOC4uMDQ0MGRiZmRhMjk1
IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fbW1hbi5jCisr
KyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9tbWFuLmMKQEAgLTI1MSwxNiAr
MjUxLDYgQEAgdm1fZmF1bHRfdCBpOTE1X2dlbV9mYXVsdChzdHJ1Y3Qgdm1fZmF1bHQgKnZtZikK
IAkJZ290byBlcnJfcnBtOwogCX0KIAotCXJldCA9IGk5MTVfbXV0ZXhfbG9ja19pbnRlcnJ1cHRp
YmxlKGRldik7Ci0JaWYgKHJldCkKLQkJZ290byBlcnJfcmVzZXQ7Ci0KLQkvKiBBY2Nlc3MgdG8g
c25vb3BhYmxlIHBhZ2VzIHRocm91Z2ggdGhlIEdUVCBpcyBpbmNvaGVyZW50LiAqLwotCWlmIChv
YmotPmNhY2hlX2xldmVsICE9IEk5MTVfQ0FDSEVfTk9ORSAmJiAhSEFTX0xMQyhpOTE1KSkgewot
CQlyZXQgPSAtRUZBVUxUOwotCQlnb3RvIGVycl91bmxvY2s7Ci0JfQotCiAJLyogTm93IHBpbiBp
dCBpbnRvIHRoZSBHVFQgYXMgbmVlZGVkICovCiAJdm1hID0gaTkxNV9nZW1fb2JqZWN0X2dndHRf
cGluKG9iaiwgTlVMTCwgMCwgMCwKIAkJCQkgICAgICAgUElOX01BUFBBQkxFIHwKQEAgLTI5MCw3
ICsyODAsMTMgQEAgdm1fZmF1bHRfdCBpOTE1X2dlbV9mYXVsdChzdHJ1Y3Qgdm1fZmF1bHQgKnZt
ZikKIAl9CiAJaWYgKElTX0VSUih2bWEpKSB7CiAJCXJldCA9IFBUUl9FUlIodm1hKTsKLQkJZ290
byBlcnJfdW5sb2NrOworCQlnb3RvIGVycl9yZXNldDsKKwl9CisKKwkvKiBBY2Nlc3MgdG8gc25v
b3BhYmxlIHBhZ2VzIHRocm91Z2ggdGhlIEdUVCBpcyBpbmNvaGVyZW50LiAqLworCWlmIChvYmot
PmNhY2hlX2xldmVsICE9IEk5MTVfQ0FDSEVfTk9ORSAmJiAhSEFTX0xMQyhpOTE1KSkgeworCQly
ZXQgPSAtRUZBVUxUOworCQlnb3RvIGVycl91bnBpbjsKIAl9CiAKIAlyZXQgPSBpOTE1X3ZtYV9w
aW5fZmVuY2Uodm1hKTsKQEAgLTMxOSwxMyArMzE1LDEwIEBAIHZtX2ZhdWx0X3QgaTkxNV9nZW1f
ZmF1bHQoc3RydWN0IHZtX2ZhdWx0ICp2bWYpCiAJCQkJICAgbXNlY3NfdG9famlmZmllc190aW1l
b3V0KENPTkZJR19EUk1fSTkxNV9VU0VSRkFVTFRfQVVUT1NVU1BFTkQpKTsKIAogCWk5MTVfdm1h
X3NldF9nZ3R0X3dyaXRlKHZtYSk7Ci0KIGVycl9mZW5jZToKIAlpOTE1X3ZtYV91bnBpbl9mZW5j
ZSh2bWEpOwogZXJyX3VucGluOgogCV9faTkxNV92bWFfdW5waW4odm1hKTsKLWVycl91bmxvY2s6
Ci0JbXV0ZXhfdW5sb2NrKCZkZXYtPnN0cnVjdF9tdXRleCk7CiBlcnJfcmVzZXQ6CiAJaW50ZWxf
Z3RfcmVzZXRfdW5sb2NrKGdndHQtPnZtLmd0LCBzcmN1KTsKIGVycl9ycG06CmRpZmYgLS1naXQg
YS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fb2JqZWN0LmMgYi9kcml2ZXJzL2dw
dS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fb2JqZWN0LmMKaW5kZXggMGVmNjBkYWUyM2E3Li5kYmY5
YmU5YTc5ZjQgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9v
YmplY3QuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fb2JqZWN0LmMK
QEAgLTE1NSwyMSArMTU1LDMwIEBAIHN0YXRpYyB2b2lkIF9faTkxNV9nZW1fZnJlZV9vYmplY3Rz
KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LAogCiAJd2FrZXJlZiA9IGludGVsX3J1bnRp
bWVfcG1fZ2V0KCZpOTE1LT5ydW50aW1lX3BtKTsKIAlsbGlzdF9mb3JfZWFjaF9lbnRyeV9zYWZl
KG9iaiwgb24sIGZyZWVkLCBmcmVlZCkgewotCQlzdHJ1Y3QgaTkxNV92bWEgKnZtYSwgKnZuOwot
CiAJCXRyYWNlX2k5MTVfZ2VtX29iamVjdF9kZXN0cm95KG9iaik7CiAKLQkJbXV0ZXhfbG9jaygm
aTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7Ci0KLQkJbGlzdF9mb3JfZWFjaF9lbnRyeV9zYWZlKHZt
YSwgdm4sICZvYmotPnZtYS5saXN0LCBvYmpfbGluaykgewotCQkJR0VNX0JVR19PTihpOTE1X3Zt
YV9pc19hY3RpdmUodm1hKSk7Ci0JCQlhdG9taWNfYW5kKH5JOTE1X1ZNQV9QSU5fTUFTSywgJnZt
YS0+ZmxhZ3MpOwotCQkJaTkxNV92bWFfZGVzdHJveSh2bWEpOworCQlpZiAoIWxpc3RfZW1wdHko
Jm9iai0+dm1hLmxpc3QpKSB7CisJCQlzdHJ1Y3QgaTkxNV92bWEgKnZtYTsKKworCQkJLyoKKwkJ
CSAqIE5vdGUgdGhhdCB0aGUgdm1hIGtlZXBzIGFuIG9iamVjdCByZWZlcmVuY2Ugd2hpbGUKKwkJ
CSAqIGl0IGlzIGFjdGl2ZSwgc28gaXQgKnNob3VsZCogbm90IHNsZWVwIHdoaWxlIHdlCisJCQkg
KiBkZXN0cm95IGl0LiBPdXIgZGVidWcgY29kZSBlcnJzIGluc2l0cyBpdCAqbWlnaHQqLgorCQkJ
ICogRm9yIHRoZSBtb21lbnQsIHBsYXkgYWxvbmcuCisJCQkgKi8KKwkJCXNwaW5fbG9jaygmb2Jq
LT52bWEubG9jayk7CisJCQl3aGlsZSAoKHZtYSA9IGxpc3RfZmlyc3RfZW50cnlfb3JfbnVsbCgm
b2JqLT52bWEubGlzdCwKKwkJCQkJCQkgICAgICAgc3RydWN0IGk5MTVfdm1hLAorCQkJCQkJCSAg
ICAgICBvYmpfbGluaykpKSB7CisJCQkJR0VNX0JVR19PTih2bWEtPm9iaiAhPSBvYmopOworCQkJ
CXNwaW5fdW5sb2NrKCZvYmotPnZtYS5sb2NrKTsKKworCQkJCWk5MTVfdm1hX2Rlc3Ryb3kodm1h
KTsKKworCQkJCXNwaW5fbG9jaygmb2JqLT52bWEubG9jayk7CisJCQl9CisJCQlzcGluX3VubG9j
aygmb2JqLT52bWEubG9jayk7CiAJCX0KLQkJR0VNX0JVR19PTighbGlzdF9lbXB0eSgmb2JqLT52
bWEubGlzdCkpOwotCQlHRU1fQlVHX09OKCFSQl9FTVBUWV9ST09UKCZvYmotPnZtYS50cmVlKSk7
Ci0KLQkJbXV0ZXhfdW5sb2NrKCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsKIAogCQlHRU1fQlVH
X09OKGF0b21pY19yZWFkKCZvYmotPmJpbmRfY291bnQpKTsKIAkJR0VNX0JVR19PTihvYmotPnVz
ZXJmYXVsdF9jb3VudCk7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkx
NV9nZW1fb2JqZWN0LmggYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fb2JqZWN0
LmgKaW5kZXggMTFiYjFhNDEyZTRmLi44ZGZkM2UxNzBkMzIgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMv
Z3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9vYmplY3QuaAorKysgYi9kcml2ZXJzL2dwdS9kcm0v
aTkxNS9nZW0vaTkxNV9nZW1fb2JqZWN0LmgKQEAgLTEwNiw2ICsxMDYsMTEgQEAgc3RhdGljIGlu
bGluZSB2b2lkIGk5MTVfZ2VtX29iamVjdF9sb2NrKHN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0
ICpvYmopCiAJZG1hX3Jlc3ZfbG9jayhvYmotPmJhc2UucmVzdiwgTlVMTCk7CiB9CiAKK3N0YXRp
YyBpbmxpbmUgYm9vbCBpOTE1X2dlbV9vYmplY3RfdHJ5bG9jayhzdHJ1Y3QgZHJtX2k5MTVfZ2Vt
X29iamVjdCAqb2JqKQoreworCXJldHVybiBkbWFfcmVzdl90cnlsb2NrKG9iai0+YmFzZS5yZXN2
KTsKK30KKwogc3RhdGljIGlubGluZSBpbnQKIGk5MTVfZ2VtX29iamVjdF9sb2NrX2ludGVycnVw
dGlibGUoc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iaikKIHsKZGlmZiAtLWdpdCBhL2Ry
aXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9zaHJpbmtlci5jIGIvZHJpdmVycy9ncHUv
ZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX3Nocmlua2VyLmMKaW5kZXggODQxZjE4Mzg2YjU0Li5jYjlk
NWMyNTg2YmQgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9z
aHJpbmtlci5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9zaHJpbmtl
ci5jCkBAIC0xNiw0MCArMTYsNiBAQAogCiAjaW5jbHVkZSAiaTkxNV90cmFjZS5oIgogCi1zdGF0
aWMgYm9vbCBzaHJpbmtlcl9sb2NrKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LAotCQkJ
ICB1bnNpZ25lZCBpbnQgZmxhZ3MsCi0JCQkgIGJvb2wgKnVubG9jaykKLXsKLQlzdHJ1Y3QgbXV0
ZXggKm0gPSAmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleDsKLQotCXN3aXRjaCAobXV0ZXhfdHJ5bG9j
a19yZWN1cnNpdmUobSkpIHsKLQljYXNlIE1VVEVYX1RSWUxPQ0tfUkVDVVJTSVZFOgotCQkqdW5s
b2NrID0gZmFsc2U7Ci0JCXJldHVybiB0cnVlOwotCi0JY2FzZSBNVVRFWF9UUllMT0NLX0ZBSUxF
RDoKLQkJKnVubG9jayA9IGZhbHNlOwotCQlpZiAoZmxhZ3MgJiBJOTE1X1NIUklOS19BQ1RJVkUg
JiYKLQkJICAgIG11dGV4X2xvY2tfa2lsbGFibGVfbmVzdGVkKG0sIEk5MTVfTU1fU0hSSU5LRVIp
ID09IDApCi0JCQkqdW5sb2NrID0gdHJ1ZTsKLQkJcmV0dXJuICp1bmxvY2s7Ci0KLQljYXNlIE1V
VEVYX1RSWUxPQ0tfU1VDQ0VTUzoKLQkJKnVubG9jayA9IHRydWU7Ci0JCXJldHVybiB0cnVlOwot
CX0KLQotCUJVRygpOwotfQotCi1zdGF0aWMgdm9pZCBzaHJpbmtlcl91bmxvY2soc3RydWN0IGRy
bV9pOTE1X3ByaXZhdGUgKmk5MTUsIGJvb2wgdW5sb2NrKQotewotCWlmICghdW5sb2NrKQotCQly
ZXR1cm47Ci0KLQltdXRleF91bmxvY2soJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwotfQotCiBz
dGF0aWMgYm9vbCBzd2FwX2F2YWlsYWJsZSh2b2lkKQogewogCXJldHVybiBnZXRfbnJfc3dhcF9w
YWdlcygpID4gMDsKQEAgLTE2MiwxMCArMTI4LDYgQEAgaTkxNV9nZW1fc2hyaW5rKHN0cnVjdCBk
cm1faTkxNV9wcml2YXRlICppOTE1LAogCWludGVsX3dha2VyZWZfdCB3YWtlcmVmID0gMDsKIAl1
bnNpZ25lZCBsb25nIGNvdW50ID0gMDsKIAl1bnNpZ25lZCBsb25nIHNjYW5uZWQgPSAwOwotCWJv
b2wgdW5sb2NrOwotCi0JaWYgKCFzaHJpbmtlcl9sb2NrKGk5MTUsIHNocmluaywgJnVubG9jaykp
Ci0JCXJldHVybiAwOwogCiAJLyoKIAkgKiBXaGVuIHNocmlua2luZyB0aGUgYWN0aXZlIGxpc3Qs
IHdlIHNob3VsZCBhbHNvIGNvbnNpZGVyIGFjdGl2ZQpAQCAtMjc1LDggKzIzNyw2IEBAIGk5MTVf
Z2VtX3NocmluayhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwKIAlpZiAoc2hyaW5rICYg
STkxNV9TSFJJTktfQk9VTkQpCiAJCWludGVsX3J1bnRpbWVfcG1fcHV0KCZpOTE1LT5ydW50aW1l
X3BtLCB3YWtlcmVmKTsKIAotCXNocmlua2VyX3VubG9jayhpOTE1LCB1bmxvY2spOwotCiAJaWYg
KG5yX3NjYW5uZWQpCiAJCSpucl9zY2FubmVkICs9IHNjYW5uZWQ7CiAJcmV0dXJuIGNvdW50OwpA
QCAtMzQ2LDEzICszMDYsOSBAQCBpOTE1X2dlbV9zaHJpbmtlcl9zY2FuKHN0cnVjdCBzaHJpbmtl
ciAqc2hyaW5rZXIsIHN0cnVjdCBzaHJpbmtfY29udHJvbCAqc2MpCiAJc3RydWN0IGRybV9pOTE1
X3ByaXZhdGUgKmk5MTUgPQogCQljb250YWluZXJfb2Yoc2hyaW5rZXIsIHN0cnVjdCBkcm1faTkx
NV9wcml2YXRlLCBtbS5zaHJpbmtlcik7CiAJdW5zaWduZWQgbG9uZyBmcmVlZDsKLQlib29sIHVu
bG9jazsKIAogCXNjLT5ucl9zY2FubmVkID0gMDsKIAotCWlmICghc2hyaW5rZXJfbG9jayhpOTE1
LCAwLCAmdW5sb2NrKSkKLQkJcmV0dXJuIFNIUklOS19TVE9QOwotCiAJZnJlZWQgPSBpOTE1X2dl
bV9zaHJpbmsoaTkxNSwKIAkJCQlzYy0+bnJfdG9fc2NhbiwKIAkJCQkmc2MtPm5yX3NjYW5uZWQs
CkBAIC0zNzMsOCArMzI5LDYgQEAgaTkxNV9nZW1fc2hyaW5rZXJfc2NhbihzdHJ1Y3Qgc2hyaW5r
ZXIgKnNocmlua2VyLCBzdHJ1Y3Qgc2hyaW5rX2NvbnRyb2wgKnNjKQogCQl9CiAJfQogCi0Jc2hy
aW5rZXJfdW5sb2NrKGk5MTUsIHVubG9jayk7Ci0KIAlyZXR1cm4gc2MtPm5yX3NjYW5uZWQgPyBm
cmVlZCA6IFNIUklOS19TVE9QOwogfQogCkBAIC00MjYsMTAgKzM4MCw2IEBAIGk5MTVfZ2VtX3No
cmlua2VyX3ZtYXAoc3RydWN0IG5vdGlmaWVyX2Jsb2NrICpuYiwgdW5zaWduZWQgbG9uZyBldmVu
dCwgdm9pZCAqcHRyCiAJc3RydWN0IGk5MTVfdm1hICp2bWEsICpuZXh0OwogCXVuc2lnbmVkIGxv
bmcgZnJlZWRfcGFnZXMgPSAwOwogCWludGVsX3dha2VyZWZfdCB3YWtlcmVmOwotCWJvb2wgdW5s
b2NrOwotCi0JaWYgKCFzaHJpbmtlcl9sb2NrKGk5MTUsIDAsICZ1bmxvY2spKQotCQlyZXR1cm4g
Tk9USUZZX0RPTkU7CiAKIAl3aXRoX2ludGVsX3J1bnRpbWVfcG0oJmk5MTUtPnJ1bnRpbWVfcG0s
IHdha2VyZWYpCiAJCWZyZWVkX3BhZ2VzICs9IGk5MTVfZ2VtX3NocmluayhpOTE1LCAtMVVMLCBO
VUxMLApAQCAtNDQ2LDE1ICszOTYsMTEgQEAgaTkxNV9nZW1fc2hyaW5rZXJfdm1hcChzdHJ1Y3Qg
bm90aWZpZXJfYmxvY2sgKm5iLCB1bnNpZ25lZCBsb25nIGV2ZW50LCB2b2lkICpwdHIKIAkJaWYg
KCF2bWEtPmlvbWFwIHx8IGk5MTVfdm1hX2lzX2FjdGl2ZSh2bWEpKQogCQkJY29udGludWU7CiAK
LQkJbXV0ZXhfdW5sb2NrKCZpOTE1LT5nZ3R0LnZtLm11dGV4KTsKIAkJaWYgKGk5MTVfdm1hX3Vu
YmluZCh2bWEpID09IDApCiAJCQlmcmVlZF9wYWdlcyArPSBjb3VudDsKLQkJbXV0ZXhfbG9jaygm
aTkxNS0+Z2d0dC52bS5tdXRleCk7CiAJfQogCW11dGV4X3VubG9jaygmaTkxNS0+Z2d0dC52bS5t
dXRleCk7CiAKLQlzaHJpbmtlcl91bmxvY2soaTkxNSwgdW5sb2NrKTsKLQogCSoodW5zaWduZWQg
bG9uZyAqKXB0ciArPSBmcmVlZF9wYWdlczsKIAlyZXR1cm4gTk9USUZZX0RPTkU7CiB9CkBAIC00
OTcsMjIgKzQ0Myw5IEBAIHZvaWQgaTkxNV9nZW1fc2hyaW5rZXJfdGFpbnRzX211dGV4KHN0cnVj
dCBkcm1faTkxNV9wcml2YXRlICppOTE1LAogCiAJZnNfcmVjbGFpbV9hY3F1aXJlKEdGUF9LRVJO
RUwpOwogCi0JLyoKLQkgKiBBcyB3ZSBpbnZhcmlhYmx5IHJlbHkgb24gdGhlIHN0cnVjdF9tdXRl
eCB3aXRoaW4gdGhlIHNocmlua2VyLAotCSAqIGJ1dCBoYXZlIGEgY29tcGxpY2F0ZWQgcmVjdXJz
aW9uIGRhbmNlLCB0YWludCBhbGwgdGhlIG11dGV4ZXMgdXNlZAotCSAqIHdpdGhpbiB0aGUgc2hy
aW5rZXIgd2l0aCB0aGUgc3RydWN0X211dGV4LiBGb3IgY29tcGxldGVuZXNzLCB3ZQotCSAqIHRh
aW50IHdpdGggYWxsIHN1YmNsYXNzIG9mIHN0cnVjdF9tdXRleCwgZXZlbiB0aG91Z2ggd2Ugc2hv
dWxkCi0JICogb25seSBuZWVkIHRhaW50aW5nIGJ5IEk5MTVfTU1fTk9STUFMIHRvIGNhdGNoIHBv
c3NpYmxlIEFCQkEKLQkgKiBkZWFkbG9ja3MgZnJvbSB1c2luZyBzdHJ1Y3RfbXV0ZXggaW5zaWRl
IEBtdXRleC4KLQkgKi8KLQltdXRleF9hY3F1aXJlKCZpOTE1LT5kcm0uc3RydWN0X211dGV4LmRl
cF9tYXAsCi0JCSAgICAgIEk5MTVfTU1fU0hSSU5LRVIsIDAsIF9SRVRfSVBfKTsKLQogCW11dGV4
X2FjcXVpcmUoJm11dGV4LT5kZXBfbWFwLCAwLCAwLCBfUkVUX0lQXyk7CiAJbXV0ZXhfcmVsZWFz
ZSgmbXV0ZXgtPmRlcF9tYXAsIDAsIF9SRVRfSVBfKTsKIAotCW11dGV4X3JlbGVhc2UoJmk5MTUt
PmRybS5zdHJ1Y3RfbXV0ZXguZGVwX21hcCwgMCwgX1JFVF9JUF8pOwotCiAJZnNfcmVjbGFpbV9y
ZWxlYXNlKEdGUF9LRVJORUwpOwogCiAJaWYgKHVubG9jaykKZGlmZiAtLWdpdCBhL2RyaXZlcnMv
Z3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9zdG9sZW4uYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1
L2dlbS9pOTE1X2dlbV9zdG9sZW4uYwppbmRleCAwZDgxZGUxNDYxYjQuLjE1OGRkZDZlNzM1ZiAx
MDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX3N0b2xlbi5jCisr
KyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9zdG9sZW4uYwpAQCAtNjIxLDgg
KzYyMSw2IEBAIGk5MTVfZ2VtX29iamVjdF9jcmVhdGVfc3RvbGVuX2Zvcl9wcmVhbGxvY2F0ZWQo
c3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2CiAJaWYgKCFkcm1fbW1faW5pdGlhbGl6
ZWQoJmRldl9wcml2LT5tbS5zdG9sZW4pKQogCQlyZXR1cm4gTlVMTDsKIAotCWxvY2tkZXBfYXNz
ZXJ0X2hlbGQoJmRldl9wcml2LT5kcm0uc3RydWN0X211dGV4KTsKLQogCURSTV9ERUJVR19EUklW
RVIoImNyZWF0aW5nIHByZWFsbG9jYXRlZCBzdG9sZW4gb2JqZWN0OiBzdG9sZW5fb2Zmc2V0PSVw
YSwgZ3R0X29mZnNldD0lcGEsIHNpemU9JXBhXG4iLAogCQkJICZzdG9sZW5fb2Zmc2V0LCAmZ3R0
X29mZnNldCwgJnNpemUpOwogCkBAIC02NzQsMTEgKzY3MiwxMyBAQCBpOTE1X2dlbV9vYmplY3Rf
Y3JlYXRlX3N0b2xlbl9mb3JfcHJlYWxsb2NhdGVkKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpk
ZXZfcHJpdgogCSAqIHNldHRpbmcgdXAgdGhlIEdUVCBzcGFjZS4gVGhlIGFjdHVhbCByZXNlcnZh
dGlvbiB3aWxsIG9jY3VyCiAJICogbGF0ZXIuCiAJICovCisJbXV0ZXhfbG9jaygmZ2d0dC0+dm0u
bXV0ZXgpOwogCXJldCA9IGk5MTVfZ2VtX2d0dF9yZXNlcnZlKCZnZ3R0LT52bSwgJnZtYS0+bm9k
ZSwKIAkJCQkgICBzaXplLCBndHRfb2Zmc2V0LCBvYmotPmNhY2hlX2xldmVsLAogCQkJCSAgIDAp
OwogCWlmIChyZXQpIHsKIAkJRFJNX0RFQlVHX0RSSVZFUigiZmFpbGVkIHRvIGFsbG9jYXRlIHN0
b2xlbiBHVFQgc3BhY2VcbiIpOworCQltdXRleF91bmxvY2soJmdndHQtPnZtLm11dGV4KTsKIAkJ
Z290byBlcnJfcGFnZXM7CiAJfQogCkBAIC02ODgsNyArNjg4LDYgQEAgaTkxNV9nZW1fb2JqZWN0
X2NyZWF0ZV9zdG9sZW5fZm9yX3ByZWFsbG9jYXRlZChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAq
ZGV2X3ByaXYKIAlzZXRfYml0KEk5MTVfVk1BX0dMT0JBTF9CSU5EX0JJVCwgX19pOTE1X3ZtYV9m
bGFncyh2bWEpKTsKIAlfX2k5MTVfdm1hX3NldF9tYXBfYW5kX2ZlbmNlYWJsZSh2bWEpOwogCi0J
bXV0ZXhfbG9jaygmZ2d0dC0+dm0ubXV0ZXgpOwogCWxpc3RfYWRkX3RhaWwoJnZtYS0+dm1fbGlu
aywgJmdndHQtPnZtLmJvdW5kX2xpc3QpOwogCW11dGV4X3VubG9jaygmZ2d0dC0+dm0ubXV0ZXgp
OwogCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fdGlsaW5n
LmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fdGlsaW5nLmMKaW5kZXggY2Ew
YzJmNDUxNzQyLi4zMjAwNDQwMWFhOTYgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1
L2dlbS9pOTE1X2dlbV90aWxpbmcuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkx
NV9nZW1fdGlsaW5nLmMKQEAgLTE4MSwyMiArMTgxLDI1IEBAIHN0YXRpYyBpbnQKIGk5MTVfZ2Vt
X29iamVjdF9mZW5jZV9wcmVwYXJlKHN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmosCiAJ
CQkgICAgICBpbnQgdGlsaW5nX21vZGUsIHVuc2lnbmVkIGludCBzdHJpZGUpCiB7CisJc3RydWN0
IGk5MTVfZ2d0dCAqZ2d0dCA9ICZ0b19pOTE1KG9iai0+YmFzZS5kZXYpLT5nZ3R0OwogCXN0cnVj
dCBpOTE1X3ZtYSAqdm1hOwogCWludCByZXQ7CiAKIAlpZiAodGlsaW5nX21vZGUgPT0gSTkxNV9U
SUxJTkdfTk9ORSkKIAkJcmV0dXJuIDA7CiAKKwltdXRleF9sb2NrKCZnZ3R0LT52bS5tdXRleCk7
CiAJZm9yX2VhY2hfZ2d0dF92bWEodm1hLCBvYmopIHsKIAkJaWYgKGk5MTVfdm1hX2ZlbmNlX3By
ZXBhcmUodm1hLCB0aWxpbmdfbW9kZSwgc3RyaWRlKSkKIAkJCWNvbnRpbnVlOwogCiAJCXJldCA9
IGk5MTVfdm1hX3VuYmluZCh2bWEpOwogCQlpZiAocmV0KQotCQkJcmV0dXJuIHJldDsKKwkJCWJy
ZWFrOwogCX0KKwltdXRleF91bmxvY2soJmdndHQtPnZtLm11dGV4KTsKIAotCXJldHVybiAwOwor
CXJldHVybiByZXQ7CiB9CiAKIGludApAQCAtMjEyLDcgKzIxNSw2IEBAIGk5MTVfZ2VtX29iamVj
dF9zZXRfdGlsaW5nKHN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmosCiAKIAlHRU1fQlVH
X09OKCFpOTE1X3RpbGluZ19vayhvYmosIHRpbGluZywgc3RyaWRlKSk7CiAJR0VNX0JVR19PTigh
c3RyaWRlIF4gKHRpbGluZyA9PSBJOTE1X1RJTElOR19OT05FKSk7Ci0JbG9ja2RlcF9hc3NlcnRf
aGVsZCgmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CiAKIAlpZiAoKHRpbGluZyB8IHN0cmlkZSkg
PT0gb2JqLT50aWxpbmdfYW5kX3N0cmlkZSkKIAkJcmV0dXJuIDA7CkBAIC0zNjQsMTIgKzM2Niw3
IEBAIGk5MTVfZ2VtX3NldF90aWxpbmdfaW9jdGwoc3RydWN0IGRybV9kZXZpY2UgKmRldiwgdm9p
ZCAqZGF0YSwKIAkJfQogCX0KIAotCWVyciA9IG11dGV4X2xvY2tfaW50ZXJydXB0aWJsZSgmZGV2
LT5zdHJ1Y3RfbXV0ZXgpOwotCWlmIChlcnIpCi0JCWdvdG8gZXJyOwotCiAJZXJyID0gaTkxNV9n
ZW1fb2JqZWN0X3NldF90aWxpbmcob2JqLCBhcmdzLT50aWxpbmdfbW9kZSwgYXJncy0+c3RyaWRl
KTsKLQltdXRleF91bmxvY2soJmRldi0+c3RydWN0X211dGV4KTsKIAogCS8qIFdlIGhhdmUgdG8g
bWFpbnRhaW4gdGhpcyBleGlzdGluZyBBQkkuLi4gKi8KIAlhcmdzLT5zdHJpZGUgPSBpOTE1X2dl
bV9vYmplY3RfZ2V0X3N0cmlkZShvYmopOwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5
MTUvZ2VtL2k5MTVfZ2VtX3VzZXJwdHIuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1
X2dlbV91c2VycHRyLmMKaW5kZXggNzRkYTM1NjExZDdjLi5jZDM2MjM2ZTNmYWYgMTAwNjQ0Ci0t
LSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV91c2VycHRyLmMKKysrIGIvZHJp
dmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX3VzZXJwdHIuYwpAQCAtOTIsNyArOTIsNiBA
QCB1c2VycHRyX21uX2ludmFsaWRhdGVfcmFuZ2Vfc3RhcnQoc3RydWN0IG1tdV9ub3RpZmllciAq
X21uLAogCXN0cnVjdCBpOTE1X21tdV9ub3RpZmllciAqbW4gPQogCQljb250YWluZXJfb2YoX21u
LCBzdHJ1Y3QgaTkxNV9tbXVfbm90aWZpZXIsIG1uKTsKIAlzdHJ1Y3QgaW50ZXJ2YWxfdHJlZV9u
b2RlICppdDsKLQlzdHJ1Y3QgbXV0ZXggKnVubG9jayA9IE5VTEw7CiAJdW5zaWduZWQgbG9uZyBl
bmQ7CiAJaW50IHJldCA9IDA7CiAKQEAgLTEyOSwzMyArMTI4LDEzIEBAIHVzZXJwdHJfbW5faW52
YWxpZGF0ZV9yYW5nZV9zdGFydChzdHJ1Y3QgbW11X25vdGlmaWVyICpfbW4sCiAJCX0KIAkJc3Bp
bl91bmxvY2soJm1uLT5sb2NrKTsKIAotCQlpZiAoIXVubG9jaykgewotCQkJdW5sb2NrID0gJm1u
LT5tbS0+aTkxNS0+ZHJtLnN0cnVjdF9tdXRleDsKLQotCQkJc3dpdGNoIChtdXRleF90cnlsb2Nr
X3JlY3Vyc2l2ZSh1bmxvY2spKSB7Ci0JCQlkZWZhdWx0OgotCQkJY2FzZSBNVVRFWF9UUllMT0NL
X0ZBSUxFRDoKLQkJCQlpZiAobXV0ZXhfbG9ja19raWxsYWJsZV9uZXN0ZWQodW5sb2NrLCBJOTE1
X01NX1NIUklOS0VSKSkgewotCQkJCQlpOTE1X2dlbV9vYmplY3RfcHV0KG9iaik7Ci0JCQkJCXJl
dHVybiAtRUlOVFI7Ci0JCQkJfQotCQkJCS8qIGZhbGwgdGhyb3VnaCAqLwotCQkJY2FzZSBNVVRF
WF9UUllMT0NLX1NVQ0NFU1M6Ci0JCQkJYnJlYWs7Ci0KLQkJCWNhc2UgTVVURVhfVFJZTE9DS19S
RUNVUlNJVkU6Ci0JCQkJdW5sb2NrID0gRVJSX1BUUigtRUVYSVNUKTsKLQkJCQlicmVhazsKLQkJ
CX0KLQkJfQotCiAJCXJldCA9IGk5MTVfZ2VtX29iamVjdF91bmJpbmQob2JqLAogCQkJCQkgICAg
IEk5MTVfR0VNX09CSkVDVF9VTkJJTkRfQUNUSVZFKTsKIAkJaWYgKHJldCA9PSAwKQogCQkJcmV0
ID0gX19pOTE1X2dlbV9vYmplY3RfcHV0X3BhZ2VzKG9iaiwgSTkxNV9NTV9TSFJJTktFUik7CiAJ
CWk5MTVfZ2VtX29iamVjdF9wdXQob2JqKTsKIAkJaWYgKHJldCkKLQkJCWdvdG8gdW5sb2NrOwor
CQkJcmV0dXJuIHJldDsKIAogCQlzcGluX2xvY2soJm1uLT5sb2NrKTsKIApAQCAtMTY4LDEwICsx
NDcsNiBAQCB1c2VycHRyX21uX2ludmFsaWRhdGVfcmFuZ2Vfc3RhcnQoc3RydWN0IG1tdV9ub3Rp
ZmllciAqX21uLAogCX0KIAlzcGluX3VubG9jaygmbW4tPmxvY2spOwogCi11bmxvY2s6Ci0JaWYg
KCFJU19FUlJfT1JfTlVMTCh1bmxvY2spKQotCQltdXRleF91bmxvY2sodW5sb2NrKTsKLQogCXJl
dHVybiByZXQ7CiAKIH0KZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9zZWxm
dGVzdHMvaHVnZV9wYWdlcy5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL3NlbGZ0ZXN0cy9o
dWdlX3BhZ2VzLmMKaW5kZXggYTBhMjcyNTU2Mjg5Li41ZWYwYTNiNDRkOTAgMTAwNjQ0Ci0tLSBh
L2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9zZWxmdGVzdHMvaHVnZV9wYWdlcy5jCisrKyBiL2Ry
aXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9zZWxmdGVzdHMvaHVnZV9wYWdlcy5jCkBAIC0yNSw2ICsy
NSwxNyBAQCBzdGF0aWMgY29uc3QgdW5zaWduZWQgaW50IHBhZ2Vfc2l6ZXNbXSA9IHsKIAlJOTE1
X0dUVF9QQUdFX1NJWkVfNEssCiB9OwogCitzdGF0aWMgaW50IHVubG9ja2VkX3ZtYV91bmJpbmQo
c3RydWN0IGk5MTVfdm1hICp2bWEpCit7CisJaW50IHJldDsKKworCW11dGV4X2xvY2soJnZtYS0+
dm0tPm11dGV4KTsKKwlyZXQgPSBpOTE1X3ZtYV91bmJpbmQodm1hKTsKKwltdXRleF91bmxvY2so
JnZtYS0+dm0tPm11dGV4KTsKKworCXJldHVybiByZXQ7Cit9CisKIHN0YXRpYyB1bnNpZ25lZCBp
bnQgZ2V0X2xhcmdlc3RfcGFnZV9zaXplKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LAog
CQkJCQkgIHU2NCByZW0pCiB7CkBAIC0zMzMsNyArMzQ0LDExIEBAIHN0YXRpYyBpbnQgaWd0X2No
ZWNrX3BhZ2Vfc2l6ZXMoc3RydWN0IGk5MTVfdm1hICp2bWEpCiAJc3RydWN0IGRybV9pOTE1X3By
aXZhdGUgKmk5MTUgPSB2bWEtPnZtLT5pOTE1OwogCXVuc2lnbmVkIGludCBzdXBwb3J0ZWQgPSBJ
TlRFTF9JTkZPKGk5MTUpLT5wYWdlX3NpemVzOwogCXN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0
ICpvYmogPSB2bWEtPm9iajsKLQlpbnQgZXJyID0gMDsKKwlpbnQgZXJyOworCisJZXJyID0gaTkx
NV9hY3RpdmVfd2FpdCgmdm1hLT5hY3RpdmUpOworCWlmIChlcnIpCisJCXJldHVybiBlcnI7CiAK
IAlpZiAoIUhBU19QQUdFX1NJWkVTKGk5MTUsIHZtYS0+cGFnZV9zaXplcy5zZykpIHsKIAkJcHJf
ZXJyKCJ1bnN1cHBvcnRlZCBwYWdlX3NpemVzLnNnPSV1LCBzdXBwb3J0ZWQ9JXVcbiIsCkBAIC01
MjYsNyArNTQxLDcgQEAgc3RhdGljIGludCBpZ3RfbW9ja19wcGd0dF9taXNhbGlnbmVkX2RtYSh2
b2lkICphcmcpCiAJCSAqIHBhZ2VzLgogCQkgKi8KIAkJZm9yIChvZmZzZXQgPSA0MDk2OyBvZmZz
ZXQgPCBwYWdlX3NpemU7IG9mZnNldCArPSA0MDk2KSB7Ci0JCQllcnIgPSBpOTE1X3ZtYV91bmJp
bmQodm1hKTsKKwkJCWVyciA9IHVubG9ja2VkX3ZtYV91bmJpbmQodm1hKTsKIAkJCWlmIChlcnIp
IHsKIAkJCQlpOTE1X3ZtYV9jbG9zZSh2bWEpOwogCQkJCWdvdG8gb3V0X3VucGluOwpAQCAtOTQx
LDcgKzk1Niw3IEBAIHN0YXRpYyBpbnQgX19pZ3Rfd3JpdGVfaHVnZShzdHJ1Y3QgaW50ZWxfY29u
dGV4dCAqY2UsCiAJaWYgKElTX0VSUih2bWEpKQogCQlyZXR1cm4gUFRSX0VSUih2bWEpOwogCi0J
ZXJyID0gaTkxNV92bWFfdW5iaW5kKHZtYSk7CisJZXJyID0gdW5sb2NrZWRfdm1hX3VuYmluZCh2
bWEpOwogCWlmIChlcnIpCiAJCWdvdG8gb3V0X3ZtYV9jbG9zZTsKIApAQCAtMTM4Nyw3ICsxNDAy
LDcgQEAgc3RhdGljIGludCBpZ3RfcHBndHRfcGluX3VwZGF0ZSh2b2lkICphcmcpCiAJCQlnb3Rv
IG91dF91bnBpbjsKIAkJfQogCi0JCWVyciA9IGk5MTVfdm1hX2JpbmQodm1hLCBJOTE1X0NBQ0hF
X05PTkUsIFBJTl9VUERBVEUpOworCQllcnIgPSBpOTE1X3ZtYV9iaW5kKHZtYSwgSTkxNV9DQUNI
RV9OT05FLCBQSU5fVVBEQVRFLCBOVUxMKTsKIAkJaWYgKGVycikKIAkJCWdvdG8gb3V0X3VucGlu
OwogCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vc2VsZnRlc3RzL2k5MTVf
Z2VtX21tYW4uYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9zZWxmdGVzdHMvaTkxNV9nZW1f
bW1hbi5jCmluZGV4IDFkMjdiYWJmZjBjZS4uOWMyMTdkZmU5NmE5IDEwMDY0NAotLS0gYS9kcml2
ZXJzL2dwdS9kcm0vaTkxNS9nZW0vc2VsZnRlc3RzL2k5MTVfZ2VtX21tYW4uYworKysgYi9kcml2
ZXJzL2dwdS9kcm0vaTkxNS9nZW0vc2VsZnRlc3RzL2k5MTVfZ2VtX21tYW4uYwpAQCAtMjA1LDcg
KzIwNSw2IEBAIHN0YXRpYyBpbnQgaWd0X3BhcnRpYWxfdGlsaW5nKHZvaWQgKmFyZykKIAkJZ290
byBvdXQ7CiAJfQogCi0JbXV0ZXhfbG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CiAJd2Fr
ZXJlZiA9IGludGVsX3J1bnRpbWVfcG1fZ2V0KCZpOTE1LT5ydW50aW1lX3BtKTsKIAogCWlmICgx
KSB7CkBAIC0zMTgsNyArMzE3LDYgQEAgbmV4dF90aWxpbmc6IDsKIAogb3V0X3VubG9jazoKIAlp
bnRlbF9ydW50aW1lX3BtX3B1dCgmaTkxNS0+cnVudGltZV9wbSwgd2FrZXJlZik7Ci0JbXV0ZXhf
dW5sb2NrKCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsKIAlpOTE1X2dlbV9vYmplY3RfdW5waW5f
cGFnZXMob2JqKTsKIG91dDoKIAlpOTE1X2dlbV9vYmplY3RfcHV0KG9iaik7CmRpZmYgLS1naXQg
YS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9ndC5jIGIvZHJpdmVycy9ncHUvZHJtL2k5
MTUvZ3QvaW50ZWxfZ3QuYwppbmRleCBkNDhlYzlhNzZlZDEuLmMyYWZmZmI5NDQ3NCAxMDA2NDQK
LS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfZ3QuYworKysgYi9kcml2ZXJzL2dw
dS9kcm0vaTkxNS9ndC9pbnRlbF9ndC5jCkBAIC0yMDcsMTEgKzIwNywxMiBAQCB2b2lkIGludGVs
X2d0X2ZsdXNoX2dndHRfd3JpdGVzKHN0cnVjdCBpbnRlbF9ndCAqZ3QpCiAKIAl3aXRoX2ludGVs
X3J1bnRpbWVfcG0oJmk5MTUtPnJ1bnRpbWVfcG0sIHdha2VyZWYpIHsKIAkJc3RydWN0IGludGVs
X3VuY29yZSAqdW5jb3JlID0gZ3QtPnVuY29yZTsKKwkJdW5zaWduZWQgbG9uZyBmbGFnczsKIAot
CQlzcGluX2xvY2tfaXJxKCZ1bmNvcmUtPmxvY2spOworCQlzcGluX2xvY2tfaXJxc2F2ZSgmdW5j
b3JlLT5sb2NrLCBmbGFncyk7CiAJCWludGVsX3VuY29yZV9wb3N0aW5nX3JlYWRfZncodW5jb3Jl
LAogCQkJCQkgICAgIFJJTkdfSEVBRChSRU5ERVJfUklOR19CQVNFKSk7Ci0JCXNwaW5fdW5sb2Nr
X2lycSgmdW5jb3JlLT5sb2NrKTsKKwkJc3Bpbl91bmxvY2tfaXJxcmVzdG9yZSgmdW5jb3JlLT5s
b2NrLCBmbGFncyk7CiAJfQogfQogCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9n
dC9zZWxmdGVzdF9oYW5nY2hlY2suYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L3NlbGZ0ZXN0
X2hhbmdjaGVjay5jCmluZGV4IGEwMDk4ZmMzNTkyMS4uZTUzZWVhMTA1MGY4IDEwMDY0NAotLS0g
YS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9zZWxmdGVzdF9oYW5nY2hlY2suYworKysgYi9kcml2
ZXJzL2dwdS9kcm0vaTkxNS9ndC9zZWxmdGVzdF9oYW5nY2hlY2suYwpAQCAtMTEyNywxNSArMTEy
NywxNCBAQCBzdGF0aWMgaW50IGV2aWN0X3ZtYSh2b2lkICpkYXRhKQogewogCXN0cnVjdCBldmlj
dF92bWEgKmFyZyA9IGRhdGE7CiAJc3RydWN0IGk5MTVfYWRkcmVzc19zcGFjZSAqdm0gPSBhcmct
PnZtYS0+dm07Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSB2bS0+aTkxNTsKIAlz
dHJ1Y3QgZHJtX21tX25vZGUgZXZpY3QgPSBhcmctPnZtYS0+bm9kZTsKIAlpbnQgZXJyOwogCiAJ
Y29tcGxldGUoJmFyZy0+Y29tcGxldGlvbik7CiAKLQltdXRleF9sb2NrKCZpOTE1LT5kcm0uc3Ry
dWN0X211dGV4KTsKKwltdXRleF9sb2NrKCZ2bS0+bXV0ZXgpOwogCWVyciA9IGk5MTVfZ2VtX2V2
aWN0X2Zvcl9ub2RlKHZtLCAmZXZpY3QsIDApOwotCW11dGV4X3VubG9jaygmaTkxNS0+ZHJtLnN0
cnVjdF9tdXRleCk7CisJbXV0ZXhfdW5sb2NrKCZ2bS0+bXV0ZXgpOwogCiAJcmV0dXJuIGVycjsK
IH0KQEAgLTExNDMsMzkgKzExNDIsMzMgQEAgc3RhdGljIGludCBldmljdF92bWEodm9pZCAqZGF0
YSkKIHN0YXRpYyBpbnQgZXZpY3RfZmVuY2Uodm9pZCAqZGF0YSkKIHsKIAlzdHJ1Y3QgZXZpY3Rf
dm1hICphcmcgPSBkYXRhOwotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0gYXJnLT52
bWEtPnZtLT5pOTE1OwogCWludCBlcnI7CiAKIAljb21wbGV0ZSgmYXJnLT5jb21wbGV0aW9uKTsK
IAotCW11dGV4X2xvY2soJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwotCiAJLyogTWFyayB0aGUg
ZmVuY2UgcmVnaXN0ZXIgYXMgZGlydHkgdG8gZm9yY2UgdGhlIG1taW8gdXBkYXRlLiAqLwogCWVy
ciA9IGk5MTVfZ2VtX29iamVjdF9zZXRfdGlsaW5nKGFyZy0+dm1hLT5vYmosIEk5MTVfVElMSU5H
X1ksIDUxMik7CiAJaWYgKGVycikgewogCQlwcl9lcnIoIkludmFsaWQgWS10aWxpbmcgc2V0dGlu
Z3M7IGVycjolZFxuIiwgZXJyKTsKLQkJZ290byBvdXRfdW5sb2NrOworCQlyZXR1cm4gZXJyOwog
CX0KIAogCWVyciA9IGk5MTVfdm1hX3BpbihhcmctPnZtYSwgMCwgMCwgUElOX0dMT0JBTCB8IFBJ
Tl9NQVBQQUJMRSk7CiAJaWYgKGVycikgewogCQlwcl9lcnIoIlVuYWJsZSB0byBwaW4gdm1hIGZv
ciBZLXRpbGVkIGZlbmNlOyBlcnI6JWRcbiIsIGVycik7Ci0JCWdvdG8gb3V0X3VubG9jazsKKwkJ
cmV0dXJuIGVycjsKIAl9CiAKIAllcnIgPSBpOTE1X3ZtYV9waW5fZmVuY2UoYXJnLT52bWEpOwog
CWk5MTVfdm1hX3VucGluKGFyZy0+dm1hKTsKIAlpZiAoZXJyKSB7CiAJCXByX2VycigiVW5hYmxl
IHRvIHBpbiBZLXRpbGVkIGZlbmNlOyBlcnI6JWRcbiIsIGVycik7Ci0JCWdvdG8gb3V0X3VubG9j
azsKKwkJcmV0dXJuIGVycjsKIAl9CiAKIAlpOTE1X3ZtYV91bnBpbl9mZW5jZShhcmctPnZtYSk7
CiAKLW91dF91bmxvY2s6Ci0JbXV0ZXhfdW5sb2NrKCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsK
LQotCXJldHVybiBlcnI7CisJcmV0dXJuIDA7CiB9CiAKIHN0YXRpYyBpbnQgX19pZ3RfcmVzZXRf
ZXZpY3Rfdm1hKHN0cnVjdCBpbnRlbF9ndCAqZ3QsCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9k
cm0vaTkxNS9ndnQvYXBlcnR1cmVfZ20uYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d2dC9hcGVy
dHVyZV9nbS5jCmluZGV4IDVmZjI0MzdiMjk5OC4uZDk5NmJiYzdlYTU5IDEwMDY0NAotLS0gYS9k
cml2ZXJzL2dwdS9kcm0vaTkxNS9ndnQvYXBlcnR1cmVfZ20uYworKysgYi9kcml2ZXJzL2dwdS9k
cm0vaTkxNS9ndnQvYXBlcnR1cmVfZ20uYwpAQCAtNjEsMTQgKzYxLDE0IEBAIHN0YXRpYyBpbnQg
YWxsb2NfZ20oc3RydWN0IGludGVsX3ZncHUgKnZncHUsIGJvb2wgaGlnaF9nbSkKIAkJZmxhZ3Mg
PSBQSU5fTUFQUEFCTEU7CiAJfQogCi0JbXV0ZXhfbG9jaygmZGV2X3ByaXYtPmRybS5zdHJ1Y3Rf
bXV0ZXgpOworCW11dGV4X2xvY2soJmRldl9wcml2LT5nZ3R0LnZtLm11dGV4KTsKIAltbWlvX2h3
X2FjY2Vzc19wcmUoZGV2X3ByaXYpOwogCXJldCA9IGk5MTVfZ2VtX2d0dF9pbnNlcnQoJmRldl9w
cml2LT5nZ3R0LnZtLCBub2RlLAogCQkJCSAgc2l6ZSwgSTkxNV9HVFRfUEFHRV9TSVpFLAogCQkJ
CSAgSTkxNV9DT0xPUl9VTkVWSUNUQUJMRSwKIAkJCQkgIHN0YXJ0LCBlbmQsIGZsYWdzKTsKIAlt
bWlvX2h3X2FjY2Vzc19wb3N0KGRldl9wcml2KTsKLQltdXRleF91bmxvY2soJmRldl9wcml2LT5k
cm0uc3RydWN0X211dGV4KTsKKwltdXRleF91bmxvY2soJmRldl9wcml2LT5nZ3R0LnZtLm11dGV4
KTsKIAlpZiAocmV0KQogCQlndnRfZXJyKCJmYWlsIHRvIGFsbG9jICVzIGdtIHNwYWNlIGZyb20g
aG9zdFxuIiwKIAkJCWhpZ2hfZ20gPyAiaGlnaCIgOiAibG93Iik7CkBAIC05OCw5ICs5OCw5IEBA
IHN0YXRpYyBpbnQgYWxsb2NfdmdwdV9nbShzdHJ1Y3QgaW50ZWxfdmdwdSAqdmdwdSkKIAogCXJl
dHVybiAwOwogb3V0X2ZyZWVfYXBlcnR1cmU6Ci0JbXV0ZXhfbG9jaygmZGV2X3ByaXYtPmRybS5z
dHJ1Y3RfbXV0ZXgpOworCW11dGV4X2xvY2soJmRldl9wcml2LT5nZ3R0LnZtLm11dGV4KTsKIAlk
cm1fbW1fcmVtb3ZlX25vZGUoJnZncHUtPmdtLmxvd19nbV9ub2RlKTsKLQltdXRleF91bmxvY2so
JmRldl9wcml2LT5kcm0uc3RydWN0X211dGV4KTsKKwltdXRleF91bmxvY2soJmRldl9wcml2LT5n
Z3R0LnZtLm11dGV4KTsKIAlyZXR1cm4gcmV0OwogfQogCkBAIC0xMDgsMTAgKzEwOCwxMCBAQCBz
dGF0aWMgdm9pZCBmcmVlX3ZncHVfZ20oc3RydWN0IGludGVsX3ZncHUgKnZncHUpCiB7CiAJc3Ry
dWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdmdwdS0+Z3Z0LT5kZXZfcHJpdjsKIAot
CW11dGV4X2xvY2soJmRldl9wcml2LT5kcm0uc3RydWN0X211dGV4KTsKKwltdXRleF9sb2NrKCZk
ZXZfcHJpdi0+Z2d0dC52bS5tdXRleCk7CiAJZHJtX21tX3JlbW92ZV9ub2RlKCZ2Z3B1LT5nbS5s
b3dfZ21fbm9kZSk7CiAJZHJtX21tX3JlbW92ZV9ub2RlKCZ2Z3B1LT5nbS5oaWdoX2dtX25vZGUp
OwotCW11dGV4X3VubG9jaygmZGV2X3ByaXYtPmRybS5zdHJ1Y3RfbXV0ZXgpOworCW11dGV4X3Vu
bG9jaygmZGV2X3ByaXYtPmdndHQudm0ubXV0ZXgpOwogfQogCiAvKioKZGlmZiAtLWdpdCBhL2Ry
aXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfYWN0aXZlLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9p
OTE1X2FjdGl2ZS5jCmluZGV4IDQ4ZTE2YWQ5M2JiZC4uNWU5ZjgyNmZmMTMyIDEwMDY0NAotLS0g
YS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2FjdGl2ZS5jCisrKyBiL2RyaXZlcnMvZ3B1L2Ry
bS9pOTE1L2k5MTVfYWN0aXZlLmMKQEAgLTE0Miw2ICsxNDIsNyBAQCBfX2FjdGl2ZV9yZXRpcmUo
c3RydWN0IGk5MTVfYWN0aXZlICpyZWYpCiAJaWYgKCFyZXRpcmUpCiAJCXJldHVybjsKIAorCUdF
TV9CVUdfT04ocmN1X2FjY2Vzc19wb2ludGVyKHJlZi0+ZXhjbCkpOwogCXJidHJlZV9wb3N0b3Jk
ZXJfZm9yX2VhY2hfZW50cnlfc2FmZShpdCwgbiwgJnJvb3QsIG5vZGUpIHsKIAkJR0VNX0JVR19P
TihpOTE1X2FjdGl2ZV9yZXF1ZXN0X2lzc2V0KCZpdC0+YmFzZSkpOwogCQlrbWVtX2NhY2hlX2Zy
ZWUoZ2xvYmFsLnNsYWJfY2FjaGUsIGl0KTsKQEAgLTI0MSw2ICsyNDIsOCBAQCB2b2lkIF9faTkx
NV9hY3RpdmVfaW5pdChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwKIAlyZWYtPmZsYWdz
ID0gMDsKIAlyZWYtPmFjdGl2ZSA9IGFjdGl2ZTsKIAlyZWYtPnJldGlyZSA9IHJldGlyZTsKKwor
CXJlZi0+ZXhjbCA9IE5VTEw7CiAJcmVmLT50cmVlID0gUkJfUk9PVDsKIAlyZWYtPmNhY2hlID0g
TlVMTDsKIAlpbml0X2xsaXN0X2hlYWQoJnJlZi0+cHJlYWxsb2NhdGVkX2JhcnJpZXJzKTsKQEAg
LTMzNyw2ICszNDAsNDUgQEAgaW50IGk5MTVfYWN0aXZlX3JlZihzdHJ1Y3QgaTkxNV9hY3RpdmUg
KnJlZiwKIAlyZXR1cm4gZXJyOwogfQogCitzdGF0aWMgdm9pZCBleGNsX2NiKHN0cnVjdCBkbWFf
ZmVuY2UgKmYsIHN0cnVjdCBkbWFfZmVuY2VfY2IgKmNiKQoreworCXN0cnVjdCBpOTE1X2FjdGl2
ZSAqcmVmID0gY29udGFpbmVyX29mKGNiLCB0eXBlb2YoKnJlZiksIGV4Y2xfY2IpOworCisJUkNV
X0lOSVRfUE9JTlRFUihyZWYtPmV4Y2wsIE5VTEwpOworCWRtYV9mZW5jZV9wdXQoZik7CisKKwlh
Y3RpdmVfcmV0aXJlKHJlZik7Cit9CisKK3ZvaWQgaTkxNV9hY3RpdmVfc2V0X2V4Y2x1c2l2ZShz
dHJ1Y3QgaTkxNV9hY3RpdmUgKnJlZiwgc3RydWN0IGRtYV9mZW5jZSAqZikKK3sKKwlHRU1fQlVH
X09OKGk5MTVfYWN0aXZlX2lzX2lkbGUocmVmKSk7CisKKwlkbWFfZmVuY2VfZ2V0KGYpOworCisJ
cmN1X3JlYWRfbG9jaygpOworCWlmIChyY3VfYWNjZXNzX3BvaW50ZXIocmVmLT5leGNsKSkgewor
CQlzdHJ1Y3QgZG1hX2ZlbmNlICpvbGQ7CisKKwkJb2xkID0gZG1hX2ZlbmNlX2dldF9yY3Vfc2Fm
ZSgmcmVmLT5leGNsKTsKKwkJaWYgKG9sZCkgeworCQkJaWYgKGRtYV9mZW5jZV9yZW1vdmVfY2Fs
bGJhY2sob2xkLCAmcmVmLT5leGNsX2NiKSkKKwkJCQlhdG9taWNfZGVjKCZyZWYtPmNvdW50KTsK
KwkJCWRtYV9mZW5jZV9wdXQob2xkKTsKKwkJfQorCX0KKwlyY3VfcmVhZF91bmxvY2soKTsKKwor
CWF0b21pY19pbmMoJnJlZi0+Y291bnQpOworCXJjdV9hc3NpZ25fcG9pbnRlcihyZWYtPmV4Y2ws
IGYpOworCisJaWYgKGRtYV9mZW5jZV9hZGRfY2FsbGJhY2soZiwgJnJlZi0+ZXhjbF9jYiwgZXhj
bF9jYikpIHsKKwkJUkNVX0lOSVRfUE9JTlRFUihyZWYtPmV4Y2wsIE5VTEwpOworCQlhdG9taWNf
ZGVjKCZyZWYtPmNvdW50KTsKKwkJZG1hX2ZlbmNlX3B1dChmKTsKKwl9Cit9CisKIGludCBpOTE1
X2FjdGl2ZV9hY3F1aXJlKHN0cnVjdCBpOTE1X2FjdGl2ZSAqcmVmKQogewogCWludCBlcnI7CkBA
IC0zOTUsNiArNDM3LDI1IEBAIHZvaWQgaTkxNV9hY3RpdmVfdW5ncmFiKHN0cnVjdCBpOTE1X2Fj
dGl2ZSAqcmVmKQogCV9fYWN0aXZlX3VuZ3JhYihyZWYpOwogfQogCitzdGF0aWMgaW50IGV4Y2xf
d2FpdChzdHJ1Y3QgaTkxNV9hY3RpdmUgKnJlZikKK3sKKwlzdHJ1Y3QgZG1hX2ZlbmNlICpvbGQ7
CisJaW50IGVyciA9IDA7CisKKwlpZiAoIXJjdV9hY2Nlc3NfcG9pbnRlcihyZWYtPmV4Y2wpKQor
CQlyZXR1cm4gMDsKKworCXJjdV9yZWFkX2xvY2soKTsKKwlvbGQgPSBkbWFfZmVuY2VfZ2V0X3Jj
dV9zYWZlKCZyZWYtPmV4Y2wpOworCXJjdV9yZWFkX3VubG9jaygpOworCWlmIChvbGQpIHsKKwkJ
ZXJyID0gZG1hX2ZlbmNlX3dhaXQob2xkLCB0cnVlKTsKKwkJZG1hX2ZlbmNlX3B1dChvbGQpOwor
CX0KKworCXJldHVybiBlcnI7Cit9CisKIGludCBpOTE1X2FjdGl2ZV93YWl0KHN0cnVjdCBpOTE1
X2FjdGl2ZSAqcmVmKQogewogCXN0cnVjdCBhY3RpdmVfbm9kZSAqaXQsICpuOwpAQCAtNDE1LDYg
KzQ3NiwxMCBAQCBpbnQgaTkxNV9hY3RpdmVfd2FpdChzdHJ1Y3QgaTkxNV9hY3RpdmUgKnJlZikK
IAkJcmV0dXJuIDA7CiAJfQogCisJZXJyID0gZXhjbF93YWl0KHJlZik7CisJaWYgKGVycikKKwkJ
Z290byBvdXQ7CisKIAlyYnRyZWVfcG9zdG9yZGVyX2Zvcl9lYWNoX2VudHJ5X3NhZmUoaXQsIG4s
ICZyZWYtPnRyZWUsIG5vZGUpIHsKIAkJaWYgKGlzX2JhcnJpZXIoJml0LT5iYXNlKSkgeyAvKiB1
bmNvbm5lY3RlZCBpZGxlLWJhcnJpZXIgKi8KIAkJCWVyciA9IC1FQlVTWTsKQEAgLTQyNiw2ICs0
OTEsNyBAQCBpbnQgaTkxNV9hY3RpdmVfd2FpdChzdHJ1Y3QgaTkxNV9hY3RpdmUgKnJlZikKIAkJ
CWJyZWFrOwogCX0KIAorb3V0OgogCV9fYWN0aXZlX3JldGlyZShyZWYpOwogCWlmIChlcnIpCiAJ
CXJldHVybiBlcnI7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2FjdGl2
ZS5oIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9hY3RpdmUuaAppbmRleCBmOTUwNThmOTkw
NTcuLmJjMWM5ZDVkNGY2MyAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9h
Y3RpdmUuaAorKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2FjdGl2ZS5oCkBAIC0zNzMs
NiArMzczLDggQEAgaW50IGk5MTVfYWN0aXZlX3JlZihzdHJ1Y3QgaTkxNV9hY3RpdmUgKnJlZiwK
IAkJICAgIHN0cnVjdCBpbnRlbF90aW1lbGluZSAqdGwsCiAJCSAgICBzdHJ1Y3QgaTkxNV9yZXF1
ZXN0ICpycSk7CiAKK3ZvaWQgaTkxNV9hY3RpdmVfc2V0X2V4Y2x1c2l2ZShzdHJ1Y3QgaTkxNV9h
Y3RpdmUgKnJlZiwgc3RydWN0IGRtYV9mZW5jZSAqZik7CisKIGludCBpOTE1X2FjdGl2ZV93YWl0
KHN0cnVjdCBpOTE1X2FjdGl2ZSAqcmVmKTsKIAogaW50IGk5MTVfcmVxdWVzdF9hd2FpdF9hY3Rp
dmUoc3RydWN0IGk5MTVfcmVxdWVzdCAqcnEsCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0v
aTkxNS9pOTE1X2FjdGl2ZV90eXBlcy5oIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9hY3Rp
dmVfdHlwZXMuaAppbmRleCAxODU0ZTdkMTY4YzEuLjg2ZTdhMjMyZWEzYyAxMDA2NDQKLS0tIGEv
ZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9hY3RpdmVfdHlwZXMuaAorKysgYi9kcml2ZXJzL2dw
dS9kcm0vaTkxNS9pOTE1X2FjdGl2ZV90eXBlcy5oCkBAIC04LDYgKzgsNyBAQAogI2RlZmluZSBf
STkxNV9BQ1RJVkVfVFlQRVNfSF8KIAogI2luY2x1ZGUgPGxpbnV4L2F0b21pYy5oPgorI2luY2x1
ZGUgPGxpbnV4L2RtYS1mZW5jZS5oPgogI2luY2x1ZGUgPGxpbnV4L2xsaXN0Lmg+CiAjaW5jbHVk
ZSA8bGludXgvbXV0ZXguaD4KICNpbmNsdWRlIDxsaW51eC9yYnRyZWUuaD4KQEAgLTUxLDYgKzUy
LDEwIEBAIHN0cnVjdCBpOTE1X2FjdGl2ZSB7CiAJc3RydWN0IG11dGV4IG11dGV4OwogCWF0b21p
Y190IGNvdW50OwogCisJLyogUHJlYWxsb2NhdGVkICJleGNsdXNpdmUiIG5vZGUgKi8KKwlzdHJ1
Y3QgZG1hX2ZlbmNlIF9fcmN1ICpleGNsOworCXN0cnVjdCBkbWFfZmVuY2VfY2IgZXhjbF9jYjsK
KwogCXVuc2lnbmVkIGxvbmcgZmxhZ3M7CiAjZGVmaW5lIEk5MTVfQUNUSVZFX0dSQUJfQklUIDAK
IApkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9nZW0uYyBiL2RyaXZlcnMv
Z3B1L2RybS9pOTE1L2k5MTVfZ2VtLmMKaW5kZXggZWM5YTQ2YzI3NmRlLi44NTMyM2NkMDgwMjIg
MTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZ2VtLmMKKysrIGIvZHJpdmVy
cy9ncHUvZHJtL2k5MTUvaTkxNV9nZW0uYwpAQCAtNjIsMjAgKzYyLDMxIEBACiAjaW5jbHVkZSAi
aW50ZWxfcG0uaCIKIAogc3RhdGljIGludAotaW5zZXJ0X21hcHBhYmxlX25vZGUoc3RydWN0IGk5
MTVfZ2d0dCAqZ2d0dCwKLSAgICAgICAgICAgICAgICAgICAgIHN0cnVjdCBkcm1fbW1fbm9kZSAq
bm9kZSwgdTMyIHNpemUpCitpbnNlcnRfbWFwcGFibGVfbm9kZShzdHJ1Y3QgaTkxNV9nZ3R0ICpn
Z3R0LCBzdHJ1Y3QgZHJtX21tX25vZGUgKm5vZGUsIHUzMiBzaXplKQogeworCWludCBlcnI7CisK
KwllcnIgPSBtdXRleF9sb2NrX2ludGVycnVwdGlibGUoJmdndHQtPnZtLm11dGV4KTsKKwlpZiAo
ZXJyKQorCQlyZXR1cm4gZXJyOworCiAJbWVtc2V0KG5vZGUsIDAsIHNpemVvZigqbm9kZSkpOwot
CXJldHVybiBkcm1fbW1faW5zZXJ0X25vZGVfaW5fcmFuZ2UoJmdndHQtPnZtLm1tLCBub2RlLAot
CQkJCQkgICBzaXplLCAwLCBJOTE1X0NPTE9SX1VORVZJQ1RBQkxFLAotCQkJCQkgICAwLCBnZ3R0
LT5tYXBwYWJsZV9lbmQsCi0JCQkJCSAgIERSTV9NTV9JTlNFUlRfTE9XKTsKKwllcnIgPSBkcm1f
bW1faW5zZXJ0X25vZGVfaW5fcmFuZ2UoJmdndHQtPnZtLm1tLCBub2RlLAorCQkJCQkgIHNpemUs
IDAsIEk5MTVfQ09MT1JfVU5FVklDVEFCTEUsCisJCQkJCSAgMCwgZ2d0dC0+bWFwcGFibGVfZW5k
LAorCQkJCQkgIERSTV9NTV9JTlNFUlRfTE9XKTsKKworCW11dGV4X3VubG9jaygmZ2d0dC0+dm0u
bXV0ZXgpOworCisJcmV0dXJuIGVycjsKIH0KIAogc3RhdGljIHZvaWQKLXJlbW92ZV9tYXBwYWJs
ZV9ub2RlKHN0cnVjdCBkcm1fbW1fbm9kZSAqbm9kZSkKK3JlbW92ZV9tYXBwYWJsZV9ub2RlKHN0
cnVjdCBpOTE1X2dndHQgKmdndHQsIHN0cnVjdCBkcm1fbW1fbm9kZSAqbm9kZSkKIHsKKwltdXRl
eF9sb2NrKCZnZ3R0LT52bS5tdXRleCk7CiAJZHJtX21tX3JlbW92ZV9ub2RlKG5vZGUpOworCW11
dGV4X3VubG9jaygmZ2d0dC0+dm0ubXV0ZXgpOwogfQogCiBpbnQKQEAgLTg3LDcgKzk4LDggQEAg
aTkxNV9nZW1fZ2V0X2FwZXJ0dXJlX2lvY3RsKHN0cnVjdCBkcm1fZGV2aWNlICpkZXYsIHZvaWQg
KmRhdGEsCiAJc3RydWN0IGk5MTVfdm1hICp2bWE7CiAJdTY0IHBpbm5lZDsKIAotCW11dGV4X2xv
Y2soJmdndHQtPnZtLm11dGV4KTsKKwlpZiAobXV0ZXhfbG9ja19pbnRlcnJ1cHRpYmxlKCZnZ3R0
LT52bS5tdXRleCkpCisJCXJldHVybiAtRUlOVFI7CiAKIAlwaW5uZWQgPSBnZ3R0LT52bS5yZXNl
cnZlZDsKIAlsaXN0X2Zvcl9lYWNoX2VudHJ5KHZtYSwgJmdndHQtPnZtLmJvdW5kX2xpc3QsIHZt
X2xpbmspCkBAIC0xMDksOCArMTIxLDYgQEAgaW50IGk5MTVfZ2VtX29iamVjdF91bmJpbmQoc3Ry
dWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iaiwKIAlMSVNUX0hFQUQoc3RpbGxfaW5fbGlzdCk7
CiAJaW50IHJldCA9IDA7CiAKLQlsb2NrZGVwX2Fzc2VydF9oZWxkKCZvYmotPmJhc2UuZGV2LT5z
dHJ1Y3RfbXV0ZXgpOwotCiAJc3Bpbl9sb2NrKCZvYmotPnZtYS5sb2NrKTsKIAl3aGlsZSAoIXJl
dCAmJiAodm1hID0gbGlzdF9maXJzdF9lbnRyeV9vcl9udWxsKCZvYmotPnZtYS5saXN0LAogCQkJ
CQkJICAgICAgIHN0cnVjdCBpOTE1X3ZtYSwKQEAgLTEyMCw4ICsxMzAsMTMgQEAgaW50IGk5MTVf
Z2VtX29iamVjdF91bmJpbmQoc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iaiwKIAogCQly
ZXQgPSAtRUJVU1k7CiAJCWlmIChmbGFncyAmIEk5MTVfR0VNX09CSkVDVF9VTkJJTkRfQUNUSVZF
IHx8Ci0JCSAgICAhaTkxNV92bWFfaXNfYWN0aXZlKHZtYSkpCi0JCQlyZXQgPSBpOTE1X3ZtYV91
bmJpbmQodm1hKTsKKwkJICAgICFpOTE1X3ZtYV9pc19hY3RpdmUodm1hKSkgeworCQkJcmV0ID0g
bXV0ZXhfbG9ja19pbnRlcnJ1cHRpYmxlKCZ2bWEtPnZtLT5tdXRleCk7CisJCQlpZiAoIXJldCkg
eworCQkJCXJldCA9IGk5MTVfdm1hX3VuYmluZCh2bWEpOworCQkJCW11dGV4X3VubG9jaygmdm1h
LT52bS0+bXV0ZXgpOworCQkJfQorCQl9CiAKIAkJc3Bpbl9sb2NrKCZvYmotPnZtYS5sb2NrKTsK
IAl9CkBAIC0zMzgsMTAgKzM1Myw2IEBAIGk5MTVfZ2VtX2d0dF9wcmVhZChzdHJ1Y3QgZHJtX2k5
MTVfZ2VtX29iamVjdCAqb2JqLAogCXU2NCByZW1haW4sIG9mZnNldDsKIAlpbnQgcmV0OwogCi0J
cmV0ID0gbXV0ZXhfbG9ja19pbnRlcnJ1cHRpYmxlKCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsK
LQlpZiAocmV0KQotCQlyZXR1cm4gcmV0OwotCiAJd2FrZXJlZiA9IGludGVsX3J1bnRpbWVfcG1f
Z2V0KCZpOTE1LT5ydW50aW1lX3BtKTsKIAl2bWEgPSBFUlJfUFRSKC1FTk9ERVYpOwogCWlmICgh
aTkxNV9nZW1fb2JqZWN0X2lzX3RpbGVkKG9iaikpCkBAIC0zNTUsMTIgKzM2NiwxMCBAQCBpOTE1
X2dlbV9ndHRfcHJlYWQoc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iaiwKIAl9IGVsc2Ug
ewogCQlyZXQgPSBpbnNlcnRfbWFwcGFibGVfbm9kZShnZ3R0LCAmbm9kZSwgUEFHRV9TSVpFKTsK
IAkJaWYgKHJldCkKLQkJCWdvdG8gb3V0X3VubG9jazsKKwkJCWdvdG8gb3V0X3JwbTsKIAkJR0VN
X0JVR19PTighbm9kZS5hbGxvY2F0ZWQpOwogCX0KIAotCW11dGV4X3VubG9jaygmaTkxNS0+ZHJt
LnN0cnVjdF9tdXRleCk7Ci0KIAlyZXQgPSBpOTE1X2dlbV9vYmplY3RfbG9ja19pbnRlcnJ1cHRp
YmxlKG9iaik7CiAJaWYgKHJldCkKIAkJZ290byBvdXRfdW5waW47CkBAIC00MTQsMTcgKzQyMywx
NCBAQCBpOTE1X2dlbV9ndHRfcHJlYWQoc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iaiwK
IAogCWk5MTVfZ2VtX29iamVjdF91bmxvY2tfZmVuY2Uob2JqLCBmZW5jZSk7CiBvdXRfdW5waW46
Ci0JbXV0ZXhfbG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CiAJaWYgKG5vZGUuYWxsb2Nh
dGVkKSB7CiAJCWdndHQtPnZtLmNsZWFyX3JhbmdlKCZnZ3R0LT52bSwgbm9kZS5zdGFydCwgbm9k
ZS5zaXplKTsKLQkJcmVtb3ZlX21hcHBhYmxlX25vZGUoJm5vZGUpOworCQlyZW1vdmVfbWFwcGFi
bGVfbm9kZShnZ3R0LCAmbm9kZSk7CiAJfSBlbHNlIHsKIAkJaTkxNV92bWFfdW5waW4odm1hKTsK
IAl9Ci1vdXRfdW5sb2NrOgorb3V0X3JwbToKIAlpbnRlbF9ydW50aW1lX3BtX3B1dCgmaTkxNS0+
cnVudGltZV9wbSwgd2FrZXJlZik7Ci0JbXV0ZXhfdW5sb2NrKCZpOTE1LT5kcm0uc3RydWN0X211
dGV4KTsKLQogCXJldHVybiByZXQ7CiB9CiAKQEAgLTUzMSwxMCArNTM3LDYgQEAgaTkxNV9nZW1f
Z3R0X3B3cml0ZV9mYXN0KHN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmosCiAJdm9pZCBf
X3VzZXIgKnVzZXJfZGF0YTsKIAlpbnQgcmV0OwogCi0JcmV0ID0gbXV0ZXhfbG9ja19pbnRlcnJ1
cHRpYmxlKCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsKLQlpZiAocmV0KQotCQlyZXR1cm4gcmV0
OwotCiAJaWYgKGk5MTVfZ2VtX29iamVjdF9oYXNfc3RydWN0X3BhZ2Uob2JqKSkgewogCQkvKgog
CQkgKiBBdm9pZCB3YWtpbmcgdGhlIGRldmljZSB1cCBpZiB3ZSBjYW4gZmFsbGJhY2ssIGFzCkBA
IC01NDQsMTAgKzU0Niw4IEBAIGk5MTVfZ2VtX2d0dF9wd3JpdGVfZmFzdChzdHJ1Y3QgZHJtX2k5
MTVfZ2VtX29iamVjdCAqb2JqLAogCQkgKiB1c2luZyB0aGUgY2FjaGUgYnlwYXNzIG9mIGluZGly
ZWN0IEdHVFQgYWNjZXNzLgogCQkgKi8KIAkJd2FrZXJlZiA9IGludGVsX3J1bnRpbWVfcG1fZ2V0
X2lmX2luX3VzZShycG0pOwotCQlpZiAoIXdha2VyZWYpIHsKLQkJCXJldCA9IC1FRkFVTFQ7Ci0J
CQlnb3RvIG91dF91bmxvY2s7Ci0JCX0KKwkJaWYgKCF3YWtlcmVmKQorCQkJcmV0dXJuIC1FRkFV
TFQ7CiAJfSBlbHNlIHsKIAkJLyogTm8gYmFja2luZyBwYWdlcywgbm8gZmFsbGJhY2ssIHdlIG11
c3QgZm9yY2UgR0dUVCBhY2Nlc3MgKi8KIAkJd2FrZXJlZiA9IGludGVsX3J1bnRpbWVfcG1fZ2V0
KHJwbSk7CkBAIC01NjksOCArNTY5LDYgQEAgaTkxNV9nZW1fZ3R0X3B3cml0ZV9mYXN0KHN0cnVj
dCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmosCiAJCUdFTV9CVUdfT04oIW5vZGUuYWxsb2NhdGVk
KTsKIAl9CiAKLQltdXRleF91bmxvY2soJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwotCiAJcmV0
ID0gaTkxNV9nZW1fb2JqZWN0X2xvY2tfaW50ZXJydXB0aWJsZShvYmopOwogCWlmIChyZXQpCiAJ
CWdvdG8gb3V0X3VucGluOwpAQCAtNjM0LDE4ICs2MzIsMTUgQEAgaTkxNV9nZW1fZ3R0X3B3cml0
ZV9mYXN0KHN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmosCiAKIAlpOTE1X2dlbV9vYmpl
Y3RfdW5sb2NrX2ZlbmNlKG9iaiwgZmVuY2UpOwogb3V0X3VucGluOgotCW11dGV4X2xvY2soJmk5
MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwogCWludGVsX2d0X2ZsdXNoX2dndHRfd3JpdGVzKGdndHQt
PnZtLmd0KTsKIAlpZiAobm9kZS5hbGxvY2F0ZWQpIHsKIAkJZ2d0dC0+dm0uY2xlYXJfcmFuZ2Uo
JmdndHQtPnZtLCBub2RlLnN0YXJ0LCBub2RlLnNpemUpOwotCQlyZW1vdmVfbWFwcGFibGVfbm9k
ZSgmbm9kZSk7CisJCXJlbW92ZV9tYXBwYWJsZV9ub2RlKGdndHQsICZub2RlKTsKIAl9IGVsc2Ug
ewogCQlpOTE1X3ZtYV91bnBpbih2bWEpOwogCX0KIG91dF9ycG06CiAJaW50ZWxfcnVudGltZV9w
bV9wdXQocnBtLCB3YWtlcmVmKTsKLW91dF91bmxvY2s6Ci0JbXV0ZXhfdW5sb2NrKCZpOTE1LT5k
cm0uc3RydWN0X211dGV4KTsKIAlyZXR1cm4gcmV0OwogfQogCkBAIC05NjcsOCArOTYyLDYgQEAg
aTkxNV9nZW1fb2JqZWN0X2dndHRfcGluKHN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmos
CiAJc3RydWN0IGk5MTVfdm1hICp2bWE7CiAJaW50IHJldDsKIAotCWxvY2tkZXBfYXNzZXJ0X2hl
bGQoJm9iai0+YmFzZS5kZXYtPnN0cnVjdF9tdXRleCk7Ci0KIAlpZiAoZmxhZ3MgJiBQSU5fTUFQ
UEFCTEUgJiYKIAkgICAgKCF2aWV3IHx8IHZpZXctPnR5cGUgPT0gSTkxNV9HR1RUX1ZJRVdfTk9S
TUFMKSkgewogCQkvKiBJZiB0aGUgcmVxdWlyZWQgc3BhY2UgaXMgbGFyZ2VyIHRoYW4gdGhlIGF2
YWlsYWJsZQpAQCAtMTAyMiw3ICsxMDE1LDkgQEAgaTkxNV9nZW1fb2JqZWN0X2dndHRfcGluKHN0
cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmosCiAJCSAgICAgaTkxNV9nZ3R0X29mZnNldCh2
bWEpLCBhbGlnbm1lbnQsCiAJCSAgICAgISEoZmxhZ3MgJiBQSU5fTUFQUEFCTEUpLAogCQkgICAg
IGk5MTVfdm1hX2lzX21hcF9hbmRfZmVuY2VhYmxlKHZtYSkpOworCQltdXRleF9sb2NrKCZ2bWEt
PnZtLT5tdXRleCk7CiAJCXJldCA9IGk5MTVfdm1hX3VuYmluZCh2bWEpOworCQltdXRleF91bmxv
Y2soJnZtYS0+dm0tPm11dGV4KTsKIAkJaWYgKHJldCkKIAkJCXJldHVybiBFUlJfUFRSKHJldCk7
CiAJfQpAQCAtMTMyMCw3ICsxMzE1LDkgQEAgc3RhdGljIGludCBfX2ludGVsX2VuZ2luZXNfcmVj
b3JkX2RlZmF1bHRzKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KQogCQkgKiBmcm9tIHRo
ZSBHVFQgdG8gcHJldmVudCBzdWNoIGFjY2lkZW50cyBhbmQgcmVjbGFpbSB0aGUKIAkJICogc3Bh
Y2UuCiAJCSAqLworCQltdXRleF9sb2NrKCZzdGF0ZS0+dm0tPm11dGV4KTsKIAkJZXJyID0gaTkx
NV92bWFfdW5iaW5kKHN0YXRlKTsKKwkJbXV0ZXhfdW5sb2NrKCZzdGF0ZS0+dm0tPm11dGV4KTsK
IAkJaWYgKGVycikKIAkJCWdvdG8gb3V0OwogCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0v
aTkxNS9pOTE1X2dlbV9ldmljdC5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9nZW1fZXZp
Y3QuYwppbmRleCA1MmM4NmM2ZTA2NzMuLjcyMmIwM2FmMzg5MiAxMDA2NDQKLS0tIGEvZHJpdmVy
cy9ncHUvZHJtL2k5MTUvaTkxNV9nZW1fZXZpY3QuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkx
NS9pOTE1X2dlbV9ldmljdC5jCkBAIC00Nyw4ICs0Nyw3IEBAIHN0YXRpYyBpbnQgZ2d0dF9mbHVz
aChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkKIAkgKiBib3VuZCBieSB0aGVpciBhY3Rp
dmUgcmVmZXJlbmNlLgogCSAqLwogCXJldHVybiBpOTE1X2dlbV93YWl0X2Zvcl9pZGxlKGk5MTUs
Ci0JCQkJICAgICAgSTkxNV9XQUlUX0lOVEVSUlVQVElCTEUgfAotCQkJCSAgICAgIEk5MTVfV0FJ
VF9MT0NLRUQsCisJCQkJICAgICAgSTkxNV9XQUlUX0lOVEVSUlVQVElCTEUsCiAJCQkJICAgICAg
TUFYX1NDSEVEVUxFX1RJTUVPVVQpOwogfQogCkBAIC0xMDQsNyArMTAzLDcgQEAgaTkxNV9nZW1f
ZXZpY3Rfc29tZXRoaW5nKHN0cnVjdCBpOTE1X2FkZHJlc3Nfc3BhY2UgKnZtLAogCXN0cnVjdCBp
OTE1X3ZtYSAqYWN0aXZlOwogCWludCByZXQ7CiAKLQlsb2NrZGVwX2Fzc2VydF9oZWxkKCZ2bS0+
aTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CisJbG9ja2RlcF9hc3NlcnRfaGVsZCgmdm0tPm11dGV4
KTsKIAl0cmFjZV9pOTE1X2dlbV9ldmljdCh2bSwgbWluX3NpemUsIGFsaWdubWVudCwgZmxhZ3Mp
OwogCiAJLyoKQEAgLTEyNywxNSArMTI2LDYgQEAgaTkxNV9nZW1fZXZpY3Rfc29tZXRoaW5nKHN0
cnVjdCBpOTE1X2FkZHJlc3Nfc3BhY2UgKnZtLAogCQkJCSAgICBtaW5fc2l6ZSwgYWxpZ25tZW50
LCBjYWNoZV9sZXZlbCwKIAkJCQkgICAgc3RhcnQsIGVuZCwgbW9kZSk7CiAKLQkvKgotCSAqIFJl
dGlyZSBiZWZvcmUgd2Ugc2VhcmNoIHRoZSBhY3RpdmUgbGlzdC4gQWx0aG91Z2ggd2UgaGF2ZQot
CSAqIHJlYXNvbmFibGUgYWNjdXJhY3kgaW4gb3VyIHJldGlyZW1lbnQgbGlzdHMsIHdlIG1heSBo
YXZlCi0JICogYSBzdHJheSBwaW4gKHByZXZlbnRpbmcgZXZpY3Rpb24pIHRoYXQgY2FuIG9ubHkg
YmUgcmVzb2x2ZWQgYnkKLQkgKiByZXRpcmluZy4KLQkgKi8KLQlpZiAoIShmbGFncyAmIFBJTl9O
T05CTE9DSykpCi0JCWk5MTVfcmV0aXJlX3JlcXVlc3RzKGRldl9wcml2KTsKLQogc2VhcmNoX2Fn
YWluOgogCWFjdGl2ZSA9IE5VTEw7CiAJSU5JVF9MSVNUX0hFQUQoJmV2aWN0aW9uX2xpc3QpOwpA
QCAtMjY5LDcgKzI1OSw3IEBAIGludCBpOTE1X2dlbV9ldmljdF9mb3Jfbm9kZShzdHJ1Y3QgaTkx
NV9hZGRyZXNzX3NwYWNlICp2bSwKIAlib29sIGNoZWNrX2NvbG9yOwogCWludCByZXQgPSAwOwog
Ci0JbG9ja2RlcF9hc3NlcnRfaGVsZCgmdm0tPmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOworCWxv
Y2tkZXBfYXNzZXJ0X2hlbGQoJnZtLT5tdXRleCk7CiAJR0VNX0JVR19PTighSVNfQUxJR05FRChz
dGFydCwgSTkxNV9HVFRfUEFHRV9TSVpFKSk7CiAJR0VNX0JVR19PTighSVNfQUxJR05FRChlbmQs
IEk5MTVfR1RUX1BBR0VfU0laRSkpOwogCkBAIC0zNzUsNyArMzY1LDcgQEAgaW50IGk5MTVfZ2Vt
X2V2aWN0X3ZtKHN0cnVjdCBpOTE1X2FkZHJlc3Nfc3BhY2UgKnZtKQogCXN0cnVjdCBpOTE1X3Zt
YSAqdm1hLCAqbmV4dDsKIAlpbnQgcmV0OwogCi0JbG9ja2RlcF9hc3NlcnRfaGVsZCgmdm0tPmk5
MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOworCWxvY2tkZXBfYXNzZXJ0X2hlbGQoJnZtLT5tdXRleCk7
CiAJdHJhY2VfaTkxNV9nZW1fZXZpY3Rfdm0odm0pOwogCiAJLyogU3dpdGNoIGJhY2sgdG8gdGhl
IGRlZmF1bHQgY29udGV4dCBpbiBvcmRlciB0byB1bnBpbgpAQCAtMzkwLDcgKzM4MCw2IEBAIGlu
dCBpOTE1X2dlbV9ldmljdF92bShzdHJ1Y3QgaTkxNV9hZGRyZXNzX3NwYWNlICp2bSkKIAl9CiAK
IAlJTklUX0xJU1RfSEVBRCgmZXZpY3Rpb25fbGlzdCk7Ci0JbXV0ZXhfbG9jaygmdm0tPm11dGV4
KTsKIAlsaXN0X2Zvcl9lYWNoX2VudHJ5KHZtYSwgJnZtLT5ib3VuZF9saXN0LCB2bV9saW5rKSB7
CiAJCWlmIChpOTE1X3ZtYV9pc19waW5uZWQodm1hKSkKIAkJCWNvbnRpbnVlOwpAQCAtMzk4LDcg
KzM4Nyw2IEBAIGludCBpOTE1X2dlbV9ldmljdF92bShzdHJ1Y3QgaTkxNV9hZGRyZXNzX3NwYWNl
ICp2bSkKIAkJX19pOTE1X3ZtYV9waW4odm1hKTsKIAkJbGlzdF9hZGQoJnZtYS0+ZXZpY3RfbGlu
aywgJmV2aWN0aW9uX2xpc3QpOwogCX0KLQltdXRleF91bmxvY2soJnZtLT5tdXRleCk7CiAKIAly
ZXQgPSAwOwogCWxpc3RfZm9yX2VhY2hfZW50cnlfc2FmZSh2bWEsIG5leHQsICZldmljdGlvbl9s
aXN0LCBldmljdF9saW5rKSB7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1
X2dlbV9mZW5jZV9yZWcuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZ2VtX2ZlbmNlX3Jl
Zy5jCmluZGV4IDYxNWE5ZjRlZjMwYy4uMWU5M2YyYWFmYzgwIDEwMDY0NAotLS0gYS9kcml2ZXJz
L2dwdS9kcm0vaTkxNS9pOTE1X2dlbV9mZW5jZV9yZWcuYworKysgYi9kcml2ZXJzL2dwdS9kcm0v
aTkxNS9pOTE1X2dlbV9mZW5jZV9yZWcuYwpAQCAtMzMxLDEzICszMzEsMTUgQEAgc3RhdGljIHN0
cnVjdCBpOTE1X2ZlbmNlX3JlZyAqZmVuY2VfZmluZChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAq
aTkxNSkKIAlyZXR1cm4gRVJSX1BUUigtRURFQURMSyk7CiB9CiAKLXN0YXRpYyBpbnQgX19pOTE1
X3ZtYV9waW5fZmVuY2Uoc3RydWN0IGk5MTVfdm1hICp2bWEpCitpbnQgX19pOTE1X3ZtYV9waW5f
ZmVuY2Uoc3RydWN0IGk5MTVfdm1hICp2bWEpCiB7CiAJc3RydWN0IGk5MTVfZ2d0dCAqZ2d0dCA9
IGk5MTVfdm1fdG9fZ2d0dCh2bWEtPnZtKTsKIAlzdHJ1Y3QgaTkxNV9mZW5jZV9yZWcgKmZlbmNl
OwogCXN0cnVjdCBpOTE1X3ZtYSAqc2V0ID0gaTkxNV9nZW1fb2JqZWN0X2lzX3RpbGVkKHZtYS0+
b2JqKSA/IHZtYSA6IE5VTEw7CiAJaW50IGVycjsKIAorCWxvY2tkZXBfYXNzZXJ0X2hlbGQoJnZt
YS0+dm0tPm11dGV4KTsKKwogCS8qIEp1c3QgdXBkYXRlIG91ciBwbGFjZSBpbiB0aGUgTFJVIGlm
IG91ciBmZW5jZSBpcyBnZXR0aW5nIHJldXNlZC4gKi8KIAlpZiAodm1hLT5mZW5jZSkgewogCQlm
ZW5jZSA9IHZtYS0+ZmVuY2U7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1
X2dlbV9ndHQuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZ2VtX2d0dC5jCmluZGV4IDM0
MmE4NDU2NmU2MS4uOGY3NDJmM2VlYzYwIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkx
NS9pOTE1X2dlbV9ndHQuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2dlbV9ndHQu
YwpAQCAtMTQ0LDE2ICsxNDQsMTggQEAgc3RhdGljIHZvaWQgZ21jaF9nZ3R0X2ludmFsaWRhdGUo
c3RydWN0IGk5MTVfZ2d0dCAqZ2d0dCkKIAogc3RhdGljIGludCBwcGd0dF9iaW5kX3ZtYShzdHJ1
Y3QgaTkxNV92bWEgKnZtYSwKIAkJCSAgZW51bSBpOTE1X2NhY2hlX2xldmVsIGNhY2hlX2xldmVs
LAotCQkJICB1MzIgdW51c2VkKQorCQkJICB1MzIgZmxhZ3MpCiB7CiAJdTMyIHB0ZV9mbGFnczsK
IAlpbnQgZXJyOwogCi0JaWYgKCFpOTE1X3ZtYV9pc19ib3VuZCh2bWEsIEk5MTVfVk1BX0xPQ0FM
X0JJTkQpKSB7CisJaWYgKGZsYWdzICYgSTkxNV9WTUFfQUxMT0MpIHsKIAkJZXJyID0gdm1hLT52
bS0+YWxsb2NhdGVfdmFfcmFuZ2Uodm1hLT52bSwKIAkJCQkJCSB2bWEtPm5vZGUuc3RhcnQsIHZt
YS0+c2l6ZSk7CiAJCWlmIChlcnIpCiAJCQlyZXR1cm4gZXJyOworCisJCXNldF9iaXQoSTkxNV9W
TUFfQUxMT0NfQklULCBfX2k5MTVfdm1hX2ZsYWdzKHZtYSkpOwogCX0KIAogCS8qIEFwcGxpY2Fi
bGUgdG8gVkxWLCBhbmQgZ2VuOCsgKi8KQEAgLTE2MSw2ICsxNjMsNyBAQCBzdGF0aWMgaW50IHBw
Z3R0X2JpbmRfdm1hKHN0cnVjdCBpOTE1X3ZtYSAqdm1hLAogCWlmIChpOTE1X2dlbV9vYmplY3Rf
aXNfcmVhZG9ubHkodm1hLT5vYmopKQogCQlwdGVfZmxhZ3MgfD0gUFRFX1JFQURfT05MWTsKIAor
CUdFTV9CVUdfT04oIXRlc3RfYml0KEk5MTVfVk1BX0FMTE9DX0JJVCwgX19pOTE1X3ZtYV9mbGFn
cyh2bWEpKSk7CiAJdm1hLT52bS0+aW5zZXJ0X2VudHJpZXModm1hLT52bSwgdm1hLCBjYWNoZV9s
ZXZlbCwgcHRlX2ZsYWdzKTsKIAl3bWIoKTsKIApAQCAtMTY5LDcgKzE3Miw4IEBAIHN0YXRpYyBp
bnQgcHBndHRfYmluZF92bWEoc3RydWN0IGk5MTVfdm1hICp2bWEsCiAKIHN0YXRpYyB2b2lkIHBw
Z3R0X3VuYmluZF92bWEoc3RydWN0IGk5MTVfdm1hICp2bWEpCiB7Ci0Jdm1hLT52bS0+Y2xlYXJf
cmFuZ2Uodm1hLT52bSwgdm1hLT5ub2RlLnN0YXJ0LCB2bWEtPnNpemUpOworCWlmICh0ZXN0X2Fu
ZF9jbGVhcl9iaXQoSTkxNV9WTUFfQUxMT0NfQklULCBfX2k5MTVfdm1hX2ZsYWdzKHZtYSkpKQor
CQl2bWEtPnZtLT5jbGVhcl9yYW5nZSh2bWEtPnZtLCB2bWEtPm5vZGUuc3RhcnQsIHZtYS0+c2l6
ZSk7CiB9CiAKIHN0YXRpYyBpbnQgcHBndHRfc2V0X3BhZ2VzKHN0cnVjdCBpOTE1X3ZtYSAqdm1h
KQpAQCAtNDk3LDE1ICs1MDEsMjUgQEAgc3RhdGljIHZvaWQgaTkxNV9hZGRyZXNzX3NwYWNlX2Zp
bmkoc3RydWN0IGk5MTVfYWRkcmVzc19zcGFjZSAqdm0pCiAJbXV0ZXhfZGVzdHJveSgmdm0tPm11
dGV4KTsKIH0KIAotc3RhdGljIHZvaWQgcHBndHRfZGVzdHJveV92bWEoc3RydWN0IGk5MTVfYWRk
cmVzc19zcGFjZSAqdm0pCit2b2lkIF9faTkxNV92bV9jbG9zZShzdHJ1Y3QgaTkxNV9hZGRyZXNz
X3NwYWNlICp2bSkKIHsKIAlzdHJ1Y3QgaTkxNV92bWEgKnZtYSwgKnZuOwogCi0JbXV0ZXhfbG9j
aygmdm0tPmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwotCWxpc3RfZm9yX2VhY2hfZW50cnlfc2Fm
ZSh2bWEsIHZuLCAmdm0tPmJvdW5kX2xpc3QsIHZtX2xpbmspCisJbXV0ZXhfbG9jaygmdm0tPm11
dGV4KTsKKwlsaXN0X2Zvcl9lYWNoX2VudHJ5X3NhZmUodm1hLCB2biwgJnZtLT5ib3VuZF9saXN0
LCB2bV9saW5rKSB7CisJCXN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmogPSB2bWEtPm9i
ajsKKworCQlpZiAoIWtyZWZfZ2V0X3VubGVzc196ZXJvKCZvYmotPmJhc2UucmVmY291bnQpKQor
CQkJY29udGludWU7CisKKwkJYXRvbWljX2FuZCh+STkxNV9WTUFfUElOX01BU0ssICZ2bWEtPmZs
YWdzKTsKKwkJV0FSTl9PTihpOTE1X3ZtYV91bmJpbmQodm1hKSk7CiAJCWk5MTVfdm1hX2Rlc3Ry
b3kodm1hKTsKKworCQlpOTE1X2dlbV9vYmplY3RfcHV0KG9iaik7CisJfQogCUdFTV9CVUdfT04o
IWxpc3RfZW1wdHkoJnZtLT5ib3VuZF9saXN0KSk7Ci0JbXV0ZXhfdW5sb2NrKCZ2bS0+aTkxNS0+
ZHJtLnN0cnVjdF9tdXRleCk7CisJbXV0ZXhfdW5sb2NrKCZ2bS0+bXV0ZXgpOwogfQogCiBzdGF0
aWMgdm9pZCBfX2k5MTVfdm1fcmVsZWFzZShzdHJ1Y3Qgd29ya19zdHJ1Y3QgKndvcmspCkBAIC01
MTMsOCArNTI3LDYgQEAgc3RhdGljIHZvaWQgX19pOTE1X3ZtX3JlbGVhc2Uoc3RydWN0IHdvcmtf
c3RydWN0ICp3b3JrKQogCXN0cnVjdCBpOTE1X2FkZHJlc3Nfc3BhY2UgKnZtID0KIAkJY29udGFp
bmVyX29mKHdvcmssIHN0cnVjdCBpOTE1X2FkZHJlc3Nfc3BhY2UsIHJjdS53b3JrKTsKIAotCXBw
Z3R0X2Rlc3Ryb3lfdm1hKHZtKTsKLQogCXZtLT5jbGVhbnVwKHZtKTsKIAlpOTE1X2FkZHJlc3Nf
c3BhY2VfZmluaSh2bSk7CiAKQEAgLTUyOSw3ICs1NDEsNiBAQCB2b2lkIGk5MTVfdm1fcmVsZWFz
ZShzdHJ1Y3Qga3JlZiAqa3JlZikKIAlHRU1fQlVHX09OKGk5MTVfaXNfZ2d0dCh2bSkpOwogCXRy
YWNlX2k5MTVfcHBndHRfcmVsZWFzZSh2bSk7CiAKLQl2bS0+Y2xvc2VkID0gdHJ1ZTsKIAlxdWV1
ZV9yY3Vfd29yayh2bS0+aTkxNS0+d3EsICZ2bS0+cmN1KTsKIH0KIApAQCAtNTM3LDYgKzU0OCw3
IEBAIHN0YXRpYyB2b2lkIGk5MTVfYWRkcmVzc19zcGFjZV9pbml0KHN0cnVjdCBpOTE1X2FkZHJl
c3Nfc3BhY2UgKnZtLCBpbnQgc3ViY2xhc3MpCiB7CiAJa3JlZl9pbml0KCZ2bS0+cmVmKTsKIAlJ
TklUX1JDVV9XT1JLKCZ2bS0+cmN1LCBfX2k5MTVfdm1fcmVsZWFzZSk7CisJYXRvbWljX3NldCgm
dm0tPm9wZW4sIDEpOwogCiAJLyoKIAkgKiBUaGUgdm0tPm11dGV4IG11c3QgYmUgcmVjbGFpbSBz
YWZlIChmb3IgdXNlIGluIHRoZSBzaHJpbmtlcikuCkBAIC0xNzc0LDEyICsxNzg2LDggQEAgc3Rh
dGljIHZvaWQgZ2VuNl9wcGd0dF9mcmVlX3BkKHN0cnVjdCBnZW42X3BwZ3R0ICpwcGd0dCkKIHN0
YXRpYyB2b2lkIGdlbjZfcHBndHRfY2xlYW51cChzdHJ1Y3QgaTkxNV9hZGRyZXNzX3NwYWNlICp2
bSkKIHsKIAlzdHJ1Y3QgZ2VuNl9wcGd0dCAqcHBndHQgPSB0b19nZW42X3BwZ3R0KGk5MTVfdm1f
dG9fcHBndHQodm0pKTsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IHZtLT5pOTE1
OwogCi0JLyogRklYTUUgcmVtb3ZlIHRoZSBzdHJ1Y3RfbXV0ZXggdG8gYnJpbmcgdGhlIGxvY2tp
bmcgdW5kZXIgY29udHJvbCAqLwotCW11dGV4X2xvY2soJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgp
OwogCWk5MTVfdm1hX2Rlc3Ryb3kocHBndHQtPnZtYSk7Ci0JbXV0ZXhfdW5sb2NrKCZpOTE1LT5k
cm0uc3RydWN0X211dGV4KTsKIAogCWdlbjZfcHBndHRfZnJlZV9wZChwcGd0dCk7CiAJZnJlZV9z
Y3JhdGNoKHZtKTsKQEAgLTE4NjcsNyArMTg3NSw3IEBAIHN0YXRpYyBzdHJ1Y3QgaTkxNV92bWEg
KnBkX3ZtYV9jcmVhdGUoc3RydWN0IGdlbjZfcHBndHQgKnBwZ3R0LCBpbnQgc2l6ZSkKIAogCWk5
MTVfYWN0aXZlX2luaXQoaTkxNSwgJnZtYS0+YWN0aXZlLCBOVUxMLCBOVUxMKTsKIAotCXZtYS0+
dm0gPSAmZ2d0dC0+dm07CisJdm1hLT52bSA9IGk5MTVfdm1fZ2V0KCZnZ3R0LT52bSk7CiAJdm1h
LT5vcHMgPSAmcGRfdm1hX29wczsKIAl2bWEtPnByaXZhdGUgPSBwcGd0dDsKIApAQCAtMTg4Nyw3
ICsxODk1LDcgQEAgaW50IGdlbjZfcHBndHRfcGluKHN0cnVjdCBpOTE1X3BwZ3R0ICpiYXNlKQog
CXN0cnVjdCBnZW42X3BwZ3R0ICpwcGd0dCA9IHRvX2dlbjZfcHBndHQoYmFzZSk7CiAJaW50IGVy
cjsKIAotCUdFTV9CVUdfT04ocHBndHQtPmJhc2Uudm0uY2xvc2VkKTsKKwlHRU1fQlVHX09OKCFh
dG9taWNfcmVhZCgmcHBndHQtPmJhc2Uudm0ub3BlbikpOwogCiAJLyoKIAkgKiBXb3JrYXJvdW5k
IHRoZSBsaW1pdGVkIG1heGltdW0gdm1hLT5waW5fY291bnQgYW5kIHRoZSBhbGlhc2luZ19wcGd0
dApAQCAtMjQ2MywxNCArMjQ3MSwxOCBAQCBzdGF0aWMgaW50IGFsaWFzaW5nX2d0dF9iaW5kX3Zt
YShzdHJ1Y3QgaTkxNV92bWEgKnZtYSwKIAlpZiAoZmxhZ3MgJiBJOTE1X1ZNQV9MT0NBTF9CSU5E
KSB7CiAJCXN0cnVjdCBpOTE1X3BwZ3R0ICphbGlhcyA9IGk5MTVfdm1fdG9fZ2d0dCh2bWEtPnZt
KS0+YWxpYXM7CiAKLQkJaWYgKCFpOTE1X3ZtYV9pc19ib3VuZCh2bWEsIEk5MTVfVk1BX0xPQ0FM
X0JJTkQpKSB7CisJCWlmIChmbGFncyAmIEk5MTVfVk1BX0FMTE9DKSB7CiAJCQlyZXQgPSBhbGlh
cy0+dm0uYWxsb2NhdGVfdmFfcmFuZ2UoJmFsaWFzLT52bSwKIAkJCQkJCQkgIHZtYS0+bm9kZS5z
dGFydCwKIAkJCQkJCQkgIHZtYS0+c2l6ZSk7CiAJCQlpZiAocmV0KQogCQkJCXJldHVybiByZXQ7
CisKKwkJCXNldF9iaXQoSTkxNV9WTUFfQUxMT0NfQklULCBfX2k5MTVfdm1hX2ZsYWdzKHZtYSkp
OwogCQl9CiAKKwkJR0VNX0JVR19PTighdGVzdF9iaXQoSTkxNV9WTUFfQUxMT0NfQklULAorCQkJ
CSAgICAgX19pOTE1X3ZtYV9mbGFncyh2bWEpKSk7CiAJCWFsaWFzLT52bS5pbnNlcnRfZW50cmll
cygmYWxpYXMtPnZtLCB2bWEsCiAJCQkJCSBjYWNoZV9sZXZlbCwgcHRlX2ZsYWdzKTsKIAl9CkBA
IC0yNjAwLDIyICsyNjEyLDE2IEBAIHN0YXRpYyBpbnQgaW5pdF9hbGlhc2luZ19wcGd0dChzdHJ1
Y3QgaTkxNV9nZ3R0ICpnZ3R0KQogCiBzdGF0aWMgdm9pZCBmaW5pX2FsaWFzaW5nX3BwZ3R0KHN0
cnVjdCBpOTE1X2dndHQgKmdndHQpCiB7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUg
PSBnZ3R0LT52bS5pOTE1OwogCXN0cnVjdCBpOTE1X3BwZ3R0ICpwcGd0dDsKIAotCW11dGV4X2xv
Y2soJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwotCiAJcHBndHQgPSBmZXRjaF9hbmRfemVybygm
Z2d0dC0+YWxpYXMpOwogCWlmICghcHBndHQpCi0JCWdvdG8gb3V0OworCQlyZXR1cm47CiAKIAlp
OTE1X3ZtX3B1dCgmcHBndHQtPnZtKTsKIAogCWdndHQtPnZtLnZtYV9vcHMuYmluZF92bWEgICA9
IGdndHRfYmluZF92bWE7CiAJZ2d0dC0+dm0udm1hX29wcy51bmJpbmRfdm1hID0gZ2d0dF91bmJp
bmRfdm1hOwotCi1vdXQ6Ci0JbXV0ZXhfdW5sb2NrKCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsK
IH0KIAogc3RhdGljIGludCBnZ3R0X3Jlc2VydmVfZ3VjX3RvcChzdHJ1Y3QgaTkxNV9nZ3R0ICpn
Z3R0KQpAQCAtMjczMiwxNSArMjczOCwxNCBAQCBpbnQgaTkxNV9pbml0X2dndHQoc3RydWN0IGRy
bV9pOTE1X3ByaXZhdGUgKmk5MTUpCiAKIHN0YXRpYyB2b2lkIGdndHRfY2xlYW51cF9odyhzdHJ1
Y3QgaTkxNV9nZ3R0ICpnZ3R0KQogewotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0g
Z2d0dC0+dm0uaTkxNTsKIAlzdHJ1Y3QgaTkxNV92bWEgKnZtYSwgKnZuOwogCi0JZ2d0dC0+dm0u
Y2xvc2VkID0gdHJ1ZTsKKwlhdG9taWNfc2V0KCZnZ3R0LT52bS5vcGVuLCAwKTsKIAogCXJjdV9i
YXJyaWVyKCk7IC8qIGZsdXNoIHRoZSBSQ1UnZWRfX2k5MTVfdm1fcmVsZWFzZSAqLwotCWZsdXNo
X3dvcmtxdWV1ZShpOTE1LT53cSk7CisJZmx1c2hfd29ya3F1ZXVlKGdndHQtPnZtLmk5MTUtPndx
KTsKIAotCW11dGV4X2xvY2soJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOworCW11dGV4X2xvY2so
JmdndHQtPnZtLm11dGV4KTsKIAogCWxpc3RfZm9yX2VhY2hfZW50cnlfc2FmZSh2bWEsIHZuLCAm
Z2d0dC0+dm0uYm91bmRfbGlzdCwgdm1fbGluaykKIAkJV0FSTl9PTihpOTE1X3ZtYV91bmJpbmQo
dm1hKSk7CkBAIC0yNzQ5LDE1ICsyNzU0LDEyIEBAIHN0YXRpYyB2b2lkIGdndHRfY2xlYW51cF9o
dyhzdHJ1Y3QgaTkxNV9nZ3R0ICpnZ3R0KQogCQlkcm1fbW1fcmVtb3ZlX25vZGUoJmdndHQtPmVy
cm9yX2NhcHR1cmUpOwogCiAJZ2d0dF9yZWxlYXNlX2d1Y190b3AoZ2d0dCk7Ci0KLQlpZiAoZHJt
X21tX2luaXRpYWxpemVkKCZnZ3R0LT52bS5tbSkpIHsKLQkJaW50ZWxfdmd0X2RlYmFsbG9vbihn
Z3R0KTsKLQkJaTkxNV9hZGRyZXNzX3NwYWNlX2ZpbmkoJmdndHQtPnZtKTsKLQl9CisJaW50ZWxf
dmd0X2RlYmFsbG9vbihnZ3R0KTsKIAogCWdndHQtPnZtLmNsZWFudXAoJmdndHQtPnZtKTsKIAot
CW11dGV4X3VubG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CisJbXV0ZXhfdW5sb2NrKCZn
Z3R0LT52bS5tdXRleCk7CisJaTkxNV9hZGRyZXNzX3NwYWNlX2ZpbmkoJmdndHQtPnZtKTsKIAog
CWFyY2hfcGh5c193Y19kZWwoZ2d0dC0+bXRycik7CiAJaW9fbWFwcGluZ19maW5pKCZnZ3R0LT5p
b21hcCk7CkBAIC0zMTg2LDkgKzMxODgsNiBAQCBpbnQgaTkxNV9nZ3R0X3Byb2JlX2h3KHN0cnVj
dCBkcm1faTkxNV9wcml2YXRlICppOTE1KQogc3RhdGljIGludCBnZ3R0X2luaXRfaHcoc3RydWN0
IGk5MTVfZ2d0dCAqZ2d0dCkKIHsKIAlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IGdn
dHQtPnZtLmk5MTU7Ci0JaW50IHJldCA9IDA7Ci0KLQltdXRleF9sb2NrKCZpOTE1LT5kcm0uc3Ry
dWN0X211dGV4KTsKIAogCWk5MTVfYWRkcmVzc19zcGFjZV9pbml0KCZnZ3R0LT52bSwgVk1fQ0xB
U1NfR0dUVCk7CiAKQEAgLTMyMDQsMTggKzMyMDMsMTQgQEAgc3RhdGljIGludCBnZ3R0X2luaXRf
aHcoc3RydWN0IGk5MTVfZ2d0dCAqZ2d0dCkKIAkJCQlnZ3R0LT5nbWFkci5zdGFydCwKIAkJCQln
Z3R0LT5tYXBwYWJsZV9lbmQpKSB7CiAJCWdndHQtPnZtLmNsZWFudXAoJmdndHQtPnZtKTsKLQkJ
cmV0ID0gLUVJTzsKLQkJZ290byBvdXQ7CisJCXJldHVybiAtRUlPOwogCX0KIAogCWdndHQtPm10
cnIgPSBhcmNoX3BoeXNfd2NfYWRkKGdndHQtPmdtYWRyLnN0YXJ0LCBnZ3R0LT5tYXBwYWJsZV9l
bmQpOwogCiAJaTkxNV9nZ3R0X2luaXRfZmVuY2VzKGdndHQpOwogCi1vdXQ6Ci0JbXV0ZXhfdW5s
b2NrKCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsKLQotCXJldHVybiByZXQ7CisJcmV0dXJuIDA7
CiB9CiAKIC8qKgpAQCAtMzI4Nyw2ICszMjgyLDcgQEAgc3RhdGljIHZvaWQgZ2d0dF9yZXN0b3Jl
X21hcHBpbmdzKHN0cnVjdCBpOTE1X2dndHQgKmdndHQpCiB7CiAJc3RydWN0IGk5MTVfdm1hICp2
bWEsICp2bjsKIAlib29sIGZsdXNoID0gZmFsc2U7CisJaW50IG9wZW47CiAKIAlpbnRlbF9ndF9j
aGVja19hbmRfY2xlYXJfZmF1bHRzKGdndHQtPnZtLmd0KTsKIApAQCAtMzI5NCw3ICszMjkwLDkg
QEAgc3RhdGljIHZvaWQgZ2d0dF9yZXN0b3JlX21hcHBpbmdzKHN0cnVjdCBpOTE1X2dndHQgKmdn
dHQpCiAKIAkvKiBGaXJzdCBmaWxsIG91ciBwb3J0aW9uIG9mIHRoZSBHVFQgd2l0aCBzY3JhdGNo
IHBhZ2VzICovCiAJZ2d0dC0+dm0uY2xlYXJfcmFuZ2UoJmdndHQtPnZtLCAwLCBnZ3R0LT52bS50
b3RhbCk7Ci0JZ2d0dC0+dm0uY2xvc2VkID0gdHJ1ZTsgLyogc2tpcCByZXdyaXRpbmcgUFRFIG9u
IFZNQSB1bmJpbmQgKi8KKworCS8qIFNraXAgcmV3cml0aW5nIFBURSBvbiBWTUEgdW5iaW5kLiAq
LworCW9wZW4gPSBhdG9taWNfeGNoZygmZ2d0dC0+dm0ub3BlbiwgMCk7CiAKIAkvKiBjbGZsdXNo
IG9iamVjdHMgYm91bmQgaW50byB0aGUgR0dUVCBhbmQgcmViaW5kIHRoZW0uICovCiAJbGlzdF9m
b3JfZWFjaF9lbnRyeV9zYWZlKHZtYSwgdm4sICZnZ3R0LT52bS5ib3VuZF9saXN0LCB2bV9saW5r
KSB7CkBAIC0zMzAzLDI0ICszMzAxLDE5IEBAIHN0YXRpYyB2b2lkIGdndHRfcmVzdG9yZV9tYXBw
aW5ncyhzdHJ1Y3QgaTkxNV9nZ3R0ICpnZ3R0KQogCQlpZiAoIWk5MTVfdm1hX2lzX2JvdW5kKHZt
YSwgSTkxNV9WTUFfR0xPQkFMX0JJTkQpKQogCQkJY29udGludWU7CiAKLQkJbXV0ZXhfdW5sb2Nr
KCZnZ3R0LT52bS5tdXRleCk7Ci0KIAkJaWYgKCFpOTE1X3ZtYV91bmJpbmQodm1hKSkKLQkJCWdv
dG8gbG9jazsKKwkJCWNvbnRpbnVlOwogCiAJCVdBUk5fT04oaTkxNV92bWFfYmluZCh2bWEsCiAJ
CQkJICAgICAgb2JqID8gb2JqLT5jYWNoZV9sZXZlbCA6IDAsCi0JCQkJICAgICAgUElOX1VQREFU
RSkpOworCQkJCSAgICAgIFBJTl9VUERBVEUsIE5VTEwpKTsKIAkJaWYgKG9iaikgeyAvKiBvbmx5
IHVzZWQgZHVyaW5nIHJlc3VtZSA9PiBleGNsdXNpdmUgYWNjZXNzICovCiAJCQlmbHVzaCB8PSBm
ZXRjaF9hbmRfemVybygmb2JqLT53cml0ZV9kb21haW4pOwogCQkJb2JqLT5yZWFkX2RvbWFpbnMg
fD0gSTkxNV9HRU1fRE9NQUlOX0dUVDsKIAkJfQotCi1sb2NrOgotCQltdXRleF9sb2NrKCZnZ3R0
LT52bS5tdXRleCk7CiAJfQogCi0JZ2d0dC0+dm0uY2xvc2VkID0gZmFsc2U7CisJYXRvbWljX3Nl
dCgmZ2d0dC0+dm0ub3Blbiwgb3Blbik7CiAJZ2d0dC0+aW52YWxpZGF0ZShnZ3R0KTsKIAogCW11
dGV4X3VubG9jaygmZ2d0dC0+dm0ubXV0ZXgpOwpAQCAtMzcxMiw3ICszNzA1LDggQEAgaW50IGk5
MTVfZ2VtX2d0dF9pbnNlcnQoc3RydWN0IGk5MTVfYWRkcmVzc19zcGFjZSAqdm0sCiAJdTY0IG9m
ZnNldDsKIAlpbnQgZXJyOwogCi0JbG9ja2RlcF9hc3NlcnRfaGVsZCgmdm0tPmk5MTUtPmRybS5z
dHJ1Y3RfbXV0ZXgpOworCWxvY2tkZXBfYXNzZXJ0X2hlbGQoJnZtLT5tdXRleCk7CisKIAlHRU1f
QlVHX09OKCFzaXplKTsKIAlHRU1fQlVHX09OKCFJU19BTElHTkVEKHNpemUsIEk5MTVfR1RUX1BB
R0VfU0laRSkpOwogCUdFTV9CVUdfT04oYWxpZ25tZW50ICYmICFpc19wb3dlcl9vZl8yKGFsaWdu
bWVudCkpOwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9nZW1fZ3R0Lmgg
Yi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2dlbV9ndHQuaAppbmRleCAwZjE0NzIyZmQxNjMu
LjA1MTZjNGQxMTBiYyAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9nZW1f
Z3R0LmgKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9nZW1fZ3R0LmgKQEAgLTMwNyw3
ICszMDcsNyBAQCBzdHJ1Y3QgaTkxNV9hZGRyZXNzX3NwYWNlIHsKIAogCXVuc2lnbmVkIGludCBi
aW5kX2FsbG9jOwogCi0JYm9vbCBjbG9zZWQ7CisJYXRvbWljX3Qgb3BlbjsKIAogCXN0cnVjdCBt
dXRleCBtdXRleDsgLyogcHJvdGVjdHMgdm1hIGFuZCBvdXIgbGlzdHMgKi8KICNkZWZpbmUgVk1f
Q0xBU1NfR0dUVCAwCkBAIC01NzQsNiArNTc0LDM1IEBAIHN0YXRpYyBpbmxpbmUgdm9pZCBpOTE1
X3ZtX3B1dChzdHJ1Y3QgaTkxNV9hZGRyZXNzX3NwYWNlICp2bSkKIAlrcmVmX3B1dCgmdm0tPnJl
ZiwgaTkxNV92bV9yZWxlYXNlKTsKIH0KIAorc3RhdGljIGlubGluZSBzdHJ1Y3QgaTkxNV9hZGRy
ZXNzX3NwYWNlICoKK2k5MTVfdm1fb3BlbihzdHJ1Y3QgaTkxNV9hZGRyZXNzX3NwYWNlICp2bSkK
K3sKKwlHRU1fQlVHX09OKCFhdG9taWNfcmVhZCgmdm0tPm9wZW4pKTsKKwlhdG9taWNfaW5jKCZ2
bS0+b3Blbik7CisJcmV0dXJuIGk5MTVfdm1fZ2V0KHZtKTsKK30KKworc3RhdGljIGlubGluZSBi
b29sCitpOTE1X3ZtX3RyeW9wZW4oc3RydWN0IGk5MTVfYWRkcmVzc19zcGFjZSAqdm0pCit7CisJ
aWYgKGF0b21pY19hZGRfdW5sZXNzKCZ2bS0+b3BlbiwgMSwgMCkpCisJCXJldHVybiBpOTE1X3Zt
X2dldCh2bSk7CisKKwlyZXR1cm4gZmFsc2U7Cit9CisKK3ZvaWQgX19pOTE1X3ZtX2Nsb3NlKHN0
cnVjdCBpOTE1X2FkZHJlc3Nfc3BhY2UgKnZtKTsKKworc3RhdGljIGlubGluZSB2b2lkCitpOTE1
X3ZtX2Nsb3NlKHN0cnVjdCBpOTE1X2FkZHJlc3Nfc3BhY2UgKnZtKQoreworCUdFTV9CVUdfT04o
IWF0b21pY19yZWFkKCZ2bS0+b3BlbikpOworCWlmIChhdG9taWNfZGVjX2FuZF90ZXN0KCZ2bS0+
b3BlbikpCisJCV9faTkxNV92bV9jbG9zZSh2bSk7CisKKwlpOTE1X3ZtX3B1dCh2bSk7Cit9CisK
IGludCBnZW42X3BwZ3R0X3BpbihzdHJ1Y3QgaTkxNV9wcGd0dCAqYmFzZSk7CiB2b2lkIGdlbjZf
cHBndHRfdW5waW4oc3RydWN0IGk5MTVfcHBndHQgKmJhc2UpOwogdm9pZCBnZW42X3BwZ3R0X3Vu
cGluX2FsbChzdHJ1Y3QgaTkxNV9wcGd0dCAqYmFzZSk7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dw
dS9kcm0vaTkxNS9pOTE1X3BlcmYuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfcGVyZi5j
CmluZGV4IGU0MmI4NjgyN2Q2Yi4uZTZhYTU2ZDgyZjliIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dw
dS9kcm0vaTkxNS9pOTE1X3BlcmYuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3Bl
cmYuYwpAQCAtMTIwNCwxNSArMTIwNCwxMCBAQCBzdGF0aWMgaW50IGk5MTVfb2FfcmVhZChzdHJ1
Y3QgaTkxNV9wZXJmX3N0cmVhbSAqc3RyZWFtLAogc3RhdGljIHN0cnVjdCBpbnRlbF9jb250ZXh0
ICpvYV9waW5fY29udGV4dChzdHJ1Y3QgaTkxNV9wZXJmX3N0cmVhbSAqc3RyZWFtKQogewogCXN0
cnVjdCBpOTE1X2dlbV9lbmdpbmVzX2l0ZXIgaXQ7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUg
Kmk5MTUgPSBzdHJlYW0tPmRldl9wcml2OwogCXN0cnVjdCBpOTE1X2dlbV9jb250ZXh0ICpjdHgg
PSBzdHJlYW0tPmN0eDsKIAlzdHJ1Y3QgaW50ZWxfY29udGV4dCAqY2U7CiAJaW50IGVycjsKIAot
CWVyciA9IGk5MTVfbXV0ZXhfbG9ja19pbnRlcnJ1cHRpYmxlKCZpOTE1LT5kcm0pOwotCWlmIChl
cnIpCi0JCXJldHVybiBFUlJfUFRSKGVycik7Ci0KIAlmb3JfZWFjaF9nZW1fZW5naW5lKGNlLCBp
OTE1X2dlbV9jb250ZXh0X2xvY2tfZW5naW5lcyhjdHgpLCBpdCkgewogCQlpZiAoY2UtPmVuZ2lu
ZS0+Y2xhc3MgIT0gUkVOREVSX0NMQVNTKQogCQkJY29udGludWU7CkBAIC0xMjI5LDEwICsxMjI0
LDYgQEAgc3RhdGljIHN0cnVjdCBpbnRlbF9jb250ZXh0ICpvYV9waW5fY29udGV4dChzdHJ1Y3Qg
aTkxNV9wZXJmX3N0cmVhbSAqc3RyZWFtKQogCX0KIAlpOTE1X2dlbV9jb250ZXh0X3VubG9ja19l
bmdpbmVzKGN0eCk7CiAKLQltdXRleF91bmxvY2soJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwot
CWlmIChlcnIpCi0JCXJldHVybiBFUlJfUFRSKGVycik7Ci0KIAlyZXR1cm4gc3RyZWFtLT5waW5u
ZWRfY3R4OwogfQogCkBAIC0xMzQ3LDE1ICsxMzM4LDkgQEAgc3RhdGljIHZvaWQgb2FfcHV0X3Jl
bmRlcl9jdHhfaWQoc3RydWN0IGk5MTVfcGVyZl9zdHJlYW0gKnN0cmVhbSkKIHN0YXRpYyB2b2lk
CiBmcmVlX29hX2J1ZmZlcihzdHJ1Y3QgaTkxNV9wZXJmX3N0cmVhbSAqc3RyZWFtKQogewotCXN0
cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0gc3RyZWFtLT5kZXZfcHJpdjsKLQotCW11dGV4
X2xvY2soJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwotCiAJaTkxNV92bWFfdW5waW5fYW5kX3Jl
bGVhc2UoJnN0cmVhbS0+b2FfYnVmZmVyLnZtYSwKIAkJCQkgICBJOTE1X1ZNQV9SRUxFQVNFX01B
UCk7CiAKLQltdXRleF91bmxvY2soJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwotCiAJc3RyZWFt
LT5vYV9idWZmZXIudmFkZHIgPSBOVUxMOwogfQogCkBAIC0xNTEwLDE4ICsxNDk1LDEzIEBAIHN0
YXRpYyBpbnQgYWxsb2Nfb2FfYnVmZmVyKHN0cnVjdCBpOTE1X3BlcmZfc3RyZWFtICpzdHJlYW0p
CiAJaWYgKFdBUk5fT04oc3RyZWFtLT5vYV9idWZmZXIudm1hKSkKIAkJcmV0dXJuIC1FTk9ERVY7
CiAKLQlyZXQgPSBpOTE1X211dGV4X2xvY2tfaW50ZXJydXB0aWJsZSgmZGV2X3ByaXYtPmRybSk7
Ci0JaWYgKHJldCkKLQkJcmV0dXJuIHJldDsKLQogCUJVSUxEX0JVR19PTl9OT1RfUE9XRVJfT0Zf
MihPQV9CVUZGRVJfU0laRSk7CiAJQlVJTERfQlVHX09OKE9BX0JVRkZFUl9TSVpFIDwgU1pfMTI4
SyB8fCBPQV9CVUZGRVJfU0laRSA+IFNaXzE2TSk7CiAKIAlibyA9IGk5MTVfZ2VtX29iamVjdF9j
cmVhdGVfc2htZW0oZGV2X3ByaXYsIE9BX0JVRkZFUl9TSVpFKTsKIAlpZiAoSVNfRVJSKGJvKSkg
ewogCQlEUk1fRVJST1IoIkZhaWxlZCB0byBhbGxvY2F0ZSBPQSBidWZmZXJcbiIpOwotCQlyZXQg
PSBQVFJfRVJSKGJvKTsKLQkJZ290byB1bmxvY2s7CisJCXJldHVybiBQVFJfRVJSKGJvKTsKIAl9
CiAKIAlpOTE1X2dlbV9vYmplY3Rfc2V0X2NhY2hlX2NvaGVyZW5jeShibywgSTkxNV9DQUNIRV9M
TEMpOwpAQCAtMTU0NSw3ICsxNTI1LDcgQEAgc3RhdGljIGludCBhbGxvY19vYV9idWZmZXIoc3Ry
dWN0IGk5MTVfcGVyZl9zdHJlYW0gKnN0cmVhbSkKIAkJCSBpOTE1X2dndHRfb2Zmc2V0KHN0cmVh
bS0+b2FfYnVmZmVyLnZtYSksCiAJCQkgc3RyZWFtLT5vYV9idWZmZXIudmFkZHIpOwogCi0JZ290
byB1bmxvY2s7CisJcmV0dXJuIDA7CiAKIGVycl91bnBpbjoKIAlfX2k5MTVfdm1hX3VucGluKHZt
YSk7CkBAIC0xNTU2LDggKzE1MzYsNiBAQCBzdGF0aWMgaW50IGFsbG9jX29hX2J1ZmZlcihzdHJ1
Y3QgaTkxNV9wZXJmX3N0cmVhbSAqc3RyZWFtKQogCXN0cmVhbS0+b2FfYnVmZmVyLnZhZGRyID0g
TlVMTDsKIAlzdHJlYW0tPm9hX2J1ZmZlci52bWEgPSBOVUxMOwogCi11bmxvY2s6Ci0JbXV0ZXhf
dW5sb2NrKCZkZXZfcHJpdi0+ZHJtLnN0cnVjdF9tdXRleCk7CiAJcmV0dXJuIHJldDsKIH0KIApk
aWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV92bWEuYyBiL2RyaXZlcnMvZ3B1
L2RybS9pOTE1L2k5MTVfdm1hLmMKaW5kZXggNmM0YWE5NDcxYWYzLi5mN2IyMGZkOTQ1YTkgMTAw
NjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfdm1hLmMKKysrIGIvZHJpdmVycy9n
cHUvZHJtL2k5MTUvaTkxNV92bWEuYwpAQCAtMzIsNiArMzIsNyBAQAogCiAjaW5jbHVkZSAiaTkx
NV9kcnYuaCIKICNpbmNsdWRlICJpOTE1X2dsb2JhbHMuaCIKKyNpbmNsdWRlICJpOTE1X3N3X2Zl
bmNlX3dvcmsuaCIKICNpbmNsdWRlICJpOTE1X3RyYWNlLmgiCiAjaW5jbHVkZSAiaTkxNV92bWEu
aCIKIApAQCAtMTEwLDcgKzExMSw3IEBAIHZtYV9jcmVhdGUoc3RydWN0IGRybV9pOTE1X2dlbV9v
YmplY3QgKm9iaiwKIAlpZiAodm1hID09IE5VTEwpCiAJCXJldHVybiBFUlJfUFRSKC1FTk9NRU0p
OwogCi0Jdm1hLT52bSA9IHZtOworCXZtYS0+dm0gPSBpOTE1X3ZtX2dldCh2bSk7CiAJdm1hLT5v
cHMgPSAmdm0tPnZtYV9vcHM7CiAJdm1hLT5vYmogPSBvYmo7CiAJdm1hLT5yZXN2ID0gb2JqLT5i
YXNlLnJlc3Y7CkBAIC0yNjEsOCArMjYyLDYgQEAgdm1hX2xvb2t1cChzdHJ1Y3QgZHJtX2k5MTVf
Z2VtX29iamVjdCAqb2JqLAogICogT25jZSBjcmVhdGVkLCB0aGUgVk1BIGlzIGtlcHQgdW50aWwg
ZWl0aGVyIHRoZSBvYmplY3QgaXMgZnJlZWQsIG9yIHRoZQogICogYWRkcmVzcyBzcGFjZSBpcyBj
bG9zZWQuCiAgKgotICogTXVzdCBiZSBjYWxsZWQgd2l0aCBzdHJ1Y3RfbXV0ZXggaGVsZC4KLSAq
CiAgKiBSZXR1cm5zIHRoZSB2bWEsIG9yIGFuIGVycm9yIHBvaW50ZXIuCiAgKi8KIHN0cnVjdCBp
OTE1X3ZtYSAqCkBAIC0yNzMsNyArMjcyLDcgQEAgaTkxNV92bWFfaW5zdGFuY2Uoc3RydWN0IGRy
bV9pOTE1X2dlbV9vYmplY3QgKm9iaiwKIAlzdHJ1Y3QgaTkxNV92bWEgKnZtYTsKIAogCUdFTV9C
VUdfT04odmlldyAmJiAhaTkxNV9pc19nZ3R0KHZtKSk7Ci0JR0VNX0JVR19PTih2bS0+Y2xvc2Vk
KTsKKwlHRU1fQlVHX09OKCFhdG9taWNfcmVhZCgmdm0tPm9wZW4pKTsKIAogCXNwaW5fbG9jaygm
b2JqLT52bWEubG9jayk7CiAJdm1hID0gdm1hX2xvb2t1cChvYmosIHZtLCB2aWV3KTsKQEAgLTI4
NywxOCArMjg2LDYzIEBAIGk5MTVfdm1hX2luc3RhbmNlKHN0cnVjdCBkcm1faTkxNV9nZW1fb2Jq
ZWN0ICpvYmosCiAJcmV0dXJuIHZtYTsKIH0KIAorc3RydWN0IGk5MTVfdm1hX3dvcmsgeworCXN0
cnVjdCBkbWFfZmVuY2Vfd29yayBiYXNlOworCXN0cnVjdCBpOTE1X3ZtYSAqdm1hOworCWVudW0g
aTkxNV9jYWNoZV9sZXZlbCBjYWNoZV9sZXZlbDsKKwl1bnNpZ25lZCBpbnQgZmxhZ3M7Cit9Owor
CitzdGF0aWMgaW50IF9fdm1hX2JpbmQoc3RydWN0IGRtYV9mZW5jZV93b3JrICp3b3JrKQorewor
CXN0cnVjdCBpOTE1X3ZtYV93b3JrICp2dyA9IGNvbnRhaW5lcl9vZih3b3JrLCB0eXBlb2YoKnZ3
KSwgYmFzZSk7CisJc3RydWN0IGk5MTVfdm1hICp2bWEgPSB2dy0+dm1hOworCWludCBlcnI7CisK
KwllcnIgPSB2bWEtPm9wcy0+YmluZF92bWEodm1hLCB2dy0+Y2FjaGVfbGV2ZWwsIHZ3LT5mbGFn
cyk7CisJaWYgKGVycikKKwkJYXRvbWljX29yKEk5MTVfVk1BX0VSUk9SLCAmdm1hLT5mbGFncyk7
CisKKwlpZiAodm1hLT5vYmopCisJCWF0b21pY19kZWMoJnZtYS0+b2JqLT5tbS5wYWdlc19waW5f
Y291bnQpOworCisJcmV0dXJuIGVycjsKK30KKworc3RhdGljIGNvbnN0IHN0cnVjdCBkbWFfZmVu
Y2Vfd29ya19vcHMgYmluZF9vcHMgPSB7CisJLm5hbWUgPSAiYmluZCIsCisJLndvcmsgPSBfX3Zt
YV9iaW5kLAorfTsKKworc3RydWN0IGk5MTVfdm1hX3dvcmsgKmk5MTVfdm1hX3dvcmsodm9pZCkK
K3sKKwlzdHJ1Y3QgaTkxNV92bWFfd29yayAqdnc7CisKKwl2dyA9IGt6YWxsb2Moc2l6ZW9mKCp2
dyksIEdGUF9LRVJORUwpOworCWlmICghdncpCisJCXJldHVybiBOVUxMOworCisJZG1hX2ZlbmNl
X3dvcmtfaW5pdCgmdnctPmJhc2UsICZiaW5kX29wcyk7CisJdnctPmJhc2UuZG1hLmVycm9yID0g
LUVBR0FJTjsgLyogZGlzYWJsZSB0aGUgd29ya2VyIGJ5IGRlZmF1bHQgKi8KKworCXJldHVybiB2
dzsKK30KKwogLyoqCiAgKiBpOTE1X3ZtYV9iaW5kIC0gU2V0cyB1cCBQVEVzIGZvciBhbiBWTUEg
aW4gaXQncyBjb3JyZXNwb25kaW5nIGFkZHJlc3Mgc3BhY2UuCiAgKiBAdm1hOiBWTUEgdG8gbWFw
CiAgKiBAY2FjaGVfbGV2ZWw6IG1hcHBpbmcgY2FjaGUgbGV2ZWwKICAqIEBmbGFnczogZmxhZ3Mg
bGlrZSBnbG9iYWwgb3IgbG9jYWwgbWFwcGluZworICogQHdvcms6IHByZWFsbG9jYXRlZCB3b3Jr
ZXIgZm9yIGFsbG9jYXRpbmcgYW5kIGJpbmRpbmcgdGhlIFBURQogICoKICAqIERNQSBhZGRyZXNz
ZXMgYXJlIHRha2VuIGZyb20gdGhlIHNjYXR0ZXItZ2F0aGVyIHRhYmxlIG9mIHRoaXMgb2JqZWN0
IChvciBvZgogICogdGhpcyBWTUEgaW4gY2FzZSBvZiBub24tZGVmYXVsdCBHR1RUIHZpZXdzKSBh
bmQgUFRFIGVudHJpZXMgc2V0IHVwLgogICogTm90ZSB0aGF0IERNQSBhZGRyZXNzZXMgYXJlIGFs
c28gdGhlIG9ubHkgcGFydCBvZiB0aGUgU0cgdGFibGUgd2UgY2FyZSBhYm91dC4KICAqLwotaW50
IGk5MTVfdm1hX2JpbmQoc3RydWN0IGk5MTVfdm1hICp2bWEsIGVudW0gaTkxNV9jYWNoZV9sZXZl
bCBjYWNoZV9sZXZlbCwKLQkJICB1MzIgZmxhZ3MpCitpbnQgaTkxNV92bWFfYmluZChzdHJ1Y3Qg
aTkxNV92bWEgKnZtYSwKKwkJICBlbnVtIGk5MTVfY2FjaGVfbGV2ZWwgY2FjaGVfbGV2ZWwsCisJ
CSAgdTMyIGZsYWdzLAorCQkgIHN0cnVjdCBpOTE1X3ZtYV93b3JrICp3b3JrKQogewogCXUzMiBi
aW5kX2ZsYWdzOwogCXUzMiB2bWFfZmxhZ3M7CkBAIC0zMTUsMTEgKzM1OSw4IEBAIGludCBpOTE1
X3ZtYV9iaW5kKHN0cnVjdCBpOTE1X3ZtYSAqdm1hLCBlbnVtIGk5MTVfY2FjaGVfbGV2ZWwgY2Fj
aGVfbGV2ZWwsCiAJaWYgKEdFTV9ERUJVR19XQVJOX09OKCFmbGFncykpCiAJCXJldHVybiAtRUlO
VkFMOwogCi0JYmluZF9mbGFncyA9IDA7Ci0JaWYgKGZsYWdzICYgUElOX0dMT0JBTCkKLQkJYmlu
ZF9mbGFncyB8PSBJOTE1X1ZNQV9HTE9CQUxfQklORDsKLQlpZiAoZmxhZ3MgJiBQSU5fVVNFUikK
LQkJYmluZF9mbGFncyB8PSBJOTE1X1ZNQV9MT0NBTF9CSU5EOworCWJpbmRfZmxhZ3MgPSBmbGFn
czsKKwliaW5kX2ZsYWdzICY9IEk5MTVfVk1BX0dMT0JBTF9CSU5EIHwgSTkxNV9WTUFfTE9DQUxf
QklORDsKIAogCXZtYV9mbGFncyA9IGF0b21pY19yZWFkKCZ2bWEtPmZsYWdzKTsKIAl2bWFfZmxh
Z3MgJj0gSTkxNV9WTUFfR0xPQkFMX0JJTkQgfCBJOTE1X1ZNQV9MT0NBTF9CSU5EOwpAQCAtMzMz
LDkgKzM3NCwyOSBAQCBpbnQgaTkxNV92bWFfYmluZChzdHJ1Y3QgaTkxNV92bWEgKnZtYSwgZW51
bSBpOTE1X2NhY2hlX2xldmVsIGNhY2hlX2xldmVsLAogCUdFTV9CVUdfT04oIXZtYS0+cGFnZXMp
OwogCiAJdHJhY2VfaTkxNV92bWFfYmluZCh2bWEsIGJpbmRfZmxhZ3MpOwotCXJldCA9IHZtYS0+
b3BzLT5iaW5kX3ZtYSh2bWEsIGNhY2hlX2xldmVsLCBiaW5kX2ZsYWdzKTsKLQlpZiAocmV0KQot
CQlyZXR1cm4gcmV0OworCWlmICh3b3JrICYmIChiaW5kX2ZsYWdzICYgfnZtYV9mbGFncykgJiB2
bWEtPnZtLT5iaW5kX2FsbG9jKSB7CisJCXdvcmstPnZtYSA9IHZtYTsKKwkJd29yay0+Y2FjaGVf
bGV2ZWwgPSBjYWNoZV9sZXZlbDsKKwkJd29yay0+ZmxhZ3MgPSBiaW5kX2ZsYWdzIHwgSTkxNV9W
TUFfQUxMT0M7CisKKwkJaWYgKCFpOTE1X3ZtYV90cnlsb2NrKHZtYSkpCisJCQlyZXR1cm4gLUVB
R0FJTjsKKworCQlkbWFfZmVuY2Vfd29ya19jaGFpbigmd29yay0+YmFzZSwgZG1hX3Jlc3ZfZ2V0
X2V4Y2wodm1hLT5yZXN2KSk7CisJCWRtYV9yZXN2X2FkZF9leGNsX2ZlbmNlKHZtYS0+cmVzdiwg
JndvcmstPmJhc2UuZG1hKTsKKwkJaTkxNV92bWFfdW5sb2NrKHZtYSk7CisKKwkJaTkxNV9hY3Rp
dmVfc2V0X2V4Y2x1c2l2ZSgmdm1hLT5hY3RpdmUsICZ3b3JrLT5iYXNlLmRtYSk7CisJCXdvcmst
PmJhc2UuZG1hLmVycm9yID0gMDsgLyogZW5hYmxlIHRoZSBxdWV1ZV93b3JrKCkgKi8KKworCQlp
ZiAodm1hLT5vYmopCisJCQlhdG9taWNfaW5jKCZ2bWEtPm9iai0+bW0ucGFnZXNfcGluX2NvdW50
KTsKKwl9IGVsc2UgeworCQlHRU1fQlVHX09OKChiaW5kX2ZsYWdzICYgfnZtYV9mbGFncykgJiB2
bWEtPnZtLT5iaW5kX2FsbG9jKTsKKwkJcmV0ID0gdm1hLT5vcHMtPmJpbmRfdm1hKHZtYSwgY2Fj
aGVfbGV2ZWwsIGJpbmRfZmxhZ3MpOworCQlpZiAocmV0KQorCQkJcmV0dXJuIHJldDsKKwl9CiAK
IAlhdG9taWNfb3IoYmluZF9mbGFncywgJnZtYS0+ZmxhZ3MpOwogCXJldHVybiAwOwpAQCAtMzQ4
LDkgKzQwOSw3IEBAIHZvaWQgX19pb21lbSAqaTkxNV92bWFfcGluX2lvbWFwKHN0cnVjdCBpOTE1
X3ZtYSAqdm1hKQogCiAJLyogQWNjZXNzIHRocm91Z2ggdGhlIEdUVCByZXF1aXJlcyB0aGUgZGV2
aWNlIHRvIGJlIGF3YWtlLiAqLwogCWFzc2VydF9ycG1fd2FrZWxvY2tfaGVsZCgmdm1hLT52bS0+
aTkxNS0+cnVudGltZV9wbSk7Ci0KLQlsb2NrZGVwX2Fzc2VydF9oZWxkKCZ2bWEtPnZtLT5pOTE1
LT5kcm0uc3RydWN0X211dGV4KTsKLQlpZiAoV0FSTl9PTighaTkxNV92bWFfaXNfbWFwX2FuZF9m
ZW5jZWFibGUodm1hKSkpIHsKKwlpZiAoR0VNX1dBUk5fT04oIWk5MTVfdm1hX2lzX21hcF9hbmRf
ZmVuY2VhYmxlKHZtYSkpKSB7CiAJCWVyciA9IC1FTk9ERVY7CiAJCWdvdG8gZXJyOwogCX0KQEAg
LTM2OCw3ICs0MjcsOCBAQCB2b2lkIF9faW9tZW0gKmk5MTVfdm1hX3Bpbl9pb21hcChzdHJ1Y3Qg
aTkxNV92bWEgKnZtYSkKIAkJCWdvdG8gZXJyOwogCQl9CiAKLQkJdm1hLT5pb21hcCA9IHB0cjsK
KwkJaWYgKHVubGlrZWx5KGNtcHhjaGcoJnZtYS0+aW9tYXAsIE5VTEwsIHB0cikpKQorCQkJaW9f
bWFwcGluZ191bm1hcChwdHIpOwogCX0KIAogCV9faTkxNV92bWFfcGluKHZtYSk7CkBAIC0zODgs
MTggKzQ0OCwxMiBAQCB2b2lkIF9faW9tZW0gKmk5MTVfdm1hX3Bpbl9pb21hcChzdHJ1Y3QgaTkx
NV92bWEgKnZtYSkKIAogdm9pZCBpOTE1X3ZtYV9mbHVzaF93cml0ZXMoc3RydWN0IGk5MTVfdm1h
ICp2bWEpCiB7Ci0JaWYgKCFpOTE1X3ZtYV9oYXNfZ2d0dF93cml0ZSh2bWEpKQotCQlyZXR1cm47
Ci0KLQlpbnRlbF9ndF9mbHVzaF9nZ3R0X3dyaXRlcyh2bWEtPnZtLT5ndCk7Ci0KLQlpOTE1X3Zt
YV91bnNldF9nZ3R0X3dyaXRlKHZtYSk7CisJaWYgKGk5MTVfdm1hX3Vuc2V0X2dndHRfd3JpdGUo
dm1hKSkKKwkJaW50ZWxfZ3RfZmx1c2hfZ2d0dF93cml0ZXModm1hLT52bS0+Z3QpOwogfQogCiB2
b2lkIGk5MTVfdm1hX3VucGluX2lvbWFwKHN0cnVjdCBpOTE1X3ZtYSAqdm1hKQogewotCWxvY2tk
ZXBfYXNzZXJ0X2hlbGQoJnZtYS0+dm0tPmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwotCiAJR0VN
X0JVR19PTih2bWEtPmlvbWFwID09IE5VTEwpOwogCiAJaTkxNV92bWFfZmx1c2hfd3JpdGVzKHZt
YSk7CkBAIC01MzgsNyArNTkyLDYgQEAgc3RhdGljIHZvaWQgYXNzZXJ0X2JpbmRfY291bnQoY29u
c3Qgc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iaikKIHN0YXRpYyBpbnQKIGk5MTVfdm1h
X2luc2VydChzdHJ1Y3QgaTkxNV92bWEgKnZtYSwgdTY0IHNpemUsIHU2NCBhbGlnbm1lbnQsIHU2
NCBmbGFncykKIHsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB2bWEtPnZt
LT5pOTE1OwogCXVuc2lnbmVkIGludCBjYWNoZV9sZXZlbDsKIAl1NjQgc3RhcnQsIGVuZDsKIAlp
bnQgcmV0OwpAQCAtNTY0LDcgKzYxNyw3IEBAIGk5MTVfdm1hX2luc2VydChzdHJ1Y3QgaTkxNV92
bWEgKnZtYSwgdTY0IHNpemUsIHU2NCBhbGlnbm1lbnQsIHU2NCBmbGFncykKIAogCWVuZCA9IHZt
YS0+dm0tPnRvdGFsOwogCWlmIChmbGFncyAmIFBJTl9NQVBQQUJMRSkKLQkJZW5kID0gbWluX3Qo
dTY0LCBlbmQsIGRldl9wcml2LT5nZ3R0Lm1hcHBhYmxlX2VuZCk7CisJCWVuZCA9IG1pbl90KHU2
NCwgZW5kLCBpOTE1X3ZtX3RvX2dndHQodm1hLT52bSktPm1hcHBhYmxlX2VuZCk7CiAJaWYgKGZs
YWdzICYgUElOX1pPTkVfNEcpCiAJCWVuZCA9IG1pbl90KHU2NCwgZW5kLCAoMVVMTCA8PCAzMikg
LSBJOTE1X0dUVF9QQUdFX1NJWkUpOwogCUdFTV9CVUdfT04oIUlTX0FMSUdORUQoZW5kLCBJOTE1
X0dUVF9QQUdFX1NJWkUpKTsKQEAgLTU4MCwzNSArNjMzLDIxIEBAIGk5MTVfdm1hX2luc2VydChz
dHJ1Y3QgaTkxNV92bWEgKnZtYSwgdTY0IHNpemUsIHU2NCBhbGlnbm1lbnQsIHU2NCBmbGFncykK
IAkJcmV0dXJuIC1FTk9TUEM7CiAJfQogCi0JaWYgKHZtYS0+b2JqKSB7Ci0JCXJldCA9IGk5MTVf
Z2VtX29iamVjdF9waW5fcGFnZXModm1hLT5vYmopOwotCQlpZiAocmV0KQotCQkJcmV0dXJuIHJl
dDsKLQorCWNhY2hlX2xldmVsID0gMDsKKwlpZiAodm1hLT5vYmopCiAJCWNhY2hlX2xldmVsID0g
dm1hLT5vYmotPmNhY2hlX2xldmVsOwotCX0gZWxzZSB7Ci0JCWNhY2hlX2xldmVsID0gMDsKLQl9
Ci0KLQlHRU1fQlVHX09OKHZtYS0+cGFnZXMpOwotCi0JcmV0ID0gdm1hLT5vcHMtPnNldF9wYWdl
cyh2bWEpOwotCWlmIChyZXQpCi0JCWdvdG8gZXJyX3VucGluOwogCiAJaWYgKGZsYWdzICYgUElO
X09GRlNFVF9GSVhFRCkgewogCQl1NjQgb2Zmc2V0ID0gZmxhZ3MgJiBQSU5fT0ZGU0VUX01BU0s7
CiAJCWlmICghSVNfQUxJR05FRChvZmZzZXQsIGFsaWdubWVudCkgfHwKLQkJICAgIHJhbmdlX292
ZXJmbG93cyhvZmZzZXQsIHNpemUsIGVuZCkpIHsKLQkJCXJldCA9IC1FSU5WQUw7Ci0JCQlnb3Rv
IGVycl9jbGVhcjsKLQkJfQorCQkgICAgcmFuZ2Vfb3ZlcmZsb3dzKG9mZnNldCwgc2l6ZSwgZW5k
KSkKKwkJCXJldHVybiAtRUlOVkFMOwogCiAJCXJldCA9IGk5MTVfZ2VtX2d0dF9yZXNlcnZlKHZt
YS0+dm0sICZ2bWEtPm5vZGUsCiAJCQkJCSAgIHNpemUsIG9mZnNldCwgY2FjaGVfbGV2ZWwsCiAJ
CQkJCSAgIGZsYWdzKTsKIAkJaWYgKHJldCkKLQkJCWdvdG8gZXJyX2NsZWFyOworCQkJcmV0dXJu
IHJldDsKIAl9IGVsc2UgewogCQkvKgogCQkgKiBXZSBvbmx5IHN1cHBvcnQgaHVnZSBndHQgcGFn
ZXMgdGhyb3VnaCB0aGUgNDhiIFBQR1RULApAQCAtNjQ3LDcgKzY4Niw3IEBAIGk5MTVfdm1hX2lu
c2VydChzdHJ1Y3QgaTkxNV92bWEgKnZtYSwgdTY0IHNpemUsIHU2NCBhbGlnbm1lbnQsIHU2NCBm
bGFncykKIAkJCQkJICBzaXplLCBhbGlnbm1lbnQsIGNhY2hlX2xldmVsLAogCQkJCQkgIHN0YXJ0
LCBlbmQsIGZsYWdzKTsKIAkJaWYgKHJldCkKLQkJCWdvdG8gZXJyX2NsZWFyOworCQkJcmV0dXJu
IHJldDsKIAogCQlHRU1fQlVHX09OKHZtYS0+bm9kZS5zdGFydCA8IHN0YXJ0KTsKIAkJR0VNX0JV
R19PTih2bWEtPm5vZGUuc3RhcnQgKyB2bWEtPm5vZGUuc2l6ZSA+IGVuZCk7CkBAIC02NTUsMjMg
KzY5NCwxNSBAQCBpOTE1X3ZtYV9pbnNlcnQoc3RydWN0IGk5MTVfdm1hICp2bWEsIHU2NCBzaXpl
LCB1NjQgYWxpZ25tZW50LCB1NjQgZmxhZ3MpCiAJR0VNX0JVR19PTighZHJtX21tX25vZGVfYWxs
b2NhdGVkKCZ2bWEtPm5vZGUpKTsKIAlHRU1fQlVHX09OKCFpOTE1X2dlbV92YWxpZF9ndHRfc3Bh
Y2Uodm1hLCBjYWNoZV9sZXZlbCkpOwogCi0JbXV0ZXhfbG9jaygmdm1hLT52bS0+bXV0ZXgpOwog
CWxpc3RfYWRkX3RhaWwoJnZtYS0+dm1fbGluaywgJnZtYS0+dm0tPmJvdW5kX2xpc3QpOwotCW11
dGV4X3VubG9jaygmdm1hLT52bS0+bXV0ZXgpOwogCiAJaWYgKHZtYS0+b2JqKSB7CisJCWF0b21p
Y19pbmMoJnZtYS0+b2JqLT5tbS5wYWdlc19waW5fY291bnQpOwogCQlhdG9taWNfaW5jKCZ2bWEt
Pm9iai0+YmluZF9jb3VudCk7CiAJCWFzc2VydF9iaW5kX2NvdW50KHZtYS0+b2JqKTsKIAl9CiAK
IAlyZXR1cm4gMDsKLQotZXJyX2NsZWFyOgotCXZtYS0+b3BzLT5jbGVhcl9wYWdlcyh2bWEpOwot
ZXJyX3VucGluOgotCWlmICh2bWEtPm9iaikKLQkJaTkxNV9nZW1fb2JqZWN0X3VucGluX3BhZ2Vz
KHZtYS0+b2JqKTsKLQlyZXR1cm4gcmV0OwogfQogCiBzdGF0aWMgdm9pZApAQCAtNjgwLDEyICs3
MTEsOCBAQCBpOTE1X3ZtYV9yZW1vdmUoc3RydWN0IGk5MTVfdm1hICp2bWEpCiAJR0VNX0JVR19P
TighZHJtX21tX25vZGVfYWxsb2NhdGVkKCZ2bWEtPm5vZGUpKTsKIAlHRU1fQlVHX09OKGk5MTVf
dm1hX2lzX2JvdW5kKHZtYSwgSTkxNV9WTUFfR0xPQkFMX0JJTkQgfCBJOTE1X1ZNQV9MT0NBTF9C
SU5EKSk7CiAKLQl2bWEtPm9wcy0+Y2xlYXJfcGFnZXModm1hKTsKLQotCW11dGV4X2xvY2soJnZt
YS0+dm0tPm11dGV4KTsKIAlkcm1fbW1fcmVtb3ZlX25vZGUoJnZtYS0+bm9kZSk7CiAJbGlzdF9k
ZWwoJnZtYS0+dm1fbGluayk7Ci0JbXV0ZXhfdW5sb2NrKCZ2bWEtPnZtLT5tdXRleCk7CiAKIAkv
KgogCSAqIFNpbmNlIHRoZSB1bmJvdW5kIGxpc3QgaXMgZ2xvYmFsLCBvbmx5IG1vdmUgdG8gdGhh
dCBsaXN0IGlmCkBAIC03MDYsNDkgKzczMywxMTEgQEAgaTkxNV92bWFfcmVtb3ZlKHN0cnVjdCBp
OTE1X3ZtYSAqdm1hKQogCX0KIH0KIAotaW50IF9faTkxNV92bWFfZG9fcGluKHN0cnVjdCBpOTE1
X3ZtYSAqdm1hLAotCQkgICAgICB1NjQgc2l6ZSwgdTY0IGFsaWdubWVudCwgdTY0IGZsYWdzKQor
aW50IGk5MTVfdm1hX3BpbihzdHJ1Y3QgaTkxNV92bWEgKnZtYSwgdTY0IHNpemUsIHU2NCBhbGln
bm1lbnQsIHU2NCBmbGFncykKIHsKLQljb25zdCB1bnNpZ25lZCBpbnQgYm91bmQgPSBhdG9taWNf
cmVhZCgmdm1hLT5mbGFncyk7Ci0JaW50IHJldDsKKwlzdHJ1Y3QgaTkxNV92bWFfd29yayAqd29y
ayA9IE5VTEw7CisJYm9vbCBpbnNlcnQgPSBmYWxzZTsKKwl1bnNpZ25lZCBpbnQgYm91bmQ7CisJ
aW50IGVycjsKKworCUJVSUxEX0JVR19PTihQSU5fTUJaICE9IEk5MTVfVk1BX1BJTl9PVkVSRkxP
Vyk7CisJQlVJTERfQlVHX09OKFBJTl9HTE9CQUwgIT0gSTkxNV9WTUFfR0xPQkFMX0JJTkQpOwor
CUJVSUxEX0JVR19PTihQSU5fVVNFUiAhPSBJOTE1X1ZNQV9MT0NBTF9CSU5EKTsKKworCUdFTV9C
VUdfT04oZmxhZ3MgJiBJOTE1X1ZNQV9QSU5fT1ZFUkZMT1cpOworCUdFTV9CVUdfT04oZmxhZ3Mg
JiBJOTE1X1ZNQV9FUlJPUik7CisKKwlib3VuZCA9IGF0b21pY19pbmNfcmV0dXJuKCZ2bWEtPmZs
YWdzKTsKKwlpZiAobGlrZWx5KCgoYm91bmQgXiBmbGFncykgJiBJOTE1X1ZNQV9CSU5EX01BU0sp
ID09IDApKSB7CisJCUdFTV9CVUdfT04oIWRybV9tbV9ub2RlX2FsbG9jYXRlZCgmdm1hLT5ub2Rl
KSk7CisJCUdFTV9CVUdfT04oaTkxNV92bWFfbWlzcGxhY2VkKHZtYSwgc2l6ZSwgYWxpZ25tZW50
LCBmbGFncykpOworCQlyZXR1cm4gMDsKKwl9CiAKLQlsb2NrZGVwX2Fzc2VydF9oZWxkKCZ2bWEt
PnZtLT5pOTE1LT5kcm0uc3RydWN0X211dGV4KTsKLQlHRU1fQlVHX09OKChmbGFncyAmIChQSU5f
R0xPQkFMIHwgUElOX1VTRVIpKSA9PSAwKTsKLQlHRU1fQlVHX09OKChmbGFncyAmIFBJTl9HTE9C
QUwpICYmICFpOTE1X3ZtYV9pc19nZ3R0KHZtYSkpOworCWlmIChib3VuZCAmIEk5MTVfVk1BX0VS
Uk9SKSB7CisJCWVyciA9IC1FTk9NRU07CisJCWdvdG8gZXJyX3VucGluOworCX0KIAogCWlmIChX
QVJOX09OKGJvdW5kICYgSTkxNV9WTUFfUElOX09WRVJGTE9XKSkgewotCQlyZXQgPSAtRUJVU1k7
CisJCWVyciA9IC1FTk9NRU07CiAJCWdvdG8gZXJyX3VucGluOwogCX0KIAotCWlmICgoYm91bmQg
JiBJOTE1X1ZNQV9CSU5EX01BU0spID09IDApIHsKLQkJcmV0ID0gaTkxNV92bWFfaW5zZXJ0KHZt
YSwgc2l6ZSwgYWxpZ25tZW50LCBmbGFncyk7Ci0JCWlmIChyZXQpCi0JCQlnb3RvIGVycl91bnBp
bjsKKwlpZiAodm1hLT5vYmopIHsKKwkJZXJyID0gaTkxNV9nZW1fb2JqZWN0X3Bpbl9wYWdlcyh2
bWEtPm9iaik7CisJCWlmIChlcnIpCisJCQlyZXR1cm4gZXJyOwogCX0KLQlHRU1fQlVHX09OKCFk
cm1fbW1fbm9kZV9hbGxvY2F0ZWQoJnZtYS0+bm9kZSkpOwogCi0JcmV0ID0gaTkxNV92bWFfYmlu
ZCh2bWEsIHZtYS0+b2JqID8gdm1hLT5vYmotPmNhY2hlX2xldmVsIDogMCwgZmxhZ3MpOwotCWlm
IChyZXQpCi0JCWdvdG8gZXJyX3JlbW92ZTsKKwlpZiAoIXZtYS0+cGFnZXMpIHsKKwkJR0VNX0JV
R19PTih2bWEtPnBhZ2VzKTsKKwkJZXJyID0gdm1hLT5vcHMtPnNldF9wYWdlcyh2bWEpOworCQlp
ZiAoZXJyKQorCQkJZ290byBlcnJfcGFnZXM7CisKKwkJR0VNX0JVR19PTighdm1hLT5wYWdlcyk7
CisJCWluc2VydCA9IHRydWU7CisJfQorCisJaWYgKGZsYWdzICYgUElOX1VTRVIpIHsKKwkJd29y
ayA9IGk5MTVfdm1hX3dvcmsoKTsKKwkJaWYgKCF3b3JrKSB7CisJCQllcnIgPSAtRU5PTUVNOwor
CQkJZ290byBlcnJfY2xlYXI7CisJCX0KKwl9CiAKLQlHRU1fQlVHX09OKCFpOTE1X3ZtYV9pc19i
b3VuZCh2bWEsIEk5MTVfVk1BX0JJTkRfTUFTSykpOworCWVyciA9IGk5MTVfYWN0aXZlX2FjcXVp
cmUoJnZtYS0+YWN0aXZlKTsKKwlpZiAoZXJyKQorCQlnb3RvIGVycl9mZW5jZTsKIAotCWlmICgo
Ym91bmQgXiBhdG9taWNfcmVhZCgmdm1hLT5mbGFncykpICYgSTkxNV9WTUFfR0xPQkFMX0JJTkQp
Ci0JCV9faTkxNV92bWFfc2V0X21hcF9hbmRfZmVuY2VhYmxlKHZtYSk7CisJZXJyID0gbXV0ZXhf
bG9ja19pbnRlcnJ1cHRpYmxlKCZ2bWEtPnZtLT5tdXRleCk7CisJaWYgKGVycikKKwkJZ290byBl
cnJfYWN0aXZlOwogCi0JR0VNX0JVR19PTihpOTE1X3ZtYV9taXNwbGFjZWQodm1hLCBzaXplLCBh
bGlnbm1lbnQsIGZsYWdzKSk7Ci0JcmV0dXJuIDA7CisJaWYgKGluc2VydCkgeworCQllcnIgPSBp
OTE1X3ZtYV9pbnNlcnQodm1hLCBzaXplLCBhbGlnbm1lbnQsIGZsYWdzKTsKKwkJaWYgKGVycikK
KwkJCWdvdG8gZXJyX3VubG9jazsKKwl9CisKKwllcnIgPSBpOTE1X3ZtYV9iaW5kKHZtYSwKKwkJ
CSAgICB2bWEtPm9iaiA/IHZtYS0+b2JqLT5jYWNoZV9sZXZlbCA6IDAsCisJCQkgICAgZmxhZ3Ms
IHdvcmspOworCWlmIChlcnIgPT0gMCkgeworCQlHRU1fQlVHX09OKCFpOTE1X3ZtYV9pc19ib3Vu
ZCh2bWEsIEk5MTVfVk1BX0JJTkRfTUFTSykpOwogCi1lcnJfcmVtb3ZlOgotCWlmICgoYm91bmQg
JiBJOTE1X1ZNQV9CSU5EX01BU0spID09IDApIHsKLQkJaTkxNV92bWFfcmVtb3ZlKHZtYSk7CisJ
CWlmICgoYm91bmQgXiBhdG9taWNfcmVhZCgmdm1hLT5mbGFncykpICYgSTkxNV9WTUFfR0xPQkFM
X0JJTkQpCisJCQlfX2k5MTVfdm1hX3NldF9tYXBfYW5kX2ZlbmNlYWJsZSh2bWEpOworCisJCUdF
TV9CVUdfT04oaTkxNV92bWFfbWlzcGxhY2VkKHZtYSwgc2l6ZSwgYWxpZ25tZW50LCBmbGFncykp
OworCisJCV9faTkxNV92bWFfcGluKHZtYSk7CisJfSBlbHNlIHsKKwkJaWYgKGluc2VydCkKKwkJ
CWk5MTVfdm1hX3JlbW92ZSh2bWEpOworCX0KKworZXJyX3VubG9jazoKKwltdXRleF91bmxvY2so
JnZtYS0+dm0tPm11dGV4KTsKK2Vycl9hY3RpdmU6CisJaTkxNV9hY3RpdmVfcmVsZWFzZSgmdm1h
LT5hY3RpdmUpOworZXJyX2ZlbmNlOgorCWlmICh3b3JrKQorCQlkbWFfZmVuY2Vfd29ya19jb21t
aXQoJndvcmstPmJhc2UpOworZXJyX2NsZWFyOgorCWlmIChlcnIgJiYgaW5zZXJ0KSB7CisJCXZt
YS0+b3BzLT5jbGVhcl9wYWdlcyh2bWEpOwogCQlHRU1fQlVHX09OKHZtYS0+cGFnZXMpOwogCQlH
RU1fQlVHX09OKGF0b21pY19yZWFkKCZ2bWEtPmZsYWdzKSAmIEk5MTVfVk1BX0JJTkRfTUFTSyk7
CiAJfQorZXJyX3BhZ2VzOgorCWlmICh2bWEtPm9iaikKKwkJaTkxNV9nZW1fb2JqZWN0X3VucGlu
X3BhZ2VzKHZtYS0+b2JqKTsKIGVycl91bnBpbjoKIAlfX2k5MTVfdm1hX3VucGluKHZtYSk7Ci0J
cmV0dXJuIHJldDsKKwlyZXR1cm4gZXJyOwogfQogCiB2b2lkIGk5MTVfdm1hX2Nsb3NlKHN0cnVj
dCBpOTE1X3ZtYSAqdm1hKQpAQCAtNzkyLDEwICs4ODEsMTggQEAgdm9pZCBpOTE1X3ZtYV9yZW9w
ZW4oc3RydWN0IGk5MTVfdm1hICp2bWEpCiAJX19pOTE1X3ZtYV9yZW1vdmVfY2xvc2VkKHZtYSk7
CiB9CiAKLXN0YXRpYyB2b2lkIF9faTkxNV92bWFfZGVzdHJveShzdHJ1Y3QgaTkxNV92bWEgKnZt
YSkKK3ZvaWQgaTkxNV92bWFfZGVzdHJveShzdHJ1Y3QgaTkxNV92bWEgKnZtYSkKIHsKLQlHRU1f
QlVHX09OKHZtYS0+bm9kZS5hbGxvY2F0ZWQpOwotCUdFTV9CVUdfT04odm1hLT5mZW5jZSk7CisJ
X19pOTE1X3ZtYV9yZW1vdmVfY2xvc2VkKHZtYSk7CisKKwlpZiAoZHJtX21tX25vZGVfYWxsb2Nh
dGVkKCZ2bWEtPm5vZGUpKSB7CisJCW11dGV4X2xvY2soJnZtYS0+dm0tPm11dGV4KTsKKwkJYXRv
bWljX2FuZCh+STkxNV9WTUFfUElOX01BU0ssICZ2bWEtPmZsYWdzKTsKKwkJV0FSTl9PTihpOTE1
X3ZtYV91bmJpbmQodm1hKSk7CisJCW11dGV4X3VubG9jaygmdm1hLT52bS0+bXV0ZXgpOworCQlH
RU1fQlVHX09OKGRybV9tbV9ub2RlX2FsbG9jYXRlZCgmdm1hLT5ub2RlKSk7CisJfQorCUdFTV9C
VUdfT04oaTkxNV92bWFfaXNfYWN0aXZlKHZtYSkpOwogCiAJaWYgKHZtYS0+b2JqKSB7CiAJCXN0
cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmogPSB2bWEtPm9iajsKQEAgLTgwNiwzNiArOTAz
LDM2IEBAIHN0YXRpYyB2b2lkIF9faTkxNV92bWFfZGVzdHJveShzdHJ1Y3QgaTkxNV92bWEgKnZt
YSkKIAkJc3Bpbl91bmxvY2soJm9iai0+dm1hLmxvY2spOwogCX0KIAotCWk5MTVfYWN0aXZlX2Zp
bmkoJnZtYS0+YWN0aXZlKTsKKwlpOTE1X3ZtX3B1dCh2bWEtPnZtKTsKIAorCWk5MTVfYWN0aXZl
X2ZpbmkoJnZtYS0+YWN0aXZlKTsKIAlpOTE1X3ZtYV9mcmVlKHZtYSk7CiB9CiAKLXZvaWQgaTkx
NV92bWFfZGVzdHJveShzdHJ1Y3QgaTkxNV92bWEgKnZtYSkKLXsKLQlsb2NrZGVwX2Fzc2VydF9o
ZWxkKCZ2bWEtPnZtLT5pOTE1LT5kcm0uc3RydWN0X211dGV4KTsKLQotCUdFTV9CVUdfT04oaTkx
NV92bWFfaXNfcGlubmVkKHZtYSkpOwotCi0JX19pOTE1X3ZtYV9yZW1vdmVfY2xvc2VkKHZtYSk7
Ci0KLQlXQVJOX09OKGk5MTVfdm1hX3VuYmluZCh2bWEpKTsKLQlHRU1fQlVHX09OKGk5MTVfdm1h
X2lzX2FjdGl2ZSh2bWEpKTsKLQotCV9faTkxNV92bWFfZGVzdHJveSh2bWEpOwotfQotCiB2b2lk
IGk5MTVfdm1hX3BhcmtlZChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkKIHsKIAlzdHJ1
Y3QgaTkxNV92bWEgKnZtYSwgKm5leHQ7CiAKIAlzcGluX2xvY2tfaXJxKCZpOTE1LT5ndC5jbG9z
ZWRfbG9jayk7CiAJbGlzdF9mb3JfZWFjaF9lbnRyeV9zYWZlKHZtYSwgbmV4dCwgJmk5MTUtPmd0
LmNsb3NlZF92bWEsIGNsb3NlZF9saW5rKSB7CisJCXN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0
ICpvYmogPSB2bWEtPm9iajsKKwkJc3RydWN0IGk5MTVfYWRkcmVzc19zcGFjZSAqdm0gPSB2bWEt
PnZtOworCiAJCWxpc3RfZGVsX2luaXQoJnZtYS0+Y2xvc2VkX2xpbmspOworCQlpZiAoIWk5MTVf
dm1fdHJ5b3Blbih2bSkpCisJCQljb250aW51ZTsKKworCQlpZiAoIWtyZWZfZ2V0X3VubGVzc196
ZXJvKCZvYmotPmJhc2UucmVmY291bnQpKQorCQkJb2JqID0gTlVMTDsKKwogCQlzcGluX3VubG9j
a19pcnEoJmk5MTUtPmd0LmNsb3NlZF9sb2NrKTsKIAotCQlpOTE1X3ZtYV9kZXN0cm95KHZtYSk7
CisJCWlmIChvYmopIHsKKwkJCWk5MTVfdm1hX2Rlc3Ryb3kodm1hKTsKKwkJCWk5MTVfZ2VtX29i
amVjdF9wdXQob2JqKTsKKwkJfQogCisJCWk5MTVfdm1fY2xvc2Uodm0pOwogCQlzcGluX2xvY2tf
aXJxKCZpOTE1LT5ndC5jbG9zZWRfbG9jayk7CiAJfQogCXNwaW5fdW5sb2NrX2lycSgmaTkxNS0+
Z3QuY2xvc2VkX2xvY2spOwpAQCAtOTI3LDM0ICsxMDI0LDE1IEBAIGludCBpOTE1X3ZtYV91bmJp
bmQoc3RydWN0IGk5MTVfdm1hICp2bWEpCiB7CiAJaW50IHJldDsKIAotCWxvY2tkZXBfYXNzZXJ0
X2hlbGQoJnZtYS0+dm0tPmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOworCWxvY2tkZXBfYXNzZXJ0
X2hlbGQoJnZtYS0+dm0tPm11dGV4KTsKIAogCS8qCiAJICogRmlyc3Qgd2FpdCB1cG9uIGFueSBh
Y3Rpdml0eSBhcyByZXRpcmluZyB0aGUgcmVxdWVzdCBtYXkKIAkgKiBoYXZlIHNpZGUtZWZmZWN0
cyBzdWNoIGFzIHVucGlubmluZyBvciBldmVuIHVuYmluZGluZyB0aGlzIHZtYS4KIAkgKi8KLQlt
aWdodF9zbGVlcCgpOwotCWlmIChpOTE1X3ZtYV9pc19hY3RpdmUodm1hKSkgewotCQkvKgotCQkg
KiBXaGVuIGEgY2xvc2VkIFZNQSBpcyByZXRpcmVkLCBpdCBpcyB1bmJvdW5kIC0gZWVrLgotCQkg
KiBJbiBvcmRlciB0byBwcmV2ZW50IGl0IGZyb20gYmVpbmcgcmVjdXJzaXZlbHkgY2xvc2VkLAot
CQkgKiB0YWtlIGEgcGluIG9uIHRoZSB2bWEgc28gdGhhdCB0aGUgc2Vjb25kIHVuYmluZCBpcwot
CQkgKiBhYm9ydGVkLgotCQkgKgotCQkgKiBFdmVuIG1vcmUgc2NhcnkgaXMgdGhhdCB0aGUgcmV0
aXJlIGNhbGxiYWNrIG1heSBmcmVlCi0JCSAqIHRoZSBvYmplY3QgKGxhc3QgYWN0aXZlIHZtYSku
IFRvIHByZXZlbnQgdGhlIGV4cGxvc2lvbgotCQkgKiB3ZSBkZWZlciB0aGUgYWN0dWFsIG9iamVj
dCBmcmVlIHRvIGEgd29ya2VyIHRoYXQgY2FuCi0JCSAqIG9ubHkgcHJvY2VlZCBvbmNlIGl0IGFj
cXVpcmVzIHRoZSBzdHJ1Y3RfbXV0ZXggKHdoaWNoCi0JCSAqIHdlIGN1cnJlbnRseSBob2xkLCB0
aGVyZWZvcmUgaXQgY2Fubm90IGZyZWUgdGhpcyBvYmplY3QKLQkJICogYmVmb3JlIHdlIGFyZSBm
aW5pc2hlZCkuCi0JCSAqLwotCQlfX2k5MTVfdm1hX3Bpbih2bWEpOwotCQlyZXQgPSBpOTE1X2Fj
dGl2ZV93YWl0KCZ2bWEtPmFjdGl2ZSk7Ci0JCV9faTkxNV92bWFfdW5waW4odm1hKTsKLQkJaWYg
KHJldCkKLQkJCXJldHVybiByZXQ7Ci0JfQotCUdFTV9CVUdfT04oaTkxNV92bWFfaXNfYWN0aXZl
KHZtYSkpOworCXJldCA9IGk5MTVfYWN0aXZlX3dhaXQoJnZtYS0+YWN0aXZlKTsKKwlpZiAocmV0
KQorCQlyZXR1cm4gcmV0OwogCiAJaWYgKGk5MTVfdm1hX2lzX3Bpbm5lZCh2bWEpKSB7CiAJCXZt
YV9wcmludF9hbGxvY2F0b3Iodm1hLCAiaXMgcGlubmVkIik7CkBAIC05NzUsMTYgKzEwNTMsMTIg
QEAgaW50IGk5MTVfdm1hX3VuYmluZChzdHJ1Y3QgaTkxNV92bWEgKnZtYSkKIAkJR0VNX0JVR19P
TihpOTE1X3ZtYV9oYXNfZ2d0dF93cml0ZSh2bWEpKTsKIAogCQkvKiByZWxlYXNlIHRoZSBmZW5j
ZSByZWcgX2FmdGVyXyBmbHVzaGluZyAqLwotCQltdXRleF9sb2NrKCZ2bWEtPnZtLT5tdXRleCk7
CiAJCXJldCA9IGk5MTVfdm1hX3Jldm9rZV9mZW5jZSh2bWEpOwotCQltdXRleF91bmxvY2soJnZt
YS0+dm0tPm11dGV4KTsKIAkJaWYgKHJldCkKIAkJCXJldHVybiByZXQ7CiAKIAkJLyogRm9yY2Ug
YSBwYWdlZmF1bHQgZm9yIGRvbWFpbiB0cmFja2luZyBvbiBuZXh0IHVzZXIgYWNjZXNzICovCi0J
CW11dGV4X2xvY2soJnZtYS0+dm0tPm11dGV4KTsKIAkJaTkxNV92bWFfcmV2b2tlX21tYXAodm1h
KTsKLQkJbXV0ZXhfdW5sb2NrKCZ2bWEtPnZtLT5tdXRleCk7CiAKIAkJX19pOTE1X3ZtYV9pb3Vu
bWFwKHZtYSk7CiAJCWNsZWFyX2JpdChJOTE1X1ZNQV9DQU5fRkVOQ0VfQklULCBfX2k5MTVfdm1h
X2ZsYWdzKHZtYSkpOwpAQCAtOTkyLDEzICsxMDY2LDE0IEBAIGludCBpOTE1X3ZtYV91bmJpbmQo
c3RydWN0IGk5MTVfdm1hICp2bWEpCiAJR0VNX0JVR19PTih2bWEtPmZlbmNlKTsKIAlHRU1fQlVH
X09OKGk5MTVfdm1hX2hhc191c2VyZmF1bHQodm1hKSk7CiAKLQlpZiAobGlrZWx5KCF2bWEtPnZt
LT5jbG9zZWQpKSB7CisJaWYgKGxpa2VseShhdG9taWNfcmVhZCgmdm1hLT52bS0+b3BlbikpKSB7
CiAJCXRyYWNlX2k5MTVfdm1hX3VuYmluZCh2bWEpOwogCQl2bWEtPm9wcy0+dW5iaW5kX3ZtYSh2
bWEpOwogCX0KIAlhdG9taWNfYW5kKH5JOTE1X1ZNQV9CSU5EX01BU0ssICZ2bWEtPmZsYWdzKTsK
IAogCWk5MTVfdm1hX3JlbW92ZSh2bWEpOworCXZtYS0+b3BzLT5jbGVhcl9wYWdlcyh2bWEpOwog
CiAJcmV0dXJuIDA7CiB9CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3Zt
YS5oIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV92bWEuaAppbmRleCAzOGM2ZjM0MjdlOGMu
LmM4Y2NmODUzNmE4MiAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV92bWEu
aAorKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3ZtYS5oCkBAIC03Myw2ICs3Myw3IEBA
IHN0cnVjdCBpOTE1X3ZtYSB7CiAJICovCiAJYXRvbWljX3Qgb3Blbl9jb3VudDsKIAlhdG9taWNf
dCBmbGFnczsKKwogCS8qKgogCSAqIEhvdyBtYW55IHVzZXJzIGhhdmUgcGlubmVkIHRoaXMgb2Jq
ZWN0IGluIEdUVCBzcGFjZS4KIAkgKgpAQCAtMTAzLDE4ICsxMDQsMjQgQEAgc3RydWN0IGk5MTVf
dm1hIHsKIAkvKiogRmxhZ3MgYW5kIGFkZHJlc3Mgc3BhY2UgdGhpcyBWTUEgaXMgYm91bmQgdG8g
Ki8KICNkZWZpbmUgSTkxNV9WTUFfR0xPQkFMX0JJTkRfQklUIDkKICNkZWZpbmUgSTkxNV9WTUFf
TE9DQUxfQklORF9CSVQgMTAKKyNkZWZpbmUgSTkxNV9WTUFfRVJST1JfQklUCTExCiAKICNkZWZp
bmUgSTkxNV9WTUFfR0xPQkFMX0JJTkQJKChpbnQpQklUKEk5MTVfVk1BX0dMT0JBTF9CSU5EX0JJ
VCkpCiAjZGVmaW5lIEk5MTVfVk1BX0xPQ0FMX0JJTkQJKChpbnQpQklUKEk5MTVfVk1BX0xPQ0FM
X0JJTkRfQklUKSkKKyNkZWZpbmUgSTkxNV9WTUFfRVJST1IJCSgoaW50KUJJVChJOTE1X1ZNQV9F
UlJPUl9CSVQpKQogCiAjZGVmaW5lIEk5MTVfVk1BX0JJTkRfTUFTSyAoSTkxNV9WTUFfR0xPQkFM
X0JJTkQgfCBcCiAJCQkgICAgSTkxNV9WTUFfTE9DQUxfQklORCB8IFwKKwkJCSAgICBJOTE1X1ZN
QV9FUlJPUiB8IFwKIAkJCSAgICBJOTE1X1ZNQV9QSU5fT1ZFUkZMT1cpCiAKLSNkZWZpbmUgSTkx
NV9WTUFfR0dUVF9CSVQJMTEKLSNkZWZpbmUgSTkxNV9WTUFfQ0FOX0ZFTkNFX0JJVAkxMgotI2Rl
ZmluZSBJOTE1X1ZNQV9VU0VSRkFVTFRfQklUCTEzCi0jZGVmaW5lIEk5MTVfVk1BX0dHVFRfV1JJ
VEVfQklUCTE0CisjZGVmaW5lIEk5MTVfVk1BX0FMTE9DX0JJVAkxMgorI2RlZmluZSBJOTE1X1ZN
QV9BTExPQwkJKChpbnQpQklUKEk5MTVfVk1BX0FMTE9DX0JJVCkpCisKKyNkZWZpbmUgSTkxNV9W
TUFfR0dUVF9CSVQJMTMKKyNkZWZpbmUgSTkxNV9WTUFfQ0FOX0ZFTkNFX0JJVAkxNAorI2RlZmlu
ZSBJOTE1X1ZNQV9VU0VSRkFVTFRfQklUCTE1CisjZGVmaW5lIEk5MTVfVk1BX0dHVFRfV1JJVEVf
QklUCTE2CiAKICNkZWZpbmUgSTkxNV9WTUFfR0dUVAkJKChpbnQpQklUKEk5MTVfVk1BX0dHVFRf
QklUKSkKICNkZWZpbmUgSTkxNV9WTUFfQ0FOX0ZFTkNFCSgoaW50KUJJVChJOTE1X1ZNQV9DQU5f
RkVOQ0VfQklUKSkKQEAgLTMwOCw4ICszMTUsMTIgQEAgaTkxNV92bWFfY29tcGFyZShzdHJ1Y3Qg
aTkxNV92bWEgKnZtYSwKIAlyZXR1cm4gbWVtY21wKCZ2bWEtPmdndHRfdmlldy5wYXJ0aWFsLCAm
dmlldy0+cGFydGlhbCwgdmlldy0+dHlwZSk7CiB9CiAKLWludCBpOTE1X3ZtYV9iaW5kKHN0cnVj
dCBpOTE1X3ZtYSAqdm1hLCBlbnVtIGk5MTVfY2FjaGVfbGV2ZWwgY2FjaGVfbGV2ZWwsCi0JCSAg
dTMyIGZsYWdzKTsKK3N0cnVjdCBpOTE1X3ZtYV93b3JrICppOTE1X3ZtYV93b3JrKHZvaWQpOwor
aW50IGk5MTVfdm1hX2JpbmQoc3RydWN0IGk5MTVfdm1hICp2bWEsCisJCSAgZW51bSBpOTE1X2Nh
Y2hlX2xldmVsIGNhY2hlX2xldmVsLAorCQkgIHUzMiBmbGFncywKKwkJICBzdHJ1Y3QgaTkxNV92
bWFfd29yayAqd29yayk7CisKIGJvb2wgaTkxNV9nZW1fdmFsaWRfZ3R0X3NwYWNlKHN0cnVjdCBp
OTE1X3ZtYSAqdm1hLCB1bnNpZ25lZCBsb25nIGNhY2hlX2xldmVsKTsKIGJvb2wgaTkxNV92bWFf
bWlzcGxhY2VkKGNvbnN0IHN0cnVjdCBpOTE1X3ZtYSAqdm1hLAogCQkJdTY0IHNpemUsIHU2NCBh
bGlnbm1lbnQsIHU2NCBmbGFncyk7CkBAIC0zMjgsMzIgKzMzOSwxOSBAQCBzdGF0aWMgaW5saW5l
IHZvaWQgaTkxNV92bWFfbG9jayhzdHJ1Y3QgaTkxNV92bWEgKnZtYSkKIAlkbWFfcmVzdl9sb2Nr
KHZtYS0+cmVzdiwgTlVMTCk7CiB9CiAKLXN0YXRpYyBpbmxpbmUgdm9pZCBpOTE1X3ZtYV91bmxv
Y2soc3RydWN0IGk5MTVfdm1hICp2bWEpCitzdGF0aWMgaW5saW5lIGJvb2wgaTkxNV92bWFfdHJ5
bG9jayhzdHJ1Y3QgaTkxNV92bWEgKnZtYSkKIHsKLQlkbWFfcmVzdl91bmxvY2sodm1hLT5yZXN2
KTsKKwlyZXR1cm4gZG1hX3Jlc3ZfdHJ5bG9jayh2bWEtPnJlc3YpOwogfQogCi1pbnQgX19pOTE1
X3ZtYV9kb19waW4oc3RydWN0IGk5MTVfdm1hICp2bWEsCi0JCSAgICAgIHU2NCBzaXplLCB1NjQg
YWxpZ25tZW50LCB1NjQgZmxhZ3MpOwotc3RhdGljIGlubGluZSBpbnQgX19tdXN0X2NoZWNrCi1p
OTE1X3ZtYV9waW4oc3RydWN0IGk5MTVfdm1hICp2bWEsIHU2NCBzaXplLCB1NjQgYWxpZ25tZW50
LCB1NjQgZmxhZ3MpCitzdGF0aWMgaW5saW5lIHZvaWQgaTkxNV92bWFfdW5sb2NrKHN0cnVjdCBp
OTE1X3ZtYSAqdm1hKQogewotCUJVSUxEX0JVR19PTihQSU5fTUJaICE9IEk5MTVfVk1BX1BJTl9P
VkVSRkxPVyk7Ci0JQlVJTERfQlVHX09OKFBJTl9HTE9CQUwgIT0gSTkxNV9WTUFfR0xPQkFMX0JJ
TkQpOwotCUJVSUxEX0JVR19PTihQSU5fVVNFUiAhPSBJOTE1X1ZNQV9MT0NBTF9CSU5EKTsKLQot
CS8qIFBpbiBlYXJseSB0byBwcmV2ZW50IHRoZSBzaHJpbmtlci9ldmljdGlvbiBsb2dpYyBmcm9t
IGRlc3Ryb3lpbmcKLQkgKiBvdXIgdm1hIGFzIHdlIGluc2VydCBhbmQgYmluZC4KLQkgKi8KLQlp
ZiAobGlrZWx5KCgoYXRvbWljX2luY19yZXR1cm4oJnZtYS0+ZmxhZ3MpIF4gZmxhZ3MpICYgSTkx
NV9WTUFfQklORF9NQVNLKSA9PSAwKSkgewotCQlHRU1fQlVHX09OKCFkcm1fbW1fbm9kZV9hbGxv
Y2F0ZWQoJnZtYS0+bm9kZSkpOwotCQlHRU1fQlVHX09OKGk5MTVfdm1hX21pc3BsYWNlZCh2bWEs
IHNpemUsIGFsaWdubWVudCwgZmxhZ3MpKTsKLQkJcmV0dXJuIDA7Ci0JfQotCi0JcmV0dXJuIF9f
aTkxNV92bWFfZG9fcGluKHZtYSwgc2l6ZSwgYWxpZ25tZW50LCBmbGFncyk7CisJZG1hX3Jlc3Zf
dW5sb2NrKHZtYS0+cmVzdik7CiB9CiAKK2ludCBfX211c3RfY2hlY2sKK2k5MTVfdm1hX3Bpbihz
dHJ1Y3QgaTkxNV92bWEgKnZtYSwgdTY0IHNpemUsIHU2NCBhbGlnbm1lbnQsIHU2NCBmbGFncyk7
CisKIHN0YXRpYyBpbmxpbmUgaW50IGk5MTVfdm1hX3Bpbl9jb3VudChjb25zdCBzdHJ1Y3QgaTkx
NV92bWEgKnZtYSkKIHsKIAlyZXR1cm4gYXRvbWljX3JlYWQoJnZtYS0+ZmxhZ3MpICYgSTkxNV9W
TUFfUElOX01BU0s7CkBAIC0zOTcsOCArMzk1LDYgQEAgc3RhdGljIGlubGluZSBib29sIGk5MTVf
dm1hX2lzX2JvdW5kKGNvbnN0IHN0cnVjdCBpOTE1X3ZtYSAqdm1hLAogICogdGhlIGNhbGxlciBt
dXN0IGNhbGwgaTkxNV92bWFfdW5waW5faW9tYXAgdG8gcmVsaW5xdWlzaCB0aGUgcGlubmluZwog
ICogYWZ0ZXIgdGhlIGlvbWFwcGluZyBpcyBubyBsb25nZXIgcmVxdWlyZWQuCiAgKgotICogQ2Fs
bGVycyBtdXN0IGhvbGQgdGhlIHN0cnVjdF9tdXRleC4KLSAqCiAgKiBSZXR1cm5zIGEgdmFsaWQg
aW9tYXBwZWQgcG9pbnRlciBvciBFUlJfUFRSLgogICovCiB2b2lkIF9faW9tZW0gKmk5MTVfdm1h
X3Bpbl9pb21hcChzdHJ1Y3QgaTkxNV92bWEgKnZtYSk7CkBAIC00MTAsOCArNDA2LDggQEAgdm9p
ZCBfX2lvbWVtICppOTE1X3ZtYV9waW5faW9tYXAoc3RydWN0IGk5MTVfdm1hICp2bWEpOwogICoK
ICAqIFVucGlucyB0aGUgcHJldmlvdXNseSBpb21hcHBlZCBWTUEgZnJvbSBpOTE1X3ZtYV9waW5f
aW9tYXAoKS4KICAqCi0gKiBDYWxsZXJzIG11c3QgaG9sZCB0aGUgc3RydWN0X211dGV4LiBUaGlz
IGZ1bmN0aW9uIGlzIG9ubHkgdmFsaWQgdG8gYmUKLSAqIGNhbGxlZCBvbiBhIFZNQSBwcmV2aW91
c2x5IGlvbWFwcGVkIGJ5IHRoZSBjYWxsZXIgd2l0aCBpOTE1X3ZtYV9waW5faW9tYXAoKS4KKyAq
IFRoaXMgZnVuY3Rpb24gaXMgb25seSB2YWxpZCB0byBiZSBjYWxsZWQgb24gYSBWTUEgcHJldmlv
dXNseQorICogaW9tYXBwZWQgYnkgdGhlIGNhbGxlciB3aXRoIGk5MTVfdm1hX3Bpbl9pb21hcCgp
LgogICovCiB2b2lkIGk5MTVfdm1hX3VucGluX2lvbWFwKHN0cnVjdCBpOTE1X3ZtYSAqdm1hKTsK
IApAQCAtNDM5LDYgKzQzNSw4IEBAIHN0YXRpYyBpbmxpbmUgc3RydWN0IHBhZ2UgKmk5MTVfdm1h
X2ZpcnN0X3BhZ2Uoc3RydWN0IGk5MTVfdm1hICp2bWEpCiBpbnQgX19tdXN0X2NoZWNrIGk5MTVf
dm1hX3Bpbl9mZW5jZShzdHJ1Y3QgaTkxNV92bWEgKnZtYSk7CiBpbnQgX19tdXN0X2NoZWNrIGk5
MTVfdm1hX3Jldm9rZV9mZW5jZShzdHJ1Y3QgaTkxNV92bWEgKnZtYSk7CiAKK2ludCBfX2k5MTVf
dm1hX3Bpbl9mZW5jZShzdHJ1Y3QgaTkxNV92bWEgKnZtYSk7CisKIHN0YXRpYyBpbmxpbmUgdm9p
ZCBfX2k5MTVfdm1hX3VucGluX2ZlbmNlKHN0cnVjdCBpOTE1X3ZtYSAqdm1hKQogewogCUdFTV9C
VUdfT04oYXRvbWljX3JlYWQoJnZtYS0+ZmVuY2UtPnBpbl9jb3VudCkgPD0gMCk7CkBAIC00NTYs
NyArNDU0LDYgQEAgc3RhdGljIGlubGluZSB2b2lkIF9faTkxNV92bWFfdW5waW5fZmVuY2Uoc3Ry
dWN0IGk5MTVfdm1hICp2bWEpCiBzdGF0aWMgaW5saW5lIHZvaWQKIGk5MTVfdm1hX3VucGluX2Zl
bmNlKHN0cnVjdCBpOTE1X3ZtYSAqdm1hKQogewotCS8qIGxvY2tkZXBfYXNzZXJ0X2hlbGQoJnZt
YS0+dm0tPmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOyAqLwogCWlmICh2bWEtPmZlbmNlKQogCQlf
X2k5MTVfdm1hX3VucGluX2ZlbmNlKHZtYSk7CiB9CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9k
cm0vaTkxNS9zZWxmdGVzdHMvaTkxNV9nZW1fZXZpY3QuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1
L3NlbGZ0ZXN0cy9pOTE1X2dlbV9ldmljdC5jCmluZGV4IGNiMzBjNjY5YjFiNy4uYmE2MDY0MTQ3
MTczIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMvaTkxNV9nZW1f
ZXZpY3QuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMvaTkxNV9nZW1fZXZp
Y3QuYwpAQCAtMTA2LDE0ICsxMDYsMTEgQEAgc3RhdGljIGludCBwb3B1bGF0ZV9nZ3R0KHN0cnVj
dCBkcm1faTkxNV9wcml2YXRlICppOTE1LAogCiBzdGF0aWMgdm9pZCB1bnBpbl9nZ3R0KHN0cnVj
dCBkcm1faTkxNV9wcml2YXRlICppOTE1KQogewotCXN0cnVjdCBpOTE1X2dndHQgKmdndHQgPSAm
aTkxNS0+Z2d0dDsKIAlzdHJ1Y3QgaTkxNV92bWEgKnZtYTsKIAotCW11dGV4X2xvY2soJmdndHQt
PnZtLm11dGV4KTsKIAlsaXN0X2Zvcl9lYWNoX2VudHJ5KHZtYSwgJmk5MTUtPmdndHQudm0uYm91
bmRfbGlzdCwgdm1fbGluaykKIAkJaWYgKHZtYS0+b2JqLT5tbS5xdWlya2VkKQogCQkJaTkxNV92
bWFfdW5waW4odm1hKTsKLQltdXRleF91bmxvY2soJmdndHQtPnZtLm11dGV4KTsKIH0KIAogc3Rh
dGljIHZvaWQgY2xlYW51cF9vYmplY3RzKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LApA
QCAtMTI3LDExICsxMjQsNyBAQCBzdGF0aWMgdm9pZCBjbGVhbnVwX29iamVjdHMoc3RydWN0IGRy
bV9pOTE1X3ByaXZhdGUgKmk5MTUsCiAJCWk5MTVfZ2VtX29iamVjdF9wdXQob2JqKTsKIAl9CiAK
LQltdXRleF91bmxvY2soJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwotCiAJaTkxNV9nZW1fZHJh
aW5fZnJlZWRfb2JqZWN0cyhpOTE1KTsKLQotCW11dGV4X2xvY2soJmk5MTUtPmRybS5zdHJ1Y3Rf
bXV0ZXgpOwogfQogCiBzdGF0aWMgaW50IGlndF9ldmljdF9zb21ldGhpbmcodm9pZCAqYXJnKQpA
QCAtMTQ4LDEwICsxNDEsMTIgQEAgc3RhdGljIGludCBpZ3RfZXZpY3Rfc29tZXRoaW5nKHZvaWQg
KmFyZykKIAkJZ290byBjbGVhbnVwOwogCiAJLyogRXZlcnl0aGluZyBpcyBwaW5uZWQsIG5vdGhp
bmcgc2hvdWxkIGhhcHBlbiAqLworCW11dGV4X2xvY2soJmdndHQtPnZtLm11dGV4KTsKIAllcnIg
PSBpOTE1X2dlbV9ldmljdF9zb21ldGhpbmcoJmdndHQtPnZtLAogCQkJCSAgICAgICBJOTE1X0dU
VF9QQUdFX1NJWkUsIDAsIDAsCiAJCQkJICAgICAgIDAsIFU2NF9NQVgsCiAJCQkJICAgICAgIDAp
OworCW11dGV4X3VubG9jaygmZ2d0dC0+dm0ubXV0ZXgpOwogCWlmIChlcnIgIT0gLUVOT1NQQykg
ewogCQlwcl9lcnIoImk5MTVfZ2VtX2V2aWN0X3NvbWV0aGluZyBmYWlsZWQgb24gYSBmdWxsIEdH
VFQgd2l0aCBlcnI9JWRcbiIsCiAJCSAgICAgICBlcnIpOwpAQCAtMTYxLDEwICsxNTYsMTIgQEAg
c3RhdGljIGludCBpZ3RfZXZpY3Rfc29tZXRoaW5nKHZvaWQgKmFyZykKIAl1bnBpbl9nZ3R0KGk5
MTUpOwogCiAJLyogRXZlcnl0aGluZyBpcyB1bnBpbm5lZCwgd2Ugc2hvdWxkIGJlIGFibGUgdG8g
ZXZpY3Qgc29tZXRoaW5nICovCisJbXV0ZXhfbG9jaygmZ2d0dC0+dm0ubXV0ZXgpOwogCWVyciA9
IGk5MTVfZ2VtX2V2aWN0X3NvbWV0aGluZygmZ2d0dC0+dm0sCiAJCQkJICAgICAgIEk5MTVfR1RU
X1BBR0VfU0laRSwgMCwgMCwKIAkJCQkgICAgICAgMCwgVTY0X01BWCwKIAkJCQkgICAgICAgMCk7
CisJbXV0ZXhfdW5sb2NrKCZnZ3R0LT52bS5tdXRleCk7CiAJaWYgKGVycikgewogCQlwcl9lcnIo
Imk5MTVfZ2VtX2V2aWN0X3NvbWV0aGluZyBmYWlsZWQgb24gYSBmdWxsIEdHVFQgd2l0aCBlcnI9
JWRcbiIsCiAJCSAgICAgICBlcnIpOwpAQCAtMjMwLDcgKzIyNyw5IEBAIHN0YXRpYyBpbnQgaWd0
X2V2aWN0X2Zvcl92bWEodm9pZCAqYXJnKQogCQlnb3RvIGNsZWFudXA7CiAKIAkvKiBFdmVyeXRo
aW5nIGlzIHBpbm5lZCwgbm90aGluZyBzaG91bGQgaGFwcGVuICovCisJbXV0ZXhfbG9jaygmZ2d0
dC0+dm0ubXV0ZXgpOwogCWVyciA9IGk5MTVfZ2VtX2V2aWN0X2Zvcl9ub2RlKCZnZ3R0LT52bSwg
JnRhcmdldCwgMCk7CisJbXV0ZXhfdW5sb2NrKCZnZ3R0LT52bS5tdXRleCk7CiAJaWYgKGVyciAh
PSAtRU5PU1BDKSB7CiAJCXByX2VycigiaTkxNV9nZW1fZXZpY3RfZm9yX25vZGUgb24gYSBmdWxs
IEdHVFQgcmV0dXJuZWQgZXJyPSVkXG4iLAogCQkgICAgICAgZXJyKTsKQEAgLTI0MCw3ICsyMzks
OSBAQCBzdGF0aWMgaW50IGlndF9ldmljdF9mb3Jfdm1hKHZvaWQgKmFyZykKIAl1bnBpbl9nZ3R0
KGk5MTUpOwogCiAJLyogRXZlcnl0aGluZyBpcyB1bnBpbm5lZCwgd2Ugc2hvdWxkIGJlIGFibGUg
dG8gZXZpY3QgdGhlIG5vZGUgKi8KKwltdXRleF9sb2NrKCZnZ3R0LT52bS5tdXRleCk7CiAJZXJy
ID0gaTkxNV9nZW1fZXZpY3RfZm9yX25vZGUoJmdndHQtPnZtLCAmdGFyZ2V0LCAwKTsKKwltdXRl
eF91bmxvY2soJmdndHQtPnZtLm11dGV4KTsKIAlpZiAoZXJyKSB7CiAJCXByX2VycigiaTkxNV9n
ZW1fZXZpY3RfZm9yX25vZGUgcmV0dXJuZWQgZXJyPSVkXG4iLAogCQkgICAgICAgZXJyKTsKQEAg
LTMxNyw3ICszMTgsOSBAQCBzdGF0aWMgaW50IGlndF9ldmljdF9mb3JfY2FjaGVfY29sb3Iodm9p
ZCAqYXJnKQogCWk5MTVfdm1hX3VucGluKHZtYSk7CiAKIAkvKiBSZW1vdmUganVzdCB0aGUgc2Vj
b25kIHZtYSAqLworCW11dGV4X2xvY2soJmdndHQtPnZtLm11dGV4KTsKIAllcnIgPSBpOTE1X2dl
bV9ldmljdF9mb3Jfbm9kZSgmZ2d0dC0+dm0sICZ0YXJnZXQsIDApOworCW11dGV4X3VubG9jaygm
Z2d0dC0+dm0ubXV0ZXgpOwogCWlmIChlcnIpIHsKIAkJcHJfZXJyKCJbMF1pOTE1X2dlbV9ldmlj
dF9mb3Jfbm9kZSByZXR1cm5lZCBlcnI9JWRcbiIsIGVycik7CiAJCWdvdG8gY2xlYW51cDsKQEAg
LTMyOCw3ICszMzEsOSBAQCBzdGF0aWMgaW50IGlndF9ldmljdF9mb3JfY2FjaGVfY29sb3Iodm9p
ZCAqYXJnKQogCSAqLwogCXRhcmdldC5jb2xvciA9IEk5MTVfQ0FDSEVfTDNfTExDOwogCisJbXV0
ZXhfbG9jaygmZ2d0dC0+dm0ubXV0ZXgpOwogCWVyciA9IGk5MTVfZ2VtX2V2aWN0X2Zvcl9ub2Rl
KCZnZ3R0LT52bSwgJnRhcmdldCwgMCk7CisJbXV0ZXhfdW5sb2NrKCZnZ3R0LT52bS5tdXRleCk7
CiAJaWYgKCFlcnIpIHsKIAkJcHJfZXJyKCJbMV1pOTE1X2dlbV9ldmljdF9mb3Jfbm9kZSByZXR1
cm5lZCBlcnI9JWRcbiIsIGVycik7CiAJCWVyciA9IC1FSU5WQUw7CkBAIC0zNTgsNyArMzYzLDkg
QEAgc3RhdGljIGludCBpZ3RfZXZpY3Rfdm0odm9pZCAqYXJnKQogCQlnb3RvIGNsZWFudXA7CiAK
IAkvKiBFdmVyeXRoaW5nIGlzIHBpbm5lZCwgbm90aGluZyBzaG91bGQgaGFwcGVuICovCisJbXV0
ZXhfbG9jaygmZ2d0dC0+dm0ubXV0ZXgpOwogCWVyciA9IGk5MTVfZ2VtX2V2aWN0X3ZtKCZnZ3R0
LT52bSk7CisJbXV0ZXhfdW5sb2NrKCZnZ3R0LT52bS5tdXRleCk7CiAJaWYgKGVycikgewogCQlw
cl9lcnIoImk5MTVfZ2VtX2V2aWN0X3ZtIG9uIGEgZnVsbCBHR1RUIHJldHVybmVkIGVycj0lZF1c
biIsCiAJCSAgICAgICBlcnIpOwpAQCAtMzY3LDcgKzM3NCw5IEBAIHN0YXRpYyBpbnQgaWd0X2V2
aWN0X3ZtKHZvaWQgKmFyZykKIAogCXVucGluX2dndHQoaTkxNSk7CiAKKwltdXRleF9sb2NrKCZn
Z3R0LT52bS5tdXRleCk7CiAJZXJyID0gaTkxNV9nZW1fZXZpY3Rfdm0oJmdndHQtPnZtKTsKKwlt
dXRleF91bmxvY2soJmdndHQtPnZtLm11dGV4KTsKIAlpZiAoZXJyKSB7CiAJCXByX2VycigiaTkx
NV9nZW1fZXZpY3Rfdm0gb24gYSBmdWxsIEdHVFQgcmV0dXJuZWQgZXJyPSVkXVxuIiwKIAkJICAg
ICAgIGVycik7CkBAIC00MDgsMTEgKzQxNywxMSBAQCBzdGF0aWMgaW50IGlndF9ldmljdF9jb250
ZXh0cyh2b2lkICphcmcpCiAJaWYgKCFIQVNfRlVMTF9QUEdUVChpOTE1KSkKIAkJcmV0dXJuIDA7
CiAKLQltdXRleF9sb2NrKCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsKIAl3YWtlcmVmID0gaW50
ZWxfcnVudGltZV9wbV9nZXQoJmk5MTUtPnJ1bnRpbWVfcG0pOwogCiAJLyogUmVzZXJ2ZSBhIGJs
b2NrIHNvIHRoYXQgd2Uga25vdyB3ZSBoYXZlIGVub3VnaCB0byBmaXQgYSBmZXcgcnEgKi8KIAlt
ZW1zZXQoJmhvbGUsIDAsIHNpemVvZihob2xlKSk7CisJbXV0ZXhfbG9jaygmaTkxNS0+Z2d0dC52
bS5tdXRleCk7CiAJZXJyID0gaTkxNV9nZW1fZ3R0X2luc2VydCgmaTkxNS0+Z2d0dC52bSwgJmhv
bGUsCiAJCQkJICBQUkVURU5EX0dHVFRfU0laRSwgMCwgSTkxNV9DT0xPUl9VTkVWSUNUQUJMRSwK
IAkJCQkgIDAsIGk5MTUtPmdndHQudm0udG90YWwsCkBAIC00MjUsNyArNDM0LDkgQEAgc3RhdGlj
IGludCBpZ3RfZXZpY3RfY29udGV4dHModm9pZCAqYXJnKQogCWRvIHsKIAkJc3RydWN0IHJlc2Vy
dmVkICpyOwogCisJCW11dGV4X3VubG9jaygmaTkxNS0+Z2d0dC52bS5tdXRleCk7CiAJCXIgPSBr
Y2FsbG9jKDEsIHNpemVvZigqciksIEdGUF9LRVJORUwpOworCQltdXRleF9sb2NrKCZpOTE1LT5n
Z3R0LnZtLm11dGV4KTsKIAkJaWYgKCFyKSB7CiAJCQllcnIgPSAtRU5PTUVNOwogCQkJZ290byBv
dXRfbG9ja2VkOwpAQCAtNDQ1LDcgKzQ1Niw3IEBAIHN0YXRpYyBpbnQgaWd0X2V2aWN0X2NvbnRl
eHRzKHZvaWQgKmFyZykKIAkJY291bnQrKzsKIAl9IHdoaWxlICgxKTsKIAlkcm1fbW1fcmVtb3Zl
X25vZGUoJmhvbGUpOwotCW11dGV4X3VubG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CisJ
bXV0ZXhfdW5sb2NrKCZpOTE1LT5nZ3R0LnZtLm11dGV4KTsKIAlwcl9pbmZvKCJGaWxsZWQgR0dU
VCB3aXRoICVsdSAxTWlCIG5vZGVzXG4iLCBjb3VudCk7CiAKIAkvKiBPdmVyZmlsbCB0aGUgR0dU
VCB3aXRoIGNvbnRleHQgb2JqZWN0cyBhbmQgc28gdHJ5IHRvIGV2aWN0IG9uZS4gKi8KQEAgLTUw
OCw3ICs1MTksNyBAQCBzdGF0aWMgaW50IGlndF9ldmljdF9jb250ZXh0cyh2b2lkICphcmcpCiAJ
CQlicmVhazsKIAl9CiAKLQltdXRleF9sb2NrKCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsKKwlt
dXRleF9sb2NrKCZpOTE1LT5nZ3R0LnZtLm11dGV4KTsKIG91dF9sb2NrZWQ6CiAJaWYgKGlndF9m
bHVzaF90ZXN0KGk5MTUsIEk5MTVfV0FJVF9MT0NLRUQpKQogCQllcnIgPSAtRUlPOwpAQCAtNTIy
LDggKzUzMyw4IEBAIHN0YXRpYyBpbnQgaWd0X2V2aWN0X2NvbnRleHRzKHZvaWQgKmFyZykKIAl9
CiAJaWYgKGRybV9tbV9ub2RlX2FsbG9jYXRlZCgmaG9sZSkpCiAJCWRybV9tbV9yZW1vdmVfbm9k
ZSgmaG9sZSk7CisJbXV0ZXhfdW5sb2NrKCZpOTE1LT5nZ3R0LnZtLm11dGV4KTsKIAlpbnRlbF9y
dW50aW1lX3BtX3B1dCgmaTkxNS0+cnVudGltZV9wbSwgd2FrZXJlZik7Ci0JbXV0ZXhfdW5sb2Nr
KCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsKIAogCXJldHVybiBlcnI7CiB9CkBAIC01NDUsMTIg
KzU1Niw5IEBAIGludCBpOTE1X2dlbV9ldmljdF9tb2NrX3NlbGZ0ZXN0cyh2b2lkKQogCWlmICgh
aTkxNSkKIAkJcmV0dXJuIC1FTk9NRU07CiAKLQltdXRleF9sb2NrKCZpOTE1LT5kcm0uc3RydWN0
X211dGV4KTsKIAl3aXRoX2ludGVsX3J1bnRpbWVfcG0oJmk5MTUtPnJ1bnRpbWVfcG0sIHdha2Vy
ZWYpCiAJCWVyciA9IGk5MTVfc3VidGVzdHModGVzdHMsIGk5MTUpOwogCi0JbXV0ZXhfdW5sb2Nr
KCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsKLQogCWRybV9kZXZfcHV0KCZpOTE1LT5kcm0pOwog
CXJldHVybiBlcnI7CiB9CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9zZWxmdGVz
dHMvaTkxNV9nZW1fZ3R0LmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMvaTkxNV9n
ZW1fZ3R0LmMKaW5kZXggYTkwYzliZTk1ZjhjLi4zMzczZjIwZmIxNDQgMTAwNjQ0Ci0tLSBhL2Ry
aXZlcnMvZ3B1L2RybS9pOTE1L3NlbGZ0ZXN0cy9pOTE1X2dlbV9ndHQuYworKysgYi9kcml2ZXJz
L2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMvaTkxNV9nZW1fZ3R0LmMKQEAgLTM1LDE2ICszNSw3IEBA
CiAKIHN0YXRpYyB2b2lkIGNsZWFudXBfZnJlZWRfb2JqZWN0cyhzdHJ1Y3QgZHJtX2k5MTVfcHJp
dmF0ZSAqaTkxNSkKIHsKLQkvKgotCSAqIEFzIHdlIG1heSBob2xkIG9udG8gdGhlIHN0cnVjdF9t
dXRleCBmb3IgaW5vcmRpbmF0ZSBsZW5ndGhzIG9mCi0JICogdGltZSwgdGhlIE5NSSBraHVuZ3Rh
c2tkIGRldGVjdG9yIG1heSBmaXJlIGZvciB0aGUgZnJlZSBvYmplY3RzCi0JICogd29ya2VyLgot
CSAqLwotCW11dGV4X3VubG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7Ci0KIAlpOTE1X2dl
bV9kcmFpbl9mcmVlZF9vYmplY3RzKGk5MTUpOwotCi0JbXV0ZXhfbG9jaygmaTkxNS0+ZHJtLnN0
cnVjdF9tdXRleCk7CiB9CiAKIHN0YXRpYyB2b2lkIGZha2VfZnJlZV9wYWdlcyhzdHJ1Y3QgZHJt
X2k5MTVfZ2VtX29iamVjdCAqb2JqLApAQCAtMzE4LDYgKzMwOSwxNyBAQCBzdGF0aWMgaW50IGxv
d2xldmVsX2hvbGUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUsCiAJcmV0dXJuIDA7CiB9
CiAKK3N0YXRpYyBpbnQgdW5sb2NrZWRfdm1hX3VuYmluZChzdHJ1Y3QgaTkxNV92bWEgKnZtYSkK
K3sKKwlpbnQgcmV0OworCisJbXV0ZXhfbG9jaygmdm1hLT52bS0+bXV0ZXgpOworCXJldCA9IGk5
MTVfdm1hX3VuYmluZCh2bWEpOworCW11dGV4X3VubG9jaygmdm1hLT52bS0+bXV0ZXgpOworCisJ
cmV0dXJuIHJldDsKK30KKwogc3RhdGljIHZvaWQgY2xvc2Vfb2JqZWN0X2xpc3Qoc3RydWN0IGxp
c3RfaGVhZCAqb2JqZWN0cywKIAkJCSAgICAgIHN0cnVjdCBpOTE1X2FkZHJlc3Nfc3BhY2UgKnZt
KQogewpAQCAtMzI5LDcgKzMzMSw3IEBAIHN0YXRpYyB2b2lkIGNsb3NlX29iamVjdF9saXN0KHN0
cnVjdCBsaXN0X2hlYWQgKm9iamVjdHMsCiAKIAkJdm1hID0gaTkxNV92bWFfaW5zdGFuY2Uob2Jq
LCB2bSwgTlVMTCk7CiAJCWlmICghSVNfRVJSKHZtYSkpCi0JCQlpZ25vcmVkID0gaTkxNV92bWFf
dW5iaW5kKHZtYSk7CisJCQlpZ25vcmVkID0gdW5sb2NrZWRfdm1hX3VuYmluZCh2bWEpOwogCQkv
KiBPbmx5IHBwZ3R0IHZtYSBtYXkgYmUgY2xvc2VkIGJlZm9yZSB0aGUgb2JqZWN0IGlzIGZyZWVk
ICovCiAJCWlmICghSVNfRVJSKHZtYSkgJiYgIWk5MTVfdm1hX2lzX2dndHQodm1hKSkKIAkJCWk5
MTVfdm1hX2Nsb3NlKHZtYSk7CkBAIC00NDQsNyArNDQ2LDcgQEAgc3RhdGljIGludCBmaWxsX2hv
bGUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUsCiAJCQkJCQlnb3RvIGVycjsKIAkJCQkJ
fQogCi0JCQkJCWVyciA9IGk5MTVfdm1hX3VuYmluZCh2bWEpOworCQkJCQllcnIgPSB1bmxvY2tl
ZF92bWFfdW5iaW5kKHZtYSk7CiAJCQkJCWlmIChlcnIpIHsKIAkJCQkJCXByX2VycigiJXMoJXMp
IChmb3J3YXJkKSB1bmJpbmQgb2Ygdm1hLm5vZGU9JWxseCArICVsbHggZmFpbGVkIHdpdGggZXJy
PSVkXG4iLAogCQkJCQkJICAgICAgIF9fZnVuY19fLCBwLT5uYW1lLCB2bWEtPm5vZGUuc3RhcnQs
IHZtYS0+bm9kZS5zaXplLApAQCAtNTE3LDcgKzUxOSw3IEBAIHN0YXRpYyBpbnQgZmlsbF9ob2xl
KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LAogCQkJCQkJZ290byBlcnI7CiAJCQkJCX0K
IAotCQkJCQllcnIgPSBpOTE1X3ZtYV91bmJpbmQodm1hKTsKKwkJCQkJZXJyID0gdW5sb2NrZWRf
dm1hX3VuYmluZCh2bWEpOwogCQkJCQlpZiAoZXJyKSB7CiAJCQkJCQlwcl9lcnIoIiVzKCVzKSAo
YmFja3dhcmQpIHVuYmluZCBvZiB2bWEubm9kZT0lbGx4ICsgJWxseCBmYWlsZWQgd2l0aCBlcnI9
JWRcbiIsCiAJCQkJCQkgICAgICAgX19mdW5jX18sIHAtPm5hbWUsIHZtYS0+bm9kZS5zdGFydCwg
dm1hLT5ub2RlLnNpemUsCkBAIC02MDQsNyArNjA2LDcgQEAgc3RhdGljIGludCB3YWxrX2hvbGUo
c3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUsCiAJCQkJZ290byBlcnJfY2xvc2U7CiAJCQl9
CiAKLQkJCWVyciA9IGk5MTVfdm1hX3VuYmluZCh2bWEpOworCQkJZXJyID0gdW5sb2NrZWRfdm1h
X3VuYmluZCh2bWEpOwogCQkJaWYgKGVycikgewogCQkJCXByX2VycigiJXMgdW5iaW5kIGZhaWxl
ZCBhdCAlbGx4ICsgJWxseCAgd2l0aCBlcnI9JWRcbiIsCiAJCQkJICAgICAgIF9fZnVuY19fLCBh
ZGRyLCB2bWEtPnNpemUsIGVycik7CkBAIC02ODUsMTMgKzY4NywxMyBAQCBzdGF0aWMgaW50IHBv
dF9ob2xlKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LAogCQkJCXByX2VycigiJXMgaW5j
b3JyZWN0IGF0ICVsbHggKyAlbGx4XG4iLAogCQkJCSAgICAgICBfX2Z1bmNfXywgYWRkciwgdm1h
LT5zaXplKTsKIAkJCQlpOTE1X3ZtYV91bnBpbih2bWEpOwotCQkJCWVyciA9IGk5MTVfdm1hX3Vu
YmluZCh2bWEpOworCQkJCWVyciA9IHVubG9ja2VkX3ZtYV91bmJpbmQodm1hKTsKIAkJCQllcnIg
PSAtRUlOVkFMOwogCQkJCWdvdG8gZXJyOwogCQkJfQogCiAJCQlpOTE1X3ZtYV91bnBpbih2bWEp
OwotCQkJZXJyID0gaTkxNV92bWFfdW5iaW5kKHZtYSk7CisJCQllcnIgPSB1bmxvY2tlZF92bWFf
dW5iaW5kKHZtYSk7CiAJCQlHRU1fQlVHX09OKGVycik7CiAJCX0KIApAQCAtNzg5LDEzICs3OTEs
MTMgQEAgc3RhdGljIGludCBkcnVua19ob2xlKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1
LAogCQkJCXByX2VycigiJXMgaW5jb3JyZWN0IGF0ICVsbHggKyAlbGx4XG4iLAogCQkJCSAgICAg
ICBfX2Z1bmNfXywgYWRkciwgQklUX1VMTChzaXplKSk7CiAJCQkJaTkxNV92bWFfdW5waW4odm1h
KTsKLQkJCQllcnIgPSBpOTE1X3ZtYV91bmJpbmQodm1hKTsKKwkJCQllcnIgPSB1bmxvY2tlZF92
bWFfdW5iaW5kKHZtYSk7CiAJCQkJZXJyID0gLUVJTlZBTDsKIAkJCQlnb3RvIGVycjsKIAkJCX0K
IAogCQkJaTkxNV92bWFfdW5waW4odm1hKTsKLQkJCWVyciA9IGk5MTVfdm1hX3VuYmluZCh2bWEp
OworCQkJZXJyID0gdW5sb2NrZWRfdm1hX3VuYmluZCh2bWEpOwogCQkJR0VNX0JVR19PTihlcnIp
OwogCiAJCQlpZiAoaWd0X3RpbWVvdXQoZW5kX3RpbWUsCkBAIC04NjcsNyArODY5LDcgQEAgc3Rh
dGljIGludCBfX3Nocmlua19ob2xlKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LAogCQkJ
cHJfZXJyKCIlcyBpbmNvcnJlY3QgYXQgJWxseCArICVsbHhcbiIsCiAJCQkgICAgICAgX19mdW5j
X18sIGFkZHIsIHNpemUpOwogCQkJaTkxNV92bWFfdW5waW4odm1hKTsKLQkJCWVyciA9IGk5MTVf
dm1hX3VuYmluZCh2bWEpOworCQkJZXJyID0gdW5sb2NrZWRfdm1hX3VuYmluZCh2bWEpOwogCQkJ
ZXJyID0gLUVJTlZBTDsKIAkJCWJyZWFrOwogCQl9CkBAIC04NzUsNiArODc3LDE1IEBAIHN0YXRp
YyBpbnQgX19zaHJpbmtfaG9sZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwKIAkJaTkx
NV92bWFfdW5waW4odm1hKTsKIAkJYWRkciArPSBzaXplOwogCisJCS8qCisJCSAqIFNpbmNlIHdl
IGFyZSBpbmplY3RpbmcgYWxsb2NhdGlvbiBmYXVsdHMgYXQgcmFuZG9tIGludGVydmFscywKKwkJ
ICogd2FpdCBmb3IgdGhpcyBhbGxvY2F0aW9uIHRvIGNvbXBsZXRlIGJlZm9yZSB3ZSBjaGFuZ2Ug
dGhlCisJCSAqIGZhdWx0aW5qZWN0aW9uLgorCQkgKi8KKwkJZXJyID0gaTkxNV9hY3RpdmVfd2Fp
dCgmdm1hLT5hY3RpdmUpOworCQlpZiAoZXJyKQorCQkJYnJlYWs7CisKIAkJaWYgKGlndF90aW1l
b3V0KGVuZF90aW1lLAogCQkJCSIlcyB0aW1lZCBvdXQgYXQgb2ZzZXQgJWxseCBbJWxseCAtICVs
bHhdXG4iLAogCQkJCV9fZnVuY19fLCBhZGRyLCBob2xlX3N0YXJ0LCBob2xlX2VuZCkpIHsKQEAg
LTEwMDgsMjEgKzEwMTksMTkgQEAgc3RhdGljIGludCBleGVyY2lzZV9wcGd0dChzdHJ1Y3QgZHJt
X2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCiAJaWYgKElTX0VSUihmaWxlKSkKIAkJcmV0dXJuIFBU
Ul9FUlIoZmlsZSk7CiAKLQltdXRleF9sb2NrKCZkZXZfcHJpdi0+ZHJtLnN0cnVjdF9tdXRleCk7
CiAJcHBndHQgPSBpOTE1X3BwZ3R0X2NyZWF0ZShkZXZfcHJpdik7CiAJaWYgKElTX0VSUihwcGd0
dCkpIHsKIAkJZXJyID0gUFRSX0VSUihwcGd0dCk7Ci0JCWdvdG8gb3V0X3VubG9jazsKKwkJZ290
byBvdXRfZnJlZTsKIAl9CiAJR0VNX0JVR19PTihvZmZzZXRfaW5fcGFnZShwcGd0dC0+dm0udG90
YWwpKTsKLQlHRU1fQlVHX09OKHBwZ3R0LT52bS5jbG9zZWQpOworCUdFTV9CVUdfT04oIWF0b21p
Y19yZWFkKCZwcGd0dC0+dm0ub3BlbikpOwogCiAJZXJyID0gZnVuYyhkZXZfcHJpdiwgJnBwZ3R0
LT52bSwgMCwgcHBndHQtPnZtLnRvdGFsLCBlbmRfdGltZSk7CiAKIAlpOTE1X3ZtX3B1dCgmcHBn
dHQtPnZtKTsKLW91dF91bmxvY2s6Ci0JbXV0ZXhfdW5sb2NrKCZkZXZfcHJpdi0+ZHJtLnN0cnVj
dF9tdXRleCk7CiAKK291dF9mcmVlOgogCW1vY2tfZmlsZV9mcmVlKGRldl9wcml2LCBmaWxlKTsK
IAlyZXR1cm4gZXJyOwogfQpAQCAtMTA4NSw3ICsxMDk0LDYgQEAgc3RhdGljIGludCBleGVyY2lz
ZV9nZ3R0KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LAogCUlHVF9USU1FT1VUKGVuZF90
aW1lKTsKIAlpbnQgZXJyID0gMDsKIAotCW11dGV4X2xvY2soJmk5MTUtPmRybS5zdHJ1Y3RfbXV0
ZXgpOwogcmVzdGFydDoKIAlsaXN0X3NvcnQoTlVMTCwgJmdndHQtPnZtLm1tLmhvbGVfc3RhY2ss
IHNvcnRfaG9sZXMpOwogCWRybV9tbV9mb3JfZWFjaF9ob2xlKG5vZGUsICZnZ3R0LT52bS5tbSwg
aG9sZV9zdGFydCwgaG9sZV9lbmQpIHsKQEAgLTExMDYsNyArMTExNCw2IEBAIHN0YXRpYyBpbnQg
ZXhlcmNpc2VfZ2d0dChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwKIAkJbGFzdCA9IGhv
bGVfZW5kOwogCQlnb3RvIHJlc3RhcnQ7CiAJfQotCW11dGV4X3VubG9jaygmaTkxNS0+ZHJtLnN0
cnVjdF9tdXRleCk7CiAKIAlyZXR1cm4gZXJyOwogfQpAQCAtMTE0OCwxMyArMTE1NSw5IEBAIHN0
YXRpYyBpbnQgaWd0X2dndHRfcGFnZSh2b2lkICphcmcpCiAJdW5zaWduZWQgaW50ICpvcmRlciwg
bjsKIAlpbnQgZXJyOwogCi0JbXV0ZXhfbG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7Ci0K
IAlvYmogPSBpOTE1X2dlbV9vYmplY3RfY3JlYXRlX2ludGVybmFsKGk5MTUsIFBBR0VfU0laRSk7
Ci0JaWYgKElTX0VSUihvYmopKSB7Ci0JCWVyciA9IFBUUl9FUlIob2JqKTsKLQkJZ290byBvdXRf
dW5sb2NrOwotCX0KKwlpZiAoSVNfRVJSKG9iaikpCisJCXJldHVybiBQVFJfRVJSKG9iaik7CiAK
IAllcnIgPSBpOTE1X2dlbV9vYmplY3RfcGluX3BhZ2VzKG9iaik7CiAJaWYgKGVycikKQEAgLTEy
MjIsOCArMTIyNSw2IEBAIHN0YXRpYyBpbnQgaWd0X2dndHRfcGFnZSh2b2lkICphcmcpCiAJaTkx
NV9nZW1fb2JqZWN0X3VucGluX3BhZ2VzKG9iaik7CiBvdXRfZnJlZToKIAlpOTE1X2dlbV9vYmpl
Y3RfcHV0KG9iaik7Ci1vdXRfdW5sb2NrOgotCW11dGV4X3VubG9jaygmaTkxNS0+ZHJtLnN0cnVj
dF9tdXRleCk7CiAJcmV0dXJuIGVycjsKIH0KIApAQCAtMTMzMCwxMSArMTMzMSwxMyBAQCBzdGF0
aWMgaW50IGlndF9ndHRfcmVzZXJ2ZSh2b2lkICphcmcpCiAJCQlnb3RvIG91dDsKIAkJfQogCisJ
CW11dGV4X2xvY2soJmdndHQtPnZtLm11dGV4KTsKIAkJZXJyID0gaTkxNV9nZW1fZ3R0X3Jlc2Vy
dmUoJmdndHQtPnZtLCAmdm1hLT5ub2RlLAogCQkJCQkgICBvYmotPmJhc2Uuc2l6ZSwKIAkJCQkJ
ICAgdG90YWwsCiAJCQkJCSAgIG9iai0+Y2FjaGVfbGV2ZWwsCiAJCQkJCSAgIDApOworCQltdXRl
eF91bmxvY2soJmdndHQtPnZtLm11dGV4KTsKIAkJaWYgKGVycikgewogCQkJcHJfZXJyKCJpOTE1
X2dlbV9ndHRfcmVzZXJ2ZSAocGFzcyAxKSBmYWlsZWQgYXQgJWxsdS8lbGx1IHdpdGggZXJyPSVk
XG4iLAogCQkJICAgICAgIHRvdGFsLCBnZ3R0LT52bS50b3RhbCwgZXJyKTsKQEAgLTEzODAsMTEg
KzEzODMsMTMgQEAgc3RhdGljIGludCBpZ3RfZ3R0X3Jlc2VydmUodm9pZCAqYXJnKQogCQkJZ290
byBvdXQ7CiAJCX0KIAorCQltdXRleF9sb2NrKCZnZ3R0LT52bS5tdXRleCk7CiAJCWVyciA9IGk5
MTVfZ2VtX2d0dF9yZXNlcnZlKCZnZ3R0LT52bSwgJnZtYS0+bm9kZSwKIAkJCQkJICAgb2JqLT5i
YXNlLnNpemUsCiAJCQkJCSAgIHRvdGFsLAogCQkJCQkgICBvYmotPmNhY2hlX2xldmVsLAogCQkJ
CQkgICAwKTsKKwkJbXV0ZXhfdW5sb2NrKCZnZ3R0LT52bS5tdXRleCk7CiAJCWlmIChlcnIpIHsK
IAkJCXByX2VycigiaTkxNV9nZW1fZ3R0X3Jlc2VydmUgKHBhc3MgMikgZmFpbGVkIGF0ICVsbHUv
JWxsdSB3aXRoIGVycj0lZFxuIiwKIAkJCSAgICAgICB0b3RhbCwgZ2d0dC0+dm0udG90YWwsIGVy
cik7CkBAIC0xNDE0LDcgKzE0MTksNyBAQCBzdGF0aWMgaW50IGlndF9ndHRfcmVzZXJ2ZSh2b2lk
ICphcmcpCiAJCQlnb3RvIG91dDsKIAkJfQogCi0JCWVyciA9IGk5MTVfdm1hX3VuYmluZCh2bWEp
OworCQllcnIgPSB1bmxvY2tlZF92bWFfdW5iaW5kKHZtYSk7CiAJCWlmIChlcnIpIHsKIAkJCXBy
X2VycigiaTkxNV92bWFfdW5iaW5kIGZhaWxlZCB3aXRoIGVycj0lZCFcbiIsIGVycik7CiAJCQln
b3RvIG91dDsKQEAgLTE0MjQsMTEgKzE0MjksMTMgQEAgc3RhdGljIGludCBpZ3RfZ3R0X3Jlc2Vy
dmUodm9pZCAqYXJnKQogCQkJCSAgICAgICAyKkk5MTVfR1RUX1BBR0VfU0laRSwKIAkJCQkgICAg
ICAgSTkxNV9HVFRfTUlOX0FMSUdOTUVOVCk7CiAKKwkJbXV0ZXhfbG9jaygmZ2d0dC0+dm0ubXV0
ZXgpOwogCQllcnIgPSBpOTE1X2dlbV9ndHRfcmVzZXJ2ZSgmZ2d0dC0+dm0sICZ2bWEtPm5vZGUs
CiAJCQkJCSAgIG9iai0+YmFzZS5zaXplLAogCQkJCQkgICBvZmZzZXQsCiAJCQkJCSAgIG9iai0+
Y2FjaGVfbGV2ZWwsCiAJCQkJCSAgIDApOworCQltdXRleF91bmxvY2soJmdndHQtPnZtLm11dGV4
KTsKIAkJaWYgKGVycikgewogCQkJcHJfZXJyKCJpOTE1X2dlbV9ndHRfcmVzZXJ2ZSAocGFzcyAz
KSBmYWlsZWQgYXQgJWxsdS8lbGx1IHdpdGggZXJyPSVkXG4iLAogCQkJICAgICAgIHRvdGFsLCBn
Z3R0LT52bS50b3RhbCwgZXJyKTsKQEAgLTE0OTcsMTEgKzE1MDQsMTMgQEAgc3RhdGljIGludCBp
Z3RfZ3R0X2luc2VydCh2b2lkICphcmcpCiAKIAkvKiBDaGVjayBhIGNvdXBsZSBvZiBvYnZpb3Vz
bHkgaW52YWxpZCByZXF1ZXN0cyAqLwogCWZvciAoaWkgPSBpbnZhbGlkX2luc2VydDsgaWktPnNp
emU7IGlpKyspIHsKKwkJbXV0ZXhfbG9jaygmZ2d0dC0+dm0ubXV0ZXgpOwogCQllcnIgPSBpOTE1
X2dlbV9ndHRfaW5zZXJ0KCZnZ3R0LT52bSwgJnRtcCwKIAkJCQkJICBpaS0+c2l6ZSwgaWktPmFs
aWdubWVudCwKIAkJCQkJICBJOTE1X0NPTE9SX1VORVZJQ1RBQkxFLAogCQkJCQkgIGlpLT5zdGFy
dCwgaWktPmVuZCwKIAkJCQkJICAwKTsKKwkJbXV0ZXhfdW5sb2NrKCZnZ3R0LT52bS5tdXRleCk7
CiAJCWlmIChlcnIgIT0gLUVOT1NQQykgewogCQkJcHJfZXJyKCJJbnZhbGlkIGk5MTVfZ2VtX2d0
dF9pbnNlcnQoLnNpemU9JWxseCwgLmFsaWdubWVudD0lbGx4LCAuc3RhcnQ9JWxseCwgLmVuZD0l
bGx4KSBzdWNjZWVkZWQgKGVycj0lZClcbiIsCiAJCQkgICAgICAgaWktPnNpemUsIGlpLT5hbGln
bm1lbnQsIGlpLT5zdGFydCwgaWktPmVuZCwKQEAgLTE1MzcsMTAgKzE1NDYsMTIgQEAgc3RhdGlj
IGludCBpZ3RfZ3R0X2luc2VydCh2b2lkICphcmcpCiAJCQlnb3RvIG91dDsKIAkJfQogCisJCW11
dGV4X2xvY2soJmdndHQtPnZtLm11dGV4KTsKIAkJZXJyID0gaTkxNV9nZW1fZ3R0X2luc2VydCgm
Z2d0dC0+dm0sICZ2bWEtPm5vZGUsCiAJCQkJCSAgb2JqLT5iYXNlLnNpemUsIDAsIG9iai0+Y2Fj
aGVfbGV2ZWwsCiAJCQkJCSAgMCwgZ2d0dC0+dm0udG90YWwsCiAJCQkJCSAgMCk7CisJCW11dGV4
X3VubG9jaygmZ2d0dC0+dm0ubXV0ZXgpOwogCQlpZiAoZXJyID09IC1FTk9TUEMpIHsKIAkJCS8q
IG1heGVkIG91dCB0aGUgR0dUVCBzcGFjZSAqLwogCQkJaTkxNV9nZW1fb2JqZWN0X3B1dChvYmop
OwpAQCAtMTU4OSwxNiArMTYwMCwxOCBAQCBzdGF0aWMgaW50IGlndF9ndHRfaW5zZXJ0KHZvaWQg
KmFyZykKIAkJR0VNX0JVR19PTighZHJtX21tX25vZGVfYWxsb2NhdGVkKCZ2bWEtPm5vZGUpKTsK
IAkJb2Zmc2V0ID0gdm1hLT5ub2RlLnN0YXJ0OwogCi0JCWVyciA9IGk5MTVfdm1hX3VuYmluZCh2
bWEpOworCQllcnIgPSB1bmxvY2tlZF92bWFfdW5iaW5kKHZtYSk7CiAJCWlmIChlcnIpIHsKIAkJ
CXByX2VycigiaTkxNV92bWFfdW5iaW5kIGZhaWxlZCB3aXRoIGVycj0lZCFcbiIsIGVycik7CiAJ
CQlnb3RvIG91dDsKIAkJfQogCisJCW11dGV4X2xvY2soJmdndHQtPnZtLm11dGV4KTsKIAkJZXJy
ID0gaTkxNV9nZW1fZ3R0X2luc2VydCgmZ2d0dC0+dm0sICZ2bWEtPm5vZGUsCiAJCQkJCSAgb2Jq
LT5iYXNlLnNpemUsIDAsIG9iai0+Y2FjaGVfbGV2ZWwsCiAJCQkJCSAgMCwgZ2d0dC0+dm0udG90
YWwsCiAJCQkJCSAgMCk7CisJCW11dGV4X3VubG9jaygmZ2d0dC0+dm0ubXV0ZXgpOwogCQlpZiAo
ZXJyKSB7CiAJCQlwcl9lcnIoImk5MTVfZ2VtX2d0dF9pbnNlcnQgKHBhc3MgMikgZmFpbGVkIGF0
ICVsbHUvJWxsdSB3aXRoIGVycj0lZFxuIiwKIAkJCSAgICAgICB0b3RhbCwgZ2d0dC0+dm0udG90
YWwsIGVycik7CkBAIC0xNjQyLDEwICsxNjU1LDEyIEBAIHN0YXRpYyBpbnQgaWd0X2d0dF9pbnNl
cnQodm9pZCAqYXJnKQogCQkJZ290byBvdXQ7CiAJCX0KIAorCQltdXRleF9sb2NrKCZnZ3R0LT52
bS5tdXRleCk7CiAJCWVyciA9IGk5MTVfZ2VtX2d0dF9pbnNlcnQoJmdndHQtPnZtLCAmdm1hLT5u
b2RlLAogCQkJCQkgIG9iai0+YmFzZS5zaXplLCAwLCBvYmotPmNhY2hlX2xldmVsLAogCQkJCQkg
IDAsIGdndHQtPnZtLnRvdGFsLAogCQkJCQkgIDApOworCQltdXRleF91bmxvY2soJmdndHQtPnZt
Lm11dGV4KTsKIAkJaWYgKGVycikgewogCQkJcHJfZXJyKCJpOTE1X2dlbV9ndHRfaW5zZXJ0IChw
YXNzIDMpIGZhaWxlZCBhdCAlbGx1LyVsbHUgd2l0aCBlcnI9JWRcbiIsCiAJCQkgICAgICAgdG90
YWwsIGdndHQtPnZtLnRvdGFsLCBlcnIpOwpAQCAtMTY4OSw4ICsxNzA0LDkgQEAgaW50IGk5MTVf
Z2VtX2d0dF9tb2NrX3NlbGZ0ZXN0cyh2b2lkKQogCX0KIAltb2NrX2luaXRfZ2d0dChpOTE1LCBn
Z3R0KTsKIAotCW11dGV4X2xvY2soJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwogCWVyciA9IGk5
MTVfc3VidGVzdHModGVzdHMsIGdndHQpOworCisJbXV0ZXhfbG9jaygmaTkxNS0+ZHJtLnN0cnVj
dF9tdXRleCk7CiAJbW9ja19kZXZpY2VfZmx1c2goaTkxNSk7CiAJbXV0ZXhfdW5sb2NrKCZpOTE1
LT5kcm0uc3RydWN0X211dGV4KTsKIApkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUv
c2VsZnRlc3RzL2k5MTVfdm1hLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMvaTkx
NV92bWEuYwppbmRleCBhNWJlYzBhNGNkY2MuLjUzYWFmYjlhM2Q2NCAxMDA2NDQKLS0tIGEvZHJp
dmVycy9ncHUvZHJtL2k5MTUvc2VsZnRlc3RzL2k5MTVfdm1hLmMKKysrIGIvZHJpdmVycy9ncHUv
ZHJtL2k5MTUvc2VsZnRlc3RzL2k5MTVfdm1hLmMKQEAgLTMzNyw3ICszMzcsOSBAQCBzdGF0aWMg
aW50IGlndF92bWFfcGluMSh2b2lkICphcmcpCiAKIAkJaWYgKCFlcnIpIHsKIAkJCWk5MTVfdm1h
X3VucGluKHZtYSk7CisJCQltdXRleF9sb2NrKCZnZ3R0LT52bS5tdXRleCk7CiAJCQllcnIgPSBp
OTE1X3ZtYV91bmJpbmQodm1hKTsKKwkJCW11dGV4X3VubG9jaygmZ2d0dC0+dm0ubXV0ZXgpOwog
CQkJaWYgKGVycikgewogCQkJCXByX2VycigiRmFpbGVkIHRvIHVuYmluZCBzaW5nbGUgcGFnZSBm
cm9tIEdHVFQsIGVycj0lZFxuIiwgZXJyKTsKIAkJCQlnb3RvIG91dDsKLS0gCjIuMjMuMAoKX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX18KSW50ZWwtZ2Z4IG1h
aWxpbmcgbGlzdApJbnRlbC1nZnhAbGlzdHMuZnJlZWRlc2t0b3Aub3JnCmh0dHBzOi8vbGlzdHMu
ZnJlZWRlc2t0b3Aub3JnL21haWxtYW4vbGlzdGluZm8vaW50ZWwtZ2Z4

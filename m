Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 65E8ABB7E2
	for <lists+intel-gfx@lfdr.de>; Mon, 23 Sep 2019 17:28:56 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id D27E76E949;
	Mon, 23 Sep 2019 15:28:53 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from fireflyinternet.com (mail.fireflyinternet.com [109.228.58.192])
 by gabe.freedesktop.org (Postfix) with ESMTPS id CBD9C6E946
 for <intel-gfx@lists.freedesktop.org>; Mon, 23 Sep 2019 15:28:50 +0000 (UTC)
X-Default-Received-SPF: pass (skip=forwardok (res=PASS))
 x-ip-name=78.156.65.138; 
Received: from haswell.alporthouse.com (unverified [78.156.65.138]) 
 by fireflyinternet.com (Firefly Internet (M1)) with ESMTP id 18588938-1500050 
 for <intel-gfx@lists.freedesktop.org>; Mon, 23 Sep 2019 16:28:47 +0100
From: Chris Wilson <chris@chris-wilson.co.uk>
To: intel-gfx@lists.freedesktop.org
Date: Mon, 23 Sep 2019 16:28:43 +0100
Message-Id: <20190923152844.8914-2-chris@chris-wilson.co.uk>
X-Mailer: git-send-email 2.23.0
In-Reply-To: <20190923152844.8914-1-chris@chris-wilson.co.uk>
References: <20190923152844.8914-1-chris@chris-wilson.co.uk>
MIME-Version: 1.0
Subject: [Intel-gfx] [CI 2/3] drm/i915: Fixup preempt-to-busy vs reset of a
 virtual request
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

RHVlIHRvIHRoZSBuYXR1cmUgb2YgcHJlZW1wdC10by1idXN5IHRoZSBleGVjbGlzdHMgYWN0aXZl
IHRyYWNraW5nIGFuZAp0aGUgc2NoZWR1bGUgcXVldWUgbWF5IGJlY29tZSB0ZW1wb3JhcmlseSBk
ZXN5bmMnZWQgKGJldHdlZW4gcmVzdWJtaXNzaW9uCnRvIEhXIGFuZCBpdHMgYWNrIGZyb20gSFcp
LiBUaGlzIG1lYW5zIHRoYXQgd2UgbWF5IGhhdmUgdW53b3VuZCBhCnJlcXVlc3QgYW5kIHBhc3Nl
ZCBpdCBiYWNrIHRvIHRoZSB2aXJ0dWFsIGVuZ2luZSwgYnV0IGl0IGlzIHN0aWxsCmluZmxpZ2h0
IG9uIHRoZSBIVyBhbmQgbWF5IGV2ZW4gcmVzdWx0IGluIGEgR1BVIGhhbmcuIElmIHdlIGRldGVj
dCB0aGF0CkdQVSBoYW5nIGFuZCB0cnkgdG8gcmVzZXQsIHRoZSBoYW5naW5nIHJlcXVlc3QtPmVu
Z2luZSB3aWxsIG5vIGxvbmdlcgptYXRjaCB0aGUgY3VycmVudCBlbmdpbmUsIHdoaWNoIG1lYW5z
IHRoYXQgdGhlIHJlcXVlc3QgaXMgbm90IG9uIHRoZQpleGVjbGlzdHMgYWN0aXZlIGxpc3QgYW5k
IHdlIHNob3VsZCBub3QgdHJ5IHRvIGZpbmQgYW4gb2xkZXIgaW5jb21wbGV0ZQpyZXF1ZXN0LiBH
aXZlbiB0aGF0IHdlIGhhdmUgZGVkdWNlZCB0aGlzIG11c3QgYmUgYSByZXF1ZXN0IG9uIGEgdmly
dHVhbAplbmdpbmUsIGl0IGlzIHRoZSBzaW5nbGUgYWN0aXZlIHJlcXVlc3QgaW4gdGhlIGNvbnRl
eHQgYW5kIHNvIG11c3QgYmUKZ3VpbHR5IChhcyB0aGUgY29udGV4dCBpcyBzdGlsbCBpbmZsaWdo
dCwgaXQgaXMgcHJldmVudGVkIGZyb20gYmVpbmcKZXhlY3V0ZWQgb24gYW5vdGhlciBlbmdpbmUg
YXMgd2UgcHJvY2VzcyB0aGUgcmVzZXQpLgoKRml4ZXM6IDIyYjdhNDI2YmJlMSAoImRybS9pOTE1
L2V4ZWNsaXN0czogUHJlZW1wdC10by1idXN5IikKU2lnbmVkLW9mZi1ieTogQ2hyaXMgV2lsc29u
IDxjaHJpc0BjaHJpcy13aWxzb24uY28udWs+CkNjOiBNaWthIEt1b3BwYWxhIDxtaWthLmt1b3Bw
YWxhQGxpbnV4LmludGVsLmNvbT4KQ2M6IFR2cnRrbyBVcnN1bGluIDx0dnJ0a28udXJzdWxpbkBp
bnRlbC5jb20+Ci0tLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfbHJjLmMgICB8IDcg
KysrKystLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfcmVzZXQuYyB8IDQgKy0tLQog
MiBmaWxlcyBjaGFuZ2VkLCA2IGluc2VydGlvbnMoKyksIDUgZGVsZXRpb25zKC0pCgpkaWZmIC0t
Z2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfbHJjLmMgYi9kcml2ZXJzL2dwdS9k
cm0vaTkxNS9ndC9pbnRlbF9scmMuYwppbmRleCAxMTQ4MTlmYjVhMjQuLjMyMjI4Nzk0M2UzMyAx
MDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfbHJjLmMKKysrIGIvZHJp
dmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfbHJjLmMKQEAgLTIzNDgsMTEgKzIzNDgsMTQgQEAg
c3RhdGljIHZvaWQgcmVzZXRfY3NiX3BvaW50ZXJzKHN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVu
Z2luZSkKIAogc3RhdGljIHN0cnVjdCBpOTE1X3JlcXVlc3QgKmFjdGl2ZV9yZXF1ZXN0KHN0cnVj
dCBpOTE1X3JlcXVlc3QgKnJxKQogewotCWNvbnN0IHN0cnVjdCBsaXN0X2hlYWQgKiBjb25zdCBs
aXN0ID0KLQkJJmk5MTVfcmVxdWVzdF9hY3RpdmVfdGltZWxpbmUocnEpLT5yZXF1ZXN0czsKIAlj
b25zdCBzdHJ1Y3QgaW50ZWxfY29udGV4dCAqIGNvbnN0IGNlID0gcnEtPmh3X2NvbnRleHQ7CiAJ
c3RydWN0IGk5MTVfcmVxdWVzdCAqYWN0aXZlID0gTlVMTDsKKwlzdHJ1Y3QgbGlzdF9oZWFkICps
aXN0OwogCisJaWYgKCFpOTE1X3JlcXVlc3RfaXNfYWN0aXZlKHJxKSkgLyogdW53b3VuZCwgYnV0
IGluY29tcGxldGUhICovCisJCXJldHVybiBycTsKKworCWxpc3QgPSAmaTkxNV9yZXF1ZXN0X2Fj
dGl2ZV90aW1lbGluZShycSktPnJlcXVlc3RzOwogCWxpc3RfZm9yX2VhY2hfZW50cnlfZnJvbV9y
ZXZlcnNlKHJxLCBsaXN0LCBsaW5rKSB7CiAJCWlmIChpOTE1X3JlcXVlc3RfY29tcGxldGVkKHJx
KSkKIAkJCWJyZWFrOwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxf
cmVzZXQuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX3Jlc2V0LmMKaW5kZXggODkw
NDhjYTg5MjRjLi5hZTY4YzM3ODZmNjMgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1
L2d0L2ludGVsX3Jlc2V0LmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfcmVz
ZXQuYwpAQCAtNDIsMTEgKzQyLDEwIEBAIHN0YXRpYyB2b2lkIGVuZ2luZV9za2lwX2NvbnRleHQo
c3RydWN0IGk5MTVfcmVxdWVzdCAqcnEpCiAJc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5l
ID0gcnEtPmVuZ2luZTsKIAlzdHJ1Y3QgaTkxNV9nZW1fY29udGV4dCAqaHVuZ19jdHggPSBycS0+
Z2VtX2NvbnRleHQ7CiAKLQlsb2NrZGVwX2Fzc2VydF9oZWxkKCZlbmdpbmUtPmFjdGl2ZS5sb2Nr
KTsKLQogCWlmICghaTkxNV9yZXF1ZXN0X2lzX2FjdGl2ZShycSkpCiAJCXJldHVybjsKIAorCWxv
Y2tkZXBfYXNzZXJ0X2hlbGQoJmVuZ2luZS0+YWN0aXZlLmxvY2spOwogCWxpc3RfZm9yX2VhY2hf
ZW50cnlfY29udGludWUocnEsICZlbmdpbmUtPmFjdGl2ZS5yZXF1ZXN0cywgc2NoZWQubGluaykK
IAkJaWYgKHJxLT5nZW1fY29udGV4dCA9PSBodW5nX2N0eCkKIAkJCWk5MTVfcmVxdWVzdF9za2lw
KHJxLCAtRUlPKTsKQEAgLTEyMyw3ICsxMjIsNiBAQCB2b2lkIF9faTkxNV9yZXF1ZXN0X3Jlc2V0
KHN0cnVjdCBpOTE1X3JlcXVlc3QgKnJxLCBib29sIGd1aWx0eSkKIAkJICBycS0+ZmVuY2Uuc2Vx
bm8sCiAJCSAgeWVzbm8oZ3VpbHR5KSk7CiAKLQlsb2NrZGVwX2Fzc2VydF9oZWxkKCZycS0+ZW5n
aW5lLT5hY3RpdmUubG9jayk7CiAJR0VNX0JVR19PTihpOTE1X3JlcXVlc3RfY29tcGxldGVkKHJx
KSk7CiAKIAlpZiAoZ3VpbHR5KSB7Ci0tIAoyLjIzLjAKCl9fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fCkludGVsLWdmeCBtYWlsaW5nIGxpc3QKSW50ZWwtZ2Z4
QGxpc3RzLmZyZWVkZXNrdG9wLm9yZwpodHRwczovL2xpc3RzLmZyZWVkZXNrdG9wLm9yZy9tYWls
bWFuL2xpc3RpbmZvL2ludGVsLWdmeA==

Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 66C41B0EF6
	for <lists+intel-gfx@lfdr.de>; Thu, 12 Sep 2019 14:38:53 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id CDF946ED1F;
	Thu, 12 Sep 2019 12:38:51 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from mga03.intel.com (mga03.intel.com [134.134.136.65])
 by gabe.freedesktop.org (Postfix) with ESMTPS id EEC146ED1F
 for <intel-gfx@lists.freedesktop.org>; Thu, 12 Sep 2019 12:38:49 +0000 (UTC)
X-Amp-Result: SKIPPED(no attachment in message)
X-Amp-File-Uploaded: False
Received: from fmsmga007.fm.intel.com ([10.253.24.52])
 by orsmga103.jf.intel.com with ESMTP/TLS/DHE-RSA-AES256-GCM-SHA384;
 12 Sep 2019 05:38:48 -0700
X-ExtLoop1: 1
X-IronPort-AV: E=Sophos;i="5.64,497,1559545200"; d="scan'208";a="186118448"
Received: from avrahamr-mobl1.ger.corp.intel.com (HELO [10.252.3.203])
 ([10.252.3.203])
 by fmsmga007.fm.intel.com with ESMTP; 12 Sep 2019 05:38:47 -0700
To: Chris Wilson <chris@chris-wilson.co.uk>, intel-gfx@lists.freedesktop.org
References: <20190911163815.11430-1-chris@chris-wilson.co.uk>
 <20190912113233.14910-1-chris@chris-wilson.co.uk>
From: Tvrtko Ursulin <tvrtko.ursulin@linux.intel.com>
Organization: Intel Corporation UK Plc
Message-ID: <21edca05-027b-808b-6e69-1b0722f69294@linux.intel.com>
Date: Thu, 12 Sep 2019 13:38:47 +0100
User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:60.0) Gecko/20100101
 Thunderbird/60.8.0
MIME-Version: 1.0
In-Reply-To: <20190912113233.14910-1-chris@chris-wilson.co.uk>
Content-Language: en-US
Subject: Re: [Intel-gfx] [PATCH v7] drm/i915/pmu: Use GT parked for
 estimating RC6 while asleep
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Transfer-Encoding: base64
Content-Type: text/plain; charset="utf-8"; Format="flowed"
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

Ck9uIDEyLzA5LzIwMTkgMTI6MzIsIENocmlzIFdpbHNvbiB3cm90ZToKPiBBcyB3ZSB0cmFjayB3
aGVuIHdlIHB1dCB0aGUgR1QgZGV2aWNlIHRvIHNsZWVwIHVwb24gaWRsaW5nLCB3ZSBjYW4gdXNl
Cj4gdGhhdCBjYWxsYmFjayB0byBzYW1wbGUgdGhlIGN1cnJlbnQgcmM2IGNvdW50ZXJzIGFuZCBy
ZWNvcmQgdGhlCj4gdGltZXN0YW1wIGZvciBlc3RpbWF0aW5nIHNhbXBsZXMgYWZ0ZXIgdGhhdCBw
b2ludCB3aGlsZSBhc2xlZXAuCj4gCj4gdjI6IFN0aWNrIHRvIHVzaW5nIGt0aW1lX3QKPiB2Mzog
VHJhY2sgdXNlcl93YWtlcmVmcyB0aGF0IGludGVyZmVyZSB3aXRoIHRoZSBuZXcKPiBpbnRlbF9n
dF9wbV93YWl0X2Zvcl9pZGxlCj4gdjQ6IE5vIG5lZWQgZm9yIHBhcmtlZC91bnBhcmtlZCBlc3Rp
bWF0aW9uIGlmICFDT05GSUdfUE0KPiB2NTogS2VlcCB0aW1lciBwYXJrL3VucGFyayBsb2dpYyBh
cyB3YXMKPiB2NjogUmVmYWN0b3IgZHVwbGljYXRlZCBlc3RpbWF0ZS91cGRhdGUgcmM2IGxvZ2lj
Cj4gdjc6IFB1bGwgaW50ZWxfZ2V0X3BtX2dldF9pZl9hd2FrZSgpIG91dCBmcm9tIHRoZSBwbXUt
PmxvY2suCj4gCj4gQnVnemlsbGE6IGh0dHBzOi8vYnVncy5mcmVlZGVza3RvcC5vcmcvc2hvd19i
dWcuY2dpP2lkPTEwNTAxMAo+IFNpZ25lZC1vZmYtYnk6IENocmlzIFdpbHNvbiA8Y2hyaXNAY2hy
aXMtd2lsc29uLmNvLnVrPgo+IENjOiBUdnJ0a28gVXJzdWxpbiA8dHZydGtvLnVyc3VsaW5AaW50
ZWwuY29tPgo+IC0tLQo+ICAgZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX3BtLmMg
ICB8ICAyMiArKwo+ICAgZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfZ3RfdHlwZXMuaCB8
ICAgMSArCj4gICBkcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2RlYnVnZnMuYyAgICAgIHwgIDIy
ICstCj4gICBkcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3BtdS5jICAgICAgICAgIHwgMjQ0ICsr
KysrKysrKysrKystLS0tLS0tLS0tCj4gICBkcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3BtdS5o
ICAgICAgICAgIHwgICA0ICstCj4gICA1IGZpbGVzIGNoYW5nZWQsIDE3MSBpbnNlcnRpb25zKCsp
LCAxMjIgZGVsZXRpb25zKC0pCj4gCj4gZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1
L2dlbS9pOTE1X2dlbV9wbS5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX3Bt
LmMKPiBpbmRleCAzYmQ3NjQxMDRkNDEuLmExMWFkNGQ5MTRjYSAxMDA2NDQKPiAtLS0gYS9kcml2
ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fcG0uYwo+ICsrKyBiL2RyaXZlcnMvZ3B1L2Ry
bS9pOTE1L2dlbS9pOTE1X2dlbV9wbS5jCj4gQEAgLTE0MSw2ICsxNDEsMjQgQEAgYm9vbCBpOTE1
X2dlbV9sb2FkX3Bvd2VyX2NvbnRleHQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpCj4g
ICAJcmV0dXJuIHN3aXRjaF90b19rZXJuZWxfY29udGV4dF9zeW5jKCZpOTE1LT5ndCk7Cj4gICB9
Cj4gICAKPiArc3RhdGljIHZvaWQgdXNlcl9mb3JjZXdha2Uoc3RydWN0IGludGVsX2d0ICpndCwg
Ym9vbCBzdXNwZW5kKQo+ICt7Cj4gKwlpbnQgY291bnQgPSBhdG9taWNfcmVhZCgmZ3QtPnVzZXJf
d2FrZXJlZik7Cj4gKwo+ICsJLyogSW5zaWRlIHN1c3BlbmQvcmVzdW1lIHNvIHNpbmdsZSB0aHJl
YWRlZCwgbm8gcmFjZXMgdG8gd29ycnkgYWJvdXQuICovCj4gKwlpZiAobGlrZWx5KCFjb3VudCkp
Cj4gKwkJcmV0dXJuOwo+ICsKPiArCWludGVsX2d0X3BtX2dldChndCk7Cj4gKwlpZiAoc3VzcGVu
ZCkgewo+ICsJCUdFTV9CVUdfT04oY291bnQgPiBhdG9taWNfcmVhZCgmZ3QtPndha2VyZWYuY291
bnQpKTsKPiArCQlhdG9taWNfc3ViKGNvdW50LCAmZ3QtPndha2VyZWYuY291bnQpOwo+ICsJfSBl
bHNlIHsKPiArCQlhdG9taWNfYWRkKGNvdW50LCAmZ3QtPndha2VyZWYuY291bnQpOwo+ICsJfQo+
ICsJaW50ZWxfZ3RfcG1fcHV0KGd0KTsKPiArfQo+ICsKPiAgIHZvaWQgaTkxNV9nZW1fc3VzcGVu
ZChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkKPiAgIHsKPiAgIAlHRU1fVFJBQ0UoIlxu
Iik7Cj4gQEAgLTE0OCw2ICsxNjYsOCBAQCB2b2lkIGk5MTVfZ2VtX3N1c3BlbmQoc3RydWN0IGRy
bV9pOTE1X3ByaXZhdGUgKmk5MTUpCj4gICAJaW50ZWxfd2FrZXJlZl9hdXRvKCZpOTE1LT5nZ3R0
LnVzZXJmYXVsdF93YWtlcmVmLCAwKTsKPiAgIAlmbHVzaF93b3JrcXVldWUoaTkxNS0+d3EpOwo+
ICAgCj4gKwl1c2VyX2ZvcmNld2FrZSgmaTkxNS0+Z3QsIHRydWUpOwo+ICsKPiAgIAltdXRleF9s
b2NrKCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsKPiAgIAo+ICAgCS8qCj4gQEAgLTI1OSw2ICsy
NzksOCBAQCB2b2lkIGk5MTVfZ2VtX3Jlc3VtZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkx
NSkKPiAgIAlpZiAoIWk5MTVfZ2VtX2xvYWRfcG93ZXJfY29udGV4dChpOTE1KSkKPiAgIAkJZ290
byBlcnJfd2VkZ2VkOwo+ICAgCj4gKwl1c2VyX2ZvcmNld2FrZSgmaTkxNS0+Z3QsIGZhbHNlKTsK
PiArCj4gICBvdXRfdW5sb2NrOgo+ICAgCWludGVsX3VuY29yZV9mb3JjZXdha2VfcHV0KCZpOTE1
LT51bmNvcmUsIEZPUkNFV0FLRV9BTEwpOwo+ICAgCW11dGV4X3VubG9jaygmaTkxNS0+ZHJtLnN0
cnVjdF9tdXRleCk7Cj4gZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVs
X2d0X3R5cGVzLmggYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9ndF90eXBlcy5oCj4g
aW5kZXggZGMyOTVjMTk2ZDExLi4zMDM5Y2VmNjRiMTEgMTAwNjQ0Cj4gLS0tIGEvZHJpdmVycy9n
cHUvZHJtL2k5MTUvZ3QvaW50ZWxfZ3RfdHlwZXMuaAo+ICsrKyBiL2RyaXZlcnMvZ3B1L2RybS9p
OTE1L2d0L2ludGVsX2d0X3R5cGVzLmgKPiBAQCAtNTAsNiArNTAsNyBAQCBzdHJ1Y3QgaW50ZWxf
Z3Qgewo+ICAgCX0gdGltZWxpbmVzOwo+ICAgCj4gICAJc3RydWN0IGludGVsX3dha2VyZWYgd2Fr
ZXJlZjsKPiArCWF0b21pY190IHVzZXJfd2FrZXJlZjsKPiAgIAo+ICAgCXN0cnVjdCBsaXN0X2hl
YWQgY2xvc2VkX3ZtYTsKPiAgIAlzcGlubG9ja190IGNsb3NlZF9sb2NrOyAvKiBndWFyZHMgdGhl
IGxpc3Qgb2YgY2xvc2VkX3ZtYSAqLwo+IGRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkx
NS9pOTE1X2RlYnVnZnMuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZGVidWdmcy5jCj4g
aW5kZXggZTU4MzUzMzdmMDIyLi5mM2FlNTI1Yjc3YzAgMTAwNjQ0Cj4gLS0tIGEvZHJpdmVycy9n
cHUvZHJtL2k5MTUvaTkxNV9kZWJ1Z2ZzLmMKPiArKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9p
OTE1X2RlYnVnZnMuYwo+IEBAIC0zOTk1LDEzICszOTk1LDEyIEBAIHN0YXRpYyBpbnQgaTkxNV9z
c2V1X3N0YXR1cyhzdHJ1Y3Qgc2VxX2ZpbGUgKm0sIHZvaWQgKnVudXNlZCkKPiAgIHN0YXRpYyBp
bnQgaTkxNV9mb3JjZXdha2Vfb3BlbihzdHJ1Y3QgaW5vZGUgKmlub2RlLCBzdHJ1Y3QgZmlsZSAq
ZmlsZSkKPiAgIHsKPiAgIAlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IGlub2RlLT5p
X3ByaXZhdGU7Cj4gKwlzdHJ1Y3QgaW50ZWxfZ3QgKmd0ID0gJmk5MTUtPmd0Owo+ICAgCj4gLQlp
ZiAoSU5URUxfR0VOKGk5MTUpIDwgNikKPiAtCQlyZXR1cm4gMDsKPiAtCj4gLQlmaWxlLT5wcml2
YXRlX2RhdGEgPQo+IC0JCSh2b2lkICopKHVpbnRwdHJfdClpbnRlbF9ydW50aW1lX3BtX2dldCgm
aTkxNS0+cnVudGltZV9wbSk7Cj4gLQlpbnRlbF91bmNvcmVfZm9yY2V3YWtlX3VzZXJfZ2V0KCZp
OTE1LT51bmNvcmUpOwo+ICsJYXRvbWljX2luYygmZ3QtPnVzZXJfd2FrZXJlZik7Cj4gKwlpbnRl
bF9ndF9wbV9nZXQoZ3QpOwo+ICsJaWYgKElOVEVMX0dFTihpOTE1KSA+PSA2KQo+ICsJCWludGVs
X3VuY29yZV9mb3JjZXdha2VfdXNlcl9nZXQoZ3QtPnVuY29yZSk7Cj4gICAKPiAgIAlyZXR1cm4g
MDsKPiAgIH0KPiBAQCAtNDAwOSwxMyArNDAwOCwxMiBAQCBzdGF0aWMgaW50IGk5MTVfZm9yY2V3
YWtlX29wZW4oc3RydWN0IGlub2RlICppbm9kZSwgc3RydWN0IGZpbGUgKmZpbGUpCj4gICBzdGF0
aWMgaW50IGk5MTVfZm9yY2V3YWtlX3JlbGVhc2Uoc3RydWN0IGlub2RlICppbm9kZSwgc3RydWN0
IGZpbGUgKmZpbGUpCj4gICB7Cj4gICAJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSBp
bm9kZS0+aV9wcml2YXRlOwo+ICsJc3RydWN0IGludGVsX2d0ICpndCA9ICZpOTE1LT5ndDsKPiAg
IAo+IC0JaWYgKElOVEVMX0dFTihpOTE1KSA8IDYpCj4gLQkJcmV0dXJuIDA7Cj4gLQo+IC0JaW50
ZWxfdW5jb3JlX2ZvcmNld2FrZV91c2VyX3B1dCgmaTkxNS0+dW5jb3JlKTsKPiAtCWludGVsX3J1
bnRpbWVfcG1fcHV0KCZpOTE1LT5ydW50aW1lX3BtLAo+IC0JCQkgICAgIChpbnRlbF93YWtlcmVm
X3QpKHVpbnRwdHJfdClmaWxlLT5wcml2YXRlX2RhdGEpOwo+ICsJaWYgKElOVEVMX0dFTihpOTE1
KSA+PSA2KQo+ICsJCWludGVsX3VuY29yZV9mb3JjZXdha2VfdXNlcl9wdXQoJmk5MTUtPnVuY29y
ZSk7Cj4gKwlpbnRlbF9ndF9wbV9wdXQoZ3QpOwo+ICsJYXRvbWljX2RlYygmZ3QtPnVzZXJfd2Fr
ZXJlZik7Cj4gICAKPiAgIAlyZXR1cm4gMDsKPiAgIH0KPiBkaWZmIC0tZ2l0IGEvZHJpdmVycy9n
cHUvZHJtL2k5MTUvaTkxNV9wbXUuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfcG11LmMK
PiBpbmRleCA4ZTI1MWU3MTkzOTAuLmU2MzY0OWI4NjkxNSAxMDA2NDQKPiAtLS0gYS9kcml2ZXJz
L2dwdS9kcm0vaTkxNS9pOTE1X3BtdS5jCj4gKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkx
NV9wbXUuYwo+IEBAIC0xMTYsMjIgKzExNiwxMjQgQEAgc3RhdGljIGJvb2wgcG11X25lZWRzX3Rp
bWVyKHN0cnVjdCBpOTE1X3BtdSAqcG11LCBib29sIGdwdV9hY3RpdmUpCj4gICAJcmV0dXJuIGVu
YWJsZTsKPiAgIH0KPiAgIAo+IC12b2lkIGk5MTVfcG11X2d0X3BhcmtlZChzdHJ1Y3QgZHJtX2k5
MTVfcHJpdmF0ZSAqaTkxNSkKPiArc3RhdGljIHU2NCBfX2dldF9yYzYoY29uc3Qgc3RydWN0IGlu
dGVsX2d0ICpndCkKPiAgIHsKPiArCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0gZ3Qt
Pmk5MTU7Cj4gKwl1NjQgdmFsOwo+ICsKPiArCXZhbCA9IGludGVsX3JjNl9yZXNpZGVuY3lfbnMo
aTkxNSwKPiArCQkJCSAgICAgSVNfVkFMTEVZVklFVyhpOTE1KSA/Cj4gKwkJCQkgICAgIFZMVl9H
VF9SRU5ERVJfUkM2IDoKPiArCQkJCSAgICAgR0VONl9HVF9HRlhfUkM2KTsKPiArCj4gKwlpZiAo
SEFTX1JDNnAoaTkxNSkpCj4gKwkJdmFsICs9IGludGVsX3JjNl9yZXNpZGVuY3lfbnMoaTkxNSwg
R0VONl9HVF9HRlhfUkM2cCk7Cj4gKwo+ICsJaWYgKEhBU19SQzZwcChpOTE1KSkKPiArCQl2YWwg
Kz0gaW50ZWxfcmM2X3Jlc2lkZW5jeV9ucyhpOTE1LCBHRU42X0dUX0dGWF9SQzZwcCk7Cj4gKwo+
ICsJcmV0dXJuIHZhbDsKPiArfQo+ICsKPiArI2lmIElTX0VOQUJMRUQoQ09ORklHX1BNKQo+ICsK
PiArc3RhdGljIGlubGluZSBzNjQga3RpbWVfc2luY2UoY29uc3Qga3RpbWVfdCBrdCkKPiArewo+
ICsJcmV0dXJuIGt0aW1lX3RvX25zKGt0aW1lX3N1YihrdGltZV9nZXQoKSwga3QpKTsKPiArfQo+
ICsKPiArc3RhdGljIHU2NCBfX3BtdV9lc3RpbWF0ZV9yYzYoc3RydWN0IGk5MTVfcG11ICpwbXUp
Cj4gK3sKPiArCXU2NCB2YWw7Cj4gKwo+ICsJdmFsID0ga3RpbWVfc2luY2UocG11LT5zbGVlcF9s
YXN0KTsKPiArCXZhbCArPSBwbXUtPnNhbXBsZVtfX0k5MTVfU0FNUExFX1JDNl0uY3VyOwo+ICsK
PiArCXBtdS0+c2FtcGxlW19fSTkxNV9TQU1QTEVfUkM2X0VTVElNQVRFRF0uY3VyID0gdmFsOwo+
ICsKPiArCXJldHVybiB2YWw7Cj4gK30KPiArCj4gK3N0YXRpYyB1NjQgX19wbXVfdXBkYXRlX3Jj
NihzdHJ1Y3QgaTkxNV9wbXUgKnBtdSwgdTY0IHZhbCkKPiArewo+ICsJaWYgKHZhbCA+PSBwbXUt
PnNhbXBsZVtfX0k5MTVfU0FNUExFX1JDNl9FU1RJTUFURURdLmN1cikgewo+ICsJCXBtdS0+c2Ft
cGxlW19fSTkxNV9TQU1QTEVfUkM2X0VTVElNQVRFRF0uY3VyID0gMDsKPiArCQlwbXUtPnNhbXBs
ZVtfX0k5MTVfU0FNUExFX1JDNl0uY3VyID0gdmFsOwo+ICsJfSBlbHNlIHsKPiArCQl2YWwgPSBw
bXUtPnNhbXBsZVtfX0k5MTVfU0FNUExFX1JDNl9FU1RJTUFURURdLmN1cjsKPiArCX0KPiArCj4g
KwlyZXR1cm4gdmFsOwo+ICt9Cj4gKwo+ICtzdGF0aWMgdTY0IGdldF9yYzYoc3RydWN0IGludGVs
X2d0ICpndCkKPiArewo+ICsJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSBndC0+aTkx
NTsKPiAgIAlzdHJ1Y3QgaTkxNV9wbXUgKnBtdSA9ICZpOTE1LT5wbXU7Cj4gKwl1bnNpZ25lZCBs
b25nIGZsYWdzOwo+ICsJdTY0IHZhbDsKPiAgIAo+IC0JaWYgKCFwbXUtPmJhc2UuZXZlbnRfaW5p
dCkKPiAtCQlyZXR1cm47Cj4gKwl2YWwgPSAwOwo+ICsJaWYgKGludGVsX2d0X3BtX2dldF9pZl9h
d2FrZShndCkpIHsKPiArCQl2YWwgPSBfX2dldF9yYzYoZ3QpOwo+ICsJCWludGVsX2d0X3BtX3B1
dChndCk7Cj4gKwl9Cj4gICAKPiAtCXNwaW5fbG9ja19pcnEoJnBtdS0+bG9jayk7Cj4gLQkvKgo+
IC0JICogU2lnbmFsIHNhbXBsaW5nIHRpbWVyIHRvIHN0b3AgaWYgb25seSBlbmdpbmUgZXZlbnRz
IGFyZSBlbmFibGVkIGFuZAo+IC0JICogR1BVIHdlbnQgaWRsZS4KPiAtCSAqLwo+IC0JcG11LT50
aW1lcl9lbmFibGVkID0gcG11X25lZWRzX3RpbWVyKHBtdSwgZmFsc2UpOwo+IC0Jc3Bpbl91bmxv
Y2tfaXJxKCZwbXUtPmxvY2spOwo+ICsJc3Bpbl9sb2NrX2lycXNhdmUoJnBtdS0+bG9jaywgZmxh
Z3MpOwo+ICsKPiArCWlmICh2YWwpCj4gKwkJLyoKPiArCQkgKiBJZiB3ZSBhcmUgY29taW5nIGJh
Y2sgZnJvbSBiZWluZyBydW50aW1lIHN1c3BlbmRlZCB3ZSBtdXN0Cj4gKwkJICogYmUgY2FyZWZ1
bCBub3QgdG8gcmVwb3J0IGEgbGFyZ2VyIHZhbHVlIHRoYW4gcmV0dXJuZWQKPiArCQkgKiBwcmV2
aW91c2x5Lgo+ICsJCSAqLwoKVGhlIGNvbW1lbnQgaXMgYSBiaXQgZGlzbG9jYXRlZCBmcm9tIHRo
ZSBsb2dpYyBzbyBmZWVscyBpdCB3b3VsZCBiZXR0ZXIgCmdvIGludG8gX19wbXVfdXBkYXRlX3Jj
Ni4KCj4gKwkJdmFsID0gX19wbXVfdXBkYXRlX3JjNihwbXUsIHZhbCk7Cj4gKwllbHNlCj4gKwkJ
LyoKPiArCQkgKiBXZSB3ZXJlIHJ1bnRpbWUgc3VzcGVuZGVkLgoKcy93ZXJlL2FyZS8sIG9yIG1h
eWJlIGl0IGlzICJ0aGluayB3ZSBhcmUiLiA6KQoKPiArCQkgKgo+ICsJCSAqIFJlcG9ydCB0aGUg
ZGVsdGEgZnJvbSB3aGVuIHRoZSBkZXZpY2Ugd2FzIHN1c3BlbmRlZCB0byBub3csCj4gKwkJICog
b24gdG9wIG9mIHRoZSBsYXN0IGtub3duIHJlYWwgdmFsdWUsIGFzIHRoZSBhcHByb3hpbWF0ZWQg
UkM2Cj4gKwkJICogY291bnRlciB2YWx1ZS4KPiArCQkgKi8KPiArCQl2YWwgPSBfX3BtdV9lc3Rp
bWF0ZV9yYzYocG11KTsKPiArCj4gKwlzcGluX3VubG9ja19pcnFyZXN0b3JlKCZwbXUtPmxvY2ss
IGZsYWdzKTsKPiArCj4gKwlyZXR1cm4gdmFsOwo+ICt9Cj4gKwo+ICtzdGF0aWMgdm9pZCBwYXJr
X3JjNihzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkKPiArewo+ICsJc3RydWN0IGk5MTVf
cG11ICpwbXUgPSAmaTkxNS0+cG11Owo+ICsKPiArCWlmIChwbXUtPmVuYWJsZSAmIGNvbmZpZ19l
bmFibGVkX21hc2soSTkxNV9QTVVfUkM2X1JFU0lERU5DWSkpCj4gKwkJX19wbXVfdXBkYXRlX3Jj
NihwbXUsIF9fZ2V0X3JjNigmaTkxNS0+Z3QpKTsKPiArCj4gKwlwbXUtPnNsZWVwX2xhc3QgPSBr
dGltZV9nZXQoKTsKPiArfQo+ICsKPiArc3RhdGljIHZvaWQgdW5wYXJrX3JjNihzdHJ1Y3QgZHJt
X2k5MTVfcHJpdmF0ZSAqaTkxNSkKPiArewo+ICsJc3RydWN0IGk5MTVfcG11ICpwbXUgPSAmaTkx
NS0+cG11Owo+ICsKPiArCS8qIEVzdGltYXRlIGhvdyBsb25nIHdlIHNsZXB0IGFuZCBhY2N1bXVs
YXRlIHRoYXQgaW50byByYzYgY291bnRlcnMgKi8KPiArCWlmIChwbXUtPmVuYWJsZSAmIGNvbmZp
Z19lbmFibGVkX21hc2soSTkxNV9QTVVfUkM2X1JFU0lERU5DWSkpCj4gKwkJX19wbXVfZXN0aW1h
dGVfcmM2KHBtdSk7Cj4gK30KPiArCj4gKyNlbHNlCj4gKwo+ICtzdGF0aWMgdTY0IGdldF9yYzYo
c3RydWN0IGludGVsX2d0ICpndCkKPiArewo+ICsJcmV0dXJuIF9fZ2V0X3JjNihndCk7Cj4gICB9
Cj4gICAKPiArc3RhdGljIHZvaWQgcGFya19yYzYoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5
MTUpIHt9Owo+ICtzdGF0aWMgdm9pZCB1bnBhcmtfcmM2KHN0cnVjdCBkcm1faTkxNV9wcml2YXRl
ICppOTE1KSB7fTsKPiArCj4gKyNlbmRpZgo+ICsKPiAgIHN0YXRpYyB2b2lkIF9faTkxNV9wbXVf
bWF5YmVfc3RhcnRfdGltZXIoc3RydWN0IGk5MTVfcG11ICpwbXUpCj4gICB7Cj4gICAJaWYgKCFw
bXUtPnRpbWVyX2VuYWJsZWQgJiYgcG11X25lZWRzX3RpbWVyKHBtdSwgdHJ1ZSkpIHsKPiBAQCAt
MTQzLDYgKzI0NSwyNiBAQCBzdGF0aWMgdm9pZCBfX2k5MTVfcG11X21heWJlX3N0YXJ0X3RpbWVy
KHN0cnVjdCBpOTE1X3BtdSAqcG11KQo+ICAgCX0KPiAgIH0KPiAgIAo+ICt2b2lkIGk5MTVfcG11
X2d0X3BhcmtlZChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkKPiArewo+ICsJc3RydWN0
IGk5MTVfcG11ICpwbXUgPSAmaTkxNS0+cG11Owo+ICsKPiArCWlmICghcG11LT5iYXNlLmV2ZW50
X2luaXQpCj4gKwkJcmV0dXJuOwo+ICsKPiArCXNwaW5fbG9ja19pcnEoJnBtdS0+bG9jayk7Cj4g
Kwo+ICsJcGFya19yYzYoaTkxNSk7Cj4gKwo+ICsJLyoKPiArCSAqIFNpZ25hbCBzYW1wbGluZyB0
aW1lciB0byBzdG9wIGlmIG9ubHkgZW5naW5lIGV2ZW50cyBhcmUgZW5hYmxlZCBhbmQKPiArCSAq
IEdQVSB3ZW50IGlkbGUuCj4gKwkgKi8KPiArCXBtdS0+dGltZXJfZW5hYmxlZCA9IHBtdV9uZWVk
c190aW1lcihwbXUsIGZhbHNlKTsKPiArCj4gKwlzcGluX3VubG9ja19pcnEoJnBtdS0+bG9jayk7
Cj4gK30KPiArCj4gICB2b2lkIGk5MTVfcG11X2d0X3VucGFya2VkKHN0cnVjdCBkcm1faTkxNV9w
cml2YXRlICppOTE1KQo+ICAgewo+ICAgCXN0cnVjdCBpOTE1X3BtdSAqcG11ID0gJmk5MTUtPnBt
dTsKPiBAQCAtMTUxLDEwICsyNzMsMTQgQEAgdm9pZCBpOTE1X3BtdV9ndF91bnBhcmtlZChzdHJ1
Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkKPiAgIAkJcmV0dXJuOwo+ICAgCj4gICAJc3Bpbl9s
b2NrX2lycSgmcG11LT5sb2NrKTsKPiArCj4gICAJLyoKPiAgIAkgKiBSZS1lbmFibGUgc2FtcGxp
bmcgdGltZXIgd2hlbiBHUFUgZ29lcyBhY3RpdmUuCj4gICAJICovCj4gICAJX19pOTE1X3BtdV9t
YXliZV9zdGFydF90aW1lcihwbXUpOwo+ICsKPiArCXVucGFya19yYzYoaTkxNSk7Cj4gKwo+ICAg
CXNwaW5fdW5sb2NrX2lycSgmcG11LT5sb2NrKTsKPiAgIH0KPiAgIAo+IEBAIC00MjYsMTA0ICs1
NTIsNiBAQCBzdGF0aWMgaW50IGk5MTVfcG11X2V2ZW50X2luaXQoc3RydWN0IHBlcmZfZXZlbnQg
KmV2ZW50KQo+ICAgCXJldHVybiAwOwo+ICAgfQo+ICAgCj4gLXN0YXRpYyB1NjQgX19nZXRfcmM2
KHN0cnVjdCBpbnRlbF9ndCAqZ3QpCj4gLXsKPiAtCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpp
OTE1ID0gZ3QtPmk5MTU7Cj4gLQl1NjQgdmFsOwo+IC0KPiAtCXZhbCA9IGludGVsX3JjNl9yZXNp
ZGVuY3lfbnMoaTkxNSwKPiAtCQkJCSAgICAgSVNfVkFMTEVZVklFVyhpOTE1KSA/Cj4gLQkJCQkg
ICAgIFZMVl9HVF9SRU5ERVJfUkM2IDoKPiAtCQkJCSAgICAgR0VONl9HVF9HRlhfUkM2KTsKPiAt
Cj4gLQlpZiAoSEFTX1JDNnAoaTkxNSkpCj4gLQkJdmFsICs9IGludGVsX3JjNl9yZXNpZGVuY3lf
bnMoaTkxNSwgR0VONl9HVF9HRlhfUkM2cCk7Cj4gLQo+IC0JaWYgKEhBU19SQzZwcChpOTE1KSkK
PiAtCQl2YWwgKz0gaW50ZWxfcmM2X3Jlc2lkZW5jeV9ucyhpOTE1LCBHRU42X0dUX0dGWF9SQzZw
cCk7Cj4gLQo+IC0JcmV0dXJuIHZhbDsKPiAtfQo+IC0KPiAtc3RhdGljIHU2NCBnZXRfcmM2KHN0
cnVjdCBpbnRlbF9ndCAqZ3QpCj4gLXsKPiAtI2lmIElTX0VOQUJMRUQoQ09ORklHX1BNKQo+IC0J
c3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSBndC0+aTkxNTsKPiAtCXN0cnVjdCBpbnRl
bF9ydW50aW1lX3BtICpycG0gPSAmaTkxNS0+cnVudGltZV9wbTsKPiAtCXN0cnVjdCBpOTE1X3Bt
dSAqcG11ID0gJmk5MTUtPnBtdTsKPiAtCWludGVsX3dha2VyZWZfdCB3YWtlcmVmOwo+IC0JdW5z
aWduZWQgbG9uZyBmbGFnczsKPiAtCXU2NCB2YWw7Cj4gLQo+IC0Jd2FrZXJlZiA9IGludGVsX3J1
bnRpbWVfcG1fZ2V0X2lmX2luX3VzZShycG0pOwo+IC0JaWYgKHdha2VyZWYpIHsKPiAtCQl2YWwg
PSBfX2dldF9yYzYoZ3QpOwo+IC0JCWludGVsX3J1bnRpbWVfcG1fcHV0KHJwbSwgd2FrZXJlZik7
Cj4gLQo+IC0JCS8qCj4gLQkJICogSWYgd2UgYXJlIGNvbWluZyBiYWNrIGZyb20gYmVpbmcgcnVu
dGltZSBzdXNwZW5kZWQgd2UgbXVzdAo+IC0JCSAqIGJlIGNhcmVmdWwgbm90IHRvIHJlcG9ydCBh
IGxhcmdlciB2YWx1ZSB0aGFuIHJldHVybmVkCj4gLQkJICogcHJldmlvdXNseS4KPiAtCQkgKi8K
PiAtCj4gLQkJc3Bpbl9sb2NrX2lycXNhdmUoJnBtdS0+bG9jaywgZmxhZ3MpOwo+IC0KPiAtCQlp
ZiAodmFsID49IHBtdS0+c2FtcGxlW19fSTkxNV9TQU1QTEVfUkM2X0VTVElNQVRFRF0uY3VyKSB7
Cj4gLQkJCXBtdS0+c2FtcGxlW19fSTkxNV9TQU1QTEVfUkM2X0VTVElNQVRFRF0uY3VyID0gMDsK
PiAtCQkJcG11LT5zYW1wbGVbX19JOTE1X1NBTVBMRV9SQzZdLmN1ciA9IHZhbDsKPiAtCQl9IGVs
c2Ugewo+IC0JCQl2YWwgPSBwbXUtPnNhbXBsZVtfX0k5MTVfU0FNUExFX1JDNl9FU1RJTUFURURd
LmN1cjsKPiAtCQl9Cj4gLQo+IC0JCXNwaW5fdW5sb2NrX2lycXJlc3RvcmUoJnBtdS0+bG9jaywg
ZmxhZ3MpOwo+IC0JfSBlbHNlIHsKPiAtCQlzdHJ1Y3QgZGV2aWNlICprZGV2ID0gcnBtLT5rZGV2
Owo+IC0KPiAtCQkvKgo+IC0JCSAqIFdlIGFyZSBydW50aW1lIHN1c3BlbmRlZC4KPiAtCQkgKgo+
IC0JCSAqIFJlcG9ydCB0aGUgZGVsdGEgZnJvbSB3aGVuIHRoZSBkZXZpY2Ugd2FzIHN1c3BlbmRl
ZCB0byBub3csCj4gLQkJICogb24gdG9wIG9mIHRoZSBsYXN0IGtub3duIHJlYWwgdmFsdWUsIGFz
IHRoZSBhcHByb3hpbWF0ZWQgUkM2Cj4gLQkJICogY291bnRlciB2YWx1ZS4KPiAtCQkgKi8KPiAt
CQlzcGluX2xvY2tfaXJxc2F2ZSgmcG11LT5sb2NrLCBmbGFncyk7Cj4gLQo+IC0JCS8qCj4gLQkJ
ICogQWZ0ZXIgdGhlIGFib3ZlIGJyYW5jaCBpbnRlbF9ydW50aW1lX3BtX2dldF9pZl9pbl91c2Ug
ZmFpbGVkCj4gLQkJICogdG8gZ2V0IHRoZSBydW50aW1lIFBNIHJlZmVyZW5jZSB3ZSBjYW5ub3Qg
YXNzdW1lIHdlIGFyZSBpbgo+IC0JCSAqIHJ1bnRpbWUgc3VzcGVuZCBzaW5jZSB3ZSBjYW4gZWl0
aGVyOiBhKSByYWNlIHdpdGggY29taW5nIG91dAo+IC0JCSAqIG9mIGl0IGJlZm9yZSB3ZSB0b29r
IHRoZSBwb3dlci5sb2NrLCBvciBiKSB0aGVyZSBhcmUgb3RoZXIKPiAtCQkgKiBzdGF0ZXMgdGhh
biBzdXNwZW5kZWQgd2hpY2ggY2FuIGJyaW5nIHVzIGhlcmUuCj4gLQkJICoKPiAtCQkgKiBXZSBu
ZWVkIHRvIGRvdWJsZS1jaGVjayB0aGF0IHdlIGFyZSBpbmRlZWQgY3VycmVudGx5IHJ1bnRpbWUK
PiAtCQkgKiBzdXNwZW5kZWQgYW5kIGlmIG5vdCB3ZSBjYW5ub3QgZG8gYmV0dGVyIHRoYW4gcmVw
b3J0IHRoZSBsYXN0Cj4gLQkJICoga25vd24gUkM2IHZhbHVlLgo+IC0JCSAqLwo+IC0JCWlmIChw
bV9ydW50aW1lX3N0YXR1c19zdXNwZW5kZWQoa2RldikpIHsKPiAtCQkJdmFsID0gcG1fcnVudGlt
ZV9zdXNwZW5kZWRfdGltZShrZGV2KTsKPiAtCj4gLQkJCWlmICghcG11LT5zYW1wbGVbX19JOTE1
X1NBTVBMRV9SQzZfRVNUSU1BVEVEXS5jdXIpCj4gLQkJCQlwbXUtPnN1c3BlbmRlZF90aW1lX2xh
c3QgPSB2YWw7Cj4gLQo+IC0JCQl2YWwgLT0gcG11LT5zdXNwZW5kZWRfdGltZV9sYXN0Owo+IC0J
CQl2YWwgKz0gcG11LT5zYW1wbGVbX19JOTE1X1NBTVBMRV9SQzZdLmN1cjsKPiAtCj4gLQkJCXBt
dS0+c2FtcGxlW19fSTkxNV9TQU1QTEVfUkM2X0VTVElNQVRFRF0uY3VyID0gdmFsOwo+IC0JCX0g
ZWxzZSBpZiAocG11LT5zYW1wbGVbX19JOTE1X1NBTVBMRV9SQzZfRVNUSU1BVEVEXS5jdXIpIHsK
PiAtCQkJdmFsID0gcG11LT5zYW1wbGVbX19JOTE1X1NBTVBMRV9SQzZfRVNUSU1BVEVEXS5jdXI7
Cj4gLQkJfSBlbHNlIHsKPiAtCQkJdmFsID0gcG11LT5zYW1wbGVbX19JOTE1X1NBTVBMRV9SQzZd
LmN1cjsKPiAtCQl9Cj4gLQo+IC0JCXNwaW5fdW5sb2NrX2lycXJlc3RvcmUoJnBtdS0+bG9jaywg
ZmxhZ3MpOwo+IC0JfQo+IC0KPiAtCXJldHVybiB2YWw7Cj4gLSNlbHNlCj4gLQlyZXR1cm4gX19n
ZXRfcmM2KGd0KTsKPiAtI2VuZGlmCj4gLX0KPiAtCj4gICBzdGF0aWMgdTY0IF9faTkxNV9wbXVf
ZXZlbnRfcmVhZChzdHJ1Y3QgcGVyZl9ldmVudCAqZXZlbnQpCj4gICB7Cj4gICAJc3RydWN0IGRy
bV9pOTE1X3ByaXZhdGUgKmk5MTUgPQo+IGRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkx
NS9pOTE1X3BtdS5oIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9wbXUuaAo+IGluZGV4IDRm
YzRmMjQ3ODMwMS4uMDY3ZGJiZjNiZGZmIDEwMDY0NAo+IC0tLSBhL2RyaXZlcnMvZ3B1L2RybS9p
OTE1L2k5MTVfcG11LmgKPiArKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3BtdS5oCj4g
QEAgLTk3LDkgKzk3LDkgQEAgc3RydWN0IGk5MTVfcG11IHsKPiAgIAkgKi8KPiAgIAlzdHJ1Y3Qg
aTkxNV9wbXVfc2FtcGxlIHNhbXBsZVtfX0k5MTVfTlVNX1BNVV9TQU1QTEVSU107Cj4gICAJLyoq
Cj4gLQkgKiBAc3VzcGVuZGVkX3RpbWVfbGFzdDogQ2FjaGVkIHN1c3BlbmQgdGltZSBmcm9tIFBN
IGNvcmUuCj4gKwkgKiBAc2xlZXBfbGFzdDogTGFzdCB0aW1lIEdUIHBhcmtlZCBmb3IgUkM2IGVz
dGltYXRpb24uCj4gICAJICovCj4gLQl1NjQgc3VzcGVuZGVkX3RpbWVfbGFzdDsKPiArCWt0aW1l
X3Qgc2xlZXBfbGFzdDsKPiAgIAkvKioKPiAgIAkgKiBAaTkxNV9hdHRyOiBNZW1vcnkgYmxvY2sg
aG9sZGluZyBkZXZpY2UgYXR0cmlidXRlcy4KPiAgIAkgKi8KPiAKClJldmlld2VkLWJ5OiBUdnJ0
a28gVXJzdWxpbiA8dHZydGtvLnVyc3VsaW5AaW50ZWwuY29tPgoKUmVnYXJkcywKClR2cnRrbwpf
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fXwpJbnRlbC1nZngg
bWFpbGluZyBsaXN0CkludGVsLWdmeEBsaXN0cy5mcmVlZGVza3RvcC5vcmcKaHR0cHM6Ly9saXN0
cy5mcmVlZGVza3RvcC5vcmcvbWFpbG1hbi9saXN0aW5mby9pbnRlbC1nZng=

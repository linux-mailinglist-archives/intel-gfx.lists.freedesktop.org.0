Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 44070277E5
	for <lists+intel-gfx@lfdr.de>; Thu, 23 May 2019 10:24:40 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id CC71C89CE1;
	Thu, 23 May 2019 08:24:36 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from mga14.intel.com (mga14.intel.com [192.55.52.115])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 2FC9189CDB
 for <intel-gfx@lists.freedesktop.org>; Thu, 23 May 2019 08:24:28 +0000 (UTC)
X-Amp-Result: SKIPPED(no attachment in message)
X-Amp-File-Uploaded: False
Received: from orsmga001.jf.intel.com ([10.7.209.18])
 by fmsmga103.fm.intel.com with ESMTP/TLS/DHE-RSA-AES256-GCM-SHA384;
 23 May 2019 01:24:28 -0700
X-ExtLoop1: 1
Received: from igivoni-mobl.amr.corp.intel.com (HELO
 ldmartin-desk.amr.corp.intel.com) ([10.255.88.102])
 by orsmga001.jf.intel.com with ESMTP; 23 May 2019 01:24:27 -0700
From: Lucas De Marchi <lucas.demarchi@intel.com>
To: intel-gfx@lists.freedesktop.org
Date: Thu, 23 May 2019 01:24:15 -0700
Message-Id: <20190523082420.10352-5-lucas.demarchi@intel.com>
X-Mailer: git-send-email 2.21.0
In-Reply-To: <20190523082420.10352-1-lucas.demarchi@intel.com>
References: <20190523082420.10352-1-lucas.demarchi@intel.com>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH 05/10] drm/i915/dmc: extract function to parse
 package_header
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Cc: Lucas De Marchi <lucas.demarchi@intel.com>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

TGlrZSBwYXJzZV9jc3JfZndfY3NzKCkgdGhpcyBwYXJzZXMgdGhlIHBhY2thZ2VfaGVhZGVyIGZy
b20gZmlybXdhcmUgYW5kCnNhdmVzIHRoZSByZWxldmFudCBmaWVsZHMgaW4gdGhlIGNzciBzdHJ1
Y3QuIEluIHRoaXMgZnVuY3Rpb24gd2UgYWxzbwpsb29rdXAgdGhlIGZ3X2luZm8gd2UgYXJlIGlu
dGVyZXN0ZWQgaW4uCgpTaWduZWQtb2ZmLWJ5OiBMdWNhcyBEZSBNYXJjaGkgPGx1Y2FzLmRlbWFy
Y2hpQGludGVsLmNvbT4KLS0tCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9pbnRlbF9jc3IuYyB8IDk0
ICsrKysrKysrKysrKysrKysrKystLS0tLS0tLS0tLS0tCiAxIGZpbGUgY2hhbmdlZCwgNTUgaW5z
ZXJ0aW9ucygrKSwgMzkgZGVsZXRpb25zKC0pCgpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJt
L2k5MTUvaW50ZWxfY3NyLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pbnRlbF9jc3IuYwppbmRl
eCA3ZTUzYmY1NzY4OTIuLmIxOTc0MmJlY2I5OCAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJt
L2k5MTUvaW50ZWxfY3NyLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50ZWxfY3NyLmMK
QEAgLTMzMiw2ICszMzIsNTYgQEAgc3RhdGljIHUzMiBmaW5kX2RtY19md19vZmZzZXQoY29uc3Qg
c3RydWN0IGludGVsX2Z3X2luZm8gKmZ3X2luZm8sCiAJcmV0dXJuIGRtY19vZmZzZXQ7CiB9CiAK
K3N0YXRpYyB1MzIKK3BhcnNlX2Nzcl9md19wYWNrYWdlKHN0cnVjdCBpbnRlbF9jc3IgKmNzciwK
KwkJICAgICBjb25zdCBzdHJ1Y3QgaW50ZWxfcGFja2FnZV9oZWFkZXIgKnBhY2thZ2VfaGVhZGVy
LAorCQkgICAgIGNvbnN0IHN0cnVjdCBzdGVwcGluZ19pbmZvICpzaSkKK3sKKwl1MzIgbnVtX2Vu
dHJpZXMsIG1heF9lbnRyaWVzLCBkbWNfb2Zmc2V0LCByOworCWNvbnN0IHN0cnVjdCBpbnRlbF9m
d19pbmZvICpmd19pbmZvOworCisJaWYgKHBhY2thZ2VfaGVhZGVyLT5oZWFkZXJfdmVyID09IDEp
IHsKKwkJbWF4X2VudHJpZXMgPSBQQUNLQUdFX01BWF9GV19JTkZPX0VOVFJJRVM7CisJfSBlbHNl
IGlmIChwYWNrYWdlX2hlYWRlci0+aGVhZGVyX3ZlciA9PSAyKSB7CisJCW1heF9lbnRyaWVzID0g
UEFDS0FHRV9WMl9NQVhfRldfSU5GT19FTlRSSUVTOworCX0gZWxzZSB7CisJCURSTV9FUlJPUigi
RE1DIGZpcm13YXJlIGhhcyB1bmtub3duIGhlYWRlciB2ZXJzaW9uICV1XG4iLAorCQkJICBwYWNr
YWdlX2hlYWRlci0+aGVhZGVyX3Zlcik7CisJCXJldHVybiAwOworCX0KKworCWlmIChwYWNrYWdl
X2hlYWRlci0+aGVhZGVyX2xlbiAqIDQgIT0KKwkgICAgc2l6ZW9mKHN0cnVjdCBpbnRlbF9wYWNr
YWdlX2hlYWRlcikgKworCSAgICBtYXhfZW50cmllcyAqIHNpemVvZihzdHJ1Y3QgaW50ZWxfZndf
aW5mbykpIHsKKwkJRFJNX0VSUk9SKCJETUMgZmlybXdhcmUgaGFzIHdyb25nIHBhY2thZ2UgaGVh
ZGVyIGxlbmd0aCAiCisJCQkgICIoJXUgYnl0ZXMpXG4iLCBwYWNrYWdlX2hlYWRlci0+aGVhZGVy
X2xlbiAqIDQpOworCQlyZXR1cm4gMDsKKwl9CisKKwludW1fZW50cmllcyA9IHBhY2thZ2VfaGVh
ZGVyLT5udW1fZW50cmllczsKKwlpZiAoV0FSTl9PTihwYWNrYWdlX2hlYWRlci0+bnVtX2VudHJp
ZXMgPiBtYXhfZW50cmllcykpCisJCW51bV9lbnRyaWVzID0gbWF4X2VudHJpZXM7CisKKwlmd19p
bmZvID0gKGNvbnN0IHN0cnVjdCBpbnRlbF9md19pbmZvICopCisJCSgodTggKilwYWNrYWdlX2hl
YWRlciArIHNpemVvZigqcGFja2FnZV9oZWFkZXIpKTsKKwlkbWNfb2Zmc2V0ID0gZmluZF9kbWNf
Zndfb2Zmc2V0KGZ3X2luZm8sIG51bV9lbnRyaWVzLCBzaSk7CisJaWYgKGRtY19vZmZzZXQgPT0g
Q1NSX0RFRkFVTFRfRldfT0ZGU0VUKSB7CisJCURSTV9FUlJPUigiRE1DIGZpcm13YXJlIG5vdCBz
dXBwb3J0ZWQgZm9yICVjIHN0ZXBwaW5nXG4iLAorCQkJICBzaS0+c3RlcHBpbmcpOworCQlyZXR1
cm4gMDsKKwl9CisKKwlyID0gc2l6ZW9mKHN0cnVjdCBpbnRlbF9wYWNrYWdlX2hlYWRlcik7CisK
KwkvKiB3ZSBhbHdheXMgaGF2ZSBzcGFjZSBmb3IgbWF4X2VudHJpZXMsIGV2ZW4gaWYgbm90IGFs
bCBhcmUgdXNlZCAqLworCXIgKz0gbWF4X2VudHJpZXMgKiBzaXplb2Yoc3RydWN0IGludGVsX2Z3
X2luZm8pOworCisJLyogZG1jX29mZnNldCBpcyBpbiBkd29yZHMgKi8KKwlyICs9IGRtY19vZmZz
ZXQgKiA0OworCisJcmV0dXJuIHI7Cit9CisKIC8qIFJldHVybiBudW1iZXIgb2YgYnl0ZXMgcGFy
c2VkIG9yIDAgb24gZXJyb3IgKi8KIHN0YXRpYyB1MzIgcGFyc2VfY3NyX2Z3X2NzcyhzdHJ1Y3Qg
aW50ZWxfY3NyICpjc3IsCiAJCQkgICAgc3RydWN0IGludGVsX2Nzc19oZWFkZXIgKmNzc19oZWFk
ZXIpCkBAIC0zNjgsNyArNDE4LDcgQEAgc3RhdGljIHUzMiAqcGFyc2VfY3NyX2Z3KHN0cnVjdCBk
cm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKIAlzdHJ1Y3QgaW50ZWxfZG1jX2hlYWRlciAqZG1j
X2hlYWRlcjsKIAlzdHJ1Y3QgaW50ZWxfY3NyICpjc3IgPSAmZGV2X3ByaXYtPmNzcjsKIAljb25z
dCBzdHJ1Y3Qgc3RlcHBpbmdfaW5mbyAqc2kgPSBpbnRlbF9nZXRfc3RlcHBpbmdfaW5mbyhkZXZf
cHJpdik7Ci0JdTMyIGRtY19vZmZzZXQsIG51bV9lbnRyaWVzLCBtYXhfZW50cmllcywgcmVhZGNv
dW50ID0gMCwgbmJ5dGVzOworCXUzMiByZWFkY291bnQgPSAwLCBuYnl0ZXM7CiAJdTMyIGksIHI7
CiAJdTMyICpkbWNfcGF5bG9hZDsKIApAQCAtMzg0LDQ2ICs0MzQsMTIgQEAgc3RhdGljIHUzMiAq
cGFyc2VfY3NyX2Z3KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKIAlyZWFkY291
bnQgKz0gcjsKIAogCS8qIEV4dHJhY3QgUGFja2FnZSBIZWFkZXIgaW5mb3JtYXRpb24qLwotCXBh
Y2thZ2VfaGVhZGVyID0gKHN0cnVjdCBpbnRlbF9wYWNrYWdlX2hlYWRlciAqKQotCQkmZnctPmRh
dGFbcmVhZGNvdW50XTsKLQotCXJlYWRjb3VudCArPSBzaXplb2Yoc3RydWN0IGludGVsX3BhY2th
Z2VfaGVhZGVyKTsKLQotCWlmIChwYWNrYWdlX2hlYWRlci0+aGVhZGVyX3ZlciA9PSAxKSB7Ci0J
CW1heF9lbnRyaWVzID0gUEFDS0FHRV9NQVhfRldfSU5GT19FTlRSSUVTOwotCX0gZWxzZSBpZiAo
cGFja2FnZV9oZWFkZXItPmhlYWRlcl92ZXIgPT0gMikgewotCQltYXhfZW50cmllcyA9IFBBQ0tB
R0VfVjJfTUFYX0ZXX0lORk9fRU5UUklFUzsKLQl9IGVsc2UgewotCQlEUk1fRVJST1IoIkRNQyBm
aXJtd2FyZSBoYXMgdW5rbm93biBoZWFkZXIgdmVyc2lvbiAldVxuIiwKLQkJCSAgcGFja2FnZV9o
ZWFkZXItPmhlYWRlcl92ZXIpOwotCQlyZXR1cm4gTlVMTDsKLQl9Ci0KLQlpZiAocGFja2FnZV9o
ZWFkZXItPmhlYWRlcl9sZW4gKiA0ICE9Ci0JICAgIHNpemVvZihzdHJ1Y3QgaW50ZWxfcGFja2Fn
ZV9oZWFkZXIpICsKLQkgICAgbWF4X2VudHJpZXMgKiBzaXplb2Yoc3RydWN0IGludGVsX2Z3X2lu
Zm8pKSB7Ci0JCURSTV9FUlJPUigiRE1DIGZpcm13YXJlIGhhcyB3cm9uZyBwYWNrYWdlIGhlYWRl
ciBsZW5ndGggIgotCQkJICAiKCV1IGJ5dGVzKVxuIiwgcGFja2FnZV9oZWFkZXItPmhlYWRlcl9s
ZW4gKiA0KTsKLQkJcmV0dXJuIE5VTEw7Ci0JfQotCi0JbnVtX2VudHJpZXMgPSBwYWNrYWdlX2hl
YWRlci0+bnVtX2VudHJpZXM7Ci0JaWYgKFdBUk5fT04ocGFja2FnZV9oZWFkZXItPm51bV9lbnRy
aWVzID4gbWF4X2VudHJpZXMpKQotCQludW1fZW50cmllcyA9IG1heF9lbnRyaWVzOwotCi0JZG1j
X29mZnNldCA9IGZpbmRfZG1jX2Z3X29mZnNldCgoc3RydWN0IGludGVsX2Z3X2luZm8gKikKLQkJ
CQkJJmZ3LT5kYXRhW3JlYWRjb3VudF0sIG51bV9lbnRyaWVzLCBzaSk7Ci0JaWYgKGRtY19vZmZz
ZXQgPT0gQ1NSX0RFRkFVTFRfRldfT0ZGU0VUKSB7Ci0JCURSTV9FUlJPUigiRE1DIGZpcm13YXJl
IG5vdCBzdXBwb3J0ZWQgZm9yICVjIHN0ZXBwaW5nXG4iLAotCQkJICBzaS0+c3RlcHBpbmcpOwor
CXBhY2thZ2VfaGVhZGVyID0gKHN0cnVjdCBpbnRlbF9wYWNrYWdlX2hlYWRlciAqKSZmdy0+ZGF0
YVtyZWFkY291bnRdOworCXIgPSBwYXJzZV9jc3JfZndfcGFja2FnZShjc3IsIHBhY2thZ2VfaGVh
ZGVyLCBzaSk7CisJaWYgKCFyKQogCQlyZXR1cm4gTlVMTDsKLQl9CiAKLQkvKiB3ZSBhbHdheXMg
aGF2ZSBzcGFjZSBmb3IgbWF4X2VudHJpZXMsIGV2ZW4gaWYgbm90IGFsbCBhcmUgdXNlZCAqLwot
CXJlYWRjb3VudCArPSBtYXhfZW50cmllcyAqIHNpemVvZihzdHJ1Y3QgaW50ZWxfZndfaW5mbyk7
Ci0JLyogQ29udmVydCBkbWNfb2Zmc2V0IGludG8gbnVtYmVyIG9mIGJ5dGVzLiBCeSBkZWZhdWx0
IGl0IGlzIGluIGR3b3JkcyovCi0JZG1jX29mZnNldCAqPSA0OwotCXJlYWRjb3VudCArPSBkbWNf
b2Zmc2V0OworCXJlYWRjb3VudCArPSByOwogCiAJLyogRXh0cmFjdCBkbWNfaGVhZGVyIGluZm9y
bWF0aW9uLiAqLwogCWRtY19oZWFkZXIgPSAoc3RydWN0IGludGVsX2RtY19oZWFkZXIgKikmZnct
PmRhdGFbcmVhZGNvdW50XTsKLS0gCjIuMjEuMAoKX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX18KSW50ZWwtZ2Z4IG1haWxpbmcgbGlzdApJbnRlbC1nZnhAbGlz
dHMuZnJlZWRlc2t0b3Aub3JnCmh0dHBzOi8vbGlzdHMuZnJlZWRlc2t0b3Aub3JnL21haWxtYW4v
bGlzdGluZm8vaW50ZWwtZ2Z4

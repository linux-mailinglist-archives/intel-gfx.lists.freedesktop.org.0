Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 0CA47FCA8B
	for <lists+intel-gfx@lfdr.de>; Thu, 14 Nov 2019 17:05:43 +0100 (CET)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id C6A836EC3C;
	Thu, 14 Nov 2019 16:05:40 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from mblankhorst.nl (mblankhorst.nl [141.105.120.124])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 2FEF06EBD1
 for <intel-gfx@lists.freedesktop.org>; Thu, 14 Nov 2019 16:05:27 +0000 (UTC)
From: Maarten Lankhorst <maarten.lankhorst@linux.intel.com>
To: intel-gfx@lists.freedesktop.org
Date: Thu, 14 Nov 2019 17:05:17 +0100
Message-Id: <20191114160522.9699-6-maarten.lankhorst@linux.intel.com>
X-Mailer: git-send-email 2.24.0
In-Reply-To: <20191114160522.9699-1-maarten.lankhorst@linux.intel.com>
References: <20191114160522.9699-1-maarten.lankhorst@linux.intel.com>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH 06/11] drm/i915: Enable big joiner support in
 enable and disable sequences.
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

TWFrZSB2ZHNjIHdvcmsgd2hlbiBubyBvdXRwdXQgaXMgZW5hYmxlZC4gVGhlIGJpZyBqb2luZXIg
bmVlZHMgVkRTQwpvbiB0aGUgc2xhdmUsIHNvIGVuYWJsZSBpdCBhbmQgc2V0IHRoZSBhcHByb3By
aWF0ZSBiaXRzLgpBbHNvIHVwZGF0ZSB0aW1lc3RhbXBpbmcgY29uc3RhbnRzLCBiZWNhdXNlIHNs
YXZlIGNydGMncyBhcmUgbm90CnVwZGF0ZWQgaW4gZHJtX2F0b21pY19oZWxwZXJfdXBkYXRlX2xl
Z2FjeV9tb2Rlc2V0X3N0YXRlKCkuCgpUaGlzIHNob3VsZCBiZSBlbm91Z2ggdG8gYnJpbmcgdXAg
Q1JUQydzIGluIGEgYmlnIGpvaW5lciBjb25maWd1cmF0aW9uLAp3aXRob3V0IGFueSBwbGFuZSBj
b25maWd1cmF0aW9uIG9uIHRoZSBzZWNvbmQgcGlwZSB5ZXQuCgpIT1dFVkVSLCB3ZSBzdGlsbCBi
cmluZyB1cCB0aGUgY3J0YydzIGluIHRoZSB3cm9uZyBvcmRlci4gV2UgbmVlZCB0bwptYWtlIHN1
cmUgdGhhdCB0aGUgbWFzdGVyIGNydGMgaXMgYnJvdWdodCB1cCBhZnRlciB0aGUgc2xhdmUgY3J0
Yy4KVGhpcyBpcyBkb25lIGNvcnJlY3RseSBsYXRlciBpbiB0aGlzIHNlcmllcy4KClRoZSBuZXh0
IHN0ZXBzIGFyZSB0byBlbmFibGUgcGxhbmVzIGNvcnJlY3RseSwgYW5kIG1ha2Ugc3VyZSB3ZSBl
bmFibGUKYW5kIHVwZGF0ZSBib3RoIG1hc3RlciBhbmQgc2xhdmUgaW4gdGhlIGNvcnJlY3Qgb3Jk
ZXIuCgpTaWduZWQtb2ZmLWJ5OiBNYWFydGVuIExhbmtob3JzdCA8bWFhcnRlbi5sYW5raG9yc3RA
bGludXguaW50ZWwuY29tPgotLS0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxf
ZGRpLmMgICAgICB8ICA0OCArKy0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxf
ZGlzcGxheS5jICB8IDM5OSArKysrKysrKysrKystLS0tLS0KIC4uLi9kcm0vaTkxNS9kaXNwbGF5
L2ludGVsX2Rpc3BsYXlfdHlwZXMuaCAgICB8ICAyMiArCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9k
aXNwbGF5L2ludGVsX2RwLmMgICAgICAgfCAgMjEgKy0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2Rp
c3BsYXkvaW50ZWxfdmRzYy5jICAgICB8IDEyMiArKysrLS0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1
L2Rpc3BsYXkvaW50ZWxfdmRzYy5oICAgICB8ICAgMiArCiA2IGZpbGVzIGNoYW5nZWQsIDQwOCBp
bnNlcnRpb25zKCspLCAyMDYgZGVsZXRpb25zKC0pCgpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUv
ZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kZGkuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3Bs
YXkvaW50ZWxfZGRpLmMKaW5kZXggOGY4MTdkZTM0NDYwLi4xMjE1ZjYxOWRhMzYgMTAwNjQ0Ci0t
LSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZGRpLmMKKysrIGIvZHJpdmVy
cy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kZGkuYwpAQCAtMjIxOCwxMyArMjIxOCw2IEBA
IHN0YXRpYyB2b2lkIGludGVsX2RkaV9nZXRfcG93ZXJfZG9tYWlucyhzdHJ1Y3QgaW50ZWxfZW5j
b2RlciAqZW5jb2RlciwKIAkgICAgaW50ZWxfcGh5X2lzX3RjKGRldl9wcml2LCBwaHkpKQogCQlp
bnRlbF9kaXNwbGF5X3Bvd2VyX2dldChkZXZfcHJpdiwKIAkJCQkJaW50ZWxfZGRpX21haW5fbGlu
a19hdXhfZG9tYWluKGRpZ19wb3J0KSk7Ci0KLQkvKgotCSAqIFZEU0MgcG93ZXIgaXMgbmVlZGVk
IHdoZW4gRFNDIGlzIGVuYWJsZWQKLQkgKi8KLQlpZiAoY3J0Y19zdGF0ZS0+ZHNjLmNvbXByZXNz
aW9uX2VuYWJsZSkKLQkJaW50ZWxfZGlzcGxheV9wb3dlcl9nZXQoZGV2X3ByaXYsCi0JCQkJCWlu
dGVsX2RzY19wb3dlcl9kb21haW4oY3J0Y19zdGF0ZSkpOwogfQogCiB2b2lkIGludGVsX2RkaV9l
bmFibGVfcGlwZV9jbG9jayhjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0
ZSkKQEAgLTM1NTcsNyArMzU1MCw4IEBAIHN0YXRpYyB2b2lkIHRnbF9kZGlfcHJlX2VuYWJsZV9k
cChzdHJ1Y3QgaW50ZWxfZW5jb2RlciAqZW5jb2RlciwKIAogCS8qIDcubCBDb25maWd1cmUgYW5k
IGVuYWJsZSBGRUMgaWYgbmVlZGVkICovCiAJaW50ZWxfZGRpX2VuYWJsZV9mZWMoZW5jb2Rlciwg
Y3J0Y19zdGF0ZSk7Ci0JaW50ZWxfZHNjX2VuYWJsZShlbmNvZGVyLCBjcnRjX3N0YXRlKTsKKwlp
ZiAoIWNydGNfc3RhdGUtPmJpZ2pvaW5lcikKKwkJaW50ZWxfZHNjX2VuYWJsZShlbmNvZGVyLCBj
cnRjX3N0YXRlKTsKIH0KIAogc3RhdGljIHZvaWQgaHN3X2RkaV9wcmVfZW5hYmxlX2RwKHN0cnVj
dCBpbnRlbF9lbmNvZGVyICplbmNvZGVyLApAQCAtMzYyOSw3ICszNjIzLDggQEAgc3RhdGljIHZv
aWQgaHN3X2RkaV9wcmVfZW5hYmxlX2RwKHN0cnVjdCBpbnRlbF9lbmNvZGVyICplbmNvZGVyLAog
CWlmICghaXNfbXN0KQogCQlpbnRlbF9kZGlfZW5hYmxlX3BpcGVfY2xvY2soY3J0Y19zdGF0ZSk7
CiAKLQlpbnRlbF9kc2NfZW5hYmxlKGVuY29kZXIsIGNydGNfc3RhdGUpOworCWlmICghY3J0Y19z
dGF0ZS0+Ymlnam9pbmVyKQorCQlpbnRlbF9kc2NfZW5hYmxlKGVuY29kZXIsIGNydGNfc3RhdGUp
OwogfQogCiBzdGF0aWMgdm9pZCBpbnRlbF9kZGlfcHJlX2VuYWJsZV9kcChzdHJ1Y3QgaW50ZWxf
ZW5jb2RlciAqZW5jb2RlciwKQEAgLTQyNTIsMTkgKzQyNDcsMTggQEAgdm9pZCBpbnRlbF9kZGlf
Y29tcHV0ZV9taW5fdm9sdGFnZV9sZXZlbChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3By
aXYsCiAJCWNydGNfc3RhdGUtPm1pbl92b2x0YWdlX2xldmVsID0gMjsKIH0KIAotdm9pZCBpbnRl
bF9kZGlfZ2V0X2NvbmZpZyhzdHJ1Y3QgaW50ZWxfZW5jb2RlciAqZW5jb2RlciwKLQkJCSAgc3Ry
dWN0IGludGVsX2NydGNfc3RhdGUgKnBpcGVfY29uZmlnKQorc3RhdGljIHZvaWQgaW50ZWxfZGRp
X3JlYWRfZnVuY19jdGwoc3RydWN0IGludGVsX2VuY29kZXIgKmVuY29kZXIsCisJCQkJICAgIHN0
cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpwaXBlX2NvbmZpZykKIHsKIAlzdHJ1Y3QgZHJtX2k5MTVf
cHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGVuY29kZXItPmJhc2UuZGV2KTsKIAlzdHJ1Y3Qg
aW50ZWxfY3J0YyAqaW50ZWxfY3J0YyA9IHRvX2ludGVsX2NydGMocGlwZV9jb25maWctPnVhcGku
Y3J0Yyk7CiAJZW51bSB0cmFuc2NvZGVyIGNwdV90cmFuc2NvZGVyID0gcGlwZV9jb25maWctPmNw
dV90cmFuc2NvZGVyOwogCXUzMiB0ZW1wLCBmbGFncyA9IDA7CiAKLQkvKiBYWFg6IERTSSB0cmFu
c2NvZGVyIHBhcmFub2lhICovCi0JaWYgKFdBUk5fT04odHJhbnNjb2Rlcl9pc19kc2koY3B1X3Ry
YW5zY29kZXIpKSkKKwl0ZW1wID0gSTkxNV9SRUFEKFRSQU5TX0RESV9GVU5DX0NUTChjcHVfdHJh
bnNjb2RlcikpOworCWlmICghKHRlbXAgJiBUUkFOU19ERElfRlVOQ19FTkFCTEUpKQogCQlyZXR1
cm47CiAKLQl0ZW1wID0gSTkxNV9SRUFEKFRSQU5TX0RESV9GVU5DX0NUTChjcHVfdHJhbnNjb2Rl
cikpOwogCWlmICh0ZW1wICYgVFJBTlNfRERJX1BIU1lOQykKIAkJZmxhZ3MgfD0gRFJNX01PREVf
RkxBR19QSFNZTkM7CiAJZWxzZQpAQCAtNDM1MCw2ICs0MzQ0LDI5IEBAIHZvaWQgaW50ZWxfZGRp
X2dldF9jb25maWcoc3RydWN0IGludGVsX2VuY29kZXIgKmVuY29kZXIsCiAJZGVmYXVsdDoKIAkJ
YnJlYWs7CiAJfQorfQorCit2b2lkIGludGVsX2RkaV9nZXRfY29uZmlnKHN0cnVjdCBpbnRlbF9l
bmNvZGVyICplbmNvZGVyLAorCQkJICBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqcGlwZV9jb25m
aWcpCit7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShlbmNv
ZGVyLT5iYXNlLmRldik7CisJZW51bSB0cmFuc2NvZGVyIGNwdV90cmFuc2NvZGVyID0gcGlwZV9j
b25maWctPmNwdV90cmFuc2NvZGVyOworCisJLyogWFhYOiBEU0kgdHJhbnNjb2RlciBwYXJhbm9p
YSAqLworCWlmIChXQVJOX09OKHRyYW5zY29kZXJfaXNfZHNpKGNwdV90cmFuc2NvZGVyKSkpCisJ
CXJldHVybjsKKworCWludGVsX2RkaV9yZWFkX2Z1bmNfY3RsKGVuY29kZXIsIHBpcGVfY29uZmln
KTsKKwlpZiAocGlwZV9jb25maWctPmJpZ2pvaW5lcl9zbGF2ZSkgeworCQkvKiByZWFkIG91dCBw
aXBlIHNldHRpbmdzIGZyb20gbWFzdGVyICovCisJCWVudW0gdHJhbnNjb2RlciBzYXZlID0gcGlw
ZV9jb25maWctPmNwdV90cmFuc2NvZGVyOworCisJCSAvKiBPdXIgb3duIHRyYW5zY29kZXIgbmVl
ZHMgdG8gYmUgZGlzYWJsZWQgd2hlbiByZWFkaW5nIGl0IGluIGludGVsX2RkaV9yZWFkX2Z1bmNf
Y3RsKCkgKi8KKwkJV0FSTl9PTihwaXBlX2NvbmZpZy0+b3V0cHV0X3R5cGVzKTsKKwkJcGlwZV9j
b25maWctPmNwdV90cmFuc2NvZGVyID0gKGVudW0gdHJhbnNjb2RlcilwaXBlX2NvbmZpZy0+Ymln
am9pbmVyX2xpbmtlZF9jcnRjLT5waXBlOworCQlpbnRlbF9kZGlfcmVhZF9mdW5jX2N0bChlbmNv
ZGVyLCBwaXBlX2NvbmZpZyk7CisJCXBpcGVfY29uZmlnLT5jcHVfdHJhbnNjb2RlciA9IHNhdmU7
CisJfQogCiAJaWYgKGVuY29kZXItPnR5cGUgPT0gSU5URUxfT1VUUFVUX0VEUCkKIAkJdGdsX2Rj
M2NvX2V4aXRsaW5lX2dldF9jb25maWcocGlwZV9jb25maWcpOwpAQCAtNDM3Nyw3ICs0Mzk0LDgg
QEAgdm9pZCBpbnRlbF9kZGlfZ2V0X2NvbmZpZyhzdHJ1Y3QgaW50ZWxfZW5jb2RlciAqZW5jb2Rl
ciwKIAkJZGV2X3ByaXYtPnZidC5lZHAuYnBwID0gcGlwZV9jb25maWctPnBpcGVfYnBwOwogCX0K
IAotCWludGVsX2RkaV9jbG9ja19nZXQoZW5jb2RlciwgcGlwZV9jb25maWcpOworCWlmICghcGlw
ZV9jb25maWctPmJpZ2pvaW5lcl9zbGF2ZSkKKwkJaW50ZWxfZGRpX2Nsb2NrX2dldChlbmNvZGVy
LCBwaXBlX2NvbmZpZyk7CiAKIAlpZiAoSVNfR0VOOV9MUChkZXZfcHJpdikpCiAJCXBpcGVfY29u
ZmlnLT5sYW5lX2xhdF9vcHRpbV9tYXNrID0KZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9p
OTE1L2Rpc3BsYXkvaW50ZWxfZGlzcGxheS5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxh
eS9pbnRlbF9kaXNwbGF5LmMKaW5kZXggMmRjNjNlZjVjYWY4Li45NGU0Y2FiMDBhNjYgMTAwNjQ0
Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZGlzcGxheS5jCisrKyBi
L2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZGlzcGxheS5jCkBAIC02NTgzLDYg
KzY1ODMsNDUgQEAgc3RhdGljIHZvaWQgaWNsX3BpcGVfbWJ1c19lbmFibGUoc3RydWN0IGludGVs
X2NydGMgKmNydGMpCiAJSTkxNV9XUklURShQSVBFX01CVVNfREJPWF9DVEwocGlwZSksIHZhbCk7
CiB9CiAKK3N0YXRpYyB2b2lkIGljbF9kZGlfYmlnam9pbmVyX3ByZV9lbmFibGUoc3RydWN0IGlu
dGVsX2F0b21pY19zdGF0ZSAqc3RhdGUsCisJCQkJCSBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAq
Y3J0Y19zdGF0ZSkKK3sKKwlzdHJ1Y3QgaW50ZWxfY3J0YyAqbWFzdGVyID0gdG9faW50ZWxfY3J0
YyhjcnRjX3N0YXRlLT51YXBpLmNydGMpOworCXN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICptYXN0
ZXJfY3J0Y19zdGF0ZTsKKwlzdHJ1Y3QgZHJtX2Nvbm5lY3Rvcl9zdGF0ZSAqY29ubl9zdGF0ZTsK
KwlzdHJ1Y3QgZHJtX2Nvbm5lY3RvciAqY29ubjsKKwlzdHJ1Y3QgaW50ZWxfZW5jb2RlciAqZW5j
b2RlciA9IE5VTEw7CisJaW50IGk7CisKKwlpZiAoY3J0Y19zdGF0ZS0+Ymlnam9pbmVyX3NsYXZl
KQorCQltYXN0ZXIgPSBjcnRjX3N0YXRlLT5iaWdqb2luZXJfbGlua2VkX2NydGM7CisKKwltYXN0
ZXJfY3J0Y19zdGF0ZSA9IGludGVsX2F0b21pY19nZXRfbmV3X2NydGNfc3RhdGUoc3RhdGUsIG1h
c3Rlcik7CisKKwlmb3JfZWFjaF9uZXdfY29ubmVjdG9yX2luX3N0YXRlKCZzdGF0ZS0+YmFzZSwg
Y29ubiwgY29ubl9zdGF0ZSwgaSkgeworCQlpZiAoY29ubl9zdGF0ZS0+Y3J0YyAhPSAmbWFzdGVy
LT5iYXNlKQorCQkJY29udGludWU7CisKKwkJZW5jb2RlciA9IHRvX2ludGVsX2VuY29kZXIoY29u
bl9zdGF0ZS0+YmVzdF9lbmNvZGVyKTsKKwkJYnJlYWs7CisJfQorCisJaWYgKCFjcnRjX3N0YXRl
LT5iaWdqb2luZXJfc2xhdmUpIHsKKwkJLyogbmVlZCB0byBlbmFibGUgVkRTQywgd2hpY2ggd2Ug
c2tpcHBlZCBpbiBwcmUtZW5hYmxlICovCisJCWludGVsX2RzY19lbmFibGUoZW5jb2RlciwgY3J0
Y19zdGF0ZSk7CisJfSBlbHNlIHsKKwkJLyoKKwkJICogRW5hYmxlIHNlcXVlbmNlIHN0ZXBzIDEt
NyBvbiBiaWdqb2luZXIgbWFzdGVyCisJCSAqLworCQlpbnRlbF9lbmNvZGVyc19wcmVfcGxsX2Vu
YWJsZShtYXN0ZXIsIG1hc3Rlcl9jcnRjX3N0YXRlLCBzdGF0ZSk7CisJCWludGVsX2VuYWJsZV9z
aGFyZWRfZHBsbChtYXN0ZXJfY3J0Y19zdGF0ZSk7CisJCWludGVsX2VuY29kZXJzX3ByZV9lbmFi
bGUobWFzdGVyLCBtYXN0ZXJfY3J0Y19zdGF0ZSwgc3RhdGUpOworCisJCS8qIGFuZCBEU0Mgb24g
c2xhdmUgKi8KKwkJaW50ZWxfZHNjX2VuYWJsZShOVUxMLCBjcnRjX3N0YXRlKTsKKwl9Cit9CisK
IHN0YXRpYyB2b2lkIGhhc3dlbGxfY3J0Y19lbmFibGUoc3RydWN0IGludGVsX2NydGNfc3RhdGUg
KnBpcGVfY29uZmlnLAogCQkJCXN0cnVjdCBpbnRlbF9hdG9taWNfc3RhdGUgKnN0YXRlKQogewpA
QCAtNjU5Niw0MCArNjYzNSw0MSBAQCBzdGF0aWMgdm9pZCBoYXN3ZWxsX2NydGNfZW5hYmxlKHN0
cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpwaXBlX2NvbmZpZywKIAlpZiAoV0FSTl9PTihpbnRlbF9j
cnRjLT5hY3RpdmUpKQogCQlyZXR1cm47CiAKLQlpbnRlbF9lbmNvZGVyc19wcmVfcGxsX2VuYWJs
ZShpbnRlbF9jcnRjLCBwaXBlX2NvbmZpZywgc3RhdGUpOworCWlmICghcGlwZV9jb25maWctPmJp
Z2pvaW5lcikgeworCQlpbnRlbF9lbmNvZGVyc19wcmVfcGxsX2VuYWJsZShpbnRlbF9jcnRjLCBw
aXBlX2NvbmZpZywgc3RhdGUpOwogCi0JaWYgKHBpcGVfY29uZmlnLT5zaGFyZWRfZHBsbCkKLQkJ
aW50ZWxfZW5hYmxlX3NoYXJlZF9kcGxsKHBpcGVfY29uZmlnKTsKKwkJaWYgKHBpcGVfY29uZmln
LT5zaGFyZWRfZHBsbCkKKwkJCWludGVsX2VuYWJsZV9zaGFyZWRfZHBsbChwaXBlX2NvbmZpZyk7
CiAKLQlpbnRlbF9lbmNvZGVyc19wcmVfZW5hYmxlKGludGVsX2NydGMsIHBpcGVfY29uZmlnLCBz
dGF0ZSk7CisJCWludGVsX2VuY29kZXJzX3ByZV9lbmFibGUoaW50ZWxfY3J0YywgcGlwZV9jb25m
aWcsIHN0YXRlKTsKKwl9IGVsc2UgeworCQlpY2xfZGRpX2JpZ2pvaW5lcl9wcmVfZW5hYmxlKHN0
YXRlLCBwaXBlX2NvbmZpZyk7CisJfQogCi0JaWYgKGludGVsX2NydGNfaGFzX2RwX2VuY29kZXIo
cGlwZV9jb25maWcpKQotCQlpbnRlbF9kcF9zZXRfbV9uKHBpcGVfY29uZmlnLCBNMV9OMSk7CisJ
aW50ZWxfc2V0X3BpcGVfc3JjX3NpemUocGlwZV9jb25maWcpOworCWlmIChJTlRFTF9HRU4oZGV2
X3ByaXYpID49IDkgfHwgSVNfQlJPQURXRUxMKGRldl9wcml2KSkKKwkJYmR3X3NldF9waXBlbWlz
YyhwaXBlX2NvbmZpZyk7CiAKLQlpZiAoIXRyYW5zY29kZXJfaXNfZHNpKGNwdV90cmFuc2NvZGVy
KSkKLQkJaW50ZWxfc2V0X3RyYW5zY29kZXJfdGltaW5ncyhwaXBlX2NvbmZpZyk7CisJaWYgKCFw
aXBlX2NvbmZpZy0+Ymlnam9pbmVyX3NsYXZlICYmICF0cmFuc2NvZGVyX2lzX2RzaShjcHVfdHJh
bnNjb2RlcikpIHsKKwkJaWYgKGludGVsX2NydGNfaGFzX2RwX2VuY29kZXIocGlwZV9jb25maWcp
KQorCQkJaW50ZWxfZHBfc2V0X21fbihwaXBlX2NvbmZpZywgTTFfTjEpOwogCi0JaWYgKElOVEVM
X0dFTihkZXZfcHJpdikgPj0gMTEpCi0JCWljbF9lbmFibGVfdHJhbnNfcG9ydF9zeW5jKHBpcGVf
Y29uZmlnKTsKKwkJaWYgKElOVEVMX0dFTihkZXZfcHJpdikgPj0gMTEpCisJCQlpY2xfZW5hYmxl
X3RyYW5zX3BvcnRfc3luYyhwaXBlX2NvbmZpZyk7CiAKLQlpbnRlbF9zZXRfcGlwZV9zcmNfc2l6
ZShwaXBlX2NvbmZpZyk7CisJCWludGVsX3NldF90cmFuc2NvZGVyX3RpbWluZ3MocGlwZV9jb25m
aWcpOwogCi0JaWYgKGNwdV90cmFuc2NvZGVyICE9IFRSQU5TQ09ERVJfRURQICYmCi0JICAgICF0
cmFuc2NvZGVyX2lzX2RzaShjcHVfdHJhbnNjb2RlcikpIHsKLQkJSTkxNV9XUklURShQSVBFX01V
TFQoY3B1X3RyYW5zY29kZXIpLAotCQkJICAgcGlwZV9jb25maWctPnBpeGVsX211bHRpcGxpZXIg
LSAxKTsKLQl9CisJCWlmIChjcHVfdHJhbnNjb2RlciAhPSBUUkFOU0NPREVSX0VEUCkKKwkJCUk5
MTVfV1JJVEUoUElQRV9NVUxUKGNwdV90cmFuc2NvZGVyKSwKKwkJCQkgIHBpcGVfY29uZmlnLT5w
aXhlbF9tdWx0aXBsaWVyIC0gMSk7CiAKLQlpZiAocGlwZV9jb25maWctPmhhc19wY2hfZW5jb2Rl
cikgewotCQlpbnRlbF9jcHVfdHJhbnNjb2Rlcl9zZXRfbV9uKHBpcGVfY29uZmlnLAotCQkJCQkg
ICAgICZwaXBlX2NvbmZpZy0+ZmRpX21fbiwgTlVMTCk7Ci0JfQorCQlpZiAocGlwZV9jb25maWct
Pmhhc19wY2hfZW5jb2RlcikgeworCQkJaW50ZWxfY3B1X3RyYW5zY29kZXJfc2V0X21fbihwaXBl
X2NvbmZpZywKKwkJCQkJCSAgICAmcGlwZV9jb25maWctPmZkaV9tX24sIE5VTEwpOworCQl9CiAK
LQlpZiAoIXRyYW5zY29kZXJfaXNfZHNpKGNwdV90cmFuc2NvZGVyKSkKIAkJaGFzd2VsbF9zZXRf
cGlwZWNvbmYocGlwZV9jb25maWcpOwotCi0JaWYgKElOVEVMX0dFTihkZXZfcHJpdikgPj0gOSB8
fCBJU19CUk9BRFdFTEwoZGV2X3ByaXYpKQotCQliZHdfc2V0X3BpcGVtaXNjKHBpcGVfY29uZmln
KTsKKwl9CiAKIAlpbnRlbF9jcnRjLT5hY3RpdmUgPSB0cnVlOwogCkBAIC02NjU3LDcgKzY2OTcs
NyBAQCBzdGF0aWMgdm9pZCBoYXN3ZWxsX2NydGNfZW5hYmxlKHN0cnVjdCBpbnRlbF9jcnRjX3N0
YXRlICpwaXBlX2NvbmZpZywKIAlpZiAoSU5URUxfR0VOKGRldl9wcml2KSA+PSAxMSkKIAkJaWNs
X3NldF9waXBlX2NoaWNrZW4oaW50ZWxfY3J0Yyk7CiAKLQlpZiAoIXRyYW5zY29kZXJfaXNfZHNp
KGNwdV90cmFuc2NvZGVyKSkKKwlpZiAoIXBpcGVfY29uZmlnLT5iaWdqb2luZXJfc2xhdmUgJiYg
IXRyYW5zY29kZXJfaXNfZHNpKGNwdV90cmFuc2NvZGVyKSkKIAkJaW50ZWxfZGRpX2VuYWJsZV90
cmFuc2NvZGVyX2Z1bmMocGlwZV9jb25maWcpOwogCiAJaWYgKGRldl9wcml2LT5kaXNwbGF5Lmlu
aXRpYWxfd2F0ZXJtYXJrcyAhPSBOVUxMKQpAQCAtNjY2Nyw4ICs2NzA3LDEwIEBAIHN0YXRpYyB2
b2lkIGhhc3dlbGxfY3J0Y19lbmFibGUoc3RydWN0IGludGVsX2NydGNfc3RhdGUgKnBpcGVfY29u
ZmlnLAogCQlpY2xfcGlwZV9tYnVzX2VuYWJsZShpbnRlbF9jcnRjKTsKIAogCS8qIFhYWDogRG8g
dGhlIHBpcGUgYXNzZXJ0aW9ucyBhdCB0aGUgcmlnaHQgcGxhY2UgZm9yIEJYVCBEU0kuICovCi0J
aWYgKCF0cmFuc2NvZGVyX2lzX2RzaShjcHVfdHJhbnNjb2RlcikpCisJaWYgKCFwaXBlX2NvbmZp
Zy0+Ymlnam9pbmVyX3NsYXZlICYmICF0cmFuc2NvZGVyX2lzX2RzaShjcHVfdHJhbnNjb2Rlcikp
CiAJCWludGVsX2VuYWJsZV9waXBlKHBpcGVfY29uZmlnKTsKKwllbHNlCisJCXRyYWNlX2ludGVs
X3BpcGVfZW5hYmxlKGludGVsX2NydGMpOwogCiAJaWYgKHBpcGVfY29uZmlnLT5oYXNfcGNoX2Vu
Y29kZXIpCiAJCWxwdF9wY2hfZW5hYmxlKHN0YXRlLCBwaXBlX2NvbmZpZyk7CkBAIC02Nzk2LDkg
KzY4MzgsMjcgQEAgc3RhdGljIHZvaWQgaGFzd2VsbF9jcnRjX2Rpc2FibGUoc3RydWN0IGludGVs
X2NydGNfc3RhdGUgKm9sZF9jcnRjX3N0YXRlLAogCWVsc2UKIAkJaXJvbmxha2VfcGZpdF9kaXNh
YmxlKG9sZF9jcnRjX3N0YXRlKTsKIAotCWludGVsX2VuY29kZXJzX3Bvc3RfZGlzYWJsZShpbnRl
bF9jcnRjLCBvbGRfY3J0Y19zdGF0ZSwgc3RhdGUpOworCWlmIChvbGRfY3J0Y19zdGF0ZS0+Ymln
am9pbmVyKSB7CisJCXN0cnVjdCBpbnRlbF9jcnRjICptYXN0ZXI7CisJCXN0cnVjdCBpbnRlbF9j
cnRjX3N0YXRlICptYXN0ZXJfY3J0Y19zdGF0ZTsKIAotCWludGVsX2VuY29kZXJzX3Bvc3RfcGxs
X2Rpc2FibGUoaW50ZWxfY3J0Yywgb2xkX2NydGNfc3RhdGUsIHN0YXRlKTsKKwkJLyogcG9ydHMg
YXJlIGRpc2FibGVkIGZyb20gdGhlIHNsYXZlLCBhZnRlciBpdCBkZWNvbmZpZ3VyZXMgKi8KKwkJ
aWYgKCFvbGRfY3J0Y19zdGF0ZS0+Ymlnam9pbmVyX3NsYXZlKQorCQkJcmV0dXJuOworCisJCW1h
c3RlciA9IG9sZF9jcnRjX3N0YXRlLT5iaWdqb2luZXJfbGlua2VkX2NydGM7CisJCW1hc3Rlcl9j
cnRjX3N0YXRlID0gaW50ZWxfYXRvbWljX2dldF9vbGRfY3J0Y19zdGF0ZShzdGF0ZSwgbWFzdGVy
KTsKKworCQlpbnRlbF9kZGlfZGlzYWJsZV9waXBlX2Nsb2NrKG9sZF9jcnRjX3N0YXRlKTsKKwor
CQkvKiBkaXNhYmxlIHBvcnRzIG9uIHRoZSBtYXN0ZXIgY3J0YyAqLworCQlpbnRlbF9lbmNvZGVy
c19wb3N0X2Rpc2FibGUobWFzdGVyLCBtYXN0ZXJfY3J0Y19zdGF0ZSwgc3RhdGUpOworCQlpbnRl
bF9lbmNvZGVyc19wb3N0X3BsbF9kaXNhYmxlKG1hc3RlciwgbWFzdGVyX2NydGNfc3RhdGUsIHN0
YXRlKTsKKwl9IGVsc2UgeworCQlpbnRlbF9lbmNvZGVyc19wb3N0X2Rpc2FibGUoaW50ZWxfY3J0
Yywgb2xkX2NydGNfc3RhdGUsIHN0YXRlKTsKKworCQlpbnRlbF9lbmNvZGVyc19wb3N0X3BsbF9k
aXNhYmxlKGludGVsX2NydGMsIG9sZF9jcnRjX3N0YXRlLCBzdGF0ZSk7CisJfQogfQogCiBzdGF0
aWMgdm9pZCBpOXh4X3BmaXRfZW5hYmxlKGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpj
cnRjX3N0YXRlKQpAQCAtNjk2OCw2ICs3MDI4LDkgQEAgc3RhdGljIHU2NCBnZXRfY3J0Y19wb3dl
cl9kb21haW5zKHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlKQogCWlmIChjcnRj
X3N0YXRlLT5zaGFyZWRfZHBsbCkKIAkJbWFzayB8PSBCSVRfVUxMKFBPV0VSX0RPTUFJTl9ESVNQ
TEFZX0NPUkUpOwogCisJaWYgKGNydGNfc3RhdGUtPmRzYy5jb21wcmVzc2lvbl9lbmFibGUpCisJ
CW1hc2sgfD0gQklUX1VMTChpbnRlbF9kc2NfcG93ZXJfZG9tYWluKGNydGNfc3RhdGUpKTsKKwog
CXJldHVybiBtYXNrOwogfQogCkBAIC03NTU5LDYgKzc2MjIsMzAgQEAgc3RhdGljIHUzMiBpbGtf
cGlwZV9waXhlbF9yYXRlKGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpwaXBlX2NvbmZp
ZykKIAlyZXR1cm4gcGl4ZWxfcmF0ZTsKIH0KIAorc3RhdGljIHZvaWQgaW50ZWxfZW5jb2Rlcl9n
ZXRfY29uZmlnKHN0cnVjdCBpbnRlbF9lbmNvZGVyICplbmNvZGVyLAorCQkJCSAgICAgc3RydWN0
IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUpCit7CisJc3RydWN0IGRybV9kaXNwbGF5X21v
ZGUgKnBpcGVfbW9kZSA9ICZjcnRjX3N0YXRlLT5ody5waXBlX21vZGU7CisKKwllbmNvZGVyLT5n
ZXRfY29uZmlnKGVuY29kZXIsIGNydGNfc3RhdGUpOworCisJKnBpcGVfbW9kZSA9IGNydGNfc3Rh
dGUtPmh3LmFkanVzdGVkX21vZGU7CisJaWYgKGNydGNfc3RhdGUtPmJpZ2pvaW5lcikgeworCQkv
KgorCQkgICogdHJhbnNjb2RlciBpcyBwcm9ncmFtbWVkIHRvIHRoZSBmdWxsIG1vZGUsCisJCSAg
KiBidXQgcGlwamUgdGltaW5ncyBhcmUgaGFsZiBvZiB0aGUgdHJhbnNjb2RlciBtb2RlCisJCSAg
Ki8KKwkJcGlwZV9tb2RlLT5jcnRjX2hkaXNwbGF5IC89IDI7CisJCXBpcGVfbW9kZS0+Y3J0Y19o
Ymxhbmtfc3RhcnQgLz0gMjsKKwkJcGlwZV9tb2RlLT5jcnRjX2hibGFua19lbmQgLz0gMjsKKwkJ
cGlwZV9tb2RlLT5jcnRjX2hzeW5jX3N0YXJ0IC89IDI7CisJCXBpcGVfbW9kZS0+Y3J0Y19oc3lu
Y19lbmQgLz0gMjsKKwkJcGlwZV9tb2RlLT5jcnRjX2h0b3RhbCAvPSAyOworCQlwaXBlX21vZGUt
PmNydGNfaHNrZXcgLz0gMjsKKwkJcGlwZV9tb2RlLT5jcnRjX2Nsb2NrIC89IDI7CisJfQorfQor
CiBzdGF0aWMgdm9pZCBpbnRlbF9jcnRjX2NvbXB1dGVfcGl4ZWxfcmF0ZShzdHJ1Y3QgaW50ZWxf
Y3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSkKIHsKIAlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2
X3ByaXYgPSB0b19pOTE1KGNydGNfc3RhdGUtPnVhcGkuY3J0Yy0+ZGV2KTsKQEAgLTg0NjEsMjAg
Kzg1NDgsMjIgQEAgc3RhdGljIHZvaWQgaW50ZWxfZ2V0X3BpcGVfc3JjX3NpemUoc3RydWN0IGlu
dGVsX2NydGMgKmNydGMsCiB2b2lkIGludGVsX21vZGVfZnJvbV9waXBlX2NvbmZpZyhzdHJ1Y3Qg
ZHJtX2Rpc3BsYXlfbW9kZSAqbW9kZSwKIAkJCQkgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKnBp
cGVfY29uZmlnKQogewotCW1vZGUtPmhkaXNwbGF5ID0gcGlwZV9jb25maWctPmh3LmFkanVzdGVk
X21vZGUuY3J0Y19oZGlzcGxheTsKLQltb2RlLT5odG90YWwgPSBwaXBlX2NvbmZpZy0+aHcuYWRq
dXN0ZWRfbW9kZS5jcnRjX2h0b3RhbDsKLQltb2RlLT5oc3luY19zdGFydCA9IHBpcGVfY29uZmln
LT5ody5hZGp1c3RlZF9tb2RlLmNydGNfaHN5bmNfc3RhcnQ7Ci0JbW9kZS0+aHN5bmNfZW5kID0g
cGlwZV9jb25maWctPmh3LmFkanVzdGVkX21vZGUuY3J0Y19oc3luY19lbmQ7CisJc3RydWN0IGRy
bV9kaXNwbGF5X21vZGUgKmh3X21vZGUgPSAmcGlwZV9jb25maWctPmh3LmFkanVzdGVkX21vZGU7
CisKKwltb2RlLT5oZGlzcGxheSA9IGh3X21vZGUtPmNydGNfaGRpc3BsYXk7CisJbW9kZS0+aHRv
dGFsID0gaHdfbW9kZS0+Y3J0Y19odG90YWw7CisJbW9kZS0+aHN5bmNfc3RhcnQgPSBod19tb2Rl
LT5jcnRjX2hzeW5jX3N0YXJ0OworCW1vZGUtPmhzeW5jX2VuZCA9IGh3X21vZGUtPmNydGNfaHN5
bmNfZW5kOwogCi0JbW9kZS0+dmRpc3BsYXkgPSBwaXBlX2NvbmZpZy0+aHcuYWRqdXN0ZWRfbW9k
ZS5jcnRjX3ZkaXNwbGF5OwotCW1vZGUtPnZ0b3RhbCA9IHBpcGVfY29uZmlnLT5ody5hZGp1c3Rl
ZF9tb2RlLmNydGNfdnRvdGFsOwotCW1vZGUtPnZzeW5jX3N0YXJ0ID0gcGlwZV9jb25maWctPmh3
LmFkanVzdGVkX21vZGUuY3J0Y192c3luY19zdGFydDsKLQltb2RlLT52c3luY19lbmQgPSBwaXBl
X2NvbmZpZy0+aHcuYWRqdXN0ZWRfbW9kZS5jcnRjX3ZzeW5jX2VuZDsKKwltb2RlLT52ZGlzcGxh
eSA9IGh3X21vZGUtPmNydGNfdmRpc3BsYXk7CisJbW9kZS0+dnRvdGFsID0gaHdfbW9kZS0+Y3J0
Y192dG90YWw7CisJbW9kZS0+dnN5bmNfc3RhcnQgPSBod19tb2RlLT5jcnRjX3ZzeW5jX3N0YXJ0
OworCW1vZGUtPnZzeW5jX2VuZCA9IGh3X21vZGUtPmNydGNfdnN5bmNfZW5kOwogCi0JbW9kZS0+
ZmxhZ3MgPSBwaXBlX2NvbmZpZy0+aHcuYWRqdXN0ZWRfbW9kZS5mbGFnczsKKwltb2RlLT5mbGFn
cyA9IGh3X21vZGUtPmZsYWdzOwogCW1vZGUtPnR5cGUgPSBEUk1fTU9ERV9UWVBFX0RSSVZFUjsK
IAotCW1vZGUtPmNsb2NrID0gcGlwZV9jb25maWctPmh3LmFkanVzdGVkX21vZGUuY3J0Y19jbG9j
azsKKwltb2RlLT5jbG9jayA9IGh3X21vZGUtPmNydGNfY2xvY2s7CiAKIAltb2RlLT5oc3luYyA9
IGRybV9tb2RlX2hzeW5jKG1vZGUpOwogCW1vZGUtPnZyZWZyZXNoID0gZHJtX21vZGVfdnJlZnJl
c2gobW9kZSk7CkBAIC0xMDU2NCw2ICsxMDY1Myw4IEBAIHN0YXRpYyB2b2lkIGhhc3dlbGxfZ2V0
X2RkaV9wb3J0X3N0YXRlKHN0cnVjdCBpbnRlbF9jcnRjICpjcnRjLAogCXUzMiB0bXA7CiAKIAl0
bXAgPSBJOTE1X1JFQUQoVFJBTlNfRERJX0ZVTkNfQ1RMKHBpcGVfY29uZmlnLT5jcHVfdHJhbnNj
b2RlcikpOworCWlmICghKHRtcCAmIFRSQU5TX0RESV9GVU5DX0VOQUJMRSkpCisJCXJldHVybjsK
IAogCWlmIChJTlRFTF9HRU4oZGV2X3ByaXYpID49IDEyKQogCQlwb3J0ID0gVEdMX1RSQU5TX0RE
SV9GVU5DX0NUTF9WQUxfVE9fUE9SVCh0bXApOwpAQCAtMTA2ODksMTEgKzEwNzgwLDE5IEBAIHN0
YXRpYyBib29sIGhhc3dlbGxfZ2V0X3BpcGVfY29uZmlnKHN0cnVjdCBpbnRlbF9jcnRjICpjcnRj
LAogCQlXQVJOX09OKGFjdGl2ZSk7CiAJCWFjdGl2ZSA9IHRydWU7CiAJfQorCWludGVsX2RzY19n
ZXRfY29uZmlnKHBpcGVfY29uZmlnKTsKIAotCWlmICghYWN0aXZlKQotCQlnb3RvIG91dDsKKwlp
ZiAoIWFjdGl2ZSkgeworCQkvKiBiaWdqb2luZXIgc2xhdmUgZG9lc24ndCBlbmFibGUgdHJhbnNj
b2RlciAqLworCQlpZiAoIXBpcGVfY29uZmlnLT5iaWdqb2luZXJfc2xhdmUpCisJCQlnb3RvIG91
dDsKIAotCWlmICghdHJhbnNjb2Rlcl9pc19kc2kocGlwZV9jb25maWctPmNwdV90cmFuc2NvZGVy
KSB8fAorCQlhY3RpdmUgPSB0cnVlOworCQlwaXBlX2NvbmZpZy0+cGl4ZWxfbXVsdGlwbGllciA9
IDE7CisKKwkJLyogd2UgY2Fubm90IHJlYWQgb3V0IG1vc3Qgc3RhdGUsIHNvIGRvbid0IGJvdGhl
ci4uICovCisJCXBpcGVfY29uZmlnLT5xdWlya3MgfD0gUElQRV9DT05GSUdfUVVJUktfQklHSk9J
TkVSX1NMQVZFOworCX0gZWxzZSBpZiAoIXRyYW5zY29kZXJfaXNfZHNpKHBpcGVfY29uZmlnLT5j
cHVfdHJhbnNjb2RlcikgfHwKIAkgICAgSU5URUxfR0VOKGRldl9wcml2KSA+PSAxMSkgewogCQlo
YXN3ZWxsX2dldF9kZGlfcG9ydF9zdGF0ZShjcnRjLCBwaXBlX2NvbmZpZyk7CiAJCWludGVsX2dl
dF90cmFuc2NvZGVyX3RpbWluZ3MoY3J0YywgcGlwZV9jb25maWcpOwpAQCAtMTA3NzAsNyArMTA4
NjksMTAgQEAgc3RhdGljIGJvb2wgaGFzd2VsbF9nZXRfcGlwZV9jb25maWcoc3RydWN0IGludGVs
X2NydGMgKmNydGMsCiAJCX0KIAl9CiAKLQlpZiAocGlwZV9jb25maWctPmNwdV90cmFuc2NvZGVy
ICE9IFRSQU5TQ09ERVJfRURQICYmCisJaWYgKHBpcGVfY29uZmlnLT5iaWdqb2luZXJfc2xhdmUp
IHsKKwkJLyogQ2Fubm90IGJlIHJlYWQgb3V0IGFzIGEgc2xhdmUsIHNldCB0byAwLiAqLworCQlw
aXBlX2NvbmZpZy0+cGl4ZWxfbXVsdGlwbGllciA9IDA7CisJfSBlbHNlIGlmIChwaXBlX2NvbmZp
Zy0+Y3B1X3RyYW5zY29kZXIgIT0gVFJBTlNDT0RFUl9FRFAgJiYKIAkgICAgIXRyYW5zY29kZXJf
aXNfZHNpKHBpcGVfY29uZmlnLT5jcHVfdHJhbnNjb2RlcikpIHsKIAkJcGlwZV9jb25maWctPnBp
eGVsX211bHRpcGxpZXIgPQogCQkJSTkxNV9SRUFEKFBJUEVfTVVMVChwaXBlX2NvbmZpZy0+Y3B1
X3RyYW5zY29kZXIpKSArIDE7CkBAIC0xMTc0OCw3ICsxMTg1MCw3IEBAIGludGVsX2VuY29kZXJf
Y3VycmVudF9tb2RlKHN0cnVjdCBpbnRlbF9lbmNvZGVyICplbmNvZGVyKQogCQlyZXR1cm4gTlVM
TDsKIAl9CiAKLQllbmNvZGVyLT5nZXRfY29uZmlnKGVuY29kZXIsIGNydGNfc3RhdGUpOworCWlu
dGVsX2VuY29kZXJfZ2V0X2NvbmZpZyhlbmNvZGVyLCBjcnRjX3N0YXRlKTsKIAogCWludGVsX21v
ZGVfZnJvbV9waXBlX2NvbmZpZyhtb2RlLCBjcnRjX3N0YXRlKTsKIApAQCAtMTI2NzQsMTAgKzEy
Nzc2LDExIEBAIGludGVsX2NydGNfY29weV91YXBpX3RvX2h3X3N0YXRlKHN0cnVjdCBpbnRlbF9h
dG9taWNfc3RhdGUgKnN0YXRlLAogc3RhdGljIHZvaWQgaW50ZWxfY3J0Y19jb3B5X2h3X3RvX3Vh
cGlfc3RhdGUoc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUsCiAJCQkJCSAgICAg
c3RydWN0IGRybV9kaXNwbGF5X21vZGUgKnVzZXJfbW9kZSkKIHsKLQljcnRjX3N0YXRlLT51YXBp
LmVuYWJsZSA9IGNydGNfc3RhdGUtPmh3LmVuYWJsZTsKLQljcnRjX3N0YXRlLT51YXBpLmFjdGl2
ZSA9IGNydGNfc3RhdGUtPmh3LmFjdGl2ZTsKLQlXQVJOX09OKGRybV9hdG9taWNfc2V0X21vZGVf
Zm9yX2NydGMoJmNydGNfc3RhdGUtPnVhcGksIHVzZXJfbW9kZSkgPCAwKTsKLQorCWlmICghY3J0
Y19zdGF0ZS0+Ymlnam9pbmVyX3NsYXZlKSB7CisJCWNydGNfc3RhdGUtPnVhcGkuZW5hYmxlID0g
Y3J0Y19zdGF0ZS0+aHcuZW5hYmxlOworCQljcnRjX3N0YXRlLT51YXBpLmFjdGl2ZSA9IGNydGNf
c3RhdGUtPmh3LmFjdGl2ZTsKKwkJV0FSTl9PTihkcm1fYXRvbWljX3NldF9tb2RlX2Zvcl9jcnRj
KCZjcnRjX3N0YXRlLT51YXBpLCB1c2VyX21vZGUpIDwgMCk7CisJfQogCWNydGNfc3RhdGUtPnVh
cGkuYWRqdXN0ZWRfbW9kZSA9IGNydGNfc3RhdGUtPmh3LmFkanVzdGVkX21vZGU7CiAKIAkvKiBj
b3B5IGNvbG9yIGJsb2JzIHRvIHVhcGkgKi8KQEAgLTEzMjU4LDIxICsxMzM2MSw0MyBAQCBpbnRl
bF9waXBlX2NvbmZpZ19jb21wYXJlKGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjdXJy
ZW50X2NvbmZpZywKIAogCVBJUEVfQ09ORl9DSEVDS19YKG91dHB1dF90eXBlcyk7CiAKLQlQSVBF
X0NPTkZfQ0hFQ0tfSShody5hZGp1c3RlZF9tb2RlLmNydGNfaGRpc3BsYXkpOwotCVBJUEVfQ09O
Rl9DSEVDS19JKGh3LmFkanVzdGVkX21vZGUuY3J0Y19odG90YWwpOwotCVBJUEVfQ09ORl9DSEVD
S19JKGh3LmFkanVzdGVkX21vZGUuY3J0Y19oYmxhbmtfc3RhcnQpOwotCVBJUEVfQ09ORl9DSEVD
S19JKGh3LmFkanVzdGVkX21vZGUuY3J0Y19oYmxhbmtfZW5kKTsKLQlQSVBFX0NPTkZfQ0hFQ0tf
SShody5hZGp1c3RlZF9tb2RlLmNydGNfaHN5bmNfc3RhcnQpOwotCVBJUEVfQ09ORl9DSEVDS19J
KGh3LmFkanVzdGVkX21vZGUuY3J0Y19oc3luY19lbmQpOwotCi0JUElQRV9DT05GX0NIRUNLX0ko
aHcuYWRqdXN0ZWRfbW9kZS5jcnRjX3ZkaXNwbGF5KTsKLQlQSVBFX0NPTkZfQ0hFQ0tfSShody5h
ZGp1c3RlZF9tb2RlLmNydGNfdnRvdGFsKTsKLQlQSVBFX0NPTkZfQ0hFQ0tfSShody5hZGp1c3Rl
ZF9tb2RlLmNydGNfdmJsYW5rX3N0YXJ0KTsKLQlQSVBFX0NPTkZfQ0hFQ0tfSShody5hZGp1c3Rl
ZF9tb2RlLmNydGNfdmJsYW5rX2VuZCk7Ci0JUElQRV9DT05GX0NIRUNLX0koaHcuYWRqdXN0ZWRf
bW9kZS5jcnRjX3ZzeW5jX3N0YXJ0KTsKLQlQSVBFX0NPTkZfQ0hFQ0tfSShody5hZGp1c3RlZF9t
b2RlLmNydGNfdnN5bmNfZW5kKTsKLQotCVBJUEVfQ09ORl9DSEVDS19JKHBpeGVsX211bHRpcGxp
ZXIpOworCWlmICghUElQRV9DT05GX1FVSVJLKFBJUEVfQ09ORklHX1FVSVJLX0JJR0pPSU5FUl9T
TEFWRSkpIHsKKwkJLyogYmlnam9pbmVyIG1vZGUgPSB0cmFuc2NvZGVyIG1vZGUgLyAyLCBmb3Ig
Y2FsY3VsYXRpb25zICovCisJCVBJUEVfQ09ORl9DSEVDS19JKGh3LnBpcGVfbW9kZS5jcnRjX2hk
aXNwbGF5KTsKKwkJUElQRV9DT05GX0NIRUNLX0koaHcucGlwZV9tb2RlLmNydGNfaHRvdGFsKTsK
KwkJUElQRV9DT05GX0NIRUNLX0koaHcucGlwZV9tb2RlLmNydGNfdmRpc3BsYXkpOworCQlQSVBF
X0NPTkZfQ0hFQ0tfSShody5waXBlX21vZGUuY3J0Y192dG90YWwpOworCisJCVBJUEVfQ09ORl9D
SEVDS19JKGh3LmFkanVzdGVkX21vZGUuY3J0Y19oZGlzcGxheSk7CisJCVBJUEVfQ09ORl9DSEVD
S19JKGh3LmFkanVzdGVkX21vZGUuY3J0Y19odG90YWwpOworCQlQSVBFX0NPTkZfQ0hFQ0tfSSho
dy5hZGp1c3RlZF9tb2RlLmNydGNfaGJsYW5rX3N0YXJ0KTsKKwkJUElQRV9DT05GX0NIRUNLX0ko
aHcuYWRqdXN0ZWRfbW9kZS5jcnRjX2hibGFua19lbmQpOworCQlQSVBFX0NPTkZfQ0hFQ0tfSSho
dy5hZGp1c3RlZF9tb2RlLmNydGNfaHN5bmNfc3RhcnQpOworCQlQSVBFX0NPTkZfQ0hFQ0tfSSho
dy5hZGp1c3RlZF9tb2RlLmNydGNfaHN5bmNfZW5kKTsKKworCQlQSVBFX0NPTkZfQ0hFQ0tfSSho
dy5hZGp1c3RlZF9tb2RlLmNydGNfdmRpc3BsYXkpOworCQlQSVBFX0NPTkZfQ0hFQ0tfSShody5h
ZGp1c3RlZF9tb2RlLmNydGNfdnRvdGFsKTsKKwkJUElQRV9DT05GX0NIRUNLX0koaHcuYWRqdXN0
ZWRfbW9kZS5jcnRjX3ZibGFua19zdGFydCk7CisJCVBJUEVfQ09ORl9DSEVDS19JKGh3LmFkanVz
dGVkX21vZGUuY3J0Y192YmxhbmtfZW5kKTsKKwkJUElQRV9DT05GX0NIRUNLX0koaHcuYWRqdXN0
ZWRfbW9kZS5jcnRjX3ZzeW5jX3N0YXJ0KTsKKwkJUElQRV9DT05GX0NIRUNLX0koaHcuYWRqdXN0
ZWRfbW9kZS5jcnRjX3ZzeW5jX2VuZCk7CisKKwkJUElQRV9DT05GX0NIRUNLX0ZMQUdTKGh3LmFk
anVzdGVkX21vZGUuZmxhZ3MsCisJCQkJICAgICAgRFJNX01PREVfRkxBR19JTlRFUkxBQ0UpOwor
CisJCWlmICghUElQRV9DT05GX1FVSVJLKFBJUEVfQ09ORklHX1FVSVJLX01PREVfU1lOQ19GTEFH
UykpIHsKKwkJCVBJUEVfQ09ORl9DSEVDS19GTEFHUyhody5hZGp1c3RlZF9tb2RlLmZsYWdzLAor
CQkJCQkgICAgICBEUk1fTU9ERV9GTEFHX1BIU1lOQyk7CisJCQlQSVBFX0NPTkZfQ0hFQ0tfRkxB
R1MoaHcuYWRqdXN0ZWRfbW9kZS5mbGFncywKKwkJCQkJICAgICAgRFJNX01PREVfRkxBR19OSFNZ
TkMpOworCQkJUElQRV9DT05GX0NIRUNLX0ZMQUdTKGh3LmFkanVzdGVkX21vZGUuZmxhZ3MsCisJ
CQkJCSAgICAgIERSTV9NT0RFX0ZMQUdfUFZTWU5DKTsKKwkJCVBJUEVfQ09ORl9DSEVDS19GTEFH
Uyhody5hZGp1c3RlZF9tb2RlLmZsYWdzLAorCQkJCQkgICAgICBEUk1fTU9ERV9GTEFHX05WU1lO
Qyk7CisJCX0KKwkJUElQRV9DT05GX0NIRUNLX0kocGl4ZWxfbXVsdGlwbGllcik7CisJfQorCiAJ
UElQRV9DT05GX0NIRUNLX0kob3V0cHV0X2Zvcm1hdCk7CiAJUElQRV9DT05GX0NIRUNLX0koZGMz
Y29fZXhpdGxpbmUpOwogCVBJUEVfQ09ORl9DSEVDS19CT09MKGhhc19oZG1pX3NpbmspOwpAQCAt
MTMyODMsMjQgKzEzNDA4LDExIEBAIGludGVsX3BpcGVfY29uZmlnX2NvbXBhcmUoY29uc3Qgc3Ry
dWN0IGludGVsX2NydGNfc3RhdGUgKmN1cnJlbnRfY29uZmlnLAogCVBJUEVfQ09ORl9DSEVDS19C
T09MKGhkbWlfc2NyYW1ibGluZyk7CiAJUElQRV9DT05GX0NIRUNLX0JPT0woaGRtaV9oaWdoX3Rt
ZHNfY2xvY2tfcmF0aW8pOwogCVBJUEVfQ09ORl9DSEVDS19CT09MKGhhc19pbmZvZnJhbWUpOwot
CVBJUEVfQ09ORl9DSEVDS19CT09MKGZlY19lbmFibGUpOworCWlmICghUElQRV9DT05GX1FVSVJL
KFBJUEVfQ09ORklHX1FVSVJLX0JJR0pPSU5FUl9TTEFWRSkpCisJCVBJUEVfQ09ORl9DSEVDS19C
T09MKGZlY19lbmFibGUpOwogCiAJUElQRV9DT05GX0NIRUNLX0JPT0xfSU5DT01QTEVURShoYXNf
YXVkaW8pOwogCi0JUElQRV9DT05GX0NIRUNLX0ZMQUdTKGh3LmFkanVzdGVkX21vZGUuZmxhZ3Ms
Ci0JCQkgICAgICBEUk1fTU9ERV9GTEFHX0lOVEVSTEFDRSk7Ci0KLQlpZiAoIVBJUEVfQ09ORl9R
VUlSSyhQSVBFX0NPTkZJR19RVUlSS19NT0RFX1NZTkNfRkxBR1MpKSB7Ci0JCVBJUEVfQ09ORl9D
SEVDS19GTEFHUyhody5hZGp1c3RlZF9tb2RlLmZsYWdzLAotCQkJCSAgICAgIERSTV9NT0RFX0ZM
QUdfUEhTWU5DKTsKLQkJUElQRV9DT05GX0NIRUNLX0ZMQUdTKGh3LmFkanVzdGVkX21vZGUuZmxh
Z3MsCi0JCQkJICAgICAgRFJNX01PREVfRkxBR19OSFNZTkMpOwotCQlQSVBFX0NPTkZfQ0hFQ0tf
RkxBR1MoaHcuYWRqdXN0ZWRfbW9kZS5mbGFncywKLQkJCQkgICAgICBEUk1fTU9ERV9GTEFHX1BW
U1lOQyk7Ci0JCVBJUEVfQ09ORl9DSEVDS19GTEFHUyhody5hZGp1c3RlZF9tb2RlLmZsYWdzLAot
CQkJCSAgICAgIERSTV9NT0RFX0ZMQUdfTlZTWU5DKTsKLQl9Ci0KIAlQSVBFX0NPTkZfQ0hFQ0tf
WChnbWNoX3BmaXQuY29udHJvbCk7CiAJLyogcGZpdCByYXRpb3MgYXJlIGF1dG9jb21wdXRlZCBi
eSB0aGUgaHcgb24gZ2VuNCsgKi8KIAlpZiAoSU5URUxfR0VOKGRldl9wcml2KSA8IDQpCkBAIC0x
MzMyNCw3ICsxMzQzNiw4IEBAIGludGVsX3BpcGVfY29uZmlnX2NvbXBhcmUoY29uc3Qgc3RydWN0
IGludGVsX2NydGNfc3RhdGUgKmN1cnJlbnRfY29uZmlnLAogCQl9CiAKIAkJUElQRV9DT05GX0NI
RUNLX0koc2NhbGVyX3N0YXRlLnNjYWxlcl9pZCk7Ci0JCVBJUEVfQ09ORl9DSEVDS19DTE9DS19G
VVpaWShwaXhlbF9yYXRlKTsKKwkJaWYgKCFQSVBFX0NPTkZfUVVJUksoUElQRV9DT05GSUdfUVVJ
UktfQklHSk9JTkVSX1NMQVZFKSkKKwkJCVBJUEVfQ09ORl9DSEVDS19DTE9DS19GVVpaWShwaXhl
bF9yYXRlKTsKIAogCQlQSVBFX0NPTkZfQ0hFQ0tfWChnYW1tYV9tb2RlKTsKIAkJaWYgKElTX0NI
RVJSWVZJRVcoZGV2X3ByaXYpKQpAQCAtMTMzNDMsNDggKzEzNDU2LDUxIEBAIGludGVsX3BpcGVf
Y29uZmlnX2NvbXBhcmUoY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmN1cnJlbnRfY29u
ZmlnLAogCVBJUEVfQ09ORl9DSEVDS19CT09MKGRvdWJsZV93aWRlKTsKIAogCVBJUEVfQ09ORl9D
SEVDS19QKHNoYXJlZF9kcGxsKTsKKwlpZiAoIVBJUEVfQ09ORl9RVUlSSyhQSVBFX0NPTkZJR19R
VUlSS19CSUdKT0lORVJfU0xBVkUpKSB7CiAJUElQRV9DT05GX0NIRUNLX1goZHBsbF9od19zdGF0
ZS5kcGxsKTsKLQlQSVBFX0NPTkZfQ0hFQ0tfWChkcGxsX2h3X3N0YXRlLmRwbGxfbWQpOwotCVBJ
UEVfQ09ORl9DSEVDS19YKGRwbGxfaHdfc3RhdGUuZnAwKTsKLQlQSVBFX0NPTkZfQ0hFQ0tfWChk
cGxsX2h3X3N0YXRlLmZwMSk7Ci0JUElQRV9DT05GX0NIRUNLX1goZHBsbF9od19zdGF0ZS53cnBs
bCk7Ci0JUElQRV9DT05GX0NIRUNLX1goZHBsbF9od19zdGF0ZS5zcGxsKTsKLQlQSVBFX0NPTkZf
Q0hFQ0tfWChkcGxsX2h3X3N0YXRlLmN0cmwxKTsKLQlQSVBFX0NPTkZfQ0hFQ0tfWChkcGxsX2h3
X3N0YXRlLmNmZ2NyMSk7Ci0JUElQRV9DT05GX0NIRUNLX1goZHBsbF9od19zdGF0ZS5jZmdjcjIp
OwotCVBJUEVfQ09ORl9DSEVDS19YKGRwbGxfaHdfc3RhdGUuY2ZnY3IwKTsKLQlQSVBFX0NPTkZf
Q0hFQ0tfWChkcGxsX2h3X3N0YXRlLmViYjApOwotCVBJUEVfQ09ORl9DSEVDS19YKGRwbGxfaHdf
c3RhdGUuZWJiNCk7Ci0JUElQRV9DT05GX0NIRUNLX1goZHBsbF9od19zdGF0ZS5wbGwwKTsKLQlQ
SVBFX0NPTkZfQ0hFQ0tfWChkcGxsX2h3X3N0YXRlLnBsbDEpOwotCVBJUEVfQ09ORl9DSEVDS19Y
KGRwbGxfaHdfc3RhdGUucGxsMik7Ci0JUElQRV9DT05GX0NIRUNLX1goZHBsbF9od19zdGF0ZS5w
bGwzKTsKLQlQSVBFX0NPTkZfQ0hFQ0tfWChkcGxsX2h3X3N0YXRlLnBsbDYpOwotCVBJUEVfQ09O
Rl9DSEVDS19YKGRwbGxfaHdfc3RhdGUucGxsOCk7Ci0JUElQRV9DT05GX0NIRUNLX1goZHBsbF9o
d19zdGF0ZS5wbGw5KTsKLQlQSVBFX0NPTkZfQ0hFQ0tfWChkcGxsX2h3X3N0YXRlLnBsbDEwKTsK
LQlQSVBFX0NPTkZfQ0hFQ0tfWChkcGxsX2h3X3N0YXRlLnBjc2R3MTIpOwotCVBJUEVfQ09ORl9D
SEVDS19YKGRwbGxfaHdfc3RhdGUubWdfcmVmY2xraW5fY3RsKTsKLQlQSVBFX0NPTkZfQ0hFQ0tf
WChkcGxsX2h3X3N0YXRlLm1nX2Nsa3RvcDJfY29yZWNsa2N0bDEpOwotCVBJUEVfQ09ORl9DSEVD
S19YKGRwbGxfaHdfc3RhdGUubWdfY2xrdG9wMl9oc2Nsa2N0bCk7Ci0JUElQRV9DT05GX0NIRUNL
X1goZHBsbF9od19zdGF0ZS5tZ19wbGxfZGl2MCk7Ci0JUElQRV9DT05GX0NIRUNLX1goZHBsbF9o
d19zdGF0ZS5tZ19wbGxfZGl2MSk7Ci0JUElQRV9DT05GX0NIRUNLX1goZHBsbF9od19zdGF0ZS5t
Z19wbGxfbGYpOwotCVBJUEVfQ09ORl9DSEVDS19YKGRwbGxfaHdfc3RhdGUubWdfcGxsX2ZyYWNf
bG9jayk7Ci0JUElQRV9DT05GX0NIRUNLX1goZHBsbF9od19zdGF0ZS5tZ19wbGxfc3NjKTsKLQlQ
SVBFX0NPTkZfQ0hFQ0tfWChkcGxsX2h3X3N0YXRlLm1nX3BsbF9iaWFzKTsKLQlQSVBFX0NPTkZf
Q0hFQ0tfWChkcGxsX2h3X3N0YXRlLm1nX3BsbF90ZGNfY29sZHN0X2JpYXMpOwotCi0JUElQRV9D
T05GX0NIRUNLX1goZHNpX3BsbC5jdHJsKTsKLQlQSVBFX0NPTkZfQ0hFQ0tfWChkc2lfcGxsLmRp
dik7Ci0KLQlpZiAoSVNfRzRYKGRldl9wcml2KSB8fCBJTlRFTF9HRU4oZGV2X3ByaXYpID49IDUp
Ci0JCVBJUEVfQ09ORl9DSEVDS19JKHBpcGVfYnBwKTsKLQotCVBJUEVfQ09ORl9DSEVDS19DTE9D
S19GVVpaWShody5hZGp1c3RlZF9tb2RlLmNydGNfY2xvY2spOwotCVBJUEVfQ09ORl9DSEVDS19D
TE9DS19GVVpaWShwb3J0X2Nsb2NrKTsKLQotCVBJUEVfQ09ORl9DSEVDS19JKG1pbl92b2x0YWdl
X2xldmVsKTsKKwkJUElQRV9DT05GX0NIRUNLX1goZHBsbF9od19zdGF0ZS5kcGxsX21kKTsKKwkJ
UElQRV9DT05GX0NIRUNLX1goZHBsbF9od19zdGF0ZS5mcDApOworCQlQSVBFX0NPTkZfQ0hFQ0tf
WChkcGxsX2h3X3N0YXRlLmZwMSk7CisJCVBJUEVfQ09ORl9DSEVDS19YKGRwbGxfaHdfc3RhdGUu
d3JwbGwpOworCQlQSVBFX0NPTkZfQ0hFQ0tfWChkcGxsX2h3X3N0YXRlLnNwbGwpOworCQlQSVBF
X0NPTkZfQ0hFQ0tfWChkcGxsX2h3X3N0YXRlLmN0cmwxKTsKKwkJUElQRV9DT05GX0NIRUNLX1go
ZHBsbF9od19zdGF0ZS5jZmdjcjEpOworCQlQSVBFX0NPTkZfQ0hFQ0tfWChkcGxsX2h3X3N0YXRl
LmNmZ2NyMik7CisJCVBJUEVfQ09ORl9DSEVDS19YKGRwbGxfaHdfc3RhdGUuY2ZnY3IwKTsKKwkJ
UElQRV9DT05GX0NIRUNLX1goZHBsbF9od19zdGF0ZS5lYmIwKTsKKwkJUElQRV9DT05GX0NIRUNL
X1goZHBsbF9od19zdGF0ZS5lYmI0KTsKKwkJUElQRV9DT05GX0NIRUNLX1goZHBsbF9od19zdGF0
ZS5wbGwwKTsKKwkJUElQRV9DT05GX0NIRUNLX1goZHBsbF9od19zdGF0ZS5wbGwxKTsKKwkJUElQ
RV9DT05GX0NIRUNLX1goZHBsbF9od19zdGF0ZS5wbGwyKTsKKwkJUElQRV9DT05GX0NIRUNLX1go
ZHBsbF9od19zdGF0ZS5wbGwzKTsKKwkJUElQRV9DT05GX0NIRUNLX1goZHBsbF9od19zdGF0ZS5w
bGw2KTsKKwkJUElQRV9DT05GX0NIRUNLX1goZHBsbF9od19zdGF0ZS5wbGw4KTsKKwkJUElQRV9D
T05GX0NIRUNLX1goZHBsbF9od19zdGF0ZS5wbGw5KTsKKwkJUElQRV9DT05GX0NIRUNLX1goZHBs
bF9od19zdGF0ZS5wbGwxMCk7CisJCVBJUEVfQ09ORl9DSEVDS19YKGRwbGxfaHdfc3RhdGUucGNz
ZHcxMik7CisJCVBJUEVfQ09ORl9DSEVDS19YKGRwbGxfaHdfc3RhdGUubWdfcmVmY2xraW5fY3Rs
KTsKKwkJUElQRV9DT05GX0NIRUNLX1goZHBsbF9od19zdGF0ZS5tZ19jbGt0b3AyX2NvcmVjbGtj
dGwxKTsKKwkJUElQRV9DT05GX0NIRUNLX1goZHBsbF9od19zdGF0ZS5tZ19jbGt0b3AyX2hzY2xr
Y3RsKTsKKwkJUElQRV9DT05GX0NIRUNLX1goZHBsbF9od19zdGF0ZS5tZ19wbGxfZGl2MCk7CisJ
CVBJUEVfQ09ORl9DSEVDS19YKGRwbGxfaHdfc3RhdGUubWdfcGxsX2RpdjEpOworCQlQSVBFX0NP
TkZfQ0hFQ0tfWChkcGxsX2h3X3N0YXRlLm1nX3BsbF9sZik7CisJCVBJUEVfQ09ORl9DSEVDS19Y
KGRwbGxfaHdfc3RhdGUubWdfcGxsX2ZyYWNfbG9jayk7CisJCVBJUEVfQ09ORl9DSEVDS19YKGRw
bGxfaHdfc3RhdGUubWdfcGxsX3NzYyk7CisJCVBJUEVfQ09ORl9DSEVDS19YKGRwbGxfaHdfc3Rh
dGUubWdfcGxsX2JpYXMpOworCQlQSVBFX0NPTkZfQ0hFQ0tfWChkcGxsX2h3X3N0YXRlLm1nX3Bs
bF90ZGNfY29sZHN0X2JpYXMpOworCisJCVBJUEVfQ09ORl9DSEVDS19YKGRzaV9wbGwuY3RybCk7
CisJCVBJUEVfQ09ORl9DSEVDS19YKGRzaV9wbGwuZGl2KTsKKworCQlpZiAoSVNfRzRYKGRldl9w
cml2KSB8fCBJTlRFTF9HRU4oZGV2X3ByaXYpID49IDUpCisJCQlQSVBFX0NPTkZfQ0hFQ0tfSShw
aXBlX2JwcCk7CisKKwkJUElQRV9DT05GX0NIRUNLX0NMT0NLX0ZVWlpZKGh3LmFkanVzdGVkX21v
ZGUuY3J0Y19jbG9jayk7CisJCVBJUEVfQ09ORl9DSEVDS19DTE9DS19GVVpaWShody5waXBlX21v
ZGUuY3J0Y19jbG9jayk7CisJCVBJUEVfQ09ORl9DSEVDS19DTE9DS19GVVpaWShwb3J0X2Nsb2Nr
KTsKKworCQlQSVBFX0NPTkZfQ0hFQ0tfSShtaW5fdm9sdGFnZV9sZXZlbCk7CisJfQogCiAJUElQ
RV9DT05GX0NIRUNLX1goaW5mb2ZyYW1lcy5lbmFibGUpOwogCVBJUEVfQ09ORl9DSEVDS19YKGlu
Zm9mcmFtZXMuZ2NwKTsKQEAgLTEzMzk1LDYgKzEzNTExLDExIEBAIGludGVsX3BpcGVfY29uZmln
X2NvbXBhcmUoY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmN1cnJlbnRfY29uZmlnLAog
CiAJUElQRV9DT05GX0NIRUNLX0koc3luY19tb2RlX3NsYXZlc19tYXNrKTsKIAlQSVBFX0NPTkZf
Q0hFQ0tfSShtYXN0ZXJfdHJhbnNjb2Rlcik7CisJUElQRV9DT05GX0NIRUNLX0JPT0woYmlnam9p
bmVyKTsKKwlQSVBFX0NPTkZfQ0hFQ0tfQk9PTChiaWdqb2luZXJfc2xhdmUpOworCVBJUEVfQ09O
Rl9DSEVDS19QKGJpZ2pvaW5lcl9saW5rZWRfY3J0Yyk7CisJUElQRV9DT05GX0NIRUNLX0JPT0wo
ZHNjLmNvbXByZXNzaW9uX2VuYWJsZSk7CisJUElQRV9DT05GX0NIRUNLX0JPT0woZHNjLmRzY19z
cGxpdCk7CiAKICN1bmRlZiBQSVBFX0NPTkZfQ0hFQ0tfWAogI3VuZGVmIFBJUEVfQ09ORl9DSEVD
S19JCkBAIC0xMzY1MCw2ICsxMzc3MSw3IEBAIHZlcmlmeV9jcnRjX3N0YXRlKHN0cnVjdCBpbnRl
bF9jcnRjICpjcnRjLAogCXN0cnVjdCBpbnRlbF9lbmNvZGVyICplbmNvZGVyOwogCXN0cnVjdCBp
bnRlbF9jcnRjX3N0YXRlICpwaXBlX2NvbmZpZzsKIAlzdHJ1Y3QgZHJtX2F0b21pY19zdGF0ZSAq
c3RhdGU7CisJc3RydWN0IGludGVsX2NydGMgKm1hc3RlciA9IGNydGM7CiAJYm9vbCBhY3RpdmU7
CiAKIAlzdGF0ZSA9IG9sZF9jcnRjX3N0YXRlLT51YXBpLnN0YXRlOwpAQCAtMTM2NzksNyArMTM4
MDEsMTAgQEAgdmVyaWZ5X2NydGNfc3RhdGUoc3RydWN0IGludGVsX2NydGMgKmNydGMsCiAJCQki
KGV4cGVjdGVkICVpLCBmb3VuZCAlaSlcbiIsCiAJCQluZXdfY3J0Y19zdGF0ZS0+aHcuYWN0aXZl
LCBjcnRjLT5hY3RpdmUpOwogCi0JZm9yX2VhY2hfZW5jb2Rlcl9vbl9jcnRjKGRldiwgJmNydGMt
PmJhc2UsIGVuY29kZXIpIHsKKwlpZiAobmV3X2NydGNfc3RhdGUtPmJpZ2pvaW5lcl9zbGF2ZSkK
KwkJbWFzdGVyID0gbmV3X2NydGNfc3RhdGUtPmJpZ2pvaW5lcl9saW5rZWRfY3J0YzsKKworCWZv
cl9lYWNoX2VuY29kZXJfb25fY3J0YyhkZXYsICZtYXN0ZXItPmJhc2UsIGVuY29kZXIpIHsKIAkJ
ZW51bSBwaXBlIHBpcGU7CiAKIAkJYWN0aXZlID0gZW5jb2Rlci0+Z2V0X2h3X3N0YXRlKGVuY29k
ZXIsICZwaXBlKTsKQEAgLTEzNjg4LDEyICsxMzgxMywxMiBAQCB2ZXJpZnlfY3J0Y19zdGF0ZShz
dHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YywKIAkJCQllbmNvZGVyLT5iYXNlLmJhc2UuaWQsIGFjdGl2
ZSwKIAkJCQluZXdfY3J0Y19zdGF0ZS0+aHcuYWN0aXZlKTsKIAotCQlJOTE1X1NUQVRFX1dBUk4o
YWN0aXZlICYmIGNydGMtPnBpcGUgIT0gcGlwZSwKKwkJSTkxNV9TVEFURV9XQVJOKGFjdGl2ZSAm
JiBtYXN0ZXItPnBpcGUgIT0gcGlwZSwKIAkJCQkiRW5jb2RlciBjb25uZWN0ZWQgdG8gd3Jvbmcg
cGlwZSAlY1xuIiwKIAkJCQlwaXBlX25hbWUocGlwZSkpOwogCiAJCWlmIChhY3RpdmUpCi0JCQll
bmNvZGVyLT5nZXRfY29uZmlnKGVuY29kZXIsIHBpcGVfY29uZmlnKTsKKwkJCWludGVsX2VuY29k
ZXJfZ2V0X2NvbmZpZyhlbmNvZGVyLCBwaXBlX2NvbmZpZyk7CiAJfQogCiAJaW50ZWxfY3J0Y19j
b21wdXRlX3BpeGVsX3JhdGUocGlwZV9jb25maWcpOwpAQCAtMTQ0NzMsNyArMTQ1OTgsNiBAQCBz
dGF0aWMgdm9pZCBpbnRlbF91cGRhdGVfY3J0YyhzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YywKIAog
CWlmIChtb2Rlc2V0KSB7CiAJCWludGVsX2NydGNfdXBkYXRlX2FjdGl2ZV90aW1pbmdzKG5ld19j
cnRjX3N0YXRlKTsKLQogCQlkZXZfcHJpdi0+ZGlzcGxheS5jcnRjX2VuYWJsZShuZXdfY3J0Y19z
dGF0ZSwgc3RhdGUpOwogCiAJCS8qIHZibGFua3Mgd29yayBhZ2FpbiwgcmUtZW5hYmxlIHBpcGUg
Q1JDLiAqLwpAQCAtMTQ2MTMsNyArMTQ3MzcsNyBAQCBzdGF0aWMgdm9pZCBpbnRlbF9jb21taXRf
bW9kZXNldF9kaXNhYmxlcyhzdHJ1Y3QgaW50ZWxfYXRvbWljX3N0YXRlICpzdGF0ZSkKIAkgKi8K
IAlmb3JfZWFjaF9vbGRuZXdfaW50ZWxfY3J0Y19pbl9zdGF0ZV9yZXZlcnNlKHN0YXRlLCBjcnRj
LCBvbGRfY3J0Y19zdGF0ZSwKIAkJCQkJCSAgICBuZXdfY3J0Y19zdGF0ZSwgaSkgewotCQlpZiAo
IW5lZWRzX21vZGVzZXQobmV3X2NydGNfc3RhdGUpKQorCQlpZiAoIW5lZWRzX21vZGVzZXQobmV3
X2NydGNfc3RhdGUpIHx8IG9sZF9jcnRjX3N0YXRlLT5iaWdqb2luZXJfc2xhdmUpCiAJCQljb250
aW51ZTsKIAogCQkvKiBJbiBjYXNlIG9mIFRyYW5zY29kZXIgcG9ydCBTeW5jIG1hc3RlciBzbGF2
ZSBDUlRDcyBjYW4gYmUKQEAgLTE0NjM3LDYgKzE0NzYxLDE5IEBAIHN0YXRpYyB2b2lkIGludGVs
X2NvbW1pdF9tb2Rlc2V0X2Rpc2FibGVzKHN0cnVjdCBpbnRlbF9hdG9taWNfc3RhdGUgKnN0YXRl
KQogCQkJCQkJCSAgICAgIG9sZF9jcnRjX3N0YXRlLAogCQkJCQkJCSAgICAgIG5ld19jcnRjX3N0
YXRlLAogCQkJCQkJCSAgICAgIGNydGMpOworCisJCQlpZiAob2xkX2NydGNfc3RhdGUtPmJpZ2pv
aW5lcikgeworCQkJCXN0cnVjdCBpbnRlbF9jcnRjICpzbGF2ZSA9IG9sZF9jcnRjX3N0YXRlLT5i
aWdqb2luZXJfbGlua2VkX2NydGM7CisJCQkJc3RydWN0IGludGVsX2NydGNfc3RhdGUgKm9sZF9z
bGF2ZV9jcnRjX3N0YXRlID0KKwkJCQkJaW50ZWxfYXRvbWljX2dldF9jcnRjX3N0YXRlKCZzdGF0
ZS0+YmFzZSwgc2xhdmUpOworCQkJCXN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpuZXdfc2xhdmVf
Y3J0Y19zdGF0ZSA9CisJCQkJCWludGVsX2F0b21pY19nZXRfY3J0Y19zdGF0ZSgmc3RhdGUtPmJh
c2UsIHNsYXZlKTsKKworCQkJCWludGVsX29sZF9jcnRjX3N0YXRlX2Rpc2FibGVzKHN0YXRlLAor
CQkJCQkJCSAgICAgIG9sZF9zbGF2ZV9jcnRjX3N0YXRlLAorCQkJCQkJCSAgICAgIG5ld19zbGF2
ZV9jcnRjX3N0YXRlLAorCQkJCQkJCSAgICAgIHNsYXZlKTsKKwkJCX0KIAkJfQogCX0KIH0KQEAg
LTE3MTY4LDcgKzE3MzA1LDcgQEAgaW50IGludGVsX21vZGVzZXRfaW5pdChzdHJ1Y3QgZHJtX2k5
MTVfcHJpdmF0ZSAqaTkxNSkKIAlmb3JfZWFjaF9pbnRlbF9jcnRjKGRldiwgY3J0YykgewogCQlz
dHJ1Y3QgaW50ZWxfaW5pdGlhbF9wbGFuZV9jb25maWcgcGxhbmVfY29uZmlnID0ge307CiAKLQkJ
aWYgKCFjcnRjLT5hY3RpdmUpCisJCWlmICghdG9faW50ZWxfY3J0Y19zdGF0ZShjcnRjLT5iYXNl
LnN0YXRlKS0+dWFwaS5hY3RpdmUpCiAJCQljb250aW51ZTsKIAogCQkvKgpAQCAtMTc2MjQsNyAr
MTc3NjEsMTcgQEAgc3RhdGljIHZvaWQgaW50ZWxfbW9kZXNldF9yZWFkb3V0X2h3X3N0YXRlKHN0
cnVjdCBkcm1fZGV2aWNlICpkZXYpCiAJCQljcnRjX3N0YXRlID0gdG9faW50ZWxfY3J0Y19zdGF0
ZShjcnRjLT5iYXNlLnN0YXRlKTsKIAogCQkJZW5jb2Rlci0+YmFzZS5jcnRjID0gJmNydGMtPmJh
c2U7Ci0JCQllbmNvZGVyLT5nZXRfY29uZmlnKGVuY29kZXIsIGNydGNfc3RhdGUpOworCQkJaW50
ZWxfZW5jb2Rlcl9nZXRfY29uZmlnKGVuY29kZXIsIGNydGNfc3RhdGUpOworCisJCQkvKiByZWFk
IG91dCB0byBzbGF2ZSBjcnRjIGFzIHdlbGwgZm9yIGJpZ2pvaW5lciAqLworCQkJaWYgKGNydGNf
c3RhdGUtPmJpZ2pvaW5lcikgeworCQkJCS8qIGVuY29kZXIgc2hvdWxkIHJlYWQgYmUgbGlua2Vk
IHRvIGJpZ2pvaW5lciBtYXN0ZXIgKi8KKwkJCQlXQVJOX09OKGNydGNfc3RhdGUtPmJpZ2pvaW5l
cl9zbGF2ZSk7CisKKwkJCQljcnRjID0gY3J0Y19zdGF0ZS0+Ymlnam9pbmVyX2xpbmtlZF9jcnRj
OworCQkJCWNydGNfc3RhdGUgPSB0b19pbnRlbF9jcnRjX3N0YXRlKGNydGMtPmJhc2Uuc3RhdGUp
OworCQkJCWludGVsX2VuY29kZXJfZ2V0X2NvbmZpZyhlbmNvZGVyLCBjcnRjX3N0YXRlKTsKKwkJ
CX0KIAkJfSBlbHNlIHsKIAkJCWVuY29kZXItPmJhc2UuY3J0YyA9IE5VTEw7CiAJCX0KZGlmZiAt
LWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZGlzcGxheV90eXBlcy5o
IGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kaXNwbGF5X3R5cGVzLmgKaW5k
ZXggY2YyZWNmYTE3NDE2Li44NmEwNTI0YjNjZDggMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2Ry
bS9pOTE1L2Rpc3BsYXkvaW50ZWxfZGlzcGxheV90eXBlcy5oCisrKyBiL2RyaXZlcnMvZ3B1L2Ry
bS9pOTE1L2Rpc3BsYXkvaW50ZWxfZGlzcGxheV90eXBlcy5oCkBAIC04MjEsNiArODIxLDcgQEAg
c3RydWN0IGludGVsX2NydGNfc3RhdGUgewogCSAqIGFjY29yZGluZ2x5LgogCSAqLwogI2RlZmlu
ZSBQSVBFX0NPTkZJR19RVUlSS19NT0RFX1NZTkNfRkxBR1MJKDE8PDApIC8qIHVucmVsaWFibGUg
c3luYyBtb2RlLmZsYWdzICovCisjZGVmaW5lIFBJUEVfQ09ORklHX1FVSVJLX0JJR0pPSU5FUl9T
TEFWRQkoMTw8MSkgLyogYmlnam9pbmVyIHNsYXZlLCBwYXJ0aWFsIHJlYWRvdXQgKi8KIAl1bnNp
Z25lZCBsb25nIHF1aXJrczsKIAogCXVuc2lnbmVkIGZiX2JpdHM7IC8qIGZyYW1lYnVmZmVycyB0
byBmbGlwICovCkBAIC0xNjM5LDQgKzE2NDAsMjUgQEAgc3RhdGljIGlubGluZSB1MzIgaW50ZWxf
cGxhbmVfZ2d0dF9vZmZzZXQoY29uc3Qgc3RydWN0IGludGVsX3BsYW5lX3N0YXRlICpzdGF0ZSkK
IAlyZXR1cm4gaTkxNV9nZ3R0X29mZnNldChzdGF0ZS0+dm1hKTsKIH0KIAorc3RhdGljIGlubGlu
ZSBib29sCitpbnRlbF9jcnRjX3N1cHBvcnRzX2RzYyhjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19z
dGF0ZSAqcGlwZV9jb25maWcpCit7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2
ID0gdG9faTkxNShwaXBlX2NvbmZpZy0+dWFwaS5jcnRjLT5kZXYpOworCisJaWYgKCFJTlRFTF9J
TkZPKGRldl9wcml2KS0+ZGlzcGxheS5oYXNfZHNjKQorCQlyZXR1cm4gZmFsc2U7CisKKwkvKiBP
biBUR0wsIERTQyBpcyBzdXBwb3J0ZWQgb24gYWxsIFBpcGVzICovCisJaWYgKElOVEVMX0dFTihk
ZXZfcHJpdikgPj0gMTIpCisJCXJldHVybiB0cnVlOworCisJLyogZ2VuMTAgYW5kIGdlbjExIGhh
dmUgRFNDLCBidXQgbm90IG9uIHBpcGUgQSwgZURQIGlzIGFsbG93ZWQgKi8KKwlpZiAoSU5URUxf
R0VOKGRldl9wcml2KSA+PSAxMCAmJgorCSAgICAodG9faW50ZWxfY3J0YyhwaXBlX2NvbmZpZy0+
dWFwaS5jcnRjKS0+cGlwZSAhPSBQSVBFX0EgfHwKKwkgICAgIHBpcGVfY29uZmlnLT5jcHVfdHJh
bnNjb2RlciA9PSBUUkFOU0NPREVSX0VEUCkpCisJCXJldHVybiB0cnVlOworCisJcmV0dXJuIGZh
bHNlOworfQorCiAjZW5kaWYgLyogIF9fSU5URUxfRElTUExBWV9UWVBFU19IX18gKi8KZGlmZiAt
LWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZHAuYyBiL2RyaXZlcnMv
Z3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZHAuYwppbmRleCA1NGZkZTRjNGM0ZGQuLmQwYjYy
NzZmNzcxMiAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9k
cC5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZHAuYwpAQCAtMTk0
OCwzMiArMTk0OCwxMyBAQCBzdGF0aWMgYm9vbCBpbnRlbF9kcF9zdXBwb3J0c19mZWMoc3RydWN0
IGludGVsX2RwICppbnRlbF9kcCwKIAkJZHJtX2RwX3Npbmtfc3VwcG9ydHNfZmVjKGludGVsX2Rw
LT5mZWNfY2FwYWJsZSk7CiB9CiAKLXN0YXRpYyBib29sIGludGVsX2RwX3NvdXJjZV9zdXBwb3J0
c19kc2Moc3RydWN0IGludGVsX2RwICppbnRlbF9kcCwKLQkJCQkJIGNvbnN0IHN0cnVjdCBpbnRl
bF9jcnRjX3N0YXRlICpwaXBlX2NvbmZpZykKLXsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAq
ZGV2X3ByaXYgPSBkcF90b19pOTE1KGludGVsX2RwKTsKLQotCWlmICghSU5URUxfSU5GTyhkZXZf
cHJpdiktPmRpc3BsYXkuaGFzX2RzYykKLQkJcmV0dXJuIGZhbHNlOwotCi0JLyogT24gVEdMLCBE
U0MgaXMgc3VwcG9ydGVkIG9uIGFsbCBQaXBlcyAqLwotCWlmIChJTlRFTF9HRU4oZGV2X3ByaXYp
ID49IDEyKQotCQlyZXR1cm4gdHJ1ZTsKLQotCWlmIChJTlRFTF9HRU4oZGV2X3ByaXYpID49IDEw
ICYmCi0JICAgIHBpcGVfY29uZmlnLT5jcHVfdHJhbnNjb2RlciAhPSBUUkFOU0NPREVSX0EpCi0J
CXJldHVybiB0cnVlOwotCi0JcmV0dXJuIGZhbHNlOwotfQotCiBzdGF0aWMgYm9vbCBpbnRlbF9k
cF9zdXBwb3J0c19kc2Moc3RydWN0IGludGVsX2RwICppbnRlbF9kcCwKIAkJCQkgIGNvbnN0IHN0
cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpwaXBlX2NvbmZpZykKIHsKIAlpZiAoIWludGVsX2RwX2lz
X2VkcChpbnRlbF9kcCkgJiYgIXBpcGVfY29uZmlnLT5mZWNfZW5hYmxlKQogCQlyZXR1cm4gZmFs
c2U7CiAKLQlyZXR1cm4gaW50ZWxfZHBfc291cmNlX3N1cHBvcnRzX2RzYyhpbnRlbF9kcCwgcGlw
ZV9jb25maWcpICYmCisJcmV0dXJuIGludGVsX2NydGNfc3VwcG9ydHNfZHNjKHBpcGVfY29uZmln
KSAmJgogCQlkcm1fZHBfc2lua19zdXBwb3J0c19kc2MoaW50ZWxfZHAtPmRzY19kcGNkKTsKIH0K
IApkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF92ZHNjLmMg
Yi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX3Zkc2MuYwppbmRleCBiMjNiYThk
MTA4ZGIuLmU0ODYwODIyMWU3MSAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlz
cGxheS9pbnRlbF92ZHNjLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRl
bF92ZHNjLmMKQEAgLTUwMSwxMSArNTAxLDEwIEBAIGludGVsX2RzY19wb3dlcl9kb21haW4oY29u
c3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUpCiAJCXJldHVybiBQT1dFUl9E
T01BSU5fVFJBTlNDT0RFUihjcHVfdHJhbnNjb2Rlcik7CiB9CiAKLXN0YXRpYyB2b2lkIGludGVs
X2RzY19wcHNfY29uZmlndXJlKHN0cnVjdCBpbnRlbF9lbmNvZGVyICplbmNvZGVyLAotCQkJCSAg
ICBjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSkKK3N0YXRpYyB2b2lk
IGludGVsX2RzY19wcHNfY29uZmlndXJlKGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpj
cnRjX3N0YXRlKQogewogCXN0cnVjdCBpbnRlbF9jcnRjICpjcnRjID0gdG9faW50ZWxfY3J0Yyhj
cnRjX3N0YXRlLT51YXBpLmNydGMpOwotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJp
diA9IHRvX2k5MTUoZW5jb2Rlci0+YmFzZS5kZXYpOworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRl
ICpkZXZfcHJpdiA9IHRvX2k5MTUoY3J0Yy0+YmFzZS5kZXYpOwogCWNvbnN0IHN0cnVjdCBkcm1f
ZHNjX2NvbmZpZyAqdmRzY19jZmcgPSAmY3J0Y19zdGF0ZS0+ZHNjLmNvbmZpZzsKIAllbnVtIHBp
cGUgcGlwZSA9IGNydGMtPnBpcGU7CiAJZW51bSB0cmFuc2NvZGVyIGNwdV90cmFuc2NvZGVyID0g
Y3J0Y19zdGF0ZS0+Y3B1X3RyYW5zY29kZXI7CkBAIC01MTUsNiArNTE0LDkgQEAgc3RhdGljIHZv
aWQgaW50ZWxfZHNjX3Bwc19jb25maWd1cmUoc3RydWN0IGludGVsX2VuY29kZXIgKmVuY29kZXIs
CiAJdTggbnVtX3Zkc2NfaW5zdGFuY2VzID0gKGNydGNfc3RhdGUtPmRzYy5kc2Nfc3BsaXQpID8g
MiA6IDE7CiAJaW50IGkgPSAwOwogCisJaWYgKGNydGNfc3RhdGUtPmJpZ2pvaW5lcikKKwkJbnVt
X3Zkc2NfaW5zdGFuY2VzICo9IDI7CisKIAkvKiBQb3B1bGF0ZSBQSUNUVVJFX1BBUkFNRVRFUl9T
RVRfMCByZWdpc3RlcnMgKi8KIAlwcHNfdmFsID0gRFNDX1ZFUl9NQUogfCB2ZHNjX2NmZy0+ZHNj
X3ZlcnNpb25fbWlub3IgPDwKIAkJRFNDX1ZFUl9NSU5fU0hJRlQgfApAQCAtOTIwLDc0ICs5MjIs
MTA0IEBAIHN0YXRpYyB2b2lkIGludGVsX2RzY19kcF9wcHNfd3JpdGUoc3RydWN0IGludGVsX2Vu
Y29kZXIgKmVuY29kZXIsCiAJCQkJCXNpemVvZihkcF9kc2NfcHBzX3NkcCkpOwogfQogCitzdGF0
aWMgaTkxNV9yZWdfdCBkc3NfY3RsMV9yZWcoY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUg
KmNydGNfc3RhdGUpCit7CisJZW51bSBwaXBlIHBpcGUgPSB0b19pbnRlbF9jcnRjKGNydGNfc3Rh
dGUtPnVhcGkuY3J0YyktPnBpcGU7CisKKwlpZiAoY3J0Y19zdGF0ZS0+Y3B1X3RyYW5zY29kZXIg
PT0gVFJBTlNDT0RFUl9FRFApCisJCXJldHVybiBEU1NfQ1RMMTsKKworCXJldHVybiBJQ0xfUElQ
RV9EU1NfQ1RMMShwaXBlKTsKK30KKworc3RhdGljIGk5MTVfcmVnX3QgZHNzX2N0bDJfcmVnKGNv
bnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlKQoreworCWVudW0gcGlwZSBw
aXBlID0gdG9faW50ZWxfY3J0YyhjcnRjX3N0YXRlLT51YXBpLmNydGMpLT5waXBlOworCisJaWYg
KGNydGNfc3RhdGUtPmNwdV90cmFuc2NvZGVyID09IFRSQU5TQ09ERVJfRURQKQorCQlyZXR1cm4g
RFNTX0NUTDI7CisKKwlyZXR1cm4gSUNMX1BJUEVfRFNTX0NUTDIocGlwZSk7Cit9CisKIHZvaWQg
aW50ZWxfZHNjX2VuYWJsZShzdHJ1Y3QgaW50ZWxfZW5jb2RlciAqZW5jb2RlciwKIAkJICAgICAg
Y29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUpCiB7CiAJc3RydWN0IGlu
dGVsX2NydGMgKmNydGMgPSB0b19pbnRlbF9jcnRjKGNydGNfc3RhdGUtPnVhcGkuY3J0Yyk7Ci0J
c3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShlbmNvZGVyLT5iYXNl
LmRldik7Ci0JZW51bSBwaXBlIHBpcGUgPSBjcnRjLT5waXBlOwotCWk5MTVfcmVnX3QgZHNzX2N0
bDFfcmVnLCBkc3NfY3RsMl9yZWc7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2
ID0gdG9faTkxNShjcnRjLT5iYXNlLmRldik7CiAJdTMyIGRzc19jdGwxX3ZhbCA9IDA7CiAJdTMy
IGRzc19jdGwyX3ZhbCA9IDA7CiAKIAlpZiAoIWNydGNfc3RhdGUtPmRzYy5jb21wcmVzc2lvbl9l
bmFibGUpCiAJCXJldHVybjsKIAotCS8qIEVuYWJsZSBQb3dlciB3ZWxscyBmb3IgVkRTQy9qb2lu
aW5nICovCi0JaW50ZWxfZGlzcGxheV9wb3dlcl9nZXQoZGV2X3ByaXYsCi0JCQkJaW50ZWxfZHNj
X3Bvd2VyX2RvbWFpbihjcnRjX3N0YXRlKSk7CisJaW50ZWxfZHNjX3Bwc19jb25maWd1cmUoY3J0
Y19zdGF0ZSk7CiAKLQlpbnRlbF9kc2NfcHBzX2NvbmZpZ3VyZShlbmNvZGVyLCBjcnRjX3N0YXRl
KTsKKwlpZiAoIWNydGNfc3RhdGUtPmJpZ2pvaW5lcl9zbGF2ZSkKKwkJaW50ZWxfZHNjX2RwX3Bw
c193cml0ZShlbmNvZGVyLCBjcnRjX3N0YXRlKTsKIAotCWludGVsX2RzY19kcF9wcHNfd3JpdGUo
ZW5jb2RlciwgY3J0Y19zdGF0ZSk7Ci0KLQlpZiAoY3J0Y19zdGF0ZS0+Y3B1X3RyYW5zY29kZXIg
PT0gVFJBTlNDT0RFUl9FRFApIHsKLQkJZHNzX2N0bDFfcmVnID0gRFNTX0NUTDE7Ci0JCWRzc19j
dGwyX3JlZyA9IERTU19DVEwyOwotCX0gZWxzZSB7Ci0JCWRzc19jdGwxX3JlZyA9IElDTF9QSVBF
X0RTU19DVEwxKHBpcGUpOwotCQlkc3NfY3RsMl9yZWcgPSBJQ0xfUElQRV9EU1NfQ1RMMihwaXBl
KTsKLQl9CiAJZHNzX2N0bDJfdmFsIHw9IExFRlRfQlJBTkNIX1ZEU0NfRU5BQkxFOwogCWlmIChj
cnRjX3N0YXRlLT5kc2MuZHNjX3NwbGl0KSB7CiAJCWRzc19jdGwyX3ZhbCB8PSBSSUdIVF9CUkFO
Q0hfVkRTQ19FTkFCTEU7CiAJCWRzc19jdGwxX3ZhbCB8PSBKT0lORVJfRU5BQkxFOwogCX0KLQlJ
OTE1X1dSSVRFKGRzc19jdGwxX3JlZywgZHNzX2N0bDFfdmFsKTsKLQlJOTE1X1dSSVRFKGRzc19j
dGwyX3JlZywgZHNzX2N0bDJfdmFsKTsKKwlpZiAoY3J0Y19zdGF0ZS0+Ymlnam9pbmVyKSB7CisJ
CWRzc19jdGwxX3ZhbCB8PSBCSUdfSk9JTkVSX0VOQUJMRTsKKwkJaWYgKCFjcnRjX3N0YXRlLT5i
aWdqb2luZXJfc2xhdmUpCisJCQlkc3NfY3RsMV92YWwgfD0gTUFTVEVSX0JJR19KT0lORVJfRU5B
QkxFOworCX0KKwlJOTE1X1dSSVRFKGRzc19jdGwxX3JlZyhjcnRjX3N0YXRlKSwgZHNzX2N0bDFf
dmFsKTsKKwlJOTE1X1dSSVRFKGRzc19jdGwyX3JlZyhjcnRjX3N0YXRlKSwgZHNzX2N0bDJfdmFs
KTsKIH0KIAogdm9pZCBpbnRlbF9kc2NfZGlzYWJsZShjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19z
dGF0ZSAqb2xkX2NydGNfc3RhdGUpCiB7CiAJc3RydWN0IGludGVsX2NydGMgKmNydGMgPSB0b19p
bnRlbF9jcnRjKG9sZF9jcnRjX3N0YXRlLT51YXBpLmNydGMpOwogCXN0cnVjdCBkcm1faTkxNV9w
cml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoY3J0Yy0+YmFzZS5kZXYpOwotCWVudW0gcGlwZSBw
aXBlID0gY3J0Yy0+cGlwZTsKLQlpOTE1X3JlZ190IGRzc19jdGwxX3JlZywgZHNzX2N0bDJfcmVn
OwotCXUzMiBkc3NfY3RsMV92YWwgPSAwLCBkc3NfY3RsMl92YWwgPSAwOwogCiAJaWYgKCFvbGRf
Y3J0Y19zdGF0ZS0+ZHNjLmNvbXByZXNzaW9uX2VuYWJsZSkKIAkJcmV0dXJuOwogCi0JaWYgKG9s
ZF9jcnRjX3N0YXRlLT5jcHVfdHJhbnNjb2RlciA9PSBUUkFOU0NPREVSX0VEUCkgewotCQlkc3Nf
Y3RsMV9yZWcgPSBEU1NfQ1RMMTsKLQkJZHNzX2N0bDJfcmVnID0gRFNTX0NUTDI7Ci0JfSBlbHNl
IHsKLQkJZHNzX2N0bDFfcmVnID0gSUNMX1BJUEVfRFNTX0NUTDEocGlwZSk7Ci0JCWRzc19jdGwy
X3JlZyA9IElDTF9QSVBFX0RTU19DVEwyKHBpcGUpOworCUk5MTVfV1JJVEUoZHNzX2N0bDFfcmVn
KG9sZF9jcnRjX3N0YXRlKSwgMCk7CisJSTkxNV9XUklURShkc3NfY3RsMl9yZWcob2xkX2NydGNf
c3RhdGUpLCAwKTsKK30KKwordm9pZCBpbnRlbF9kc2NfZ2V0X2NvbmZpZyhzdHJ1Y3QgaW50ZWxf
Y3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSkKK3sKKwlzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YyA9IHRv
X2ludGVsX2NydGMoY3J0Y19zdGF0ZS0+dWFwaS5jcnRjKTsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJp
dmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGNydGMtPmJhc2UuZGV2KTsKKwl1MzIgZHNzX2N0bDFf
dmFsLCBkc3NfY3RsMl92YWw7CisJaW50ZWxfd2FrZXJlZl90IHdha2VyZWY7CisKKwlpZiAoIWlu
dGVsX2NydGNfc3VwcG9ydHNfZHNjKGNydGNfc3RhdGUpKQorCQlyZXR1cm47CisKKwl3YWtlcmVm
ID0gaW50ZWxfZGlzcGxheV9wb3dlcl9nZXRfaWZfZW5hYmxlZChkZXZfcHJpdiwgaW50ZWxfZHNj
X3Bvd2VyX2RvbWFpbihjcnRjX3N0YXRlKSk7CisJaWYgKCF3YWtlcmVmKQorCQlyZXR1cm47CisK
Kwlkc3NfY3RsMV92YWwgPSBJOTE1X1JFQUQoZHNzX2N0bDFfcmVnKGNydGNfc3RhdGUpKTsKKwlk
c3NfY3RsMl92YWwgPSBJOTE1X1JFQUQoZHNzX2N0bDJfcmVnKGNydGNfc3RhdGUpKTsKKwlpZiAo
ZHNzX2N0bDJfdmFsICYgTEVGVF9CUkFOQ0hfVkRTQ19FTkFCTEUpCisJCWNydGNfc3RhdGUtPmRz
Yy5jb21wcmVzc2lvbl9lbmFibGUgPSB0cnVlOworCisJaWYgKChkc3NfY3RsMV92YWwgJiBKT0lO
RVJfRU5BQkxFKSAmJiAoZHNzX2N0bDJfdmFsICYgUklHSFRfQlJBTkNIX1ZEU0NfRU5BQkxFKSkK
KwkJY3J0Y19zdGF0ZS0+ZHNjLmRzY19zcGxpdCA9IHRydWU7CisKKwlpZiAoZHNzX2N0bDFfdmFs
ICYgQklHX0pPSU5FUl9FTkFCTEUpIHsKKwkJY3J0Y19zdGF0ZS0+Ymlnam9pbmVyID0gdHJ1ZTsK
KworCQlpZiAoIShkc3NfY3RsMV92YWwgJiBNQVNURVJfQklHX0pPSU5FUl9FTkFCTEUpKSB7CisJ
CQljcnRjX3N0YXRlLT5iaWdqb2luZXJfc2xhdmUgPSB0cnVlOworCQkJaWYgKCFXQVJOX09OKGNy
dGMtPnBpcGUgPT0gUElQRV9BKSkKKwkJCQljcnRjX3N0YXRlLT5iaWdqb2luZXJfbGlua2VkX2Ny
dGMgPQorCQkJCQlpbnRlbF9nZXRfY3J0Y19mb3JfcGlwZShkZXZfcHJpdiwgY3J0Yy0+cGlwZSAt
IDEpOworCQl9IGVsc2UgeworCQkJaWYgKCFXQVJOX09OKElOVEVMX05VTV9QSVBFUyhkZXZfcHJp
dikgPT0gY3J0Yy0+cGlwZSArIDEpKQorCQkJCWNydGNfc3RhdGUtPmJpZ2pvaW5lcl9saW5rZWRf
Y3J0YyA9CisJCQkJCWludGVsX2dldF9jcnRjX2Zvcl9waXBlKGRldl9wcml2LCBjcnRjLT5waXBl
ICsgMSk7CisJCX0KIAl9Ci0JZHNzX2N0bDFfdmFsID0gSTkxNV9SRUFEKGRzc19jdGwxX3JlZyk7
Ci0JaWYgKGRzc19jdGwxX3ZhbCAmIEpPSU5FUl9FTkFCTEUpCi0JCWRzc19jdGwxX3ZhbCAmPSB+
Sk9JTkVSX0VOQUJMRTsKLQlJOTE1X1dSSVRFKGRzc19jdGwxX3JlZywgZHNzX2N0bDFfdmFsKTsK
LQotCWRzc19jdGwyX3ZhbCA9IEk5MTVfUkVBRChkc3NfY3RsMl9yZWcpOwotCWlmIChkc3NfY3Rs
Ml92YWwgJiBMRUZUX0JSQU5DSF9WRFNDX0VOQUJMRSB8fAotCSAgICBkc3NfY3RsMl92YWwgJiBS
SUdIVF9CUkFOQ0hfVkRTQ19FTkFCTEUpCi0JCWRzc19jdGwyX3ZhbCAmPSB+KExFRlRfQlJBTkNI
X1ZEU0NfRU5BQkxFIHwKLQkJCQkgIFJJR0hUX0JSQU5DSF9WRFNDX0VOQUJMRSk7Ci0JSTkxNV9X
UklURShkc3NfY3RsMl9yZWcsIGRzc19jdGwyX3ZhbCk7Ci0KLQkvKiBEaXNhYmxlIFBvd2VyIHdl
bGxzIGZvciBWRFNDL2pvaW5pbmcgKi8KLQlpbnRlbF9kaXNwbGF5X3Bvd2VyX3B1dF91bmNoZWNr
ZWQoZGV2X3ByaXYsCi0JCQkJCSAgaW50ZWxfZHNjX3Bvd2VyX2RvbWFpbihvbGRfY3J0Y19zdGF0
ZSkpOworCisJaW50ZWxfZGlzcGxheV9wb3dlcl9wdXQoZGV2X3ByaXYsIGludGVsX2RzY19wb3dl
cl9kb21haW4oY3J0Y19zdGF0ZSksIHdha2VyZWYpOwogfQpkaWZmIC0tZ2l0IGEvZHJpdmVycy9n
cHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF92ZHNjLmggYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9k
aXNwbGF5L2ludGVsX3Zkc2MuaAppbmRleCA0ZWQyMjU2NzUwYzMuLjc5ZDk2NWZlZGYwYiAxMDA2
NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF92ZHNjLmgKKysrIGIv
ZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF92ZHNjLmgKQEAgLTE0LDYgKzE0LDgg
QEAgdm9pZCBpbnRlbF9kc2NfZW5hYmxlKHN0cnVjdCBpbnRlbF9lbmNvZGVyICplbmNvZGVyLAog
dm9pZCBpbnRlbF9kc2NfZGlzYWJsZShjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0
Y19zdGF0ZSk7CiBpbnQgaW50ZWxfZHNjX2NvbXB1dGVfcGFyYW1zKHN0cnVjdCBpbnRlbF9lbmNv
ZGVyICplbmNvZGVyLAogCQkJICAgICBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqcGlwZV9jb25m
aWcpOwordm9pZCBpbnRlbF9kc2NfZ2V0X2NvbmZpZyhzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAq
Y3J0Y19zdGF0ZSk7CisKIGVudW0gaW50ZWxfZGlzcGxheV9wb3dlcl9kb21haW4KIGludGVsX2Rz
Y19wb3dlcl9kb21haW4oY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUp
OwogCi0tIAoyLjI0LjAKCl9fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fCkludGVsLWdmeCBtYWlsaW5nIGxpc3QKSW50ZWwtZ2Z4QGxpc3RzLmZyZWVkZXNrdG9w
Lm9yZwpodHRwczovL2xpc3RzLmZyZWVkZXNrdG9wLm9yZy9tYWlsbWFuL2xpc3RpbmZvL2ludGVs
LWdmeA==

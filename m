Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id AF5B6D088C
	for <lists+intel-gfx@lfdr.de>; Wed,  9 Oct 2019 09:41:44 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id EB21489B49;
	Wed,  9 Oct 2019 07:41:42 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from mga02.intel.com (mga02.intel.com [134.134.136.20])
 by gabe.freedesktop.org (Postfix) with ESMTPS id C837F89B49
 for <intel-gfx@lists.freedesktop.org>; Wed,  9 Oct 2019 07:41:40 +0000 (UTC)
X-Amp-Result: SKIPPED(no attachment in message)
X-Amp-File-Uploaded: False
Received: from fmsmga003.fm.intel.com ([10.253.24.29])
 by orsmga101.jf.intel.com with ESMTP/TLS/DHE-RSA-AES256-GCM-SHA384;
 09 Oct 2019 00:41:39 -0700
X-ExtLoop1: 1
X-IronPort-AV: E=Sophos;i="5.67,273,1566889200"; d="scan'208";a="200057860"
Received: from slisovsk-lenovo-ideapad-720s-13ikb.fi.intel.com ([10.237.72.89])
 by FMSMGA003.fm.intel.com with ESMTP; 09 Oct 2019 00:41:36 -0700
From: Stanislav Lisovskiy <stanislav.lisovskiy@intel.com>
To: intel-gfx@lists.freedesktop.org
Date: Wed,  9 Oct 2019 10:39:08 +0300
Message-Id: <20191009073908.22128-1-stanislav.lisovskiy@intel.com>
X-Mailer: git-send-email 2.17.1
Subject: [Intel-gfx] [PATCH v2] drm/i915: Enable second dbuf slice for ICL
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Cc: martin.peres@intel.com
MIME-Version: 1.0
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

QWxzbyBpbXBsZW1lbnRlZCBhbGdvcml0aG0gZm9yIGNob29zaW5nIERCdWYgc2xpY2UgY29uZmln
dXJhdGlvbgpiYXNlZCBvbiBhY3RpdmUgcGlwZXMsIHBpcGUgcmF0aW8gYXMgc3RhdGVkIGluIEJT
cGVjIDEyNzE2LgoKTm93IHBpcGUgYWxsb2NhdGlvbiBzdGlsbCBzdGF5cyBwcm9wb3J0aW9uYWwg
dG8gcGlwZSB3aWR0aCBhcyBiZWZvcmUsCmhvd2V2ZXIgd2l0aGluIGFsbG93ZWQgREJ1ZiBzbGlj
ZSBmb3IgdGhpcyBwYXJ0aWN1bGFyIGNvbmZpZ3VyYXRpb24uCgp2MjogUmVtb3ZlIHVubmVlZGVk
IGNoZWNrIGZyb20gY29tbWl0IGFzIGRkYiBlbmFibGVkIHNsaWNlcyBtaWdodAogICAgbm93IGRp
ZmZlciBmcm9tIGh3IHN0YXRlLgoKU2lnbmVkLW9mZi1ieTogU3RhbmlzbGF2IExpc292c2tpeSA8
c3RhbmlzbGF2Lmxpc292c2tpeUBpbnRlbC5jb20+Ci0tLQogZHJpdmVycy9ncHUvZHJtL2k5MTUv
ZGlzcGxheS9pbnRlbF9kaXNwbGF5LmMgfCAgIDYgLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50
ZWxfcG0uYyAgICAgICAgICAgICAgfCAyMDggKysrKysrKysrKysrKysrKysrLQogMiBmaWxlcyBj
aGFuZ2VkLCAyMDIgaW5zZXJ0aW9ucygrKSwgMTIgZGVsZXRpb25zKC0pCgpkaWZmIC0tZ2l0IGEv
ZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kaXNwbGF5LmMgYi9kcml2ZXJzL2dw
dS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2Rpc3BsYXkuYwppbmRleCAxYTUzM2NjZGI1NGYuLjQ2
ODM3MzFhYzFjYSAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRl
bF9kaXNwbGF5LmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kaXNw
bGF5LmMKQEAgLTEyOTg5LDEyICsxMjk4OSw2IEBAIHN0YXRpYyB2b2lkIHZlcmlmeV93bV9zdGF0
ZShzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YywKIAlza2xfZGRiX2dldF9od19zdGF0ZShkZXZfcHJp
diwgJmh3LT5kZGIpOwogCXN3X2RkYiA9ICZkZXZfcHJpdi0+d20uc2tsX2h3LmRkYjsKIAotCWlm
IChJTlRFTF9HRU4oZGV2X3ByaXYpID49IDExICYmCi0JICAgIGh3LT5kZGIuZW5hYmxlZF9zbGlj
ZXMgIT0gc3dfZGRiLT5lbmFibGVkX3NsaWNlcykKLQkJRFJNX0VSUk9SKCJtaXNtYXRjaCBpbiBE
QlVGIFNsaWNlcyAoZXhwZWN0ZWQgJXUsIGdvdCAldSlcbiIsCi0JCQkgIHN3X2RkYi0+ZW5hYmxl
ZF9zbGljZXMsCi0JCQkgIGh3LT5kZGIuZW5hYmxlZF9zbGljZXMpOwotCiAJLyogcGxhbmVzICov
CiAJZm9yX2VhY2hfdW5pdmVyc2FsX3BsYW5lKGRldl9wcml2LCBwaXBlLCBwbGFuZSkgewogCQlz
dHJ1Y3Qgc2tsX3BsYW5lX3dtICpod19wbGFuZV93bSwgKnN3X3BsYW5lX3dtOwpkaWZmIC0tZ2l0
IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50ZWxfcG0uYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1
L2ludGVsX3BtLmMKaW5kZXggYmZjZjAzYWI1MjQ1Li4wZmJlZWE2MTI5OWYgMTAwNjQ0Ci0tLSBh
L2RyaXZlcnMvZ3B1L2RybS9pOTE1L2ludGVsX3BtLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5
MTUvaW50ZWxfcG0uYwpAQCAtMzYxNiw3ICszNjE2LDcgQEAgc3RhdGljIHU4IGludGVsX2VuYWJs
ZWRfZGJ1Zl9zbGljZXNfbnVtKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikKIAkg
KiBvbmx5IHRoYXQgMSBzbGljZSBlbmFibGVkIHVudGlsIHdlIGhhdmUgYSBwcm9wZXIgd2F5IGZv
ciBvbi1kZW1hbmQKIAkgKiB0b2dnbGluZyBvZiB0aGUgc2Vjb25kIHNsaWNlLgogCSAqLwotCWlm
ICgwICYmIEk5MTVfUkVBRChEQlVGX0NUTF9TMikgJiBEQlVGX1BPV0VSX1NUQVRFKQorCWlmIChJ
OTE1X1JFQUQoREJVRl9DVExfUzIpICYgREJVRl9QT1dFUl9TVEFURSkKIAkJZW5hYmxlZF9zbGlj
ZXMrKzsKIAogCXJldHVybiBlbmFibGVkX3NsaWNlczsKQEAgLTM4MjEsNyArMzgyMSw3IEBAIHN0
YXRpYyB1MTYgaW50ZWxfZ2V0X2RkYl9zaXplKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZf
cHJpdiwKIAkgKiAtIHBsYW5lIHN0cmFkZGxpbmcgYm90aCBzbGljZXMgaXMgaWxsZWdhbCBpbiBt
dWx0aS1waXBlIHNjZW5hcmlvcwogCSAqIC0gc2hvdWxkIHZhbGlkYXRlIHdlIHN0YXkgd2l0aGlu
IHRoZSBodyBiYW5kd2lkdGggbGltaXRzCiAJICovCi0JaWYgKDAgJiYgKG51bV9hY3RpdmUgPiAx
IHx8IHRvdGFsX2RhdGFfYncgPj0gR0JwcygxMikpKSB7CisJaWYgKChudW1fYWN0aXZlID4gMSB8
fCB0b3RhbF9kYXRhX2J3ID49IEdCcHMoMTIpKSkgewogCQlkZGItPmVuYWJsZWRfc2xpY2VzID0g
MjsKIAl9IGVsc2UgewogCQlkZGItPmVuYWJsZWRfc2xpY2VzID0gMTsKQEAgLTM4MzEsNiArMzgz
MSwzNSBAQCBzdGF0aWMgdTE2IGludGVsX2dldF9kZGJfc2l6ZShzdHJ1Y3QgZHJtX2k5MTVfcHJp
dmF0ZSAqZGV2X3ByaXYsCiAJcmV0dXJuIGRkYl9zaXplOwogfQogCisvKgorICogQ2FsY3VsYXRl
IGluaXRpYWwgREJ1ZiBzbGljZSBvZmZzZXQsIGJhc2VkIG9uIHNsaWNlIHNpemUKKyAqIGFuZCBt
YXNrKGkuZSBpZiBzbGljZSBzaXplIGlzIDEwMjQgYW5kIHNlY29uZCBzbGljZSBpcyBlbmFibGVk
CisgKiBvZmZzZXQgd291bGQgYmUgMTAyNCkKKyAqLworc3RhdGljIHUzMiBza2xfZ2V0X2ZpcnN0
X2RidWZfc2xpY2Vfb2Zmc2V0KHUzMiBkYnVmX3NsaWNlX21hc2ssCisJCQkJCSAgIHUzMiBzbGlj
ZV9zaXplLCB1MzIgZGRiX3NpemUpCit7CisJdTMyIG9mZnNldCA9IDA7CisKKwlpZiAoIWRidWZf
c2xpY2VfbWFzaykKKwkJcmV0dXJuIDA7CisKKwl3aGlsZSAoIShkYnVmX3NsaWNlX21hc2sgJiAx
KSkgeworCQlkYnVmX3NsaWNlX21hc2sgPj49IDE7CisJCW9mZnNldCArPSBzbGljZV9zaXplOwor
CQlpZiAob2Zmc2V0ID49IGRkYl9zaXplKQorCQkJYnJlYWs7CisJfQorCXJldHVybiBvZmZzZXQ7
Cit9CisKK3N0YXRpYyB1MzIgaTkxNV9nZXRfYWxsb3dlZF9kYnVmX21hc2soc3RydWN0IGRybV9p
OTE1X3ByaXZhdGUgKmRldl9wcml2LAorCQkJCSAgICAgIGludCBwaXBlLCB1MzIgYWN0aXZlX3Bp
cGVzLAorCQkJCSAgICAgIHVpbnRfZml4ZWRfMTZfMTZfdCBwaXBlX3JhdGlvKTsKKworc3RhdGlj
IHVpbnRfZml4ZWRfMTZfMTZfdAorc2tsX2dldF9waXBlX3JhdGlvKGNvbnN0IHN0cnVjdCBpbnRl
bF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlKTsKKwogc3RhdGljIHZvaWQKIHNrbF9kZGJfZ2V0X3Bp
cGVfYWxsb2NhdGlvbl9saW1pdHMoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAog
CQkJCSAgIGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlLApAQCAtMzg0
Niw3ICszODc1LDEzIEBAIHNrbF9kZGJfZ2V0X3BpcGVfYWxsb2NhdGlvbl9saW1pdHMoc3RydWN0
IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAogCXUzMiBwaXBlX3dpZHRoID0gMCwgdG90YWxf
d2lkdGggPSAwLCB3aWR0aF9iZWZvcmVfcGlwZSA9IDA7CiAJZW51bSBwaXBlIGZvcl9waXBlID0g
dG9faW50ZWxfY3J0Yyhmb3JfY3J0YyktPnBpcGU7CiAJdTE2IGRkYl9zaXplOworCXUxNiBkZGJf
cmFuZ2Vfc2l6ZTsKIAl1MzIgaTsKKwl1MzIgZGJ1Zl9zbGljZV9tYXNrOworCXUzMiBhY3RpdmVf
cGlwZXM7CisJdTMyIG9mZnNldDsKKwl1MzIgc2xpY2Vfc2l6ZTsKKwl1aW50X2ZpeGVkXzE2XzE2
X3QgcGlwZV9yYXRpbzsKIAogCWlmIChXQVJOX09OKCFzdGF0ZSkgfHwgIWNydGNfc3RhdGUtPmJh
c2UuYWN0aXZlKSB7CiAJCWFsbG9jLT5zdGFydCA9IDA7CkBAIC0zODU1LDE0ICszODkwLDIzIEBA
IHNrbF9kZGJfZ2V0X3BpcGVfYWxsb2NhdGlvbl9saW1pdHMoc3RydWN0IGRybV9pOTE1X3ByaXZh
dGUgKmRldl9wcml2LAogCQlyZXR1cm47CiAJfQogCi0JaWYgKGludGVsX3N0YXRlLT5hY3RpdmVf
cGlwZV9jaGFuZ2VzKQorCWlmIChpbnRlbF9zdGF0ZS0+YWN0aXZlX3BpcGVfY2hhbmdlcykgewog
CQkqbnVtX2FjdGl2ZSA9IGh3ZWlnaHQ4KGludGVsX3N0YXRlLT5hY3RpdmVfcGlwZXMpOwotCWVs
c2UKKwkJYWN0aXZlX3BpcGVzID0gaW50ZWxfc3RhdGUtPmFjdGl2ZV9waXBlczsKKwl9IGVsc2Ug
ewogCQkqbnVtX2FjdGl2ZSA9IGh3ZWlnaHQ4KGRldl9wcml2LT5hY3RpdmVfcGlwZXMpOworCQlh
Y3RpdmVfcGlwZXMgPSBkZXZfcHJpdi0+YWN0aXZlX3BpcGVzOworCX0KIAogCWRkYl9zaXplID0g
aW50ZWxfZ2V0X2RkYl9zaXplKGRldl9wcml2LCBjcnRjX3N0YXRlLCB0b3RhbF9kYXRhX3JhdGUs
CiAJCQkJICAgICAgKm51bV9hY3RpdmUsIGRkYik7CiAKKwlEUk1fREVCVUdfS01TKCJHb3QgdG90
YWwgZGRiIHNpemUgJWRcbiIsIGRkYl9zaXplKTsKKworCXNsaWNlX3NpemUgPSBkZGJfc2l6ZSAv
IGRkYi0+ZW5hYmxlZF9zbGljZXM7CisKKwlEUk1fREVCVUdfS01TKCJHb3QgREJ1ZiBzbGljZSBz
aXplICVkXG4iLCBzbGljZV9zaXplKTsKKwogCS8qCiAJICogSWYgdGhlIHN0YXRlIGRvZXNuJ3Qg
Y2hhbmdlIHRoZSBhY3RpdmUgQ1JUQydzIG9yIHRoZXJlIGlzIG5vCiAJICogbW9kZXNldCByZXF1
ZXN0LCB0aGVuIHRoZXJlJ3Mgbm8gbmVlZCB0byByZWNhbGN1bGF0ZTsKQEAgLTM4ODAsNiArMzky
NCwzOSBAQCBza2xfZGRiX2dldF9waXBlX2FsbG9jYXRpb25fbGltaXRzKHN0cnVjdCBkcm1faTkx
NV9wcml2YXRlICpkZXZfcHJpdiwKIAkJcmV0dXJuOwogCX0KIAorCS8qCisJICogQ2FsY3VsYXRl
IHBpcGUgcmF0aW8gYXMgc3RhdGVkIGluIEJTcGVjIDI4NjkyCisJICovCisJcGlwZV9yYXRpbyA9
IHNrbF9nZXRfcGlwZV9yYXRpbyhjcnRjX3N0YXRlKTsKKworCS8qCisJICogR2V0IGFsbG93ZWQg
REJ1ZiBzbGljZXMgZm9yIGNvcnJlc3BvbmRlbnQgcGlwZSBhbmQgcGxhdGZvcm0uCisJICovCisJ
ZGJ1Zl9zbGljZV9tYXNrID0gaTkxNV9nZXRfYWxsb3dlZF9kYnVmX21hc2soZGV2X3ByaXYsIGZv
cl9waXBlLAorCQkJCQkJICAgICBhY3RpdmVfcGlwZXMsIHBpcGVfcmF0aW8pOworCisJRFJNX0RF
QlVHX0tNUygiREJ1ZiBzbGljZSBtYXNrICV4IHBpcGUgJWQgYWN0aXZlIHBpcGVzICV4XG4iLAor
CQkgICAgICBkYnVmX3NsaWNlX21hc2ssCisJCSAgICAgIGZvcl9waXBlLCBhY3RpdmVfcGlwZXMp
OworCisJLyoKKwkgKiBGaWd1cmUgb3V0IGF0IHdoaWNoIERCdWYgc2xpY2Ugd2Ugc3RhcnQsIGku
ZSBpZiB3ZSBzdGFydCBhdCBEYnVmIFMyCisJICogYW5kIHNsaWNlIHNpemUgaXMgMTAyNCwgdGhl
IG9mZnNldCB3b3VsZCBiZSAxMDI0CisJICovCisJb2Zmc2V0ID0gc2tsX2dldF9maXJzdF9kYnVm
X3NsaWNlX29mZnNldChkYnVmX3NsaWNlX21hc2ssCisJCQkJCQkgc2xpY2Vfc2l6ZSwgZGRiX3Np
emUpOworCisJLyoKKwkgKiBGaWd1cmUgb3V0IHRvdGFsIHNpemUgb2YgYWxsb3dlZCBEQnVmIHNs
aWNlcywgd2hpY2ggaXMgYmFzaWNhbGx5CisJICogYSBudW1iZXIgb2YgYWxsb3dlZCBzbGljZXMg
Zm9yIHRoYXQgcGlwZSBtdWx0aXBsaWVkIGJ5IHNsaWNlIHNpemUuCisJICogV2UgbWlnaHQgc3Rp
bGwgaGF2ZSBzb21lIGRidWYgc2xpY2VzIGRpc2FibGVkIGluIGNhc2UgaWYgdGhvc2UKKwkgKiBh
cmUgbm90IG5lZWRlZCBiYXNlZCBvbiBiYW5kd2lkdGggcmVxdWlyZW1lbnRzIGFuZCBudW1fYWN0
aXZlIHBpcGVzLAorCSAqIHNvIHN0aWNrIHRvIHJlYWwgZGRiIHNpemUgaWYgaXQgaGFwcGVucyB0
byBiZSBsZXNzLiBJbnNpZGUgb2YgdGhpcworCSAqIHJhbmdlIGRkYiBlbnRyaWVzIGFyZSBzdGls
bCBhbGxvY2F0ZWQgaW4gcHJvcG9ydGlvbiB0byBkaXNwbGF5IHdpZHRoLgorCSAqLworCWRkYl9y
YW5nZV9zaXplID0gbWluKGh3ZWlnaHQ4KGRidWZfc2xpY2VfbWFzaykgKiBzbGljZV9zaXplLAor
CQkJICAgICAodW5zaWduZWQgaW50KWRkYl9zaXplKTsKKwogCS8qCiAJICogV2F0ZXJtYXJrL2Rk
YiByZXF1aXJlbWVudCBoaWdobHkgZGVwZW5kcyB1cG9uIHdpZHRoIG9mIHRoZQogCSAqIGZyYW1l
YnVmZmVyLCBTbyBpbnN0ZWFkIG9mIGFsbG9jYXRpbmcgRERCIGVxdWFsbHkgYW1vbmcgcGlwZXMK
QEAgLTM4OTAsMTAgKzM5NjcsMjMgQEAgc2tsX2RkYl9nZXRfcGlwZV9hbGxvY2F0aW9uX2xpbWl0
cyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCiAJCQkmY3J0Y19zdGF0ZS0+YmFz
ZS5hZGp1c3RlZF9tb2RlOwogCQllbnVtIHBpcGUgcGlwZSA9IGNydGMtPnBpcGU7CiAJCWludCBo
ZGlzcGxheSwgdmRpc3BsYXk7CisJCXVpbnRfZml4ZWRfMTZfMTZfdCByYXRpbyA9IHNrbF9nZXRf
cGlwZV9yYXRpbyhjcnRjX3N0YXRlKTsKKwkJdTMyIHBpcGVfZGJ1Zl9zbGljZV9tYXNrID0gaTkx
NV9nZXRfYWxsb3dlZF9kYnVmX21hc2soZGV2X3ByaXYsCisJCQkJCQkJCSAgICAgIHBpcGUsCisJ
CQkJCQkJCSAgICAgIGFjdGl2ZV9waXBlcywKKwkJCQkJCQkJICAgICAgcmF0aW8pOwogCiAJCWlm
ICghY3J0Y19zdGF0ZS0+YmFzZS5lbmFibGUpCiAJCQljb250aW51ZTsKIAorCQkvKgorCQkgKiBB
Y2NvcmRpbmcgdG8gQlNwZWMgcGlwZSBjYW4gc2hhcmUgb25lIGRidWYgc2xpY2Ugd2l0aCBhbm90
aGVyIHBpcGVzIG9yIHBpcGUgY2FuIHVzZQorCQkgKiBtdWx0aXBsZSBkYnVmcywgaW4gYm90aCBj
YXNlcyB3ZSBhY2NvdW50IGZvciBvdGhlciBwaXBlcyBvbmx5IGlmIHRoZXkgaGF2ZQorCQkgKiBl
eGFjdGx5IHNhbWUgbWFzay4KKwkJICovCisJCWlmIChkYnVmX3NsaWNlX21hc2sgIT0gcGlwZV9k
YnVmX3NsaWNlX21hc2spCisJCQljb250aW51ZTsKKwogCQlkcm1fbW9kZV9nZXRfaHZfdGltaW5n
KGFkanVzdGVkX21vZGUsICZoZGlzcGxheSwgJnZkaXNwbGF5KTsKIAkJdG90YWxfd2lkdGggKz0g
aGRpc3BsYXk7CiAKQEAgLTM5MDMsOCArMzk5MywxMSBAQCBza2xfZGRiX2dldF9waXBlX2FsbG9j
YXRpb25fbGltaXRzKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKIAkJCXBpcGVf
d2lkdGggPSBoZGlzcGxheTsKIAl9CiAKLQlhbGxvYy0+c3RhcnQgPSBkZGJfc2l6ZSAqIHdpZHRo
X2JlZm9yZV9waXBlIC8gdG90YWxfd2lkdGg7Ci0JYWxsb2MtPmVuZCA9IGRkYl9zaXplICogKHdp
ZHRoX2JlZm9yZV9waXBlICsgcGlwZV93aWR0aCkgLyB0b3RhbF93aWR0aDsKKwlhbGxvYy0+c3Rh
cnQgPSBvZmZzZXQgKyBkZGJfcmFuZ2Vfc2l6ZSAqIHdpZHRoX2JlZm9yZV9waXBlIC8gdG90YWxf
d2lkdGg7CisJYWxsb2MtPmVuZCA9IG9mZnNldCArIGRkYl9yYW5nZV9zaXplICogKHdpZHRoX2Jl
Zm9yZV9waXBlICsgcGlwZV93aWR0aCkgLyB0b3RhbF93aWR0aDsKKworCURSTV9ERUJVR19LTVMo
IlBpcGUgJWQgZGRiICVkLSVkXG4iLCBmb3JfcGlwZSwKKwkJICAgICAgYWxsb2MtPnN0YXJ0LCBh
bGxvYy0+ZW5kKTsKIH0KIAogc3RhdGljIGludCBza2xfY29tcHV0ZV93bV9wYXJhbXMoY29uc3Qg
c3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUsCkBAIC00MjU1LDYgKzQzNDgsMTA5
IEBAIHNrbF9nZXRfdG90YWxfcmVsYXRpdmVfZGF0YV9yYXRlKHN0cnVjdCBpbnRlbF9jcnRjX3N0
YXRlICpjcnRjX3N0YXRlLAogCXJldHVybiB0b3RhbF9kYXRhX3JhdGU7CiB9CiAKK3VpbnRfZml4
ZWRfMTZfMTZfdAorc2tsX2dldF9waXBlX3JhdGlvKGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0
YXRlICpjcnRjX3N0YXRlKQoreworCXN0cnVjdCBkcm1fcGxhbmUgKnBsYW5lOworCWNvbnN0IHN0
cnVjdCBkcm1fcGxhbmVfc3RhdGUgKmRybV9wbGFuZV9zdGF0ZTsKKwl1aW50X2ZpeGVkXzE2XzE2
X3QgcGlwZV9kb3duc2NhbGU7CisJdWludF9maXhlZF8xNl8xNl90IG1heF9kb3duc2NhbGUgPSB1
MzJfdG9fZml4ZWQxNigxKTsKKworCWlmICghY3J0Y19zdGF0ZS0+YmFzZS5lbmFibGUpCisJCXJl
dHVybiBtYXhfZG93bnNjYWxlOworCisJZHJtX2F0b21pY19jcnRjX3N0YXRlX2Zvcl9lYWNoX3Bs
YW5lX3N0YXRlKHBsYW5lLCBkcm1fcGxhbmVfc3RhdGUsICZjcnRjX3N0YXRlLT5iYXNlKSB7CisJ
CXVpbnRfZml4ZWRfMTZfMTZfdCBwbGFuZV9kb3duc2NhbGU7CisJCWNvbnN0IHN0cnVjdCBpbnRl
bF9wbGFuZV9zdGF0ZSAqcGxhbmVfc3RhdGUgPQorCQkJdG9faW50ZWxfcGxhbmVfc3RhdGUoZHJt
X3BsYW5lX3N0YXRlKTsKKworCQlpZiAoIWludGVsX3dtX3BsYW5lX3Zpc2libGUoY3J0Y19zdGF0
ZSwgcGxhbmVfc3RhdGUpKQorCQkJY29udGludWU7CisKKwkJcGxhbmVfZG93bnNjYWxlID0gc2ts
X3BsYW5lX2Rvd25zY2FsZV9hbW91bnQoY3J0Y19zdGF0ZSwgcGxhbmVfc3RhdGUpOworCisJCW1h
eF9kb3duc2NhbGUgPSBtYXhfZml4ZWQxNihwbGFuZV9kb3duc2NhbGUsIG1heF9kb3duc2NhbGUp
OworCX0KKworCXBpcGVfZG93bnNjYWxlID0gc2tsX3BpcGVfZG93bnNjYWxlX2Ftb3VudChjcnRj
X3N0YXRlKTsKKworCXBpcGVfZG93bnNjYWxlID0gbXVsX2ZpeGVkMTYocGlwZV9kb3duc2NhbGUs
IG1heF9kb3duc2NhbGUpOworCisJcmV0dXJuIHBpcGVfZG93bnNjYWxlOworfQorCisjZGVmaW5l
IERCVUZfUzFfQklUIDEKKyNkZWZpbmUgREJVRl9TMl9CSVQgMgorCitzdHJ1Y3QgZGJ1Zl9zbGlj
ZV9jb25mX2VudHJ5IHsKKwl1MzIgZGJ1Zl9tYXNrW0k5MTVfTUFYX1BJUEVTXTsKKwl1MzIgYWN0
aXZlX3BpcGVzOworfTsKKworCisvKgorICogVGFibGUgdGFrZW4gZnJvbSBCc3BlYyAxMjcxNgor
ICogUGlwZXMgZG8gaGF2ZSBzb21lIHByZWZlcnJlZCBEQnVmIHNsaWNlIGFmZmluaXR5LAorICog
cGx1cyB0aGVyZSBhcmUgc29tZSBoYXJkY29kZWQgcmVxdWlyZW1lbnRzIG9uIGhvdworICogdGhv
c2Ugc2hvdWxkIGJlIGRpc3RyaWJ1dGVkIGZvciBtdWx0aXBpcGUgc2NlbmFyaW9zLgorICogRm9y
IG1vcmUgREJ1ZiBzbGljZXMgYWxnb3JpdGhtIGNhbiBnZXQgZXZlbiBtb3JlIG1lc3N5CisgKiBh
bmQgbGVzcyByZWFkYWJsZSwgc28gZGVjaWRlZCB0byB1c2UgYSB0YWJsZSBhbG1vc3QKKyAqIGFz
IGlzIGZyb20gQlNwZWMgaXRzZWxmIC0gdGhhdCB3YXkgaXQgaXMgYXQgbGVhc3QgZWFzaWVyCisg
KiB0byBjb21wYXJlLCBjaGFuZ2UgYW5kIGNoZWNrLgorICovCitzdHJ1Y3QgZGJ1Zl9zbGljZV9j
b25mX2VudHJ5IGljbF9hbGxvd2VkX2RidWZzW10gPSB7Cit7IHsgMCwgMCwgMCwgMCB9LCAwIH0s
Cit7IHsgREJVRl9TMV9CSVQgfCBEQlVGX1MyX0JJVCwgMCwgMCwgMCB9LCBCSVQoUElQRV9BKSB9
LAoreyB7IERCVUZfUzFfQklULCAwLCAwLCAwIH0sIEJJVChQSVBFX0EpIH0sCit7IHsgMCwgREJV
Rl9TMV9CSVQgfCBEQlVGX1MyX0JJVCwgMCwgMCB9LCBCSVQoUElQRV9CKSB9LAoreyB7IDAsIERC
VUZfUzFfQklULCAwLCAwIH0sIEJJVChQSVBFX0IpIH0sCit7IHsgMCwgMCwgREJVRl9TMV9CSVQg
fCBEQlVGX1MyX0JJVCB9LCBCSVQoUElQRV9DKSB9LAoreyB7IDAsIDAsIERCVUZfUzJfQklULCAw
IH0sIEJJVChQSVBFX0MpIH0sCit7IHsgREJVRl9TMV9CSVQsIERCVUZfUzJfQklULCAwLCAwIH0s
IEJJVChQSVBFX0EpIHwgQklUKFBJUEVfQikgfSwKK3sgeyBEQlVGX1MxX0JJVCwgMCwgREJVRl9T
Ml9CSVQsIDAgfSwgQklUKFBJUEVfQSkgfCBCSVQoUElQRV9DKSB9LAoreyB7IDAsIERCVUZfUzFf
QklULCBEQlVGX1MyX0JJVCwgMCB9LCBCSVQoUElQRV9CKSB8IEJJVChQSVBFX0MpIH0sCit7IHsg
REJVRl9TMV9CSVQsIERCVUZfUzFfQklULCBEQlVGX1MyX0JJVCwgMCB9LCBCSVQoUElQRV9BKSB8
IEJJVChQSVBFX0IpIHwgQklUKFBJUEVfQykgfSwKK307CisKKy8qCisgKiBUaGlzIGZ1bmN0aW9u
IGZpbmRzIGFuIGVudHJ5IHdpdGggc2FtZSBlbmFibGVkIHBpcGUgY29uZmlndXJhdGlvbiBhbmQK
KyAqIHJldHVybnMgY29ycmVzcG9uZGVudCBEQnVmIHNsaWNlIG1hc2sgYXMgc3RhdGVkIGluIEJT
cGVjIGZvciBwYXJ0aWN1bGFyCisgKiBwbGF0Zm9ybS4KKyAqLworc3RhdGljIHUzMiBpY2xfZ2V0
X2FsbG93ZWRfZGJ1Zl9tYXNrKGludCBwaXBlLAorCQkJCSAgICAgdTMyIGFjdGl2ZV9waXBlcywK
KwkJCQkgICAgIHVpbnRfZml4ZWRfMTZfMTZfdCBwaXBlX3JhdGlvKQoreworCWludCBpOworCWZv
ciAoaSA9IDA7IGkgPCBBUlJBWV9TSVpFKGljbF9hbGxvd2VkX2RidWZzKTsgaSsrKSB7CisJCWlm
IChpY2xfYWxsb3dlZF9kYnVmc1tpXS5hY3RpdmVfcGlwZXMgPT0gYWN0aXZlX3BpcGVzKSB7CisJ
CQkvKgorCQkJICogQWNjb3JkaW5nIHRvIEJTcGVjIDEyNzE2OiBpZiBwaXBlX3JhdGlvID49IDg4
LjgKKwkJCSAqIHVzZSBzaW5nbGUgcGlwZSwgZXZlbiBpZiB0d28gYXJlIGFjY2Vzc2libGUuCisJ
CQkgKi8KKwkJCWlmIChwaXBlX3JhdGlvLnZhbCA+PSBkaXZfZml4ZWQxNig4ODgsIDEwKS52YWwp
CisJCQkJKytpOworCQkJcmV0dXJuIGljbF9hbGxvd2VkX2RidWZzW2ldLmRidWZfbWFza1twaXBl
XTsKKwkJfQorCX0KKwlyZXR1cm4gMDsKK30KKwordTMyIGk5MTVfZ2V0X2FsbG93ZWRfZGJ1Zl9t
YXNrKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKKwkJCQkgICAgICBpbnQgcGlw
ZSwgdTMyIGFjdGl2ZV9waXBlcywKKwkJCQkgICAgICB1aW50X2ZpeGVkXzE2XzE2X3QgcGlwZV9y
YXRpbykKK3sKKwlpZiAoSVNfR0VOKGRldl9wcml2LCAxMSkpCisJCXJldHVybiBpY2xfZ2V0X2Fs
bG93ZWRfZGJ1Zl9tYXNrKHBpcGUsCisJCQkJCQkgYWN0aXZlX3BpcGVzLAorCQkJCQkJIHBpcGVf
cmF0aW8pOworCS8qCisJICogRm9yIGFueXRoaW5nIGVsc2UganVzdCByZXR1cm4gb25lIHNsaWNl
IHlldC4KKwkgKiBTaG91bGQgYmUgZXh0ZW5kZWQgZm9yIG90aGVyIHBsYXRmb3Jtcy4KKwkgKi8K
KwlyZXR1cm4gREJVRl9TMV9CSVQ7Cit9CisKIHN0YXRpYyB1NjQKIGljbF9nZXRfdG90YWxfcmVs
YXRpdmVfZGF0YV9yYXRlKHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlLAogCQkJ
CSB1NjQgKnBsYW5lX2RhdGFfcmF0ZSkKLS0gCjIuMTcuMQoKX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX18KSW50ZWwtZ2Z4IG1haWxpbmcgbGlzdApJbnRlbC1n
ZnhAbGlzdHMuZnJlZWRlc2t0b3Aub3JnCmh0dHBzOi8vbGlzdHMuZnJlZWRlc2t0b3Aub3JnL21h
aWxtYW4vbGlzdGluZm8vaW50ZWwtZ2Z4

Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 66E341D29B9
	for <lists+intel-gfx@lfdr.de>; Thu, 14 May 2020 10:10:18 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id E45F889CCE;
	Thu, 14 May 2020 08:10:15 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from mga09.intel.com (mga09.intel.com [134.134.136.24])
 by gabe.freedesktop.org (Postfix) with ESMTPS id A457389CCE
 for <intel-gfx@lists.freedesktop.org>; Thu, 14 May 2020 08:10:14 +0000 (UTC)
IronPort-SDR: je0K5h8nxdciGZZruh5KdRmK4vAdSz/yb62CINCD41mJDIuPK+um1IJ8EtHnuocBwpxyq6XfbQ
 co4hyO+KOWhg==
X-Amp-Result: SKIPPED(no attachment in message)
X-Amp-File-Uploaded: False
Received: from fmsmga003.fm.intel.com ([10.253.24.29])
 by orsmga102.jf.intel.com with ESMTP/TLS/ECDHE-RSA-AES256-GCM-SHA384;
 14 May 2020 01:10:13 -0700
IronPort-SDR: e5BUX/WCJep74s1Z/fAYT89XKQ5HCQwwrDA2JWj5kqXTuliVVPTrZD2Yjq1BXHyHjp62N4qtqC
 vXmgU8zFkWJg==
X-ExtLoop1: 1
X-IronPort-AV: E=Sophos;i="5.73,390,1583222400"; d="scan'208";a="307035458"
Received: from unknown (HELO amanna.iind.intel.com) ([10.223.74.53])
 by FMSMGA003.fm.intel.com with ESMTP; 14 May 2020 01:10:11 -0700
From: Animesh Manna <animesh.manna@intel.com>
To: intel-gfx@lists.freedesktop.org
Date: Thu, 14 May 2020 13:27:22 +0530
Message-Id: <20200514075722.7941-1-animesh.manna@intel.com>
X-Mailer: git-send-email 2.26.0
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH v6] drm/i915/dsb: Pre allocate and late cleanup
 of cmd buffer
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.29
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Cc: Jani Nikula <jani.nikula@intel.com>, Daniel Vetter <daniel.vetter@ffwll.ch>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

UHJlLWFsbG9jYXRlIGNvbW1hbmQgYnVmZmVyIGluIGF0b21pY19jb21taXQgdXNpbmcgaW50ZWxf
ZHNiX3ByZXBhcmUKZnVuY3Rpb24gd2hpY2ggYWxzbyBpbmNsdWRlcyBwaW5uaW5nIGFuZCBtYXAg
aW4gY3B1IGRvbWFpbi4KCk5vIGZ1bmN0aW9uYWwgY2hhbmdlIGlzIGRzYiB3cml0ZS9jb21taXQg
ZnVuY3Rpb25zLgoKTm93IGRzYiBnZXQvcHV0IGZ1bmN0aW9uIGlzIHJlbW92ZWQgYW5kIHJlZi1j
b3VudCBtZWNoYW5pc20gaXMKbm90IG5lZWRlZC4gQmVsb3cgZHNiIGFwaSBhZGRlZCB0byBkbyBy
ZXNwZWN0aXZlIGpvYiBtZW50aW9uZWQKYmVsb3cuCgppbnRlbF9kc2JfcHJlcGFyZSAtIEFsbG9j
YXRlLCBwaW4gYW5kIG1hcCB0aGUgYnVmZmVyLgppbnRlbF9kc2JfY2xlYW51cCAtIFVucGluIGFu
ZCByZWxlYXNlIHRoZSBnZW0gb2JqZWN0LgoKUkZDOiBJbml0aWFsIHBhdGNoIGZvciBkZXNpZ24g
cmV2aWV3Lgp2MjogaW5jbHVkZWQgX2luaXQoKSBwYXJ0IGluIF9wcmVwYXJlKCkuIFtEYW5pZWws
IFZpbGxlXQp2MzogZHNiX2NsZWFudXAgY2FsbGVkIGFmdGVyIGNsZWFudXBfcGxhbmVzLiBbRGFu
aWVsXQp2NDogZHNiIHN0cnVjdHVyZSBpcyBtb3ZlZCB0byBpbnRlbF9jcnRjX3N0YXRlIGZyb20g
aW50ZWxfY3J0Yy4gW01hYXJ0ZW5dCnY1OiBkc2IgZ2V0L3B1dC9yZWYtY291bnQgbWVjaGFuaXNt
IHJlbW92ZWQuIFtNYWFydGVuXQp2NjogQmFzZWQgb24gcmV2aWV3IGZlZWRiYWNrIGZvbGxvd2lu
ZyBjaGFuZ2VzIGFyZSBhZGRlZCwKLSByZXBsYWNlZCBpbnRlbF9kc2Igc3RydWN0dXJlIGJ5IHBv
aW50ZXIgaW4gaW50ZWxfY3J0Y19zdGF0ZS4gW01hYXJ0ZW5dCi0gcGFzc2luZyBpbnRlbF9jcnRj
X3N0YXRlIHRvIGRzcC1hcGkgdG8gc2ltcGxpZnkgdGhlIGNvZGUuIFtNYWFydGVuXQotIGZldyBk
c2IgZnVuY3Rpb25zIHByb3RvdHlwZSBtb2RpZmllZCB0byBzaW1wbGlmeSBjb2RlLgoKQ2M6IE1h
YXJ0ZW4gTGFua2hvcnN0IDxtYWFydGVuLmxhbmtob3JzdEBsaW51eC5pbnRlbC5jb20+CkNjOiBW
aWxsZSBTeXJqw6Rsw6QgPHZpbGxlLnN5cmphbGFAbGludXguaW50ZWwuY29tPgpDYzogSmFuaSBO
aWt1bGEgPGphbmkubmlrdWxhQGludGVsLmNvbT4KQ2M6IERhbmllbCBWZXR0ZXIgPGRhbmllbC52
ZXR0ZXJAZmZ3bGwuY2g+CkFja2VkLWJ5OiBEYW5pZWwgVmV0dGVyIDxkYW5pZWwudmV0dGVyQGZm
d2xsLmNoPgpTaWduZWQtb2ZmLWJ5OiBBbmltZXNoIE1hbm5hIDxhbmltZXNoLm1hbm5hQGludGVs
LmNvbT4KLS0tCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2F0b21pYy5jICAg
fCAgIDMgKwogZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9jb2xvci5jICAgIHwg
IDUxICsrLS0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZGlzcGxheS5jICB8
ICA1OSArKysrLQogLi4uL2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZGlzcGxheV90eXBlcy5oICAg
IHwgICA2ICstCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2RzYi5jICAgICAg
fCAyNTAgKysrKysrKystLS0tLS0tLS0tCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2lu
dGVsX2RzYi5oICAgICAgfCAgMTcgKy0KIDYgZmlsZXMgY2hhbmdlZCwgMjAyIGluc2VydGlvbnMo
KyksIDE4NCBkZWxldGlvbnMoLSkKCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9k
aXNwbGF5L2ludGVsX2F0b21pYy5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRl
bF9hdG9taWMuYwppbmRleCBkMDQzMDU3ZDJmYTAuLjNjYjg2NmYyMmU3NCAxMDA2NDQKLS0tIGEv
ZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9hdG9taWMuYworKysgYi9kcml2ZXJz
L2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2F0b21pYy5jCkBAIC0yNTIsNiArMjUyLDcgQEAg
aW50ZWxfY3J0Y19kdXBsaWNhdGVfc3RhdGUoc3RydWN0IGRybV9jcnRjICpjcnRjKQogCWNydGNf
c3RhdGUtPndtLm5lZWRfcG9zdHZibF91cGRhdGUgPSBmYWxzZTsKIAljcnRjX3N0YXRlLT5mYl9i
aXRzID0gMDsKIAljcnRjX3N0YXRlLT51cGRhdGVfcGxhbmVzID0gMDsKKwljcnRjX3N0YXRlLT5k
c2IgPSBOVUxMOwogCiAJcmV0dXJuICZjcnRjX3N0YXRlLT51YXBpOwogfQpAQCAtMjkyLDYgKzI5
Myw4IEBAIGludGVsX2NydGNfZGVzdHJveV9zdGF0ZShzdHJ1Y3QgZHJtX2NydGMgKmNydGMsCiB7
CiAJc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUgPSB0b19pbnRlbF9jcnRjX3N0
YXRlKHN0YXRlKTsKIAorCWRybV9XQVJOX09OKGNydGMtPmRldiwgY3J0Y19zdGF0ZS0+ZHNiKTsK
KwogCV9fZHJtX2F0b21pY19oZWxwZXJfY3J0Y19kZXN0cm95X3N0YXRlKCZjcnRjX3N0YXRlLT51
YXBpKTsKIAlpbnRlbF9jcnRjX2ZyZWVfaHdfc3RhdGUoY3J0Y19zdGF0ZSk7CiAJa2ZyZWUoY3J0
Y19zdGF0ZSk7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVs
X2NvbG9yLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2NvbG9yLmMKaW5k
ZXggOThlY2U5Y2Q3Y2RkLi5iYzA5MzQ2ODk1MDUgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2Ry
bS9pOTE1L2Rpc3BsYXkvaW50ZWxfY29sb3IuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9k
aXNwbGF5L2ludGVsX2NvbG9yLmMKQEAgLTcxNywxMyArNzE3LDE0IEBAIHN0YXRpYyB2b2lkIGJk
d19sb2FkX2x1dF8xMChzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YywKIHN0YXRpYyB2b2lkIGl2Yl9s
b2FkX2x1dF9leHRfbWF4KHN0cnVjdCBpbnRlbF9jcnRjICpjcnRjKQogewogCXN0cnVjdCBkcm1f
aTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoY3J0Yy0+YmFzZS5kZXYpOwotCXN0cnVj
dCBpbnRlbF9kc2IgKmRzYiA9IGludGVsX2RzYl9nZXQoY3J0Yyk7CisJc3RydWN0IGludGVsX2Ny
dGNfc3RhdGUgKmNydGNfc3RhdGUgPQorCQl0b19pbnRlbF9jcnRjX3N0YXRlKGNydGMtPmJhc2Uu
c3RhdGUpOwogCWVudW0gcGlwZSBwaXBlID0gY3J0Yy0+cGlwZTsKIAogCS8qIFByb2dyYW0gdGhl
IG1heCByZWdpc3RlciB0byBjbGFtcCB2YWx1ZXMgPiAxLjAuICovCi0JaW50ZWxfZHNiX3JlZ193
cml0ZShkc2IsIFBSRUNfUEFMX0VYVF9HQ19NQVgocGlwZSwgMCksIDEgPDwgMTYpOwotCWludGVs
X2RzYl9yZWdfd3JpdGUoZHNiLCBQUkVDX1BBTF9FWFRfR0NfTUFYKHBpcGUsIDEpLCAxIDw8IDE2
KTsKLQlpbnRlbF9kc2JfcmVnX3dyaXRlKGRzYiwgUFJFQ19QQUxfRVhUX0dDX01BWChwaXBlLCAy
KSwgMSA8PCAxNik7CisJaW50ZWxfZHNiX3JlZ193cml0ZShjcnRjX3N0YXRlLCBQUkVDX1BBTF9F
WFRfR0NfTUFYKHBpcGUsIDApLCAxIDw8IDE2KTsKKwlpbnRlbF9kc2JfcmVnX3dyaXRlKGNydGNf
c3RhdGUsIFBSRUNfUEFMX0VYVF9HQ19NQVgocGlwZSwgMSksIDEgPDwgMTYpOworCWludGVsX2Rz
Yl9yZWdfd3JpdGUoY3J0Y19zdGF0ZSwgUFJFQ19QQUxfRVhUX0dDX01BWChwaXBlLCAyKSwgMSA8
PCAxNik7CiAKIAkvKgogCSAqIFByb2dyYW0gdGhlIGdjIG1heCAyIHJlZ2lzdGVyIHRvIGNsYW1w
IHZhbHVlcyA+IDEuMC4KQEAgLTczMSwxNSArNzMyLDEzIEBAIHN0YXRpYyB2b2lkIGl2Yl9sb2Fk
X2x1dF9leHRfbWF4KHN0cnVjdCBpbnRlbF9jcnRjICpjcnRjKQogCSAqIGZyb20gMy4wIHRvIDcu
MAogCSAqLwogCWlmIChJTlRFTF9HRU4oZGV2X3ByaXYpID49IDEwIHx8IElTX0dFTUlOSUxBS0Uo
ZGV2X3ByaXYpKSB7Ci0JCWludGVsX2RzYl9yZWdfd3JpdGUoZHNiLCBQUkVDX1BBTF9FWFQyX0dD
X01BWChwaXBlLCAwKSwKKwkJaW50ZWxfZHNiX3JlZ193cml0ZShjcnRjX3N0YXRlLCBQUkVDX1BB
TF9FWFQyX0dDX01BWChwaXBlLCAwKSwKIAkJCQkgICAgMSA8PCAxNik7Ci0JCWludGVsX2RzYl9y
ZWdfd3JpdGUoZHNiLCBQUkVDX1BBTF9FWFQyX0dDX01BWChwaXBlLCAxKSwKKwkJaW50ZWxfZHNi
X3JlZ193cml0ZShjcnRjX3N0YXRlLCBQUkVDX1BBTF9FWFQyX0dDX01BWChwaXBlLCAxKSwKIAkJ
CQkgICAgMSA8PCAxNik7Ci0JCWludGVsX2RzYl9yZWdfd3JpdGUoZHNiLCBQUkVDX1BBTF9FWFQy
X0dDX01BWChwaXBlLCAyKSwKKwkJaW50ZWxfZHNiX3JlZ193cml0ZShjcnRjX3N0YXRlLCBQUkVD
X1BBTF9FWFQyX0dDX01BWChwaXBlLCAyKSwKIAkJCQkgICAgMSA8PCAxNik7CiAJfQotCi0JaW50
ZWxfZHNiX3B1dChkc2IpOwogfQogCiBzdGF0aWMgdm9pZCBpdmJfbG9hZF9sdXRzKGNvbnN0IHN0
cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlKQpAQCAtOTAwLDE0ICs4OTksMTIgQEAg
aWNsX2xvYWRfZ2NtYXgoY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUs
CiAJICAgICAgIGNvbnN0IHN0cnVjdCBkcm1fY29sb3JfbHV0ICpjb2xvcikKIHsKIAlzdHJ1Y3Qg
aW50ZWxfY3J0YyAqY3J0YyA9IHRvX2ludGVsX2NydGMoY3J0Y19zdGF0ZS0+dWFwaS5jcnRjKTsK
LQlzdHJ1Y3QgaW50ZWxfZHNiICpkc2IgPSBpbnRlbF9kc2JfZ2V0KGNydGMpOwogCWVudW0gcGlw
ZSBwaXBlID0gY3J0Yy0+cGlwZTsKIAogCS8qIEZJWE1FIExVVCBlbnRyaWVzIGFyZSAxNiBiaXQg
b25seSwgc28gd2UgY2FuIHByb2cgMHhGRkZGIG1heCAqLwotCWludGVsX2RzYl9yZWdfd3JpdGUo
ZHNiLCBQUkVDX1BBTF9HQ19NQVgocGlwZSwgMCksIGNvbG9yLT5yZWQpOwotCWludGVsX2RzYl9y
ZWdfd3JpdGUoZHNiLCBQUkVDX1BBTF9HQ19NQVgocGlwZSwgMSksIGNvbG9yLT5ncmVlbik7Ci0J
aW50ZWxfZHNiX3JlZ193cml0ZShkc2IsIFBSRUNfUEFMX0dDX01BWChwaXBlLCAyKSwgY29sb3It
PmJsdWUpOwotCWludGVsX2RzYl9wdXQoZHNiKTsKKwlpbnRlbF9kc2JfcmVnX3dyaXRlKGNydGNf
c3RhdGUsIFBSRUNfUEFMX0dDX01BWChwaXBlLCAwKSwgY29sb3ItPnJlZCk7CisJaW50ZWxfZHNi
X3JlZ193cml0ZShjcnRjX3N0YXRlLCBQUkVDX1BBTF9HQ19NQVgocGlwZSwgMSksIGNvbG9yLT5n
cmVlbik7CisJaW50ZWxfZHNiX3JlZ193cml0ZShjcnRjX3N0YXRlLCBQUkVDX1BBTF9HQ19NQVgo
cGlwZSwgMiksIGNvbG9yLT5ibHVlKTsKIH0KIAogc3RhdGljIHZvaWQKQEAgLTkxNiw3ICs5MTMs
NiBAQCBpY2xfcHJvZ3JhbV9nYW1tYV9zdXBlcmZpbmVfc2VnbWVudChjb25zdCBzdHJ1Y3QgaW50
ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSkKIAlzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YyA9IHRv
X2ludGVsX2NydGMoY3J0Y19zdGF0ZS0+dWFwaS5jcnRjKTsKIAljb25zdCBzdHJ1Y3QgZHJtX3By
b3BlcnR5X2Jsb2IgKmJsb2IgPSBjcnRjX3N0YXRlLT5ody5nYW1tYV9sdXQ7CiAJY29uc3Qgc3Ry
dWN0IGRybV9jb2xvcl9sdXQgKmx1dCA9IGJsb2ItPmRhdGE7Ci0Jc3RydWN0IGludGVsX2RzYiAq
ZHNiID0gaW50ZWxfZHNiX2dldChjcnRjKTsKIAllbnVtIHBpcGUgcGlwZSA9IGNydGMtPnBpcGU7
CiAJaW50IGk7CiAKQEAgLTkyNywxOSArOTIzLDE3IEBAIGljbF9wcm9ncmFtX2dhbW1hX3N1cGVy
ZmluZV9zZWdtZW50KGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlKQog
CSAqIDkgZW50cmllcywgY29ycmVzcG9uZGluZyB0byB2YWx1ZXMgMCwgMS8oOCAqIDEyOCAqIDI1
NiksCiAJICogMi8oOCAqIDEyOCAqIDI1NikgLi4uIDgvKDggKiAxMjggKiAyNTYpLgogCSAqLwot
CWludGVsX2RzYl9yZWdfd3JpdGUoZHNiLCBQUkVDX1BBTF9NVUxUSV9TRUdfSU5ERVgocGlwZSks
CisJaW50ZWxfZHNiX3JlZ193cml0ZShjcnRjX3N0YXRlLCBQUkVDX1BBTF9NVUxUSV9TRUdfSU5E
RVgocGlwZSksCiAJCQkgICAgUEFMX1BSRUNfQVVUT19JTkNSRU1FTlQpOwogCiAJZm9yIChpID0g
MDsgaSA8IDk7IGkrKykgewogCQljb25zdCBzdHJ1Y3QgZHJtX2NvbG9yX2x1dCAqZW50cnkgPSAm
bHV0W2ldOwogCi0JCWludGVsX2RzYl9pbmRleGVkX3JlZ193cml0ZShkc2IsIFBSRUNfUEFMX01V
TFRJX1NFR19EQVRBKHBpcGUpLAorCQlpbnRlbF9kc2JfaW5kZXhlZF9yZWdfd3JpdGUoY3J0Y19z
dGF0ZSwgUFJFQ19QQUxfTVVMVElfU0VHX0RBVEEocGlwZSksCiAJCQkJCSAgICBpbGtfbHV0XzEy
cDRfbGR3KGVudHJ5KSk7Ci0JCWludGVsX2RzYl9pbmRleGVkX3JlZ193cml0ZShkc2IsIFBSRUNf
UEFMX01VTFRJX1NFR19EQVRBKHBpcGUpLAorCQlpbnRlbF9kc2JfaW5kZXhlZF9yZWdfd3JpdGUo
Y3J0Y19zdGF0ZSwgUFJFQ19QQUxfTVVMVElfU0VHX0RBVEEocGlwZSksCiAJCQkJCSAgICBpbGtf
bHV0XzEycDRfdWR3KGVudHJ5KSk7CiAJfQotCi0JaW50ZWxfZHNiX3B1dChkc2IpOwogfQogCiBz
dGF0aWMgdm9pZApAQCAtOTQ5LDcgKzk0Myw2IEBAIGljbF9wcm9ncmFtX2dhbW1hX211bHRpX3Nl
Z21lbnQoY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUpCiAJY29uc3Qg
c3RydWN0IGRybV9wcm9wZXJ0eV9ibG9iICpibG9iID0gY3J0Y19zdGF0ZS0+aHcuZ2FtbWFfbHV0
OwogCWNvbnN0IHN0cnVjdCBkcm1fY29sb3JfbHV0ICpsdXQgPSBibG9iLT5kYXRhOwogCWNvbnN0
IHN0cnVjdCBkcm1fY29sb3JfbHV0ICplbnRyeTsKLQlzdHJ1Y3QgaW50ZWxfZHNiICpkc2IgPSBp
bnRlbF9kc2JfZ2V0KGNydGMpOwogCWVudW0gcGlwZSBwaXBlID0gY3J0Yy0+cGlwZTsKIAlpbnQg
aTsKIApAQCAtOTYzLDEyICs5NTYsMTMgQEAgaWNsX3Byb2dyYW1fZ2FtbWFfbXVsdGlfc2VnbWVu
dChjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSkKIAkgKiBQQUxfUFJF
Q19JTkRFWFswXSBhbmQgUEFMX1BSRUNfSU5ERVhbMV0gbWFwIHRvIHNlZzJbMV0sCiAJICogc2Vn
MlswXSBiZWluZyB1bnVzZWQgYnkgdGhlIGhhcmR3YXJlLgogCSAqLwotCWludGVsX2RzYl9yZWdf
d3JpdGUoZHNiLCBQUkVDX1BBTF9JTkRFWChwaXBlKSwgUEFMX1BSRUNfQVVUT19JTkNSRU1FTlQp
OworCWludGVsX2RzYl9yZWdfd3JpdGUoY3J0Y19zdGF0ZSwgUFJFQ19QQUxfSU5ERVgocGlwZSks
CisJCQkgICAgUEFMX1BSRUNfQVVUT19JTkNSRU1FTlQpOwogCWZvciAoaSA9IDE7IGkgPCAyNTc7
IGkrKykgewogCQllbnRyeSA9ICZsdXRbaSAqIDhdOwotCQlpbnRlbF9kc2JfaW5kZXhlZF9yZWdf
d3JpdGUoZHNiLCBQUkVDX1BBTF9EQVRBKHBpcGUpLAorCQlpbnRlbF9kc2JfaW5kZXhlZF9yZWdf
d3JpdGUoY3J0Y19zdGF0ZSwgUFJFQ19QQUxfREFUQShwaXBlKSwKIAkJCQkJICAgIGlsa19sdXRf
MTJwNF9sZHcoZW50cnkpKTsKLQkJaW50ZWxfZHNiX2luZGV4ZWRfcmVnX3dyaXRlKGRzYiwgUFJF
Q19QQUxfREFUQShwaXBlKSwKKwkJaW50ZWxfZHNiX2luZGV4ZWRfcmVnX3dyaXRlKGNydGNfc3Rh
dGUsIFBSRUNfUEFMX0RBVEEocGlwZSksCiAJCQkJCSAgICBpbGtfbHV0XzEycDRfdWR3KGVudHJ5
KSk7CiAJfQogCkBAIC05ODYsOSArOTgwLDkgQEAgaWNsX3Byb2dyYW1fZ2FtbWFfbXVsdGlfc2Vn
bWVudChjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSkKIAkgKi8KIAlm
b3IgKGkgPSAwOyBpIDwgMjU2OyBpKyspIHsKIAkJZW50cnkgPSAmbHV0W2kgKiA4ICogMTI4XTsK
LQkJaW50ZWxfZHNiX2luZGV4ZWRfcmVnX3dyaXRlKGRzYiwgUFJFQ19QQUxfREFUQShwaXBlKSwK
KwkJaW50ZWxfZHNiX2luZGV4ZWRfcmVnX3dyaXRlKGNydGNfc3RhdGUsIFBSRUNfUEFMX0RBVEEo
cGlwZSksCiAJCQkJCSAgICBpbGtfbHV0XzEycDRfbGR3KGVudHJ5KSk7Ci0JCWludGVsX2RzYl9p
bmRleGVkX3JlZ193cml0ZShkc2IsIFBSRUNfUEFMX0RBVEEocGlwZSksCisJCWludGVsX2RzYl9p
bmRleGVkX3JlZ193cml0ZShjcnRjX3N0YXRlLCBQUkVDX1BBTF9EQVRBKHBpcGUpLAogCQkJCQkg
ICAgaWxrX2x1dF8xMnA0X3VkdyhlbnRyeSkpOwogCX0KIApAQCAtOTk2LDE0ICs5OTAsMTIgQEAg
aWNsX3Byb2dyYW1fZ2FtbWFfbXVsdGlfc2VnbWVudChjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19z
dGF0ZSAqY3J0Y19zdGF0ZSkKIAllbnRyeSA9ICZsdXRbMjU2ICogOCAqIDEyOF07CiAJaWNsX2xv
YWRfZ2NtYXgoY3J0Y19zdGF0ZSwgZW50cnkpOwogCWl2Yl9sb2FkX2x1dF9leHRfbWF4KGNydGMp
OwotCWludGVsX2RzYl9wdXQoZHNiKTsKIH0KIAogc3RhdGljIHZvaWQgaWNsX2xvYWRfbHV0cyhj
b25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSkKIHsKIAljb25zdCBzdHJ1
Y3QgZHJtX3Byb3BlcnR5X2Jsb2IgKmdhbW1hX2x1dCA9IGNydGNfc3RhdGUtPmh3LmdhbW1hX2x1
dDsKIAlzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YyA9IHRvX2ludGVsX2NydGMoY3J0Y19zdGF0ZS0+
dWFwaS5jcnRjKTsKLQlzdHJ1Y3QgaW50ZWxfZHNiICpkc2IgPSBpbnRlbF9kc2JfZ2V0KGNydGMp
OwogCiAJaWYgKGNydGNfc3RhdGUtPmh3LmRlZ2FtbWFfbHV0KQogCQlnbGtfbG9hZF9kZWdhbW1h
X2x1dChjcnRjX3N0YXRlKTsKQEAgLTEwMjEsOCArMTAxMyw3IEBAIHN0YXRpYyB2b2lkIGljbF9s
b2FkX2x1dHMoY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUpCiAJCWl2
Yl9sb2FkX2x1dF9leHRfbWF4KGNydGMpOwogCX0KIAotCWludGVsX2RzYl9jb21taXQoZHNiKTsK
LQlpbnRlbF9kc2JfcHV0KGRzYik7CisJaW50ZWxfZHNiX2NvbW1pdChjcnRjX3N0YXRlKTsKIH0K
IAogc3RhdGljIHUzMiBjaHZfY2dtX2RlZ2FtbWFfbGR3KGNvbnN0IHN0cnVjdCBkcm1fY29sb3Jf
bHV0ICpjb2xvcikKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50
ZWxfZGlzcGxheS5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kaXNwbGF5
LmMKaW5kZXggNDMyYjRlZWFmOWY2Li5mMTAzZDAwMzA3MTAgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMv
Z3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZGlzcGxheS5jCisrKyBiL2RyaXZlcnMvZ3B1L2Ry
bS9pOTE1L2Rpc3BsYXkvaW50ZWxfZGlzcGxheS5jCkBAIC0xNDg3Myw4ICsxNDg3MywyOCBAQCBz
dGF0aWMgaW50IGludGVsX2F0b21pY19jaGVjayhzdHJ1Y3QgZHJtX2RldmljZSAqZGV2LAogCiBz
dGF0aWMgaW50IGludGVsX2F0b21pY19wcmVwYXJlX2NvbW1pdChzdHJ1Y3QgaW50ZWxfYXRvbWlj
X3N0YXRlICpzdGF0ZSkKIHsKLQlyZXR1cm4gZHJtX2F0b21pY19oZWxwZXJfcHJlcGFyZV9wbGFu
ZXMoc3RhdGUtPmJhc2UuZGV2LAotCQkJCQkJJnN0YXRlLT5iYXNlKTsKKwlzdHJ1Y3QgaW50ZWxf
Y3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZTsKKwlzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YzsKKwlpbnQg
aSwgcmV0OworCisJcmV0ID0gZHJtX2F0b21pY19oZWxwZXJfcHJlcGFyZV9wbGFuZXMoc3RhdGUt
PmJhc2UuZGV2LCAmc3RhdGUtPmJhc2UpOworCWlmIChyZXQgPCAwKQorCQlyZXR1cm4gcmV0Owor
CisJLyoKKwkgKiBJbiBjYXNlIG9mIERTQiBidWZmZXIgY3JlYXRpb24gZmFpbHVyZSByZWdpc3Rl
ciBwcm9ncmFtbWluZyB3aWxsIGJlCisJICogZG9uZSBieSBtbWlvIGFuZCBlcnJvbmVvdXMgcGF0
aCB3aWxsIGJlIGhhbmRsZWQgYnkgZHNwLXdyaXRlIGFwaS4KKwkgKi8KKwlmb3JfZWFjaF9uZXdf
aW50ZWxfY3J0Y19pbl9zdGF0ZShzdGF0ZSwgY3J0YywgY3J0Y19zdGF0ZSwgaSkgeworCQlib29s
IG1vZGVfY2hhbmdlZCA9IG5lZWRzX21vZGVzZXQoY3J0Y19zdGF0ZSk7CisKKwkJaWYgKG1vZGVf
Y2hhbmdlZCB8fCBjcnRjX3N0YXRlLT51cGRhdGVfcGlwZSB8fAorCQkgICAgY3J0Y19zdGF0ZS0+
dWFwaS5jb2xvcl9tZ210X2NoYW5nZWQpIHsKKwkJCWludGVsX2RzYl9wcmVwYXJlKGNydGNfc3Rh
dGUpOworCQl9CisJfQorCisJcmV0dXJuIDA7CiB9CiAKIHUzMiBpbnRlbF9jcnRjX2dldF92Ymxh
bmtfY291bnRlcihzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YykKQEAgLTE1MzI3LDE1ICsxNTM0Nywy
OSBAQCBzdGF0aWMgdm9pZCBpbnRlbF9hdG9taWNfY29tbWl0X2ZlbmNlX3dhaXQoc3RydWN0IGlu
dGVsX2F0b21pY19zdGF0ZSAqaW50ZWxfc3RhdAogCQkgICAgJndhaXRfcmVzZXQpOwogfQogCitz
dGF0aWMgdm9pZCBpbnRlbF9jbGVhbnVwX2RzYnMoc3RydWN0IGludGVsX2F0b21pY19zdGF0ZSAq
c3RhdGUpCit7CisJc3RydWN0IGludGVsX2NydGNfc3RhdGUgKm9sZF9jcnRjX3N0YXRlLCAqbmV3
X2NydGNfc3RhdGU7CisJc3RydWN0IGludGVsX2NydGMgKmNydGM7CisJaW50IGk7CisKKwlmb3Jf
ZWFjaF9vbGRuZXdfaW50ZWxfY3J0Y19pbl9zdGF0ZShzdGF0ZSwgY3J0Yywgb2xkX2NydGNfc3Rh
dGUsCisJCQkJCSAgICBuZXdfY3J0Y19zdGF0ZSwgaSkgeworCQlpbnRlbF9kc2JfY2xlYW51cChv
bGRfY3J0Y19zdGF0ZSk7CisJCW9sZF9jcnRjX3N0YXRlLT5kc2IgPSBOVUxMOworCX0KK30KKwog
c3RhdGljIHZvaWQgaW50ZWxfYXRvbWljX2NsZWFudXBfd29yayhzdHJ1Y3Qgd29ya19zdHJ1Y3Qg
KndvcmspCiB7Ci0Jc3RydWN0IGRybV9hdG9taWNfc3RhdGUgKnN0YXRlID0KLQkJY29udGFpbmVy
X29mKHdvcmssIHN0cnVjdCBkcm1fYXRvbWljX3N0YXRlLCBjb21taXRfd29yayk7Ci0Jc3RydWN0
IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSB0b19pOTE1KHN0YXRlLT5kZXYpOworCXN0cnVjdCBp
bnRlbF9hdG9taWNfc3RhdGUgKnN0YXRlID0KKwkJY29udGFpbmVyX29mKHdvcmssIHN0cnVjdCBp
bnRlbF9hdG9taWNfc3RhdGUsIGJhc2UuY29tbWl0X3dvcmspOworCXN0cnVjdCBkcm1faTkxNV9w
cml2YXRlICppOTE1ID0gdG9faTkxNShzdGF0ZS0+YmFzZS5kZXYpOwogCi0JZHJtX2F0b21pY19o
ZWxwZXJfY2xlYW51cF9wbGFuZXMoJmk5MTUtPmRybSwgc3RhdGUpOwotCWRybV9hdG9taWNfaGVs
cGVyX2NvbW1pdF9jbGVhbnVwX2RvbmUoc3RhdGUpOwotCWRybV9hdG9taWNfc3RhdGVfcHV0KHN0
YXRlKTsKKwlpbnRlbF9jbGVhbnVwX2RzYnMoc3RhdGUpOworCWRybV9hdG9taWNfaGVscGVyX2Ns
ZWFudXBfcGxhbmVzKCZpOTE1LT5kcm0sICZzdGF0ZS0+YmFzZSk7CisJZHJtX2F0b21pY19oZWxw
ZXJfY29tbWl0X2NsZWFudXBfZG9uZSgmc3RhdGUtPmJhc2UpOworCWRybV9hdG9taWNfc3RhdGVf
cHV0KCZzdGF0ZS0+YmFzZSk7CiAKIAlpbnRlbF9hdG9taWNfaGVscGVyX2ZyZWVfc3RhdGUoaTkx
NSk7CiB9CkBAIC0xNTQ2OSw2ICsxNTUwMyw4IEBAIHN0YXRpYyB2b2lkIGludGVsX2F0b21pY19j
b21taXRfdGFpbChzdHJ1Y3QgaW50ZWxfYXRvbWljX3N0YXRlICpzdGF0ZSkKIAkJCW1vZGVzZXRf
cHV0X3Bvd2VyX2RvbWFpbnMoZGV2X3ByaXYsIHB1dF9kb21haW5zW2ldKTsKIAogCQlpbnRlbF9t
b2Rlc2V0X3ZlcmlmeV9jcnRjKGNydGMsIHN0YXRlLCBvbGRfY3J0Y19zdGF0ZSwgbmV3X2NydGNf
c3RhdGUpOworCisJCW9sZF9jcnRjX3N0YXRlLT5kc2IgPSBmZXRjaF9hbmRfemVybygmbmV3X2Ny
dGNfc3RhdGUtPmRzYik7CiAJfQogCiAJLyogVW5kZXJydW5zIGRvbid0IGFsd2F5cyByYWlzZSBp
bnRlcnJ1cHRzLCBzbyBjaGVjayBtYW51YWxseSAqLwpAQCAtMTU2MTgsOCArMTU2NTQsMTUgQEAg
c3RhdGljIGludCBpbnRlbF9hdG9taWNfY29tbWl0KHN0cnVjdCBkcm1fZGV2aWNlICpkZXYsCiAJ
CWludGVsX2F0b21pY19zd2FwX2dsb2JhbF9zdGF0ZShzdGF0ZSk7CiAKIAlpZiAocmV0KSB7CisJ
CXN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpuZXdfY3J0Y19zdGF0ZTsKKwkJc3RydWN0IGludGVs
X2NydGMgKmNydGM7CisJCWludCBpOworCiAJCWk5MTVfc3dfZmVuY2VfY29tbWl0KCZzdGF0ZS0+
Y29tbWl0X3JlYWR5KTsKIAorCQlmb3JfZWFjaF9uZXdfaW50ZWxfY3J0Y19pbl9zdGF0ZShzdGF0
ZSwgY3J0YywgbmV3X2NydGNfc3RhdGUsIGkpCisJCQlpbnRlbF9kc2JfY2xlYW51cChuZXdfY3J0
Y19zdGF0ZSk7CisKIAkJZHJtX2F0b21pY19oZWxwZXJfY2xlYW51cF9wbGFuZXMoZGV2LCAmc3Rh
dGUtPmJhc2UpOwogCQlpbnRlbF9ydW50aW1lX3BtX3B1dCgmZGV2X3ByaXYtPnJ1bnRpbWVfcG0s
IHN0YXRlLT53YWtlcmVmKTsKIAkJcmV0dXJuIHJldDsKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1
L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZGlzcGxheV90eXBlcy5oIGIvZHJpdmVycy9ncHUvZHJt
L2k5MTUvZGlzcGxheS9pbnRlbF9kaXNwbGF5X3R5cGVzLmgKaW5kZXggODc4NzZmY2U5MWE1Li5j
YTU3OTAwNWQ4MTggMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50
ZWxfZGlzcGxheV90eXBlcy5oCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50
ZWxfZGlzcGxheV90eXBlcy5oCkBAIC0xMDc4LDYgKzEwNzgsOSBAQCBzdHJ1Y3QgaW50ZWxfY3J0
Y19zdGF0ZSB7CiAKIAkvKiBPbmx5IHZhbGlkIG9uIFRHTCsgKi8KIAllbnVtIHRyYW5zY29kZXIg
bXN0X21hc3Rlcl90cmFuc2NvZGVyOworCisJLyogRm9yIERTQiByZWxhdGVkIGluZm8gKi8KKwlz
dHJ1Y3QgaW50ZWxfZHNiICpkc2I7CiB9OwogCiBlbnVtIGludGVsX3BpcGVfY3JjX3NvdXJjZSB7
CkBAIC0xMTQ3LDkgKzExNTAsNiBAQCBzdHJ1Y3QgaW50ZWxfY3J0YyB7CiAJLyogc2NhbGVycyBh
dmFpbGFibGUgb24gdGhpcyBjcnRjICovCiAJaW50IG51bV9zY2FsZXJzOwogCi0JLyogcGVyIHBp
cGUgRFNCIHJlbGF0ZWQgaW5mbyAqLwotCXN0cnVjdCBpbnRlbF9kc2IgZHNiOwotCiAjaWZkZWYg
Q09ORklHX0RFQlVHX0ZTCiAJc3RydWN0IGludGVsX3BpcGVfY3JjIHBpcGVfY3JjOwogI2VuZGlm
CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2RzYi5jIGIv
ZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kc2IuYwppbmRleCAyOWZlYzZhOTJk
MTcuLjI5NTI0MjcyNDFlYiAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxh
eS9pbnRlbF9kc2IuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2Rz
Yi5jCkBAIC0zNCwxNTIgKzM0LDUyIEBACiAjZGVmaW5lIERTQl9CWVRFX0VOX1NISUZUCQkyMAog
I2RlZmluZSBEU0JfUkVHX1ZBTFVFX01BU0sJCTB4ZmZmZmYKIAotc3RhdGljIGJvb2wgaXNfZHNi
X2J1c3koc3RydWN0IGludGVsX2RzYiAqZHNiKQorc3RhdGljIGlubGluZSBib29sIGlzX2RzYl9i
dXN5KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKKwkJCSAgICAgICBlbnVtIHBp
cGUgcGlwZSwgZW51bSBkc2JfaWQgaWQpCiB7Ci0Jc3RydWN0IGludGVsX2NydGMgKmNydGMgPSBj
b250YWluZXJfb2YoZHNiLCB0eXBlb2YoKmNydGMpLCBkc2IpOwotCXN0cnVjdCBkcm1faTkxNV9w
cml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoY3J0Yy0+YmFzZS5kZXYpOwotCWVudW0gcGlwZSBw
aXBlID0gY3J0Yy0+cGlwZTsKLQotCXJldHVybiBEU0JfU1RBVFVTICYgaW50ZWxfZGVfcmVhZChk
ZXZfcHJpdiwgRFNCX0NUUkwocGlwZSwgZHNiLT5pZCkpOworCXJldHVybiBEU0JfU1RBVFVTICYg
aW50ZWxfZGVfcmVhZChkZXZfcHJpdiwgRFNCX0NUUkwocGlwZSwgaWQpKTsKIH0KIAotc3RhdGlj
IGJvb2wgaW50ZWxfZHNiX2VuYWJsZV9lbmdpbmUoc3RydWN0IGludGVsX2RzYiAqZHNiKQorc3Rh
dGljIGlubGluZSBib29sIGludGVsX2RzYl9lbmFibGVfZW5naW5lKHN0cnVjdCBkcm1faTkxNV9w
cml2YXRlICpkZXZfcHJpdiwKKwkJCQkJICAgZW51bSBwaXBlIHBpcGUsIGVudW0gZHNiX2lkIGlk
KQogewotCXN0cnVjdCBpbnRlbF9jcnRjICpjcnRjID0gY29udGFpbmVyX29mKGRzYiwgdHlwZW9m
KCpjcnRjKSwgZHNiKTsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19p
OTE1KGNydGMtPmJhc2UuZGV2KTsKLQllbnVtIHBpcGUgcGlwZSA9IGNydGMtPnBpcGU7CiAJdTMy
IGRzYl9jdHJsOwogCi0JZHNiX2N0cmwgPSBpbnRlbF9kZV9yZWFkKGRldl9wcml2LCBEU0JfQ1RS
TChwaXBlLCBkc2ItPmlkKSk7CisJZHNiX2N0cmwgPSBpbnRlbF9kZV9yZWFkKGRldl9wcml2LCBE
U0JfQ1RSTChwaXBlLCBpZCkpOwogCWlmIChEU0JfU1RBVFVTICYgZHNiX2N0cmwpIHsKIAkJZHJt
X2RiZ19rbXMoJmRldl9wcml2LT5kcm0sICJEU0IgZW5naW5lIGlzIGJ1c3kuXG4iKTsKIAkJcmV0
dXJuIGZhbHNlOwogCX0KIAogCWRzYl9jdHJsIHw9IERTQl9FTkFCTEU7Ci0JaW50ZWxfZGVfd3Jp
dGUoZGV2X3ByaXYsIERTQl9DVFJMKHBpcGUsIGRzYi0+aWQpLCBkc2JfY3RybCk7CisJaW50ZWxf
ZGVfd3JpdGUoZGV2X3ByaXYsIERTQl9DVFJMKHBpcGUsIGlkKSwgZHNiX2N0cmwpOwogCi0JaW50
ZWxfZGVfcG9zdGluZ19yZWFkKGRldl9wcml2LCBEU0JfQ1RSTChwaXBlLCBkc2ItPmlkKSk7CisJ
aW50ZWxfZGVfcG9zdGluZ19yZWFkKGRldl9wcml2LCBEU0JfQ1RSTChwaXBlLCBpZCkpOwogCXJl
dHVybiB0cnVlOwogfQogCi1zdGF0aWMgYm9vbCBpbnRlbF9kc2JfZGlzYWJsZV9lbmdpbmUoc3Ry
dWN0IGludGVsX2RzYiAqZHNiKQorc3RhdGljIGlubGluZSBib29sIGludGVsX2RzYl9kaXNhYmxl
X2VuZ2luZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCisJCQkJCSAgICBlbnVt
IHBpcGUgcGlwZSwgZW51bSBkc2JfaWQgaWQpCiB7Ci0Jc3RydWN0IGludGVsX2NydGMgKmNydGMg
PSBjb250YWluZXJfb2YoZHNiLCB0eXBlb2YoKmNydGMpLCBkc2IpOwotCXN0cnVjdCBkcm1faTkx
NV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoY3J0Yy0+YmFzZS5kZXYpOwotCWVudW0gcGlw
ZSBwaXBlID0gY3J0Yy0+cGlwZTsKIAl1MzIgZHNiX2N0cmw7CiAKLQlkc2JfY3RybCA9IGludGVs
X2RlX3JlYWQoZGV2X3ByaXYsIERTQl9DVFJMKHBpcGUsIGRzYi0+aWQpKTsKKwlkc2JfY3RybCA9
IGludGVsX2RlX3JlYWQoZGV2X3ByaXYsIERTQl9DVFJMKHBpcGUsIGlkKSk7CiAJaWYgKERTQl9T
VEFUVVMgJiBkc2JfY3RybCkgewogCQlkcm1fZGJnX2ttcygmZGV2X3ByaXYtPmRybSwgIkRTQiBl
bmdpbmUgaXMgYnVzeS5cbiIpOwogCQlyZXR1cm4gZmFsc2U7CiAJfQogCiAJZHNiX2N0cmwgJj0g
fkRTQl9FTkFCTEU7Ci0JaW50ZWxfZGVfd3JpdGUoZGV2X3ByaXYsIERTQl9DVFJMKHBpcGUsIGRz
Yi0+aWQpLCBkc2JfY3RybCk7CisJaW50ZWxfZGVfd3JpdGUoZGV2X3ByaXYsIERTQl9DVFJMKHBp
cGUsIGlkKSwgZHNiX2N0cmwpOwogCi0JaW50ZWxfZGVfcG9zdGluZ19yZWFkKGRldl9wcml2LCBE
U0JfQ1RSTChwaXBlLCBkc2ItPmlkKSk7CisJaW50ZWxfZGVfcG9zdGluZ19yZWFkKGRldl9wcml2
LCBEU0JfQ1RSTChwaXBlLCBpZCkpOwogCXJldHVybiB0cnVlOwogfQogCi0vKioKLSAqIGludGVs
X2RzYl9nZXQoKSAtIEFsbG9jYXRlIERTQiBjb250ZXh0IGFuZCByZXR1cm4gYSBEU0IgaW5zdGFu
Y2UuCi0gKiBAY3J0YzogaW50ZWxfY3J0YyBzdHJ1Y3R1cmUgdG8gZ2V0IHBpcGUgaW5mby4KLSAq
Ci0gKiBUaGlzIGZ1bmN0aW9uIHByb3ZpZGVzIGhhbmRsZSBvZiBhIERTQiBpbnN0YW5jZSwgZm9y
IHRoZSBmdXJ0aGVyIERTQgotICogb3BlcmF0aW9ucy4KLSAqCi0gKiBSZXR1cm5zOiBhZGRyZXNz
IG9mIEludGVsX2RzYiBpbnN0YW5jZSByZXF1ZXN0ZWQgZm9yLgotICogRmFpbHVyZTogUmV0dXJu
cyB0aGUgc2FtZSBEU0IgaW5zdGFuY2UsIGJ1dCB3aXRob3V0IGEgY29tbWFuZCBidWZmZXIuCi0g
Ki8KLQotc3RydWN0IGludGVsX2RzYiAqCi1pbnRlbF9kc2JfZ2V0KHN0cnVjdCBpbnRlbF9jcnRj
ICpjcnRjKQotewotCXN0cnVjdCBkcm1fZGV2aWNlICpkZXYgPSBjcnRjLT5iYXNlLmRldjsKLQlz
dHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IHRvX2k5MTUoZGV2KTsKLQlzdHJ1Y3QgaW50
ZWxfZHNiICpkc2IgPSAmY3J0Yy0+ZHNiOwotCXN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpv
Ymo7Ci0Jc3RydWN0IGk5MTVfdm1hICp2bWE7Ci0JdTMyICpidWY7Ci0JaW50ZWxfd2FrZXJlZl90
IHdha2VyZWY7Ci0KLQlpZiAoIUhBU19EU0IoaTkxNSkpCi0JCXJldHVybiBkc2I7Ci0KLQlpZiAo
ZHNiLT5yZWZjb3VudCsrICE9IDApCi0JCXJldHVybiBkc2I7Ci0KLQl3YWtlcmVmID0gaW50ZWxf
cnVudGltZV9wbV9nZXQoJmk5MTUtPnJ1bnRpbWVfcG0pOwotCi0Jb2JqID0gaTkxNV9nZW1fb2Jq
ZWN0X2NyZWF0ZV9pbnRlcm5hbChpOTE1LCBEU0JfQlVGX1NJWkUpOwotCWlmIChJU19FUlIob2Jq
KSkgewotCQlkcm1fZXJyKCZpOTE1LT5kcm0sICJHZW0gb2JqZWN0IGNyZWF0aW9uIGZhaWxlZFxu
Iik7Ci0JCWdvdG8gb3V0OwotCX0KLQotCXZtYSA9IGk5MTVfZ2VtX29iamVjdF9nZ3R0X3Bpbihv
YmosIE5VTEwsIDAsIDAsIDApOwotCWlmIChJU19FUlIodm1hKSkgewotCQlkcm1fZXJyKCZpOTE1
LT5kcm0sICJWbWEgY3JlYXRpb24gZmFpbGVkXG4iKTsKLQkJaTkxNV9nZW1fb2JqZWN0X3B1dChv
YmopOwotCQlnb3RvIG91dDsKLQl9Ci0KLQlidWYgPSBpOTE1X2dlbV9vYmplY3RfcGluX21hcCh2
bWEtPm9iaiwgSTkxNV9NQVBfV0MpOwotCWlmIChJU19FUlIoYnVmKSkgewotCQlkcm1fZXJyKCZp
OTE1LT5kcm0sICJDb21tYW5kIGJ1ZmZlciBjcmVhdGlvbiBmYWlsZWRcbiIpOwotCQlnb3RvIG91
dDsKLQl9Ci0KLQlkc2ItPmlkID0gRFNCMTsKLQlkc2ItPnZtYSA9IHZtYTsKLQlkc2ItPmNtZF9i
dWYgPSBidWY7Ci0KLW91dDoKLQkvKgotCSAqIE9uIGVycm9yIGRzYi0+Y21kX2J1ZiB3aWxsIGNv
bnRpbnVlIHRvIGJlIE5VTEwsIG1ha2luZyB0aGUgd3JpdGVzCi0JICogcGFzcy10aHJvdWdoLiBM
ZWF2ZSB0aGUgZGFuZ2xpbmcgcmVmIHRvIGJlIHJlbW92ZWQgbGF0ZXIgYnkgdGhlCi0JICogY29y
cmVzcG9uZGluZyBpbnRlbF9kc2JfcHV0KCk6IHRoZSBpbXBvcnRhbnQgZXJyb3IgbWVzc2FnZSB3
aWxsCi0JICogYWxyZWFkeSBiZSBsb2dnZWQgYWJvdmUuCi0JICovCi0KLQlpbnRlbF9ydW50aW1l
X3BtX3B1dCgmaTkxNS0+cnVudGltZV9wbSwgd2FrZXJlZik7Ci0KLQlyZXR1cm4gZHNiOwotfQot
Ci0vKioKLSAqIGludGVsX2RzYl9wdXQoKSAtIFRvIGRlc3Ryb3kgRFNCIGNvbnRleHQuCi0gKiBA
ZHNiOiBpbnRlbF9kc2Igc3RydWN0dXJlLgotICoKLSAqIFRoaXMgZnVuY3Rpb24gZGVzdHJveXMg
dGhlIERTQiBjb250ZXh0IGFsbG9jYXRlZCBieSBhIGRzYl9nZXQoKSwgYnkKLSAqIHVucGlubmlu
ZyBhbmQgcmVsZWFzaW5nIHRoZSBWTUEgb2JqZWN0IGFzc29jaWF0ZWQgd2l0aCBpdC4KLSAqLwot
Ci12b2lkIGludGVsX2RzYl9wdXQoc3RydWN0IGludGVsX2RzYiAqZHNiKQotewotCXN0cnVjdCBp
bnRlbF9jcnRjICpjcnRjID0gY29udGFpbmVyX29mKGRzYiwgdHlwZW9mKCpjcnRjKSwgZHNiKTsK
LQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IHRvX2k5MTUoY3J0Yy0+YmFzZS5kZXYp
OwotCi0JaWYgKCFIQVNfRFNCKGk5MTUpKQotCQlyZXR1cm47Ci0KLQlpZiAoZHJtX1dBUk5fT04o
Jmk5MTUtPmRybSwgZHNiLT5yZWZjb3VudCA9PSAwKSkKLQkJcmV0dXJuOwotCi0JaWYgKC0tZHNi
LT5yZWZjb3VudCA9PSAwKSB7Ci0JCWk5MTVfdm1hX3VucGluX2FuZF9yZWxlYXNlKCZkc2ItPnZt
YSwgSTkxNV9WTUFfUkVMRUFTRV9NQVApOwotCQlkc2ItPmNtZF9idWYgPSBOVUxMOwotCQlkc2It
PmZyZWVfcG9zID0gMDsKLQkJZHNiLT5pbnNfc3RhcnRfb2Zmc2V0ID0gMDsKLQl9Ci19Ci0KIC8q
KgogICogaW50ZWxfZHNiX2luZGV4ZWRfcmVnX3dyaXRlKCkgLVdyaXRlIHRvIHRoZSBEU0IgY29u
dGV4dCBmb3IgYXV0bwogICogaW5jcmVtZW50IHJlZ2lzdGVyLgotICogQGRzYjogaW50ZWxfZHNi
IHN0cnVjdHVyZS4KKyAqIEBjcnRjX3N0YXRlOiBpbnRlbF9jcnRjX3N0YXRlIHN0cnVjdHVyZQog
ICogQHJlZzogcmVnaXN0ZXIgYWRkcmVzcy4KICAqIEB2YWw6IHZhbHVlLgogICoKQEAgLTE4OSwx
OSArODksMjAgQEAgdm9pZCBpbnRlbF9kc2JfcHV0KHN0cnVjdCBpbnRlbF9kc2IgKmRzYikKICAq
IGlzIGRvbmUgdGhyb3VnaCBtbWlvIHdyaXRlLgogICovCiAKLXZvaWQgaW50ZWxfZHNiX2luZGV4
ZWRfcmVnX3dyaXRlKHN0cnVjdCBpbnRlbF9kc2IgKmRzYiwgaTkxNV9yZWdfdCByZWcsCi0JCQkJ
IHUzMiB2YWwpCit2b2lkIGludGVsX2RzYl9pbmRleGVkX3JlZ193cml0ZShjb25zdCBzdHJ1Y3Qg
aW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSwKKwkJCQkgaTkxNV9yZWdfdCByZWcsIHUzMiB2
YWwpCiB7Ci0Jc3RydWN0IGludGVsX2NydGMgKmNydGMgPSBjb250YWluZXJfb2YoZHNiLCB0eXBl
b2YoKmNydGMpLCBkc2IpOworCXN0cnVjdCBpbnRlbF9kc2IgKmRzYiA9IGNydGNfc3RhdGUtPmRz
YjsKKwlzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YyA9IHRvX2ludGVsX2NydGMoY3J0Y19zdGF0ZS0+
dWFwaS5jcnRjKTsKIAlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1
KGNydGMtPmJhc2UuZGV2KTsKLQl1MzIgKmJ1ZiA9IGRzYi0+Y21kX2J1ZjsKKwl1MzIgKmJ1ZjsK
IAl1MzIgcmVnX3ZhbDsKIAotCWlmICghYnVmKSB7CisJaWYgKCEoZHNiICYmIGRzYi0+Y21kX2J1
ZikpIHsKIAkJaW50ZWxfZGVfd3JpdGUoZGV2X3ByaXYsIHJlZywgdmFsKTsKIAkJcmV0dXJuOwog
CX0KLQorCWJ1ZiA9IGRzYi0+Y21kX2J1ZjsKIAlpZiAoZHJtX1dBUk5fT04oJmRldl9wcml2LT5k
cm0sIGRzYi0+ZnJlZV9wb3MgPj0gRFNCX0JVRl9TSVpFKSkgewogCQlkcm1fZGJnX2ttcygmZGV2
X3ByaXYtPmRybSwgIkRTQiBidWZmZXIgb3ZlcmZsb3dcbiIpOwogCQlyZXR1cm47CkBAIC0yNTYs
NyArMTU3LDcgQEAgdm9pZCBpbnRlbF9kc2JfaW5kZXhlZF9yZWdfd3JpdGUoc3RydWN0IGludGVs
X2RzYiAqZHNiLCBpOTE1X3JlZ190IHJlZywKIC8qKgogICogaW50ZWxfZHNiX3JlZ193cml0ZSgp
IC1Xcml0ZSB0byB0aGUgRFNCIGNvbnRleHQgZm9yIG5vcm1hbAogICogcmVnaXN0ZXIuCi0gKiBA
ZHNiOiBpbnRlbF9kc2Igc3RydWN0dXJlLgorICogQGNydGNfc3RhdGU6IGludGVsX2NydGNfc3Rh
dGUgc3RydWN0dXJlCiAgKiBAcmVnOiByZWdpc3RlciBhZGRyZXNzLgogICogQHZhbDogdmFsdWUu
CiAgKgpAQCAtMjY1LDE3ICsxNjYsMTkgQEAgdm9pZCBpbnRlbF9kc2JfaW5kZXhlZF9yZWdfd3Jp
dGUoc3RydWN0IGludGVsX2RzYiAqZHNiLCBpOTE1X3JlZ190IHJlZywKICAqIGFuZCByZXN0IGFs
bCBlcnJvbmVvdXMgY29uZGl0aW9uIHJlZ2lzdGVyIHByb2dyYW1taW5nIGlzIGRvbmUKICAqIHRo
cm91Z2ggbW1pbyB3cml0ZS4KICAqLwotdm9pZCBpbnRlbF9kc2JfcmVnX3dyaXRlKHN0cnVjdCBp
bnRlbF9kc2IgKmRzYiwgaTkxNV9yZWdfdCByZWcsIHUzMiB2YWwpCit2b2lkIGludGVsX2RzYl9y
ZWdfd3JpdGUoY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUsCisJCQkg
aTkxNV9yZWdfdCByZWcsIHUzMiB2YWwpCiB7Ci0Jc3RydWN0IGludGVsX2NydGMgKmNydGMgPSBj
b250YWluZXJfb2YoZHNiLCB0eXBlb2YoKmNydGMpLCBkc2IpOworCXN0cnVjdCBpbnRlbF9kc2Ig
KmRzYiA9IGNydGNfc3RhdGUtPmRzYjsKKwlzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YyA9IHRvX2lu
dGVsX2NydGMoY3J0Y19zdGF0ZS0+dWFwaS5jcnRjKTsKIAlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0
ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGNydGMtPmJhc2UuZGV2KTsKIAl1MzIgKmJ1ZiA9IGRzYi0+
Y21kX2J1ZjsKIAotCWlmICghYnVmKSB7CisJaWYgKCEoZHNiICYmIGRzYi0+Y21kX2J1ZikpIHsK
IAkJaW50ZWxfZGVfd3JpdGUoZGV2X3ByaXYsIHJlZywgdmFsKTsKIAkJcmV0dXJuOwogCX0KLQor
CWJ1ZiA9IGRzYi0+Y21kX2J1ZjsKIAlpZiAoZHJtX1dBUk5fT04oJmRldl9wcml2LT5kcm0sIGRz
Yi0+ZnJlZV9wb3MgPj0gRFNCX0JVRl9TSVpFKSkgewogCQlkcm1fZGJnX2ttcygmZGV2X3ByaXYt
PmRybSwgIkRTQiBidWZmZXIgb3ZlcmZsb3dcbiIpOwogCQlyZXR1cm47CkBAIC0yOTAsMjYgKzE5
MywyNyBAQCB2b2lkIGludGVsX2RzYl9yZWdfd3JpdGUoc3RydWN0IGludGVsX2RzYiAqZHNiLCBp
OTE1X3JlZ190IHJlZywgdTMyIHZhbCkKIAogLyoqCiAgKiBpbnRlbF9kc2JfY29tbWl0KCkgLSBU
cmlnZ2VyIHdvcmtsb2FkIGV4ZWN1dGlvbiBvZiBEU0IuCi0gKiBAZHNiOiBpbnRlbF9kc2Igc3Ry
dWN0dXJlLgorICogQGNydGNfc3RhdGU6IGludGVsX2NydGNfc3RhdGUgc3RydWN0dXJlCiAgKgog
ICogVGhpcyBmdW5jdGlvbiBpcyB1c2VkIHRvIGRvIGFjdHVhbCB3cml0ZSB0byBoYXJkd2FyZSB1
c2luZyBEU0IuCiAgKiBPbiBlcnJvcnMsIGZhbGwgYmFjayB0byBNTUlPLiBBbHNvIHRoaXMgZnVu
Y3Rpb24gaGVscCB0byByZXNldCB0aGUgY29udGV4dC4KICAqLwotdm9pZCBpbnRlbF9kc2JfY29t
bWl0KHN0cnVjdCBpbnRlbF9kc2IgKmRzYikKK3ZvaWQgaW50ZWxfZHNiX2NvbW1pdChjb25zdCBz
dHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSkKIHsKLQlzdHJ1Y3QgaW50ZWxfY3J0
YyAqY3J0YyA9IGNvbnRhaW5lcl9vZihkc2IsIHR5cGVvZigqY3J0YyksIGRzYik7CisJc3RydWN0
IGludGVsX2RzYiAqZHNiID0gY3J0Y19zdGF0ZS0+ZHNiOworCXN0cnVjdCBpbnRlbF9jcnRjICpj
cnRjID0gdG9faW50ZWxfY3J0YyhjcnRjX3N0YXRlLT51YXBpLmNydGMpOwogCXN0cnVjdCBkcm1f
ZGV2aWNlICpkZXYgPSBjcnRjLT5iYXNlLmRldjsKIAlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAq
ZGV2X3ByaXYgPSB0b19pOTE1KGRldik7CiAJZW51bSBwaXBlIHBpcGUgPSBjcnRjLT5waXBlOwog
CXUzMiB0YWlsOwogCi0JaWYgKCFkc2ItPmZyZWVfcG9zKQorCWlmICghKGRzYiAmJiBkc2ItPmZy
ZWVfcG9zKSkKIAkJcmV0dXJuOwogCi0JaWYgKCFpbnRlbF9kc2JfZW5hYmxlX2VuZ2luZShkc2Ip
KQorCWlmICghaW50ZWxfZHNiX2VuYWJsZV9lbmdpbmUoZGV2X3ByaXYsIHBpcGUsIGRzYi0+aWQp
KQogCQlnb3RvIHJlc2V0OwogCi0JaWYgKGlzX2RzYl9idXN5KGRzYikpIHsKKwlpZiAoaXNfZHNi
X2J1c3koZGV2X3ByaXYsIHBpcGUsIGRzYi0+aWQpKSB7CiAJCWRybV9lcnIoJmRldl9wcml2LT5k
cm0sCiAJCQkiSEVBRF9QVFIgd3JpdGUgZmFpbGVkIC0gZHNiIGVuZ2luZSBpcyBidXN5LlxuIik7
CiAJCWdvdG8gcmVzZXQ7CkBAIC0zMjIsNyArMjI2LDcgQEAgdm9pZCBpbnRlbF9kc2JfY29tbWl0
KHN0cnVjdCBpbnRlbF9kc2IgKmRzYikKIAkJbWVtc2V0KCZkc2ItPmNtZF9idWZbZHNiLT5mcmVl
X3Bvc10sIDAsCiAJCSAgICAgICAodGFpbCAtIGRzYi0+ZnJlZV9wb3MgKiA0KSk7CiAKLQlpZiAo
aXNfZHNiX2J1c3koZHNiKSkgeworCWlmIChpc19kc2JfYnVzeShkZXZfcHJpdiwgcGlwZSwgZHNi
LT5pZCkpIHsKIAkJZHJtX2VycigmZGV2X3ByaXYtPmRybSwKIAkJCSJUQUlMX1BUUiB3cml0ZSBm
YWlsZWQgLSBkc2IgZW5naW5lIGlzIGJ1c3kuXG4iKTsKIAkJZ290byByZXNldDsKQEAgLTMzMiw3
ICsyMzYsNyBAQCB2b2lkIGludGVsX2RzYl9jb21taXQoc3RydWN0IGludGVsX2RzYiAqZHNiKQog
CQkgICAgaTkxNV9nZ3R0X29mZnNldChkc2ItPnZtYSksIHRhaWwpOwogCWludGVsX2RlX3dyaXRl
KGRldl9wcml2LCBEU0JfVEFJTChwaXBlLCBkc2ItPmlkKSwKIAkJICAgICAgIGk5MTVfZ2d0dF9v
ZmZzZXQoZHNiLT52bWEpICsgdGFpbCk7Ci0JaWYgKHdhaXRfZm9yKCFpc19kc2JfYnVzeShkc2Ip
LCAxKSkgeworCWlmICh3YWl0X2ZvcighaXNfZHNiX2J1c3koZGV2X3ByaXYsIHBpcGUsIGRzYi0+
aWQpLCAxKSkgewogCQlkcm1fZXJyKCZkZXZfcHJpdi0+ZHJtLAogCQkJIlRpbWVkIG91dCB3YWl0
aW5nIGZvciBEU0Igd29ya2xvYWQgY29tcGxldGlvbi5cbiIpOwogCQlnb3RvIHJlc2V0OwpAQCAt
MzQxLDUgKzI0NSw4MyBAQCB2b2lkIGludGVsX2RzYl9jb21taXQoc3RydWN0IGludGVsX2RzYiAq
ZHNiKQogcmVzZXQ6CiAJZHNiLT5mcmVlX3BvcyA9IDA7CiAJZHNiLT5pbnNfc3RhcnRfb2Zmc2V0
ID0gMDsKLQlpbnRlbF9kc2JfZGlzYWJsZV9lbmdpbmUoZHNiKTsKKwlpbnRlbF9kc2JfZGlzYWJs
ZV9lbmdpbmUoZGV2X3ByaXYsIHBpcGUsIGRzYi0+aWQpOworfQorCisvKioKKyAqIGludGVsX2Rz
Yl9wcmVwYXJlKCkgLSBBbGxvY2F0ZSwgcGluIGFuZCBtYXAgdGhlIERTQiBjb21tYW5kIGJ1ZmZl
ci4KKyAqIEBjcnRjX3N0YXRlOiBpbnRlbF9jcnRjX3N0YXRlIHN0cnVjdHVyZSB0byBwcmVwYXJl
IGFzc29jaWF0ZWQgZHNiIGluc3RhbmNlLgorICoKKyAqIFRoaXMgZnVuY3Rpb24gcHJlcGFyZSB0
aGUgY29tbWFuZCBidWZmZXIgd2hpY2ggaXMgdXNlZCB0byBzdG9yZSBkc2IKKyAqIGluc3RydWN0
aW9ucyB3aXRoIGRhdGEuCisgKi8KKwordm9pZCBpbnRlbF9kc2JfcHJlcGFyZShzdHJ1Y3QgaW50
ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSkKK3sKKwlzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YyA9
IHRvX2ludGVsX2NydGMoY3J0Y19zdGF0ZS0+dWFwaS5jcnRjKTsKKwlzdHJ1Y3QgZHJtX2k5MTVf
cHJpdmF0ZSAqaTkxNSA9IHRvX2k5MTUoY3J0Yy0+YmFzZS5kZXYpOworCXN0cnVjdCBpbnRlbF9k
c2IgKmRzYjsKKwlzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2JqOworCXN0cnVjdCBpOTE1
X3ZtYSAqdm1hOworCXUzMiAqYnVmOworCWludGVsX3dha2VyZWZfdCB3YWtlcmVmOworCisJaWYg
KCFIQVNfRFNCKGk5MTUpKQorCQlyZXR1cm47CisKKwlkc2IgPSBrbWFsbG9jKHNpemVvZigqZHNi
KSwgR0ZQX0tFUk5FTCk7CisKKwl3YWtlcmVmID0gaW50ZWxfcnVudGltZV9wbV9nZXQoJmk5MTUt
PnJ1bnRpbWVfcG0pOworCisJb2JqID0gaTkxNV9nZW1fb2JqZWN0X2NyZWF0ZV9pbnRlcm5hbChp
OTE1LCBEU0JfQlVGX1NJWkUpOworCWlmIChJU19FUlIob2JqKSkgeworCQlkcm1fZXJyKCZpOTE1
LT5kcm0sICJHZW0gb2JqZWN0IGNyZWF0aW9uIGZhaWxlZFxuIik7CisJCWdvdG8gb3V0OworCX0K
KworCXZtYSA9IGk5MTVfZ2VtX29iamVjdF9nZ3R0X3BpbihvYmosIE5VTEwsIDAsIDAsIDApOwor
CWlmIChJU19FUlIodm1hKSkgeworCQlkcm1fZXJyKCZpOTE1LT5kcm0sICJWbWEgY3JlYXRpb24g
ZmFpbGVkXG4iKTsKKwkJaTkxNV9nZW1fb2JqZWN0X3B1dChvYmopOworCQlnb3RvIG91dDsKKwl9
CisKKwlidWYgPSBpOTE1X2dlbV9vYmplY3RfcGluX21hcCh2bWEtPm9iaiwgSTkxNV9NQVBfV0Mp
OworCWlmIChJU19FUlIoYnVmKSkgeworCQlkcm1fZXJyKCZpOTE1LT5kcm0sICJDb21tYW5kIGJ1
ZmZlciBjcmVhdGlvbiBmYWlsZWRcbiIpOworCQlnb3RvIG91dDsKKwl9CisKKwlkc2ItPmlkID0g
RFNCMTsKKwlkc2ItPnZtYSA9IHZtYTsKKwlkc2ItPmNtZF9idWYgPSBidWY7CisJZHNiLT5mcmVl
X3BvcyA9IDA7CisJZHNiLT5pbnNfc3RhcnRfb2Zmc2V0ID0gMDsKKwljcnRjX3N0YXRlLT5kc2Ig
PSBkc2I7CitvdXQ6CisJLyoKKwkgKiBPbiBlcnJvciBkc2ItPmNtZF9idWYgd2lsbCBjb250aW51
ZSB0byBiZSBOVUxMLCBtYWtpbmcgdGhlIHdyaXRlcworCSAqIHBhc3MtdGhyb3VnaC4gTGVhdmUg
dGhlIGRhbmdsaW5nIHJlZiB0byBiZSByZW1vdmVkIGxhdGVyIGJ5IHRoZQorCSAqIGNvcnJlc3Bv
bmRpbmcgaW50ZWxfZHNiX3B1dCgpOiB0aGUgaW1wb3J0YW50IGVycm9yIG1lc3NhZ2Ugd2lsbAor
CSAqIGFscmVhZHkgYmUgbG9nZ2VkIGFib3ZlLgorCSAqLworCisJaW50ZWxfcnVudGltZV9wbV9w
dXQoJmk5MTUtPnJ1bnRpbWVfcG0sIHdha2VyZWYpOworfQorCisvKioKKyAqIGludGVsX2RzYl9j
bGVhbnVwKCkgLSBUbyBjbGVhbnVwIERTQiBjb250ZXh0LgorICogQGNydGNfc3RhdGU6IGludGVs
X2NydGNfc3RhdGUgc3RydWN0dXJlIHRvIGNsZWFudXAgYXNzb2NpYXRlZCBkc2IgaW5zdGFuY2Uu
CisgKgorICogVGhpcyBmdW5jdGlvbiBjbGVhbnVwIHRoZSBEU0IgY29udGV4dCBieSB1bnBpbm5p
bmcgYW5kIHJlbGVhc2luZworICogdGhlIFZNQSBvYmplY3QgYXNzb2NpYXRlZCB3aXRoIGl0Lgor
ICovCisKK3ZvaWQgaW50ZWxfZHNiX2NsZWFudXAoc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNy
dGNfc3RhdGUpCit7CisJaWYgKGNydGNfc3RhdGUgJiYgY3J0Y19zdGF0ZS0+ZHNiKSB7CisJCWk5
MTVfdm1hX3VucGluX2FuZF9yZWxlYXNlKCZjcnRjX3N0YXRlLT5kc2ItPnZtYSwKKwkJCQkJICAg
STkxNV9WTUFfUkVMRUFTRV9NQVApOworCQlrZnJlZShjcnRjX3N0YXRlLT5kc2IpOworCX0KIH0K
ZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZHNiLmggYi9k
cml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2RzYi5oCmluZGV4IDM5NWVmOWNlNTU4
ZS4uNjU0YTExZjI0YjgwIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5
L2ludGVsX2RzYi5oCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZHNi
LmgKQEAgLTEwLDcgKzEwLDcgQEAKIAogI2luY2x1ZGUgImk5MTVfcmVnLmgiCiAKLXN0cnVjdCBp
bnRlbF9jcnRjOworc3RydWN0IGludGVsX2NydGNfc3RhdGU7CiBzdHJ1Y3QgaTkxNV92bWE7CiAK
IGVudW0gZHNiX2lkIHsKQEAgLTIyLDcgKzIyLDYgQEAgZW51bSBkc2JfaWQgewogfTsKIAogc3Ry
dWN0IGludGVsX2RzYiB7Ci0JbG9uZyByZWZjb3VudDsKIAllbnVtIGRzYl9pZCBpZDsKIAl1MzIg
KmNtZF9idWY7CiAJc3RydWN0IGk5MTVfdm1hICp2bWE7CkBAIC00MSwxMiArNDAsMTIgQEAgc3Ry
dWN0IGludGVsX2RzYiB7CiAJdTMyIGluc19zdGFydF9vZmZzZXQ7CiB9OwogCi1zdHJ1Y3QgaW50
ZWxfZHNiICoKLWludGVsX2RzYl9nZXQoc3RydWN0IGludGVsX2NydGMgKmNydGMpOwotdm9pZCBp
bnRlbF9kc2JfcHV0KHN0cnVjdCBpbnRlbF9kc2IgKmRzYik7Ci12b2lkIGludGVsX2RzYl9yZWdf
d3JpdGUoc3RydWN0IGludGVsX2RzYiAqZHNiLCBpOTE1X3JlZ190IHJlZywgdTMyIHZhbCk7Ci12
b2lkIGludGVsX2RzYl9pbmRleGVkX3JlZ193cml0ZShzdHJ1Y3QgaW50ZWxfZHNiICpkc2IsIGk5
MTVfcmVnX3QgcmVnLAotCQkJCSB1MzIgdmFsKTsKLXZvaWQgaW50ZWxfZHNiX2NvbW1pdChzdHJ1
Y3QgaW50ZWxfZHNiICpkc2IpOwordm9pZCBpbnRlbF9kc2JfcHJlcGFyZShzdHJ1Y3QgaW50ZWxf
Y3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSk7Cit2b2lkIGludGVsX2RzYl9jbGVhbnVwKHN0cnVjdCBp
bnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlKTsKK3ZvaWQgaW50ZWxfZHNiX3JlZ193cml0ZShj
b25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSwKKwkJCSBpOTE1X3JlZ190
IHJlZywgdTMyIHZhbCk7Cit2b2lkIGludGVsX2RzYl9pbmRleGVkX3JlZ193cml0ZShjb25zdCBz
dHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSwKKwkJCQkgaTkxNV9yZWdfdCByZWcs
IHUzMiB2YWwpOwordm9pZCBpbnRlbF9kc2JfY29tbWl0KGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRj
X3N0YXRlICpjcnRjX3N0YXRlKTsKIAogI2VuZGlmCi0tIAoyLjI2LjAKCl9fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fCkludGVsLWdmeCBtYWlsaW5nIGxpc3QK
SW50ZWwtZ2Z4QGxpc3RzLmZyZWVkZXNrdG9wLm9yZwpodHRwczovL2xpc3RzLmZyZWVkZXNrdG9w
Lm9yZy9tYWlsbWFuL2xpc3RpbmZvL2ludGVsLWdmeAo=

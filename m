Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id AD7AF26C593
	for <lists+intel-gfx@lfdr.de>; Wed, 16 Sep 2020 19:08:17 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 7F5AD6EA77;
	Wed, 16 Sep 2020 17:08:12 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from mga14.intel.com (mga14.intel.com [192.55.52.115])
 by gabe.freedesktop.org (Postfix) with ESMTPS id D67456EA75
 for <intel-gfx@lists.freedesktop.org>; Wed, 16 Sep 2020 17:08:10 +0000 (UTC)
IronPort-SDR: gkDG2CpPuq4W/nvkQJGyziqUgwhFLrgglYjFPOvWuMKecHTyl+dpVvF8Xs7pYKLy7GcqRbiv2B
 MJIjLT8TTTRw==
X-IronPort-AV: E=McAfee;i="6000,8403,9746"; a="158818288"
X-IronPort-AV: E=Sophos;i="5.76,433,1592895600"; d="scan'208";a="158818288"
X-Amp-Result: SKIPPED(no attachment in message)
X-Amp-File-Uploaded: False
Received: from fmsmga006.fm.intel.com ([10.253.24.20])
 by fmsmga103.fm.intel.com with ESMTP/TLS/ECDHE-RSA-AES256-GCM-SHA384;
 16 Sep 2020 10:08:10 -0700
IronPort-SDR: Lllglr2YyPB4UNhvsUJslBVhZ1Mie/JW+K2xCUAPUajKbpqc1yVF2+BDz2uIz4G21EGpe5+9Yn
 1FujQyKbnJBw==
X-IronPort-AV: E=Sophos;i="5.76,433,1592895600"; d="scan'208";a="507238860"
Received: from gottipat-mobl.amr.corp.intel.com (HELO
 josouza-MOBL2.amr.corp.intel.com) ([10.251.129.32])
 by fmsmga006-auth.fm.intel.com with ESMTP/TLS/ECDHE-RSA-AES256-GCM-SHA384;
 16 Sep 2020 10:08:10 -0700
From: =?UTF-8?q?Jos=C3=A9=20Roberto=20de=20Souza?= <jose.souza@intel.com>
To: intel-gfx@lists.freedesktop.org
Date: Wed, 16 Sep 2020 10:11:04 -0700
Message-Id: <20200916171105.23471-2-jose.souza@intel.com>
X-Mailer: git-send-email 2.28.0
In-Reply-To: <20200916171105.23471-1-jose.souza@intel.com>
References: <20200916171105.23471-1-jose.souza@intel.com>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH v2 2/3] drm/i915/display: Check PSR parameter
 and flag only in state compute phase
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.29
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

RHVlIHRvIHRoZSBkZWJ1Z2ZzIGZsYWcsIGhhc19wc3IyIGluIENSVEMgc3RhdGUgY291bGQgaGF2
ZSBhIGRpZmZlcmVudAp2YWx1ZSB0aGFuIHBzci5wc3IyX2VuYWJsZWQgYW5kIGl0IHdhcyBjYXVz
aW5nIFBTUjIgc3ViZmVhdHVyZXMoREMzQ08KYW5kIHNlbGVjdGl2ZSBmZXRjaCkgdG8gYmUgc2V0
IHRvIG5vdCBhIGV4cGVjdGVkIHN0YXRlLgoKU28gaGVyZSBvbmx5IHRha2luZyBpbiBjb25zaWRl
cmF0aW9uIHRoZSBwYXJhbWV0ZXIgYW5kIGRlYnVnZnMgZmxhZwp3aGVuIGNvbXB1dGluZyBQU1Ig
c3RhdGUsIHRoaXMgd2F5IHRoZSBDUlRDIHN0YXRlIHdpbGwgYWxzbyBoYXZlCnRoZSBjb3JyZWN0
IHN0YXRlLgoKaW50ZWxfcHNyX2Zhc3RzZXRfZm9yY2UoKSB3YXMgYWxyZWFkeSBicm9rZW4gYXMK
aW50ZWxfcHNyX2NvbXB1dGVfY29uZmlnKCkgd2FzIGFscmVhZHkgb25seSBlbmFibGluZyBQU1Ig
d2hlbgpwc3JfZ2xvYmFsX2VuYWJsZWQoKSBhbmQgYWxsIG90aGVyIFBTUiByZXF1aXJlbWVudHMg
YXJlIG1ldC4KU28gc29tZSBjaGFuZ2VzIHdhcyByZXF1aXJlZCBpbiB0aGlzIGZ1bmN0aW9uLCBu
b3cgaXQgaXRlcmF0ZXMgb3ZlcgphbGwgY29ubmVjdG9ycywgaWYgaXQgaXMgYSBlRFAgY29ubmVj
dG9yIGFuZCBpcyBhY3RpdmUgZm9yY2UgYSBtb2Rlc2V0CmluIHRoZSBDUlRDIGRyaXZpbmcgdGhp
cyBjb25uZWN0b3IsIHdoYXQgd2lsbCBjYXVzZSB0aGUgbmV3IFBTUiBzdGF0ZQp0byBiZSBzZXQg
YmFzZWQgb24gdGhlIGRlYnVnZnMgZmxhZy4KCnYyOgotIGVuZCBjb25uZWN0b3IgaXRlcmF0b3Ig
aW4gZXJyb3IgY2FzZXMKCkNjOiBHd2FuLWd5ZW9uZyBNdW4gPGd3YW4tZ3llb25nLm11bkBpbnRl
bC5jb20+CkNjOiBWaWxsZSBTeXJqw6Rsw6QgPHZpbGxlLnN5cmphbGFAbGludXguaW50ZWwuY29t
PgpTaWduZWQtb2ZmLWJ5OiBKb3PDqSBSb2JlcnRvIGRlIFNvdXphIDxqb3NlLnNvdXphQGludGVs
LmNvbT4KLS0tCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX3Bzci5jIHwgNzMg
KysrKysrKysrKysrKy0tLS0tLS0tLS0tCiAxIGZpbGUgY2hhbmdlZCwgNDEgaW5zZXJ0aW9ucygr
KSwgMzIgZGVsZXRpb25zKC0pCgpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlz
cGxheS9pbnRlbF9wc3IuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfcHNy
LmMKaW5kZXggNGUwOWFlNjFkNGFhLi4wMmY3NGIwZGRlYzEgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMv
Z3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfcHNyLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5
MTUvZGlzcGxheS9pbnRlbF9wc3IuYwpAQCAtOTEsMTkgKzkxLDE0IEBAIHN0YXRpYyBib29sIHBz
cl9nbG9iYWxfZW5hYmxlZChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkKIAl9CiB9CiAK
LXN0YXRpYyBib29sIGludGVsX3BzcjJfZW5hYmxlZChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAq
ZGV2X3ByaXYsCi0JCQkgICAgICAgY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNf
c3RhdGUpCitzdGF0aWMgYm9vbCBwc3IyX2dsb2JhbF9lbmFibGVkKHN0cnVjdCBkcm1faTkxNV9w
cml2YXRlICpkZXZfcHJpdikKIHsKLQkvKiBDYW5ub3QgZW5hYmxlIERTQyBhbmQgUFNSMiBzaW11
bHRhbmVvdXNseSAqLwotCWRybV9XQVJOX09OKCZkZXZfcHJpdi0+ZHJtLCBjcnRjX3N0YXRlLT5k
c2MuY29tcHJlc3Npb25fZW5hYmxlICYmCi0JCSAgICBjcnRjX3N0YXRlLT5oYXNfcHNyMik7Ci0K
IAlzd2l0Y2ggKGRldl9wcml2LT5wc3IuZGVidWcgJiBJOTE1X1BTUl9ERUJVR19NT0RFX01BU0sp
IHsKIAljYXNlIEk5MTVfUFNSX0RFQlVHX0RJU0FCTEU6CiAJY2FzZSBJOTE1X1BTUl9ERUJVR19G
T1JDRV9QU1IxOgogCQlyZXR1cm4gZmFsc2U7CiAJZGVmYXVsdDoKLQkJcmV0dXJuIGNydGNfc3Rh
dGUtPmhhc19wc3IyOworCQlyZXR1cm4gdHJ1ZTsKIAl9CiB9CiAKQEAgLTcyOSw2ICs3MjQsMTEg
QEAgc3RhdGljIGJvb2wgaW50ZWxfcHNyMl9jb25maWdfdmFsaWQoc3RydWN0IGludGVsX2RwICpp
bnRlbF9kcCwKIAkJcmV0dXJuIGZhbHNlOwogCX0KIAorCWlmICghcHNyMl9nbG9iYWxfZW5hYmxl
ZChkZXZfcHJpdikpIHsKKwkJZHJtX2RiZ19rbXMoJmRldl9wcml2LT5kcm0sICJQU1IyIGRpc2Fi
bGVkIGJ5IGZsYWdcbiIpOworCQlyZXR1cm4gZmFsc2U7CisJfQorCiAJLyoKIAkgKiBEU0MgYW5k
IFBTUjIgY2Fubm90IGJlIGVuYWJsZWQgc2ltdWx0YW5lb3VzbHkuIElmIGEgcmVxdWVzdGVkCiAJ
ICogcmVzb2x1dGlvbiByZXF1aXJlcyBEU0MgdG8gYmUgZW5hYmxlZCwgcHJpb3JpdHkgaXMgZ2l2
ZW4gdG8gRFNDCkBAIC04MTcsOCArODE3LDExIEBAIHZvaWQgaW50ZWxfcHNyX2NvbXB1dGVfY29u
ZmlnKHN0cnVjdCBpbnRlbF9kcCAqaW50ZWxfZHAsCiAJaWYgKGludGVsX2RwICE9IGRldl9wcml2
LT5wc3IuZHApCiAJCXJldHVybjsKIAotCWlmICghcHNyX2dsb2JhbF9lbmFibGVkKGRldl9wcml2
KSkKKwlpZiAoIXBzcl9nbG9iYWxfZW5hYmxlZChkZXZfcHJpdikpIHsKKwkJZHJtX2RiZ19rbXMo
JmRldl9wcml2LT5kcm0sICJQU1IgZGlzYWJsZWQgYnkgZmxhZ1xuIik7CiAJCXJldHVybjsKKwl9
CisKIAkvKgogCSAqIEhTVyBzcGVjIGV4cGxpY2l0bHkgc2F5cyBQU1IgaXMgdGllZCB0byBwb3J0
IEEuCiAJICogQkRXKyBwbGF0Zm9ybXMgaGF2ZSBhIGluc3RhbmNlIG9mIFBTUiByZWdpc3RlcnMg
cGVyIHRyYW5zY29kZXIgYnV0CkBAIC05NTksNyArOTYyLDcgQEAgc3RhdGljIHZvaWQgaW50ZWxf
cHNyX2VuYWJsZV9sb2NrZWQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAogCiAJ
ZHJtX1dBUk5fT04oJmRldl9wcml2LT5kcm0sIGRldl9wcml2LT5wc3IuZW5hYmxlZCk7CiAKLQlk
ZXZfcHJpdi0+cHNyLnBzcjJfZW5hYmxlZCA9IGludGVsX3BzcjJfZW5hYmxlZChkZXZfcHJpdiwg
Y3J0Y19zdGF0ZSk7CisJZGV2X3ByaXYtPnBzci5wc3IyX2VuYWJsZWQgPSBjcnRjX3N0YXRlLT5o
YXNfcHNyMjsKIAlkZXZfcHJpdi0+cHNyLmJ1c3lfZnJvbnRidWZmZXJfYml0cyA9IDA7CiAJZGV2
X3ByaXYtPnBzci5waXBlID0gdG9faW50ZWxfY3J0YyhjcnRjX3N0YXRlLT51YXBpLmNydGMpLT5w
aXBlOwogCWRldl9wcml2LT5wc3IuZGMzY29fZW5hYmxlZCA9ICEhY3J0Y19zdGF0ZS0+ZGMzY29f
ZXhpdGxpbmU7CkBAIC0xMDI5LDE1ICsxMDMyLDcgQEAgdm9pZCBpbnRlbF9wc3JfZW5hYmxlKHN0
cnVjdCBpbnRlbF9kcCAqaW50ZWxfZHAsCiAJZHJtX1dBUk5fT04oJmRldl9wcml2LT5kcm0sIGRl
dl9wcml2LT5kcnJzLmRwKTsKIAogCW11dGV4X2xvY2soJmRldl9wcml2LT5wc3IubG9jayk7Ci0K
LQlpZiAoIXBzcl9nbG9iYWxfZW5hYmxlZChkZXZfcHJpdikpIHsKLQkJZHJtX2RiZ19rbXMoJmRl
dl9wcml2LT5kcm0sICJQU1IgZGlzYWJsZWQgYnkgZmxhZ1xuIik7Ci0JCWdvdG8gdW5sb2NrOwot
CX0KLQogCWludGVsX3Bzcl9lbmFibGVfbG9ja2VkKGRldl9wcml2LCBjcnRjX3N0YXRlLCBjb25u
X3N0YXRlKTsKLQotdW5sb2NrOgogCW11dGV4X3VubG9jaygmZGV2X3ByaXYtPnBzci5sb2NrKTsK
IH0KIApAQCAtMTIyMiw4ICsxMjE3LDggQEAgdm9pZCBpbnRlbF9wc3JfdXBkYXRlKHN0cnVjdCBp
bnRlbF9kcCAqaW50ZWxfZHAsCiAKIAltdXRleF9sb2NrKCZkZXZfcHJpdi0+cHNyLmxvY2spOwog
Ci0JZW5hYmxlID0gY3J0Y19zdGF0ZS0+aGFzX3BzciAmJiBwc3JfZ2xvYmFsX2VuYWJsZWQoZGV2
X3ByaXYpOwotCXBzcjJfZW5hYmxlID0gaW50ZWxfcHNyMl9lbmFibGVkKGRldl9wcml2LCBjcnRj
X3N0YXRlKTsKKwllbmFibGUgPSBjcnRjX3N0YXRlLT5oYXNfcHNyOworCXBzcjJfZW5hYmxlID0g
Y3J0Y19zdGF0ZS0+aGFzX3BzcjI7CiAKIAlpZiAoZW5hYmxlID09IHBzci0+ZW5hYmxlZCAmJiBw
c3IyX2VuYWJsZSA9PSBwc3ItPnBzcjJfZW5hYmxlZCkgewogCQkvKiBGb3JjZSBhIFBTUiBleGl0
IHdoZW4gZW5hYmxpbmcgQ1JDIHRvIGF2b2lkIENSQyB0aW1lb3V0cyAqLwpAQCAtMTMyMCwxMSAr
MTMxNSwxMiBAQCBzdGF0aWMgYm9vbCBfX3Bzcl93YWl0X2Zvcl9pZGxlX2xvY2tlZChzdHJ1Y3Qg
ZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCiAKIHN0YXRpYyBpbnQgaW50ZWxfcHNyX2Zhc3Rz
ZXRfZm9yY2Uoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQogeworCXN0cnVjdCBk
cm1fY29ubmVjdG9yX2xpc3RfaXRlciBjb25uX2l0ZXI7CiAJc3RydWN0IGRybV9kZXZpY2UgKmRl
diA9ICZkZXZfcHJpdi0+ZHJtOwogCXN0cnVjdCBkcm1fbW9kZXNldF9hY3F1aXJlX2N0eCBjdHg7
CiAJc3RydWN0IGRybV9hdG9taWNfc3RhdGUgKnN0YXRlOwotCXN0cnVjdCBpbnRlbF9jcnRjICpj
cnRjOwotCWludCBlcnI7CisJc3RydWN0IGRybV9jb25uZWN0b3IgKmNvbm47CisJaW50IGVyciA9
IDA7CiAKIAlzdGF0ZSA9IGRybV9hdG9taWNfc3RhdGVfYWxsb2MoZGV2KTsKIAlpZiAoIXN0YXRl
KQpAQCAtMTMzNCwyNSArMTMzMCwzOCBAQCBzdGF0aWMgaW50IGludGVsX3Bzcl9mYXN0c2V0X2Zv
cmNlKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikKIAlzdGF0ZS0+YWNxdWlyZV9j
dHggPSAmY3R4OwogCiByZXRyeToKLQlmb3JfZWFjaF9pbnRlbF9jcnRjKGRldiwgY3J0Yykgewot
CQlzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSA9Ci0JCQlpbnRlbF9hdG9taWNf
Z2V0X2NydGNfc3RhdGUoc3RhdGUsIGNydGMpOwogCi0JCWlmIChJU19FUlIoY3J0Y19zdGF0ZSkp
IHsKLQkJCWVyciA9IFBUUl9FUlIoY3J0Y19zdGF0ZSk7Ci0JCQlnb3RvIGVycm9yOworCWRybV9j
b25uZWN0b3JfbGlzdF9pdGVyX2JlZ2luKGRldiwgJmNvbm5faXRlcik7CisJZHJtX2Zvcl9lYWNo
X2Nvbm5lY3Rvcl9pdGVyKGNvbm4sICZjb25uX2l0ZXIpIHsKKwkJc3RydWN0IGRybV9jb25uZWN0
b3Jfc3RhdGUgKmNvbm5fc3RhdGU7CisJCXN0cnVjdCBkcm1fY3J0Y19zdGF0ZSAqY3J0Y19zdGF0
ZTsKKworCQlpZiAoY29ubi0+Y29ubmVjdG9yX3R5cGUgIT0gRFJNX01PREVfQ09OTkVDVE9SX2VE
UCkKKwkJCWNvbnRpbnVlOworCisJCWNvbm5fc3RhdGUgPSBkcm1fYXRvbWljX2dldF9jb25uZWN0
b3Jfc3RhdGUoc3RhdGUsIGNvbm4pOworCQlpZiAoSVNfRVJSKGNvbm5fc3RhdGUpKSB7CisJCQll
cnIgPSBQVFJfRVJSKGNvbm5fc3RhdGUpOworCQkJYnJlYWs7CiAJCX0KIAotCQlpZiAoY3J0Y19z
dGF0ZS0+aHcuYWN0aXZlICYmIGNydGNfc3RhdGUtPmhhc19wc3IpIHsKLQkJCS8qIE1hcmsgbW9k
ZSBhcyBjaGFuZ2VkIHRvIHRyaWdnZXIgYSBwaXBlLT51cGRhdGUoKSAqLwotCQkJY3J0Y19zdGF0
ZS0+dWFwaS5tb2RlX2NoYW5nZWQgPSB0cnVlOworCQlpZiAoIWNvbm5fc3RhdGUtPmNydGMpCisJ
CQljb250aW51ZTsKKworCQljcnRjX3N0YXRlID0gZHJtX2F0b21pY19nZXRfY3J0Y19zdGF0ZShz
dGF0ZSwgY29ubl9zdGF0ZS0+Y3J0Yyk7CisJCWlmIChJU19FUlIoY3J0Y19zdGF0ZSkpIHsKKwkJ
CWVyciA9IFBUUl9FUlIoY3J0Y19zdGF0ZSk7CiAJCQlicmVhazsKIAkJfQorCisJCS8qIE1hcmsg
bW9kZSBhcyBjaGFuZ2VkIHRvIHRyaWdnZXIgYSBwaXBlLT51cGRhdGUoKSAqLworCQljcnRjX3N0
YXRlLT5tb2RlX2NoYW5nZWQgPSB0cnVlOwogCX0KKwlkcm1fY29ubmVjdG9yX2xpc3RfaXRlcl9l
bmQoJmNvbm5faXRlcik7CiAKLQllcnIgPSBkcm1fYXRvbWljX2NvbW1pdChzdGF0ZSk7CisJaWYg
KGVyciA9PSAwKQorCQllcnIgPSBkcm1fYXRvbWljX2NvbW1pdChzdGF0ZSk7CiAKLWVycm9yOgog
CWlmIChlcnIgPT0gLUVERUFETEspIHsKIAkJZHJtX2F0b21pY19zdGF0ZV9jbGVhcihzdGF0ZSk7
CiAJCWVyciA9IGRybV9tb2Rlc2V0X2JhY2tvZmYoJmN0eCk7Ci0tIAoyLjI4LjAKCl9fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fCkludGVsLWdmeCBtYWlsaW5n
IGxpc3QKSW50ZWwtZ2Z4QGxpc3RzLmZyZWVkZXNrdG9wLm9yZwpodHRwczovL2xpc3RzLmZyZWVk
ZXNrdG9wLm9yZy9tYWlsbWFuL2xpc3RpbmZvL2ludGVsLWdmeAo=

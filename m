Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 3816C2E0C0A
	for <lists+intel-gfx@lfdr.de>; Tue, 22 Dec 2020 15:51:11 +0100 (CET)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 956EF6E879;
	Tue, 22 Dec 2020 14:51:09 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from mga18.intel.com (mga18.intel.com [134.134.136.126])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 7AA326E879
 for <intel-gfx@lists.freedesktop.org>; Tue, 22 Dec 2020 14:51:08 +0000 (UTC)
IronPort-SDR: FDAle/Q6jGpKfDq2L5zU2PaOjBG9+U+h8SVzbaDNz3g7Y51HJlScvL086e69n47EydK3Z4hE7u
 KzjgZ5RIVsoQ==
X-IronPort-AV: E=McAfee;i="6000,8403,9842"; a="163596358"
X-IronPort-AV: E=Sophos;i="5.78,438,1599548400"; d="scan'208";a="163596358"
Received: from fmsmga002.fm.intel.com ([10.253.24.26])
 by orsmga106.jf.intel.com with ESMTP/TLS/ECDHE-RSA-AES256-GCM-SHA384;
 22 Dec 2020 06:51:07 -0800
IronPort-SDR: SqNhyD9HL7HyOruQ6b00YIj4zp1ByrUSrJqLKZXD1KwBcf7lCei5wWNKqv6gJPf1xSDmZrU5lj
 kpgDLfXf4gbw==
X-IronPort-AV: E=Sophos;i="5.78,439,1599548400"; d="scan'208";a="392351870"
Received: from sauterhx-mobl1.ger.corp.intel.com (HELO localhost)
 ([10.252.59.229])
 by fmsmga002-auth.fm.intel.com with ESMTP/TLS/ECDHE-RSA-AES256-GCM-SHA384;
 22 Dec 2020 06:51:05 -0800
From: Jani Nikula <jani.nikula@intel.com>
To: intel-gfx@lists.freedesktop.org
Date: Tue, 22 Dec 2020 16:49:53 +0200
Message-Id: <59e20745ffd777210a537cec8e0af51ec42fb9c5.1608648128.git.jani.nikula@intel.com>
X-Mailer: git-send-email 2.20.1
In-Reply-To: <cover.1608648128.git.jani.nikula@intel.com>
References: <cover.1608648128.git.jani.nikula@intel.com>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH 13/13] drm/i915/dp: split out aux functionality
 to intel_dp_aux.c
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.29
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Cc: jani.nikula@intel.com
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

U3BsaXQgb3V0IHRoZSBEUCBhdXggZnVuY3Rpb25hbGl0eSB0byBhIG5ldyBpbnRlbF9kcF9hdXgu
W2NoXS4gVGhpcyBpcyBhCnN1cnByaXNpbmdseSBjbGVhbiBjdXQuCgpTaWduZWQtb2ZmLWJ5OiBK
YW5pIE5pa3VsYSA8amFuaS5uaWt1bGFAaW50ZWwuY29tPgotLS0KIGRyaXZlcnMvZ3B1L2RybS9p
OTE1L01ha2VmaWxlICAgICAgICAgICAgICAgfCAgIDEgKwogZHJpdmVycy9ncHUvZHJtL2k5MTUv
ZGlzcGxheS9pbnRlbF9kcC5jICAgICB8IDY3NiArLS0tLS0tLS0tLS0tLS0tLS0tCiBkcml2ZXJz
L2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2RwX2F1eC5jIHwgNjgzICsrKysrKysrKysrKysr
KysrKysrCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2RwX2F1eC5oIHwgIDE4
ICsKIDQgZmlsZXMgY2hhbmdlZCwgNzAzIGluc2VydGlvbnMoKyksIDY3NSBkZWxldGlvbnMoLSkK
IGNyZWF0ZSBtb2RlIDEwMDY0NCBkcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2Rw
X2F1eC5jCiBjcmVhdGUgbW9kZSAxMDA2NDQgZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9p
bnRlbF9kcF9hdXguaAoKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L01ha2VmaWxl
IGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvTWFrZWZpbGUKaW5kZXggMWUyNjkwMmE4NmU1Li5jNWNh
ZmFlYTc1MjcgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L01ha2VmaWxlCisrKyBi
L2RyaXZlcnMvZ3B1L2RybS9pOTE1L01ha2VmaWxlCkBAIC0yMzcsNiArMjM3LDcgQEAgaTkxNS15
ICs9IFwKIAlkaXNwbGF5L2ludGVsX2NydC5vIFwKIAlkaXNwbGF5L2ludGVsX2RkaS5vIFwKIAlk
aXNwbGF5L2ludGVsX2RwLm8gXAorCWRpc3BsYXkvaW50ZWxfZHBfYXV4Lm8gXAogCWRpc3BsYXkv
aW50ZWxfZHBfYXV4X2JhY2tsaWdodC5vIFwKIAlkaXNwbGF5L2ludGVsX2RwX2hkY3AubyBcCiAJ
ZGlzcGxheS9pbnRlbF9kcF9saW5rX3RyYWluaW5nLm8gXApkaWZmIC0tZ2l0IGEvZHJpdmVycy9n
cHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kcC5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlz
cGxheS9pbnRlbF9kcC5jCmluZGV4IGM0OWFkYTMxMzYzYi4uODZjYjc2NzFlYmY0IDEwMDY0NAot
LS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2RwLmMKKysrIGIvZHJpdmVy
cy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kcC5jCkBAIC00MSwxMyArNDEsMTMgQEAKIAog
I2luY2x1ZGUgImk5MTVfZGVidWdmcy5oIgogI2luY2x1ZGUgImk5MTVfZHJ2LmgiCi0jaW5jbHVk
ZSAiaTkxNV90cmFjZS5oIgogI2luY2x1ZGUgImludGVsX2F0b21pYy5oIgogI2luY2x1ZGUgImlu
dGVsX2F1ZGlvLmgiCiAjaW5jbHVkZSAiaW50ZWxfY29ubmVjdG9yLmgiCiAjaW5jbHVkZSAiaW50
ZWxfZGRpLmgiCiAjaW5jbHVkZSAiaW50ZWxfZGlzcGxheV90eXBlcy5oIgogI2luY2x1ZGUgImlu
dGVsX2RwLmgiCisjaW5jbHVkZSAiaW50ZWxfZHBfYXV4LmgiCiAjaW5jbHVkZSAiaW50ZWxfZHBf
bGlua190cmFpbmluZy5oIgogI2luY2x1ZGUgImludGVsX2RwX21zdC5oIgogI2luY2x1ZGUgImlu
dGVsX2RwaW9fcGh5LmgiCkBAIC04MzMsNjgwICs4MzMsNiBAQCBpbnRlbF9kcF9tb2RlX3ZhbGlk
KHN0cnVjdCBkcm1fY29ubmVjdG9yICpjb25uZWN0b3IsCiAJcmV0dXJuIGludGVsX21vZGVfdmFs
aWRfbWF4X3BsYW5lX3NpemUoZGV2X3ByaXYsIG1vZGUsIGJpZ2pvaW5lcik7CiB9CiAKLXUzMiBp
bnRlbF9kcF9wYWNrX2F1eChjb25zdCB1OCAqc3JjLCBpbnQgc3JjX2J5dGVzKQotewotCWludCBp
OwotCXUzMiB2ID0gMDsKLQotCWlmIChzcmNfYnl0ZXMgPiA0KQotCQlzcmNfYnl0ZXMgPSA0Owot
CWZvciAoaSA9IDA7IGkgPCBzcmNfYnl0ZXM7IGkrKykKLQkJdiB8PSAoKHUzMilzcmNbaV0pIDw8
ICgoMyAtIGkpICogOCk7Ci0JcmV0dXJuIHY7Ci19Ci0KLXN0YXRpYyB2b2lkIGludGVsX2RwX3Vu
cGFja19hdXgodTMyIHNyYywgdTggKmRzdCwgaW50IGRzdF9ieXRlcykKLXsKLQlpbnQgaTsKLQlp
ZiAoZHN0X2J5dGVzID4gNCkKLQkJZHN0X2J5dGVzID0gNDsKLQlmb3IgKGkgPSAwOyBpIDwgZHN0
X2J5dGVzOyBpKyspCi0JCWRzdFtpXSA9IHNyYyA+PiAoKDMtaSkgKiA4KTsKLX0KLQotc3RhdGlj
IHUzMgotaW50ZWxfZHBfYXV4X3dhaXRfZG9uZShzdHJ1Y3QgaW50ZWxfZHAgKmludGVsX2RwKQot
ewotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0gZHBfdG9faTkxNShpbnRlbF9kcCk7
Ci0JaTkxNV9yZWdfdCBjaF9jdGwgPSBpbnRlbF9kcC0+YXV4X2NoX2N0bF9yZWcoaW50ZWxfZHAp
OwotCWNvbnN0IHVuc2lnbmVkIGludCB0aW1lb3V0X21zID0gMTA7Ci0JdTMyIHN0YXR1czsKLQli
b29sIGRvbmU7Ci0KLSNkZWZpbmUgQyAoKChzdGF0dXMgPSBpbnRlbF91bmNvcmVfcmVhZF9ub3Ry
YWNlKCZpOTE1LT51bmNvcmUsIGNoX2N0bCkpICYgRFBfQVVYX0NIX0NUTF9TRU5EX0JVU1kpID09
IDApCi0JZG9uZSA9IHdhaXRfZXZlbnRfdGltZW91dChpOTE1LT5nbWJ1c193YWl0X3F1ZXVlLCBD
LAotCQkJCSAgbXNlY3NfdG9famlmZmllc190aW1lb3V0KHRpbWVvdXRfbXMpKTsKLQotCS8qIGp1
c3QgdHJhY2UgdGhlIGZpbmFsIHZhbHVlICovCi0JdHJhY2VfaTkxNV9yZWdfcncoZmFsc2UsIGNo
X2N0bCwgc3RhdHVzLCBzaXplb2Yoc3RhdHVzKSwgdHJ1ZSk7Ci0KLQlpZiAoIWRvbmUpCi0JCWRy
bV9lcnIoJmk5MTUtPmRybSwKLQkJCSIlczogZGlkIG5vdCBjb21wbGV0ZSBvciB0aW1lb3V0IHdp
dGhpbiAldW1zIChzdGF0dXMgMHglMDh4KVxuIiwKLQkJCWludGVsX2RwLT5hdXgubmFtZSwgdGlt
ZW91dF9tcywgc3RhdHVzKTsKLSN1bmRlZiBDCi0KLQlyZXR1cm4gc3RhdHVzOwotfQotCi1zdGF0
aWMgdTMyIGc0eF9nZXRfYXV4X2Nsb2NrX2RpdmlkZXIoc3RydWN0IGludGVsX2RwICppbnRlbF9k
cCwgaW50IGluZGV4KQotewotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IGRw
X3RvX2k5MTUoaW50ZWxfZHApOwotCi0JaWYgKGluZGV4KQotCQlyZXR1cm4gMDsKLQotCS8qCi0J
ICogVGhlIGNsb2NrIGRpdmlkZXIgaXMgYmFzZWQgb2ZmIHRoZSBocmF3Y2xrLCBhbmQgd291bGQg
bGlrZSB0byBydW4gYXQKLQkgKiAyTUh6LiAgU28sIHRha2UgdGhlIGhyYXdjbGsgdmFsdWUgYW5k
IGRpdmlkZSBieSAyMDAwIGFuZCB1c2UgdGhhdAotCSAqLwotCXJldHVybiBESVZfUk9VTkRfQ0xP
U0VTVChSVU5USU1FX0lORk8oZGV2X3ByaXYpLT5yYXdjbGtfZnJlcSwgMjAwMCk7Ci19Ci0KLXN0
YXRpYyB1MzIgaWxrX2dldF9hdXhfY2xvY2tfZGl2aWRlcihzdHJ1Y3QgaW50ZWxfZHAgKmludGVs
X2RwLCBpbnQgaW5kZXgpCi17Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0g
ZHBfdG9faTkxNShpbnRlbF9kcCk7Ci0Jc3RydWN0IGludGVsX2RpZ2l0YWxfcG9ydCAqZGlnX3Bv
cnQgPSBkcF90b19kaWdfcG9ydChpbnRlbF9kcCk7Ci0JdTMyIGZyZXE7Ci0KLQlpZiAoaW5kZXgp
Ci0JCXJldHVybiAwOwotCi0JLyoKLQkgKiBUaGUgY2xvY2sgZGl2aWRlciBpcyBiYXNlZCBvZmYg
dGhlIGNkY2xrIG9yIFBDSCByYXdjbGssIGFuZCB3b3VsZAotCSAqIGxpa2UgdG8gcnVuIGF0IDJN
SHouICBTbywgdGFrZSB0aGUgY2RjbGsgb3IgUENIIHJhd2NsayB2YWx1ZSBhbmQKLQkgKiBkaXZp
ZGUgYnkgMjAwMCBhbmQgdXNlIHRoYXQKLQkgKi8KLQlpZiAoZGlnX3BvcnQtPmF1eF9jaCA9PSBB
VVhfQ0hfQSkKLQkJZnJlcSA9IGRldl9wcml2LT5jZGNsay5ody5jZGNsazsKLQllbHNlCi0JCWZy
ZXEgPSBSVU5USU1FX0lORk8oZGV2X3ByaXYpLT5yYXdjbGtfZnJlcTsKLQlyZXR1cm4gRElWX1JP
VU5EX0NMT1NFU1QoZnJlcSwgMjAwMCk7Ci19Ci0KLXN0YXRpYyB1MzIgaHN3X2dldF9hdXhfY2xv
Y2tfZGl2aWRlcihzdHJ1Y3QgaW50ZWxfZHAgKmludGVsX2RwLCBpbnQgaW5kZXgpCi17Ci0Jc3Ry
dWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gZHBfdG9faTkxNShpbnRlbF9kcCk7Ci0J
c3RydWN0IGludGVsX2RpZ2l0YWxfcG9ydCAqZGlnX3BvcnQgPSBkcF90b19kaWdfcG9ydChpbnRl
bF9kcCk7Ci0KLQlpZiAoZGlnX3BvcnQtPmF1eF9jaCAhPSBBVVhfQ0hfQSAmJiBIQVNfUENIX0xQ
VF9IKGRldl9wcml2KSkgewotCQkvKiBXb3JrYXJvdW5kIGZvciBub24tVUxUIEhTVyAqLwotCQlz
d2l0Y2ggKGluZGV4KSB7Ci0JCWNhc2UgMDogcmV0dXJuIDYzOwotCQljYXNlIDE6IHJldHVybiA3
MjsKLQkJZGVmYXVsdDogcmV0dXJuIDA7Ci0JCX0KLQl9Ci0KLQlyZXR1cm4gaWxrX2dldF9hdXhf
Y2xvY2tfZGl2aWRlcihpbnRlbF9kcCwgaW5kZXgpOwotfQotCi1zdGF0aWMgdTMyIHNrbF9nZXRf
YXV4X2Nsb2NrX2RpdmlkZXIoc3RydWN0IGludGVsX2RwICppbnRlbF9kcCwgaW50IGluZGV4KQot
ewotCS8qCi0JICogU0tMIGRvZXNuJ3QgbmVlZCB1cyB0byBwcm9ncmFtIHRoZSBBVVggY2xvY2sg
ZGl2aWRlciAoSGFyZHdhcmUgd2lsbAotCSAqIGRlcml2ZSB0aGUgY2xvY2sgZnJvbSBDRENMSyBh
dXRvbWF0aWNhbGx5KS4gV2Ugc3RpbGwgaW1wbGVtZW50IHRoZQotCSAqIGdldF9hdXhfY2xvY2tf
ZGl2aWRlciB2ZnVuYyB0byBwbHVnLWluIGludG8gdGhlIGV4aXN0aW5nIGNvZGUuCi0JICovCi0J
cmV0dXJuIGluZGV4ID8gMCA6IDE7Ci19Ci0KLXN0YXRpYyB1MzIgZzR4X2dldF9hdXhfc2VuZF9j
dGwoc3RydWN0IGludGVsX2RwICppbnRlbF9kcCwKLQkJCQlpbnQgc2VuZF9ieXRlcywKLQkJCQl1
MzIgYXV4X2Nsb2NrX2RpdmlkZXIpCi17Ci0Jc3RydWN0IGludGVsX2RpZ2l0YWxfcG9ydCAqZGln
X3BvcnQgPSBkcF90b19kaWdfcG9ydChpbnRlbF9kcCk7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZh
dGUgKmRldl9wcml2ID0KLQkJCXRvX2k5MTUoZGlnX3BvcnQtPmJhc2UuYmFzZS5kZXYpOwotCXUz
MiBwcmVjaGFyZ2UsIHRpbWVvdXQ7Ci0KLQlpZiAoSVNfR0VOKGRldl9wcml2LCA2KSkKLQkJcHJl
Y2hhcmdlID0gMzsKLQllbHNlCi0JCXByZWNoYXJnZSA9IDU7Ci0KLQlpZiAoSVNfQlJPQURXRUxM
KGRldl9wcml2KSkKLQkJdGltZW91dCA9IERQX0FVWF9DSF9DVExfVElNRV9PVVRfNjAwdXM7Ci0J
ZWxzZQotCQl0aW1lb3V0ID0gRFBfQVVYX0NIX0NUTF9USU1FX09VVF80MDB1czsKLQotCXJldHVy
biBEUF9BVVhfQ0hfQ1RMX1NFTkRfQlVTWSB8Ci0JICAgICAgIERQX0FVWF9DSF9DVExfRE9ORSB8
Ci0JICAgICAgIERQX0FVWF9DSF9DVExfSU5URVJSVVBUIHwKLQkgICAgICAgRFBfQVVYX0NIX0NU
TF9USU1FX09VVF9FUlJPUiB8Ci0JICAgICAgIHRpbWVvdXQgfAotCSAgICAgICBEUF9BVVhfQ0hf
Q1RMX1JFQ0VJVkVfRVJST1IgfAotCSAgICAgICAoc2VuZF9ieXRlcyA8PCBEUF9BVVhfQ0hfQ1RM
X01FU1NBR0VfU0laRV9TSElGVCkgfAotCSAgICAgICAocHJlY2hhcmdlIDw8IERQX0FVWF9DSF9D
VExfUFJFQ0hBUkdFXzJVU19TSElGVCkgfAotCSAgICAgICAoYXV4X2Nsb2NrX2RpdmlkZXIgPDwg
RFBfQVVYX0NIX0NUTF9CSVRfQ0xPQ0tfMlhfU0hJRlQpOwotfQotCi1zdGF0aWMgdTMyIHNrbF9n
ZXRfYXV4X3NlbmRfY3RsKHN0cnVjdCBpbnRlbF9kcCAqaW50ZWxfZHAsCi0JCQkJaW50IHNlbmRf
Ynl0ZXMsCi0JCQkJdTMyIHVudXNlZCkKLXsKLQlzdHJ1Y3QgaW50ZWxfZGlnaXRhbF9wb3J0ICpk
aWdfcG9ydCA9IGRwX3RvX2RpZ19wb3J0KGludGVsX2RwKTsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJp
dmF0ZSAqaTkxNSA9Ci0JCQl0b19pOTE1KGRpZ19wb3J0LT5iYXNlLmJhc2UuZGV2KTsKLQllbnVt
IHBoeSBwaHkgPSBpbnRlbF9wb3J0X3RvX3BoeShpOTE1LCBkaWdfcG9ydC0+YmFzZS5wb3J0KTsK
LQl1MzIgcmV0OwotCi0JcmV0ID0gRFBfQVVYX0NIX0NUTF9TRU5EX0JVU1kgfAotCSAgICAgIERQ
X0FVWF9DSF9DVExfRE9ORSB8Ci0JICAgICAgRFBfQVVYX0NIX0NUTF9JTlRFUlJVUFQgfAotCSAg
ICAgIERQX0FVWF9DSF9DVExfVElNRV9PVVRfRVJST1IgfAotCSAgICAgIERQX0FVWF9DSF9DVExf
VElNRV9PVVRfTUFYIHwKLQkgICAgICBEUF9BVVhfQ0hfQ1RMX1JFQ0VJVkVfRVJST1IgfAotCSAg
ICAgIChzZW5kX2J5dGVzIDw8IERQX0FVWF9DSF9DVExfTUVTU0FHRV9TSVpFX1NISUZUKSB8Ci0J
ICAgICAgRFBfQVVYX0NIX0NUTF9GV19TWU5DX1BVTFNFX1NLTCgzMikgfAotCSAgICAgIERQX0FV
WF9DSF9DVExfU1lOQ19QVUxTRV9TS0woMzIpOwotCi0JaWYgKGludGVsX3BoeV9pc190YyhpOTE1
LCBwaHkpICYmCi0JICAgIGRpZ19wb3J0LT50Y19tb2RlID09IFRDX1BPUlRfVEJUX0FMVCkKLQkJ
cmV0IHw9IERQX0FVWF9DSF9DVExfVEJUX0lPOwotCi0JcmV0dXJuIHJldDsKLX0KLQotc3RhdGlj
IGludAotaW50ZWxfZHBfYXV4X3hmZXIoc3RydWN0IGludGVsX2RwICppbnRlbF9kcCwKLQkJICBj
b25zdCB1OCAqc2VuZCwgaW50IHNlbmRfYnl0ZXMsCi0JCSAgdTggKnJlY3YsIGludCByZWN2X3Np
emUsCi0JCSAgdTMyIGF1eF9zZW5kX2N0bF9mbGFncykKLXsKLQlzdHJ1Y3QgaW50ZWxfZGlnaXRh
bF9wb3J0ICpkaWdfcG9ydCA9IGRwX3RvX2RpZ19wb3J0KGludGVsX2RwKTsKLQlzdHJ1Y3QgZHJt
X2k5MTVfcHJpdmF0ZSAqaTkxNSA9Ci0JCQl0b19pOTE1KGRpZ19wb3J0LT5iYXNlLmJhc2UuZGV2
KTsKLQlzdHJ1Y3QgaW50ZWxfdW5jb3JlICp1bmNvcmUgPSAmaTkxNS0+dW5jb3JlOwotCWVudW0g
cGh5IHBoeSA9IGludGVsX3BvcnRfdG9fcGh5KGk5MTUsIGRpZ19wb3J0LT5iYXNlLnBvcnQpOwot
CWJvb2wgaXNfdGNfcG9ydCA9IGludGVsX3BoeV9pc190YyhpOTE1LCBwaHkpOwotCWk5MTVfcmVn
X3QgY2hfY3RsLCBjaF9kYXRhWzVdOwotCXUzMiBhdXhfY2xvY2tfZGl2aWRlcjsKLQllbnVtIGlu
dGVsX2Rpc3BsYXlfcG93ZXJfZG9tYWluIGF1eF9kb21haW47Ci0JaW50ZWxfd2FrZXJlZl90IGF1
eF93YWtlcmVmOwotCWludGVsX3dha2VyZWZfdCBwcHNfd2FrZXJlZjsKLQlpbnQgaSwgcmV0LCBy
ZWN2X2J5dGVzOwotCWludCB0cnksIGNsb2NrID0gMDsKLQl1MzIgc3RhdHVzOwotCWJvb2wgdmRk
OwotCi0JY2hfY3RsID0gaW50ZWxfZHAtPmF1eF9jaF9jdGxfcmVnKGludGVsX2RwKTsKLQlmb3Ig
KGkgPSAwOyBpIDwgQVJSQVlfU0laRShjaF9kYXRhKTsgaSsrKQotCQljaF9kYXRhW2ldID0gaW50
ZWxfZHAtPmF1eF9jaF9kYXRhX3JlZyhpbnRlbF9kcCwgaSk7Ci0KLQlpZiAoaXNfdGNfcG9ydCkK
LQkJaW50ZWxfdGNfcG9ydF9sb2NrKGRpZ19wb3J0KTsKLQotCWF1eF9kb21haW4gPSBpbnRlbF9h
dXhfcG93ZXJfZG9tYWluKGRpZ19wb3J0KTsKLQotCWF1eF93YWtlcmVmID0gaW50ZWxfZGlzcGxh
eV9wb3dlcl9nZXQoaTkxNSwgYXV4X2RvbWFpbik7Ci0JcHBzX3dha2VyZWYgPSBpbnRlbF9wcHNf
bG9jayhpbnRlbF9kcCk7Ci0KLQkvKgotCSAqIFdlIHdpbGwgYmUgY2FsbGVkIHdpdGggVkREIGFs
cmVhZHkgZW5hYmxlZCBmb3IgZHBjZC9lZGlkL291aSByZWFkcy4KLQkgKiBJbiBzdWNoIGNhc2Vz
IHdlIHdhbnQgdG8gbGVhdmUgVkREIGVuYWJsZWQgYW5kIGl0J3MgdXAgdG8gdXBwZXIgbGF5ZXJz
Ci0JICogdG8gdHVybiBpdCBvZmYuIEJ1dCBmb3IgZWcuIGkyYy1kZXYgYWNjZXNzIHdlIG5lZWQg
dG8gdHVybiBpdCBvbi9vZmYKLQkgKiBvdXJzZWx2ZXMuCi0JICovCi0JdmRkID0gaW50ZWxfcHBz
X3ZkZF9vbl91bmxvY2tlZChpbnRlbF9kcCk7Ci0KLQkvKiBkcCBhdXggaXMgZXh0cmVtZWx5IHNl
bnNpdGl2ZSB0byBpcnEgbGF0ZW5jeSwgaGVuY2UgcmVxdWVzdCB0aGUKLQkgKiBsb3dlc3QgcG9z
c2libGUgd2FrZXVwIGxhdGVuY3kgYW5kIHNvIHByZXZlbnQgdGhlIGNwdSBmcm9tIGdvaW5nIGlu
dG8KLQkgKiBkZWVwIHNsZWVwIHN0YXRlcy4KLQkgKi8KLQljcHVfbGF0ZW5jeV9xb3NfdXBkYXRl
X3JlcXVlc3QoJmk5MTUtPnBtX3FvcywgMCk7Ci0KLQlpbnRlbF9wcHNfY2hlY2tfcG93ZXJfdW5s
b2NrZWQoaW50ZWxfZHApOwotCi0JLyogVHJ5IHRvIHdhaXQgZm9yIGFueSBwcmV2aW91cyBBVVgg
Y2hhbm5lbCBhY3Rpdml0eSAqLwotCWZvciAodHJ5ID0gMDsgdHJ5IDwgMzsgdHJ5KyspIHsKLQkJ
c3RhdHVzID0gaW50ZWxfdW5jb3JlX3JlYWRfbm90cmFjZSh1bmNvcmUsIGNoX2N0bCk7Ci0JCWlm
ICgoc3RhdHVzICYgRFBfQVVYX0NIX0NUTF9TRU5EX0JVU1kpID09IDApCi0JCQlicmVhazsKLQkJ
bXNsZWVwKDEpOwotCX0KLQkvKiBqdXN0IHRyYWNlIHRoZSBmaW5hbCB2YWx1ZSAqLwotCXRyYWNl
X2k5MTVfcmVnX3J3KGZhbHNlLCBjaF9jdGwsIHN0YXR1cywgc2l6ZW9mKHN0YXR1cyksIHRydWUp
OwotCi0JaWYgKHRyeSA9PSAzKSB7Ci0JCWNvbnN0IHUzMiBzdGF0dXMgPSBpbnRlbF91bmNvcmVf
cmVhZCh1bmNvcmUsIGNoX2N0bCk7Ci0KLQkJaWYgKHN0YXR1cyAhPSBpbnRlbF9kcC0+YXV4X2J1
c3lfbGFzdF9zdGF0dXMpIHsKLQkJCWRybV9XQVJOKCZpOTE1LT5kcm0sIDEsCi0JCQkJICIlczog
bm90IHN0YXJ0ZWQgKHN0YXR1cyAweCUwOHgpXG4iLAotCQkJCSBpbnRlbF9kcC0+YXV4Lm5hbWUs
IHN0YXR1cyk7Ci0JCQlpbnRlbF9kcC0+YXV4X2J1c3lfbGFzdF9zdGF0dXMgPSBzdGF0dXM7Ci0J
CX0KLQotCQlyZXQgPSAtRUJVU1k7Ci0JCWdvdG8gb3V0OwotCX0KLQotCS8qIE9ubHkgNSBkYXRh
IHJlZ2lzdGVycyEgKi8KLQlpZiAoZHJtX1dBUk5fT04oJmk5MTUtPmRybSwgc2VuZF9ieXRlcyA+
IDIwIHx8IHJlY3Zfc2l6ZSA+IDIwKSkgewotCQlyZXQgPSAtRTJCSUc7Ci0JCWdvdG8gb3V0Owot
CX0KLQotCXdoaWxlICgoYXV4X2Nsb2NrX2RpdmlkZXIgPSBpbnRlbF9kcC0+Z2V0X2F1eF9jbG9j
a19kaXZpZGVyKGludGVsX2RwLCBjbG9jaysrKSkpIHsKLQkJdTMyIHNlbmRfY3RsID0gaW50ZWxf
ZHAtPmdldF9hdXhfc2VuZF9jdGwoaW50ZWxfZHAsCi0JCQkJCQkJICBzZW5kX2J5dGVzLAotCQkJ
CQkJCSAgYXV4X2Nsb2NrX2RpdmlkZXIpOwotCi0JCXNlbmRfY3RsIHw9IGF1eF9zZW5kX2N0bF9m
bGFnczsKLQotCQkvKiBNdXN0IHRyeSBhdCBsZWFzdCAzIHRpbWVzIGFjY29yZGluZyB0byBEUCBz
cGVjICovCi0JCWZvciAodHJ5ID0gMDsgdHJ5IDwgNTsgdHJ5KyspIHsKLQkJCS8qIExvYWQgdGhl
IHNlbmQgZGF0YSBpbnRvIHRoZSBhdXggY2hhbm5lbCBkYXRhIHJlZ2lzdGVycyAqLwotCQkJZm9y
IChpID0gMDsgaSA8IHNlbmRfYnl0ZXM7IGkgKz0gNCkKLQkJCQlpbnRlbF91bmNvcmVfd3JpdGUo
dW5jb3JlLAotCQkJCQkJICAgY2hfZGF0YVtpID4+IDJdLAotCQkJCQkJICAgaW50ZWxfZHBfcGFj
a19hdXgoc2VuZCArIGksCi0JCQkJCQkJCSAgICAgc2VuZF9ieXRlcyAtIGkpKTsKLQotCQkJLyog
U2VuZCB0aGUgY29tbWFuZCBhbmQgd2FpdCBmb3IgaXQgdG8gY29tcGxldGUgKi8KLQkJCWludGVs
X3VuY29yZV93cml0ZSh1bmNvcmUsIGNoX2N0bCwgc2VuZF9jdGwpOwotCi0JCQlzdGF0dXMgPSBp
bnRlbF9kcF9hdXhfd2FpdF9kb25lKGludGVsX2RwKTsKLQotCQkJLyogQ2xlYXIgZG9uZSBzdGF0
dXMgYW5kIGFueSBlcnJvcnMgKi8KLQkJCWludGVsX3VuY29yZV93cml0ZSh1bmNvcmUsCi0JCQkJ
CSAgIGNoX2N0bCwKLQkJCQkJICAgc3RhdHVzIHwKLQkJCQkJICAgRFBfQVVYX0NIX0NUTF9ET05F
IHwKLQkJCQkJICAgRFBfQVVYX0NIX0NUTF9USU1FX09VVF9FUlJPUiB8Ci0JCQkJCSAgIERQX0FV
WF9DSF9DVExfUkVDRUlWRV9FUlJPUik7Ci0KLQkJCS8qIERQIENUUyAxLjIgQ29yZSBSZXYgMS4x
LCA0LjIuMS4xICYgNC4yLjEuMgotCQkJICogICA0MDB1cyBkZWxheSByZXF1aXJlZCBmb3IgZXJy
b3JzIGFuZCB0aW1lb3V0cwotCQkJICogICBUaW1lb3V0IGVycm9ycyBmcm9tIHRoZSBIVyBhbHJl
YWR5IG1lZXQgdGhpcwotCQkJICogICByZXF1aXJlbWVudCBzbyBza2lwIHRvIG5leHQgaXRlcmF0
aW9uCi0JCQkgKi8KLQkJCWlmIChzdGF0dXMgJiBEUF9BVVhfQ0hfQ1RMX1RJTUVfT1VUX0VSUk9S
KQotCQkJCWNvbnRpbnVlOwotCi0JCQlpZiAoc3RhdHVzICYgRFBfQVVYX0NIX0NUTF9SRUNFSVZF
X0VSUk9SKSB7Ci0JCQkJdXNsZWVwX3JhbmdlKDQwMCwgNTAwKTsKLQkJCQljb250aW51ZTsKLQkJ
CX0KLQkJCWlmIChzdGF0dXMgJiBEUF9BVVhfQ0hfQ1RMX0RPTkUpCi0JCQkJZ290byBkb25lOwot
CQl9Ci0JfQotCi0JaWYgKChzdGF0dXMgJiBEUF9BVVhfQ0hfQ1RMX0RPTkUpID09IDApIHsKLQkJ
ZHJtX2VycigmaTkxNS0+ZHJtLCAiJXM6IG5vdCBkb25lIChzdGF0dXMgMHglMDh4KVxuIiwKLQkJ
CWludGVsX2RwLT5hdXgubmFtZSwgc3RhdHVzKTsKLQkJcmV0ID0gLUVCVVNZOwotCQlnb3RvIG91
dDsKLQl9Ci0KLWRvbmU6Ci0JLyogQ2hlY2sgZm9yIHRpbWVvdXQgb3IgcmVjZWl2ZSBlcnJvci4K
LQkgKiBUaW1lb3V0cyBvY2N1ciB3aGVuIHRoZSBzaW5rIGlzIG5vdCBjb25uZWN0ZWQKLQkgKi8K
LQlpZiAoc3RhdHVzICYgRFBfQVVYX0NIX0NUTF9SRUNFSVZFX0VSUk9SKSB7Ci0JCWRybV9lcnIo
Jmk5MTUtPmRybSwgIiVzOiByZWNlaXZlIGVycm9yIChzdGF0dXMgMHglMDh4KVxuIiwKLQkJCWlu
dGVsX2RwLT5hdXgubmFtZSwgc3RhdHVzKTsKLQkJcmV0ID0gLUVJTzsKLQkJZ290byBvdXQ7Ci0J
fQotCi0JLyogVGltZW91dHMgb2NjdXIgd2hlbiB0aGUgZGV2aWNlIGlzbid0IGNvbm5lY3RlZCwg
c28gdGhleSdyZQotCSAqICJub3JtYWwiIC0tIGRvbid0IGZpbGwgdGhlIGtlcm5lbCBsb2cgd2l0
aCB0aGVzZSAqLwotCWlmIChzdGF0dXMgJiBEUF9BVVhfQ0hfQ1RMX1RJTUVfT1VUX0VSUk9SKSB7
Ci0JCWRybV9kYmdfa21zKCZpOTE1LT5kcm0sICIlczogdGltZW91dCAoc3RhdHVzIDB4JTA4eClc
biIsCi0JCQkgICAgaW50ZWxfZHAtPmF1eC5uYW1lLCBzdGF0dXMpOwotCQlyZXQgPSAtRVRJTUVE
T1VUOwotCQlnb3RvIG91dDsKLQl9Ci0KLQkvKiBVbmxvYWQgYW55IGJ5dGVzIHNlbnQgYmFjayBm
cm9tIHRoZSBvdGhlciBzaWRlICovCi0JcmVjdl9ieXRlcyA9ICgoc3RhdHVzICYgRFBfQVVYX0NI
X0NUTF9NRVNTQUdFX1NJWkVfTUFTSykgPj4KLQkJICAgICAgRFBfQVVYX0NIX0NUTF9NRVNTQUdF
X1NJWkVfU0hJRlQpOwotCi0JLyoKLQkgKiBCeSBCU3BlYzogIk1lc3NhZ2Ugc2l6ZXMgb2YgMCBv
ciA+MjAgYXJlIG5vdCBhbGxvd2VkLiIKLQkgKiBXZSBoYXZlIG5vIGlkZWEgb2Ygd2hhdCBoYXBw
ZW5lZCBzbyB3ZSByZXR1cm4gLUVCVVNZIHNvCi0JICogZHJtIGxheWVyIHRha2VzIGNhcmUgZm9y
IHRoZSBuZWNlc3NhcnkgcmV0cmllcy4KLQkgKi8KLQlpZiAocmVjdl9ieXRlcyA9PSAwIHx8IHJl
Y3ZfYnl0ZXMgPiAyMCkgewotCQlkcm1fZGJnX2ttcygmaTkxNS0+ZHJtLAotCQkJICAgICIlczog
Rm9yYmlkZGVuIHJlY3ZfYnl0ZXMgPSAlZCBvbiBhdXggdHJhbnNhY3Rpb25cbiIsCi0JCQkgICAg
aW50ZWxfZHAtPmF1eC5uYW1lLCByZWN2X2J5dGVzKTsKLQkJcmV0ID0gLUVCVVNZOwotCQlnb3Rv
IG91dDsKLQl9Ci0KLQlpZiAocmVjdl9ieXRlcyA+IHJlY3Zfc2l6ZSkKLQkJcmVjdl9ieXRlcyA9
IHJlY3Zfc2l6ZTsKLQotCWZvciAoaSA9IDA7IGkgPCByZWN2X2J5dGVzOyBpICs9IDQpCi0JCWlu
dGVsX2RwX3VucGFja19hdXgoaW50ZWxfdW5jb3JlX3JlYWQodW5jb3JlLCBjaF9kYXRhW2kgPj4g
Ml0pLAotCQkJCSAgICByZWN2ICsgaSwgcmVjdl9ieXRlcyAtIGkpOwotCi0JcmV0ID0gcmVjdl9i
eXRlczsKLW91dDoKLQljcHVfbGF0ZW5jeV9xb3NfdXBkYXRlX3JlcXVlc3QoJmk5MTUtPnBtX3Fv
cywgUE1fUU9TX0RFRkFVTFRfVkFMVUUpOwotCi0JaWYgKHZkZCkKLQkJaW50ZWxfcHBzX3ZkZF9v
ZmZfdW5sb2NrZWQoaW50ZWxfZHAsIGZhbHNlKTsKLQotCWludGVsX3Bwc191bmxvY2soaW50ZWxf
ZHAsIHBwc193YWtlcmVmKTsKLQlpbnRlbF9kaXNwbGF5X3Bvd2VyX3B1dF9hc3luYyhpOTE1LCBh
dXhfZG9tYWluLCBhdXhfd2FrZXJlZik7Ci0KLQlpZiAoaXNfdGNfcG9ydCkKLQkJaW50ZWxfdGNf
cG9ydF91bmxvY2soZGlnX3BvcnQpOwotCi0JcmV0dXJuIHJldDsKLX0KLQotI2RlZmluZSBCQVJF
X0FERFJFU1NfU0laRQkzCi0jZGVmaW5lIEhFQURFUl9TSVpFCQkoQkFSRV9BRERSRVNTX1NJWkUg
KyAxKQotCi1zdGF0aWMgdm9pZAotaW50ZWxfZHBfYXV4X2hlYWRlcih1OCB0eGJ1ZltIRUFERVJf
U0laRV0sCi0JCSAgICBjb25zdCBzdHJ1Y3QgZHJtX2RwX2F1eF9tc2cgKm1zZykKLXsKLQl0eGJ1
ZlswXSA9IChtc2ctPnJlcXVlc3QgPDwgNCkgfCAoKG1zZy0+YWRkcmVzcyA+PiAxNikgJiAweGYp
OwotCXR4YnVmWzFdID0gKG1zZy0+YWRkcmVzcyA+PiA4KSAmIDB4ZmY7Ci0JdHhidWZbMl0gPSBt
c2ctPmFkZHJlc3MgJiAweGZmOwotCXR4YnVmWzNdID0gbXNnLT5zaXplIC0gMTsKLX0KLQotc3Rh
dGljIHUzMiBpbnRlbF9kcF9hdXhfeGZlcl9mbGFncyhjb25zdCBzdHJ1Y3QgZHJtX2RwX2F1eF9t
c2cgKm1zZykKLXsKLQkvKgotCSAqIElmIHdlJ3JlIHRyeWluZyB0byBzZW5kIHRoZSBIRENQIEFr
c3YsIHdlIG5lZWQgdG8gc2V0IGEgdGhlIEFrc3YKLQkgKiBzZWxlY3QgYml0IHRvIGluZm9ybSB0
aGUgaGFyZHdhcmUgdG8gc2VuZCB0aGUgQWtzdiBhZnRlciBvdXIgaGVhZGVyCi0JICogc2luY2Ug
d2UgY2FuJ3QgYWNjZXNzIHRoYXQgZGF0YSBmcm9tIHNvZnR3YXJlLgotCSAqLwotCWlmICgobXNn
LT5yZXF1ZXN0ICYgfkRQX0FVWF9JMkNfTU9UKSA9PSBEUF9BVVhfTkFUSVZFX1dSSVRFICYmCi0J
ICAgIG1zZy0+YWRkcmVzcyA9PSBEUF9BVVhfSERDUF9BS1NWKQotCQlyZXR1cm4gRFBfQVVYX0NI
X0NUTF9BVVhfQUtTVl9TRUxFQ1Q7Ci0KLQlyZXR1cm4gMDsKLX0KLQotc3RhdGljIHNzaXplX3QK
LWludGVsX2RwX2F1eF90cmFuc2ZlcihzdHJ1Y3QgZHJtX2RwX2F1eCAqYXV4LCBzdHJ1Y3QgZHJt
X2RwX2F1eF9tc2cgKm1zZykKLXsKLQlzdHJ1Y3QgaW50ZWxfZHAgKmludGVsX2RwID0gY29udGFp
bmVyX29mKGF1eCwgc3RydWN0IGludGVsX2RwLCBhdXgpOwotCXN0cnVjdCBkcm1faTkxNV9wcml2
YXRlICppOTE1ID0gZHBfdG9faTkxNShpbnRlbF9kcCk7Ci0JdTggdHhidWZbMjBdLCByeGJ1Zlsy
MF07Ci0Jc2l6ZV90IHR4c2l6ZSwgcnhzaXplOwotCXUzMiBmbGFncyA9IGludGVsX2RwX2F1eF94
ZmVyX2ZsYWdzKG1zZyk7Ci0JaW50IHJldDsKLQotCWludGVsX2RwX2F1eF9oZWFkZXIodHhidWYs
IG1zZyk7Ci0KLQlzd2l0Y2ggKG1zZy0+cmVxdWVzdCAmIH5EUF9BVVhfSTJDX01PVCkgewotCWNh
c2UgRFBfQVVYX05BVElWRV9XUklURToKLQljYXNlIERQX0FVWF9JMkNfV1JJVEU6Ci0JY2FzZSBE
UF9BVVhfSTJDX1dSSVRFX1NUQVRVU19VUERBVEU6Ci0JCXR4c2l6ZSA9IG1zZy0+c2l6ZSA/IEhF
QURFUl9TSVpFICsgbXNnLT5zaXplIDogQkFSRV9BRERSRVNTX1NJWkU7Ci0JCXJ4c2l6ZSA9IDI7
IC8qIDAgb3IgMSBkYXRhIGJ5dGVzICovCi0KLQkJaWYgKGRybV9XQVJOX09OKCZpOTE1LT5kcm0s
IHR4c2l6ZSA+IDIwKSkKLQkJCXJldHVybiAtRTJCSUc7Ci0KLQkJZHJtX1dBUk5fT04oJmk5MTUt
PmRybSwgIW1zZy0+YnVmZmVyICE9ICFtc2ctPnNpemUpOwotCi0JCWlmIChtc2ctPmJ1ZmZlcikK
LQkJCW1lbWNweSh0eGJ1ZiArIEhFQURFUl9TSVpFLCBtc2ctPmJ1ZmZlciwgbXNnLT5zaXplKTsK
LQotCQlyZXQgPSBpbnRlbF9kcF9hdXhfeGZlcihpbnRlbF9kcCwgdHhidWYsIHR4c2l6ZSwKLQkJ
CQkJcnhidWYsIHJ4c2l6ZSwgZmxhZ3MpOwotCQlpZiAocmV0ID4gMCkgewotCQkJbXNnLT5yZXBs
eSA9IHJ4YnVmWzBdID4+IDQ7Ci0KLQkJCWlmIChyZXQgPiAxKSB7Ci0JCQkJLyogTnVtYmVyIG9m
IGJ5dGVzIHdyaXR0ZW4gaW4gYSBzaG9ydCB3cml0ZS4gKi8KLQkJCQlyZXQgPSBjbGFtcF90KGlu
dCwgcnhidWZbMV0sIDAsIG1zZy0+c2l6ZSk7Ci0JCQl9IGVsc2UgewotCQkJCS8qIFJldHVybiBw
YXlsb2FkIHNpemUuICovCi0JCQkJcmV0ID0gbXNnLT5zaXplOwotCQkJfQotCQl9Ci0JCWJyZWFr
OwotCi0JY2FzZSBEUF9BVVhfTkFUSVZFX1JFQUQ6Ci0JY2FzZSBEUF9BVVhfSTJDX1JFQUQ6Ci0J
CXR4c2l6ZSA9IG1zZy0+c2l6ZSA/IEhFQURFUl9TSVpFIDogQkFSRV9BRERSRVNTX1NJWkU7Ci0J
CXJ4c2l6ZSA9IG1zZy0+c2l6ZSArIDE7Ci0KLQkJaWYgKGRybV9XQVJOX09OKCZpOTE1LT5kcm0s
IHJ4c2l6ZSA+IDIwKSkKLQkJCXJldHVybiAtRTJCSUc7Ci0KLQkJcmV0ID0gaW50ZWxfZHBfYXV4
X3hmZXIoaW50ZWxfZHAsIHR4YnVmLCB0eHNpemUsCi0JCQkJCXJ4YnVmLCByeHNpemUsIGZsYWdz
KTsKLQkJaWYgKHJldCA+IDApIHsKLQkJCW1zZy0+cmVwbHkgPSByeGJ1ZlswXSA+PiA0OwotCQkJ
LyoKLQkJCSAqIEFzc3VtZSBoYXBweSBkYXksIGFuZCBjb3B5IHRoZSBkYXRhLiBUaGUgY2FsbGVy
IGlzCi0JCQkgKiBleHBlY3RlZCB0byBjaGVjayBtc2ctPnJlcGx5IGJlZm9yZSB0b3VjaGluZyBp
dC4KLQkJCSAqCi0JCQkgKiBSZXR1cm4gcGF5bG9hZCBzaXplLgotCQkJICovCi0JCQlyZXQtLTsK
LQkJCW1lbWNweShtc2ctPmJ1ZmZlciwgcnhidWYgKyAxLCByZXQpOwotCQl9Ci0JCWJyZWFrOwot
Ci0JZGVmYXVsdDoKLQkJcmV0ID0gLUVJTlZBTDsKLQkJYnJlYWs7Ci0JfQotCi0JcmV0dXJuIHJl
dDsKLX0KLQotCi1zdGF0aWMgaTkxNV9yZWdfdCBnNHhfYXV4X2N0bF9yZWcoc3RydWN0IGludGVs
X2RwICppbnRlbF9kcCkKLXsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSBk
cF90b19pOTE1KGludGVsX2RwKTsKLQlzdHJ1Y3QgaW50ZWxfZGlnaXRhbF9wb3J0ICpkaWdfcG9y
dCA9IGRwX3RvX2RpZ19wb3J0KGludGVsX2RwKTsKLQllbnVtIGF1eF9jaCBhdXhfY2ggPSBkaWdf
cG9ydC0+YXV4X2NoOwotCi0Jc3dpdGNoIChhdXhfY2gpIHsKLQljYXNlIEFVWF9DSF9COgotCWNh
c2UgQVVYX0NIX0M6Ci0JY2FzZSBBVVhfQ0hfRDoKLQkJcmV0dXJuIERQX0FVWF9DSF9DVEwoYXV4
X2NoKTsKLQlkZWZhdWx0OgotCQlNSVNTSU5HX0NBU0UoYXV4X2NoKTsKLQkJcmV0dXJuIERQX0FV
WF9DSF9DVEwoQVVYX0NIX0IpOwotCX0KLX0KLQotc3RhdGljIGk5MTVfcmVnX3QgZzR4X2F1eF9k
YXRhX3JlZyhzdHJ1Y3QgaW50ZWxfZHAgKmludGVsX2RwLCBpbnQgaW5kZXgpCi17Ci0Jc3RydWN0
IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gZHBfdG9faTkxNShpbnRlbF9kcCk7Ci0Jc3Ry
dWN0IGludGVsX2RpZ2l0YWxfcG9ydCAqZGlnX3BvcnQgPSBkcF90b19kaWdfcG9ydChpbnRlbF9k
cCk7Ci0JZW51bSBhdXhfY2ggYXV4X2NoID0gZGlnX3BvcnQtPmF1eF9jaDsKLQotCXN3aXRjaCAo
YXV4X2NoKSB7Ci0JY2FzZSBBVVhfQ0hfQjoKLQljYXNlIEFVWF9DSF9DOgotCWNhc2UgQVVYX0NI
X0Q6Ci0JCXJldHVybiBEUF9BVVhfQ0hfREFUQShhdXhfY2gsIGluZGV4KTsKLQlkZWZhdWx0Ogot
CQlNSVNTSU5HX0NBU0UoYXV4X2NoKTsKLQkJcmV0dXJuIERQX0FVWF9DSF9EQVRBKEFVWF9DSF9C
LCBpbmRleCk7Ci0JfQotfQotCi1zdGF0aWMgaTkxNV9yZWdfdCBpbGtfYXV4X2N0bF9yZWcoc3Ry
dWN0IGludGVsX2RwICppbnRlbF9kcCkKLXsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2
X3ByaXYgPSBkcF90b19pOTE1KGludGVsX2RwKTsKLQlzdHJ1Y3QgaW50ZWxfZGlnaXRhbF9wb3J0
ICpkaWdfcG9ydCA9IGRwX3RvX2RpZ19wb3J0KGludGVsX2RwKTsKLQllbnVtIGF1eF9jaCBhdXhf
Y2ggPSBkaWdfcG9ydC0+YXV4X2NoOwotCi0Jc3dpdGNoIChhdXhfY2gpIHsKLQljYXNlIEFVWF9D
SF9BOgotCQlyZXR1cm4gRFBfQVVYX0NIX0NUTChhdXhfY2gpOwotCWNhc2UgQVVYX0NIX0I6Ci0J
Y2FzZSBBVVhfQ0hfQzoKLQljYXNlIEFVWF9DSF9EOgotCQlyZXR1cm4gUENIX0RQX0FVWF9DSF9D
VEwoYXV4X2NoKTsKLQlkZWZhdWx0OgotCQlNSVNTSU5HX0NBU0UoYXV4X2NoKTsKLQkJcmV0dXJu
IERQX0FVWF9DSF9DVEwoQVVYX0NIX0EpOwotCX0KLX0KLQotc3RhdGljIGk5MTVfcmVnX3QgaWxr
X2F1eF9kYXRhX3JlZyhzdHJ1Y3QgaW50ZWxfZHAgKmludGVsX2RwLCBpbnQgaW5kZXgpCi17Ci0J
c3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gZHBfdG9faTkxNShpbnRlbF9kcCk7
Ci0Jc3RydWN0IGludGVsX2RpZ2l0YWxfcG9ydCAqZGlnX3BvcnQgPSBkcF90b19kaWdfcG9ydChp
bnRlbF9kcCk7Ci0JZW51bSBhdXhfY2ggYXV4X2NoID0gZGlnX3BvcnQtPmF1eF9jaDsKLQotCXN3
aXRjaCAoYXV4X2NoKSB7Ci0JY2FzZSBBVVhfQ0hfQToKLQkJcmV0dXJuIERQX0FVWF9DSF9EQVRB
KGF1eF9jaCwgaW5kZXgpOwotCWNhc2UgQVVYX0NIX0I6Ci0JY2FzZSBBVVhfQ0hfQzoKLQljYXNl
IEFVWF9DSF9EOgotCQlyZXR1cm4gUENIX0RQX0FVWF9DSF9EQVRBKGF1eF9jaCwgaW5kZXgpOwot
CWRlZmF1bHQ6Ci0JCU1JU1NJTkdfQ0FTRShhdXhfY2gpOwotCQlyZXR1cm4gRFBfQVVYX0NIX0RB
VEEoQVVYX0NIX0EsIGluZGV4KTsKLQl9Ci19Ci0KLXN0YXRpYyBpOTE1X3JlZ190IHNrbF9hdXhf
Y3RsX3JlZyhzdHJ1Y3QgaW50ZWxfZHAgKmludGVsX2RwKQotewotCXN0cnVjdCBkcm1faTkxNV9w
cml2YXRlICpkZXZfcHJpdiA9IGRwX3RvX2k5MTUoaW50ZWxfZHApOwotCXN0cnVjdCBpbnRlbF9k
aWdpdGFsX3BvcnQgKmRpZ19wb3J0ID0gZHBfdG9fZGlnX3BvcnQoaW50ZWxfZHApOwotCWVudW0g
YXV4X2NoIGF1eF9jaCA9IGRpZ19wb3J0LT5hdXhfY2g7Ci0KLQlzd2l0Y2ggKGF1eF9jaCkgewot
CWNhc2UgQVVYX0NIX0E6Ci0JY2FzZSBBVVhfQ0hfQjoKLQljYXNlIEFVWF9DSF9DOgotCWNhc2Ug
QVVYX0NIX0Q6Ci0JY2FzZSBBVVhfQ0hfRToKLQljYXNlIEFVWF9DSF9GOgotCQlyZXR1cm4gRFBf
QVVYX0NIX0NUTChhdXhfY2gpOwotCWRlZmF1bHQ6Ci0JCU1JU1NJTkdfQ0FTRShhdXhfY2gpOwot
CQlyZXR1cm4gRFBfQVVYX0NIX0NUTChBVVhfQ0hfQSk7Ci0JfQotfQotCi1zdGF0aWMgaTkxNV9y
ZWdfdCBza2xfYXV4X2RhdGFfcmVnKHN0cnVjdCBpbnRlbF9kcCAqaW50ZWxfZHAsIGludCBpbmRl
eCkKLXsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSBkcF90b19pOTE1KGlu
dGVsX2RwKTsKLQlzdHJ1Y3QgaW50ZWxfZGlnaXRhbF9wb3J0ICpkaWdfcG9ydCA9IGRwX3RvX2Rp
Z19wb3J0KGludGVsX2RwKTsKLQllbnVtIGF1eF9jaCBhdXhfY2ggPSBkaWdfcG9ydC0+YXV4X2No
OwotCi0Jc3dpdGNoIChhdXhfY2gpIHsKLQljYXNlIEFVWF9DSF9BOgotCWNhc2UgQVVYX0NIX0I6
Ci0JY2FzZSBBVVhfQ0hfQzoKLQljYXNlIEFVWF9DSF9EOgotCWNhc2UgQVVYX0NIX0U6Ci0JY2Fz
ZSBBVVhfQ0hfRjoKLQkJcmV0dXJuIERQX0FVWF9DSF9EQVRBKGF1eF9jaCwgaW5kZXgpOwotCWRl
ZmF1bHQ6Ci0JCU1JU1NJTkdfQ0FTRShhdXhfY2gpOwotCQlyZXR1cm4gRFBfQVVYX0NIX0RBVEEo
QVVYX0NIX0EsIGluZGV4KTsKLQl9Ci19Ci0KLXN0YXRpYyBpOTE1X3JlZ190IHRnbF9hdXhfY3Rs
X3JlZyhzdHJ1Y3QgaW50ZWxfZHAgKmludGVsX2RwKQotewotCXN0cnVjdCBkcm1faTkxNV9wcml2
YXRlICpkZXZfcHJpdiA9IGRwX3RvX2k5MTUoaW50ZWxfZHApOwotCXN0cnVjdCBpbnRlbF9kaWdp
dGFsX3BvcnQgKmRpZ19wb3J0ID0gZHBfdG9fZGlnX3BvcnQoaW50ZWxfZHApOwotCWVudW0gYXV4
X2NoIGF1eF9jaCA9IGRpZ19wb3J0LT5hdXhfY2g7Ci0KLQlzd2l0Y2ggKGF1eF9jaCkgewotCWNh
c2UgQVVYX0NIX0E6Ci0JY2FzZSBBVVhfQ0hfQjoKLQljYXNlIEFVWF9DSF9DOgotCWNhc2UgQVVY
X0NIX1VTQkMxOgotCWNhc2UgQVVYX0NIX1VTQkMyOgotCWNhc2UgQVVYX0NIX1VTQkMzOgotCWNh
c2UgQVVYX0NIX1VTQkM0OgotCWNhc2UgQVVYX0NIX1VTQkM1OgotCWNhc2UgQVVYX0NIX1VTQkM2
OgotCQlyZXR1cm4gRFBfQVVYX0NIX0NUTChhdXhfY2gpOwotCWRlZmF1bHQ6Ci0JCU1JU1NJTkdf
Q0FTRShhdXhfY2gpOwotCQlyZXR1cm4gRFBfQVVYX0NIX0NUTChBVVhfQ0hfQSk7Ci0JfQotfQot
Ci1zdGF0aWMgaTkxNV9yZWdfdCB0Z2xfYXV4X2RhdGFfcmVnKHN0cnVjdCBpbnRlbF9kcCAqaW50
ZWxfZHAsIGludCBpbmRleCkKLXsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYg
PSBkcF90b19pOTE1KGludGVsX2RwKTsKLQlzdHJ1Y3QgaW50ZWxfZGlnaXRhbF9wb3J0ICpkaWdf
cG9ydCA9IGRwX3RvX2RpZ19wb3J0KGludGVsX2RwKTsKLQllbnVtIGF1eF9jaCBhdXhfY2ggPSBk
aWdfcG9ydC0+YXV4X2NoOwotCi0Jc3dpdGNoIChhdXhfY2gpIHsKLQljYXNlIEFVWF9DSF9BOgot
CWNhc2UgQVVYX0NIX0I6Ci0JY2FzZSBBVVhfQ0hfQzoKLQljYXNlIEFVWF9DSF9VU0JDMToKLQlj
YXNlIEFVWF9DSF9VU0JDMjoKLQljYXNlIEFVWF9DSF9VU0JDMzoKLQljYXNlIEFVWF9DSF9VU0JD
NDoKLQljYXNlIEFVWF9DSF9VU0JDNToKLQljYXNlIEFVWF9DSF9VU0JDNjoKLQkJcmV0dXJuIERQ
X0FVWF9DSF9EQVRBKGF1eF9jaCwgaW5kZXgpOwotCWRlZmF1bHQ6Ci0JCU1JU1NJTkdfQ0FTRShh
dXhfY2gpOwotCQlyZXR1cm4gRFBfQVVYX0NIX0RBVEEoQVVYX0NIX0EsIGluZGV4KTsKLQl9Ci19
Ci0KLXN0YXRpYyB2b2lkCi1pbnRlbF9kcF9hdXhfZmluaShzdHJ1Y3QgaW50ZWxfZHAgKmludGVs
X2RwKQotewotCWtmcmVlKGludGVsX2RwLT5hdXgubmFtZSk7Ci19Ci0KLXN0YXRpYyB2b2lkCi1p
bnRlbF9kcF9hdXhfaW5pdChzdHJ1Y3QgaW50ZWxfZHAgKmludGVsX2RwKQotewotCXN0cnVjdCBk
cm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IGRwX3RvX2k5MTUoaW50ZWxfZHApOwotCXN0cnVj
dCBpbnRlbF9kaWdpdGFsX3BvcnQgKmRpZ19wb3J0ID0gZHBfdG9fZGlnX3BvcnQoaW50ZWxfZHAp
OwotCXN0cnVjdCBpbnRlbF9lbmNvZGVyICplbmNvZGVyID0gJmRpZ19wb3J0LT5iYXNlOwotCWVu
dW0gYXV4X2NoIGF1eF9jaCA9IGRpZ19wb3J0LT5hdXhfY2g7Ci0KLQlpZiAoSU5URUxfR0VOKGRl
dl9wcml2KSA+PSAxMikgewotCQlpbnRlbF9kcC0+YXV4X2NoX2N0bF9yZWcgPSB0Z2xfYXV4X2N0
bF9yZWc7Ci0JCWludGVsX2RwLT5hdXhfY2hfZGF0YV9yZWcgPSB0Z2xfYXV4X2RhdGFfcmVnOwot
CX0gZWxzZSBpZiAoSU5URUxfR0VOKGRldl9wcml2KSA+PSA5KSB7Ci0JCWludGVsX2RwLT5hdXhf
Y2hfY3RsX3JlZyA9IHNrbF9hdXhfY3RsX3JlZzsKLQkJaW50ZWxfZHAtPmF1eF9jaF9kYXRhX3Jl
ZyA9IHNrbF9hdXhfZGF0YV9yZWc7Ci0JfSBlbHNlIGlmIChIQVNfUENIX1NQTElUKGRldl9wcml2
KSkgewotCQlpbnRlbF9kcC0+YXV4X2NoX2N0bF9yZWcgPSBpbGtfYXV4X2N0bF9yZWc7Ci0JCWlu
dGVsX2RwLT5hdXhfY2hfZGF0YV9yZWcgPSBpbGtfYXV4X2RhdGFfcmVnOwotCX0gZWxzZSB7Ci0J
CWludGVsX2RwLT5hdXhfY2hfY3RsX3JlZyA9IGc0eF9hdXhfY3RsX3JlZzsKLQkJaW50ZWxfZHAt
PmF1eF9jaF9kYXRhX3JlZyA9IGc0eF9hdXhfZGF0YV9yZWc7Ci0JfQotCi0JaWYgKElOVEVMX0dF
TihkZXZfcHJpdikgPj0gOSkKLQkJaW50ZWxfZHAtPmdldF9hdXhfY2xvY2tfZGl2aWRlciA9IHNr
bF9nZXRfYXV4X2Nsb2NrX2RpdmlkZXI7Ci0JZWxzZSBpZiAoSVNfQlJPQURXRUxMKGRldl9wcml2
KSB8fCBJU19IQVNXRUxMKGRldl9wcml2KSkKLQkJaW50ZWxfZHAtPmdldF9hdXhfY2xvY2tfZGl2
aWRlciA9IGhzd19nZXRfYXV4X2Nsb2NrX2RpdmlkZXI7Ci0JZWxzZSBpZiAoSEFTX1BDSF9TUExJ
VChkZXZfcHJpdikpCi0JCWludGVsX2RwLT5nZXRfYXV4X2Nsb2NrX2RpdmlkZXIgPSBpbGtfZ2V0
X2F1eF9jbG9ja19kaXZpZGVyOwotCWVsc2UKLQkJaW50ZWxfZHAtPmdldF9hdXhfY2xvY2tfZGl2
aWRlciA9IGc0eF9nZXRfYXV4X2Nsb2NrX2RpdmlkZXI7Ci0KLQlpZiAoSU5URUxfR0VOKGRldl9w
cml2KSA+PSA5KQotCQlpbnRlbF9kcC0+Z2V0X2F1eF9zZW5kX2N0bCA9IHNrbF9nZXRfYXV4X3Nl
bmRfY3RsOwotCWVsc2UKLQkJaW50ZWxfZHAtPmdldF9hdXhfc2VuZF9jdGwgPSBnNHhfZ2V0X2F1
eF9zZW5kX2N0bDsKLQotCWRybV9kcF9hdXhfaW5pdCgmaW50ZWxfZHAtPmF1eCk7Ci0KLQkvKiBG
YWlsdXJlIHRvIGFsbG9jYXRlIG91ciBwcmVmZXJyZWQgbmFtZSBpcyBub3QgY3JpdGljYWwgKi8K
LQlpZiAoSU5URUxfR0VOKGRldl9wcml2KSA+PSAxMiAmJiBhdXhfY2ggPj0gQVVYX0NIX1VTQkMx
KQotCQlpbnRlbF9kcC0+YXV4Lm5hbWUgPSBrYXNwcmludGYoR0ZQX0tFUk5FTCwgIkFVWCBVU0JD
JWMvJXMiLAotCQkJCQkgICAgICAgYXV4X2NoIC0gQVVYX0NIX1VTQkMxICsgJzEnLAotCQkJCQkg
ICAgICAgZW5jb2Rlci0+YmFzZS5uYW1lKTsKLQllbHNlCi0JCWludGVsX2RwLT5hdXgubmFtZSA9
IGthc3ByaW50ZihHRlBfS0VSTkVMLCAiQVVYICVjLyVzIiwKLQkJCQkJICAgICAgIGF1eF9jaF9u
YW1lKGF1eF9jaCksCi0JCQkJCSAgICAgICBlbmNvZGVyLT5iYXNlLm5hbWUpOwotCi0JaW50ZWxf
ZHAtPmF1eC50cmFuc2ZlciA9IGludGVsX2RwX2F1eF90cmFuc2ZlcjsKLX0KLQogYm9vbCBpbnRl
bF9kcF9zb3VyY2Vfc3VwcG9ydHNfaGJyMihzdHJ1Y3QgaW50ZWxfZHAgKmludGVsX2RwKQogewog
CWludCBtYXhfcmF0ZSA9IGludGVsX2RwLT5zb3VyY2VfcmF0ZXNbaW50ZWxfZHAtPm51bV9zb3Vy
Y2VfcmF0ZXMgLSAxXTsKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkv
aW50ZWxfZHBfYXV4LmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2RwX2F1
eC5jCm5ldyBmaWxlIG1vZGUgMTAwNjQ0CmluZGV4IDAwMDAwMDAwMDAwMC4uODkyOTRjMTQ0YzQ3
Ci0tLSAvZGV2L251bGwKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9k
cF9hdXguYwpAQCAtMCwwICsxLDY4MyBAQAorLy8gU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IE1J
VAorLyoKKyAqIENvcHlyaWdodCDCqSAyMDIwIEludGVsIENvcnBvcmF0aW9uCisgKi8KKworI2lu
Y2x1ZGUgImk5MTVfZHJ2LmgiCisjaW5jbHVkZSAiaTkxNV90cmFjZS5oIgorI2luY2x1ZGUgImlu
dGVsX2Rpc3BsYXlfdHlwZXMuaCIKKyNpbmNsdWRlICJpbnRlbF9kcF9hdXguaCIKKyNpbmNsdWRl
ICJpbnRlbF9wcHMuaCIKKyNpbmNsdWRlICJpbnRlbF90Yy5oIgorCit1MzIgaW50ZWxfZHBfcGFj
a19hdXgoY29uc3QgdTggKnNyYywgaW50IHNyY19ieXRlcykKK3sKKwlpbnQgaTsKKwl1MzIgdiA9
IDA7CisKKwlpZiAoc3JjX2J5dGVzID4gNCkKKwkJc3JjX2J5dGVzID0gNDsKKwlmb3IgKGkgPSAw
OyBpIDwgc3JjX2J5dGVzOyBpKyspCisJCXYgfD0gKCh1MzIpc3JjW2ldKSA8PCAoKDMgLSBpKSAq
IDgpOworCXJldHVybiB2OworfQorCitzdGF0aWMgdm9pZCBpbnRlbF9kcF91bnBhY2tfYXV4KHUz
MiBzcmMsIHU4ICpkc3QsIGludCBkc3RfYnl0ZXMpCit7CisJaW50IGk7CisJaWYgKGRzdF9ieXRl
cyA+IDQpCisJCWRzdF9ieXRlcyA9IDQ7CisJZm9yIChpID0gMDsgaSA8IGRzdF9ieXRlczsgaSsr
KQorCQlkc3RbaV0gPSBzcmMgPj4gKCgzLWkpICogOCk7Cit9CisKK3N0YXRpYyB1MzIKK2ludGVs
X2RwX2F1eF93YWl0X2RvbmUoc3RydWN0IGludGVsX2RwICppbnRlbF9kcCkKK3sKKwlzdHJ1Y3Qg
ZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IGRwX3RvX2k5MTUoaW50ZWxfZHApOworCWk5MTVfcmVn
X3QgY2hfY3RsID0gaW50ZWxfZHAtPmF1eF9jaF9jdGxfcmVnKGludGVsX2RwKTsKKwljb25zdCB1
bnNpZ25lZCBpbnQgdGltZW91dF9tcyA9IDEwOworCXUzMiBzdGF0dXM7CisJYm9vbCBkb25lOwor
CisjZGVmaW5lIEMgKCgoc3RhdHVzID0gaW50ZWxfdW5jb3JlX3JlYWRfbm90cmFjZSgmaTkxNS0+
dW5jb3JlLCBjaF9jdGwpKSAmIERQX0FVWF9DSF9DVExfU0VORF9CVVNZKSA9PSAwKQorCWRvbmUg
PSB3YWl0X2V2ZW50X3RpbWVvdXQoaTkxNS0+Z21idXNfd2FpdF9xdWV1ZSwgQywKKwkJCQkgIG1z
ZWNzX3RvX2ppZmZpZXNfdGltZW91dCh0aW1lb3V0X21zKSk7CisKKwkvKiBqdXN0IHRyYWNlIHRo
ZSBmaW5hbCB2YWx1ZSAqLworCXRyYWNlX2k5MTVfcmVnX3J3KGZhbHNlLCBjaF9jdGwsIHN0YXR1
cywgc2l6ZW9mKHN0YXR1cyksIHRydWUpOworCisJaWYgKCFkb25lKQorCQlkcm1fZXJyKCZpOTE1
LT5kcm0sCisJCQkiJXM6IGRpZCBub3QgY29tcGxldGUgb3IgdGltZW91dCB3aXRoaW4gJXVtcyAo
c3RhdHVzIDB4JTA4eClcbiIsCisJCQlpbnRlbF9kcC0+YXV4Lm5hbWUsIHRpbWVvdXRfbXMsIHN0
YXR1cyk7CisjdW5kZWYgQworCisJcmV0dXJuIHN0YXR1czsKK30KKworc3RhdGljIHUzMiBnNHhf
Z2V0X2F1eF9jbG9ja19kaXZpZGVyKHN0cnVjdCBpbnRlbF9kcCAqaW50ZWxfZHAsIGludCBpbmRl
eCkKK3sKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSBkcF90b19pOTE1KGlu
dGVsX2RwKTsKKworCWlmIChpbmRleCkKKwkJcmV0dXJuIDA7CisKKwkvKgorCSAqIFRoZSBjbG9j
ayBkaXZpZGVyIGlzIGJhc2VkIG9mZiB0aGUgaHJhd2NsaywgYW5kIHdvdWxkIGxpa2UgdG8gcnVu
IGF0CisJICogMk1Iei4gIFNvLCB0YWtlIHRoZSBocmF3Y2xrIHZhbHVlIGFuZCBkaXZpZGUgYnkg
MjAwMCBhbmQgdXNlIHRoYXQKKwkgKi8KKwlyZXR1cm4gRElWX1JPVU5EX0NMT1NFU1QoUlVOVElN
RV9JTkZPKGRldl9wcml2KS0+cmF3Y2xrX2ZyZXEsIDIwMDApOworfQorCitzdGF0aWMgdTMyIGls
a19nZXRfYXV4X2Nsb2NrX2RpdmlkZXIoc3RydWN0IGludGVsX2RwICppbnRlbF9kcCwgaW50IGlu
ZGV4KQoreworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IGRwX3RvX2k5MTUo
aW50ZWxfZHApOworCXN0cnVjdCBpbnRlbF9kaWdpdGFsX3BvcnQgKmRpZ19wb3J0ID0gZHBfdG9f
ZGlnX3BvcnQoaW50ZWxfZHApOworCXUzMiBmcmVxOworCisJaWYgKGluZGV4KQorCQlyZXR1cm4g
MDsKKworCS8qCisJICogVGhlIGNsb2NrIGRpdmlkZXIgaXMgYmFzZWQgb2ZmIHRoZSBjZGNsayBv
ciBQQ0ggcmF3Y2xrLCBhbmQgd291bGQKKwkgKiBsaWtlIHRvIHJ1biBhdCAyTUh6LiAgU28sIHRh
a2UgdGhlIGNkY2xrIG9yIFBDSCByYXdjbGsgdmFsdWUgYW5kCisJICogZGl2aWRlIGJ5IDIwMDAg
YW5kIHVzZSB0aGF0CisJICovCisJaWYgKGRpZ19wb3J0LT5hdXhfY2ggPT0gQVVYX0NIX0EpCisJ
CWZyZXEgPSBkZXZfcHJpdi0+Y2RjbGsuaHcuY2RjbGs7CisJZWxzZQorCQlmcmVxID0gUlVOVElN
RV9JTkZPKGRldl9wcml2KS0+cmF3Y2xrX2ZyZXE7CisJcmV0dXJuIERJVl9ST1VORF9DTE9TRVNU
KGZyZXEsIDIwMDApOworfQorCitzdGF0aWMgdTMyIGhzd19nZXRfYXV4X2Nsb2NrX2RpdmlkZXIo
c3RydWN0IGludGVsX2RwICppbnRlbF9kcCwgaW50IGluZGV4KQoreworCXN0cnVjdCBkcm1faTkx
NV9wcml2YXRlICpkZXZfcHJpdiA9IGRwX3RvX2k5MTUoaW50ZWxfZHApOworCXN0cnVjdCBpbnRl
bF9kaWdpdGFsX3BvcnQgKmRpZ19wb3J0ID0gZHBfdG9fZGlnX3BvcnQoaW50ZWxfZHApOworCisJ
aWYgKGRpZ19wb3J0LT5hdXhfY2ggIT0gQVVYX0NIX0EgJiYgSEFTX1BDSF9MUFRfSChkZXZfcHJp
dikpIHsKKwkJLyogV29ya2Fyb3VuZCBmb3Igbm9uLVVMVCBIU1cgKi8KKwkJc3dpdGNoIChpbmRl
eCkgeworCQljYXNlIDA6IHJldHVybiA2MzsKKwkJY2FzZSAxOiByZXR1cm4gNzI7CisJCWRlZmF1
bHQ6IHJldHVybiAwOworCQl9CisJfQorCisJcmV0dXJuIGlsa19nZXRfYXV4X2Nsb2NrX2Rpdmlk
ZXIoaW50ZWxfZHAsIGluZGV4KTsKK30KKworc3RhdGljIHUzMiBza2xfZ2V0X2F1eF9jbG9ja19k
aXZpZGVyKHN0cnVjdCBpbnRlbF9kcCAqaW50ZWxfZHAsIGludCBpbmRleCkKK3sKKwkvKgorCSAq
IFNLTCBkb2Vzbid0IG5lZWQgdXMgdG8gcHJvZ3JhbSB0aGUgQVVYIGNsb2NrIGRpdmlkZXIgKEhh
cmR3YXJlIHdpbGwKKwkgKiBkZXJpdmUgdGhlIGNsb2NrIGZyb20gQ0RDTEsgYXV0b21hdGljYWxs
eSkuIFdlIHN0aWxsIGltcGxlbWVudCB0aGUKKwkgKiBnZXRfYXV4X2Nsb2NrX2RpdmlkZXIgdmZ1
bmMgdG8gcGx1Zy1pbiBpbnRvIHRoZSBleGlzdGluZyBjb2RlLgorCSAqLworCXJldHVybiBpbmRl
eCA/IDAgOiAxOworfQorCitzdGF0aWMgdTMyIGc0eF9nZXRfYXV4X3NlbmRfY3RsKHN0cnVjdCBp
bnRlbF9kcCAqaW50ZWxfZHAsCisJCQkJaW50IHNlbmRfYnl0ZXMsCisJCQkJdTMyIGF1eF9jbG9j
a19kaXZpZGVyKQoreworCXN0cnVjdCBpbnRlbF9kaWdpdGFsX3BvcnQgKmRpZ19wb3J0ID0gZHBf
dG9fZGlnX3BvcnQoaW50ZWxfZHApOworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJp
diA9CisJCQl0b19pOTE1KGRpZ19wb3J0LT5iYXNlLmJhc2UuZGV2KTsKKwl1MzIgcHJlY2hhcmdl
LCB0aW1lb3V0OworCisJaWYgKElTX0dFTihkZXZfcHJpdiwgNikpCisJCXByZWNoYXJnZSA9IDM7
CisJZWxzZQorCQlwcmVjaGFyZ2UgPSA1OworCisJaWYgKElTX0JST0FEV0VMTChkZXZfcHJpdikp
CisJCXRpbWVvdXQgPSBEUF9BVVhfQ0hfQ1RMX1RJTUVfT1VUXzYwMHVzOworCWVsc2UKKwkJdGlt
ZW91dCA9IERQX0FVWF9DSF9DVExfVElNRV9PVVRfNDAwdXM7CisKKwlyZXR1cm4gRFBfQVVYX0NI
X0NUTF9TRU5EX0JVU1kgfAorCSAgICAgICBEUF9BVVhfQ0hfQ1RMX0RPTkUgfAorCSAgICAgICBE
UF9BVVhfQ0hfQ1RMX0lOVEVSUlVQVCB8CisJICAgICAgIERQX0FVWF9DSF9DVExfVElNRV9PVVRf
RVJST1IgfAorCSAgICAgICB0aW1lb3V0IHwKKwkgICAgICAgRFBfQVVYX0NIX0NUTF9SRUNFSVZF
X0VSUk9SIHwKKwkgICAgICAgKHNlbmRfYnl0ZXMgPDwgRFBfQVVYX0NIX0NUTF9NRVNTQUdFX1NJ
WkVfU0hJRlQpIHwKKwkgICAgICAgKHByZWNoYXJnZSA8PCBEUF9BVVhfQ0hfQ1RMX1BSRUNIQVJH
RV8yVVNfU0hJRlQpIHwKKwkgICAgICAgKGF1eF9jbG9ja19kaXZpZGVyIDw8IERQX0FVWF9DSF9D
VExfQklUX0NMT0NLXzJYX1NISUZUKTsKK30KKworc3RhdGljIHUzMiBza2xfZ2V0X2F1eF9zZW5k
X2N0bChzdHJ1Y3QgaW50ZWxfZHAgKmludGVsX2RwLAorCQkJCWludCBzZW5kX2J5dGVzLAorCQkJ
CXUzMiB1bnVzZWQpCit7CisJc3RydWN0IGludGVsX2RpZ2l0YWxfcG9ydCAqZGlnX3BvcnQgPSBk
cF90b19kaWdfcG9ydChpbnRlbF9kcCk7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUg
PQorCQkJdG9faTkxNShkaWdfcG9ydC0+YmFzZS5iYXNlLmRldik7CisJZW51bSBwaHkgcGh5ID0g
aW50ZWxfcG9ydF90b19waHkoaTkxNSwgZGlnX3BvcnQtPmJhc2UucG9ydCk7CisJdTMyIHJldDsK
KworCXJldCA9IERQX0FVWF9DSF9DVExfU0VORF9CVVNZIHwKKwkgICAgICBEUF9BVVhfQ0hfQ1RM
X0RPTkUgfAorCSAgICAgIERQX0FVWF9DSF9DVExfSU5URVJSVVBUIHwKKwkgICAgICBEUF9BVVhf
Q0hfQ1RMX1RJTUVfT1VUX0VSUk9SIHwKKwkgICAgICBEUF9BVVhfQ0hfQ1RMX1RJTUVfT1VUX01B
WCB8CisJICAgICAgRFBfQVVYX0NIX0NUTF9SRUNFSVZFX0VSUk9SIHwKKwkgICAgICAoc2VuZF9i
eXRlcyA8PCBEUF9BVVhfQ0hfQ1RMX01FU1NBR0VfU0laRV9TSElGVCkgfAorCSAgICAgIERQX0FV
WF9DSF9DVExfRldfU1lOQ19QVUxTRV9TS0woMzIpIHwKKwkgICAgICBEUF9BVVhfQ0hfQ1RMX1NZ
TkNfUFVMU0VfU0tMKDMyKTsKKworCWlmIChpbnRlbF9waHlfaXNfdGMoaTkxNSwgcGh5KSAmJgor
CSAgICBkaWdfcG9ydC0+dGNfbW9kZSA9PSBUQ19QT1JUX1RCVF9BTFQpCisJCXJldCB8PSBEUF9B
VVhfQ0hfQ1RMX1RCVF9JTzsKKworCXJldHVybiByZXQ7Cit9CisKK3N0YXRpYyBpbnQKK2ludGVs
X2RwX2F1eF94ZmVyKHN0cnVjdCBpbnRlbF9kcCAqaW50ZWxfZHAsCisJCSAgY29uc3QgdTggKnNl
bmQsIGludCBzZW5kX2J5dGVzLAorCQkgIHU4ICpyZWN2LCBpbnQgcmVjdl9zaXplLAorCQkgIHUz
MiBhdXhfc2VuZF9jdGxfZmxhZ3MpCit7CisJc3RydWN0IGludGVsX2RpZ2l0YWxfcG9ydCAqZGln
X3BvcnQgPSBkcF90b19kaWdfcG9ydChpbnRlbF9kcCk7CisJc3RydWN0IGRybV9pOTE1X3ByaXZh
dGUgKmk5MTUgPQorCQkJdG9faTkxNShkaWdfcG9ydC0+YmFzZS5iYXNlLmRldik7CisJc3RydWN0
IGludGVsX3VuY29yZSAqdW5jb3JlID0gJmk5MTUtPnVuY29yZTsKKwllbnVtIHBoeSBwaHkgPSBp
bnRlbF9wb3J0X3RvX3BoeShpOTE1LCBkaWdfcG9ydC0+YmFzZS5wb3J0KTsKKwlib29sIGlzX3Rj
X3BvcnQgPSBpbnRlbF9waHlfaXNfdGMoaTkxNSwgcGh5KTsKKwlpOTE1X3JlZ190IGNoX2N0bCwg
Y2hfZGF0YVs1XTsKKwl1MzIgYXV4X2Nsb2NrX2RpdmlkZXI7CisJZW51bSBpbnRlbF9kaXNwbGF5
X3Bvd2VyX2RvbWFpbiBhdXhfZG9tYWluOworCWludGVsX3dha2VyZWZfdCBhdXhfd2FrZXJlZjsK
KwlpbnRlbF93YWtlcmVmX3QgcHBzX3dha2VyZWY7CisJaW50IGksIHJldCwgcmVjdl9ieXRlczsK
KwlpbnQgdHJ5LCBjbG9jayA9IDA7CisJdTMyIHN0YXR1czsKKwlib29sIHZkZDsKKworCWNoX2N0
bCA9IGludGVsX2RwLT5hdXhfY2hfY3RsX3JlZyhpbnRlbF9kcCk7CisJZm9yIChpID0gMDsgaSA8
IEFSUkFZX1NJWkUoY2hfZGF0YSk7IGkrKykKKwkJY2hfZGF0YVtpXSA9IGludGVsX2RwLT5hdXhf
Y2hfZGF0YV9yZWcoaW50ZWxfZHAsIGkpOworCisJaWYgKGlzX3RjX3BvcnQpCisJCWludGVsX3Rj
X3BvcnRfbG9jayhkaWdfcG9ydCk7CisKKwlhdXhfZG9tYWluID0gaW50ZWxfYXV4X3Bvd2VyX2Rv
bWFpbihkaWdfcG9ydCk7CisKKwlhdXhfd2FrZXJlZiA9IGludGVsX2Rpc3BsYXlfcG93ZXJfZ2V0
KGk5MTUsIGF1eF9kb21haW4pOworCXBwc193YWtlcmVmID0gaW50ZWxfcHBzX2xvY2soaW50ZWxf
ZHApOworCisJLyoKKwkgKiBXZSB3aWxsIGJlIGNhbGxlZCB3aXRoIFZERCBhbHJlYWR5IGVuYWJs
ZWQgZm9yIGRwY2QvZWRpZC9vdWkgcmVhZHMuCisJICogSW4gc3VjaCBjYXNlcyB3ZSB3YW50IHRv
IGxlYXZlIFZERCBlbmFibGVkIGFuZCBpdCdzIHVwIHRvIHVwcGVyIGxheWVycworCSAqIHRvIHR1
cm4gaXQgb2ZmLiBCdXQgZm9yIGVnLiBpMmMtZGV2IGFjY2VzcyB3ZSBuZWVkIHRvIHR1cm4gaXQg
b24vb2ZmCisJICogb3Vyc2VsdmVzLgorCSAqLworCXZkZCA9IGludGVsX3Bwc192ZGRfb25fdW5s
b2NrZWQoaW50ZWxfZHApOworCisJLyogZHAgYXV4IGlzIGV4dHJlbWVseSBzZW5zaXRpdmUgdG8g
aXJxIGxhdGVuY3ksIGhlbmNlIHJlcXVlc3QgdGhlCisJICogbG93ZXN0IHBvc3NpYmxlIHdha2V1
cCBsYXRlbmN5IGFuZCBzbyBwcmV2ZW50IHRoZSBjcHUgZnJvbSBnb2luZyBpbnRvCisJICogZGVl
cCBzbGVlcCBzdGF0ZXMuCisJICovCisJY3B1X2xhdGVuY3lfcW9zX3VwZGF0ZV9yZXF1ZXN0KCZp
OTE1LT5wbV9xb3MsIDApOworCisJaW50ZWxfcHBzX2NoZWNrX3Bvd2VyX3VubG9ja2VkKGludGVs
X2RwKTsKKworCS8qIFRyeSB0byB3YWl0IGZvciBhbnkgcHJldmlvdXMgQVVYIGNoYW5uZWwgYWN0
aXZpdHkgKi8KKwlmb3IgKHRyeSA9IDA7IHRyeSA8IDM7IHRyeSsrKSB7CisJCXN0YXR1cyA9IGlu
dGVsX3VuY29yZV9yZWFkX25vdHJhY2UodW5jb3JlLCBjaF9jdGwpOworCQlpZiAoKHN0YXR1cyAm
IERQX0FVWF9DSF9DVExfU0VORF9CVVNZKSA9PSAwKQorCQkJYnJlYWs7CisJCW1zbGVlcCgxKTsK
Kwl9CisJLyoganVzdCB0cmFjZSB0aGUgZmluYWwgdmFsdWUgKi8KKwl0cmFjZV9pOTE1X3JlZ19y
dyhmYWxzZSwgY2hfY3RsLCBzdGF0dXMsIHNpemVvZihzdGF0dXMpLCB0cnVlKTsKKworCWlmICh0
cnkgPT0gMykgeworCQljb25zdCB1MzIgc3RhdHVzID0gaW50ZWxfdW5jb3JlX3JlYWQodW5jb3Jl
LCBjaF9jdGwpOworCisJCWlmIChzdGF0dXMgIT0gaW50ZWxfZHAtPmF1eF9idXN5X2xhc3Rfc3Rh
dHVzKSB7CisJCQlkcm1fV0FSTigmaTkxNS0+ZHJtLCAxLAorCQkJCSAiJXM6IG5vdCBzdGFydGVk
IChzdGF0dXMgMHglMDh4KVxuIiwKKwkJCQkgaW50ZWxfZHAtPmF1eC5uYW1lLCBzdGF0dXMpOwor
CQkJaW50ZWxfZHAtPmF1eF9idXN5X2xhc3Rfc3RhdHVzID0gc3RhdHVzOworCQl9CisKKwkJcmV0
ID0gLUVCVVNZOworCQlnb3RvIG91dDsKKwl9CisKKwkvKiBPbmx5IDUgZGF0YSByZWdpc3RlcnMh
ICovCisJaWYgKGRybV9XQVJOX09OKCZpOTE1LT5kcm0sIHNlbmRfYnl0ZXMgPiAyMCB8fCByZWN2
X3NpemUgPiAyMCkpIHsKKwkJcmV0ID0gLUUyQklHOworCQlnb3RvIG91dDsKKwl9CisKKwl3aGls
ZSAoKGF1eF9jbG9ja19kaXZpZGVyID0gaW50ZWxfZHAtPmdldF9hdXhfY2xvY2tfZGl2aWRlcihp
bnRlbF9kcCwgY2xvY2srKykpKSB7CisJCXUzMiBzZW5kX2N0bCA9IGludGVsX2RwLT5nZXRfYXV4
X3NlbmRfY3RsKGludGVsX2RwLAorCQkJCQkJCSAgc2VuZF9ieXRlcywKKwkJCQkJCQkgIGF1eF9j
bG9ja19kaXZpZGVyKTsKKworCQlzZW5kX2N0bCB8PSBhdXhfc2VuZF9jdGxfZmxhZ3M7CisKKwkJ
LyogTXVzdCB0cnkgYXQgbGVhc3QgMyB0aW1lcyBhY2NvcmRpbmcgdG8gRFAgc3BlYyAqLworCQlm
b3IgKHRyeSA9IDA7IHRyeSA8IDU7IHRyeSsrKSB7CisJCQkvKiBMb2FkIHRoZSBzZW5kIGRhdGEg
aW50byB0aGUgYXV4IGNoYW5uZWwgZGF0YSByZWdpc3RlcnMgKi8KKwkJCWZvciAoaSA9IDA7IGkg
PCBzZW5kX2J5dGVzOyBpICs9IDQpCisJCQkJaW50ZWxfdW5jb3JlX3dyaXRlKHVuY29yZSwKKwkJ
CQkJCSAgIGNoX2RhdGFbaSA+PiAyXSwKKwkJCQkJCSAgIGludGVsX2RwX3BhY2tfYXV4KHNlbmQg
KyBpLAorCQkJCQkJCQkgICAgIHNlbmRfYnl0ZXMgLSBpKSk7CisKKwkJCS8qIFNlbmQgdGhlIGNv
bW1hbmQgYW5kIHdhaXQgZm9yIGl0IHRvIGNvbXBsZXRlICovCisJCQlpbnRlbF91bmNvcmVfd3Jp
dGUodW5jb3JlLCBjaF9jdGwsIHNlbmRfY3RsKTsKKworCQkJc3RhdHVzID0gaW50ZWxfZHBfYXV4
X3dhaXRfZG9uZShpbnRlbF9kcCk7CisKKwkJCS8qIENsZWFyIGRvbmUgc3RhdHVzIGFuZCBhbnkg
ZXJyb3JzICovCisJCQlpbnRlbF91bmNvcmVfd3JpdGUodW5jb3JlLAorCQkJCQkgICBjaF9jdGws
CisJCQkJCSAgIHN0YXR1cyB8CisJCQkJCSAgIERQX0FVWF9DSF9DVExfRE9ORSB8CisJCQkJCSAg
IERQX0FVWF9DSF9DVExfVElNRV9PVVRfRVJST1IgfAorCQkJCQkgICBEUF9BVVhfQ0hfQ1RMX1JF
Q0VJVkVfRVJST1IpOworCisJCQkvKiBEUCBDVFMgMS4yIENvcmUgUmV2IDEuMSwgNC4yLjEuMSAm
IDQuMi4xLjIKKwkJCSAqICAgNDAwdXMgZGVsYXkgcmVxdWlyZWQgZm9yIGVycm9ycyBhbmQgdGlt
ZW91dHMKKwkJCSAqICAgVGltZW91dCBlcnJvcnMgZnJvbSB0aGUgSFcgYWxyZWFkeSBtZWV0IHRo
aXMKKwkJCSAqICAgcmVxdWlyZW1lbnQgc28gc2tpcCB0byBuZXh0IGl0ZXJhdGlvbgorCQkJICov
CisJCQlpZiAoc3RhdHVzICYgRFBfQVVYX0NIX0NUTF9USU1FX09VVF9FUlJPUikKKwkJCQljb250
aW51ZTsKKworCQkJaWYgKHN0YXR1cyAmIERQX0FVWF9DSF9DVExfUkVDRUlWRV9FUlJPUikgewor
CQkJCXVzbGVlcF9yYW5nZSg0MDAsIDUwMCk7CisJCQkJY29udGludWU7CisJCQl9CisJCQlpZiAo
c3RhdHVzICYgRFBfQVVYX0NIX0NUTF9ET05FKQorCQkJCWdvdG8gZG9uZTsKKwkJfQorCX0KKwor
CWlmICgoc3RhdHVzICYgRFBfQVVYX0NIX0NUTF9ET05FKSA9PSAwKSB7CisJCWRybV9lcnIoJmk5
MTUtPmRybSwgIiVzOiBub3QgZG9uZSAoc3RhdHVzIDB4JTA4eClcbiIsCisJCQlpbnRlbF9kcC0+
YXV4Lm5hbWUsIHN0YXR1cyk7CisJCXJldCA9IC1FQlVTWTsKKwkJZ290byBvdXQ7CisJfQorCitk
b25lOgorCS8qIENoZWNrIGZvciB0aW1lb3V0IG9yIHJlY2VpdmUgZXJyb3IuCisJICogVGltZW91
dHMgb2NjdXIgd2hlbiB0aGUgc2luayBpcyBub3QgY29ubmVjdGVkCisJICovCisJaWYgKHN0YXR1
cyAmIERQX0FVWF9DSF9DVExfUkVDRUlWRV9FUlJPUikgeworCQlkcm1fZXJyKCZpOTE1LT5kcm0s
ICIlczogcmVjZWl2ZSBlcnJvciAoc3RhdHVzIDB4JTA4eClcbiIsCisJCQlpbnRlbF9kcC0+YXV4
Lm5hbWUsIHN0YXR1cyk7CisJCXJldCA9IC1FSU87CisJCWdvdG8gb3V0OworCX0KKworCS8qIFRp
bWVvdXRzIG9jY3VyIHdoZW4gdGhlIGRldmljZSBpc24ndCBjb25uZWN0ZWQsIHNvIHRoZXkncmUK
KwkgKiAibm9ybWFsIiAtLSBkb24ndCBmaWxsIHRoZSBrZXJuZWwgbG9nIHdpdGggdGhlc2UgKi8K
KwlpZiAoc3RhdHVzICYgRFBfQVVYX0NIX0NUTF9USU1FX09VVF9FUlJPUikgeworCQlkcm1fZGJn
X2ttcygmaTkxNS0+ZHJtLCAiJXM6IHRpbWVvdXQgKHN0YXR1cyAweCUwOHgpXG4iLAorCQkJICAg
IGludGVsX2RwLT5hdXgubmFtZSwgc3RhdHVzKTsKKwkJcmV0ID0gLUVUSU1FRE9VVDsKKwkJZ290
byBvdXQ7CisJfQorCisJLyogVW5sb2FkIGFueSBieXRlcyBzZW50IGJhY2sgZnJvbSB0aGUgb3Ro
ZXIgc2lkZSAqLworCXJlY3ZfYnl0ZXMgPSAoKHN0YXR1cyAmIERQX0FVWF9DSF9DVExfTUVTU0FH
RV9TSVpFX01BU0spID4+CisJCSAgICAgIERQX0FVWF9DSF9DVExfTUVTU0FHRV9TSVpFX1NISUZU
KTsKKworCS8qCisJICogQnkgQlNwZWM6ICJNZXNzYWdlIHNpemVzIG9mIDAgb3IgPjIwIGFyZSBu
b3QgYWxsb3dlZC4iCisJICogV2UgaGF2ZSBubyBpZGVhIG9mIHdoYXQgaGFwcGVuZWQgc28gd2Ug
cmV0dXJuIC1FQlVTWSBzbworCSAqIGRybSBsYXllciB0YWtlcyBjYXJlIGZvciB0aGUgbmVjZXNz
YXJ5IHJldHJpZXMuCisJICovCisJaWYgKHJlY3ZfYnl0ZXMgPT0gMCB8fCByZWN2X2J5dGVzID4g
MjApIHsKKwkJZHJtX2RiZ19rbXMoJmk5MTUtPmRybSwKKwkJCSAgICAiJXM6IEZvcmJpZGRlbiBy
ZWN2X2J5dGVzID0gJWQgb24gYXV4IHRyYW5zYWN0aW9uXG4iLAorCQkJICAgIGludGVsX2RwLT5h
dXgubmFtZSwgcmVjdl9ieXRlcyk7CisJCXJldCA9IC1FQlVTWTsKKwkJZ290byBvdXQ7CisJfQor
CisJaWYgKHJlY3ZfYnl0ZXMgPiByZWN2X3NpemUpCisJCXJlY3ZfYnl0ZXMgPSByZWN2X3NpemU7
CisKKwlmb3IgKGkgPSAwOyBpIDwgcmVjdl9ieXRlczsgaSArPSA0KQorCQlpbnRlbF9kcF91bnBh
Y2tfYXV4KGludGVsX3VuY29yZV9yZWFkKHVuY29yZSwgY2hfZGF0YVtpID4+IDJdKSwKKwkJCQkg
ICAgcmVjdiArIGksIHJlY3ZfYnl0ZXMgLSBpKTsKKworCXJldCA9IHJlY3ZfYnl0ZXM7CitvdXQ6
CisJY3B1X2xhdGVuY3lfcW9zX3VwZGF0ZV9yZXF1ZXN0KCZpOTE1LT5wbV9xb3MsIFBNX1FPU19E
RUZBVUxUX1ZBTFVFKTsKKworCWlmICh2ZGQpCisJCWludGVsX3Bwc192ZGRfb2ZmX3VubG9ja2Vk
KGludGVsX2RwLCBmYWxzZSk7CisKKwlpbnRlbF9wcHNfdW5sb2NrKGludGVsX2RwLCBwcHNfd2Fr
ZXJlZik7CisJaW50ZWxfZGlzcGxheV9wb3dlcl9wdXRfYXN5bmMoaTkxNSwgYXV4X2RvbWFpbiwg
YXV4X3dha2VyZWYpOworCisJaWYgKGlzX3RjX3BvcnQpCisJCWludGVsX3RjX3BvcnRfdW5sb2Nr
KGRpZ19wb3J0KTsKKworCXJldHVybiByZXQ7Cit9CisKKyNkZWZpbmUgQkFSRV9BRERSRVNTX1NJ
WkUJMworI2RlZmluZSBIRUFERVJfU0laRQkJKEJBUkVfQUREUkVTU19TSVpFICsgMSkKKworc3Rh
dGljIHZvaWQKK2ludGVsX2RwX2F1eF9oZWFkZXIodTggdHhidWZbSEVBREVSX1NJWkVdLAorCQkg
ICAgY29uc3Qgc3RydWN0IGRybV9kcF9hdXhfbXNnICptc2cpCit7CisJdHhidWZbMF0gPSAobXNn
LT5yZXF1ZXN0IDw8IDQpIHwgKChtc2ctPmFkZHJlc3MgPj4gMTYpICYgMHhmKTsKKwl0eGJ1Zlsx
XSA9IChtc2ctPmFkZHJlc3MgPj4gOCkgJiAweGZmOworCXR4YnVmWzJdID0gbXNnLT5hZGRyZXNz
ICYgMHhmZjsKKwl0eGJ1ZlszXSA9IG1zZy0+c2l6ZSAtIDE7Cit9CisKK3N0YXRpYyB1MzIgaW50
ZWxfZHBfYXV4X3hmZXJfZmxhZ3MoY29uc3Qgc3RydWN0IGRybV9kcF9hdXhfbXNnICptc2cpCit7
CisJLyoKKwkgKiBJZiB3ZSdyZSB0cnlpbmcgdG8gc2VuZCB0aGUgSERDUCBBa3N2LCB3ZSBuZWVk
IHRvIHNldCBhIHRoZSBBa3N2CisJICogc2VsZWN0IGJpdCB0byBpbmZvcm0gdGhlIGhhcmR3YXJl
IHRvIHNlbmQgdGhlIEFrc3YgYWZ0ZXIgb3VyIGhlYWRlcgorCSAqIHNpbmNlIHdlIGNhbid0IGFj
Y2VzcyB0aGF0IGRhdGEgZnJvbSBzb2Z0d2FyZS4KKwkgKi8KKwlpZiAoKG1zZy0+cmVxdWVzdCAm
IH5EUF9BVVhfSTJDX01PVCkgPT0gRFBfQVVYX05BVElWRV9XUklURSAmJgorCSAgICBtc2ctPmFk
ZHJlc3MgPT0gRFBfQVVYX0hEQ1BfQUtTVikKKwkJcmV0dXJuIERQX0FVWF9DSF9DVExfQVVYX0FL
U1ZfU0VMRUNUOworCisJcmV0dXJuIDA7Cit9CisKK3N0YXRpYyBzc2l6ZV90CitpbnRlbF9kcF9h
dXhfdHJhbnNmZXIoc3RydWN0IGRybV9kcF9hdXggKmF1eCwgc3RydWN0IGRybV9kcF9hdXhfbXNn
ICptc2cpCit7CisJc3RydWN0IGludGVsX2RwICppbnRlbF9kcCA9IGNvbnRhaW5lcl9vZihhdXgs
IHN0cnVjdCBpbnRlbF9kcCwgYXV4KTsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9
IGRwX3RvX2k5MTUoaW50ZWxfZHApOworCXU4IHR4YnVmWzIwXSwgcnhidWZbMjBdOworCXNpemVf
dCB0eHNpemUsIHJ4c2l6ZTsKKwl1MzIgZmxhZ3MgPSBpbnRlbF9kcF9hdXhfeGZlcl9mbGFncyht
c2cpOworCWludCByZXQ7CisKKwlpbnRlbF9kcF9hdXhfaGVhZGVyKHR4YnVmLCBtc2cpOworCisJ
c3dpdGNoIChtc2ctPnJlcXVlc3QgJiB+RFBfQVVYX0kyQ19NT1QpIHsKKwljYXNlIERQX0FVWF9O
QVRJVkVfV1JJVEU6CisJY2FzZSBEUF9BVVhfSTJDX1dSSVRFOgorCWNhc2UgRFBfQVVYX0kyQ19X
UklURV9TVEFUVVNfVVBEQVRFOgorCQl0eHNpemUgPSBtc2ctPnNpemUgPyBIRUFERVJfU0laRSAr
IG1zZy0+c2l6ZSA6IEJBUkVfQUREUkVTU19TSVpFOworCQlyeHNpemUgPSAyOyAvKiAwIG9yIDEg
ZGF0YSBieXRlcyAqLworCisJCWlmIChkcm1fV0FSTl9PTigmaTkxNS0+ZHJtLCB0eHNpemUgPiAy
MCkpCisJCQlyZXR1cm4gLUUyQklHOworCisJCWRybV9XQVJOX09OKCZpOTE1LT5kcm0sICFtc2ct
PmJ1ZmZlciAhPSAhbXNnLT5zaXplKTsKKworCQlpZiAobXNnLT5idWZmZXIpCisJCQltZW1jcHko
dHhidWYgKyBIRUFERVJfU0laRSwgbXNnLT5idWZmZXIsIG1zZy0+c2l6ZSk7CisKKwkJcmV0ID0g
aW50ZWxfZHBfYXV4X3hmZXIoaW50ZWxfZHAsIHR4YnVmLCB0eHNpemUsCisJCQkJCXJ4YnVmLCBy
eHNpemUsIGZsYWdzKTsKKwkJaWYgKHJldCA+IDApIHsKKwkJCW1zZy0+cmVwbHkgPSByeGJ1Zlsw
XSA+PiA0OworCisJCQlpZiAocmV0ID4gMSkgeworCQkJCS8qIE51bWJlciBvZiBieXRlcyB3cml0
dGVuIGluIGEgc2hvcnQgd3JpdGUuICovCisJCQkJcmV0ID0gY2xhbXBfdChpbnQsIHJ4YnVmWzFd
LCAwLCBtc2ctPnNpemUpOworCQkJfSBlbHNlIHsKKwkJCQkvKiBSZXR1cm4gcGF5bG9hZCBzaXpl
LiAqLworCQkJCXJldCA9IG1zZy0+c2l6ZTsKKwkJCX0KKwkJfQorCQlicmVhazsKKworCWNhc2Ug
RFBfQVVYX05BVElWRV9SRUFEOgorCWNhc2UgRFBfQVVYX0kyQ19SRUFEOgorCQl0eHNpemUgPSBt
c2ctPnNpemUgPyBIRUFERVJfU0laRSA6IEJBUkVfQUREUkVTU19TSVpFOworCQlyeHNpemUgPSBt
c2ctPnNpemUgKyAxOworCisJCWlmIChkcm1fV0FSTl9PTigmaTkxNS0+ZHJtLCByeHNpemUgPiAy
MCkpCisJCQlyZXR1cm4gLUUyQklHOworCisJCXJldCA9IGludGVsX2RwX2F1eF94ZmVyKGludGVs
X2RwLCB0eGJ1ZiwgdHhzaXplLAorCQkJCQlyeGJ1ZiwgcnhzaXplLCBmbGFncyk7CisJCWlmIChy
ZXQgPiAwKSB7CisJCQltc2ctPnJlcGx5ID0gcnhidWZbMF0gPj4gNDsKKwkJCS8qCisJCQkgKiBB
c3N1bWUgaGFwcHkgZGF5LCBhbmQgY29weSB0aGUgZGF0YS4gVGhlIGNhbGxlciBpcworCQkJICog
ZXhwZWN0ZWQgdG8gY2hlY2sgbXNnLT5yZXBseSBiZWZvcmUgdG91Y2hpbmcgaXQuCisJCQkgKgor
CQkJICogUmV0dXJuIHBheWxvYWQgc2l6ZS4KKwkJCSAqLworCQkJcmV0LS07CisJCQltZW1jcHko
bXNnLT5idWZmZXIsIHJ4YnVmICsgMSwgcmV0KTsKKwkJfQorCQlicmVhazsKKworCWRlZmF1bHQ6
CisJCXJldCA9IC1FSU5WQUw7CisJCWJyZWFrOworCX0KKworCXJldHVybiByZXQ7Cit9CisKKwor
c3RhdGljIGk5MTVfcmVnX3QgZzR4X2F1eF9jdGxfcmVnKHN0cnVjdCBpbnRlbF9kcCAqaW50ZWxf
ZHApCit7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gZHBfdG9faTkxNShp
bnRlbF9kcCk7CisJc3RydWN0IGludGVsX2RpZ2l0YWxfcG9ydCAqZGlnX3BvcnQgPSBkcF90b19k
aWdfcG9ydChpbnRlbF9kcCk7CisJZW51bSBhdXhfY2ggYXV4X2NoID0gZGlnX3BvcnQtPmF1eF9j
aDsKKworCXN3aXRjaCAoYXV4X2NoKSB7CisJY2FzZSBBVVhfQ0hfQjoKKwljYXNlIEFVWF9DSF9D
OgorCWNhc2UgQVVYX0NIX0Q6CisJCXJldHVybiBEUF9BVVhfQ0hfQ1RMKGF1eF9jaCk7CisJZGVm
YXVsdDoKKwkJTUlTU0lOR19DQVNFKGF1eF9jaCk7CisJCXJldHVybiBEUF9BVVhfQ0hfQ1RMKEFV
WF9DSF9CKTsKKwl9Cit9CisKK3N0YXRpYyBpOTE1X3JlZ190IGc0eF9hdXhfZGF0YV9yZWcoc3Ry
dWN0IGludGVsX2RwICppbnRlbF9kcCwgaW50IGluZGV4KQoreworCXN0cnVjdCBkcm1faTkxNV9w
cml2YXRlICpkZXZfcHJpdiA9IGRwX3RvX2k5MTUoaW50ZWxfZHApOworCXN0cnVjdCBpbnRlbF9k
aWdpdGFsX3BvcnQgKmRpZ19wb3J0ID0gZHBfdG9fZGlnX3BvcnQoaW50ZWxfZHApOworCWVudW0g
YXV4X2NoIGF1eF9jaCA9IGRpZ19wb3J0LT5hdXhfY2g7CisKKwlzd2l0Y2ggKGF1eF9jaCkgewor
CWNhc2UgQVVYX0NIX0I6CisJY2FzZSBBVVhfQ0hfQzoKKwljYXNlIEFVWF9DSF9EOgorCQlyZXR1
cm4gRFBfQVVYX0NIX0RBVEEoYXV4X2NoLCBpbmRleCk7CisJZGVmYXVsdDoKKwkJTUlTU0lOR19D
QVNFKGF1eF9jaCk7CisJCXJldHVybiBEUF9BVVhfQ0hfREFUQShBVVhfQ0hfQiwgaW5kZXgpOwor
CX0KK30KKworc3RhdGljIGk5MTVfcmVnX3QgaWxrX2F1eF9jdGxfcmVnKHN0cnVjdCBpbnRlbF9k
cCAqaW50ZWxfZHApCit7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gZHBf
dG9faTkxNShpbnRlbF9kcCk7CisJc3RydWN0IGludGVsX2RpZ2l0YWxfcG9ydCAqZGlnX3BvcnQg
PSBkcF90b19kaWdfcG9ydChpbnRlbF9kcCk7CisJZW51bSBhdXhfY2ggYXV4X2NoID0gZGlnX3Bv
cnQtPmF1eF9jaDsKKworCXN3aXRjaCAoYXV4X2NoKSB7CisJY2FzZSBBVVhfQ0hfQToKKwkJcmV0
dXJuIERQX0FVWF9DSF9DVEwoYXV4X2NoKTsKKwljYXNlIEFVWF9DSF9COgorCWNhc2UgQVVYX0NI
X0M6CisJY2FzZSBBVVhfQ0hfRDoKKwkJcmV0dXJuIFBDSF9EUF9BVVhfQ0hfQ1RMKGF1eF9jaCk7
CisJZGVmYXVsdDoKKwkJTUlTU0lOR19DQVNFKGF1eF9jaCk7CisJCXJldHVybiBEUF9BVVhfQ0hf
Q1RMKEFVWF9DSF9BKTsKKwl9Cit9CisKK3N0YXRpYyBpOTE1X3JlZ190IGlsa19hdXhfZGF0YV9y
ZWcoc3RydWN0IGludGVsX2RwICppbnRlbF9kcCwgaW50IGluZGV4KQoreworCXN0cnVjdCBkcm1f
aTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IGRwX3RvX2k5MTUoaW50ZWxfZHApOworCXN0cnVjdCBp
bnRlbF9kaWdpdGFsX3BvcnQgKmRpZ19wb3J0ID0gZHBfdG9fZGlnX3BvcnQoaW50ZWxfZHApOwor
CWVudW0gYXV4X2NoIGF1eF9jaCA9IGRpZ19wb3J0LT5hdXhfY2g7CisKKwlzd2l0Y2ggKGF1eF9j
aCkgeworCWNhc2UgQVVYX0NIX0E6CisJCXJldHVybiBEUF9BVVhfQ0hfREFUQShhdXhfY2gsIGlu
ZGV4KTsKKwljYXNlIEFVWF9DSF9COgorCWNhc2UgQVVYX0NIX0M6CisJY2FzZSBBVVhfQ0hfRDoK
KwkJcmV0dXJuIFBDSF9EUF9BVVhfQ0hfREFUQShhdXhfY2gsIGluZGV4KTsKKwlkZWZhdWx0Ogor
CQlNSVNTSU5HX0NBU0UoYXV4X2NoKTsKKwkJcmV0dXJuIERQX0FVWF9DSF9EQVRBKEFVWF9DSF9B
LCBpbmRleCk7CisJfQorfQorCitzdGF0aWMgaTkxNV9yZWdfdCBza2xfYXV4X2N0bF9yZWcoc3Ry
dWN0IGludGVsX2RwICppbnRlbF9kcCkKK3sKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2
X3ByaXYgPSBkcF90b19pOTE1KGludGVsX2RwKTsKKwlzdHJ1Y3QgaW50ZWxfZGlnaXRhbF9wb3J0
ICpkaWdfcG9ydCA9IGRwX3RvX2RpZ19wb3J0KGludGVsX2RwKTsKKwllbnVtIGF1eF9jaCBhdXhf
Y2ggPSBkaWdfcG9ydC0+YXV4X2NoOworCisJc3dpdGNoIChhdXhfY2gpIHsKKwljYXNlIEFVWF9D
SF9BOgorCWNhc2UgQVVYX0NIX0I6CisJY2FzZSBBVVhfQ0hfQzoKKwljYXNlIEFVWF9DSF9EOgor
CWNhc2UgQVVYX0NIX0U6CisJY2FzZSBBVVhfQ0hfRjoKKwkJcmV0dXJuIERQX0FVWF9DSF9DVEwo
YXV4X2NoKTsKKwlkZWZhdWx0OgorCQlNSVNTSU5HX0NBU0UoYXV4X2NoKTsKKwkJcmV0dXJuIERQ
X0FVWF9DSF9DVEwoQVVYX0NIX0EpOworCX0KK30KKworc3RhdGljIGk5MTVfcmVnX3Qgc2tsX2F1
eF9kYXRhX3JlZyhzdHJ1Y3QgaW50ZWxfZHAgKmludGVsX2RwLCBpbnQgaW5kZXgpCit7CisJc3Ry
dWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gZHBfdG9faTkxNShpbnRlbF9kcCk7CisJ
c3RydWN0IGludGVsX2RpZ2l0YWxfcG9ydCAqZGlnX3BvcnQgPSBkcF90b19kaWdfcG9ydChpbnRl
bF9kcCk7CisJZW51bSBhdXhfY2ggYXV4X2NoID0gZGlnX3BvcnQtPmF1eF9jaDsKKworCXN3aXRj
aCAoYXV4X2NoKSB7CisJY2FzZSBBVVhfQ0hfQToKKwljYXNlIEFVWF9DSF9COgorCWNhc2UgQVVY
X0NIX0M6CisJY2FzZSBBVVhfQ0hfRDoKKwljYXNlIEFVWF9DSF9FOgorCWNhc2UgQVVYX0NIX0Y6
CisJCXJldHVybiBEUF9BVVhfQ0hfREFUQShhdXhfY2gsIGluZGV4KTsKKwlkZWZhdWx0OgorCQlN
SVNTSU5HX0NBU0UoYXV4X2NoKTsKKwkJcmV0dXJuIERQX0FVWF9DSF9EQVRBKEFVWF9DSF9BLCBp
bmRleCk7CisJfQorfQorCitzdGF0aWMgaTkxNV9yZWdfdCB0Z2xfYXV4X2N0bF9yZWcoc3RydWN0
IGludGVsX2RwICppbnRlbF9kcCkKK3sKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3By
aXYgPSBkcF90b19pOTE1KGludGVsX2RwKTsKKwlzdHJ1Y3QgaW50ZWxfZGlnaXRhbF9wb3J0ICpk
aWdfcG9ydCA9IGRwX3RvX2RpZ19wb3J0KGludGVsX2RwKTsKKwllbnVtIGF1eF9jaCBhdXhfY2gg
PSBkaWdfcG9ydC0+YXV4X2NoOworCisJc3dpdGNoIChhdXhfY2gpIHsKKwljYXNlIEFVWF9DSF9B
OgorCWNhc2UgQVVYX0NIX0I6CisJY2FzZSBBVVhfQ0hfQzoKKwljYXNlIEFVWF9DSF9VU0JDMToK
KwljYXNlIEFVWF9DSF9VU0JDMjoKKwljYXNlIEFVWF9DSF9VU0JDMzoKKwljYXNlIEFVWF9DSF9V
U0JDNDoKKwljYXNlIEFVWF9DSF9VU0JDNToKKwljYXNlIEFVWF9DSF9VU0JDNjoKKwkJcmV0dXJu
IERQX0FVWF9DSF9DVEwoYXV4X2NoKTsKKwlkZWZhdWx0OgorCQlNSVNTSU5HX0NBU0UoYXV4X2No
KTsKKwkJcmV0dXJuIERQX0FVWF9DSF9DVEwoQVVYX0NIX0EpOworCX0KK30KKworc3RhdGljIGk5
MTVfcmVnX3QgdGdsX2F1eF9kYXRhX3JlZyhzdHJ1Y3QgaW50ZWxfZHAgKmludGVsX2RwLCBpbnQg
aW5kZXgpCit7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gZHBfdG9faTkx
NShpbnRlbF9kcCk7CisJc3RydWN0IGludGVsX2RpZ2l0YWxfcG9ydCAqZGlnX3BvcnQgPSBkcF90
b19kaWdfcG9ydChpbnRlbF9kcCk7CisJZW51bSBhdXhfY2ggYXV4X2NoID0gZGlnX3BvcnQtPmF1
eF9jaDsKKworCXN3aXRjaCAoYXV4X2NoKSB7CisJY2FzZSBBVVhfQ0hfQToKKwljYXNlIEFVWF9D
SF9COgorCWNhc2UgQVVYX0NIX0M6CisJY2FzZSBBVVhfQ0hfVVNCQzE6CisJY2FzZSBBVVhfQ0hf
VVNCQzI6CisJY2FzZSBBVVhfQ0hfVVNCQzM6CisJY2FzZSBBVVhfQ0hfVVNCQzQ6CisJY2FzZSBB
VVhfQ0hfVVNCQzU6CisJY2FzZSBBVVhfQ0hfVVNCQzY6CisJCXJldHVybiBEUF9BVVhfQ0hfREFU
QShhdXhfY2gsIGluZGV4KTsKKwlkZWZhdWx0OgorCQlNSVNTSU5HX0NBU0UoYXV4X2NoKTsKKwkJ
cmV0dXJuIERQX0FVWF9DSF9EQVRBKEFVWF9DSF9BLCBpbmRleCk7CisJfQorfQorCit2b2lkIGlu
dGVsX2RwX2F1eF9maW5pKHN0cnVjdCBpbnRlbF9kcCAqaW50ZWxfZHApCit7CisJa2ZyZWUoaW50
ZWxfZHAtPmF1eC5uYW1lKTsKK30KKwordm9pZCBpbnRlbF9kcF9hdXhfaW5pdChzdHJ1Y3QgaW50
ZWxfZHAgKmludGVsX2RwKQoreworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9
IGRwX3RvX2k5MTUoaW50ZWxfZHApOworCXN0cnVjdCBpbnRlbF9kaWdpdGFsX3BvcnQgKmRpZ19w
b3J0ID0gZHBfdG9fZGlnX3BvcnQoaW50ZWxfZHApOworCXN0cnVjdCBpbnRlbF9lbmNvZGVyICpl
bmNvZGVyID0gJmRpZ19wb3J0LT5iYXNlOworCWVudW0gYXV4X2NoIGF1eF9jaCA9IGRpZ19wb3J0
LT5hdXhfY2g7CisKKwlpZiAoSU5URUxfR0VOKGRldl9wcml2KSA+PSAxMikgeworCQlpbnRlbF9k
cC0+YXV4X2NoX2N0bF9yZWcgPSB0Z2xfYXV4X2N0bF9yZWc7CisJCWludGVsX2RwLT5hdXhfY2hf
ZGF0YV9yZWcgPSB0Z2xfYXV4X2RhdGFfcmVnOworCX0gZWxzZSBpZiAoSU5URUxfR0VOKGRldl9w
cml2KSA+PSA5KSB7CisJCWludGVsX2RwLT5hdXhfY2hfY3RsX3JlZyA9IHNrbF9hdXhfY3RsX3Jl
ZzsKKwkJaW50ZWxfZHAtPmF1eF9jaF9kYXRhX3JlZyA9IHNrbF9hdXhfZGF0YV9yZWc7CisJfSBl
bHNlIGlmIChIQVNfUENIX1NQTElUKGRldl9wcml2KSkgeworCQlpbnRlbF9kcC0+YXV4X2NoX2N0
bF9yZWcgPSBpbGtfYXV4X2N0bF9yZWc7CisJCWludGVsX2RwLT5hdXhfY2hfZGF0YV9yZWcgPSBp
bGtfYXV4X2RhdGFfcmVnOworCX0gZWxzZSB7CisJCWludGVsX2RwLT5hdXhfY2hfY3RsX3JlZyA9
IGc0eF9hdXhfY3RsX3JlZzsKKwkJaW50ZWxfZHAtPmF1eF9jaF9kYXRhX3JlZyA9IGc0eF9hdXhf
ZGF0YV9yZWc7CisJfQorCisJaWYgKElOVEVMX0dFTihkZXZfcHJpdikgPj0gOSkKKwkJaW50ZWxf
ZHAtPmdldF9hdXhfY2xvY2tfZGl2aWRlciA9IHNrbF9nZXRfYXV4X2Nsb2NrX2RpdmlkZXI7CisJ
ZWxzZSBpZiAoSVNfQlJPQURXRUxMKGRldl9wcml2KSB8fCBJU19IQVNXRUxMKGRldl9wcml2KSkK
KwkJaW50ZWxfZHAtPmdldF9hdXhfY2xvY2tfZGl2aWRlciA9IGhzd19nZXRfYXV4X2Nsb2NrX2Rp
dmlkZXI7CisJZWxzZSBpZiAoSEFTX1BDSF9TUExJVChkZXZfcHJpdikpCisJCWludGVsX2RwLT5n
ZXRfYXV4X2Nsb2NrX2RpdmlkZXIgPSBpbGtfZ2V0X2F1eF9jbG9ja19kaXZpZGVyOworCWVsc2UK
KwkJaW50ZWxfZHAtPmdldF9hdXhfY2xvY2tfZGl2aWRlciA9IGc0eF9nZXRfYXV4X2Nsb2NrX2Rp
dmlkZXI7CisKKwlpZiAoSU5URUxfR0VOKGRldl9wcml2KSA+PSA5KQorCQlpbnRlbF9kcC0+Z2V0
X2F1eF9zZW5kX2N0bCA9IHNrbF9nZXRfYXV4X3NlbmRfY3RsOworCWVsc2UKKwkJaW50ZWxfZHAt
PmdldF9hdXhfc2VuZF9jdGwgPSBnNHhfZ2V0X2F1eF9zZW5kX2N0bDsKKworCWRybV9kcF9hdXhf
aW5pdCgmaW50ZWxfZHAtPmF1eCk7CisKKwkvKiBGYWlsdXJlIHRvIGFsbG9jYXRlIG91ciBwcmVm
ZXJyZWQgbmFtZSBpcyBub3QgY3JpdGljYWwgKi8KKwlpZiAoSU5URUxfR0VOKGRldl9wcml2KSA+
PSAxMiAmJiBhdXhfY2ggPj0gQVVYX0NIX1VTQkMxKQorCQlpbnRlbF9kcC0+YXV4Lm5hbWUgPSBr
YXNwcmludGYoR0ZQX0tFUk5FTCwgIkFVWCBVU0JDJWMvJXMiLAorCQkJCQkgICAgICAgYXV4X2No
IC0gQVVYX0NIX1VTQkMxICsgJzEnLAorCQkJCQkgICAgICAgZW5jb2Rlci0+YmFzZS5uYW1lKTsK
KwllbHNlCisJCWludGVsX2RwLT5hdXgubmFtZSA9IGthc3ByaW50ZihHRlBfS0VSTkVMLCAiQVVY
ICVjLyVzIiwKKwkJCQkJICAgICAgIGF1eF9jaF9uYW1lKGF1eF9jaCksCisJCQkJCSAgICAgICBl
bmNvZGVyLT5iYXNlLm5hbWUpOworCisJaW50ZWxfZHAtPmF1eC50cmFuc2ZlciA9IGludGVsX2Rw
X2F1eF90cmFuc2ZlcjsKK30KZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3Bs
YXkvaW50ZWxfZHBfYXV4LmggYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2Rw
X2F1eC5oCm5ldyBmaWxlIG1vZGUgMTAwNjQ0CmluZGV4IDAwMDAwMDAwMDAwMC4uY2VhNThkZDg2
YzQ5Ci0tLSAvZGV2L251bGwKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRl
bF9kcF9hdXguaApAQCAtMCwwICsxLDE4IEBACisvKiBTUERYLUxpY2Vuc2UtSWRlbnRpZmllcjog
TUlUICovCisvKgorICogQ29weXJpZ2h0IMKpIDIwMjAgSW50ZWwgQ29ycG9yYXRpb24KKyAqLwor
CisjaWZuZGVmIF9fSU5URUxfRFBfQVVYX0hfXworI2RlZmluZSBfX0lOVEVMX0RQX0FVWF9IX18K
KworI2luY2x1ZGUgPGxpbnV4L3R5cGVzLmg+CisKK3N0cnVjdCBpbnRlbF9kcDsKKwordTMyIGlu
dGVsX2RwX3BhY2tfYXV4KGNvbnN0IHU4ICpzcmMsIGludCBzcmNfYnl0ZXMpOworCit2b2lkIGlu
dGVsX2RwX2F1eF9maW5pKHN0cnVjdCBpbnRlbF9kcCAqaW50ZWxfZHApOwordm9pZCBpbnRlbF9k
cF9hdXhfaW5pdChzdHJ1Y3QgaW50ZWxfZHAgKmludGVsX2RwKTsKKworI2VuZGlmIC8qIF9fSU5U
RUxfRFBfQVVYX0hfXyAqLwotLSAKMi4yMC4xCgpfX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fXwpJbnRlbC1nZnggbWFpbGluZyBsaXN0CkludGVsLWdmeEBsaXN0
cy5mcmVlZGVza3RvcC5vcmcKaHR0cHM6Ly9saXN0cy5mcmVlZGVza3RvcC5vcmcvbWFpbG1hbi9s
aXN0aW5mby9pbnRlbC1nZngK

Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 46DA61946B7
	for <lists+intel-gfx@lfdr.de>; Thu, 26 Mar 2020 19:43:51 +0100 (CET)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id BA27A89D4B;
	Thu, 26 Mar 2020 18:43:48 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from mga01.intel.com (mga01.intel.com [192.55.52.88])
 by gabe.freedesktop.org (Postfix) with ESMTPS id CB47789D4B
 for <intel-gfx@lists.freedesktop.org>; Thu, 26 Mar 2020 18:43:46 +0000 (UTC)
IronPort-SDR: qikkoHfGdfZ//kGN8Ot6+lrbzV5bIS22xJxyfo2u7MEkWvFR8K8D9hOEWPSGkSDQtTwWYDz3EW
 eZmCw0x6C8sg==
X-Amp-Result: SKIPPED(no attachment in message)
X-Amp-File-Uploaded: False
Received: from fmsmga007.fm.intel.com ([10.253.24.52])
 by fmsmga101.fm.intel.com with ESMTP/TLS/ECDHE-RSA-AES256-GCM-SHA384;
 26 Mar 2020 11:43:46 -0700
IronPort-SDR: Uu22lR9YMGNfmmLxWbjkMjKgdQWDRIL6fEgXYqABP0a2pgN3B9lpsC3fzpwVQjCK7o88mPmqZN
 Jisij2d/HBrQ==
X-ExtLoop1: 1
X-IronPort-AV: E=Sophos;i="5.72,309,1580803200"; d="scan'208";a="238882845"
Received: from unknown (HELO slisovsk-Lenovo-ideapad-720S-13IKB.fi.intel.com)
 ([10.237.72.89])
 by fmsmga007.fm.intel.com with ESMTP; 26 Mar 2020 11:43:43 -0700
From: Stanislav Lisovskiy <stanislav.lisovskiy@intel.com>
To: intel-gfx@lists.freedesktop.org
Date: Thu, 26 Mar 2020 20:39:59 +0200
Message-Id: <20200326183959.22903-1-stanislav.lisovskiy@intel.com>
X-Mailer: git-send-email 2.24.1.485.gad05a3d8e5
In-Reply-To: <20200326181005.11775-7-stanislav.lisovskiy@intel.com>
References: <20200326181005.11775-7-stanislav.lisovskiy@intel.com>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH v20 06/10] drm/i915: Add proper SAGV support for
 TGL+
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.29
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Cc: jani.nikula@intel.com
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

TGV0J3MgcmVmYWN0b3IgdGhlIHdob2xlIFNBR1YgbG9naWMsIG1vdmluZwp0aGUgbWFpbiBjYWxj
dWxhdGlvbnMgZnJvbSBpbnRlbF9jYW5fZW5hYmxlX3NhZ3YKdG8gaW50ZWxfY29tcHV0ZV9zYWd2
X21hc2ssIHdoaWNoIGFsc28gaGFuZGxlcwp0aGlzIGluIGEgdW5pZmllZCB3YXkgY2FsbGluZyBn
ZW4gc3BlY2lmaWMKZnVuY3Rpb25zIHRvIGV2YWx1YXRlIGlmIFNBR1YgaXMgYWxsb3dlZCBmb3IK
ZWFjaCBjcnRjLiBJZiBjcnRjIHNhZ3YgbWFzayBoYXZlIGJlZW4gY2hhbmdlZAp3ZSBzZXJpYWxp
emUgYWNjZXNzIGFuZCBtb2RpZnkgZ2xvYmFsIHN0YXRlLgoKaW50ZWxfY2FuX2VuYWJsZV9zYWd2
IG5vdyB1c2VzIGJ3X3N0YXRlIHdoaWNoCnN0b3JlcyBhbGwgaW5mb3JtYXRpb24gcmVsYXRlZCB0
byBTQUdWIGFuZAppcyBub3cgYSB0cml2aWFsIGhlbHBlci4KCnYyOgogICAgLSBSZXdvcmsgd2F0
ZXJtYXJrIGNhbGN1bGF0aW9uIGFsZ29yaXRobSB0bwogICAgICBhdHRlbXB0IHRvIGNhbGN1bGF0
ZSBMZXZlbCAwIHdhdGVybWFyawogICAgICB3aXRoIGFkZGVkIHNhZ3YgYmxvY2sgdGltZSBsYXRl
bmN5IGFuZAogICAgICBjaGVjayBpZiBpdCBmaXRzIGluIERCdWYgaW4gb3JkZXIgdG8KICAgICAg
ZGV0ZXJtaW5lIGlmIFNBR1YgY2FuIGJlIGVuYWJsZWQgYWxyZWFkeQogICAgICBhdCB0aGlzIHN0
YWdlLCBqdXN0IGFzIEJTcGVjIDQ5MzI1IHN0YXRlcy4KICAgICAgaWYgdGhhdCBmYWlscyByb2xs
YmFjayB0byB1c3VhbCBMZXZlbCAwCiAgICAgIGxhdGVuY3kgYW5kIGRpc2FibGUgU0FHVi4KICAg
IC0gUmVtb3ZlIHVubmVlZGVkIHRhYnMoSmFtZXMgQXVzbXVzKQoKdjM6IFJlYmFzZWQgdGhlIHBh
dGNoCgp2NDogLSBBZGRlZCBiYWNrIGludGVybGFjZWQgY2hlY2sgZm9yIEdlbjEyIGFuZAogICAg
ICBhZGRlZCBzZXBhcmF0ZSBmdW5jdGlvbiBmb3IgVEdMIFNBR1YgY2hlY2sKICAgICAgKHRoYW5r
cyB0byBKYW1lcyBBdXNtdXMgZm9yIHNwb3R0aW5nKQogICAgLSBSZW1vdmVkIHVubmVlZGVkIGdl
biBjaGVjawogICAgLSBFeHRyYWN0ZWQgR2VuMTIgU0FHViBkZWNpc2lvbiBtYWtpbmcgY29kZQog
ICAgICB0byBhIHNlcGFyYXRlIGZ1bmN0aW9uIGZyb20gc2tsX2NvbXB1dGVfd20KCnY1OiAtIEFk
ZGVkIFNBR1YgZ2xvYmFsIHN0YXRlIHRvIGRldl9wcml2LCBiZWNhdXNlCiAgICAgIHdlIG5lZWQg
dG8gdHJhY2sgYWxsIHBpcGVzLCBub3Qgb25seSB0aG9zZQogICAgICBpbiBhdG9taWMgc3RhdGUu
IEVhY2ggcGlwZSBoYXMgbm93IGNvcnJlc3BvbmRlbnQKICAgICAgYml0IG1hc2sgcmVmbGVjdGlu
Zywgd2hldGhlciBpdCBjYW4gdG9sZXJhdGUKICAgICAgU0FHViBvciBub3QodGhhbmtzIHRvIFZp
bGxlIFN5cmphbGEgZm9yIHN1Z2dlc3Rpb25zKS4KICAgIC0gTm93IHVzaW5nIGFjdGl2ZSBmbGFn
IGluc3RlYWQgb2YgZW5hYmxlIGluIGNyYwogICAgICB1c2FnZSBjaGVjay4KCnY2OiAtIEZpeGVk
IHJlYmFzZSBjb25mbGljdHMKCnY3OiAtIGttc19jdXJzb3JfbGVnYWN5IHNlZW1zIHRvIGdldCBi
cm9rZW4gYmVjYXVzZSBvZiBtdWx0aXBsZSBtZW1jcHkKICAgICAgY2FsbHMgd2hlbiBjb3B5aW5n
IGxldmVsIDAgd2F0ZXIgbWFya3MgZm9yIGVuYWJsZWQgU0FHViwgdG8KICAgICAgZml4IHRoaXMg
bm93IHNpbXBseSB1c2luZyB0aGF0IGZpZWxkIHJpZ2h0IGF3YXksIHdpdGhvdXQgY29weWluZywK
ICAgICAgZm9yIHRoYXQgaW50cm9kdWNlZCBhIG5ldyB3bV9sZXZlbCBhY2Nlc3NvciB3aGljaCBk
ZWNpZGVzIHdoaWNoCiAgICAgIHdtX2xldmVsIHRvIHJldHVybiBiYXNlZCBvbiBTQUdWIHN0YXRl
LgoKdjg6IC0gUHJvdGVjdCBjcnRjX3NhZ3ZfbWFzayBzYW1lIHdheSBhcyB3ZSBkbyBmb3Igb3Ro
ZXIgZ2xvYmFsIHN0YXRlCiAgICAgIGNoYW5nZXM6IGkuZSBjaGVjayBpZiBjaGFuZ2VzIGFyZSBu
ZWVkZWQsIHRoZW4gZ3JhYiBhbGwgY3J0YyBsb2NrcwogICAgICB0byBzZXJpYWxpemUgdGhlIGNo
YW5nZXMoVmlsbGUgU3lyasOkbMOkKQogICAgLSBBZGQgY3J0Y19zYWd2X21hc2sgY2FjaGluZyBp
biBvcmRlciB0byBhdm9pZCBuZWVkbGVzcyByZWNhbGN1bGF0aW9ucwogICAgICAoTWF0dGhldyBS
b3BlcikKICAgIC0gUHV0IGJhY2sgR2VuMTIgU0FHViBzd2l0Y2ggaW4gb3JkZXIgdG8gZ2V0IGl0
IGVuYWJsZWQgaW4gc2VwYXJhdGUKICAgICAgcGF0Y2goTWF0dGhldyBSb3BlcikKICAgIC0gUmVu
YW1lICpfc2V0X3NhZ3ZfbWFzayB0byAqX2NvbXB1dGVfc2Fndl9tYXNrKE1hdHRoZXcgUm9wZXIp
CiAgICAtIENoZWNrIGlmIHRoZXJlIGFyZSBubyBhY3RpdmUgcGlwZXMgaW4gaW50ZWxfY2FuX2Vu
YWJsZV9zYWd2CiAgICAgIGluc3RlYWQgb2YgcGxhdGZvcm0gc3BlY2lmaWMgZnVuY3Rpb25zKE1h
dHRoZXcgUm9wZXIpLCBzYW1lCiAgICAgIGZvciBpbnRlbF9oYXNfc2FndiBjaGVjay4KCnY5ICAt
IFN3aXRjaGVkIHRvIHU4IGZvciBjcnRjX3NhZ3ZfbWFzayhWaWxsZSBTeXJqw6Rsw6QpCiAgICAt
IGNydGNfc2Fndl9tYXNrIG5vdyBpcyBwaXBlX3NhZ3ZfbWFzayhWaWxsZSBTeXJqw6Rsw6QpCiAg
ICAtIEV4dHJhY3RlZCBzYWd2IGNoZWNraW5nIGxvZ2ljIGZyb20gc2tsL2ljbC90Z2xfY29tcHV0
ZV9zYWd2X21hc2sKICAgIC0gRXh0cmFjdGVkIHNrbF9wbGFuZV93bV9sZXZlbCBmdW5jdGlvbiBh
bmQgcGFzc2luZyBsYXRlbmN5IHRvCiAgICAgIHNlcGFyYXRlIHBhdGNoZXMoVmlsbGUgU3lyasOk
bMOkKQogICAgLSBSZW1vdmVkIHBhcnQgb2YgdW5uZWVkZWQgY29weS1wYXN0ZSBmcm9tIHRnbF9j
aGVja19waXBlX2ZpdHNfc2Fndl93bQogICAgICAoVmlsbGUgU3lyasOkbMOkKQogICAgLSBOb3cg
dXNpbmcgc2ltcGxlIGFzc2lnbm1lbnQgZm9yIHNhZ3Zfd20wIGFzIGl0IGNvbnRhaW5zIG9ubHkK
ICAgICAgcG9kIHR5cGVzIGFuZCBubyBwb2ludGVycyhWaWxsZSBTeXJqw6Rsw6QpCiAgICAtIEZp
eGVkIGludGVsX2Nhbl9lbmFibGVfc2FndiBub3QgdG8gZG8gZG91YmxlIGR1dHksIG5vdyBpdCBv
bmx5CiAgICAgIGNoZWNrIFNBR1YgYml0cyBieSBBTkRpbmcgdGhvc2UgYmV0d2VlbiBsb2NhbCBh
bmQgZ2xvYmFsIHN0YXRlLgogICAgICBUaGUgU0FHViBtYXNrcyBhcmUgbm93IGNvbXB1dGVkIGFm
dGVyIHdhdGVybWFya3MgYXJlIGF2YWlsYWJsZSwKICAgICAgaW4gb3JkZXIgdG8gYmUgYWJsZSB0
byBmaWd1cmUgb3V0IGlmIGRkYiByYW5nZXMgYXJlIGZpdHRpbmcgbmljZWx5LgogICAgICAoVmls
bGUgU3lyasOkbMOkKQogICAgLSBOb3cgaGF2aW5nIHV2X3NhZ3Zfd20wIGFuZCBzYWd2X3dtMCwg
b3RoZXJ3aXNlIHdlIGhhdmUgd3JvbmcgbG9naWMKICAgICAgd2hlbiB1c2luZyBza2xfcGxhbmVf
d21fbGV2ZWwgYWNjZXNzb3IsIGFzIHdlIGhhZCBwcmV2aW91c2x5IGZvcgogICAgICBHZW4xMSsg
Y29sb3IgcGxhbmUgYW5kIHJlZ3VsYXIgd20gbGV2ZWxzLCBzbyBwcm9iYWJseSBib3RoCiAgICAg
IGhhcyB0byBiZSByZWNhbGN1bGF0ZWQgd2l0aCBhZGRpdGlvbmFsIFNBR1YgYmxvY2sgdGltZSBm
b3IgTGV2ZWwgMC4KCnYxMDogLSBTdGFydGluZyB0byB1c2UgbmV3IGdsb2JhbCBzdGF0ZSBmb3Ig
c3RvcmluZyBwaXBlX3NhZ3ZfbWFzawoKdjExOiAtIEZpeGVkIHJlYmFzZSBjb25mbGljdCB3aXRo
IHJlY2VudCBkcm0tdGlwCiAgICAgLSBDaGVjayBpZiB3ZSByZWFsbHkgbmVlZCB0byByZWNhbGN1
bGF0ZSBTQUdWIG1hc2ssIG90aGVyd2lzZQogICAgICAgYmFpbCBvdXQgd2l0aG91dCBtYWtpbmcg
YW55IGNoYW5nZXMuCiAgICAgLSBVc2UgY2FjaGVkIFNBR1YgcmVzdWx0LCBpbnN0ZWFkIG9mIHJl
Y2FsY3VsYXRpbmcgaXQgZXZlcnl0aW1lLAogICAgICAgaWYgYndfc3RhdGUgaGFzbid0IGNoYW5n
ZWQuCgp2MTI6IC0gUmVtb3ZlZCBXQVJOIGZyb20gaW50ZWxfY2FuX2VuYWJsZV9zYWd2LCBpbiBz
b21lIG9mIHRoZSBjb21taXRzCiAgICAgICBpZiB3ZSBkb24ndCByZWNhbGN1bGF0ZWQgd2F0ZXJt
YXJrcywgYndfc3RhdGUgaXMgbm90IHJlY2FsY3VsYXRlZCwKICAgICAgIHRodXMgbGVhZGluZyB0
byBTQUdWIHN0YXRlIG5vdCByZWNhbGN1bGF0ZWQgYnkgdGhlIGNvbW1pdCBzdGF0ZSwKICAgICAg
IHdoaWNoIGlzIHN0aWxsIGNhbGxpbmcgaW50ZWxfY2FuX2VuYWJsZV9zYWd2IGZ1bmN0aW9uLiBG
aXggdGhhdAogICAgICAgYnkganVzdCBhbmFseXppbmcgdGhlIGN1cnJlbnQgZ2xvYmFsIGJ3X3N0
YXRlIG9iamVjdCAtIGJlY2F1c2UKICAgICAgIHdlIHNpbXBseSBoYXZlIG5vIG90aGVyIG9iamVj
dHMgcmVsYXRlZCB0byB0aGF0LgoKdjEzOiAtIFJlYmFzZWQsIGZpeGVkIHdhcm5pbmdzIHJlZ2Fy
ZGluZyBsb25nIGxpbmVzCiAgICAgLSBDaGFuZ2VkIGZ1bmN0aW9uIGNhbGwgc2l0ZXMgZnJvbSBp
bnRlbF9hdG9taWNfYncqIHRvCiAgICAgICBpbnRlbF93Yl8qIGFzIHdhcyBzdWdnZXN0ZWQuKEph
bmkgTmlrdWxhKQogICAgIC0gVGFrZW4gZGRiX3N0YXRlX2NoYW5nZWQgYW5kIGJ3X3N0YXRlX2No
YW5nZWQgaW50byB1c2UuCgp2MTQ6IC0gdG90YWxfYWZmZWN0ZWRfcGxhbmVzIGlzIG5vIGxvbmdl
ciBuZWVkZWQgdG8gY2hlY2sgZm9yIGRkYiBjaGFuZ2VzLAogICAgICAganVzdCBhcyBhY3RpdmVf
cGlwZV9jaGFuZ2VzLgoKdjE1OiAtIEZpeGVkIHN0dXBpZCBtaXN0YWtlIHdpdGggdW5pbml0aWFs
aXplZCBjcnRjIGluCiAgICAgICBza2xfY29tcHV0ZV9zYWd2X21hc2suCgp2MTY6IC0gQ29udmVy
dCBwaXBlX3NhZ3ZfbWFzayB0byBwaXBlX3NhZ3ZfcmVqZWN0IGFuZCBub3cgdXNpbmcgaW52ZXJ0
ZWQKICAgICAgIGZsYWcgdG8gaW5kaWNhdGUgU0FHViByZWFkaW5lc3MgZm9yIHRoZSBwaXBlKFZp
bGxlIFN5cmrDpGzDpCkKICAgICAtIEFkZGVkIHJldHVybiB2YWx1ZSB0byBpbnRlbF9jb21wdXRl
X3NhZ3ZfbWFzayB3aGljaCBjYWxsCiAgICAgICBpbnRlbF9hdG9taWNfc2VyaWFsaXplX2dsb2Jh
bF9zdGF0ZSBpbiBvcmRlciB0byBwcm9wZXJseQogICAgICAgcHJvcGFnYXRlIEVERUFETENLIHRv
IGRybS4KICAgICAtIEJhc2VkIG9uIHRoZSBkaXNjdXNzaW9uIHdpdGggVmlsbGUsIHJlbW92ZWQg
YWN0aXZlX3BpcGVfY2hhbmdlcwogICAgICAgY2hlY2sgYW5kIGFsc28gdGhlcmUgc2VlbXMgdG8g
YmUgbm8gbmVlZCBmb3IgY2hlY2tpbmcKICAgICAgIGRkYl9zdGF0ZV9jaGFuZ2VzIGFzIHdlbGwu
CiAgICAgICBJbnN0ZWFkIHdlIGp1c3QgaXRlcmF0ZSB0aHJvdWdoIGNydGNzIGluIHN0YXRlIC0g
aGF2aW5nCiAgICAgICBjcnRjIGluIGEgc3RhdGUgYWxyZWFkeSBndWFyYW50ZWVzIHRoYXQgaXQg
aXMgYXQgbGVhc3QgcmVhZC1sb2NrZWQKICAgICAgIEhhdmluZyBhZGRpdGlvbmFsIGZsYWcgdG8g
Y2hlY2sgaWYgdGhlcmUgYWN0dWFsbHkgd2VyZSBzb21lIHBsYW5lCiAgICAgICB3bS9kZGIgY2hh
bmdlcyB3b3VsZCBiZSBwcm9iYWJseSBhZGRlZCBsYXRlciBhcyBhbiBvcHRpbWl6YXRpb24uCiAg
ICAgLSBXZSBjYW4ndCBnZXQgcGFyZW50IGF0b21pYyBzdGF0ZSBmcm9tIGNydGNfc3RhdGUgYXQg
Y29tbWl0IHN0YWdlCiAgICAgICAobmljZSBkcm0gZmVhdHVyZSksIGFsc28gcHJvcGFnYXRpbmcg
c3RhdGUgdGhyb3VnaCBmdW5jdGlvbiBjYWxsCiAgICAgICBjaGFpbiBzZWVtcyB0byBiZSBvdmVy
a2lsbCBhbmQgbm90IHBvc3NpYmxlKGN1cnNvciBsZWdhY3kgdXBkYXRlcykKICAgICAgIFF1ZXJ5
aW5nIGZvciBid19zdGF0ZSBvYmplY3QgZnJvbSBnbG9iYWwgc3RhdGUgaXMgbm90IHBvc3NpYmxl
IGFzCiAgICAgICBpdCBtaWdodCBnZXQgc3dhcHBlZCB3aXRoIG90aGVyIGdsb2JhbCBzdGF0ZS4K
ICAgICAgIFNvLi4uIGp1c3Qgc3RpY2tlZCBjYW5fc2FndiBib29sZWFuIGludG8gd20gY3J0YyBz
dGF0ZS4KCnYxNzogLSBTa2lwIGluYWN0aXZlIGNydGNzLCB3aGVuIGNoZWNraW5nIGZvciBTQUdW
LXJlYWRpbmVzcy4KCnYxODogLSBTd2l0Y2ggdG8gdXNlIGludGVsX2F0b21pY19jcnRjX3N0YXRl
X2Zvcl9lYWNoX3BsYW5lX3N0YXRlCiAgICAgICBpbnN0ZWFkIG9mIGZvcl9lYWNoX2ludGVsX3Bs
YW5lX29uX2NydGMgYW5kIGZpeGVkIHByZXZpb3VzCiAgICAgICBjb2RlLCB3aGljaCB3YXMgdXNp
bmcgb2xkIHBsYW5lIHN0YXRlLCB3aGljaCBjYXVzZWQgTlVMTCBwdHIKICAgICAgIGRlcmVmZXJl
bmNlLCBiYWNhdXNlIHRoYXQgY29kZSBpcyBub3cgY2FsbGVkIGJlZm9yZSB3ZSBzd2FwIHRoZQog
ICAgICAgc3RhdGUuCgp2MTk6IC0gVXNlIGludGVsX2F0b21pY19id18qIHBhdHRlcm4gYWdhaW4K
ICAgICAtIE9wdGltaXplZCBzYWd2IGNoZWNrcyBpbiB2ZXJpZnlfd21fc3RhdGUoVmlsbGUgU3ly
asOkbMOkKQogICAgIC0gRG8gaW50ZWxfY29tcHV0ZV9zYWd2X21hc2sgYWZ0ZXIgZGRiIGlzIGFs
bG9jYXRlZChWaWxsZSBTeXJqw6Rsw6QpLAogICAgICAgdXNpbmcgaXQncyByZXN1bHRzCiAgICAg
LSBVc2UgYndfc3RhdGUgaW4gaW50ZWxfY2FuX2VuYWJsZV9zYWd2CiAgICAgLSBVc2UgQ09MT1Jf
UExBTkUgZW51bSBpbnN0ZWFkIG9mIGJvb2xlYW4geXV2IG9yICIwIiwgIjEiIG1hZ2ljCiAgICAg
LSBFeHRyYWN0ZWQgc2FndiB3bTAgY2FsY3VsYXRpb24gaW50byBzZXBhcmF0ZSBza2xfY29tcHV0
ZV9zYWd2X3dtCiAgICAgICBmdW5jdGlvbihWaWxsZSBTeXJqw6Rsw6QpCgp2MjA6IC0gQWRkZWQg
Y2hlY2sgZm9yIE5VTEwgZm9yIGJ3X3N0YXRlIGluIGNvbW1pdF90YWlsCgpTaWduZWQtb2ZmLWJ5
OiBTdGFuaXNsYXYgTGlzb3Zza2l5IDxzdGFuaXNsYXYubGlzb3Zza2l5QGludGVsLmNvbT4KQ2M6
IFZpbGxlIFN5cmrDpGzDpCA8dmlsbGUuc3lyamFsYUBpbnRlbC5jb20+CkNjOiBKYW1lcyBBdXNt
dXMgPGphbWVzLmF1c211c0BpbnRlbC5jb20+Ci0tLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlz
cGxheS9pbnRlbF9idy5oICAgICAgIHwgICA2ICsKIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3Bs
YXkvaW50ZWxfZGlzcGxheS5jICB8ICAzMCArKy0KIC4uLi9kcm0vaTkxNS9kaXNwbGF5L2ludGVs
X2Rpc3BsYXlfdHlwZXMuaCAgICB8ICAgMyArCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9pbnRlbF9w
bS5jICAgICAgICAgICAgICAgfCAyNDQgKysrKysrKysrKysrKysrKy0tCiBkcml2ZXJzL2dwdS9k
cm0vaTkxNS9pbnRlbF9wbS5oICAgICAgICAgICAgICAgfCAgIDQgKy0KIDUgZmlsZXMgY2hhbmdl
ZCwgMjU2IGluc2VydGlvbnMoKyksIDMxIGRlbGV0aW9ucygtKQoKZGlmZiAtLWdpdCBhL2RyaXZl
cnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfYncuaCBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1
L2Rpc3BsYXkvaW50ZWxfYncuaAppbmRleCBmZTY1NzljOTUyZjUuLjZhZDNlYTdjZWRmZSAxMDA2
NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9idy5oCisrKyBiL2Ry
aXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfYncuaApAQCAtMTgsNiArMTgsMTIgQEAg
c3RydWN0IGludGVsX2NydGNfc3RhdGU7CiBzdHJ1Y3QgaW50ZWxfYndfc3RhdGUgewogCXN0cnVj
dCBpbnRlbF9nbG9iYWxfc3RhdGUgYmFzZTsKIAorCS8qCisJICogQ29udGFpbnMgYSBiaXQgbWFz
aywgdXNlZCB0byBkZXRlcm1pbmUsIHdoZXRoZXIgY29ycmVzcG9uZGVudAorCSAqIHBpcGUgYWxs
b3dzIFNBR1Ygb3Igbm90LgorCSAqLworCXU4IHBpcGVfc2Fndl9yZWplY3Q7CisKIAl1bnNpZ25l
ZCBpbnQgZGF0YV9yYXRlW0k5MTVfTUFYX1BJUEVTXTsKIAl1OCBudW1fYWN0aXZlX3BsYW5lc1tJ
OTE1X01BWF9QSVBFU107CiB9OwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlz
cGxheS9pbnRlbF9kaXNwbGF5LmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVs
X2Rpc3BsYXkuYwppbmRleCBlNjMwNDI5YWYyYzAuLjhhMGQ5NTJjNjdiZiAxMDA2NDQKLS0tIGEv
ZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kaXNwbGF5LmMKKysrIGIvZHJpdmVy
cy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kaXNwbGF5LmMKQEAgLTE0MDA5LDcgKzE0MDA5
LDkgQEAgc3RhdGljIHZvaWQgdmVyaWZ5X3dtX3N0YXRlKHN0cnVjdCBpbnRlbF9jcnRjICpjcnRj
LAogCQkvKiBXYXRlcm1hcmtzICovCiAJCWZvciAobGV2ZWwgPSAwOyBsZXZlbCA8PSBtYXhfbGV2
ZWw7IGxldmVsKyspIHsKIAkJCWlmIChza2xfd21fbGV2ZWxfZXF1YWxzKCZod19wbGFuZV93bS0+
d21bbGV2ZWxdLAotCQkJCQkJJnN3X3BsYW5lX3dtLT53bVtsZXZlbF0pKQorCQkJCQkJJnN3X3Bs
YW5lX3dtLT53bVtsZXZlbF0pIHx8CisJCQkgICAgKGxldmVsID09IDAgJiYgc2tsX3dtX2xldmVs
X2VxdWFscygmaHdfcGxhbmVfd20tPndtW2xldmVsXSwKKwkJCQkJCQkgICAgICAgJnN3X3BsYW5l
X3dtLT5zYWd2X3dtMCkpKQogCQkJCWNvbnRpbnVlOwogCiAJCQlkcm1fZXJyKCZkZXZfcHJpdi0+
ZHJtLApAQCAtMTQwNjQsNyArMTQwNjYsOSBAQCBzdGF0aWMgdm9pZCB2ZXJpZnlfd21fc3RhdGUo
c3RydWN0IGludGVsX2NydGMgKmNydGMsCiAJCS8qIFdhdGVybWFya3MgKi8KIAkJZm9yIChsZXZl
bCA9IDA7IGxldmVsIDw9IG1heF9sZXZlbDsgbGV2ZWwrKykgewogCQkJaWYgKHNrbF93bV9sZXZl
bF9lcXVhbHMoJmh3X3BsYW5lX3dtLT53bVtsZXZlbF0sCi0JCQkJCQkmc3dfcGxhbmVfd20tPndt
W2xldmVsXSkpCisJCQkJCQkmc3dfcGxhbmVfd20tPndtW2xldmVsXSkgfHwKKwkJCSAgICAobGV2
ZWwgPT0gMCAmJiBza2xfd21fbGV2ZWxfZXF1YWxzKCZod19wbGFuZV93bS0+d21bbGV2ZWxdLAor
CQkJCQkJCSAgICAgICAmc3dfcGxhbmVfd20tPnNhZ3Zfd20wKSkpCiAJCQkJY29udGludWU7CiAK
IAkJCWRybV9lcnIoJmRldl9wcml2LT5kcm0sCkBAIC0xNTUzNSw2ICsxNTUzOSwxMCBAQCBzdGF0
aWMgdm9pZCBpbnRlbF9hdG9taWNfY29tbWl0X3RhaWwoc3RydWN0IGludGVsX2F0b21pY19zdGF0
ZSAqc3RhdGUpCiAJCWNydGMtPmNvbmZpZyA9IG5ld19jcnRjX3N0YXRlOwogCiAJaWYgKHN0YXRl
LT5tb2Rlc2V0KSB7CisJCXN0cnVjdCBpbnRlbF9id19zdGF0ZSAqYndfc3RhdGU7CisKKwkJYndf
c3RhdGUgPSBpbnRlbF9hdG9taWNfZ2V0X2J3X25ld19zdGF0ZShzdGF0ZSk7CisKIAkJZHJtX2F0
b21pY19oZWxwZXJfdXBkYXRlX2xlZ2FjeV9tb2Rlc2V0X3N0YXRlKGRldiwgJnN0YXRlLT5iYXNl
KTsKIAogCQlpbnRlbF9zZXRfY2RjbGtfcHJlX3BsYW5lX3VwZGF0ZShzdGF0ZSk7CkBAIC0xNTU0
Myw4ICsxNTU1MSwxMCBAQCBzdGF0aWMgdm9pZCBpbnRlbF9hdG9taWNfY29tbWl0X3RhaWwoc3Ry
dWN0IGludGVsX2F0b21pY19zdGF0ZSAqc3RhdGUpCiAJCSAqIFNLTCB3b3JrYXJvdW5kOiBic3Bl
YyByZWNvbW1lbmRzIHdlIGRpc2FibGUgdGhlIFNBR1Ygd2hlbiB3ZQogCQkgKiBoYXZlIG1vcmUg
dGhlbiBvbmUgcGlwZSBlbmFibGVkCiAJCSAqLwotCQlpZiAoIWludGVsX2Nhbl9lbmFibGVfc2Fn
dihzdGF0ZSkpCi0JCQlpbnRlbF9kaXNhYmxlX3NhZ3YoZGV2X3ByaXYpOworCQlpZiAoSU5URUxf
R0VOKGRldl9wcml2KSA8IDExKSB7CisJCQlpZiAoYndfc3RhdGUgJiYgIWludGVsX2Nhbl9lbmFi
bGVfc2Fndihid19zdGF0ZSkpCisJCQkJaW50ZWxfZGlzYWJsZV9zYWd2KGRldl9wcml2KTsKKwkJ
fQogCiAJCWludGVsX21vZGVzZXRfdmVyaWZ5X2Rpc2FibGVkKGRldl9wcml2LCBzdGF0ZSk7CiAJ
fQpAQCAtMTU2NDQsOCArMTU2NTQsMTUgQEAgc3RhdGljIHZvaWQgaW50ZWxfYXRvbWljX2NvbW1p
dF90YWlsKHN0cnVjdCBpbnRlbF9hdG9taWNfc3RhdGUgKnN0YXRlKQogCWlmIChzdGF0ZS0+bW9k
ZXNldCkKIAkJaW50ZWxfdmVyaWZ5X3BsYW5lcyhzdGF0ZSk7CiAKLQlpZiAoc3RhdGUtPm1vZGVz
ZXQgJiYgaW50ZWxfY2FuX2VuYWJsZV9zYWd2KHN0YXRlKSkKLQkJaW50ZWxfZW5hYmxlX3NhZ3Yo
ZGV2X3ByaXYpOworCWlmIChJTlRFTF9HRU4oZGV2X3ByaXYpIDwgMTEpIHsKKwkJc3RydWN0IGlu
dGVsX2J3X3N0YXRlICpid19zdGF0ZTsKKworCQlid19zdGF0ZSA9IGludGVsX2F0b21pY19nZXRf
YndfbmV3X3N0YXRlKHN0YXRlKTsKKworCQlpZiAoYndfc3RhdGUgJiYgc3RhdGUtPm1vZGVzZXQg
JiYgaW50ZWxfY2FuX2VuYWJsZV9zYWd2KGJ3X3N0YXRlKSkgeworCQkJaW50ZWxfZW5hYmxlX3Nh
Z3YoZGV2X3ByaXYpOworCQl9CisJfQogCiAJZHJtX2F0b21pY19oZWxwZXJfY29tbWl0X2h3X2Rv
bmUoJnN0YXRlLT5iYXNlKTsKIApAQCAtMTU3OTcsNyArMTU4MTQsNiBAQCBzdGF0aWMgaW50IGlu
dGVsX2F0b21pY19jb21taXQoc3RydWN0IGRybV9kZXZpY2UgKmRldiwKIAogCWlmIChzdGF0ZS0+
Z2xvYmFsX3N0YXRlX2NoYW5nZWQpIHsKIAkJYXNzZXJ0X2dsb2JhbF9zdGF0ZV9sb2NrZWQoZGV2
X3ByaXYpOwotCiAJCWRldl9wcml2LT5hY3RpdmVfcGlwZXMgPSBzdGF0ZS0+YWN0aXZlX3BpcGVz
OwogCX0KIApkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9k
aXNwbGF5X3R5cGVzLmggYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2Rpc3Bs
YXlfdHlwZXMuaAppbmRleCA1MjNlMDQ0NGIzNzMuLjUxZmE1YTc0NmE1ZiAxMDA2NDQKLS0tIGEv
ZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kaXNwbGF5X3R5cGVzLmgKKysrIGIv
ZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kaXNwbGF5X3R5cGVzLmgKQEAgLTY3
OSw2ICs2NzksOCBAQCBzdHJ1Y3Qgc2tsX3BsYW5lX3dtIHsKIAlzdHJ1Y3Qgc2tsX3dtX2xldmVs
IHdtWzhdOwogCXN0cnVjdCBza2xfd21fbGV2ZWwgdXZfd21bOF07CiAJc3RydWN0IHNrbF93bV9s
ZXZlbCB0cmFuc193bTsKKwlzdHJ1Y3Qgc2tsX3dtX2xldmVsIHNhZ3Zfd20wOworCXN0cnVjdCBz
a2xfd21fbGV2ZWwgdXZfc2Fndl93bTA7CiAJYm9vbCBpc19wbGFuYXI7CiB9OwogCkBAIC02ODks
NiArNjkxLDcgQEAgZW51bSBjb2xvcl9wbGFuZSB7CiAKIHN0cnVjdCBza2xfcGlwZV93bSB7CiAJ
c3RydWN0IHNrbF9wbGFuZV93bSBwbGFuZXNbSTkxNV9NQVhfUExBTkVTXTsKKwlib29sIGNhbl9z
YWd2OwogfTsKIAogZW51bSB2bHZfd21fbGV2ZWwgewpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUv
ZHJtL2k5MTUvaW50ZWxfcG0uYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2ludGVsX3BtLmMKaW5k
ZXggNjQxOTNiMDk4MTc1Li42M2M0NjkxOGQxZWQgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2Ry
bS9pOTE1L2ludGVsX3BtLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50ZWxfcG0uYwpA
QCAtNDMsNiArNDMsNyBAQAogI2luY2x1ZGUgImk5MTVfZml4ZWQuaCIKICNpbmNsdWRlICJpOTE1
X2lycS5oIgogI2luY2x1ZGUgImk5MTVfdHJhY2UuaCIKKyNpbmNsdWRlICJkaXNwbGF5L2ludGVs
X2J3LmgiCiAjaW5jbHVkZSAiaW50ZWxfcG0uaCIKICNpbmNsdWRlICJpbnRlbF9zaWRlYmFuZC5o
IgogI2luY2x1ZGUgIi4uLy4uLy4uL3BsYXRmb3JtL3g4Ni9pbnRlbF9pcHMuaCIKQEAgLTM2MzQs
NyArMzYzNSw3IEBAIHN0YXRpYyBib29sIHNrbF9uZWVkc19tZW1vcnlfYndfd2Eoc3RydWN0IGRy
bV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQogCXJldHVybiBJU19HRU45X0JDKGRldl9wcml2KSB8
fCBJU19CUk9YVE9OKGRldl9wcml2KTsKIH0KIAotc3RhdGljIGJvb2wKK2Jvb2wKIGludGVsX2hh
c19zYWd2KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikKIHsKIAkvKiBIQUNLISAq
LwpAQCAtMzgyNywzMyArMzgyOCwxMDYgQEAgc3RhdGljIGJvb2wgc2tsX2Nhbl9lbmFibGVfc2Fn
dl9vbl9waXBlKHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlKQogCXJldHVybiBp
Y2xfY2FuX2VuYWJsZV9zYWd2X29uX3BpcGUoY3J0Y19zdGF0ZSk7CiB9CiAKLWJvb2wgaW50ZWxf
Y2FuX2VuYWJsZV9zYWd2KHN0cnVjdCBpbnRlbF9hdG9taWNfc3RhdGUgKnN0YXRlKQorc3RhdGlj
IGJvb2wKK3RnbF9jYW5fZW5hYmxlX3NhZ3Zfb25fcGlwZShzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0
ZSAqY3J0Y19zdGF0ZSk7CisKK2Jvb2wgaW50ZWxfY2FuX2VuYWJsZV9zYWd2KHN0cnVjdCBpbnRl
bF9id19zdGF0ZSAqYndfc3RhdGUpCit7CisJcmV0dXJuIGJ3X3N0YXRlLT5waXBlX3NhZ3ZfcmVq
ZWN0ID09IDA7Cit9CisKK3N0YXRpYyBpbnQgaW50ZWxfY29tcHV0ZV9zYWd2X21hc2soc3RydWN0
IGludGVsX2F0b21pY19zdGF0ZSAqc3RhdGUpCiB7CisJaW50IHJldDsKIAlzdHJ1Y3QgZHJtX2Rl
dmljZSAqZGV2ID0gc3RhdGUtPmJhc2UuZGV2OwogCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpk
ZXZfcHJpdiA9IHRvX2k5MTUoZGV2KTsKIAlzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YzsKLQlzdHJ1
Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZTsKKwlzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0
ZSAqbmV3X2NydGNfc3RhdGU7CisJc3RydWN0IGludGVsX2J3X3N0YXRlICpuZXdfYndfc3RhdGUg
PSBOVUxMOworCXN0cnVjdCBpbnRlbF9id19zdGF0ZSAqb2xkX2J3X3N0YXRlID0gTlVMTDsKIAlp
bnQgaTsKKwlib29sIGNhbl9zYWd2OwogCisJLyoKKwkgKiBJZiBTQUdWIGlzIG5vdCBzdXBwb3J0
ZWQgd2UganVzdCBjYW4ndCBkbyBhbnl0aGluZworCSAqIG5vdCBldmVuIHNldCBvciByZWplY3Qg
U0FHViBwb2ludHMgLSBqdXN0IGJhaWwgb3V0LgorCSAqIFRodXMgYXZvaWQgbmVlZGxlc3MgY2Fs
Y3VsYXRpb25zLgorCSAqLwogCWlmICghaW50ZWxfaGFzX3NhZ3YoZGV2X3ByaXYpKQotCQlyZXR1
cm4gZmFsc2U7CisJCXJldHVybiAwOworCisJZm9yX2VhY2hfbmV3X2ludGVsX2NydGNfaW5fc3Rh
dGUoc3RhdGUsIGNydGMsCisJCQkJCSBuZXdfY3J0Y19zdGF0ZSwgaSkgeworCQlib29sIHBpcGVf
c2Fndl9lbmFibGU7CisKKwkJbmV3X2J3X3N0YXRlID0gaW50ZWxfYXRvbWljX2dldF9id19zdGF0
ZShzdGF0ZSk7CisJCWlmIChJU19FUlIobmV3X2J3X3N0YXRlKSkgeworCQkJV0FSTigxLCAiQ291
bGQgbm90IGdldCBid19zdGF0ZVxuIik7CisJCQlyZXR1cm4gUFRSX0VSUihuZXdfYndfc3RhdGUp
OworCQl9CisKKwkJb2xkX2J3X3N0YXRlID0gaW50ZWxfYXRvbWljX2dldF9id19vbGRfc3RhdGUo
c3RhdGUpOworCisJCWlmICghbmV3X2NydGNfc3RhdGUtPmh3LmFjdGl2ZSkKKwkJCWNvbnRpbnVl
OworCisJCWlmIChJTlRFTF9HRU4oZGV2X3ByaXYpID49IDEyKSB7CisJCQlwaXBlX3NhZ3ZfZW5h
YmxlID0gdGdsX2Nhbl9lbmFibGVfc2Fndl9vbl9waXBlKG5ld19jcnRjX3N0YXRlKTsKKwkJfSBl
bHNlIGlmIChJTlRFTF9HRU4oZGV2X3ByaXYpID49IDExKSB7CisJCQlwaXBlX3NhZ3ZfZW5hYmxl
ID0gaWNsX2Nhbl9lbmFibGVfc2Fndl9vbl9waXBlKG5ld19jcnRjX3N0YXRlKTsKKwkJfSBlbHNl
IHsKKwkJCXBpcGVfc2Fndl9lbmFibGUgPSBza2xfY2FuX2VuYWJsZV9zYWd2X29uX3BpcGUobmV3
X2NydGNfc3RhdGUpOworCQl9CisKKwkJaWYgKHBpcGVfc2Fndl9lbmFibGUpCisJCQluZXdfYndf
c3RhdGUtPnBpcGVfc2Fndl9yZWplY3QgJj0gfkJJVChjcnRjLT5waXBlKTsKKwkJZWxzZQorCQkJ
bmV3X2J3X3N0YXRlLT5waXBlX3NhZ3ZfcmVqZWN0IHw9IEJJVChjcnRjLT5waXBlKTsKKwl9CisK
KwlpZiAoIW5ld19id19zdGF0ZSB8fCAhb2xkX2J3X3N0YXRlKQorCQlyZXR1cm4gMDsKKworCWNh
bl9zYWd2ID0gbmV3X2J3X3N0YXRlLT5waXBlX3NhZ3ZfcmVqZWN0ID09IDA7CisKKwlmb3JfZWFj
aF9uZXdfaW50ZWxfY3J0Y19pbl9zdGF0ZShzdGF0ZSwgY3J0YywKKwkJCQkJIG5ld19jcnRjX3N0
YXRlLCBpKSB7CisJCXN0cnVjdCBza2xfcGlwZV93bSAqcGlwZV93bSA9ICZuZXdfY3J0Y19zdGF0
ZS0+d20uc2tsLm9wdGltYWw7CisKKwkJLyoKKwkJICogRHVlIHRvIGRybSBsaW1pdGF0aW9uIGF0
IGNvbW1pdCBzdGF0ZSwgd2hlbgorCQkgKiBjaGFuZ2VzIGFyZSB3cml0dGVuIHRoZSB3aG9sZSBh
dG9taWMgc3RhdGUgaXMKKwkJICogemVyb2VkIGF3YXkgPT4gd2hpY2ggcHJldmVudHMgZnJvbSB1
c2luZyBpdCwKKwkJICogc28ganVzdCBzdGlja2luZyBpdCBpbnRvIHBpcGUgd20gc3RhdGUgZm9y
CisJCSAqIGtlZXBpbmcgaXQgc2ltcGxlIC0gYW55d2F5IHRoaXMgaXMgcmVsYXRlZCB0byB3bS4K
KwkJICogUHJvcGVyIHdheSBpbiBpZGVhbCB1bml2ZXJzZSB3b3VsZCBiZSBvZiBjb3Vyc2Ugbm90
CisJCSAqIHRvIGxvc2UgcGFyZW50IGF0b21pYyBzdGF0ZSBvYmplY3QgZnJvbSBjaGlsZCBjcnRj
X3N0YXRlLAorCQkgKiBhbmQgc3RpY2sgdG8gT09QIHByb2dyYW1taW5nIHByaW5jaXBsZXMsIHdo
aWNoIGhhZCBiZWVuCisJCSAqIHNjaWVudGlmaWNhbGx5IHByb3ZlbiB0byB3b3JrLgorCQkgKi8K
KwkJcGlwZV93bS0+Y2FuX3NhZ3YgPSBjYW5fc2FndjsKKwl9CiAKIAkvKgotCSAqIElmIHRoZXJl
IGFyZSBubyBhY3RpdmUgQ1JUQ3MsIG5vIGFkZGl0aW9uYWwgY2hlY2tzIG5lZWQgYmUgcGVyZm9y
bWVkCisJICogRm9yIFNBR1Ygd2UgbmVlZCB0byBhY2NvdW50IGFsbCB0aGUgcGlwZXMsCisJICog
bm90IG9ubHkgdGhlIG9uZXMgd2hpY2ggYXJlIGluIHN0YXRlIGN1cnJlbnRseS4KKwkgKiBHcmFi
IGFsbCBsb2NrcyBpZiB3ZSBkZXRlY3QgdGhhdCB3ZSBhcmUgYWN0dWFsbHkKKwkgKiBnb2luZyB0
byBkbyBzb21ldGhpbmcuCiAJICovCi0JaWYgKGh3ZWlnaHQ4KHN0YXRlLT5hY3RpdmVfcGlwZXMp
ID09IDApCi0JCXJldHVybiB0cnVlOworCWlmIChuZXdfYndfc3RhdGUtPnBpcGVfc2Fndl9yZWpl
Y3QgIT0gb2xkX2J3X3N0YXRlLT5waXBlX3NhZ3ZfcmVqZWN0KSB7CisJCURSTV9ERUJVR19LTVMo
IlN0YXRlICVwOiBvbGQgc2FndiBtYXNrIDB4JXgsIG5ldyBzYWd2IG1hc2sgMHgleFxuIiwKKwkJ
CSAgICAgIHN0YXRlLAorCQkJICAgICAgb2xkX2J3X3N0YXRlLT5waXBlX3NhZ3ZfcmVqZWN0LAor
CQkJICAgICAgbmV3X2J3X3N0YXRlLT5waXBlX3NhZ3ZfcmVqZWN0KTsKIAotCWZvcl9lYWNoX25l
d19pbnRlbF9jcnRjX2luX3N0YXRlKHN0YXRlLCBjcnRjLCBjcnRjX3N0YXRlLCBpKSB7Ci0JCWlm
IChJTlRFTF9HRU4oZGV2X3ByaXYpIDw9IDkpIHsKLQkJCWlmICghc2tsX2Nhbl9lbmFibGVfc2Fn
dl9vbl9waXBlKGNydGNfc3RhdGUpKQotCQkJCXJldHVybiBmYWxzZTsKLQkJfSBlbHNlIGlmICgh
aWNsX2Nhbl9lbmFibGVfc2Fndl9vbl9waXBlKGNydGNfc3RhdGUpKSB7Ci0JCQlyZXR1cm4gZmFs
c2U7CisJCXJldCA9IGludGVsX2F0b21pY19zZXJpYWxpemVfZ2xvYmFsX3N0YXRlKCZuZXdfYndf
c3RhdGUtPmJhc2UpOworCQlpZiAocmV0KSB7CisJCQlEUk1fREVCVUdfS01TKCJDb3VsZCBub3Qg
c2VyaWFsaXplIGdsb2JhbCBzdGF0ZVxuIik7CisJCQlyZXR1cm4gcmV0OwogCQl9CiAJfQogCi0J
cmV0dXJuIHRydWU7CisJcmV0dXJuIDA7CiB9CiAKIC8qCkBAIC00MDc1LDYgKzQxNDksNyBAQCBz
a2xfY3Vyc29yX2FsbG9jYXRpb24oY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNf
c3RhdGUsCiAJCXVuc2lnbmVkIGludCBsYXRlbmN5ID0gZGV2X3ByaXYtPndtLnNrbF9sYXRlbmN5
W2xldmVsXTsKIAogCQlza2xfY29tcHV0ZV9wbGFuZV93bShjcnRjX3N0YXRlLCBsZXZlbCwgbGF0
ZW5jeSwgJndwLCAmd20sICZ3bSk7CisKIAkJaWYgKHdtLm1pbl9kZGJfYWxsb2MgPT0gVTE2X01B
WCkKIAkJCWJyZWFrOwogCkBAIC00NTg5LDkgKzQ2NjQsNjYgQEAgc2tsX3BsYW5lX3dtX2xldmVs
KGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlLAogCWNvbnN0IHN0cnVj
dCBza2xfcGxhbmVfd20gKndtID0KIAkJJmNydGNfc3RhdGUtPndtLnNrbC5vcHRpbWFsLnBsYW5l
c1twbGFuZV9pZF07CiAKKwlpZiAoIWxldmVsKSB7CisJCWNvbnN0IHN0cnVjdCBza2xfcGlwZV93
bSAqcGlwZV93bSA9ICZjcnRjX3N0YXRlLT53bS5za2wub3B0aW1hbDsKKworCQlpZiAocGlwZV93
bS0+Y2FuX3NhZ3YpCisJCQlyZXR1cm4gY29sb3JfcGxhbmUgPT0gQ09MT1JfUExBTkVfWSA/ICZ3
bS0+c2Fndl93bTAgOiAmd20tPnV2X3NhZ3Zfd20wOworCX0KKwogCXJldHVybiBjb2xvcl9wbGFu
ZSA9PSBDT0xPUl9QTEFORV9ZID8gJndtLT53bVtsZXZlbF0gOiAmd20tPnV2X3dtW2xldmVsXTsK
IH0KIAorc3RhdGljIGJvb2wKK3RnbF9jYW5fZW5hYmxlX3NhZ3Zfb25fcGlwZShzdHJ1Y3QgaW50
ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSkKK3sKKwlzdHJ1Y3QgaW50ZWxfY3J0YyAqaW50ZWxf
Y3J0YyA9IHRvX2ludGVsX2NydGMoY3J0Y19zdGF0ZS0+dWFwaS5jcnRjKTsKKwllbnVtIHBsYW5l
X2lkIHBsYW5lX2lkOworCisJLyoKKwkgKiBJZiBwaXBlIGlzIG5vdCBhY3RpdmUgaXQgY2FuJ3Qg
YWZmZWN0IFNBR1YgcmVqZWN0aW9uCisJICogQ2hlY2tpbmcgaXQgaGVyZSBpcyBuZWVkZWQgdG8g
bGVhdmUgb25seSBjYXNlcyB3aGVuCisJICogYWxsb2Nfc2l6ZSBpcyAwIGZvciBhbnkgb3RoZXIg
cmVhc29ucywgZXhjZXB0IGluYWN0aXZlCisJICogcGlwZS4gQXMgaW5hY3RpdmUgcGlwZSBpcyBm
aW5lLCBob3dldmVyIGhhdmluZyBubyBkZGIKKwkgKiBzcGFjZSBhdmFpbGFibGUgaXMgYWxyZWFk
eSBwcm9ibGVtYXRpYyAtIHNvIG5lZWQgdG8KKwkgKiB0byBzZXBhcmF0ZSB0aG9zZS4KKwkgKi8K
KwlpZiAoIWNydGNfc3RhdGUtPmh3LmFjdGl2ZSkKKwkJcmV0dXJuIHRydWU7CisKKwkvKgorCSAq
IHNrbF9hbGxvY2F0ZV9waXBlX2RkYiBhbHJlYWR5IGRvbmUgaXQncyBqb2IgdG8gYWxsb2NhdGUK
KwkgKiBhcyBtdWNoIGJsb2NrcyBhcyBwb3NzaWJsZSBmb3IgZWFjaCBwbGFuZSAtIGxldCdzIG5v
dworCSAqIGV2YWx1YXRlIGlmIHRob3NlIHdlcmUgZW5vdWdoIHRvIGVuYWJsZSBTQUdWLgorCSAq
IENyaXRlcmlhIGlzIHRoYXQgd2UgbmVlZCB0byBoYXZlIHdtMCArIHNhZ3ZfYmxvY2tfdGltZSBi
bG9ja3MKKwkgKiBmb3IgbGV2ZWwgMCBmb3IgZWFjaCBwbGFuZS4KKwkgKi8KKwlmb3JfZWFjaF9w
bGFuZV9pZF9vbl9jcnRjKGludGVsX2NydGMsIHBsYW5lX2lkKSB7CisJCXN0cnVjdCBza2xfZGRi
X2VudHJ5ICpwbGFuZV9hbGxvYyA9CisJCQkmY3J0Y19zdGF0ZS0+d20uc2tsLnBsYW5lX2RkYl95
W3BsYW5lX2lkXTsKKwkJc3RydWN0IHNrbF9kZGJfZW50cnkgKnV2X3BsYW5lX2FsbG9jID0KKwkJ
CSZjcnRjX3N0YXRlLT53bS5za2wucGxhbmVfZGRiX3V2W3BsYW5lX2lkXTsKKwkJY29uc3Qgc3Ry
dWN0IHNrbF9wbGFuZV93bSAqd20gPQorCQkJJmNydGNfc3RhdGUtPndtLnNrbC5vcHRpbWFsLnBs
YW5lc1twbGFuZV9pZF07CisKKwkJaWYgKHNrbF9kZGJfZW50cnlfc2l6ZShwbGFuZV9hbGxvYykg
PCB3bS0+c2Fndl93bTAubWluX2RkYl9hbGxvYykgeworCQkJRFJNX0RFQlVHX0tNUygiTm90IGVu
b3VnaCBkZGIgYmxvY2tzKCVkLSVkKSBmb3IgU0FHViBwbGFuZSAlZCBwaXBlICVjXG4iLAorCQkJ
CSAgICAgIHBsYW5lX2FsbG9jLT5zdGFydCwgcGxhbmVfYWxsb2MtPmVuZCwgcGxhbmVfaWQsCisJ
CQkJICAgICAgcGlwZV9uYW1lKGludGVsX2NydGMtPnBpcGUpKTsKKwkJCXJldHVybiBmYWxzZTsK
KwkJfQorCisJCWlmIChza2xfZGRiX2VudHJ5X3NpemUodXZfcGxhbmVfYWxsb2MpIDwgd20tPnV2
X3NhZ3Zfd20wLm1pbl9kZGJfYWxsb2MpIHsKKwkJCURSTV9ERUJVR19LTVMoIk5vdCBlbm91Z2gg
ZGRiIGJsb2NrcyglZC0lZCkgZm9yIFNBR1YgdXYgcGxhbmUgJWQgcGlwZSAlY1xuIiwKKwkJCQkg
ICAgICBwbGFuZV9hbGxvYy0+c3RhcnQsIHBsYW5lX2FsbG9jLT5lbmQsIHBsYW5lX2lkLAorCQkJ
CSAgICAgIHBpcGVfbmFtZShpbnRlbF9jcnRjLT5waXBlKSk7CisJCQlyZXR1cm4gZmFsc2U7CisJ
CX0KKwl9CisKKwlyZXR1cm4gdHJ1ZTsKK30KKwogc3RhdGljIGludAogc2tsX2FsbG9jYXRlX3Bp
cGVfZGRiKHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlKQogewpAQCAtNTE3Mywx
MCArNTMwNSwxNyBAQCBzdGF0aWMgdm9pZCBza2xfY29tcHV0ZV9wbGFuZV93bShjb25zdCBzdHJ1
Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSwKIHN0YXRpYyB2b2lkCiBza2xfY29tcHV0
ZV93bV9sZXZlbHMoY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUsCiAJ
CSAgICAgIGNvbnN0IHN0cnVjdCBza2xfd21fcGFyYW1zICp3bV9wYXJhbXMsCi0JCSAgICAgIHN0
cnVjdCBza2xfd21fbGV2ZWwgKmxldmVscykKKwkJICAgICAgc3RydWN0IHNrbF9wbGFuZV93bSAq
cGxhbmVfd20sCisJCSAgICAgIGVudW0gY29sb3JfcGxhbmUgY29sb3JfcGxhbmUpCiB7CiAJc3Ry
dWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShjcnRjX3N0YXRlLT51YXBp
LmNydGMtPmRldik7CiAJaW50IGxldmVsLCBtYXhfbGV2ZWwgPSBpbGtfd21fbWF4X2xldmVsKGRl
dl9wcml2KTsKKwkvKgorCSAqIENoZWNrIHdoaWNoIGtpbmQgb2YgcGxhbmUgaXMgaXQgYW5kIGJh
c2VkIG9uIHRoYXQgY2FsY3VsYXRlCisJICogY29ycmVzcG9uZGVudCBXTSBsZXZlbHMuCisJICov
CisJc3RydWN0IHNrbF93bV9sZXZlbCAqbGV2ZWxzID0gY29sb3JfcGxhbmUgPT0gQ09MT1JfUExB
TkVfVVYgPworCQkJCSAgICAgIHBsYW5lX3dtLT51dl93bSA6IHBsYW5lX3dtLT53bTsKIAlzdHJ1
Y3Qgc2tsX3dtX2xldmVsICpyZXN1bHRfcHJldiA9ICZsZXZlbHNbMF07CiAKIAlmb3IgKGxldmVs
ID0gMDsgbGV2ZWwgPD0gbWF4X2xldmVsOyBsZXZlbCsrKSB7CkBAIC01MTkwLDYgKzUzMjksNDAg
QEAgc2tsX2NvbXB1dGVfd21fbGV2ZWxzKGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpj
cnRjX3N0YXRlLAogCX0KIH0KIAorc3RhdGljIHZvaWQgc2tsX2NvbXB1dGVfc2Fndl93bShjb25z
dCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSwKKwkJCQljb25zdCBzdHJ1Y3Qg
c2tsX3dtX3BhcmFtcyAqd21fcGFyYW1zLAorCQkJCXN0cnVjdCBza2xfcGxhbmVfd20gKnBsYW5l
X3dtLAorCQkJCWVudW0gY29sb3JfcGxhbmUgY29sb3JfcGxhbmUpCit7CisJc3RydWN0IGRybV9p
OTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShjcnRjX3N0YXRlLT51YXBpLmNydGMtPmRl
dik7CisJc3RydWN0IHNrbF93bV9sZXZlbCAqc2Fndl93bSA9IGNvbG9yX3BsYW5lID09IENPTE9S
X1BMQU5FX1VWID8KKwkJCQkmcGxhbmVfd20tPnV2X3NhZ3Zfd20wIDogJnBsYW5lX3dtLT5zYWd2
X3dtMDsKKwlzdHJ1Y3Qgc2tsX3dtX2xldmVsICpsZXZlbHMgPSBjb2xvcl9wbGFuZSA9PSBDT0xP
Ul9QTEFORV9VViA/CisJCQkJcGxhbmVfd20tPnV2X3dtIDogcGxhbmVfd20tPndtOworCisJLyoK
KwkgKiBGb3IgR2VuMTIgaWYgaXQgaXMgYW4gTDAgd2UgbmVlZCB0byBhbHNvCisJICogY29uc2lk
ZXIgc2Fndl9ibG9ja190aW1lIHdoZW4gY2FsY3VsYXRpbmcKKwkgKiBMMCB3YXRlcm1hcmsgLSB3
ZSB3aWxsIG5lZWQgdGhhdCB3aGVuIG1ha2luZworCSAqIGEgZGVjaXNpb24gd2hldGhlciBlbmFi
bGUgU0FHViBvciBub3QuCisJICogRm9yIG9sZGVyIGdlbnMgd2UgYWdyZWVkIHRvIGNvcHkgTDAg
dmFsdWUgZm9yCisJICogY29tcGF0aWJpbGl0eS4KKwkgKi8KKwlpZiAoKElOVEVMX0dFTihkZXZf
cHJpdikgPj0gMTIpKSB7CisJCXUzMiBsYXRlbmN5ID0gZGV2X3ByaXYtPndtLnNrbF9sYXRlbmN5
WzBdOworCisJCWxhdGVuY3kgKz0gZGV2X3ByaXYtPnNhZ3ZfYmxvY2tfdGltZV91czsKKwkJc2ts
X2NvbXB1dGVfcGxhbmVfd20oY3J0Y19zdGF0ZSwgMCwgbGF0ZW5jeSwKKwkJCQkgICAgIHdtX3Bh
cmFtcywgJmxldmVsc1swXSwKKwkJCQkgICAgIHNhZ3Zfd20pOworCQlEUk1fREVCVUdfS01TKCIl
ZCBMMCBibG9ja3MgcmVxdWlyZWQgZm9yIFNBR1YgdnMgJWQgZm9yIG5vbi1TQUdWXG4iLAorCQkJ
ICAgICAgc2Fndl93bS0+bWluX2RkYl9hbGxvYywgbGV2ZWxzWzBdLm1pbl9kZGJfYWxsb2MpOwor
CX0gZWxzZSB7CisJCS8qIFNpbmNlIGFsbCBtZW1iZXJzIGFyZSBQT0QgKi8KKwkJKnNhZ3Zfd20g
PSBsZXZlbHNbMF07CisJfQorfQorCiBzdGF0aWMgdm9pZCBza2xfY29tcHV0ZV90cmFuc2l0aW9u
X3dtKGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlLAogCQkJCSAgICAg
IGNvbnN0IHN0cnVjdCBza2xfd21fcGFyYW1zICp3cCwKIAkJCQkgICAgICBzdHJ1Y3Qgc2tsX3Bs
YW5lX3dtICp3bSkKQEAgLTUyNzAsNyArNTQ0Myw4IEBAIHN0YXRpYyBpbnQgc2tsX2J1aWxkX3Bs
YW5lX3dtX3NpbmdsZShzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSwKIAlpZiAo
cmV0KQogCQlyZXR1cm4gcmV0OwogCi0Jc2tsX2NvbXB1dGVfd21fbGV2ZWxzKGNydGNfc3RhdGUs
ICZ3bV9wYXJhbXMsIHdtLT53bSk7CisJc2tsX2NvbXB1dGVfd21fbGV2ZWxzKGNydGNfc3RhdGUs
ICZ3bV9wYXJhbXMsIHdtLCBDT0xPUl9QTEFORV9ZKTsKKwlza2xfY29tcHV0ZV9zYWd2X3dtKGNy
dGNfc3RhdGUsICZ3bV9wYXJhbXMsIHdtLCBDT0xPUl9QTEFORV9ZKTsKIAlza2xfY29tcHV0ZV90
cmFuc2l0aW9uX3dtKGNydGNfc3RhdGUsICZ3bV9wYXJhbXMsIHdtKTsKIAogCXJldHVybiAwOwpA
QCAtNTI5Miw3ICs1NDY2LDggQEAgc3RhdGljIGludCBza2xfYnVpbGRfcGxhbmVfd21fdXYoc3Ry
dWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUsCiAJaWYgKHJldCkKIAkJcmV0dXJuIHJl
dDsKIAotCXNrbF9jb21wdXRlX3dtX2xldmVscyhjcnRjX3N0YXRlLCAmd21fcGFyYW1zLCB3bS0+
dXZfd20pOworCXNrbF9jb21wdXRlX3dtX2xldmVscyhjcnRjX3N0YXRlLCAmd21fcGFyYW1zLCB3
bSwgQ09MT1JfUExBTkVfVVYpOworCXNrbF9jb21wdXRlX3NhZ3Zfd20oY3J0Y19zdGF0ZSwgJndt
X3BhcmFtcywgd20sIENPTE9SX1BMQU5FX1VWKTsKIAogCXJldHVybiAwOwogfQpAQCAtNTYzMSw5
ICs1ODA2LDI1IEBAIHNrbF9wcmludF93bV9jaGFuZ2VzKHN0cnVjdCBpbnRlbF9hdG9taWNfc3Rh
dGUgKnN0YXRlKQogCQlmb3JfZWFjaF9pbnRlbF9wbGFuZV9vbl9jcnRjKCZkZXZfcHJpdi0+ZHJt
LCBjcnRjLCBwbGFuZSkgewogCQkJZW51bSBwbGFuZV9pZCBwbGFuZV9pZCA9IHBsYW5lLT5pZDsK
IAkJCWNvbnN0IHN0cnVjdCBza2xfcGxhbmVfd20gKm9sZF93bSwgKm5ld193bTsKKwkJCWNvbnN0
IHN0cnVjdCBza2xfd21fbGV2ZWwgKm9sZF93bV9sZXZlbCwgKm5ld193bV9sZXZlbDsKKwkJCXUx
NiBvbGRfcGxhbmVfcmVzX2wsIG5ld19wbGFuZV9yZXNfbDsKKwkJCXU4ICBvbGRfcGxhbmVfcmVz
X2IsIG5ld19wbGFuZV9yZXNfYjsKKwkJCXUxNiBvbGRfbWluX2RkYl9hbGxvYywgbmV3X21pbl9k
ZGJfYWxsb2M7CisJCQlpbnQgY29sb3JfcGxhbmUgPSAwOwogCiAJCQlvbGRfd20gPSAmb2xkX3Bp
cGVfd20tPnBsYW5lc1twbGFuZV9pZF07CiAJCQluZXdfd20gPSAmbmV3X3BpcGVfd20tPnBsYW5l
c1twbGFuZV9pZF07CisJCQlvbGRfd21fbGV2ZWwgPSBza2xfcGxhbmVfd21fbGV2ZWwob2xkX2Ny
dGNfc3RhdGUsIHBsYW5lX2lkLCAwLCBjb2xvcl9wbGFuZSk7CisJCQluZXdfd21fbGV2ZWwgPSBz
a2xfcGxhbmVfd21fbGV2ZWwobmV3X2NydGNfc3RhdGUsIHBsYW5lX2lkLCAwLCBjb2xvcl9wbGFu
ZSk7CisKKwkJCW9sZF9wbGFuZV9yZXNfbCA9IG9sZF93bV9sZXZlbC0+cGxhbmVfcmVzX2w7CisJ
CQlvbGRfcGxhbmVfcmVzX2IgPSBvbGRfd21fbGV2ZWwtPnBsYW5lX3Jlc19iOworCisJCQluZXdf
cGxhbmVfcmVzX2wgPSBuZXdfd21fbGV2ZWwtPnBsYW5lX3Jlc19sOworCQkJbmV3X3BsYW5lX3Jl
c19iID0gbmV3X3dtX2xldmVsLT5wbGFuZV9yZXNfYjsKKworCQkJb2xkX21pbl9kZGJfYWxsb2Mg
PSBvbGRfd21fbGV2ZWwtPm1pbl9kZGJfYWxsb2M7CisJCQluZXdfbWluX2RkYl9hbGxvYyA9IG5l
d193bV9sZXZlbC0+bWluX2RkYl9hbGxvYzsKIAogCQkJaWYgKHNrbF9wbGFuZV93bV9lcXVhbHMo
ZGV2X3ByaXYsIG9sZF93bSwgbmV3X3dtKSkKIAkJCQljb250aW51ZTsKQEAgLTU2NTcsNyArNTg0
OCw3IEBAIHNrbF9wcmludF93bV9jaGFuZ2VzKHN0cnVjdCBpbnRlbF9hdG9taWNfc3RhdGUgKnN0
YXRlKQogCQkJCSAgICAiW1BMQU5FOiVkOiVzXSAgIGxpbmVzICVjJTNkLCVjJTNkLCVjJTNkLCVj
JTNkLCVjJTNkLCVjJTNkLCVjJTNkLCVjJTNkLCVjJTNkIgogCQkJCSAgICAgICIgLT4gJWMlM2Qs
JWMlM2QsJWMlM2QsJWMlM2QsJWMlM2QsJWMlM2QsJWMlM2QsJWMlM2QsJWMlM2RcbiIsCiAJCQkJ
ICAgIHBsYW5lLT5iYXNlLmJhc2UuaWQsIHBsYW5lLT5iYXNlLm5hbWUsCi0JCQkJICAgIGVuYXN0
KG9sZF93bS0+d21bMF0uaWdub3JlX2xpbmVzKSwgb2xkX3dtLT53bVswXS5wbGFuZV9yZXNfbCwK
KwkJCQkgICAgZW5hc3Qob2xkX3dtLT53bVswXS5pZ25vcmVfbGluZXMpLCBvbGRfcGxhbmVfcmVz
X2wsCiAJCQkJICAgIGVuYXN0KG9sZF93bS0+d21bMV0uaWdub3JlX2xpbmVzKSwgb2xkX3dtLT53
bVsxXS5wbGFuZV9yZXNfbCwKIAkJCQkgICAgZW5hc3Qob2xkX3dtLT53bVsyXS5pZ25vcmVfbGlu
ZXMpLCBvbGRfd20tPndtWzJdLnBsYW5lX3Jlc19sLAogCQkJCSAgICBlbmFzdChvbGRfd20tPndt
WzNdLmlnbm9yZV9saW5lcyksIG9sZF93bS0+d21bM10ucGxhbmVfcmVzX2wsCkBAIC01NjY3LDcg
KzU4NTgsNyBAQCBza2xfcHJpbnRfd21fY2hhbmdlcyhzdHJ1Y3QgaW50ZWxfYXRvbWljX3N0YXRl
ICpzdGF0ZSkKIAkJCQkgICAgZW5hc3Qob2xkX3dtLT53bVs3XS5pZ25vcmVfbGluZXMpLCBvbGRf
d20tPndtWzddLnBsYW5lX3Jlc19sLAogCQkJCSAgICBlbmFzdChvbGRfd20tPnRyYW5zX3dtLmln
bm9yZV9saW5lcyksIG9sZF93bS0+dHJhbnNfd20ucGxhbmVfcmVzX2wsCiAKLQkJCQkgICAgZW5h
c3QobmV3X3dtLT53bVswXS5pZ25vcmVfbGluZXMpLCBuZXdfd20tPndtWzBdLnBsYW5lX3Jlc19s
LAorCQkJCSAgICBlbmFzdChuZXdfd20tPndtWzBdLmlnbm9yZV9saW5lcyksIG5ld19wbGFuZV9y
ZXNfbCwKIAkJCQkgICAgZW5hc3QobmV3X3dtLT53bVsxXS5pZ25vcmVfbGluZXMpLCBuZXdfd20t
PndtWzFdLnBsYW5lX3Jlc19sLAogCQkJCSAgICBlbmFzdChuZXdfd20tPndtWzJdLmlnbm9yZV9s
aW5lcyksIG5ld193bS0+d21bMl0ucGxhbmVfcmVzX2wsCiAJCQkJICAgIGVuYXN0KG5ld193bS0+
d21bM10uaWdub3JlX2xpbmVzKSwgbmV3X3dtLT53bVszXS5wbGFuZV9yZXNfbCwKQEAgLTU2ODEs
MTIgKzU4NzIsMTIgQEAgc2tsX3ByaW50X3dtX2NoYW5nZXMoc3RydWN0IGludGVsX2F0b21pY19z
dGF0ZSAqc3RhdGUpCiAJCQkJICAgICJbUExBTkU6JWQ6JXNdICBibG9ja3MgJTRkLCU0ZCwlNGQs
JTRkLCU0ZCwlNGQsJTRkLCU0ZCwlNGQiCiAJCQkJICAgICIgLT4gJTRkLCU0ZCwlNGQsJTRkLCU0
ZCwlNGQsJTRkLCU0ZCwlNGRcbiIsCiAJCQkJICAgIHBsYW5lLT5iYXNlLmJhc2UuaWQsIHBsYW5l
LT5iYXNlLm5hbWUsCi0JCQkJICAgIG9sZF93bS0+d21bMF0ucGxhbmVfcmVzX2IsIG9sZF93bS0+
d21bMV0ucGxhbmVfcmVzX2IsCisJCQkJICAgIG9sZF9wbGFuZV9yZXNfYiwgb2xkX3dtLT53bVsx
XS5wbGFuZV9yZXNfYiwKIAkJCQkgICAgb2xkX3dtLT53bVsyXS5wbGFuZV9yZXNfYiwgb2xkX3dt
LT53bVszXS5wbGFuZV9yZXNfYiwKIAkJCQkgICAgb2xkX3dtLT53bVs0XS5wbGFuZV9yZXNfYiwg
b2xkX3dtLT53bVs1XS5wbGFuZV9yZXNfYiwKIAkJCQkgICAgb2xkX3dtLT53bVs2XS5wbGFuZV9y
ZXNfYiwgb2xkX3dtLT53bVs3XS5wbGFuZV9yZXNfYiwKIAkJCQkgICAgb2xkX3dtLT50cmFuc193
bS5wbGFuZV9yZXNfYiwKLQkJCQkgICAgbmV3X3dtLT53bVswXS5wbGFuZV9yZXNfYiwgbmV3X3dt
LT53bVsxXS5wbGFuZV9yZXNfYiwKKwkJCQkgICAgbmV3X3BsYW5lX3Jlc19iLCBuZXdfd20tPndt
WzFdLnBsYW5lX3Jlc19iLAogCQkJCSAgICBuZXdfd20tPndtWzJdLnBsYW5lX3Jlc19iLCBuZXdf
d20tPndtWzNdLnBsYW5lX3Jlc19iLAogCQkJCSAgICBuZXdfd20tPndtWzRdLnBsYW5lX3Jlc19i
LCBuZXdfd20tPndtWzVdLnBsYW5lX3Jlc19iLAogCQkJCSAgICBuZXdfd20tPndtWzZdLnBsYW5l
X3Jlc19iLCBuZXdfd20tPndtWzddLnBsYW5lX3Jlc19iLApAQCAtNTY5NiwxMiArNTg4NywxMiBA
QCBza2xfcHJpbnRfd21fY2hhbmdlcyhzdHJ1Y3QgaW50ZWxfYXRvbWljX3N0YXRlICpzdGF0ZSkK
IAkJCQkgICAgIltQTEFORTolZDolc10gbWluX2RkYiAlNGQsJTRkLCU0ZCwlNGQsJTRkLCU0ZCwl
NGQsJTRkLCU0ZCIKIAkJCQkgICAgIiAtPiAlNGQsJTRkLCU0ZCwlNGQsJTRkLCU0ZCwlNGQsJTRk
LCU0ZFxuIiwKIAkJCQkgICAgcGxhbmUtPmJhc2UuYmFzZS5pZCwgcGxhbmUtPmJhc2UubmFtZSwK
LQkJCQkgICAgb2xkX3dtLT53bVswXS5taW5fZGRiX2FsbG9jLCBvbGRfd20tPndtWzFdLm1pbl9k
ZGJfYWxsb2MsCisJCQkJICAgIG9sZF9taW5fZGRiX2FsbG9jLCBvbGRfd20tPndtWzFdLm1pbl9k
ZGJfYWxsb2MsCiAJCQkJICAgIG9sZF93bS0+d21bMl0ubWluX2RkYl9hbGxvYywgb2xkX3dtLT53
bVszXS5taW5fZGRiX2FsbG9jLAogCQkJCSAgICBvbGRfd20tPndtWzRdLm1pbl9kZGJfYWxsb2Ms
IG9sZF93bS0+d21bNV0ubWluX2RkYl9hbGxvYywKIAkJCQkgICAgb2xkX3dtLT53bVs2XS5taW5f
ZGRiX2FsbG9jLCBvbGRfd20tPndtWzddLm1pbl9kZGJfYWxsb2MsCiAJCQkJICAgIG9sZF93bS0+
dHJhbnNfd20ubWluX2RkYl9hbGxvYywKLQkJCQkgICAgbmV3X3dtLT53bVswXS5taW5fZGRiX2Fs
bG9jLCBuZXdfd20tPndtWzFdLm1pbl9kZGJfYWxsb2MsCisJCQkJICAgIG5ld19taW5fZGRiX2Fs
bG9jLCBuZXdfd20tPndtWzFdLm1pbl9kZGJfYWxsb2MsCiAJCQkJICAgIG5ld193bS0+d21bMl0u
bWluX2RkYl9hbGxvYywgbmV3X3dtLT53bVszXS5taW5fZGRiX2FsbG9jLAogCQkJCSAgICBuZXdf
d20tPndtWzRdLm1pbl9kZGJfYWxsb2MsIG5ld193bS0+d21bNV0ubWluX2RkYl9hbGxvYywKIAkJ
CQkgICAgbmV3X3dtLT53bVs2XS5taW5fZGRiX2FsbG9jLCBuZXdfd20tPndtWzddLm1pbl9kZGJf
YWxsb2MsCkBAIC01ODY2LDYgKzYwNTcsMTAgQEAgc2tsX2NvbXB1dGVfd20oc3RydWN0IGludGVs
X2F0b21pY19zdGF0ZSAqc3RhdGUpCiAJaWYgKHJldCkKIAkJcmV0dXJuIHJldDsKIAorCXJldCA9
IGludGVsX2NvbXB1dGVfc2Fndl9tYXNrKHN0YXRlKTsKKwlpZiAocmV0KQorCQlyZXR1cm4gcmV0
OworCiAJLyoKIAkgKiBza2xfY29tcHV0ZV9kZGIoKSB3aWxsIGhhdmUgYWRqdXN0ZWQgdGhlIGZp
bmFsIHdhdGVybWFya3MKIAkgKiBiYXNlZCBvbiBob3cgbXVjaCBkZGIgaXMgYXZhaWxhYmxlLiBO
b3cgd2UgY2FuIGFjdHVhbGx5CkBAIC01OTkzLDYgKzYxODgsOSBAQCB2b2lkIHNrbF9waXBlX3dt
X2dldF9od19zdGF0ZShzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YywKIAkJCQl2YWwgPSBJOTE1X1JF
QUQoQ1VSX1dNKHBpcGUsIGxldmVsKSk7CiAKIAkJCXNrbF93bV9sZXZlbF9mcm9tX3JlZ192YWwo
dmFsLCAmd20tPndtW2xldmVsXSk7CisJCQlpZiAobGV2ZWwgPT0gMCkKKwkJCQltZW1jcHkoJndt
LT5zYWd2X3dtMCwgJndtLT53bVtsZXZlbF0sCisJCQkJICAgICAgIHNpemVvZihzdHJ1Y3Qgc2ts
X3dtX2xldmVsKSk7CiAJCX0KIAogCQlpZiAocGxhbmVfaWQgIT0gUExBTkVfQ1VSU09SKQpkaWZm
IC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50ZWxfcG0uaCBiL2RyaXZlcnMvZ3B1L2Ry
bS9pOTE1L2ludGVsX3BtLmgKaW5kZXggZDYwYTg1NDIxYzVhLi41ZmIzMmRiNGFiYzUgMTAwNjQ0
Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2ludGVsX3BtLmgKKysrIGIvZHJpdmVycy9ncHUv
ZHJtL2k5MTUvaW50ZWxfcG0uaApAQCAtOSw2ICs5LDcgQEAKICNpbmNsdWRlIDxsaW51eC90eXBl
cy5oPgogCiAjaW5jbHVkZSAiaTkxNV9yZWcuaCIKKyNpbmNsdWRlICJkaXNwbGF5L2ludGVsX2J3
LmgiCiAKIHN0cnVjdCBkcm1fZGV2aWNlOwogc3RydWN0IGRybV9pOTE1X3ByaXZhdGU7CkBAIC00
MSw3ICs0Miw4IEBAIHZvaWQgc2tsX3BpcGVfd21fZ2V0X2h3X3N0YXRlKHN0cnVjdCBpbnRlbF9j
cnRjICpjcnRjLAogCQkJICAgICAgc3RydWN0IHNrbF9waXBlX3dtICpvdXQpOwogdm9pZCBnNHhf
d21fc2FuaXRpemUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KTsKIHZvaWQgdmx2
X3dtX3Nhbml0aXplKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdik7Ci1ib29sIGlu
dGVsX2Nhbl9lbmFibGVfc2FndihzdHJ1Y3QgaW50ZWxfYXRvbWljX3N0YXRlICpzdGF0ZSk7Citi
b29sIGludGVsX2hhc19zYWd2KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdik7Citi
b29sIGludGVsX2Nhbl9lbmFibGVfc2FndihzdHJ1Y3QgaW50ZWxfYndfc3RhdGUgKmJ3X3N0YXRl
KTsKIGludCBpbnRlbF9lbmFibGVfc2FndihzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3By
aXYpOwogaW50IGludGVsX2Rpc2FibGVfc2FndihzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2
X3ByaXYpOwogYm9vbCBza2xfd21fbGV2ZWxfZXF1YWxzKGNvbnN0IHN0cnVjdCBza2xfd21fbGV2
ZWwgKmwxLAotLSAKMi4yNC4xLjQ4NS5nYWQwNWEzZDhlNQoKX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX18KSW50ZWwtZ2Z4IG1haWxpbmcgbGlzdApJbnRlbC1n
ZnhAbGlzdHMuZnJlZWRlc2t0b3Aub3JnCmh0dHBzOi8vbGlzdHMuZnJlZWRlc2t0b3Aub3JnL21h
aWxtYW4vbGlzdGluZm8vaW50ZWwtZ2Z4Cg==

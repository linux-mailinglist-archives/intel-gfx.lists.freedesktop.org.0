Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 56971A2F8A
	for <lists+intel-gfx@lfdr.de>; Fri, 30 Aug 2019 08:14:00 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 6DA956E260;
	Fri, 30 Aug 2019 06:13:58 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from fireflyinternet.com (mail.fireflyinternet.com [109.228.58.192])
 by gabe.freedesktop.org (Postfix) with ESMTPS id A7DEE6E261
 for <intel-gfx@lists.freedesktop.org>; Fri, 30 Aug 2019 06:13:54 +0000 (UTC)
X-Default-Received-SPF: pass (skip=forwardok (res=PASS))
 x-ip-name=78.156.65.138; 
Received: from haswell.alporthouse.com (unverified [78.156.65.138]) 
 by fireflyinternet.com (Firefly Internet (M1)) with ESMTP id 18312342-1500050 
 for multiple; Fri, 30 Aug 2019 07:12:08 +0100
From: Chris Wilson <chris@chris-wilson.co.uk>
To: intel-gfx@lists.freedesktop.org
Date: Fri, 30 Aug 2019 07:11:58 +0100
Message-Id: <20190830061204.21206-15-chris@chris-wilson.co.uk>
X-Mailer: git-send-email 2.23.0
In-Reply-To: <20190830061204.21206-1-chris@chris-wilson.co.uk>
References: <20190830061204.21206-1-chris@chris-wilson.co.uk>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH 15/21] drm/i915: Coordinate i915_active with its
 own mutex
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

Rm9yZ28gdGhlIHN0cnVjdF9tdXRleCBzZXJpYWxpc2F0aW9uIGZvciBpOTE1X2FjdGl2ZSwgYW5k
IGludGVycG9zZSBpdHMKb3duIG11dGV4IGhhbmRsaW5nIGZvciBhY3RpdmUvcmV0aXJlLgoKVGhp
cyBpcyBhIG11bHRpLWxheWVyZWQgc2xlaWdodC1vZi1oYW5kLiBGaXJzdCwgd2UgaGFkIHRvIGVu
c3VyZSB0aGF0IG5vCmFjdGl2ZS9yZXRpcmUgY2FsbGJhY2tzIGFjY2lkZW50YWxseSBpbnZlcnRl
ZCB0aGUgbXV0ZXggb3JkZXJpbmcgcnVsZXMsCm5vciBhc3N1bWVkIHRoYXQgdGhleSB3ZXJlIHRo
ZW1zZWx2ZXMgc2VyaWFsaXNlZCBieSBzdHJ1Y3RfbXV0ZXguIE1vcmUKY2hhbGxlbmdpbmcgdGhv
dWdoLCBpcyB0aGUgcnVsZSBvdmVyIHVwZGF0aW5nIGVsZW1lbnRzIG9mIHRoZSBhY3RpdmUKcmJ0
cmVlLiBJbnN0ZWFkIG9mIHRoZSB3aG9sZSBpOTE1X2FjdGl2ZSBub3cgYmVpbmcgc2VyaWFsaXNl
ZCBieQpzdHJ1Y3RfbXV0ZXgsIGFsbG9jYXRpb25zL3JvdGF0aW9ucyBvZiB0aGUgdHJlZSBhcmUg
c2VyaWFsaXNlZCBieSB0aGUKaTkxNV9hY3RpdmUubXV0ZXggYW5kIGluZGl2aWR1YWwgbm9kZXMg
YXJlIHNlcmlhbGlzZWQgYnkgdGhlIGNhbGxlcgp1c2luZyB0aGUgaTkxNV90aW1lbGluZS5tdXRl
eCAod2UgbmVlZCB0byB1c2UgbmVzdGVkIHNwaW5sb2NrcyB0bwppbnRlcmFjdCB3aXRoIHRoZSBk
bWFfZmVuY2UgY2FsbGJhY2sgbGlzdHMpLgoKVGhlIHBhaW4gcG9pbnQgaGVyZSBpcyB0aGF0IGlu
c3RlYWQgb2YgYSBzaW5nbGUgbXV0ZXggYXJvdW5kIGV4ZWNidWYsIHdlCm5vdyBoYXZlIHRvIHRh
a2UgYSBtdXRleCBmb3IgYWN0aXZlIHRyYWNrZXIgKG9uZSBmb3IgZWFjaCB2bWEsIGNvbnRleHQs
CmV0YykgYW5kIGEgY291cGxlIG9mIHNwaW5sb2NrcyBmb3IgZWFjaCBmZW5jZSB1cGRhdGUuIFRo
ZSBpbXByb3ZlbWVudCBpbgpmaW5lIGdyYWluZWQgbG9ja2luZyBhbGxvd2luZyBmb3IgbXVsdGlw
bGUgY29uY3VycmVudCBjbGllbnRzCihldmVudHVhbGx5ISkgc2hvdWxkIGJlIHdvcnRoIGl0IGlu
IHR5cGljYWwgbG9hZHMuCgpTaWduZWQtb2ZmLWJ5OiBDaHJpcyBXaWxzb24gPGNocmlzQGNocmlz
LXdpbHNvbi5jby51az4KLS0tCiAuLi4vZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZnJvbnRi
dWZmZXIuYyAgfCAgIDIgKy0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfb3Zl
cmxheS5jICB8ICAgNSArLQogLi4uL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fY2xpZW50X2Js
dC5jICAgIHwgICAyICstCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fY29udGV4
dC5jICAgfCAgIDggKy0KIC4uLi9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX29iamVjdF90eXBl
cy5oICB8ICAgMSArCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fcG0uYyAgICAg
ICAgfCAgIDkgKy0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2NvbnRleHQuYyAgICAg
ICB8ICAgNiArLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfZW5naW5lX3Bvb2wuYyAg
IHwgICAyICstCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9lbmdpbmVfcG9vbC5oICAg
fCAgIDIgKy0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX3Jlc2V0LmMgICAgICAgICB8
ICAxMCArLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfdGltZWxpbmUuYyAgICAgIHwg
ICA5ICstCiAuLi4vZ3B1L2RybS9pOTE1L2d0L2ludGVsX3RpbWVsaW5lX3R5cGVzLmggICAgfCAg
IDIgKy0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L3NlbGZ0ZXN0X2NvbnRleHQuYyAgICB8ICAx
NiArLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qvc2VsZnRlc3RfbHJjLmMgICAgICAgIHwgIDEw
ICstCiAuLi4vZ3B1L2RybS9pOTE1L2d0L3NlbGZ0ZXN0cy9tb2NrX3RpbWVsaW5lLmMgfCAgIDIg
Ky0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2d2dC9zY2hlZHVsZXIuYyAgICAgICAgICB8ICAgMyAt
CiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2FjdGl2ZS5jICAgICAgICAgICAgfCAyOTEgKysr
KysrKy0tLS0tLS0tLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9hY3RpdmUuaCAgICAgICAg
ICAgIHwgMzE2ICsrKystLS0tLS0tLS0tLS0tLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9h
Y3RpdmVfdHlwZXMuaCAgICAgIHwgIDIzICstCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2dl
bS5jICAgICAgICAgICAgICAgfCAgNDIgKystCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2dl
bV9ndHQuYyAgICAgICAgICAgfCAgIDMgKy0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZ3B1
X2Vycm9yLmMgICAgICAgICB8ICAgNCArLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9yZXF1
ZXN0LmMgICAgICAgICAgIHwgIDM5ICstLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9yZXF1
ZXN0LmggICAgICAgICAgIHwgICAxIC0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfdm1hLmMg
ICAgICAgICAgICAgICB8ICAgOCArLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvc2VsZnRlc3RzL2k5
MTVfYWN0aXZlLmMgIHwgIDM2ICstCiAyNiBmaWxlcyBjaGFuZ2VkLCAyNzMgaW5zZXJ0aW9ucygr
KSwgNTc5IGRlbGV0aW9ucygtKQoKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rp
c3BsYXkvaW50ZWxfZnJvbnRidWZmZXIuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkv
aW50ZWxfZnJvbnRidWZmZXIuYwppbmRleCA2NDI4YjhkZDcwZDMuLjg0YjE2NGYzMTg5NSAxMDA2
NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9mcm9udGJ1ZmZlci5j
CisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZnJvbnRidWZmZXIuYwpA
QCAtMjU3LDcgKzI1Nyw3IEBAIGludGVsX2Zyb250YnVmZmVyX2dldChzdHJ1Y3QgZHJtX2k5MTVf
Z2VtX29iamVjdCAqb2JqKQogCWZyb250LT5vYmogPSBvYmo7CiAJa3JlZl9pbml0KCZmcm9udC0+
cmVmKTsKIAlhdG9taWNfc2V0KCZmcm9udC0+Yml0cywgMCk7Ci0JaTkxNV9hY3RpdmVfaW5pdChp
OTE1LCAmZnJvbnQtPndyaXRlLAorCWk5MTVfYWN0aXZlX2luaXQoJmZyb250LT53cml0ZSwKIAkJ
CSBmcm9udGJ1ZmZlcl9hY3RpdmUsCiAJCQkgaTkxNV9hY3RpdmVfbWF5X3NsZWVwKGZyb250YnVm
ZmVyX3JldGlyZSkpOwogCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5
L2ludGVsX292ZXJsYXkuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfb3Zl
cmxheS5jCmluZGV4IDRmMzY1NTdiM2YzYi4uNTQ0ZTk1MzM0MmVhIDEwMDY0NAotLS0gYS9kcml2
ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX292ZXJsYXkuYworKysgYi9kcml2ZXJzL2dw
dS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX292ZXJsYXkuYwpAQCAtMjMwLDcgKzIzMCw3IEBAIGFs
bG9jX3JlcXVlc3Qoc3RydWN0IGludGVsX292ZXJsYXkgKm92ZXJsYXksIHZvaWQgKCpmbikoc3Ry
dWN0IGludGVsX292ZXJsYXkgKikpCiAJaWYgKElTX0VSUihycSkpCiAJCXJldHVybiBycTsKIAot
CWVyciA9IGk5MTVfYWN0aXZlX3JlZigmb3ZlcmxheS0+bGFzdF9mbGlwLCBycS0+dGltZWxpbmUs
IHJxKTsKKwllcnIgPSBpOTE1X2FjdGl2ZV9yZWYoJm92ZXJsYXktPmxhc3RfZmxpcCwgcnEtPnRp
bWVsaW5lLCAmcnEtPmZlbmNlKTsKIAlpZiAoZXJyKSB7CiAJCWk5MTVfcmVxdWVzdF9hZGQocnEp
OwogCQlyZXR1cm4gRVJSX1BUUihlcnIpOwpAQCAtMTM2MCw4ICsxMzYwLDcgQEAgdm9pZCBpbnRl
bF9vdmVybGF5X3NldHVwKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikKIAlvdmVy
bGF5LT5jb250cmFzdCA9IDc1OwogCW92ZXJsYXktPnNhdHVyYXRpb24gPSAxNDY7CiAKLQlpOTE1
X2FjdGl2ZV9pbml0KGRldl9wcml2LAotCQkJICZvdmVybGF5LT5sYXN0X2ZsaXAsCisJaTkxNV9h
Y3RpdmVfaW5pdCgmb3ZlcmxheS0+bGFzdF9mbGlwLAogCQkJIE5VTEwsIGludGVsX292ZXJsYXlf
bGFzdF9mbGlwX3JldGlyZSk7CiAKIAlyZXQgPSBnZXRfcmVnaXN0ZXJzKG92ZXJsYXksIE9WRVJM
QVlfTkVFRFNfUEhZU0lDQUwoZGV2X3ByaXYpKTsKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2Ry
bS9pOTE1L2dlbS9pOTE1X2dlbV9jbGllbnRfYmx0LmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9n
ZW0vaTkxNV9nZW1fY2xpZW50X2JsdC5jCmluZGV4IDllNzJiNDJhODZmNS4uYWNlNTBiYjllZTFm
IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fY2xpZW50X2Js
dC5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9jbGllbnRfYmx0LmMK
QEAgLTE2MCw3ICsxNjAsNyBAQCBzdGF0aWMgaW50IG1vdmVfdG9fYWN0aXZlKHN0cnVjdCBpOTE1
X3ZtYSAqdm1hLCBzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpycSkKIAlpZiAoZXJyKQogCQlyZXR1cm4g
ZXJyOwogCi0JcmV0dXJuIGk5MTVfYWN0aXZlX3JlZigmdm1hLT5hY3RpdmUsIHJxLT50aW1lbGlu
ZSwgcnEpOworCXJldHVybiBpOTE1X2FjdGl2ZV9yZWYoJnZtYS0+YWN0aXZlLCBycS0+dGltZWxp
bmUsICZycS0+ZmVuY2UpOwogfQogCiBzdGF0aWMgdm9pZCBjbGVhcl9wYWdlc193b3JrZXIoc3Ry
dWN0IHdvcmtfc3RydWN0ICp3b3JrKQpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUv
Z2VtL2k5MTVfZ2VtX2NvbnRleHQuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dl
bV9jb250ZXh0LmMKaW5kZXggMzc4YmE5YTJjZDhhLi5kM2NlOGI1YmNjYzUgMTAwNjQ0Ci0tLSBh
L2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9jb250ZXh0LmMKKysrIGIvZHJpdmVy
cy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX2NvbnRleHQuYwpAQCAtODY4LDIwICs4NjgsMTgg
QEAgc3RhdGljIGludCBjb250ZXh0X2JhcnJpZXJfdGFzayhzdHJ1Y3QgaTkxNV9nZW1fY29udGV4
dCAqY3R4LAogCQkJCXZvaWQgKCp0YXNrKSh2b2lkICpkYXRhKSwKIAkJCQl2b2lkICpkYXRhKQog
ewotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0gY3R4LT5pOTE1OwogCXN0cnVjdCBj
b250ZXh0X2JhcnJpZXJfdGFzayAqY2I7CiAJc3RydWN0IGk5MTVfZ2VtX2VuZ2luZXNfaXRlciBp
dDsKIAlzdHJ1Y3QgaW50ZWxfY29udGV4dCAqY2U7CiAJaW50IGVyciA9IDA7CiAKLQlsb2NrZGVw
X2Fzc2VydF9oZWxkKCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsKIAlHRU1fQlVHX09OKCF0YXNr
KTsKIAogCWNiID0ga21hbGxvYyhzaXplb2YoKmNiKSwgR0ZQX0tFUk5FTCk7CiAJaWYgKCFjYikK
IAkJcmV0dXJuIC1FTk9NRU07CiAKLQlpOTE1X2FjdGl2ZV9pbml0KGk5MTUsICZjYi0+YmFzZSwg
TlVMTCwgY2JfcmV0aXJlKTsKKwlpOTE1X2FjdGl2ZV9pbml0KCZjYi0+YmFzZSwgTlVMTCwgY2Jf
cmV0aXJlKTsKIAllcnIgPSBpOTE1X2FjdGl2ZV9hY3F1aXJlKCZjYi0+YmFzZSk7CiAJaWYgKGVy
cikgewogCQlrZnJlZShjYik7CkBAIC05MTMsNyArOTExLDkgQEAgc3RhdGljIGludCBjb250ZXh0
X2JhcnJpZXJfdGFzayhzdHJ1Y3QgaTkxNV9nZW1fY29udGV4dCAqY3R4LAogCQlpZiAoZW1pdCkK
IAkJCWVyciA9IGVtaXQocnEsIGRhdGEpOwogCQlpZiAoZXJyID09IDApCi0JCQllcnIgPSBpOTE1
X2FjdGl2ZV9yZWYoJmNiLT5iYXNlLCBycS0+dGltZWxpbmUsIHJxKTsKKwkJCWVyciA9IGk5MTVf
YWN0aXZlX3JlZigmY2ItPmJhc2UsCisJCQkJCSAgICAgIHJxLT50aW1lbGluZSwKKwkJCQkJICAg
ICAgJnJxLT5mZW5jZSk7CiAKIAkJaTkxNV9yZXF1ZXN0X2FkZChycSk7CiAJCWlmIChlcnIpCmRp
ZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fb2JqZWN0X3R5cGVz
LmggYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fb2JqZWN0X3R5cGVzLmgKaW5k
ZXggYjA1NTA3MjdlNjlhLi4wM2UxZTMyMDZhYjMgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2Ry
bS9pOTE1L2dlbS9pOTE1X2dlbV9vYmplY3RfdHlwZXMuaAorKysgYi9kcml2ZXJzL2dwdS9kcm0v
aTkxNS9nZW0vaTkxNV9nZW1fb2JqZWN0X3R5cGVzLmgKQEAgLTgsNiArOCw3IEBACiAjZGVmaW5l
IF9fSTkxNV9HRU1fT0JKRUNUX1RZUEVTX0hfXwogCiAjaW5jbHVkZSA8ZHJtL2RybV9nZW0uaD4K
KyNpbmNsdWRlIDx1YXBpL2RybS9pOTE1X2RybS5oPgogCiAjaW5jbHVkZSAiaTkxNV9hY3RpdmUu
aCIKICNpbmNsdWRlICJpOTE1X3NlbGZ0ZXN0LmgiCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9k
cm0vaTkxNS9nZW0vaTkxNV9nZW1fcG0uYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1
X2dlbV9wbS5jCmluZGV4IDkyZTUzYzI1NDI0Yy4uOTI1NThmYTQ3MTA4IDEwMDY0NAotLS0gYS9k
cml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fcG0uYworKysgYi9kcml2ZXJzL2dwdS9k
cm0vaTkxNS9nZW0vaTkxNV9nZW1fcG0uYwpAQCAtMTYsMTQgKzE2LDExIEBAIHN0YXRpYyB2b2lk
IGNhbGxfaWRsZV9iYXJyaWVycyhzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmUpCiAJc3Ry
dWN0IGxsaXN0X25vZGUgKm5vZGUsICpuZXh0OwogCiAJbGxpc3RfZm9yX2VhY2hfc2FmZShub2Rl
LCBuZXh0LCBsbGlzdF9kZWxfYWxsKCZlbmdpbmUtPmJhcnJpZXJfdGFza3MpKSB7Ci0JCXN0cnVj
dCBpOTE1X2FjdGl2ZV9yZXF1ZXN0ICphY3RpdmUgPQorCQlzdHJ1Y3QgZG1hX2ZlbmNlX2NiICpj
YiA9CiAJCQljb250YWluZXJfb2YoKHN0cnVjdCBsaXN0X2hlYWQgKilub2RlLAotCQkJCSAgICAg
dHlwZW9mKCphY3RpdmUpLCBsaW5rKTsKKwkJCQkgICAgIHR5cGVvZigqY2IpLCBub2RlKTsKIAot
CQlJTklUX0xJU1RfSEVBRCgmYWN0aXZlLT5saW5rKTsKLQkJUkNVX0lOSVRfUE9JTlRFUihhY3Rp
dmUtPnJlcXVlc3QsIE5VTEwpOwotCi0JCWFjdGl2ZS0+cmV0aXJlKGFjdGl2ZSwgTlVMTCk7CisJ
CWNiLT5mdW5jKE5VTEwsIGNiKTsKIAl9CiB9CiAKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2Ry
bS9pOTE1L2d0L2ludGVsX2NvbnRleHQuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVs
X2NvbnRleHQuYwppbmRleCBhZTdjMjY4OWVmMzAuLjU3ZTEzYzZmNTljNSAxMDA2NDQKLS0tIGEv
ZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfY29udGV4dC5jCisrKyBiL2RyaXZlcnMvZ3B1
L2RybS9pOTE1L2d0L2ludGVsX2NvbnRleHQuYwpAQCAtMjQwLDcgKzI0MCw3IEBAIGludGVsX2Nv
bnRleHRfaW5pdChzdHJ1Y3QgaW50ZWxfY29udGV4dCAqY2UsCiAKIAltdXRleF9pbml0KCZjZS0+
cGluX211dGV4KTsKIAotCWk5MTVfYWN0aXZlX2luaXQoY3R4LT5pOTE1LCAmY2UtPmFjdGl2ZSwK
KwlpOTE1X2FjdGl2ZV9pbml0KCZjZS0+YWN0aXZlLAogCQkJIF9faW50ZWxfY29udGV4dF9hY3Rp
dmUsIF9faW50ZWxfY29udGV4dF9yZXRpcmUpOwogfQogCkBAIC0zMDcsNyArMzA3LDcgQEAgaW50
IGludGVsX2NvbnRleHRfcHJlcGFyZV9yZW1vdGVfcmVxdWVzdChzdHJ1Y3QgaW50ZWxfY29udGV4
dCAqY2UsCiAJCQlyZXR1cm4gZXJyOwogCiAJCS8qIFF1ZXVlIHRoaXMgc3dpdGNoIGFmdGVyIGN1
cnJlbnQgYWN0aXZpdHkgYnkgdGhpcyBjb250ZXh0LiAqLwotCQllcnIgPSBpOTE1X2FjdGl2ZV9y
ZXF1ZXN0X3NldCgmdGwtPmxhc3RfcmVxdWVzdCwgcnEpOworCQllcnIgPSBpOTE1X2FjdGl2ZV9m
ZW5jZV9zZXQoJnRsLT5sYXN0X3JlcXVlc3QsIHJxKTsKIAkJbXV0ZXhfdW5sb2NrKCZ0bC0+bXV0
ZXgpOwogCQlpZiAoZXJyKQogCQkJcmV0dXJuIGVycjsKQEAgLTMyMSw3ICszMjEsNyBAQCBpbnQg
aW50ZWxfY29udGV4dF9wcmVwYXJlX3JlbW90ZV9yZXF1ZXN0KHN0cnVjdCBpbnRlbF9jb250ZXh0
ICpjZSwKIAkgKiB3b3JkcyB0cmFuc2ZlciB0aGUgcGlubmVkIGNlIG9iamVjdCB0byB0cmFja2Vk
IGFjdGl2ZSByZXF1ZXN0LgogCSAqLwogCUdFTV9CVUdfT04oaTkxNV9hY3RpdmVfaXNfaWRsZSgm
Y2UtPmFjdGl2ZSkpOwotCXJldHVybiBpOTE1X2FjdGl2ZV9yZWYoJmNlLT5hY3RpdmUsIHJxLT50
aW1lbGluZSwgcnEpOworCXJldHVybiBpOTE1X2FjdGl2ZV9yZWYoJmNlLT5hY3RpdmUsIHJxLT50
aW1lbGluZSwgJnJxLT5mZW5jZSk7CiB9CiAKIHN0cnVjdCBpOTE1X3JlcXVlc3QgKmludGVsX2Nv
bnRleHRfY3JlYXRlX3JlcXVlc3Qoc3RydWN0IGludGVsX2NvbnRleHQgKmNlKQpkaWZmIC0tZ2l0
IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfZW5naW5lX3Bvb2wuYyBiL2RyaXZlcnMv
Z3B1L2RybS9pOTE1L2d0L2ludGVsX2VuZ2luZV9wb29sLmMKaW5kZXggODFmYWIxMDFmZGI0Li4z
Y2RiZDVmOGI1YmUgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2Vu
Z2luZV9wb29sLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfZW5naW5lX3Bv
b2wuYwpAQCAtOTUsNyArOTUsNyBAQCBub2RlX2NyZWF0ZShzdHJ1Y3QgaW50ZWxfZW5naW5lX3Bv
b2wgKnBvb2wsIHNpemVfdCBzeikKIAkJcmV0dXJuIEVSUl9QVFIoLUVOT01FTSk7CiAKIAlub2Rl
LT5wb29sID0gcG9vbDsKLQlpOTE1X2FjdGl2ZV9pbml0KGVuZ2luZS0+aTkxNSwgJm5vZGUtPmFj
dGl2ZSwgcG9vbF9hY3RpdmUsIHBvb2xfcmV0aXJlKTsKKwlpOTE1X2FjdGl2ZV9pbml0KCZub2Rl
LT5hY3RpdmUsIHBvb2xfYWN0aXZlLCBwb29sX3JldGlyZSk7CiAKIAlvYmogPSBpOTE1X2dlbV9v
YmplY3RfY3JlYXRlX2ludGVybmFsKGVuZ2luZS0+aTkxNSwgc3opOwogCWlmIChJU19FUlIob2Jq
KSkgewpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfZW5naW5lX3Bv
b2wuaCBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2VuZ2luZV9wb29sLmgKaW5kZXgg
N2UyMTIzYjMzNTk0Li40YjBmM2FlMGM3ZTIgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9p
OTE1L2d0L2ludGVsX2VuZ2luZV9wb29sLmgKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qv
aW50ZWxfZW5naW5lX3Bvb2wuaApAQCAtMTgsNyArMTgsNyBAQCBzdGF0aWMgaW5saW5lIGludAog
aW50ZWxfZW5naW5lX3Bvb2xfbWFya19hY3RpdmUoc3RydWN0IGludGVsX2VuZ2luZV9wb29sX25v
ZGUgKm5vZGUsCiAJCQkgICAgICBzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpycSkKIHsKLQlyZXR1cm4g
aTkxNV9hY3RpdmVfcmVmKCZub2RlLT5hY3RpdmUsIHJxLT50aW1lbGluZSwgcnEpOworCXJldHVy
biBpOTE1X2FjdGl2ZV9yZWYoJm5vZGUtPmFjdGl2ZSwgcnEtPnRpbWVsaW5lLCAmcnEtPmZlbmNl
KTsKIH0KIAogc3RhdGljIGlubGluZSB2b2lkCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0v
aTkxNS9ndC9pbnRlbF9yZXNldC5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfcmVz
ZXQuYwppbmRleCBiOWQ4NGQ1MmU5ODYuLjQ4MjVjODJhZWZlZSAxMDA2NDQKLS0tIGEvZHJpdmVy
cy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfcmVzZXQuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkx
NS9ndC9pbnRlbF9yZXNldC5jCkBAIC04MTQsMTAgKzgxNCwxMCBAQCBzdGF0aWMgYm9vbCBfX2lu
dGVsX2d0X3Vuc2V0X3dlZGdlZChzdHJ1Y3QgaW50ZWxfZ3QgKmd0KQogCSAqLwogCXNwaW5fbG9j
a19pcnFzYXZlKCZ0aW1lbGluZXMtPmxvY2ssIGZsYWdzKTsKIAlsaXN0X2Zvcl9lYWNoX2VudHJ5
KHRsLCAmdGltZWxpbmVzLT5hY3RpdmVfbGlzdCwgbGluaykgewotCQlzdHJ1Y3QgaTkxNV9yZXF1
ZXN0ICpycTsKKwkJc3RydWN0IGRtYV9mZW5jZSAqZmVuY2U7CiAKLQkJcnEgPSBpOTE1X2FjdGl2
ZV9yZXF1ZXN0X2dldF91bmxvY2tlZCgmdGwtPmxhc3RfcmVxdWVzdCk7Ci0JCWlmICghcnEpCisJ
CWZlbmNlID0gaTkxNV9hY3RpdmVfZmVuY2VfZ2V0KCZ0bC0+bGFzdF9yZXF1ZXN0KTsKKwkJaWYg
KCFmZW5jZSkKIAkJCWNvbnRpbnVlOwogCiAJCXNwaW5fdW5sb2NrX2lycXJlc3RvcmUoJnRpbWVs
aW5lcy0+bG9jaywgZmxhZ3MpOwpAQCAtODI5LDggKzgyOSw4IEBAIHN0YXRpYyBib29sIF9faW50
ZWxfZ3RfdW5zZXRfd2VkZ2VkKHN0cnVjdCBpbnRlbF9ndCAqZ3QpCiAJCSAqIChJOTE1X0ZFTkNF
X1RJTUVPVVQpIHNvIHRoaXMgd2FpdCBzaG91bGQgbm90IGJlIHVuYm91bmRlZAogCQkgKiBpbiB0
aGUgd29yc3QgY2FzZS4KIAkJICovCi0JCWRtYV9mZW5jZV9kZWZhdWx0X3dhaXQoJnJxLT5mZW5j
ZSwgZmFsc2UsIE1BWF9TQ0hFRFVMRV9USU1FT1VUKTsKLQkJaTkxNV9yZXF1ZXN0X3B1dChycSk7
CisJCWRtYV9mZW5jZV9kZWZhdWx0X3dhaXQoZmVuY2UsIGZhbHNlLCBNQVhfU0NIRURVTEVfVElN
RU9VVCk7CisJCWRtYV9mZW5jZV9wdXQoZmVuY2UpOwogCiAJCS8qIFJlc3RhcnQgaXRlcmF0aW9u
IGFmdGVyIGRyb3BpbmcgbG9jayAqLwogCQlzcGluX2xvY2tfaXJxc2F2ZSgmdGltZWxpbmVzLT5s
b2NrLCBmbGFncyk7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF90
aW1lbGluZS5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfdGltZWxpbmUuYwppbmRl
eCBkODI0YmNhNDNkNTUuLjc1ZDg5NjE2N2NmYiAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJt
L2k5MTUvZ3QvaW50ZWxfdGltZWxpbmUuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9p
bnRlbF90aW1lbGluZS5jCkBAIC0xNzgsOCArMTc4LDcgQEAgY2FjaGVsaW5lX2FsbG9jKHN0cnVj
dCBpbnRlbF90aW1lbGluZV9od3NwICpod3NwLCB1bnNpZ25lZCBpbnQgY2FjaGVsaW5lKQogCWNs
LT5od3NwID0gaHdzcDsKIAljbC0+dmFkZHIgPSBwYWdlX3BhY2tfYml0cyh2YWRkciwgY2FjaGVs
aW5lKTsKIAotCWk5MTVfYWN0aXZlX2luaXQoaHdzcC0+Z3QtPmk5MTUsICZjbC0+YWN0aXZlLAot
CQkJIF9fY2FjaGVsaW5lX2FjdGl2ZSwgX19jYWNoZWxpbmVfcmV0aXJlKTsKKwlpOTE1X2FjdGl2
ZV9pbml0KCZjbC0+YWN0aXZlLCBfX2NhY2hlbGluZV9hY3RpdmUsIF9fY2FjaGVsaW5lX3JldGly
ZSk7CiAKIAlyZXR1cm4gY2w7CiB9CkBAIC0yNTUsNyArMjU0LDcgQEAgaW50IGludGVsX3RpbWVs
aW5lX2luaXQoc3RydWN0IGludGVsX3RpbWVsaW5lICp0aW1lbGluZSwKIAogCW11dGV4X2luaXQo
JnRpbWVsaW5lLT5tdXRleCk7CiAKLQlJTklUX0FDVElWRV9SRVFVRVNUKCZ0aW1lbGluZS0+bGFz
dF9yZXF1ZXN0LCAmdGltZWxpbmUtPm11dGV4KTsKKwlJTklUX0FDVElWRV9GRU5DRSgmdGltZWxp
bmUtPmxhc3RfcmVxdWVzdCwgJnRpbWVsaW5lLT5tdXRleCk7CiAJSU5JVF9MSVNUX0hFQUQoJnRp
bWVsaW5lLT5yZXF1ZXN0cyk7CiAKIAlpOTE1X3N5bmNtYXBfaW5pdCgmdGltZWxpbmUtPnN5bmMp
OwpAQCAtNDQzLDcgKzQ0Miw3IEBAIF9faW50ZWxfdGltZWxpbmVfZ2V0X3NlcW5vKHN0cnVjdCBp
bnRlbF90aW1lbGluZSAqdGwsCiAJICogZnJlZSBpdCBhZnRlciB0aGUgY3VycmVudCByZXF1ZXN0
IGlzIHJldGlyZWQsIHdoaWNoIGVuc3VyZXMgdGhhdAogCSAqIGFsbCB3cml0ZXMgaW50byB0aGUg
Y2FjaGVsaW5lIGZyb20gcHJldmlvdXMgcmVxdWVzdHMgYXJlIGNvbXBsZXRlLgogCSAqLwotCWVy
ciA9IGk5MTVfYWN0aXZlX3JlZigmdGwtPmh3c3BfY2FjaGVsaW5lLT5hY3RpdmUsIHRsLCBycSk7
CisJZXJyID0gaTkxNV9hY3RpdmVfcmVmKCZ0bC0+aHdzcF9jYWNoZWxpbmUtPmFjdGl2ZSwgdGws
ICZycS0+ZmVuY2UpOwogCWlmIChlcnIpCiAJCWdvdG8gZXJyX2NhY2hlbGluZTsKIApAQCAtNDk0
LDcgKzQ5Myw3IEBAIGludCBpbnRlbF90aW1lbGluZV9nZXRfc2Vxbm8oc3RydWN0IGludGVsX3Rp
bWVsaW5lICp0bCwKIHN0YXRpYyBpbnQgY2FjaGVsaW5lX3JlZihzdHJ1Y3QgaW50ZWxfdGltZWxp
bmVfY2FjaGVsaW5lICpjbCwKIAkJCSBzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpycSkKIHsKLQlyZXR1
cm4gaTkxNV9hY3RpdmVfcmVmKCZjbC0+YWN0aXZlLCBycS0+dGltZWxpbmUsIHJxKTsKKwlyZXR1
cm4gaTkxNV9hY3RpdmVfcmVmKCZjbC0+YWN0aXZlLCBycS0+dGltZWxpbmUsICZycS0+ZmVuY2Up
OwogfQogCiBpbnQgaW50ZWxfdGltZWxpbmVfcmVhZF9od3NwKHN0cnVjdCBpOTE1X3JlcXVlc3Qg
KmZyb20sCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF90aW1lbGlu
ZV90eXBlcy5oIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfdGltZWxpbmVfdHlwZXMu
aAppbmRleCAyYjFiYWYyZmNjOGUuLjZkN2FjMTI5Y2U4YSAxMDA2NDQKLS0tIGEvZHJpdmVycy9n
cHUvZHJtL2k5MTUvZ3QvaW50ZWxfdGltZWxpbmVfdHlwZXMuaAorKysgYi9kcml2ZXJzL2dwdS9k
cm0vaTkxNS9ndC9pbnRlbF90aW1lbGluZV90eXBlcy5oCkBAIC02Myw3ICs2Myw3IEBAIHN0cnVj
dCBpbnRlbF90aW1lbGluZSB7CiAJICogdGhlIHJlcXVlc3QgdXNpbmcgaTkxNV9hY3RpdmVfcmVx
dWVzdF9nZXRfcmVxdWVzdF9yY3UoKSwgb3IgaG9sZCB0aGUKIAkgKiBzdHJ1Y3RfbXV0ZXguCiAJ
ICovCi0Jc3RydWN0IGk5MTVfYWN0aXZlX3JlcXVlc3QgbGFzdF9yZXF1ZXN0OworCXN0cnVjdCBp
OTE1X2FjdGl2ZV9mZW5jZSBsYXN0X3JlcXVlc3Q7CiAKIAkvKioKIAkgKiBXZSB0cmFjayB0aGUg
bW9zdCByZWNlbnQgc2Vxbm8gdGhhdCB3ZSB3YWl0IG9uIGluIGV2ZXJ5IGNvbnRleHQgc28KZGlm
ZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L3NlbGZ0ZXN0X2NvbnRleHQuYyBiL2Ry
aXZlcnMvZ3B1L2RybS9pOTE1L2d0L3NlbGZ0ZXN0X2NvbnRleHQuYwppbmRleCA5ZDFlYTI2Yzdh
MmQuLjE0MjA1MzNlOGZkNSAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qvc2Vs
ZnRlc3RfY29udGV4dC5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L3NlbGZ0ZXN0X2Nv
bnRleHQuYwpAQCAtNDEsMjQgKzQxLDIwIEBAIHN0YXRpYyBpbnQgY29udGV4dF9zeW5jKHN0cnVj
dCBpbnRlbF9jb250ZXh0ICpjZSkKIAogCW11dGV4X2xvY2soJnRsLT5tdXRleCk7CiAJZG8gewot
CQlzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpycTsKKwkJc3RydWN0IGRtYV9mZW5jZSAqZmVuY2U7CiAJ
CWxvbmcgdGltZW91dDsKIAotCQlyY3VfcmVhZF9sb2NrKCk7Ci0JCXJxID0gcmN1X2RlcmVmZXJl
bmNlKHRsLT5sYXN0X3JlcXVlc3QucmVxdWVzdCk7Ci0JCWlmIChycSkKLQkJCXJxID0gaTkxNV9y
ZXF1ZXN0X2dldF9yY3UocnEpOwotCQlyY3VfcmVhZF91bmxvY2soKTsKLQkJaWYgKCFycSkKKwkJ
ZmVuY2UgPSBpOTE1X2FjdGl2ZV9mZW5jZV9nZXQoJnRsLT5sYXN0X3JlcXVlc3QpOworCQlpZiAo
IWZlbmNlKQogCQkJYnJlYWs7CiAKLQkJdGltZW91dCA9IGk5MTVfcmVxdWVzdF93YWl0KHJxLCAw
LCBIWiAvIDEwKTsKKwkJdGltZW91dCA9IGRtYV9mZW5jZV93YWl0X3RpbWVvdXQoZmVuY2UsIGZh
bHNlLCBIWiAvIDEwKTsKIAkJaWYgKHRpbWVvdXQgPCAwKQogCQkJZXJyID0gdGltZW91dDsKIAkJ
ZWxzZQotCQkJaTkxNV9yZXF1ZXN0X3JldGlyZV91cHRvKHJxKTsKKwkJCWk5MTVfcmVxdWVzdF9y
ZXRpcmVfdXB0byh0b19yZXF1ZXN0KGZlbmNlKSk7CiAKLQkJaTkxNV9yZXF1ZXN0X3B1dChycSk7
CisJCWRtYV9mZW5jZV9wdXQoZmVuY2UpOwogCX0gd2hpbGUgKCFlcnIpOwogCW11dGV4X3VubG9j
aygmdGwtPm11dGV4KTsKIApkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qvc2Vs
ZnRlc3RfbHJjLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9zZWxmdGVzdF9scmMuYwppbmRl
eCBkNzkxMTU4OTg4ZDYuLmFjYTFiM2E5YzVkZSAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJt
L2k5MTUvZ3Qvc2VsZnRlc3RfbHJjLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qvc2Vs
ZnRlc3RfbHJjLmMKQEAgLTk4NCw5ICs5ODQsMTMgQEAgc3RhdGljIHN0cnVjdCBpOTE1X3JlcXVl
c3QgKmR1bW15X3JlcXVlc3Qoc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lKQogCWlmICgh
cnEpCiAJCXJldHVybiBOVUxMOwogCi0JSU5JVF9MSVNUX0hFQUQoJnJxLT5hY3RpdmVfbGlzdCk7
CiAJcnEtPmVuZ2luZSA9IGVuZ2luZTsKIAorCXNwaW5fbG9ja19pbml0KCZycS0+bG9jayk7CisJ
SU5JVF9MSVNUX0hFQUQoJnJxLT5mZW5jZS5jYl9saXN0KTsKKwlycS0+ZmVuY2UubG9jayA9ICZy
cS0+bG9jazsKKwlycS0+ZmVuY2Uub3BzID0gJmk5MTVfZmVuY2Vfb3BzOworCiAJaTkxNV9zY2hl
ZF9ub2RlX2luaXQoJnJxLT5zY2hlZCk7CiAKIAkvKiBtYXJrIHRoaXMgcmVxdWVzdCBhcyBwZXJt
YW5lbnRseSBpbmNvbXBsZXRlICovCkBAIC0xMDc5LDggKzEwODMsOCBAQCBzdGF0aWMgaW50IGxp
dmVfc3VwcHJlc3Nfd2FpdF9wcmVlbXB0KHZvaWQgKmFyZykKIAkJCQl9CiAKIAkJCQkvKiBEaXNh
YmxlIE5FV0NMSUVOVCBwcm9tb3Rpb24gKi8KLQkJCQlfX2k5MTVfYWN0aXZlX3JlcXVlc3Rfc2V0
KCZycVtpXS0+dGltZWxpbmUtPmxhc3RfcmVxdWVzdCwKLQkJCQkJCQkgIGR1bW15KTsKKwkJCQlf
X2k5MTVfYWN0aXZlX2ZlbmNlX3NldCgmcnFbaV0tPnRpbWVsaW5lLT5sYXN0X3JlcXVlc3QsCisJ
CQkJCQkJJmR1bW15LT5mZW5jZSk7CiAJCQkJaTkxNV9yZXF1ZXN0X2FkZChycVtpXSk7CiAJCQl9
CiAKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L3NlbGZ0ZXN0cy9tb2NrX3Rp
bWVsaW5lLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9zZWxmdGVzdHMvbW9ja190aW1lbGlu
ZS5jCmluZGV4IDU5ODE3MGVmY2FmNi4uMmE3N2MwNTFmMzZhIDEwMDY0NAotLS0gYS9kcml2ZXJz
L2dwdS9kcm0vaTkxNS9ndC9zZWxmdGVzdHMvbW9ja190aW1lbGluZS5jCisrKyBiL2RyaXZlcnMv
Z3B1L2RybS9pOTE1L2d0L3NlbGZ0ZXN0cy9tb2NrX3RpbWVsaW5lLmMKQEAgLTE1LDcgKzE1LDcg
QEAgdm9pZCBtb2NrX3RpbWVsaW5lX2luaXQoc3RydWN0IGludGVsX3RpbWVsaW5lICp0aW1lbGlu
ZSwgdTY0IGNvbnRleHQpCiAKIAltdXRleF9pbml0KCZ0aW1lbGluZS0+bXV0ZXgpOwogCi0JSU5J
VF9BQ1RJVkVfUkVRVUVTVCgmdGltZWxpbmUtPmxhc3RfcmVxdWVzdCwgJnRpbWVsaW5lLT5tdXRl
eCk7CisJSU5JVF9BQ1RJVkVfRkVOQ0UoJnRpbWVsaW5lLT5sYXN0X3JlcXVlc3QsICZ0aW1lbGlu
ZS0+bXV0ZXgpOwogCUlOSVRfTElTVF9IRUFEKCZ0aW1lbGluZS0+cmVxdWVzdHMpOwogCiAJaTkx
NV9zeW5jbWFwX2luaXQoJnRpbWVsaW5lLT5zeW5jKTsKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1
L2RybS9pOTE1L2d2dC9zY2hlZHVsZXIuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d2dC9zY2hl
ZHVsZXIuYwppbmRleCA4OTQwZmE4ZDM5MWEuLjZiZWI3NTNiMWVhMSAxMDA2NDQKLS0tIGEvZHJp
dmVycy9ncHUvZHJtL2k5MTUvZ3Z0L3NjaGVkdWxlci5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9p
OTE1L2d2dC9zY2hlZHVsZXIuYwpAQCAtMzg1LDExICszODUsOCBAQCBpbnRlbF9ndnRfd29ya2xv
YWRfcmVxX2FsbG9jKHN0cnVjdCBpbnRlbF92Z3B1X3dvcmtsb2FkICp3b3JrbG9hZCkKIHsKIAlz
dHJ1Y3QgaW50ZWxfdmdwdSAqdmdwdSA9IHdvcmtsb2FkLT52Z3B1OwogCXN0cnVjdCBpbnRlbF92
Z3B1X3N1Ym1pc3Npb24gKnMgPSAmdmdwdS0+c3VibWlzc2lvbjsKLQlzdHJ1Y3QgZHJtX2k5MTVf
cHJpdmF0ZSAqZGV2X3ByaXYgPSB2Z3B1LT5ndnQtPmRldl9wcml2OwogCXN0cnVjdCBpOTE1X3Jl
cXVlc3QgKnJxOwogCi0JbG9ja2RlcF9hc3NlcnRfaGVsZCgmZGV2X3ByaXYtPmRybS5zdHJ1Y3Rf
bXV0ZXgpOwotCiAJaWYgKHdvcmtsb2FkLT5yZXEpCiAJCXJldHVybiAwOwogCmRpZmYgLS1naXQg
YS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2FjdGl2ZS5jIGIvZHJpdmVycy9ncHUvZHJtL2k5
MTUvaTkxNV9hY3RpdmUuYwppbmRleCBmODJkNmQ5MzE4MjQuLjJlMmFiODE3NjYyMCAxMDA2NDQK
LS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9hY3RpdmUuYworKysgYi9kcml2ZXJzL2dw
dS9kcm0vaTkxNS9pOTE1X2FjdGl2ZS5jCkBAIC0xMiw4ICsxMiw2IEBACiAjaW5jbHVkZSAiaTkx
NV9hY3RpdmUuaCIKICNpbmNsdWRlICJpOTE1X2dsb2JhbHMuaCIKIAotI2RlZmluZSBCS0wocmVm
KSAoJihyZWYpLT5pOTE1LT5kcm0uc3RydWN0X211dGV4KQotCiAvKgogICogQWN0aXZlIHJlZnMg
bWVtb3J5IG1hbmFnZW1lbnQKICAqCkBAIC0yNywzNSArMjUsMzUgQEAgc3RhdGljIHN0cnVjdCBp
OTE1X2dsb2JhbF9hY3RpdmUgewogfSBnbG9iYWw7CiAKIHN0cnVjdCBhY3RpdmVfbm9kZSB7Ci0J
c3RydWN0IGk5MTVfYWN0aXZlX3JlcXVlc3QgYmFzZTsKKwlzdHJ1Y3QgaTkxNV9hY3RpdmVfZmVu
Y2UgYmFzZTsKIAlzdHJ1Y3QgaTkxNV9hY3RpdmUgKnJlZjsKIAlzdHJ1Y3QgcmJfbm9kZSBub2Rl
OwogCXU2NCB0aW1lbGluZTsKIH07CiAKIHN0YXRpYyBpbmxpbmUgc3RydWN0IGFjdGl2ZV9ub2Rl
ICoKLW5vZGVfZnJvbV9hY3RpdmUoc3RydWN0IGk5MTVfYWN0aXZlX3JlcXVlc3QgKmFjdGl2ZSkK
K25vZGVfZnJvbV9hY3RpdmUoc3RydWN0IGk5MTVfYWN0aXZlX2ZlbmNlICphY3RpdmUpCiB7CiAJ
cmV0dXJuIGNvbnRhaW5lcl9vZihhY3RpdmUsIHN0cnVjdCBhY3RpdmVfbm9kZSwgYmFzZSk7CiB9
CiAKICNkZWZpbmUgdGFrZV9wcmVhbGxvY2F0ZWRfYmFycmllcnMoeCkgbGxpc3RfZGVsX2FsbCgm
KHgpLT5wcmVhbGxvY2F0ZWRfYmFycmllcnMpCiAKLXN0YXRpYyBpbmxpbmUgYm9vbCBpc19iYXJy
aWVyKGNvbnN0IHN0cnVjdCBpOTE1X2FjdGl2ZV9yZXF1ZXN0ICphY3RpdmUpCitzdGF0aWMgaW5s
aW5lIGJvb2wgaXNfYmFycmllcihjb25zdCBzdHJ1Y3QgaTkxNV9hY3RpdmVfZmVuY2UgKmFjdGl2
ZSkKIHsKLQlyZXR1cm4gSVNfRVJSKHJjdV9hY2Nlc3NfcG9pbnRlcihhY3RpdmUtPnJlcXVlc3Qp
KTsKKwlyZXR1cm4gSVNfRVJSKHJjdV9hY2Nlc3NfcG9pbnRlcihhY3RpdmUtPmZlbmNlKSk7CiB9
CiAKIHN0YXRpYyBpbmxpbmUgc3RydWN0IGxsaXN0X25vZGUgKmJhcnJpZXJfdG9fbGwoc3RydWN0
IGFjdGl2ZV9ub2RlICpub2RlKQogewogCUdFTV9CVUdfT04oIWlzX2JhcnJpZXIoJm5vZGUtPmJh
c2UpKTsKLQlyZXR1cm4gKHN0cnVjdCBsbGlzdF9ub2RlICopJm5vZGUtPmJhc2UubGluazsKKwly
ZXR1cm4gKHN0cnVjdCBsbGlzdF9ub2RlICopJm5vZGUtPmJhc2UuY2Iubm9kZTsKIH0KIAogc3Rh
dGljIGlubGluZSBzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICoKIF9fYmFycmllcl90b19lbmdpbmUo
c3RydWN0IGFjdGl2ZV9ub2RlICpub2RlKQogewotCXJldHVybiAoc3RydWN0IGludGVsX2VuZ2lu
ZV9jcyAqKVJFQURfT05DRShub2RlLT5iYXNlLmxpbmsucHJldik7CisJcmV0dXJuIChzdHJ1Y3Qg
aW50ZWxfZW5naW5lX2NzICopUkVBRF9PTkNFKG5vZGUtPmJhc2UuY2Iubm9kZS5wcmV2KTsKIH0K
IAogc3RhdGljIGlubGluZSBzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICoKQEAgLTY4LDcgKzY2LDcg
QEAgYmFycmllcl90b19lbmdpbmUoc3RydWN0IGFjdGl2ZV9ub2RlICpub2RlKQogc3RhdGljIGlu
bGluZSBzdHJ1Y3QgYWN0aXZlX25vZGUgKmJhcnJpZXJfZnJvbV9sbChzdHJ1Y3QgbGxpc3Rfbm9k
ZSAqeCkKIHsKIAlyZXR1cm4gY29udGFpbmVyX29mKChzdHJ1Y3QgbGlzdF9oZWFkICopeCwKLQkJ
CSAgICBzdHJ1Y3QgYWN0aXZlX25vZGUsIGJhc2UubGluayk7CisJCQkgICAgc3RydWN0IGFjdGl2
ZV9ub2RlLCBiYXNlLmNiLm5vZGUpOwogfQogCiAjaWYgSVNfRU5BQkxFRChDT05GSUdfRFJNX0k5
MTVfREVCVUdfR0VNKSAmJiBJU19FTkFCTEVEKENPTkZJR19ERUJVR19PQkpFQ1RTKQpAQCAtMTQ3
LDE1ICsxNDUsMTggQEAgX19hY3RpdmVfcmV0aXJlKHN0cnVjdCBpOTE1X2FjdGl2ZSAqcmVmKQog
CWlmICghcmV0aXJlKQogCQlyZXR1cm47CiAKLQlHRU1fQlVHX09OKHJjdV9hY2Nlc3NfcG9pbnRl
cihyZWYtPmV4Y2wpKTsKKwlHRU1fQlVHX09OKHJjdV9hY2Nlc3NfcG9pbnRlcihyZWYtPmV4Y2wu
ZmVuY2UpKTsKIAlyYnRyZWVfcG9zdG9yZGVyX2Zvcl9lYWNoX2VudHJ5X3NhZmUoaXQsIG4sICZy
b290LCBub2RlKSB7Ci0JCUdFTV9CVUdfT04oaTkxNV9hY3RpdmVfcmVxdWVzdF9pc3NldCgmaXQt
PmJhc2UpKTsKKwkJR0VNX0JVR19PTihpOTE1X2FjdGl2ZV9mZW5jZV9pc3NldCgmaXQtPmJhc2Up
KTsKIAkJa21lbV9jYWNoZV9mcmVlKGdsb2JhbC5zbGFiX2NhY2hlLCBpdCk7CiAJfQogCiAJLyog
QWZ0ZXIgdGhlIGZpbmFsIHJldGlyZSwgdGhlIGVudGlyZSBzdHJ1Y3QgbWF5IGJlIGZyZWVkICov
CiAJaWYgKHJlZi0+cmV0aXJlKQogCQlyZWYtPnJldGlyZShyZWYpOworCisJLyogLi4uIGV4Y2Vw
dCBpZiB5b3Ugd2FpdCBvbiBpdCwgeW91IG11c3QgbWFuYWdlIHlvdXIgb3duIHJlZmVyZW5jZXMh
ICovCisJd2FrZV91cF92YXIocmVmKTsKIH0KIAogc3RhdGljIHZvaWQKQEAgLTE4OSwxMiArMTkw
LDIwIEBAIGFjdGl2ZV9yZXRpcmUoc3RydWN0IGk5MTVfYWN0aXZlICpyZWYpCiB9CiAKIHN0YXRp
YyB2b2lkCi1ub2RlX3JldGlyZShzdHJ1Y3QgaTkxNV9hY3RpdmVfcmVxdWVzdCAqYmFzZSwgc3Ry
dWN0IGk5MTVfcmVxdWVzdCAqcnEpCitub2RlX3JldGlyZShzdHJ1Y3QgZG1hX2ZlbmNlICpmZW5j
ZSwgc3RydWN0IGRtYV9mZW5jZV9jYiAqY2IpCiB7Ci0JYWN0aXZlX3JldGlyZShub2RlX2Zyb21f
YWN0aXZlKGJhc2UpLT5yZWYpOworCWk5MTVfYWN0aXZlX2ZlbmNlX2NiKGZlbmNlLCBjYik7CisJ
YWN0aXZlX3JldGlyZShjb250YWluZXJfb2YoY2IsIHN0cnVjdCBhY3RpdmVfbm9kZSwgYmFzZS5j
YiktPnJlZik7CiB9CiAKLXN0YXRpYyBzdHJ1Y3QgaTkxNV9hY3RpdmVfcmVxdWVzdCAqCitzdGF0
aWMgdm9pZAorZXhjbF9yZXRpcmUoc3RydWN0IGRtYV9mZW5jZSAqZmVuY2UsIHN0cnVjdCBkbWFf
ZmVuY2VfY2IgKmNiKQoreworCWk5MTVfYWN0aXZlX2ZlbmNlX2NiKGZlbmNlLCBjYik7CisJYWN0
aXZlX3JldGlyZShjb250YWluZXJfb2YoY2IsIHN0cnVjdCBpOTE1X2FjdGl2ZSwgZXhjbC5jYikp
OworfQorCitzdGF0aWMgc3RydWN0IGk5MTVfYWN0aXZlX2ZlbmNlICoKIGFjdGl2ZV9pbnN0YW5j
ZShzdHJ1Y3QgaTkxNV9hY3RpdmUgKnJlZiwgc3RydWN0IGludGVsX3RpbWVsaW5lICp0bCkKIHsK
IAlzdHJ1Y3QgYWN0aXZlX25vZGUgKm5vZGUsICpwcmVhbGxvYzsKQEAgLTIzOCw3ICsyNDcsNyBA
QCBhY3RpdmVfaW5zdGFuY2Uoc3RydWN0IGk5MTVfYWN0aXZlICpyZWYsIHN0cnVjdCBpbnRlbF90
aW1lbGluZSAqdGwpCiAJfQogCiAJbm9kZSA9IHByZWFsbG9jOwotCWk5MTVfYWN0aXZlX3JlcXVl
c3RfaW5pdCgmbm9kZS0+YmFzZSwgJnRsLT5tdXRleCwgTlVMTCwgbm9kZV9yZXRpcmUpOworCV9f
aTkxNV9hY3RpdmVfZmVuY2VfaW5pdCgmbm9kZS0+YmFzZSwgJnRsLT5tdXRleCwgTlVMTCwgbm9k
ZV9yZXRpcmUpOwogCW5vZGUtPnJlZiA9IHJlZjsKIAlub2RlLT50aW1lbGluZSA9IGlkeDsKIApA
QCAtMjUzLDggKzI2Miw3IEBAIGFjdGl2ZV9pbnN0YW5jZShzdHJ1Y3QgaTkxNV9hY3RpdmUgKnJl
Ziwgc3RydWN0IGludGVsX3RpbWVsaW5lICp0bCkKIAlyZXR1cm4gJm5vZGUtPmJhc2U7CiB9CiAK
LXZvaWQgX19pOTE1X2FjdGl2ZV9pbml0KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LAot
CQkJc3RydWN0IGk5MTVfYWN0aXZlICpyZWYsCit2b2lkIF9faTkxNV9hY3RpdmVfaW5pdChzdHJ1
Y3QgaTkxNV9hY3RpdmUgKnJlZiwKIAkJCWludCAoKmFjdGl2ZSkoc3RydWN0IGk5MTVfYWN0aXZl
ICpyZWYpLAogCQkJdm9pZCAoKnJldGlyZSkoc3RydWN0IGk5MTVfYWN0aXZlICpyZWYpLAogCQkJ
c3RydWN0IGxvY2tfY2xhc3Nfa2V5ICprZXkpCkBAIC0yNjMsMTkgKzI3MSwxOCBAQCB2b2lkIF9f
aTkxNV9hY3RpdmVfaW5pdChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwKIAogCWRlYnVn
X2FjdGl2ZV9pbml0KHJlZik7CiAKLQlyZWYtPmk5MTUgPSBpOTE1OwogCXJlZi0+ZmxhZ3MgPSAw
OwogCXJlZi0+YWN0aXZlID0gYWN0aXZlOwogCXJlZi0+cmV0aXJlID0gcHRyX3VucGFja19iaXRz
KHJldGlyZSwgJmJpdHMsIDIpOwogCWlmIChiaXRzICYgSTkxNV9BQ1RJVkVfTUFZX1NMRUVQKQog
CQlyZWYtPmZsYWdzIHw9IEk5MTVfQUNUSVZFX1JFVElSRV9TTEVFUFM7CiAKLQlyZWYtPmV4Y2wg
PSBOVUxMOwogCXJlZi0+dHJlZSA9IFJCX1JPT1Q7CiAJcmVmLT5jYWNoZSA9IE5VTEw7CiAJaW5p
dF9sbGlzdF9oZWFkKCZyZWYtPnByZWFsbG9jYXRlZF9iYXJyaWVycyk7CiAJYXRvbWljX3NldCgm
cmVmLT5jb3VudCwgMCk7CiAJX19tdXRleF9pbml0KCZyZWYtPm11dGV4LCAiaTkxNV9hY3RpdmUi
LCBrZXkpOworCV9faTkxNV9hY3RpdmVfZmVuY2VfaW5pdCgmcmVmLT5leGNsLCAmcmVmLT5tdXRl
eCwgTlVMTCwgZXhjbF9yZXRpcmUpOwogCUlOSVRfV09SSygmcmVmLT53b3JrLCBhY3RpdmVfd29y
ayk7CiB9CiAKQEAgLTMyOSw5ICszMzYsOSBAQCBfX2FjdGl2ZV9kZWxfYmFycmllcihzdHJ1Y3Qg
aTkxNV9hY3RpdmUgKnJlZiwgc3RydWN0IGFjdGl2ZV9ub2RlICpub2RlKQogCiBpbnQgaTkxNV9h
Y3RpdmVfcmVmKHN0cnVjdCBpOTE1X2FjdGl2ZSAqcmVmLAogCQkgICAgc3RydWN0IGludGVsX3Rp
bWVsaW5lICp0bCwKLQkJICAgIHN0cnVjdCBpOTE1X3JlcXVlc3QgKnJxKQorCQkgICAgc3RydWN0
IGRtYV9mZW5jZSAqZmVuY2UpCiB7Ci0Jc3RydWN0IGk5MTVfYWN0aXZlX3JlcXVlc3QgKmFjdGl2
ZTsKKwlzdHJ1Y3QgaTkxNV9hY3RpdmVfZmVuY2UgKmFjdGl2ZTsKIAlpbnQgZXJyOwogCiAJbG9j
a2RlcF9hc3NlcnRfaGVsZCgmdGwtPm11dGV4KTsKQEAgLTM1NCw2NSArMzYxLDM4IEBAIGludCBp
OTE1X2FjdGl2ZV9yZWYoc3RydWN0IGk5MTVfYWN0aXZlICpyZWYsCiAJCSAqIHJlcXVlc3QgdGhh
dCB3ZSB3YW50IHRvIGVtaXQgb24gdGhlIGtlcm5lbF9jb250ZXh0LgogCQkgKi8KIAkJX19hY3Rp
dmVfZGVsX2JhcnJpZXIocmVmLCBub2RlX2Zyb21fYWN0aXZlKGFjdGl2ZSkpOwotCQlSQ1VfSU5J
VF9QT0lOVEVSKGFjdGl2ZS0+cmVxdWVzdCwgTlVMTCk7Ci0JCUlOSVRfTElTVF9IRUFEKCZhY3Rp
dmUtPmxpbmspOwotCX0gZWxzZSB7Ci0JCWlmICghaTkxNV9hY3RpdmVfcmVxdWVzdF9pc3NldChh
Y3RpdmUpKQotCQkJYXRvbWljX2luYygmcmVmLT5jb3VudCk7CisJCVJDVV9JTklUX1BPSU5URVIo
YWN0aXZlLT5mZW5jZSwgTlVMTCk7CisJCWF0b21pY19kZWMoJnJlZi0+Y291bnQpOwogCX0KLQlH
RU1fQlVHX09OKCFhdG9taWNfcmVhZCgmcmVmLT5jb3VudCkpOwotCV9faTkxNV9hY3RpdmVfcmVx
dWVzdF9zZXQoYWN0aXZlLCBycSk7CisJaWYgKCFfX2k5MTVfYWN0aXZlX2ZlbmNlX3NldChhY3Rp
dmUsIGZlbmNlKSkKKwkJYXRvbWljX2luYygmcmVmLT5jb3VudCk7CiAKIG91dDoKIAlpOTE1X2Fj
dGl2ZV9yZWxlYXNlKHJlZik7CiAJcmV0dXJuIGVycjsKIH0KIAotc3RhdGljIHZvaWQgZXhjbF9j
YihzdHJ1Y3QgZG1hX2ZlbmNlICpmLCBzdHJ1Y3QgZG1hX2ZlbmNlX2NiICpjYikKLXsKLQlzdHJ1
Y3QgaTkxNV9hY3RpdmUgKnJlZiA9IGNvbnRhaW5lcl9vZihjYiwgdHlwZW9mKCpyZWYpLCBleGNs
X2NiKTsKLQotCVJDVV9JTklUX1BPSU5URVIocmVmLT5leGNsLCBOVUxMKTsKLQlkbWFfZmVuY2Vf
cHV0KGYpOwotCi0JYWN0aXZlX3JldGlyZShyZWYpOwotfQotCiB2b2lkIGk5MTVfYWN0aXZlX3Nl
dF9leGNsdXNpdmUoc3RydWN0IGk5MTVfYWN0aXZlICpyZWYsIHN0cnVjdCBkbWFfZmVuY2UgKmYp
CiB7CiAJR0VNX0JVR19PTihpOTE1X2FjdGl2ZV9pc19pZGxlKHJlZikpOwogCi0JZG1hX2ZlbmNl
X2dldChmKTsKLQotCXJjdV9yZWFkX2xvY2soKTsKLQlpZiAocmN1X2FjY2Vzc19wb2ludGVyKHJl
Zi0+ZXhjbCkpIHsKLQkJc3RydWN0IGRtYV9mZW5jZSAqb2xkOwotCi0JCW9sZCA9IGRtYV9mZW5j
ZV9nZXRfcmN1X3NhZmUoJnJlZi0+ZXhjbCk7Ci0JCWlmIChvbGQpIHsKLQkJCWlmIChkbWFfZmVu
Y2VfcmVtb3ZlX2NhbGxiYWNrKG9sZCwgJnJlZi0+ZXhjbF9jYikpCi0JCQkJYXRvbWljX2RlYygm
cmVmLT5jb3VudCk7Ci0JCQlkbWFfZmVuY2VfcHV0KG9sZCk7Ci0JCX0KLQl9Ci0JcmN1X3JlYWRf
dW5sb2NrKCk7Ci0KLQlhdG9taWNfaW5jKCZyZWYtPmNvdW50KTsKLQlyY3VfYXNzaWduX3BvaW50
ZXIocmVmLT5leGNsLCBmKTsKKwltdXRleF9hY3F1aXJlKCZyZWYtPm11dGV4LmRlcF9tYXAsIDAs
IDAsIF9USElTX0lQXyk7CisJaWYgKCFfX2k5MTVfYWN0aXZlX2ZlbmNlX3NldCgmcmVmLT5leGNs
LCBmKSkKKwkJYXRvbWljX2luYygmcmVmLT5jb3VudCk7CisJbXV0ZXhfcmVsZWFzZSgmcmVmLT5t
dXRleC5kZXBfbWFwLCAwLCBfVEhJU19JUF8pOworfQogCi0JaWYgKGRtYV9mZW5jZV9hZGRfY2Fs
bGJhY2soZiwgJnJlZi0+ZXhjbF9jYiwgZXhjbF9jYikpIHsKLQkJUkNVX0lOSVRfUE9JTlRFUihy
ZWYtPmV4Y2wsIE5VTEwpOwotCQlhdG9taWNfZGVjKCZyZWYtPmNvdW50KTsKLQkJZG1hX2ZlbmNl
X3B1dChmKTsKLQl9Citib29sIGk5MTVfYWN0aXZlX2FjcXVpcmVfaWZfYnVzeShzdHJ1Y3QgaTkx
NV9hY3RpdmUgKnJlZikKK3sKKwlkZWJ1Z19hY3RpdmVfYXNzZXJ0KHJlZik7CisJcmV0dXJuIGF0
b21pY19hZGRfdW5sZXNzKCZyZWYtPmNvdW50LCAxLCAwKTsKIH0KIAogaW50IGk5MTVfYWN0aXZl
X2FjcXVpcmUoc3RydWN0IGk5MTVfYWN0aXZlICpyZWYpCiB7CiAJaW50IGVycjsKIAotCWRlYnVn
X2FjdGl2ZV9hc3NlcnQocmVmKTsKLQlpZiAoYXRvbWljX2FkZF91bmxlc3MoJnJlZi0+Y291bnQs
IDEsIDApKQorCWlmIChpOTE1X2FjdGl2ZV9hY3F1aXJlX2lmX2J1c3kocmVmKSkKIAkJcmV0dXJu
IDA7CiAKIAllcnIgPSBtdXRleF9sb2NrX2ludGVycnVwdGlibGUoJnJlZi0+bXV0ZXgpOwpAQCAt
NDM3LDEyMSArNDE3LDQ5IEBAIHZvaWQgaTkxNV9hY3RpdmVfcmVsZWFzZShzdHJ1Y3QgaTkxNV9h
Y3RpdmUgKnJlZikKIAlhY3RpdmVfcmV0aXJlKHJlZik7CiB9CiAKLXN0YXRpYyB2b2lkIF9fYWN0
aXZlX3VuZ3JhYihzdHJ1Y3QgaTkxNV9hY3RpdmUgKnJlZikKLXsKLQljbGVhcl9hbmRfd2FrZV91
cF9iaXQoSTkxNV9BQ1RJVkVfR1JBQl9CSVQsICZyZWYtPmZsYWdzKTsKLX0KLQotYm9vbCBpOTE1
X2FjdGl2ZV90cnlncmFiKHN0cnVjdCBpOTE1X2FjdGl2ZSAqcmVmKQotewotCWRlYnVnX2FjdGl2
ZV9hc3NlcnQocmVmKTsKLQotCWlmICh0ZXN0X2FuZF9zZXRfYml0KEk5MTVfQUNUSVZFX0dSQUJf
QklULCAmcmVmLT5mbGFncykpCi0JCXJldHVybiBmYWxzZTsKLQotCWlmICghYXRvbWljX2FkZF91
bmxlc3MoJnJlZi0+Y291bnQsIDEsIDApKSB7Ci0JCV9fYWN0aXZlX3VuZ3JhYihyZWYpOwotCQly
ZXR1cm4gZmFsc2U7Ci0JfQotCi0JcmV0dXJuIHRydWU7Ci19Ci0KLXZvaWQgaTkxNV9hY3RpdmVf
dW5ncmFiKHN0cnVjdCBpOTE1X2FjdGl2ZSAqcmVmKQotewotCUdFTV9CVUdfT04oIXRlc3RfYml0
KEk5MTVfQUNUSVZFX0dSQUJfQklULCAmcmVmLT5mbGFncykpOwotCi0JYWN0aXZlX3JldGlyZShy
ZWYpOwotCV9fYWN0aXZlX3VuZ3JhYihyZWYpOwotfQotCi1zdGF0aWMgaW50IGV4Y2xfd2FpdChz
dHJ1Y3QgaTkxNV9hY3RpdmUgKnJlZikKLXsKLQlzdHJ1Y3QgZG1hX2ZlbmNlICpvbGQ7Ci0JaW50
IGVyciA9IDA7Ci0KLQlpZiAoIXJjdV9hY2Nlc3NfcG9pbnRlcihyZWYtPmV4Y2wpKQotCQlyZXR1
cm4gMDsKLQotCXJjdV9yZWFkX2xvY2soKTsKLQlvbGQgPSBkbWFfZmVuY2VfZ2V0X3JjdV9zYWZl
KCZyZWYtPmV4Y2wpOwotCXJjdV9yZWFkX3VubG9jaygpOwotCWlmIChvbGQpIHsKLQkJZXJyID0g
ZG1hX2ZlbmNlX3dhaXQob2xkLCB0cnVlKTsKLQkJZG1hX2ZlbmNlX3B1dChvbGQpOwotCX0KLQot
CXJldHVybiBlcnI7Ci19Ci0KIGludCBpOTE1X2FjdGl2ZV93YWl0KHN0cnVjdCBpOTE1X2FjdGl2
ZSAqcmVmKQogewogCXN0cnVjdCBhY3RpdmVfbm9kZSAqaXQsICpuOwotCWludCBlcnI7CisJaW50
IGVyciA9IDA7CiAKIAltaWdodF9zbGVlcCgpOwotCW1pZ2h0X2xvY2soJnJlZi0+bXV0ZXgpOwog
Ci0JaWYgKGk5MTVfYWN0aXZlX2lzX2lkbGUocmVmKSkKKwlpZiAoIWk5MTVfYWN0aXZlX2FjcXVp
cmVfaWZfYnVzeShyZWYpKQogCQlyZXR1cm4gMDsKIAotCWVyciA9IG11dGV4X2xvY2tfaW50ZXJy
dXB0aWJsZSgmcmVmLT5tdXRleCk7Ci0JaWYgKGVycikKLQkJcmV0dXJuIGVycjsKLQotCWlmICgh
YXRvbWljX2FkZF91bmxlc3MoJnJlZi0+Y291bnQsIDEsIDApKSB7Ci0JCW11dGV4X3VubG9jaygm
cmVmLT5tdXRleCk7Ci0JCXJldHVybiAwOwotCX0KKwkvKiBGbHVzaCBsYXp5IHNpZ25hbHMgKi8K
KwlyYnRyZWVfcG9zdG9yZGVyX2Zvcl9lYWNoX2VudHJ5X3NhZmUoaXQsIG4sICZyZWYtPnRyZWUs
IG5vZGUpIHsKKwkJc3RydWN0IGRtYV9mZW5jZSAqZmVuY2U7CiAKLQllcnIgPSBleGNsX3dhaXQo
cmVmKTsKLQlpZiAoZXJyKQotCQlnb3RvIG91dDsKKwkJaWYgKGlzX2JhcnJpZXIoJml0LT5iYXNl
KSkgLyogdW5jb25uZWN0ZWQgaWRsZSBiYXJyaWVyICovCisJCQljb250aW51ZTsKIAotCXJidHJl
ZV9wb3N0b3JkZXJfZm9yX2VhY2hfZW50cnlfc2FmZShpdCwgbiwgJnJlZi0+dHJlZSwgbm9kZSkg
ewotCQlpZiAoaXNfYmFycmllcigmaXQtPmJhc2UpKSB7IC8qIHVuY29ubmVjdGVkIGlkbGUtYmFy
cmllciAqLwotCQkJZXJyID0gLUVCVVNZOwotCQkJYnJlYWs7CisJCWZlbmNlID0gaTkxNV9hY3Rp
dmVfZmVuY2VfZ2V0KCZpdC0+YmFzZSk7CisJCWlmIChmZW5jZSkgeworCQkJZG1hX2ZlbmNlX2Vu
YWJsZV9zd19zaWduYWxpbmcoZmVuY2UpOworCQkJZG1hX2ZlbmNlX3B1dChmZW5jZSk7CiAJCX0K
LQotCQllcnIgPSBpOTE1X2FjdGl2ZV9yZXF1ZXN0X3JldGlyZSgmaXQtPmJhc2UsIEJLTChyZWYp
KTsKLQkJaWYgKGVycikKLQkJCWJyZWFrOwogCX0KLQotb3V0OgotCV9fYWN0aXZlX3JldGlyZShy
ZWYpOworCS8qIEFueSBmZW5jZSBhZGRlZCBhZnRlciB0aGUgd2FpdCBiZWdpbnMgd2lsbCBub3Qg
YmUgYXV0by1zaWduYWxlZCAqLworCWk5MTVfYWN0aXZlX3JlbGVhc2UocmVmKTsKIAlpZiAoZXJy
KQogCQlyZXR1cm4gZXJyOwogCi0JaWYgKHdhaXRfb25fYml0KCZyZWYtPmZsYWdzLCBJOTE1X0FD
VElWRV9HUkFCX0JJVCwgVEFTS19LSUxMQUJMRSkpCisJaWYgKHdhaXRfdmFyX2V2ZW50X2ludGVy
cnVwdGlibGUocmVmLCBpOTE1X2FjdGl2ZV9pc19pZGxlKHJlZikpKQogCQlyZXR1cm4gLUVJTlRS
OwogCi0JZmx1c2hfd29yaygmcmVmLT53b3JrKTsKLQlpZiAoIWk5MTVfYWN0aXZlX2lzX2lkbGUo
cmVmKSkKLQkJcmV0dXJuIC1FQlVTWTsKLQogCXJldHVybiAwOwogfQogCi1pbnQgaTkxNV9yZXF1
ZXN0X2F3YWl0X2FjdGl2ZV9yZXF1ZXN0KHN0cnVjdCBpOTE1X3JlcXVlc3QgKnJxLAotCQkJCSAg
ICAgIHN0cnVjdCBpOTE1X2FjdGl2ZV9yZXF1ZXN0ICphY3RpdmUpCi17Ci0Jc3RydWN0IGk5MTVf
cmVxdWVzdCAqYmFycmllciA9Ci0JCWk5MTVfYWN0aXZlX3JlcXVlc3RfcmF3KGFjdGl2ZSwgJnJx
LT5pOTE1LT5kcm0uc3RydWN0X211dGV4KTsKLQotCXJldHVybiBiYXJyaWVyID8gaTkxNV9yZXF1
ZXN0X2F3YWl0X2RtYV9mZW5jZShycSwgJmJhcnJpZXItPmZlbmNlKSA6IDA7Ci19Ci0KIGludCBp
OTE1X3JlcXVlc3RfYXdhaXRfYWN0aXZlKHN0cnVjdCBpOTE1X3JlcXVlc3QgKnJxLCBzdHJ1Y3Qg
aTkxNV9hY3RpdmUgKnJlZikKIHsKIAlpbnQgZXJyID0gMDsKIAotCWlmIChyY3VfYWNjZXNzX3Bv
aW50ZXIocmVmLT5leGNsKSkgeworCWlmIChyY3VfYWNjZXNzX3BvaW50ZXIocmVmLT5leGNsLmZl
bmNlKSkgewogCQlzdHJ1Y3QgZG1hX2ZlbmNlICpmZW5jZTsKIAogCQlyY3VfcmVhZF9sb2NrKCk7
Ci0JCWZlbmNlID0gZG1hX2ZlbmNlX2dldF9yY3Vfc2FmZSgmcmVmLT5leGNsKTsKKwkJZmVuY2Ug
PSBkbWFfZmVuY2VfZ2V0X3JjdV9zYWZlKCZyZWYtPmV4Y2wuZmVuY2UpOwogCQlyY3VfcmVhZF91
bmxvY2soKTsKIAkJaWYgKGZlbmNlKSB7CiAJCQllcnIgPSBpOTE1X3JlcXVlc3RfYXdhaXRfZG1h
X2ZlbmNlKHJxLCBmZW5jZSk7CkBAIC01NzcsNyArNDg1LDcgQEAgdm9pZCBpOTE1X2FjdGl2ZV9m
aW5pKHN0cnVjdCBpOTE1X2FjdGl2ZSAqcmVmKQogCiBzdGF0aWMgaW5saW5lIGJvb2wgaXNfaWRs
ZV9iYXJyaWVyKHN0cnVjdCBhY3RpdmVfbm9kZSAqbm9kZSwgdTY0IGlkeCkKIHsKLQlyZXR1cm4g
bm9kZS0+dGltZWxpbmUgPT0gaWR4ICYmICFpOTE1X2FjdGl2ZV9yZXF1ZXN0X2lzc2V0KCZub2Rl
LT5iYXNlKTsKKwlyZXR1cm4gbm9kZS0+dGltZWxpbmUgPT0gaWR4ICYmICFpOTE1X2FjdGl2ZV9m
ZW5jZV9pc3NldCgmbm9kZS0+YmFzZSk7CiB9CiAKIHN0YXRpYyBzdHJ1Y3QgYWN0aXZlX25vZGUg
KnJldXNlX2lkbGVfYmFycmllcihzdHJ1Y3QgaTkxNV9hY3RpdmUgKnJlZiwgdTY0IGlkeCkKQEAg
LTY5NywxMyArNjA1LDEzIEBAIGludCBpOTE1X2FjdGl2ZV9hY3F1aXJlX3ByZWFsbG9jYXRlX2Jh
cnJpZXIoc3RydWN0IGk5MTVfYWN0aXZlICpyZWYsCiAJCQlub2RlLT5iYXNlLmxvY2sgPQogCQkJ
CSZlbmdpbmUtPmtlcm5lbF9jb250ZXh0LT50aW1lbGluZS0+bXV0ZXg7CiAjZW5kaWYKLQkJCVJD
VV9JTklUX1BPSU5URVIobm9kZS0+YmFzZS5yZXF1ZXN0LCBOVUxMKTsKLQkJCW5vZGUtPmJhc2Uu
cmV0aXJlID0gbm9kZV9yZXRpcmU7CisJCQlSQ1VfSU5JVF9QT0lOVEVSKG5vZGUtPmJhc2UuZmVu
Y2UsIE5VTEwpOworCQkJbm9kZS0+YmFzZS5jYi5mdW5jID0gbm9kZV9yZXRpcmU7CiAJCQlub2Rl
LT50aW1lbGluZSA9IGlkeDsKIAkJCW5vZGUtPnJlZiA9IHJlZjsKIAkJfQogCi0JCWlmICghaTkx
NV9hY3RpdmVfcmVxdWVzdF9pc3NldCgmbm9kZS0+YmFzZSkpIHsKKwkJaWYgKCFpOTE1X2FjdGl2
ZV9mZW5jZV9pc3NldCgmbm9kZS0+YmFzZSkpIHsKIAkJCS8qCiAJCQkgKiBNYXJrIHRoaXMgYXMg
YmVpbmcgKm91ciogdW5jb25uZWN0ZWQgcHJvdG8tbm9kZS4KIAkJCSAqCkBAIC03MTMsOCArNjIx
LDggQEAgaW50IGk5MTVfYWN0aXZlX2FjcXVpcmVfcHJlYWxsb2NhdGVfYmFycmllcihzdHJ1Y3Qg
aTkxNV9hY3RpdmUgKnJlZiwKIAkJCSAqIGFuZCB0aGVuIHdlIGNhbiB1c2UgdGhlIHJiX25vZGUg
YW5kIGxpc3QgcG9pbnRlcnMKIAkJCSAqIGZvciBvdXIgdHJhY2tpbmcgb2YgdGhlIHBlbmRpbmcg
YmFycmllci4KIAkJCSAqLwotCQkJUkNVX0lOSVRfUE9JTlRFUihub2RlLT5iYXNlLnJlcXVlc3Qs
IEVSUl9QVFIoLUVBR0FJTikpOwotCQkJbm9kZS0+YmFzZS5saW5rLnByZXYgPSAodm9pZCAqKWVu
Z2luZTsKKwkJCVJDVV9JTklUX1BPSU5URVIobm9kZS0+YmFzZS5mZW5jZSwgRVJSX1BUUigtRUFH
QUlOKSk7CisJCQlub2RlLT5iYXNlLmNiLm5vZGUucHJldiA9ICh2b2lkICopZW5naW5lOwogCQkJ
YXRvbWljX2luYygmcmVmLT5jb3VudCk7CiAJCX0KIApAQCAtNzgxLDI1ICs2ODksNjUgQEAgdm9p
ZCBpOTE1X3JlcXVlc3RfYWRkX2FjdGl2ZV9iYXJyaWVycyhzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpy
cSkKIHsKIAlzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmUgPSBycS0+ZW5naW5lOwogCXN0
cnVjdCBsbGlzdF9ub2RlICpub2RlLCAqbmV4dDsKKwl1bnNpZ25lZCBsb25nIGZsYWdzOwogCiAJ
R0VNX0JVR19PTihpbnRlbF9lbmdpbmVfaXNfdmlydHVhbChlbmdpbmUpKTsKIAlHRU1fQlVHX09O
KHJxLT50aW1lbGluZSAhPSBlbmdpbmUtPmtlcm5lbF9jb250ZXh0LT50aW1lbGluZSk7CiAKKwlu
b2RlID0gbGxpc3RfZGVsX2FsbCgmZW5naW5lLT5iYXJyaWVyX3Rhc2tzKTsKKwlpZiAoIW5vZGUp
CisJCXJldHVybjsKIAkvKgogCSAqIEF0dGFjaCB0aGUgbGlzdCBvZiBwcm90by1mZW5jZXMgdG8g
dGhlIGluLWZsaWdodCByZXF1ZXN0IHN1Y2gKIAkgKiB0aGF0IHRoZSBwYXJlbnQgaTkxNV9hY3Rp
dmUgd2lsbCBiZSByZWxlYXNlZCB3aGVuIHRoaXMgcmVxdWVzdAogCSAqIGlzIHJldGlyZWQuCiAJ
ICovCi0JbGxpc3RfZm9yX2VhY2hfc2FmZShub2RlLCBuZXh0LCBsbGlzdF9kZWxfYWxsKCZlbmdp
bmUtPmJhcnJpZXJfdGFza3MpKSB7Ci0JCVJDVV9JTklUX1BPSU5URVIoYmFycmllcl9mcm9tX2xs
KG5vZGUpLT5iYXNlLnJlcXVlc3QsIHJxKTsKKwlzcGluX2xvY2tfaXJxc2F2ZSgmcnEtPmxvY2ss
IGZsYWdzKTsKKwlsbGlzdF9mb3JfZWFjaF9zYWZlKG5vZGUsIG5leHQsIG5vZGUpIHsKKwkJUkNV
X0lOSVRfUE9JTlRFUihiYXJyaWVyX2Zyb21fbGwobm9kZSktPmJhc2UuZmVuY2UsICZycS0+ZmVu
Y2UpOwogCQlzbXBfd21iKCk7IC8qIHNlcmlhbGlzZSB3aXRoIHJldXNlX2lkbGVfYmFycmllciAq
LwotCQlsaXN0X2FkZF90YWlsKChzdHJ1Y3QgbGlzdF9oZWFkICopbm9kZSwgJnJxLT5hY3RpdmVf
bGlzdCk7CisJCWxpc3RfYWRkX3RhaWwoKHN0cnVjdCBsaXN0X2hlYWQgKilub2RlLCAmcnEtPmZl
bmNlLmNiX2xpc3QpOworCX0KKwlzcGluX3VubG9ja19pcnFyZXN0b3JlKCZycS0+bG9jaywgZmxh
Z3MpOworfQorCisjaWYgSVNfRU5BQkxFRChDT05GSUdfRFJNX0k5MTVfREVCVUdfR0VNKQorI2Rl
ZmluZSBhY3RpdmVfaXNfaGVsZChhY3RpdmUpIGxvY2tkZXBfaXNfaGVsZCgoYWN0aXZlKS0+bG9j
aykKKyNlbHNlCisjZGVmaW5lIGFjdGl2ZV9pc19oZWxkKGFjdGl2ZSkgdHJ1ZQorI2VuZGlmCisK
K3N0cnVjdCBkbWFfZmVuY2UgKgorX19pOTE1X2FjdGl2ZV9mZW5jZV9zZXQoc3RydWN0IGk5MTVf
YWN0aXZlX2ZlbmNlICphY3RpdmUsCisJCQlzdHJ1Y3QgZG1hX2ZlbmNlICpmZW5jZSkKK3sKKwlz
dHJ1Y3QgZG1hX2ZlbmNlICpwcmV2OworCXVuc2lnbmVkIGxvbmcgZmxhZ3M7CisKKwkvKiBOQjog
dXBkYXRlcyBtdXN0IGJlIHNlcmlhbGlzZWQgYnkgYW4gb3V0ZXIgdGltZWxpbmUgbXV0ZXggKi8K
KwlzcGluX2xvY2tfaXJxc2F2ZShmZW5jZS0+bG9jaywgZmxhZ3MpOworCUdFTV9CVUdfT04odGVz
dF9iaXQoRE1BX0ZFTkNFX0ZMQUdfU0lHTkFMRURfQklULCAmZmVuY2UtPmZsYWdzKSk7CisKKwlw
cmV2ID0gcmN1X2RlcmVmZXJlbmNlX3Byb3RlY3RlZChhY3RpdmUtPmZlbmNlLCBhY3RpdmVfaXNf
aGVsZChhY3RpdmUpKTsKKwlpZiAocHJldikgeworCQlzcGluX2xvY2tfbmVzdGVkKHByZXYtPmxv
Y2ssIFNJTkdMRV9ERVBUSF9ORVNUSU5HKTsKKwkJX19saXN0X2RlbF9lbnRyeSgmYWN0aXZlLT5j
Yi5ub2RlKTsKKwkJc3Bpbl91bmxvY2socHJldi0+bG9jayk7IC8qIHNlcmlhbGlzZSB3aXRoIHBy
ZXYtPmNiX2xpc3QgKi8KKwkJcHJldiA9IHJjdV9hY2Nlc3NfcG9pbnRlcihhY3RpdmUtPmZlbmNl
KTsKIAl9CisKKwlyY3VfYXNzaWduX3BvaW50ZXIoYWN0aXZlLT5mZW5jZSwgZmVuY2UpOworCWxp
c3RfYWRkX3RhaWwoJmFjdGl2ZS0+Y2Iubm9kZSwgJmZlbmNlLT5jYl9saXN0KTsKKworCXNwaW5f
dW5sb2NrX2lycXJlc3RvcmUoZmVuY2UtPmxvY2ssIGZsYWdzKTsKKworCXJldHVybiBwcmV2Owog
fQogCi1pbnQgaTkxNV9hY3RpdmVfcmVxdWVzdF9zZXQoc3RydWN0IGk5MTVfYWN0aXZlX3JlcXVl
c3QgKmFjdGl2ZSwKLQkJCSAgICBzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpycSkKK2ludCBpOTE1X2Fj
dGl2ZV9mZW5jZV9zZXQoc3RydWN0IGk5MTVfYWN0aXZlX2ZlbmNlICphY3RpdmUsCisJCQkgIHN0
cnVjdCBpOTE1X3JlcXVlc3QgKnJxKQogeworCXN0cnVjdCBkbWFfZmVuY2UgKmZlbmNlOwogCWlu
dCBlcnI7CiAKICNpZiBJU19FTkFCTEVEKENPTkZJR19EUk1fSTkxNV9ERUJVR19HRU0pCkBAIC04
MDcsMTggKzc1NSwyNSBAQCBpbnQgaTkxNV9hY3RpdmVfcmVxdWVzdF9zZXQoc3RydWN0IGk5MTVf
YWN0aXZlX3JlcXVlc3QgKmFjdGl2ZSwKICNlbmRpZgogCiAJLyogTXVzdCBtYWludGFpbiBvcmRl
cmluZyB3cnQgcHJldmlvdXMgYWN0aXZlIHJlcXVlc3RzICovCi0JZXJyID0gaTkxNV9yZXF1ZXN0
X2F3YWl0X2FjdGl2ZV9yZXF1ZXN0KHJxLCBhY3RpdmUpOwotCWlmIChlcnIpCi0JCXJldHVybiBl
cnI7CisJcmN1X3JlYWRfbG9jaygpOworCWZlbmNlID0gX19pOTE1X2FjdGl2ZV9mZW5jZV9zZXQo
YWN0aXZlLCAmcnEtPmZlbmNlKTsKKwlpZiAoZmVuY2UpCisJCWZlbmNlID0gZG1hX2ZlbmNlX2dl
dF9yY3UoZmVuY2UpOworCXJjdV9yZWFkX3VubG9jaygpOworCisJaWYgKGZlbmNlKSB7CisJCWVy
ciA9IGk5MTVfcmVxdWVzdF9hd2FpdF9kbWFfZmVuY2UocnEsIGZlbmNlKTsKKwkJZG1hX2ZlbmNl
X3B1dChmZW5jZSk7CisJCWlmIChlcnIpCisJCQlyZXR1cm4gZXJyOworCX0KIAotCV9faTkxNV9h
Y3RpdmVfcmVxdWVzdF9zZXQoYWN0aXZlLCBycSk7CiAJcmV0dXJuIDA7CiB9CiAKLXZvaWQgaTkx
NV9hY3RpdmVfcmV0aXJlX25vb3Aoc3RydWN0IGk5MTVfYWN0aXZlX3JlcXVlc3QgKmFjdGl2ZSwK
LQkJCSAgICAgc3RydWN0IGk5MTVfcmVxdWVzdCAqcmVxdWVzdCkKK3ZvaWQgaTkxNV9hY3RpdmVf
bm9vcChzdHJ1Y3QgZG1hX2ZlbmNlICpmZW5jZSwgc3RydWN0IGRtYV9mZW5jZV9jYiAqY2IpCiB7
Ci0JLyogU3BhY2UgbGVmdCBpbnRlbnRpb25hbGx5IGJsYW5rICovCisJaTkxNV9hY3RpdmVfZmVu
Y2VfY2IoZmVuY2UsIGNiKTsKIH0KIAogI2lmIElTX0VOQUJMRUQoQ09ORklHX0RSTV9JOTE1X1NF
TEZURVNUKQpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9hY3RpdmUuaCBi
L2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfYWN0aXZlLmgKaW5kZXggYmMxYzlkNWQ0ZjYzLi4y
NzZiNjRiMzUzY2QgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfYWN0aXZl
LmgKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9hY3RpdmUuaApAQCAtMTAsNyArMTAs
MTAgQEAKICNpbmNsdWRlIDxsaW51eC9sb2NrZGVwLmg+CiAKICNpbmNsdWRlICJpOTE1X2FjdGl2
ZV90eXBlcy5oIgotI2luY2x1ZGUgImk5MTVfcmVxdWVzdC5oIgorCitzdHJ1Y3QgaTkxNV9yZXF1
ZXN0Oworc3RydWN0IGludGVsX2VuZ2luZV9jczsKK3N0cnVjdCBpbnRlbF90aW1lbGluZTsKIAog
LyoKICAqIFdlIHRyZWF0IHJlcXVlc3RzIGFzIGZlbmNlcy4gVGhpcyBpcyBub3QgYmUgdG8gY29u
ZnVzZWQgd2l0aCBvdXIKQEAgLTI4LDMwOCArMzEsMTA4IEBACiAgKiB3cml0ZSBhY2Nlc3Mgc28g
dGhhdCB3ZSBjYW4gcGVyZm9ybSBjb25jdXJyZW50IHJlYWQgb3BlcmF0aW9ucyBiZXR3ZWVuCiAg
KiB0aGUgQ1BVIGFuZCBHUFUgZW5naW5lcywgYXMgd2VsbCBhcyB3YWl0aW5nIGZvciBhbGwgcmVu
ZGVyaW5nIHRvCiAgKiBjb21wbGV0ZSwgb3Igd2FpdGluZyBmb3IgdGhlIGxhc3QgR1BVIHVzZXIg
b2YgYSAiZmVuY2UgcmVnaXN0ZXIiLiBUaGUKLSAqIG9iamVjdCB0aGVuIGVtYmVkcyBhICNpOTE1
X2FjdGl2ZV9yZXF1ZXN0IHRvIHRyYWNrIHRoZSBtb3N0IHJlY2VudCAoaW4KKyAqIG9iamVjdCB0
aGVuIGVtYmVkcyBhICNpOTE1X2FjdGl2ZV9mZW5jZSB0byB0cmFjayB0aGUgbW9zdCByZWNlbnQg
KGluCiAgKiByZXRpcmVtZW50IG9yZGVyKSByZXF1ZXN0IHJlbGV2YW50IGZvciB0aGUgZGVzaXJl
ZCBtb2RlIG9mIGFjY2Vzcy4KLSAqIFRoZSAjaTkxNV9hY3RpdmVfcmVxdWVzdCBpcyB1cGRhdGVk
IHdpdGggaTkxNV9hY3RpdmVfcmVxdWVzdF9zZXQoKSB0bworICogVGhlICNpOTE1X2FjdGl2ZV9m
ZW5jZSBpcyB1cGRhdGVkIHdpdGggaTkxNV9hY3RpdmVfZmVuY2Vfc2V0KCkgdG8KICAqIHRyYWNr
IHRoZSBtb3N0IHJlY2VudCBmZW5jZSByZXF1ZXN0LCB0eXBpY2FsbHkgdGhpcyBpcyBkb25lIGFz
IHBhcnQgb2YKICAqIGk5MTVfdm1hX21vdmVfdG9fYWN0aXZlKCkuCiAgKgotICogV2hlbiB0aGUg
I2k5MTVfYWN0aXZlX3JlcXVlc3QgY29tcGxldGVzIChpcyByZXRpcmVkKSwgaXQgd2lsbAorICog
V2hlbiB0aGUgI2k5MTVfYWN0aXZlX2ZlbmNlIGNvbXBsZXRlcyAoaXMgcmV0aXJlZCksIGl0IHdp
bGwKICAqIHNpZ25hbCBpdHMgY29tcGxldGlvbiB0byB0aGUgb3duZXIgdGhyb3VnaCBhIGNhbGxi
YWNrIGFzIHdlbGwgYXMgbWFyawotICogaXRzZWxmIGFzIGlkbGUgKGk5MTVfYWN0aXZlX3JlcXVl
c3QucmVxdWVzdCA9PSBOVUxMKS4gVGhlIG93bmVyCisgKiBpdHNlbGYgYXMgaWRsZSAoaTkxNV9h
Y3RpdmVfZmVuY2UucmVxdWVzdCA9PSBOVUxMKS4gVGhlIG93bmVyCiAgKiBjYW4gdGhlbiBwZXJm
b3JtIGFueSBhY3Rpb24sIHN1Y2ggYXMgZGVsYXllZCBmcmVlaW5nIG9mIGFuIGFjdGl2ZQogICog
cmVzb3VyY2UgaW5jbHVkaW5nIGl0c2VsZi4KICAqLwogCi12b2lkIGk5MTVfYWN0aXZlX3JldGly
ZV9ub29wKHN0cnVjdCBpOTE1X2FjdGl2ZV9yZXF1ZXN0ICphY3RpdmUsCi0JCQkgICAgIHN0cnVj
dCBpOTE1X3JlcXVlc3QgKnJlcXVlc3QpOwordm9pZCBpOTE1X2FjdGl2ZV9ub29wKHN0cnVjdCBk
bWFfZmVuY2UgKmZlbmNlLCBzdHJ1Y3QgZG1hX2ZlbmNlX2NiICpjYik7CiAKIC8qKgotICogaTkx
NV9hY3RpdmVfcmVxdWVzdF9pbml0IC0gcHJlcGFyZXMgdGhlIGFjdGl2aXR5IHRyYWNrZXIgZm9y
IHVzZQorICogX19pOTE1X2FjdGl2ZV9mZW5jZV9pbml0IC0gcHJlcGFyZXMgdGhlIGFjdGl2aXR5
IHRyYWNrZXIgZm9yIHVzZQogICogQGFjdGl2ZSAtIHRoZSBhY3RpdmUgdHJhY2tlcgotICogQHJx
IC0gaW5pdGlhbCByZXF1ZXN0IHRvIHRyYWNrLCBjYW4gYmUgTlVMTAorICogQGZlbmNlIC0gaW5p
dGlhbCBmZW5jZSB0byB0cmFjaywgY2FuIGJlIE5VTEwKICAqIEBmdW5jIC0gYSBjYWxsYmFjayB3
aGVuIHRoZW4gdGhlIHRyYWNrZXIgaXMgcmV0aXJlZCAoYmVjb21lcyBpZGxlKSwKICAqICAgICAg
ICAgY2FuIGJlIE5VTEwKICAqCi0gKiBpOTE1X2FjdGl2ZV9yZXF1ZXN0X2luaXQoKSBwcmVwYXJl
cyB0aGUgZW1iZWRkZWQgQGFjdGl2ZSBzdHJ1Y3QgZm9yIHVzZSBhcwotICogYW4gYWN0aXZpdHkg
dHJhY2tlciwgdGhhdCBpcyBmb3IgdHJhY2tpbmcgdGhlIGxhc3Qga25vd24gYWN0aXZlIHJlcXVl
c3QKLSAqIGFzc29jaWF0ZWQgd2l0aCBpdC4gV2hlbiB0aGUgbGFzdCByZXF1ZXN0IGJlY29tZXMg
aWRsZSwgd2hlbiBpdCBpcyByZXRpcmVkCisgKiBpOTE1X2FjdGl2ZV9mZW5jZV9pbml0KCkgcHJl
cGFyZXMgdGhlIGVtYmVkZGVkIEBhY3RpdmUgc3RydWN0IGZvciB1c2UgYXMKKyAqIGFuIGFjdGl2
aXR5IHRyYWNrZXIsIHRoYXQgaXMgZm9yIHRyYWNraW5nIHRoZSBsYXN0IGtub3duIGFjdGl2ZSBm
ZW5jZQorICogYXNzb2NpYXRlZCB3aXRoIGl0LiBXaGVuIHRoZSBsYXN0IGZlbmNlIGJlY29tZXMg
aWRsZSwgd2hlbiBpdCBpcyByZXRpcmVkCiAgKiBhZnRlciBjb21wbGV0aW9uLCB0aGUgb3B0aW9u
YWwgY2FsbGJhY2sgQGZ1bmMgaXMgaW52b2tlZC4KICAqLwogc3RhdGljIGlubGluZSB2b2lkCi1p
OTE1X2FjdGl2ZV9yZXF1ZXN0X2luaXQoc3RydWN0IGk5MTVfYWN0aXZlX3JlcXVlc3QgKmFjdGl2
ZSwKK19faTkxNV9hY3RpdmVfZmVuY2VfaW5pdChzdHJ1Y3QgaTkxNV9hY3RpdmVfZmVuY2UgKmFj
dGl2ZSwKIAkJCSBzdHJ1Y3QgbXV0ZXggKmxvY2ssCi0JCQkgc3RydWN0IGk5MTVfcmVxdWVzdCAq
cnEsCi0JCQkgaTkxNV9hY3RpdmVfcmV0aXJlX2ZuIHJldGlyZSkKKwkJCSB2b2lkICpmZW5jZSwK
KwkJCSBkbWFfZmVuY2VfZnVuY190IGZuKQogewotCVJDVV9JTklUX1BPSU5URVIoYWN0aXZlLT5y
ZXF1ZXN0LCBycSk7Ci0JSU5JVF9MSVNUX0hFQUQoJmFjdGl2ZS0+bGluayk7Ci0JYWN0aXZlLT5y
ZXRpcmUgPSByZXRpcmUgPzogaTkxNV9hY3RpdmVfcmV0aXJlX25vb3A7CisJUkNVX0lOSVRfUE9J
TlRFUihhY3RpdmUtPmZlbmNlLCBmZW5jZSk7CisJYWN0aXZlLT5jYi5mdW5jID0gZm4gPzogaTkx
NV9hY3RpdmVfbm9vcDsKICNpZiBJU19FTkFCTEVEKENPTkZJR19EUk1fSTkxNV9ERUJVR19HRU0p
CiAJYWN0aXZlLT5sb2NrID0gbG9jazsKICNlbmRpZgogfQogCi0jZGVmaW5lIElOSVRfQUNUSVZF
X1JFUVVFU1QobmFtZSwgbG9jaykgXAotCWk5MTVfYWN0aXZlX3JlcXVlc3RfaW5pdCgobmFtZSks
IChsb2NrKSwgTlVMTCwgTlVMTCkKLQotLyoqCi0gKiBpOTE1X2FjdGl2ZV9yZXF1ZXN0X3NldCAt
IHVwZGF0ZXMgdGhlIHRyYWNrZXIgdG8gd2F0Y2ggdGhlIGN1cnJlbnQgcmVxdWVzdAotICogQGFj
dGl2ZSAtIHRoZSBhY3RpdmUgdHJhY2tlcgotICogQHJlcXVlc3QgLSB0aGUgcmVxdWVzdCB0byB3
YXRjaAotICoKLSAqIF9faTkxNV9hY3RpdmVfcmVxdWVzdF9zZXQoKSB3YXRjaGVzIHRoZSBnaXZl
biBAcmVxdWVzdCBmb3IgY29tcGxldGlvbi4gV2hpbHN0Ci0gKiB0aGF0IEByZXF1ZXN0IGlzIGJ1
c3ksIHRoZSBAYWN0aXZlIHJlcG9ydHMgYnVzeS4gV2hlbiB0aGF0IEByZXF1ZXN0IGlzCi0gKiBy
ZXRpcmVkLCB0aGUgQGFjdGl2ZSB0cmFja2VyIGlzIHVwZGF0ZWQgdG8gcmVwb3J0IGlkbGUuCi0g
Ki8KLXN0YXRpYyBpbmxpbmUgdm9pZAotX19pOTE1X2FjdGl2ZV9yZXF1ZXN0X3NldChzdHJ1Y3Qg
aTkxNV9hY3RpdmVfcmVxdWVzdCAqYWN0aXZlLAotCQkJICBzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpy
ZXF1ZXN0KQotewotI2lmIElTX0VOQUJMRUQoQ09ORklHX0RSTV9JOTE1X0RFQlVHX0dFTSkKLQls
b2NrZGVwX2Fzc2VydF9oZWxkKGFjdGl2ZS0+bG9jayk7Ci0jZW5kaWYKLQlsaXN0X21vdmUoJmFj
dGl2ZS0+bGluaywgJnJlcXVlc3QtPmFjdGl2ZV9saXN0KTsKLQlyY3VfYXNzaWduX3BvaW50ZXIo
YWN0aXZlLT5yZXF1ZXN0LCByZXF1ZXN0KTsKLX0KKyNkZWZpbmUgSU5JVF9BQ1RJVkVfRkVOQ0Uo
QSwgTE9DSykgXAorCV9faTkxNV9hY3RpdmVfZmVuY2VfaW5pdCgoQSksIChMT0NLKSwgTlVMTCwg
TlVMTCkKIAotaW50IF9fbXVzdF9jaGVjawotaTkxNV9hY3RpdmVfcmVxdWVzdF9zZXQoc3RydWN0
IGk5MTVfYWN0aXZlX3JlcXVlc3QgKmFjdGl2ZSwKLQkJCXN0cnVjdCBpOTE1X3JlcXVlc3QgKnJx
KTsKK3N0cnVjdCBkbWFfZmVuY2UgKgorX19pOTE1X2FjdGl2ZV9mZW5jZV9zZXQoc3RydWN0IGk5
MTVfYWN0aXZlX2ZlbmNlICphY3RpdmUsCisJCQlzdHJ1Y3QgZG1hX2ZlbmNlICpmZW5jZSk7CiAK
IC8qKgotICogaTkxNV9hY3RpdmVfcmVxdWVzdF9yYXcgLSByZXR1cm4gdGhlIGFjdGl2ZSByZXF1
ZXN0CisgKiBpOTE1X2FjdGl2ZV9mZW5jZV9zZXQgLSB1cGRhdGVzIHRoZSB0cmFja2VyIHRvIHdh
dGNoIHRoZSBjdXJyZW50IGZlbmNlCiAgKiBAYWN0aXZlIC0gdGhlIGFjdGl2ZSB0cmFja2VyCisg
KiBAcnEgLSB0aGUgcmVxdWVzdCB0byB3YXRjaAogICoKLSAqIGk5MTVfYWN0aXZlX3JlcXVlc3Rf
cmF3KCkgcmV0dXJucyB0aGUgY3VycmVudCByZXF1ZXN0IGJlaW5nIHRyYWNrZWQsIG9yIE5VTEwu
Ci0gKiBJdCBkb2VzIG5vdCBvYnRhaW4gYSByZWZlcmVuY2Ugb24gdGhlIHJlcXVlc3QgZm9yIHRo
ZSBjYWxsZXIsIHNvIHRoZSBjYWxsZXIKLSAqIG11c3QgaG9sZCBzdHJ1Y3RfbXV0ZXguCisgKiBp
OTE1X2FjdGl2ZV9mZW5jZV9zZXQoKSB3YXRjaGVzIHRoZSBnaXZlbiBAcnEgZm9yIGNvbXBsZXRp
b24uIFdoaWxlCisgKiB0aGF0IEBycSBpcyBidXN5LCB0aGUgQGFjdGl2ZSByZXBvcnRzIGJ1c3ku
IFdoZW4gdGhhdCBAcnEgaXMgc2lnbmFsZWQKKyAqIChvciBlbHNlIHJldGlyZWQpIHRoZSBAYWN0
aXZlIHRyYWNrZXIgaXMgdXBkYXRlZCB0byByZXBvcnQgaWRsZS4KICAqLwotc3RhdGljIGlubGlu
ZSBzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICoKLWk5MTVfYWN0aXZlX3JlcXVlc3RfcmF3KGNvbnN0IHN0
cnVjdCBpOTE1X2FjdGl2ZV9yZXF1ZXN0ICphY3RpdmUsCi0JCQlzdHJ1Y3QgbXV0ZXggKm11dGV4
KQotewotCXJldHVybiByY3VfZGVyZWZlcmVuY2VfcHJvdGVjdGVkKGFjdGl2ZS0+cmVxdWVzdCwK
LQkJCQkJIGxvY2tkZXBfaXNfaGVsZChtdXRleCkpOwotfQotCi0vKioKLSAqIGk5MTVfYWN0aXZl
X3JlcXVlc3RfcGVlayAtIHJlcG9ydCB0aGUgYWN0aXZlIHJlcXVlc3QgYmVpbmcgbW9uaXRvcmVk
Ci0gKiBAYWN0aXZlIC0gdGhlIGFjdGl2ZSB0cmFja2VyCi0gKgotICogaTkxNV9hY3RpdmVfcmVx
dWVzdF9wZWVrKCkgcmV0dXJucyB0aGUgY3VycmVudCByZXF1ZXN0IGJlaW5nIHRyYWNrZWQgaWYK
LSAqIHN0aWxsIGFjdGl2ZSwgb3IgTlVMTC4gSXQgZG9lcyBub3Qgb2J0YWluIGEgcmVmZXJlbmNl
IG9uIHRoZSByZXF1ZXN0Ci0gKiBmb3IgdGhlIGNhbGxlciwgc28gdGhlIGNhbGxlciBtdXN0IGhv
bGQgc3RydWN0X211dGV4LgotICovCi1zdGF0aWMgaW5saW5lIHN0cnVjdCBpOTE1X3JlcXVlc3Qg
KgotaTkxNV9hY3RpdmVfcmVxdWVzdF9wZWVrKGNvbnN0IHN0cnVjdCBpOTE1X2FjdGl2ZV9yZXF1
ZXN0ICphY3RpdmUsCi0JCQkgc3RydWN0IG11dGV4ICptdXRleCkKLXsKLQlzdHJ1Y3QgaTkxNV9y
ZXF1ZXN0ICpyZXF1ZXN0OwotCi0JcmVxdWVzdCA9IGk5MTVfYWN0aXZlX3JlcXVlc3RfcmF3KGFj
dGl2ZSwgbXV0ZXgpOwotCWlmICghcmVxdWVzdCB8fCBpOTE1X3JlcXVlc3RfY29tcGxldGVkKHJl
cXVlc3QpKQotCQlyZXR1cm4gTlVMTDsKLQotCXJldHVybiByZXF1ZXN0OwotfQotCi0vKioKLSAq
IGk5MTVfYWN0aXZlX3JlcXVlc3RfZ2V0IC0gcmV0dXJuIGEgcmVmZXJlbmNlIHRvIHRoZSBhY3Rp
dmUgcmVxdWVzdAotICogQGFjdGl2ZSAtIHRoZSBhY3RpdmUgdHJhY2tlcgotICoKLSAqIGk5MTVf
YWN0aXZlX3JlcXVlc3RfZ2V0KCkgcmV0dXJucyBhIHJlZmVyZW5jZSB0byB0aGUgYWN0aXZlIHJl
cXVlc3QsIG9yIE5VTEwKLSAqIGlmIHRoZSBhY3RpdmUgdHJhY2tlciBpcyBpZGxlLiBUaGUgY2Fs
bGVyIG11c3QgaG9sZCBzdHJ1Y3RfbXV0ZXguCi0gKi8KLXN0YXRpYyBpbmxpbmUgc3RydWN0IGk5
MTVfcmVxdWVzdCAqCi1pOTE1X2FjdGl2ZV9yZXF1ZXN0X2dldChjb25zdCBzdHJ1Y3QgaTkxNV9h
Y3RpdmVfcmVxdWVzdCAqYWN0aXZlLAotCQkJc3RydWN0IG11dGV4ICptdXRleCkKLXsKLQlyZXR1
cm4gaTkxNV9yZXF1ZXN0X2dldChpOTE1X2FjdGl2ZV9yZXF1ZXN0X3BlZWsoYWN0aXZlLCBtdXRl
eCkpOwotfQotCi0vKioKLSAqIF9faTkxNV9hY3RpdmVfcmVxdWVzdF9nZXRfcmN1IC0gcmV0dXJu
IGEgcmVmZXJlbmNlIHRvIHRoZSBhY3RpdmUgcmVxdWVzdAotICogQGFjdGl2ZSAtIHRoZSBhY3Rp
dmUgdHJhY2tlcgotICoKLSAqIF9faTkxNV9hY3RpdmVfcmVxdWVzdF9nZXQoKSByZXR1cm5zIGEg
cmVmZXJlbmNlIHRvIHRoZSBhY3RpdmUgcmVxdWVzdCwKLSAqIG9yIE5VTEwgaWYgdGhlIGFjdGl2
ZSB0cmFja2VyIGlzIGlkbGUuIFRoZSBjYWxsZXIgbXVzdCBob2xkIHRoZSBSQ1UgcmVhZAotICog
bG9jaywgYnV0IHRoZSByZXR1cm5lZCBwb2ludGVyIGlzIHNhZmUgdG8gdXNlIG91dHNpZGUgb2Yg
UkNVLgotICovCi1zdGF0aWMgaW5saW5lIHN0cnVjdCBpOTE1X3JlcXVlc3QgKgotX19pOTE1X2Fj
dGl2ZV9yZXF1ZXN0X2dldF9yY3UoY29uc3Qgc3RydWN0IGk5MTVfYWN0aXZlX3JlcXVlc3QgKmFj
dGl2ZSkKLXsKLQkvKgotCSAqIFBlcmZvcm1pbmcgYSBsb2NrbGVzcyByZXRyaWV2YWwgb2YgdGhl
IGFjdGl2ZSByZXF1ZXN0IGlzIHN1cGVyCi0JICogdHJpY2t5LiBTTEFCX1RZUEVTQUZFX0JZX1JD
VSBtZXJlbHkgZ3VhcmFudGVlcyB0aGF0IHRoZSBiYWNraW5nCi0JICogc2xhYiBvZiByZXF1ZXN0
IG9iamVjdHMgd2lsbCBub3QgYmUgZnJlZWQgd2hpbHN0IHdlIGhvbGQgdGhlCi0JICogUkNVIHJl
YWQgbG9jay4gSXQgZG9lcyBub3QgZ3VhcmFudGVlIHRoYXQgdGhlIHJlcXVlc3QgaXRzZWxmCi0J
ICogd2lsbCBub3QgYmUgZnJlZWQgYW5kIHRoZW4gKnJldXNlZCouIFZpeiwKLQkgKgotCSAqIFRo
cmVhZCBBCQkJVGhyZWFkIEIKLQkgKgotCSAqIHJxID0gYWN0aXZlLnJlcXVlc3QKLQkgKgkJCQly
ZXRpcmUocnEpIC0+IGZyZWUocnEpOwotCSAqCQkJCShycSBpcyBub3cgZmlyc3Qgb24gdGhlIHNs
YWIgZnJlZWxpc3QpCi0JICoJCQkJYWN0aXZlLnJlcXVlc3QgPSBOVUxMCi0JICoKLQkgKgkJCQly
cSA9IG5ldyBzdWJtaXNzaW9uIG9uIGEgbmV3IG9iamVjdAotCSAqIHJlZihycSkKLQkgKgotCSAq
IFRvIHByZXZlbnQgdGhlIHJlcXVlc3QgZnJvbSBiZWluZyByZXVzZWQgd2hpbHN0IHRoZSBjYWxs
ZXIKLQkgKiB1c2VzIGl0LCB3ZSB0YWtlIGEgcmVmZXJlbmNlIGxpa2Ugbm9ybWFsLiBXaGlsc3Qg
YWNxdWlyaW5nCi0JICogdGhlIHJlZmVyZW5jZSB3ZSBjaGVjayB0aGF0IGl0IGlzIG5vdCBpbiBh
IGRlc3Ryb3llZCBzdGF0ZQotCSAqIChyZWZjbnQgPT0gMCkuIFRoYXQgcHJldmVudHMgdGhlIHJl
cXVlc3QgYmVpbmcgcmVhbGxvY2F0ZWQKLQkgKiB3aGlsc3QgdGhlIGNhbGxlciBob2xkcyBvbiB0
byBpdC4gVG8gY2hlY2sgdGhhdCB0aGUgcmVxdWVzdAotCSAqIHdhcyBub3QgcmVhbGxvY2F0ZWQg
YXMgd2UgYWNxdWlyZWQgdGhlIHJlZmVyZW5jZSB3ZSBoYXZlIHRvCi0JICogY2hlY2sgdGhhdCBv
dXIgcmVxdWVzdCByZW1haW5zIHRoZSBhY3RpdmUgcmVxdWVzdCBhY3Jvc3MKLQkgKiB0aGUgbG9v
a3VwLCBpbiB0aGUgc2FtZSBtYW5uZXIgYXMgYSBzZXFsb2NrLiBUaGUgdmlzaWJpbGl0eQotCSAq
IG9mIHRoZSBwb2ludGVyIHZlcnN1cyB0aGUgcmVmZXJlbmNlIGNvdW50aW5nIGlzIGNvbnRyb2xs
ZWQKLQkgKiBieSB1c2luZyBSQ1UgYmFycmllcnMgKHJjdV9kZXJlZmVyZW5jZSBhbmQgcmN1X2Fz
c2lnbl9wb2ludGVyKS4KLQkgKgotCSAqIEluIHRoZSBtaWRkbGUgb2YgYWxsIHRoYXQsIHdlIGlu
c3BlY3Qgd2hldGhlciB0aGUgcmVxdWVzdCBpcwotCSAqIGNvbXBsZXRlLiBSZXRpcmluZyBpcyBs
YXp5IHNvIHRoZSByZXF1ZXN0IG1heSBiZSBjb21wbGV0ZWQgbG9uZwotCSAqIGJlZm9yZSB0aGUg
YWN0aXZlIHRyYWNrZXIgaXMgdXBkYXRlZC4gUXVlcnlpbmcgd2hldGhlciB0aGUKLQkgKiByZXF1
ZXN0IGlzIGNvbXBsZXRlIGlzIGZhciBjaGVhcGVyIChhcyBpdCBpbnZvbHZlcyBubyBsb2NrZWQK
LQkgKiBpbnN0cnVjdGlvbnMgc2V0dGluZyBjYWNoZWxpbmVzIHRvIGV4Y2x1c2l2ZSkgdGhhbiBh
Y3F1aXJpbmcKLQkgKiB0aGUgcmVmZXJlbmNlLCBzbyB3ZSBkbyBpdCBmaXJzdC4gVGhlIFJDVSBy
ZWFkIGxvY2sgZW5zdXJlcyB0aGUKLQkgKiBwb2ludGVyIGRlcmVmZXJlbmNlIGlzIHZhbGlkLCBi
dXQgZG9lcyBub3QgZW5zdXJlIHRoYXQgdGhlCi0JICogc2Vxbm8gbm9yIEhXUyBpcyB0aGUgcmln
aHQgb25lISBIb3dldmVyLCBpZiB0aGUgcmVxdWVzdCB3YXMKLQkgKiByZWFsbG9jYXRlZCwgdGhh
dCBtZWFucyB0aGUgYWN0aXZlIHRyYWNrZXIncyByZXF1ZXN0IHdhcyBjb21wbGV0ZS4KLQkgKiBJ
ZiB0aGUgbmV3IHJlcXVlc3QgaXMgYWxzbyBjb21wbGV0ZSwgdGhlbiBib3RoIGFyZSBhbmQgd2Ug
Y2FuCi0JICoganVzdCByZXBvcnQgdGhlIGFjdGl2ZSB0cmFja2VyIGlzIGlkbGUuIElmIHRoZSBu
ZXcgcmVxdWVzdCBpcwotCSAqIGluY29tcGxldGUsIHRoZW4gd2UgYWNxdWlyZSBhIHJlZmVyZW5j
ZSBvbiBpdCBhbmQgY2hlY2sgdGhhdAotCSAqIGl0IHJlbWFpbmVkIHRoZSBhY3RpdmUgcmVxdWVz
dC4KLQkgKgotCSAqIEl0IGlzIHRoZW4gaW1wZXJhdGl2ZSB0aGF0IHdlIGRvIG5vdCB6ZXJvIHRo
ZSByZXF1ZXN0IG9uCi0JICogcmVhbGxvY2F0aW9uLCBzbyB0aGF0IHdlIGNhbiBjaGFzZSB0aGUg
ZGFuZ2xpbmcgcG9pbnRlcnMhCi0JICogU2VlIGk5MTVfcmVxdWVzdF9hbGxvYygpLgotCSAqLwot
CWRvIHsKLQkJc3RydWN0IGk5MTVfcmVxdWVzdCAqcmVxdWVzdDsKLQotCQlyZXF1ZXN0ID0gcmN1
X2RlcmVmZXJlbmNlKGFjdGl2ZS0+cmVxdWVzdCk7Ci0JCWlmICghcmVxdWVzdCB8fCBpOTE1X3Jl
cXVlc3RfY29tcGxldGVkKHJlcXVlc3QpKQotCQkJcmV0dXJuIE5VTEw7Ci0KLQkJLyoKLQkJICog
QW4gZXNwZWNpYWxseSBzaWxseSBjb21waWxlciBjb3VsZCBkZWNpZGUgdG8gcmVjb21wdXRlIHRo
ZQotCQkgKiByZXN1bHQgb2YgaTkxNV9yZXF1ZXN0X2NvbXBsZXRlZCwgbW9yZSBzcGVjaWZpY2Fs
bHkKLQkJICogcmUtZW1pdCB0aGUgbG9hZCBmb3IgcmVxdWVzdC0+ZmVuY2Uuc2Vxbm8uIEEgcmFj
ZSB3b3VsZCBjYXRjaAotCQkgKiBhIGxhdGVyIHNlcW5vIHZhbHVlLCB3aGljaCBjb3VsZCBmbGlw
IHRoZSByZXN1bHQgZnJvbSB0cnVlIHRvCi0JCSAqIGZhbHNlLiBXaGljaCBtZWFucyBwYXJ0IG9m
IHRoZSBpbnN0cnVjdGlvbnMgYmVsb3cgbWlnaHQgbm90Ci0JCSAqIGJlIGV4ZWN1dGVkLCB3aGls
ZSBsYXRlciBvbiBpbnN0cnVjdGlvbnMgYXJlIGV4ZWN1dGVkLiBEdWUgdG8KLQkJICogYmFycmll
cnMgd2l0aGluIHRoZSByZWZjb3VudGluZyB0aGUgaW5jb25zaXN0ZW5jeSBjYW4ndCByZWFjaAot
CQkgKiBwYXN0IHRoZSBjYWxsIHRvIGk5MTVfcmVxdWVzdF9nZXRfcmN1LCBidXQgbm90IGV4ZWN1
dGluZwotCQkgKiB0aGF0IHdoaWxlIHN0aWxsIGV4ZWN1dGluZyBpOTE1X3JlcXVlc3RfcHV0KCkg
Y3JlYXRlcwotCQkgKiBoYXZvYyBlbm91Z2guICBQcmV2ZW50IHRoaXMgd2l0aCBhIGNvbXBpbGVy
IGJhcnJpZXIuCi0JCSAqLwotCQliYXJyaWVyKCk7Ci0KLQkJcmVxdWVzdCA9IGk5MTVfcmVxdWVz
dF9nZXRfcmN1KHJlcXVlc3QpOwotCi0JCS8qCi0JCSAqIFdoYXQgc3RvcHMgdGhlIGZvbGxvd2lu
ZyByY3VfYWNjZXNzX3BvaW50ZXIoKSBmcm9tIG9jY3VycmluZwotCQkgKiBiZWZvcmUgdGhlIGFi
b3ZlIGk5MTVfcmVxdWVzdF9nZXRfcmN1KCk/IElmIHdlIHdlcmUKLQkJICogdG8gcmVhZCB0aGUg
dmFsdWUgYmVmb3JlIHBhdXNpbmcgdG8gZ2V0IHRoZSByZWZlcmVuY2UgdG8KLQkJICogdGhlIHJl
cXVlc3QsIHdlIG1heSBub3Qgbm90aWNlIGEgY2hhbmdlIGluIHRoZSBhY3RpdmUKLQkJICogdHJh
Y2tlci4KLQkJICoKLQkJICogVGhlIHJjdV9hY2Nlc3NfcG9pbnRlcigpIGlzIGEgbWVyZSBjb21w
aWxlciBiYXJyaWVyLCB3aGljaAotCQkgKiBtZWFucyBib3RoIHRoZSBDUFUgYW5kIGNvbXBpbGVy
IGFyZSBmcmVlIHRvIHBlcmZvcm0gdGhlCi0JCSAqIG1lbW9yeSByZWFkIHdpdGhvdXQgY29uc3Ry
YWludC4gVGhlIGNvbXBpbGVyIG9ubHkgaGFzIHRvCi0JCSAqIGVuc3VyZSB0aGF0IGFueSBvcGVy
YXRpb25zIGFmdGVyIHRoZSByY3VfYWNjZXNzX3BvaW50ZXIoKQotCQkgKiBvY2N1ciBhZnRlcndh
cmRzIGluIHByb2dyYW0gb3JkZXIuIFRoaXMgbWVhbnMgdGhlIHJlYWQgbWF5Ci0JCSAqIGJlIHBl
cmZvcm1lZCBlYXJsaWVyIGJ5IGFuIG91dC1vZi1vcmRlciBDUFUsIG9yIGFkdmVudHVyb3VzCi0J
CSAqIGNvbXBpbGVyLgotCQkgKgotCQkgKiBUaGUgYXRvbWljIG9wZXJhdGlvbiBhdCB0aGUgaGVh
cnQgb2YKLQkJICogaTkxNV9yZXF1ZXN0X2dldF9yY3UoKSwgc2VlIGRtYV9mZW5jZV9nZXRfcmN1
KCksIGlzCi0JCSAqIGF0b21pY19pbmNfbm90X3plcm8oKSB3aGljaCBpcyBvbmx5IGEgZnVsbCBt
ZW1vcnkgYmFycmllcgotCQkgKiB3aGVuIHN1Y2Nlc3NmdWwuIFRoYXQgaXMsIGlmIGk5MTVfcmVx
dWVzdF9nZXRfcmN1KCkKLQkJICogcmV0dXJucyB0aGUgcmVxdWVzdCAoYW5kIHNvIHdpdGggdGhl
IHJlZmVyZW5jZSBjb3VudGVkCi0JCSAqIGluY3JlbWVudGVkKSB0aGVuIHRoZSBmb2xsb3dpbmcg
cmVhZCBmb3IgcmN1X2FjY2Vzc19wb2ludGVyKCkKLQkJICogbXVzdCBvY2N1ciBhZnRlciB0aGUg
YXRvbWljIG9wZXJhdGlvbiBhbmQgc28gY29uZmlybQotCQkgKiB0aGF0IHRoaXMgcmVxdWVzdCBp
cyB0aGUgb25lIGN1cnJlbnRseSBiZWluZyB0cmFja2VkLgotCQkgKgotCQkgKiBUaGUgY29ycmVz
cG9uZGluZyB3cml0ZSBiYXJyaWVyIGlzIHBhcnQgb2YKLQkJICogcmN1X2Fzc2lnbl9wb2ludGVy
KCkuCi0JCSAqLwotCQlpZiAoIXJlcXVlc3QgfHwgcmVxdWVzdCA9PSByY3VfYWNjZXNzX3BvaW50
ZXIoYWN0aXZlLT5yZXF1ZXN0KSkKLQkJCXJldHVybiByY3VfcG9pbnRlcl9oYW5kb2ZmKHJlcXVl
c3QpOwotCi0JCWk5MTVfcmVxdWVzdF9wdXQocmVxdWVzdCk7Ci0JfSB3aGlsZSAoMSk7Ci19Ci0K
K2ludCBfX211c3RfY2hlY2sKK2k5MTVfYWN0aXZlX2ZlbmNlX3NldChzdHJ1Y3QgaTkxNV9hY3Rp
dmVfZmVuY2UgKmFjdGl2ZSwKKwkJICAgICAgc3RydWN0IGk5MTVfcmVxdWVzdCAqcnEpOwogLyoq
Ci0gKiBpOTE1X2FjdGl2ZV9yZXF1ZXN0X2dldF91bmxvY2tlZCAtIHJldHVybiBhIHJlZmVyZW5j
ZSB0byB0aGUgYWN0aXZlIHJlcXVlc3QKKyAqIGk5MTVfYWN0aXZlX2ZlbmNlX2dldCAtIHJldHVy
biBhIHJlZmVyZW5jZSB0byB0aGUgYWN0aXZlIGZlbmNlCiAgKiBAYWN0aXZlIC0gdGhlIGFjdGl2
ZSB0cmFja2VyCiAgKgotICogaTkxNV9hY3RpdmVfcmVxdWVzdF9nZXRfdW5sb2NrZWQoKSByZXR1
cm5zIGEgcmVmZXJlbmNlIHRvIHRoZSBhY3RpdmUgcmVxdWVzdCwKKyAqIGk5MTVfYWN0aXZlX2Zl
bmNlX2dldCgpIHJldHVybnMgYSByZWZlcmVuY2UgdG8gdGhlIGFjdGl2ZSBmZW5jZSwKICAqIG9y
IE5VTEwgaWYgdGhlIGFjdGl2ZSB0cmFja2VyIGlzIGlkbGUuIFRoZSByZWZlcmVuY2UgaXMgb2J0
YWluZWQgdW5kZXIgUkNVLAogICogc28gbm8gbG9ja2luZyBpcyByZXF1aXJlZCBieSB0aGUgY2Fs
bGVyLgogICoKLSAqIFRoZSByZWZlcmVuY2Ugc2hvdWxkIGJlIGZyZWVkIHdpdGggaTkxNV9yZXF1
ZXN0X3B1dCgpLgorICogVGhlIHJlZmVyZW5jZSBzaG91bGQgYmUgZnJlZWQgd2l0aCBkbWFfZmVu
Y2VfcHV0KCkuCiAgKi8KLXN0YXRpYyBpbmxpbmUgc3RydWN0IGk5MTVfcmVxdWVzdCAqCi1pOTE1
X2FjdGl2ZV9yZXF1ZXN0X2dldF91bmxvY2tlZChjb25zdCBzdHJ1Y3QgaTkxNV9hY3RpdmVfcmVx
dWVzdCAqYWN0aXZlKQorc3RhdGljIGlubGluZSBzdHJ1Y3QgZG1hX2ZlbmNlICoKK2k5MTVfYWN0
aXZlX2ZlbmNlX2dldChzdHJ1Y3QgaTkxNV9hY3RpdmVfZmVuY2UgKmFjdGl2ZSkKIHsKLQlzdHJ1
Y3QgaTkxNV9yZXF1ZXN0ICpyZXF1ZXN0OworCXN0cnVjdCBkbWFfZmVuY2UgKmZlbmNlOwogCiAJ
cmN1X3JlYWRfbG9jaygpOwotCXJlcXVlc3QgPSBfX2k5MTVfYWN0aXZlX3JlcXVlc3RfZ2V0X3Jj
dShhY3RpdmUpOworCWZlbmNlID0gZG1hX2ZlbmNlX2dldF9yY3Vfc2FmZSgmYWN0aXZlLT5mZW5j
ZSk7CiAJcmN1X3JlYWRfdW5sb2NrKCk7CiAKLQlyZXR1cm4gcmVxdWVzdDsKKwlyZXR1cm4gZmVu
Y2U7CiB9CiAKIC8qKgotICogaTkxNV9hY3RpdmVfcmVxdWVzdF9pc3NldCAtIHJlcG9ydCB3aGV0
aGVyIHRoZSBhY3RpdmUgdHJhY2tlciBpcyBhc3NpZ25lZAorICogaTkxNV9hY3RpdmVfZmVuY2Vf
aXNzZXQgLSByZXBvcnQgd2hldGhlciB0aGUgYWN0aXZlIHRyYWNrZXIgaXMgYXNzaWduZWQKICAq
IEBhY3RpdmUgLSB0aGUgYWN0aXZlIHRyYWNrZXIKICAqCi0gKiBpOTE1X2FjdGl2ZV9yZXF1ZXN0
X2lzc2V0KCkgcmV0dXJucyB0cnVlIGlmIHRoZSBhY3RpdmUgdHJhY2tlciBpcyBjdXJyZW50bHkK
LSAqIGFzc2lnbmVkIHRvIGEgcmVxdWVzdC4gRHVlIHRvIHRoZSBsYXp5IHJldGlyaW5nLCB0aGF0
IHJlcXVlc3QgbWF5IGJlIGlkbGUKKyAqIGk5MTVfYWN0aXZlX2ZlbmNlX2lzc2V0KCkgcmV0dXJu
cyB0cnVlIGlmIHRoZSBhY3RpdmUgdHJhY2tlciBpcyBjdXJyZW50bHkKKyAqIGFzc2lnbmVkIHRv
IGEgZmVuY2UuIER1ZSB0byB0aGUgbGF6eSByZXRpcmluZywgdGhhdCBmZW5jZSBtYXkgYmUgaWRs
ZQogICogYW5kIHRoaXMgbWF5IHJlcG9ydCBzdGFsZSBpbmZvcm1hdGlvbi4KICAqLwogc3RhdGlj
IGlubGluZSBib29sCi1pOTE1X2FjdGl2ZV9yZXF1ZXN0X2lzc2V0KGNvbnN0IHN0cnVjdCBpOTE1
X2FjdGl2ZV9yZXF1ZXN0ICphY3RpdmUpCitpOTE1X2FjdGl2ZV9mZW5jZV9pc3NldChjb25zdCBz
dHJ1Y3QgaTkxNV9hY3RpdmVfZmVuY2UgKmFjdGl2ZSkKIHsKLQlyZXR1cm4gcmN1X2FjY2Vzc19w
b2ludGVyKGFjdGl2ZS0+cmVxdWVzdCk7CisJcmV0dXJuIHJjdV9hY2Nlc3NfcG9pbnRlcihhY3Rp
dmUtPmZlbmNlKTsKIH0KIAotLyoqCi0gKiBpOTE1X2FjdGl2ZV9yZXF1ZXN0X3JldGlyZSAtIHdh
aXRzIHVudGlsIHRoZSByZXF1ZXN0IGlzIHJldGlyZWQKLSAqIEBhY3RpdmUgLSB0aGUgYWN0aXZl
IHJlcXVlc3Qgb24gd2hpY2ggdG8gd2FpdAotICoKLSAqIGk5MTVfYWN0aXZlX3JlcXVlc3RfcmV0
aXJlKCkgd2FpdHMgdW50aWwgdGhlIHJlcXVlc3QgaXMgY29tcGxldGVkLAotICogYW5kIHRoZW4g
ZW5zdXJlcyB0aGF0IGF0IGxlYXN0IHRoZSByZXRpcmVtZW50IGhhbmRsZXIgZm9yIHRoaXMKLSAq
IEBhY3RpdmUgdHJhY2tlciBpcyBjYWxsZWQgYmVmb3JlIHJldHVybmluZy4gSWYgdGhlIEBhY3Rp
dmUKLSAqIHRyYWNrZXIgaXMgaWRsZSwgdGhlIGZ1bmN0aW9uIHJldHVybnMgaW1tZWRpYXRlbHku
Ci0gKi8KLXN0YXRpYyBpbmxpbmUgaW50IF9fbXVzdF9jaGVjawotaTkxNV9hY3RpdmVfcmVxdWVz
dF9yZXRpcmUoc3RydWN0IGk5MTVfYWN0aXZlX3JlcXVlc3QgKmFjdGl2ZSwKLQkJCSAgIHN0cnVj
dCBtdXRleCAqbXV0ZXgpCitzdGF0aWMgaW5saW5lIHZvaWQKK2k5MTVfYWN0aXZlX2ZlbmNlX2Ni
KHN0cnVjdCBkbWFfZmVuY2UgKmZlbmNlLCBzdHJ1Y3QgZG1hX2ZlbmNlX2NiICpjYikKIHsKLQlz
dHJ1Y3QgaTkxNV9yZXF1ZXN0ICpyZXF1ZXN0OwotCWxvbmcgcmV0OwotCi0JcmVxdWVzdCA9IGk5
MTVfYWN0aXZlX3JlcXVlc3RfcmF3KGFjdGl2ZSwgbXV0ZXgpOwotCWlmICghcmVxdWVzdCkKLQkJ
cmV0dXJuIDA7Ci0KLQlyZXQgPSBpOTE1X3JlcXVlc3Rfd2FpdChyZXF1ZXN0LAotCQkJCUk5MTVf
V0FJVF9JTlRFUlJVUFRJQkxFLAotCQkJCU1BWF9TQ0hFRFVMRV9USU1FT1VUKTsKLQlpZiAocmV0
IDwgMCkKLQkJcmV0dXJuIHJldDsKKwlzdHJ1Y3QgaTkxNV9hY3RpdmVfZmVuY2UgKmFjdGl2ZSA9
CisJCWNvbnRhaW5lcl9vZihjYiwgdHlwZW9mKCphY3RpdmUpLCBjYik7CiAKLQlsaXN0X2RlbF9p
bml0KCZhY3RpdmUtPmxpbmspOwotCVJDVV9JTklUX1BPSU5URVIoYWN0aXZlLT5yZXF1ZXN0LCBO
VUxMKTsKLQotCWFjdGl2ZS0+cmV0aXJlKGFjdGl2ZSwgcmVxdWVzdCk7Ci0KLQlyZXR1cm4gMDsK
KwlSQ1VfSU5JVF9QT0lOVEVSKGFjdGl2ZS0+ZmVuY2UsIE5VTEwpOwogfQogCiAvKgpAQCAtMzU4
LDM2ICsxNjEsMjkgQEAgaTkxNV9hY3RpdmVfcmVxdWVzdF9yZXRpcmUoc3RydWN0IGk5MTVfYWN0
aXZlX3JlcXVlc3QgKmFjdGl2ZSwKICAqIHN5bmNocm9uaXNhdGlvbi4KICAqLwogCi12b2lkIF9f
aTkxNV9hY3RpdmVfaW5pdChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwKLQkJCXN0cnVj
dCBpOTE1X2FjdGl2ZSAqcmVmLAordm9pZCBfX2k5MTVfYWN0aXZlX2luaXQoc3RydWN0IGk5MTVf
YWN0aXZlICpyZWYsCiAJCQlpbnQgKCphY3RpdmUpKHN0cnVjdCBpOTE1X2FjdGl2ZSAqcmVmKSwK
IAkJCXZvaWQgKCpyZXRpcmUpKHN0cnVjdCBpOTE1X2FjdGl2ZSAqcmVmKSwKIAkJCXN0cnVjdCBs
b2NrX2NsYXNzX2tleSAqa2V5KTsKLSNkZWZpbmUgaTkxNV9hY3RpdmVfaW5pdChpOTE1LCByZWYs
IGFjdGl2ZSwgcmV0aXJlKSBkbyB7CQlcCisjZGVmaW5lIGk5MTVfYWN0aXZlX2luaXQocmVmLCBh
Y3RpdmUsIHJldGlyZSkgZG8gewkJXAogCXN0YXRpYyBzdHJ1Y3QgbG9ja19jbGFzc19rZXkgX19r
ZXk7CQkJCVwKIAkJCQkJCQkJCVwKLQlfX2k5MTVfYWN0aXZlX2luaXQoaTkxNSwgcmVmLCBhY3Rp
dmUsIHJldGlyZSwgJl9fa2V5KTsJCVwKKwlfX2k5MTVfYWN0aXZlX2luaXQocmVmLCBhY3RpdmUs
IHJldGlyZSwgJl9fa2V5KTsJCVwKIH0gd2hpbGUgKDApCiAKIGludCBpOTE1X2FjdGl2ZV9yZWYo
c3RydWN0IGk5MTVfYWN0aXZlICpyZWYsCiAJCSAgICBzdHJ1Y3QgaW50ZWxfdGltZWxpbmUgKnRs
LAotCQkgICAgc3RydWN0IGk5MTVfcmVxdWVzdCAqcnEpOworCQkgICAgc3RydWN0IGRtYV9mZW5j
ZSAqZmVuY2UpOwogCiB2b2lkIGk5MTVfYWN0aXZlX3NldF9leGNsdXNpdmUoc3RydWN0IGk5MTVf
YWN0aXZlICpyZWYsIHN0cnVjdCBkbWFfZmVuY2UgKmYpOwogCiBpbnQgaTkxNV9hY3RpdmVfd2Fp
dChzdHJ1Y3QgaTkxNV9hY3RpdmUgKnJlZik7CiAKLWludCBpOTE1X3JlcXVlc3RfYXdhaXRfYWN0
aXZlKHN0cnVjdCBpOTE1X3JlcXVlc3QgKnJxLAotCQkJICAgICAgc3RydWN0IGk5MTVfYWN0aXZl
ICpyZWYpOwotaW50IGk5MTVfcmVxdWVzdF9hd2FpdF9hY3RpdmVfcmVxdWVzdChzdHJ1Y3QgaTkx
NV9yZXF1ZXN0ICpycSwKLQkJCQkgICAgICBzdHJ1Y3QgaTkxNV9hY3RpdmVfcmVxdWVzdCAqYWN0
aXZlKTsKK2ludCBpOTE1X3JlcXVlc3RfYXdhaXRfYWN0aXZlKHN0cnVjdCBpOTE1X3JlcXVlc3Qg
KnJxLCBzdHJ1Y3QgaTkxNV9hY3RpdmUgKnJlZik7CiAKIGludCBpOTE1X2FjdGl2ZV9hY3F1aXJl
KHN0cnVjdCBpOTE1X2FjdGl2ZSAqcmVmKTsKK2Jvb2wgaTkxNV9hY3RpdmVfYWNxdWlyZV9pZl9i
dXN5KHN0cnVjdCBpOTE1X2FjdGl2ZSAqcmVmKTsKIHZvaWQgaTkxNV9hY3RpdmVfcmVsZWFzZShz
dHJ1Y3QgaTkxNV9hY3RpdmUgKnJlZik7Ci12b2lkIF9faTkxNV9hY3RpdmVfcmVsZWFzZV9uZXN0
ZWQoc3RydWN0IGk5MTVfYWN0aXZlICpyZWYsIGludCBzdWJjbGFzcyk7Ci0KLWJvb2wgaTkxNV9h
Y3RpdmVfdHJ5Z3JhYihzdHJ1Y3QgaTkxNV9hY3RpdmUgKnJlZik7Ci12b2lkIGk5MTVfYWN0aXZl
X3VuZ3JhYihzdHJ1Y3QgaTkxNV9hY3RpdmUgKnJlZik7CiAKIHN0YXRpYyBpbmxpbmUgYm9vbAog
aTkxNV9hY3RpdmVfaXNfaWRsZShjb25zdCBzdHJ1Y3QgaTkxNV9hY3RpdmUgKnJlZikKZGlmZiAt
LWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfYWN0aXZlX3R5cGVzLmggYi9kcml2ZXJz
L2dwdS9kcm0vaTkxNS9pOTE1X2FjdGl2ZV90eXBlcy5oCmluZGV4IDAyMTE2N2YwMDA0ZC4uZDg5
YTc0YzE0MmM2IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2FjdGl2ZV90
eXBlcy5oCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfYWN0aXZlX3R5cGVzLmgKQEAg
LTE3LDE3ICsxNyw5IEBACiAKICNpbmNsdWRlICJpOTE1X3V0aWxzLmgiCiAKLXN0cnVjdCBkcm1f
aTkxNV9wcml2YXRlOwotc3RydWN0IGk5MTVfYWN0aXZlX3JlcXVlc3Q7Ci1zdHJ1Y3QgaTkxNV9y
ZXF1ZXN0OwotCi10eXBlZGVmIHZvaWQgKCppOTE1X2FjdGl2ZV9yZXRpcmVfZm4pKHN0cnVjdCBp
OTE1X2FjdGl2ZV9yZXF1ZXN0ICosCi0JCQkJICAgICAgc3RydWN0IGk5MTVfcmVxdWVzdCAqKTsK
LQotc3RydWN0IGk5MTVfYWN0aXZlX3JlcXVlc3QgewotCXN0cnVjdCBpOTE1X3JlcXVlc3QgX19y
Y3UgKnJlcXVlc3Q7Ci0Jc3RydWN0IGxpc3RfaGVhZCBsaW5rOwotCWk5MTVfYWN0aXZlX3JldGly
ZV9mbiByZXRpcmU7CitzdHJ1Y3QgaTkxNV9hY3RpdmVfZmVuY2UgeworCXN0cnVjdCBkbWFfZmVu
Y2UgX19yY3UgKmZlbmNlOworCXN0cnVjdCBkbWFfZmVuY2VfY2IgY2I7CiAjaWYgSVNfRU5BQkxF
RChDT05GSUdfRFJNX0k5MTVfREVCVUdfR0VNKQogCS8qCiAJICogSW5jb3Jwb3JlYWwhCkBAIC01
MywyMCArNDUsMTcgQEAgc3RydWN0IGFjdGl2ZV9ub2RlOwogI2RlZmluZSBpOTE1X2FjdGl2ZV9t
YXlfc2xlZXAoZm4pIHB0cl9wYWNrX2JpdHMoJihmbiksIEk5MTVfQUNUSVZFX01BWV9TTEVFUCwg
MikKIAogc3RydWN0IGk5MTVfYWN0aXZlIHsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkx
NTsKKwlhdG9taWNfdCBjb3VudDsKKwlzdHJ1Y3QgbXV0ZXggbXV0ZXg7CiAKIAlzdHJ1Y3QgYWN0
aXZlX25vZGUgKmNhY2hlOwogCXN0cnVjdCByYl9yb290IHRyZWU7Ci0Jc3RydWN0IG11dGV4IG11
dGV4OwotCWF0b21pY190IGNvdW50OwogCiAJLyogUHJlYWxsb2NhdGVkICJleGNsdXNpdmUiIG5v
ZGUgKi8KLQlzdHJ1Y3QgZG1hX2ZlbmNlIF9fcmN1ICpleGNsOwotCXN0cnVjdCBkbWFfZmVuY2Vf
Y2IgZXhjbF9jYjsKKwlzdHJ1Y3QgaTkxNV9hY3RpdmVfZmVuY2UgZXhjbDsKIAogCXVuc2lnbmVk
IGxvbmcgZmxhZ3M7CiAjZGVmaW5lIEk5MTVfQUNUSVZFX1JFVElSRV9TTEVFUFMgQklUKDApCi0j
ZGVmaW5lIEk5MTVfQUNUSVZFX0dSQUJfQklUIDEKIAogCWludCAoKmFjdGl2ZSkoc3RydWN0IGk5
MTVfYWN0aXZlICpyZWYpOwogCXZvaWQgKCpyZXRpcmUpKHN0cnVjdCBpOTE1X2FjdGl2ZSAqcmVm
KTsKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZ2VtLmMgYi9kcml2ZXJz
L2dwdS9kcm0vaTkxNS9pOTE1X2dlbS5jCmluZGV4IDY2YWJiNDI3YWE0Ny4uZDIxNmRiYzQwNmZk
IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2dlbS5jCisrKyBiL2RyaXZl
cnMvZ3B1L2RybS9pOTE1L2k5MTVfZ2VtLmMKQEAgLTkwMCwyOCArOTAwLDM4IEBAIHdhaXRfZm9y
X3RpbWVsaW5lcyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwKIAogCXNwaW5fbG9ja19p
cnFzYXZlKCZ0aW1lbGluZXMtPmxvY2ssIGZsYWdzKTsKIAlsaXN0X2Zvcl9lYWNoX2VudHJ5KHRs
LCAmdGltZWxpbmVzLT5hY3RpdmVfbGlzdCwgbGluaykgewotCQlzdHJ1Y3QgaTkxNV9yZXF1ZXN0
ICpycTsKKwkJc3RydWN0IGRtYV9mZW5jZSAqZmVuY2U7CiAKLQkJcnEgPSBpOTE1X2FjdGl2ZV9y
ZXF1ZXN0X2dldF91bmxvY2tlZCgmdGwtPmxhc3RfcmVxdWVzdCk7Ci0JCWlmICghcnEpCisJCWZl
bmNlID0gaTkxNV9hY3RpdmVfZmVuY2VfZ2V0KCZ0bC0+bGFzdF9yZXF1ZXN0KTsKKwkJaWYgKCFm
ZW5jZSkKIAkJCWNvbnRpbnVlOwogCiAJCXNwaW5fdW5sb2NrX2lycXJlc3RvcmUoJnRpbWVsaW5l
cy0+bG9jaywgZmxhZ3MpOwogCi0JCS8qCi0JCSAqICJSYWNlLXRvLWlkbGUiLgotCQkgKgotCQkg
KiBTd2l0Y2hpbmcgdG8gdGhlIGtlcm5lbCBjb250ZXh0IGlzIG9mdGVuIHVzZWQgYSBzeW5jaHJv
bm91cwotCQkgKiBzdGVwIHByaW9yIHRvIGlkbGluZywgZS5nLiBpbiBzdXNwZW5kIGZvciBmbHVz
aGluZyBhbGwKLQkJICogY3VycmVudCBvcGVyYXRpb25zIHRvIG1lbW9yeSBiZWZvcmUgc2xlZXBp
bmcuIFRoZXNlIHdlCi0JCSAqIHdhbnQgdG8gY29tcGxldGUgYXMgcXVpY2tseSBhcyBwb3NzaWJs
ZSB0byBhdm9pZCBwcm9sb25nZWQKLQkJICogc3RhbGxzLCBzbyBhbGxvdyB0aGUgZ3B1IHRvIGJv
b3N0IHRvIG1heGltdW0gY2xvY2tzLgotCQkgKi8KLQkJaWYgKHdhaXQgJiBJOTE1X1dBSVRfRk9S
X0lETEVfQk9PU1QpCi0JCQlnZW42X3Jwc19ib29zdChycSk7CisJCWlmICghZG1hX2ZlbmNlX2lz
X2k5MTUoZmVuY2UpKSB7CisJCQl0aW1lb3V0ID0gZG1hX2ZlbmNlX3dhaXRfdGltZW91dChmZW5j
ZSwKKwkJCQkJCQkgZmxhZ3MgJiBJOTE1X1dBSVRfSU5URVJSVVBUSUJMRSwKKwkJCQkJCQkgdGlt
ZW91dCk7CisJCX0gZWxzZSB7CisJCQlzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpycSA9IHRvX3JlcXVl
c3QoZmVuY2UpOworCisJCQkvKgorCQkJICogIlJhY2UtdG8taWRsZSIuCisJCQkgKgorCQkJICog
U3dpdGNoaW5nIHRvIHRoZSBrZXJuZWwgY29udGV4dCBpcyBvZnRlbiB1c2VkIGFzCisJCQkgKiBh
IHN5bmNocm9ub3VzIHN0ZXAgcHJpb3IgdG8gaWRsaW5nLCBlLmcuIGluIHN1c3BlbmQKKwkJCSAq
IGZvciBmbHVzaGluZyBhbGwgY3VycmVudCBvcGVyYXRpb25zIHRvIG1lbW9yeSBiZWZvcmUKKwkJ
CSAqIHNsZWVwaW5nLiBUaGVzZSB3ZSB3YW50IHRvIGNvbXBsZXRlIGFzIHF1aWNrbHkgYXMKKwkJ
CSAqIHBvc3NpYmxlIHRvIGF2b2lkIHByb2xvbmdlZCBzdGFsbHMsIHNvIGFsbG93IHRoZSBncHUK
KwkJCSAqIHRvIGJvb3N0IHRvIG1heGltdW0gY2xvY2tzLgorCQkJICovCisJCQlpZiAoZmxhZ3Mg
JiBJOTE1X1dBSVRfRk9SX0lETEVfQk9PU1QpCisJCQkJZ2VuNl9ycHNfYm9vc3QocnEpOworCisJ
CQl0aW1lb3V0ID0gaTkxNV9yZXF1ZXN0X3dhaXQocnEsIGZsYWdzLCB0aW1lb3V0KTsKKwkJfQog
Ci0JCXRpbWVvdXQgPSBpOTE1X3JlcXVlc3Rfd2FpdChycSwgd2FpdCwgdGltZW91dCk7Ci0JCWk5
MTVfcmVxdWVzdF9wdXQocnEpOworCQlkbWFfZmVuY2VfcHV0KGZlbmNlKTsKIAkJaWYgKHRpbWVv
dXQgPCAwKQogCQkJcmV0dXJuIHRpbWVvdXQ7CiAKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2Ry
bS9pOTE1L2k5MTVfZ2VtX2d0dC5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9nZW1fZ3R0
LmMKaW5kZXggOTFlNGNhODVkOGQ5Li40OTI1ZDc2NGE1MDggMTAwNjQ0Ci0tLSBhL2RyaXZlcnMv
Z3B1L2RybS9pOTE1L2k5MTVfZ2VtX2d0dC5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5
MTVfZ2VtX2d0dC5jCkBAIC0xODU4LDcgKzE4NTgsNiBAQCBzdGF0aWMgY29uc3Qgc3RydWN0IGk5
MTVfdm1hX29wcyBwZF92bWFfb3BzID0gewogCiBzdGF0aWMgc3RydWN0IGk5MTVfdm1hICpwZF92
bWFfY3JlYXRlKHN0cnVjdCBnZW42X3BwZ3R0ICpwcGd0dCwgaW50IHNpemUpCiB7Ci0Jc3RydWN0
IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSBwcGd0dC0+YmFzZS52bS5pOTE1OwogCXN0cnVjdCBp
OTE1X2dndHQgKmdndHQgPSBwcGd0dC0+YmFzZS52bS5ndC0+Z2d0dDsKIAlzdHJ1Y3QgaTkxNV92
bWEgKnZtYTsKIApAQCAtMTg2OSw3ICsxODY4LDcgQEAgc3RhdGljIHN0cnVjdCBpOTE1X3ZtYSAq
cGRfdm1hX2NyZWF0ZShzdHJ1Y3QgZ2VuNl9wcGd0dCAqcHBndHQsIGludCBzaXplKQogCWlmICgh
dm1hKQogCQlyZXR1cm4gRVJSX1BUUigtRU5PTUVNKTsKIAotCWk5MTVfYWN0aXZlX2luaXQoaTkx
NSwgJnZtYS0+YWN0aXZlLCBOVUxMLCBOVUxMKTsKKwlpOTE1X2FjdGl2ZV9pbml0KCZ2bWEtPmFj
dGl2ZSwgTlVMTCwgTlVMTCk7CiAKIAltdXRleF9pbml0KCZ2bWEtPnBhZ2VzX211dGV4KTsKIAl2
bWEtPnZtID0gaTkxNV92bV9nZXQoJmdndHQtPnZtKTsKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1
L2RybS9pOTE1L2k5MTVfZ3B1X2Vycm9yLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2dw
dV9lcnJvci5jCmluZGV4IDNjY2Y3ZmQ5MzA3Zi4uMmMwMDcxZmYyZDJkIDEwMDY0NAotLS0gYS9k
cml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2dwdV9lcnJvci5jCisrKyBiL2RyaXZlcnMvZ3B1L2Ry
bS9pOTE1L2k5MTVfZ3B1X2Vycm9yLmMKQEAgLTEyOTIsNyArMTI5Miw3IEBAIGNhcHR1cmVfdm1h
KHN0cnVjdCBjYXB0dXJlX3ZtYSAqbmV4dCwKIAlpZiAoIWMpCiAJCXJldHVybiBuZXh0OwogCi0J
aWYgKCFpOTE1X2FjdGl2ZV90cnlncmFiKCZ2bWEtPmFjdGl2ZSkpIHsKKwlpZiAoIWk5MTVfYWN0
aXZlX2FjcXVpcmVfaWZfYnVzeSgmdm1hLT5hY3RpdmUpKSB7CiAJCWtmcmVlKGMpOwogCQlyZXR1
cm4gbmV4dDsKIAl9CkBAIC0xNDMyLDcgKzE0MzIsNyBAQCBnZW1fcmVjb3JkX3JpbmdzKHN0cnVj
dCBpOTE1X2dwdV9zdGF0ZSAqZXJyb3IsIHN0cnVjdCBjb21wcmVzcyAqY29tcHJlc3MpCiAJCQkq
dGhpcy0+c2xvdCA9CiAJCQkJaTkxNV9lcnJvcl9vYmplY3RfY3JlYXRlKGk5MTUsIHZtYSwgY29t
cHJlc3MpOwogCi0JCQlpOTE1X2FjdGl2ZV91bmdyYWIoJnZtYS0+YWN0aXZlKTsKKwkJCWk5MTVf
YWN0aXZlX3JlbGVhc2UoJnZtYS0+YWN0aXZlKTsKIAkJCWk5MTVfdm1hX3B1dCh2bWEpOwogCiAJ
CQljYXB0dXJlID0gdGhpcy0+bmV4dDsKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1
L2k5MTVfcmVxdWVzdC5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9yZXF1ZXN0LmMKaW5k
ZXggNzU0YTc4MzY0YTYzLi40ZWNmYWUxNDMyNzYgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2Ry
bS9pOTE1L2k5MTVfcmVxdWVzdC5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfcmVx
dWVzdC5jCkBAIC0xOTcsOSArMTk3LDggQEAgc3RhdGljIHZvaWQgZnJlZV9jYXB0dXJlX2xpc3Qo
c3RydWN0IGk5MTVfcmVxdWVzdCAqcmVxdWVzdCkKIAogc3RhdGljIGJvb2wgaTkxNV9yZXF1ZXN0
X3JldGlyZShzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpycSkKIHsKLQlzdHJ1Y3QgaTkxNV9hY3RpdmVf
cmVxdWVzdCAqYWN0aXZlLCAqbmV4dDsKLQogCWxvY2tkZXBfYXNzZXJ0X2hlbGQoJnJxLT50aW1l
bGluZS0+bXV0ZXgpOworCiAJaWYgKCFpOTE1X3JlcXVlc3RfY29tcGxldGVkKHJxKSkKIAkJcmV0
dXJuIGZhbHNlOwogCkBAIC0yMjMsMzUgKzIyMiw2IEBAIHN0YXRpYyBib29sIGk5MTVfcmVxdWVz
dF9yZXRpcmUoc3RydWN0IGk5MTVfcmVxdWVzdCAqcnEpCiAJR0VNX0JVR19PTighbGlzdF9pc19m
aXJzdCgmcnEtPmxpbmssICZycS0+dGltZWxpbmUtPnJlcXVlc3RzKSk7CiAJcnEtPnJpbmctPmhl
YWQgPSBycS0+cG9zdGZpeDsKIAotCS8qCi0JICogV2FsayB0aHJvdWdoIHRoZSBhY3RpdmUgbGlz
dCwgY2FsbGluZyByZXRpcmUgb24gZWFjaC4gVGhpcyBhbGxvd3MKLQkgKiBvYmplY3RzIHRvIHRy
YWNrIHRoZWlyIEdQVSBhY3Rpdml0eSBhbmQgbWFyayB0aGVtc2VsdmVzIGFzIGlkbGUKLQkgKiB3
aGVuIHRoZWlyICpsYXN0KiBhY3RpdmUgcmVxdWVzdCBpcyBjb21wbGV0ZWQgKHVwZGF0aW5nIHN0
YXRlCi0JICogdHJhY2tpbmcgbGlzdHMgZm9yIGV2aWN0aW9uLCBhY3RpdmUgcmVmZXJlbmNlcyBm
b3IgR0VNLCBldGMpLgotCSAqCi0JICogQXMgdGhlIC0+cmV0aXJlKCkgbWF5IGZyZWUgdGhlIG5v
ZGUsIHdlIGRlY291cGxlIGl0IGZpcnN0IGFuZAotCSAqIHBhc3MgYWxvbmcgdGhlIGF1eGlsaWFy
eSBpbmZvcm1hdGlvbiAodG8gYXZvaWQgZGVyZWZlcmVuY2luZwotCSAqIHRoZSBub2RlIGFmdGVy
IHRoZSBjYWxsYmFjaykuCi0JICovCi0JbGlzdF9mb3JfZWFjaF9lbnRyeV9zYWZlKGFjdGl2ZSwg
bmV4dCwgJnJxLT5hY3RpdmVfbGlzdCwgbGluaykgewotCQkvKgotCQkgKiBJbiBtaWNyb2JlbmNo
bWFya3Mgb3IgZm9jdXNpbmcgdXBvbiB0aW1lIGluc2lkZSB0aGUga2VybmVsLAotCQkgKiB3ZSBt
YXkgc3BlbmQgYW4gaW5vcmRpbmF0ZSBhbW91bnQgb2YgdGltZSBzaW1wbHkgaGFuZGxpbmcKLQkJ
ICogdGhlIHJldGlyZW1lbnQgb2YgcmVxdWVzdHMgYW5kIHByb2Nlc3NpbmcgdGhlaXIgY2FsbGJh
Y2tzLgotCQkgKiBPZiB3aGljaCwgdGhpcyBsb29wIGl0c2VsZiBpcyBwYXJ0aWN1bGFybHkgaG90
IGR1ZSB0byB0aGUKLQkJICogY2FjaGUgbWlzc2VzIHdoZW4ganVtcGluZyBhcm91bmQgdGhlIGxp
c3Qgb2YKLQkJICogaTkxNV9hY3RpdmVfcmVxdWVzdC4gIFNvIHdlIHRyeSB0byBrZWVwIHRoaXMg
bG9vcCBhcwotCQkgKiBzdHJlYW1saW5lZCBhcyBwb3NzaWJsZSBhbmQgYWxzbyBwcmVmZXRjaCB0
aGUgbmV4dAotCQkgKiBpOTE1X2FjdGl2ZV9yZXF1ZXN0IHRvIHRyeSBhbmQgaGlkZSB0aGUgbGlr
ZWx5IGNhY2hlIG1pc3MuCi0JCSAqLwotCQlwcmVmZXRjaHcobmV4dCk7Ci0KLQkJSU5JVF9MSVNU
X0hFQUQoJmFjdGl2ZS0+bGluayk7Ci0JCVJDVV9JTklUX1BPSU5URVIoYWN0aXZlLT5yZXF1ZXN0
LCBOVUxMKTsKLQotCQlhY3RpdmUtPnJldGlyZShhY3RpdmUsIHJxKTsKLQl9Ci0KIAlsb2NhbF9p
cnFfZGlzYWJsZSgpOwogCiAJLyoKQEAgLTY2NCw3ICs2MzQsNiBAQCBfX2k5MTVfcmVxdWVzdF9j
cmVhdGUoc3RydWN0IGludGVsX2NvbnRleHQgKmNlLCBnZnBfdCBnZnApCiAJcnEtPmZsYWdzID0g
MDsKIAlycS0+ZXhlY3V0aW9uX21hc2sgPSBBTExfRU5HSU5FUzsKIAotCUlOSVRfTElTVF9IRUFE
KCZycS0+YWN0aXZlX2xpc3QpOwogCUlOSVRfTElTVF9IRUFEKCZycS0+ZXhlY3V0ZV9jYik7CiAK
IAkvKgpAQCAtNzAzLDcgKzY3Miw2IEBAIF9faTkxNV9yZXF1ZXN0X2NyZWF0ZShzdHJ1Y3QgaW50
ZWxfY29udGV4dCAqY2UsIGdmcF90IGdmcCkKIAljZS0+cmluZy0+ZW1pdCA9IHJxLT5oZWFkOwog
CiAJLyogTWFrZSBzdXJlIHdlIGRpZG4ndCBhZGQgb3Vyc2VsdmVzIHRvIGV4dGVybmFsIHN0YXRl
IGJlZm9yZSBmcmVlaW5nICovCi0JR0VNX0JVR19PTighbGlzdF9lbXB0eSgmcnEtPmFjdGl2ZV9s
aXN0KSk7CiAJR0VNX0JVR19PTighbGlzdF9lbXB0eSgmcnEtPnNjaGVkLnNpZ25hbGVyc19saXN0
KSk7CiAJR0VNX0JVR19PTighbGlzdF9lbXB0eSgmcnEtPnNjaGVkLndhaXRlcnNfbGlzdCkpOwog
CkBAIC0xMDk2LDggKzEwNjQsOCBAQCBfX2k5MTVfcmVxdWVzdF9hZGRfdG9fdGltZWxpbmUoc3Ry
dWN0IGk5MTVfcmVxdWVzdCAqcnEpCiAJICogcHJlY2x1ZGVzIG9wdGltaXNpbmcgdG8gdXNlIHNl
bWFwaG9yZXMgc2VyaWFsaXNhdGlvbiBvZiBhIHNpbmdsZQogCSAqIHRpbWVsaW5lIGFjcm9zcyBl
bmdpbmVzLgogCSAqLwotCXByZXYgPSByY3VfZGVyZWZlcmVuY2VfcHJvdGVjdGVkKHRpbWVsaW5l
LT5sYXN0X3JlcXVlc3QucmVxdWVzdCwKLQkJCQkJIGxvY2tkZXBfaXNfaGVsZCgmdGltZWxpbmUt
Pm11dGV4KSk7CisJcHJldiA9IHRvX3JlcXVlc3QoX19pOTE1X2FjdGl2ZV9mZW5jZV9zZXQoJnRp
bWVsaW5lLT5sYXN0X3JlcXVlc3QsCisJCQkJCQkgICZycS0+ZmVuY2UpKTsKIAlpZiAocHJldiAm
JiAhaTkxNV9yZXF1ZXN0X2NvbXBsZXRlZChwcmV2KSkgewogCQlpZiAoaXNfcG93ZXJfb2ZfMihw
cmV2LT5lbmdpbmUtPm1hc2sgfCBycS0+ZW5naW5lLT5tYXNrKSkKIAkJCWk5MTVfc3dfZmVuY2Vf
YXdhaXRfc3dfZmVuY2UoJnJxLT5zdWJtaXQsCkBAIC0xMTIyLDcgKzEwOTAsNiBAQCBfX2k5MTVf
cmVxdWVzdF9hZGRfdG9fdGltZWxpbmUoc3RydWN0IGk5MTVfcmVxdWVzdCAqcnEpCiAJICogdXMs
IHRoZSB0aW1lbGluZSB3aWxsIGhvbGQgaXRzIHNlcW5vIHdoaWNoIGlzIGxhdGVyIHRoYW4gb3Vy
cy4KIAkgKi8KIAlHRU1fQlVHX09OKHRpbWVsaW5lLT5zZXFubyAhPSBycS0+ZmVuY2Uuc2Vxbm8p
OwotCV9faTkxNV9hY3RpdmVfcmVxdWVzdF9zZXQoJnRpbWVsaW5lLT5sYXN0X3JlcXVlc3QsIHJx
KTsKIAogCXJldHVybiBwcmV2OwogfQpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUv
aTkxNV9yZXF1ZXN0LmggYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3JlcXVlc3QuaAppbmRl
eCA4YWM2ZTEyMjZhNTYuLjMyNTFkMmJkYmVlYSAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJt
L2k5MTUvaTkxNV9yZXF1ZXN0LmgKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9yZXF1
ZXN0LmgKQEAgLTIxMSw3ICsyMTEsNiBAQCBzdHJ1Y3QgaTkxNV9yZXF1ZXN0IHsKIAkgKiBvbiB0
aGUgYWN0aXZlX2xpc3QgKG9mIHRoZWlyIGZpbmFsIHJlcXVlc3QpLgogCSAqLwogCXN0cnVjdCBp
OTE1X2NhcHR1cmVfbGlzdCAqY2FwdHVyZV9saXN0OwotCXN0cnVjdCBsaXN0X2hlYWQgYWN0aXZl
X2xpc3Q7CiAKIAkvKiogVGltZSBhdCB3aGljaCB0aGlzIHJlcXVlc3Qgd2FzIGVtaXR0ZWQsIGlu
IGppZmZpZXMuICovCiAJdW5zaWduZWQgbG9uZyBlbWl0dGVkX2ppZmZpZXM7CmRpZmYgLS1naXQg
YS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3ZtYS5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUv
aTkxNV92bWEuYwppbmRleCAzYjQxM2ZiMTc1MWMuLjE1MGY3OGRjOGI5NSAxMDA2NDQKLS0tIGEv
ZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV92bWEuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkx
NS9pOTE1X3ZtYS5jCkBAIC0xMjAsOCArMTIwLDcgQEAgdm1hX2NyZWF0ZShzdHJ1Y3QgZHJtX2k5
MTVfZ2VtX29iamVjdCAqb2JqLAogCXZtYS0+c2l6ZSA9IG9iai0+YmFzZS5zaXplOwogCXZtYS0+
ZGlzcGxheV9hbGlnbm1lbnQgPSBJOTE1X0dUVF9NSU5fQUxJR05NRU5UOwogCi0JaTkxNV9hY3Rp
dmVfaW5pdCh2bS0+aTkxNSwgJnZtYS0+YWN0aXZlLAotCQkJIF9faTkxNV92bWFfYWN0aXZlLCBf
X2k5MTVfdm1hX3JldGlyZSk7CisJaTkxNV9hY3RpdmVfaW5pdCgmdm1hLT5hY3RpdmUsIF9faTkx
NV92bWFfYWN0aXZlLCBfX2k5MTVfdm1hX3JldGlyZSk7CiAKIAkvKiBEZWNsYXJlIG91cnNlbHZl
cyBzYWZlIGZvciB1c2UgaW5zaWRlIHNocmlua2VycyAqLwogCWlmIChJU19FTkFCTEVEKENPTkZJ
R19MT0NLREVQKSkgewpAQCAtMTEwMSw3ICsxMTAwLDcgQEAgaW50IGk5MTVfdm1hX21vdmVfdG9f
YWN0aXZlKHN0cnVjdCBpOTE1X3ZtYSAqdm1hLAogCSAqIGFkZCB0aGUgYWN0aXZlIHJlZmVyZW5j
ZSBmaXJzdCBhbmQgcXVldWUgZm9yIGl0IHRvIGJlIGRyb3BwZWQKIAkgKiAqbGFzdCouCiAJICov
Ci0JZXJyID0gaTkxNV9hY3RpdmVfcmVmKCZ2bWEtPmFjdGl2ZSwgcnEtPnRpbWVsaW5lLCBycSk7
CisJZXJyID0gaTkxNV9hY3RpdmVfcmVmKCZ2bWEtPmFjdGl2ZSwgcnEtPnRpbWVsaW5lLCAmcnEt
PmZlbmNlKTsKIAlpZiAodW5saWtlbHkoZXJyKSkKIAkJcmV0dXJuIGVycjsKIApAQCAtMTEwOSw3
ICsxMTA4LDcgQEAgaW50IGk5MTVfdm1hX21vdmVfdG9fYWN0aXZlKHN0cnVjdCBpOTE1X3ZtYSAq
dm1hLAogCQlpZiAoaW50ZWxfZnJvbnRidWZmZXJfaW52YWxpZGF0ZShvYmotPmZyb250YnVmZmVy
LCBPUklHSU5fQ1MpKQogCQkJaTkxNV9hY3RpdmVfcmVmKCZvYmotPmZyb250YnVmZmVyLT53cml0
ZSwKIAkJCQkJcnEtPnRpbWVsaW5lLAotCQkJCQlycSk7CisJCQkJCSZycS0+ZmVuY2UpOwogCiAJ
CWRtYV9yZXN2X2FkZF9leGNsX2ZlbmNlKHZtYS0+cmVzdiwgJnJxLT5mZW5jZSk7CiAJCW9iai0+
d3JpdGVfZG9tYWluID0gSTkxNV9HRU1fRE9NQUlOX1JFTkRFUjsKQEAgLTExNDcsNiArMTE0Niw3
IEBAIGludCBpOTE1X3ZtYV91bmJpbmQoc3RydWN0IGk5MTVfdm1hICp2bWEpCiAJaWYgKHJldCkK
IAkJcmV0dXJuIHJldDsKIAorCUdFTV9CVUdfT04oaTkxNV92bWFfaXNfYWN0aXZlKHZtYSkpOwog
CWlmIChpOTE1X3ZtYV9pc19waW5uZWQodm1hKSkgewogCQl2bWFfcHJpbnRfYWxsb2NhdG9yKHZt
YSwgImlzIHBpbm5lZCIpOwogCQlyZXR1cm4gLUVCVVNZOwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9n
cHUvZHJtL2k5MTUvc2VsZnRlc3RzL2k5MTVfYWN0aXZlLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkx
NS9zZWxmdGVzdHMvaTkxNV9hY3RpdmUuYwppbmRleCBkNWFjOTk0NGQwOTMuLmFmNTgyN2FhYzdi
MiAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvc2VsZnRlc3RzL2k5MTVfYWN0aXZl
LmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvc2VsZnRlc3RzL2k5MTVfYWN0aXZlLmMKQEAg
LTY4LDcgKzY4LDcgQEAgc3RhdGljIHN0cnVjdCBsaXZlX2FjdGl2ZSAqX19saXZlX2FsbG9jKHN0
cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KQogCQlyZXR1cm4gTlVMTDsKIAogCWtyZWZfaW5p
dCgmYWN0aXZlLT5yZWYpOwotCWk5MTVfYWN0aXZlX2luaXQoaTkxNSwgJmFjdGl2ZS0+YmFzZSwg
X19saXZlX2FjdGl2ZSwgX19saXZlX3JldGlyZSk7CisJaTkxNV9hY3RpdmVfaW5pdCgmYWN0aXZl
LT5iYXNlLCBfX2xpdmVfYWN0aXZlLCBfX2xpdmVfcmV0aXJlKTsKIAogCXJldHVybiBhY3RpdmU7
CiB9CkBAIC0xMTAsNyArMTEwLDkgQEAgX19saXZlX2FjdGl2ZV9zZXR1cChzdHJ1Y3QgZHJtX2k5
MTVfcHJpdmF0ZSAqaTkxNSkKIAkJCQkJCSAgICAgICBzdWJtaXQsCiAJCQkJCQkgICAgICAgR0ZQ
X0tFUk5FTCk7CiAJCWlmIChlcnIgPj0gMCkKLQkJCWVyciA9IGk5MTVfYWN0aXZlX3JlZigmYWN0
aXZlLT5iYXNlLCBycS0+dGltZWxpbmUsIHJxKTsKKwkJCWVyciA9IGk5MTVfYWN0aXZlX3JlZigm
YWN0aXZlLT5iYXNlLAorCQkJCQkgICAgICBycS0+dGltZWxpbmUsCisJCQkJCSAgICAgICZycS0+
ZmVuY2UpOwogCQlpOTE1X3JlcXVlc3RfYWRkKHJxKTsKIAkJaWYgKGVycikgewogCQkJcHJfZXJy
KCJGYWlsZWQgdG8gdHJhY2sgYWN0aXZlIHJlZiFcbiIpOwpAQCAtMTQ2LDE5ICsxNDgsMTMgQEAg
c3RhdGljIGludCBsaXZlX2FjdGl2ZV93YWl0KHZvaWQgKmFyZykKIHsKIAlzdHJ1Y3QgZHJtX2k5
MTVfcHJpdmF0ZSAqaTkxNSA9IGFyZzsKIAlzdHJ1Y3QgbGl2ZV9hY3RpdmUgKmFjdGl2ZTsKLQlp
bnRlbF93YWtlcmVmX3Qgd2FrZXJlZjsKIAlpbnQgZXJyID0gMDsKIAogCS8qIENoZWNrIHRoYXQg
d2UgZ2V0IGEgY2FsbGJhY2sgd2hlbiByZXF1ZXN0cyByZXRpcmUgdXBvbiB3YWl0aW5nICovCiAK
LQltdXRleF9sb2NrKCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsKLQl3YWtlcmVmID0gaW50ZWxf
cnVudGltZV9wbV9nZXQoJmk5MTUtPnJ1bnRpbWVfcG0pOwotCiAJYWN0aXZlID0gX19saXZlX2Fj
dGl2ZV9zZXR1cChpOTE1KTsKLQlpZiAoSVNfRVJSKGFjdGl2ZSkpIHsKLQkJZXJyID0gUFRSX0VS
UihhY3RpdmUpOwotCQlnb3RvIGVycjsKLQl9CisJaWYgKElTX0VSUihhY3RpdmUpKQorCQlyZXR1
cm4gUFRSX0VSUihhY3RpdmUpOwogCiAJaTkxNV9hY3RpdmVfd2FpdCgmYWN0aXZlLT5iYXNlKTsK
IAlpZiAoIVJFQURfT05DRShhY3RpdmUtPnJldGlyZWQpKSB7CkBAIC0xNjgsMTEgKzE2NCw5IEBA
IHN0YXRpYyBpbnQgbGl2ZV9hY3RpdmVfd2FpdCh2b2lkICphcmcpCiAKIAlfX2xpdmVfcHV0KGFj
dGl2ZSk7CiAKKwltdXRleF9sb2NrKCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsKIAlpZiAoaWd0
X2ZsdXNoX3Rlc3QoaTkxNSwgSTkxNV9XQUlUX0xPQ0tFRCkpCiAJCWVyciA9IC1FSU87Ci0KLWVy
cjoKLQlpbnRlbF9ydW50aW1lX3BtX3B1dCgmaTkxNS0+cnVudGltZV9wbSwgd2FrZXJlZik7CiAJ
bXV0ZXhfdW5sb2NrKCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsKIAogCXJldHVybiBlcnI7CkBA
IC0xODIsMjMgKzE3NiwxOSBAQCBzdGF0aWMgaW50IGxpdmVfYWN0aXZlX3JldGlyZSh2b2lkICph
cmcpCiB7CiAJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSBhcmc7CiAJc3RydWN0IGxp
dmVfYWN0aXZlICphY3RpdmU7Ci0JaW50ZWxfd2FrZXJlZl90IHdha2VyZWY7CiAJaW50IGVyciA9
IDA7CiAKIAkvKiBDaGVjayB0aGF0IHdlIGdldCBhIGNhbGxiYWNrIHdoZW4gcmVxdWVzdHMgYXJl
IGluZGlyZWN0bHkgcmV0aXJlZCAqLwogCi0JbXV0ZXhfbG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9t
dXRleCk7Ci0Jd2FrZXJlZiA9IGludGVsX3J1bnRpbWVfcG1fZ2V0KCZpOTE1LT5ydW50aW1lX3Bt
KTsKLQogCWFjdGl2ZSA9IF9fbGl2ZV9hY3RpdmVfc2V0dXAoaTkxNSk7Ci0JaWYgKElTX0VSUihh
Y3RpdmUpKSB7Ci0JCWVyciA9IFBUUl9FUlIoYWN0aXZlKTsKLQkJZ290byBlcnI7Ci0JfQorCWlm
IChJU19FUlIoYWN0aXZlKSkKKwkJcmV0dXJuIFBUUl9FUlIoYWN0aXZlKTsKIAogCS8qIHdhaXRz
IGZvciAmIHJldGlyZXMgYWxsIHJlcXVlc3RzICovCisJbXV0ZXhfbG9jaygmaTkxNS0+ZHJtLnN0
cnVjdF9tdXRleCk7CiAJaWYgKGlndF9mbHVzaF90ZXN0KGk5MTUsIEk5MTVfV0FJVF9MT0NLRUQp
KQogCQllcnIgPSAtRUlPOworCW11dGV4X3VubG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7
CiAKIAlpZiAoIVJFQURfT05DRShhY3RpdmUtPnJldGlyZWQpKSB7CiAJCXByX2VycigiaTkxNV9h
Y3RpdmUgbm90IHJldGlyZWQgYWZ0ZXIgZmx1c2hpbmchXG4iKTsKQEAgLTIwNywxMCArMTk3LDYg
QEAgc3RhdGljIGludCBsaXZlX2FjdGl2ZV9yZXRpcmUodm9pZCAqYXJnKQogCiAJX19saXZlX3B1
dChhY3RpdmUpOwogCi1lcnI6Ci0JaW50ZWxfcnVudGltZV9wbV9wdXQoJmk5MTUtPnJ1bnRpbWVf
cG0sIHdha2VyZWYpOwotCW11dGV4X3VubG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7Ci0K
IAlyZXR1cm4gZXJyOwogfQogCi0tIAoyLjIzLjAKCl9fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fCkludGVsLWdmeCBtYWlsaW5nIGxpc3QKSW50ZWwtZ2Z4QGxp
c3RzLmZyZWVkZXNrdG9wLm9yZwpodHRwczovL2xpc3RzLmZyZWVkZXNrdG9wLm9yZy9tYWlsbWFu
L2xpc3RpbmZvL2ludGVsLWdmeA==

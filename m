Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id B549CD93F3
	for <lists+intel-gfx@lfdr.de>; Wed, 16 Oct 2019 16:33:00 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 03B616E06B;
	Wed, 16 Oct 2019 14:32:59 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from fireflyinternet.com (mail.fireflyinternet.com [109.228.58.192])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 693986E06B
 for <intel-gfx@lists.freedesktop.org>; Wed, 16 Oct 2019 14:32:57 +0000 (UTC)
X-Default-Received-SPF: pass (skip=forwardok (res=PASS))
 x-ip-name=78.156.65.138; 
Received: from haswell.alporthouse.com (unverified [78.156.65.138]) 
 by fireflyinternet.com (Firefly Internet (M1)) with ESMTP id 18858278-1500050 
 for multiple; Wed, 16 Oct 2019 15:32:36 +0100
From: Chris Wilson <chris@chris-wilson.co.uk>
To: intel-gfx@lists.freedesktop.org
Date: Wed, 16 Oct 2019 15:32:33 +0100
Message-Id: <20191016143234.4075-1-chris@chris-wilson.co.uk>
X-Mailer: git-send-email 2.23.0
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH 1/2] drm/i915: Store i915_ggtt as the
 backpointer on fence registers
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

Tm93IHRoYXQgaTkxNV9nZ3R0IGtub3dzIGV2ZXJ5dGhpbmcgYWJvdXQgaXRzIG93biBwYXRocyB0
byBwZXJmb3JtIG1taW8sCndlIGNhbiB1c2UgdGhhdCBhcyBvdXIgcHJpbWFyeSBiYWNrcG9pbnRl
ciBmb3IgaW5kaXZpZHVhbCBmZW5jZQpyZWdpc3RlcnMuIFRoaXMgcmVkdWNlcyB0aGUgYW1vdW50
IG9mIHBvaW50ZXIgZGFuY2luZyB3ZSBoYXZlIHRvIHBlcmZvcm0Kb24gdGhlIGNvbW1vbiBwYXRo
cywgYnV0IG1vcmUgaW1wb3J0YW50bHkgZmluaXNoZXMgb3VyIGZlbmNlIHJlZ2lzdGVyCmVuY2Fw
c3VsYXRpb24uCgpTaWduZWQtb2ZmLWJ5OiBDaHJpcyBXaWxzb24gPGNocmlzQGNocmlzLXdpbHNv
bi5jby51az4KQ2M6IFR2cnRrbyBVcnN1bGluIDx0dnJ0a28udXJzdWxpbkBpbnRlbC5jb20+CkNj
OiBEYW5pZWxlIENlcmFvbG8gU3B1cmlvIDxkYW5pZWxlLmNlcmFvbG9zcHVyaW9AaW50ZWwuY29t
PgotLS0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX3Jlc2V0LmMgICAgIHwgIDIgKy0K
IGRyaXZlcnMvZ3B1L2RybS9pOTE1L2d2dC9hcGVydHVyZV9nbS5jICAgIHwgIDIgKy0KIGRyaXZl
cnMvZ3B1L2RybS9pOTE1L2k5MTVfZHJ2LmMgICAgICAgICAgIHwgIDYgKy0KIGRyaXZlcnMvZ3B1
L2RybS9pOTE1L2k5MTVfZ2VtLmMgICAgICAgICAgIHwgIDIgKy0KIGRyaXZlcnMvZ3B1L2RybS9p
OTE1L2k5MTVfZ2VtX2ZlbmNlX3JlZy5jIHwgNzQgKysrKysrKysrKysrKystLS0tLS0tLS0KIGRy
aXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZ2VtX2ZlbmNlX3JlZy5oIHwgIDcgKy0tCiBkcml2ZXJz
L2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMvaTkxNV9nZW0uYyB8ICAyICstCiA3IGZpbGVzIGNoYW5n
ZWQsIDU0IGluc2VydGlvbnMoKyksIDQxIGRlbGV0aW9ucygtKQoKZGlmZiAtLWdpdCBhL2RyaXZl
cnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX3Jlc2V0LmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9n
dC9pbnRlbF9yZXNldC5jCmluZGV4IDc3NDQ1ZDEwMGNhOC4uNDc3YmZhZmRiMTAzIDEwMDY0NAot
LS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9yZXNldC5jCisrKyBiL2RyaXZlcnMv
Z3B1L2RybS9pOTE1L2d0L2ludGVsX3Jlc2V0LmMKQEAgLTcxNSw3ICs3MTUsNyBAQCBzdGF0aWMg
aW50IGd0X3Jlc2V0KHN0cnVjdCBpbnRlbF9ndCAqZ3QsIGludGVsX2VuZ2luZV9tYXNrX3Qgc3Rh
bGxlZF9tYXNrKQogCWZvcl9lYWNoX2VuZ2luZShlbmdpbmUsIGd0LT5pOTE1LCBpZCkKIAkJX19p
bnRlbF9lbmdpbmVfcmVzZXQoZW5naW5lLCBzdGFsbGVkX21hc2sgJiBlbmdpbmUtPm1hc2spOwog
Ci0JaTkxNV9nZW1fcmVzdG9yZV9mZW5jZXMoZ3QtPmk5MTUpOworCWk5MTVfZ2VtX3Jlc3RvcmVf
ZmVuY2VzKGd0LT5nZ3R0KTsKIAogCXJldHVybiBlcnI7CiB9CmRpZmYgLS1naXQgYS9kcml2ZXJz
L2dwdS9kcm0vaTkxNS9ndnQvYXBlcnR1cmVfZ20uYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d2
dC9hcGVydHVyZV9nbS5jCmluZGV4IGQ5OTZiYmM3ZWE1OS4uNzcxNDIwNDUzZjgyIDEwMDY0NAot
LS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndnQvYXBlcnR1cmVfZ20uYworKysgYi9kcml2ZXJz
L2dwdS9kcm0vaTkxNS9ndnQvYXBlcnR1cmVfZ20uYwpAQCAtMTk4LDcgKzE5OCw3IEBAIHN0YXRp
YyBpbnQgYWxsb2NfdmdwdV9mZW5jZShzdHJ1Y3QgaW50ZWxfdmdwdSAqdmdwdSkKIAltdXRleF9s
b2NrKCZkZXZfcHJpdi0+Z2d0dC52bS5tdXRleCk7CiAKIAlmb3IgKGkgPSAwOyBpIDwgdmdwdV9m
ZW5jZV9zeih2Z3B1KTsgaSsrKSB7Ci0JCXJlZyA9IGk5MTVfcmVzZXJ2ZV9mZW5jZShkZXZfcHJp
dik7CisJCXJlZyA9IGk5MTVfcmVzZXJ2ZV9mZW5jZSgmZGV2X3ByaXYtPmdndHQpOwogCQlpZiAo
SVNfRVJSKHJlZykpCiAJCQlnb3RvIG91dF9mcmVlX2ZlbmNlOwogCmRpZmYgLS1naXQgYS9kcml2
ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2Rydi5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9k
cnYuYwppbmRleCBmMDJhMzQ3MjIyMTcuLjg3MzYxNTM2YzZmMCAxMDA2NDQKLS0tIGEvZHJpdmVy
cy9ncHUvZHJtL2k5MTUvaTkxNV9kcnYuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1
X2Rydi5jCkBAIC0xODA1LDcgKzE4MDUsNyBAQCBzdGF0aWMgaW50IGk5MTVfZHJtX3Jlc3VtZShz
dHJ1Y3QgZHJtX2RldmljZSAqZGV2KQogCiAJbXV0ZXhfbG9jaygmZGV2X3ByaXYtPmRybS5zdHJ1
Y3RfbXV0ZXgpOwogCWk5MTVfZ2VtX3Jlc3RvcmVfZ3R0X21hcHBpbmdzKGRldl9wcml2KTsKLQlp
OTE1X2dlbV9yZXN0b3JlX2ZlbmNlcyhkZXZfcHJpdik7CisJaTkxNV9nZW1fcmVzdG9yZV9mZW5j
ZXMoJmRldl9wcml2LT5nZ3R0KTsKIAltdXRleF91bmxvY2soJmRldl9wcml2LT5kcm0uc3RydWN0
X211dGV4KTsKIAogCWludGVsX2Nzcl91Y29kZV9yZXN1bWUoZGV2X3ByaXYpOwpAQCAtMjUwNCw3
ICsyNTA0LDcgQEAgc3RhdGljIGludCBpbnRlbF9ydW50aW1lX3N1c3BlbmQoc3RydWN0IGRldmlj
ZSAqa2RldikKIAogCQlpbnRlbF9ndF9ydW50aW1lX3Jlc3VtZSgmZGV2X3ByaXYtPmd0KTsKIAot
CQlpOTE1X2dlbV9yZXN0b3JlX2ZlbmNlcyhkZXZfcHJpdik7CisJCWk5MTVfZ2VtX3Jlc3RvcmVf
ZmVuY2VzKCZkZXZfcHJpdi0+Z2d0dCk7CiAKIAkJZW5hYmxlX3JwbV93YWtlcmVmX2Fzc2VydHMo
cnBtKTsKIApAQCAtMjU4NCw3ICsyNTg0LDcgQEAgc3RhdGljIGludCBpbnRlbF9ydW50aW1lX3Jl
c3VtZShzdHJ1Y3QgZGV2aWNlICprZGV2KQogCSAqIHdlIGNhbiBkbyBpcyB0byBob3BlIHRoYXQg
dGhpbmdzIHdpbGwgc3RpbGwgd29yayAoYW5kIGRpc2FibGUgUlBNKS4KIAkgKi8KIAlpbnRlbF9n
dF9ydW50aW1lX3Jlc3VtZSgmZGV2X3ByaXYtPmd0KTsKLQlpOTE1X2dlbV9yZXN0b3JlX2ZlbmNl
cyhkZXZfcHJpdik7CisJaTkxNV9nZW1fcmVzdG9yZV9mZW5jZXMoJmRldl9wcml2LT5nZ3R0KTsK
IAogCS8qCiAJICogT24gVkxWL0NIViBkaXNwbGF5IGludGVycnVwdHMgYXJlIHBhcnQgb2YgdGhl
IGRpc3BsYXkKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZ2VtLmMgYi9k
cml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2dlbS5jCmluZGV4IDBkZGJkM2E1ZmI4ZC4uMjBjZTY3
OTczYzU5IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2dlbS5jCisrKyBi
L2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZ2VtLmMKQEAgLTEzNjksNyArMTM2OSw3IEBAIGlu
dCBpOTE1X2dlbV9pbml0KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikKIAkJLyog
TWluaW1hbCBiYXNpYyByZWNvdmVyeSBmb3IgS01TICovCiAJCXJldCA9IGk5MTVfZ2d0dF9lbmFi
bGVfaHcoZGV2X3ByaXYpOwogCQlpOTE1X2dlbV9yZXN0b3JlX2d0dF9tYXBwaW5ncyhkZXZfcHJp
dik7Ci0JCWk5MTVfZ2VtX3Jlc3RvcmVfZmVuY2VzKGRldl9wcml2KTsKKwkJaTkxNV9nZW1fcmVz
dG9yZV9mZW5jZXMoJmRldl9wcml2LT5nZ3R0KTsKIAkJaW50ZWxfaW5pdF9jbG9ja19nYXRpbmco
ZGV2X3ByaXYpOwogCX0KIApkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9n
ZW1fZmVuY2VfcmVnLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2dlbV9mZW5jZV9yZWcu
YwppbmRleCA0ODdiNzI2MWY3ZWQuLjgzYjQ1MGQ5Y2U4NCAxMDA2NDQKLS0tIGEvZHJpdmVycy9n
cHUvZHJtL2k5MTUvaTkxNV9nZW1fZmVuY2VfcmVnLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5
MTUvaTkxNV9nZW1fZmVuY2VfcmVnLmMKQEAgLTU5LDYgKzU5LDE2IEBACiAKICNkZWZpbmUgcGlw
ZWxpbmVkIDAKIAorc3RhdGljIHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpmZW5jZV90b19pOTE1
KHN0cnVjdCBpOTE1X2ZlbmNlX3JlZyAqZmVuY2UpCit7CisJcmV0dXJuIGZlbmNlLT5nZ3R0LT52
bS5pOTE1OworfQorCitzdGF0aWMgc3RydWN0IGludGVsX3VuY29yZSAqZmVuY2VfdG9fdW5jb3Jl
KHN0cnVjdCBpOTE1X2ZlbmNlX3JlZyAqZmVuY2UpCit7CisJcmV0dXJuIGZlbmNlLT5nZ3R0LT52
bS5ndC0+dW5jb3JlOworfQorCiBzdGF0aWMgdm9pZCBpOTY1X3dyaXRlX2ZlbmNlX3JlZyhzdHJ1
Y3QgaTkxNV9mZW5jZV9yZWcgKmZlbmNlLAogCQkJCSBzdHJ1Y3QgaTkxNV92bWEgKnZtYSkKIHsK
QEAgLTY2LDcgKzc2LDcgQEAgc3RhdGljIHZvaWQgaTk2NV93cml0ZV9mZW5jZV9yZWcoc3RydWN0
IGk5MTVfZmVuY2VfcmVnICpmZW5jZSwKIAlpbnQgZmVuY2VfcGl0Y2hfc2hpZnQ7CiAJdTY0IHZh
bDsKIAotCWlmIChJTlRFTF9HRU4oZmVuY2UtPmk5MTUpID49IDYpIHsKKwlpZiAoSU5URUxfR0VO
KGZlbmNlX3RvX2k5MTUoZmVuY2UpKSA+PSA2KSB7CiAJCWZlbmNlX3JlZ19sbyA9IEZFTkNFX1JF
R19HRU42X0xPKGZlbmNlLT5pZCk7CiAJCWZlbmNlX3JlZ19oaSA9IEZFTkNFX1JFR19HRU42X0hJ
KGZlbmNlLT5pZCk7CiAJCWZlbmNlX3BpdGNoX3NoaWZ0ID0gR0VONl9GRU5DRV9QSVRDSF9TSElG
VDsKQEAgLTk1LDcgKzEwNSw3IEBAIHN0YXRpYyB2b2lkIGk5NjVfd3JpdGVfZmVuY2VfcmVnKHN0
cnVjdCBpOTE1X2ZlbmNlX3JlZyAqZmVuY2UsCiAJfQogCiAJaWYgKCFwaXBlbGluZWQpIHsKLQkJ
c3RydWN0IGludGVsX3VuY29yZSAqdW5jb3JlID0gJmZlbmNlLT5pOTE1LT51bmNvcmU7CisJCXN0
cnVjdCBpbnRlbF91bmNvcmUgKnVuY29yZSA9IGZlbmNlX3RvX3VuY29yZShmZW5jZSk7CiAKIAkJ
LyoKIAkJICogVG8gdy9hIGluY29oZXJlbmN5IHdpdGggbm9uLWF0b21pYyA2NC1iaXQgcmVnaXN0
ZXIgdXBkYXRlcywKQEAgLTEzMiw3ICsxNDIsNyBAQCBzdGF0aWMgdm9pZCBpOTE1X3dyaXRlX2Zl
bmNlX3JlZyhzdHJ1Y3QgaTkxNV9mZW5jZV9yZWcgKmZlbmNlLAogCQlHRU1fQlVHX09OKCFpc19w
b3dlcl9vZl8yKHZtYS0+ZmVuY2Vfc2l6ZSkpOwogCQlHRU1fQlVHX09OKCFJU19BTElHTkVEKHZt
YS0+bm9kZS5zdGFydCwgdm1hLT5mZW5jZV9zaXplKSk7CiAKLQkJaWYgKGlzX3lfdGlsZWQgJiYg
SEFTXzEyOF9CWVRFX1lfVElMSU5HKGZlbmNlLT5pOTE1KSkKKwkJaWYgKGlzX3lfdGlsZWQgJiYg
SEFTXzEyOF9CWVRFX1lfVElMSU5HKGZlbmNlX3RvX2k5MTUoZmVuY2UpKSkKIAkJCXN0cmlkZSAv
PSAxMjg7CiAJCWVsc2UKIAkJCXN0cmlkZSAvPSA1MTI7CkBAIC0xNDgsNyArMTU4LDcgQEAgc3Rh
dGljIHZvaWQgaTkxNV93cml0ZV9mZW5jZV9yZWcoc3RydWN0IGk5MTVfZmVuY2VfcmVnICpmZW5j
ZSwKIAl9CiAKIAlpZiAoIXBpcGVsaW5lZCkgewotCQlzdHJ1Y3QgaW50ZWxfdW5jb3JlICp1bmNv
cmUgPSAmZmVuY2UtPmk5MTUtPnVuY29yZTsKKwkJc3RydWN0IGludGVsX3VuY29yZSAqdW5jb3Jl
ID0gZmVuY2VfdG9fdW5jb3JlKGZlbmNlKTsKIAkJaTkxNV9yZWdfdCByZWcgPSBGRU5DRV9SRUco
ZmVuY2UtPmlkKTsKIAogCQlpbnRlbF91bmNvcmVfd3JpdGVfZncodW5jb3JlLCByZWcsIHZhbCk7
CkBAIC0xODAsNyArMTkwLDcgQEAgc3RhdGljIHZvaWQgaTgzMF93cml0ZV9mZW5jZV9yZWcoc3Ry
dWN0IGk5MTVfZmVuY2VfcmVnICpmZW5jZSwKIAl9CiAKIAlpZiAoIXBpcGVsaW5lZCkgewotCQlz
dHJ1Y3QgaW50ZWxfdW5jb3JlICp1bmNvcmUgPSAmZmVuY2UtPmk5MTUtPnVuY29yZTsKKwkJc3Ry
dWN0IGludGVsX3VuY29yZSAqdW5jb3JlID0gZmVuY2VfdG9fdW5jb3JlKGZlbmNlKTsKIAkJaTkx
NV9yZWdfdCByZWcgPSBGRU5DRV9SRUcoZmVuY2UtPmlkKTsKIAogCQlpbnRlbF91bmNvcmVfd3Jp
dGVfZncodW5jb3JlLCByZWcsIHZhbCk7CkBAIC0xOTEsMTUgKzIwMSwxNyBAQCBzdGF0aWMgdm9p
ZCBpODMwX3dyaXRlX2ZlbmNlX3JlZyhzdHJ1Y3QgaTkxNV9mZW5jZV9yZWcgKmZlbmNlLAogc3Rh
dGljIHZvaWQgZmVuY2Vfd3JpdGUoc3RydWN0IGk5MTVfZmVuY2VfcmVnICpmZW5jZSwKIAkJCXN0
cnVjdCBpOTE1X3ZtYSAqdm1hKQogeworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0g
ZmVuY2VfdG9faTkxNShmZW5jZSk7CisKIAkvKgogCSAqIFByZXZpb3VzIGFjY2VzcyB0aHJvdWdo
IHRoZSBmZW5jZSByZWdpc3RlciBpcyBtYXJzaGFsbGVkIGJ5CiAJICogdGhlIG1iKCkgaW5zaWRl
IHRoZSBmYXVsdCBoYW5kbGVycyAoaTkxNV9nZW1fcmVsZWFzZV9tbWFwcykKIAkgKiBhbmQgZXhw
bGljaXRseSBtYW5hZ2VkIGZvciBpbnRlcm5hbCB1c2Vycy4KIAkgKi8KIAotCWlmIChJU19HRU4o
ZmVuY2UtPmk5MTUsIDIpKQorCWlmIChJU19HRU4oaTkxNSwgMikpCiAJCWk4MzBfd3JpdGVfZmVu
Y2VfcmVnKGZlbmNlLCB2bWEpOwotCWVsc2UgaWYgKElTX0dFTihmZW5jZS0+aTkxNSwgMykpCisJ
ZWxzZSBpZiAoSVNfR0VOKGk5MTUsIDMpKQogCQlpOTE1X3dyaXRlX2ZlbmNlX3JlZyhmZW5jZSwg
dm1hKTsKIAllbHNlCiAJCWk5NjVfd3JpdGVfZmVuY2VfcmVnKGZlbmNlLCB2bWEpOwpAQCAtMjE1
LDYgKzIyNyw4IEBAIHN0YXRpYyB2b2lkIGZlbmNlX3dyaXRlKHN0cnVjdCBpOTE1X2ZlbmNlX3Jl
ZyAqZmVuY2UsCiBzdGF0aWMgaW50IGZlbmNlX3VwZGF0ZShzdHJ1Y3QgaTkxNV9mZW5jZV9yZWcg
KmZlbmNlLAogCQkJc3RydWN0IGk5MTVfdm1hICp2bWEpCiB7CisJc3RydWN0IGk5MTVfZ2d0dCAq
Z2d0dCA9IGZlbmNlLT5nZ3R0OworCXN0cnVjdCBpbnRlbF91bmNvcmUgKnVuY29yZSA9IGZlbmNl
X3RvX3VuY29yZShmZW5jZSk7CiAJaW50ZWxfd2FrZXJlZl90IHdha2VyZWY7CiAJc3RydWN0IGk5
MTVfdm1hICpvbGQ7CiAJaW50IHJldDsKQEAgLTI1Niw3ICsyNzAsNyBAQCBzdGF0aWMgaW50IGZl
bmNlX3VwZGF0ZShzdHJ1Y3QgaTkxNV9mZW5jZV9yZWcgKmZlbmNlLAogCQkJb2xkLT5mZW5jZSA9
IE5VTEw7CiAJCX0KIAotCQlsaXN0X21vdmUoJmZlbmNlLT5saW5rLCAmZmVuY2UtPmk5MTUtPmdn
dHQuZmVuY2VfbGlzdCk7CisJCWxpc3RfbW92ZSgmZmVuY2UtPmxpbmssICZnZ3R0LT5mZW5jZV9s
aXN0KTsKIAl9CiAKIAkvKgpAQCAtMjY5LDcgKzI4Myw3IEBAIHN0YXRpYyBpbnQgZmVuY2VfdXBk
YXRlKHN0cnVjdCBpOTE1X2ZlbmNlX3JlZyAqZmVuY2UsCiAJICogYmUgY2xlYXJlZCBiZWZvcmUg
d2UgY2FuIHVzZSBhbnkgb3RoZXIgZmVuY2VzIHRvIGVuc3VyZSB0aGF0CiAJICogdGhlIG5ldyBm
ZW5jZXMgZG8gbm90IG92ZXJsYXAgdGhlIGVsaWRlZCBjbGVhcnMsIGNvbmZ1c2luZyBIVy4KIAkg
Ki8KLQl3YWtlcmVmID0gaW50ZWxfcnVudGltZV9wbV9nZXRfaWZfaW5fdXNlKCZmZW5jZS0+aTkx
NS0+cnVudGltZV9wbSk7CisJd2FrZXJlZiA9IGludGVsX3J1bnRpbWVfcG1fZ2V0X2lmX2luX3Vz
ZSh1bmNvcmUtPnJwbSk7CiAJaWYgKCF3YWtlcmVmKSB7CiAJCUdFTV9CVUdfT04odm1hKTsKIAkJ
cmV0dXJuIDA7CkBAIC0yODAsMTAgKzI5NCwxMCBAQCBzdGF0aWMgaW50IGZlbmNlX3VwZGF0ZShz
dHJ1Y3QgaTkxNV9mZW5jZV9yZWcgKmZlbmNlLAogCiAJaWYgKHZtYSkgewogCQl2bWEtPmZlbmNl
ID0gZmVuY2U7Ci0JCWxpc3RfbW92ZV90YWlsKCZmZW5jZS0+bGluaywgJmZlbmNlLT5pOTE1LT5n
Z3R0LmZlbmNlX2xpc3QpOworCQlsaXN0X21vdmVfdGFpbCgmZmVuY2UtPmxpbmssICZnZ3R0LT5m
ZW5jZV9saXN0KTsKIAl9CiAKLQlpbnRlbF9ydW50aW1lX3BtX3B1dCgmZmVuY2UtPmk5MTUtPnJ1
bnRpbWVfcG0sIHdha2VyZWYpOworCWludGVsX3J1bnRpbWVfcG1fcHV0KHVuY29yZS0+cnBtLCB3
YWtlcmVmKTsKIAlyZXR1cm4gMDsKIH0KIApAQCAtMzEyLDExICszMjYsMTEgQEAgaW50IGk5MTVf
dm1hX3Jldm9rZV9mZW5jZShzdHJ1Y3QgaTkxNV92bWEgKnZtYSkKIAlyZXR1cm4gZmVuY2VfdXBk
YXRlKGZlbmNlLCBOVUxMKTsKIH0KIAotc3RhdGljIHN0cnVjdCBpOTE1X2ZlbmNlX3JlZyAqZmVu
Y2VfZmluZChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkKK3N0YXRpYyBzdHJ1Y3QgaTkx
NV9mZW5jZV9yZWcgKmZlbmNlX2ZpbmQoc3RydWN0IGk5MTVfZ2d0dCAqZ2d0dCkKIHsKIAlzdHJ1
Y3QgaTkxNV9mZW5jZV9yZWcgKmZlbmNlOwogCi0JbGlzdF9mb3JfZWFjaF9lbnRyeShmZW5jZSwg
Jmk5MTUtPmdndHQuZmVuY2VfbGlzdCwgbGluaykgeworCWxpc3RfZm9yX2VhY2hfZW50cnkoZmVu
Y2UsICZnZ3R0LT5mZW5jZV9saXN0LCBsaW5rKSB7CiAJCUdFTV9CVUdfT04oZmVuY2UtPnZtYSAm
JiBmZW5jZS0+dm1hLT5mZW5jZSAhPSBmZW5jZSk7CiAKIAkJaWYgKGF0b21pY19yZWFkKCZmZW5j
ZS0+cGluX2NvdW50KSkKQEAgLTMyNiw3ICszNDAsNyBAQCBzdGF0aWMgc3RydWN0IGk5MTVfZmVu
Y2VfcmVnICpmZW5jZV9maW5kKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KQogCX0KIAog
CS8qIFdhaXQgZm9yIGNvbXBsZXRpb24gb2YgcGVuZGluZyBmbGlwcyB3aGljaCBjb25zdW1lIGZl
bmNlcyAqLwotCWlmIChpbnRlbF9oYXNfcGVuZGluZ19mYl91bnBpbihpOTE1KSkKKwlpZiAoaW50
ZWxfaGFzX3BlbmRpbmdfZmJfdW5waW4oZ2d0dC0+dm0uaTkxNSkpCiAJCXJldHVybiBFUlJfUFRS
KC1FQUdBSU4pOwogCiAJcmV0dXJuIEVSUl9QVFIoLUVERUFETEspOwpAQCAtMzUxLDcgKzM2NSw3
IEBAIGludCBfX2k5MTVfdm1hX3Bpbl9mZW5jZShzdHJ1Y3QgaTkxNV92bWEgKnZtYSkKIAkJCXJl
dHVybiAwOwogCQl9CiAJfSBlbHNlIGlmIChzZXQpIHsKLQkJZmVuY2UgPSBmZW5jZV9maW5kKHZt
YS0+dm0tPmk5MTUpOworCQlmZW5jZSA9IGZlbmNlX2ZpbmQoZ2d0dCk7CiAJCWlmIChJU19FUlIo
ZmVuY2UpKQogCQkJcmV0dXJuIFBUUl9FUlIoZmVuY2UpOwogCkBAIC00MDIsNyArNDE2LDcgQEAg
aW50IGk5MTVfdm1hX3Bpbl9mZW5jZShzdHJ1Y3QgaTkxNV92bWEgKnZtYSkKIAkgKiBOb3RlIHRo
YXQgd2UgcmV2b2tlIGZlbmNlcyBvbiBydW50aW1lIHN1c3BlbmQuIFRoZXJlZm9yZSB0aGUgdXNl
cgogCSAqIG11c3Qga2VlcCB0aGUgZGV2aWNlIGF3YWtlIHdoaWxzdCB1c2luZyB0aGUgZmVuY2Uu
CiAJICovCi0JYXNzZXJ0X3JwbV93YWtlbG9ja19oZWxkKCZ2bWEtPnZtLT5pOTE1LT5ydW50aW1l
X3BtKTsKKwlhc3NlcnRfcnBtX3dha2Vsb2NrX2hlbGQodm1hLT52bS0+Z3QtPnVuY29yZS0+cnBt
KTsKIAlHRU1fQlVHX09OKCFpOTE1X3ZtYV9pc19waW5uZWQodm1hKSk7CiAJR0VNX0JVR19PTigh
aTkxNV92bWFfaXNfZ2d0dCh2bWEpKTsKIApAQCAtNDE4LDE0ICs0MzIsMTMgQEAgaW50IGk5MTVf
dm1hX3Bpbl9mZW5jZShzdHJ1Y3QgaTkxNV92bWEgKnZtYSkKIAogLyoqCiAgKiBpOTE1X3Jlc2Vy
dmVfZmVuY2UgLSBSZXNlcnZlIGEgZmVuY2UgZm9yIHZHUFUKLSAqIEBpOTE1OiBpOTE1IGRldmlj
ZSBwcml2YXRlCisgKiBAZ2d0dDogR2xvYmFsIEdUVAogICoKICAqIFRoaXMgZnVuY3Rpb24gd2Fs
a3MgdGhlIGZlbmNlIHJlZ3MgbG9va2luZyBmb3IgYSBmcmVlIG9uZSBhbmQgcmVtb3ZlCiAgKiBp
dCBmcm9tIHRoZSBmZW5jZV9saXN0LiBJdCBpcyB1c2VkIHRvIHJlc2VydmUgZmVuY2UgZm9yIHZH
UFUgdG8gdXNlLgogICovCi1zdHJ1Y3QgaTkxNV9mZW5jZV9yZWcgKmk5MTVfcmVzZXJ2ZV9mZW5j
ZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkKK3N0cnVjdCBpOTE1X2ZlbmNlX3JlZyAq
aTkxNV9yZXNlcnZlX2ZlbmNlKHN0cnVjdCBpOTE1X2dndHQgKmdndHQpCiB7Ci0Jc3RydWN0IGk5
MTVfZ2d0dCAqZ2d0dCA9ICZpOTE1LT5nZ3R0OwogCXN0cnVjdCBpOTE1X2ZlbmNlX3JlZyAqZmVu
Y2U7CiAJaW50IGNvdW50OwogCWludCByZXQ7CkBAIC00MzksNyArNDUyLDcgQEAgc3RydWN0IGk5
MTVfZmVuY2VfcmVnICppOTE1X3Jlc2VydmVfZmVuY2Uoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUg
Kmk5MTUpCiAJaWYgKGNvdW50IDw9IDEpCiAJCXJldHVybiBFUlJfUFRSKC1FTk9TUEMpOwogCi0J
ZmVuY2UgPSBmZW5jZV9maW5kKGk5MTUpOworCWZlbmNlID0gZmVuY2VfZmluZChnZ3R0KTsKIAlp
ZiAoSVNfRVJSKGZlbmNlKSkKIAkJcmV0dXJuIGZlbmNlOwogCkBAIC00NjMsNyArNDc2LDcgQEAg
c3RydWN0IGk5MTVfZmVuY2VfcmVnICppOTE1X3Jlc2VydmVfZmVuY2Uoc3RydWN0IGRybV9pOTE1
X3ByaXZhdGUgKmk5MTUpCiAgKi8KIHZvaWQgaTkxNV91bnJlc2VydmVfZmVuY2Uoc3RydWN0IGk5
MTVfZmVuY2VfcmVnICpmZW5jZSkKIHsKLQlzdHJ1Y3QgaTkxNV9nZ3R0ICpnZ3R0ID0gJmZlbmNl
LT5pOTE1LT5nZ3R0OworCXN0cnVjdCBpOTE1X2dndHQgKmdndHQgPSBmZW5jZS0+Z2d0dDsKIAog
CWxvY2tkZXBfYXNzZXJ0X2hlbGQoJmdndHQtPnZtLm11dGV4KTsKIApAQCAtNDcyLDE5ICs0ODUs
MTkgQEAgdm9pZCBpOTE1X3VucmVzZXJ2ZV9mZW5jZShzdHJ1Y3QgaTkxNV9mZW5jZV9yZWcgKmZl
bmNlKQogCiAvKioKICAqIGk5MTVfZ2VtX3Jlc3RvcmVfZmVuY2VzIC0gcmVzdG9yZSBmZW5jZSBz
dGF0ZQotICogQGk5MTU6IGk5MTUgZGV2aWNlIHByaXZhdGUKKyAqIEBnZ3R0OiBHbG9iYWwgR1RU
CiAgKgogICogUmVzdG9yZSB0aGUgaHcgZmVuY2Ugc3RhdGUgdG8gbWF0Y2ggdGhlIHNvZnR3YXJl
IHRyYWNraW5nIGFnYWluLCB0byBiZSBjYWxsZWQKICAqIGFmdGVyIGEgZ3B1IHJlc2V0IGFuZCBv
biByZXN1bWUuIE5vdGUgdGhhdCBvbiBydW50aW1lIHN1c3BlbmQgd2Ugb25seSBjYW5jZWwKICAq
IHRoZSBmZW5jZXMsIHRvIGJlIHJlYWNxdWlyZWQgYnkgdGhlIHVzZXIgbGF0ZXIuCiAgKi8KLXZv
aWQgaTkxNV9nZW1fcmVzdG9yZV9mZW5jZXMoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUp
Cit2b2lkIGk5MTVfZ2VtX3Jlc3RvcmVfZmVuY2VzKHN0cnVjdCBpOTE1X2dndHQgKmdndHQpCiB7
CiAJaW50IGk7CiAKIAlyY3VfcmVhZF9sb2NrKCk7IC8qIGtlZXAgb2JqIGFsaXZlIGFzIHdlIGRl
cmVmZXJlbmNlICovCi0JZm9yIChpID0gMDsgaSA8IGk5MTUtPmdndHQubnVtX2ZlbmNlczsgaSsr
KSB7Ci0JCXN0cnVjdCBpOTE1X2ZlbmNlX3JlZyAqcmVnID0gJmk5MTUtPmdndHQuZmVuY2VfcmVn
c1tpXTsKKwlmb3IgKGkgPSAwOyBpIDwgZ2d0dC0+bnVtX2ZlbmNlczsgaSsrKSB7CisJCXN0cnVj
dCBpOTE1X2ZlbmNlX3JlZyAqcmVnID0gJmdndHQtPmZlbmNlX3JlZ3NbaV07CiAJCXN0cnVjdCBp
OTE1X3ZtYSAqdm1hID0gUkVBRF9PTkNFKHJlZy0+dm1hKTsKIAogCQlHRU1fQlVHX09OKHZtYSAm
JiB2bWEtPmZlbmNlICE9IHJlZyk7CkBAIC01NTAsNyArNTYzLDcgQEAgdm9pZCBpOTE1X2dlbV9y
ZXN0b3JlX2ZlbmNlcyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkKICAqLwogCiAvKioK
LSAqIGk5MTVfZ2VtX2RldGVjdF9iaXRfNl9zd2l6emxlIC0gZGV0ZWN0IGJpdCA2IHN3aXp6bGlu
ZyBwYXR0ZXJuCisgKiBkZXRlY3RfYml0XzZfc3dpenpsZSAtIGRldGVjdCBiaXQgNiBzd2l6emxp
bmcgcGF0dGVybgogICogQGk5MTU6IGk5MTUgZGV2aWNlIHByaXZhdGUKICAqCiAgKiBEZXRlY3Rz
IGJpdCA2IHN3aXp6bGluZyBvZiBhZGRyZXNzIGxvb2t1cCBiZXR3ZWVuIElHRCBhY2Nlc3MgYW5k
IENQVQpAQCAtODIyLDEyICs4MzUsMTMgQEAgaTkxNV9nZW1fb2JqZWN0X3NhdmVfYml0XzE3X3N3
aXp6bGUoc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iaiwKIHZvaWQgaTkxNV9nZ3R0X2lu
aXRfZmVuY2VzKHN0cnVjdCBpOTE1X2dndHQgKmdndHQpCiB7CiAJc3RydWN0IGRybV9pOTE1X3By
aXZhdGUgKmk5MTUgPSBnZ3R0LT52bS5pOTE1OworCXN0cnVjdCBpbnRlbF91bmNvcmUgKnVuY29y
ZSA9IGdndHQtPnZtLmd0LT51bmNvcmU7CiAJaW50IG51bV9mZW5jZXM7CiAJaW50IGk7CiAKIAlJ
TklUX0xJU1RfSEVBRCgmZ2d0dC0+ZmVuY2VfbGlzdCk7CiAJSU5JVF9MSVNUX0hFQUQoJmdndHQt
PnVzZXJmYXVsdF9saXN0KTsKLQlpbnRlbF93YWtlcmVmX2F1dG9faW5pdCgmZ2d0dC0+dXNlcmZh
dWx0X3dha2VyZWYsICZpOTE1LT5ydW50aW1lX3BtKTsKKwlpbnRlbF93YWtlcmVmX2F1dG9faW5p
dCgmZ2d0dC0+dXNlcmZhdWx0X3dha2VyZWYsIHVuY29yZS0+cnBtKTsKIAogCWRldGVjdF9iaXRf
Nl9zd2l6emxlKGk5MTUpOwogCkBAIC04NDIsMjAgKzg1NiwyMCBAQCB2b2lkIGk5MTVfZ2d0dF9p
bml0X2ZlbmNlcyhzdHJ1Y3QgaTkxNV9nZ3R0ICpnZ3R0KQogCQludW1fZmVuY2VzID0gODsKIAog
CWlmIChpbnRlbF92Z3B1X2FjdGl2ZShpOTE1KSkKLQkJbnVtX2ZlbmNlcyA9IGludGVsX3VuY29y
ZV9yZWFkKCZpOTE1LT51bmNvcmUsCisJCW51bV9mZW5jZXMgPSBpbnRlbF91bmNvcmVfcmVhZCh1
bmNvcmUsCiAJCQkJCSAgICAgICB2Z3RpZl9yZWcoYXZhaWxfcnMuZmVuY2VfbnVtKSk7CiAKIAkv
KiBJbml0aWFsaXplIGZlbmNlIHJlZ2lzdGVycyB0byB6ZXJvICovCiAJZm9yIChpID0gMDsgaSA8
IG51bV9mZW5jZXM7IGkrKykgewogCQlzdHJ1Y3QgaTkxNV9mZW5jZV9yZWcgKmZlbmNlID0gJmdn
dHQtPmZlbmNlX3JlZ3NbaV07CiAKLQkJZmVuY2UtPmk5MTUgPSBpOTE1OworCQlmZW5jZS0+Z2d0
dCA9IGdndHQ7CiAJCWZlbmNlLT5pZCA9IGk7CiAJCWxpc3RfYWRkX3RhaWwoJmZlbmNlLT5saW5r
LCAmZ2d0dC0+ZmVuY2VfbGlzdCk7CiAJfQogCWdndHQtPm51bV9mZW5jZXMgPSBudW1fZmVuY2Vz
OwogCi0JaTkxNV9nZW1fcmVzdG9yZV9mZW5jZXMoaTkxNSk7CisJaTkxNV9nZW1fcmVzdG9yZV9m
ZW5jZXMoZ2d0dCk7CiB9CiAKIHZvaWQgaW50ZWxfZ3RfaW5pdF9zd2l6emxpbmcoc3RydWN0IGlu
dGVsX2d0ICpndCkKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZ2VtX2Zl
bmNlX3JlZy5oIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9nZW1fZmVuY2VfcmVnLmgKaW5k
ZXggOTk4NjZmYjlkOTRmLi43YmQ1MjFjZDdjZDcgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2Ry
bS9pOTE1L2k5MTVfZ2VtX2ZlbmNlX3JlZy5oCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5
MTVfZ2VtX2ZlbmNlX3JlZy5oCkBAIC0yOSw3ICsyOSw2IEBACiAjaW5jbHVkZSA8bGludXgvdHlw
ZXMuaD4KIAogc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3Q7Ci1zdHJ1Y3QgZHJtX2k5MTVfcHJp
dmF0ZTsKIHN0cnVjdCBpOTE1X2dndHQ7CiBzdHJ1Y3QgaTkxNV92bWE7CiBzdHJ1Y3QgaW50ZWxf
Z3Q7CkBAIC0zOSw3ICszOCw3IEBAIHN0cnVjdCBzZ190YWJsZTsKIAogc3RydWN0IGk5MTVfZmVu
Y2VfcmVnIHsKIAlzdHJ1Y3QgbGlzdF9oZWFkIGxpbms7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZh
dGUgKmk5MTU7CisJc3RydWN0IGk5MTVfZ2d0dCAqZ2d0dDsKIAlzdHJ1Y3QgaTkxNV92bWEgKnZt
YTsKIAlhdG9taWNfdCBwaW5fY291bnQ7CiAJaW50IGlkOwpAQCAtNTUsMTAgKzU0LDEwIEBAIHN0
cnVjdCBpOTE1X2ZlbmNlX3JlZyB7CiB9OwogCiAvKiBpOTE1X2dlbV9mZW5jZV9yZWcuYyAqLwot
c3RydWN0IGk5MTVfZmVuY2VfcmVnICppOTE1X3Jlc2VydmVfZmVuY2Uoc3RydWN0IGRybV9pOTE1
X3ByaXZhdGUgKmk5MTUpOworc3RydWN0IGk5MTVfZmVuY2VfcmVnICppOTE1X3Jlc2VydmVfZmVu
Y2Uoc3RydWN0IGk5MTVfZ2d0dCAqZ2d0dCk7CiB2b2lkIGk5MTVfdW5yZXNlcnZlX2ZlbmNlKHN0
cnVjdCBpOTE1X2ZlbmNlX3JlZyAqZmVuY2UpOwogCi12b2lkIGk5MTVfZ2VtX3Jlc3RvcmVfZmVu
Y2VzKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KTsKK3ZvaWQgaTkxNV9nZW1fcmVzdG9y
ZV9mZW5jZXMoc3RydWN0IGk5MTVfZ2d0dCAqZ2d0dCk7CiAKIHZvaWQgaTkxNV9nZW1fb2JqZWN0
X2RvX2JpdF8xN19zd2l6emxlKHN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmosCiAJCQkJ
ICAgICAgIHN0cnVjdCBzZ190YWJsZSAqcGFnZXMpOwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUv
ZHJtL2k5MTUvc2VsZnRlc3RzL2k5MTVfZ2VtLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9zZWxm
dGVzdHMvaTkxNV9nZW0uYwppbmRleCBiZmE0MGE1YjZkOTguLjk3Zjg5Zjc0NGVlMiAxMDA2NDQK
LS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvc2VsZnRlc3RzL2k5MTVfZ2VtLmMKKysrIGIvZHJp
dmVycy9ncHUvZHJtL2k5MTUvc2VsZnRlc3RzL2k5MTVfZ2VtLmMKQEAgLTEyMCw3ICsxMjAsNyBA
QCBzdGF0aWMgdm9pZCBwbV9yZXN1bWUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpCiAJ
CWk5MTVfZ2VtX3Nhbml0aXplKGk5MTUpOwogCiAJCWk5MTVfZ2VtX3Jlc3RvcmVfZ3R0X21hcHBp
bmdzKGk5MTUpOwotCQlpOTE1X2dlbV9yZXN0b3JlX2ZlbmNlcyhpOTE1KTsKKwkJaTkxNV9nZW1f
cmVzdG9yZV9mZW5jZXMoJmk5MTUtPmdndHQpOwogCiAJCWk5MTVfZ2VtX3Jlc3VtZShpOTE1KTsK
IAl9Ci0tIAoyLjIzLjAKCl9fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fCkludGVsLWdmeCBtYWlsaW5nIGxpc3QKSW50ZWwtZ2Z4QGxpc3RzLmZyZWVkZXNrdG9w
Lm9yZwpodHRwczovL2xpc3RzLmZyZWVkZXNrdG9wLm9yZy9tYWlsbWFuL2xpc3RpbmZvL2ludGVs
LWdmeA==

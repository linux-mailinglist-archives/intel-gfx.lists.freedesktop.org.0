Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id A9AAB5BB020
	for <lists+intel-gfx@lfdr.de>; Fri, 16 Sep 2022 17:22:49 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id BC0C910ED6A;
	Fri, 16 Sep 2022 15:22:46 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from mga09.intel.com (mga09.intel.com [134.134.136.24])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 75DB710ED6A
 for <intel-gfx@lists.freedesktop.org>; Fri, 16 Sep 2022 15:22:42 +0000 (UTC)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/simple;
 d=intel.com; i=@intel.com; q=dns/txt; s=Intel;
 t=1663341762; x=1694877762;
 h=date:message-id:from:to:cc:subject:in-reply-to:
 references:mime-version;
 bh=Y9C8dlAYSIIZ7Vb3xiAsLPVGQdlR8A3OW+R1bHFy+8Q=;
 b=b98/NWEcJLdFfN27h/+LKKDyH8s87dTCplfsqGJi4tztCWQ2k4gI5w8k
 WSdSNI6MiVYnPAni9DvZOSNBgUEhQ1DX1+Ti8Zs92CqbxK+t8eCX2aG3z
 g82AKn6Ag8NEwlDs/yY/TKij7ErcexHhyiI3GZZBsv0+pelG3Cj/WjLQA
 58VKGUqUbkzXIzY2tFL9o44CEBn9asbjG9Vb4yCslqLT3viuBWpOeHCh3
 uXXVUaZ4rE19+/IzQGu4Cc7npSBuyE86RFMuoBlNY6SKF8nRFvYhE+SmS
 1qWtDnu74cak7CU/1jfLNGWDVlUGFu7P+jW8nb13LcrJL0E4ToKCVs/nq Q==;
X-IronPort-AV: E=McAfee;i="6500,9779,10472"; a="299835928"
X-IronPort-AV: E=Sophos;i="5.93,320,1654585200"; d="scan'208";a="299835928"
Received: from fmsmga007.fm.intel.com ([10.253.24.52])
 by orsmga102.jf.intel.com with ESMTP/TLS/ECDHE-RSA-AES256-GCM-SHA384;
 16 Sep 2022 08:22:41 -0700
X-IronPort-AV: E=Sophos;i="5.93,320,1654585200"; d="scan'208";a="620120709"
Received: from nudhayak-mobl1.amr.corp.intel.com (HELO adixit-arch.intel.com)
 ([10.212.179.96])
 by fmsmga007-auth.fm.intel.com with ESMTP/TLS/ECDHE-RSA-AES256-GCM-SHA384;
 16 Sep 2022 08:22:41 -0700
Date: Fri, 16 Sep 2022 08:22:40 -0700
Message-ID: <874jx7wdhb.wl-ashutosh.dixit@intel.com>
From: "Dixit, Ashutosh" <ashutosh.dixit@intel.com>
To: Umesh Nerlige Ramappa <umesh.nerlige.ramappa@intel.com>
In-Reply-To: <875yhn526p.wl-ashutosh.dixit@intel.com>
References: <20220823204155.8178-1-umesh.nerlige.ramappa@intel.com>
 <20220823204155.8178-17-umesh.nerlige.ramappa@intel.com>
 <875yhn526p.wl-ashutosh.dixit@intel.com>
User-Agent: Wanderlust/2.15.9 (Almost Unreal) SEMI-EPG/1.14.7 (Harue)
 FLIM-LB/1.14.9 (=?ISO-8859-4?Q?Goj=F2?=) APEL-LB/10.8 EasyPG/1.0.0
 Emacs/28.1 (x86_64-pc-linux-gnu) MULE/6.0 (HANACHIRUSATO)
MIME-Version: 1.0 (generated by SEMI-EPG 1.14.7 - "Harue")
Content-Type: text/plain; charset=US-ASCII
Subject: Re: [Intel-gfx] [PATCH 16/19] drm/i915/perf: Apply Wa_18013179988
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.29
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Cc: intel-gfx@lists.freedesktop.org
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

On Thu, 15 Sep 2022 22:16:30 -0700, Dixit, Ashutosh wrote:
>
> On Tue, 23 Aug 2022 13:41:52 -0700, Umesh Nerlige Ramappa wrote:
> >
>
> Hi Umesh,
>
> > OA reports in the OA buffer contain an OA timestamp field that helps
> > user calculate delta between 2 OA reports. The calculation relies on the
> > CS timestamp frequency to convert the timestamp value to nanoseconds.
> > The CS timestamp frequency is a function of the CTC_SHIFT value in
> > RPM_CONFIG0.
> >
> > In DG2, OA unit assumes that the CTC_SHIFT is 3, instead of using the
> > actual value from RPM_CONFIG0. At the user level, this results in an
> > error in calculating delta between 2 OA reports since the OA timestamp
> > is not shifted in the same manner as CS timestamp.
> >
> > To resolve this, return actual OA timestamp frequency to the user in
> > i915_getparam_ioctl.
>
> Rather than exposing actual OA timestamp frequency to userspace (with the
> corresponding uapi change, specially if it's only DG2 and not all future
> products) questions about a couple of other options:
>
> Option 1. Can we set CTC_SHIFT in RPM_CONFIG0 to 3, so change GT freq to be the
>           same as OA freq :-)
>
>    The HSD seems to mention this:
>    Is setting CTC SHIFT to 0b11 on driver init an acceptable W/A?
>    Note: Changing the shift setting on live driver may break apps that are
>    currently running (including desktop manager).
>
> Option 2. Is it possible to correct the timestamps in OA report headers to
>           compensate for the difference between OA and GT frequencies (say when
>           copying OA data to userspace)?
>
>	  Though not sure if this is preferable to having userspace do this.

Also do we need input from userland on this patch? UMD's might need to
assess the impact of having different GT and OA frequencies at their end
since they consume OA data?

Thanks.
--
Ashutosh

Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id B92C97AA11
	for <lists+intel-gfx@lfdr.de>; Tue, 30 Jul 2019 15:48:33 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id C24436E514;
	Tue, 30 Jul 2019 13:48:31 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from fireflyinternet.com (mail.fireflyinternet.com [109.228.58.192])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 0284B6E514
 for <intel-gfx@lists.freedesktop.org>; Tue, 30 Jul 2019 13:48:29 +0000 (UTC)
X-Default-Received-SPF: pass (skip=forwardok (res=PASS))
 x-ip-name=78.156.65.138; 
Received: from haswell.alporthouse.com (unverified [78.156.65.138]) 
 by fireflyinternet.com (Firefly Internet (M1)) with ESMTP id 17730651-1500050 
 for multiple; Tue, 30 Jul 2019 14:30:40 +0100
From: Chris Wilson <chris@chris-wilson.co.uk>
To: intel-gfx@lists.freedesktop.org
Date: Tue, 30 Jul 2019 14:30:34 +0100
Message-Id: <20190730133035.1977-17-chris@chris-wilson.co.uk>
X-Mailer: git-send-email 2.22.0
In-Reply-To: <20190730133035.1977-1-chris@chris-wilson.co.uk>
References: <20190730133035.1977-1-chris@chris-wilson.co.uk>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH 16/17] drm/i915: Make debugfs/per_file_stats
 scale better
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

Q3VycmVudGx5IHdlIHdhbGsgdGhlIGVudGlyZSBsaXN0IG9mIG9iai0+dm1hIGZvciBlYWNoIG9i
aiB3aXRoaW4gYSBmaWxlCnRvIGZpbmQgdGhlIG1hdGNoaW5nIHZtYSBvZiB0aGlzIGNvbnRleHQu
IFNpbmNlIHdlIGtub3cgd2UgYXJlIHNlYXJjaGluZwpmb3IgYSBwYXJ0aWN1bGFyIHZtYSBib3Vu
ZCB0byBhIHVzZXIgY29udGV4dCwgd2UgY2FuIHVzZSB0aGUgcmJ0cmVlIHRvCnNlYXJjaCBmb3Ig
aXQgcmF0aGVyIHRoYW4gcmVwZWF0ZWRseSB3YWxrIGV2ZXJ5dGhpbmcuCgpTaWduZWQtb2ZmLWJ5
OiBDaHJpcyBXaWxzb24gPGNocmlzQGNocmlzLXdpbHNvbi5jby51az4KLS0tCiBkcml2ZXJzL2dw
dS9kcm0vaTkxNS9pOTE1X2RlYnVnZnMuYyB8IDU4ICsrKysrKysrKysrKysrKysrKy0tLS0tLS0t
LS0tCiAxIGZpbGUgY2hhbmdlZCwgMzcgaW5zZXJ0aW9ucygrKSwgMjEgZGVsZXRpb25zKC0pCgpk
aWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9kZWJ1Z2ZzLmMgYi9kcml2ZXJz
L2dwdS9kcm0vaTkxNS9pOTE1X2RlYnVnZnMuYwppbmRleCA5ZWUwYjFmNmViMjYuLjY0MTJlOWNh
NGMxNyAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9kZWJ1Z2ZzLmMKKysr
IGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9kZWJ1Z2ZzLmMKQEAgLTIzOCw3ICsyMzgsNiBA
QCBzdHJ1Y3QgZmlsZV9zdGF0cyB7CiAJc3RydWN0IGk5MTVfYWRkcmVzc19zcGFjZSAqdm07CiAJ
dW5zaWduZWQgbG9uZyBjb3VudDsKIAl1NjQgdG90YWwsIHVuYm91bmQ7Ci0JdTY0IGdsb2JhbCwg
c2hhcmVkOwogCXU2NCBhY3RpdmUsIGluYWN0aXZlOwogCXU2NCBjbG9zZWQ7CiB9OwpAQCAtMjU1
LDI3ICsyNTQsNDYgQEAgc3RhdGljIGludCBwZXJfZmlsZV9zdGF0cyhpbnQgaWQsIHZvaWQgKnB0
ciwgdm9pZCAqZGF0YSkKIAlzdGF0cy0+dG90YWwgKz0gb2JqLT5iYXNlLnNpemU7CiAJaWYgKCFh
dG9taWNfcmVhZCgmb2JqLT5iaW5kX2NvdW50KSkKIAkJc3RhdHMtPnVuYm91bmQgKz0gb2JqLT5i
YXNlLnNpemU7Ci0JaWYgKG9iai0+YmFzZS5uYW1lIHx8IG9iai0+YmFzZS5kbWFfYnVmKQotCQlz
dGF0cy0+c2hhcmVkICs9IG9iai0+YmFzZS5zaXplOwogCi0JbGlzdF9mb3JfZWFjaF9lbnRyeSh2
bWEsICZvYmotPnZtYS5saXN0LCBvYmpfbGluaykgewotCQlpZiAoIWRybV9tbV9ub2RlX2FsbG9j
YXRlZCgmdm1hLT5ub2RlKSkKLQkJCWNvbnRpbnVlOwotCi0JCWlmIChpOTE1X3ZtYV9pc19nZ3R0
KHZtYSkpIHsKLQkJCXN0YXRzLT5nbG9iYWwgKz0gdm1hLT5ub2RlLnNpemU7Ci0JCX0gZWxzZSB7
Ci0JCQlpZiAodm1hLT52bSAhPSBzdGF0cy0+dm0pCisJc3Bpbl9sb2NrKCZvYmotPnZtYS5sb2Nr
KTsKKwlpZiAoIXN0YXRzLT52bSkgeworCQlmb3JfZWFjaF9nZ3R0X3ZtYSh2bWEsIG9iaikgewor
CQkJaWYgKCFkcm1fbW1fbm9kZV9hbGxvY2F0ZWQoJnZtYS0+bm9kZSkpCiAJCQkJY29udGludWU7
Ci0JCX0KIAotCQlpZiAoaTkxNV92bWFfaXNfYWN0aXZlKHZtYSkpCi0JCQlzdGF0cy0+YWN0aXZl
ICs9IHZtYS0+bm9kZS5zaXplOwotCQllbHNlCi0JCQlzdGF0cy0+aW5hY3RpdmUgKz0gdm1hLT5u
b2RlLnNpemU7CisJCQlpZiAoaTkxNV92bWFfaXNfYWN0aXZlKHZtYSkpCisJCQkJc3RhdHMtPmFj
dGl2ZSArPSB2bWEtPm5vZGUuc2l6ZTsKKwkJCWVsc2UKKwkJCQlzdGF0cy0+aW5hY3RpdmUgKz0g
dm1hLT5ub2RlLnNpemU7CiAKLQkJaWYgKGk5MTVfdm1hX2lzX2Nsb3NlZCh2bWEpKQotCQkJc3Rh
dHMtPmNsb3NlZCArPSB2bWEtPm5vZGUuc2l6ZTsKKwkJCWlmIChpOTE1X3ZtYV9pc19jbG9zZWQo
dm1hKSkKKwkJCQlzdGF0cy0+Y2xvc2VkICs9IHZtYS0+bm9kZS5zaXplOworCQl9CisJfSBlbHNl
IHsKKwkJc3RydWN0IHJiX25vZGUgKnAgPSBvYmotPnZtYS50cmVlLnJiX25vZGU7CisKKwkJd2hp
bGUgKHApIHsKKwkJCWxvbmcgY21wOworCisJCQl2bWEgPSByYl9lbnRyeShwLCB0eXBlb2YoKnZt
YSksIG9ial9ub2RlKTsKKwkJCWNtcCA9IGk5MTVfdm1hX2NvbXBhcmUodm1hLCBzdGF0cy0+dm0s
IE5VTEwpOworCQkJaWYgKGNtcCA9PSAwKSB7CisJCQkJaWYgKGRybV9tbV9ub2RlX2FsbG9jYXRl
ZCgmdm1hLT5ub2RlKSkgeworCQkJCQlpZiAoaTkxNV92bWFfaXNfYWN0aXZlKHZtYSkpCisJCQkJ
CQlzdGF0cy0+YWN0aXZlICs9IHZtYS0+bm9kZS5zaXplOworCQkJCQllbHNlCisJCQkJCQlzdGF0
cy0+aW5hY3RpdmUgKz0gdm1hLT5ub2RlLnNpemU7CisKKwkJCQkJaWYgKGk5MTVfdm1hX2lzX2Ns
b3NlZCh2bWEpKQorCQkJCQkJc3RhdHMtPmNsb3NlZCArPSB2bWEtPm5vZGUuc2l6ZTsKKwkJCQl9
CisJCQkJYnJlYWs7CisJCQl9CisJCQlpZiAoY21wIDwgMCkKKwkJCQlwID0gcC0+cmJfcmlnaHQ7
CisJCQllbHNlCisJCQkJcCA9IHAtPnJiX2xlZnQ7CisJCX0KIAl9CiAKIAlyZXR1cm4gMDsKQEAg
LTI4MywxNCArMzAxLDEyIEBAIHN0YXRpYyBpbnQgcGVyX2ZpbGVfc3RhdHMoaW50IGlkLCB2b2lk
ICpwdHIsIHZvaWQgKmRhdGEpCiAKICNkZWZpbmUgcHJpbnRfZmlsZV9zdGF0cyhtLCBuYW1lLCBz
dGF0cykgZG8geyBcCiAJaWYgKHN0YXRzLmNvdW50KSBcCi0JCXNlcV9wcmludGYobSwgIiVzOiAl
bHUgb2JqZWN0cywgJWxsdSBieXRlcyAoJWxsdSBhY3RpdmUsICVsbHUgaW5hY3RpdmUsICVsbHUg
Z2xvYmFsLCAlbGx1IHNoYXJlZCwgJWxsdSB1bmJvdW5kLCAlbGx1IGNsb3NlZClcbiIsIFwKKwkJ
c2VxX3ByaW50ZihtLCAiJXM6ICVsdSBvYmplY3RzLCAlbGx1IGJ5dGVzICglbGx1IGFjdGl2ZSwg
JWxsdSBpbmFjdGl2ZSwgJWxsdSB1bmJvdW5kLCAlbGx1IGNsb3NlZClcbiIsIFwKIAkJCSAgIG5h
bWUsIFwKIAkJCSAgIHN0YXRzLmNvdW50LCBcCiAJCQkgICBzdGF0cy50b3RhbCwgXAogCQkJICAg
c3RhdHMuYWN0aXZlLCBcCiAJCQkgICBzdGF0cy5pbmFjdGl2ZSwgXAotCQkJICAgc3RhdHMuZ2xv
YmFsLCBcCi0JCQkgICBzdGF0cy5zaGFyZWQsIFwKIAkJCSAgIHN0YXRzLnVuYm91bmQsIFwKIAkJ
CSAgIHN0YXRzLmNsb3NlZCk7IFwKIH0gd2hpbGUgKDApCi0tIAoyLjIyLjAKCl9fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fCkludGVsLWdmeCBtYWlsaW5nIGxp
c3QKSW50ZWwtZ2Z4QGxpc3RzLmZyZWVkZXNrdG9wLm9yZwpodHRwczovL2xpc3RzLmZyZWVkZXNr
dG9wLm9yZy9tYWlsbWFuL2xpc3RpbmZvL2ludGVsLWdmeA==

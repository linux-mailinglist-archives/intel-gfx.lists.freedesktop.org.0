Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 9FF2021B45F
	for <lists+intel-gfx@lfdr.de>; Fri, 10 Jul 2020 13:59:09 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 291396EBE5;
	Fri, 10 Jul 2020 11:59:08 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from mga09.intel.com (mga09.intel.com [134.134.136.24])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 7D0366EBE5
 for <intel-gfx@lists.freedesktop.org>; Fri, 10 Jul 2020 11:59:06 +0000 (UTC)
IronPort-SDR: u6DsFCf2xjPt2r+JwIX0BI6E/eDA1FGcJ4q5AI+eR6clF5Isns1Nt1AhE1OvTsMowuGb3aydxn
 CkyBWAl++pBA==
X-IronPort-AV: E=McAfee;i="6000,8403,9677"; a="149653630"
X-IronPort-AV: E=Sophos;i="5.75,335,1589266800"; d="scan'208";a="149653630"
X-Amp-Result: SKIPPED(no attachment in message)
X-Amp-File-Uploaded: False
Received: from orsmga005.jf.intel.com ([10.7.209.41])
 by orsmga102.jf.intel.com with ESMTP/TLS/ECDHE-RSA-AES256-GCM-SHA384;
 10 Jul 2020 04:59:06 -0700
IronPort-SDR: RSShFShu4VtABTfh0ywaYz7aa8vZ/8EA8Yhi2Lr33uyIRefzTyQLdlq9cC74RYLLd+ezNK3Vbv
 mW1YVFFtyUTA==
X-IronPort-AV: E=Sophos;i="5.75,335,1589266800"; d="scan'208";a="458257323"
Received: from nmartino-mobl1.ger.corp.intel.com (HELO
 mwahaha-bdw.ger.corp.intel.com) ([10.255.207.224])
 by orsmga005-auth.jf.intel.com with ESMTP/TLS/ECDHE-RSA-AES256-GCM-SHA384;
 10 Jul 2020 04:59:03 -0700
From: Matthew Auld <matthew.auld@intel.com>
To: intel-gfx@lists.freedesktop.org
Date: Fri, 10 Jul 2020 12:57:01 +0100
Message-Id: <20200710115757.290984-5-matthew.auld@intel.com>
X-Mailer: git-send-email 2.26.2
In-Reply-To: <20200710115757.290984-1-matthew.auld@intel.com>
References: <20200710115757.290984-1-matthew.auld@intel.com>
MIME-Version: 1.0
Subject: [Intel-gfx] [RFC 04/60] drm/i915/dg1: add support for the master
 unit interrupt
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.29
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Cc: Lucas De Marchi <lucas.demarchi@intel.com>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

RnJvbTogTHVjYXMgRGUgTWFyY2hpIDxsdWNhcy5kZW1hcmNoaUBpbnRlbC5jb20+CgpERzEgaGFz
IG1hc3RlciB1bml0IGludGVycnVwdCByZWdpc3RlciB3aGljaCBpcyB1c2VkIHRvIGluZGljYXRl
IHRoZQpjb3JyZWN0IHNvdXJjZSBvZiBpbnRlcnJ1cHQuCgp2MjogZml4IGNvZGluZyBzdHlsZSBv
biByZWdpc3RlciBkZWZpbml0aW9uCgpDYzogUmFkaGFrcmlzaG5hIFNyaXBhZGEgPHJhZGhha3Jp
c2huYS5zcmlwYWRhQGludGVsLmNvbT4KQ2M6IERhbmllbGUgU3B1cmlvIENlcmFvbG8gPGRhbmll
bGUuY2VyYW9sb3NwdXJpb0BpbnRlbC5jb20+CkNjOiBNYXR0IFJvcGVyIDxtYXR0aGV3LmQucm9w
ZXJAaW50ZWwuY29tPgpTaWduZWQtb2ZmLWJ5OiBMdWNhcyBEZSBNYXJjaGkgPGx1Y2FzLmRlbWFy
Y2hpQGludGVsLmNvbT4KUmV2aWV3ZWQtYnk6IEpvc8OpIFJvYmVydG8gZGUgU291emEgPGpvc2Uu
c291emFAaW50ZWwuY29tPgotLS0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZGVidWdmcy5j
IHwgIDQgKysrCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2lycS5jICAgICB8IDU2ICsrKysr
KysrKysrKysrKysrKysrKysrKysrKy0tCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3JlZy5o
ICAgICB8ICA0ICsrKwogMyBmaWxlcyBjaGFuZ2VkLCA2MSBpbnNlcnRpb25zKCspLCAzIGRlbGV0
aW9ucygtKQoKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZGVidWdmcy5j
IGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9kZWJ1Z2ZzLmMKaW5kZXggNzhlYmVkZTUxZmIz
Li43ODQyMTk5NjIxOTMgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZGVi
dWdmcy5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZGVidWdmcy5jCkBAIC00OTUs
NiArNDk1LDEwIEBAIHN0YXRpYyBpbnQgaTkxNV9pbnRlcnJ1cHRfaW5mbyhzdHJ1Y3Qgc2VxX2Zp
bGUgKm0sIHZvaWQgKmRhdGEpCiAJCXNlcV9wcmludGYobSwgIlBDVSBpbnRlcnJ1cHQgZW5hYmxl
Olx0JTA4eFxuIiwKIAkJCSAgIEk5MTVfUkVBRChHRU44X1BDVV9JRVIpKTsKIAl9IGVsc2UgaWYg
KElOVEVMX0dFTihkZXZfcHJpdikgPj0gMTEpIHsKKwkJaWYgKEhBU19NQVNURVJfVU5JVF9JUlEo
ZGV2X3ByaXYpKQorCQkJc2VxX3ByaW50ZihtLCAiTWFzdGVyIFVuaXQgSW50ZXJydXB0IENvbnRy
b2w6ICAlMDh4XG4iLAorCQkJCSAgIEk5MTVfUkVBRChERzFfTVNUUl9VTklUX0lOVFIpKTsKKwog
CQlzZXFfcHJpbnRmKG0sICJNYXN0ZXIgSW50ZXJydXB0IENvbnRyb2w6ICAlMDh4XG4iLAogCQkJ
ICAgSTkxNV9SRUFEKEdFTjExX0dGWF9NU1RSX0lSUSkpOwogCmRpZmYgLS1naXQgYS9kcml2ZXJz
L2dwdS9kcm0vaTkxNS9pOTE1X2lycS5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9pcnEu
YwppbmRleCA1NjJiNDNlZDA3N2YuLjRjOWQwYTRhMjQ3NiAxMDA2NDQKLS0tIGEvZHJpdmVycy9n
cHUvZHJtL2k5MTUvaTkxNV9pcnEuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2ly
cS5jCkBAIC0yNTg0LDYgKzI1ODQsNDYgQEAgc3RhdGljIGlycXJldHVybl90IGdlbjExX2lycV9o
YW5kbGVyKGludCBpcnEsIHZvaWQgKmFyZykKIAkJCQkgICBnZW4xMV9tYXN0ZXJfaW50cl9lbmFi
bGUpOwogfQogCitzdGF0aWMgdTMyIGRnMV9tYXN0ZXJfaW50cl9kaXNhYmxlX2FuZF9hY2sodm9p
ZCBfX2lvbWVtICogY29uc3QgcmVncykKK3sKKwl1MzIgdmFsOworCisJLyogRmlyc3QgZGlzYWJs
ZSBpbnRlcnJ1cHRzICovCisJcmF3X3JlZ193cml0ZShyZWdzLCBERzFfTVNUUl9VTklUX0lOVFIs
IDApOworCisJLyogR2V0IHRoZSBpbmRpY2F0aW9uIGxldmVscyBhbmQgYWNrIHRoZSBtYXN0ZXIg
dW5pdCAqLworCXZhbCA9IHJhd19yZWdfcmVhZChyZWdzLCBERzFfTVNUUl9VTklUX0lOVFIpOwor
CWlmICh1bmxpa2VseSghdmFsKSkKKwkJcmV0dXJuIDA7CisKKwlyYXdfcmVnX3dyaXRlKHJlZ3Ms
IERHMV9NU1RSX1VOSVRfSU5UUiwgdmFsKTsKKworCS8qCisJICogTm93IHdpdGggbWFzdGVyIGRp
c2FibGVkLCBnZXQgYSBzYW1wbGUgb2YgbGV2ZWwgaW5kaWNhdGlvbnMKKwkgKiBmb3IgdGhpcyBp
bnRlcnJ1cHQgYW5kIGFjayB0aGVtIHJpZ2h0IGF3YXkgLSB3ZSBrZWVwIEdFTjExX01BU1RFUl9J
UlEKKwkgKiBvdXQgYXMgdGhpcyBiaXQgZG9lc24ndCBleGlzdCBhbnltb3JlIGZvciBERzEKKwkg
Ki8KKwl2YWwgPSByYXdfcmVnX3JlYWQocmVncywgR0VOMTFfR0ZYX01TVFJfSVJRKSAmIH5HRU4x
MV9NQVNURVJfSVJROworCWlmICh1bmxpa2VseSghdmFsKSkKKwkJcmV0dXJuIDA7CisKKwlyYXdf
cmVnX3dyaXRlKHJlZ3MsIEdFTjExX0dGWF9NU1RSX0lSUSwgdmFsKTsKKworCXJldHVybiB2YWw7
Cit9CisKK3N0YXRpYyBpbmxpbmUgdm9pZCBkZzFfbWFzdGVyX2ludHJfZW5hYmxlKHZvaWQgX19p
b21lbSAqIGNvbnN0IHJlZ3MpCit7CisJcmF3X3JlZ193cml0ZShyZWdzLCBERzFfTVNUUl9VTklU
X0lOVFIsIERHMV9NU1RSX0lSUSk7Cit9CisKK3N0YXRpYyBpcnFyZXR1cm5fdCBkZzFfaXJxX2hh
bmRsZXIoaW50IGlycSwgdm9pZCAqYXJnKQoreworCXJldHVybiBfX2dlbjExX2lycV9oYW5kbGVy
KGFyZywKKwkJCQkgICBkZzFfbWFzdGVyX2ludHJfZGlzYWJsZV9hbmRfYWNrLAorCQkJCSAgIGRn
MV9tYXN0ZXJfaW50cl9lbmFibGUpOworfQorCiAvKiBDYWxsZWQgZnJvbSBkcm0gZ2VuZXJpYyBj
b2RlLCBwYXNzZWQgJ2NydGMnIHdoaWNoCiAgKiB3ZSB1c2UgYXMgYSBwaXBlIGluZGV4CiAgKi8K
QEAgLTI5MjAsNyArMjk2MCwxMCBAQCBzdGF0aWMgdm9pZCBnZW4xMV9pcnFfcmVzZXQoc3RydWN0
IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQogewogCXN0cnVjdCBpbnRlbF91bmNvcmUgKnVu
Y29yZSA9ICZkZXZfcHJpdi0+dW5jb3JlOwogCi0JZ2VuMTFfbWFzdGVyX2ludHJfZGlzYWJsZShk
ZXZfcHJpdi0+dW5jb3JlLnJlZ3MpOworCWlmIChIQVNfTUFTVEVSX1VOSVRfSVJRKGRldl9wcml2
KSkKKwkJZGcxX21hc3Rlcl9pbnRyX2Rpc2FibGVfYW5kX2FjayhkZXZfcHJpdi0+dW5jb3JlLnJl
Z3MpOworCWVsc2UKKwkJZ2VuMTFfbWFzdGVyX2ludHJfZGlzYWJsZShkZXZfcHJpdi0+dW5jb3Jl
LnJlZ3MpOwogCiAJZ2VuMTFfZ3RfaXJxX3Jlc2V0KCZkZXZfcHJpdi0+Z3QpOwogCWdlbjExX2Rp
c3BsYXlfaXJxX3Jlc2V0KGRldl9wcml2KTsKQEAgLTM1MTcsOCArMzU2MCwxMyBAQCBzdGF0aWMg
dm9pZCBnZW4xMV9pcnFfcG9zdGluc3RhbGwoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9w
cml2KQogCiAJSTkxNV9XUklURShHRU4xMV9ESVNQTEFZX0lOVF9DVEwsIEdFTjExX0RJU1BMQVlf
SVJRX0VOQUJMRSk7CiAKLQlnZW4xMV9tYXN0ZXJfaW50cl9lbmFibGUodW5jb3JlLT5yZWdzKTsK
LQlQT1NUSU5HX1JFQUQoR0VOMTFfR0ZYX01TVFJfSVJRKTsKKwlpZiAoSEFTX01BU1RFUl9VTklU
X0lSUShkZXZfcHJpdikpIHsKKwkJZGcxX21hc3Rlcl9pbnRyX2VuYWJsZSh1bmNvcmUtPnJlZ3Mp
OworCQlQT1NUSU5HX1JFQUQoREcxX01TVFJfVU5JVF9JTlRSKTsKKwl9IGVsc2UgeworCQlnZW4x
MV9tYXN0ZXJfaW50cl9lbmFibGUodW5jb3JlLT5yZWdzKTsKKwkJUE9TVElOR19SRUFEKEdFTjEx
X0dGWF9NU1RSX0lSUSk7CisJfQogfQogCiBzdGF0aWMgdm9pZCBjaGVycnl2aWV3X2lycV9wb3N0
aW5zdGFsbChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCkBAIC00MDQzLDYgKzQw
OTEsOCBAQCBzdGF0aWMgaXJxX2hhbmRsZXJfdCBpbnRlbF9pcnFfaGFuZGxlcihzdHJ1Y3QgZHJt
X2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCiAJCWVsc2UKIAkJCXJldHVybiBpOHh4X2lycV9oYW5k
bGVyOwogCX0gZWxzZSB7CisJCWlmIChIQVNfTUFTVEVSX1VOSVRfSVJRKGRldl9wcml2KSkKKwkJ
CXJldHVybiBkZzFfaXJxX2hhbmRsZXI7CiAJCWlmIChJTlRFTF9HRU4oZGV2X3ByaXYpID49IDEx
KQogCQkJcmV0dXJuIGdlbjExX2lycV9oYW5kbGVyOwogCQllbHNlIGlmIChJTlRFTF9HRU4oZGV2
X3ByaXYpID49IDgpCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3JlZy5o
IGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9yZWcuaAppbmRleCA4NmEyM2NlZDA1MWIuLjRl
Nzk2ZmY0ZDdkMCAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9yZWcuaAor
KysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3JlZy5oCkBAIC03NzMzLDYgKzc3MzMsMTAg
QEAgZW51bSB7CiAjZGVmaW5lICBHRU4xMV9HVF9EVzFfSVJRCQkoMSA8PCAxKQogI2RlZmluZSAg
R0VOMTFfR1RfRFcwX0lSUQkJKDEgPDwgMCkKIAorI2RlZmluZSBERzFfTVNUUl9VTklUX0lOVFIJ
CV9NTUlPKDB4MTkwMDA4KQorI2RlZmluZSAgIERHMV9NU1RSX0lSUQkJCVJFR19CSVQoMzEpCisj
ZGVmaW5lICAgREcxX01TVFJfVU5JVCh1KQkJUkVHX0JJVCh1KQorCiAjZGVmaW5lIEdFTjExX0RJ
U1BMQVlfSU5UX0NUTAkJX01NSU8oMHg0NDIwMCkKICNkZWZpbmUgIEdFTjExX0RJU1BMQVlfSVJR
X0VOQUJMRQkoMSA8PCAzMSkKICNkZWZpbmUgIEdFTjExX0FVRElPX0NPREVDX0lSUQkJKDEgPDwg
MjQpCi0tIAoyLjI2LjIKCl9fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fCkludGVsLWdmeCBtYWlsaW5nIGxpc3QKSW50ZWwtZ2Z4QGxpc3RzLmZyZWVkZXNrdG9w
Lm9yZwpodHRwczovL2xpc3RzLmZyZWVkZXNrdG9wLm9yZy9tYWlsbWFuL2xpc3RpbmZvL2ludGVs
LWdmeAo=

Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 7C22E1288F8
	for <lists+intel-gfx@lfdr.de>; Sat, 21 Dec 2019 13:06:20 +0100 (CET)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id CC5F76E454;
	Sat, 21 Dec 2019 12:06:18 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from mga03.intel.com (mga03.intel.com [134.134.136.65])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 7ECE86E455
 for <intel-gfx@lists.freedesktop.org>; Sat, 21 Dec 2019 12:06:16 +0000 (UTC)
X-Amp-Result: SKIPPED(no attachment in message)
X-Amp-File-Uploaded: False
Received: from orsmga003.jf.intel.com ([10.7.209.27])
 by orsmga103.jf.intel.com with ESMTP/TLS/DHE-RSA-AES256-GCM-SHA384;
 21 Dec 2019 04:06:16 -0800
X-ExtLoop1: 1
X-IronPort-AV: E=Sophos;i="5.69,338,1571727600"; d="scan'208";a="219065217"
Received: from ideak-desk.fi.intel.com ([10.237.72.183])
 by orsmga003.jf.intel.com with ESMTP; 21 Dec 2019 04:06:14 -0800
From: Imre Deak <imre.deak@intel.com>
To: intel-gfx@lists.freedesktop.org
Date: Sat, 21 Dec 2019 14:05:37 +0200
Message-Id: <20191221120543.22816-5-imre.deak@intel.com>
X-Mailer: git-send-email 2.22.0
In-Reply-To: <20191221120543.22816-1-imre.deak@intel.com>
References: <20191221120543.22816-1-imre.deak@intel.com>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH 04/10] drm/i915: Add helpers to select correct
 ccs/aux planes
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.29
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Cc: Dhinakaran Pandiyan <dhinakaran.pandiyan@intel.com>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

VXNpbmcgaGVscGVycyBpbnN0ZWFkIG9mIG9wZW4gY29kaW5nIHRoaXMgdG8gc2VsZWN0IGEgQ0NT
IHBsYW5lIGZvciBhCm1haW4gcGxhbmUgbWFrZXMgdGhlIGNvZGUgY2xlYW5lciBhbmQgbGVzcyBl
cnJvci1wcm9uZSB3aGVuIHRoZSBsb2NhdGlvbgpvZiBDQ1MgcGxhbmUgY2FuIGJlIGRpZmZlcmVu
dCBiYXNlZCBvbiB0aGUgZm9ybWF0IChwYWNrZWQgdnMuIFlVVgpzZW1pcGxhbmFyKS4gVGhlIHNh
bWUgYXBwbGllcyB0byBzZWxlY3RpbmcgYW4gQVVYIHBsYW5lIHdoaWNoIGNhbiBiZSBhClVWIHBs
YW5lIChmb3IgYW4gdW5jb21wcmVzc2VkIFlVViBzZW1pcGxhbmFyIGZvcm1hdCksIG9yIGEgQ0NT
IHBsYW5lLgoKQ2M6IERoaW5ha2FyYW4gUGFuZGl5YW4gPGRoaW5ha2FyYW4ucGFuZGl5YW5AaW50
ZWwuY29tPgpDYzogVmlsbGUgU3lyasOkbMOkIDx2aWxsZS5zeXJqYWxhQGxpbnV4LmludGVsLmNv
bT4KQ2M6IE1pa2EgS2Fob2xhIDxtaWthLmthaG9sYUBpbnRlbC5jb20+CkNjOiBNYXR0IFJvcGVy
IDxtYXR0aGV3LmQucm9wZXJAaW50ZWwuY29tPgpTaWduZWQtb2ZmLWJ5OiBJbXJlIERlYWsgPGlt
cmUuZGVha0BpbnRlbC5jb20+ClJldmlld2VkLWJ5OiBNaWthIEthaG9sYSA8bWlrYS5rYWhvbGFA
aW50ZWwuY29tPgpSZXZpZXdlZC1ieTogTWF0dCBSb3BlciA8bWF0dGhldy5kLnJvcGVyQGludGVs
LmNvbT4KLS0tCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2Rpc3BsYXkuYyB8
IDcxICsrKysrKysrKysrKysrKystLS0tCiAxIGZpbGUgY2hhbmdlZCwgNTcgaW5zZXJ0aW9ucygr
KSwgMTQgZGVsZXRpb25zKC0pCgpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlz
cGxheS9pbnRlbF9kaXNwbGF5LmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVs
X2Rpc3BsYXkuYwppbmRleCBkMjQzZTVhOTI0MGUuLmQ0N2NmNjM5NDA3MyAxMDA2NDQKLS0tIGEv
ZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kaXNwbGF5LmMKKysrIGIvZHJpdmVy
cy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kaXNwbGF5LmMKQEAgLTE5MzQsNiArMTkzNCw0
MCBAQCBzdGF0aWMgdW5zaWduZWQgaW50IGludGVsX3RpbGVfc2l6ZShjb25zdCBzdHJ1Y3QgZHJt
X2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCiAJcmV0dXJuIElTX0dFTihkZXZfcHJpdiwgMikgPyAy
MDQ4IDogNDA5NjsKIH0KIAorc3RhdGljIGJvb2wgaXNfY2NzX3BsYW5lKGNvbnN0IHN0cnVjdCBk
cm1fZnJhbWVidWZmZXIgKmZiLCBpbnQgcGxhbmUpCit7CisJaWYgKCFpc19jY3NfbW9kaWZpZXIo
ZmItPm1vZGlmaWVyKSkKKwkJcmV0dXJuIGZhbHNlOworCisJcmV0dXJuIHBsYW5lID49IGZiLT5m
b3JtYXQtPm51bV9wbGFuZXMgLyAyOworfQorCitzdGF0aWMgYm9vbCBpc19hdXhfcGxhbmUoY29u
c3Qgc3RydWN0IGRybV9mcmFtZWJ1ZmZlciAqZmIsIGludCBwbGFuZSkKK3sKKwlpZiAoaXNfY2Nz
X21vZGlmaWVyKGZiLT5tb2RpZmllcikpCisJCXJldHVybiBpc19jY3NfcGxhbmUoZmIsIHBsYW5l
KTsKKworCXJldHVybiBwbGFuZSA9PSAxOworfQorCitzdGF0aWMgaW50IG1haW5fdG9fY2NzX3Bs
YW5lKGNvbnN0IHN0cnVjdCBkcm1fZnJhbWVidWZmZXIgKmZiLCBpbnQgbWFpbl9wbGFuZSkKK3sK
KwlXQVJOX09OKCFpc19jY3NfbW9kaWZpZXIoZmItPm1vZGlmaWVyKSB8fAorCQkobWFpbl9wbGFu
ZSAmJiBtYWluX3BsYW5lID49IGZiLT5mb3JtYXQtPm51bV9wbGFuZXMgLyAyKSk7CisKKwlyZXR1
cm4gZmItPmZvcm1hdC0+bnVtX3BsYW5lcyAvIDIgKyBtYWluX3BsYW5lOworfQorCisvKiBSZXR1
cm4gZWl0aGVyIHRoZSBtYWluIHBsYW5lJ3MgQ0NTIG9yIC0gaWYgbm90IGEgQ0NTIEZCIC0gVVYg
cGxhbmUgKi8KK3N0YXRpYyBpbnQKK2ludGVsX21haW5fdG9fYXV4X3BsYW5lKGNvbnN0IHN0cnVj
dCBkcm1fZnJhbWVidWZmZXIgKmZiLCBpbnQgbWFpbl9wbGFuZSkKK3sKKwlpZiAoaXNfY2NzX21v
ZGlmaWVyKGZiLT5tb2RpZmllcikpCisJCXJldHVybiBtYWluX3RvX2Njc19wbGFuZShmYiwgbWFp
bl9wbGFuZSk7CisKKwlyZXR1cm4gMTsKK30KKwogc3RhdGljIHVuc2lnbmVkIGludAogaW50ZWxf
dGlsZV93aWR0aF9ieXRlcyhjb25zdCBzdHJ1Y3QgZHJtX2ZyYW1lYnVmZmVyICpmYiwgaW50IGNv
bG9yX3BsYW5lKQogewpAQCAtMTk0OSw3ICsxOTgzLDcgQEAgaW50ZWxfdGlsZV93aWR0aF9ieXRl
cyhjb25zdCBzdHJ1Y3QgZHJtX2ZyYW1lYnVmZmVyICpmYiwgaW50IGNvbG9yX3BsYW5lKQogCQll
bHNlCiAJCQlyZXR1cm4gNTEyOwogCWNhc2UgSTkxNV9GT1JNQVRfTU9EX1lfVElMRURfQ0NTOgot
CQlpZiAoY29sb3JfcGxhbmUgPT0gMSkKKwkJaWYgKGlzX2Njc19wbGFuZShmYiwgY29sb3JfcGxh
bmUpKQogCQkJcmV0dXJuIDEyODsKIAkJLyogZmFsbCB0aHJvdWdoICovCiAJY2FzZSBJOTE1X0ZP
Uk1BVF9NT0RfWV9USUxFRDoKQEAgLTE5NTgsNyArMTk5Miw3IEBAIGludGVsX3RpbGVfd2lkdGhf
Ynl0ZXMoY29uc3Qgc3RydWN0IGRybV9mcmFtZWJ1ZmZlciAqZmIsIGludCBjb2xvcl9wbGFuZSkK
IAkJZWxzZQogCQkJcmV0dXJuIDUxMjsKIAljYXNlIEk5MTVfRk9STUFUX01PRF9ZZl9USUxFRF9D
Q1M6Ci0JCWlmIChjb2xvcl9wbGFuZSA9PSAxKQorCQlpZiAoaXNfY2NzX3BsYW5lKGZiLCBjb2xv
cl9wbGFuZSkpCiAJCQlyZXR1cm4gMTI4OwogCQkvKiBmYWxsIHRocm91Z2ggKi8KIAljYXNlIEk5
MTVfRk9STUFUX01PRF9ZZl9USUxFRDoKQEAgLTIwNzUsNyArMjEwOSw3IEBAIHN0YXRpYyB1bnNp
Z25lZCBpbnQgaW50ZWxfc3VyZl9hbGlnbm1lbnQoY29uc3Qgc3RydWN0IGRybV9mcmFtZWJ1ZmZl
ciAqZmIsCiAJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShmYi0+
ZGV2KTsKIAogCS8qIEFVWF9ESVNUIG5lZWRzIG9ubHkgNEsgYWxpZ25tZW50ICovCi0JaWYgKGNv
bG9yX3BsYW5lID09IDEpCisJaWYgKGlzX2F1eF9wbGFuZShmYiwgY29sb3JfcGxhbmUpKQogCQly
ZXR1cm4gNDA5NjsKIAogCXN3aXRjaCAoZmItPm1vZGlmaWVyKSB7CkBAIC0zNDYxLDEwICszNDk1
LDExIEBAIHN0YXRpYyBib29sIHNrbF9jaGVja19tYWluX2Njc19jb29yZGluYXRlcyhzdHJ1Y3Qg
aW50ZWxfcGxhbmVfc3RhdGUgKnBsYW5lX3N0YXRlCiAJY29uc3Qgc3RydWN0IGRybV9mcmFtZWJ1
ZmZlciAqZmIgPSBwbGFuZV9zdGF0ZS0+aHcuZmI7CiAJaW50IGhzdWIgPSBmYi0+Zm9ybWF0LT5o
c3ViOwogCWludCB2c3ViID0gZmItPmZvcm1hdC0+dnN1YjsKLQlpbnQgYXV4X3ggPSBwbGFuZV9z
dGF0ZS0+Y29sb3JfcGxhbmVbMV0ueDsKLQlpbnQgYXV4X3kgPSBwbGFuZV9zdGF0ZS0+Y29sb3Jf
cGxhbmVbMV0ueTsKLQl1MzIgYXV4X29mZnNldCA9IHBsYW5lX3N0YXRlLT5jb2xvcl9wbGFuZVsx
XS5vZmZzZXQ7Ci0JdTMyIGFsaWdubWVudCA9IGludGVsX3N1cmZfYWxpZ25tZW50KGZiLCAxKTsK
KwlpbnQgY2NzX3BsYW5lID0gbWFpbl90b19jY3NfcGxhbmUoZmIsIDApOworCWludCBhdXhfeCA9
IHBsYW5lX3N0YXRlLT5jb2xvcl9wbGFuZVtjY3NfcGxhbmVdLng7CisJaW50IGF1eF95ID0gcGxh
bmVfc3RhdGUtPmNvbG9yX3BsYW5lW2Njc19wbGFuZV0ueTsKKwl1MzIgYXV4X29mZnNldCA9IHBs
YW5lX3N0YXRlLT5jb2xvcl9wbGFuZVtjY3NfcGxhbmVdLm9mZnNldDsKKwl1MzIgYWxpZ25tZW50
ID0gaW50ZWxfc3VyZl9hbGlnbm1lbnQoZmIsIGNjc19wbGFuZSk7CiAKIAl3aGlsZSAoYXV4X29m
ZnNldCA+PSBtYWluX29mZnNldCAmJiBhdXhfeSA8PSBtYWluX3kpIHsKIAkJaW50IHgsIHk7CkBA
IC0zNDc3LDggKzM1MTIsMTIgQEAgc3RhdGljIGJvb2wgc2tsX2NoZWNrX21haW5fY2NzX2Nvb3Jk
aW5hdGVzKHN0cnVjdCBpbnRlbF9wbGFuZV9zdGF0ZSAqcGxhbmVfc3RhdGUKIAogCQl4ID0gYXV4
X3ggLyBoc3ViOwogCQl5ID0gYXV4X3kgLyB2c3ViOwotCQlhdXhfb2Zmc2V0ID0gaW50ZWxfcGxh
bmVfYWRqdXN0X2FsaWduZWRfb2Zmc2V0KCZ4LCAmeSwgcGxhbmVfc3RhdGUsIDEsCi0JCQkJCQkJ
ICAgICAgIGF1eF9vZmZzZXQsIGF1eF9vZmZzZXQgLSBhbGlnbm1lbnQpOworCQlhdXhfb2Zmc2V0
ID0gaW50ZWxfcGxhbmVfYWRqdXN0X2FsaWduZWRfb2Zmc2V0KCZ4LCAmeSwKKwkJCQkJCQkgICAg
ICAgcGxhbmVfc3RhdGUsCisJCQkJCQkJICAgICAgIGNjc19wbGFuZSwKKwkJCQkJCQkgICAgICAg
YXV4X29mZnNldCwKKwkJCQkJCQkgICAgICAgYXV4X29mZnNldCAtCisJCQkJCQkJCWFsaWdubWVu
dCk7CiAJCWF1eF94ID0geCAqIGhzdWIgKyBhdXhfeCAlIGhzdWI7CiAJCWF1eF95ID0geSAqIHZz
dWIgKyBhdXhfeSAlIHZzdWI7CiAJfQpAQCAtMzQ4Niw5ICszNTI1LDkgQEAgc3RhdGljIGJvb2wg
c2tsX2NoZWNrX21haW5fY2NzX2Nvb3JkaW5hdGVzKHN0cnVjdCBpbnRlbF9wbGFuZV9zdGF0ZSAq
cGxhbmVfc3RhdGUKIAlpZiAoYXV4X3ggIT0gbWFpbl94IHx8IGF1eF95ICE9IG1haW5feSkKIAkJ
cmV0dXJuIGZhbHNlOwogCi0JcGxhbmVfc3RhdGUtPmNvbG9yX3BsYW5lWzFdLm9mZnNldCA9IGF1
eF9vZmZzZXQ7Ci0JcGxhbmVfc3RhdGUtPmNvbG9yX3BsYW5lWzFdLnggPSBhdXhfeDsKLQlwbGFu
ZV9zdGF0ZS0+Y29sb3JfcGxhbmVbMV0ueSA9IGF1eF95OworCXBsYW5lX3N0YXRlLT5jb2xvcl9w
bGFuZVtjY3NfcGxhbmVdLm9mZnNldCA9IGF1eF9vZmZzZXQ7CisJcGxhbmVfc3RhdGUtPmNvbG9y
X3BsYW5lW2Njc19wbGFuZV0ueCA9IGF1eF94OworCXBsYW5lX3N0YXRlLT5jb2xvcl9wbGFuZVtj
Y3NfcGxhbmVdLnkgPSBhdXhfeTsKIAogCXJldHVybiB0cnVlOwogfQpAQCAtMzUwNCw3ICszNTQz
LDEwIEBAIHN0YXRpYyBpbnQgc2tsX2NoZWNrX21haW5fc3VyZmFjZShzdHJ1Y3QgaW50ZWxfcGxh
bmVfc3RhdGUgKnBsYW5lX3N0YXRlKQogCWludCBoID0gZHJtX3JlY3RfaGVpZ2h0KCZwbGFuZV9z
dGF0ZS0+dWFwaS5zcmMpID4+IDE2OwogCWludCBtYXhfd2lkdGg7CiAJaW50IG1heF9oZWlnaHQ7
Ci0JdTMyIGFsaWdubWVudCwgb2Zmc2V0LCBhdXhfb2Zmc2V0ID0gcGxhbmVfc3RhdGUtPmNvbG9y
X3BsYW5lWzFdLm9mZnNldDsKKwl1MzIgYWxpZ25tZW50OworCXUzMiBvZmZzZXQ7CisJaW50IGF1
eF9wbGFuZSA9IGludGVsX21haW5fdG9fYXV4X3BsYW5lKGZiLCAwKTsKKwl1MzIgYXV4X29mZnNl
dCA9IHBsYW5lX3N0YXRlLT5jb2xvcl9wbGFuZVthdXhfcGxhbmVdLm9mZnNldDsKIAogCWlmIChJ
TlRFTF9HRU4oZGV2X3ByaXYpID49IDExKQogCQltYXhfd2lkdGggPSBpY2xfbWF4X3BsYW5lX3dp
ZHRoKGZiLCAwLCByb3RhdGlvbik7CkBAIC0zNTcwLDcgKzM2MTIsOCBAQCBzdGF0aWMgaW50IHNr
bF9jaGVja19tYWluX3N1cmZhY2Uoc3RydWN0IGludGVsX3BsYW5lX3N0YXRlICpwbGFuZV9zdGF0
ZSkKIAkJCQkJCQkJICAgb2Zmc2V0LCBvZmZzZXQgLSBhbGlnbm1lbnQpOwogCQl9CiAKLQkJaWYg
KHggIT0gcGxhbmVfc3RhdGUtPmNvbG9yX3BsYW5lWzFdLnggfHwgeSAhPSBwbGFuZV9zdGF0ZS0+
Y29sb3JfcGxhbmVbMV0ueSkgeworCQlpZiAoeCAhPSBwbGFuZV9zdGF0ZS0+Y29sb3JfcGxhbmVb
YXV4X3BsYW5lXS54IHx8CisJCSAgICB5ICE9IHBsYW5lX3N0YXRlLT5jb2xvcl9wbGFuZVthdXhf
cGxhbmVdLnkpIHsKIAkJCURSTV9ERUJVR19LTVMoIlVuYWJsZSB0byBmaW5kIHN1aXRhYmxlIGRp
c3BsYXkgc3VyZmFjZSBvZmZzZXQgZHVlIHRvIENDU1xuIik7CiAJCQlyZXR1cm4gLUVJTlZBTDsK
IAkJfQotLSAKMi4yMi4wCgpfX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fXwpJbnRlbC1nZnggbWFpbGluZyBsaXN0CkludGVsLWdmeEBsaXN0cy5mcmVlZGVza3Rv
cC5vcmcKaHR0cHM6Ly9saXN0cy5mcmVlZGVza3RvcC5vcmcvbWFpbG1hbi9saXN0aW5mby9pbnRl
bC1nZngK

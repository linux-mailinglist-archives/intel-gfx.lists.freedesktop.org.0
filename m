Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 07D7C18C21D
	for <lists+intel-gfx@lfdr.de>; Thu, 19 Mar 2020 22:14:23 +0100 (CET)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 54A8A6EA85;
	Thu, 19 Mar 2020 21:14:21 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from mga17.intel.com (mga17.intel.com [192.55.52.151])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 636E86EA85
 for <intel-gfx@lists.freedesktop.org>; Thu, 19 Mar 2020 21:14:20 +0000 (UTC)
IronPort-SDR: qm4fbQH2cbPBD2m3oEcfK/0Aqx2xd1YIEz0Pa1fxa43Q/ccxi0/YFJ4CPKVV41ZZfmG2hDH9yj
 Mf5xrm/Q7+dQ==
X-Amp-Result: SKIPPED(no attachment in message)
X-Amp-File-Uploaded: False
Received: from orsmga008.jf.intel.com ([10.7.209.65])
 by fmsmga107.fm.intel.com with ESMTP/TLS/ECDHE-RSA-AES256-GCM-SHA384;
 19 Mar 2020 14:14:19 -0700
IronPort-SDR: Aw2rGUdZeFiDCdxM8i2VcXslo9KqZigoT2CIZWnyPPNFN0I6wlmeoXPhg1jAT05WUiuTSkpuhY
 xCP5mIw1AL2w==
X-ExtLoop1: 1
X-IronPort-AV: E=Sophos;i="5.70,573,1574150400"; d="scan'208";a="239041783"
Received: from josouza-mobl2.jf.intel.com (HELO josouza-MOBL2.intel.com)
 ([10.24.15.8])
 by orsmga008.jf.intel.com with ESMTP; 19 Mar 2020 14:14:19 -0700
From: =?UTF-8?q?Jos=C3=A9=20Roberto=20de=20Souza?= <jose.souza@intel.com>
To: intel-gfx@lists.freedesktop.org
Date: Thu, 19 Mar 2020 14:15:35 -0700
Message-Id: <20200319211535.114625-1-jose.souza@intel.com>
X-Mailer: git-send-email 2.25.2
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH v5] drm/i915/display/fbc: Make fences a
 nice-to-have for GEN9+
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.29
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Cc: Daniel Vetter <daniel.vetter@intel.com>,
 Dhinakaran Pandiyan <dhinakaran.pandiyan@intel.com>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

ZEdGWCBoYXZlIGxvY2FsIG1lbW9yeSBzbyBpdCBkbyBub3QgaGF2ZSBhcGVydHVyZSBhbmQgZG8g
bm90IHN1cHBvcnQKQ1BVIGZlbmNlcyBidXQgZXZlbiBmb3IgaUdGWCBpdCBoYXZlIGEgc21hbGwg
bnVtYmVyIG9mIGZlbmNlcy4KCkFzIHJlcGxhY2VtZW50IGZvciBmZW5jZXMgdG8gdHJhY2sgZnJv
bnRidWZmZXIgbW9kaWZpY2F0aW9ucyBieSBDUFUKd2UgaGF2ZSBhIHNvZnR3YXJlIHRyYWNraW5n
IHRoYXQgaXMgYWxyZWFkeSBpbiB1c2VkIGJ5IEZCQyBhbmQgUFNSLgpQU1IgZG9uJ3Qgc3VwcG9y
dCBmZW5jZXMgc28gaXQgc2hvd3MgdGhhdCB0aGlzIHRyYWNraW5nIGlzIHJlbGlhYmxlLgoKU28g
bGV0cyBtYWtlIGZlbmNlcyBhIG5pY2UtdG8taGF2ZSB0byBhY3RpdmF0ZSBGQkMgZm9yIEdFTjkr
LCB0aGlzCndpbGwgYWxsb3cgdXMgdG8gZW5hYmxlIEZCQyBmb3IgZEdGWHMgYW5kIGlHRlhzIGV2
ZW4gd2hlbiB0aGVyZSBpcyBubwphdmFpbGFibGUgZmVuY2UuCgpXZSBkbyBub3Qgc2V0IGZlbmNl
cyB0byByb3RhdGVkIHBsYW5lcyBidXQgRkJDIG9ubHkgaGF2ZSByZXN0cmljdGlvbnMKYWdhaW5z
dCAxNmJwcCwgc28gYWRkaW5nIGl0IGhlcmUuCgpBbHNvIGFkZGluZyBhIG5ldyBjaGVjayBmb3Ig
dGhlIHRpbGluZyBmb3JtYXQsIGZlbmNlcyBhcmUgb25seSBzZXQKdG8gWCBhbmQgWSB0aWxlZCBw
bGFuZXMgYnV0IGFnYWluIEZCQyBkb24ndCBoYXZlIGFueSByZXN0cmljdGlvbnMKYWdhaW5zdCB0
aWxpbmcgc28gYWRkaW5nIGxpbmVhciBhcyBzdXBwb3J0ZWQgYXMgd2VsbCwgb3RoZXIgZm9ybWF0
cwpzaG91bGQgYmUgYWRkZWQgYWZ0ZXIgdGVzdGVkIGJ1dCBJR1Qgb25seSBzdXBwb3J0cyBkcmF3
aW5nIGluIHRoc2UKMyBmb3JtYXRzLgoKaW50ZWxfZmJjX2h3X3RyYWNraW5nX2NvdmVyc19zY3Jl
ZW4oKSBtYXliZSBjYW4gYWxzbyBoYXZlIHRoZSBzYW1lCnRyZWF0bWVudCBhcyBmZW5jZXMgYnV0
IEJTcGVjIGlzIG5vdCBjbGVhciBpZiB0aGUgc2l6ZSBsaW1pdGF0aW9uIGlzCmZvciBoYXJkd2Fy
ZSB0cmFja2luZyBvciBnZW5lcmFsIHVzZSBvZiBGQkMgYW5kIEkgZG9uJ3QgaGF2ZSBhIDVLCmRp
c3BsYXkgdG8gdGVzdCBpdCwgc28ga2VlcGluZyBhcyBpcyBmb3Igc2FmZXR5LgoKdjI6Ci0gQWRk
ZWQgdGlsaW5nIGFuZCBwaXhlbCBmb3JtYXQgcm90YXRpb24gY2hlY2tzCi0gQ2hhbmdlZCB0aGUg
R0VOIHZlcnNpb24gbm90IHJlcXVpcmluZyBmZW5jZXMgdG8gMTEgZnJvbSA5LCBERFgKbmVlZHMg
c29tZSBjaGFuZ2VzIGJ1dCBpdCBkb24ndCBoYXZlIHN1cHBvcnQgZm9yIEdFTjExKwoKdjM6Ci0g
Q2hhbmdlZCBiYWNrIHRvIEdFTjkrCi0gTW92ZWQgR0VOIHRlc3QgdG8gaW5zaWRlIG9mIHRpbGlu
Z19pc192YWxpZCgpCgp2NDoKLSBtb3ZlZCByb3RhdGlvbiBjaGVjayB0byBpdHMgb3duIGZ1bmN0
aW9ucwoKdjU6Ci0gcmVuYW1lZCByb3RhdGlvbnNfaXNfdmFsaWQgdG8gcm90YXRpb25faXNfdmFs
aWQKLSBtb3ZlZCBwcmUtZzR4IHJvdGF0aW9uIGNoZWNrIHRvIHJvdGF0aW9uX2lzX3ZhbGlkKCkK
CkNjOiBEYW5pZWwgVmV0dGVyIDxkYW5pZWwudmV0dGVyQGludGVsLmNvbT4KQ2M6IERoaW5ha2Fy
YW4gUGFuZGl5YW4gPGRoaW5ha2FyYW4ucGFuZGl5YW5AaW50ZWwuY29tPgpDYzogVmlsbGUgU3ly
asOkbMOkIDx2aWxsZS5zeXJqYWxhQGxpbnV4LmludGVsLmNvbT4KUmV2aWV3ZWQtYnk6IFZpbGxl
IFN5cmrDpGzDpCA8dmlsbGUuc3lyamFsYUBsaW51eC5pbnRlbC5jb20+ClNpZ25lZC1vZmYtYnk6
IEpvc8OpIFJvYmVydG8gZGUgU291emEgPGpvc2Uuc291emFAaW50ZWwuY29tPgotLS0KIGRyaXZl
cnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZmJjLmMgfCA1NCArKysrKysrKysrKysrKysr
KysrKystLS0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZHJ2LmggICAgICAgICAgfCAgMSAr
CiAyIGZpbGVzIGNoYW5nZWQsIDQ4IGluc2VydGlvbnMoKyksIDcgZGVsZXRpb25zKC0pCgpkaWZm
IC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9mYmMuYyBiL2RyaXZl
cnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZmJjLmMKaW5kZXggMDJiZTE0YjY5M2Q0Li5k
NDQ1ZjllNTA2MzUgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50
ZWxfZmJjLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9mYmMuYwpA
QCAtNjA4LDYgKzYwOCwxOSBAQCBzdGF0aWMgYm9vbCBwaXhlbF9mb3JtYXRfaXNfdmFsaWQoc3Ry
dWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAogCX0KIH0KIAorc3RhdGljIGJvb2wgcm90
YXRpb25faXNfdmFsaWQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAorCQkJICAg
ICAgdTMyIHBpeGVsX2Zvcm1hdCwgdW5zaWduZWQgaW50IHJvdGF0aW9uKQoreworCWlmIChJTlRF
TF9HRU4oZGV2X3ByaXYpID49IDkgJiYgcGl4ZWxfZm9ybWF0ID09IERSTV9GT1JNQVRfUkdCNTY1
ICYmCisJICAgIGRybV9yb3RhdGlvbl85MF9vcl8yNzAocm90YXRpb24pKQorCQlyZXR1cm4gZmFs
c2U7CisJZWxzZSBpZiAoSU5URUxfR0VOKGRldl9wcml2KSA8PSA0ICYmICFJU19HNFgoZGV2X3By
aXYpICYmCisJCSByb3RhdGlvbiAhPSBEUk1fTU9ERV9ST1RBVEVfMCkKKwkJcmV0dXJuIGZhbHNl
OworCisJcmV0dXJuIHRydWU7Cit9CisKIC8qCiAgKiBGb3Igc29tZSByZWFzb24sIHRoZSBoYXJk
d2FyZSB0cmFja2luZyBzdGFydHMgbG9va2luZyBhdCB3aGF0ZXZlciB3ZQogICogcHJvZ3JhbW1l
ZCBhcyB0aGUgZGlzcGxheSBwbGFuZSBiYXNlIGFkZHJlc3MgcmVnaXN0ZXIuIEl0IGRvZXMgbm90
IGxvb2sgYXQKQEAgLTY0Miw2ICs2NTUsMjIgQEAgc3RhdGljIGJvb2wgaW50ZWxfZmJjX2h3X3Ry
YWNraW5nX2NvdmVyc19zY3JlZW4oc3RydWN0IGludGVsX2NydGMgKmNydGMpCiAJcmV0dXJuIGVm
ZmVjdGl2ZV93IDw9IG1heF93ICYmIGVmZmVjdGl2ZV9oIDw9IG1heF9oOwogfQogCitzdGF0aWMg
Ym9vbCB0aWxpbmdfaXNfdmFsaWQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAor
CQkJICAgIHVpbnQ2NF90IG1vZGlmaWVyKQoreworCXN3aXRjaCAobW9kaWZpZXIpIHsKKwljYXNl
IERSTV9GT1JNQVRfTU9EX0xJTkVBUjoKKwkJaWYgKElOVEVMX0dFTihkZXZfcHJpdikgPj0gOSkK
KwkJCXJldHVybiB0cnVlOworCQlyZXR1cm4gZmFsc2U7CisJY2FzZSBJOTE1X0ZPUk1BVF9NT0Rf
WF9USUxFRDoKKwljYXNlIEk5MTVfRk9STUFUX01PRF9ZX1RJTEVEOgorCQlyZXR1cm4gdHJ1ZTsK
KwlkZWZhdWx0OgorCQlyZXR1cm4gZmFsc2U7CisJfQorfQorCiBzdGF0aWMgdm9pZCBpbnRlbF9m
YmNfdXBkYXRlX3N0YXRlX2NhY2hlKHN0cnVjdCBpbnRlbF9jcnRjICpjcnRjLAogCQkJCQkgY29u
c3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUsCiAJCQkJCSBjb25zdCBzdHJ1
Y3QgaW50ZWxfcGxhbmVfc3RhdGUgKnBsYW5lX3N0YXRlKQpAQCAtNjc1LDYgKzcwNCw3IEBAIHN0
YXRpYyB2b2lkIGludGVsX2ZiY191cGRhdGVfc3RhdGVfY2FjaGUoc3RydWN0IGludGVsX2NydGMg
KmNydGMsCiAKIAljYWNoZS0+ZmIuZm9ybWF0ID0gZmItPmZvcm1hdDsKIAljYWNoZS0+ZmIuc3Ry
aWRlID0gZmItPnBpdGNoZXNbMF07CisJY2FjaGUtPmZiLm1vZGlmaWVyID0gZmItPm1vZGlmaWVy
OwogCiAJZHJtX1dBUk5fT04oJmRldl9wcml2LT5kcm0sIHBsYW5lX3N0YXRlLT5mbGFncyAmIFBM
QU5FX0hBU19GRU5DRSAmJgogCQkgICAgIXBsYW5lX3N0YXRlLT52bWEtPmZlbmNlKTsKQEAgLTc0
OCwyOSArNzc4LDM5IEBAIHN0YXRpYyBib29sIGludGVsX2ZiY19jYW5fYWN0aXZhdGUoc3RydWN0
IGludGVsX2NydGMgKmNydGMpCiAJCXJldHVybiBmYWxzZTsKIAl9CiAKLQkvKiBUaGUgdXNlIG9m
IGEgQ1BVIGZlbmNlIGlzIG1hbmRhdG9yeSBpbiBvcmRlciB0byBkZXRlY3Qgd3JpdGVzCi0JICog
YnkgdGhlIENQVSB0byB0aGUgc2Nhbm91dCBhbmQgdHJpZ2dlciB1cGRhdGVzIHRvIHRoZSBGQkMu
CisJLyogVGhlIHVzZSBvZiBhIENQVSBmZW5jZSBpcyBvbmUgb2YgdHdvIHdheXMgdG8gZGV0ZWN0
IHdyaXRlcyBieSB0aGUKKwkgKiBDUFUgdG8gdGhlIHNjYW5vdXQgYW5kIHRyaWdnZXIgdXBkYXRl
cyB0byB0aGUgRkJDLgorCSAqCisJICogVGhlIG90aGVyIG1ldGhvZCBpcyBieSBzb2Z0d2FyZSB0
cmFja2luZyhzZWUKKwkgKiBpbnRlbF9mYmNfaW52YWxpZGF0ZS9mbHVzaCgpKSwgaXQgd2lsbCBt
YW51YWxseSBub3RpZnkgRkJDIGFuZCBudWtlCisJICogdGhlIGN1cnJlbnQgY29tcHJlc3NlZCBi
dWZmZXIgYW5kIHJlY29tcHJlc3MgaXQuCiAJICoKIAkgKiBOb3RlIHRoYXQgaXMgcG9zc2libGUg
Zm9yIGEgdGlsZWQgc3VyZmFjZSB0byBiZSB1bm1hcHBhYmxlIChhbmQKLQkgKiBzbyBoYXZlIG5v
IGZlbmNlIGFzc29jaWF0ZWQgd2l0aCBpdCkgZHVlIHRvIGFwZXJ0dXJlIGNvbnN0YWludHMKKwkg
KiBzbyBoYXZlIG5vIGZlbmNlIGFzc29jaWF0ZWQgd2l0aCBpdCkgZHVlIHRvIGFwZXJ0dXJlIGNv
bnN0cmFpbnRzCiAJICogYXQgdGhlIHRpbWUgb2YgcGlubmluZy4KIAkgKgogCSAqIEZJWE1FIHdp
dGggOTAvMjcwIGRlZ3JlZSByb3RhdGlvbiB3ZSBzaG91bGQgdXNlIHRoZSBmZW5jZSBvbgogCSAq
IHRoZSBub3JtYWwgR1RUIHZpZXcgKHRoZSByb3RhdGVkIHZpZXcgZG9lc24ndCBldmVuIGhhdmUg
YQogCSAqIGZlbmNlKS4gV291bGQgbmVlZCBjaGFuZ2VzIHRvIHRoZSBGQkMgZmVuY2UgWSBvZmZz
ZXQgYXMgd2VsbC4KLQkgKiBGb3Igbm93IHRoaXMgd2lsbCBlZmZlY2l2ZWx5IGRpc2FibGUgRkJD
IHdpdGggOTAvMjcwIGRlZ3JlZQorCSAqIEZvciBub3cgdGhpcyB3aWxsIGVmZmVjdGl2ZWx5IGRp
c2FibGUgRkJDIHdpdGggOTAvMjcwIGRlZ3JlZQogCSAqIHJvdGF0aW9uLgogCSAqLwotCWlmIChj
YWNoZS0+ZmVuY2VfaWQgPCAwKSB7CisJaWYgKElOVEVMX0dFTihkZXZfcHJpdikgPCA5ICYmIGNh
Y2hlLT5mZW5jZV9pZCA8IDApIHsKIAkJZmJjLT5ub19mYmNfcmVhc29uID0gImZyYW1lYnVmZmVy
IG5vdCB0aWxlZCBvciBmZW5jZWQiOwogCQlyZXR1cm4gZmFsc2U7CiAJfQotCWlmIChJTlRFTF9H
RU4oZGV2X3ByaXYpIDw9IDQgJiYgIUlTX0c0WChkZXZfcHJpdikgJiYKLQkgICAgY2FjaGUtPnBs
YW5lLnJvdGF0aW9uICE9IERSTV9NT0RFX1JPVEFURV8wKSB7CisKKwlpZiAoIXJvdGF0aW9uX2lz
X3ZhbGlkKGRldl9wcml2LCBjYWNoZS0+ZmIuZm9ybWF0LT5mb3JtYXQsCisJCQkgICAgICAgY2Fj
aGUtPnBsYW5lLnJvdGF0aW9uKSkgewogCQlmYmMtPm5vX2ZiY19yZWFzb24gPSAicm90YXRpb24g
dW5zdXBwb3J0ZWQiOwogCQlyZXR1cm4gZmFsc2U7CiAJfQogCisJaWYgKCF0aWxpbmdfaXNfdmFs
aWQoZGV2X3ByaXYsIGNhY2hlLT5mYi5tb2RpZmllcikpIHsKKwkJZmJjLT5ub19mYmNfcmVhc29u
ID0gInRpbGluZyB1bnN1cHBvcnRlZCI7CisJCXJldHVybiBmYWxzZTsKKwl9CisKIAlpZiAoIXN0
cmlkZV9pc192YWxpZChkZXZfcHJpdiwgY2FjaGUtPmZiLnN0cmlkZSkpIHsKIAkJZmJjLT5ub19m
YmNfcmVhc29uID0gImZyYW1lYnVmZmVyIHN0cmlkZSBub3Qgc3VwcG9ydGVkIjsKIAkJcmV0dXJu
IGZhbHNlOwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9kcnYuaCBiL2Ry
aXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZHJ2LmgKaW5kZXggYTdlYTFkODU1MzU5Li45YmNlYTk3
YzM5ZGUgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZHJ2LmgKKysrIGIv
ZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9kcnYuaApAQCAtNDE2LDYgKzQxNiw3IEBAIHN0cnVj
dCBpbnRlbF9mYmMgewogCQlzdHJ1Y3QgewogCQkJY29uc3Qgc3RydWN0IGRybV9mb3JtYXRfaW5m
byAqZm9ybWF0OwogCQkJdW5zaWduZWQgaW50IHN0cmlkZTsKKwkJCXU2NCBtb2RpZmllcjsKIAkJ
fSBmYjsKIAkJdTE2IGdlbjlfd2FfY2ZiX3N0cmlkZTsKIAkJczggZmVuY2VfaWQ7Ci0tIAoyLjI1
LjIKCl9fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fCkludGVs
LWdmeCBtYWlsaW5nIGxpc3QKSW50ZWwtZ2Z4QGxpc3RzLmZyZWVkZXNrdG9wLm9yZwpodHRwczov
L2xpc3RzLmZyZWVkZXNrdG9wLm9yZy9tYWlsbWFuL2xpc3RpbmZvL2ludGVsLWdmeAo=

Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id E0A839B0DD
	for <lists+intel-gfx@lfdr.de>; Fri, 23 Aug 2019 15:27:16 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 626876EC8D;
	Fri, 23 Aug 2019 13:27:12 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from fireflyinternet.com (mail.fireflyinternet.com [109.228.58.192])
 by gabe.freedesktop.org (Postfix) with ESMTPS id A08DF6EC8D
 for <intel-gfx@lists.freedesktop.org>; Fri, 23 Aug 2019 13:27:08 +0000 (UTC)
X-Default-Received-SPF: pass (skip=forwardok (res=PASS))
 x-ip-name=78.156.65.138; 
Received: from haswell.alporthouse.com (unverified [78.156.65.138]) 
 by fireflyinternet.com (Firefly Internet (M1)) with ESMTP id 18240608-1500050 
 for multiple; Fri, 23 Aug 2019 14:27:05 +0100
From: Chris Wilson <chris@chris-wilson.co.uk>
To: intel-gfx@lists.freedesktop.org
Date: Fri, 23 Aug 2019 14:26:59 +0100
Message-Id: <20190823132700.25286-15-chris@chris-wilson.co.uk>
X-Mailer: git-send-email 2.23.0
In-Reply-To: <20190823132700.25286-1-chris@chris-wilson.co.uk>
References: <20190823132700.25286-1-chris@chris-wilson.co.uk>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH 14/15] drm/i915: Drop struct_mutex from around
 i915_retire_requests()
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

V2UgZG9uJ3QgbmVlZCB0byBob2xkIHN0cnVjdF9tdXRleCBub3cgZm9yIHJldGlyaW5nIHJlcXVl
c3RzLCBzbyBkcm9wIGl0CmZyb20gaTkxNV9yZXRpcmVfcmVxdWVzdHMoKSBhbmQgaTkxNV9nZW1f
d2FpdF9mb3JfaWRsZSgpLCBmaW5hbGx5CnJlbW92aW5nIEk5MTVfV0FJVF9MT0NLRUQgZm9yIGdv
b2QuCgpTaWduZWQtb2ZmLWJ5OiBDaHJpcyBXaWxzb24gPGNocmlzQGNocmlzLXdpbHNvbi5jby51
az4KLS0tCiAuLi4vZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9jbGllbnRfYmx0LmMgICAgfCAg
NyArLS0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9jb250ZXh0LmMgICB8IDIw
ICstLS0tLS0tLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX3BtLmMgICAgICAg
IHwgNDUgKysrKysrKy0tLS0tLS0tLS0tLQogLi4uL2RybS9pOTE1L2dlbS9zZWxmdGVzdHMvaTkx
NV9nZW1fY29udGV4dC5jIHwgIDQgKy0KIC4uLi9kcm0vaTkxNS9nZW0vc2VsZnRlc3RzL2k5MTVf
Z2VtX21tYW4uYyAgICB8ICA2ICstLQogLi4uL2k5MTUvZ2VtL3NlbGZ0ZXN0cy9pOTE1X2dlbV9v
YmplY3RfYmx0LmMgIHwgIDIgLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qvc2VsZnRlc3RfY29u
dGV4dC5jICAgIHwgIDQgKy0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L3NlbGZ0ZXN0X2hhbmdj
aGVjay5jICB8IDI4ICsrKystLS0tLS0tLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qvc2VsZnRl
c3RfbHJjLmMgICAgICAgIHwgMjEgKysrKystLS0tCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9z
ZWxmdGVzdF90aW1lbGluZS5jICAgfCAgNiArLS0KIC4uLi9ncHUvZHJtL2k5MTUvZ3Qvc2VsZnRl
c3Rfd29ya2Fyb3VuZHMuYyAgICB8ICA2ICstLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9k
ZWJ1Z2ZzLmMgICAgICAgICAgIHwgNDIgKysrKystLS0tLS0tLS0tLS0KIGRyaXZlcnMvZ3B1L2Ry
bS9pOTE1L2k5MTVfZ2VtLmMgICAgICAgICAgICAgICB8IDE5ICsrKystLS0tCiBkcml2ZXJzL2dw
dS9kcm0vaTkxNS9pOTE1X3JlcXVlc3QuaCAgICAgICAgICAgfCAgNyArKy0KIGRyaXZlcnMvZ3B1
L2RybS9pOTE1L3NlbGZ0ZXN0cy9pOTE1X2FjdGl2ZS5jICB8ICA4ICstLS0KIC4uLi9ncHUvZHJt
L2k5MTUvc2VsZnRlc3RzL2k5MTVfZ2VtX2V2aWN0LmMgICB8ICAyICstCiAuLi4vZ3B1L2RybS9p
OTE1L3NlbGZ0ZXN0cy9pOTE1X3NlbGZ0ZXN0LmMgICAgfCAgOCArLS0tCiAuLi4vZ3B1L2RybS9p
OTE1L3NlbGZ0ZXN0cy9pZ3RfZmx1c2hfdGVzdC5jICAgfCAzMCArKysrKy0tLS0tLS0tCiAuLi4v
Z3B1L2RybS9pOTE1L3NlbGZ0ZXN0cy9pZ3RfZmx1c2hfdGVzdC5oICAgfCAgMiArLQogLi4uL2dw
dS9kcm0vaTkxNS9zZWxmdGVzdHMvaWd0X2xpdmVfdGVzdC5jICAgIHwgIDkgKy0tLQogLi4uL2dw
dS9kcm0vaTkxNS9zZWxmdGVzdHMvbW9ja19nZW1fZGV2aWNlLmMgIHwgIDQgLS0KIDIxIGZpbGVz
IGNoYW5nZWQsIDkxIGluc2VydGlvbnMoKyksIDE4OSBkZWxldGlvbnMoLSkKCmRpZmYgLS1naXQg
YS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fY2xpZW50X2JsdC5jIGIvZHJpdmVy
cy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX2NsaWVudF9ibHQuYwppbmRleCBjMzQ1ZDNkNjJk
ZjEuLjM1MDIwNzFlMTM5MSAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5
MTVfZ2VtX2NsaWVudF9ibHQuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9n
ZW1fY2xpZW50X2JsdC5jCkBAIC0xNTUsNyArMTU1LDYgQEAgc3RhdGljIHZvaWQgY2xlYXJfcGFn
ZXNfZG1hX2ZlbmNlX2NiKHN0cnVjdCBkbWFfZmVuY2UgKmZlbmNlLAogc3RhdGljIHZvaWQgY2xl
YXJfcGFnZXNfd29ya2VyKHN0cnVjdCB3b3JrX3N0cnVjdCAqd29yaykKIHsKIAlzdHJ1Y3QgY2xl
YXJfcGFnZXNfd29yayAqdyA9IGNvbnRhaW5lcl9vZih3b3JrLCB0eXBlb2YoKncpLCB3b3JrKTsK
LQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IHctPmNlLT5lbmdpbmUtPmk5MTU7CiAJ
c3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iaiA9IHctPnNsZWV2ZS0+dm1hLT5vYmo7CiAJ
c3RydWN0IGk5MTVfdm1hICp2bWEgPSB3LT5zbGVldmUtPnZtYTsKIAlzdHJ1Y3QgaTkxNV9yZXF1
ZXN0ICpycTsKQEAgLTE3MywxMSArMTcyLDkgQEAgc3RhdGljIHZvaWQgY2xlYXJfcGFnZXNfd29y
a2VyKHN0cnVjdCB3b3JrX3N0cnVjdCAqd29yaykKIAlvYmotPnJlYWRfZG9tYWlucyA9IEk5MTVf
R0VNX0dQVV9ET01BSU5TOwogCW9iai0+d3JpdGVfZG9tYWluID0gMDsKIAotCS8qIFhYWDogd2Ug
bmVlZCB0byBraWxsIHRoaXMgKi8KLQltdXRleF9sb2NrKCZpOTE1LT5kcm0uc3RydWN0X211dGV4
KTsKIAllcnIgPSBpOTE1X3ZtYV9waW4odm1hLCAwLCAwLCBQSU5fVVNFUik7CiAJaWYgKHVubGlr
ZWx5KGVycikpCi0JCWdvdG8gb3V0X3VubG9jazsKKwkJZ290byBvdXRfc2lnbmFsOwogCiAJYmF0
Y2ggPSBpbnRlbF9lbWl0X3ZtYV9maWxsX2JsdCh3LT5jZSwgdm1hLCB3LT52YWx1ZSk7CiAJaWYg
KElTX0VSUihiYXRjaCkpIHsKQEAgLTIyOSw4ICsyMjYsNiBAQCBzdGF0aWMgdm9pZCBjbGVhcl9w
YWdlc193b3JrZXIoc3RydWN0IHdvcmtfc3RydWN0ICp3b3JrKQogCWludGVsX2VtaXRfdm1hX3Jl
bGVhc2Uody0+Y2UsIGJhdGNoKTsKIG91dF91bnBpbjoKIAlpOTE1X3ZtYV91bnBpbih2bWEpOwot
b3V0X3VubG9jazoKLQltdXRleF91bmxvY2soJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwogb3V0
X3NpZ25hbDoKIAlpZiAodW5saWtlbHkoZXJyKSkgewogCQlkbWFfZmVuY2Vfc2V0X2Vycm9yKCZ3
LT5kbWEsIGVycik7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9n
ZW1fY29udGV4dC5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX2NvbnRleHQu
YwppbmRleCAwOTVlYTY0N2M4NjIuLmRjMjExMzc2NzYwMyAxMDA2NDQKLS0tIGEvZHJpdmVycy9n
cHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX2NvbnRleHQuYworKysgYi9kcml2ZXJzL2dwdS9kcm0v
aTkxNS9nZW0vaTkxNV9nZW1fY29udGV4dC5jCkBAIC0xMTY0LDggKzExNjQsNyBAQCBnZW44X21v
ZGlmeV9ycGNzKHN0cnVjdCBpbnRlbF9jb250ZXh0ICpjZSwgc3RydWN0IGludGVsX3NzZXUgc3Nl
dSkKIH0KIAogc3RhdGljIGludAotX19pbnRlbF9jb250ZXh0X3JlY29uZmlndXJlX3NzZXUoc3Ry
dWN0IGludGVsX2NvbnRleHQgKmNlLAotCQkJCSBzdHJ1Y3QgaW50ZWxfc3NldSBzc2V1KQoraW50
ZWxfY29udGV4dF9yZWNvbmZpZ3VyZV9zc2V1KHN0cnVjdCBpbnRlbF9jb250ZXh0ICpjZSwgc3Ry
dWN0IGludGVsX3NzZXUgc3NldSkKIHsKIAlpbnQgcmV0OwogCkBAIC0xMTg4LDIzICsxMTg3LDYg
QEAgX19pbnRlbF9jb250ZXh0X3JlY29uZmlndXJlX3NzZXUoc3RydWN0IGludGVsX2NvbnRleHQg
KmNlLAogCXJldHVybiByZXQ7CiB9CiAKLXN0YXRpYyBpbnQKLWludGVsX2NvbnRleHRfcmVjb25m
aWd1cmVfc3NldShzdHJ1Y3QgaW50ZWxfY29udGV4dCAqY2UsIHN0cnVjdCBpbnRlbF9zc2V1IHNz
ZXUpCi17Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSBjZS0+ZW5naW5lLT5pOTE1
OwotCWludCByZXQ7Ci0KLQlyZXQgPSBtdXRleF9sb2NrX2ludGVycnVwdGlibGUoJmk5MTUtPmRy
bS5zdHJ1Y3RfbXV0ZXgpOwotCWlmIChyZXQpCi0JCXJldHVybiByZXQ7Ci0KLQlyZXQgPSBfX2lu
dGVsX2NvbnRleHRfcmVjb25maWd1cmVfc3NldShjZSwgc3NldSk7Ci0KLQltdXRleF91bmxvY2so
Jmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwotCi0JcmV0dXJuIHJldDsKLX0KLQogc3RhdGljIGlu
dAogdXNlcl90b19jb250ZXh0X3NzZXUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUsCiAJ
CSAgICAgY29uc3Qgc3RydWN0IGRybV9pOTE1X2dlbV9jb250ZXh0X3BhcmFtX3NzZXUgKnVzZXIs
CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fcG0uYyBiL2Ry
aXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9wbS5jCmluZGV4IDZlNGNjMTc3Y2M3YS4u
ZmVjMGI0MTBkMWQ5IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9n
ZW1fcG0uYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fcG0uYwpAQCAt
NDgsMTEgKzQ4LDcgQEAgc3RhdGljIHZvaWQgcmV0aXJlX3dvcmtfaGFuZGxlcihzdHJ1Y3Qgd29y
a19zdHJ1Y3QgKndvcmspCiAJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPQogCQljb250
YWluZXJfb2Yod29yaywgdHlwZW9mKCppOTE1KSwgZ2VtLnJldGlyZV93b3JrLndvcmspOwogCi0J
LyogQ29tZSBiYWNrIGxhdGVyIGlmIHRoZSBkZXZpY2UgaXMgYnVzeS4uLiAqLwotCWlmIChtdXRl
eF90cnlsb2NrKCZpOTE1LT5kcm0uc3RydWN0X211dGV4KSkgewotCQlpOTE1X3JldGlyZV9yZXF1
ZXN0cyhpOTE1KTsKLQkJbXV0ZXhfdW5sb2NrKCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsKLQl9
CisJaTkxNV9yZXRpcmVfcmVxdWVzdHMoaTkxNSk7CiAKIAlxdWV1ZV9kZWxheWVkX3dvcmsoaTkx
NS0+d3EsCiAJCQkgICAmaTkxNS0+Z2VtLnJldGlyZV93b3JrLApAQCAtODYsMjYgKzgyLDIzIEBA
IHN0YXRpYyBib29sIHN3aXRjaF90b19rZXJuZWxfY29udGV4dF9zeW5jKHN0cnVjdCBpbnRlbF9n
dCAqZ3QpCiB7CiAJYm9vbCByZXN1bHQgPSAhaW50ZWxfZ3RfaXNfd2VkZ2VkKGd0KTsKIAotCWRv
IHsKLQkJaWYgKGk5MTVfZ2VtX3dhaXRfZm9yX2lkbGUoZ3QtPmk5MTUsCi0JCQkJCSAgIEk5MTVf
V0FJVF9MT0NLRUQgfAotCQkJCQkgICBJOTE1X1dBSVRfRk9SX0lETEVfQk9PU1QsCi0JCQkJCSAg
IEk5MTVfR0VNX0lETEVfVElNRU9VVCkgPT0gLUVUSU1FKSB7Ci0JCQkvKiBYWFggaGlkZSB3YXJu
aW5nIGZyb20gZ2VtX2VpbyAqLwotCQkJaWYgKGk5MTVfbW9kcGFyYW1zLnJlc2V0KSB7Ci0JCQkJ
ZGV2X2VycihndC0+aTkxNS0+ZHJtLmRldiwKLQkJCQkJIkZhaWxlZCB0byBpZGxlIGVuZ2luZXMs
IGRlY2xhcmluZyB3ZWRnZWQhXG4iKTsKLQkJCQlHRU1fVFJBQ0VfRFVNUCgpOwotCQkJfQotCi0J
CQkvKgotCQkJICogRm9yY2libHkgY2FuY2VsIG91dHN0YW5kaW5nIHdvcmsgYW5kIGxlYXZlCi0J
CQkgKiB0aGUgZ3B1IHF1aWV0LgotCQkJICovCi0JCQlpbnRlbF9ndF9zZXRfd2VkZ2VkKGd0KTsK
LQkJCXJlc3VsdCA9IGZhbHNlOworCWlmIChpOTE1X2dlbV93YWl0X2Zvcl9pZGxlKGd0LT5pOTE1
LAorCQkJCSAgIEk5MTVfV0FJVF9GT1JfSURMRV9CT09TVCwKKwkJCQkgICBJOTE1X0dFTV9JRExF
X1RJTUVPVVQpID09IC1FVElNRSkgeworCQkvKiBYWFggaGlkZSB3YXJuaW5nIGZyb20gZ2VtX2Vp
byAqLworCQlpZiAoaTkxNV9tb2RwYXJhbXMucmVzZXQpIHsKKwkJCWRldl9lcnIoZ3QtPmk5MTUt
PmRybS5kZXYsCisJCQkJIkZhaWxlZCB0byBpZGxlIGVuZ2luZXMsIGRlY2xhcmluZyB3ZWRnZWQh
XG4iKTsKKwkJCUdFTV9UUkFDRV9EVU1QKCk7CiAJCX0KLQl9IHdoaWxlIChpOTE1X3JldGlyZV9y
ZXF1ZXN0cyhndC0+aTkxNSkgJiYgcmVzdWx0KTsKKworCQkvKgorCQkgKiBGb3JjaWJseSBjYW5j
ZWwgb3V0c3RhbmRpbmcgd29yayBhbmQgbGVhdmUKKwkJICogdGhlIGdwdSBxdWlldC4KKwkJICov
CisJCWludGVsX2d0X3NldF93ZWRnZWQoZ3QpOworCQlyZXN1bHQgPSBmYWxzZTsKKwl9CiAKIAlp
ZiAoaW50ZWxfZ3RfcG1fd2FpdF9mb3JfaWRsZShndCkpCiAJCXJlc3VsdCA9IGZhbHNlOwpAQCAt
MTI1LDggKzExOCw2IEBAIHZvaWQgaTkxNV9nZW1fc3VzcGVuZChzdHJ1Y3QgZHJtX2k5MTVfcHJp
dmF0ZSAqaTkxNSkKIAlpbnRlbF93YWtlcmVmX2F1dG8oJmk5MTUtPmdndHQudXNlcmZhdWx0X3dh
a2VyZWYsIDApOwogCWZsdXNoX3dvcmtxdWV1ZShpOTE1LT53cSk7CiAKLQltdXRleF9sb2NrKCZp
OTE1LT5kcm0uc3RydWN0X211dGV4KTsKLQogCS8qCiAJICogV2UgaGF2ZSB0byBmbHVzaCBhbGwg
dGhlIGV4ZWN1dGluZyBjb250ZXh0cyB0byBtYWluIG1lbW9yeSBzbwogCSAqIHRoYXQgdGhleSBj
YW4gc2F2ZWQgaW4gdGhlIGhpYmVybmF0aW9uIGltYWdlLiBUbyBlbnN1cmUgdGhlIGxhc3QKQEAg
LTEzOCw4ICsxMjksNiBAQCB2b2lkIGk5MTVfZ2VtX3N1c3BlbmQoc3RydWN0IGRybV9pOTE1X3By
aXZhdGUgKmk5MTUpCiAJICovCiAJc3dpdGNoX3RvX2tlcm5lbF9jb250ZXh0X3N5bmMoJmk5MTUt
Pmd0KTsKIAotCW11dGV4X3VubG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7Ci0KIAljYW5j
ZWxfZGVsYXllZF93b3JrX3N5bmMoJmk5MTUtPmd0LmhhbmdjaGVjay53b3JrKTsKIAogCWk5MTVf
Z2VtX2RyYWluX2ZyZWVkX29iamVjdHMoaTkxNSk7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9k
cm0vaTkxNS9nZW0vc2VsZnRlc3RzL2k5MTVfZ2VtX2NvbnRleHQuYyBiL2RyaXZlcnMvZ3B1L2Ry
bS9pOTE1L2dlbS9zZWxmdGVzdHMvaTkxNV9nZW1fY29udGV4dC5jCmluZGV4IDNhZGI2MGMyZmQx
Zi4uMWQwYTJlYzMzMDdhIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vc2Vs
ZnRlc3RzL2k5MTVfZ2VtX2NvbnRleHQuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0v
c2VsZnRlc3RzL2k5MTVfZ2VtX2NvbnRleHQuYwpAQCAtODkzLDcgKzg5Myw3IEBAIF9fc3NldV90
ZXN0KGNvbnN0IGNoYXIgKm5hbWUsCiAJaWYgKHJldCkKIAkJcmV0dXJuIHJldDsKIAotCXJldCA9
IF9faW50ZWxfY29udGV4dF9yZWNvbmZpZ3VyZV9zc2V1KGNlLCBzc2V1KTsKKwlyZXQgPSBpbnRl
bF9jb250ZXh0X3JlY29uZmlndXJlX3NzZXUoY2UsIHNzZXUpOwogCWlmIChyZXQpCiAJCWdvdG8g
b3V0X3NwaW47CiAKQEAgLTk5Nyw3ICs5OTcsNyBAQCBfX2lndF9jdHhfc3NldShzdHJ1Y3QgZHJt
X2k5MTVfcHJpdmF0ZSAqaTkxNSwKIAkJZ290byBvdXRfZmFpbDsKIAogb3V0X2ZhaWw6Ci0JaWYg
KGlndF9mbHVzaF90ZXN0KGk5MTUsIEk5MTVfV0FJVF9MT0NLRUQpKQorCWlmIChpZ3RfZmx1c2hf
dGVzdChpOTE1KSkKIAkJcmV0ID0gLUVJTzsKIAogCWludGVsX2NvbnRleHRfdW5waW4oY2UpOwpk
aWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL3NlbGZ0ZXN0cy9pOTE1X2dlbV9t
bWFuLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vc2VsZnRlc3RzL2k5MTVfZ2VtX21tYW4u
YwppbmRleCA5YzIxN2RmZTk2YTkuLjM5YzAxYmM0ZWI1MSAxMDA2NDQKLS0tIGEvZHJpdmVycy9n
cHUvZHJtL2k5MTUvZ2VtL3NlbGZ0ZXN0cy9pOTE1X2dlbV9tbWFuLmMKKysrIGIvZHJpdmVycy9n
cHUvZHJtL2k5MTUvZ2VtL3NlbGZ0ZXN0cy9pOTE1X2dlbV9tbWFuLmMKQEAgLTM5MywxMiArMzkz
LDggQEAgc3RhdGljIHZvaWQgZGlzYWJsZV9yZXRpcmVfd29ya2VyKHN0cnVjdCBkcm1faTkxNV9w
cml2YXRlICppOTE1KQogCiBzdGF0aWMgdm9pZCByZXN0b3JlX3JldGlyZV93b3JrZXIoc3RydWN0
IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpCiB7CisJaWd0X2ZsdXNoX3Rlc3QoaTkxNSk7CiAJaW50
ZWxfZ3RfcG1fcHV0KCZpOTE1LT5ndCk7Ci0KLQltdXRleF9sb2NrKCZpOTE1LT5kcm0uc3RydWN0
X211dGV4KTsKLQlpZ3RfZmx1c2hfdGVzdChpOTE1LCBJOTE1X1dBSVRfTE9DS0VEKTsKLQltdXRl
eF91bmxvY2soJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwotCiAJaTkxNV9nZW1fZHJpdmVyX3Jl
Z2lzdGVyX19zaHJpbmtlcihpOTE1KTsKIH0KIApkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJt
L2k5MTUvZ2VtL3NlbGZ0ZXN0cy9pOTE1X2dlbV9vYmplY3RfYmx0LmMgYi9kcml2ZXJzL2dwdS9k
cm0vaTkxNS9nZW0vc2VsZnRlc3RzL2k5MTVfZ2VtX29iamVjdF9ibHQuYwppbmRleCBjMjFkNzQ3
ZTdkMDUuLjVhMzUxOTk4YTk4ZCAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2Vt
L3NlbGZ0ZXN0cy9pOTE1X2dlbV9vYmplY3RfYmx0LmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5
MTUvZ2VtL3NlbGZ0ZXN0cy9pOTE1X2dlbV9vYmplY3RfYmx0LmMKQEAgLTE2Niw5ICsxNjYsNyBA
QCBzdGF0aWMgaW50IGlndF9jb3B5X2JsdCh2b2lkICphcmcpCiAJCWlmICghKGRzdC0+Y2FjaGVf
Y29oZXJlbnQgJiBJOTE1X0JPX0NBQ0hFX0NPSEVSRU5UX0ZPUl9XUklURSkpCiAJCQlkc3QtPmNh
Y2hlX2RpcnR5ID0gdHJ1ZTsKIAotCQltdXRleF9sb2NrKCZpOTE1LT5kcm0uc3RydWN0X211dGV4
KTsKIAkJZXJyID0gaTkxNV9nZW1fb2JqZWN0X2NvcHlfYmx0KHNyYywgZHN0LCBjZSk7Ci0JCW11
dGV4X3VubG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CiAJCWlmIChlcnIpCiAJCQlnb3Rv
IGVycl91bnBpbjsKIApkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qvc2VsZnRl
c3RfY29udGV4dC5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qvc2VsZnRlc3RfY29udGV4dC5j
CmluZGV4IDE0MjA1MzNlOGZkNS4uODgzNzM5MzU0YjA3IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dw
dS9kcm0vaTkxNS9ndC9zZWxmdGVzdF9jb250ZXh0LmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5
MTUvZ3Qvc2VsZnRlc3RfY29udGV4dC5jCkBAIC0zMTIsNyArMzEyLDcgQEAgc3RhdGljIGludCBs
aXZlX2FjdGl2ZV9jb250ZXh0KHZvaWQgKmFyZykKIAkJaWYgKGVycikKIAkJCWJyZWFrOwogCi0J
CWVyciA9IGlndF9mbHVzaF90ZXN0KGd0LT5pOTE1LCBJOTE1X1dBSVRfTE9DS0VEKTsKKwkJZXJy
ID0gaWd0X2ZsdXNoX3Rlc3QoZ3QtPmk5MTUpOwogCQlpZiAoZXJyKQogCQkJYnJlYWs7CiAJfQpA
QCAtNDI1LDcgKzQyNSw3IEBAIHN0YXRpYyBpbnQgbGl2ZV9yZW1vdGVfY29udGV4dCh2b2lkICph
cmcpCiAJCWlmIChlcnIpCiAJCQlicmVhazsKIAotCQllcnIgPSBpZ3RfZmx1c2hfdGVzdChndC0+
aTkxNSwgSTkxNV9XQUlUX0xPQ0tFRCk7CisJCWVyciA9IGlndF9mbHVzaF90ZXN0KGd0LT5pOTE1
KTsKIAkJaWYgKGVycikKIAkJCWJyZWFrOwogCX0KZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2Ry
bS9pOTE1L2d0L3NlbGZ0ZXN0X2hhbmdjaGVjay5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qv
c2VsZnRlc3RfaGFuZ2NoZWNrLmMKaW5kZXggZTUzZWVhMTA1MGY4Li4zNWFiNzAzZGFjMzQgMTAw
NjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L3NlbGZ0ZXN0X2hhbmdjaGVjay5jCisr
KyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L3NlbGZ0ZXN0X2hhbmdjaGVjay5jCkBAIC0yODUs
NyArMjg1LDcgQEAgc3RhdGljIHZvaWQgaGFuZ19maW5pKHN0cnVjdCBoYW5nICpoKQogCiAJa2Vy
bmVsX2NvbnRleHRfY2xvc2UoaC0+Y3R4KTsKIAotCWlndF9mbHVzaF90ZXN0KGgtPmd0LT5pOTE1
LCBJOTE1X1dBSVRfTE9DS0VEKTsKKwlpZ3RfZmx1c2hfdGVzdChoLT5ndC0+aTkxNSk7CiB9CiAK
IHN0YXRpYyBib29sIHdhaXRfdW50aWxfcnVubmluZyhzdHJ1Y3QgaGFuZyAqaCwgc3RydWN0IGk5
MTVfcmVxdWVzdCAqcnEpCkBAIC00MjksMTYgKzQyOSwxMyBAQCBzdGF0aWMgaW50IGlndF9yZXNl
dF9ub3Aodm9pZCAqYXJnKQogCQkJYnJlYWs7CiAJCX0KIAotCQllcnIgPSBpZ3RfZmx1c2hfdGVz
dChndC0+aTkxNSwgMCk7CisJCWVyciA9IGlndF9mbHVzaF90ZXN0KGd0LT5pOTE1KTsKIAkJaWYg
KGVycikKIAkJCWJyZWFrOwogCX0gd2hpbGUgKHRpbWVfYmVmb3JlKGppZmZpZXMsIGVuZF90aW1l
KSk7CiAJcHJfaW5mbygiJXM6ICVkIHJlc2V0c1xuIiwgX19mdW5jX18sIGNvdW50KTsKIAotCW11
dGV4X2xvY2soJmd0LT5pOTE1LT5kcm0uc3RydWN0X211dGV4KTsKLQllcnIgPSBpZ3RfZmx1c2hf
dGVzdChndC0+aTkxNSwgSTkxNV9XQUlUX0xPQ0tFRCk7Ci0JbXV0ZXhfdW5sb2NrKCZndC0+aTkx
NS0+ZHJtLnN0cnVjdF9tdXRleCk7Ci0KKwllcnIgPSBpZ3RfZmx1c2hfdGVzdChndC0+aTkxNSk7
CiBvdXQ6CiAJbW9ja19maWxlX2ZyZWUoZ3QtPmk5MTUsIGZpbGUpOwogCWlmIChpbnRlbF9ndF9p
c193ZWRnZWQoZ3QpKQpAQCAtNTMzLDE1ICs1MzAsMTIgQEAgc3RhdGljIGludCBpZ3RfcmVzZXRf
bm9wX2VuZ2luZSh2b2lkICphcmcpCiAJCWlmIChlcnIpCiAJCQlicmVhazsKIAotCQllcnIgPSBp
Z3RfZmx1c2hfdGVzdChndC0+aTkxNSwgMCk7CisJCWVyciA9IGlndF9mbHVzaF90ZXN0KGd0LT5p
OTE1KTsKIAkJaWYgKGVycikKIAkJCWJyZWFrOwogCX0KIAotCW11dGV4X2xvY2soJmd0LT5pOTE1
LT5kcm0uc3RydWN0X211dGV4KTsKLQllcnIgPSBpZ3RfZmx1c2hfdGVzdChndC0+aTkxNSwgSTkx
NV9XQUlUX0xPQ0tFRCk7Ci0JbXV0ZXhfdW5sb2NrKCZndC0+aTkxNS0+ZHJtLnN0cnVjdF9tdXRl
eCk7Ci0KKwllcnIgPSBpZ3RfZmx1c2hfdGVzdChndC0+aTkxNSk7CiBvdXQ6CiAJbW9ja19maWxl
X2ZyZWUoZ3QtPmk5MTUsIGZpbGUpOwogCWlmIChpbnRlbF9ndF9pc193ZWRnZWQoZ3QpKQpAQCAt
NjQ3LDcgKzY0MSw3IEBAIHN0YXRpYyBpbnQgX19pZ3RfcmVzZXRfZW5naW5lKHN0cnVjdCBpbnRl
bF9ndCAqZ3QsIGJvb2wgYWN0aXZlKQogCQlpZiAoZXJyKQogCQkJYnJlYWs7CiAKLQkJZXJyID0g
aWd0X2ZsdXNoX3Rlc3QoZ3QtPmk5MTUsIDApOworCQllcnIgPSBpZ3RfZmx1c2hfdGVzdChndC0+
aTkxNSk7CiAJCWlmIChlcnIpCiAJCQlicmVhazsKIAl9CkBAIC05NzcsOSArOTcxLDcgQEAgc3Rh
dGljIGludCBfX2lndF9yZXNldF9lbmdpbmVzKHN0cnVjdCBpbnRlbF9ndCAqZ3QsCiAJCWlmIChl
cnIpCiAJCQlicmVhazsKIAotCQltdXRleF9sb2NrKCZndC0+aTkxNS0+ZHJtLnN0cnVjdF9tdXRl
eCk7Ci0JCWVyciA9IGlndF9mbHVzaF90ZXN0KGd0LT5pOTE1LCBJOTE1X1dBSVRfTE9DS0VEKTsK
LQkJbXV0ZXhfdW5sb2NrKCZndC0+aTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CisJCWVyciA9IGln
dF9mbHVzaF90ZXN0KGd0LT5pOTE1KTsKIAkJaWYgKGVycikKIAkJCWJyZWFrOwogCX0KQEAgLTE1
MTEsNyArMTUwMyw3IEBAIHN0YXRpYyBpbnQgaWd0X3Jlc2V0X3F1ZXVlKHZvaWQgKmFyZykKIAog
CQlpOTE1X3JlcXVlc3RfcHV0KHByZXYpOwogCi0JCWVyciA9IGlndF9mbHVzaF90ZXN0KGd0LT5p
OTE1LCBJOTE1X1dBSVRfTE9DS0VEKTsKKwkJZXJyID0gaWd0X2ZsdXNoX3Rlc3QoZ3QtPmk5MTUp
OwogCQlpZiAoZXJyKQogCQkJYnJlYWs7CiAJfQpAQCAtMTc1MSwxMCArMTc0Myw2IEBAIGludCBp
bnRlbF9oYW5nY2hlY2tfbGl2ZV9zZWxmdGVzdHMoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5
MTUpCiAKIAllcnIgPSBpbnRlbF9ndF9saXZlX3N1YnRlc3RzKHRlc3RzLCBndCk7CiAKLQltdXRl
eF9sb2NrKCZndC0+aTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7Ci0JaWd0X2ZsdXNoX3Rlc3QoZ3Qt
Pmk5MTUsIEk5MTVfV0FJVF9MT0NLRUQpOwotCW11dGV4X3VubG9jaygmZ3QtPmk5MTUtPmRybS5z
dHJ1Y3RfbXV0ZXgpOwotCiAJaTkxNV9tb2RwYXJhbXMuZW5hYmxlX2hhbmdjaGVjayA9IHNhdmVk
X2hhbmdjaGVjazsKIAlpbnRlbF9ydW50aW1lX3BtX3B1dCgmZ3QtPmk5MTUtPnJ1bnRpbWVfcG0s
IHdha2VyZWYpOwogCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9zZWxmdGVz
dF9scmMuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L3NlbGZ0ZXN0X2xyYy5jCmluZGV4IGFj
YTFiM2E5YzVkZS4uMjIyYTczNzVjNzg3IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkx
NS9ndC9zZWxmdGVzdF9scmMuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9zZWxmdGVz
dF9scmMuYwpAQCAtNjEsNyArNjEsNyBAQCBzdGF0aWMgaW50IGxpdmVfc2FuaXR5Y2hlY2sodm9p
ZCAqYXJnKQogCQl9CiAKIAkJaWd0X3NwaW5uZXJfZW5kKCZzcGluKTsKLQkJaWYgKGlndF9mbHVz
aF90ZXN0KGk5MTUsIEk5MTVfV0FJVF9MT0NLRUQpKSB7CisJCWlmIChpZ3RfZmx1c2hfdGVzdChp
OTE1KSkgewogCQkJZXJyID0gLUVJTzsKIAkJCWdvdG8gZXJyX2N0eDsKIAkJfQpAQCAtMjA2LDgg
KzIwNiw3IEBAIHNsaWNlX3NlbWFwaG9yZV9xdWV1ZShzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICpv
dXRlciwKIAlpZiAoZXJyKQogCQlnb3RvIG91dDsKIAotCWlmIChpOTE1X3JlcXVlc3Rfd2FpdCho
ZWFkLAotCQkJICAgICAgSTkxNV9XQUlUX0xPQ0tFRCwKKwlpZiAoaTkxNV9yZXF1ZXN0X3dhaXQo
aGVhZCwgMCwKIAkJCSAgICAgIDIgKiBSVU5USU1FX0lORk8ob3V0ZXItPmk5MTUpLT5udW1fZW5n
aW5lcyAqIChjb3VudCArIDIpICogKGNvdW50ICsgMykpIDwgMCkgewogCQlwcl9lcnIoIkZhaWxl
ZCB0byBzbGljZSBhbG9uZyBzZW1hcGhvcmUgY2hhaW4gb2YgbGVuZ3RoICglZCwgJWQpIVxuIiwK
IAkJICAgICAgIGNvdW50LCBuKTsKQEAgLTI3OSw3ICsyNzgsNyBAQCBzdGF0aWMgaW50IGxpdmVf
dGltZXNsaWNlX3ByZWVtcHQodm9pZCAqYXJnKQogCQkJaWYgKGVycikKIAkJCQlnb3RvIGVycl9w
aW47CiAKLQkJCWlmIChpZ3RfZmx1c2hfdGVzdChpOTE1LCBJOTE1X1dBSVRfTE9DS0VEKSkgewor
CQkJaWYgKGlndF9mbHVzaF90ZXN0KGk5MTUpKSB7CiAJCQkJZXJyID0gLUVJTzsKIAkJCQlnb3Rv
IGVycl9waW47CiAJCQl9CkBAIC04MzIsNyArODMxLDcgQEAgc3RhdGljIGludCBsaXZlX25vcHJl
ZW1wdCh2b2lkICphcmcpCiAJCQlnb3RvIGVycl93ZWRnZWQ7CiAJCX0KIAotCQlpZiAoaWd0X2Zs
dXNoX3Rlc3QoaTkxNSwgSTkxNV9XQUlUX0xPQ0tFRCkpCisJCWlmIChpZ3RfZmx1c2hfdGVzdChp
OTE1KSkKIAkJCWdvdG8gZXJyX3dlZGdlZDsKIAl9CiAKQEAgLTk0OCw3ICs5NDcsNyBAQCBzdGF0
aWMgaW50IGxpdmVfc3VwcHJlc3Nfc2VsZl9wcmVlbXB0KHZvaWQgKmFyZykKIAkJCWdvdG8gZXJy
X2NsaWVudF9iOwogCQl9CiAKLQkJaWYgKGlndF9mbHVzaF90ZXN0KGk5MTUsIEk5MTVfV0FJVF9M
T0NLRUQpKQorCQlpZiAoaWd0X2ZsdXNoX3Rlc3QoaTkxNSkpCiAJCQlnb3RvIGVycl93ZWRnZWQ7
CiAJfQogCkBAIC0xMTA5LDcgKzExMDgsNyBAQCBzdGF0aWMgaW50IGxpdmVfc3VwcHJlc3Nfd2Fp
dF9wcmVlbXB0KHZvaWQgKmFyZykKIAkJCWZvciAoaSA9IDA7IGkgPCBBUlJBWV9TSVpFKGNsaWVu
dCk7IGkrKykKIAkJCQlpZ3Rfc3Bpbm5lcl9lbmQoJmNsaWVudFtpXS5zcGluKTsKIAotCQkJaWYg
KGlndF9mbHVzaF90ZXN0KGk5MTUsIEk5MTVfV0FJVF9MT0NLRUQpKQorCQkJaWYgKGlndF9mbHVz
aF90ZXN0KGk5MTUpKQogCQkJCWdvdG8gZXJyX3dlZGdlZDsKIAogCQkJaWYgKGVuZ2luZS0+ZXhl
Y2xpc3RzLnByZWVtcHRfaGFuZy5jb3VudCkgewpAQCAtMTM4OCw3ICsxMzg3LDcgQEAgc3RhdGlj
IGludCBsaXZlX3ByZWVtcHRfaGFuZyh2b2lkICphcmcpCiAKIAkJaWd0X3NwaW5uZXJfZW5kKCZz
cGluX2hpKTsKIAkJaWd0X3NwaW5uZXJfZW5kKCZzcGluX2xvKTsKLQkJaWYgKGlndF9mbHVzaF90
ZXN0KGk5MTUsIEk5MTVfV0FJVF9MT0NLRUQpKSB7CisJCWlmIChpZ3RfZmx1c2hfdGVzdChpOTE1
KSkgewogCQkJZXJyID0gLUVJTzsKIAkJCWdvdG8gZXJyX2N0eF9sbzsKIAkJfQpAQCAtMTc4NSw3
ICsxNzg0LDcgQEAgc3RhdGljIGludCBub3BfdmlydHVhbF9lbmdpbmUoc3RydWN0IGRybV9pOTE1
X3ByaXZhdGUgKmk5MTUsCiAJCXByaW1lLCBkaXY2NF91NjQoa3RpbWVfdG9fbnModGltZXNbMV0p
LCBwcmltZSkpOwogCiBvdXQ6Ci0JaWYgKGlndF9mbHVzaF90ZXN0KGk5MTUsIEk5MTVfV0FJVF9M
T0NLRUQpKQorCWlmIChpZ3RfZmx1c2hfdGVzdChpOTE1KSkKIAkJZXJyID0gLUVJTzsKIAogCWZv
ciAobmMgPSAwOyBuYyA8IG5jdHg7IG5jKyspIHsKQEAgLTE5MzAsNyArMTkyOSw3IEBAIHN0YXRp
YyBpbnQgbWFza192aXJ0dWFsX2VuZ2luZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwK
IAkJZ290byBvdXQ7CiAKIG91dDoKLQlpZiAoaWd0X2ZsdXNoX3Rlc3QoaTkxNSwgSTkxNV9XQUlU
X0xPQ0tFRCkpCisJaWYgKGlndF9mbHVzaF90ZXN0KGk5MTUpKQogCQllcnIgPSAtRUlPOwogCiAJ
Zm9yIChuID0gMDsgbiA8IG5zaWJsaW5nOyBuKyspCkBAIC0yMTA4LDcgKzIxMDcsNyBAQCBzdGF0
aWMgaW50IGJvbmRfdmlydHVhbF9lbmdpbmUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUs
CiBvdXQ6CiAJZm9yIChuID0gMDsgIUlTX0VSUihycVtuXSk7IG4rKykKIAkJaTkxNV9yZXF1ZXN0
X3B1dChycVtuXSk7Ci0JaWYgKGlndF9mbHVzaF90ZXN0KGk5MTUsIEk5MTVfV0FJVF9MT0NLRUQp
KQorCWlmIChpZ3RfZmx1c2hfdGVzdChpOTE1KSkKIAkJZXJyID0gLUVJTzsKIAogCWtlcm5lbF9j
b250ZXh0X2Nsb3NlKGN0eCk7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9z
ZWxmdGVzdF90aW1lbGluZS5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qvc2VsZnRlc3RfdGlt
ZWxpbmUuYwppbmRleCAzMjE0ODE0MDMxNjUuLjQyZDBiYmJiYzdlYSAxMDA2NDQKLS0tIGEvZHJp
dmVycy9ncHUvZHJtL2k5MTUvZ3Qvc2VsZnRlc3RfdGltZWxpbmUuYworKysgYi9kcml2ZXJzL2dw
dS9kcm0vaTkxNS9ndC9zZWxmdGVzdF90aW1lbGluZS5jCkBAIC01NDUsNyArNTQ1LDcgQEAgc3Rh
dGljIGludCBsaXZlX2h3c3BfZW5naW5lKHZvaWQgKmFyZykKIAl9CiAKIG91dDoKLQlpZiAoaWd0
X2ZsdXNoX3Rlc3QoaTkxNSwgSTkxNV9XQUlUX0xPQ0tFRCkpCisJaWYgKGlndF9mbHVzaF90ZXN0
KGk5MTUpKQogCQllcnIgPSAtRUlPOwogCiAJZm9yIChuID0gMDsgbiA8IGNvdW50OyBuKyspIHsK
QEAgLTYyMSw3ICs2MjEsNyBAQCBzdGF0aWMgaW50IGxpdmVfaHdzcF9hbHRlcm5hdGUodm9pZCAq
YXJnKQogCX0KIAogb3V0OgotCWlmIChpZ3RfZmx1c2hfdGVzdChpOTE1LCBJOTE1X1dBSVRfTE9D
S0VEKSkKKwlpZiAoaWd0X2ZsdXNoX3Rlc3QoaTkxNSkpCiAJCWVyciA9IC1FSU87CiAKIAlmb3Ig
KG4gPSAwOyBuIDwgY291bnQ7IG4rKykgewpAQCAtNzQ3LDcgKzc0Nyw3IEBAIHN0YXRpYyBpbnQg
bGl2ZV9od3NwX3dyYXAodm9pZCAqYXJnKQogCX0KIAogb3V0OgotCWlmIChpZ3RfZmx1c2hfdGVz
dChpOTE1LCBJOTE1X1dBSVRfTE9DS0VEKSkKKwlpZiAoaWd0X2ZsdXNoX3Rlc3QoaTkxNSkpCiAJ
CWVyciA9IC1FSU87CiAKIAlpbnRlbF90aW1lbGluZV91bnBpbih0bCk7CmRpZmYgLS1naXQgYS9k
cml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9zZWxmdGVzdF93b3JrYXJvdW5kcy5jIGIvZHJpdmVycy9n
cHUvZHJtL2k5MTUvZ3Qvc2VsZnRlc3Rfd29ya2Fyb3VuZHMuYwppbmRleCBkMDZkNjhhYzJhM2Iu
LjE3M2RmNTUwNzUyNSAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qvc2VsZnRl
c3Rfd29ya2Fyb3VuZHMuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9zZWxmdGVzdF93
b3JrYXJvdW5kcy5jCkBAIC02NjgsNyArNjY4LDcgQEAgc3RhdGljIGludCBjaGVja19kaXJ0eV93
aGl0ZWxpc3Qoc3RydWN0IGk5MTVfZ2VtX2NvbnRleHQgKmN0eCwKIAkJCWJyZWFrOwogCX0KIAot
CWlmIChpZ3RfZmx1c2hfdGVzdChjdHgtPmk5MTUsIEk5MTVfV0FJVF9MT0NLRUQpKQorCWlmIChp
Z3RfZmx1c2hfdGVzdChjdHgtPmk5MTUpKQogCQllcnIgPSAtRUlPOwogb3V0X2JhdGNoOgogCWk5
MTVfdm1hX3VucGluX2FuZF9yZWxlYXNlKCZiYXRjaCwgMCk7CkBAIC0xMDc0LDcgKzEwNzQsNyBA
QCBzdGF0aWMgaW50IGxpdmVfaXNvbGF0ZWRfd2hpdGVsaXN0KHZvaWQgKmFyZykKIAkJa2VybmVs
X2NvbnRleHRfY2xvc2UoY2xpZW50W2ldLmN0eCk7CiAJfQogCi0JaWYgKGlndF9mbHVzaF90ZXN0
KGk5MTUsIEk5MTVfV0FJVF9MT0NLRUQpKQorCWlmIChpZ3RfZmx1c2hfdGVzdChpOTE1KSkKIAkJ
ZXJyID0gLUVJTzsKIAogCXJldHVybiBlcnI7CkBAIC0xMjMyLDcgKzEyMzIsNyBAQCBsaXZlX2Vu
Z2luZV9yZXNldF93b3JrYXJvdW5kcyh2b2lkICphcmcpCiAJaWd0X2dsb2JhbF9yZXNldF91bmxv
Y2soJmk5MTUtPmd0KTsKIAlrZXJuZWxfY29udGV4dF9jbG9zZShjdHgpOwogCi0JaWd0X2ZsdXNo
X3Rlc3QoaTkxNSwgSTkxNV9XQUlUX0xPQ0tFRCk7CisJaWd0X2ZsdXNoX3Rlc3QoaTkxNSk7CiAK
IAlyZXR1cm4gcmV0OwogfQpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9k
ZWJ1Z2ZzLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2RlYnVnZnMuYwppbmRleCBjMzY1
MzhmMWIzNmMuLjMyMTY4YjlhM2Y0ZSAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUv
aTkxNV9kZWJ1Z2ZzLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9kZWJ1Z2ZzLmMK
QEAgLTM2MDcsNiArMzYwNyw3IEBAIHN0YXRpYyBpbnQKIGk5MTVfZHJvcF9jYWNoZXNfc2V0KHZv
aWQgKmRhdGEsIHU2NCB2YWwpCiB7CiAJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSBk
YXRhOworCWludCByZXQ7CiAKIAlEUk1fREVCVUcoIkRyb3BwaW5nIGNhY2hlczogMHglMDhsbHgg
WzB4JTA4bGx4XVxuIiwKIAkJICB2YWwsIHZhbCAmIERST1BfQUxMKTsKQEAgLTM2MTYsNDAgKzM2
MTcsMjEgQEAgaTkxNV9kcm9wX2NhY2hlc19zZXQodm9pZCAqZGF0YSwgdTY0IHZhbCkKIAkJICAg
ICBJOTE1X0lETEVfRU5HSU5FU19USU1FT1VUKSkKIAkJaW50ZWxfZ3Rfc2V0X3dlZGdlZCgmaTkx
NS0+Z3QpOwogCi0JLyogTm8gbmVlZCB0byBjaGVjayBhbmQgd2FpdCBmb3IgZ3B1IHJlc2V0cywg
b25seSBsaWJkcm0gYXV0by1yZXN0YXJ0cwotCSAqIG9uIGlvY3RscyBvbiAtRUFHQUlOLiAqLwot
CWlmICh2YWwgJiAoRFJPUF9BQ1RJVkUgfCBEUk9QX0lETEUgfCBEUk9QX1JFVElSRSB8IERST1Bf
UkVTRVRfU0VRTk8pKSB7Ci0JCWludCByZXQ7CisJaWYgKHZhbCAmIERST1BfUkVUSVJFKQorCQlp
OTE1X3JldGlyZV9yZXF1ZXN0cyhpOTE1KTsKIAotCQlyZXQgPSBtdXRleF9sb2NrX2ludGVycnVw
dGlibGUoJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOworCWlmICh2YWwgJiAoRFJPUF9JRExFIHwg
RFJPUF9BQ1RJVkUpKSB7CisJCXJldCA9IGk5MTVfZ2VtX3dhaXRfZm9yX2lkbGUoaTkxNSwKKwkJ
CQkJICAgICBJOTE1X1dBSVRfSU5URVJSVVBUSUJMRSwKKwkJCQkJICAgICBNQVhfU0NIRURVTEVf
VElNRU9VVCk7CiAJCWlmIChyZXQpCiAJCQlyZXR1cm4gcmV0OworCX0KIAotCQkvKgotCQkgKiBU
byBmaW5pc2ggdGhlIGZsdXNoIG9mIHRoZSBpZGxlX3dvcmtlciwgd2UgbXVzdCBjb21wbGV0ZQot
CQkgKiB0aGUgc3dpdGNoLXRvLWtlcm5lbC1jb250ZXh0LCB3aGljaCByZXF1aXJlcyBhIGRvdWJs
ZQotCQkgKiBwYXNzIHRocm91Z2ggd2FpdF9mb3JfaWRsZTogZmlyc3QgcXVldWVzIHRoZSBzd2l0
Y2gsCi0JCSAqIHNlY29uZCB3YWl0cyBmb3IgdGhlIHN3aXRjaC4KLQkJICovCi0JCWlmIChyZXQg
PT0gMCAmJiB2YWwgJiAoRFJPUF9JRExFIHwgRFJPUF9BQ1RJVkUpKQotCQkJcmV0ID0gaTkxNV9n
ZW1fd2FpdF9mb3JfaWRsZShpOTE1LAotCQkJCQkJICAgICBJOTE1X1dBSVRfSU5URVJSVVBUSUJM
RSB8Ci0JCQkJCQkgICAgIEk5MTVfV0FJVF9MT0NLRUQsCi0JCQkJCQkgICAgIE1BWF9TQ0hFRFVM
RV9USU1FT1VUKTsKLQotCQlpZiAocmV0ID09IDAgJiYgdmFsICYgRFJPUF9JRExFKQotCQkJcmV0
ID0gaTkxNV9nZW1fd2FpdF9mb3JfaWRsZShpOTE1LAotCQkJCQkJICAgICBJOTE1X1dBSVRfSU5U
RVJSVVBUSUJMRSB8Ci0JCQkJCQkgICAgIEk5MTVfV0FJVF9MT0NLRUQsCi0JCQkJCQkgICAgIE1B
WF9TQ0hFRFVMRV9USU1FT1VUKTsKLQotCQlpZiAodmFsICYgRFJPUF9SRVRJUkUpCi0JCQlpOTE1
X3JldGlyZV9yZXF1ZXN0cyhpOTE1KTsKLQotCQltdXRleF91bmxvY2soJmk5MTUtPmRybS5zdHJ1
Y3RfbXV0ZXgpOwotCi0JCWlmIChyZXQgPT0gMCAmJiB2YWwgJiBEUk9QX0lETEUpCi0JCQlyZXQg
PSBpbnRlbF9ndF9wbV93YWl0X2Zvcl9pZGxlKCZpOTE1LT5ndCk7CisJaWYgKHZhbCAmIERST1Bf
SURMRSkgeworCQlyZXQgPSBpbnRlbF9ndF9wbV93YWl0X2Zvcl9pZGxlKCZpOTE1LT5ndCk7CisJ
CWlmIChyZXQpCisJCQlyZXR1cm4gcmV0OwogCX0KIAogCWlmICh2YWwgJiBEUk9QX1JFU0VUX0FD
VElWRSAmJiBpbnRlbF9ndF90ZXJtaW5hbGx5X3dlZGdlZCgmaTkxNS0+Z3QpKQpkaWZmIC0tZ2l0
IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9nZW0uYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1
L2k5MTVfZ2VtLmMKaW5kZXggOGY0YzhjMjljYWI4Li5hMTRiMmFkMTNjZDUgMTAwNjQ0Ci0tLSBh
L2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZ2VtLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5
MTUvaTkxNV9nZW0uYwpAQCAtOTQzLDE5ICs5NDMsMTYgQEAgaW50IGk5MTVfZ2VtX3dhaXRfZm9y
X2lkbGUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUsCiAJaWYgKCFpbnRlbF9ndF9wbV9p
c19hd2FrZSgmaTkxNS0+Z3QpKQogCQlyZXR1cm4gMDsKIAotCUdFTV9UUkFDRSgiZmxhZ3M9JXgg
KCVzKSwgdGltZW91dD0lbGQlc1xuIiwKLQkJICBmbGFncywgZmxhZ3MgJiBJOTE1X1dBSVRfTE9D
S0VEID8gImxvY2tlZCIgOiAidW5sb2NrZWQiLAotCQkgIHRpbWVvdXQsIHRpbWVvdXQgPT0gTUFY
X1NDSEVEVUxFX1RJTUVPVVQgPyAiIChmb3JldmVyKSIgOiAiIik7Ci0KLQl0aW1lb3V0ID0gd2Fp
dF9mb3JfdGltZWxpbmVzKGk5MTUsIGZsYWdzLCB0aW1lb3V0KTsKLQlpZiAodGltZW91dCA8IDAp
Ci0JCXJldHVybiB0aW1lb3V0OworCWRvIHsKKwkJdGltZW91dCA9IHdhaXRfZm9yX3RpbWVsaW5l
cyhpOTE1LCBmbGFncywgdGltZW91dCk7CisJCWlmICh0aW1lb3V0IDwgMCkKKwkJCXJldHVybiB0
aW1lb3V0OwogCi0JaWYgKGZsYWdzICYgSTkxNV9XQUlUX0xPQ0tFRCkgewotCQlsb2NrZGVwX2Fz
c2VydF9oZWxkKCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsKKwkJY29uZF9yZXNjaGVkKCk7CisJ
CWlmIChzaWduYWxfcGVuZGluZyhjdXJyZW50KSkKKwkJCXJldHVybiAtRUlOVFI7CiAKLQkJaTkx
NV9yZXRpcmVfcmVxdWVzdHMoaTkxNSk7Ci0JfQorCX0gd2hpbGUgKGk5MTVfcmV0aXJlX3JlcXVl
c3RzKGk5MTUpKTsKIAogCXJldHVybiAwOwogfQpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJt
L2k5MTUvaTkxNV9yZXF1ZXN0LmggYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3JlcXVlc3Qu
aAppbmRleCAzMjUxZDJiZGJlZWEuLjU3YTIxOTNjNjRkMSAxMDA2NDQKLS0tIGEvZHJpdmVycy9n
cHUvZHJtL2k5MTUvaTkxNV9yZXF1ZXN0LmgKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkx
NV9yZXF1ZXN0LmgKQEAgLTMwOCwxMCArMzA4LDkgQEAgbG9uZyBpOTE1X3JlcXVlc3Rfd2FpdChz
dHJ1Y3QgaTkxNV9yZXF1ZXN0ICpycSwKIAkJICAgICAgIGxvbmcgdGltZW91dCkKIAlfX2F0dHJp
YnV0ZV9fKChub25udWxsKDEpKSk7CiAjZGVmaW5lIEk5MTVfV0FJVF9JTlRFUlJVUFRJQkxFCUJJ
VCgwKQotI2RlZmluZSBJOTE1X1dBSVRfTE9DS0VECUJJVCgxKSAvKiBzdHJ1Y3RfbXV0ZXggaGVs
ZCwgaGFuZGxlIEdQVSByZXNldCAqLwotI2RlZmluZSBJOTE1X1dBSVRfUFJJT1JJVFkJQklUKDIp
IC8qIHNtYWxsIHByaW9yaXR5IGJ1bXAgZm9yIHRoZSByZXF1ZXN0ICovCi0jZGVmaW5lIEk5MTVf
V0FJVF9BTEwJCUJJVCgzKSAvKiB1c2VkIGJ5IGk5MTVfZ2VtX29iamVjdF93YWl0KCkgKi8KLSNk
ZWZpbmUgSTkxNV9XQUlUX0ZPUl9JRExFX0JPT1NUIEJJVCg0KQorI2RlZmluZSBJOTE1X1dBSVRf
UFJJT1JJVFkJQklUKDEpIC8qIHNtYWxsIHByaW9yaXR5IGJ1bXAgZm9yIHRoZSByZXF1ZXN0ICov
CisjZGVmaW5lIEk5MTVfV0FJVF9BTEwJCUJJVCgyKSAvKiB1c2VkIGJ5IGk5MTVfZ2VtX29iamVj
dF93YWl0KCkgKi8KKyNkZWZpbmUgSTkxNV9XQUlUX0ZPUl9JRExFX0JPT1NUIEJJVCgzKQogCiBz
dGF0aWMgaW5saW5lIGJvb2wgaTkxNV9yZXF1ZXN0X3NpZ25hbGVkKGNvbnN0IHN0cnVjdCBpOTE1
X3JlcXVlc3QgKnJxKQogewpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvc2VsZnRl
c3RzL2k5MTVfYWN0aXZlLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMvaTkxNV9h
Y3RpdmUuYwppbmRleCBhZjU4MjdhYWM3YjIuLmZmMTMzN2UzNDUyMiAxMDA2NDQKLS0tIGEvZHJp
dmVycy9ncHUvZHJtL2k5MTUvc2VsZnRlc3RzL2k5MTVfYWN0aXZlLmMKKysrIGIvZHJpdmVycy9n
cHUvZHJtL2k5MTUvc2VsZnRlc3RzL2k5MTVfYWN0aXZlLmMKQEAgLTE2NCwxMCArMTY0LDggQEAg
c3RhdGljIGludCBsaXZlX2FjdGl2ZV93YWl0KHZvaWQgKmFyZykKIAogCV9fbGl2ZV9wdXQoYWN0
aXZlKTsKIAotCW11dGV4X2xvY2soJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwotCWlmIChpZ3Rf
Zmx1c2hfdGVzdChpOTE1LCBJOTE1X1dBSVRfTE9DS0VEKSkKKwlpZiAoaWd0X2ZsdXNoX3Rlc3Qo
aTkxNSkpCiAJCWVyciA9IC1FSU87Ci0JbXV0ZXhfdW5sb2NrKCZpOTE1LT5kcm0uc3RydWN0X211
dGV4KTsKIAogCXJldHVybiBlcnI7CiB9CkBAIC0xODUsMTAgKzE4Myw4IEBAIHN0YXRpYyBpbnQg
bGl2ZV9hY3RpdmVfcmV0aXJlKHZvaWQgKmFyZykKIAkJcmV0dXJuIFBUUl9FUlIoYWN0aXZlKTsK
IAogCS8qIHdhaXRzIGZvciAmIHJldGlyZXMgYWxsIHJlcXVlc3RzICovCi0JbXV0ZXhfbG9jaygm
aTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7Ci0JaWYgKGlndF9mbHVzaF90ZXN0KGk5MTUsIEk5MTVf
V0FJVF9MT0NLRUQpKQorCWlmIChpZ3RfZmx1c2hfdGVzdChpOTE1KSkKIAkJZXJyID0gLUVJTzsK
LQltdXRleF91bmxvY2soJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwogCiAJaWYgKCFSRUFEX09O
Q0UoYWN0aXZlLT5yZXRpcmVkKSkgewogCQlwcl9lcnIoImk5MTVfYWN0aXZlIG5vdCByZXRpcmVk
IGFmdGVyIGZsdXNoaW5nIVxuIik7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9z
ZWxmdGVzdHMvaTkxNV9nZW1fZXZpY3QuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L3NlbGZ0ZXN0
cy9pOTE1X2dlbV9ldmljdC5jCmluZGV4IGJhNjA2NDE0NzE3My4uNDIxMzlkYjBkNjljIDEwMDY0
NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMvaTkxNV9nZW1fZXZpY3QuYwor
KysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMvaTkxNV9nZW1fZXZpY3QuYwpAQCAt
NTIxLDcgKzUyMSw3IEBAIHN0YXRpYyBpbnQgaWd0X2V2aWN0X2NvbnRleHRzKHZvaWQgKmFyZykK
IAogCW11dGV4X2xvY2soJmk5MTUtPmdndHQudm0ubXV0ZXgpOwogb3V0X2xvY2tlZDoKLQlpZiAo
aWd0X2ZsdXNoX3Rlc3QoaTkxNSwgSTkxNV9XQUlUX0xPQ0tFRCkpCisJaWYgKGlndF9mbHVzaF90
ZXN0KGk5MTUpKQogCQllcnIgPSAtRUlPOwogCXdoaWxlIChyZXNlcnZlZCkgewogCQlzdHJ1Y3Qg
cmVzZXJ2ZWQgKm5leHQgPSByZXNlcnZlZC0+bmV4dDsKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1
L2RybS9pOTE1L3NlbGZ0ZXN0cy9pOTE1X3NlbGZ0ZXN0LmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkx
NS9zZWxmdGVzdHMvaTkxNV9zZWxmdGVzdC5jCmluZGV4IDQzOGVhMGVhYTQxNi4uODI1YTgyODZj
YmU4IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMvaTkxNV9zZWxm
dGVzdC5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L3NlbGZ0ZXN0cy9pOTE1X3NlbGZ0ZXN0
LmMKQEAgLTI2MywxMCArMjYzLDggQEAgaW50IF9faTkxNV9saXZlX3RlYXJkb3duKGludCBlcnIs
IHZvaWQgKmRhdGEpCiB7CiAJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSBkYXRhOwog
Ci0JbXV0ZXhfbG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7Ci0JaWYgKGlndF9mbHVzaF90
ZXN0KGk5MTUsIEk5MTVfV0FJVF9MT0NLRUQpKQorCWlmIChpZ3RfZmx1c2hfdGVzdChpOTE1KSkK
IAkJZXJyID0gLUVJTzsKLQltdXRleF91bmxvY2soJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwog
CiAJaTkxNV9nZW1fZHJhaW5fZnJlZWRfb2JqZWN0cyhpOTE1KTsKIApAQCAtMjg0LDEwICsyODIs
OCBAQCBpbnQgX19pbnRlbF9ndF9saXZlX3RlYXJkb3duKGludCBlcnIsIHZvaWQgKmRhdGEpCiB7
CiAJc3RydWN0IGludGVsX2d0ICpndCA9IGRhdGE7CiAKLQltdXRleF9sb2NrKCZndC0+aTkxNS0+
ZHJtLnN0cnVjdF9tdXRleCk7Ci0JaWYgKGlndF9mbHVzaF90ZXN0KGd0LT5pOTE1LCBJOTE1X1dB
SVRfTE9DS0VEKSkKKwlpZiAoaWd0X2ZsdXNoX3Rlc3QoZ3QtPmk5MTUpKQogCQllcnIgPSAtRUlP
OwotCW11dGV4X3VubG9jaygmZ3QtPmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwogCiAJaTkxNV9n
ZW1fZHJhaW5fZnJlZWRfb2JqZWN0cyhndC0+aTkxNSk7CiAKZGlmZiAtLWdpdCBhL2RyaXZlcnMv
Z3B1L2RybS9pOTE1L3NlbGZ0ZXN0cy9pZ3RfZmx1c2hfdGVzdC5jIGIvZHJpdmVycy9ncHUvZHJt
L2k5MTUvc2VsZnRlc3RzL2lndF9mbHVzaF90ZXN0LmMKaW5kZXggZDNiNWViNDAyZDMzLi4yYTVm
YmU0NmVhOWYgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L3NlbGZ0ZXN0cy9pZ3Rf
Zmx1c2hfdGVzdC5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L3NlbGZ0ZXN0cy9pZ3RfZmx1
c2hfdGVzdC5jCkBAIC0xMiwzMSArMTIsMjUgQEAKIAogI2luY2x1ZGUgImlndF9mbHVzaF90ZXN0
LmgiCiAKLWludCBpZ3RfZmx1c2hfdGVzdChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwg
dW5zaWduZWQgaW50IGZsYWdzKQoraW50IGlndF9mbHVzaF90ZXN0KHN0cnVjdCBkcm1faTkxNV9w
cml2YXRlICppOTE1KQogewogCWludCByZXQgPSBpbnRlbF9ndF9pc193ZWRnZWQoJmk5MTUtPmd0
KSA/IC1FSU8gOiAwOwotCWludCByZXBlYXQgPSAhIShmbGFncyAmIEk5MTVfV0FJVF9MT0NLRUQp
OwogCiAJY29uZF9yZXNjaGVkKCk7CiAKLQlkbyB7Ci0JCWlmIChpOTE1X2dlbV93YWl0X2Zvcl9p
ZGxlKGk5MTUsIGZsYWdzLCBIWiAvIDUpID09IC1FVElNRSkgewotCQkJcHJfZXJyKCIlcFMgdGlt
ZWQgb3V0LCBjYW5jZWxsaW5nIGFsbCBmdXJ0aGVyIHRlc3RpbmcuXG4iLAotCQkJICAgICAgIF9f
YnVpbHRpbl9yZXR1cm5fYWRkcmVzcygwKSk7CisJaTkxNV9yZXRpcmVfcmVxdWVzdHMoaTkxNSk7
CisJaWYgKGk5MTVfZ2VtX3dhaXRfZm9yX2lkbGUoaTkxNSwgMCwgSFogLyA1KSA9PSAtRVRJTUUp
IHsKKwkJcHJfZXJyKCIlcFMgdGltZWQgb3V0LCBjYW5jZWxsaW5nIGFsbCBmdXJ0aGVyIHRlc3Rp
bmcuXG4iLAorCQkgICAgICAgX19idWlsdGluX3JldHVybl9hZGRyZXNzKDApKTsKIAotCQkJR0VN
X1RSQUNFKCIlcFMgdGltZWQgb3V0LlxuIiwKLQkJCQkgIF9fYnVpbHRpbl9yZXR1cm5fYWRkcmVz
cygwKSk7Ci0JCQlHRU1fVFJBQ0VfRFVNUCgpOworCQlHRU1fVFJBQ0UoIiVwUyB0aW1lZCBvdXQu
XG4iLAorCQkJICBfX2J1aWx0aW5fcmV0dXJuX2FkZHJlc3MoMCkpOworCQlHRU1fVFJBQ0VfRFVN
UCgpOwogCi0JCQlpbnRlbF9ndF9zZXRfd2VkZ2VkKCZpOTE1LT5ndCk7Ci0JCQlyZXBlYXQgPSAw
OwotCQkJcmV0ID0gLUVJTzsKLQkJfQotCi0JCS8qIEVuc3VyZSB3ZSBhbHNvIGZsdXNoIGFmdGVy
IHdlZGdpbmcuICovCi0JCWlmIChmbGFncyAmIEk5MTVfV0FJVF9MT0NLRUQpCi0JCQlpOTE1X3Jl
dGlyZV9yZXF1ZXN0cyhpOTE1KTsKLQl9IHdoaWxlIChyZXBlYXQtLSk7CisJCWludGVsX2d0X3Nl
dF93ZWRnZWQoJmk5MTUtPmd0KTsKKwkJcmV0ID0gLUVJTzsKKwl9CisJaTkxNV9yZXRpcmVfcmVx
dWVzdHMoaTkxNSk7CiAKIAlyZXR1cm4gcmV0OwogfQpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUv
ZHJtL2k5MTUvc2VsZnRlc3RzL2lndF9mbHVzaF90ZXN0LmggYi9kcml2ZXJzL2dwdS9kcm0vaTkx
NS9zZWxmdGVzdHMvaWd0X2ZsdXNoX3Rlc3QuaAppbmRleCA2M2UwMDk5MjdjNDMuLjc1NDFmYTc0
ZTY0MSAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvc2VsZnRlc3RzL2lndF9mbHVz
aF90ZXN0LmgKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvc2VsZnRlc3RzL2lndF9mbHVzaF90
ZXN0LmgKQEAgLTksNiArOSw2IEBACiAKIHN0cnVjdCBkcm1faTkxNV9wcml2YXRlOwogCi1pbnQg
aWd0X2ZsdXNoX3Rlc3Qoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUsIHVuc2lnbmVkIGlu
dCBmbGFncyk7CitpbnQgaWd0X2ZsdXNoX3Rlc3Qoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5
MTUpOwogCiAjZW5kaWYgLyogSUdUX0ZMVVNIX1RFU1RfSCAqLwpkaWZmIC0tZ2l0IGEvZHJpdmVy
cy9ncHUvZHJtL2k5MTUvc2VsZnRlc3RzL2lndF9saXZlX3Rlc3QuYyBiL2RyaXZlcnMvZ3B1L2Ry
bS9pOTE1L3NlbGZ0ZXN0cy9pZ3RfbGl2ZV90ZXN0LmMKaW5kZXggM2U5MDI3NjFjZDE2Li4wNGE2
Zjg4ZmRmNjQgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L3NlbGZ0ZXN0cy9pZ3Rf
bGl2ZV90ZXN0LmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvc2VsZnRlc3RzL2lndF9saXZl
X3Rlc3QuYwpAQCAtMTksMTUgKzE5LDEyIEBAIGludCBpZ3RfbGl2ZV90ZXN0X2JlZ2luKHN0cnVj
dCBpZ3RfbGl2ZV90ZXN0ICp0LAogCWVudW0gaW50ZWxfZW5naW5lX2lkIGlkOwogCWludCBlcnI7
CiAKLQlsb2NrZGVwX2Fzc2VydF9oZWxkKCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsKLQogCXQt
Pmk5MTUgPSBpOTE1OwogCXQtPmZ1bmMgPSBmdW5jOwogCXQtPm5hbWUgPSBuYW1lOwogCiAJZXJy
ID0gaTkxNV9nZW1fd2FpdF9mb3JfaWRsZShpOTE1LAotCQkJCSAgICAgSTkxNV9XQUlUX0lOVEVS
UlVQVElCTEUgfAotCQkJCSAgICAgSTkxNV9XQUlUX0xPQ0tFRCwKKwkJCQkgICAgIEk5MTVfV0FJ
VF9JTlRFUlJVUFRJQkxFLAogCQkJCSAgICAgTUFYX1NDSEVEVUxFX1RJTUVPVVQpOwogCWlmIChl
cnIpIHsKIAkJcHJfZXJyKCIlcyglcyk6IGZhaWxlZCB0byBpZGxlIGJlZm9yZSwgd2l0aCBlcnI9
JWQhIiwKQEAgLTUwLDkgKzQ3LDcgQEAgaW50IGlndF9saXZlX3Rlc3RfZW5kKHN0cnVjdCBpZ3Rf
bGl2ZV90ZXN0ICp0KQogCXN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZTsKIAllbnVtIGlu
dGVsX2VuZ2luZV9pZCBpZDsKIAotCWxvY2tkZXBfYXNzZXJ0X2hlbGQoJmk5MTUtPmRybS5zdHJ1
Y3RfbXV0ZXgpOwotCi0JaWYgKGlndF9mbHVzaF90ZXN0KGk5MTUsIEk5MTVfV0FJVF9MT0NLRUQp
KQorCWlmIChpZ3RfZmx1c2hfdGVzdChpOTE1KSkKIAkJcmV0dXJuIC1FSU87CiAKIAlpZiAodC0+
cmVzZXRfZ2xvYmFsICE9IGk5MTVfcmVzZXRfY291bnQoJmk5MTUtPmdwdV9lcnJvcikpIHsKZGlm
ZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L3NlbGZ0ZXN0cy9tb2NrX2dlbV9kZXZpY2Uu
YyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L3NlbGZ0ZXN0cy9tb2NrX2dlbV9kZXZpY2UuYwppbmRl
eCAwMWE4OWMwNzFiZjUuLjE5NTYwMDZhMGQ1YiAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJt
L2k5MTUvc2VsZnRlc3RzL21vY2tfZ2VtX2RldmljZS5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9p
OTE1L3NlbGZ0ZXN0cy9tb2NrX2dlbV9kZXZpY2UuYwpAQCAtNDEsOCArNDEsNiBAQCB2b2lkIG1v
Y2tfZGV2aWNlX2ZsdXNoKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KQogCXN0cnVjdCBp
bnRlbF9lbmdpbmVfY3MgKmVuZ2luZTsKIAllbnVtIGludGVsX2VuZ2luZV9pZCBpZDsKIAotCWxv
Y2tkZXBfYXNzZXJ0X2hlbGQoJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwotCiAJZG8gewogCQlm
b3JfZWFjaF9lbmdpbmUoZW5naW5lLCBpOTE1LCBpZCkKIAkJCW1vY2tfZW5naW5lX2ZsdXNoKGVu
Z2luZSk7CkBAIC01NSw5ICs1Myw3IEBAIHN0YXRpYyB2b2lkIG1vY2tfZGV2aWNlX3JlbGVhc2Uo
c3RydWN0IGRybV9kZXZpY2UgKmRldikKIAlzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmU7
CiAJZW51bSBpbnRlbF9lbmdpbmVfaWQgaWQ7CiAKLQltdXRleF9sb2NrKCZpOTE1LT5kcm0uc3Ry
dWN0X211dGV4KTsKIAltb2NrX2RldmljZV9mbHVzaChpOTE1KTsKLQltdXRleF91bmxvY2soJmk5
MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwogCiAJZmx1c2hfd29yaygmaTkxNS0+Z2VtLmlkbGVfd29y
ayk7CiAJaTkxNV9nZW1fZHJhaW5fd29ya3F1ZXVlKGk5MTUpOwotLSAKMi4yMy4wCgpfX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fXwpJbnRlbC1nZnggbWFpbGlu
ZyBsaXN0CkludGVsLWdmeEBsaXN0cy5mcmVlZGVza3RvcC5vcmcKaHR0cHM6Ly9saXN0cy5mcmVl
ZGVza3RvcC5vcmcvbWFpbG1hbi9saXN0aW5mby9pbnRlbC1nZng=

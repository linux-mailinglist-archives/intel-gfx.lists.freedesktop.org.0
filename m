Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 168F02D7C8D
	for <lists+intel-gfx@lfdr.de>; Fri, 11 Dec 2020 18:14:56 +0100 (CET)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 83EF48977A;
	Fri, 11 Dec 2020 17:14:53 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from mga17.intel.com (mga17.intel.com [192.55.52.151])
 by gabe.freedesktop.org (Postfix) with ESMTPS id BFC508977A
 for <intel-gfx@lists.freedesktop.org>; Fri, 11 Dec 2020 17:14:51 +0000 (UTC)
IronPort-SDR: a8lFAI3OnrixICbz48R/7L1KhSp43AYabaapBFKlFJhoefnSBynGtkB28uEWRFqlv7P1UgKzf/
 GfHthIYAA8Ng==
X-IronPort-AV: E=McAfee;i="6000,8403,9832"; a="154277036"
X-IronPort-AV: E=Sophos;i="5.78,411,1599548400"; d="scan'208";a="154277036"
Received: from orsmga008.jf.intel.com ([10.7.209.65])
 by fmsmga107.fm.intel.com with ESMTP/TLS/ECDHE-RSA-AES256-GCM-SHA384;
 11 Dec 2020 09:14:51 -0800
IronPort-SDR: NLv7zrgejZRA1I5BF7xjUbAJ5n8nY64vIAmwXGYJ/8TX79MTWbhh/YnP8EOXFcHO/6TZdn9TRE
 /BNBK8MBcW4A==
X-IronPort-AV: E=Sophos;i="5.78,412,1599548400"; d="scan'208";a="365502699"
Received: from helsinki.fi.intel.com ([10.237.66.162])
 by orsmga008-auth.jf.intel.com with ESMTP/TLS/ECDHE-RSA-AES256-GCM-SHA384;
 11 Dec 2020 09:14:48 -0800
From: Gwan-gyeong Mun <gwan-gyeong.mun@intel.com>
To: intel-gfx@lists.freedesktop.org
Date: Fri, 11 Dec 2020 19:14:20 +0200
Message-Id: <20201211171421.4048499-1-gwan-gyeong.mun@intel.com>
X-Mailer: git-send-email 2.25.0
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH v5 1/2] drm/i915/display: Support PSR Multiple
 Transcoders
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.29
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Cc: jani.nikula@intel.com
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

SXQgaXMgYSBwcmVsaW1pbmFyeSB3b3JrIGZvciBzdXBwb3J0aW5nIG11bHRpcGxlIEVEUCBQU1Ig
YW5kCkRQIFBhbmVsUmVwbGF5LiBBbmQgaXQgcmVmYWN0b3JzIHNpbmdsZXRvbiBQU1IgdG8gTXVs
dGkgVHJhbnNjb2RlcgpzdXBwb3J0YWJsZSBQU1IuCkFuZCB0aGlzIG1vdmVzIGFuZCByZW5hbWVz
IHRoZSBpOTE1X3BzciBzdHJ1Y3R1cmUgb2YgZHJtX2k5MTVfcHJpdmF0ZSdzIHRvCmludGVsX2Rw
J3MgaW50ZWxfcHNyIHN0cnVjdHVyZS4KSXQgYWxzbyBjYXVzZXMgY2hhbmdlcyBpbiBQU1IgaW50
ZXJydXB0IGhhbmRsaW5nIHJvdXRpbmUgZm9yIHN1cHBvcnRpbmcKbXVsdGlwbGUgdHJhbnNjb2Rl
cnMuIEJ1dCBpdCBkb2VzIG5vdCBjaGFuZ2UgdGhlIHNjZW5hcmlvIGFuZCB0aW1pbmcgb2YKZW5h
YmxpbmcgYW5kIGRpc2FibGluZyBQU1IuCgp2MjogRml4IGluZGVudGF0aW9uIGFuZCBhZGQgY29t
bWVudHMKdjM6IFJlbW92ZSBCbGFuayBsaW5lCnY0OiBSZWJhc2VkCnY1OiBSZWJhc2VkIGFuZCBB
ZGRyZXNzZWQgQW5zaHVtYW4ncyByZXZpZXcgY29tbWVudC4KICAgIC0gTW92ZSBjYWxsaW5nIG9m
IGludGVsX3Bzcl9pbml0KCkgdG8gaW50ZWxfZHBfaW5pdF9jb25uZWN0b3IoKQoKU2lnbmVkLW9m
Zi1ieTogR3dhbi1neWVvbmcgTXVuIDxnd2FuLWd5ZW9uZy5tdW5AaW50ZWwuY29tPgpDYzogSm9z
w6kgUm9iZXJ0byBkZSBTb3V6YSA8am9zZS5zb3V6YUBpbnRlbC5jb20+CkNjOiBKdWhhLVBla2th
IEhlaWtraWxhIDxqdWhhcGVra2EuaGVpa2tpbGFAZ21haWwuY29tPgpDYzogQW5zaHVtYW4gR3Vw
dGEgPGFuc2h1bWFuLmd1cHRhQGludGVsLmNvbT4KLS0tCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9k
aXNwbGF5L2ludGVsX2RkaS5jICAgICAgfCAgIDMgKwogZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlz
cGxheS9pbnRlbF9kaXNwbGF5LmMgIHwgICA0IC0KIC4uLi9kcm0vaTkxNS9kaXNwbGF5L2ludGVs
X2Rpc3BsYXlfZGVidWdmcy5jICB8IDExMSArKy0tCiAuLi4vZHJtL2k5MTUvZGlzcGxheS9pbnRl
bF9kaXNwbGF5X3R5cGVzLmggICAgfCAgMzggKysKIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3Bs
YXkvaW50ZWxfZHAuYyAgICAgICB8ICAyMyArLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxh
eS9pbnRlbF9wc3IuYyAgICAgIHwgNTg1ICsrKysrKysrKystLS0tLS0tLQogZHJpdmVycy9ncHUv
ZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9wc3IuaCAgICAgIHwgIDE0ICstCiBkcml2ZXJzL2dwdS9k
cm0vaTkxNS9kaXNwbGF5L2ludGVsX3Nwcml0ZS5jICAgfCAgIDYgKy0KIGRyaXZlcnMvZ3B1L2Ry
bS9pOTE1L2k5MTVfZHJ2LmggICAgICAgICAgICAgICB8ICAzOCAtLQogZHJpdmVycy9ncHUvZHJt
L2k5MTUvaTkxNV9pcnEuYyAgICAgICAgICAgICAgIHwgIDQ5ICstCiAxMCBmaWxlcyBjaGFuZ2Vk
LCA0OTEgaW5zZXJ0aW9ucygrKSwgMzgwIGRlbGV0aW9ucygtKQoKZGlmZiAtLWdpdCBhL2RyaXZl
cnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZGRpLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkx
NS9kaXNwbGF5L2ludGVsX2RkaS5jCmluZGV4IDY4NjMyMzZkZjFkMC4uNGI4N2Y3MmNiOWMwIDEw
MDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2RkaS5jCisrKyBi
L2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZGRpLmMKQEAgLTQzMjAsNyArNDMy
MCwxMCBAQCBzdGF0aWMgdm9pZCBpbnRlbF9kZGlfdXBkYXRlX3BpcGVfZHAoc3RydWN0IGludGVs
X2F0b21pY19zdGF0ZSAqc3RhdGUsCiAKIAlpbnRlbF9kZGlfc2V0X2RwX21zYShjcnRjX3N0YXRl
LCBjb25uX3N0YXRlKTsKIAorCS8vVE9ETzogbW92ZSBQU1IgcmVsYXRlZCBmdW5jdGlvbnMgaW50
byBpbnRlbF9wc3JfdXBkYXRlKCkKKwlpbnRlbF9wc3IyX3Byb2dyYW1fdHJhbnNfbWFuX3Rya19j
dGwoaW50ZWxfZHAsIGNydGNfc3RhdGUpOwogCWludGVsX3Bzcl91cGRhdGUoaW50ZWxfZHAsIGNy
dGNfc3RhdGUsIGNvbm5fc3RhdGUpOworCiAJaW50ZWxfZHBfc2V0X2luZm9mcmFtZXMoZW5jb2Rl
ciwgdHJ1ZSwgY3J0Y19zdGF0ZSwgY29ubl9zdGF0ZSk7CiAJaW50ZWxfZWRwX2RycnNfdXBkYXRl
KGludGVsX2RwLCBjcnRjX3N0YXRlKTsKIApkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5
MTUvZGlzcGxheS9pbnRlbF9kaXNwbGF5LmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5
L2ludGVsX2Rpc3BsYXkuYwppbmRleCA3NjFiZThkZWFhOWIuLmYyNmQ5YmNkNzIyYyAxMDA2NDQK
LS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kaXNwbGF5LmMKKysrIGIv
ZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kaXNwbGF5LmMKQEAgLTE1ODY5LDgg
KzE1ODY5LDYgQEAgc3RhdGljIHZvaWQgY29tbWl0X3BpcGVfY29uZmlnKHN0cnVjdCBpbnRlbF9h
dG9taWNfc3RhdGUgKnN0YXRlLAogCiAJCWlmIChuZXdfY3J0Y19zdGF0ZS0+dXBkYXRlX3BpcGUp
CiAJCQlpbnRlbF9waXBlX2Zhc3RzZXQob2xkX2NydGNfc3RhdGUsIG5ld19jcnRjX3N0YXRlKTsK
LQotCQlpbnRlbF9wc3IyX3Byb2dyYW1fdHJhbnNfbWFuX3Rya19jdGwobmV3X2NydGNfc3RhdGUp
OwogCX0KIAogCWlmIChkZXZfcHJpdi0+ZGlzcGxheS5hdG9taWNfdXBkYXRlX3dhdGVybWFya3Mp
CkBAIC0xNzgzMCw4ICsxNzgyOCw2IEBAIHN0YXRpYyB2b2lkIGludGVsX3NldHVwX291dHB1dHMo
c3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQogCQlpbnRlbF9kdm9faW5pdChkZXZf
cHJpdik7CiAJfQogCi0JaW50ZWxfcHNyX2luaXQoZGV2X3ByaXYpOwotCiAJZm9yX2VhY2hfaW50
ZWxfZW5jb2RlcigmZGV2X3ByaXYtPmRybSwgZW5jb2RlcikgewogCQllbmNvZGVyLT5iYXNlLnBv
c3NpYmxlX2NydGNzID0KIAkJCWludGVsX2VuY29kZXJfcG9zc2libGVfY3J0Y3MoZW5jb2Rlcik7
CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2Rpc3BsYXlf
ZGVidWdmcy5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kaXNwbGF5X2Rl
YnVnZnMuYwppbmRleCBjZDdlNTUxOWVlN2QuLjA0MTA1MzE2N2Q3ZiAxMDA2NDQKLS0tIGEvZHJp
dmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kaXNwbGF5X2RlYnVnZnMuYworKysgYi9k
cml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2Rpc3BsYXlfZGVidWdmcy5jCkBAIC0y
NDksMTggKzI0OSwxNyBAQCBzdGF0aWMgaW50IGk5MTVfcHNyX3Npbmtfc3RhdHVzX3Nob3coc3Ry
dWN0IHNlcV9maWxlICptLCB2b2lkICpkYXRhKQogCQkic2luayBpbnRlcm5hbCBlcnJvciIsCiAJ
fTsKIAlzdHJ1Y3QgZHJtX2Nvbm5lY3RvciAqY29ubmVjdG9yID0gbS0+cHJpdmF0ZTsKLQlzdHJ1
Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGNvbm5lY3Rvci0+ZGV2KTsK
IAlzdHJ1Y3QgaW50ZWxfZHAgKmludGVsX2RwID0KIAkJaW50ZWxfYXR0YWNoZWRfZHAodG9faW50
ZWxfY29ubmVjdG9yKGNvbm5lY3RvcikpOwogCWludCByZXQ7CiAKLQlpZiAoIUNBTl9QU1IoZGV2
X3ByaXYpKSB7Ci0JCXNlcV9wdXRzKG0sICJQU1IgVW5zdXBwb3J0ZWRcbiIpOworCWlmIChjb25u
ZWN0b3ItPnN0YXR1cyAhPSBjb25uZWN0b3Jfc3RhdHVzX2Nvbm5lY3RlZCkKIAkJcmV0dXJuIC1F
Tk9ERVY7Ci0JfQogCi0JaWYgKGNvbm5lY3Rvci0+c3RhdHVzICE9IGNvbm5lY3Rvcl9zdGF0dXNf
Y29ubmVjdGVkKQorCWlmICghQ0FOX1BTUihpbnRlbF9kcCkpIHsKKwkJc2VxX3B1dHMobSwgIlBT
UiBVbnN1cHBvcnRlZFxuIik7CiAJCXJldHVybiAtRU5PREVWOworCX0KIAogCXJldCA9IGRybV9k
cF9kcGNkX3JlYWRiKCZpbnRlbF9kcC0+YXV4LCBEUF9QU1JfU1RBVFVTLCAmdmFsKTsKIApAQCAt
MjgwLDEyICsyNzksMTMgQEAgc3RhdGljIGludCBpOTE1X3Bzcl9zaW5rX3N0YXR1c19zaG93KHN0
cnVjdCBzZXFfZmlsZSAqbSwgdm9pZCAqZGF0YSkKIERFRklORV9TSE9XX0FUVFJJQlVURShpOTE1
X3Bzcl9zaW5rX3N0YXR1cyk7CiAKIHN0YXRpYyB2b2lkCi1wc3Jfc291cmNlX3N0YXR1cyhzdHJ1
Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsIHN0cnVjdCBzZXFfZmlsZSAqbSkKK3Bzcl9z
b3VyY2Vfc3RhdHVzKHN0cnVjdCBpbnRlbF9kcCAqaW50ZWxfZHAsIHN0cnVjdCBzZXFfZmlsZSAq
bSkKIHsKIAl1MzIgdmFsLCBzdGF0dXNfdmFsOwogCWNvbnN0IGNoYXIgKnN0YXR1cyA9ICJ1bmtu
b3duIjsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSBkcF90b19pOTE1KGlu
dGVsX2RwKTsKIAotCWlmIChkZXZfcHJpdi0+cHNyLnBzcjJfZW5hYmxlZCkgeworCWlmIChpbnRl
bF9kcC0+cHNyLnBzcjJfZW5hYmxlZCkgewogCQlzdGF0aWMgY29uc3QgY2hhciAqIGNvbnN0IGxp
dmVfc3RhdHVzW10gPSB7CiAJCQkiSURMRSIsCiAJCQkiQ0FQVFVSRSIsCkBAIC0zMDAsNyArMzAw
LDcgQEAgcHNyX3NvdXJjZV9zdGF0dXMoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2
LCBzdHJ1Y3Qgc2VxX2ZpbGUgKm0pCiAJCQkiVEdfT04iCiAJCX07CiAJCXZhbCA9IGludGVsX2Rl
X3JlYWQoZGV2X3ByaXYsCi0JCQkJICAgIEVEUF9QU1IyX1NUQVRVUyhkZXZfcHJpdi0+cHNyLnRy
YW5zY29kZXIpKTsKKwkJCQkgICAgRURQX1BTUjJfU1RBVFVTKGludGVsX2RwLT5wc3IudHJhbnNj
b2RlcikpOwogCQlzdGF0dXNfdmFsID0gKHZhbCAmIEVEUF9QU1IyX1NUQVRVU19TVEFURV9NQVNL
KSA+PgogCQkJICAgICAgRURQX1BTUjJfU1RBVFVTX1NUQVRFX1NISUZUOwogCQlpZiAoc3RhdHVz
X3ZhbCA8IEFSUkFZX1NJWkUobGl2ZV9zdGF0dXMpKQpAQCAtMzE3LDcgKzMxNyw3IEBAIHBzcl9z
b3VyY2Vfc3RhdHVzKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwgc3RydWN0IHNl
cV9maWxlICptKQogCQkJIlNSREVOVF9PTiIsCiAJCX07CiAJCXZhbCA9IGludGVsX2RlX3JlYWQo
ZGV2X3ByaXYsCi0JCQkJICAgIEVEUF9QU1JfU1RBVFVTKGRldl9wcml2LT5wc3IudHJhbnNjb2Rl
cikpOworCQkJCSAgICBFRFBfUFNSX1NUQVRVUyhpbnRlbF9kcC0+cHNyLnRyYW5zY29kZXIpKTsK
IAkJc3RhdHVzX3ZhbCA9ICh2YWwgJiBFRFBfUFNSX1NUQVRVU19TVEFURV9NQVNLKSA+PgogCQkJ
ICAgICAgRURQX1BTUl9TVEFUVVNfU1RBVEVfU0hJRlQ7CiAJCWlmIChzdGF0dXNfdmFsIDwgQVJS
QVlfU0laRShsaXZlX3N0YXR1cykpCkBAIC0zMjcsMjEgKzMyNywxOCBAQCBwc3Jfc291cmNlX3N0
YXR1cyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsIHN0cnVjdCBzZXFfZmlsZSAq
bSkKIAlzZXFfcHJpbnRmKG0sICJTb3VyY2UgUFNSIHN0YXR1czogJXMgWzB4JTA4eF1cbiIsIHN0
YXR1cywgdmFsKTsKIH0KIAotc3RhdGljIGludCBpOTE1X2VkcF9wc3Jfc3RhdHVzKHN0cnVjdCBz
ZXFfZmlsZSAqbSwgdm9pZCAqZGF0YSkKK3N0YXRpYyBpbnQgaW50ZWxfcHNyX3N0YXR1cyhzdHJ1
Y3Qgc2VxX2ZpbGUgKm0sIHN0cnVjdCBpbnRlbF9kcCAqaW50ZWxfZHApCiB7Ci0Jc3RydWN0IGRy
bV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gbm9kZV90b19pOTE1KG0tPnByaXZhdGUpOwotCXN0
cnVjdCBpOTE1X3BzciAqcHNyID0gJmRldl9wcml2LT5wc3I7CisJc3RydWN0IGRybV9pOTE1X3By
aXZhdGUgKmRldl9wcml2ID0gZHBfdG9faTkxNShpbnRlbF9kcCk7CisJc3RydWN0IGludGVsX3Bz
ciAqcHNyID0gJmludGVsX2RwLT5wc3I7CiAJaW50ZWxfd2FrZXJlZl90IHdha2VyZWY7CiAJY29u
c3QgY2hhciAqc3RhdHVzOwogCWJvb2wgZW5hYmxlZDsKIAl1MzIgdmFsOwogCi0JaWYgKCFIQVNf
UFNSKGRldl9wcml2KSkKLQkJcmV0dXJuIC1FTk9ERVY7Ci0KIAlzZXFfcHJpbnRmKG0sICJTaW5r
IHN1cHBvcnQ6ICVzIiwgeWVzbm8ocHNyLT5zaW5rX3N1cHBvcnQpKTsKLQlpZiAocHNyLT5kcCkK
LQkJc2VxX3ByaW50ZihtLCAiIFsweCUwMnhdIiwgcHNyLT5kcC0+cHNyX2RwY2RbMF0pOworCWlm
IChwc3ItPnNpbmtfc3VwcG9ydCkKKwkJc2VxX3ByaW50ZihtLCAiIFsweCUwMnhdIiwgaW50ZWxf
ZHAtPnBzcl9kcGNkWzBdKTsKIAlzZXFfcHV0cyhtLCAiXG4iKTsKIAogCWlmICghcHNyLT5zaW5r
X3N1cHBvcnQpCkBAIC0zNjUsMTYgKzM2MiwxNiBAQCBzdGF0aWMgaW50IGk5MTVfZWRwX3Bzcl9z
dGF0dXMoc3RydWN0IHNlcV9maWxlICptLCB2b2lkICpkYXRhKQogCiAJaWYgKHBzci0+cHNyMl9l
bmFibGVkKSB7CiAJCXZhbCA9IGludGVsX2RlX3JlYWQoZGV2X3ByaXYsCi0JCQkJICAgIEVEUF9Q
U1IyX0NUTChkZXZfcHJpdi0+cHNyLnRyYW5zY29kZXIpKTsKKwkJCQkgICAgRURQX1BTUjJfQ1RM
KGludGVsX2RwLT5wc3IudHJhbnNjb2RlcikpOwogCQllbmFibGVkID0gdmFsICYgRURQX1BTUjJf
RU5BQkxFOwogCX0gZWxzZSB7CiAJCXZhbCA9IGludGVsX2RlX3JlYWQoZGV2X3ByaXYsCi0JCQkJ
ICAgIEVEUF9QU1JfQ1RMKGRldl9wcml2LT5wc3IudHJhbnNjb2RlcikpOworCQkJCSAgICBFRFBf
UFNSX0NUTChpbnRlbF9kcC0+cHNyLnRyYW5zY29kZXIpKTsKIAkJZW5hYmxlZCA9IHZhbCAmIEVE
UF9QU1JfRU5BQkxFOwogCX0KIAlzZXFfcHJpbnRmKG0sICJTb3VyY2UgUFNSIGN0bDogJXMgWzB4
JTA4eF1cbiIsCiAJCSAgIGVuYWJsZWRkaXNhYmxlZChlbmFibGVkKSwgdmFsKTsKLQlwc3Jfc291
cmNlX3N0YXR1cyhkZXZfcHJpdiwgbSk7CisJcHNyX3NvdXJjZV9zdGF0dXMoaW50ZWxfZHAsIG0p
OwogCXNlcV9wcmludGYobSwgIkJ1c3kgZnJvbnRidWZmZXIgYml0czogMHglMDh4XG4iLAogCQkg
ICBwc3ItPmJ1c3lfZnJvbnRidWZmZXJfYml0cyk7CiAKQEAgLTM4Myw3ICszODAsNyBAQCBzdGF0
aWMgaW50IGk5MTVfZWRwX3Bzcl9zdGF0dXMoc3RydWN0IHNlcV9maWxlICptLCB2b2lkICpkYXRh
KQogCSAqLwogCWlmIChJU19IQVNXRUxMKGRldl9wcml2KSB8fCBJU19CUk9BRFdFTEwoZGV2X3By
aXYpKSB7CiAJCXZhbCA9IGludGVsX2RlX3JlYWQoZGV2X3ByaXYsCi0JCQkJICAgIEVEUF9QU1Jf
UEVSRl9DTlQoZGV2X3ByaXYtPnBzci50cmFuc2NvZGVyKSk7CisJCQkJICAgIEVEUF9QU1JfUEVS
Rl9DTlQoaW50ZWxfZHAtPnBzci50cmFuc2NvZGVyKSk7CiAJCXZhbCAmPSBFRFBfUFNSX1BFUkZf
Q05UX01BU0s7CiAJCXNlcV9wcmludGYobSwgIlBlcmZvcm1hbmNlIGNvdW50ZXI6ICV1XG4iLCB2
YWwpOwogCX0KQEAgLTQwNCw3ICs0MDEsNyBAQCBzdGF0aWMgaW50IGk5MTVfZWRwX3Bzcl9zdGF0
dXMoc3RydWN0IHNlcV9maWxlICptLCB2b2lkICpkYXRhKQogCQkgKi8KIAkJZm9yIChmcmFtZSA9
IDA7IGZyYW1lIDwgUFNSMl9TVV9TVEFUVVNfRlJBTUVTOyBmcmFtZSArPSAzKSB7CiAJCQl2YWwg
PSBpbnRlbF9kZV9yZWFkKGRldl9wcml2LAotCQkJCQkgICAgUFNSMl9TVV9TVEFUVVMoZGV2X3By
aXYtPnBzci50cmFuc2NvZGVyLCBmcmFtZSkpOworCQkJCQkgICAgUFNSMl9TVV9TVEFUVVMoaW50
ZWxfZHAtPnBzci50cmFuc2NvZGVyLCBmcmFtZSkpOwogCQkJc3VfZnJhbWVzX3ZhbFtmcmFtZSAv
IDNdID0gdmFsOwogCQl9CiAKQEAgLTQzMCwyMyArNDI3LDU3IEBAIHN0YXRpYyBpbnQgaTkxNV9l
ZHBfcHNyX3N0YXR1cyhzdHJ1Y3Qgc2VxX2ZpbGUgKm0sIHZvaWQgKmRhdGEpCiAJcmV0dXJuIDA7
CiB9CiAKK3N0YXRpYyBpbnQgaTkxNV9lZHBfcHNyX3N0YXR1cyhzdHJ1Y3Qgc2VxX2ZpbGUgKm0s
IHZvaWQgKmRhdGEpCit7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gbm9k
ZV90b19pOTE1KG0tPnByaXZhdGUpOworCXN0cnVjdCBpbnRlbF9lbmNvZGVyICplbmNvZGVyOwor
CXN0cnVjdCBpbnRlbF9kcCAqaW50ZWxfZHAgPSBOVUxMOworCisJaWYgKCFIQVNfUFNSKGRldl9w
cml2KSkKKwkJcmV0dXJuIC1FTk9ERVY7CisKKwkvKiBGaW5kIHRoZSBmaXJzdCBFRFAgKi8KKwlm
b3JfZWFjaF9pbnRlbF9kcCgmZGV2X3ByaXYtPmRybSwgZW5jb2RlcikgeworCQlpZiAoZW5jb2Rl
ci0+dHlwZSA9PSBJTlRFTF9PVVRQVVRfRURQKSB7CisJCQlpbnRlbF9kcCA9IGVuY190b19pbnRl
bF9kcChlbmNvZGVyKTsKKwkJCWJyZWFrOworCQl9CisJfQorCisJaWYgKCFpbnRlbF9kcCkKKwkJ
cmV0dXJuIC1FTk9ERVY7CisKKwlyZXR1cm4gaW50ZWxfcHNyX3N0YXR1cyhtLCBpbnRlbF9kcCk7
Cit9CisKIHN0YXRpYyBpbnQKIGk5MTVfZWRwX3Bzcl9kZWJ1Z19zZXQodm9pZCAqZGF0YSwgdTY0
IHZhbCkKIHsKIAlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSBkYXRhOwogCWlu
dGVsX3dha2VyZWZfdCB3YWtlcmVmOwotCWludCByZXQ7CisJaW50IHJldCA9IC1FTk9ERVY7CisJ
c3RydWN0IGludGVsX2VuY29kZXIgKmVuY29kZXI7CiAKLQlpZiAoIUNBTl9QU1IoZGV2X3ByaXYp
KQotCQlyZXR1cm4gLUVOT0RFVjsKKwlpZiAoIUhBU19QU1IoZGV2X3ByaXYpKQorCQlyZXR1cm4g
cmV0OwogCi0JZHJtX2RiZ19rbXMoJmRldl9wcml2LT5kcm0sICJTZXR0aW5nIFBTUiBkZWJ1ZyB0
byAlbGx4XG4iLCB2YWwpOworCWZvcl9lYWNoX2ludGVsX2RwKCZkZXZfcHJpdi0+ZHJtLCBlbmNv
ZGVyKSB7CisJCXN0cnVjdCBpbnRlbF9kcCAqaW50ZWxfZHAgPSBlbmNfdG9faW50ZWxfZHAoZW5j
b2Rlcik7CiAKLQl3YWtlcmVmID0gaW50ZWxfcnVudGltZV9wbV9nZXQoJmRldl9wcml2LT5ydW50
aW1lX3BtKTsKKwkJaWYgKCFDQU5fUFNSKGludGVsX2RwKSkKKwkJCWNvbnRpbnVlOwogCi0JcmV0
ID0gaW50ZWxfcHNyX2RlYnVnX3NldChkZXZfcHJpdiwgdmFsKTsKKwkJaWYgKGVuY29kZXItPnR5
cGUgPT0gSU5URUxfT1VUUFVUX0VEUCkgeworCQkJZHJtX2RiZ19rbXMoJmRldl9wcml2LT5kcm0s
ICJTZXR0aW5nIFBTUiBkZWJ1ZyB0byAlbGx4XG4iLCB2YWwpOwogCi0JaW50ZWxfcnVudGltZV9w
bV9wdXQoJmRldl9wcml2LT5ydW50aW1lX3BtLCB3YWtlcmVmKTsKKwkJCXdha2VyZWYgPSBpbnRl
bF9ydW50aW1lX3BtX2dldCgmZGV2X3ByaXYtPnJ1bnRpbWVfcG0pOworCisJCQkvLyBUT0RPOiBz
cGxpdCB0byBlYWNoIHRyYW5zY29kZXIncyBQU1IgZGVidWcgc3RhdGUKKwkJCXJldCA9IGludGVs
X3Bzcl9kZWJ1Z19zZXQoaW50ZWxfZHAsIHZhbCk7CisKKwkJCWludGVsX3J1bnRpbWVfcG1fcHV0
KCZkZXZfcHJpdi0+cnVudGltZV9wbSwgd2FrZXJlZik7CisJCX0KKwl9CiAKIAlyZXR1cm4gcmV0
OwogfQpAQCAtNDU1LDEyICs0ODYsMjUgQEAgc3RhdGljIGludAogaTkxNV9lZHBfcHNyX2RlYnVn
X2dldCh2b2lkICpkYXRhLCB1NjQgKnZhbCkKIHsKIAlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAq
ZGV2X3ByaXYgPSBkYXRhOworCXN0cnVjdCBpbnRlbF9lbmNvZGVyICplbmNvZGVyOwogCi0JaWYg
KCFDQU5fUFNSKGRldl9wcml2KSkKKwlpZiAoIUhBU19QU1IoZGV2X3ByaXYpKQogCQlyZXR1cm4g
LUVOT0RFVjsKIAotCSp2YWwgPSBSRUFEX09OQ0UoZGV2X3ByaXYtPnBzci5kZWJ1Zyk7Ci0JcmV0
dXJuIDA7CisJZm9yX2VhY2hfaW50ZWxfZHAoJmRldl9wcml2LT5kcm0sIGVuY29kZXIpIHsKKwkJ
c3RydWN0IGludGVsX2RwICppbnRlbF9kcCA9IGVuY190b19pbnRlbF9kcChlbmNvZGVyKTsKKwor
CQlpZiAoIUNBTl9QU1IoaW50ZWxfZHApKQorCQkJY29udGludWU7CisKKwkJLy8gVE9ETzogc3Bs
aXQgdG8gZWFjaCB0cmFuc2NvZGVyJ3MgUFNSIGRlYnVnIHN0YXRlCisJCWlmIChlbmNvZGVyLT50
eXBlID09IElOVEVMX09VVFBVVF9FRFApIHsKKwkJCSp2YWwgPSBSRUFEX09OQ0UoaW50ZWxfZHAt
PnBzci5kZWJ1Zyk7CisJCQlyZXR1cm4gMDsKKwkJfQorCX0KKworCXJldHVybiAtRU5PREVWOwog
fQogCiBERUZJTkVfU0lNUExFX0FUVFJJQlVURShpOTE1X2VkcF9wc3JfZGVidWdfZm9wcywKQEAg
LTEyMzQsOSArMTI3OCw2IEBAIHN0YXRpYyB2b2lkIGRycnNfc3RhdHVzX3Blcl9jcnRjKHN0cnVj
dCBzZXFfZmlsZSAqbSwKIAkJLyogZGlzYWJsZV9kcnJzKCkgd2lsbCBtYWtlIGRycnMtPmRwIE5V
TEwgKi8KIAkJaWYgKCFkcnJzLT5kcCkgewogCQkJc2VxX3B1dHMobSwgIklkbGVuZXNzIERSUlM6
IERpc2FibGVkXG4iKTsKLQkJCWlmIChkZXZfcHJpdi0+cHNyLmVuYWJsZWQpCi0JCQkJc2VxX3B1
dHMobSwKLQkJCQkiXHRBcyBQU1IgaXMgZW5hYmxlZCwgRFJSUyBpcyBub3QgZW5hYmxlZFxuIik7
CiAJCQltdXRleF91bmxvY2soJmRycnMtPm11dGV4KTsKIAkJCXJldHVybjsKIAkJfQpkaWZmIC0t
Z2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kaXNwbGF5X3R5cGVzLmgg
Yi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2Rpc3BsYXlfdHlwZXMuaAppbmRl
eCA1YmM1YmZiYzQ1NTEuLjk4OTlmZGRmNGM5OSAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJt
L2k5MTUvZGlzcGxheS9pbnRlbF9kaXNwbGF5X3R5cGVzLmgKKysrIGIvZHJpdmVycy9ncHUvZHJt
L2k5MTUvZGlzcGxheS9pbnRlbF9kaXNwbGF5X3R5cGVzLmgKQEAgLTEzMzksNiArMTMzOSw0MiBA
QCBzdHJ1Y3QgaW50ZWxfZHBfY29tcGxpYW5jZSB7CiAJdTggdGVzdF9sYW5lX2NvdW50OwogfTsK
IAorc3RydWN0IGludGVsX3BzciB7CisJLyogTXV0ZXggZm9yIFBTUiBzdGF0ZSBvZiB0aGUgdHJh
bnNjb2RlciAqLworCXN0cnVjdCBtdXRleCBsb2NrOworCisjZGVmaW5lIEk5MTVfUFNSX0RFQlVH
X01PREVfTUFTSwkweDBmCisjZGVmaW5lIEk5MTVfUFNSX0RFQlVHX0RFRkFVTFQJCTB4MDAKKyNk
ZWZpbmUgSTkxNV9QU1JfREVCVUdfRElTQUJMRQkJMHgwMQorI2RlZmluZSBJOTE1X1BTUl9ERUJV
R19FTkFCTEUJCTB4MDIKKyNkZWZpbmUgSTkxNV9QU1JfREVCVUdfRk9SQ0VfUFNSMQkweDAzCisj
ZGVmaW5lIEk5MTVfUFNSX0RFQlVHX0lSUQkJMHgxMAorCisJdTMyIGRlYnVnOworCWJvb2wgc2lu
a19zdXBwb3J0OworCWJvb2wgZW5hYmxlZDsKKwllbnVtIHBpcGUgcGlwZTsKKwllbnVtIHRyYW5z
Y29kZXIgdHJhbnNjb2RlcjsKKwlib29sIGFjdGl2ZTsKKwlzdHJ1Y3Qgd29ya19zdHJ1Y3Qgd29y
azsKKwl1bnNpZ25lZCBpbnQgYnVzeV9mcm9udGJ1ZmZlcl9iaXRzOworCWJvb2wgc2lua19wc3Iy
X3N1cHBvcnQ7CisJYm9vbCBsaW5rX3N0YW5kYnk7CisJYm9vbCBjb2xvcmltZXRyeV9zdXBwb3J0
OworCWJvb2wgcHNyMl9lbmFibGVkOworCWJvb2wgcHNyMl9zZWxfZmV0Y2hfZW5hYmxlZDsKKwl1
OCBzaW5rX3N5bmNfbGF0ZW5jeTsKKwlrdGltZV90IGxhc3RfZW50cnlfYXR0ZW1wdDsKKwlrdGlt
ZV90IGxhc3RfZXhpdDsKKwlib29sIHNpbmtfbm90X3JlbGlhYmxlOworCWJvb2wgaXJxX2F1eF9l
cnJvcjsKKwl1MTYgc3VfeF9ncmFudWxhcml0eTsKKwlib29sIGRjM2NvX2VuYWJsZWQ7CisJdTMy
IGRjM2NvX2V4aXRfZGVsYXk7CisJc3RydWN0IGRlbGF5ZWRfd29yayBkYzNjb193b3JrOworCXN0
cnVjdCBkcm1fZHBfdnNjX3NkcCB2c2M7Cit9OworCiBzdHJ1Y3QgaW50ZWxfZHAgewogCWk5MTVf
cmVnX3Qgb3V0cHV0X3JlZzsKIAl1MzIgRFA7CkBAIC0xNDYwLDYgKzE0OTYsOCBAQCBzdHJ1Y3Qg
aW50ZWxfZHAgewogCiAJYm9vbCBob2JsX2ZhaWxlZDsKIAlib29sIGhvYmxfYWN0aXZlOworCisJ
c3RydWN0IGludGVsX3BzciBwc3I7CiB9OwogCiBlbnVtIGxzcGNvbl92ZW5kb3IgewpkaWZmIC0t
Z2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kcC5jIGIvZHJpdmVycy9n
cHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kcC5jCmluZGV4IGIyYmMwYzhjMzljNy4uNTczMGNh
ZDdiNmFjIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2Rw
LmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kcC5jCkBAIC0yNzAy
LDEyICsyNzAyLDEwIEBAIHZvaWQgaW50ZWxfZHBfY29tcHV0ZV9wc3JfdnNjX3NkcChzdHJ1Y3Qg
aW50ZWxfZHAgKmludGVsX2RwLAogCQkJCSAgY29uc3Qgc3RydWN0IGRybV9jb25uZWN0b3Jfc3Rh
dGUgKmNvbm5fc3RhdGUsCiAJCQkJICBzdHJ1Y3QgZHJtX2RwX3ZzY19zZHAgKnZzYykKIHsKLQlz
dHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSBkcF90b19pOTE1KGludGVsX2RwKTsK
LQogCXZzYy0+c2RwX3R5cGUgPSBEUF9TRFBfVlNDOwogCi0JaWYgKGRldl9wcml2LT5wc3IucHNy
Ml9lbmFibGVkKSB7Ci0JCWlmIChkZXZfcHJpdi0+cHNyLmNvbG9yaW1ldHJ5X3N1cHBvcnQgJiYK
KwlpZiAoaW50ZWxfZHAtPnBzci5wc3IyX2VuYWJsZWQpIHsKKwkJaWYgKGludGVsX2RwLT5wc3Iu
Y29sb3JpbWV0cnlfc3VwcG9ydCAmJgogCQkgICAgaW50ZWxfZHBfbmVlZHNfdnNjX3NkcChjcnRj
X3N0YXRlLCBjb25uX3N0YXRlKSkgewogCQkJLyogW1BTUjIsICtDb2xvcmltZXRyeV0gKi8KIAkJ
CWludGVsX2RwX2NvbXB1dGVfdnNjX2NvbG9yaW1ldHJ5KGNydGNfc3RhdGUsIGNvbm5fc3RhdGUs
CkBAIC0zODQ0LDcgKzM4NDIsNyBAQCBib29sIGludGVsX2RwX2luaXRpYWxfZmFzdHNldF9jaGVj
ayhzdHJ1Y3QgaW50ZWxfZW5jb2RlciAqZW5jb2RlciwKIAkJcmV0dXJuIGZhbHNlOwogCX0KIAot
CWlmIChDQU5fUFNSKGk5MTUpICYmIGludGVsX2RwX2lzX2VkcChpbnRlbF9kcCkpIHsKKwlpZiAo
Q0FOX1BTUihpbnRlbF9kcCkgJiYgaW50ZWxfZHBfaXNfZWRwKGludGVsX2RwKSkgewogCQlkcm1f
ZGJnX2ttcygmaTkxNS0+ZHJtLCAiRm9yY2luZyBmdWxsIG1vZGVzZXQgdG8gY29tcHV0ZSBQU1Ig
c3RhdGVcbiIpOwogCQljcnRjX3N0YXRlLT51YXBpLm1vZGVfY2hhbmdlZCA9IHRydWU7CiAJCXJl
dHVybiBmYWxzZTsKQEAgLTgwNzAsNiArODA2OCwxNyBAQCBzdGF0aWMgdm9pZCBpbnRlbF9kcF9t
b2Rlc2V0X3JldHJ5X3dvcmtfZm4oc3RydWN0IHdvcmtfc3RydWN0ICp3b3JrKQogCWRybV9rbXNf
aGVscGVyX2hvdHBsdWdfZXZlbnQoY29ubmVjdG9yLT5kZXYpOwogfQogCitzdGF0aWMgdm9pZCBp
bnRlbF9kcF91cGRhdGVfcGlwZShzdHJ1Y3QgaW50ZWxfYXRvbWljX3N0YXRlICpzdGF0ZSwKKwkJ
CQkgc3RydWN0IGludGVsX2VuY29kZXIgKmVuY29kZXIsCisJCQkJIGNvbnN0IHN0cnVjdCBpbnRl
bF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlLAorCQkJCSBjb25zdCBzdHJ1Y3QgZHJtX2Nvbm5lY3Rv
cl9zdGF0ZSAqY29ubl9zdGF0ZSkKK3sKKwlzdHJ1Y3QgaW50ZWxfZHAgKmludGVsX2RwID0gZW5j
X3RvX2ludGVsX2RwKGVuY29kZXIpOworCisJaW50ZWxfcGFuZWxfdXBkYXRlX2JhY2tsaWdodChz
dGF0ZSwgZW5jb2RlciwgY3J0Y19zdGF0ZSwgY29ubl9zdGF0ZSk7CisJaW50ZWxfcHNyMl9wcm9n
cmFtX3RyYW5zX21hbl90cmtfY3RsKGludGVsX2RwLCBjcnRjX3N0YXRlKTsKK30KKwogYm9vbAog
aW50ZWxfZHBfaW5pdF9jb25uZWN0b3Ioc3RydWN0IGludGVsX2RpZ2l0YWxfcG9ydCAqZGlnX3Bv
cnQsCiAJCQlzdHJ1Y3QgaW50ZWxfY29ubmVjdG9yICppbnRlbF9jb25uZWN0b3IpCkBAIC04MTg0
LDYgKzgxOTMsOCBAQCBpbnRlbF9kcF9pbml0X2Nvbm5lY3RvcihzdHJ1Y3QgaW50ZWxfZGlnaXRh
bF9wb3J0ICpkaWdfcG9ydCwKIAkJCSAgICAgICAodGVtcCAmIH4weGYpIHwgMHhkKTsKIAl9CiAK
KwlpbnRlbF9wc3JfaW5pdChpbnRlbF9kcCk7CisKIAlyZXR1cm4gdHJ1ZTsKIAogZmFpbDoKQEAg
LTgyMjUsNyArODIzNiw3IEBAIGJvb2wgaW50ZWxfZHBfaW5pdChzdHJ1Y3QgZHJtX2k5MTVfcHJp
dmF0ZSAqZGV2X3ByaXYsCiAJaW50ZWxfZW5jb2Rlci0+Z2V0X2NvbmZpZyA9IGludGVsX2RwX2dl
dF9jb25maWc7CiAJaW50ZWxfZW5jb2Rlci0+c3luY19zdGF0ZSA9IGludGVsX2RwX3N5bmNfc3Rh
dGU7CiAJaW50ZWxfZW5jb2Rlci0+aW5pdGlhbF9mYXN0c2V0X2NoZWNrID0gaW50ZWxfZHBfaW5p
dGlhbF9mYXN0c2V0X2NoZWNrOwotCWludGVsX2VuY29kZXItPnVwZGF0ZV9waXBlID0gaW50ZWxf
cGFuZWxfdXBkYXRlX2JhY2tsaWdodDsKKwlpbnRlbF9lbmNvZGVyLT51cGRhdGVfcGlwZSA9IGlu
dGVsX2RwX3VwZGF0ZV9waXBlOwogCWludGVsX2VuY29kZXItPnN1c3BlbmQgPSBpbnRlbF9kcF9l
bmNvZGVyX3N1c3BlbmQ7CiAJaW50ZWxfZW5jb2Rlci0+c2h1dGRvd24gPSBpbnRlbF9kcF9lbmNv
ZGVyX3NodXRkb3duOwogCWlmIChJU19DSEVSUllWSUVXKGRldl9wcml2KSkgewpkaWZmIC0tZ2l0
IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9wc3IuYyBiL2RyaXZlcnMvZ3B1
L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfcHNyLmMKaW5kZXggZDlhMzk1YzQ4NmQzLi5iZTJiMTIz
MDUwYzkgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfcHNy
LmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9wc3IuYwpAQCAtNzks
MTEgKzc5LDEzIEBACiAgKiB1c2UgcGFnZSBmbGlwcy4KICAqLwogCi1zdGF0aWMgYm9vbCBwc3Jf
Z2xvYmFsX2VuYWJsZWQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpCitzdGF0aWMgYm9v
bCBwc3JfZ2xvYmFsX2VuYWJsZWQoc3RydWN0IGludGVsX2RwICppbnRlbF9kcCkKIHsKLQlzd2l0
Y2ggKGk5MTUtPnBzci5kZWJ1ZyAmIEk5MTVfUFNSX0RFQlVHX01PREVfTUFTSykgeworCXN0cnVj
dCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IGRwX3RvX2k5MTUoaW50ZWxfZHApOworCisJ
c3dpdGNoIChpbnRlbF9kcC0+cHNyLmRlYnVnICYgSTkxNV9QU1JfREVCVUdfTU9ERV9NQVNLKSB7
CiAJY2FzZSBJOTE1X1BTUl9ERUJVR19ERUZBVUxUOgotCQlyZXR1cm4gaTkxNS0+cGFyYW1zLmVu
YWJsZV9wc3I7CisJCXJldHVybiBkZXZfcHJpdi0+cGFyYW1zLmVuYWJsZV9wc3I7CiAJY2FzZSBJ
OTE1X1BTUl9ERUJVR19ESVNBQkxFOgogCQlyZXR1cm4gZmFsc2U7CiAJZGVmYXVsdDoKQEAgLTkx
LDkgKzkzLDkgQEAgc3RhdGljIGJvb2wgcHNyX2dsb2JhbF9lbmFibGVkKHN0cnVjdCBkcm1faTkx
NV9wcml2YXRlICppOTE1KQogCX0KIH0KIAotc3RhdGljIGJvb2wgcHNyMl9nbG9iYWxfZW5hYmxl
ZChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCitzdGF0aWMgYm9vbCBwc3IyX2ds
b2JhbF9lbmFibGVkKHN0cnVjdCBpbnRlbF9kcCAqaW50ZWxfZHApCiB7Ci0Jc3dpdGNoIChkZXZf
cHJpdi0+cHNyLmRlYnVnICYgSTkxNV9QU1JfREVCVUdfTU9ERV9NQVNLKSB7CisJc3dpdGNoIChp
bnRlbF9kcC0+cHNyLmRlYnVnICYgSTkxNV9QU1JfREVCVUdfTU9ERV9NQVNLKSB7CiAJY2FzZSBJ
OTE1X1BTUl9ERUJVR19ESVNBQkxFOgogCWNhc2UgSTkxNV9QU1JfREVCVUdfRk9SQ0VfUFNSMToK
IAkJcmV0dXJuIGZhbHNlOwpAQCAtMTAyLDExICsxMDQsMTIgQEAgc3RhdGljIGJvb2wgcHNyMl9n
bG9iYWxfZW5hYmxlZChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCiAJfQogfQog
Ci1zdGF0aWMgdm9pZCBwc3JfaXJxX2NvbnRyb2woc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRl
dl9wcml2KQorc3RhdGljIHZvaWQgcHNyX2lycV9jb250cm9sKHN0cnVjdCBpbnRlbF9kcCAqaW50
ZWxfZHApCiB7CiAJZW51bSB0cmFuc2NvZGVyIHRyYW5zX3NoaWZ0OwogCXUzMiBtYXNrLCB2YWw7
CiAJaTkxNV9yZWdfdCBpbXJfcmVnOworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJp
diA9IGRwX3RvX2k5MTUoaW50ZWxfZHApOwogCiAJLyoKIAkgKiBnZW4xMisgaGFzIHJlZ2lzdGVy
cyByZWxhdGl2ZSB0byB0cmFuc2NvZGVyIGFuZCBvbmUgcGVyIHRyYW5zY29kZXIKQEAgLTExNSwx
NCArMTE4LDE0IEBAIHN0YXRpYyB2b2lkIHBzcl9pcnFfY29udHJvbChzdHJ1Y3QgZHJtX2k5MTVf
cHJpdmF0ZSAqZGV2X3ByaXYpCiAJICovCiAJaWYgKElOVEVMX0dFTihkZXZfcHJpdikgPj0gMTIp
IHsKIAkJdHJhbnNfc2hpZnQgPSAwOwotCQlpbXJfcmVnID0gVFJBTlNfUFNSX0lNUihkZXZfcHJp
di0+cHNyLnRyYW5zY29kZXIpOworCQlpbXJfcmVnID0gVFJBTlNfUFNSX0lNUihpbnRlbF9kcC0+
cHNyLnRyYW5zY29kZXIpOwogCX0gZWxzZSB7Ci0JCXRyYW5zX3NoaWZ0ID0gZGV2X3ByaXYtPnBz
ci50cmFuc2NvZGVyOworCQl0cmFuc19zaGlmdCA9IGludGVsX2RwLT5wc3IudHJhbnNjb2RlcjsK
IAkJaW1yX3JlZyA9IEVEUF9QU1JfSU1SOwogCX0KIAogCW1hc2sgPSBFRFBfUFNSX0VSUk9SKHRy
YW5zX3NoaWZ0KTsKLQlpZiAoZGV2X3ByaXYtPnBzci5kZWJ1ZyAmIEk5MTVfUFNSX0RFQlVHX0lS
USkKKwlpZiAoaW50ZWxfZHAtPnBzci5kZWJ1ZyAmIEk5MTVfUFNSX0RFQlVHX0lSUSkKIAkJbWFz
ayB8PSBFRFBfUFNSX1BPU1RfRVhJVCh0cmFuc19zaGlmdCkgfAogCQkJRURQX1BTUl9QUkVfRU5U
UlkodHJhbnNfc2hpZnQpOwogCkBAIC0xNzEsMzggKzE3NCwzNyBAQCBzdGF0aWMgdm9pZCBwc3Jf
ZXZlbnRfcHJpbnQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUsCiAJCWRybV9kYmdfa21z
KCZpOTE1LT5kcm0sICJcdFBTUiBkaXNhYmxlZFxuIik7CiB9CiAKLXZvaWQgaW50ZWxfcHNyX2ly
cV9oYW5kbGVyKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwgdTMyIHBzcl9paXIp
Cit2b2lkIGludGVsX3Bzcl9pcnFfaGFuZGxlcihzdHJ1Y3QgaW50ZWxfZHAgKmludGVsX2RwLCB1
MzIgcHNyX2lpcikKIHsKLQllbnVtIHRyYW5zY29kZXIgY3B1X3RyYW5zY29kZXIgPSBkZXZfcHJp
di0+cHNyLnRyYW5zY29kZXI7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0g
ZHBfdG9faTkxNShpbnRlbF9kcCk7CisJZW51bSB0cmFuc2NvZGVyIGNwdV90cmFuc2NvZGVyID0g
aW50ZWxfZHAtPnBzci50cmFuc2NvZGVyOwogCWVudW0gdHJhbnNjb2RlciB0cmFuc19zaGlmdDsK
IAlpOTE1X3JlZ190IGltcl9yZWc7CiAJa3RpbWVfdCB0aW1lX25zID0gIGt0aW1lX2dldCgpOwog
CiAJaWYgKElOVEVMX0dFTihkZXZfcHJpdikgPj0gMTIpIHsKIAkJdHJhbnNfc2hpZnQgPSAwOwot
CQlpbXJfcmVnID0gVFJBTlNfUFNSX0lNUihkZXZfcHJpdi0+cHNyLnRyYW5zY29kZXIpOworCQlp
bXJfcmVnID0gVFJBTlNfUFNSX0lNUihpbnRlbF9kcC0+cHNyLnRyYW5zY29kZXIpOwogCX0gZWxz
ZSB7Ci0JCXRyYW5zX3NoaWZ0ID0gZGV2X3ByaXYtPnBzci50cmFuc2NvZGVyOworCQl0cmFuc19z
aGlmdCA9IGludGVsX2RwLT5wc3IudHJhbnNjb2RlcjsKIAkJaW1yX3JlZyA9IEVEUF9QU1JfSU1S
OwogCX0KIAogCWlmIChwc3JfaWlyICYgRURQX1BTUl9QUkVfRU5UUlkodHJhbnNfc2hpZnQpKSB7
Ci0JCWRldl9wcml2LT5wc3IubGFzdF9lbnRyeV9hdHRlbXB0ID0gdGltZV9uczsKLQkJZHJtX2Ri
Z19rbXMoJmRldl9wcml2LT5kcm0sCi0JCQkgICAgIlt0cmFuc2NvZGVyICVzXSBQU1IgZW50cnkg
YXR0ZW1wdCBpbiAyIHZibGFua3NcbiIsCi0JCQkgICAgdHJhbnNjb2Rlcl9uYW1lKGNwdV90cmFu
c2NvZGVyKSk7CisJCWludGVsX2RwLT5wc3IubGFzdF9lbnRyeV9hdHRlbXB0ID0gdGltZV9uczsK
KwkJRFJNX0RFQlVHX0tNUygiW3RyYW5zY29kZXIgJXNdIFBTUiBlbnRyeSBhdHRlbXB0IGluIDIg
dmJsYW5rc1xuIiwKKwkJCSAgICAgIHRyYW5zY29kZXJfbmFtZShjcHVfdHJhbnNjb2RlcikpOwog
CX0KIAogCWlmIChwc3JfaWlyICYgRURQX1BTUl9QT1NUX0VYSVQodHJhbnNfc2hpZnQpKSB7Ci0J
CWRldl9wcml2LT5wc3IubGFzdF9leGl0ID0gdGltZV9uczsKLQkJZHJtX2RiZ19rbXMoJmRldl9w
cml2LT5kcm0sCi0JCQkgICAgIlt0cmFuc2NvZGVyICVzXSBQU1IgZXhpdCBjb21wbGV0ZWRcbiIs
Ci0JCQkgICAgdHJhbnNjb2Rlcl9uYW1lKGNwdV90cmFuc2NvZGVyKSk7CisJCWludGVsX2RwLT5w
c3IubGFzdF9leGl0ID0gdGltZV9uczsKKwkJRFJNX0RFQlVHX0tNUygiW3RyYW5zY29kZXIgJXNd
IFBTUiBleGl0IGNvbXBsZXRlZFxuIiwKKwkJCSAgICAgIHRyYW5zY29kZXJfbmFtZShjcHVfdHJh
bnNjb2RlcikpOwogCiAJCWlmIChJTlRFTF9HRU4oZGV2X3ByaXYpID49IDkpIHsKIAkJCXUzMiB2
YWwgPSBpbnRlbF9kZV9yZWFkKGRldl9wcml2LAogCQkJCQkJUFNSX0VWRU5UKGNwdV90cmFuc2Nv
ZGVyKSk7Ci0JCQlib29sIHBzcjJfZW5hYmxlZCA9IGRldl9wcml2LT5wc3IucHNyMl9lbmFibGVk
OworCQkJYm9vbCBwc3IyX2VuYWJsZWQgPSBpbnRlbF9kcC0+cHNyLnBzcjJfZW5hYmxlZDsKIAog
CQkJaW50ZWxfZGVfd3JpdGUoZGV2X3ByaXYsIFBTUl9FVkVOVChjcHVfdHJhbnNjb2RlciksCiAJ
CQkJICAgICAgIHZhbCk7CkBAIC0yMTMsMTAgKzIxNSwxMCBAQCB2b2lkIGludGVsX3Bzcl9pcnFf
aGFuZGxlcihzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsIHUzMiBwc3JfaWlyKQog
CWlmIChwc3JfaWlyICYgRURQX1BTUl9FUlJPUih0cmFuc19zaGlmdCkpIHsKIAkJdTMyIHZhbDsK
IAotCQlkcm1fd2FybigmZGV2X3ByaXYtPmRybSwgIlt0cmFuc2NvZGVyICVzXSBQU1IgYXV4IGVy
cm9yXG4iLAorCQlEUk1fV0FSTigiW3RyYW5zY29kZXIgJXNdIFBTUiBhdXggZXJyb3JcbiIsCiAJ
CQkgdHJhbnNjb2Rlcl9uYW1lKGNwdV90cmFuc2NvZGVyKSk7CiAKLQkJZGV2X3ByaXYtPnBzci5p
cnFfYXV4X2Vycm9yID0gdHJ1ZTsKKwkJaW50ZWxfZHAtPnBzci5pcnFfYXV4X2Vycm9yID0gdHJ1
ZTsKIAogCQkvKgogCQkgKiBJZiB0aGlzIGludGVycnVwdGlvbiBpcyBub3QgbWFza2VkIGl0IHdp
bGwga2VlcApAQCAtMjMwLDcgKzIzMiw3IEBAIHZvaWQgaW50ZWxfcHNyX2lycV9oYW5kbGVyKHN0
cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwgdTMyIHBzcl9paXIpCiAJCXZhbCB8PSBF
RFBfUFNSX0VSUk9SKHRyYW5zX3NoaWZ0KTsKIAkJaW50ZWxfZGVfd3JpdGUoZGV2X3ByaXYsIGlt
cl9yZWcsIHZhbCk7CiAKLQkJc2NoZWR1bGVfd29yaygmZGV2X3ByaXYtPnBzci53b3JrKTsKKwkJ
c2NoZWR1bGVfd29yaygmaW50ZWxfZHAtPnBzci53b3JrKTsKIAl9CiB9CiAKQEAgLTI5MSwxMiAr
MjkzLDYgQEAgdm9pZCBpbnRlbF9wc3JfaW5pdF9kcGNkKHN0cnVjdCBpbnRlbF9kcCAqaW50ZWxf
ZHApCiAJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0KIAkJdG9faTkxNShkcF90
b19kaWdfcG9ydChpbnRlbF9kcCktPmJhc2UuYmFzZS5kZXYpOwogCi0JaWYgKGRldl9wcml2LT5w
c3IuZHApIHsKLQkJZHJtX3dhcm4oJmRldl9wcml2LT5kcm0sCi0JCQkgIk1vcmUgdGhhbiBvbmUg
ZURQIHBhbmVsIGZvdW5kLCBQU1Igc3VwcG9ydCBzaG91bGQgYmUgZXh0ZW5kZWRcbiIpOwotCQly
ZXR1cm47Ci0JfQotCiAJZHJtX2RwX2RwY2RfcmVhZCgmaW50ZWxfZHAtPmF1eCwgRFBfUFNSX1NV
UFBPUlQsIGludGVsX2RwLT5wc3JfZHBjZCwKIAkJCSBzaXplb2YoaW50ZWxfZHAtPnBzcl9kcGNk
KSk7CiAKQEAgLTMxNywxMiArMzEzLDEwIEBAIHZvaWQgaW50ZWxfcHNyX2luaXRfZHBjZChzdHJ1
Y3QgaW50ZWxfZHAgKmludGVsX2RwKQogCQlyZXR1cm47CiAJfQogCi0JZGV2X3ByaXYtPnBzci5z
aW5rX3N1cHBvcnQgPSB0cnVlOwotCWRldl9wcml2LT5wc3Iuc2lua19zeW5jX2xhdGVuY3kgPQor
CWludGVsX2RwLT5wc3Iuc2lua19zdXBwb3J0ID0gdHJ1ZTsKKwlpbnRlbF9kcC0+cHNyLnNpbmtf
c3luY19sYXRlbmN5ID0KIAkJaW50ZWxfZHBfZ2V0X3Npbmtfc3luY19sYXRlbmN5KGludGVsX2Rw
KTsKIAotCWRldl9wcml2LT5wc3IuZHAgPSBpbnRlbF9kcDsKLQogCWlmIChJTlRFTF9HRU4oZGV2
X3ByaXYpID49IDkgJiYKIAkgICAgKGludGVsX2RwLT5wc3JfZHBjZFswXSA9PSBEUF9QU1IyX1dJ
VEhfWV9DT09SRF9JU19TVVBQT1JURUQpKSB7CiAJCWJvb2wgeV9yZXEgPSBpbnRlbF9kcC0+cHNy
X2RwY2RbMV0gJgpAQCAtMzQwLDE0ICszMzQsMTQgQEAgdm9pZCBpbnRlbF9wc3JfaW5pdF9kcGNk
KHN0cnVjdCBpbnRlbF9kcCAqaW50ZWxfZHApCiAJCSAqIFktY29vcmRpbmF0ZSByZXF1aXJlbWVu
dCBwYW5lbHMgd2Ugd291bGQgbmVlZCB0byBlbmFibGUKIAkJICogR1RDIGZpcnN0LgogCQkgKi8K
LQkJZGV2X3ByaXYtPnBzci5zaW5rX3BzcjJfc3VwcG9ydCA9IHlfcmVxICYmIGFscG07CisJCWlu
dGVsX2RwLT5wc3Iuc2lua19wc3IyX3N1cHBvcnQgPSB5X3JlcSAmJiBhbHBtOwogCQlkcm1fZGJn
X2ttcygmZGV2X3ByaXYtPmRybSwgIlBTUjIgJXNzdXBwb3J0ZWRcbiIsCi0JCQkgICAgZGV2X3By
aXYtPnBzci5zaW5rX3BzcjJfc3VwcG9ydCA/ICIiIDogIm5vdCAiKTsKKwkJCSAgICBpbnRlbF9k
cC0+cHNyLnNpbmtfcHNyMl9zdXBwb3J0ID8gIiIgOiAibm90ICIpOwogCi0JCWlmIChkZXZfcHJp
di0+cHNyLnNpbmtfcHNyMl9zdXBwb3J0KSB7Ci0JCQlkZXZfcHJpdi0+cHNyLmNvbG9yaW1ldHJ5
X3N1cHBvcnQgPQorCQlpZiAoaW50ZWxfZHAtPnBzci5zaW5rX3BzcjJfc3VwcG9ydCkgeworCQkJ
aW50ZWxfZHAtPnBzci5jb2xvcmltZXRyeV9zdXBwb3J0ID0KIAkJCQlpbnRlbF9kcF9nZXRfY29s
b3JpbWV0cnlfc3RhdHVzKGludGVsX2RwKTsKLQkJCWRldl9wcml2LT5wc3Iuc3VfeF9ncmFudWxh
cml0eSA9CisJCQlpbnRlbF9kcC0+cHNyLnN1X3hfZ3JhbnVsYXJpdHkgPQogCQkJCWludGVsX2Rw
X2dldF9zdV94X2dyYW51bGFydGl5KGludGVsX2RwKTsKIAkJfQogCX0KQEAgLTM3Myw3ICszNjcs
NyBAQCBzdGF0aWMgdm9pZCBoc3dfcHNyX3NldHVwX2F1eChzdHJ1Y3QgaW50ZWxfZHAgKmludGVs
X2RwKQogCUJVSUxEX0JVR19PTihzaXplb2YoYXV4X21zZykgPiAyMCk7CiAJZm9yIChpID0gMDsg
aSA8IHNpemVvZihhdXhfbXNnKTsgaSArPSA0KQogCQlpbnRlbF9kZV93cml0ZShkZXZfcHJpdiwK
LQkJCSAgICAgICBFRFBfUFNSX0FVWF9EQVRBKGRldl9wcml2LT5wc3IudHJhbnNjb2RlciwgaSA+
PiAyKSwKKwkJCSAgICAgICBFRFBfUFNSX0FVWF9EQVRBKGludGVsX2RwLT5wc3IudHJhbnNjb2Rl
ciwgaSA+PiAyKSwKIAkJCSAgICAgICBpbnRlbF9kcF9wYWNrX2F1eCgmYXV4X21zZ1tpXSwgc2l6
ZW9mKGF1eF9tc2cpIC0gaSkpOwogCiAJYXV4X2Nsb2NrX2RpdmlkZXIgPSBpbnRlbF9kcC0+Z2V0
X2F1eF9jbG9ja19kaXZpZGVyKGludGVsX2RwLCAwKTsKQEAgLTM4NCw3ICszNzgsNyBAQCBzdGF0
aWMgdm9pZCBoc3dfcHNyX3NldHVwX2F1eChzdHJ1Y3QgaW50ZWxfZHAgKmludGVsX2RwKQogCiAJ
LyogU2VsZWN0IG9ubHkgdmFsaWQgYml0cyBmb3IgU1JEX0FVWF9DVEwgKi8KIAlhdXhfY3RsICY9
IHBzcl9hdXhfbWFzazsKLQlpbnRlbF9kZV93cml0ZShkZXZfcHJpdiwgRURQX1BTUl9BVVhfQ1RM
KGRldl9wcml2LT5wc3IudHJhbnNjb2RlciksCisJaW50ZWxfZGVfd3JpdGUoZGV2X3ByaXYsIEVE
UF9QU1JfQVVYX0NUTChpbnRlbF9kcC0+cHNyLnRyYW5zY29kZXIpLAogCQkgICAgICAgYXV4X2N0
bCk7CiB9CiAKQEAgLTM5NCwxNCArMzg4LDE0IEBAIHN0YXRpYyB2b2lkIGludGVsX3Bzcl9lbmFi
bGVfc2luayhzdHJ1Y3QgaW50ZWxfZHAgKmludGVsX2RwKQogCXU4IGRwY2RfdmFsID0gRFBfUFNS
X0VOQUJMRTsKIAogCS8qIEVuYWJsZSBBTFBNIGF0IHNpbmsgZm9yIHBzcjIgKi8KLQlpZiAoZGV2
X3ByaXYtPnBzci5wc3IyX2VuYWJsZWQpIHsKKwlpZiAoaW50ZWxfZHAtPnBzci5wc3IyX2VuYWJs
ZWQpIHsKIAkJZHJtX2RwX2RwY2Rfd3JpdGViKCZpbnRlbF9kcC0+YXV4LCBEUF9SRUNFSVZFUl9B
TFBNX0NPTkZJRywKIAkJCQkgICBEUF9BTFBNX0VOQUJMRSB8CiAJCQkJICAgRFBfQUxQTV9MT0NL
X0VSUk9SX0lSUV9IUERfRU5BQkxFKTsKIAogCQlkcGNkX3ZhbCB8PSBEUF9QU1JfRU5BQkxFX1BT
UjIgfCBEUF9QU1JfSVJRX0hQRF9XSVRIX0NSQ19FUlJPUlM7CiAJfSBlbHNlIHsKLQkJaWYgKGRl
dl9wcml2LT5wc3IubGlua19zdGFuZGJ5KQorCQlpZiAoaW50ZWxfZHAtPnBzci5saW5rX3N0YW5k
YnkpCiAJCQlkcGNkX3ZhbCB8PSBEUF9QU1JfTUFJTl9MSU5LX0FDVElWRTsKIAogCQlpZiAoSU5U
RUxfR0VOKGRldl9wcml2KSA+PSA4KQpAQCAtNDY0LDcgKzQ1OCw3IEBAIHN0YXRpYyB1OCBwc3Jf
Y29tcHV0ZV9pZGxlX2ZyYW1lcyhzdHJ1Y3QgaW50ZWxfZHAgKmludGVsX2RwKQogCSAqIG9mZi1i
eS1vbmUgaXNzdWUgdGhhdCBIVyBoYXMgaW4gc29tZSBjYXNlcy4KIAkgKi8KIAlpZGxlX2ZyYW1l
cyA9IG1heCg2LCBkZXZfcHJpdi0+dmJ0LnBzci5pZGxlX2ZyYW1lcyk7Ci0JaWRsZV9mcmFtZXMg
PSBtYXgoaWRsZV9mcmFtZXMsIGRldl9wcml2LT5wc3Iuc2lua19zeW5jX2xhdGVuY3kgKyAxKTsK
KwlpZGxlX2ZyYW1lcyA9IG1heChpZGxlX2ZyYW1lcywgaW50ZWxfZHAtPnBzci5zaW5rX3N5bmNf
bGF0ZW5jeSArIDEpOwogCiAJaWYgKGRybV9XQVJOX09OKCZkZXZfcHJpdi0+ZHJtLCBpZGxlX2Zy
YW1lcyA+IDB4ZikpCiAJCWlkbGVfZnJhbWVzID0gMHhmOwpAQCAtNDg0LDcgKzQ3OCw3IEBAIHN0
YXRpYyB2b2lkIGhzd19hY3RpdmF0ZV9wc3IxKHN0cnVjdCBpbnRlbF9kcCAqaW50ZWxfZHApCiAJ
aWYgKElTX0hBU1dFTEwoZGV2X3ByaXYpKQogCQl2YWwgfD0gRURQX1BTUl9NSU5fTElOS19FTlRS
WV9USU1FXzhfTElORVM7CiAKLQlpZiAoZGV2X3ByaXYtPnBzci5saW5rX3N0YW5kYnkpCisJaWYg
KGludGVsX2RwLT5wc3IubGlua19zdGFuZGJ5KQogCQl2YWwgfD0gRURQX1BTUl9MSU5LX1NUQU5E
Qlk7CiAKIAl2YWwgfD0gaW50ZWxfcHNyMV9nZXRfdHBfdGltZShpbnRlbF9kcCk7CkBAIC00OTIs
OSArNDg2LDkgQEAgc3RhdGljIHZvaWQgaHN3X2FjdGl2YXRlX3BzcjEoc3RydWN0IGludGVsX2Rw
ICppbnRlbF9kcCkKIAlpZiAoSU5URUxfR0VOKGRldl9wcml2KSA+PSA4KQogCQl2YWwgfD0gRURQ
X1BTUl9DUkNfRU5BQkxFOwogCi0JdmFsIHw9IChpbnRlbF9kZV9yZWFkKGRldl9wcml2LCBFRFBf
UFNSX0NUTChkZXZfcHJpdi0+cHNyLnRyYW5zY29kZXIpKSAmCisJdmFsIHw9IChpbnRlbF9kZV9y
ZWFkKGRldl9wcml2LCBFRFBfUFNSX0NUTChpbnRlbF9kcC0+cHNyLnRyYW5zY29kZXIpKSAmCiAJ
CUVEUF9QU1JfUkVTVE9SRV9QU1JfQUNUSVZFX0NUWF9NQVNLKTsKLQlpbnRlbF9kZV93cml0ZShk
ZXZfcHJpdiwgRURQX1BTUl9DVEwoZGV2X3ByaXYtPnBzci50cmFuc2NvZGVyKSwgdmFsKTsKKwlp
bnRlbF9kZV93cml0ZShkZXZfcHJpdiwgRURQX1BTUl9DVEwoaW50ZWxfZHAtPnBzci50cmFuc2Nv
ZGVyKSwgdmFsKTsKIH0KIAogc3RhdGljIHUzMiBpbnRlbF9wc3IyX2dldF90cF90aW1lKHN0cnVj
dCBpbnRlbF9kcCAqaW50ZWxfZHApCkBAIC01MjksNyArNTIzLDcgQEAgc3RhdGljIHZvaWQgaHN3
X2FjdGl2YXRlX3BzcjIoc3RydWN0IGludGVsX2RwICppbnRlbF9kcCkKIAlpZiAoSU5URUxfR0VO
KGRldl9wcml2KSA+PSAxMCB8fCBJU19HRU1JTklMQUtFKGRldl9wcml2KSkKIAkJdmFsIHw9IEVE
UF9ZX0NPT1JESU5BVEVfRU5BQkxFOwogCi0JdmFsIHw9IEVEUF9QU1IyX0ZSQU1FX0JFRk9SRV9T
VShkZXZfcHJpdi0+cHNyLnNpbmtfc3luY19sYXRlbmN5ICsgMSk7CisJdmFsIHw9IEVEUF9QU1Iy
X0ZSQU1FX0JFRk9SRV9TVShpbnRlbF9kcC0+cHNyLnNpbmtfc3luY19sYXRlbmN5ICsgMSk7CiAJ
dmFsIHw9IGludGVsX3BzcjJfZ2V0X3RwX3RpbWUoaW50ZWxfZHApOwogCiAJaWYgKElOVEVMX0dF
TihkZXZfcHJpdikgPj0gMTIpIHsKQEAgLTU0OCw3ICs1NDIsNyBAQCBzdGF0aWMgdm9pZCBoc3df
YWN0aXZhdGVfcHNyMihzdHJ1Y3QgaW50ZWxfZHAgKmludGVsX2RwKQogCQl2YWwgfD0gRURQX1BT
UjJfRkFTVF9XQUtFKDcpOwogCX0KIAotCWlmIChkZXZfcHJpdi0+cHNyLnBzcjJfc2VsX2ZldGNo
X2VuYWJsZWQpIHsKKwlpZiAoaW50ZWxfZHAtPnBzci5wc3IyX3NlbF9mZXRjaF9lbmFibGVkKSB7
CiAJCS8qIFdBIDE0MDgzMzA4NDcgKi8KIAkJaWYgKElTX1RHTF9ESVNQX1JFVklEKGRldl9wcml2
LCBUR0xfUkVWSURfQTAsIFRHTF9SRVZJRF9BMCkgfHwKIAkJICAgIElTX1JLTF9SRVZJRChkZXZf
cHJpdiwgUktMX1JFVklEX0EwLCBSS0xfUkVWSURfQTApKQpAQCAtNTU3LDIwICs1NTEsMjAgQEAg
c3RhdGljIHZvaWQgaHN3X2FjdGl2YXRlX3BzcjIoc3RydWN0IGludGVsX2RwICppbnRlbF9kcCkK
IAkJCQkgICAgIERJU19SQU1fQllQQVNTX1BTUjJfTUFOX1RSQUNLKTsKIAogCQlpbnRlbF9kZV93
cml0ZShkZXZfcHJpdiwKLQkJCSAgICAgICBQU1IyX01BTl9UUktfQ1RMKGRldl9wcml2LT5wc3Iu
dHJhbnNjb2RlciksCisJCQkgICAgICAgUFNSMl9NQU5fVFJLX0NUTChpbnRlbF9kcC0+cHNyLnRy
YW5zY29kZXIpLAogCQkJICAgICAgIFBTUjJfTUFOX1RSS19DVExfRU5BQkxFKTsKIAl9IGVsc2Ug
aWYgKEhBU19QU1IyX1NFTF9GRVRDSChkZXZfcHJpdikpIHsKIAkJaW50ZWxfZGVfd3JpdGUoZGV2
X3ByaXYsCi0JCQkgICAgICAgUFNSMl9NQU5fVFJLX0NUTChkZXZfcHJpdi0+cHNyLnRyYW5zY29k
ZXIpLCAwKTsKKwkJCSAgICAgICBQU1IyX01BTl9UUktfQ1RMKGludGVsX2RwLT5wc3IudHJhbnNj
b2RlciksIDApOwogCX0KIAogCS8qCiAJICogUFNSMiBIVyBpcyBpbmNvcnJlY3RseSB1c2luZyBF
RFBfUFNSX1RQMV9UUDNfU0VMIGFuZCBCU3BlYyBpcwogCSAqIHJlY29tbWVuZGluZyBrZWVwIHRo
aXMgYml0IHVuc2V0IHdoaWxlIFBTUjIgaXMgZW5hYmxlZC4KIAkgKi8KLQlpbnRlbF9kZV93cml0
ZShkZXZfcHJpdiwgRURQX1BTUl9DVEwoZGV2X3ByaXYtPnBzci50cmFuc2NvZGVyKSwgMCk7CisJ
aW50ZWxfZGVfd3JpdGUoZGV2X3ByaXYsIEVEUF9QU1JfQ1RMKGludGVsX2RwLT5wc3IudHJhbnNj
b2RlciksIDApOwogCi0JaW50ZWxfZGVfd3JpdGUoZGV2X3ByaXYsIEVEUF9QU1IyX0NUTChkZXZf
cHJpdi0+cHNyLnRyYW5zY29kZXIpLCB2YWwpOworCWludGVsX2RlX3dyaXRlKGRldl9wcml2LCBF
RFBfUFNSMl9DVEwoaW50ZWxfZHAtPnBzci50cmFuc2NvZGVyKSwgdmFsKTsKIH0KIAogc3RhdGlj
IGJvb2wKQEAgLTU5Myw1NSArNTg3LDU4IEBAIHN0YXRpYyB1MzIgaW50ZWxfZ2V0X2ZyYW1lX3Rp
bWVfdXMoY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNzdGF0ZSkKIAkJCSAgICBkcm1f
bW9kZV92cmVmcmVzaCgmY3N0YXRlLT5ody5hZGp1c3RlZF9tb2RlKSk7CiB9CiAKLXN0YXRpYyB2
b2lkIHBzcjJfcHJvZ3JhbV9pZGxlX2ZyYW1lcyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2
X3ByaXYsCitzdGF0aWMgdm9pZCBwc3IyX3Byb2dyYW1faWRsZV9mcmFtZXMoc3RydWN0IGludGVs
X2RwICppbnRlbF9kcCwKIAkJCQkgICAgIHUzMiBpZGxlX2ZyYW1lcykKIHsKKwlzdHJ1Y3QgZHJt
X2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSBkcF90b19pOTE1KGludGVsX2RwKTsKIAl1MzIgdmFs
OwogCiAJaWRsZV9mcmFtZXMgPDw9ICBFRFBfUFNSMl9JRExFX0ZSQU1FX1NISUZUOwotCXZhbCA9
IGludGVsX2RlX3JlYWQoZGV2X3ByaXYsIEVEUF9QU1IyX0NUTChkZXZfcHJpdi0+cHNyLnRyYW5z
Y29kZXIpKTsKKwl2YWwgPSBpbnRlbF9kZV9yZWFkKGRldl9wcml2LCBFRFBfUFNSMl9DVEwoaW50
ZWxfZHAtPnBzci50cmFuc2NvZGVyKSk7CiAJdmFsICY9IH5FRFBfUFNSMl9JRExFX0ZSQU1FX01B
U0s7CiAJdmFsIHw9IGlkbGVfZnJhbWVzOwotCWludGVsX2RlX3dyaXRlKGRldl9wcml2LCBFRFBf
UFNSMl9DVEwoZGV2X3ByaXYtPnBzci50cmFuc2NvZGVyKSwgdmFsKTsKKwlpbnRlbF9kZV93cml0
ZShkZXZfcHJpdiwgRURQX1BTUjJfQ1RMKGludGVsX2RwLT5wc3IudHJhbnNjb2RlciksIHZhbCk7
CiB9CiAKLXN0YXRpYyB2b2lkIHRnbF9wc3IyX2VuYWJsZV9kYzNjbyhzdHJ1Y3QgZHJtX2k5MTVf
cHJpdmF0ZSAqZGV2X3ByaXYpCitzdGF0aWMgdm9pZCB0Z2xfcHNyMl9lbmFibGVfZGMzY28oc3Ry
dWN0IGludGVsX2RwICppbnRlbF9kcCkKIHsKLQlwc3IyX3Byb2dyYW1faWRsZV9mcmFtZXMoZGV2
X3ByaXYsIDApOworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IGRwX3RvX2k5
MTUoaW50ZWxfZHApOworCisJcHNyMl9wcm9ncmFtX2lkbGVfZnJhbWVzKGludGVsX2RwLCAwKTsK
IAlpbnRlbF9kaXNwbGF5X3Bvd2VyX3NldF90YXJnZXRfZGNfc3RhdGUoZGV2X3ByaXYsIERDX1NU
QVRFX0VOX0RDM0NPKTsKIH0KIAotc3RhdGljIHZvaWQgdGdsX3BzcjJfZGlzYWJsZV9kYzNjbyhz
dHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCitzdGF0aWMgdm9pZCB0Z2xfcHNyMl9k
aXNhYmxlX2RjM2NvKHN0cnVjdCBpbnRlbF9kcCAqaW50ZWxfZHApCiB7Ci0Jc3RydWN0IGludGVs
X2RwICppbnRlbF9kcCA9IGRldl9wcml2LT5wc3IuZHA7CisJc3RydWN0IGRybV9pOTE1X3ByaXZh
dGUgKmRldl9wcml2ID0gZHBfdG9faTkxNShpbnRlbF9kcCk7CiAKIAlpbnRlbF9kaXNwbGF5X3Bv
d2VyX3NldF90YXJnZXRfZGNfc3RhdGUoZGV2X3ByaXYsIERDX1NUQVRFX0VOX1VQVE9fREM2KTsK
LQlwc3IyX3Byb2dyYW1faWRsZV9mcmFtZXMoZGV2X3ByaXYsIHBzcl9jb21wdXRlX2lkbGVfZnJh
bWVzKGludGVsX2RwKSk7CisJcHNyMl9wcm9ncmFtX2lkbGVfZnJhbWVzKGludGVsX2RwLCBwc3Jf
Y29tcHV0ZV9pZGxlX2ZyYW1lcyhpbnRlbF9kcCkpOwogfQogCiBzdGF0aWMgdm9pZCB0Z2xfZGMz
Y29fZGlzYWJsZV93b3JrKHN0cnVjdCB3b3JrX3N0cnVjdCAqd29yaykKIHsKLQlzdHJ1Y3QgZHJt
X2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPQotCQljb250YWluZXJfb2Yod29yaywgdHlwZW9mKCpk
ZXZfcHJpdiksIHBzci5kYzNjb193b3JrLndvcmspOworCXN0cnVjdCBpbnRlbF9kcCAqaW50ZWxf
ZHAgPQorCQljb250YWluZXJfb2Yod29yaywgdHlwZW9mKCppbnRlbF9kcCksIHBzci5kYzNjb193
b3JrLndvcmspOwogCi0JbXV0ZXhfbG9jaygmZGV2X3ByaXYtPnBzci5sb2NrKTsKKwltdXRleF9s
b2NrKCZpbnRlbF9kcC0+cHNyLmxvY2spOwogCS8qIElmIGRlbGF5ZWQgd29yayBpcyBwZW5kaW5n
LCBpdCBpcyBub3QgaWRsZSAqLwotCWlmIChkZWxheWVkX3dvcmtfcGVuZGluZygmZGV2X3ByaXYt
PnBzci5kYzNjb193b3JrKSkKKwlpZiAoZGVsYXllZF93b3JrX3BlbmRpbmcoJmludGVsX2RwLT5w
c3IuZGMzY29fd29yaykpCiAJCWdvdG8gdW5sb2NrOwogCi0JdGdsX3BzcjJfZGlzYWJsZV9kYzNj
byhkZXZfcHJpdik7CisJdGdsX3BzcjJfZGlzYWJsZV9kYzNjbyhpbnRlbF9kcCk7CiB1bmxvY2s6
Ci0JbXV0ZXhfdW5sb2NrKCZkZXZfcHJpdi0+cHNyLmxvY2spOworCW11dGV4X3VubG9jaygmaW50
ZWxfZHAtPnBzci5sb2NrKTsKIH0KIAotc3RhdGljIHZvaWQgdGdsX2Rpc2FsbG93X2RjM2NvX29u
X3BzcjJfZXhpdChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCitzdGF0aWMgdm9p
ZCB0Z2xfZGlzYWxsb3dfZGMzY29fb25fcHNyMl9leGl0KHN0cnVjdCBpbnRlbF9kcCAqaW50ZWxf
ZHApCiB7Ci0JaWYgKCFkZXZfcHJpdi0+cHNyLmRjM2NvX2VuYWJsZWQpCisJaWYgKCFpbnRlbF9k
cC0+cHNyLmRjM2NvX2VuYWJsZWQpCiAJCXJldHVybjsKIAotCWNhbmNlbF9kZWxheWVkX3dvcmso
JmRldl9wcml2LT5wc3IuZGMzY29fd29yayk7CisJY2FuY2VsX2RlbGF5ZWRfd29yaygmaW50ZWxf
ZHAtPnBzci5kYzNjb193b3JrKTsKIAkvKiBCZWZvcmUgUFNSMiBleGl0IGRpc2FsbG93IGRjM2Nv
Ki8KLQl0Z2xfcHNyMl9kaXNhYmxlX2RjM2NvKGRldl9wcml2KTsKKwl0Z2xfcHNyMl9kaXNhYmxl
X2RjM2NvKGludGVsX2RwKTsKIH0KIAogc3RhdGljIHZvaWQKQEAgLTcxNCw3ICs3MTEsNyBAQCBz
dGF0aWMgYm9vbCBpbnRlbF9wc3IyX2NvbmZpZ192YWxpZChzdHJ1Y3QgaW50ZWxfZHAgKmludGVs
X2RwLAogCWludCBjcnRjX3ZkaXNwbGF5ID0gY3J0Y19zdGF0ZS0+aHcuYWRqdXN0ZWRfbW9kZS5j
cnRjX3ZkaXNwbGF5OwogCWludCBwc3JfbWF4X2ggPSAwLCBwc3JfbWF4X3YgPSAwLCBtYXhfYnBw
ID0gMDsKIAotCWlmICghZGV2X3ByaXYtPnBzci5zaW5rX3BzcjJfc3VwcG9ydCkKKwlpZiAoIWlu
dGVsX2RwLT5wc3Iuc2lua19wc3IyX3N1cHBvcnQpCiAJCXJldHVybiBmYWxzZTsKIAogCWlmICgh
dHJhbnNjb2Rlcl9oYXNfcHNyMihkZXZfcHJpdiwgY3J0Y19zdGF0ZS0+Y3B1X3RyYW5zY29kZXIp
KSB7CkBAIC03MjQsNyArNzIxLDcgQEAgc3RhdGljIGJvb2wgaW50ZWxfcHNyMl9jb25maWdfdmFs
aWQoc3RydWN0IGludGVsX2RwICppbnRlbF9kcCwKIAkJcmV0dXJuIGZhbHNlOwogCX0KIAotCWlm
ICghcHNyMl9nbG9iYWxfZW5hYmxlZChkZXZfcHJpdikpIHsKKwlpZiAoIXBzcjJfZ2xvYmFsX2Vu
YWJsZWQoaW50ZWxfZHApKSB7CiAJCWRybV9kYmdfa21zKCZkZXZfcHJpdi0+ZHJtLCAiUFNSMiBk
aXNhYmxlZCBieSBmbGFnXG4iKTsKIAkJcmV0dXJuIGZhbHNlOwogCX0KQEAgLTc3MywxMCArNzcw
LDEwIEBAIHN0YXRpYyBib29sIGludGVsX3BzcjJfY29uZmlnX3ZhbGlkKHN0cnVjdCBpbnRlbF9k
cCAqaW50ZWxfZHAsCiAJICogb25seSBuZWVkIHRvIHZhbGlkYXRlIHRoZSBTVSBibG9jayB3aWR0
aCBpcyBhIG11bHRpcGxlIG9mCiAJICogeCBncmFudWxhcml0eS4KIAkgKi8KLQlpZiAoY3J0Y19o
ZGlzcGxheSAlIGRldl9wcml2LT5wc3Iuc3VfeF9ncmFudWxhcml0eSkgeworCWlmIChjcnRjX2hk
aXNwbGF5ICUgaW50ZWxfZHAtPnBzci5zdV94X2dyYW51bGFyaXR5KSB7CiAJCWRybV9kYmdfa21z
KCZkZXZfcHJpdi0+ZHJtLAogCQkJICAgICJQU1IyIG5vdCBlbmFibGVkLCBoZGlzcGxheSglZCkg
bm90IG11bHRpcGxlIG9mICVkXG4iLAotCQkJICAgIGNydGNfaGRpc3BsYXksIGRldl9wcml2LT5w
c3Iuc3VfeF9ncmFudWxhcml0eSk7CisJCQkgICAgY3J0Y19oZGlzcGxheSwgaW50ZWxfZHAtPnBz
ci5zdV94X2dyYW51bGFyaXR5KTsKIAkJcmV0dXJuIGZhbHNlOwogCX0KIApAQCAtODExLDEzICs4
MDgsMTAgQEAgdm9pZCBpbnRlbF9wc3JfY29tcHV0ZV9jb25maWcoc3RydWN0IGludGVsX2RwICpp
bnRlbF9kcCwKIAkJJmNydGNfc3RhdGUtPmh3LmFkanVzdGVkX21vZGU7CiAJaW50IHBzcl9zZXR1
cF90aW1lOwogCi0JaWYgKCFDQU5fUFNSKGRldl9wcml2KSkKLQkJcmV0dXJuOwotCi0JaWYgKGlu
dGVsX2RwICE9IGRldl9wcml2LT5wc3IuZHApCisJaWYgKCFDQU5fUFNSKGludGVsX2RwKSkKIAkJ
cmV0dXJuOwogCi0JaWYgKCFwc3JfZ2xvYmFsX2VuYWJsZWQoZGV2X3ByaXYpKSB7CisJaWYgKCFw
c3JfZ2xvYmFsX2VuYWJsZWQoaW50ZWxfZHApKSB7CiAJCWRybV9kYmdfa21zKCZkZXZfcHJpdi0+
ZHJtLCAiUFNSIGRpc2FibGVkIGJ5IGZsYWdcbiIpOwogCQlyZXR1cm47CiAJfQpAQCAtODM0LDcg
KzgyOCw3IEBAIHZvaWQgaW50ZWxfcHNyX2NvbXB1dGVfY29uZmlnKHN0cnVjdCBpbnRlbF9kcCAq
aW50ZWxfZHAsCiAJCXJldHVybjsKIAl9CiAKLQlpZiAoZGV2X3ByaXYtPnBzci5zaW5rX25vdF9y
ZWxpYWJsZSkgeworCWlmIChpbnRlbF9kcC0+cHNyLnNpbmtfbm90X3JlbGlhYmxlKSB7CiAJCWRy
bV9kYmdfa21zKCZkZXZfcHJpdi0+ZHJtLAogCQkJICAgICJQU1Igc2luayBpbXBsZW1lbnRhdGlv
biBpcyBub3QgcmVsaWFibGVcbiIpOwogCQlyZXR1cm47CkBAIC04NzAsMjMgKzg2NCwyNCBAQCB2
b2lkIGludGVsX3Bzcl9jb21wdXRlX2NvbmZpZyhzdHJ1Y3QgaW50ZWxfZHAgKmludGVsX2RwLAog
c3RhdGljIHZvaWQgaW50ZWxfcHNyX2FjdGl2YXRlKHN0cnVjdCBpbnRlbF9kcCAqaW50ZWxfZHAp
CiB7CiAJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gZHBfdG9faTkxNShpbnRl
bF9kcCk7CisJZW51bSB0cmFuc2NvZGVyIHRyYW5zY29kZXIgPSBpbnRlbF9kcC0+cHNyLnRyYW5z
Y29kZXI7CiAKLQlpZiAodHJhbnNjb2Rlcl9oYXNfcHNyMihkZXZfcHJpdiwgZGV2X3ByaXYtPnBz
ci50cmFuc2NvZGVyKSkKKwlpZiAodHJhbnNjb2Rlcl9oYXNfcHNyMihkZXZfcHJpdiwgdHJhbnNj
b2RlcikpCiAJCWRybV9XQVJOX09OKCZkZXZfcHJpdi0+ZHJtLAotCQkJICAgIGludGVsX2RlX3Jl
YWQoZGV2X3ByaXYsIEVEUF9QU1IyX0NUTChkZXZfcHJpdi0+cHNyLnRyYW5zY29kZXIpKSAmIEVE
UF9QU1IyX0VOQUJMRSk7CisJCQkgICAgaW50ZWxfZGVfcmVhZChkZXZfcHJpdiwgRURQX1BTUjJf
Q1RMKHRyYW5zY29kZXIpKSAmIEVEUF9QU1IyX0VOQUJMRSk7CiAKIAlkcm1fV0FSTl9PTigmZGV2
X3ByaXYtPmRybSwKLQkJICAgIGludGVsX2RlX3JlYWQoZGV2X3ByaXYsIEVEUF9QU1JfQ1RMKGRl
dl9wcml2LT5wc3IudHJhbnNjb2RlcikpICYgRURQX1BTUl9FTkFCTEUpOwotCWRybV9XQVJOX09O
KCZkZXZfcHJpdi0+ZHJtLCBkZXZfcHJpdi0+cHNyLmFjdGl2ZSk7Ci0JbG9ja2RlcF9hc3NlcnRf
aGVsZCgmZGV2X3ByaXYtPnBzci5sb2NrKTsKKwkJICAgIGludGVsX2RlX3JlYWQoZGV2X3ByaXYs
IEVEUF9QU1JfQ1RMKHRyYW5zY29kZXIpKSAmIEVEUF9QU1JfRU5BQkxFKTsKKwlkcm1fV0FSTl9P
TigmZGV2X3ByaXYtPmRybSwgaW50ZWxfZHAtPnBzci5hY3RpdmUpOworCWxvY2tkZXBfYXNzZXJ0
X2hlbGQoJmludGVsX2RwLT5wc3IubG9jayk7CiAKIAkvKiBwc3IxIGFuZCBwc3IyIGFyZSBtdXR1
YWxseSBleGNsdXNpdmUuKi8KLQlpZiAoZGV2X3ByaXYtPnBzci5wc3IyX2VuYWJsZWQpCisJaWYg
KGludGVsX2RwLT5wc3IucHNyMl9lbmFibGVkKQogCQloc3dfYWN0aXZhdGVfcHNyMihpbnRlbF9k
cCk7CiAJZWxzZQogCQloc3dfYWN0aXZhdGVfcHNyMShpbnRlbF9kcCk7CiAKLQlkZXZfcHJpdi0+
cHNyLmFjdGl2ZSA9IHRydWU7CisJaW50ZWxfZHAtPnBzci5hY3RpdmUgPSB0cnVlOwogfQogCiBz
dGF0aWMgdm9pZCBpbnRlbF9wc3JfZW5hYmxlX3NvdXJjZShzdHJ1Y3QgaW50ZWxfZHAgKmludGVs
X2RwLApAQCAtOTAyLDcgKzg5Nyw3IEBAIHN0YXRpYyB2b2lkIGludGVsX3Bzcl9lbmFibGVfc291
cmNlKHN0cnVjdCBpbnRlbF9kcCAqaW50ZWxfZHAsCiAJaWYgKElTX0hBU1dFTEwoZGV2X3ByaXYp
IHx8IElTX0JST0FEV0VMTChkZXZfcHJpdikpCiAJCWhzd19wc3Jfc2V0dXBfYXV4KGludGVsX2Rw
KTsKIAotCWlmIChkZXZfcHJpdi0+cHNyLnBzcjJfZW5hYmxlZCAmJiAoSVNfR0VOKGRldl9wcml2
LCA5KSAmJgorCWlmIChpbnRlbF9kcC0+cHNyLnBzcjJfZW5hYmxlZCAmJiAoSVNfR0VOKGRldl9w
cml2LCA5KSAmJgogCQkJCQkgICAhSVNfR0VNSU5JTEFLRShkZXZfcHJpdikpKSB7CiAJCWk5MTVf
cmVnX3QgcmVnID0gQ0hJQ0tFTl9UUkFOUyhjcHVfdHJhbnNjb2Rlcik7CiAJCXUzMiBjaGlja2Vu
ID0gaW50ZWxfZGVfcmVhZChkZXZfcHJpdiwgcmVnKTsKQEAgLTkyNiwxMCArOTIxLDEwIEBAIHN0
YXRpYyB2b2lkIGludGVsX3Bzcl9lbmFibGVfc291cmNlKHN0cnVjdCBpbnRlbF9kcCAqaW50ZWxf
ZHAsCiAJaWYgKElOVEVMX0dFTihkZXZfcHJpdikgPCAxMSkKIAkJbWFzayB8PSBFRFBfUFNSX0RF
QlVHX01BU0tfRElTUF9SRUdfV1JJVEU7CiAKLQlpbnRlbF9kZV93cml0ZShkZXZfcHJpdiwgRURQ
X1BTUl9ERUJVRyhkZXZfcHJpdi0+cHNyLnRyYW5zY29kZXIpLAorCWludGVsX2RlX3dyaXRlKGRl
dl9wcml2LCBFRFBfUFNSX0RFQlVHKGludGVsX2RwLT5wc3IudHJhbnNjb2RlciksCiAJCSAgICAg
ICBtYXNrKTsKIAotCXBzcl9pcnFfY29udHJvbChkZXZfcHJpdik7CisJcHNyX2lycV9jb250cm9s
KGludGVsX2RwKTsKIAogCWlmIChjcnRjX3N0YXRlLT5kYzNjb19leGl0bGluZSkgewogCQl1MzIg
dmFsOwpAQCAtOTQ3LDMwICs5NDIsMzAgQEAgc3RhdGljIHZvaWQgaW50ZWxfcHNyX2VuYWJsZV9z
b3VyY2Uoc3RydWN0IGludGVsX2RwICppbnRlbF9kcCwKIAogCWlmIChIQVNfUFNSX0hXX1RSQUNL
SU5HKGRldl9wcml2KSAmJiBIQVNfUFNSMl9TRUxfRkVUQ0goZGV2X3ByaXYpKQogCQlpbnRlbF9k
ZV9ybXcoZGV2X3ByaXYsIENISUNLRU5fUEFSMV8xLCBJR05PUkVfUFNSMl9IV19UUkFDS0lORywK
LQkJCSAgICAgZGV2X3ByaXYtPnBzci5wc3IyX3NlbF9mZXRjaF9lbmFibGVkID8KKwkJCSAgICAg
aW50ZWxfZHAtPnBzci5wc3IyX3NlbF9mZXRjaF9lbmFibGVkID8KIAkJCSAgICAgSUdOT1JFX1BT
UjJfSFdfVFJBQ0tJTkcgOiAwKTsKIH0KIAotc3RhdGljIHZvaWQgaW50ZWxfcHNyX2VuYWJsZV9s
b2NrZWQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAorc3RhdGljIHZvaWQgaW50
ZWxfcHNyX2VuYWJsZV9sb2NrZWQoc3RydWN0IGludGVsX2RwICppbnRlbF9kcCwKIAkJCQkgICAg
Y29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUsCiAJCQkJICAgIGNvbnN0
IHN0cnVjdCBkcm1fY29ubmVjdG9yX3N0YXRlICpjb25uX3N0YXRlKQogewotCXN0cnVjdCBpbnRl
bF9kcCAqaW50ZWxfZHAgPSBkZXZfcHJpdi0+cHNyLmRwOworCXN0cnVjdCBkcm1faTkxNV9wcml2
YXRlICpkZXZfcHJpdiA9IGRwX3RvX2k5MTUoaW50ZWxfZHApOwogCXN0cnVjdCBpbnRlbF9kaWdp
dGFsX3BvcnQgKmRpZ19wb3J0ID0gZHBfdG9fZGlnX3BvcnQoaW50ZWxfZHApOwogCXN0cnVjdCBp
bnRlbF9lbmNvZGVyICplbmNvZGVyID0gJmRpZ19wb3J0LT5iYXNlOwogCXUzMiB2YWw7CiAKLQlk
cm1fV0FSTl9PTigmZGV2X3ByaXYtPmRybSwgZGV2X3ByaXYtPnBzci5lbmFibGVkKTsKKwlkcm1f
V0FSTl9PTigmZGV2X3ByaXYtPmRybSwgaW50ZWxfZHAtPnBzci5lbmFibGVkKTsKIAotCWRldl9w
cml2LT5wc3IucHNyMl9lbmFibGVkID0gY3J0Y19zdGF0ZS0+aGFzX3BzcjI7Ci0JZGV2X3ByaXYt
PnBzci5idXN5X2Zyb250YnVmZmVyX2JpdHMgPSAwOwotCWRldl9wcml2LT5wc3IucGlwZSA9IHRv
X2ludGVsX2NydGMoY3J0Y19zdGF0ZS0+dWFwaS5jcnRjKS0+cGlwZTsKLQlkZXZfcHJpdi0+cHNy
LmRjM2NvX2VuYWJsZWQgPSAhIWNydGNfc3RhdGUtPmRjM2NvX2V4aXRsaW5lOwotCWRldl9wcml2
LT5wc3IudHJhbnNjb2RlciA9IGNydGNfc3RhdGUtPmNwdV90cmFuc2NvZGVyOworCWludGVsX2Rw
LT5wc3IucHNyMl9lbmFibGVkID0gY3J0Y19zdGF0ZS0+aGFzX3BzcjI7CisJaW50ZWxfZHAtPnBz
ci5idXN5X2Zyb250YnVmZmVyX2JpdHMgPSAwOworCWludGVsX2RwLT5wc3IucGlwZSA9IHRvX2lu
dGVsX2NydGMoY3J0Y19zdGF0ZS0+dWFwaS5jcnRjKS0+cGlwZTsKKwlpbnRlbF9kcC0+cHNyLmRj
M2NvX2VuYWJsZWQgPSAhIWNydGNfc3RhdGUtPmRjM2NvX2V4aXRsaW5lOworCWludGVsX2RwLT5w
c3IudHJhbnNjb2RlciA9IGNydGNfc3RhdGUtPmNwdV90cmFuc2NvZGVyOwogCS8qIERDNS9EQzYg
cmVxdWlyZXMgYXQgbGVhc3QgNiBpZGxlIGZyYW1lcyAqLwogCXZhbCA9IHVzZWNzX3RvX2ppZmZp
ZXMoaW50ZWxfZ2V0X2ZyYW1lX3RpbWVfdXMoY3J0Y19zdGF0ZSkgKiA2KTsKLQlkZXZfcHJpdi0+
cHNyLmRjM2NvX2V4aXRfZGVsYXkgPSB2YWw7Ci0JZGV2X3ByaXYtPnBzci5wc3IyX3NlbF9mZXRj
aF9lbmFibGVkID0gY3J0Y19zdGF0ZS0+ZW5hYmxlX3BzcjJfc2VsX2ZldGNoOworCWludGVsX2Rw
LT5wc3IuZGMzY29fZXhpdF9kZWxheSA9IHZhbDsKKwlpbnRlbF9kcC0+cHNyLnBzcjJfc2VsX2Zl
dGNoX2VuYWJsZWQgPSBjcnRjX3N0YXRlLT5lbmFibGVfcHNyMl9zZWxfZmV0Y2g7CiAKIAkvKgog
CSAqIElmIGEgUFNSIGVycm9yIGhhcHBlbmVkIGFuZCB0aGUgZHJpdmVyIGlzIHJlbG9hZGVkLCB0
aGUgRURQX1BTUl9JSVIKQEAgLTk4MiwyNyArOTc3LDI3IEBAIHN0YXRpYyB2b2lkIGludGVsX3Bz
cl9lbmFibGVfbG9ja2VkKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKIAkgKi8K
IAlpZiAoSU5URUxfR0VOKGRldl9wcml2KSA+PSAxMikgewogCQl2YWwgPSBpbnRlbF9kZV9yZWFk
KGRldl9wcml2LAotCQkJCSAgICBUUkFOU19QU1JfSUlSKGRldl9wcml2LT5wc3IudHJhbnNjb2Rl
cikpOworCQkJCSAgICBUUkFOU19QU1JfSUlSKGludGVsX2RwLT5wc3IudHJhbnNjb2RlcikpOwog
CQl2YWwgJj0gRURQX1BTUl9FUlJPUigwKTsKIAl9IGVsc2UgewogCQl2YWwgPSBpbnRlbF9kZV9y
ZWFkKGRldl9wcml2LCBFRFBfUFNSX0lJUik7Ci0JCXZhbCAmPSBFRFBfUFNSX0VSUk9SKGRldl9w
cml2LT5wc3IudHJhbnNjb2Rlcik7CisJCXZhbCAmPSBFRFBfUFNSX0VSUk9SKGludGVsX2RwLT5w
c3IudHJhbnNjb2Rlcik7CiAJfQogCWlmICh2YWwpIHsKLQkJZGV2X3ByaXYtPnBzci5zaW5rX25v
dF9yZWxpYWJsZSA9IHRydWU7CisJCWludGVsX2RwLT5wc3Iuc2lua19ub3RfcmVsaWFibGUgPSB0
cnVlOwogCQlkcm1fZGJnX2ttcygmZGV2X3ByaXYtPmRybSwKIAkJCSAgICAiUFNSIGludGVycnVw
dGlvbiBlcnJvciBzZXQsIG5vdCBlbmFibGluZyBQU1JcbiIpOwogCQlyZXR1cm47CiAJfQogCiAJ
ZHJtX2RiZ19rbXMoJmRldl9wcml2LT5kcm0sICJFbmFibGluZyBQU1Ilc1xuIiwKLQkJICAgIGRl
dl9wcml2LT5wc3IucHNyMl9lbmFibGVkID8gIjIiIDogIjEiKTsKKwkJICAgIGludGVsX2RwLT5w
c3IucHNyMl9lbmFibGVkID8gIjIiIDogIjEiKTsKIAlpbnRlbF9kcF9jb21wdXRlX3Bzcl92c2Nf
c2RwKGludGVsX2RwLCBjcnRjX3N0YXRlLCBjb25uX3N0YXRlLAotCQkJCSAgICAgJmRldl9wcml2
LT5wc3IudnNjKTsKLQlpbnRlbF93cml0ZV9kcF92c2Nfc2RwKGVuY29kZXIsIGNydGNfc3RhdGUs
ICZkZXZfcHJpdi0+cHNyLnZzYyk7CisJCQkJICAgICAmaW50ZWxfZHAtPnBzci52c2MpOworCWlu
dGVsX3dyaXRlX2RwX3ZzY19zZHAoZW5jb2RlciwgY3J0Y19zdGF0ZSwgJmludGVsX2RwLT5wc3Iu
dnNjKTsKIAlpbnRlbF9wc3JfZW5hYmxlX3NpbmsoaW50ZWxfZHApOwogCWludGVsX3Bzcl9lbmFi
bGVfc291cmNlKGludGVsX2RwLCBjcnRjX3N0YXRlKTsKLQlkZXZfcHJpdi0+cHNyLmVuYWJsZWQg
PSB0cnVlOworCWludGVsX2RwLT5wc3IuZW5hYmxlZCA9IHRydWU7CiAKIAlpbnRlbF9wc3JfYWN0
aXZhdGUoaW50ZWxfZHApOwogfQpAQCAtMTAyMSw3ICsxMDE2LDcgQEAgdm9pZCBpbnRlbF9wc3Jf
ZW5hYmxlKHN0cnVjdCBpbnRlbF9kcCAqaW50ZWxfZHAsCiB7CiAJc3RydWN0IGRybV9pOTE1X3By
aXZhdGUgKmRldl9wcml2ID0gZHBfdG9faTkxNShpbnRlbF9kcCk7CiAKLQlpZiAoIUNBTl9QU1Io
ZGV2X3ByaXYpIHx8IGRldl9wcml2LT5wc3IuZHAgIT0gaW50ZWxfZHApCisJaWYgKCFDQU5fUFNS
KGludGVsX2RwKSkKIAkJcmV0dXJuOwogCiAJaWYgKCFjcnRjX3N0YXRlLT5oYXNfcHNyKQpAQCAt
MTAyOSw0NiArMTAyNCw0NyBAQCB2b2lkIGludGVsX3Bzcl9lbmFibGUoc3RydWN0IGludGVsX2Rw
ICppbnRlbF9kcCwKIAogCWRybV9XQVJOX09OKCZkZXZfcHJpdi0+ZHJtLCBkZXZfcHJpdi0+ZHJy
cy5kcCk7CiAKLQltdXRleF9sb2NrKCZkZXZfcHJpdi0+cHNyLmxvY2spOwotCWludGVsX3Bzcl9l
bmFibGVfbG9ja2VkKGRldl9wcml2LCBjcnRjX3N0YXRlLCBjb25uX3N0YXRlKTsKLQltdXRleF91
bmxvY2soJmRldl9wcml2LT5wc3IubG9jayk7CisJbXV0ZXhfbG9jaygmaW50ZWxfZHAtPnBzci5s
b2NrKTsKKwlpbnRlbF9wc3JfZW5hYmxlX2xvY2tlZChpbnRlbF9kcCwgY3J0Y19zdGF0ZSwgY29u
bl9zdGF0ZSk7CisJbXV0ZXhfdW5sb2NrKCZpbnRlbF9kcC0+cHNyLmxvY2spOwogfQogCi1zdGF0
aWMgdm9pZCBpbnRlbF9wc3JfZXhpdChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYp
CitzdGF0aWMgdm9pZCBpbnRlbF9wc3JfZXhpdChzdHJ1Y3QgaW50ZWxfZHAgKmludGVsX2RwKQog
eworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IGRwX3RvX2k5MTUoaW50ZWxf
ZHApOwogCXUzMiB2YWw7CiAKLQlpZiAoIWRldl9wcml2LT5wc3IuYWN0aXZlKSB7Ci0JCWlmICh0
cmFuc2NvZGVyX2hhc19wc3IyKGRldl9wcml2LCBkZXZfcHJpdi0+cHNyLnRyYW5zY29kZXIpKSB7
CisJaWYgKCFpbnRlbF9kcC0+cHNyLmFjdGl2ZSkgeworCQlpZiAodHJhbnNjb2Rlcl9oYXNfcHNy
MihkZXZfcHJpdiwgaW50ZWxfZHAtPnBzci50cmFuc2NvZGVyKSkgewogCQkJdmFsID0gaW50ZWxf
ZGVfcmVhZChkZXZfcHJpdiwKLQkJCQkJICAgIEVEUF9QU1IyX0NUTChkZXZfcHJpdi0+cHNyLnRy
YW5zY29kZXIpKTsKKwkJCQkJICAgIEVEUF9QU1IyX0NUTChpbnRlbF9kcC0+cHNyLnRyYW5zY29k
ZXIpKTsKIAkJCWRybV9XQVJOX09OKCZkZXZfcHJpdi0+ZHJtLCB2YWwgJiBFRFBfUFNSMl9FTkFC
TEUpOwogCQl9CiAKIAkJdmFsID0gaW50ZWxfZGVfcmVhZChkZXZfcHJpdiwKLQkJCQkgICAgRURQ
X1BTUl9DVEwoZGV2X3ByaXYtPnBzci50cmFuc2NvZGVyKSk7CisJCQkJICAgIEVEUF9QU1JfQ1RM
KGludGVsX2RwLT5wc3IudHJhbnNjb2RlcikpOwogCQlkcm1fV0FSTl9PTigmZGV2X3ByaXYtPmRy
bSwgdmFsICYgRURQX1BTUl9FTkFCTEUpOwogCiAJCXJldHVybjsKIAl9CiAKLQlpZiAoZGV2X3By
aXYtPnBzci5wc3IyX2VuYWJsZWQpIHsKLQkJdGdsX2Rpc2FsbG93X2RjM2NvX29uX3BzcjJfZXhp
dChkZXZfcHJpdik7CisJaWYgKGludGVsX2RwLT5wc3IucHNyMl9lbmFibGVkKSB7CisJCXRnbF9k
aXNhbGxvd19kYzNjb19vbl9wc3IyX2V4aXQoaW50ZWxfZHApOwogCQl2YWwgPSBpbnRlbF9kZV9y
ZWFkKGRldl9wcml2LAotCQkJCSAgICBFRFBfUFNSMl9DVEwoZGV2X3ByaXYtPnBzci50cmFuc2Nv
ZGVyKSk7CisJCQkJICAgIEVEUF9QU1IyX0NUTChpbnRlbF9kcC0+cHNyLnRyYW5zY29kZXIpKTsK
IAkJZHJtX1dBUk5fT04oJmRldl9wcml2LT5kcm0sICEodmFsICYgRURQX1BTUjJfRU5BQkxFKSk7
CiAJCXZhbCAmPSB+RURQX1BTUjJfRU5BQkxFOwogCQlpbnRlbF9kZV93cml0ZShkZXZfcHJpdiwK
LQkJCSAgICAgICBFRFBfUFNSMl9DVEwoZGV2X3ByaXYtPnBzci50cmFuc2NvZGVyKSwgdmFsKTsK
KwkJCSAgICAgICBFRFBfUFNSMl9DVEwoaW50ZWxfZHAtPnBzci50cmFuc2NvZGVyKSwgdmFsKTsK
IAl9IGVsc2UgewogCQl2YWwgPSBpbnRlbF9kZV9yZWFkKGRldl9wcml2LAotCQkJCSAgICBFRFBf
UFNSX0NUTChkZXZfcHJpdi0+cHNyLnRyYW5zY29kZXIpKTsKKwkJCQkgICAgRURQX1BTUl9DVEwo
aW50ZWxfZHAtPnBzci50cmFuc2NvZGVyKSk7CiAJCWRybV9XQVJOX09OKCZkZXZfcHJpdi0+ZHJt
LCAhKHZhbCAmIEVEUF9QU1JfRU5BQkxFKSk7CiAJCXZhbCAmPSB+RURQX1BTUl9FTkFCTEU7CiAJ
CWludGVsX2RlX3dyaXRlKGRldl9wcml2LAotCQkJICAgICAgIEVEUF9QU1JfQ1RMKGRldl9wcml2
LT5wc3IudHJhbnNjb2RlciksIHZhbCk7CisJCQkgICAgICAgRURQX1BTUl9DVEwoaW50ZWxfZHAt
PnBzci50cmFuc2NvZGVyKSwgdmFsKTsKIAl9Ci0JZGV2X3ByaXYtPnBzci5hY3RpdmUgPSBmYWxz
ZTsKKwlpbnRlbF9kcC0+cHNyLmFjdGl2ZSA9IGZhbHNlOwogfQogCiBzdGF0aWMgdm9pZCBpbnRl
bF9wc3JfZGlzYWJsZV9sb2NrZWQoc3RydWN0IGludGVsX2RwICppbnRlbF9kcCkKQEAgLTEwNzcs
MjEgKzEwNzMsMjEgQEAgc3RhdGljIHZvaWQgaW50ZWxfcHNyX2Rpc2FibGVfbG9ja2VkKHN0cnVj
dCBpbnRlbF9kcCAqaW50ZWxfZHApCiAJaTkxNV9yZWdfdCBwc3Jfc3RhdHVzOwogCXUzMiBwc3Jf
c3RhdHVzX21hc2s7CiAKLQlsb2NrZGVwX2Fzc2VydF9oZWxkKCZkZXZfcHJpdi0+cHNyLmxvY2sp
OworCWxvY2tkZXBfYXNzZXJ0X2hlbGQoJmludGVsX2RwLT5wc3IubG9jayk7CiAKLQlpZiAoIWRl
dl9wcml2LT5wc3IuZW5hYmxlZCkKKwlpZiAoIWludGVsX2RwLT5wc3IuZW5hYmxlZCkKIAkJcmV0
dXJuOwogCiAJZHJtX2RiZ19rbXMoJmRldl9wcml2LT5kcm0sICJEaXNhYmxpbmcgUFNSJXNcbiIs
Ci0JCSAgICBkZXZfcHJpdi0+cHNyLnBzcjJfZW5hYmxlZCA/ICIyIiA6ICIxIik7CisJCSAgICBp
bnRlbF9kcC0+cHNyLnBzcjJfZW5hYmxlZCA/ICIyIiA6ICIxIik7CiAKLQlpbnRlbF9wc3JfZXhp
dChkZXZfcHJpdik7CisJaW50ZWxfcHNyX2V4aXQoaW50ZWxfZHApOwogCi0JaWYgKGRldl9wcml2
LT5wc3IucHNyMl9lbmFibGVkKSB7Ci0JCXBzcl9zdGF0dXMgPSBFRFBfUFNSMl9TVEFUVVMoZGV2
X3ByaXYtPnBzci50cmFuc2NvZGVyKTsKKwlpZiAoaW50ZWxfZHAtPnBzci5wc3IyX2VuYWJsZWQp
IHsKKwkJcHNyX3N0YXR1cyA9IEVEUF9QU1IyX1NUQVRVUyhpbnRlbF9kcC0+cHNyLnRyYW5zY29k
ZXIpOwogCQlwc3Jfc3RhdHVzX21hc2sgPSBFRFBfUFNSMl9TVEFUVVNfU1RBVEVfTUFTSzsKIAl9
IGVsc2UgewotCQlwc3Jfc3RhdHVzID0gRURQX1BTUl9TVEFUVVMoZGV2X3ByaXYtPnBzci50cmFu
c2NvZGVyKTsKKwkJcHNyX3N0YXR1cyA9IEVEUF9QU1JfU1RBVFVTKGludGVsX2RwLT5wc3IudHJh
bnNjb2Rlcik7CiAJCXBzcl9zdGF0dXNfbWFzayA9IEVEUF9QU1JfU1RBVFVTX1NUQVRFX01BU0s7
CiAJfQogCkBAIC0xMTAxLDcgKzEwOTcsNyBAQCBzdGF0aWMgdm9pZCBpbnRlbF9wc3JfZGlzYWJs
ZV9sb2NrZWQoc3RydWN0IGludGVsX2RwICppbnRlbF9kcCkKIAkJZHJtX2VycigmZGV2X3ByaXYt
PmRybSwgIlRpbWVkIG91dCB3YWl0aW5nIFBTUiBpZGxlIHN0YXRlXG4iKTsKIAogCS8qIFdBIDE0
MDgzMzA4NDcgKi8KLQlpZiAoZGV2X3ByaXYtPnBzci5wc3IyX3NlbF9mZXRjaF9lbmFibGVkICYm
CisJaWYgKGludGVsX2RwLT5wc3IucHNyMl9zZWxfZmV0Y2hfZW5hYmxlZCAmJgogCSAgICAoSVNf
VEdMX0RJU1BfUkVWSUQoZGV2X3ByaXYsIFRHTF9SRVZJRF9BMCwgVEdMX1JFVklEX0EwKSB8fAog
CSAgICAgSVNfUktMX1JFVklEKGRldl9wcml2LCBSS0xfUkVWSURfQTAsIFJLTF9SRVZJRF9BMCkp
KQogCQlpbnRlbF9kZV9ybXcoZGV2X3ByaXYsIENISUNLRU5fUEFSMV8xLApAQCAtMTExMCwxMCAr
MTEwNiwxMCBAQCBzdGF0aWMgdm9pZCBpbnRlbF9wc3JfZGlzYWJsZV9sb2NrZWQoc3RydWN0IGlu
dGVsX2RwICppbnRlbF9kcCkKIAkvKiBEaXNhYmxlIFBTUiBvbiBTaW5rICovCiAJZHJtX2RwX2Rw
Y2Rfd3JpdGViKCZpbnRlbF9kcC0+YXV4LCBEUF9QU1JfRU5fQ0ZHLCAwKTsKIAotCWlmIChkZXZf
cHJpdi0+cHNyLnBzcjJfZW5hYmxlZCkKKwlpZiAoaW50ZWxfZHAtPnBzci5wc3IyX2VuYWJsZWQp
CiAJCWRybV9kcF9kcGNkX3dyaXRlYigmaW50ZWxfZHAtPmF1eCwgRFBfUkVDRUlWRVJfQUxQTV9D
T05GSUcsIDApOwogCi0JZGV2X3ByaXYtPnBzci5lbmFibGVkID0gZmFsc2U7CisJaW50ZWxfZHAt
PnBzci5lbmFibGVkID0gZmFsc2U7CiB9CiAKIC8qKgpAQCAtMTEzMSwyMCArMTEyNywyMiBAQCB2
b2lkIGludGVsX3Bzcl9kaXNhYmxlKHN0cnVjdCBpbnRlbF9kcCAqaW50ZWxfZHAsCiAJaWYgKCFv
bGRfY3J0Y19zdGF0ZS0+aGFzX3BzcikKIAkJcmV0dXJuOwogCi0JaWYgKGRybV9XQVJOX09OKCZk
ZXZfcHJpdi0+ZHJtLCAhQ0FOX1BTUihkZXZfcHJpdikpKQorCWlmIChkcm1fV0FSTl9PTigmZGV2
X3ByaXYtPmRybSwgIUNBTl9QU1IoaW50ZWxfZHApKSkKIAkJcmV0dXJuOwogCi0JbXV0ZXhfbG9j
aygmZGV2X3ByaXYtPnBzci5sb2NrKTsKKwltdXRleF9sb2NrKCZpbnRlbF9kcC0+cHNyLmxvY2sp
OwogCiAJaW50ZWxfcHNyX2Rpc2FibGVfbG9ja2VkKGludGVsX2RwKTsKIAotCW11dGV4X3VubG9j
aygmZGV2X3ByaXYtPnBzci5sb2NrKTsKLQljYW5jZWxfd29ya19zeW5jKCZkZXZfcHJpdi0+cHNy
LndvcmspOwotCWNhbmNlbF9kZWxheWVkX3dvcmtfc3luYygmZGV2X3ByaXYtPnBzci5kYzNjb193
b3JrKTsKKwltdXRleF91bmxvY2soJmludGVsX2RwLT5wc3IubG9jayk7CisJY2FuY2VsX3dvcmtf
c3luYygmaW50ZWxfZHAtPnBzci53b3JrKTsKKwljYW5jZWxfZGVsYXllZF93b3JrX3N5bmMoJmlu
dGVsX2RwLT5wc3IuZGMzY29fd29yayk7CiB9CiAKLXN0YXRpYyB2b2lkIHBzcl9mb3JjZV9od190
cmFja2luZ19leGl0KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikKK3N0YXRpYyB2
b2lkIHBzcl9mb3JjZV9od190cmFja2luZ19leGl0KHN0cnVjdCBpbnRlbF9kcCAqaW50ZWxfZHAp
CiB7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gZHBfdG9faTkxNShpbnRl
bF9kcCk7CisKIAlpZiAoSVNfVElHRVJMQUtFKGRldl9wcml2KSkKIAkJLyoKIAkJICogV3JpdGVz
IHRvIENVUlNVUkZMSVZFIGluIFRHTCBhcmUgY2F1c2luZyBJT01NVSBlcnJvcnMgYW5kCkBAIC0x
MTU4LDcgKzExNTYsNyBAQCBzdGF0aWMgdm9pZCBwc3JfZm9yY2VfaHdfdHJhY2tpbmdfZXhpdChz
dHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCiAJCSAqIFNvIHVzaW5nIHRoaXMgd29y
a2Fyb3VuZCB1bnRpbCB0aGlzIGlzc3VlIGlzIHJvb3QgY2F1c2VkCiAJCSAqIGFuZCBhIGJldHRl
ciBmaXggaXMgZm91bmQuCiAJCSAqLwotCQlpbnRlbF9wc3JfZXhpdChkZXZfcHJpdik7CisJCWlu
dGVsX3Bzcl9leGl0KGludGVsX2RwKTsKIAllbHNlIGlmIChJTlRFTF9HRU4oZGV2X3ByaXYpID49
IDkpCiAJCS8qCiAJCSAqIERpc3BsYXkgV0EgIzA4ODQ6IHNrbCsKQEAgLTExNjksMTMgKzExNjcs
MTMgQEAgc3RhdGljIHZvaWQgcHNyX2ZvcmNlX2h3X3RyYWNraW5nX2V4aXQoc3RydWN0IGRybV9p
OTE1X3ByaXZhdGUgKmRldl9wcml2KQogCQkgKiBidXQgaXQgbWFrZXMgbW9yZSBzZW5zZSB3cml0
ZSB0byB0aGUgY3VycmVudCBhY3RpdmUKIAkJICogcGlwZS4KIAkJICovCi0JCWludGVsX2RlX3dy
aXRlKGRldl9wcml2LCBDVVJTVVJGTElWRShkZXZfcHJpdi0+cHNyLnBpcGUpLCAwKTsKKwkJaW50
ZWxfZGVfd3JpdGUoZGV2X3ByaXYsIENVUlNVUkZMSVZFKGludGVsX2RwLT5wc3IucGlwZSksIDAp
OwogCWVsc2UKIAkJLyoKIAkJICogQSB3cml0ZSB0byBDVVJTVVJGTElWRSBkbyBub3QgY2F1c2Ug
SFcgdHJhY2tpbmcgdG8gZXhpdCBQU1IKIAkJICogb24gb2xkZXIgZ2VucyBzbyBkb2luZyB0aGUg
bWFudWFsIGV4aXQgaW5zdGVhZC4KIAkJICovCi0JCWludGVsX3Bzcl9leGl0KGRldl9wcml2KTsK
KwkJaW50ZWxfcHNyX2V4aXQoaW50ZWxfZHApOwogfQogCiB2b2lkIGludGVsX3BzcjJfcHJvZ3Jh
bV9wbGFuZV9zZWxfZmV0Y2goc3RydWN0IGludGVsX3BsYW5lICpwbGFuZSwKQEAgLTEyMTUsMTEg
KzEyMTMsMTEgQEAgdm9pZCBpbnRlbF9wc3IyX3Byb2dyYW1fcGxhbmVfc2VsX2ZldGNoKHN0cnVj
dCBpbnRlbF9wbGFuZSAqcGxhbmUsCiAJaW50ZWxfZGVfd3JpdGVfZncoZGV2X3ByaXYsIFBMQU5F
X1NFTF9GRVRDSF9TSVpFKHBpcGUsIHBsYW5lLT5pZCksIHZhbCk7CiB9CiAKLXZvaWQgaW50ZWxf
cHNyMl9wcm9ncmFtX3RyYW5zX21hbl90cmtfY3RsKGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0
YXRlICpjcnRjX3N0YXRlKQordm9pZCBpbnRlbF9wc3IyX3Byb2dyYW1fdHJhbnNfbWFuX3Rya19j
dGwoc3RydWN0IGludGVsX2RwICppbnRlbF9kcCwKKwkJCQkJICBjb25zdCBzdHJ1Y3QgaW50ZWxf
Y3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSkKIHsKLQlzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YyA9IHRv
X2ludGVsX2NydGMoY3J0Y19zdGF0ZS0+dWFwaS5jcnRjKTsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJp
dmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGNydGMtPmJhc2UuZGV2KTsKLQlzdHJ1Y3QgaTkxNV9w
c3IgKnBzciA9ICZkZXZfcHJpdi0+cHNyOworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZf
cHJpdiA9IGRwX3RvX2k5MTUoaW50ZWxfZHApOworCXN0cnVjdCBpbnRlbF9wc3IgKnBzciA9ICZp
bnRlbF9kcC0+cHNyOwogCiAJaWYgKCFIQVNfUFNSMl9TRUxfRkVUQ0goZGV2X3ByaXYpIHx8CiAJ
ICAgICFjcnRjX3N0YXRlLT5lbmFibGVfcHNyMl9zZWxfZmV0Y2gpCkBAIC0xMzM2LDEzICsxMzM0
LDEzIEBAIHZvaWQgaW50ZWxfcHNyX3VwZGF0ZShzdHJ1Y3QgaW50ZWxfZHAgKmludGVsX2RwLAog
CQkgICAgICBjb25zdCBzdHJ1Y3QgZHJtX2Nvbm5lY3Rvcl9zdGF0ZSAqY29ubl9zdGF0ZSkKIHsK
IAlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSBkcF90b19pOTE1KGludGVsX2Rw
KTsKLQlzdHJ1Y3QgaTkxNV9wc3IgKnBzciA9ICZkZXZfcHJpdi0+cHNyOworCXN0cnVjdCBpbnRl
bF9wc3IgKnBzciA9ICZpbnRlbF9kcC0+cHNyOwogCWJvb2wgZW5hYmxlLCBwc3IyX2VuYWJsZTsK
IAotCWlmICghQ0FOX1BTUihkZXZfcHJpdikgfHwgUkVBRF9PTkNFKHBzci0+ZHApICE9IGludGVs
X2RwKQorCWlmICghQ0FOX1BTUihpbnRlbF9kcCkpCiAJCXJldHVybjsKIAotCW11dGV4X2xvY2so
JmRldl9wcml2LT5wc3IubG9jayk7CisJbXV0ZXhfbG9jaygmaW50ZWxfZHAtPnBzci5sb2NrKTsK
IAogCWVuYWJsZSA9IGNydGNfc3RhdGUtPmhhc19wc3I7CiAJcHNyMl9lbmFibGUgPSBjcnRjX3N0
YXRlLT5oYXNfcHNyMjsKQEAgLTEzNTAsMTUgKzEzNDgsMTUgQEAgdm9pZCBpbnRlbF9wc3JfdXBk
YXRlKHN0cnVjdCBpbnRlbF9kcCAqaW50ZWxfZHAsCiAJaWYgKGVuYWJsZSA9PSBwc3ItPmVuYWJs
ZWQgJiYgcHNyMl9lbmFibGUgPT0gcHNyLT5wc3IyX2VuYWJsZWQpIHsKIAkJLyogRm9yY2UgYSBQ
U1IgZXhpdCB3aGVuIGVuYWJsaW5nIENSQyB0byBhdm9pZCBDUkMgdGltZW91dHMgKi8KIAkJaWYg
KGNydGNfc3RhdGUtPmNyY19lbmFibGVkICYmIHBzci0+ZW5hYmxlZCkKLQkJCXBzcl9mb3JjZV9o
d190cmFja2luZ19leGl0KGRldl9wcml2KTsKKwkJCXBzcl9mb3JjZV9od190cmFja2luZ19leGl0
KGludGVsX2RwKTsKIAkJZWxzZSBpZiAoSU5URUxfR0VOKGRldl9wcml2KSA8IDkgJiYgcHNyLT5l
bmFibGVkKSB7CiAJCQkvKgogCQkJICogQWN0aXZhdGUgUFNSIGFnYWluIGFmdGVyIGEgZm9yY2Ug
ZXhpdCB3aGVuIGVuYWJsaW5nCiAJCQkgKiBDUkMgaW4gb2xkZXIgZ2VucwogCQkJICovCi0JCQlp
ZiAoIWRldl9wcml2LT5wc3IuYWN0aXZlICYmCi0JCQkgICAgIWRldl9wcml2LT5wc3IuYnVzeV9m
cm9udGJ1ZmZlcl9iaXRzKQotCQkJCXNjaGVkdWxlX3dvcmsoJmRldl9wcml2LT5wc3Iud29yayk7
CisJCQlpZiAoIWludGVsX2RwLT5wc3IuYWN0aXZlICYmCisJCQkgICAgIWludGVsX2RwLT5wc3Iu
YnVzeV9mcm9udGJ1ZmZlcl9iaXRzKQorCQkJCXNjaGVkdWxlX3dvcmsoJmludGVsX2RwLT5wc3Iu
d29yayk7CiAJCX0KIAogCQlnb3RvIHVubG9jazsKQEAgLTEzNjgsMzQgKzEzNjYsMjMgQEAgdm9p
ZCBpbnRlbF9wc3JfdXBkYXRlKHN0cnVjdCBpbnRlbF9kcCAqaW50ZWxfZHAsCiAJCWludGVsX3Bz
cl9kaXNhYmxlX2xvY2tlZChpbnRlbF9kcCk7CiAKIAlpZiAoZW5hYmxlKQotCQlpbnRlbF9wc3Jf
ZW5hYmxlX2xvY2tlZChkZXZfcHJpdiwgY3J0Y19zdGF0ZSwgY29ubl9zdGF0ZSk7CisJCWludGVs
X3Bzcl9lbmFibGVfbG9ja2VkKGludGVsX2RwLCBjcnRjX3N0YXRlLCBjb25uX3N0YXRlKTsKIAog
dW5sb2NrOgotCW11dGV4X3VubG9jaygmZGV2X3ByaXYtPnBzci5sb2NrKTsKKwltdXRleF91bmxv
Y2soJmludGVsX2RwLT5wc3IubG9jayk7CiB9CiAKIC8qKgotICogaW50ZWxfcHNyX3dhaXRfZm9y
X2lkbGUgLSB3YWl0IGZvciBQU1IxIHRvIGlkbGUKLSAqIEBuZXdfY3J0Y19zdGF0ZTogbmV3IENS
VEMgc3RhdGUKKyAqIHBzcl93YWl0X2Zvcl9pZGxlIC0gd2FpdCBmb3IgUFNSMSB0byBpZGxlCisg
KiBAaW50ZWxfZHA6IEludGVsIERQCiAgKiBAb3V0X3ZhbHVlOiBQU1Igc3RhdHVzIGluIGNhc2Ug
b2YgZmFpbHVyZQogICoKLSAqIFRoaXMgZnVuY3Rpb24gaXMgZXhwZWN0ZWQgdG8gYmUgY2FsbGVk
IGZyb20gcGlwZV91cGRhdGVfc3RhcnQoKSB3aGVyZSBpdCBpcwotICogbm90IGV4cGVjdGVkIHRv
IHJhY2Ugd2l0aCBQU1IgZW5hYmxlIG9yIGRpc2FibGUuCi0gKgogICogUmV0dXJuczogMCBvbiBz
dWNjZXNzIG9yIC1FVElNRU9VVCBpZiBQU1Igc3RhdHVzIGRvZXMgbm90IGlkbGUuCisgKgogICov
Ci1pbnQgaW50ZWxfcHNyX3dhaXRfZm9yX2lkbGUoY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3Rh
dGUgKm5ld19jcnRjX3N0YXRlLAotCQkJICAgIHUzMiAqb3V0X3ZhbHVlKQorc3RhdGljIGludCBw
c3Jfd2FpdF9mb3JfaWRsZShzdHJ1Y3QgaW50ZWxfZHAgKmludGVsX2RwLCB1MzIgKm91dF92YWx1
ZSkKIHsKLQlzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YyA9IHRvX2ludGVsX2NydGMobmV3X2NydGNf
c3RhdGUtPnVhcGkuY3J0Yyk7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0g
dG9faTkxNShjcnRjLT5iYXNlLmRldik7Ci0KLQlpZiAoIWRldl9wcml2LT5wc3IuZW5hYmxlZCB8
fCAhbmV3X2NydGNfc3RhdGUtPmhhc19wc3IpCi0JCXJldHVybiAwOwotCi0JLyogRklYTUU6IFVw
ZGF0ZSB0aGlzIGZvciBQU1IyIGlmIHdlIG5lZWQgdG8gd2FpdCBmb3IgaWRsZSAqLwotCWlmIChS
RUFEX09OQ0UoZGV2X3ByaXYtPnBzci5wc3IyX2VuYWJsZWQpKQotCQlyZXR1cm4gMDsKKwlzdHJ1
Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSBkcF90b19pOTE1KGludGVsX2RwKTsKIAog
CS8qCiAJICogRnJvbSBic3BlYzogUGFuZWwgU2VsZiBSZWZyZXNoIChCRFcrKQpAQCAtMTQwMywz
MiArMTM5MCw2NyBAQCBpbnQgaW50ZWxfcHNyX3dhaXRfZm9yX2lkbGUoY29uc3Qgc3RydWN0IGlu
dGVsX2NydGNfc3RhdGUgKm5ld19jcnRjX3N0YXRlLAogCSAqIGV4aXQgdHJhaW5pbmcgdGltZSAr
IDEuNSBtcyBvZiBhdXggY2hhbm5lbCBoYW5kc2hha2UuIDUwIG1zIGlzCiAJICogZGVmZW5zaXZl
IGVub3VnaCB0byBjb3ZlciBldmVyeXRoaW5nLgogCSAqLwotCiAJcmV0dXJuIF9faW50ZWxfd2Fp
dF9mb3JfcmVnaXN0ZXIoJmRldl9wcml2LT51bmNvcmUsCi0JCQkJCSBFRFBfUFNSX1NUQVRVUyhk
ZXZfcHJpdi0+cHNyLnRyYW5zY29kZXIpLAorCQkJCQkgRURQX1BTUl9TVEFUVVMoaW50ZWxfZHAt
PnBzci50cmFuc2NvZGVyKSwKIAkJCQkJIEVEUF9QU1JfU1RBVFVTX1NUQVRFX01BU0ssCiAJCQkJ
CSBFRFBfUFNSX1NUQVRVU19TVEFURV9JRExFLCAyLCA1MCwKIAkJCQkJIG91dF92YWx1ZSk7CiB9
CiAKLXN0YXRpYyBib29sIF9fcHNyX3dhaXRfZm9yX2lkbGVfbG9ja2VkKHN0cnVjdCBkcm1faTkx
NV9wcml2YXRlICpkZXZfcHJpdikKKy8qKgorICogaW50ZWxfcHNyX3dhaXRfZm9yX2lkbGUgLSB3
YWl0IGZvciBQU1IxIHRvIGlkbGUKKyAqIEBuZXdfY3J0Y19zdGF0ZTogbmV3IENSVEMgc3RhdGUK
KyAqCisgKiBUaGlzIGZ1bmN0aW9uIGlzIGV4cGVjdGVkIHRvIGJlIGNhbGxlZCBmcm9tIHBpcGVf
dXBkYXRlX3N0YXJ0KCkgd2hlcmUgaXQgaXMKKyAqIG5vdCBleHBlY3RlZCB0byByYWNlIHdpdGgg
UFNSIGVuYWJsZSBvciBkaXNhYmxlLgorICovCit2b2lkIGludGVsX3Bzcl93YWl0X2Zvcl9pZGxl
KGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpuZXdfY3J0Y19zdGF0ZSkKK3sKKwlzdHJ1
Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KG5ld19jcnRjX3N0YXRlLT51
YXBpLmNydGMtPmRldik7CisJc3RydWN0IGludGVsX2VuY29kZXIgKmVuY29kZXI7CisJdTMyIHBz
cl9zdGF0dXM7CisKKwlpZiAoIW5ld19jcnRjX3N0YXRlLT5oYXNfcHNyKQorCQlyZXR1cm47CisK
Kwlmb3JfZWFjaF9pbnRlbF9kcCgmZGV2X3ByaXYtPmRybSwgZW5jb2RlcikgeworCQlzdHJ1Y3Qg
aW50ZWxfZHAgKmludGVsX2RwID0gZW5jX3RvX2ludGVsX2RwKGVuY29kZXIpOworCisJCWlmIChl
bmNvZGVyLT50eXBlICE9IElOVEVMX09VVFBVVF9FRFApCisJCQljb250aW51ZTsKKworCQkvKiB3
aGVuIHRoZSBQU1IxIGlzIGVuYWJsZWQgKi8KKwkJaWYgKGludGVsX2RwLT5wc3IuZW5hYmxlZCAm
JiAhaW50ZWxfZHAtPnBzci5wc3IyX2VuYWJsZWQpIHsKKwkJCWlmIChwc3Jfd2FpdF9mb3JfaWRs
ZShpbnRlbF9kcCwgJnBzcl9zdGF0dXMpKQorCQkJCWRybV9lcnIoJmRldl9wcml2LT5kcm0sCisJ
CQkJCSJQU1IgaWRsZSB0aW1lZCBvdXQgMHgleCwgYXRvbWljIHVwZGF0ZSBtYXkgZmFpbFxuIiwK
KwkJCQkJcHNyX3N0YXR1cyk7CisKKwkJCS8qIG9ubHkgb25lIHRyYW5jb2RlciBjYW4gZW5hYmxl
IFBTUjEgKi8KKwkJCWJyZWFrOworCQl9CisJfQorfQorCitzdGF0aWMgYm9vbCBfX3Bzcl93YWl0
X2Zvcl9pZGxlX2xvY2tlZChzdHJ1Y3QgaW50ZWxfZHAgKmludGVsX2RwKQogewogCWk5MTVfcmVn
X3QgcmVnOwogCXUzMiBtYXNrOwogCWludCBlcnI7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUg
KmRldl9wcml2ID0gZHBfdG9faTkxNShpbnRlbF9kcCk7CiAKLQlpZiAoIWRldl9wcml2LT5wc3Iu
ZW5hYmxlZCkKKwlpZiAoIWludGVsX2RwLT5wc3IuZW5hYmxlZCkKIAkJcmV0dXJuIGZhbHNlOwog
Ci0JaWYgKGRldl9wcml2LT5wc3IucHNyMl9lbmFibGVkKSB7Ci0JCXJlZyA9IEVEUF9QU1IyX1NU
QVRVUyhkZXZfcHJpdi0+cHNyLnRyYW5zY29kZXIpOworCWlmIChpbnRlbF9kcC0+cHNyLnBzcjJf
ZW5hYmxlZCkgeworCQlyZWcgPSBFRFBfUFNSMl9TVEFUVVMoaW50ZWxfZHAtPnBzci50cmFuc2Nv
ZGVyKTsKIAkJbWFzayA9IEVEUF9QU1IyX1NUQVRVU19TVEFURV9NQVNLOwogCX0gZWxzZSB7Ci0J
CXJlZyA9IEVEUF9QU1JfU1RBVFVTKGRldl9wcml2LT5wc3IudHJhbnNjb2Rlcik7CisJCXJlZyA9
IEVEUF9QU1JfU1RBVFVTKGludGVsX2RwLT5wc3IudHJhbnNjb2Rlcik7CiAJCW1hc2sgPSBFRFBf
UFNSX1NUQVRVU19TVEFURV9NQVNLOwogCX0KIAotCW11dGV4X3VubG9jaygmZGV2X3ByaXYtPnBz
ci5sb2NrKTsKKwltdXRleF91bmxvY2soJmludGVsX2RwLT5wc3IubG9jayk7CiAKIAllcnIgPSBp
bnRlbF9kZV93YWl0X2Zvcl9jbGVhcihkZXZfcHJpdiwgcmVnLCBtYXNrLCA1MCk7CiAJaWYgKGVy
cikKQEAgLTE0MzYsOCArMTQ1OCw4IEBAIHN0YXRpYyBib29sIF9fcHNyX3dhaXRfZm9yX2lkbGVf
bG9ja2VkKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikKIAkJCSJUaW1lZCBvdXQg
d2FpdGluZyBmb3IgUFNSIElkbGUgZm9yIHJlLWVuYWJsZVxuIik7CiAKIAkvKiBBZnRlciB0aGUg
dW5sb2NrZWQgd2FpdCwgdmVyaWZ5IHRoYXQgUFNSIGlzIHN0aWxsIHdhbnRlZCEgKi8KLQltdXRl
eF9sb2NrKCZkZXZfcHJpdi0+cHNyLmxvY2spOwotCXJldHVybiBlcnIgPT0gMCAmJiBkZXZfcHJp
di0+cHNyLmVuYWJsZWQ7CisJbXV0ZXhfbG9jaygmaW50ZWxfZHAtPnBzci5sb2NrKTsKKwlyZXR1
cm4gZXJyID09IDAgJiYgaW50ZWxfZHAtPnBzci5lbmFibGVkOwogfQogCiBzdGF0aWMgaW50IGlu
dGVsX3Bzcl9mYXN0c2V0X2ZvcmNlKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikK
QEAgLTE1MDMsMTEgKzE1MjUsMTIgQEAgc3RhdGljIGludCBpbnRlbF9wc3JfZmFzdHNldF9mb3Jj
ZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCiAJcmV0dXJuIGVycjsKIH0KIAot
aW50IGludGVsX3Bzcl9kZWJ1Z19zZXQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2
LCB1NjQgdmFsKQoraW50IGludGVsX3Bzcl9kZWJ1Z19zZXQoc3RydWN0IGludGVsX2RwICppbnRl
bF9kcCwgdTY0IHZhbCkKIHsKIAljb25zdCB1MzIgbW9kZSA9IHZhbCAmIEk5MTVfUFNSX0RFQlVH
X01PREVfTUFTSzsKIAl1MzIgb2xkX21vZGU7CiAJaW50IHJldDsKKwlzdHJ1Y3QgZHJtX2k5MTVf
cHJpdmF0ZSAqZGV2X3ByaXYgPSBkcF90b19pOTE1KGludGVsX2RwKTsKIAogCWlmICh2YWwgJiB+
KEk5MTVfUFNSX0RFQlVHX0lSUSB8IEk5MTVfUFNSX0RFQlVHX01PREVfTUFTSykgfHwKIAkgICAg
bW9kZSA+IEk5MTVfUFNSX0RFQlVHX0ZPUkNFX1BTUjEpIHsKQEAgLTE1MTUsMjEgKzE1MzgsMjEg
QEAgaW50IGludGVsX3Bzcl9kZWJ1Z19zZXQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9w
cml2LCB1NjQgdmFsKQogCQlyZXR1cm4gLUVJTlZBTDsKIAl9CiAKLQlyZXQgPSBtdXRleF9sb2Nr
X2ludGVycnVwdGlibGUoJmRldl9wcml2LT5wc3IubG9jayk7CisJcmV0ID0gbXV0ZXhfbG9ja19p
bnRlcnJ1cHRpYmxlKCZpbnRlbF9kcC0+cHNyLmxvY2spOwogCWlmIChyZXQpCiAJCXJldHVybiBy
ZXQ7CiAKLQlvbGRfbW9kZSA9IGRldl9wcml2LT5wc3IuZGVidWcgJiBJOTE1X1BTUl9ERUJVR19N
T0RFX01BU0s7Ci0JZGV2X3ByaXYtPnBzci5kZWJ1ZyA9IHZhbDsKKwlvbGRfbW9kZSA9IGludGVs
X2RwLT5wc3IuZGVidWcgJiBJOTE1X1BTUl9ERUJVR19NT0RFX01BU0s7CisJaW50ZWxfZHAtPnBz
ci5kZWJ1ZyA9IHZhbDsKIAogCS8qCiAJICogRG8gaXQgcmlnaHQgYXdheSBpZiBpdCdzIGFscmVh
ZHkgZW5hYmxlZCwgb3RoZXJ3aXNlIGl0IHdpbGwgYmUgZG9uZQogCSAqIHdoZW4gZW5hYmxpbmcg
dGhlIHNvdXJjZS4KIAkgKi8KLQlpZiAoZGV2X3ByaXYtPnBzci5lbmFibGVkKQotCQlwc3JfaXJx
X2NvbnRyb2woZGV2X3ByaXYpOworCWlmIChpbnRlbF9kcC0+cHNyLmVuYWJsZWQpCisJCXBzcl9p
cnFfY29udHJvbChpbnRlbF9kcCk7CiAKLQltdXRleF91bmxvY2soJmRldl9wcml2LT5wc3IubG9j
ayk7CisJbXV0ZXhfdW5sb2NrKCZpbnRlbF9kcC0+cHNyLmxvY2spOwogCiAJaWYgKG9sZF9tb2Rl
ICE9IG1vZGUpCiAJCXJldCA9IGludGVsX3Bzcl9mYXN0c2V0X2ZvcmNlKGRldl9wcml2KTsKQEAg
LTE1MzcsMjggKzE1NjAsMjggQEAgaW50IGludGVsX3Bzcl9kZWJ1Z19zZXQoc3RydWN0IGRybV9p
OTE1X3ByaXZhdGUgKmRldl9wcml2LCB1NjQgdmFsKQogCXJldHVybiByZXQ7CiB9CiAKLXN0YXRp
YyB2b2lkIGludGVsX3Bzcl9oYW5kbGVfaXJxKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZf
cHJpdikKK3N0YXRpYyB2b2lkIGludGVsX3Bzcl9oYW5kbGVfaXJxKHN0cnVjdCBpbnRlbF9kcCAq
aW50ZWxfZHApCiB7Ci0Jc3RydWN0IGk5MTVfcHNyICpwc3IgPSAmZGV2X3ByaXYtPnBzcjsKKwlz
dHJ1Y3QgaW50ZWxfcHNyICpwc3IgPSAmaW50ZWxfZHAtPnBzcjsKIAotCWludGVsX3Bzcl9kaXNh
YmxlX2xvY2tlZChwc3ItPmRwKTsKKwlpbnRlbF9wc3JfZGlzYWJsZV9sb2NrZWQoaW50ZWxfZHAp
OwogCXBzci0+c2lua19ub3RfcmVsaWFibGUgPSB0cnVlOwogCS8qIGxldCdzIG1ha2Ugc3VyZSB0
aGF0IHNpbmsgaXMgYXdha2VuICovCi0JZHJtX2RwX2RwY2Rfd3JpdGViKCZwc3ItPmRwLT5hdXgs
IERQX1NFVF9QT1dFUiwgRFBfU0VUX1BPV0VSX0QwKTsKKwlkcm1fZHBfZHBjZF93cml0ZWIoJmlu
dGVsX2RwLT5hdXgsIERQX1NFVF9QT1dFUiwgRFBfU0VUX1BPV0VSX0QwKTsKIH0KIAogc3RhdGlj
IHZvaWQgaW50ZWxfcHNyX3dvcmsoc3RydWN0IHdvcmtfc3RydWN0ICp3b3JrKQogewotCXN0cnVj
dCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9Ci0JCWNvbnRhaW5lcl9vZih3b3JrLCB0eXBl
b2YoKmRldl9wcml2KSwgcHNyLndvcmspOworCXN0cnVjdCBpbnRlbF9kcCAqaW50ZWxfZHAgPQor
CQljb250YWluZXJfb2Yod29yaywgdHlwZW9mKCppbnRlbF9kcCksIHBzci53b3JrKTsKIAotCW11
dGV4X2xvY2soJmRldl9wcml2LT5wc3IubG9jayk7CisJbXV0ZXhfbG9jaygmaW50ZWxfZHAtPnBz
ci5sb2NrKTsKIAotCWlmICghZGV2X3ByaXYtPnBzci5lbmFibGVkKQorCWlmICghaW50ZWxfZHAt
PnBzci5lbmFibGVkKQogCQlnb3RvIHVubG9jazsKIAotCWlmIChSRUFEX09OQ0UoZGV2X3ByaXYt
PnBzci5pcnFfYXV4X2Vycm9yKSkKLQkJaW50ZWxfcHNyX2hhbmRsZV9pcnEoZGV2X3ByaXYpOwor
CWlmIChSRUFEX09OQ0UoaW50ZWxfZHAtPnBzci5pcnFfYXV4X2Vycm9yKSkKKwkJaW50ZWxfcHNy
X2hhbmRsZV9pcnEoaW50ZWxfZHApOwogCiAJLyoKIAkgKiBXZSBoYXZlIHRvIG1ha2Ugc3VyZSBQ
U1IgaXMgcmVhZHkgZm9yIHJlLWVuYWJsZQpAQCAtMTU2Niw3ICsxNTg5LDcgQEAgc3RhdGljIHZv
aWQgaW50ZWxfcHNyX3dvcmsoc3RydWN0IHdvcmtfc3RydWN0ICp3b3JrKQogCSAqIFBTUiBtaWdo
dCB0YWtlIHNvbWUgdGltZSB0byBnZXQgZnVsbHkgZGlzYWJsZWQKIAkgKiBhbmQgYmUgcmVhZHkg
Zm9yIHJlLWVuYWJsZS4KIAkgKi8KLQlpZiAoIV9fcHNyX3dhaXRfZm9yX2lkbGVfbG9ja2VkKGRl
dl9wcml2KSkKKwlpZiAoIV9fcHNyX3dhaXRfZm9yX2lkbGVfbG9ja2VkKGludGVsX2RwKSkKIAkJ
Z290byB1bmxvY2s7CiAKIAkvKgpAQCAtMTU3NCwxMiArMTU5NywxMiBAQCBzdGF0aWMgdm9pZCBp
bnRlbF9wc3Jfd29yayhzdHJ1Y3Qgd29ya19zdHJ1Y3QgKndvcmspCiAJICogcmVjaGVjay4gU2lu
Y2UgcHNyX2ZsdXNoIGZpcnN0IGNsZWFycyB0aGlzIGFuZCB0aGVuIHJlc2NoZWR1bGVzIHdlCiAJ
ICogd29uJ3QgZXZlciBtaXNzIGEgZmx1c2ggd2hlbiBiYWlsaW5nIG91dCBoZXJlLgogCSAqLwot
CWlmIChkZXZfcHJpdi0+cHNyLmJ1c3lfZnJvbnRidWZmZXJfYml0cyB8fCBkZXZfcHJpdi0+cHNy
LmFjdGl2ZSkKKwlpZiAoaW50ZWxfZHAtPnBzci5idXN5X2Zyb250YnVmZmVyX2JpdHMgfHwgaW50
ZWxfZHAtPnBzci5hY3RpdmUpCiAJCWdvdG8gdW5sb2NrOwogCi0JaW50ZWxfcHNyX2FjdGl2YXRl
KGRldl9wcml2LT5wc3IuZHApOworCWludGVsX3Bzcl9hY3RpdmF0ZShpbnRlbF9kcCk7CiB1bmxv
Y2s6Ci0JbXV0ZXhfdW5sb2NrKCZkZXZfcHJpdi0+cHNyLmxvY2spOworCW11dGV4X3VubG9jaygm
aW50ZWxfZHAtPnBzci5sb2NrKTsKIH0KIAogLyoqCkBAIC0xNTk4LDI3ICsxNjIxLDM1IEBAIHN0
YXRpYyB2b2lkIGludGVsX3Bzcl93b3JrKHN0cnVjdCB3b3JrX3N0cnVjdCAqd29yaykKIHZvaWQg
aW50ZWxfcHNyX2ludmFsaWRhdGUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAog
CQkJICB1bnNpZ25lZCBmcm9udGJ1ZmZlcl9iaXRzLCBlbnVtIGZiX29wX29yaWdpbiBvcmlnaW4p
CiB7Ci0JaWYgKCFDQU5fUFNSKGRldl9wcml2KSkKLQkJcmV0dXJuOworCXN0cnVjdCBpbnRlbF9l
bmNvZGVyICplbmNvZGVyOworCXN0cnVjdCBpbnRlbF9kcCAqaW50ZWxfZHA7CiAKLQlpZiAob3Jp
Z2luID09IE9SSUdJTl9GTElQKQotCQlyZXR1cm47CisJZm9yX2VhY2hfaW50ZWxfZHAoJmRldl9w
cml2LT5kcm0sIGVuY29kZXIpIHsKIAotCW11dGV4X2xvY2soJmRldl9wcml2LT5wc3IubG9jayk7
Ci0JaWYgKCFkZXZfcHJpdi0+cHNyLmVuYWJsZWQpIHsKLQkJbXV0ZXhfdW5sb2NrKCZkZXZfcHJp
di0+cHNyLmxvY2spOwotCQlyZXR1cm47Ci0JfQorCQlpbnRlbF9kcCA9IGVuY190b19pbnRlbF9k
cChlbmNvZGVyKTsKKwkJaWYgKGVuY29kZXItPnR5cGUgIT0gSU5URUxfT1VUUFVUX0VEUCkKKwkJ
CWNvbnRpbnVlOworCQlpZiAoIUNBTl9QU1IoaW50ZWxfZHApKQorCQkJY29udGludWU7CisKKwkJ
aWYgKG9yaWdpbiA9PSBPUklHSU5fRkxJUCkKKwkJCWNvbnRpbnVlOwogCi0JZnJvbnRidWZmZXJf
Yml0cyAmPSBJTlRFTF9GUk9OVEJVRkZFUl9BTExfTUFTSyhkZXZfcHJpdi0+cHNyLnBpcGUpOwot
CWRldl9wcml2LT5wc3IuYnVzeV9mcm9udGJ1ZmZlcl9iaXRzIHw9IGZyb250YnVmZmVyX2JpdHM7
CisJCW11dGV4X2xvY2soJmludGVsX2RwLT5wc3IubG9jayk7CisJCWlmICghaW50ZWxfZHAtPnBz
ci5lbmFibGVkKSB7CisJCQltdXRleF91bmxvY2soJmludGVsX2RwLT5wc3IubG9jayk7CisJCQlj
b250aW51ZTsKKwkJfQogCi0JaWYgKGZyb250YnVmZmVyX2JpdHMpCi0JCWludGVsX3Bzcl9leGl0
KGRldl9wcml2KTsKKwkJZnJvbnRidWZmZXJfYml0cyAmPSBJTlRFTF9GUk9OVEJVRkZFUl9BTExf
TUFTSyhpbnRlbF9kcC0+cHNyLnBpcGUpOworCQlpbnRlbF9kcC0+cHNyLmJ1c3lfZnJvbnRidWZm
ZXJfYml0cyB8PSBmcm9udGJ1ZmZlcl9iaXRzOwogCi0JbXV0ZXhfdW5sb2NrKCZkZXZfcHJpdi0+
cHNyLmxvY2spOwotfQorCQlpZiAoZnJvbnRidWZmZXJfYml0cykKKwkJCWludGVsX3Bzcl9leGl0
KGludGVsX2RwKTsKIAorCQltdXRleF91bmxvY2soJmludGVsX2RwLT5wc3IubG9jayk7CisJfQor
fQogLyoKICAqIFdoZW4gd2Ugd2lsbCBiZSBjb21wbGV0ZWx5IHJlbHkgb24gUFNSMiBTL1cgdHJh
Y2tpbmcgaW4gZnV0dXJlLAogICogaW50ZWxfcHNyX2ZsdXNoKCkgd2lsbCBpbnZhbGlkYXRlIGFu
ZCBmbHVzaCB0aGUgUFNSIGZvciBPUklHSU5fRkxJUApAQCAtMTYyNiwxNSArMTY1NywxNSBAQCB2
b2lkIGludGVsX3Bzcl9pbnZhbGlkYXRlKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJp
diwKICAqIGFjY29yZGluZ2x5IGluIGZ1dHVyZS4KICAqLwogc3RhdGljIHZvaWQKLXRnbF9kYzNj
b19mbHVzaChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCi0JCXVuc2lnbmVkIGlu
dCBmcm9udGJ1ZmZlcl9iaXRzLCBlbnVtIGZiX29wX29yaWdpbiBvcmlnaW4pCit0Z2xfZGMzY29f
Zmx1c2goc3RydWN0IGludGVsX2RwICppbnRlbF9kcCwgdW5zaWduZWQgaW50IGZyb250YnVmZmVy
X2JpdHMsCisJCWVudW0gZmJfb3Bfb3JpZ2luIG9yaWdpbikKIHsKLQltdXRleF9sb2NrKCZkZXZf
cHJpdi0+cHNyLmxvY2spOworCW11dGV4X2xvY2soJmludGVsX2RwLT5wc3IubG9jayk7CiAKLQlp
ZiAoIWRldl9wcml2LT5wc3IuZGMzY29fZW5hYmxlZCkKKwlpZiAoIWludGVsX2RwLT5wc3IuZGMz
Y29fZW5hYmxlZCkKIAkJZ290byB1bmxvY2s7CiAKLQlpZiAoIWRldl9wcml2LT5wc3IucHNyMl9l
bmFibGVkIHx8ICFkZXZfcHJpdi0+cHNyLmFjdGl2ZSkKKwlpZiAoIWludGVsX2RwLT5wc3IucHNy
Ml9lbmFibGVkIHx8ICFpbnRlbF9kcC0+cHNyLmFjdGl2ZSkKIAkJZ290byB1bmxvY2s7CiAKIAkv
KgpAQCAtMTY0MiwxNSArMTY3MywxNSBAQCB0Z2xfZGMzY29fZmx1c2goc3RydWN0IGRybV9pOTE1
X3ByaXZhdGUgKmRldl9wcml2LAogCSAqIHdoZW4gZGVsYXllZCB3b3JrIHNjaGVkdWxlcyB0aGF0
IG1lYW5zIGRpc3BsYXkgaGFzIGJlZW4gaWRsZS4KIAkgKi8KIAlpZiAoIShmcm9udGJ1ZmZlcl9i
aXRzICYKLQkgICAgSU5URUxfRlJPTlRCVUZGRVJfQUxMX01BU0soZGV2X3ByaXYtPnBzci5waXBl
KSkpCisJICAgIElOVEVMX0ZST05UQlVGRkVSX0FMTF9NQVNLKGludGVsX2RwLT5wc3IucGlwZSkp
KQogCQlnb3RvIHVubG9jazsKIAotCXRnbF9wc3IyX2VuYWJsZV9kYzNjbyhkZXZfcHJpdik7Ci0J
bW9kX2RlbGF5ZWRfd29yayhzeXN0ZW1fd3EsICZkZXZfcHJpdi0+cHNyLmRjM2NvX3dvcmssCi0J
CQkgZGV2X3ByaXYtPnBzci5kYzNjb19leGl0X2RlbGF5KTsKKwl0Z2xfcHNyMl9lbmFibGVfZGMz
Y28oaW50ZWxfZHApOworCW1vZF9kZWxheWVkX3dvcmsoc3lzdGVtX3dxLCAmaW50ZWxfZHAtPnBz
ci5kYzNjb193b3JrLAorCQkJIGludGVsX2RwLT5wc3IuZGMzY29fZXhpdF9kZWxheSk7CiAKIHVu
bG9jazoKLQltdXRleF91bmxvY2soJmRldl9wcml2LT5wc3IubG9jayk7CisJbXV0ZXhfdW5sb2Nr
KCZpbnRlbF9kcC0+cHNyLmxvY2spOwogfQogCiAvKioKQEAgLTE2NjksNDUgKzE3MDAsNTQgQEAg
dGdsX2RjM2NvX2ZsdXNoKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKIHZvaWQg
aW50ZWxfcHNyX2ZsdXNoKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKIAkJICAg
ICB1bnNpZ25lZCBmcm9udGJ1ZmZlcl9iaXRzLCBlbnVtIGZiX29wX29yaWdpbiBvcmlnaW4pCiB7
Ci0JaWYgKCFDQU5fUFNSKGRldl9wcml2KSkKLQkJcmV0dXJuOwotCi0JaWYgKG9yaWdpbiA9PSBP
UklHSU5fRkxJUCkgewotCQl0Z2xfZGMzY29fZmx1c2goZGV2X3ByaXYsIGZyb250YnVmZmVyX2Jp
dHMsIG9yaWdpbik7Ci0JCXJldHVybjsKLQl9Ci0KLQltdXRleF9sb2NrKCZkZXZfcHJpdi0+cHNy
LmxvY2spOwotCWlmICghZGV2X3ByaXYtPnBzci5lbmFibGVkKSB7Ci0JCW11dGV4X3VubG9jaygm
ZGV2X3ByaXYtPnBzci5sb2NrKTsKLQkJcmV0dXJuOworCXN0cnVjdCBpbnRlbF9lbmNvZGVyICpl
bmNvZGVyOworCXN0cnVjdCBpbnRlbF9kcCAqaW50ZWxfZHA7CisKKwlmb3JfZWFjaF9pbnRlbF9k
cCgmZGV2X3ByaXYtPmRybSwgZW5jb2RlcikgeworCQlpbnRlbF9kcCA9IGVuY190b19pbnRlbF9k
cChlbmNvZGVyKTsKKworCQlpZiAoZW5jb2Rlci0+dHlwZSA9PSBJTlRFTF9PVVRQVVRfRURQICYm
IENBTl9QU1IoaW50ZWxfZHApKSB7CisJCQlpZiAob3JpZ2luID09IE9SSUdJTl9GTElQKSB7CisJ
CQkJdGdsX2RjM2NvX2ZsdXNoKGludGVsX2RwLCBmcm9udGJ1ZmZlcl9iaXRzLCBvcmlnaW4pOwor
CQkJCWNvbnRpbnVlOworCQkJfQorCisJCQltdXRleF9sb2NrKCZpbnRlbF9kcC0+cHNyLmxvY2sp
OworCQkJaWYgKCFpbnRlbF9kcC0+cHNyLmVuYWJsZWQpIHsKKwkJCQltdXRleF91bmxvY2soJmlu
dGVsX2RwLT5wc3IubG9jayk7CisJCQkJY29udGludWU7CisJCQl9CisKKwkJCWZyb250YnVmZmVy
X2JpdHMgJj0gSU5URUxfRlJPTlRCVUZGRVJfQUxMX01BU0soaW50ZWxfZHAtPnBzci5waXBlKTsK
KwkJCWludGVsX2RwLT5wc3IuYnVzeV9mcm9udGJ1ZmZlcl9iaXRzICY9IH5mcm9udGJ1ZmZlcl9i
aXRzOworCisJCQkvKiBCeSBkZWZpbml0aW9uIGZsdXNoID0gaW52YWxpZGF0ZSArIGZsdXNoICov
CisJCQlpZiAoZnJvbnRidWZmZXJfYml0cykKKwkJCQlwc3JfZm9yY2VfaHdfdHJhY2tpbmdfZXhp
dChpbnRlbF9kcCk7CisKKwkJCWlmICghaW50ZWxfZHAtPnBzci5hY3RpdmUgJiYgIWludGVsX2Rw
LT5wc3IuYnVzeV9mcm9udGJ1ZmZlcl9iaXRzKQorCQkJCXNjaGVkdWxlX3dvcmsoJmludGVsX2Rw
LT5wc3Iud29yayk7CisJCQltdXRleF91bmxvY2soJmludGVsX2RwLT5wc3IubG9jayk7CisJCX0K
IAl9Ci0KLQlmcm9udGJ1ZmZlcl9iaXRzICY9IElOVEVMX0ZST05UQlVGRkVSX0FMTF9NQVNLKGRl
dl9wcml2LT5wc3IucGlwZSk7Ci0JZGV2X3ByaXYtPnBzci5idXN5X2Zyb250YnVmZmVyX2JpdHMg
Jj0gfmZyb250YnVmZmVyX2JpdHM7Ci0KLQkvKiBCeSBkZWZpbml0aW9uIGZsdXNoID0gaW52YWxp
ZGF0ZSArIGZsdXNoICovCi0JaWYgKGZyb250YnVmZmVyX2JpdHMpCi0JCXBzcl9mb3JjZV9od190
cmFja2luZ19leGl0KGRldl9wcml2KTsKLQotCWlmICghZGV2X3ByaXYtPnBzci5hY3RpdmUgJiYg
IWRldl9wcml2LT5wc3IuYnVzeV9mcm9udGJ1ZmZlcl9iaXRzKQotCQlzY2hlZHVsZV93b3JrKCZk
ZXZfcHJpdi0+cHNyLndvcmspOwotCW11dGV4X3VubG9jaygmZGV2X3ByaXYtPnBzci5sb2NrKTsK
IH0KIAogLyoqCiAgKiBpbnRlbF9wc3JfaW5pdCAtIEluaXQgYmFzaWMgUFNSIHdvcmsgYW5kIG11
dGV4LgotICogQGRldl9wcml2OiBpOTE1IGRldmljZSBwcml2YXRlCisgKiBAaW50ZWxfZHA6IElu
dGVsIERQCiAgKgotICogVGhpcyBmdW5jdGlvbiBpcyAgY2FsbGVkIG9ubHkgb25jZSBhdCBkcml2
ZXIgbG9hZCB0byBpbml0aWFsaXplIGJhc2ljCi0gKiBQU1Igc3R1ZmYuCisgKiBUaGlzIGZ1bmN0
aW9uIGlzIGNhbGxlZCBhZnRlciB0aGUgaW5pdGlhbGl6aW5nIGNvbm5lY3Rvci4KKyAqICh0aGUg
aW5pdGlhbGl6aW5nIG9mIGNvbm5lY3RvciB0cmVhdHMgdGhlIGhhbmRsaW5nIG9mIGNvbm5lY3Rv
ciBjYXBhYmlsaXRpZXMpCisgKiBBbmQgaXQgaW5pdGlhbGl6ZXMgYmFzaWMgUFNSIHN0dWZmIGZv
ciBlYWNoIERQIEVuY29kZXIuCiAgKi8KLXZvaWQgaW50ZWxfcHNyX2luaXQoc3RydWN0IGRybV9p
OTE1X3ByaXZhdGUgKmRldl9wcml2KQordm9pZCBpbnRlbF9wc3JfaW5pdChzdHJ1Y3QgaW50ZWxf
ZHAgKmludGVsX2RwKQogeworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IGRw
X3RvX2k5MTUoaW50ZWxfZHApOworCiAJaWYgKCFIQVNfUFNSKGRldl9wcml2KSkKIAkJcmV0dXJu
OwogCi0JaWYgKCFkZXZfcHJpdi0+cHNyLnNpbmtfc3VwcG9ydCkKKwlpZiAoIWludGVsX2RwLT5w
c3Iuc2lua19zdXBwb3J0KQogCQlyZXR1cm47CiAKIAlpZiAoSVNfSEFTV0VMTChkZXZfcHJpdikp
CkBAIC0xNzI1LDE0ICsxNzY1LDE0IEBAIHZvaWQgaW50ZWxfcHNyX2luaXQoc3RydWN0IGRybV9p
OTE1X3ByaXZhdGUgKmRldl9wcml2KQogCS8qIFNldCBsaW5rX3N0YW5kYnkgeCBsaW5rX29mZiBk
ZWZhdWx0cyAqLwogCWlmIChJU19IQVNXRUxMKGRldl9wcml2KSB8fCBJU19CUk9BRFdFTEwoZGV2
X3ByaXYpKQogCQkvKiBIU1cgYW5kIEJEVyByZXF1aXJlIHdvcmthcm91bmRzIHRoYXQgd2UgZG9u
J3QgaW1wbGVtZW50LiAqLwotCQlkZXZfcHJpdi0+cHNyLmxpbmtfc3RhbmRieSA9IGZhbHNlOwor
CQlpbnRlbF9kcC0+cHNyLmxpbmtfc3RhbmRieSA9IGZhbHNlOwogCWVsc2UgaWYgKElOVEVMX0dF
TihkZXZfcHJpdikgPCAxMikKIAkJLyogRm9yIG5ldyBwbGF0Zm9ybXMgdXAgdG8gVEdMIGxldCdz
IHJlc3BlY3QgVkJUIGJhY2sgYWdhaW4gKi8KLQkJZGV2X3ByaXYtPnBzci5saW5rX3N0YW5kYnkg
PSBkZXZfcHJpdi0+dmJ0LnBzci5mdWxsX2xpbms7CisJCWludGVsX2RwLT5wc3IubGlua19zdGFu
ZGJ5ID0gZGV2X3ByaXYtPnZidC5wc3IuZnVsbF9saW5rOwogCi0JSU5JVF9XT1JLKCZkZXZfcHJp
di0+cHNyLndvcmssIGludGVsX3Bzcl93b3JrKTsKLQlJTklUX0RFTEFZRURfV09SSygmZGV2X3By
aXYtPnBzci5kYzNjb193b3JrLCB0Z2xfZGMzY29fZGlzYWJsZV93b3JrKTsKLQltdXRleF9pbml0
KCZkZXZfcHJpdi0+cHNyLmxvY2spOworCUlOSVRfV09SSygmaW50ZWxfZHAtPnBzci53b3JrLCBp
bnRlbF9wc3Jfd29yayk7CisJSU5JVF9ERUxBWUVEX1dPUksoJmludGVsX2RwLT5wc3IuZGMzY29f
d29yaywgdGdsX2RjM2NvX2Rpc2FibGVfd29yayk7CisJbXV0ZXhfaW5pdCgmaW50ZWxfZHAtPnBz
ci5sb2NrKTsKIH0KIAogc3RhdGljIGludCBwc3JfZ2V0X3N0YXR1c19hbmRfZXJyb3Jfc3RhdHVz
KHN0cnVjdCBpbnRlbF9kcCAqaW50ZWxfZHAsCkBAIC0xNzU4LDcgKzE3OTgsNyBAQCBzdGF0aWMg
dm9pZCBwc3JfYWxwbV9jaGVjayhzdHJ1Y3QgaW50ZWxfZHAgKmludGVsX2RwKQogewogCXN0cnVj
dCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IGRwX3RvX2k5MTUoaW50ZWxfZHApOwogCXN0
cnVjdCBkcm1fZHBfYXV4ICphdXggPSAmaW50ZWxfZHAtPmF1eDsKLQlzdHJ1Y3QgaTkxNV9wc3Ig
KnBzciA9ICZkZXZfcHJpdi0+cHNyOworCXN0cnVjdCBpbnRlbF9wc3IgKnBzciA9ICZpbnRlbF9k
cC0+cHNyOwogCXU4IHZhbDsKIAlpbnQgcjsKIApAQCAtMTc4NSw3ICsxODI1LDcgQEAgc3RhdGlj
IHZvaWQgcHNyX2FscG1fY2hlY2soc3RydWN0IGludGVsX2RwICppbnRlbF9kcCkKIHN0YXRpYyB2
b2lkIHBzcl9jYXBhYmlsaXR5X2NoYW5nZWRfY2hlY2soc3RydWN0IGludGVsX2RwICppbnRlbF9k
cCkKIHsKIAlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSBkcF90b19pOTE1KGlu
dGVsX2RwKTsKLQlzdHJ1Y3QgaTkxNV9wc3IgKnBzciA9ICZkZXZfcHJpdi0+cHNyOworCXN0cnVj
dCBpbnRlbF9wc3IgKnBzciA9ICZpbnRlbF9kcC0+cHNyOwogCXU4IHZhbDsKIAlpbnQgcjsKIApA
QCAtMTgwOSwxOCArMTg0OSwxOCBAQCBzdGF0aWMgdm9pZCBwc3JfY2FwYWJpbGl0eV9jaGFuZ2Vk
X2NoZWNrKHN0cnVjdCBpbnRlbF9kcCAqaW50ZWxfZHApCiB2b2lkIGludGVsX3Bzcl9zaG9ydF9w
dWxzZShzdHJ1Y3QgaW50ZWxfZHAgKmludGVsX2RwKQogewogCXN0cnVjdCBkcm1faTkxNV9wcml2
YXRlICpkZXZfcHJpdiA9IGRwX3RvX2k5MTUoaW50ZWxfZHApOwotCXN0cnVjdCBpOTE1X3BzciAq
cHNyID0gJmRldl9wcml2LT5wc3I7CisJc3RydWN0IGludGVsX3BzciAqcHNyID0gJmludGVsX2Rw
LT5wc3I7CiAJdTggc3RhdHVzLCBlcnJvcl9zdGF0dXM7CiAJY29uc3QgdTggZXJyb3JzID0gRFBf
UFNSX1JGQl9TVE9SQUdFX0VSUk9SIHwKIAkJCSAgRFBfUFNSX1ZTQ19TRFBfVU5DT1JSRUNUQUJM
RV9FUlJPUiB8CiAJCQkgIERQX1BTUl9MSU5LX0NSQ19FUlJPUjsKIAotCWlmICghQ0FOX1BTUihk
ZXZfcHJpdikgfHwgIWludGVsX2RwX2lzX2VkcChpbnRlbF9kcCkpCisJaWYgKCFDQU5fUFNSKGlu
dGVsX2RwKSB8fCAhaW50ZWxfZHBfaXNfZWRwKGludGVsX2RwKSkKIAkJcmV0dXJuOwogCiAJbXV0
ZXhfbG9jaygmcHNyLT5sb2NrKTsKIAotCWlmICghcHNyLT5lbmFibGVkIHx8IHBzci0+ZHAgIT0g
aW50ZWxfZHApCisJaWYgKCFwc3ItPmVuYWJsZWQpCiAJCWdvdG8gZXhpdDsKIAogCWlmIChwc3Jf
Z2V0X3N0YXR1c19hbmRfZXJyb3Jfc3RhdHVzKGludGVsX2RwLCAmc3RhdHVzLCAmZXJyb3Jfc3Rh
dHVzKSkgewpAQCAtMTg2MywxNSArMTkwMywxNCBAQCB2b2lkIGludGVsX3Bzcl9zaG9ydF9wdWxz
ZShzdHJ1Y3QgaW50ZWxfZHAgKmludGVsX2RwKQogCiBib29sIGludGVsX3Bzcl9lbmFibGVkKHN0
cnVjdCBpbnRlbF9kcCAqaW50ZWxfZHApCiB7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRl
dl9wcml2ID0gZHBfdG9faTkxNShpbnRlbF9kcCk7CiAJYm9vbCByZXQ7CiAKLQlpZiAoIUNBTl9Q
U1IoZGV2X3ByaXYpIHx8ICFpbnRlbF9kcF9pc19lZHAoaW50ZWxfZHApKQorCWlmICghQ0FOX1BT
UihpbnRlbF9kcCkgfHwgIWludGVsX2RwX2lzX2VkcChpbnRlbF9kcCkpCiAJCXJldHVybiBmYWxz
ZTsKIAotCW11dGV4X2xvY2soJmRldl9wcml2LT5wc3IubG9jayk7Ci0JcmV0ID0gKGRldl9wcml2
LT5wc3IuZHAgPT0gaW50ZWxfZHAgJiYgZGV2X3ByaXYtPnBzci5lbmFibGVkKTsKLQltdXRleF91
bmxvY2soJmRldl9wcml2LT5wc3IubG9jayk7CisJbXV0ZXhfbG9jaygmaW50ZWxfZHAtPnBzci5s
b2NrKTsKKwlyZXQgPSBpbnRlbF9kcC0+cHNyLmVuYWJsZWQ7CisJbXV0ZXhfdW5sb2NrKCZpbnRl
bF9kcC0+cHNyLmxvY2spOwogCiAJcmV0dXJuIHJldDsKIH0KZGlmZiAtLWdpdCBhL2RyaXZlcnMv
Z3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfcHNyLmggYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9k
aXNwbGF5L2ludGVsX3Bzci5oCmluZGV4IDBhNTE3OTc4ZThhZi4uMDNlYjE5NTQ3ZDA5IDEwMDY0
NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX3Bzci5oCisrKyBiL2Ry
aXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfcHNyLmgKQEAgLTE4LDcgKzE4LDcgQEAg
c3RydWN0IGludGVsX2F0b21pY19zdGF0ZTsKIHN0cnVjdCBpbnRlbF9wbGFuZV9zdGF0ZTsKIHN0
cnVjdCBpbnRlbF9wbGFuZTsKIAotI2RlZmluZSBDQU5fUFNSKGRldl9wcml2KSAoSEFTX1BTUihk
ZXZfcHJpdikgJiYgZGV2X3ByaXYtPnBzci5zaW5rX3N1cHBvcnQpCisjZGVmaW5lIENBTl9QU1Io
aW50ZWxfZHApIChIQVNfUFNSKGRwX3RvX2k5MTUoaW50ZWxfZHApKSAmJiBpbnRlbF9kcC0+cHNy
LnNpbmtfc3VwcG9ydCkKIHZvaWQgaW50ZWxfcHNyX2luaXRfZHBjZChzdHJ1Y3QgaW50ZWxfZHAg
KmludGVsX2RwKTsKIHZvaWQgaW50ZWxfcHNyX2VuYWJsZShzdHJ1Y3QgaW50ZWxfZHAgKmludGVs
X2RwLAogCQkgICAgICBjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSwK
QEAgLTI4LDI0ICsyOCwyNCBAQCB2b2lkIGludGVsX3Bzcl9kaXNhYmxlKHN0cnVjdCBpbnRlbF9k
cCAqaW50ZWxfZHAsCiB2b2lkIGludGVsX3Bzcl91cGRhdGUoc3RydWN0IGludGVsX2RwICppbnRl
bF9kcCwKIAkJICAgICAgY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUs
CiAJCSAgICAgIGNvbnN0IHN0cnVjdCBkcm1fY29ubmVjdG9yX3N0YXRlICpjb25uX3N0YXRlKTsK
LWludCBpbnRlbF9wc3JfZGVidWdfc2V0KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJp
diwgdTY0IHZhbHVlKTsKK2ludCBpbnRlbF9wc3JfZGVidWdfc2V0KHN0cnVjdCBpbnRlbF9kcCAq
aW50ZWxfZHAsIHU2NCB2YWx1ZSk7CiB2b2lkIGludGVsX3Bzcl9pbnZhbGlkYXRlKHN0cnVjdCBk
cm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKIAkJCSAgdW5zaWduZWQgZnJvbnRidWZmZXJfYml0
cywKIAkJCSAgZW51bSBmYl9vcF9vcmlnaW4gb3JpZ2luKTsKIHZvaWQgaW50ZWxfcHNyX2ZsdXNo
KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKIAkJICAgICB1bnNpZ25lZCBmcm9u
dGJ1ZmZlcl9iaXRzLAogCQkgICAgIGVudW0gZmJfb3Bfb3JpZ2luIG9yaWdpbik7Ci12b2lkIGlu
dGVsX3Bzcl9pbml0KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdik7Cit2b2lkIGlu
dGVsX3Bzcl9pbml0KHN0cnVjdCBpbnRlbF9kcCAqaW50ZWxfZHApOwogdm9pZCBpbnRlbF9wc3Jf
Y29tcHV0ZV9jb25maWcoc3RydWN0IGludGVsX2RwICppbnRlbF9kcCwKIAkJCSAgICAgIHN0cnVj
dCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlKTsKLXZvaWQgaW50ZWxfcHNyX2lycV9oYW5k
bGVyKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwgdTMyIHBzcl9paXIpOwordm9p
ZCBpbnRlbF9wc3JfaXJxX2hhbmRsZXIoc3RydWN0IGludGVsX2RwICppbnRlbF9kcCwgdTMyIHBz
cl9paXIpOwogdm9pZCBpbnRlbF9wc3Jfc2hvcnRfcHVsc2Uoc3RydWN0IGludGVsX2RwICppbnRl
bF9kcCk7Ci1pbnQgaW50ZWxfcHNyX3dhaXRfZm9yX2lkbGUoY29uc3Qgc3RydWN0IGludGVsX2Ny
dGNfc3RhdGUgKm5ld19jcnRjX3N0YXRlLAotCQkJICAgIHUzMiAqb3V0X3ZhbHVlKTsKK3ZvaWQg
aW50ZWxfcHNyX3dhaXRfZm9yX2lkbGUoY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKm5l
d19jcnRjX3N0YXRlKTsKIGJvb2wgaW50ZWxfcHNyX2VuYWJsZWQoc3RydWN0IGludGVsX2RwICpp
bnRlbF9kcCk7CiBpbnQgaW50ZWxfcHNyMl9zZWxfZmV0Y2hfdXBkYXRlKHN0cnVjdCBpbnRlbF9h
dG9taWNfc3RhdGUgKnN0YXRlLAogCQkJCXN0cnVjdCBpbnRlbF9jcnRjICpjcnRjKTsKLXZvaWQg
aW50ZWxfcHNyMl9wcm9ncmFtX3RyYW5zX21hbl90cmtfY3RsKGNvbnN0IHN0cnVjdCBpbnRlbF9j
cnRjX3N0YXRlICpjcnRjX3N0YXRlKTsKK3ZvaWQgaW50ZWxfcHNyMl9wcm9ncmFtX3RyYW5zX21h
bl90cmtfY3RsKHN0cnVjdCBpbnRlbF9kcCAqaW50ZWxfZHAsCisJCQkJCSAgY29uc3Qgc3RydWN0
IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUpOwogdm9pZCBpbnRlbF9wc3IyX3Byb2dyYW1f
cGxhbmVfc2VsX2ZldGNoKHN0cnVjdCBpbnRlbF9wbGFuZSAqcGxhbmUsCiAJCQkJCWNvbnN0IHN0
cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlLAogCQkJCQljb25zdCBzdHJ1Y3QgaW50
ZWxfcGxhbmVfc3RhdGUgKnBsYW5lX3N0YXRlLApkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJt
L2k5MTUvZGlzcGxheS9pbnRlbF9zcHJpdGUuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3Bs
YXkvaW50ZWxfc3ByaXRlLmMKaW5kZXggYjdlMjA4ODE2MDc0Li45NDgyMzRjNjA2NDggMTAwNjQ0
Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfc3ByaXRlLmMKKysrIGIv
ZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9zcHJpdGUuYwpAQCAtODQsNyArODQs
NiBAQCB2b2lkIGludGVsX3BpcGVfdXBkYXRlX3N0YXJ0KGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRj
X3N0YXRlICpuZXdfY3J0Y19zdGF0ZSkKIAlib29sIG5lZWRfdmx2X2RzaV93YSA9IChJU19WQUxM
RVlWSUVXKGRldl9wcml2KSB8fCBJU19DSEVSUllWSUVXKGRldl9wcml2KSkgJiYKIAkJaW50ZWxf
Y3J0Y19oYXNfdHlwZShuZXdfY3J0Y19zdGF0ZSwgSU5URUxfT1VUUFVUX0RTSSk7CiAJREVGSU5F
X1dBSVQod2FpdCk7Ci0JdTMyIHBzcl9zdGF0dXM7CiAKIAlpZiAobmV3X2NydGNfc3RhdGUtPnVh
cGkuYXN5bmNfZmxpcCkKIAkJcmV0dXJuOwpAQCAtMTA5LDEwICsxMDgsNyBAQCB2b2lkIGludGVs
X3BpcGVfdXBkYXRlX3N0YXJ0KGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpuZXdfY3J0
Y19zdGF0ZSkKIAkgKiBWQkwgaW50ZXJydXB0cyB3aWxsIHN0YXJ0IHRoZSBQU1IgZXhpdCBhbmQg
cHJldmVudCBhIFBTUgogCSAqIHJlLWVudHJ5IGFzIHdlbGwuCiAJICovCi0JaWYgKGludGVsX3Bz
cl93YWl0X2Zvcl9pZGxlKG5ld19jcnRjX3N0YXRlLCAmcHNyX3N0YXR1cykpCi0JCWRybV9lcnIo
JmRldl9wcml2LT5kcm0sCi0JCQkiUFNSIGlkbGUgdGltZWQgb3V0IDB4JXgsIGF0b21pYyB1cGRh
dGUgbWF5IGZhaWxcbiIsCi0JCQlwc3Jfc3RhdHVzKTsKKwlpbnRlbF9wc3Jfd2FpdF9mb3JfaWRs
ZShuZXdfY3J0Y19zdGF0ZSk7CiAKIAlsb2NhbF9pcnFfZGlzYWJsZSgpOwogCmRpZmYgLS1naXQg
YS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2Rydi5oIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUv
aTkxNV9kcnYuaAppbmRleCA1ZDA0YjI4MmMwNjAuLmEyZTM5ZThhZGNiZSAxMDA2NDQKLS0tIGEv
ZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9kcnYuaAorKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkx
NS9pOTE1X2Rydi5oCkBAIC00NzUsNDIgKzQ3NSw2IEBAIHN0cnVjdCBpOTE1X2RycnMgewogCWVu
dW0gZHJyc19zdXBwb3J0X3R5cGUgdHlwZTsKIH07CiAKLXN0cnVjdCBpOTE1X3BzciB7Ci0Jc3Ry
dWN0IG11dGV4IGxvY2s7Ci0KLSNkZWZpbmUgSTkxNV9QU1JfREVCVUdfTU9ERV9NQVNLCTB4MGYK
LSNkZWZpbmUgSTkxNV9QU1JfREVCVUdfREVGQVVMVAkJMHgwMAotI2RlZmluZSBJOTE1X1BTUl9E
RUJVR19ESVNBQkxFCQkweDAxCi0jZGVmaW5lIEk5MTVfUFNSX0RFQlVHX0VOQUJMRQkJMHgwMgot
I2RlZmluZSBJOTE1X1BTUl9ERUJVR19GT1JDRV9QU1IxCTB4MDMKLSNkZWZpbmUgSTkxNV9QU1Jf
REVCVUdfSVJRCQkweDEwCi0KLQl1MzIgZGVidWc7Ci0JYm9vbCBzaW5rX3N1cHBvcnQ7Ci0JYm9v
bCBlbmFibGVkOwotCXN0cnVjdCBpbnRlbF9kcCAqZHA7Ci0JZW51bSBwaXBlIHBpcGU7Ci0JZW51
bSB0cmFuc2NvZGVyIHRyYW5zY29kZXI7Ci0JYm9vbCBhY3RpdmU7Ci0Jc3RydWN0IHdvcmtfc3Ry
dWN0IHdvcms7Ci0JdW5zaWduZWQgYnVzeV9mcm9udGJ1ZmZlcl9iaXRzOwotCWJvb2wgc2lua19w
c3IyX3N1cHBvcnQ7Ci0JYm9vbCBsaW5rX3N0YW5kYnk7Ci0JYm9vbCBjb2xvcmltZXRyeV9zdXBw
b3J0OwotCWJvb2wgcHNyMl9lbmFibGVkOwotCWJvb2wgcHNyMl9zZWxfZmV0Y2hfZW5hYmxlZDsK
LQl1OCBzaW5rX3N5bmNfbGF0ZW5jeTsKLQlrdGltZV90IGxhc3RfZW50cnlfYXR0ZW1wdDsKLQlr
dGltZV90IGxhc3RfZXhpdDsKLQlib29sIHNpbmtfbm90X3JlbGlhYmxlOwotCWJvb2wgaXJxX2F1
eF9lcnJvcjsKLQl1MTYgc3VfeF9ncmFudWxhcml0eTsKLQlib29sIGRjM2NvX2VuYWJsZWQ7Ci0J
dTMyIGRjM2NvX2V4aXRfZGVsYXk7Ci0Jc3RydWN0IGRlbGF5ZWRfd29yayBkYzNjb193b3JrOwot
CXN0cnVjdCBkcm1fZHBfdnNjX3NkcCB2c2M7Ci19OwotCiAjZGVmaW5lIFFVSVJLX0xWRFNfU1ND
X0RJU0FCTEUgKDE8PDEpCiAjZGVmaW5lIFFVSVJLX0lOVkVSVF9CUklHSFRORVNTICgxPDwyKQog
I2RlZmluZSBRVUlSS19CQUNLTElHSFRfUFJFU0VOVCAoMTw8MykKQEAgLTEwNDEsOCArMTAwNSw2
IEBAIHN0cnVjdCBkcm1faTkxNV9wcml2YXRlIHsKIAogCXN0cnVjdCBpOTE1X3Bvd2VyX2RvbWFp
bnMgcG93ZXJfZG9tYWluczsKIAotCXN0cnVjdCBpOTE1X3BzciBwc3I7Ci0KIAlzdHJ1Y3QgaTkx
NV9ncHVfZXJyb3IgZ3B1X2Vycm9yOwogCiAJc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKnZs
dl9wY3R4OwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9pcnEuYyBiL2Ry
aXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfaXJxLmMKaW5kZXggYjI0NTEwOWY3M2UzLi5iMGFlZTQ3
YzdhZDQgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfaXJxLmMKKysrIGIv
ZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9pcnEuYwpAQCAtMjA1NywxMCArMjA1NywyMiBAQCBz
dGF0aWMgdm9pZCBpdmJfZGlzcGxheV9pcnFfaGFuZGxlcihzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0
ZSAqZGV2X3ByaXYsCiAJCWl2Yl9lcnJfaW50X2hhbmRsZXIoZGV2X3ByaXYpOwogCiAJaWYgKGRl
X2lpciAmIERFX0VEUF9QU1JfSU5UX0hTVykgewotCQl1MzIgcHNyX2lpciA9IGludGVsX3VuY29y
ZV9yZWFkKCZkZXZfcHJpdi0+dW5jb3JlLCBFRFBfUFNSX0lJUik7CisJCXN0cnVjdCBpbnRlbF9l
bmNvZGVyICplbmNvZGVyOwogCi0JCWludGVsX3Bzcl9pcnFfaGFuZGxlcihkZXZfcHJpdiwgcHNy
X2lpcik7Ci0JCWludGVsX3VuY29yZV93cml0ZSgmZGV2X3ByaXYtPnVuY29yZSwgRURQX1BTUl9J
SVIsIHBzcl9paXIpOworCQlmb3JfZWFjaF9pbnRlbF9kcCgmZGV2X3ByaXYtPmRybSwgZW5jb2Rl
cikgeworCQkJc3RydWN0IGludGVsX2RwICppbnRlbF9kcCA9IGVuY190b19pbnRlbF9kcChlbmNv
ZGVyKTsKKworCQkJaWYgKGVuY29kZXItPnR5cGUgPT0gSU5URUxfT1VUUFVUX0VEUCAmJgorCQkJ
ICAgIENBTl9QU1IoaW50ZWxfZHApKSB7CisJCQkJdTMyIHBzcl9paXIgPSBpbnRlbF91bmNvcmVf
cmVhZCgmZGV2X3ByaXYtPnVuY29yZSwKKwkJCQkJCQkJRURQX1BTUl9JSVIpOworCisJCQkJaW50
ZWxfcHNyX2lycV9oYW5kbGVyKGludGVsX2RwLCBwc3JfaWlyKTsKKwkJCQlpbnRlbF91bmNvcmVf
d3JpdGUoJmRldl9wcml2LT51bmNvcmUsCisJCQkJCQkgICBFRFBfUFNSX0lJUiwgcHNyX2lpcik7
CisJCQkJYnJlYWs7CisJCQl9CisJCX0KIAl9CiAKIAlpZiAoZGVfaWlyICYgREVfQVVYX0NIQU5O
RUxfQV9JVkIpCkBAIC0yMjY4LDIxICsyMjgwLDM0IEBAIGdlbjhfZGVfbWlzY19pcnFfaGFuZGxl
cihzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsIHUzMiBpaXIpCiAJfQogCiAJaWYg
KGlpciAmIEdFTjhfREVfRURQX1BTUikgeworCQlzdHJ1Y3QgaW50ZWxfZW5jb2RlciAqZW5jb2Rl
cjsKIAkJdTMyIHBzcl9paXI7CiAJCWk5MTVfcmVnX3QgaWlyX3JlZzsKIAotCQlpZiAoSU5URUxf
R0VOKGRldl9wcml2KSA+PSAxMikKLQkJCWlpcl9yZWcgPSBUUkFOU19QU1JfSUlSKGRldl9wcml2
LT5wc3IudHJhbnNjb2Rlcik7Ci0JCWVsc2UKLQkJCWlpcl9yZWcgPSBFRFBfUFNSX0lJUjsKKwkJ
Zm9yX2VhY2hfaW50ZWxfZHAoJmRldl9wcml2LT5kcm0sIGVuY29kZXIpIHsKKwkJCXN0cnVjdCBp
bnRlbF9kcCAqaW50ZWxfZHAgPSBlbmNfdG9faW50ZWxfZHAoZW5jb2Rlcik7CiAKLQkJcHNyX2lp
ciA9IGludGVsX3VuY29yZV9yZWFkKCZkZXZfcHJpdi0+dW5jb3JlLCBpaXJfcmVnKTsKLQkJaW50
ZWxfdW5jb3JlX3dyaXRlKCZkZXZfcHJpdi0+dW5jb3JlLCBpaXJfcmVnLCBwc3JfaWlyKTsKKwkJ
CWlmIChJTlRFTF9HRU4oZGV2X3ByaXYpID49IDEyICYmIENBTl9QU1IoaW50ZWxfZHApKSB7CisJ
CQkJaWlyX3JlZyA9IFRSQU5TX1BTUl9JSVIoaW50ZWxfZHAtPnBzci50cmFuc2NvZGVyKTsKKwkJ
CX0gZWxzZSBpZiAoZW5jb2Rlci0+dHlwZSA9PSBJTlRFTF9PVVRQVVRfRURQICYmCisJCQkJICAg
Q0FOX1BTUihpbnRlbF9kcCkpIHsKKwkJCQlpaXJfcmVnID0gRURQX1BTUl9JSVI7CisJCQl9IGVs
c2UgeworCQkJCWNvbnRpbnVlOworCQkJfQorCisJCQlwc3JfaWlyID0gaW50ZWxfdW5jb3JlX3Jl
YWQoJmRldl9wcml2LT51bmNvcmUsIGlpcl9yZWcpOworCQkJaW50ZWxfdW5jb3JlX3dyaXRlKCZk
ZXZfcHJpdi0+dW5jb3JlLCBpaXJfcmVnLCBwc3JfaWlyKTsKKworCQkJaWYgKHBzcl9paXIpCisJ
CQkJZm91bmQgPSB0cnVlOwogCi0JCWlmIChwc3JfaWlyKQotCQkJZm91bmQgPSB0cnVlOworCQkJ
aW50ZWxfcHNyX2lycV9oYW5kbGVyKGludGVsX2RwLCBwc3JfaWlyKTsKIAotCQlpbnRlbF9wc3Jf
aXJxX2hhbmRsZXIoZGV2X3ByaXYsIHBzcl9paXIpOworCQkJLyogcHJpb3IgR0VOMTIgb25seSBo
YXZlIG9uZSBFRFAgUFNSICovCisJCQlpZiAoSU5URUxfR0VOKGRldl9wcml2KSA8IDEyKQorCQkJ
CWJyZWFrOworCQl9CiAJfQogCiAJaWYgKCFmb3VuZCkKLS0gCjIuMjUuMAoKX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX18KSW50ZWwtZ2Z4IG1haWxpbmcgbGlz
dApJbnRlbC1nZnhAbGlzdHMuZnJlZWRlc2t0b3Aub3JnCmh0dHBzOi8vbGlzdHMuZnJlZWRlc2t0
b3Aub3JnL21haWxtYW4vbGlzdGluZm8vaW50ZWwtZ2Z4Cg==

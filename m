Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 49043BB71E
	for <lists+intel-gfx@lfdr.de>; Mon, 23 Sep 2019 16:49:56 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 6BBF189830;
	Mon, 23 Sep 2019 14:49:54 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from mblankhorst.nl (mblankhorst.nl [141.105.120.124])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 672D689830
 for <intel-gfx@lists.freedesktop.org>; Mon, 23 Sep 2019 14:49:52 +0000 (UTC)
From: Maarten Lankhorst <maarten.lankhorst@linux.intel.com>
To: intel-gfx@lists.freedesktop.org
Date: Mon, 23 Sep 2019 16:49:47 +0200
Message-Id: <20190923144947.18588-1-maarten.lankhorst@linux.intel.com>
X-Mailer: git-send-email 2.20.1
In-Reply-To: <20190923130307.GK1208@intel.com>
References: <20190923130307.GK1208@intel.com>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH] drm/i915/dp: Fix dsc bpp calculations, v4.
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Cc: stable@vger.kernel.org
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

VGhlcmUgd2FzIGEgaW50ZWdlciB3cmFwYXJvdW5kIHdoZW4gbW9kZV9jbG9jayBiZWNhbWUgdG9v
IGhpZ2gsCmFuZCB3ZSBkaWRuJ3QgY29ycmVjdCBmb3IgdGhlIEZFQyBvdmVyaGVhZCBmYWN0b3Ig
d2hlbiBkaXZpZGluZywKd2l0aCB0aGUgY2FsY3VsYXRpb25zIGJyZWFraW5nIGF0IEhCUjMuCgpB
cyBhIHJlc3VsdCBvdXIgY2FsY3VsYXRlZCBicHAgd2FzIHdheSB0b28gaGlnaCwgYW5kIHRoZSBs
aW5rIHdpZHRoCmxpbWl0YXRpb24gbmV2ZXIgY2FtZSBpbnRvIGVmZmVjdC4KClByaW50IG91dCB0
aGUgcmVzdWx0aW5nIGJwcCBjYWxjdWx1bGF0aW9ucyBhcyBhIHNhbml0eSBjaGVjaywganVzdApp
biBjYXNlIHdlIGV2ZXIgaGF2ZSB0byBkZWJ1ZyBpdCBsYXRlciBvbiBhZ2Fpbi4KCldlIGFsc28g
dXNlZCB0aGUgd3JvbmcgZmFjdG9yIGZvciBGRUMuIFdoaWxlIGJzcGVjIG1lbnRpb25zIDIuNCUs
CmFsbCB0aGUgY2FsY3VsYXRpb25zIHVzZSAxLzAuOTcyMjYxLCBhbmQgdGhlIHNhbWUgcmF0aW8g
c2hvdWxkIGJlCmFwcGxpZWQgdG8gZGF0YSBNL04gYXMgd2VsbCwgc28gdXNlIGl0IHRoZXJlIHdo
ZW4gRkVDIGlzIGVuYWJsZWQuCgpNYWtlIHN1cmUgd2UgZG9uJ3QgYnJlYWsgaHcgcmVhZG91dCwg
YW5kIHJlYWQgb3V0IEZFQyBlbmFibGUgc3RhdGUKYW5kIGNvcnJlY3QgdGhlIERESSBjbG9jayBy
ZWFkb3V0IGZvciB0aGUgbmV3IHZhbHVlcy4KClRoaXMgZml4ZXMgdGhlIEZJRk8gdW5kZXJydW4g
d2UgYXJlIHNlZWluZyB3aXRoIEZFQyBlbmFibGVkLgoKQ2hhbmdlcyBzaW5jZSB2MjoKLSBIYW5k
bGUgZmVjX2VuYWJsZSBpbiBpbnRlbF9saW5rX2NvbXB1dGVfbV9uLCBzbyBvbmx5IGRhdGEgTS9O
IGlzIGFkanVzdGVkLiAoVmlsbGUpCi0gRml4IGluaXRpYWwgaGFyZHdhcmUgcmVhZG91dCBmb3Ig
RkVDLiAoVmlsbGUpCkNoYW5nZXMgc2luY2UgdjM6Ci0gUmVtb3ZlIGJvZ3VzIGZlY190b19tb2Rl
X2Nsb2NrLiAoVmlsbGUpCgpTaWduZWQtb2ZmLWJ5OiBNYWFydGVuIExhbmtob3JzdCA8bWFhcnRl
bi5sYW5raG9yc3RAbGludXguaW50ZWwuY29tPgpGaXhlczogZDkyMThjOGY2Y2Y0ICgiZHJtL2k5
MTUvZHA6IEFkZCBoZWxwZXJzIGZvciBDb21wcmVzc2VkIEJQUCBhbmQgU2xpY2UgQ291bnQgZm9y
IERTQyIpCkNjOiA8c3RhYmxlQHZnZXIua2VybmVsLm9yZz4gIyB2NS4wKwpDYzogTWFuYXNpIE5h
dmFyZSA8bWFuYXNpLmQubmF2YXJlQGludGVsLmNvbT4KLS0tCiBkcml2ZXJzL2dwdS9kcm0vaTkx
NS9kaXNwbGF5L2ludGVsX2RkaS5jICAgICB8ICAxNyArKwogZHJpdmVycy9ncHUvZHJtL2k5MTUv
ZGlzcGxheS9pbnRlbF9kaXNwbGF5LmMgfCAgMTMgKy0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2Rp
c3BsYXkvaW50ZWxfZGlzcGxheS5oIHwgICAyICstCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNw
bGF5L2ludGVsX2RwLmMgICAgICB8IDE4NCArKysrKysrKysrLS0tLS0tLS0tCiBkcml2ZXJzL2dw
dS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2RwLmggICAgICB8ICAgNiArLQogZHJpdmVycy9ncHUv
ZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kcF9tc3QuYyAgfCAgIDIgKy0KIDYgZmlsZXMgY2hhbmdl
ZCwgMTI1IGluc2VydGlvbnMoKyksIDk5IGRlbGV0aW9ucygtKQoKZGlmZiAtLWdpdCBhL2RyaXZl
cnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZGRpLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkx
NS9kaXNwbGF5L2ludGVsX2RkaS5jCmluZGV4IDBjMGRhOWY2YzJlOC4uMWNiMjk3YWJkMTExIDEw
MDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2RkaS5jCisrKyBi
L2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZGRpLmMKQEAgLTQwNDUsNiArNDA0
NSwyMyBAQCB2b2lkIGludGVsX2RkaV9nZXRfY29uZmlnKHN0cnVjdCBpbnRlbF9lbmNvZGVyICpl
bmNvZGVyLAogCQlwaXBlX2NvbmZpZy0+bGFuZV9jb3VudCA9CiAJCQkoKHRlbXAgJiBERElfUE9S
VF9XSURUSF9NQVNLKSA+PiBERElfUE9SVF9XSURUSF9TSElGVCkgKyAxOwogCQlpbnRlbF9kcF9n
ZXRfbV9uKGludGVsX2NydGMsIHBpcGVfY29uZmlnKTsKKworCQlpZiAoSU5URUxfR0VOKGRldl9w
cml2KSA+PSAxMSkgeworCQkJaTkxNV9yZWdfdCBkcF90cF9jdGw7CisKKwkJCWlmIChJU19HRU4o
ZGV2X3ByaXYsIDExKSkKKwkJCQlkcF90cF9jdGwgPSBEUF9UUF9DVEwocGlwZV9jb25maWctPmNw
dV90cmFuc2NvZGVyKTsKKwkJCWVsc2UKKwkJCQlkcF90cF9jdGwgPSBUR0xfRFBfVFBfQ1RMKHBp
cGVfY29uZmlnLT5jcHVfdHJhbnNjb2Rlcik7CisKKwkJCXBpcGVfY29uZmlnLT5mZWNfZW5hYmxl
ID0KKwkJCQlJOTE1X1JFQUQoZHBfdHBfY3RsKSAmIERQX1RQX0NUTF9GRUNfRU5BQkxFOworCisJ
CQlEUk1fREVCVUdfS01TKCJbRU5DT0RFUjolZDolc10gRmVjIHN0YXR1czogJXVcbiIsCisJCQkJ
ICAgICAgZW5jb2Rlci0+YmFzZS5iYXNlLmlkLCBlbmNvZGVyLT5iYXNlLm5hbWUsCisJCQkJICAg
ICAgcGlwZV9jb25maWctPmZlY19lbmFibGUpOworCQl9CisKIAkJYnJlYWs7CiAJY2FzZSBUUkFO
U19ERElfTU9ERV9TRUxFQ1RfRFBfTVNUOgogCQlwaXBlX2NvbmZpZy0+b3V0cHV0X3R5cGVzIHw9
IEJJVChJTlRFTF9PVVRQVVRfRFBfTVNUKTsKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9p
OTE1L2Rpc3BsYXkvaW50ZWxfZGlzcGxheS5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxh
eS9pbnRlbF9kaXNwbGF5LmMKaW5kZXggNWVjZjU0MjcwMTgxLi4zMTY5OGE1Nzc3M2YgMTAwNjQ0
Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZGlzcGxheS5jCisrKyBi
L2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZGlzcGxheS5jCkBAIC03MjkxLDcg
KzcyOTEsNyBAQCBzdGF0aWMgaW50IGlyb25sYWtlX2ZkaV9jb21wdXRlX2NvbmZpZyhzdHJ1Y3Qg
aW50ZWxfY3J0YyAqaW50ZWxfY3J0YywKIAlwaXBlX2NvbmZpZy0+ZmRpX2xhbmVzID0gbGFuZTsK
IAogCWludGVsX2xpbmtfY29tcHV0ZV9tX24ocGlwZV9jb25maWctPnBpcGVfYnBwLCBsYW5lLCBm
ZGlfZG90Y2xvY2ssCi0JCQkgICAgICAgbGlua19idywgJnBpcGVfY29uZmlnLT5mZGlfbV9uLCBm
YWxzZSk7CisJCQkgICAgICAgbGlua19idywgJnBpcGVfY29uZmlnLT5mZGlfbV9uLCBmYWxzZSwg
ZmFsc2UpOwogCiAJcmV0ID0gaXJvbmxha2VfY2hlY2tfZmRpX2xhbmVzKGRldiwgaW50ZWxfY3J0
Yy0+cGlwZSwgcGlwZV9jb25maWcpOwogCWlmIChyZXQgPT0gLUVERUFETEspCkBAIC03NTM4LDEx
ICs3NTM4LDE1IEBAIHZvaWQKIGludGVsX2xpbmtfY29tcHV0ZV9tX24odTE2IGJpdHNfcGVyX3Bp
eGVsLCBpbnQgbmxhbmVzLAogCQkgICAgICAgaW50IHBpeGVsX2Nsb2NrLCBpbnQgbGlua19jbG9j
aywKIAkJICAgICAgIHN0cnVjdCBpbnRlbF9saW5rX21fbiAqbV9uLAotCQkgICAgICAgYm9vbCBj
b25zdGFudF9uKQorCQkgICAgICAgYm9vbCBjb25zdGFudF9uLCBib29sIGZlY19lbmFibGUpCiB7
Ci0JbV9uLT50dSA9IDY0OworCXUzMiBkYXRhX2Nsb2NrID0gYml0c19wZXJfcGl4ZWwgKiBwaXhl
bF9jbG9jazsKKworCWlmIChmZWNfZW5hYmxlKQorCQlkYXRhX2Nsb2NrID0gaW50ZWxfZHBfbW9k
ZV90b19mZWNfY2xvY2soZGF0YV9jbG9jayk7CiAKLQljb21wdXRlX21fbihiaXRzX3Blcl9waXhl
bCAqIHBpeGVsX2Nsb2NrLAorCW1fbi0+dHUgPSA2NDsKKwljb21wdXRlX21fbihkYXRhX2Nsb2Nr
LAogCQkgICAgbGlua19jbG9jayAqIG5sYW5lcyAqIDgsCiAJCSAgICAmbV9uLT5nbWNoX20sICZt
X24tPmdtY2hfbiwKIAkJICAgIGNvbnN0YW50X24pOwpAQCAtMTI4MzIsNiArMTI4MzYsNyBAQCBp
bnRlbF9waXBlX2NvbmZpZ19jb21wYXJlKGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpj
dXJyZW50X2NvbmZpZywKIAlQSVBFX0NPTkZfQ0hFQ0tfQk9PTChoZG1pX3NjcmFtYmxpbmcpOwog
CVBJUEVfQ09ORl9DSEVDS19CT09MKGhkbWlfaGlnaF90bWRzX2Nsb2NrX3JhdGlvKTsKIAlQSVBF
X0NPTkZfQ0hFQ0tfQk9PTChoYXNfaW5mb2ZyYW1lKTsKKwlQSVBFX0NPTkZfQ0hFQ0tfQk9PTChm
ZWNfZW5hYmxlKTsKIAogCVBJUEVfQ09ORl9DSEVDS19CT09MX0lOQ09NUExFVEUoaGFzX2F1ZGlv
KTsKIApkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kaXNw
bGF5LmggYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2Rpc3BsYXkuaAppbmRl
eCA1Y2VhNmY4ZTEwN2EuLjRiOWUxOGU1YTI2MyAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJt
L2k5MTUvZGlzcGxheS9pbnRlbF9kaXNwbGF5LmgKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUv
ZGlzcGxheS9pbnRlbF9kaXNwbGF5LmgKQEAgLTQ0Myw3ICs0NDMsNyBAQCBlbnVtIHBoeV9maWEg
ewogdm9pZCBpbnRlbF9saW5rX2NvbXB1dGVfbV9uKHUxNiBicHAsIGludCBubGFuZXMsCiAJCQkg
ICAgaW50IHBpeGVsX2Nsb2NrLCBpbnQgbGlua19jbG9jaywKIAkJCSAgICBzdHJ1Y3QgaW50ZWxf
bGlua19tX24gKm1fbiwKLQkJCSAgICBib29sIGNvbnN0YW50X24pOworCQkJICAgIGJvb2wgY29u
c3RhbnRfbiwgYm9vbCBmZWNfZW5hYmxlKTsKIGJvb2wgaXNfY2NzX21vZGlmaWVyKHU2NCBtb2Rp
Zmllcik7CiB2b2lkIGxwdF9kaXNhYmxlX2Nsa291dF9kcChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0
ZSAqZGV2X3ByaXYpOwogdTMyIGludGVsX3BsYW5lX2ZiX21heF9zdHJpZGUoc3RydWN0IGRybV9p
OTE1X3ByaXZhdGUgKmRldl9wcml2LApkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUv
ZGlzcGxheS9pbnRlbF9kcC5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9k
cC5jCmluZGV4IDgyOTU1OWY5NzQ0MC4uMmIxZTcxZjk5MmIwIDEwMDY0NAotLS0gYS9kcml2ZXJz
L2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2RwLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5
MTUvZGlzcGxheS9pbnRlbF9kcC5jCkBAIC03Niw4ICs3Niw4IEBACiAjZGVmaW5lIERQX0RTQ19N
QVhfRU5DX1RIUk9VR0hQVVRfMAkJMzQwMDAwCiAjZGVmaW5lIERQX0RTQ19NQVhfRU5DX1RIUk9V
R0hQVVRfMQkJNDAwMDAwCiAKLS8qIERQIERTQyBGRUMgT3ZlcmhlYWQgZmFjdG9yID0gKDEwMCAt
IDIuNCkvMTAwICovCi0jZGVmaW5lIERQX0RTQ19GRUNfT1ZFUkhFQURfRkFDVE9SCQk5NzYKKy8q
IERQIERTQyBGRUMgT3ZlcmhlYWQgZmFjdG9yID0gMS8oMC45NzIyNjEpICovCisjZGVmaW5lIERQ
X0RTQ19GRUNfT1ZFUkhFQURfRkFDVE9SCQk5NzIyNjEKIAogLyogQ29tcGxpYW5jZSB0ZXN0IHN0
YXR1cyBiaXRzICAqLwogI2RlZmluZSBJTlRFTF9EUF9SRVNPTFVUSU9OX1NISUZUX01BU0sJMApA
QCAtNDkyLDYgKzQ5Miw5NyBAQCBpbnQgaW50ZWxfZHBfZ2V0X2xpbmtfdHJhaW5fZmFsbGJhY2tf
dmFsdWVzKHN0cnVjdCBpbnRlbF9kcCAqaW50ZWxfZHAsCiAJcmV0dXJuIDA7CiB9CiAKK3UzMiBp
bnRlbF9kcF9tb2RlX3RvX2ZlY19jbG9jayh1MzIgbW9kZV9jbG9jaykKK3sKKwlyZXR1cm4gZGl2
X3U2NChtdWxfdTMyX3UzMihtb2RlX2Nsb2NrLCAxMDAwMDAwVSksCisJCSAgICAgICBEUF9EU0Nf
RkVDX09WRVJIRUFEX0ZBQ1RPUik7Cit9CisKK3N0YXRpYyB1MTYgaW50ZWxfZHBfZHNjX2dldF9v
dXRwdXRfYnBwKHUzMiBsaW5rX2Nsb2NrLCB1MzIgbGFuZV9jb3VudCwKKwkJCQkgICAgICAgdTMy
IG1vZGVfY2xvY2ssIHUzMiBtb2RlX2hkaXNwbGF5KQoreworCXUzMiBiaXRzX3Blcl9waXhlbCwg
bWF4X2JwcF9zbWFsbF9qb2luZXJfcmFtOworCWludCBpOworCisJLyoKKwkgKiBBdmFpbGFibGUg
TGluayBCYW5kd2lkdGgoS2JpdHMvc2VjKSA9IChOdW1iZXJPZkxhbmVzKSoKKwkgKiAoTGlua1N5
bWJvbENsb2NrKSogOCAqIChUaW1lU2xvdHNQZXJNVFApCisJICogZm9yIFNTVCAtPiBUaW1lU2xv
dHNQZXJNVFAgaXMgMSwKKwkgKiBmb3IgTVNUIC0+IFRpbWVTbG90c1Blck1UUCBoYXMgdG8gYmUg
Y2FsY3VsYXRlZAorCSAqLworCWJpdHNfcGVyX3BpeGVsID0gKGxpbmtfY2xvY2sgKiBsYW5lX2Nv
dW50ICogOCkgLworCQkJIGludGVsX2RwX21vZGVfdG9fZmVjX2Nsb2NrKG1vZGVfY2xvY2spOwor
CURSTV9ERUJVR19LTVMoIk1heCBsaW5rIGJwcDogJXVcbiIsIGJpdHNfcGVyX3BpeGVsKTsKKwor
CS8qIFNtYWxsIEpvaW5lciBDaGVjazogb3V0cHV0IGJwcCA8PSBqb2luZXIgUkFNIChiaXRzKSAv
IEhvcml6LiB3aWR0aCAqLworCW1heF9icHBfc21hbGxfam9pbmVyX3JhbSA9IERQX0RTQ19NQVhf
U01BTExfSk9JTkVSX1JBTV9CVUZGRVIgLyBtb2RlX2hkaXNwbGF5OworCURSTV9ERUJVR19LTVMo
Ik1heCBzbWFsbCBqb2luZXIgYnBwOiAldVxuIiwgbWF4X2JwcF9zbWFsbF9qb2luZXJfcmFtKTsK
KworCS8qCisJICogR3JlYXRlc3QgYWxsb3dlZCBEU0MgQlBQID0gTUlOIChvdXRwdXQgQlBQIGZy
b20gYXZhaWxhYmxlIExpbmsgQlcKKwkgKiBjaGVjaywgb3V0cHV0IGJwcCBmcm9tIHNtYWxsIGpv
aW5lciBSQU0gY2hlY2spCisJICovCisJYml0c19wZXJfcGl4ZWwgPSBtaW4oYml0c19wZXJfcGl4
ZWwsIG1heF9icHBfc21hbGxfam9pbmVyX3JhbSk7CisKKwkvKiBFcnJvciBvdXQgaWYgdGhlIG1h
eCBicHAgaXMgbGVzcyB0aGFuIHNtYWxsZXN0IGFsbG93ZWQgdmFsaWQgYnBwICovCisJaWYgKGJp
dHNfcGVyX3BpeGVsIDwgdmFsaWRfZHNjX2JwcFswXSkgeworCQlEUk1fREVCVUdfS01TKCJVbnN1
cHBvcnRlZCBCUFAgJXUsIG1pbiAldVxuIiwKKwkJCSAgICAgIGJpdHNfcGVyX3BpeGVsLCB2YWxp
ZF9kc2NfYnBwWzBdKTsKKwkJcmV0dXJuIDA7CisJfQorCisJLyogRmluZCB0aGUgbmVhcmVzdCBt
YXRjaCBpbiB0aGUgYXJyYXkgb2Yga25vd24gQlBQcyBmcm9tIFZFU0EgKi8KKwlmb3IgKGkgPSAw
OyBpIDwgQVJSQVlfU0laRSh2YWxpZF9kc2NfYnBwKSAtIDE7IGkrKykgeworCQlpZiAoYml0c19w
ZXJfcGl4ZWwgPCB2YWxpZF9kc2NfYnBwW2kgKyAxXSkKKwkJCWJyZWFrOworCX0KKwliaXRzX3Bl
cl9waXhlbCA9IHZhbGlkX2RzY19icHBbaV07CisKKwkvKgorCSAqIENvbXByZXNzZWQgQlBQIGlu
IFU2LjQgZm9ybWF0IHNvIG11bHRpcGx5IGJ5IDE2LCBmb3IgR2VuIDExLAorCSAqIGZyYWN0aW9u
YWwgcGFydCBpcyAwCisJICovCisJcmV0dXJuIGJpdHNfcGVyX3BpeGVsIDw8IDQ7Cit9CisKK3N0
YXRpYyB1OCBpbnRlbF9kcF9kc2NfZ2V0X3NsaWNlX2NvdW50KHN0cnVjdCBpbnRlbF9kcCAqaW50
ZWxfZHAsCisJCQkJICAgICAgIGludCBtb2RlX2Nsb2NrLCBpbnQgbW9kZV9oZGlzcGxheSkKK3sK
Kwl1OCBtaW5fc2xpY2VfY291bnQsIGk7CisJaW50IG1heF9zbGljZV93aWR0aDsKKworCWlmICht
b2RlX2Nsb2NrIDw9IERQX0RTQ19QRUFLX1BJWEVMX1JBVEUpCisJCW1pbl9zbGljZV9jb3VudCA9
IERJVl9ST1VORF9VUChtb2RlX2Nsb2NrLAorCQkJCQkgICAgICAgRFBfRFNDX01BWF9FTkNfVEhS
T1VHSFBVVF8wKTsKKwllbHNlCisJCW1pbl9zbGljZV9jb3VudCA9IERJVl9ST1VORF9VUChtb2Rl
X2Nsb2NrLAorCQkJCQkgICAgICAgRFBfRFNDX01BWF9FTkNfVEhST1VHSFBVVF8xKTsKKworCW1h
eF9zbGljZV93aWR0aCA9IGRybV9kcF9kc2Nfc2lua19tYXhfc2xpY2Vfd2lkdGgoaW50ZWxfZHAt
PmRzY19kcGNkKTsKKwlpZiAobWF4X3NsaWNlX3dpZHRoIDwgRFBfRFNDX01JTl9TTElDRV9XSURU
SF9WQUxVRSkgeworCQlEUk1fREVCVUdfS01TKCJVbnN1cHBvcnRlZCBzbGljZSB3aWR0aCAlZCBi
eSBEUCBEU0MgU2luayBkZXZpY2VcbiIsCisJCQkgICAgICBtYXhfc2xpY2Vfd2lkdGgpOworCQly
ZXR1cm4gMDsKKwl9CisJLyogQWxzbyB0YWtlIGludG8gYWNjb3VudCBtYXggc2xpY2Ugd2lkdGgg
Ki8KKwltaW5fc2xpY2VfY291bnQgPSBtaW5fdCh1OCwgbWluX3NsaWNlX2NvdW50LAorCQkJCURJ
Vl9ST1VORF9VUChtb2RlX2hkaXNwbGF5LAorCQkJCQkgICAgIG1heF9zbGljZV93aWR0aCkpOwor
CisJLyogRmluZCB0aGUgY2xvc2VzdCBtYXRjaCB0byB0aGUgdmFsaWQgc2xpY2UgY291bnQgdmFs
dWVzICovCisJZm9yIChpID0gMDsgaSA8IEFSUkFZX1NJWkUodmFsaWRfZHNjX3NsaWNlY291bnQp
OyBpKyspIHsKKwkJaWYgKHZhbGlkX2RzY19zbGljZWNvdW50W2ldID4KKwkJICAgIGRybV9kcF9k
c2Nfc2lua19tYXhfc2xpY2VfY291bnQoaW50ZWxfZHAtPmRzY19kcGNkLAorCQkJCQkJICAgIGZh
bHNlKSkKKwkJCWJyZWFrOworCQlpZiAobWluX3NsaWNlX2NvdW50ICA8PSB2YWxpZF9kc2Nfc2xp
Y2Vjb3VudFtpXSkKKwkJCXJldHVybiB2YWxpZF9kc2Nfc2xpY2Vjb3VudFtpXTsKKwl9CisKKwlE
Uk1fREVCVUdfS01TKCJVbnN1cHBvcnRlZCBTbGljZSBDb3VudCAlZFxuIiwgbWluX3NsaWNlX2Nv
dW50KTsKKwlyZXR1cm4gMDsKK30KKwogc3RhdGljIGVudW0gZHJtX21vZGVfc3RhdHVzCiBpbnRl
bF9kcF9tb2RlX3ZhbGlkKHN0cnVjdCBkcm1fY29ubmVjdG9yICpjb25uZWN0b3IsCiAJCSAgICBz
dHJ1Y3QgZHJtX2Rpc3BsYXlfbW9kZSAqbW9kZSkKQEAgLTIyNTksNyArMjM1MCw3IEBAIGludGVs
X2RwX2NvbXB1dGVfY29uZmlnKHN0cnVjdCBpbnRlbF9lbmNvZGVyICplbmNvZGVyLAogCQkJICAg
ICAgIGFkanVzdGVkX21vZGUtPmNydGNfY2xvY2ssCiAJCQkgICAgICAgcGlwZV9jb25maWctPnBv
cnRfY2xvY2ssCiAJCQkgICAgICAgJnBpcGVfY29uZmlnLT5kcF9tX24sCi0JCQkgICAgICAgY29u
c3RhbnRfbik7CisJCQkgICAgICAgY29uc3RhbnRfbiwgcGlwZV9jb25maWctPmZlY19lbmFibGUp
OwogCiAJaWYgKGludGVsX2Nvbm5lY3Rvci0+cGFuZWwuZG93bmNsb2NrX21vZGUgIT0gTlVMTCAm
JgogCQlkZXZfcHJpdi0+ZHJycy50eXBlID09IFNFQU1MRVNTX0RSUlNfU1VQUE9SVCkgewpAQCAt
MjI2OSw3ICsyMzYwLDcgQEAgaW50ZWxfZHBfY29tcHV0ZV9jb25maWcoc3RydWN0IGludGVsX2Vu
Y29kZXIgKmVuY29kZXIsCiAJCQkJCSAgICAgICBpbnRlbF9jb25uZWN0b3ItPnBhbmVsLmRvd25j
bG9ja19tb2RlLT5jbG9jaywKIAkJCQkJICAgICAgIHBpcGVfY29uZmlnLT5wb3J0X2Nsb2NrLAog
CQkJCQkgICAgICAgJnBpcGVfY29uZmlnLT5kcF9tMl9uMiwKLQkJCQkJICAgICAgIGNvbnN0YW50
X24pOworCQkJCQkgICAgICAgY29uc3RhbnRfbiwgcGlwZV9jb25maWctPmZlY19lbmFibGUpOwog
CX0KIAogCWlmICghSEFTX0RESShkZXZfcHJpdikpCkBAIC00MzczLDkxICs0NDY0LDYgQEAgaW50
ZWxfZHBfZ2V0X3NpbmtfaXJxX2VzaShzdHJ1Y3QgaW50ZWxfZHAgKmludGVsX2RwLCB1OCAqc2lu
a19pcnFfdmVjdG9yKQogCQlEUF9EUFJYX0VTSV9MRU47CiB9CiAKLXUxNiBpbnRlbF9kcF9kc2Nf
Z2V0X291dHB1dF9icHAoaW50IGxpbmtfY2xvY2ssIHU4IGxhbmVfY291bnQsCi0JCQkJaW50IG1v
ZGVfY2xvY2ssIGludCBtb2RlX2hkaXNwbGF5KQotewotCXUxNiBiaXRzX3Blcl9waXhlbCwgbWF4
X2JwcF9zbWFsbF9qb2luZXJfcmFtOwotCWludCBpOwotCi0JLyoKLQkgKiBBdmFpbGFibGUgTGlu
ayBCYW5kd2lkdGgoS2JpdHMvc2VjKSA9IChOdW1iZXJPZkxhbmVzKSoKLQkgKiAoTGlua1N5bWJv
bENsb2NrKSogOCAqICgoMTAwLUZFQ092ZXJoZWFkKS8xMDApKihUaW1lU2xvdHNQZXJNVFApCi0J
ICogRkVDT3ZlcmhlYWQgPSAyLjQlLCBmb3IgU1NUIC0+IFRpbWVTbG90c1Blck1UUCBpcyAxLAot
CSAqIGZvciBNU1QgLT4gVGltZVNsb3RzUGVyTVRQIGhhcyB0byBiZSBjYWxjdWxhdGVkCi0JICov
Ci0JYml0c19wZXJfcGl4ZWwgPSAobGlua19jbG9jayAqIGxhbmVfY291bnQgKiA4ICoKLQkJCSAg
RFBfRFNDX0ZFQ19PVkVSSEVBRF9GQUNUT1IpIC8KLQkJbW9kZV9jbG9jazsKLQotCS8qIFNtYWxs
IEpvaW5lciBDaGVjazogb3V0cHV0IGJwcCA8PSBqb2luZXIgUkFNIChiaXRzKSAvIEhvcml6LiB3
aWR0aCAqLwotCW1heF9icHBfc21hbGxfam9pbmVyX3JhbSA9IERQX0RTQ19NQVhfU01BTExfSk9J
TkVSX1JBTV9CVUZGRVIgLwotCQltb2RlX2hkaXNwbGF5OwotCi0JLyoKLQkgKiBHcmVhdGVzdCBh
bGxvd2VkIERTQyBCUFAgPSBNSU4gKG91dHB1dCBCUFAgZnJvbSBhdmFpYWxibGUgTGluayBCVwot
CSAqIGNoZWNrLCBvdXRwdXQgYnBwIGZyb20gc21hbGwgam9pbmVyIFJBTSBjaGVjaykKLQkgKi8K
LQliaXRzX3Blcl9waXhlbCA9IG1pbihiaXRzX3Blcl9waXhlbCwgbWF4X2JwcF9zbWFsbF9qb2lu
ZXJfcmFtKTsKLQotCS8qIEVycm9yIG91dCBpZiB0aGUgbWF4IGJwcCBpcyBsZXNzIHRoYW4gc21h
bGxlc3QgYWxsb3dlZCB2YWxpZCBicHAgKi8KLQlpZiAoYml0c19wZXJfcGl4ZWwgPCB2YWxpZF9k
c2NfYnBwWzBdKSB7Ci0JCURSTV9ERUJVR19LTVMoIlVuc3VwcG9ydGVkIEJQUCAlZFxuIiwgYml0
c19wZXJfcGl4ZWwpOwotCQlyZXR1cm4gMDsKLQl9Ci0KLQkvKiBGaW5kIHRoZSBuZWFyZXN0IG1h
dGNoIGluIHRoZSBhcnJheSBvZiBrbm93biBCUFBzIGZyb20gVkVTQSAqLwotCWZvciAoaSA9IDA7
IGkgPCBBUlJBWV9TSVpFKHZhbGlkX2RzY19icHApIC0gMTsgaSsrKSB7Ci0JCWlmIChiaXRzX3Bl
cl9waXhlbCA8IHZhbGlkX2RzY19icHBbaSArIDFdKQotCQkJYnJlYWs7Ci0JfQotCWJpdHNfcGVy
X3BpeGVsID0gdmFsaWRfZHNjX2JwcFtpXTsKLQotCS8qCi0JICogQ29tcHJlc3NlZCBCUFAgaW4g
VTYuNCBmb3JtYXQgc28gbXVsdGlwbHkgYnkgMTYsIGZvciBHZW4gMTEsCi0JICogZnJhY3Rpb25h
bCBwYXJ0IGlzIDAKLQkgKi8KLQlyZXR1cm4gYml0c19wZXJfcGl4ZWwgPDwgNDsKLX0KLQotdTgg
aW50ZWxfZHBfZHNjX2dldF9zbGljZV9jb3VudChzdHJ1Y3QgaW50ZWxfZHAgKmludGVsX2RwLAot
CQkJCWludCBtb2RlX2Nsb2NrLAotCQkJCWludCBtb2RlX2hkaXNwbGF5KQotewotCXU4IG1pbl9z
bGljZV9jb3VudCwgaTsKLQlpbnQgbWF4X3NsaWNlX3dpZHRoOwotCi0JaWYgKG1vZGVfY2xvY2sg
PD0gRFBfRFNDX1BFQUtfUElYRUxfUkFURSkKLQkJbWluX3NsaWNlX2NvdW50ID0gRElWX1JPVU5E
X1VQKG1vZGVfY2xvY2ssCi0JCQkJCSAgICAgICBEUF9EU0NfTUFYX0VOQ19USFJPVUdIUFVUXzAp
OwotCWVsc2UKLQkJbWluX3NsaWNlX2NvdW50ID0gRElWX1JPVU5EX1VQKG1vZGVfY2xvY2ssCi0J
CQkJCSAgICAgICBEUF9EU0NfTUFYX0VOQ19USFJPVUdIUFVUXzEpOwotCi0JbWF4X3NsaWNlX3dp
ZHRoID0gZHJtX2RwX2RzY19zaW5rX21heF9zbGljZV93aWR0aChpbnRlbF9kcC0+ZHNjX2RwY2Qp
OwotCWlmIChtYXhfc2xpY2Vfd2lkdGggPCBEUF9EU0NfTUlOX1NMSUNFX1dJRFRIX1ZBTFVFKSB7
Ci0JCURSTV9ERUJVR19LTVMoIlVuc3VwcG9ydGVkIHNsaWNlIHdpZHRoICVkIGJ5IERQIERTQyBT
aW5rIGRldmljZVxuIiwKLQkJCSAgICAgIG1heF9zbGljZV93aWR0aCk7Ci0JCXJldHVybiAwOwot
CX0KLQkvKiBBbHNvIHRha2UgaW50byBhY2NvdW50IG1heCBzbGljZSB3aWR0aCAqLwotCW1pbl9z
bGljZV9jb3VudCA9IG1pbl90KHU4LCBtaW5fc2xpY2VfY291bnQsCi0JCQkJRElWX1JPVU5EX1VQ
KG1vZGVfaGRpc3BsYXksCi0JCQkJCSAgICAgbWF4X3NsaWNlX3dpZHRoKSk7Ci0KLQkvKiBGaW5k
IHRoZSBjbG9zZXN0IG1hdGNoIHRvIHRoZSB2YWxpZCBzbGljZSBjb3VudCB2YWx1ZXMgKi8KLQlm
b3IgKGkgPSAwOyBpIDwgQVJSQVlfU0laRSh2YWxpZF9kc2Nfc2xpY2Vjb3VudCk7IGkrKykgewot
CQlpZiAodmFsaWRfZHNjX3NsaWNlY291bnRbaV0gPgotCQkgICAgZHJtX2RwX2RzY19zaW5rX21h
eF9zbGljZV9jb3VudChpbnRlbF9kcC0+ZHNjX2RwY2QsCi0JCQkJCQkgICAgZmFsc2UpKQotCQkJ
YnJlYWs7Ci0JCWlmIChtaW5fc2xpY2VfY291bnQgIDw9IHZhbGlkX2RzY19zbGljZWNvdW50W2ld
KQotCQkJcmV0dXJuIHZhbGlkX2RzY19zbGljZWNvdW50W2ldOwotCX0KLQotCURSTV9ERUJVR19L
TVMoIlVuc3VwcG9ydGVkIFNsaWNlIENvdW50ICVkXG4iLCBtaW5fc2xpY2VfY291bnQpOwotCXJl
dHVybiAwOwotfQotCiBzdGF0aWMgdm9pZAogaW50ZWxfcGl4ZWxfZW5jb2Rpbmdfc2V0dXBfdnNj
KHN0cnVjdCBpbnRlbF9kcCAqaW50ZWxfZHAsCiAJCQkgICAgICAgY29uc3Qgc3RydWN0IGludGVs
X2NydGNfc3RhdGUgKmNydGNfc3RhdGUpCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkx
NS9kaXNwbGF5L2ludGVsX2RwLmggYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVs
X2RwLmgKaW5kZXggZTAxZDFmODk0MDlkLi5hMTk0YjViNmRhMDUgMTAwNjQ0Ci0tLSBhL2RyaXZl
cnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZHAuaAorKysgYi9kcml2ZXJzL2dwdS9kcm0v
aTkxNS9kaXNwbGF5L2ludGVsX2RwLmgKQEAgLTEwMywxMCArMTAzLDYgQEAgYm9vbCBpbnRlbF9k
cF9zb3VyY2Vfc3VwcG9ydHNfaGJyMihzdHJ1Y3QgaW50ZWxfZHAgKmludGVsX2RwKTsKIGJvb2wg
aW50ZWxfZHBfc291cmNlX3N1cHBvcnRzX2hicjMoc3RydWN0IGludGVsX2RwICppbnRlbF9kcCk7
CiBib29sCiBpbnRlbF9kcF9nZXRfbGlua19zdGF0dXMoc3RydWN0IGludGVsX2RwICppbnRlbF9k
cCwgdTggKmxpbmtfc3RhdHVzKTsKLXUxNiBpbnRlbF9kcF9kc2NfZ2V0X291dHB1dF9icHAoaW50
IGxpbmtfY2xvY2ssIHU4IGxhbmVfY291bnQsCi0JCQkJaW50IG1vZGVfY2xvY2ssIGludCBtb2Rl
X2hkaXNwbGF5KTsKLXU4IGludGVsX2RwX2RzY19nZXRfc2xpY2VfY291bnQoc3RydWN0IGludGVs
X2RwICppbnRlbF9kcCwgaW50IG1vZGVfY2xvY2ssCi0JCQkJaW50IG1vZGVfaGRpc3BsYXkpOwog
CiBib29sIGludGVsX2RwX3JlYWRfZHBjZChzdHJ1Y3QgaW50ZWxfZHAgKmludGVsX2RwKTsKIGJv
b2wgaW50ZWxfZHBfZ2V0X2NvbG9yaW1ldHJ5X3N0YXR1cyhzdHJ1Y3QgaW50ZWxfZHAgKmludGVs
X2RwKTsKQEAgLTExOSw0ICsxMTUsNiBAQCBzdGF0aWMgaW5saW5lIHVuc2lnbmVkIGludCBpbnRl
bF9kcF91bnVzZWRfbGFuZV9tYXNrKGludCBsYW5lX2NvdW50KQogCXJldHVybiB+KCgxIDw8IGxh
bmVfY291bnQpIC0gMSkgJiAweGY7CiB9CiAKK3UzMiBpbnRlbF9kcF9tb2RlX3RvX2ZlY19jbG9j
ayh1MzIgbW9kZV9jbG9jayk7CisKICNlbmRpZiAvKiBfX0lOVEVMX0RQX0hfXyAqLwpkaWZmIC0t
Z2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kcF9tc3QuYyBiL2RyaXZl
cnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZHBfbXN0LmMKaW5kZXggZWVlYjNmOTMzYWE0
Li5jZjRkODUxYTUxMzkgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkv
aW50ZWxfZHBfbXN0LmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9k
cF9tc3QuYwpAQCAtODEsNyArODEsNyBAQCBzdGF0aWMgaW50IGludGVsX2RwX21zdF9jb21wdXRl
X2xpbmtfY29uZmlnKHN0cnVjdCBpbnRlbF9lbmNvZGVyICplbmNvZGVyLAogCQkJICAgICAgIGFk
anVzdGVkX21vZGUtPmNydGNfY2xvY2ssCiAJCQkgICAgICAgY3J0Y19zdGF0ZS0+cG9ydF9jbG9j
aywKIAkJCSAgICAgICAmY3J0Y19zdGF0ZS0+ZHBfbV9uLAotCQkJICAgICAgIGNvbnN0YW50X24p
OworCQkJICAgICAgIGNvbnN0YW50X24sIGNydGNfc3RhdGUtPmZlY19lbmFibGUpOwogCWNydGNf
c3RhdGUtPmRwX21fbi50dSA9IHNsb3RzOwogCiAJcmV0dXJuIDA7Ci0tIAoyLjIwLjEKCl9fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fCkludGVsLWdmeCBtYWls
aW5nIGxpc3QKSW50ZWwtZ2Z4QGxpc3RzLmZyZWVkZXNrdG9wLm9yZwpodHRwczovL2xpc3RzLmZy
ZWVkZXNrdG9wLm9yZy9tYWlsbWFuL2xpc3RpbmZvL2ludGVsLWdmeA==

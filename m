Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id DAFFB4B707
	for <lists+intel-gfx@lfdr.de>; Wed, 19 Jun 2019 13:25:29 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id EBD616E379;
	Wed, 19 Jun 2019 11:25:27 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from fireflyinternet.com (mail.fireflyinternet.com [109.228.58.192])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 776C66E375
 for <intel-gfx@lists.freedesktop.org>; Wed, 19 Jun 2019 11:25:24 +0000 (UTC)
X-Default-Received-SPF: pass (skip=forwardok (res=PASS))
 x-ip-name=78.156.65.138; 
Received: from haswell.alporthouse.com (unverified [78.156.65.138]) 
 by fireflyinternet.com (Firefly Internet (M1)) with ESMTP id 16951951-1500050 
 for multiple; Wed, 19 Jun 2019 12:23:40 +0100
From: Chris Wilson <chris@chris-wilson.co.uk>
To: intel-gfx@lists.freedesktop.org
Date: Wed, 19 Jun 2019 12:23:39 +0100
Message-Id: <20190619112341.9082-5-chris@chris-wilson.co.uk>
X-Mailer: git-send-email 2.20.1
In-Reply-To: <20190619112341.9082-1-chris@chris-wilson.co.uk>
References: <20190619112341.9082-1-chris@chris-wilson.co.uk>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH 5/7] drm/i915: Throw away the active object
 retirement complexity
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Cc: matthew.auld@intel.com
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

UmVtb3ZlIHRoZSBhY2N1bXVsYXRlZCBvcHRpbWlzYXRpb25zIHRoYXQgd2UgaGF2ZSBmb3IgaTkx
NV92bWFfcmV0aXJlCmFuZCByZWR1Y2UgaXQgdG8gdGhlIGJhcmUgZXNzZW50aWFsIG9mIHRyYWNr
aW5nIHRoZSBhY3RpdmUgb2JqZWN0CnJlZmVyZW5jZS4gVGhpcyBhbGxvd3MgdXMgdG8gb25seSB1
c2UgYXRvbWljIG9wZXJhdGlvbnMsIGFuZCBzbyB3aWxsIGJlCmFibGUgdG8gYXZvaWQgdGhlIHN0
cnVjdF9tdXRleCByZXF1aXJlbWVudC4KClRoZSBwcmluY2lwYWwgbG9zcyBoZXJlIGlzIHRoZSBz
aHJpbmtlciBNUlUgYnVtcGluZywgc28gbm93IGlmIHdlIGhhdmUKdG8gc2hyaW5rLCB3ZSB3aWxs
IGRvIHNvIGluIG11Y2ggbW9yZSByYW5kb20gb3JkZXIgYW5kIG1vcmUgbGlrZWx5IHRvCnRyeSBh
bmQgc2hyaW5rIHJlY2VudGx5IHVzZWQgb2JqZWN0cy4gVGhhdCBpcyBhIG51aXNhbmNlLCBidXQg
c2hyaW5raW5nCmFjdGl2ZSBvYmplY3RzIGlzIGEgc2Vjb25kIHN0ZXAgd2UgdHJ5IHRvIGF2b2lk
IGFuZCB3aWxsIGFsd2F5cyBiZSBhCnN5c3RlbS13aWRlIHBlcmZvcm1hbmNlIGlzc3VlLgoKVGhl
IG90aGVyIGxvc3MgaXMgaGVyZSBpcyBpbiB0aGUgYXV0b21hdGljIHBydW5pbmcgb2YgdGhlCnJl
c2VydmF0aW9uX29iamVjdCB3aGVuIGlkbGluZy4gVGhpcyBpcyBub3QgYXMgbGFyZ2UgYW4gaXNz
dWUgYXMgdXBvbgpyZXNlcnZhdGlvbl9vYmplY3QgaW50cm9kdWN0aW9uIGFzIG5vdyBhZGRpbmcg
bmV3IGZlbmNlcyBpbnRvIHRoZSBvYmplY3QKcmVwbGFjZXMgYWxyZWFkeSBzaWduYWxlZCBmZW5j
ZXMsIGtlZXBpbmcgdGhlIGFycmF5IGNvbXBhY3QuIEJ1dCB3ZSBkbwpsb3NlIHRoZSBhdXRvLWV4
cGlyYXRpb24gb2Ygc3RhbGUgZmVuY2VzIGFuZCB1bnVzZWQgYXJyYXlzLiBUaGF0IG1heSBiZQph
IG5vdGljZWFibGUgcHJvYmxlbSBmb3Igd2hpY2ggd2UgbmVlZCB0byByZS1pbXBsZW1lbnQgYXV0
b3BydW5pbmcuCgpTaWduZWQtb2ZmLWJ5OiBDaHJpcyBXaWxzb24gPGNocmlzQGNocmlzLXdpbHNv
bi5jby51az4KUmV2aWV3ZWQtYnk6IE1hdHRoZXcgQXVsZCA8bWF0dGhldy5hdWxkQGludGVsLmNv
bT4KLS0tCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fb2JqZWN0LmMgICAgfCAg
MSAtCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fb2JqZWN0LmggICAgfCAgNiAt
LS0KIC4uLi9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX29iamVjdF90eXBlcy5oICB8ICAxIC0K
IGRyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9zaHJpbmtlci5jICB8ICA1ICstCiAu
Li4vZHJtL2k5MTUvZ2VtL3NlbGZ0ZXN0cy9pOTE1X2dlbV9tbWFuLmMgICAgfCAgOSAtLS0tCiBk
cml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9scmMuYyAgICAgICAgICAgfCAgNCArLQogZHJp
dmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfcmluZ2J1ZmZlci5jICAgIHwgIDEgLQogZHJpdmVy
cy9ncHUvZHJtL2k5MTUvZ3Qvc2VsZnRlc3RfaGFuZ2NoZWNrLmMgIHwgMzIgKysrKystLS0tLS0K
IGRyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZGVidWdmcy5jICAgICAgICAgICB8ICA4ICstLQog
ZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9nZW1fYmF0Y2hfcG9vbC5jICAgIHwgNDIgKysrKysr
LS0tLS0tLS0tCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3ZtYS5jICAgICAgICAgICAgICAg
fCA1NCArKysrLS0tLS0tLS0tLS0tLS0tCiAxMSBmaWxlcyBjaGFuZ2VkLCA0NyBpbnNlcnRpb25z
KCspLCAxMTYgZGVsZXRpb25zKC0pCgpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUv
Z2VtL2k5MTVfZ2VtX29iamVjdC5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2Vt
X29iamVjdC5jCmluZGV4IGJlNmNhY2NjZTBjNS4uMDVhZWFkMzM4MTEyIDEwMDY0NAotLS0gYS9k
cml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fb2JqZWN0LmMKKysrIGIvZHJpdmVycy9n
cHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX29iamVjdC5jCkBAIC0xNjAsNyArMTYwLDYgQEAgc3Rh
dGljIHZvaWQgX19pOTE1X2dlbV9mcmVlX29iamVjdHMoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUg
Kmk5MTUsCiAKIAkJbXV0ZXhfbG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CiAKLQkJR0VN
X0JVR19PTihpOTE1X2dlbV9vYmplY3RfaXNfYWN0aXZlKG9iaikpOwogCQlsaXN0X2Zvcl9lYWNo
X2VudHJ5X3NhZmUodm1hLCB2biwgJm9iai0+dm1hLmxpc3QsIG9ial9saW5rKSB7CiAJCQlHRU1f
QlVHX09OKGk5MTVfdm1hX2lzX2FjdGl2ZSh2bWEpKTsKIAkJCXZtYS0+ZmxhZ3MgJj0gfkk5MTVf
Vk1BX1BJTl9NQVNLOwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVf
Z2VtX29iamVjdC5oIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX29iamVjdC5o
CmluZGV4IGRmZWJkNTcwNmYxNi4uMjA3NTRjMTU0MTJhIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dw
dS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fb2JqZWN0LmgKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5
MTUvZ2VtL2k5MTVfZ2VtX29iamVjdC5oCkBAIC0xNTgsMTIgKzE1OCw2IEBAIGk5MTVfZ2VtX29i
amVjdF9uZWVkc19hc3luY19jYW5jZWwoY29uc3Qgc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3Qg
Km9iaikKIAlyZXR1cm4gb2JqLT5vcHMtPmZsYWdzICYgSTkxNV9HRU1fT0JKRUNUX0FTWU5DX0NB
TkNFTDsKIH0KIAotc3RhdGljIGlubGluZSBib29sCi1pOTE1X2dlbV9vYmplY3RfaXNfYWN0aXZl
KGNvbnN0IHN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmopCi17Ci0JcmV0dXJuIFJFQURf
T05DRShvYmotPmFjdGl2ZV9jb3VudCk7Ci19Ci0KIHN0YXRpYyBpbmxpbmUgYm9vbAogaTkxNV9n
ZW1fb2JqZWN0X2lzX2ZyYW1lYnVmZmVyKGNvbnN0IHN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0
ICpvYmopCiB7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1f
b2JqZWN0X3R5cGVzLmggYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fb2JqZWN0
X3R5cGVzLmgKaW5kZXggMThiZjRmOGQ2ZDgwLi4zNGI1MWZhZDAyZGUgMTAwNjQ0Ci0tLSBhL2Ry
aXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9vYmplY3RfdHlwZXMuaAorKysgYi9kcml2
ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fb2JqZWN0X3R5cGVzLmgKQEAgLTE1NCw3ICsx
NTQsNiBAQCBzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCB7CiAKIAkvKiogQ291bnQgb2YgVk1B
IGFjdHVhbGx5IGJvdW5kIGJ5IHRoaXMgb2JqZWN0ICovCiAJYXRvbWljX3QgYmluZF9jb3VudDsK
LQl1bnNpZ25lZCBpbnQgYWN0aXZlX2NvdW50OwogCS8qKiBDb3VudCBvZiBob3cgbWFueSBnbG9i
YWwgVk1BIGFyZSBjdXJyZW50bHkgcGlubmVkIGZvciB1c2UgYnkgSFcgKi8KIAl1bnNpZ25lZCBp
bnQgcGluX2dsb2JhbDsKIApkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5
MTVfZ2VtX3Nocmlua2VyLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fc2hy
aW5rZXIuYwppbmRleCAxYmJjNjkwNDk0YzcuLmQ5OWYxYTYwMGI5NiAxMDA2NDQKLS0tIGEvZHJp
dmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX3Nocmlua2VyLmMKKysrIGIvZHJpdmVycy9n
cHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX3Nocmlua2VyLmMKQEAgLTIyOSw4ICsyMjksOSBAQCBp
OTE1X2dlbV9zaHJpbmsoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUsCiAJCQkJY29udGlu
dWU7CiAKIAkJCWlmICghKHNocmluayAmIEk5MTVfU0hSSU5LX0FDVElWRSkgJiYKLQkJCSAgICAo
aTkxNV9nZW1fb2JqZWN0X2lzX2FjdGl2ZShvYmopIHx8Ci0JCQkgICAgIGk5MTVfZ2VtX29iamVj
dF9pc19mcmFtZWJ1ZmZlcihvYmopKSkKKwkJCSAgICAoaTkxNV9nZW1fb2JqZWN0X2lzX2ZyYW1l
YnVmZmVyKG9iaikgfHwKKwkJCSAgICAgIXJlc2VydmF0aW9uX29iamVjdF90ZXN0X3NpZ25hbGVk
X3JjdShvYmotPmJhc2UucmVzdiwKKwkJCQkJCQkJICAgdHJ1ZSkpKQogCQkJCWNvbnRpbnVlOwog
CiAJCQlpZiAoIShzaHJpbmsgJiBJOTE1X1NIUklOS19CT1VORCkgJiYKZGlmZiAtLWdpdCBhL2Ry
aXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9zZWxmdGVzdHMvaTkxNV9nZW1fbW1hbi5jIGIvZHJpdmVy
cy9ncHUvZHJtL2k5MTUvZ2VtL3NlbGZ0ZXN0cy9pOTE1X2dlbV9tbWFuLmMKaW5kZXggNWM4MWY0
YjQ4MTNhLi4yMDUzMTk0YThiNzAgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dl
bS9zZWxmdGVzdHMvaTkxNV9nZW1fbW1hbi5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dl
bS9zZWxmdGVzdHMvaTkxNV9nZW1fbW1hbi5jCkBAIC00NzQsMTUgKzQ3NCw2IEBAIHN0YXRpYyBp
bnQgaWd0X21tYXBfb2Zmc2V0X2V4aGF1c3Rpb24odm9pZCAqYXJnKQogCQkJcHJfZXJyKCJbbG9v
cCAlZF0gRmFpbGVkIHRvIGJ1c3kgdGhlIG9iamVjdFxuIiwgbG9vcCk7CiAJCQlnb3RvIGVycl9v
Ymo7CiAJCX0KLQotCQkvKiBOQiB3ZSByZWx5IG9uIHRoZSBfYWN0aXZlXyByZWZlcmVuY2UgdG8g
YWNjZXNzIG9iaiBub3cgKi8KLQkJR0VNX0JVR19PTighaTkxNV9nZW1fb2JqZWN0X2lzX2FjdGl2
ZShvYmopKTsKLQkJZXJyID0gY3JlYXRlX21tYXBfb2Zmc2V0KG9iaik7Ci0JCWlmIChlcnIpIHsK
LQkJCXByX2VycigiW2xvb3AgJWRdIGNyZWF0ZV9tbWFwX29mZnNldCBmYWlsZWQgd2l0aCBlcnI9
JWRcbiIsCi0JCQkgICAgICAgbG9vcCwgZXJyKTsKLQkJCWdvdG8gb3V0OwotCQl9CiAJfQogCiBv
dXQ6CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9scmMuYyBiL2Ry
aXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2xyYy5jCmluZGV4IGRmNThkMWQ4MzhmNy4uZTJm
OTc4Y2JjYTBjIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9scmMu
YworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9scmMuYwpAQCAtMTQwNCw5ICsx
NDA0LDcgQEAgc3RhdGljIHZvaWQgZXhlY2xpc3RzX3N1Ym1pdF9yZXF1ZXN0KHN0cnVjdCBpOTE1
X3JlcXVlc3QgKnJlcXVlc3QpCiBzdGF0aWMgdm9pZCBfX2V4ZWNsaXN0c19jb250ZXh0X2Zpbmko
c3RydWN0IGludGVsX2NvbnRleHQgKmNlKQogewogCWludGVsX3JpbmdfcHV0KGNlLT5yaW5nKTsK
LQotCUdFTV9CVUdfT04oaTkxNV9nZW1fb2JqZWN0X2lzX2FjdGl2ZShjZS0+c3RhdGUtPm9iaikp
OwotCWk5MTVfZ2VtX29iamVjdF9wdXQoY2UtPnN0YXRlLT5vYmopOworCWk5MTVfdm1hX3B1dChj
ZS0+c3RhdGUpOwogfQogCiBzdGF0aWMgdm9pZCBleGVjbGlzdHNfY29udGV4dF9kZXN0cm95KHN0
cnVjdCBrcmVmICprcmVmKQpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50
ZWxfcmluZ2J1ZmZlci5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfcmluZ2J1ZmZl
ci5jCmluZGV4IGJkMzVhZDIwMjQ1OS4uMWRlZTU2N2YzMGVjIDEwMDY0NAotLS0gYS9kcml2ZXJz
L2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9yaW5nYnVmZmVyLmMKKysrIGIvZHJpdmVycy9ncHUvZHJt
L2k5MTUvZ3QvaW50ZWxfcmluZ2J1ZmZlci5jCkBAIC0xMzA5LDcgKzEzMDksNiBAQCB2b2lkIGlu
dGVsX3JpbmdfZnJlZShzdHJ1Y3Qga3JlZiAqcmVmKQogCiBzdGF0aWMgdm9pZCBfX3JpbmdfY29u
dGV4dF9maW5pKHN0cnVjdCBpbnRlbF9jb250ZXh0ICpjZSkKIHsKLQlHRU1fQlVHX09OKGk5MTVf
Z2VtX29iamVjdF9pc19hY3RpdmUoY2UtPnN0YXRlLT5vYmopKTsKIAlpOTE1X2dlbV9vYmplY3Rf
cHV0KGNlLT5zdGF0ZS0+b2JqKTsKIH0KIApkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5
MTUvZ3Qvc2VsZnRlc3RfaGFuZ2NoZWNrLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9zZWxm
dGVzdF9oYW5nY2hlY2suYwppbmRleCBiMGIyOTk4ZTU2YjguLmJlMjE5MDkyMjMzNCAxMDA2NDQK
LS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qvc2VsZnRlc3RfaGFuZ2NoZWNrLmMKKysrIGIv
ZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qvc2VsZnRlc3RfaGFuZ2NoZWNrLmMKQEAgLTEyOSwzMyAr
MTI5LDI5IEBAIGhhbmdfY3JlYXRlX3JlcXVlc3Qoc3RydWN0IGhhbmcgKmgsIHN0cnVjdCBpbnRl
bF9lbmdpbmVfY3MgKmVuZ2luZSkKIHsKIAlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9
IGgtPmk5MTU7CiAJc3RydWN0IGk5MTVfYWRkcmVzc19zcGFjZSAqdm0gPSBoLT5jdHgtPnZtID86
ICZpOTE1LT5nZ3R0LnZtOworCXN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmo7CiAJc3Ry
dWN0IGk5MTVfcmVxdWVzdCAqcnEgPSBOVUxMOwogCXN0cnVjdCBpOTE1X3ZtYSAqaHdzLCAqdm1h
OwogCXVuc2lnbmVkIGludCBmbGFnczsKKwl2b2lkICp2YWRkcjsKIAl1MzIgKmJhdGNoOwogCWlu
dCBlcnI7CiAKLQlpZiAoaTkxNV9nZW1fb2JqZWN0X2lzX2FjdGl2ZShoLT5vYmopKSB7Ci0JCXN0
cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmo7Ci0JCXZvaWQgKnZhZGRyOwotCi0JCW9iaiA9
IGk5MTVfZ2VtX29iamVjdF9jcmVhdGVfaW50ZXJuYWwoaC0+aTkxNSwgUEFHRV9TSVpFKTsKLQkJ
aWYgKElTX0VSUihvYmopKQotCQkJcmV0dXJuIEVSUl9DQVNUKG9iaik7CisJb2JqID0gaTkxNV9n
ZW1fb2JqZWN0X2NyZWF0ZV9pbnRlcm5hbChoLT5pOTE1LCBQQUdFX1NJWkUpOworCWlmIChJU19F
UlIob2JqKSkKKwkJcmV0dXJuIEVSUl9DQVNUKG9iaik7CiAKLQkJdmFkZHIgPSBpOTE1X2dlbV9v
YmplY3RfcGluX21hcChvYmosCi0JCQkJCQlpOTE1X2NvaGVyZW50X21hcF90eXBlKGgtPmk5MTUp
KTsKLQkJaWYgKElTX0VSUih2YWRkcikpIHsKLQkJCWk5MTVfZ2VtX29iamVjdF9wdXQob2JqKTsK
LQkJCXJldHVybiBFUlJfQ0FTVCh2YWRkcik7Ci0JCX0KKwl2YWRkciA9IGk5MTVfZ2VtX29iamVj
dF9waW5fbWFwKG9iaiwgaTkxNV9jb2hlcmVudF9tYXBfdHlwZShoLT5pOTE1KSk7CisJaWYgKElT
X0VSUih2YWRkcikpIHsKKwkJaTkxNV9nZW1fb2JqZWN0X3B1dChvYmopOworCQlyZXR1cm4gRVJS
X0NBU1QodmFkZHIpOworCX0KIAotCQlpOTE1X2dlbV9vYmplY3RfdW5waW5fbWFwKGgtPm9iaik7
Ci0JCWk5MTVfZ2VtX29iamVjdF9wdXQoaC0+b2JqKTsKKwlpOTE1X2dlbV9vYmplY3RfdW5waW5f
bWFwKGgtPm9iaik7CisJaTkxNV9nZW1fb2JqZWN0X3B1dChoLT5vYmopOwogCi0JCWgtPm9iaiA9
IG9iajsKLQkJaC0+YmF0Y2ggPSB2YWRkcjsKLQl9CisJaC0+b2JqID0gb2JqOworCWgtPmJhdGNo
ID0gdmFkZHI7CiAKIAl2bWEgPSBpOTE1X3ZtYV9pbnN0YW5jZShoLT5vYmosIHZtLCBOVUxMKTsK
IAlpZiAoSVNfRVJSKHZtYSkpCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1
X2RlYnVnZnMuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZGVidWdmcy5jCmluZGV4IDYy
Y2YzNGRiOTI4MC4uZWVlY2RhZDBlM2NhIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkx
NS9pOTE1X2RlYnVnZnMuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2RlYnVnZnMu
YwpAQCAtNzUsMTEgKzc1LDYgQEAgc3RhdGljIGludCBpOTE1X2NhcGFiaWxpdGllcyhzdHJ1Y3Qg
c2VxX2ZpbGUgKm0sIHZvaWQgKmRhdGEpCiAJcmV0dXJuIDA7CiB9CiAKLXN0YXRpYyBjaGFyIGdl
dF9hY3RpdmVfZmxhZyhzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2JqKQotewotCXJldHVy
biBpOTE1X2dlbV9vYmplY3RfaXNfYWN0aXZlKG9iaikgPyAnKicgOiAnICc7Ci19Ci0KIHN0YXRp
YyBjaGFyIGdldF9waW5fZmxhZyhzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2JqKQogewog
CXJldHVybiBvYmotPnBpbl9nbG9iYWwgPyAncCcgOiAnICc7CkBAIC0xNDQsOSArMTM5LDggQEAg
ZGVzY3JpYmVfb2JqKHN0cnVjdCBzZXFfZmlsZSAqbSwgc3RydWN0IGRybV9pOTE1X2dlbV9vYmpl
Y3QgKm9iaikKIAl1bnNpZ25lZCBpbnQgZnJvbnRidWZmZXJfYml0czsKIAlpbnQgcGluX2NvdW50
ID0gMDsKIAotCXNlcV9wcmludGYobSwgIiVwSzogJWMlYyVjJWMlYyAlOHpkS2lCICUwMnggJTAy
eCAlcyVzJXMiLAorCXNlcV9wcmludGYobSwgIiVwSzogJWMlYyVjJWMgJTh6ZEtpQiAlMDJ4ICUw
MnggJXMlcyVzIiwKIAkJICAgJm9iai0+YmFzZSwKLQkJICAgZ2V0X2FjdGl2ZV9mbGFnKG9iaiks
CiAJCSAgIGdldF9waW5fZmxhZyhvYmopLAogCQkgICBnZXRfdGlsaW5nX2ZsYWcob2JqKSwKIAkJ
ICAgZ2V0X2dsb2JhbF9mbGFnKG9iaiksCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkx
NS9pOTE1X2dlbV9iYXRjaF9wb29sLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2dlbV9i
YXRjaF9wb29sLmMKaW5kZXggMjVhM2U0ZDA5YTJmLi5iMTdmMjM5OTEyNTMgMTAwNjQ0Ci0tLSBh
L2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZ2VtX2JhdGNoX3Bvb2wuYworKysgYi9kcml2ZXJz
L2dwdS9kcm0vaTkxNS9pOTE1X2dlbV9iYXRjaF9wb29sLmMKQEAgLTk0LDM0ICs5NCwyNiBAQCBp
OTE1X2dlbV9iYXRjaF9wb29sX2dldChzdHJ1Y3QgaTkxNV9nZW1fYmF0Y2hfcG9vbCAqcG9vbCwK
IAlsaXN0ID0gJnBvb2wtPmNhY2hlX2xpc3Rbbl07CiAKIAlsaXN0X2Zvcl9lYWNoX2VudHJ5KG9i
aiwgbGlzdCwgYmF0Y2hfcG9vbF9saW5rKSB7CisJCXN0cnVjdCByZXNlcnZhdGlvbl9vYmplY3Qg
KnJlc3YgPSBvYmotPmJhc2UucmVzdjsKKwogCQkvKiBUaGUgYmF0Y2hlcyBhcmUgc3RyaWN0bHkg
TFJVIG9yZGVyZWQgKi8KLQkJaWYgKGk5MTVfZ2VtX29iamVjdF9pc19hY3RpdmUob2JqKSkgewot
CQkJc3RydWN0IHJlc2VydmF0aW9uX29iamVjdCAqcmVzdiA9IG9iai0+YmFzZS5yZXN2OwotCi0J
CQlpZiAoIXJlc2VydmF0aW9uX29iamVjdF90ZXN0X3NpZ25hbGVkX3JjdShyZXN2LCB0cnVlKSkK
LQkJCQlicmVhazsKLQotCQkJaTkxNV9yZXRpcmVfcmVxdWVzdHMocG9vbC0+ZW5naW5lLT5pOTE1
KTsKLQkJCUdFTV9CVUdfT04oaTkxNV9nZW1fb2JqZWN0X2lzX2FjdGl2ZShvYmopKTsKLQotCQkJ
LyoKLQkJCSAqIFRoZSBvYmplY3QgaXMgbm93IGlkbGUsIGNsZWFyIHRoZSBhcnJheSBvZiBzaGFy
ZWQKLQkJCSAqIGZlbmNlcyBiZWZvcmUgd2UgYWRkIGEgbmV3IHJlcXVlc3QuIEFsdGhvdWdoLCB3
ZQotCQkJICogcmVtYWluIG9uIHRoZSBzYW1lIGVuZ2luZSwgd2UgbWF5IGJlIG9uIGEgZGlmZmVy
ZW50Ci0JCQkgKiB0aW1lbGluZSBhbmQgc28gbWF5IGNvbnRpbnVhbGx5IGdyb3cgdGhlIGFycmF5
LAotCQkJICogdHJhcHBpbmcgYSByZWZlcmVuY2UgdG8gYWxsIHRoZSBvbGQgZmVuY2VzLCByYXRo
ZXIKLQkJCSAqIHRoYW4gcmVwbGFjZSB0aGUgZXhpc3RpbmcgZmVuY2UuCi0JCQkgKi8KLQkJCWlm
IChyY3VfYWNjZXNzX3BvaW50ZXIocmVzdi0+ZmVuY2UpKSB7Ci0JCQkJcmVzZXJ2YXRpb25fb2Jq
ZWN0X2xvY2socmVzdiwgTlVMTCk7Ci0JCQkJcmVzZXJ2YXRpb25fb2JqZWN0X2FkZF9leGNsX2Zl
bmNlKHJlc3YsIE5VTEwpOwotCQkJCXJlc2VydmF0aW9uX29iamVjdF91bmxvY2socmVzdik7Ci0J
CQl9CisJCWlmICghcmVzZXJ2YXRpb25fb2JqZWN0X3Rlc3Rfc2lnbmFsZWRfcmN1KHJlc3YsIHRy
dWUpKQorCQkJYnJlYWs7CisKKwkJLyoKKwkJICogVGhlIG9iamVjdCBpcyBub3cgaWRsZSwgY2xl
YXIgdGhlIGFycmF5IG9mIHNoYXJlZAorCQkgKiBmZW5jZXMgYmVmb3JlIHdlIGFkZCBhIG5ldyBy
ZXF1ZXN0LiBBbHRob3VnaCwgd2UKKwkJICogcmVtYWluIG9uIHRoZSBzYW1lIGVuZ2luZSwgd2Ug
bWF5IGJlIG9uIGEgZGlmZmVyZW50CisJCSAqIHRpbWVsaW5lIGFuZCBzbyBtYXkgY29udGludWFs
bHkgZ3JvdyB0aGUgYXJyYXksCisJCSAqIHRyYXBwaW5nIGEgcmVmZXJlbmNlIHRvIGFsbCB0aGUg
b2xkIGZlbmNlcywgcmF0aGVyCisJCSAqIHRoYW4gcmVwbGFjZSB0aGUgZXhpc3RpbmcgZmVuY2Uu
CisJCSAqLworCQlpZiAocmN1X2FjY2Vzc19wb2ludGVyKHJlc3YtPmZlbmNlKSkgeworCQkJcmVz
ZXJ2YXRpb25fb2JqZWN0X2xvY2socmVzdiwgTlVMTCk7CisJCQlyZXNlcnZhdGlvbl9vYmplY3Rf
YWRkX2V4Y2xfZmVuY2UocmVzdiwgTlVMTCk7CisJCQlyZXNlcnZhdGlvbl9vYmplY3RfdW5sb2Nr
KHJlc3YpOwogCQl9CiAKLQkJR0VNX0JVR19PTighcmVzZXJ2YXRpb25fb2JqZWN0X3Rlc3Rfc2ln
bmFsZWRfcmN1KG9iai0+YmFzZS5yZXN2LAotCQkJCQkJCQkgdHJ1ZSkpOwotCiAJCWlmIChvYmot
PmJhc2Uuc2l6ZSA+PSBzaXplKQogCQkJZ290byBmb3VuZDsKIAl9CmRpZmYgLS1naXQgYS9kcml2
ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3ZtYS5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV92
bWEuYwppbmRleCBhNTc3MjliZTgzMTIuLmI2MGE2OTIzNWJhZCAxMDA2NDQKLS0tIGEvZHJpdmVy
cy9ncHUvZHJtL2k5MTUvaTkxNV92bWEuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1
X3ZtYS5jCkBAIC03Nyw0MyArNzcsMTEgQEAgc3RhdGljIHZvaWQgdm1hX3ByaW50X2FsbG9jYXRv
cihzdHJ1Y3QgaTkxNV92bWEgKnZtYSwgY29uc3QgY2hhciAqcmVhc29uKQogCiAjZW5kaWYKIAot
c3RhdGljIHZvaWQgb2JqX2J1bXBfbXJ1KHN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmop
Ci17Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSB0b19pOTE1KG9iai0+YmFzZS5k
ZXYpOwotCXVuc2lnbmVkIGxvbmcgZmxhZ3M7Ci0KLQlzcGluX2xvY2tfaXJxc2F2ZSgmaTkxNS0+
bW0ub2JqX2xvY2ssIGZsYWdzKTsKLQlsaXN0X21vdmVfdGFpbCgmb2JqLT5tbS5saW5rLCAmaTkx
NS0+bW0uc2hyaW5rX2xpc3QpOwotCXNwaW5fdW5sb2NrX2lycXJlc3RvcmUoJmk5MTUtPm1tLm9i
al9sb2NrLCBmbGFncyk7Ci0KLQlvYmotPm1tLmRpcnR5ID0gdHJ1ZTsgLyogYmUgcGFyYW5vaWQg
ICovCi19Ci0KIHN0YXRpYyB2b2lkIF9faTkxNV92bWFfcmV0aXJlKHN0cnVjdCBpOTE1X2FjdGl2
ZSAqcmVmKQogewogCXN0cnVjdCBpOTE1X3ZtYSAqdm1hID0gY29udGFpbmVyX29mKHJlZiwgdHlw
ZW9mKCp2bWEpLCBhY3RpdmUpOwotCXN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmogPSB2
bWEtPm9iajsKLQotCUdFTV9CVUdfT04oIWk5MTVfZ2VtX29iamVjdF9pc19hY3RpdmUob2JqKSk7
Ci0JaWYgKC0tb2JqLT5hY3RpdmVfY291bnQpCi0JCXJldHVybjsKLQotCS8qIFBydW5lIHRoZSBz
aGFyZWQgZmVuY2UgYXJyYXlzIGlmZiBjb21wbGV0ZWx5IGlkbGUgKGluYy4gZXh0ZXJuYWwpICov
Ci0JaWYgKHJlc2VydmF0aW9uX29iamVjdF90cnlsb2NrKG9iai0+YmFzZS5yZXN2KSkgewotCQlp
ZiAocmVzZXJ2YXRpb25fb2JqZWN0X3Rlc3Rfc2lnbmFsZWRfcmN1KG9iai0+YmFzZS5yZXN2LCB0
cnVlKSkKLQkJCXJlc2VydmF0aW9uX29iamVjdF9hZGRfZXhjbF9mZW5jZShvYmotPmJhc2UucmVz
diwgTlVMTCk7Ci0JCXJlc2VydmF0aW9uX29iamVjdF91bmxvY2sob2JqLT5iYXNlLnJlc3YpOwot
CX0KIAotCS8qCi0JICogQnVtcCBvdXIgcGxhY2Ugb24gdGhlIGJvdW5kIGxpc3QgdG8ga2VlcCBp
dCByb3VnaGx5IGluIExSVSBvcmRlcgotCSAqIHNvIHRoYXQgd2UgZG9uJ3Qgc3RlYWwgZnJvbSBy
ZWNlbnRseSB1c2VkIGJ1dCBpbmFjdGl2ZSBvYmplY3RzCi0JICogKHVubGVzcyB3ZSBhcmUgZm9y
Y2VkIHRvIG9mYyEpCi0JICovCi0JaWYgKGk5MTVfZ2VtX29iamVjdF9pc19zaHJpbmthYmxlKG9i
aikpCi0JCW9ial9idW1wX21ydShvYmopOwotCi0JaTkxNV9nZW1fb2JqZWN0X3B1dChvYmopOyAv
KiBhbmQgZHJvcCB0aGUgYWN0aXZlIHJlZmVyZW5jZSAqLworCWk5MTVfdm1hX3B1dCh2bWEpOwog
fQogCiBzdGF0aWMgc3RydWN0IGk5MTVfdm1hICoKQEAgLTkyMSw2ICs4ODksNyBAQCBpbnQgaTkx
NV92bWFfbW92ZV90b19hY3RpdmUoc3RydWN0IGk5MTVfdm1hICp2bWEsCiAJCQkgICAgdW5zaWdu
ZWQgaW50IGZsYWdzKQogewogCXN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmogPSB2bWEt
Pm9iajsKKwlpbnQgZXJyOwogCiAJYXNzZXJ0X3ZtYV9oZWxkKHZtYSk7CiAJYXNzZXJ0X29iamVj
dF9oZWxkKG9iaik7CkBAIC05MzQsMTcgKzkwMywxMyBAQCBpbnQgaTkxNV92bWFfbW92ZV90b19h
Y3RpdmUoc3RydWN0IGk5MTVfdm1hICp2bWEsCiAJICogYWRkIHRoZSBhY3RpdmUgcmVmZXJlbmNl
IGZpcnN0IGFuZCBxdWV1ZSBmb3IgaXQgdG8gYmUgZHJvcHBlZAogCSAqICpsYXN0Ki4KIAkgKi8K
LQlpZiAoIXZtYS0+YWN0aXZlLmNvdW50ICYmICFvYmotPmFjdGl2ZV9jb3VudCsrKQotCQlpOTE1
X2dlbV9vYmplY3RfZ2V0KG9iaik7IC8qIG9uY2UgbW9yZSBmb3IgdGhlIGFjdGl2ZSByZWYgKi8K
LQotCWlmICh1bmxpa2VseShpOTE1X2FjdGl2ZV9yZWYoJnZtYS0+YWN0aXZlLCBycS0+ZmVuY2Uu
Y29udGV4dCwgcnEpKSkgewotCQlpZiAoIXZtYS0+YWN0aXZlLmNvdW50ICYmICEtLW9iai0+YWN0
aXZlX2NvdW50KQotCQkJaTkxNV9nZW1fb2JqZWN0X3B1dChvYmopOwotCQlyZXR1cm4gLUVOT01F
TTsKLQl9CisJaWYgKGk5MTVfYWN0aXZlX2FjcXVpcmUoJnZtYS0+YWN0aXZlKSkKKwkJaTkxNV92
bWFfZ2V0KHZtYSk7CiAKLQlHRU1fQlVHX09OKCFpOTE1X3ZtYV9pc19hY3RpdmUodm1hKSk7Ci0J
R0VNX0JVR19PTighb2JqLT5hY3RpdmVfY291bnQpOworCWVyciA9IGk5MTVfYWN0aXZlX3JlZigm
dm1hLT5hY3RpdmUsIHJxLT5mZW5jZS5jb250ZXh0LCBycSk7CisJaTkxNV9hY3RpdmVfcmVsZWFz
ZSgmdm1hLT5hY3RpdmUpOworCWlmICh1bmxpa2VseShlcnIpKQorCQlyZXR1cm4gZXJyOwogCiAJ
b2JqLT53cml0ZV9kb21haW4gPSAwOwogCWlmIChmbGFncyAmIEVYRUNfT0JKRUNUX1dSSVRFKSB7
CkBAIC05NTYsMTEgKzkyMSwxNCBAQCBpbnQgaTkxNV92bWFfbW92ZV90b19hY3RpdmUoc3RydWN0
IGk5MTVfdm1hICp2bWEsCiAJCW9iai0+cmVhZF9kb21haW5zID0gMDsKIAl9CiAJb2JqLT5yZWFk
X2RvbWFpbnMgfD0gSTkxNV9HRU1fR1BVX0RPTUFJTlM7CisJb2JqLT5tbS5kaXJ0eSA9IHRydWU7
CiAKIAlpZiAoZmxhZ3MgJiBFWEVDX09CSkVDVF9ORUVEU19GRU5DRSkKIAkJX19pOTE1X2FjdGl2
ZV9yZXF1ZXN0X3NldCgmdm1hLT5sYXN0X2ZlbmNlLCBycSk7CiAKIAlleHBvcnRfZmVuY2Uodm1h
LCBycSwgZmxhZ3MpOworCisJR0VNX0JVR19PTighaTkxNV92bWFfaXNfYWN0aXZlKHZtYSkpOwog
CXJldHVybiAwOwogfQogCi0tIAoyLjIwLjEKCl9fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fCkludGVsLWdmeCBtYWlsaW5nIGxpc3QKSW50ZWwtZ2Z4QGxpc3Rz
LmZyZWVkZXNrdG9wLm9yZwpodHRwczovL2xpc3RzLmZyZWVkZXNrdG9wLm9yZy9tYWlsbWFuL2xp
c3RpbmZvL2ludGVsLWdmeA==

Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id CAD5810B65A
	for <lists+intel-gfx@lfdr.de>; Wed, 27 Nov 2019 20:06:13 +0100 (CET)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 9F29E6E48E;
	Wed, 27 Nov 2019 19:06:11 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from mga18.intel.com (mga18.intel.com [134.134.136.126])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 751B16E48E
 for <intel-gfx@lists.freedesktop.org>; Wed, 27 Nov 2019 19:06:10 +0000 (UTC)
X-Amp-Result: SKIPPED(no attachment in message)
X-Amp-File-Uploaded: False
Received: from orsmga002.jf.intel.com ([10.7.209.21])
 by orsmga106.jf.intel.com with ESMTP/TLS/DHE-RSA-AES256-GCM-SHA384;
 27 Nov 2019 11:06:09 -0800
X-ExtLoop1: 1
X-IronPort-AV: E=Sophos;i="5.69,250,1571727600"; d="scan'208";a="221074171"
Received: from stinkbox.fi.intel.com (HELO stinkbox) ([10.237.72.174])
 by orsmga002.jf.intel.com with SMTP; 27 Nov 2019 11:06:07 -0800
Received: by stinkbox (sSMTP sendmail emulation);
 Wed, 27 Nov 2019 21:06:07 +0200
From: Ville Syrjala <ville.syrjala@linux.intel.com>
To: intel-gfx@lists.freedesktop.org
Date: Wed, 27 Nov 2019 21:05:53 +0200
Message-Id: <20191127190556.1574-5-ville.syrjala@linux.intel.com>
X-Mailer: git-send-email 2.23.0
In-Reply-To: <20191127190556.1574-1-ville.syrjala@linux.intel.com>
References: <20191127190556.1574-1-ville.syrjala@linux.intel.com>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH 4/7] drm/i915: Clean up intel_{pre,
 post}_plane_update()
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

RnJvbTogVmlsbGUgU3lyasOkbMOkIDx2aWxsZS5zeXJqYWxhQGxpbnV4LmludGVsLmNvbT4KCkNo
YW5nZSB0aGUgY2FsbGluZyBjb252ZW50aW9uIHRvIGp1c3QgcGFzcyB0aGUgc3RhdGUrY3J0YyBh
bmQKc3dpdGNoIHRvIGludGVsXyB0eXBlcyB0aHJvdWdob3V0LgoKU2lnbmVkLW9mZi1ieTogVmls
bGUgU3lyasOkbMOkIDx2aWxsZS5zeXJqYWxhQGxpbnV4LmludGVsLmNvbT4KLS0tCiBkcml2ZXJz
L2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2Rpc3BsYXkuYyB8IDg4ICsrKysrKysrKy0tLS0t
LS0tLS0tCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2ZiYy5jICAgICB8IDE0
ICsrLS0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZmJjLmggICAgIHwgIDgg
Ky0KIDMgZmlsZXMgY2hhbmdlZCwgNTEgaW5zZXJ0aW9ucygrKSwgNTkgZGVsZXRpb25zKC0pCgpk
aWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kaXNwbGF5LmMg
Yi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2Rpc3BsYXkuYwppbmRleCBlMzQx
Yjk3YjdkZWMuLjcyNjU1YjViMTM2NSAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUv
ZGlzcGxheS9pbnRlbF9kaXNwbGF5LmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxh
eS9pbnRlbF9kaXNwbGF5LmMKQEAgLTU5MjAsMTMgKzU5MjAsMTAgQEAgc3RhdGljIHZvaWQgaW50
ZWxfY3J0Y19kcG1zX292ZXJsYXlfZGlzYWJsZShzdHJ1Y3QgaW50ZWxfY3J0YyAqaW50ZWxfY3J0
YykKICAqIGNvbXBsZXRlbHkgaGlkZSB0aGUgcHJpbWFyeSBwbGFuZS4KICAqLwogc3RhdGljIHZv
aWQKLWludGVsX3Bvc3RfZW5hYmxlX3ByaW1hcnkoc3RydWN0IGRybV9jcnRjICpjcnRjLAotCQkJ
ICBjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqbmV3X2NydGNfc3RhdGUpCitpbnRlbF9w
b3N0X2VuYWJsZV9wcmltYXJ5KHN0cnVjdCBpbnRlbF9jcnRjICpjcnRjKQogewotCXN0cnVjdCBk
cm1fZGV2aWNlICpkZXYgPSBjcnRjLT5kZXY7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRl
dl9wcml2ID0gdG9faTkxNShkZXYpOwotCXN0cnVjdCBpbnRlbF9jcnRjICppbnRlbF9jcnRjID0g
dG9faW50ZWxfY3J0YyhjcnRjKTsKLQllbnVtIHBpcGUgcGlwZSA9IGludGVsX2NydGMtPnBpcGU7
CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShjcnRjLT5iYXNl
LmRldik7CisJZW51bSBwaXBlIHBpcGUgPSBjcnRjLT5waXBlOwogCiAJLyoKIAkgKiBHZW4yIHJl
cG9ydHMgcGlwZSB1bmRlcnJ1bnMgd2hlbmV2ZXIgYWxsIHBsYW5lcyBhcmUgZGlzYWJsZWQuCkBA
IC02MDYyLDIwICs2MDU5LDIxIEBAIHN0YXRpYyBib29sIG5lZWRzX3NjYWxlcmNsa193YShjb25z
dCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSkKIAlyZXR1cm4gZmFsc2U7CiB9
CiAKLXN0YXRpYyB2b2lkIGludGVsX3Bvc3RfcGxhbmVfdXBkYXRlKHN0cnVjdCBpbnRlbF9jcnRj
X3N0YXRlICpvbGRfY3J0Y19zdGF0ZSkKK3N0YXRpYyB2b2lkIGludGVsX3Bvc3RfcGxhbmVfdXBk
YXRlKHN0cnVjdCBpbnRlbF9hdG9taWNfc3RhdGUgKnN0YXRlLAorCQkJCSAgICBzdHJ1Y3QgaW50
ZWxfY3J0YyAqY3J0YykKIHsKLQlzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YyA9IHRvX2ludGVsX2Ny
dGMob2xkX2NydGNfc3RhdGUtPnVhcGkuY3J0Yyk7Ci0Jc3RydWN0IGRybV9kZXZpY2UgKmRldiA9
IGNydGMtPmJhc2UuZGV2OwotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRv
X2k5MTUoZGV2KTsKLQlzdHJ1Y3QgZHJtX2F0b21pY19zdGF0ZSAqc3RhdGUgPSBvbGRfY3J0Y19z
dGF0ZS0+dWFwaS5zdGF0ZTsKLQlzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqbmV3X2NydGNfc3Rh
dGUgPQotCQlpbnRlbF9hdG9taWNfZ2V0X25ld19jcnRjX3N0YXRlKHRvX2ludGVsX2F0b21pY19z
dGF0ZShzdGF0ZSksCi0JCQkJCQljcnRjKTsKLQlzdHJ1Y3QgZHJtX3BsYW5lICpwcmltYXJ5ID0g
Y3J0Yy0+YmFzZS5wcmltYXJ5OwotCXN0cnVjdCBkcm1fcGxhbmVfc3RhdGUgKm9sZF9wcmltYXJ5
X3N0YXRlID0KLQkJZHJtX2F0b21pY19nZXRfb2xkX3BsYW5lX3N0YXRlKHN0YXRlLCBwcmltYXJ5
KTsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KHN0YXRlLT5i
YXNlLmRldik7CisJc3RydWN0IGludGVsX3BsYW5lICpwcmltYXJ5ID0gdG9faW50ZWxfcGxhbmUo
Y3J0Yy0+YmFzZS5wcmltYXJ5KTsKKwljb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqb2xk
X2NydGNfc3RhdGUgPQorCQlpbnRlbF9hdG9taWNfZ2V0X29sZF9jcnRjX3N0YXRlKHN0YXRlLCBj
cnRjKTsKKwljb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqbmV3X2NydGNfc3RhdGUgPQor
CQlpbnRlbF9hdG9taWNfZ2V0X25ld19jcnRjX3N0YXRlKHN0YXRlLCBjcnRjKTsKKwljb25zdCBz
dHJ1Y3QgaW50ZWxfcGxhbmVfc3RhdGUgKm9sZF9wcmltYXJ5X3N0YXRlID0KKwkJaW50ZWxfYXRv
bWljX2dldF9vbGRfcGxhbmVfc3RhdGUoc3RhdGUsIHByaW1hcnkpOworCWNvbnN0IHN0cnVjdCBp
bnRlbF9wbGFuZV9zdGF0ZSAqbmV3X3ByaW1hcnlfc3RhdGUgPQorCQlpbnRlbF9hdG9taWNfZ2V0
X25ld19wbGFuZV9zdGF0ZShzdGF0ZSwgcHJpbWFyeSk7CiAKLQlpbnRlbF9mcm9udGJ1ZmZlcl9m
bGlwKHRvX2k5MTUoY3J0Yy0+YmFzZS5kZXYpLCBuZXdfY3J0Y19zdGF0ZS0+ZmJfYml0cyk7CisJ
aW50ZWxfZnJvbnRidWZmZXJfZmxpcChkZXZfcHJpdiwgbmV3X2NydGNfc3RhdGUtPmZiX2JpdHMp
OwogCiAJaWYgKG5ld19jcnRjX3N0YXRlLT51cGRhdGVfd21fcG9zdCAmJiBuZXdfY3J0Y19zdGF0
ZS0+aHcuYWN0aXZlKQogCQlpbnRlbF91cGRhdGVfd2F0ZXJtYXJrcyhjcnRjKTsKQEAgLTYwODMs
MTYgKzYwODEsMTMgQEAgc3RhdGljIHZvaWQgaW50ZWxfcG9zdF9wbGFuZV91cGRhdGUoc3RydWN0
IGludGVsX2NydGNfc3RhdGUgKm9sZF9jcnRjX3N0YXRlKQogCWlmIChoc3dfcG9zdF91cGRhdGVf
ZW5hYmxlX2lwcyhvbGRfY3J0Y19zdGF0ZSwgbmV3X2NydGNfc3RhdGUpKQogCQloc3dfZW5hYmxl
X2lwcyhuZXdfY3J0Y19zdGF0ZSk7CiAKLQlpZiAob2xkX3ByaW1hcnlfc3RhdGUpIHsKLQkJc3Ry
dWN0IGRybV9wbGFuZV9zdGF0ZSAqbmV3X3ByaW1hcnlfc3RhdGUgPQotCQkJZHJtX2F0b21pY19n
ZXRfbmV3X3BsYW5lX3N0YXRlKHN0YXRlLCBwcmltYXJ5KTsKLQorCWlmIChuZXdfcHJpbWFyeV9z
dGF0ZSkgewogCQlpbnRlbF9mYmNfcG9zdF91cGRhdGUoY3J0Yyk7CiAKLQkJaWYgKG5ld19wcmlt
YXJ5X3N0YXRlLT52aXNpYmxlICYmCisJCWlmIChuZXdfcHJpbWFyeV9zdGF0ZS0+dWFwaS52aXNp
YmxlICYmCiAJCSAgICAobmVlZHNfbW9kZXNldChuZXdfY3J0Y19zdGF0ZSkgfHwKLQkJICAgICAh
b2xkX3ByaW1hcnlfc3RhdGUtPnZpc2libGUpKQotCQkJaW50ZWxfcG9zdF9lbmFibGVfcHJpbWFy
eSgmY3J0Yy0+YmFzZSwgbmV3X2NydGNfc3RhdGUpOworCQkgICAgICFvbGRfcHJpbWFyeV9zdGF0
ZS0+dWFwaS52aXNpYmxlKSkKKwkJCWludGVsX3Bvc3RfZW5hYmxlX3ByaW1hcnkoY3J0Yyk7CiAJ
fQogCiAJaWYgKG5lZWRzX252MTJfd2Eob2xkX2NydGNfc3RhdGUpICYmCkBAIC02MTA0LDM0ICs2
MDk5LDMxIEBAIHN0YXRpYyB2b2lkIGludGVsX3Bvc3RfcGxhbmVfdXBkYXRlKHN0cnVjdCBpbnRl
bF9jcnRjX3N0YXRlICpvbGRfY3J0Y19zdGF0ZSkKIAkJaWNsX3dhX3NjYWxlcmNsa2dhdGluZyhk
ZXZfcHJpdiwgY3J0Yy0+cGlwZSwgZmFsc2UpOwogfQogCi1zdGF0aWMgdm9pZCBpbnRlbF9wcmVf
cGxhbmVfdXBkYXRlKHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpvbGRfY3J0Y19zdGF0ZSwKLQkJ
CQkgICBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqbmV3X2NydGNfc3RhdGUpCitzdGF0aWMgdm9p
ZCBpbnRlbF9wcmVfcGxhbmVfdXBkYXRlKHN0cnVjdCBpbnRlbF9hdG9taWNfc3RhdGUgKnN0YXRl
LAorCQkJCSAgIHN0cnVjdCBpbnRlbF9jcnRjICpjcnRjKQogewotCXN0cnVjdCBpbnRlbF9jcnRj
ICpjcnRjID0gdG9faW50ZWxfY3J0YyhvbGRfY3J0Y19zdGF0ZS0+dWFwaS5jcnRjKTsKLQlzdHJ1
Y3QgZHJtX2RldmljZSAqZGV2ID0gY3J0Yy0+YmFzZS5kZXY7Ci0Jc3RydWN0IGRybV9pOTE1X3By
aXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShkZXYpOwotCXN0cnVjdCBkcm1fYXRvbWljX3N0YXRl
ICpzdGF0ZSA9IG9sZF9jcnRjX3N0YXRlLT51YXBpLnN0YXRlOwotCXN0cnVjdCBkcm1fcGxhbmUg
KnByaW1hcnkgPSBjcnRjLT5iYXNlLnByaW1hcnk7Ci0Jc3RydWN0IGRybV9wbGFuZV9zdGF0ZSAq
b2xkX3ByaW1hcnlfc3RhdGUgPQotCQlkcm1fYXRvbWljX2dldF9vbGRfcGxhbmVfc3RhdGUoc3Rh
dGUsIHByaW1hcnkpOworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5
MTUoc3RhdGUtPmJhc2UuZGV2KTsKKwlzdHJ1Y3QgaW50ZWxfcGxhbmUgKnByaW1hcnkgPSB0b19p
bnRlbF9wbGFuZShjcnRjLT5iYXNlLnByaW1hcnkpOworCWNvbnN0IHN0cnVjdCBpbnRlbF9jcnRj
X3N0YXRlICpvbGRfY3J0Y19zdGF0ZSA9CisJCWludGVsX2F0b21pY19nZXRfb2xkX2NydGNfc3Rh
dGUoc3RhdGUsIGNydGMpOworCWNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpuZXdfY3J0
Y19zdGF0ZSA9CisJCWludGVsX2F0b21pY19nZXRfbmV3X2NydGNfc3RhdGUoc3RhdGUsIGNydGMp
OworCWNvbnN0IHN0cnVjdCBpbnRlbF9wbGFuZV9zdGF0ZSAqb2xkX3ByaW1hcnlfc3RhdGUgPQor
CQlpbnRlbF9hdG9taWNfZ2V0X29sZF9wbGFuZV9zdGF0ZShzdGF0ZSwgcHJpbWFyeSk7CisJY29u
c3Qgc3RydWN0IGludGVsX3BsYW5lX3N0YXRlICpuZXdfcHJpbWFyeV9zdGF0ZSA9CisJCWludGVs
X2F0b21pY19nZXRfbmV3X3BsYW5lX3N0YXRlKHN0YXRlLCBwcmltYXJ5KTsKIAlib29sIG1vZGVz
ZXQgPSBuZWVkc19tb2Rlc2V0KG5ld19jcnRjX3N0YXRlKTsKLQlzdHJ1Y3QgaW50ZWxfYXRvbWlj
X3N0YXRlICppbnRlbF9zdGF0ZSA9Ci0JCXRvX2ludGVsX2F0b21pY19zdGF0ZShzdGF0ZSk7CiAK
IAlpZiAoaHN3X3ByZV91cGRhdGVfZGlzYWJsZV9pcHMob2xkX2NydGNfc3RhdGUsIG5ld19jcnRj
X3N0YXRlKSkKIAkJaHN3X2Rpc2FibGVfaXBzKG9sZF9jcnRjX3N0YXRlKTsKIAotCWlmIChvbGRf
cHJpbWFyeV9zdGF0ZSkgewotCQlzdHJ1Y3QgaW50ZWxfcGxhbmVfc3RhdGUgKm5ld19wcmltYXJ5
X3N0YXRlID0KLQkJCWludGVsX2F0b21pY19nZXRfbmV3X3BsYW5lX3N0YXRlKGludGVsX3N0YXRl
LAotCQkJCQkJCSB0b19pbnRlbF9wbGFuZShwcmltYXJ5KSk7Ci0KKwlpZiAobmV3X3ByaW1hcnlf
c3RhdGUpIHsKIAkJaW50ZWxfZmJjX3ByZV91cGRhdGUoY3J0YywgbmV3X2NydGNfc3RhdGUsIG5l
d19wcmltYXJ5X3N0YXRlKTsKIAkJLyoKIAkJICogR2VuMiByZXBvcnRzIHBpcGUgdW5kZXJydW5z
IHdoZW5ldmVyIGFsbCBwbGFuZXMgYXJlIGRpc2FibGVkLgogCQkgKiBTbyBkaXNhYmxlIHVuZGVy
cnVuIHJlcG9ydGluZyBiZWZvcmUgYWxsIHRoZSBwbGFuZXMgZ2V0IGRpc2FibGVkLgogCQkgKi8K
LQkJaWYgKElTX0dFTihkZXZfcHJpdiwgMikgJiYgb2xkX3ByaW1hcnlfc3RhdGUtPnZpc2libGUg
JiYKKwkJaWYgKElTX0dFTihkZXZfcHJpdiwgMikgJiYgb2xkX3ByaW1hcnlfc3RhdGUtPnVhcGku
dmlzaWJsZSAmJgogCQkgICAgKG1vZGVzZXQgfHwgIW5ld19wcmltYXJ5X3N0YXRlLT51YXBpLnZp
c2libGUpKQogCQkJaW50ZWxfc2V0X2NwdV9maWZvX3VuZGVycnVuX3JlcG9ydGluZyhkZXZfcHJp
diwgY3J0Yy0+cGlwZSwgZmFsc2UpOwogCX0KQEAgLTYxOTIsNyArNjE4NCw3IEBAIHN0YXRpYyB2
b2lkIGludGVsX3ByZV9wbGFuZV91cGRhdGUoc3RydWN0IGludGVsX2NydGNfc3RhdGUgKm9sZF9j
cnRjX3N0YXRlLAogCSAqIHVzIHRvLgogCSAqLwogCWlmIChkZXZfcHJpdi0+ZGlzcGxheS5pbml0
aWFsX3dhdGVybWFya3MpCi0JCWRldl9wcml2LT5kaXNwbGF5LmluaXRpYWxfd2F0ZXJtYXJrcyhp
bnRlbF9zdGF0ZSwgY3J0Yyk7CisJCWRldl9wcml2LT5kaXNwbGF5LmluaXRpYWxfd2F0ZXJtYXJr
cyhzdGF0ZSwgY3J0Yyk7CiAJZWxzZSBpZiAobmV3X2NydGNfc3RhdGUtPnVwZGF0ZV93bV9wcmUp
CiAJCWludGVsX3VwZGF0ZV93YXRlcm1hcmtzKGNydGMpOwogfQpAQCAtMTQzNjUsNyArMTQzNTcs
NyBAQCBzdGF0aWMgdm9pZCBpbnRlbF91cGRhdGVfY3J0YyhzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0
YywKIAkJICAgICBuZXdfY3J0Y19zdGF0ZS0+dXBkYXRlX3BpcGUpKQogCQkJaW50ZWxfY29sb3Jf
bG9hZF9sdXRzKG5ld19jcnRjX3N0YXRlKTsKIAotCQlpbnRlbF9wcmVfcGxhbmVfdXBkYXRlKG9s
ZF9jcnRjX3N0YXRlLCBuZXdfY3J0Y19zdGF0ZSk7CisJCWludGVsX3ByZV9wbGFuZV91cGRhdGUo
c3RhdGUsIGNydGMpOwogCiAJCWlmIChuZXdfY3J0Y19zdGF0ZS0+dXBkYXRlX3BpcGUpCiAJCQlp
bnRlbF9lbmNvZGVyc191cGRhdGVfcGlwZShzdGF0ZSwgY3J0Yyk7CkBAIC0xNDQ2MCw3ICsxNDQ1
Miw3IEBAIHN0YXRpYyB2b2lkIGludGVsX3RyYW5zX3BvcnRfc3luY19tb2Rlc2V0X2Rpc2FibGVz
KHN0cnVjdCBpbnRlbF9hdG9taWNfc3RhdGUgKnN0CiAJCSFvbGRfc2xhdmVfY3J0Y19zdGF0ZSk7
CiAKIAkvKiBEaXNhYmxlIFNsYXZlIGZpcnN0ICovCi0JaW50ZWxfcHJlX3BsYW5lX3VwZGF0ZShv
bGRfc2xhdmVfY3J0Y19zdGF0ZSwgbmV3X3NsYXZlX2NydGNfc3RhdGUpOworCWludGVsX3ByZV9w
bGFuZV91cGRhdGUoc3RhdGUsIHNsYXZlX2NydGMpOwogCWlmIChvbGRfc2xhdmVfY3J0Y19zdGF0
ZS0+aHcuYWN0aXZlKQogCQlpbnRlbF9vbGRfY3J0Y19zdGF0ZV9kaXNhYmxlcyhzdGF0ZSwKIAkJ
CQkJICAgICAgb2xkX3NsYXZlX2NydGNfc3RhdGUsCkBAIC0xNDQ2OCw3ICsxNDQ2MCw3IEBAIHN0
YXRpYyB2b2lkIGludGVsX3RyYW5zX3BvcnRfc3luY19tb2Rlc2V0X2Rpc2FibGVzKHN0cnVjdCBp
bnRlbF9hdG9taWNfc3RhdGUgKnN0CiAJCQkJCSAgICAgIHNsYXZlX2NydGMpOwogCiAJLyogRGlz
YWJsZSBNYXN0ZXIgKi8KLQlpbnRlbF9wcmVfcGxhbmVfdXBkYXRlKG9sZF9jcnRjX3N0YXRlLCBu
ZXdfY3J0Y19zdGF0ZSk7CisJaW50ZWxfcHJlX3BsYW5lX3VwZGF0ZShzdGF0ZSwgY3J0Yyk7CiAJ
aWYgKG9sZF9jcnRjX3N0YXRlLT5ody5hY3RpdmUpCiAJCWludGVsX29sZF9jcnRjX3N0YXRlX2Rp
c2FibGVzKHN0YXRlLAogCQkJCQkgICAgICBvbGRfY3J0Y19zdGF0ZSwKQEAgLTE0NTA4LDcgKzE0
NTAwLDcgQEAgc3RhdGljIHZvaWQgaW50ZWxfY29tbWl0X21vZGVzZXRfZGlzYWJsZXMoc3RydWN0
IGludGVsX2F0b21pY19zdGF0ZSAqc3RhdGUpCiAJCQllbHNlCiAJCQkJY29udGludWU7CiAJCX0g
ZWxzZSB7Ci0JCQlpbnRlbF9wcmVfcGxhbmVfdXBkYXRlKG9sZF9jcnRjX3N0YXRlLCBuZXdfY3J0
Y19zdGF0ZSk7CisJCQlpbnRlbF9wcmVfcGxhbmVfdXBkYXRlKHN0YXRlLCBjcnRjKTsKIAogCQkJ
aWYgKG9sZF9jcnRjX3N0YXRlLT5ody5hY3RpdmUpCiAJCQkJaW50ZWxfb2xkX2NydGNfc3RhdGVf
ZGlzYWJsZXMoc3RhdGUsCkBAIC0xNDg5Niw3ICsxNDg4OCw3IEBAIHN0YXRpYyB2b2lkIGludGVs
X2F0b21pY19jb21taXRfdGFpbChzdHJ1Y3QgaW50ZWxfYXRvbWljX3N0YXRlICpzdGF0ZSkKIAl9
CiAKIAlmb3JfZWFjaF9vbGRuZXdfaW50ZWxfY3J0Y19pbl9zdGF0ZShzdGF0ZSwgY3J0Yywgb2xk
X2NydGNfc3RhdGUsIG5ld19jcnRjX3N0YXRlLCBpKSB7Ci0JCWludGVsX3Bvc3RfcGxhbmVfdXBk
YXRlKG9sZF9jcnRjX3N0YXRlKTsKKwkJaW50ZWxfcG9zdF9wbGFuZV91cGRhdGUoc3RhdGUsIGNy
dGMpOwogCiAJCWlmIChwdXRfZG9tYWluc1tpXSkKIAkJCW1vZGVzZXRfcHV0X3Bvd2VyX2RvbWFp
bnMoZGV2X3ByaXYsIHB1dF9kb21haW5zW2ldKTsKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2Ry
bS9pOTE1L2Rpc3BsYXkvaW50ZWxfZmJjLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5
L2ludGVsX2ZiYy5jCmluZGV4IDkyYzdlYjI0MzU1OS4uNzBjNTZhYmUxYTgzIDEwMDY0NAotLS0g
YS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2ZiYy5jCisrKyBiL2RyaXZlcnMv
Z3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZmJjLmMKQEAgLTQyMCw3ICs0MjAsNyBAQCBzdGF0
aWMgdm9pZCBpbnRlbF9mYmNfZGVhY3RpdmF0ZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2
X3ByaXYsCiB9CiAKIHN0YXRpYyBib29sIG11bHRpcGxlX3BpcGVzX29rKHN0cnVjdCBpbnRlbF9j
cnRjICpjcnRjLAotCQkJICAgICAgc3RydWN0IGludGVsX3BsYW5lX3N0YXRlICpwbGFuZV9zdGF0
ZSkKKwkJCSAgICAgIGNvbnN0IHN0cnVjdCBpbnRlbF9wbGFuZV9zdGF0ZSAqcGxhbmVfc3RhdGUp
CiB7CiAJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShjcnRjLT5i
YXNlLmRldik7CiAJc3RydWN0IGludGVsX2ZiYyAqZmJjID0gJmRldl9wcml2LT5mYmM7CkBAIC02
NTYsOCArNjU2LDggQEAgc3RhdGljIGJvb2wgaW50ZWxfZmJjX2h3X3RyYWNraW5nX2NvdmVyc19z
Y3JlZW4oc3RydWN0IGludGVsX2NydGMgKmNydGMpCiB9CiAKIHN0YXRpYyB2b2lkIGludGVsX2Zi
Y191cGRhdGVfc3RhdGVfY2FjaGUoc3RydWN0IGludGVsX2NydGMgKmNydGMsCi0JCQkJCSBzdHJ1
Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSwKLQkJCQkJIHN0cnVjdCBpbnRlbF9wbGFu
ZV9zdGF0ZSAqcGxhbmVfc3RhdGUpCisJCQkJCSBjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0
ZSAqY3J0Y19zdGF0ZSwKKwkJCQkJIGNvbnN0IHN0cnVjdCBpbnRlbF9wbGFuZV9zdGF0ZSAqcGxh
bmVfc3RhdGUpCiB7CiAJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkx
NShjcnRjLT5iYXNlLmRldik7CiAJc3RydWN0IGludGVsX2ZiYyAqZmJjID0gJmRldl9wcml2LT5m
YmM7CkBAIC04NTUsOCArODU1LDggQEAgc3RhdGljIHZvaWQgaW50ZWxfZmJjX2dldF9yZWdfcGFy
YW1zKHN0cnVjdCBpbnRlbF9jcnRjICpjcnRjLAogfQogCiB2b2lkIGludGVsX2ZiY19wcmVfdXBk
YXRlKHN0cnVjdCBpbnRlbF9jcnRjICpjcnRjLAotCQkJICBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0
ZSAqY3J0Y19zdGF0ZSwKLQkJCSAgc3RydWN0IGludGVsX3BsYW5lX3N0YXRlICpwbGFuZV9zdGF0
ZSkKKwkJCSAgY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUsCisJCQkg
IGNvbnN0IHN0cnVjdCBpbnRlbF9wbGFuZV9zdGF0ZSAqcGxhbmVfc3RhdGUpCiB7CiAJc3RydWN0
IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShjcnRjLT5iYXNlLmRldik7CiAJ
c3RydWN0IGludGVsX2ZiYyAqZmJjID0gJmRldl9wcml2LT5mYmM7CkBAIC0xMDgxLDggKzEwODEs
OCBAQCB2b2lkIGludGVsX2ZiY19jaG9vc2VfY3J0YyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAq
ZGV2X3ByaXYsCiAgKiBpbnRlbF9mYmNfZGlzYWJsZSBpbiB0aGUgbWlkZGxlLCBhcyBsb25nIGFz
IGl0IGlzIGRlYWN0aXZhdGVkLgogICovCiB2b2lkIGludGVsX2ZiY19lbmFibGUoc3RydWN0IGlu
dGVsX2NydGMgKmNydGMsCi0JCSAgICAgIHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0
YXRlLAotCQkgICAgICBzdHJ1Y3QgaW50ZWxfcGxhbmVfc3RhdGUgKnBsYW5lX3N0YXRlKQorCQkg
ICAgICBjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSwKKwkJICAgICAg
Y29uc3Qgc3RydWN0IGludGVsX3BsYW5lX3N0YXRlICpwbGFuZV9zdGF0ZSkKIHsKIAlzdHJ1Y3Qg
ZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGNydGMtPmJhc2UuZGV2KTsKIAlz
dHJ1Y3QgaW50ZWxfZmJjICpmYmMgPSAmZGV2X3ByaXYtPmZiYzsKZGlmZiAtLWdpdCBhL2RyaXZl
cnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZmJjLmggYi9kcml2ZXJzL2dwdS9kcm0vaTkx
NS9kaXNwbGF5L2ludGVsX2ZiYy5oCmluZGV4IDUwMjcyZWRhOGQ0My4uZjU4YjBiMWUzYzVjIDEw
MDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2ZiYy5oCisrKyBi
L2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZmJjLmgKQEAgLTIwLDE0ICsyMCwx
NCBAQCB2b2lkIGludGVsX2ZiY19jaG9vc2VfY3J0YyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAq
ZGV2X3ByaXYsCiAJCQkgICBzdHJ1Y3QgaW50ZWxfYXRvbWljX3N0YXRlICpzdGF0ZSk7CiBib29s
IGludGVsX2ZiY19pc19hY3RpdmUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KTsK
IHZvaWQgaW50ZWxfZmJjX3ByZV91cGRhdGUoc3RydWN0IGludGVsX2NydGMgKmNydGMsCi0JCQkg
IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlLAotCQkJICBzdHJ1Y3QgaW50ZWxf
cGxhbmVfc3RhdGUgKnBsYW5lX3N0YXRlKTsKKwkJCSAgY29uc3Qgc3RydWN0IGludGVsX2NydGNf
c3RhdGUgKmNydGNfc3RhdGUsCisJCQkgIGNvbnN0IHN0cnVjdCBpbnRlbF9wbGFuZV9zdGF0ZSAq
cGxhbmVfc3RhdGUpOwogdm9pZCBpbnRlbF9mYmNfcG9zdF91cGRhdGUoc3RydWN0IGludGVsX2Ny
dGMgKmNydGMpOwogdm9pZCBpbnRlbF9mYmNfaW5pdChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAq
ZGV2X3ByaXYpOwogdm9pZCBpbnRlbF9mYmNfaW5pdF9waXBlX3N0YXRlKHN0cnVjdCBkcm1faTkx
NV9wcml2YXRlICpkZXZfcHJpdik7CiB2b2lkIGludGVsX2ZiY19lbmFibGUoc3RydWN0IGludGVs
X2NydGMgKmNydGMsCi0JCSAgICAgIHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRl
LAotCQkgICAgICBzdHJ1Y3QgaW50ZWxfcGxhbmVfc3RhdGUgKnBsYW5lX3N0YXRlKTsKKwkJICAg
ICAgY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUsCisJCSAgICAgIGNv
bnN0IHN0cnVjdCBpbnRlbF9wbGFuZV9zdGF0ZSAqcGxhbmVfc3RhdGUpOwogdm9pZCBpbnRlbF9m
YmNfZGlzYWJsZShzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0Yyk7CiB2b2lkIGludGVsX2ZiY19nbG9i
YWxfZGlzYWJsZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpOwogdm9pZCBpbnRl
bF9mYmNfaW52YWxpZGF0ZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCi0tIAoy
LjIzLjAKCl9fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fCklu
dGVsLWdmeCBtYWlsaW5nIGxpc3QKSW50ZWwtZ2Z4QGxpc3RzLmZyZWVkZXNrdG9wLm9yZwpodHRw
czovL2xpc3RzLmZyZWVkZXNrdG9wLm9yZy9tYWlsbWFuL2xpc3RpbmZvL2ludGVsLWdmeA==

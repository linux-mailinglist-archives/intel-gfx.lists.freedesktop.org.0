Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 0CEE2DD2C9
	for <lists+intel-gfx@lfdr.de>; Sat, 19 Oct 2019 00:15:13 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id BAE0B89DFB;
	Fri, 18 Oct 2019 22:15:10 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from fireflyinternet.com (mail.fireflyinternet.com [109.228.58.192])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 0533589DFF
 for <intel-gfx@lists.freedesktop.org>; Fri, 18 Oct 2019 22:15:05 +0000 (UTC)
X-Default-Received-SPF: pass (skip=forwardok (res=PASS))
 x-ip-name=78.156.65.138; 
Received: from haswell.alporthouse.com (unverified [78.156.65.138]) 
 by fireflyinternet.com (Firefly Internet (M1)) with ESMTP id 18887727-1500050 
 for multiple; Fri, 18 Oct 2019 23:14:52 +0100
From: Chris Wilson <chris@chris-wilson.co.uk>
To: intel-gfx@lists.freedesktop.org
Date: Fri, 18 Oct 2019 23:14:42 +0100
Message-Id: <20191018221450.26247-5-chris@chris-wilson.co.uk>
X-Mailer: git-send-email 2.23.0
In-Reply-To: <20191018221450.26247-1-chris@chris-wilson.co.uk>
References: <20191018221450.26247-1-chris@chris-wilson.co.uk>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH 05/13] drm/i915: Expose timeslice duration to
 sysfs
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

RXhlY2xpc3RzIHVzZXMgYSBzY2hlZHVsaW5nIHF1YW50dW0gKGEgdGltZXNsaWNlKSB0byBhbHRl
cm5hdGUgZXhlY3V0aW9uCmJldHdlZW4gcmVhZHktdG8tcnVuIGNvbnRleHRzIG9mIGVxdWFsIHBy
aW9yaXR5LiBUaGlzIGVuc3VyZXMgdGhhdCBhbGwKdXNlcnMgKHRob3VnaCBvbmx5IGlmIHRoZXkg
b2YgZXF1YWwgaW1wb3J0YW5jZSkgdGhlIG9wcG9ydHVuaXR5IHRvIHJ1bgphbmQgcHJldmVudHMg
bGl2ZWxvY2tzIHdlcmUgY29udGV4dHMgbWF5IGhhdmUgaW1wbGljaXQgb3JkZXJpbmcgZHVlIHRv
CnVzZXJzcGFjZSBzZW1hcGhvcmVzLgoKVGhlIHRpbWVzbGljaW5nIG1lY2hhbmlzbSBjYW4gYmUg
Y29tcGlsZWQgb3V0IHdpdGgKCgkuL3NjcmlwdHMvY29uZmlnIC0tc2V0LXZhbCBEUk1fSTkxNV9U
SU1FU0xJQ0VfRFVSQVRJT04gMAoKVGhlIHRpbWVzbGljZSBkdXJhdGlvbiBjYW4gYmUgYWRqdXN0
ZWQgcGVyLWVuZ2luZSB1c2luZywKCgkvc3lzL2NsYXNzL2RybS9jYXJkPy9lbmdpbmUvKi90aW1l
c2xpY2VfZHVyYXRpb25fbXMKClNpZ25lZC1vZmYtYnk6IENocmlzIFdpbHNvbiA8Y2hyaXNAY2hy
aXMtd2lsc29uLmNvLnVrPgpDYzogSm9vbmFzIExhaHRpbmVuIDxqb29uYXMubGFodGluZW5AbGlu
dXguaW50ZWwuY29tPgotLS0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L0tjb25maWcucHJvZmlsZSAg
ICAgICAgIHwgMTggKysrKysrKwogZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfZW5naW5l
LmggICAgICAgfCAgOSArKysrCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9lbmdpbmVf
Y3MuYyAgICB8ICAzICsrCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9lbmdpbmVfc3lz
ZnMuYyB8IDQ2ICsrKysrKysrKysrKysrKysrCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRl
bF9lbmdpbmVfdHlwZXMuaCB8ICA0ICsrCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9s
cmMuYyAgICAgICAgICB8IDUzICsrKysrKysrKysrKysrKy0tLS0tCiBkcml2ZXJzL2dwdS9kcm0v
aTkxNS9ndC9zZWxmdGVzdF9scmMuYyAgICAgICB8ICA0ICsrCiA3IGZpbGVzIGNoYW5nZWQsIDEy
NSBpbnNlcnRpb25zKCspLCAxMiBkZWxldGlvbnMoLSkKCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dw
dS9kcm0vaTkxNS9LY29uZmlnLnByb2ZpbGUgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9LY29uZmln
LnByb2ZpbGUKaW5kZXggNDhkZjg4ODlhODhhLi5iOGRmODBiYzBiNDcgMTAwNjQ0Ci0tLSBhL2Ry
aXZlcnMvZ3B1L2RybS9pOTE1L0tjb25maWcucHJvZmlsZQorKysgYi9kcml2ZXJzL2dwdS9kcm0v
aTkxNS9LY29uZmlnLnByb2ZpbGUKQEAgLTI1LDMgKzI1LDIxIEBAIGNvbmZpZyBEUk1fSTkxNV9T
UElOX1JFUVVFU1QKIAkgIE1heSBiZSAwIHRvIGRpc2FibGUgdGhlIGluaXRpYWwgc3Bpbi4gSW4g
cHJhY3RpY2UsIHdlIGVzdGltYXRlCiAJICB0aGUgY29zdCBvZiBlbmFibGluZyB0aGUgaW50ZXJy
dXB0IChpZiBjdXJyZW50bHkgZGlzYWJsZWQpIHRvIGJlCiAJICBhIGZldyBtaWNyb3NlY29uZHMu
CisKK2NvbmZpZyBEUk1fSTkxNV9USU1FU0xJQ0VfRFVSQVRJT04KKwlpbnQgIlNjaGVkdWxpbmcg
cXVhbnR1bSBmb3IgdXNlcnNwYWNlIGJhdGNoZXMgKG1zLCBqaWZmeSBncmFudWxhcml0eSkiCisJ
ZGVmYXVsdCAxICMgbWlsbGlzZWNvbmRzCisJaGVscAorCSAgV2hlbiB0d28gdXNlciBiYXRjaGVz
IG9mIGVxdWFsIHByaW9yaXR5IGFyZSBleGVjdXRpbmcsIHdlIHdpbGwKKwkgIGFsdGVybmF0ZSBl
eGVjdXRpb24gb2YgZWFjaCBiYXRjaCB0byBlbnN1cmUgZm9yd2FyZCBwcm9ncmVzcyBvZgorCSAg
YWxsIHVzZXJzLiBUaGlzIGlzIG5lY2Vzc2FyeSBpbiBzb21lIGNhc2VzIHdoZXJlIHRoZXJlIG1h
eSBiZQorCSAgYW4gaW1wbGljaXQgZGVwZW5kZW5jeSBiZXR3ZWVuIHRob3NlIGJhdGNoZXMgdGhh
dCByZXF1aXJlcworCSAgY29uY3VycmVudCBleGVjdXRpb24gaW4gb3JkZXIgZm9yIHRoZW0gdG8g
cHJvY2VlZCwgZS5nLiB0aGV5CisJICBpbnRlcmFjdCB3aXRoIGVhY2ggb3RoZXIgdmlhIHVzZXJz
cGFjZSBzZW1hcGhvcmVzLiBFYWNoIGNvbnRleHQKKwkgIGlzIHNjaGVkdWxlZCBmb3IgZXhlY3V0
aW9uIGZvciB0aGUgdGltZXNsaWNlIGR1cmF0aW9uLCBiZWZvcmUKKwkgIHN3aXRjaGluZyB0byB0
aGUgbmV4dCBjb250ZXh0LgorCisJICBUaGlzIGlzIGFkanVzdGFibGUgdmlhCisJICAvc3lzL2Ns
YXNzL2RybS9jYXJkPy9lbmdpbmUvKi90aW1lc2xpY2VfZHVyYXRpb25fbXMKKworCSAgTWF5IGJl
IDAgdG8gZGlzYWJsZSB0aW1lc2xpY2luZy4KZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9p
OTE1L2d0L2ludGVsX2VuZ2luZS5oIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfZW5n
aW5lLmgKaW5kZXggOTNlYTM2N2ZlNjI0Li4zOTM0ODEzNzRmOTYgMTAwNjQ0Ci0tLSBhL2RyaXZl
cnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2VuZ2luZS5oCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9p
OTE1L2d0L2ludGVsX2VuZ2luZS5oCkBAIC01MjUsNCArNTI1LDEzIEBAIHZvaWQgaW50ZWxfZW5n
aW5lX2luaXRfYWN0aXZlKHN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZSwKICNkZWZpbmUg
RU5HSU5FX01PQ0sJMQogI2RlZmluZSBFTkdJTkVfVklSVFVBTAkyCiAKK3N0YXRpYyBpbmxpbmUg
Ym9vbAoraW50ZWxfZW5naW5lX2hhc190aW1lc2xpY2VzKGNvbnN0IHN0cnVjdCBpbnRlbF9lbmdp
bmVfY3MgKmVuZ2luZSkKK3sKKwlpZiAoIUNPTkZJR19EUk1fSTkxNV9USU1FU0xJQ0VfRFVSQVRJ
T04pCisJCXJldHVybiAwOworCisJcmV0dXJuIGludGVsX2VuZ2luZV9oYXNfc2VtYXBob3Jlcyhl
bmdpbmUpOworfQorCiAjZW5kaWYgLyogX0lOVEVMX1JJTkdCVUZGRVJfSF8gKi8KZGlmZiAtLWdp
dCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2VuZ2luZV9jcy5jIGIvZHJpdmVycy9n
cHUvZHJtL2k5MTUvZ3QvaW50ZWxfZW5naW5lX2NzLmMKaW5kZXggMDUxNzM0YzliNzMzLi5iOTNk
YmVkNjdmZTcgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2VuZ2lu
ZV9jcy5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2VuZ2luZV9jcy5jCkBA
IC0zMDgsNiArMzA4LDkgQEAgc3RhdGljIGludCBpbnRlbF9lbmdpbmVfc2V0dXAoc3RydWN0IGlu
dGVsX2d0ICpndCwgZW51bSBpbnRlbF9lbmdpbmVfaWQgaWQpCiAJZW5naW5lLT5pbnN0YW5jZSA9
IGluZm8tPmluc3RhbmNlOwogCV9fc3ByaW50X2VuZ2luZV9uYW1lKGVuZ2luZSk7CiAKKwllbmdp
bmUtPnByb3BzLnRpbWVzbGljZV9kdXJhdGlvbl9tcyA9CisJCUNPTkZJR19EUk1fSTkxNV9USU1F
U0xJQ0VfRFVSQVRJT047CisKIAkvKgogCSAqIFRvIGJlIG92ZXJyaWRkZW4gYnkgdGhlIGJhY2tl
bmQgb24gc2V0dXAuIEhvd2V2ZXIgdG8gZmFjaWxpdGF0ZQogCSAqIGNsZWFudXAgb24gZXJyb3Ig
ZHVyaW5nIHNldHVwLCB3ZSBhbHdheXMgcHJvdmlkZSB0aGUgZGVzdHJveSB2ZnVuYy4KZGlmZiAt
LWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2VuZ2luZV9zeXNmcy5jIGIvZHJp
dmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfZW5naW5lX3N5c2ZzLmMKaW5kZXggODIzMTUzZTU2
YzY3Li43OGQxZGVmMjcxMWUgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2lu
dGVsX2VuZ2luZV9zeXNmcy5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2Vu
Z2luZV9zeXNmcy5jCkBAIC0xMzMsNiArMTMzLDQ4IEBAIGFsbF9jYXBzX3Nob3coc3RydWN0IGtv
YmplY3QgKmtvYmosIHN0cnVjdCBrb2JqX2F0dHJpYnV0ZSAqYXR0ciwgY2hhciAqYnVmKQogc3Rh
dGljIHN0cnVjdCBrb2JqX2F0dHJpYnV0ZSBhbGxfY2Fwc19hdHRyID0KIF9fQVRUUihrbm93bl9j
YXBhYmlsaXRpZXMsIDA0NDQsIGFsbF9jYXBzX3Nob3csIE5VTEwpOwogCitzdGF0aWMgc3NpemVf
dAordGltZXNsaWNlX3Nob3coc3RydWN0IGtvYmplY3QgKmtvYmosIHN0cnVjdCBrb2JqX2F0dHJp
YnV0ZSAqYXR0ciwgY2hhciAqYnVmKQoreworCXN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2lu
ZSA9IGtvYmpfdG9fZW5naW5lKGtvYmopOworCisJcmV0dXJuIHNwcmludGYoYnVmLCAiJWx1XG4i
LCBlbmdpbmUtPnByb3BzLnRpbWVzbGljZV9kdXJhdGlvbl9tcyk7Cit9CisKK3N0YXRpYyBzc2l6
ZV90Cit0aW1lc2xpY2Vfc3RvcmUoc3RydWN0IGtvYmplY3QgKmtvYmosIHN0cnVjdCBrb2JqX2F0
dHJpYnV0ZSAqYXR0ciwKKwkJY29uc3QgY2hhciAqYnVmLCBzaXplX3QgY291bnQpCit7CisJc3Ry
dWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lID0ga29ial90b19lbmdpbmUoa29iaik7CisJdW5z
aWduZWQgbG9uZyBsb25nIGR1cmF0aW9uOworCWludCBlcnI7CisKKwllcnIgPSBrc3RydG91bGwo
YnVmLCAwLCAmZHVyYXRpb24pOworCWlmIChlcnIpCisJCXJldHVybiBlcnI7CisKKwlpZiAoZHVy
YXRpb24gPiBqaWZmaWVzX3RvX21zZWNzKE1BWF9TQ0hFRFVMRV9USU1FT1VUKSkKKwkJcmV0dXJu
IC1FSU5WQUw7CisKKwlXUklURV9PTkNFKGVuZ2luZS0+cHJvcHMudGltZXNsaWNlX2R1cmF0aW9u
X21zLCBkdXJhdGlvbik7CisKKwlpZiAoZXhlY2xpc3RzX2FjdGl2ZSgmZW5naW5lLT5leGVjbGlz
dHMpKSB7CisJCXN0cnVjdCB0aW1lcl9saXN0ICp0ID0gJmVuZ2luZS0+ZXhlY2xpc3RzLnRpbWVy
OworCisJCWlmICghZHVyYXRpb24pIHsKKwkJCWNhbmNlbF90aW1lcih0KTsKKwkJfSBlbHNlIHsK
KwkJCWR1cmF0aW9uID0gbXNlY3NfdG9famlmZmllc190aW1lb3V0KGR1cmF0aW9uKTsKKwkJCW1v
ZF90aW1lcih0LCBqaWZmaWVzICsgZHVyYXRpb24pOworCQl9CisJfQorCisJcmV0dXJuIGNvdW50
OworfQorCitzdGF0aWMgc3RydWN0IGtvYmpfYXR0cmlidXRlIHRpbWVzbGljZV9kdXJhdGlvbl9h
dHRyID0KK19fQVRUUih0aW1lc2xpY2VfZHVyYXRpb25fbXMsIDA2NDQsIHRpbWVzbGljZV9zaG93
LCB0aW1lc2xpY2Vfc3RvcmUpOworCiBzdGF0aWMgdm9pZCBrb2JqX2VuZ2luZV9yZWxlYXNlKHN0
cnVjdCBrb2JqZWN0ICprb2JqKQogewogCWtmcmVlKGtvYmopOwpAQCAtMTkzLDYgKzIzNSwxMCBA
QCB2b2lkIGludGVsX2VuZ2luZXNfYWRkX3N5c2ZzKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpp
OTE1KQogCQlpZiAoc3lzZnNfY3JlYXRlX2ZpbGVzKGtvYmosIGZpbGVzKSkKIAkJCWdvdG8gZXJy
X29iamVjdDsKIAorCQlpZiAoaW50ZWxfZW5naW5lX2hhc190aW1lc2xpY2VzKGVuZ2luZSkgJiYK
KwkJICAgIHN5c2ZzX2NyZWF0ZV9maWxlKGtvYmosICZ0aW1lc2xpY2VfZHVyYXRpb25fYXR0ci5h
dHRyKSkKKwkJCWdvdG8gZXJyX2VuZ2luZTsKKwogCQlpZiAoMCkgewogZXJyX29iamVjdDoKIAkJ
CWtvYmplY3RfcHV0KGtvYmopOwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qv
aW50ZWxfZW5naW5lX3R5cGVzLmggYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9lbmdp
bmVfdHlwZXMuaAppbmRleCAzNDUxYmUwMzRjYWYuLjg5YTk2MTZlODUzOSAxMDA2NDQKLS0tIGEv
ZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfZW5naW5lX3R5cGVzLmgKKysrIGIvZHJpdmVy
cy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfZW5naW5lX3R5cGVzLmgKQEAgLTU0Miw2ICs1NDIsMTAg
QEAgc3RydWN0IGludGVsX2VuZ2luZV9jcyB7CiAJCSAqLwogCQlrdGltZV90IHRvdGFsOwogCX0g
c3RhdHM7CisKKwlzdHJ1Y3QgeworCQl1bnNpZ25lZCBsb25nIHRpbWVzbGljZV9kdXJhdGlvbl9t
czsKKwl9IHByb3BzOwogfTsKIAogc3RhdGljIGlubGluZSBib29sCmRpZmYgLS1naXQgYS9kcml2
ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9scmMuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0
L2ludGVsX2xyYy5jCmluZGV4IGQwMDg4ZDAyMDIyMC4uM2ZmY2M3YmYzMDdlIDEwMDY0NAotLS0g
YS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9scmMuYworKysgYi9kcml2ZXJzL2dwdS9k
cm0vaTkxNS9ndC9pbnRlbF9scmMuYwpAQCAtMTM0NSw3ICsxMzQ1LDcgQEAgbmVlZF90aW1lc2xp
Y2Uoc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lLCBjb25zdCBzdHJ1Y3QgaTkxNV9yZXF1
ZXN0ICpycSkKIHsKIAlpbnQgaGludDsKIAotCWlmICghaW50ZWxfZW5naW5lX2hhc19zZW1hcGhv
cmVzKGVuZ2luZSkpCisJaWYgKCFpbnRlbF9lbmdpbmVfaGFzX3RpbWVzbGljZXMoZW5naW5lKSkK
IAkJcmV0dXJuIGZhbHNlOwogCiAJaWYgKGxpc3RfaXNfbGFzdCgmcnEtPnNjaGVkLmxpbmssICZl
bmdpbmUtPmFjdGl2ZS5yZXF1ZXN0cykpCkBAIC0xMzY2LDE1ICsxMzY2LDQ2IEBAIHN3aXRjaF9w
cmlvKHN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZSwgY29uc3Qgc3RydWN0IGk5MTVfcmVx
dWVzdCAqcnEpCiAJcmV0dXJuIHJxX3ByaW8obGlzdF9uZXh0X2VudHJ5KHJxLCBzY2hlZC5saW5r
KSk7CiB9CiAKLXN0YXRpYyBib29sCi1lbmFibGVfdGltZXNsaWNlKGNvbnN0IHN0cnVjdCBpbnRl
bF9lbmdpbmVfZXhlY2xpc3RzICpleGVjbGlzdHMpCitzdGF0aWMgaW5saW5lIHVuc2lnbmVkIGxv
bmcKK3RpbWVzbGljZShjb25zdCBzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmUpCit7CisJ
cmV0dXJuIFJFQURfT05DRShlbmdpbmUtPnByb3BzLnRpbWVzbGljZV9kdXJhdGlvbl9tcyk7Cit9
CisKK3N0YXRpYyB1bnNpZ25lZCBsb25nCithY3RpdmVfdGltZXNsaWNlKGNvbnN0IHN0cnVjdCBp
bnRlbF9lbmdpbmVfY3MgKmVuZ2luZSkKIHsKLQljb25zdCBzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpy
cSA9ICpleGVjbGlzdHMtPmFjdGl2ZTsKKwljb25zdCBzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpycSA9
ICplbmdpbmUtPmV4ZWNsaXN0cy5hY3RpdmU7CiAKIAlpZiAoaTkxNV9yZXF1ZXN0X2NvbXBsZXRl
ZChycSkpCi0JCXJldHVybiBmYWxzZTsKKwkJcmV0dXJuIDA7CisKKwlpZiAoZW5naW5lLT5leGVj
bGlzdHMuc3dpdGNoX3ByaW9yaXR5X2hpbnQgPCBlZmZlY3RpdmVfcHJpbyhycSkpCisJCXJldHVy
biAwOworCisJcmV0dXJuIHRpbWVzbGljZShlbmdpbmUpOworfQogCi0JcmV0dXJuIGV4ZWNsaXN0
cy0+c3dpdGNoX3ByaW9yaXR5X2hpbnQgPj0gZWZmZWN0aXZlX3ByaW8ocnEpOworc3RhdGljIHZv
aWQgX19zZXRfdGltZXNsaWNlKHN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZSwKKwkJCSAg
ICB1bnNpZ25lZCBsb25nIHRpbWVvdXQpCit7CisJc3RydWN0IHRpbWVyX2xpc3QgKnQgPSAmZW5n
aW5lLT5leGVjbGlzdHMudGltZXI7CisKKwlpZiAoIXRpbWVvdXQpIHsKKwkJY2FuY2VsX3RpbWVy
KHQpOworCX0gZWxzZSB7CisJCXRpbWVvdXQgPSBtc2Vjc190b19qaWZmaWVzX3RpbWVvdXQodGlt
ZW91dCk7CisJCWJhcnJpZXIoKTsKKwkJbW9kX3RpbWVyKHQsIGppZmZpZXMgKyB0aW1lb3V0KTsK
Kwl9Cit9CisKK3N0YXRpYyB2b2lkIHNldF90aW1lc2xpY2Uoc3RydWN0IGludGVsX2VuZ2luZV9j
cyAqZW5naW5lKQoreworCWlmICghaW50ZWxfZW5naW5lX2hhc190aW1lc2xpY2VzKGVuZ2luZSkp
CisJCXJldHVybjsKKworCV9fc2V0X3RpbWVzbGljZShlbmdpbmUsIGFjdGl2ZV90aW1lc2xpY2Uo
ZW5naW5lKSk7CiB9CiAKIHN0YXRpYyB2b2lkIHJlY29yZF9wcmVlbXB0aW9uKHN0cnVjdCBpbnRl
bF9lbmdpbmVfZXhlY2xpc3RzICpleGVjbGlzdHMpCkBAIC0xNTIxLDggKzE1NTIsOSBAQCBzdGF0
aWMgdm9pZCBleGVjbGlzdHNfZGVxdWV1ZShzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmUp
CiAJCQkJICovCiAJCQkJaWYgKCFleGVjbGlzdHMtPnRpbWVyLmV4cGlyZXMgJiYKIAkJCQkgICAg
bmVlZF90aW1lc2xpY2UoZW5naW5lLCBsYXN0KSkKLQkJCQkJbW9kX3RpbWVyKCZleGVjbGlzdHMt
PnRpbWVyLAotCQkJCQkJICBqaWZmaWVzICsgMSk7CisJCQkJCV9fc2V0X3RpbWVzbGljZShlbmdp
bmUsCisJCQkJCQkJdGltZXNsaWNlKGVuZ2luZSkpOworCiAJCQkJcmV0dXJuOwogCQkJfQogCkBA
IC0xOTQ0LDEwICsxOTc2LDcgQEAgc3RhdGljIHZvaWQgcHJvY2Vzc19jc2Ioc3RydWN0IGludGVs
X2VuZ2luZV9jcyAqZW5naW5lKQogCQkJCSAgICAgICBleGVjbGlzdHNfbnVtX3BvcnRzKGV4ZWNs
aXN0cykgKgogCQkJCSAgICAgICBzaXplb2YoKmV4ZWNsaXN0cy0+cGVuZGluZykpOwogCi0JCQlp
ZiAoZW5hYmxlX3RpbWVzbGljZShleGVjbGlzdHMpKQotCQkJCW1vZF90aW1lcigmZXhlY2xpc3Rz
LT50aW1lciwgamlmZmllcyArIDEpOwotCQkJZWxzZQotCQkJCWNhbmNlbF90aW1lcigmZXhlY2xp
c3RzLT50aW1lcik7CisJCQlzZXRfdGltZXNsaWNlKGVuZ2luZSk7CiAKIAkJCVdSSVRFX09OQ0Uo
ZXhlY2xpc3RzLT5wZW5kaW5nWzBdLCBOVUxMKTsKIAkJfSBlbHNlIHsKZGlmZiAtLWdpdCBhL2Ry
aXZlcnMvZ3B1L2RybS9pOTE1L2d0L3NlbGZ0ZXN0X2xyYy5jIGIvZHJpdmVycy9ncHUvZHJtL2k5
MTUvZ3Qvc2VsZnRlc3RfbHJjLmMKaW5kZXggMmNkMWEyZDQzMzE0Li4zNGJlOGFmNjRlNTQgMTAw
NjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L3NlbGZ0ZXN0X2xyYy5jCisrKyBiL2Ry
aXZlcnMvZ3B1L2RybS9pOTE1L2d0L3NlbGZ0ZXN0X2xyYy5jCkBAIC00NDQsNiArNDQ0LDggQEAg
c3RhdGljIGludCBsaXZlX3RpbWVzbGljZV9wcmVlbXB0KHZvaWQgKmFyZykKIAkgKiBuZWVkIHRv
IHByZWVtcHQgdGhlIGN1cnJlbnQgdGFzayBhbmQgcmVwbGFjZSBpdCB3aXRoIGFub3RoZXIKIAkg
KiByZWFkeSB0YXNrLgogCSAqLworCWlmICghQ09ORklHX0RSTV9JOTE1X1RJTUVTTElDRV9EVVJB
VElPTikKKwkJcmV0dXJuIDA7CiAKIAlvYmogPSBpOTE1X2dlbV9vYmplY3RfY3JlYXRlX2ludGVy
bmFsKGd0LT5pOTE1LCBQQUdFX1NJWkUpOwogCWlmIChJU19FUlIob2JqKSkKQEAgLTUzNSw2ICs1
MzcsOCBAQCBzdGF0aWMgaW50IGxpdmVfdGltZXNsaWNlX3F1ZXVlKHZvaWQgKmFyZykKIAkgKiBF
TFNQWzFdIGlzIGFscmVhZHkgb2NjdXBpZWQsIHNvIG11c3QgcmVseSBvbiB0aW1lc2xpY2luZyB0
bwogCSAqIGVqZWN0IEVMU1BbMF0gaW4gZmF2b3VyIG9mIHRoZSBxdWV1ZS4pCiAJICovCisJaWYg
KCFDT05GSUdfRFJNX0k5MTVfVElNRVNMSUNFX0RVUkFUSU9OKQorCQlyZXR1cm4gMDsKIAogCW9i
aiA9IGk5MTVfZ2VtX29iamVjdF9jcmVhdGVfaW50ZXJuYWwoZ3QtPmk5MTUsIFBBR0VfU0laRSk7
CiAJaWYgKElTX0VSUihvYmopKQotLSAKMi4yMy4wCgpfX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fXwpJbnRlbC1nZnggbWFpbGluZyBsaXN0CkludGVsLWdmeEBs
aXN0cy5mcmVlZGVza3RvcC5vcmcKaHR0cHM6Ly9saXN0cy5mcmVlZGVza3RvcC5vcmcvbWFpbG1h
bi9saXN0aW5mby9pbnRlbC1nZng=

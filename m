Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id D30AA17322
	for <lists+intel-gfx@lfdr.de>; Wed,  8 May 2019 10:07:50 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id D8C7A893A4;
	Wed,  8 May 2019 08:07:48 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from fireflyinternet.com (mail.fireflyinternet.com [109.228.58.192])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 6DC3E89394
 for <intel-gfx@lists.freedesktop.org>; Wed,  8 May 2019 08:07:47 +0000 (UTC)
X-Default-Received-SPF: pass (skip=forwardok (res=PASS))
 x-ip-name=78.156.65.138; 
Received: from haswell.alporthouse.com (unverified [78.156.65.138]) 
 by fireflyinternet.com (Firefly Internet (M1)) with ESMTP id 16485937-1500050 
 for multiple; Wed, 08 May 2019 09:07:13 +0100
From: Chris Wilson <chris@chris-wilson.co.uk>
To: intel-gfx@lists.freedesktop.org
Date: Wed,  8 May 2019 09:07:01 +0100
Message-Id: <20190508080704.24223-37-chris@chris-wilson.co.uk>
X-Mailer: git-send-email 2.20.1
In-Reply-To: <20190508080704.24223-1-chris@chris-wilson.co.uk>
References: <20190508080704.24223-1-chris@chris-wilson.co.uk>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH 37/40] drm/i915: Replace engine->timeline with a
 plain list
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

VG8gY29udGludWUgdGhlIG9uc2xhdWdodCBvZiByZW1vdmluZyB0aGUgYXNzdW1wdGlvbiBvZiBh
IGdsb2JhbApleGVjdXRpb24gb3JkZXJpbmcsIGFub3RoZXIgY2FzdWFsdHkgaXMgdGhlIGVuZ2lu
ZS0+dGltZWxpbmUuIFdpdGhvdXQgYW4KYWN0dWFsIHRpbWVsaW5lIHRvIHRyYWNrLCBpdCBpcyBv
dmVya2lsbCBhbmQgd2UgY2FuIHJlcGxhY2UgaXQgd2l0aCBhCm11Y2ggbGVzcyBncmFuZCBwbGFp
biBsaXN0LiBXZSBzdGlsbCBuZWVkIGEgbGlzdCBvZiByZXF1ZXN0cyBpbmZsaWdodCwKZm9yIHRo
ZSBzaW1wbGUgcHVycG9zZSBvZiBmaW5kaW5nIGluZmxpZ2h0IHJlcXVlc3RzIChmb3IgcmV0aXJp
bmcsCnJlc2V0dGluZywgcHJlZW1wdGlvbiBldGMpLgoKU2lnbmVkLW9mZi1ieTogQ2hyaXMgV2ls
c29uIDxjaHJpc0BjaHJpcy13aWxzb24uY28udWs+Ci0tLQogZHJpdmVycy9ncHUvZHJtL2k5MTUv
Z3QvaW50ZWxfZW5naW5lLmggICAgICAgIHwgIDYgKysKIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2d0
L2ludGVsX2VuZ2luZV9jcy5jICAgICB8IDYyICsrKysrKy0tLS0tLQogZHJpdmVycy9ncHUvZHJt
L2k5MTUvZ3QvaW50ZWxfZW5naW5lX3R5cGVzLmggIHwgIDYgKy0KIGRyaXZlcnMvZ3B1L2RybS9p
OTE1L2d0L2ludGVsX2xyYy5jICAgICAgICAgICB8IDk1ICsrKysrKysrKystLS0tLS0tLS0KIGRy
aXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX3Jlc2V0LmMgICAgICAgICB8IDEwICstCiBkcml2
ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9yaW5nYnVmZmVyLmMgICAgfCAxNSArKy0KIGRyaXZl
cnMvZ3B1L2RybS9pOTE1L2d0L21vY2tfZW5naW5lLmMgICAgICAgICB8IDE4ICsrLS0KIGRyaXZl
cnMvZ3B1L2RybS9pOTE1L2k5MTVfZ3B1X2Vycm9yLmMgICAgICAgICB8ICA1ICstCiBkcml2ZXJz
L2dwdS9kcm0vaTkxNS9pOTE1X3JlcXVlc3QuYyAgICAgICAgICAgfCA0MyArKystLS0tLS0KIGRy
aXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfcmVxdWVzdC5oICAgICAgICAgICB8ICAyICstCiBkcml2
ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3NjaGVkdWxlci5jICAgICAgICAgfCAzNiArKystLS0tCiBk
cml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3RpbWVsaW5lLmMgICAgICAgICAgfCAgMSAtCiBkcml2
ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3RpbWVsaW5lLmggICAgICAgICAgfCAxOSAtLS0tCiBkcml2
ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3RpbWVsaW5lX3R5cGVzLmggICAgfCAgNCAtCiBkcml2ZXJz
L2dwdS9kcm0vaTkxNS9pbnRlbF9ndWNfc3VibWlzc2lvbi5jICAgfCAxNiArKy0tCiAuLi4vZ3B1
L2RybS9pOTE1L3NlbGZ0ZXN0cy9tb2NrX3RpbWVsaW5lLmMgICAgfCAgMSAtCiAxNiBmaWxlcyBj
aGFuZ2VkLCAxNTIgaW5zZXJ0aW9ucygrKSwgMTg3IGRlbGV0aW9ucygtKQoKZGlmZiAtLWdpdCBh
L2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2VuZ2luZS5oIGIvZHJpdmVycy9ncHUvZHJt
L2k5MTUvZ3QvaW50ZWxfZW5naW5lLmgKaW5kZXggMWFlMjkzNGI3ZWNjLi5iOGY1YzRlMWQzOWUg
MTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2VuZ2luZS5oCisrKyBi
L2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2VuZ2luZS5oCkBAIC01NDQsNCArNTQ0LDEw
IEBAIHN0YXRpYyBpbmxpbmUgYm9vbCBpbmplY3RfcHJlZW1wdF9oYW5nKHN0cnVjdCBpbnRlbF9l
bmdpbmVfZXhlY2xpc3RzICpleGVjbGlzdHMpCiAKICNlbmRpZgogCit2b2lkIGludGVsX2VuZ2lu
ZV9pbml0X2FjdGl2ZShzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmUsCisJCQkgICAgICB1
bnNpZ25lZCBpbnQgc3ViY2xhc3MpOworI2RlZmluZSBFTkdJTkVfUEhZU0lDQUwJMAorI2RlZmlu
ZSBFTkdJTkVfTU9DSwkxCisjZGVmaW5lIEVOR0lORV9WSVJUVUFMCTIKKwogI2VuZGlmIC8qIF9J
TlRFTF9SSU5HQlVGRkVSX0hfICovCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9n
dC9pbnRlbF9lbmdpbmVfY3MuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2VuZ2lu
ZV9jcy5jCmluZGV4IDc5NGFhOGIxMTc0Mi4uZjJlMjg1MTA0MzNiIDEwMDY0NAotLS0gYS9kcml2
ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9lbmdpbmVfY3MuYworKysgYi9kcml2ZXJzL2dwdS9k
cm0vaTkxNS9ndC9pbnRlbF9lbmdpbmVfY3MuYwpAQCAtNTY3LDE0ICs1NjcsNyBAQCBzdGF0aWMg
aW50IGludGVsX2VuZ2luZV9zZXR1cF9jb21tb24oc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5n
aW5lKQogCWlmIChlcnIpCiAJCXJldHVybiBlcnI7CiAKLQllcnIgPSBpOTE1X3RpbWVsaW5lX2lu
aXQoZW5naW5lLT5pOTE1LAotCQkJCSAmZW5naW5lLT50aW1lbGluZSwKLQkJCQkgZW5naW5lLT5z
dGF0dXNfcGFnZS52bWEpOwotCWlmIChlcnIpCi0JCWdvdG8gZXJyX2h3c3A7Ci0KLQlpOTE1X3Rp
bWVsaW5lX3NldF9zdWJjbGFzcygmZW5naW5lLT50aW1lbGluZSwgVElNRUxJTkVfRU5HSU5FKTsK
LQorCWludGVsX2VuZ2luZV9pbml0X2FjdGl2ZShlbmdpbmUsIEVOR0lORV9QSFlTSUNBTCk7CiAJ
aW50ZWxfZW5naW5lX2luaXRfYnJlYWRjcnVtYnMoZW5naW5lKTsKIAlpbnRlbF9lbmdpbmVfaW5p
dF9leGVjbGlzdHMoZW5naW5lKTsKIAlpbnRlbF9lbmdpbmVfaW5pdF9oYW5nY2hlY2soZW5naW5l
KTsKQEAgLTU4NywxMCArNTgwLDYgQEAgc3RhdGljIGludCBpbnRlbF9lbmdpbmVfc2V0dXBfY29t
bW9uKHN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZSkKIAkJaW50ZWxfc3NldV9mcm9tX2Rl
dmljZV9pbmZvKCZSVU5USU1FX0lORk8oZW5naW5lLT5pOTE1KS0+c3NldSk7CiAKIAlyZXR1cm4g
MDsKLQotZXJyX2h3c3A6Ci0JY2xlYW51cF9zdGF0dXNfcGFnZShlbmdpbmUpOwotCXJldHVybiBl
cnI7CiB9CiAKIC8qKgpAQCAtNzQ3LDYgKzczNiwyNyBAQCBzdGF0aWMgaW50IHBpbl9jb250ZXh0
KHN0cnVjdCBpOTE1X2dlbV9jb250ZXh0ICpjdHgsCiAJcmV0dXJuIDA7CiB9CiAKK3ZvaWQKK2lu
dGVsX2VuZ2luZV9pbml0X2FjdGl2ZShzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmUsIHVu
c2lnbmVkIGludCBzdWJjbGFzcykKK3sKKwlJTklUX0xJU1RfSEVBRCgmZW5naW5lLT5hY3RpdmUu
cmVxdWVzdHMpOworCisJc3Bpbl9sb2NrX2luaXQoJmVuZ2luZS0+YWN0aXZlLmxvY2spOworCWxv
Y2tkZXBfc2V0X3N1YmNsYXNzKCZlbmdpbmUtPmFjdGl2ZS5sb2NrLCBzdWJjbGFzcyk7CisKKwkv
KgorCSAqIER1ZSB0byBhbiBpbnRlcmVzdGluZyBxdWlyayBpbiBsb2NrZGVwJ3MgaW50ZXJuYWwg
ZGVidWcgdHJhY2tpbmcsCisJICogYWZ0ZXIgc2V0dGluZyBhIHN1YmNsYXNzIHdlIG11c3QgZW5z
dXJlIHRoZSBsb2NrIGlzIHVzZWQuIE90aGVyd2lzZSwKKwkgKiBucl91bnVzZWRfbG9ja3MgaXMg
aW5jcmVtZW50ZWQgb25jZSB0b28gb2Z0ZW4uCisJICovCisjaWZkZWYgQ09ORklHX0RFQlVHX0xP
Q0tfQUxMT0MKKwlsb2NhbF9pcnFfZGlzYWJsZSgpOworCWxvY2tfbWFwX2FjcXVpcmUoJmVuZ2lu
ZS0+YWN0aXZlLmxvY2suZGVwX21hcCk7CisJbG9ja19tYXBfcmVsZWFzZSgmZW5naW5lLT5hY3Rp
dmUubG9jay5kZXBfbWFwKTsKKwlsb2NhbF9pcnFfZW5hYmxlKCk7CisjZW5kaWYKK30KKwogLyoq
CiAgKiBpbnRlbF9lbmdpbmVzX2luaXRfY29tbW9uIC0gaW5pdGlhbGl6ZSBjZW5naW5lIHN0YXRl
IHdoaWNoIG1pZ2h0IHJlcXVpcmUgaHcgYWNjZXNzCiAgKiBAZW5naW5lOiBFbmdpbmUgdG8gaW5p
dGlhbGl6ZS4KQEAgLTgxMCw2ICs4MjAsOCBAQCBpbnQgaW50ZWxfZW5naW5lX2luaXRfY29tbW9u
KHN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZSkKICAqLwogdm9pZCBpbnRlbF9lbmdpbmVf
Y2xlYW51cF9jb21tb24oc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lKQogeworCUdFTV9C
VUdfT04oIWxpc3RfZW1wdHkoJmVuZ2luZS0+YWN0aXZlLnJlcXVlc3RzKSk7CisKIAljbGVhbnVw
X3N0YXR1c19wYWdlKGVuZ2luZSk7CiAKIAlpbnRlbF9lbmdpbmVfZmluaV9icmVhZGNydW1icyhl
bmdpbmUpOwpAQCAtODI0LDggKzgzNiw2IEBAIHZvaWQgaW50ZWxfZW5naW5lX2NsZWFudXBfY29t
bW9uKHN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZSkKIAlpbnRlbF9jb250ZXh0X3VucGlu
KGVuZ2luZS0+a2VybmVsX2NvbnRleHQpOwogCUdFTV9CVUdfT04oIWxsaXN0X2VtcHR5KCZlbmdp
bmUtPmJhcnJpZXJfdGFza3MpKTsKIAotCWk5MTVfdGltZWxpbmVfZmluaSgmZW5naW5lLT50aW1l
bGluZSk7Ci0KIAlpbnRlbF93YV9saXN0X2ZyZWUoJmVuZ2luZS0+Y3R4X3dhX2xpc3QpOwogCWlu
dGVsX3dhX2xpc3RfZnJlZSgmZW5naW5lLT53YV9saXN0KTsKIAlpbnRlbF93YV9saXN0X2ZyZWUo
JmVuZ2luZS0+d2hpdGVsaXN0KTsKQEAgLTE0MzEsMTYgKzE0NDEsNiBAQCB2b2lkIGludGVsX2Vu
Z2luZV9kdW1wKHN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZSwKIAogCWRybV9wcmludGYo
bSwgIlx0UmVxdWVzdHM6XG4iKTsKIAotCXJxID0gbGlzdF9maXJzdF9lbnRyeSgmZW5naW5lLT50
aW1lbGluZS5yZXF1ZXN0cywKLQkJCSAgICAgIHN0cnVjdCBpOTE1X3JlcXVlc3QsIGxpbmspOwot
CWlmICgmcnEtPmxpbmsgIT0gJmVuZ2luZS0+dGltZWxpbmUucmVxdWVzdHMpCi0JCXByaW50X3Jl
cXVlc3QobSwgcnEsICJcdFx0Zmlyc3QgICIpOwotCi0JcnEgPSBsaXN0X2xhc3RfZW50cnkoJmVu
Z2luZS0+dGltZWxpbmUucmVxdWVzdHMsCi0JCQkgICAgIHN0cnVjdCBpOTE1X3JlcXVlc3QsIGxp
bmspOwotCWlmICgmcnEtPmxpbmsgIT0gJmVuZ2luZS0+dGltZWxpbmUucmVxdWVzdHMpCi0JCXBy
aW50X3JlcXVlc3QobSwgcnEsICJcdFx0bGFzdCAgICIpOwotCiAJcnEgPSBpbnRlbF9lbmdpbmVf
ZmluZF9hY3RpdmVfcmVxdWVzdChlbmdpbmUpOwogCWlmIChycSkgewogCQlwcmludF9yZXF1ZXN0
KG0sIHJxLCAiXHRcdGFjdGl2ZSAiKTsKQEAgLTE1MjEsNyArMTUyMSw3IEBAIGludCBpbnRlbF9l
bmFibGVfZW5naW5lX3N0YXRzKHN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZSkKIAlpZiAo
IWludGVsX2VuZ2luZV9zdXBwb3J0c19zdGF0cyhlbmdpbmUpKQogCQlyZXR1cm4gLUVOT0RFVjsK
IAotCXNwaW5fbG9ja19pcnFzYXZlKCZlbmdpbmUtPnRpbWVsaW5lLmxvY2ssIGZsYWdzKTsKKwlz
cGluX2xvY2tfaXJxc2F2ZSgmZW5naW5lLT5hY3RpdmUubG9jaywgZmxhZ3MpOwogCXdyaXRlX3Nl
cWxvY2soJmVuZ2luZS0+c3RhdHMubG9jayk7CiAKIAlpZiAodW5saWtlbHkoZW5naW5lLT5zdGF0
cy5lbmFibGVkID09IH4wKSkgewpAQCAtMTU0Nyw3ICsxNTQ3LDcgQEAgaW50IGludGVsX2VuYWJs
ZV9lbmdpbmVfc3RhdHMoc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lKQogCiB1bmxvY2s6
CiAJd3JpdGVfc2VxdW5sb2NrKCZlbmdpbmUtPnN0YXRzLmxvY2spOwotCXNwaW5fdW5sb2NrX2ly
cXJlc3RvcmUoJmVuZ2luZS0+dGltZWxpbmUubG9jaywgZmxhZ3MpOworCXNwaW5fdW5sb2NrX2ly
cXJlc3RvcmUoJmVuZ2luZS0+YWN0aXZlLmxvY2ssIGZsYWdzKTsKIAogCXJldHVybiBlcnI7CiB9
CkBAIC0xNjMyLDIyICsxNjMyLDIyIEBAIGludGVsX2VuZ2luZV9maW5kX2FjdGl2ZV9yZXF1ZXN0
KHN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZSkKIAkgKiBBdCBhbGwgb3RoZXIgdGltZXMs
IHdlIG11c3QgYXNzdW1lIHRoZSBHUFUgaXMgc3RpbGwgcnVubmluZywgYnV0CiAJICogd2Ugb25s
eSBjYXJlIGFib3V0IHRoZSBzbmFwc2hvdCBvZiB0aGlzIG1vbWVudC4KIAkgKi8KLQlzcGluX2xv
Y2tfaXJxc2F2ZSgmZW5naW5lLT50aW1lbGluZS5sb2NrLCBmbGFncyk7Ci0JbGlzdF9mb3JfZWFj
aF9lbnRyeShyZXF1ZXN0LCAmZW5naW5lLT50aW1lbGluZS5yZXF1ZXN0cywgbGluaykgeworCXNw
aW5fbG9ja19pcnFzYXZlKCZlbmdpbmUtPmFjdGl2ZS5sb2NrLCBmbGFncyk7CisJbGlzdF9mb3Jf
ZWFjaF9lbnRyeShyZXF1ZXN0LCAmZW5naW5lLT5hY3RpdmUucmVxdWVzdHMsIHNjaGVkLmxpbmsp
IHsKIAkJaWYgKGk5MTVfcmVxdWVzdF9jb21wbGV0ZWQocmVxdWVzdCkpCiAJCQljb250aW51ZTsK
IAogCQlpZiAoIWk5MTVfcmVxdWVzdF9zdGFydGVkKHJlcXVlc3QpKQotCQkJYnJlYWs7CisJCQlj
b250aW51ZTsKIAogCQkvKiBNb3JlIHRoYW4gb25lIHByZWVtcHRpYmxlIHJlcXVlc3QgbWF5IG1h
dGNoISAqLwogCQlpZiAoIW1hdGNoX3JpbmcocmVxdWVzdCkpCi0JCQlicmVhazsKKwkJCWNvbnRp
bnVlOwogCiAJCWFjdGl2ZSA9IHJlcXVlc3Q7CiAJCWJyZWFrOwogCX0KLQlzcGluX3VubG9ja19p
cnFyZXN0b3JlKCZlbmdpbmUtPnRpbWVsaW5lLmxvY2ssIGZsYWdzKTsKKwlzcGluX3VubG9ja19p
cnFyZXN0b3JlKCZlbmdpbmUtPmFjdGl2ZS5sb2NrLCBmbGFncyk7CiAKIAlyZXR1cm4gYWN0aXZl
OwogfQpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfZW5naW5lX3R5
cGVzLmggYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9lbmdpbmVfdHlwZXMuaAppbmRl
eCBkM2Q1YTUwNWY2MjEuLmUwMDQ0M2Y1M2I1OSAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJt
L2k5MTUvZ3QvaW50ZWxfZW5naW5lX3R5cGVzLmgKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUv
Z3QvaW50ZWxfZW5naW5lX3R5cGVzLmgKQEAgLTI4Niw3ICsyODYsMTEgQEAgc3RydWN0IGludGVs
X2VuZ2luZV9jcyB7CiAKIAlzdHJ1Y3QgaW50ZWxfcmluZyAqYnVmZmVyOwogCi0Jc3RydWN0IGk5
MTVfdGltZWxpbmUgdGltZWxpbmU7CisJc3RydWN0IHsKKwkJc3BpbmxvY2tfdCBsb2NrOworCQlz
dHJ1Y3QgbGlzdF9oZWFkIHJlcXVlc3RzOworCX0gYWN0aXZlOworCiAJc3RydWN0IGxsaXN0X2hl
YWQgYmFycmllcl90YXNrczsKIAogCXN0cnVjdCBpbnRlbF9jb250ZXh0ICprZXJuZWxfY29udGV4
dDsgLyogcGlubmVkICovCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRl
bF9scmMuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2xyYy5jCmluZGV4IGJjMTM1
YTllNmQ0Mi4uZDM1MGNlYWRmZmM1IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9n
dC9pbnRlbF9scmMuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9scmMuYwpA
QCAtMzExLDggKzMxMSw4IEBAIHN0YXRpYyBpbmxpbmUgYm9vbCBuZWVkX3ByZWVtcHQoY29uc3Qg
c3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lLAogCSAqIENoZWNrIGFnYWluc3QgdGhlIGZp
cnN0IHJlcXVlc3QgaW4gRUxTUFsxXSwgaXQgd2lsbCwgdGhhbmtzIHRvIHRoZQogCSAqIHBvd2Vy
IG9mIFBJLCBiZSB0aGUgaGlnaGVzdCBwcmlvcml0eSBvZiB0aGF0IGNvbnRleHQuCiAJICovCi0J
aWYgKCFsaXN0X2lzX2xhc3QoJnJxLT5saW5rLCAmZW5naW5lLT50aW1lbGluZS5yZXF1ZXN0cykg
JiYKLQkgICAgcnFfcHJpbyhsaXN0X25leHRfZW50cnkocnEsIGxpbmspKSA+IGxhc3RfcHJpbykK
KwlpZiAoIWxpc3RfaXNfbGFzdCgmcnEtPnNjaGVkLmxpbmssICZlbmdpbmUtPmFjdGl2ZS5yZXF1
ZXN0cykgJiYKKwkgICAgcnFfcHJpbyhsaXN0X25leHRfZW50cnkocnEsIHNjaGVkLmxpbmspKSA+
IGxhc3RfcHJpbykKIAkJcmV0dXJuIHRydWU7CiAKIAlpZiAocmIpIHsKQEAgLTQ0NywxMSArNDQ3
LDExIEBAIF9fdW53aW5kX2luY29tcGxldGVfcmVxdWVzdHMoc3RydWN0IGludGVsX2VuZ2luZV9j
cyAqZW5naW5lLCBpbnQgYm9vc3QpCiAJc3RydWN0IGxpc3RfaGVhZCAqdW5pbml0aWFsaXplZF92
YXIocGwpOwogCWludCBwcmlvID0gSTkxNV9QUklPUklUWV9JTlZBTElEIHwgYm9vc3Q7CiAKLQls
b2NrZGVwX2Fzc2VydF9oZWxkKCZlbmdpbmUtPnRpbWVsaW5lLmxvY2spOworCWxvY2tkZXBfYXNz
ZXJ0X2hlbGQoJmVuZ2luZS0+YWN0aXZlLmxvY2spOwogCiAJbGlzdF9mb3JfZWFjaF9lbnRyeV9z
YWZlX3JldmVyc2UocnEsIHJuLAotCQkJCQkgJmVuZ2luZS0+dGltZWxpbmUucmVxdWVzdHMsCi0J
CQkJCSBsaW5rKSB7CisJCQkJCSAmZW5naW5lLT5hY3RpdmUucmVxdWVzdHMsCisJCQkJCSBzY2hl
ZC5saW5rKSB7CiAJCXN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKm93bmVyOwogCiAJCWlmIChpOTE1
X3JlcXVlc3RfY29tcGxldGVkKHJxKSkKQEAgLTQ3OCw3ICs0NzgsNyBAQCBfX3Vud2luZF9pbmNv
bXBsZXRlX3JlcXVlc3RzKHN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZSwgaW50IGJvb3N0
KQogCQkJfQogCQkJR0VNX0JVR19PTihSQl9FTVBUWV9ST09UKCZlbmdpbmUtPmV4ZWNsaXN0cy5x
dWV1ZS5yYl9yb290KSk7CiAKLQkJCWxpc3RfYWRkKCZycS0+c2NoZWQubGluaywgcGwpOworCQkJ
bGlzdF9tb3ZlKCZycS0+c2NoZWQubGluaywgcGwpOwogCQkJYWN0aXZlID0gcnE7CiAJCX0gZWxz
ZSB7CiAJCQlpZiAoX19pOTE1X3JlcXVlc3RfaGFzX3N0YXJ0ZWQocnEpKQpAQCAtOTc1LDExICs5
NzUsMTEgQEAgc3RhdGljIHZvaWQgZXhlY2xpc3RzX2RlcXVldWUoc3RydWN0IGludGVsX2VuZ2lu
ZV9jcyAqZW5naW5lKQogCQkJcmJfZW50cnkocmIsIHR5cGVvZigqdmUpLCBub2Rlc1tlbmdpbmUt
PmlkXS5yYik7CiAJCXN0cnVjdCBpOTE1X3JlcXVlc3QgKnJxOwogCi0JCXNwaW5fbG9jaygmdmUt
PmJhc2UudGltZWxpbmUubG9jayk7CisJCXNwaW5fbG9jaygmdmUtPmJhc2UuYWN0aXZlLmxvY2sp
OwogCiAJCXJxID0gdmUtPnJlcXVlc3Q7CiAJCWlmICh1bmxpa2VseSghcnEpKSB7IC8qIGxvc3Qg
dGhlIHJhY2UgdG8gYSBzaWJsaW5nICovCi0JCQlzcGluX3VubG9jaygmdmUtPmJhc2UudGltZWxp
bmUubG9jayk7CisJCQlzcGluX3VubG9jaygmdmUtPmJhc2UuYWN0aXZlLmxvY2spOwogCQkJcmJf
ZXJhc2VfY2FjaGVkKHJiLCAmZXhlY2xpc3RzLT52aXJ0dWFsKTsKIAkJCVJCX0NMRUFSX05PREUo
cmIpOwogCQkJcmIgPSByYl9maXJzdF9jYWNoZWQoJmV4ZWNsaXN0cy0+dmlydHVhbCk7CkBAIC05
OTIsMTMgKzk5MiwxMyBAQCBzdGF0aWMgdm9pZCBleGVjbGlzdHNfZGVxdWV1ZShzdHJ1Y3QgaW50
ZWxfZW5naW5lX2NzICplbmdpbmUpCiAKIAkJaWYgKHJxX3ByaW8ocnEpID49IHF1ZXVlX3ByaW8o
ZXhlY2xpc3RzKSkgewogCQkJaWYgKCF2aXJ0dWFsX21hdGNoZXModmUsIHJxLCBlbmdpbmUpKSB7
Ci0JCQkJc3Bpbl91bmxvY2soJnZlLT5iYXNlLnRpbWVsaW5lLmxvY2spOworCQkJCXNwaW5fdW5s
b2NrKCZ2ZS0+YmFzZS5hY3RpdmUubG9jayk7CiAJCQkJcmIgPSByYl9uZXh0KHJiKTsKIAkJCQlj
b250aW51ZTsKIAkJCX0KIAogCQkJaWYgKGxhc3QgJiYgIWNhbl9tZXJnZV9ycShsYXN0LCBycSkp
IHsKLQkJCQlzcGluX3VubG9jaygmdmUtPmJhc2UudGltZWxpbmUubG9jayk7CisJCQkJc3Bpbl91
bmxvY2soJnZlLT5iYXNlLmFjdGl2ZS5sb2NrKTsKIAkJCQlyZXR1cm47IC8qIGxlYXZlIHRoaXMg
cnEgZm9yIGFub3RoZXIgZW5naW5lICovCiAJCQl9CiAKQEAgLTEwNTMsNyArMTA1Myw3IEBAIHN0
YXRpYyB2b2lkIGV4ZWNsaXN0c19kZXF1ZXVlKHN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2lu
ZSkKIAkJCWxhc3QgPSBycTsKIAkJfQogCi0JCXNwaW5fdW5sb2NrKCZ2ZS0+YmFzZS50aW1lbGlu
ZS5sb2NrKTsKKwkJc3Bpbl91bmxvY2soJnZlLT5iYXNlLmFjdGl2ZS5sb2NrKTsKIAkJYnJlYWs7
CiAJfQogCkBAIC0xMTEwLDggKzExMTAsNiBAQCBzdGF0aWMgdm9pZCBleGVjbGlzdHNfZGVxdWV1
ZShzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmUpCiAJCQkJR0VNX0JVR19PTihwb3J0X2lz
c2V0KHBvcnQpKTsKIAkJCX0KIAotCQkJbGlzdF9kZWxfaW5pdCgmcnEtPnNjaGVkLmxpbmspOwot
CiAJCQlfX2k5MTVfcmVxdWVzdF9zdWJtaXQocnEpOwogCQkJdHJhY2VfaTkxNV9yZXF1ZXN0X2lu
KHJxLCBwb3J0X2luZGV4KHBvcnQsIGV4ZWNsaXN0cykpOwogCkBAIC0xMjEyLDcgKzEyMTAsNyBA
QCBzdGF0aWMgdm9pZCBwcm9jZXNzX2NzYihzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmUp
CiAJY29uc3QgdTggbnVtX2VudHJpZXMgPSBleGVjbGlzdHMtPmNzYl9zaXplOwogCXU4IGhlYWQs
IHRhaWw7CiAKLQlsb2NrZGVwX2Fzc2VydF9oZWxkKCZlbmdpbmUtPnRpbWVsaW5lLmxvY2spOwor
CWxvY2tkZXBfYXNzZXJ0X2hlbGQoJmVuZ2luZS0+YWN0aXZlLmxvY2spOwogCiAJLyoKIAkgKiBO
b3RlIHRoYXQgY3NiX3dyaXRlLCBjc2Jfc3RhdHVzIG1heSBiZSBlaXRoZXIgaW4gSFdTUCBvciBt
bWlvLgpAQCAtMTM3Miw3ICsxMzcwLDcgQEAgc3RhdGljIHZvaWQgcHJvY2Vzc19jc2Ioc3RydWN0
IGludGVsX2VuZ2luZV9jcyAqZW5naW5lKQogCiBzdGF0aWMgdm9pZCBfX2V4ZWNsaXN0c19zdWJt
aXNzaW9uX3Rhc2tsZXQoc3RydWN0IGludGVsX2VuZ2luZV9jcyAqY29uc3QgZW5naW5lKQogewot
CWxvY2tkZXBfYXNzZXJ0X2hlbGQoJmVuZ2luZS0+dGltZWxpbmUubG9jayk7CisJbG9ja2RlcF9h
c3NlcnRfaGVsZCgmZW5naW5lLT5hY3RpdmUubG9jayk7CiAKIAlwcm9jZXNzX2NzYihlbmdpbmUp
OwogCWlmICghZXhlY2xpc3RzX2lzX2FjdGl2ZSgmZW5naW5lLT5leGVjbGlzdHMsIEVYRUNMSVNU
U19BQ1RJVkVfUFJFRU1QVCkpCkBAIC0xMzkzLDE1ICsxMzkxLDE2IEBAIHN0YXRpYyB2b2lkIGV4
ZWNsaXN0c19zdWJtaXNzaW9uX3Rhc2tsZXQodW5zaWduZWQgbG9uZyBkYXRhKQogCQkgICEhaW50
ZWxfd2FrZXJlZl9hY3RpdmUoJmVuZ2luZS0+d2FrZXJlZiksCiAJCSAgZW5naW5lLT5leGVjbGlz
dHMuYWN0aXZlKTsKIAotCXNwaW5fbG9ja19pcnFzYXZlKCZlbmdpbmUtPnRpbWVsaW5lLmxvY2ss
IGZsYWdzKTsKKwlzcGluX2xvY2tfaXJxc2F2ZSgmZW5naW5lLT5hY3RpdmUubG9jaywgZmxhZ3Mp
OwogCV9fZXhlY2xpc3RzX3N1Ym1pc3Npb25fdGFza2xldChlbmdpbmUpOwotCXNwaW5fdW5sb2Nr
X2lycXJlc3RvcmUoJmVuZ2luZS0+dGltZWxpbmUubG9jaywgZmxhZ3MpOworCXNwaW5fdW5sb2Nr
X2lycXJlc3RvcmUoJmVuZ2luZS0+YWN0aXZlLmxvY2ssIGZsYWdzKTsKIH0KIAogc3RhdGljIHZv
aWQgcXVldWVfcmVxdWVzdChzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmUsCiAJCQkgIHN0
cnVjdCBpOTE1X3NjaGVkX25vZGUgKm5vZGUsCiAJCQkgIGludCBwcmlvKQogeworCUdFTV9CVUdf
T04oIWxpc3RfZW1wdHkoJm5vZGUtPmxpbmspKTsKIAlsaXN0X2FkZF90YWlsKCZub2RlLT5saW5r
LCBpOTE1X3NjaGVkX2xvb2t1cF9wcmlvbGlzdChlbmdpbmUsIHByaW8pKTsKIH0KIApAQCAtMTQz
Miw3ICsxNDMxLDcgQEAgc3RhdGljIHZvaWQgZXhlY2xpc3RzX3N1Ym1pdF9yZXF1ZXN0KHN0cnVj
dCBpOTE1X3JlcXVlc3QgKnJlcXVlc3QpCiAJdW5zaWduZWQgbG9uZyBmbGFnczsKIAogCS8qIFdp
bGwgYmUgY2FsbGVkIGZyb20gaXJxLWNvbnRleHQgd2hlbiB1c2luZyBmb3JlaWduIGZlbmNlcy4g
Ki8KLQlzcGluX2xvY2tfaXJxc2F2ZSgmZW5naW5lLT50aW1lbGluZS5sb2NrLCBmbGFncyk7CisJ
c3Bpbl9sb2NrX2lycXNhdmUoJmVuZ2luZS0+YWN0aXZlLmxvY2ssIGZsYWdzKTsKIAogCXF1ZXVl
X3JlcXVlc3QoZW5naW5lLCAmcmVxdWVzdC0+c2NoZWQsIHJxX3ByaW8ocmVxdWVzdCkpOwogCkBA
IC0xNDQxLDcgKzE0NDAsNyBAQCBzdGF0aWMgdm9pZCBleGVjbGlzdHNfc3VibWl0X3JlcXVlc3Qo
c3RydWN0IGk5MTVfcmVxdWVzdCAqcmVxdWVzdCkKIAogCXN1Ym1pdF9xdWV1ZShlbmdpbmUsIHJx
X3ByaW8ocmVxdWVzdCkpOwogCi0Jc3Bpbl91bmxvY2tfaXJxcmVzdG9yZSgmZW5naW5lLT50aW1l
bGluZS5sb2NrLCBmbGFncyk7CisJc3Bpbl91bmxvY2tfaXJxcmVzdG9yZSgmZW5naW5lLT5hY3Rp
dmUubG9jaywgZmxhZ3MpOwogfQogCiBzdGF0aWMgdm9pZCBfX2V4ZWNsaXN0c19jb250ZXh0X2Zp
bmkoc3RydWN0IGludGVsX2NvbnRleHQgKmNlKQpAQCAtMjA5Miw4ICsyMDkxLDggQEAgc3RhdGlj
IHZvaWQgZXhlY2xpc3RzX3Jlc2V0X3ByZXBhcmUoc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5n
aW5lKQogCWludGVsX2VuZ2luZV9zdG9wX2NzKGVuZ2luZSk7CiAKIAkvKiBBbmQgZmx1c2ggYW55
IGN1cnJlbnQgZGlyZWN0IHN1Ym1pc3Npb24uICovCi0Jc3Bpbl9sb2NrX2lycXNhdmUoJmVuZ2lu
ZS0+dGltZWxpbmUubG9jaywgZmxhZ3MpOwotCXNwaW5fdW5sb2NrX2lycXJlc3RvcmUoJmVuZ2lu
ZS0+dGltZWxpbmUubG9jaywgZmxhZ3MpOworCXNwaW5fbG9ja19pcnFzYXZlKCZlbmdpbmUtPmFj
dGl2ZS5sb2NrLCBmbGFncyk7CisJc3Bpbl91bmxvY2tfaXJxcmVzdG9yZSgmZW5naW5lLT5hY3Rp
dmUubG9jaywgZmxhZ3MpOwogfQogCiBzdGF0aWMgYm9vbCBscmNfcmVnc19vayhjb25zdCBzdHJ1
Y3QgaTkxNV9yZXF1ZXN0ICpycSkKQEAgLTIxMzYsMTEgKzIxMzUsMTEgQEAgc3RhdGljIHZvaWQg
cmVzZXRfY3NiX3BvaW50ZXJzKHN0cnVjdCBpbnRlbF9lbmdpbmVfZXhlY2xpc3RzICpleGVjbGlz
dHMpCiAKIHN0YXRpYyBzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICphY3RpdmVfcmVxdWVzdChzdHJ1Y3Qg
aTkxNV9yZXF1ZXN0ICpycSkKIHsKLQljb25zdCBzdHJ1Y3QgbGlzdF9oZWFkICogY29uc3QgbGlz
dCA9ICZycS0+ZW5naW5lLT50aW1lbGluZS5yZXF1ZXN0czsKKwljb25zdCBzdHJ1Y3QgbGlzdF9o
ZWFkICogY29uc3QgbGlzdCA9ICZycS0+ZW5naW5lLT5hY3RpdmUucmVxdWVzdHM7CiAJY29uc3Qg
c3RydWN0IGludGVsX2NvbnRleHQgKiBjb25zdCBjb250ZXh0ID0gcnEtPmh3X2NvbnRleHQ7CiAJ
c3RydWN0IGk5MTVfcmVxdWVzdCAqYWN0aXZlID0gTlVMTDsKIAotCWxpc3RfZm9yX2VhY2hfZW50
cnlfZnJvbV9yZXZlcnNlKHJxLCBsaXN0LCBsaW5rKSB7CisJbGlzdF9mb3JfZWFjaF9lbnRyeV9m
cm9tX3JldmVyc2UocnEsIGxpc3QsIHNjaGVkLmxpbmspIHsKIAkJaWYgKGk5MTVfcmVxdWVzdF9j
b21wbGV0ZWQocnEpKQogCQkJYnJlYWs7CiAKQEAgLTIyNTcsMTEgKzIyNTYsMTEgQEAgc3RhdGlj
IHZvaWQgZXhlY2xpc3RzX3Jlc2V0KHN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZSwgYm9v
bCBzdGFsbGVkKQogCiAJR0VNX1RSQUNFKCIlc1xuIiwgZW5naW5lLT5uYW1lKTsKIAotCXNwaW5f
bG9ja19pcnFzYXZlKCZlbmdpbmUtPnRpbWVsaW5lLmxvY2ssIGZsYWdzKTsKKwlzcGluX2xvY2tf
aXJxc2F2ZSgmZW5naW5lLT5hY3RpdmUubG9jaywgZmxhZ3MpOwogCiAJX19leGVjbGlzdHNfcmVz
ZXQoZW5naW5lLCBzdGFsbGVkKTsKIAotCXNwaW5fdW5sb2NrX2lycXJlc3RvcmUoJmVuZ2luZS0+
dGltZWxpbmUubG9jaywgZmxhZ3MpOworCXNwaW5fdW5sb2NrX2lycXJlc3RvcmUoJmVuZ2luZS0+
YWN0aXZlLmxvY2ssIGZsYWdzKTsKIH0KIAogc3RhdGljIHZvaWQgbm9wX3N1Ym1pc3Npb25fdGFz
a2xldCh1bnNpZ25lZCBsb25nIGRhdGEpCkBAIC0yMjkyLDEyICsyMjkxLDEyIEBAIHN0YXRpYyB2
b2lkIGV4ZWNsaXN0c19jYW5jZWxfcmVxdWVzdHMoc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5n
aW5lKQogCSAqIHN1Ym1pc3Npb24ncyBpcnEgc3RhdGUsIHdlIGFsc28gd2lzaCB0byByZW1pbmQg
b3Vyc2VsdmVzIHRoYXQKIAkgKiBpdCBpcyBpcnEgc3RhdGUuKQogCSAqLwotCXNwaW5fbG9ja19p
cnFzYXZlKCZlbmdpbmUtPnRpbWVsaW5lLmxvY2ssIGZsYWdzKTsKKwlzcGluX2xvY2tfaXJxc2F2
ZSgmZW5naW5lLT5hY3RpdmUubG9jaywgZmxhZ3MpOwogCiAJX19leGVjbGlzdHNfcmVzZXQoZW5n
aW5lLCB0cnVlKTsKIAogCS8qIE1hcmsgYWxsIGV4ZWN1dGluZyByZXF1ZXN0cyBhcyBza2lwcGVk
LiAqLwotCWxpc3RfZm9yX2VhY2hfZW50cnkocnEsICZlbmdpbmUtPnRpbWVsaW5lLnJlcXVlc3Rz
LCBsaW5rKSB7CisJbGlzdF9mb3JfZWFjaF9lbnRyeShycSwgJmVuZ2luZS0+YWN0aXZlLnJlcXVl
c3RzLCBzY2hlZC5saW5rKSB7CiAJCWlmICghaTkxNV9yZXF1ZXN0X3NpZ25hbGVkKHJxKSkKIAkJ
CWRtYV9mZW5jZV9zZXRfZXJyb3IoJnJxLT5mZW5jZSwgLUVJTyk7CiAKQEAgLTIzMjgsNyArMjMy
Nyw3IEBAIHN0YXRpYyB2b2lkIGV4ZWNsaXN0c19jYW5jZWxfcmVxdWVzdHMoc3RydWN0IGludGVs
X2VuZ2luZV9jcyAqZW5naW5lKQogCQlyYl9lcmFzZV9jYWNoZWQocmIsICZleGVjbGlzdHMtPnZp
cnR1YWwpOwogCQlSQl9DTEVBUl9OT0RFKHJiKTsKIAotCQlzcGluX2xvY2soJnZlLT5iYXNlLnRp
bWVsaW5lLmxvY2spOworCQlzcGluX2xvY2soJnZlLT5iYXNlLmFjdGl2ZS5sb2NrKTsKIAkJaWYg
KHZlLT5yZXF1ZXN0KSB7CiAJCQl2ZS0+cmVxdWVzdC0+ZW5naW5lID0gZW5naW5lOwogCQkJX19p
OTE1X3JlcXVlc3Rfc3VibWl0KHZlLT5yZXF1ZXN0KTsKQEAgLTIzMzcsNyArMjMzNiw3IEBAIHN0
YXRpYyB2b2lkIGV4ZWNsaXN0c19jYW5jZWxfcmVxdWVzdHMoc3RydWN0IGludGVsX2VuZ2luZV9j
cyAqZW5naW5lKQogCQkJdmUtPmJhc2UuZXhlY2xpc3RzLnF1ZXVlX3ByaW9yaXR5X2hpbnQgPSBJ
TlRfTUlOOwogCQkJdmUtPnJlcXVlc3QgPSBOVUxMOwogCQl9Ci0JCXNwaW5fdW5sb2NrKCZ2ZS0+
YmFzZS50aW1lbGluZS5sb2NrKTsKKwkJc3Bpbl91bmxvY2soJnZlLT5iYXNlLmFjdGl2ZS5sb2Nr
KTsKIAl9CiAKIAkvKiBSZW1haW5pbmcgX3VucmVhZHlfIHJlcXVlc3RzIHdpbGwgYmUgbm9wJ2Vk
IHdoZW4gc3VibWl0dGVkICovCkBAIC0yMzQ5LDcgKzIzNDgsNyBAQCBzdGF0aWMgdm9pZCBleGVj
bGlzdHNfY2FuY2VsX3JlcXVlc3RzKHN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZSkKIAlH
RU1fQlVHX09OKF9fdGFza2xldF9pc19lbmFibGVkKCZleGVjbGlzdHMtPnRhc2tsZXQpKTsKIAll
eGVjbGlzdHMtPnRhc2tsZXQuZnVuYyA9IG5vcF9zdWJtaXNzaW9uX3Rhc2tsZXQ7CiAKLQlzcGlu
X3VubG9ja19pcnFyZXN0b3JlKCZlbmdpbmUtPnRpbWVsaW5lLmxvY2ssIGZsYWdzKTsKKwlzcGlu
X3VubG9ja19pcnFyZXN0b3JlKCZlbmdpbmUtPmFjdGl2ZS5sb2NrLCBmbGFncyk7CiB9CiAKIHN0
YXRpYyB2b2lkIGV4ZWNsaXN0c19yZXNldF9maW5pc2goc3RydWN0IGludGVsX2VuZ2luZV9jcyAq
ZW5naW5lKQpAQCAtMzA1MCwxMiArMzA0OSwxOCBAQCBzdGF0aWMgaW50IGV4ZWNsaXN0c19jb250
ZXh0X2RlZmVycmVkX2FsbG9jKHN0cnVjdCBpbnRlbF9jb250ZXh0ICpjZSwKIAlyZXR1cm4gcmV0
OwogfQogCitzdGF0aWMgc3RydWN0IGxpc3RfaGVhZCAqdmlydHVhbF9xdWV1ZShzdHJ1Y3Qgdmly
dHVhbF9lbmdpbmUgKnZlKQoreworCXJldHVybiAmdmUtPmJhc2UuZXhlY2xpc3RzLmRlZmF1bHRf
cHJpb2xpc3QucmVxdWVzdHNbMF07Cit9CisKIHN0YXRpYyB2b2lkIHZpcnR1YWxfY29udGV4dF9k
ZXN0cm95KHN0cnVjdCBrcmVmICprcmVmKQogewogCXN0cnVjdCB2aXJ0dWFsX2VuZ2luZSAqdmUg
PQogCQljb250YWluZXJfb2Yoa3JlZiwgdHlwZW9mKCp2ZSksIGNvbnRleHQucmVmKTsKIAl1bnNp
Z25lZCBpbnQgbjsKIAorCUdFTV9CVUdfT04oIWxpc3RfZW1wdHkodmlydHVhbF9xdWV1ZSh2ZSkp
KTsKIAlHRU1fQlVHX09OKHZlLT5yZXF1ZXN0KTsKIAlHRU1fQlVHX09OKHZlLT5jb250ZXh0Lmlu
ZmxpZ2h0KTsKIApAQCAtMzA2NiwxMyArMzA3MSwxMyBAQCBzdGF0aWMgdm9pZCB2aXJ0dWFsX2Nv
bnRleHRfZGVzdHJveShzdHJ1Y3Qga3JlZiAqa3JlZikKIAkJaWYgKFJCX0VNUFRZX05PREUobm9k
ZSkpCiAJCQljb250aW51ZTsKIAotCQlzcGluX2xvY2tfaXJxKCZzaWJsaW5nLT50aW1lbGluZS5s
b2NrKTsKKwkJc3Bpbl9sb2NrX2lycSgmc2libGluZy0+YWN0aXZlLmxvY2spOwogCiAJCS8qIERl
dGFjaG1lbnQgaXMgbGF6aWx5IHBlcmZvcm1lZCBpbiB0aGUgZXhlY2xpc3RzIHRhc2tsZXQgKi8K
IAkJaWYgKCFSQl9FTVBUWV9OT0RFKG5vZGUpKQogCQkJcmJfZXJhc2VfY2FjaGVkKG5vZGUsICZz
aWJsaW5nLT5leGVjbGlzdHMudmlydHVhbCk7CiAKLQkJc3Bpbl91bmxvY2tfaXJxKCZzaWJsaW5n
LT50aW1lbGluZS5sb2NrKTsKKwkJc3Bpbl91bmxvY2tfaXJxKCZzaWJsaW5nLT5hY3RpdmUubG9j
ayk7CiAJfQogCUdFTV9CVUdfT04oX190YXNrbGV0X2lzX3NjaGVkdWxlZCgmdmUtPmJhc2UuZXhl
Y2xpc3RzLnRhc2tsZXQpKTsKIApAQCAtMzA4MCw4ICszMDg1LDYgQEAgc3RhdGljIHZvaWQgdmly
dHVhbF9jb250ZXh0X2Rlc3Ryb3koc3RydWN0IGtyZWYgKmtyZWYpCiAJCV9fZXhlY2xpc3RzX2Nv
bnRleHRfZmluaSgmdmUtPmNvbnRleHQpOwogCiAJa2ZyZWUodmUtPmJvbmRzKTsKLQotCWk5MTVf
dGltZWxpbmVfZmluaSgmdmUtPmJhc2UudGltZWxpbmUpOwogCWtmcmVlKHZlKTsKIH0KIApAQCAt
MzIwMSwxNiArMzIwNCwxNiBAQCBzdGF0aWMgdm9pZCB2aXJ0dWFsX3N1Ym1pc3Npb25fdGFza2xl
dCh1bnNpZ25lZCBsb25nIGRhdGEpCiAKIAkJaWYgKHVubGlrZWx5KCEobWFzayAmIHNpYmxpbmct
Pm1hc2spKSkgewogCQkJaWYgKCFSQl9FTVBUWV9OT0RFKCZub2RlLT5yYikpIHsKLQkJCQlzcGlu
X2xvY2soJnNpYmxpbmctPnRpbWVsaW5lLmxvY2spOworCQkJCXNwaW5fbG9jaygmc2libGluZy0+
YWN0aXZlLmxvY2spOwogCQkJCXJiX2VyYXNlX2NhY2hlZCgmbm9kZS0+cmIsCiAJCQkJCQkmc2li
bGluZy0+ZXhlY2xpc3RzLnZpcnR1YWwpOwogCQkJCVJCX0NMRUFSX05PREUoJm5vZGUtPnJiKTsK
LQkJCQlzcGluX3VubG9jaygmc2libGluZy0+dGltZWxpbmUubG9jayk7CisJCQkJc3Bpbl91bmxv
Y2soJnNpYmxpbmctPmFjdGl2ZS5sb2NrKTsKIAkJCX0KIAkJCWNvbnRpbnVlOwogCQl9CiAKLQkJ
c3Bpbl9sb2NrKCZzaWJsaW5nLT50aW1lbGluZS5sb2NrKTsKKwkJc3Bpbl9sb2NrKCZzaWJsaW5n
LT5hY3RpdmUubG9jayk7CiAKIAkJaWYgKCFSQl9FTVBUWV9OT0RFKCZub2RlLT5yYikpIHsKIAkJ
CS8qCkBAIC0zMjU0LDcgKzMyNTcsNyBAQCBzdGF0aWMgdm9pZCB2aXJ0dWFsX3N1Ym1pc3Npb25f
dGFza2xldCh1bnNpZ25lZCBsb25nIGRhdGEpCiAJCQl0YXNrbGV0X2hpX3NjaGVkdWxlKCZzaWJs
aW5nLT5leGVjbGlzdHMudGFza2xldCk7CiAJCX0KIAotCQlzcGluX3VubG9jaygmc2libGluZy0+
dGltZWxpbmUubG9jayk7CisJCXNwaW5fdW5sb2NrKCZzaWJsaW5nLT5hY3RpdmUubG9jayk7CiAJ
fQogCWxvY2FsX2lycV9lbmFibGUoKTsKIH0KQEAgLTMyNzEsOSArMzI3NCwxMyBAQCBzdGF0aWMg
dm9pZCB2aXJ0dWFsX3N1Ym1pdF9yZXF1ZXN0KHN0cnVjdCBpOTE1X3JlcXVlc3QgKnJxKQogCUdF
TV9CVUdfT04odmUtPmJhc2Uuc3VibWl0X3JlcXVlc3QgIT0gdmlydHVhbF9zdWJtaXRfcmVxdWVz
dCk7CiAKIAlHRU1fQlVHX09OKHZlLT5yZXF1ZXN0KTsKKwlHRU1fQlVHX09OKCFsaXN0X2VtcHR5
KHZpcnR1YWxfcXVldWUodmUpKSk7CisKIAl2ZS0+YmFzZS5leGVjbGlzdHMucXVldWVfcHJpb3Jp
dHlfaGludCA9IHJxX3ByaW8ocnEpOwogCVdSSVRFX09OQ0UodmUtPnJlcXVlc3QsIHJxKTsKIAor
CWxpc3RfbW92ZV90YWlsKCZycS0+c2NoZWQubGluaywgdmlydHVhbF9xdWV1ZSh2ZSkpOworCiAJ
dGFza2xldF9zY2hlZHVsZSgmdmUtPmJhc2UuZXhlY2xpc3RzLnRhc2tsZXQpOwogfQogCkBAIC0z
MzM3LDEwICszMzQ0LDcgQEAgaW50ZWxfZXhlY2xpc3RzX2NyZWF0ZV92aXJ0dWFsKHN0cnVjdCBp
OTE1X2dlbV9jb250ZXh0ICpjdHgsCiAKIAlzbnByaW50Zih2ZS0+YmFzZS5uYW1lLCBzaXplb2Yo
dmUtPmJhc2UubmFtZSksICJ2aXJ0dWFsIik7CiAKLQllcnIgPSBpOTE1X3RpbWVsaW5lX2luaXQo
Y3R4LT5pOTE1LCAmdmUtPmJhc2UudGltZWxpbmUsIE5VTEwpOwotCWlmIChlcnIpCi0JCWdvdG8g
ZXJyX3B1dDsKLQlpOTE1X3RpbWVsaW5lX3NldF9zdWJjbGFzcygmdmUtPmJhc2UudGltZWxpbmUs
IFRJTUVMSU5FX1ZJUlRVQUwpOworCWludGVsX2VuZ2luZV9pbml0X2FjdGl2ZSgmdmUtPmJhc2Us
IEVOR0lORV9WSVJUVUFMKTsKIAogCWludGVsX2VuZ2luZV9pbml0X2V4ZWNsaXN0cygmdmUtPmJh
c2UpOwogCkBAIC0zMzUxLDYgKzMzNTUsNyBAQCBpbnRlbF9leGVjbGlzdHNfY3JlYXRlX3ZpcnR1
YWwoc3RydWN0IGk5MTVfZ2VtX2NvbnRleHQgKmN0eCwKIAl2ZS0+YmFzZS5zdWJtaXRfcmVxdWVz
dCA9IHZpcnR1YWxfc3VibWl0X3JlcXVlc3Q7CiAJdmUtPmJhc2UuYm9uZF9leGVjdXRlID0gdmly
dHVhbF9ib25kX2V4ZWN1dGU7CiAKKwlJTklUX0xJU1RfSEVBRCh2aXJ0dWFsX3F1ZXVlKHZlKSk7
CiAJdmUtPmJhc2UuZXhlY2xpc3RzLnF1ZXVlX3ByaW9yaXR5X2hpbnQgPSBJTlRfTUlOOwogCXRh
c2tsZXRfaW5pdCgmdmUtPmJhc2UuZXhlY2xpc3RzLnRhc2tsZXQsCiAJCSAgICAgdmlydHVhbF9z
dWJtaXNzaW9uX3Rhc2tsZXQsCkBAIC0zNTA1LDExICszNTEwLDExIEBAIHZvaWQgaW50ZWxfZXhl
Y2xpc3RzX3Nob3dfcmVxdWVzdHMoc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lLAogCXVu
c2lnbmVkIGludCBjb3VudDsKIAlzdHJ1Y3QgcmJfbm9kZSAqcmI7CiAKLQlzcGluX2xvY2tfaXJx
c2F2ZSgmZW5naW5lLT50aW1lbGluZS5sb2NrLCBmbGFncyk7CisJc3Bpbl9sb2NrX2lycXNhdmUo
JmVuZ2luZS0+YWN0aXZlLmxvY2ssIGZsYWdzKTsKIAogCWxhc3QgPSBOVUxMOwogCWNvdW50ID0g
MDsKLQlsaXN0X2Zvcl9lYWNoX2VudHJ5KHJxLCAmZW5naW5lLT50aW1lbGluZS5yZXF1ZXN0cywg
bGluaykgeworCWxpc3RfZm9yX2VhY2hfZW50cnkocnEsICZlbmdpbmUtPmFjdGl2ZS5yZXF1ZXN0
cywgc2NoZWQubGluaykgewogCQlpZiAoY291bnQrKyA8IG1heCAtIDEpCiAJCQlzaG93X3JlcXVl
c3QobSwgcnEsICJcdFx0RSAiKTsKIAkJZWxzZQpAQCAtMzU3Miw3ICszNTc3LDcgQEAgdm9pZCBp
bnRlbF9leGVjbGlzdHNfc2hvd19yZXF1ZXN0cyhzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdp
bmUsCiAJCXNob3dfcmVxdWVzdChtLCBsYXN0LCAiXHRcdFYgIik7CiAJfQogCi0Jc3Bpbl91bmxv
Y2tfaXJxcmVzdG9yZSgmZW5naW5lLT50aW1lbGluZS5sb2NrLCBmbGFncyk7CisJc3Bpbl91bmxv
Y2tfaXJxcmVzdG9yZSgmZW5naW5lLT5hY3RpdmUubG9jaywgZmxhZ3MpOwogfQogCiB2b2lkIGlu
dGVsX2xyX2NvbnRleHRfcmVzZXQoc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lLApkaWZm
IC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfcmVzZXQuYyBiL2RyaXZlcnMv
Z3B1L2RybS9pOTE1L2d0L2ludGVsX3Jlc2V0LmMKaW5kZXggYWE2MDVkNzlmYTk0Li4yYjBiMDgw
OTZlYTUgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX3Jlc2V0LmMK
KysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfcmVzZXQuYwpAQCAtNDksMTIgKzQ5
LDEyIEBAIHN0YXRpYyB2b2lkIGVuZ2luZV9za2lwX2NvbnRleHQoc3RydWN0IGk5MTVfcmVxdWVz
dCAqcnEpCiAJc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lID0gcnEtPmVuZ2luZTsKIAlz
dHJ1Y3QgaTkxNV9nZW1fY29udGV4dCAqaHVuZ19jdHggPSBycS0+Z2VtX2NvbnRleHQ7CiAKLQls
b2NrZGVwX2Fzc2VydF9oZWxkKCZlbmdpbmUtPnRpbWVsaW5lLmxvY2spOworCWxvY2tkZXBfYXNz
ZXJ0X2hlbGQoJmVuZ2luZS0+YWN0aXZlLmxvY2spOwogCiAJaWYgKCFpOTE1X3JlcXVlc3RfaXNf
YWN0aXZlKHJxKSkKIAkJcmV0dXJuOwogCi0JbGlzdF9mb3JfZWFjaF9lbnRyeV9jb250aW51ZShy
cSwgJmVuZ2luZS0+dGltZWxpbmUucmVxdWVzdHMsIGxpbmspCisJbGlzdF9mb3JfZWFjaF9lbnRy
eV9jb250aW51ZShycSwgJmVuZ2luZS0+YWN0aXZlLnJlcXVlc3RzLCBzY2hlZC5saW5rKQogCQlp
ZiAocnEtPmdlbV9jb250ZXh0ID09IGh1bmdfY3R4KQogCQkJaTkxNV9yZXF1ZXN0X3NraXAocnEs
IC1FSU8pOwogfQpAQCAtMTMwLDcgKzEzMCw3IEBAIHZvaWQgaTkxNV9yZXNldF9yZXF1ZXN0KHN0
cnVjdCBpOTE1X3JlcXVlc3QgKnJxLCBib29sIGd1aWx0eSkKIAkJICBycS0+ZmVuY2Uuc2Vxbm8s
CiAJCSAgeWVzbm8oZ3VpbHR5KSk7CiAKLQlsb2NrZGVwX2Fzc2VydF9oZWxkKCZycS0+ZW5naW5l
LT50aW1lbGluZS5sb2NrKTsKKwlsb2NrZGVwX2Fzc2VydF9oZWxkKCZycS0+ZW5naW5lLT5hY3Rp
dmUubG9jayk7CiAJR0VNX0JVR19PTihpOTE1X3JlcXVlc3RfY29tcGxldGVkKHJxKSk7CiAKIAlp
ZiAoZ3VpbHR5KSB7CkBAIC03ODUsMTAgKzc4NSwxMCBAQCBzdGF0aWMgdm9pZCBub3Bfc3VibWl0
X3JlcXVlc3Qoc3RydWN0IGk5MTVfcmVxdWVzdCAqcmVxdWVzdCkKIAkJICBlbmdpbmUtPm5hbWUs
IHJlcXVlc3QtPmZlbmNlLmNvbnRleHQsIHJlcXVlc3QtPmZlbmNlLnNlcW5vKTsKIAlkbWFfZmVu
Y2Vfc2V0X2Vycm9yKCZyZXF1ZXN0LT5mZW5jZSwgLUVJTyk7CiAKLQlzcGluX2xvY2tfaXJxc2F2
ZSgmZW5naW5lLT50aW1lbGluZS5sb2NrLCBmbGFncyk7CisJc3Bpbl9sb2NrX2lycXNhdmUoJmVu
Z2luZS0+YWN0aXZlLmxvY2ssIGZsYWdzKTsKIAlfX2k5MTVfcmVxdWVzdF9zdWJtaXQocmVxdWVz
dCk7CiAJaTkxNV9yZXF1ZXN0X21hcmtfY29tcGxldGUocmVxdWVzdCk7Ci0Jc3Bpbl91bmxvY2tf
aXJxcmVzdG9yZSgmZW5naW5lLT50aW1lbGluZS5sb2NrLCBmbGFncyk7CisJc3Bpbl91bmxvY2tf
aXJxcmVzdG9yZSgmZW5naW5lLT5hY3RpdmUubG9jaywgZmxhZ3MpOwogCiAJaW50ZWxfZW5naW5l
X3F1ZXVlX2JyZWFkY3J1bWJzKGVuZ2luZSk7CiB9CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9k
cm0vaTkxNS9ndC9pbnRlbF9yaW5nYnVmZmVyLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9p
bnRlbF9yaW5nYnVmZmVyLmMKaW5kZXggZmM1OTZhZGM2MzdhLi45M2IwODkzYzczNmIgMTAwNjQ0
Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX3JpbmdidWZmZXIuYworKysgYi9k
cml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9yaW5nYnVmZmVyLmMKQEAgLTczMCwxNCArNzMw
LDEzIEBAIHN0YXRpYyB2b2lkIHJlc2V0X3ByZXBhcmUoc3RydWN0IGludGVsX2VuZ2luZV9jcyAq
ZW5naW5lKQogCiBzdGF0aWMgdm9pZCByZXNldF9yaW5nKHN0cnVjdCBpbnRlbF9lbmdpbmVfY3Mg
KmVuZ2luZSwgYm9vbCBzdGFsbGVkKQogewotCXN0cnVjdCBpOTE1X3RpbWVsaW5lICp0bCA9ICZl
bmdpbmUtPnRpbWVsaW5lOwogCXN0cnVjdCBpOTE1X3JlcXVlc3QgKnBvcywgKnJxOwogCXVuc2ln
bmVkIGxvbmcgZmxhZ3M7CiAJdTMyIGhlYWQ7CiAKIAlycSA9IE5VTEw7Ci0Jc3Bpbl9sb2NrX2ly
cXNhdmUoJnRsLT5sb2NrLCBmbGFncyk7Ci0JbGlzdF9mb3JfZWFjaF9lbnRyeShwb3MsICZ0bC0+
cmVxdWVzdHMsIGxpbmspIHsKKwlzcGluX2xvY2tfaXJxc2F2ZSgmZW5naW5lLT5hY3RpdmUubG9j
aywgZmxhZ3MpOworCWxpc3RfZm9yX2VhY2hfZW50cnkocG9zLCAmZW5naW5lLT5hY3RpdmUucmVx
dWVzdHMsIHNjaGVkLmxpbmspIHsKIAkJaWYgKCFpOTE1X3JlcXVlc3RfY29tcGxldGVkKHBvcykp
IHsKIAkJCXJxID0gcG9zOwogCQkJYnJlYWs7CkBAIC03OTEsNyArNzkwLDcgQEAgc3RhdGljIHZv
aWQgcmVzZXRfcmluZyhzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmUsIGJvb2wgc3RhbGxl
ZCkKIAl9CiAJZW5naW5lLT5idWZmZXItPmhlYWQgPSBpbnRlbF9yaW5nX3dyYXAoZW5naW5lLT5i
dWZmZXIsIGhlYWQpOwogCi0Jc3Bpbl91bmxvY2tfaXJxcmVzdG9yZSgmdGwtPmxvY2ssIGZsYWdz
KTsKKwlzcGluX3VubG9ja19pcnFyZXN0b3JlKCZlbmdpbmUtPmFjdGl2ZS5sb2NrLCBmbGFncyk7
CiB9CiAKIHN0YXRpYyB2b2lkIHJlc2V0X2ZpbmlzaChzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICpl
bmdpbmUpCkBAIC04NzcsMTAgKzg3NiwxMCBAQCBzdGF0aWMgdm9pZCBjYW5jZWxfcmVxdWVzdHMo
c3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lKQogCXN0cnVjdCBpOTE1X3JlcXVlc3QgKnJl
cXVlc3Q7CiAJdW5zaWduZWQgbG9uZyBmbGFnczsKIAotCXNwaW5fbG9ja19pcnFzYXZlKCZlbmdp
bmUtPnRpbWVsaW5lLmxvY2ssIGZsYWdzKTsKKwlzcGluX2xvY2tfaXJxc2F2ZSgmZW5naW5lLT5h
Y3RpdmUubG9jaywgZmxhZ3MpOwogCiAJLyogTWFyayBhbGwgc3VibWl0dGVkIHJlcXVlc3RzIGFz
IHNraXBwZWQuICovCi0JbGlzdF9mb3JfZWFjaF9lbnRyeShyZXF1ZXN0LCAmZW5naW5lLT50aW1l
bGluZS5yZXF1ZXN0cywgbGluaykgeworCWxpc3RfZm9yX2VhY2hfZW50cnkocmVxdWVzdCwgJmVu
Z2luZS0+YWN0aXZlLnJlcXVlc3RzLCBzY2hlZC5saW5rKSB7CiAJCWlmICghaTkxNV9yZXF1ZXN0
X3NpZ25hbGVkKHJlcXVlc3QpKQogCQkJZG1hX2ZlbmNlX3NldF9lcnJvcigmcmVxdWVzdC0+ZmVu
Y2UsIC1FSU8pOwogCkBAIC04ODksNyArODg4LDcgQEAgc3RhdGljIHZvaWQgY2FuY2VsX3JlcXVl
c3RzKHN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZSkKIAogCS8qIFJlbWFpbmluZyBfdW5y
ZWFkeV8gcmVxdWVzdHMgd2lsbCBiZSBub3AnZWQgd2hlbiBzdWJtaXR0ZWQgKi8KIAotCXNwaW5f
dW5sb2NrX2lycXJlc3RvcmUoJmVuZ2luZS0+dGltZWxpbmUubG9jaywgZmxhZ3MpOworCXNwaW5f
dW5sb2NrX2lycXJlc3RvcmUoJmVuZ2luZS0+YWN0aXZlLmxvY2ssIGZsYWdzKTsKIH0KIAogc3Rh
dGljIHZvaWQgaTl4eF9zdWJtaXRfcmVxdWVzdChzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpyZXF1ZXN0
KQpAQCAtMTI2Nyw4ICsxMjY2LDYgQEAgaW50ZWxfZW5naW5lX2NyZWF0ZV9yaW5nKHN0cnVjdCBp
bnRlbF9lbmdpbmVfY3MgKmVuZ2luZSwKIAogCUdFTV9CVUdfT04oIWlzX3Bvd2VyX29mXzIoc2l6
ZSkpOwogCUdFTV9CVUdfT04oUklOR19DVExfU0laRShzaXplKSAmIH5SSU5HX05SX1BBR0VTKTsK
LQlHRU1fQlVHX09OKHRpbWVsaW5lID09ICZlbmdpbmUtPnRpbWVsaW5lKTsKLQlsb2NrZGVwX2Fz
c2VydF9oZWxkKCZlbmdpbmUtPmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwogCiAJcmluZyA9IGt6
YWxsb2Moc2l6ZW9mKCpyaW5nKSwgR0ZQX0tFUk5FTCk7CiAJaWYgKCFyaW5nKQpkaWZmIC0tZ2l0
IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvbW9ja19lbmdpbmUuYyBiL2RyaXZlcnMvZ3B1L2Ry
bS9pOTE1L2d0L21vY2tfZW5naW5lLmMKaW5kZXggYjc2NzVlZjE4NTIzLi4wMGM2NjZkM2U2NTIg
MTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L21vY2tfZW5naW5lLmMKKysrIGIv
ZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvbW9ja19lbmdpbmUuYwpAQCAtMjI5LDE3ICsyMjksMTcg
QEAgc3RhdGljIHZvaWQgbW9ja19jYW5jZWxfcmVxdWVzdHMoc3RydWN0IGludGVsX2VuZ2luZV9j
cyAqZW5naW5lKQogCXN0cnVjdCBpOTE1X3JlcXVlc3QgKnJlcXVlc3Q7CiAJdW5zaWduZWQgbG9u
ZyBmbGFnczsKIAotCXNwaW5fbG9ja19pcnFzYXZlKCZlbmdpbmUtPnRpbWVsaW5lLmxvY2ssIGZs
YWdzKTsKKwlzcGluX2xvY2tfaXJxc2F2ZSgmZW5naW5lLT5hY3RpdmUubG9jaywgZmxhZ3MpOwog
CiAJLyogTWFyayBhbGwgc3VibWl0dGVkIHJlcXVlc3RzIGFzIHNraXBwZWQuICovCi0JbGlzdF9m
b3JfZWFjaF9lbnRyeShyZXF1ZXN0LCAmZW5naW5lLT50aW1lbGluZS5yZXF1ZXN0cywgc2NoZWQu
bGluaykgeworCWxpc3RfZm9yX2VhY2hfZW50cnkocmVxdWVzdCwgJmVuZ2luZS0+YWN0aXZlLnJl
cXVlc3RzLCBzY2hlZC5saW5rKSB7CiAJCWlmICghaTkxNV9yZXF1ZXN0X3NpZ25hbGVkKHJlcXVl
c3QpKQogCQkJZG1hX2ZlbmNlX3NldF9lcnJvcigmcmVxdWVzdC0+ZmVuY2UsIC1FSU8pOwogCiAJ
CWk5MTVfcmVxdWVzdF9tYXJrX2NvbXBsZXRlKHJlcXVlc3QpOwogCX0KIAotCXNwaW5fdW5sb2Nr
X2lycXJlc3RvcmUoJmVuZ2luZS0+dGltZWxpbmUubG9jaywgZmxhZ3MpOworCXNwaW5fdW5sb2Nr
X2lycXJlc3RvcmUoJmVuZ2luZS0+YWN0aXZlLmxvY2ssIGZsYWdzKTsKIH0KIAogc3RydWN0IGlu
dGVsX2VuZ2luZV9jcyAqbW9ja19lbmdpbmUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUs
CkBAIC0yODUsMjggKzI4NSwyMyBAQCBpbnQgbW9ja19lbmdpbmVfaW5pdChzdHJ1Y3QgaW50ZWxf
ZW5naW5lX2NzICplbmdpbmUpCiAJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSBlbmdp
bmUtPmk5MTU7CiAJaW50IGVycjsKIAorCWludGVsX2VuZ2luZV9pbml0X2FjdGl2ZShlbmdpbmUs
IEVOR0lORV9NT0NLKTsKIAlpbnRlbF9lbmdpbmVfaW5pdF9icmVhZGNydW1icyhlbmdpbmUpOwog
CWludGVsX2VuZ2luZV9pbml0X2V4ZWNsaXN0cyhlbmdpbmUpOwogCWludGVsX2VuZ2luZV9pbml0
X19wbShlbmdpbmUpOwogCi0JaWYgKGk5MTVfdGltZWxpbmVfaW5pdChpOTE1LCAmZW5naW5lLT50
aW1lbGluZSwgTlVMTCkpCi0JCWdvdG8gZXJyX2JyZWFkY3J1bWJzOwotCWk5MTVfdGltZWxpbmVf
c2V0X3N1YmNsYXNzKCZlbmdpbmUtPnRpbWVsaW5lLCBUSU1FTElORV9FTkdJTkUpOwotCiAJZW5n
aW5lLT5rZXJuZWxfY29udGV4dCA9CiAJCWk5MTVfZ2VtX2NvbnRleHRfZ2V0X2VuZ2luZShpOTE1
LT5rZXJuZWxfY29udGV4dCwgZW5naW5lLT5pZCk7CiAJaWYgKElTX0VSUihlbmdpbmUtPmtlcm5l
bF9jb250ZXh0KSkKLQkJZ290byBlcnJfdGltZWxpbmU7CisJCWdvdG8gZXJyX2JyZWFkY3J1bWJz
OwogCiAJZXJyID0gaW50ZWxfY29udGV4dF9waW4oZW5naW5lLT5rZXJuZWxfY29udGV4dCk7CiAJ
aW50ZWxfY29udGV4dF9wdXQoZW5naW5lLT5rZXJuZWxfY29udGV4dCk7CiAJaWYgKGVycikKLQkJ
Z290byBlcnJfdGltZWxpbmU7CisJCWdvdG8gZXJyX2JyZWFkY3J1bWJzOwogCiAJcmV0dXJuIDA7
CiAKLWVycl90aW1lbGluZToKLQlpOTE1X3RpbWVsaW5lX2ZpbmkoJmVuZ2luZS0+dGltZWxpbmUp
OwogZXJyX2JyZWFkY3J1bWJzOgogCWludGVsX2VuZ2luZV9maW5pX2JyZWFkY3J1bWJzKGVuZ2lu
ZSk7CiAJcmV0dXJuIC1FTk9NRU07CkBAIC0zNDAsNyArMzM1LDYgQEAgdm9pZCBtb2NrX2VuZ2lu
ZV9mcmVlKHN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZSkKIAlpbnRlbF9jb250ZXh0X3Vu
cGluKGVuZ2luZS0+a2VybmVsX2NvbnRleHQpOwogCiAJaW50ZWxfZW5naW5lX2ZpbmlfYnJlYWRj
cnVtYnMoZW5naW5lKTsKLQlpOTE1X3RpbWVsaW5lX2ZpbmkoJmVuZ2luZS0+dGltZWxpbmUpOwog
CiAJa2ZyZWUoZW5naW5lKTsKIH0KZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5
MTVfZ3B1X2Vycm9yLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2dwdV9lcnJvci5jCmlu
ZGV4IDcwNzgxMTI1NjUwMS4uNGNjOTAwZTQzMmUyIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9k
cm0vaTkxNS9pOTE1X2dwdV9lcnJvci5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVf
Z3B1X2Vycm9yLmMKQEAgLTEyNjksNyArMTI2OSw3IEBAIHN0YXRpYyB2b2lkIGVuZ2luZV9yZWNv
cmRfcmVxdWVzdHMoc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lLAogCiAJY291bnQgPSAw
OwogCXJlcXVlc3QgPSBmaXJzdDsKLQlsaXN0X2Zvcl9lYWNoX2VudHJ5X2Zyb20ocmVxdWVzdCwg
JmVuZ2luZS0+dGltZWxpbmUucmVxdWVzdHMsIGxpbmspCisJbGlzdF9mb3JfZWFjaF9lbnRyeV9m
cm9tKHJlcXVlc3QsICZlbmdpbmUtPmFjdGl2ZS5yZXF1ZXN0cywgc2NoZWQubGluaykKIAkJY291
bnQrKzsKIAlpZiAoIWNvdW50KQogCQlyZXR1cm47CkBAIC0xMjgyLDcgKzEyODIsOCBAQCBzdGF0
aWMgdm9pZCBlbmdpbmVfcmVjb3JkX3JlcXVlc3RzKHN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVu
Z2luZSwKIAogCWNvdW50ID0gMDsKIAlyZXF1ZXN0ID0gZmlyc3Q7Ci0JbGlzdF9mb3JfZWFjaF9l
bnRyeV9mcm9tKHJlcXVlc3QsICZlbmdpbmUtPnRpbWVsaW5lLnJlcXVlc3RzLCBsaW5rKSB7CisJ
bGlzdF9mb3JfZWFjaF9lbnRyeV9mcm9tKHJlcXVlc3QsCisJCQkJICZlbmdpbmUtPmFjdGl2ZS5y
ZXF1ZXN0cywgc2NoZWQubGluaykgewogCQlpZiAoY291bnQgPj0gZWUtPm51bV9yZXF1ZXN0cykg
ewogCQkJLyoKIAkJCSAqIElmIHRoZSByaW5nIHJlcXVlc3QgbGlzdCB3YXMgY2hhbmdlZCBpbgpk
aWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9yZXF1ZXN0LmMgYi9kcml2ZXJz
L2dwdS9kcm0vaTkxNS9pOTE1X3JlcXVlc3QuYwppbmRleCBjNmZjMGU4YzM4NzYuLjAzZjE1YWM2
M2VjOSAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9yZXF1ZXN0LmMKKysr
IGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9yZXF1ZXN0LmMKQEAgLTIzMiw5ICsyMzIsOSBA
QCBzdGF0aWMgYm9vbCBpOTE1X3JlcXVlc3RfcmV0aXJlKHN0cnVjdCBpOTE1X3JlcXVlc3QgKnJx
KQogCiAJbG9jYWxfaXJxX2Rpc2FibGUoKTsKIAotCXNwaW5fbG9jaygmcnEtPmVuZ2luZS0+dGlt
ZWxpbmUubG9jayk7Ci0JbGlzdF9kZWwoJnJxLT5saW5rKTsKLQlzcGluX3VubG9jaygmcnEtPmVu
Z2luZS0+dGltZWxpbmUubG9jayk7CisJc3Bpbl9sb2NrKCZycS0+ZW5naW5lLT5hY3RpdmUubG9j
ayk7CisJbGlzdF9kZWwoJnJxLT5zY2hlZC5saW5rKTsKKwlzcGluX3VubG9jaygmcnEtPmVuZ2lu
ZS0+YWN0aXZlLmxvY2spOwogCiAJc3Bpbl9sb2NrKCZycS0+bG9jayk7CiAJaTkxNV9yZXF1ZXN0
X21hcmtfY29tcGxldGUocnEpOwpAQCAtMjU0LDYgKzI1NCw3IEBAIHN0YXRpYyBib29sIGk5MTVf
cmVxdWVzdF9yZXRpcmUoc3RydWN0IGk5MTVfcmVxdWVzdCAqcnEpCiAJaW50ZWxfY29udGV4dF91
bnBpbihycS0+aHdfY29udGV4dCk7CiAKIAlpOTE1X3JlcXVlc3RfcmVtb3ZlX2Zyb21fY2xpZW50
KHJxKTsKKwlsaXN0X2RlbCgmcnEtPmxpbmspOwogCiAJZnJlZV9jYXB0dXJlX2xpc3QocnEpOwog
CWk5MTVfc2NoZWRfbm9kZV9maW5pKCZycS0+c2NoZWQpOwpAQCAtMzczLDI4ICszNzQsMTcgQEAg
X19pOTE1X3JlcXVlc3RfYXdhaXRfZXhlY3V0aW9uKHN0cnVjdCBpOTE1X3JlcXVlc3QgKnJxLAog
CXJldHVybiAwOwogfQogCi1zdGF0aWMgdm9pZCBtb3ZlX3RvX3RpbWVsaW5lKHN0cnVjdCBpOTE1
X3JlcXVlc3QgKnJlcXVlc3QsCi0JCQkgICAgIHN0cnVjdCBpOTE1X3RpbWVsaW5lICp0aW1lbGlu
ZSkKLXsKLQlHRU1fQlVHX09OKHJlcXVlc3QtPnRpbWVsaW5lID09ICZyZXF1ZXN0LT5lbmdpbmUt
PnRpbWVsaW5lKTsKLQlsb2NrZGVwX2Fzc2VydF9oZWxkKCZyZXF1ZXN0LT5lbmdpbmUtPnRpbWVs
aW5lLmxvY2spOwotCi0Jc3Bpbl9sb2NrKCZyZXF1ZXN0LT50aW1lbGluZS0+bG9jayk7Ci0JbGlz
dF9tb3ZlX3RhaWwoJnJlcXVlc3QtPmxpbmssICZ0aW1lbGluZS0+cmVxdWVzdHMpOwotCXNwaW5f
dW5sb2NrKCZyZXF1ZXN0LT50aW1lbGluZS0+bG9jayk7Ci19Ci0KIHZvaWQgX19pOTE1X3JlcXVl
c3Rfc3VibWl0KHN0cnVjdCBpOTE1X3JlcXVlc3QgKnJlcXVlc3QpCiB7CiAJc3RydWN0IGludGVs
X2VuZ2luZV9jcyAqZW5naW5lID0gcmVxdWVzdC0+ZW5naW5lOwogCi0JR0VNX1RSQUNFKCIlcyBm
ZW5jZSAlbGx4OiVsbGQgLT4gY3VycmVudCAlZFxuIiwKKwlHRU1fVFJBQ0UoIiVzIGZlbmNlICVs
bHg6JWxsZCwgY3VycmVudCAlZFxuIiwKIAkJICBlbmdpbmUtPm5hbWUsCiAJCSAgcmVxdWVzdC0+
ZmVuY2UuY29udGV4dCwgcmVxdWVzdC0+ZmVuY2Uuc2Vxbm8sCiAJCSAgaHdzcF9zZXFubyhyZXF1
ZXN0KSk7CiAKIAlHRU1fQlVHX09OKCFpcnFzX2Rpc2FibGVkKCkpOwotCWxvY2tkZXBfYXNzZXJ0
X2hlbGQoJmVuZ2luZS0+dGltZWxpbmUubG9jayk7CisJbG9ja2RlcF9hc3NlcnRfaGVsZCgmZW5n
aW5lLT5hY3RpdmUubG9jayk7CiAKIAlpZiAoaTkxNV9nZW1fY29udGV4dF9pc19iYW5uZWQocmVx
dWVzdC0+Z2VtX2NvbnRleHQpKQogCQlpOTE1X3JlcXVlc3Rfc2tpcChyZXF1ZXN0LCAtRUlPKTsK
QEAgLTQyMiw2ICs0MTIsOCBAQCB2b2lkIF9faTkxNV9yZXF1ZXN0X3N1Ym1pdChzdHJ1Y3QgaTkx
NV9yZXF1ZXN0ICpyZXF1ZXN0KQogCS8qIFdlIG1heSBiZSByZWN1cnNpbmcgZnJvbSB0aGUgc2ln
bmFsIGNhbGxiYWNrIG9mIGFub3RoZXIgaTkxNSBmZW5jZSAqLwogCXNwaW5fbG9ja19uZXN0ZWQo
JnJlcXVlc3QtPmxvY2ssIFNJTkdMRV9ERVBUSF9ORVNUSU5HKTsKIAorCWxpc3RfbW92ZV90YWls
KCZyZXF1ZXN0LT5zY2hlZC5saW5rLCAmZW5naW5lLT5hY3RpdmUucmVxdWVzdHMpOworCiAJR0VN
X0JVR19PTih0ZXN0X2JpdChJOTE1X0ZFTkNFX0ZMQUdfQUNUSVZFLCAmcmVxdWVzdC0+ZmVuY2Uu
ZmxhZ3MpKTsKIAlzZXRfYml0KEk5MTVfRkVOQ0VfRkxBR19BQ1RJVkUsICZyZXF1ZXN0LT5mZW5j
ZS5mbGFncyk7CiAKQEAgLTQzNyw5ICs0MjksNiBAQCB2b2lkIF9faTkxNV9yZXF1ZXN0X3N1Ym1p
dChzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpyZXF1ZXN0KQogCWVuZ2luZS0+ZW1pdF9maW5pX2JyZWFk
Y3J1bWIocmVxdWVzdCwKIAkJCQkgICAgIHJlcXVlc3QtPnJpbmctPnZhZGRyICsgcmVxdWVzdC0+
cG9zdGZpeCk7CiAKLQkvKiBUcmFuc2ZlciBmcm9tIHBlci1jb250ZXh0IG9udG8gdGhlIGdsb2Jh
bCBwZXItZW5naW5lIHRpbWVsaW5lICovCi0JbW92ZV90b190aW1lbGluZShyZXF1ZXN0LCAmZW5n
aW5lLT50aW1lbGluZSk7Ci0KIAllbmdpbmUtPnNlcmlhbCsrOwogCiAJdHJhY2VfaTkxNV9yZXF1
ZXN0X2V4ZWN1dGUocmVxdWVzdCk7CkBAIC00NTEsMTEgKzQ0MCwxMSBAQCB2b2lkIGk5MTVfcmVx
dWVzdF9zdWJtaXQoc3RydWN0IGk5MTVfcmVxdWVzdCAqcmVxdWVzdCkKIAl1bnNpZ25lZCBsb25n
IGZsYWdzOwogCiAJLyogV2lsbCBiZSBjYWxsZWQgZnJvbSBpcnEtY29udGV4dCB3aGVuIHVzaW5n
IGZvcmVpZ24gZmVuY2VzLiAqLwotCXNwaW5fbG9ja19pcnFzYXZlKCZlbmdpbmUtPnRpbWVsaW5l
LmxvY2ssIGZsYWdzKTsKKwlzcGluX2xvY2tfaXJxc2F2ZSgmZW5naW5lLT5hY3RpdmUubG9jaywg
ZmxhZ3MpOwogCiAJX19pOTE1X3JlcXVlc3Rfc3VibWl0KHJlcXVlc3QpOwogCi0Jc3Bpbl91bmxv
Y2tfaXJxcmVzdG9yZSgmZW5naW5lLT50aW1lbGluZS5sb2NrLCBmbGFncyk7CisJc3Bpbl91bmxv
Y2tfaXJxcmVzdG9yZSgmZW5naW5lLT5hY3RpdmUubG9jaywgZmxhZ3MpOwogfQogCiB2b2lkIF9f
aTkxNV9yZXF1ZXN0X3Vuc3VibWl0KHN0cnVjdCBpOTE1X3JlcXVlc3QgKnJlcXVlc3QpCkBAIC00
NjgsNyArNDU3LDcgQEAgdm9pZCBfX2k5MTVfcmVxdWVzdF91bnN1Ym1pdChzdHJ1Y3QgaTkxNV9y
ZXF1ZXN0ICpyZXF1ZXN0KQogCQkgIGh3c3Bfc2Vxbm8ocmVxdWVzdCkpOwogCiAJR0VNX0JVR19P
TighaXJxc19kaXNhYmxlZCgpKTsKLQlsb2NrZGVwX2Fzc2VydF9oZWxkKCZlbmdpbmUtPnRpbWVs
aW5lLmxvY2spOworCWxvY2tkZXBfYXNzZXJ0X2hlbGQoJmVuZ2luZS0+YWN0aXZlLmxvY2spOwog
CiAJLyoKIAkgKiBPbmx5IHVud2luZCBpbiByZXZlcnNlIG9yZGVyLCByZXF1aXJlZCBzbyB0aGF0
IHRoZSBwZXItY29udGV4dCBsaXN0CkBAIC00ODYsOSArNDc1LDYgQEAgdm9pZCBfX2k5MTVfcmVx
dWVzdF91bnN1Ym1pdChzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpyZXF1ZXN0KQogCiAJc3Bpbl91bmxv
Y2soJnJlcXVlc3QtPmxvY2spOwogCi0JLyogVHJhbnNmZXIgYmFjayBmcm9tIHRoZSBnbG9iYWwg
cGVyLWVuZ2luZSB0aW1lbGluZSB0byBwZXItY29udGV4dCAqLwotCW1vdmVfdG9fdGltZWxpbmUo
cmVxdWVzdCwgcmVxdWVzdC0+dGltZWxpbmUpOwotCiAJLyoKIAkgKiBXZSBkb24ndCBuZWVkIHRv
IHdha2VfdXAgYW55IHdhaXRlcnMgb24gcmVxdWVzdC0+ZXhlY3V0ZSwgdGhleQogCSAqIHdpbGwg
Z2V0IHdva2VuIGJ5IGFueSBvdGhlciBldmVudCBvciB1cyByZS1hZGRpbmcgdGhpcyByZXF1ZXN0
CkBAIC01MDQsMTEgKzQ5MCwxMSBAQCB2b2lkIGk5MTVfcmVxdWVzdF91bnN1Ym1pdChzdHJ1Y3Qg
aTkxNV9yZXF1ZXN0ICpyZXF1ZXN0KQogCXVuc2lnbmVkIGxvbmcgZmxhZ3M7CiAKIAkvKiBXaWxs
IGJlIGNhbGxlZCBmcm9tIGlycS1jb250ZXh0IHdoZW4gdXNpbmcgZm9yZWlnbiBmZW5jZXMuICov
Ci0Jc3Bpbl9sb2NrX2lycXNhdmUoJmVuZ2luZS0+dGltZWxpbmUubG9jaywgZmxhZ3MpOworCXNw
aW5fbG9ja19pcnFzYXZlKCZlbmdpbmUtPmFjdGl2ZS5sb2NrLCBmbGFncyk7CiAKIAlfX2k5MTVf
cmVxdWVzdF91bnN1Ym1pdChyZXF1ZXN0KTsKIAotCXNwaW5fdW5sb2NrX2lycXJlc3RvcmUoJmVu
Z2luZS0+dGltZWxpbmUubG9jaywgZmxhZ3MpOworCXNwaW5fdW5sb2NrX2lycXJlc3RvcmUoJmVu
Z2luZS0+YWN0aXZlLmxvY2ssIGZsYWdzKTsKIH0KIAogc3RhdGljIGludCBfX2k5MTVfc3dfZmVu
Y2VfY2FsbApAQCAtNjc0LDcgKzY2MCw2IEBAIF9faTkxNV9yZXF1ZXN0X2NyZWF0ZShzdHJ1Y3Qg
aW50ZWxfY29udGV4dCAqY2UsIGdmcF90IGdmcCkKIAlycS0+ZW5naW5lID0gY2UtPmVuZ2luZTsK
IAlycS0+cmluZyA9IGNlLT5yaW5nOwogCXJxLT50aW1lbGluZSA9IHRsOwotCUdFTV9CVUdfT04o
cnEtPnRpbWVsaW5lID09ICZjZS0+ZW5naW5lLT50aW1lbGluZSk7CiAJcnEtPmh3c3Bfc2Vxbm8g
PSB0bC0+aHdzcF9zZXFubzsKIAlycS0+aHdzcF9jYWNoZWxpbmUgPSB0bC0+aHdzcF9jYWNoZWxp
bmU7CiAJcnEtPnJjdXN0YXRlID0gZ2V0X3N0YXRlX3N5bmNocm9uaXplX3JjdSgpOyAvKiBhY3Rz
IGFzIHNtcF9tYigpICovCkBAIC0xMTM1LDkgKzExMjAsNyBAQCBfX2k5MTVfcmVxdWVzdF9hZGRf
dG9fdGltZWxpbmUoc3RydWN0IGk5MTVfcmVxdWVzdCAqcnEpCiAJCQkJCQkJIDApOwogCX0KIAot
CXNwaW5fbG9ja19pcnEoJnRpbWVsaW5lLT5sb2NrKTsKIAlsaXN0X2FkZF90YWlsKCZycS0+bGlu
aywgJnRpbWVsaW5lLT5yZXF1ZXN0cyk7Ci0Jc3Bpbl91bmxvY2tfaXJxKCZ0aW1lbGluZS0+bG9j
ayk7CiAKIAkvKgogCSAqIE1ha2Ugc3VyZSB0aGF0IG5vIHJlcXVlc3QgZ2F6dW1wZWQgdXMgLSBp
ZiBpdCB3YXMgYWxsb2NhdGVkIGFmdGVyCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkx
NS9pOTE1X3JlcXVlc3QuaCBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfcmVxdWVzdC5oCmlu
ZGV4IGM5ZjdkMDc5OTFjOC4uZWRiYmRmZWMyNGFiIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9k
cm0vaTkxNS9pOTE1X3JlcXVlc3QuaAorKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3Jl
cXVlc3QuaApAQCAtMjE3LDcgKzIxNyw3IEBAIHN0cnVjdCBpOTE1X3JlcXVlc3QgewogCiAJYm9v
bCB3YWl0Ym9vc3Q7CiAKLQkvKiogZW5naW5lLT5yZXF1ZXN0X2xpc3QgZW50cnkgZm9yIHRoaXMg
cmVxdWVzdCAqLworCS8qKiB0aW1lbGluZS0+cmVxdWVzdCBlbnRyeSBmb3IgdGhpcyByZXF1ZXN0
ICovCiAJc3RydWN0IGxpc3RfaGVhZCBsaW5rOwogCiAJLyoqIHJpbmctPnJlcXVlc3RfbGlzdCBl
bnRyeSBmb3IgdGhpcyByZXF1ZXN0ICovCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkx
NS9pOTE1X3NjaGVkdWxlci5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9zY2hlZHVsZXIu
YwppbmRleCA3OGNlYjU2ZDc4MDEuLjJjYmE1YjliMzRiYiAxMDA2NDQKLS0tIGEvZHJpdmVycy9n
cHUvZHJtL2k5MTUvaTkxNV9zY2hlZHVsZXIuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9p
OTE1X3NjaGVkdWxlci5jCkBAIC03Nyw3ICs3Nyw3IEBAIGk5MTVfc2NoZWRfbG9va3VwX3ByaW9s
aXN0KHN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZSwgaW50IHByaW8pCiAJYm9vbCBmaXJz
dCA9IHRydWU7CiAJaW50IGlkeCwgaTsKIAotCWxvY2tkZXBfYXNzZXJ0X2hlbGQoJmVuZ2luZS0+
dGltZWxpbmUubG9jayk7CisJbG9ja2RlcF9hc3NlcnRfaGVsZCgmZW5naW5lLT5hY3RpdmUubG9j
ayk7CiAJYXNzZXJ0X3ByaW9saXN0cyhleGVjbGlzdHMpOwogCiAJLyogYnVja2V0cyBzb3J0ZWQg
ZnJvbSBoaWdoZXN0IFtpbiBzbG90IDBdIHRvIGxvd2VzdCBwcmlvcml0eSAqLwpAQCAtMTYyLDkg
KzE2Miw5IEBAIHNjaGVkX2xvY2tfZW5naW5lKGNvbnN0IHN0cnVjdCBpOTE1X3NjaGVkX25vZGUg
Km5vZGUsCiAJICogY2hlY2sgdGhhdCB0aGUgcnEgc3RpbGwgYmVsb25ncyB0byB0aGUgbmV3bHkg
bG9ja2VkIGVuZ2luZS4KIAkgKi8KIAl3aGlsZSAobG9ja2VkICE9IChlbmdpbmUgPSBSRUFEX09O
Q0UocnEtPmVuZ2luZSkpKSB7Ci0JCXNwaW5fdW5sb2NrKCZsb2NrZWQtPnRpbWVsaW5lLmxvY2sp
OworCQlzcGluX3VubG9jaygmbG9ja2VkLT5hY3RpdmUubG9jayk7CiAJCW1lbXNldChjYWNoZSwg
MCwgc2l6ZW9mKCpjYWNoZSkpOwotCQlzcGluX2xvY2soJmVuZ2luZS0+dGltZWxpbmUubG9jayk7
CisJCXNwaW5fbG9jaygmZW5naW5lLT5hY3RpdmUubG9jayk7CiAJCWxvY2tlZCA9IGVuZ2luZTsK
IAl9CiAKQEAgLTI3OCw3ICsyNzgsNyBAQCBzdGF0aWMgdm9pZCBfX2k5MTVfc2NoZWR1bGUoc3Ry
dWN0IGk5MTVfc2NoZWRfbm9kZSAqbm9kZSwKIAogCW1lbXNldCgmY2FjaGUsIDAsIHNpemVvZihj
YWNoZSkpOwogCWVuZ2luZSA9IG5vZGVfdG9fcmVxdWVzdChub2RlKS0+ZW5naW5lOwotCXNwaW5f
bG9jaygmZW5naW5lLT50aW1lbGluZS5sb2NrKTsKKwlzcGluX2xvY2soJmVuZ2luZS0+YWN0aXZl
LmxvY2spOwogCiAJLyogRmlmbyBhbmQgZGVwdGgtZmlyc3QgcmVwbGFjZW1lbnQgZW5zdXJlIG91
ciBkZXBzIGV4ZWN1dGUgYmVmb3JlIHVzICovCiAJZW5naW5lID0gc2NoZWRfbG9ja19lbmdpbmUo
bm9kZSwgZW5naW5lLCAmY2FjaGUpOwpAQCAtMjg3LDcgKzI4Nyw3IEBAIHN0YXRpYyB2b2lkIF9f
aTkxNV9zY2hlZHVsZShzdHJ1Y3QgaTkxNV9zY2hlZF9ub2RlICpub2RlLAogCiAJCW5vZGUgPSBk
ZXAtPnNpZ25hbGVyOwogCQllbmdpbmUgPSBzY2hlZF9sb2NrX2VuZ2luZShub2RlLCBlbmdpbmUs
ICZjYWNoZSk7Ci0JCWxvY2tkZXBfYXNzZXJ0X2hlbGQoJmVuZ2luZS0+dGltZWxpbmUubG9jayk7
CisJCWxvY2tkZXBfYXNzZXJ0X2hlbGQoJmVuZ2luZS0+YWN0aXZlLmxvY2spOwogCiAJCS8qIFJl
Y2hlY2sgYWZ0ZXIgYWNxdWlyaW5nIHRoZSBlbmdpbmUtPnRpbWVsaW5lLmxvY2sgKi8KIAkJaWYg
KHByaW8gPD0gbm9kZS0+YXR0ci5wcmlvcml0eSB8fCBub2RlX3NpZ25hbGVkKG5vZGUpKQpAQCAt
Mjk2LDE0ICsyOTYsOCBAQCBzdGF0aWMgdm9pZCBfX2k5MTVfc2NoZWR1bGUoc3RydWN0IGk5MTVf
c2NoZWRfbm9kZSAqbm9kZSwKIAkJR0VNX0JVR19PTihub2RlX3RvX3JlcXVlc3Qobm9kZSktPmVu
Z2luZSAhPSBlbmdpbmUpOwogCiAJCW5vZGUtPmF0dHIucHJpb3JpdHkgPSBwcmlvOwotCQlpZiAo
IWxpc3RfZW1wdHkoJm5vZGUtPmxpbmspKSB7Ci0JCQlHRU1fQlVHX09OKGludGVsX2VuZ2luZV9p
c192aXJ0dWFsKGVuZ2luZSkpOwotCQkJaWYgKCFjYWNoZS5wcmlvbGlzdCkKLQkJCQljYWNoZS5w
cmlvbGlzdCA9Ci0JCQkJCWk5MTVfc2NoZWRfbG9va3VwX3ByaW9saXN0KGVuZ2luZSwKLQkJCQkJ
CQkJICAgcHJpbyk7Ci0JCQlsaXN0X21vdmVfdGFpbCgmbm9kZS0+bGluaywgY2FjaGUucHJpb2xp
c3QpOwotCQl9IGVsc2UgeworCisJCWlmIChsaXN0X2VtcHR5KCZub2RlLT5saW5rKSkgewogCQkJ
LyoKIAkJCSAqIElmIHRoZSByZXF1ZXN0IGlzIG5vdCBpbiB0aGUgcHJpb2xpc3QgcXVldWUgYmVj
YXVzZQogCQkJICogaXQgaXMgbm90IHlldCBydW5uYWJsZSwgdGhlbiBpdCBkb2Vzbid0IGNvbnRy
aWJ1dGUKQEAgLTMxMiw4ICszMDYsMTYgQEAgc3RhdGljIHZvaWQgX19pOTE1X3NjaGVkdWxlKHN0
cnVjdCBpOTE1X3NjaGVkX25vZGUgKm5vZGUsCiAJCQkgKiBxdWV1ZTsgYnV0IGluIHRoYXQgY2Fz
ZSB3ZSBtYXkgc3RpbGwgbmVlZCB0byByZW9yZGVyCiAJCQkgKiB0aGUgaW5mbGlnaHQgcmVxdWVz
dHMuCiAJCQkgKi8KLQkJCWlmICghaTkxNV9zd19mZW5jZV9kb25lKCZub2RlX3RvX3JlcXVlc3Qo
bm9kZSktPnN1Ym1pdCkpCi0JCQkJY29udGludWU7CisJCQljb250aW51ZTsKKwkJfQorCisJCWlm
ICghaW50ZWxfZW5naW5lX2lzX3ZpcnR1YWwoZW5naW5lKSAmJgorCQkgICAgIWk5MTVfcmVxdWVz
dF9pc19hY3RpdmUobm9kZV90b19yZXF1ZXN0KG5vZGUpKSkgeworCQkJaWYgKCFjYWNoZS5wcmlv
bGlzdCkKKwkJCQljYWNoZS5wcmlvbGlzdCA9CisJCQkJCWk5MTVfc2NoZWRfbG9va3VwX3ByaW9s
aXN0KGVuZ2luZSwKKwkJCQkJCQkJICAgcHJpbyk7CisJCQlsaXN0X21vdmVfdGFpbCgmbm9kZS0+
bGluaywgY2FjaGUucHJpb2xpc3QpOwogCQl9CiAKIAkJaWYgKHByaW8gPD0gZW5naW5lLT5leGVj
bGlzdHMucXVldWVfcHJpb3JpdHlfaGludCkKQEAgLTMyNSw3ICszMjcsNyBAQCBzdGF0aWMgdm9p
ZCBfX2k5MTVfc2NoZWR1bGUoc3RydWN0IGk5MTVfc2NoZWRfbm9kZSAqbm9kZSwKIAkJa2lja19z
dWJtaXNzaW9uKGVuZ2luZSwgcHJpbyk7CiAJfQogCi0Jc3Bpbl91bmxvY2soJmVuZ2luZS0+dGlt
ZWxpbmUubG9jayk7CisJc3Bpbl91bmxvY2soJmVuZ2luZS0+YWN0aXZlLmxvY2spOwogfQogCiB2
b2lkIGk5MTVfc2NoZWR1bGUoc3RydWN0IGk5MTVfcmVxdWVzdCAqcnEsIGNvbnN0IHN0cnVjdCBp
OTE1X3NjaGVkX2F0dHIgKmF0dHIpCkBAIC00MzksOCArNDQxLDYgQEAgdm9pZCBpOTE1X3NjaGVk
X25vZGVfZmluaShzdHJ1Y3QgaTkxNV9zY2hlZF9ub2RlICpub2RlKQogewogCXN0cnVjdCBpOTE1
X2RlcGVuZGVuY3kgKmRlcCwgKnRtcDsKIAotCUdFTV9CVUdfT04oIWxpc3RfZW1wdHkoJm5vZGUt
PmxpbmspKTsKLQogCXNwaW5fbG9ja19pcnEoJnNjaGVkdWxlX2xvY2spOwogCiAJLyoKZGlmZiAt
LWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfdGltZWxpbmUuYyBiL2RyaXZlcnMvZ3B1
L2RybS9pOTE1L2k5MTVfdGltZWxpbmUuYwppbmRleCAwMDBlMWE5YjY3NTAuLmMzMTFjZTljNmY5
ZCAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV90aW1lbGluZS5jCisrKyBi
L2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfdGltZWxpbmUuYwpAQCAtMjUxLDcgKzI1MSw2IEBA
IGludCBpOTE1X3RpbWVsaW5lX2luaXQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUsCiAK
IAl0aW1lbGluZS0+ZmVuY2VfY29udGV4dCA9IGRtYV9mZW5jZV9jb250ZXh0X2FsbG9jKDEpOwog
Ci0Jc3Bpbl9sb2NrX2luaXQoJnRpbWVsaW5lLT5sb2NrKTsKIAltdXRleF9pbml0KCZ0aW1lbGlu
ZS0+bXV0ZXgpOwogCiAJSU5JVF9BQ1RJVkVfUkVRVUVTVCgmdGltZWxpbmUtPmxhc3RfcmVxdWVz
dCk7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3RpbWVsaW5lLmggYi9k
cml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3RpbWVsaW5lLmgKaW5kZXggMjc2NjhhMWE2OWEzLi4z
NmU1ZTVhNjUxNTUgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfdGltZWxp
bmUuaAorKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3RpbWVsaW5lLmgKQEAgLTM2LDI1
ICszNiw2IEBAIGludCBpOTE1X3RpbWVsaW5lX2luaXQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUg
Kmk5MTUsCiAJCSAgICAgICBzdHJ1Y3QgaTkxNV92bWEgKmh3c3ApOwogdm9pZCBpOTE1X3RpbWVs
aW5lX2Zpbmkoc3RydWN0IGk5MTVfdGltZWxpbmUgKnRsKTsKIAotc3RhdGljIGlubGluZSB2b2lk
Ci1pOTE1X3RpbWVsaW5lX3NldF9zdWJjbGFzcyhzdHJ1Y3QgaTkxNV90aW1lbGluZSAqdGltZWxp
bmUsCi0JCQkgICB1bnNpZ25lZCBpbnQgc3ViY2xhc3MpCi17Ci0JbG9ja2RlcF9zZXRfc3ViY2xh
c3MoJnRpbWVsaW5lLT5sb2NrLCBzdWJjbGFzcyk7Ci0KLQkvKgotCSAqIER1ZSB0byBhbiBpbnRl
cmVzdGluZyBxdWlyayBpbiBsb2NrZGVwJ3MgaW50ZXJuYWwgZGVidWcgdHJhY2tpbmcsCi0JICog
YWZ0ZXIgc2V0dGluZyBhIHN1YmNsYXNzIHdlIG11c3QgZW5zdXJlIHRoZSBsb2NrIGlzIHVzZWQu
IE90aGVyd2lzZSwKLQkgKiBucl91bnVzZWRfbG9ja3MgaXMgaW5jcmVtZW50ZWQgb25jZSB0b28g
b2Z0ZW4uCi0JICovCi0jaWZkZWYgQ09ORklHX0RFQlVHX0xPQ0tfQUxMT0MKLQlsb2NhbF9pcnFf
ZGlzYWJsZSgpOwotCWxvY2tfbWFwX2FjcXVpcmUoJnRpbWVsaW5lLT5sb2NrLmRlcF9tYXApOwot
CWxvY2tfbWFwX3JlbGVhc2UoJnRpbWVsaW5lLT5sb2NrLmRlcF9tYXApOwotCWxvY2FsX2lycV9l
bmFibGUoKTsKLSNlbmRpZgotfQotCiBzdHJ1Y3QgaTkxNV90aW1lbGluZSAqCiBpOTE1X3RpbWVs
aW5lX2NyZWF0ZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwKIAkJICAgICBzdHJ1Y3Qg
aTkxNV92bWEgKmdsb2JhbF9od3NwKTsKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1
L2k5MTVfdGltZWxpbmVfdHlwZXMuaCBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfdGltZWxp
bmVfdHlwZXMuaAppbmRleCAxNjg4NzA1ZjRhMmIuLmZjZTVjYjRmMTA5MCAxMDA2NDQKLS0tIGEv
ZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV90aW1lbGluZV90eXBlcy5oCisrKyBiL2RyaXZlcnMv
Z3B1L2RybS9pOTE1L2k5MTVfdGltZWxpbmVfdHlwZXMuaApAQCAtMjMsMTAgKzIzLDYgQEAgc3Ry
dWN0IGk5MTVfdGltZWxpbmUgewogCXU2NCBmZW5jZV9jb250ZXh0OwogCXUzMiBzZXFubzsKIAot
CXNwaW5sb2NrX3QgbG9jazsKLSNkZWZpbmUgVElNRUxJTkVfQ0xJRU5UIDAgLyogZGVmYXVsdCBz
dWJjbGFzcyAqLwotI2RlZmluZSBUSU1FTElORV9FTkdJTkUgMQotI2RlZmluZSBUSU1FTElORV9W
SVJUVUFMIDIKIAlzdHJ1Y3QgbXV0ZXggbXV0ZXg7IC8qIHByb3RlY3RzIHRoZSBmbG93IG9mIHJl
cXVlc3RzICovCiAKIAl1bnNpZ25lZCBpbnQgcGluX2NvdW50OwpkaWZmIC0tZ2l0IGEvZHJpdmVy
cy9ncHUvZHJtL2k5MTUvaW50ZWxfZ3VjX3N1Ym1pc3Npb24uYyBiL2RyaXZlcnMvZ3B1L2RybS9p
OTE1L2ludGVsX2d1Y19zdWJtaXNzaW9uLmMKaW5kZXggMzg5YTkxMzFkNDEzLi4yNDBjOGEyYWFi
YzIgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2ludGVsX2d1Y19zdWJtaXNzaW9u
LmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50ZWxfZ3VjX3N1Ym1pc3Npb24uYwpAQCAt
NzQwLDcgKzc0MCw3IEBAIHN0YXRpYyBib29sIF9fZ3VjX2RlcXVldWUoc3RydWN0IGludGVsX2Vu
Z2luZV9jcyAqZW5naW5lKQogCWJvb2wgc3VibWl0ID0gZmFsc2U7CiAJc3RydWN0IHJiX25vZGUg
KnJiOwogCi0JbG9ja2RlcF9hc3NlcnRfaGVsZCgmZW5naW5lLT50aW1lbGluZS5sb2NrKTsKKwls
b2NrZGVwX2Fzc2VydF9oZWxkKCZlbmdpbmUtPmFjdGl2ZS5sb2NrKTsKIAogCWlmIChwb3J0X2lz
c2V0KHBvcnQpKSB7CiAJCWlmIChpbnRlbF9lbmdpbmVfaGFzX3ByZWVtcHRpb24oZW5naW5lKSkg
ewpAQCAtODIyLDcgKzgyMiw3IEBAIHN0YXRpYyB2b2lkIGd1Y19zdWJtaXNzaW9uX3Rhc2tsZXQo
dW5zaWduZWQgbG9uZyBkYXRhKQogCXN0cnVjdCBpOTE1X3JlcXVlc3QgKnJxOwogCXVuc2lnbmVk
IGxvbmcgZmxhZ3M7CiAKLQlzcGluX2xvY2tfaXJxc2F2ZSgmZW5naW5lLT50aW1lbGluZS5sb2Nr
LCBmbGFncyk7CisJc3Bpbl9sb2NrX2lycXNhdmUoJmVuZ2luZS0+YWN0aXZlLmxvY2ssIGZsYWdz
KTsKIAogCXJxID0gcG9ydF9yZXF1ZXN0KHBvcnQpOwogCXdoaWxlIChycSAmJiBpOTE1X3JlcXVl
c3RfY29tcGxldGVkKHJxKSkgewpAQCAtODQ3LDcgKzg0Nyw3IEBAIHN0YXRpYyB2b2lkIGd1Y19z
dWJtaXNzaW9uX3Rhc2tsZXQodW5zaWduZWQgbG9uZyBkYXRhKQogCWlmICghZXhlY2xpc3RzX2lz
X2FjdGl2ZShleGVjbGlzdHMsIEVYRUNMSVNUU19BQ1RJVkVfUFJFRU1QVCkpCiAJCWd1Y19kZXF1
ZXVlKGVuZ2luZSk7CiAKLQlzcGluX3VubG9ja19pcnFyZXN0b3JlKCZlbmdpbmUtPnRpbWVsaW5l
LmxvY2ssIGZsYWdzKTsKKwlzcGluX3VubG9ja19pcnFyZXN0b3JlKCZlbmdpbmUtPmFjdGl2ZS5s
b2NrLCBmbGFncyk7CiB9CiAKIHN0YXRpYyB2b2lkIGd1Y19yZXNldF9wcmVwYXJlKHN0cnVjdCBp
bnRlbF9lbmdpbmVfY3MgKmVuZ2luZSkKQEAgLTg4NCw3ICs4ODQsNyBAQCBzdGF0aWMgdm9pZCBn
dWNfcmVzZXQoc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lLCBib29sIHN0YWxsZWQpCiAJ
c3RydWN0IGk5MTVfcmVxdWVzdCAqcnE7CiAJdW5zaWduZWQgbG9uZyBmbGFnczsKIAotCXNwaW5f
bG9ja19pcnFzYXZlKCZlbmdpbmUtPnRpbWVsaW5lLmxvY2ssIGZsYWdzKTsKKwlzcGluX2xvY2tf
aXJxc2F2ZSgmZW5naW5lLT5hY3RpdmUubG9jaywgZmxhZ3MpOwogCiAJZXhlY2xpc3RzX2NhbmNl
bF9wb3J0X3JlcXVlc3RzKGV4ZWNsaXN0cyk7CiAKQEAgLTkwMCw3ICs5MDAsNyBAQCBzdGF0aWMg
dm9pZCBndWNfcmVzZXQoc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lLCBib29sIHN0YWxs
ZWQpCiAJaW50ZWxfbHJfY29udGV4dF9yZXNldChlbmdpbmUsIHJxLT5od19jb250ZXh0LCBycS0+
aGVhZCwgc3RhbGxlZCk7CiAKIG91dF91bmxvY2s6Ci0Jc3Bpbl91bmxvY2tfaXJxcmVzdG9yZSgm
ZW5naW5lLT50aW1lbGluZS5sb2NrLCBmbGFncyk7CisJc3Bpbl91bmxvY2tfaXJxcmVzdG9yZSgm
ZW5naW5lLT5hY3RpdmUubG9jaywgZmxhZ3MpOwogfQogCiBzdGF0aWMgdm9pZCBndWNfY2FuY2Vs
X3JlcXVlc3RzKHN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZSkKQEAgLTkyNiwxMyArOTI2
LDEzIEBAIHN0YXRpYyB2b2lkIGd1Y19jYW5jZWxfcmVxdWVzdHMoc3RydWN0IGludGVsX2VuZ2lu
ZV9jcyAqZW5naW5lKQogCSAqIHN1Ym1pc3Npb24ncyBpcnEgc3RhdGUsIHdlIGFsc28gd2lzaCB0
byByZW1pbmQgb3Vyc2VsdmVzIHRoYXQKIAkgKiBpdCBpcyBpcnEgc3RhdGUuKQogCSAqLwotCXNw
aW5fbG9ja19pcnFzYXZlKCZlbmdpbmUtPnRpbWVsaW5lLmxvY2ssIGZsYWdzKTsKKwlzcGluX2xv
Y2tfaXJxc2F2ZSgmZW5naW5lLT5hY3RpdmUubG9jaywgZmxhZ3MpOwogCiAJLyogQ2FuY2VsIHRo
ZSByZXF1ZXN0cyBvbiB0aGUgSFcgYW5kIGNsZWFyIHRoZSBFTFNQIHRyYWNrZXIuICovCiAJZXhl
Y2xpc3RzX2NhbmNlbF9wb3J0X3JlcXVlc3RzKGV4ZWNsaXN0cyk7CiAKIAkvKiBNYXJrIGFsbCBl
eGVjdXRpbmcgcmVxdWVzdHMgYXMgc2tpcHBlZC4gKi8KLQlsaXN0X2Zvcl9lYWNoX2VudHJ5KHJx
LCAmZW5naW5lLT50aW1lbGluZS5yZXF1ZXN0cywgbGluaykgeworCWxpc3RfZm9yX2VhY2hfZW50
cnkocnEsICZlbmdpbmUtPmFjdGl2ZS5yZXF1ZXN0cywgc2NoZWQubGluaykgewogCQlpZiAoIWk5
MTVfcmVxdWVzdF9zaWduYWxlZChycSkpCiAJCQlkbWFfZmVuY2Vfc2V0X2Vycm9yKCZycS0+ZmVu
Y2UsIC1FSU8pOwogCkBAIC05NjEsNyArOTYxLDcgQEAgc3RhdGljIHZvaWQgZ3VjX2NhbmNlbF9y
ZXF1ZXN0cyhzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmUpCiAJZXhlY2xpc3RzLT5xdWV1
ZSA9IFJCX1JPT1RfQ0FDSEVEOwogCUdFTV9CVUdfT04ocG9ydF9pc3NldChleGVjbGlzdHMtPnBv
cnQpKTsKIAotCXNwaW5fdW5sb2NrX2lycXJlc3RvcmUoJmVuZ2luZS0+dGltZWxpbmUubG9jaywg
ZmxhZ3MpOworCXNwaW5fdW5sb2NrX2lycXJlc3RvcmUoJmVuZ2luZS0+YWN0aXZlLmxvY2ssIGZs
YWdzKTsKIH0KIAogc3RhdGljIHZvaWQgZ3VjX3Jlc2V0X2ZpbmlzaChzdHJ1Y3QgaW50ZWxfZW5n
aW5lX2NzICplbmdpbmUpCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9zZWxmdGVz
dHMvbW9ja190aW1lbGluZS5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvc2VsZnRlc3RzL21vY2tf
dGltZWxpbmUuYwppbmRleCBlMDg0NDc2NDY5ZWYuLjY1YjUyYmUyM2Q0MiAxMDA2NDQKLS0tIGEv
ZHJpdmVycy9ncHUvZHJtL2k5MTUvc2VsZnRlc3RzL21vY2tfdGltZWxpbmUuYworKysgYi9kcml2
ZXJzL2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMvbW9ja190aW1lbGluZS5jCkBAIC0xMyw3ICsxMyw2
IEBAIHZvaWQgbW9ja190aW1lbGluZV9pbml0KHN0cnVjdCBpOTE1X3RpbWVsaW5lICp0aW1lbGlu
ZSwgdTY0IGNvbnRleHQpCiAJdGltZWxpbmUtPmk5MTUgPSBOVUxMOwogCXRpbWVsaW5lLT5mZW5j
ZV9jb250ZXh0ID0gY29udGV4dDsKIAotCXNwaW5fbG9ja19pbml0KCZ0aW1lbGluZS0+bG9jayk7
CiAJbXV0ZXhfaW5pdCgmdGltZWxpbmUtPm11dGV4KTsKIAogCUlOSVRfQUNUSVZFX1JFUVVFU1Qo
JnRpbWVsaW5lLT5sYXN0X3JlcXVlc3QpOwotLSAKMi4yMC4xCgpfX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fXwpJbnRlbC1nZnggbWFpbGluZyBsaXN0CkludGVs
LWdmeEBsaXN0cy5mcmVlZGVza3RvcC5vcmcKaHR0cHM6Ly9saXN0cy5mcmVlZGVza3RvcC5vcmcv
bWFpbG1hbi9saXN0aW5mby9pbnRlbC1nZng=

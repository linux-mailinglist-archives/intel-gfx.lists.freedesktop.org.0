Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 101843AC624
	for <lists+intel-gfx@lfdr.de>; Fri, 18 Jun 2021 10:31:38 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 3046F6E986;
	Fri, 18 Jun 2021 08:31:34 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from mga04.intel.com (mga04.intel.com [192.55.52.120])
 by gabe.freedesktop.org (Postfix) with ESMTPS id D83CE6E841;
 Fri, 18 Jun 2021 08:31:32 +0000 (UTC)
IronPort-SDR: /rn+ZTWrPAT38lZcXcqwQKCfCwbs1VQoRaqSKGBGHsi67hA8ew1Ad72xWBFWgjK/8KSFQXz/EA
 XKmFnYgxDnuw==
X-IronPort-AV: E=McAfee;i="6200,9189,10018"; a="204689094"
X-IronPort-AV: E=Sophos;i="5.83,283,1616482800"; d="scan'208";a="204689094"
Received: from fmsmga003.fm.intel.com ([10.253.24.29])
 by fmsmga104.fm.intel.com with ESMTP/TLS/ECDHE-RSA-AES256-GCM-SHA384;
 18 Jun 2021 01:31:31 -0700
IronPort-SDR: qu5/NKVZLN2eS0CYpr1BxnA8ENYRLHB/xFhOcb58yhBEbSB3xxTaLLZP4m86G1t7JO+wb+hRWC
 NezK20j2T1hw==
X-IronPort-AV: E=Sophos;i="5.83,283,1616482800"; d="scan'208";a="479759540"
Received: from jhogberg-mobl1.ger.corp.intel.com (HELO
 thellst-mobl1.intel.com) ([10.249.254.60])
 by fmsmga003-auth.fm.intel.com with ESMTP/TLS/ECDHE-RSA-AES256-GCM-SHA384;
 18 Jun 2021 01:31:29 -0700
From: =?UTF-8?q?Thomas=20Hellstr=C3=B6m?= <thomas.hellstrom@linux.intel.com>
To: intel-gfx@lists.freedesktop.org,
	dri-devel@lists.freedesktop.org
Date: Fri, 18 Jun 2021 10:31:17 +0200
Message-Id: <20210618083117.158081-1-thomas.hellstrom@linux.intel.com>
X-Mailer: git-send-email 2.31.1
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH] drm/i915/ttm: Fix incorrect assumptions about
 ttm_bo_validate() semantics
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.29
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Cc: =?UTF-8?q?Thomas=20Hellstr=C3=B6m?= <thomas.hellstrom@linux.intel.com>,
 matthew.auld@intel.com
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

V2UgaGF2ZSBhc3N1bWVkIHRoYXQgaWYgdGhlIGN1cnJlbnQgcGxhY2VtZW50IHdhcyBub3QgdGhl
IHJlcXVlc3RlZApwbGFjZW1lbnQsIGJ1dCBpbnN0ZWFkIG9uZSBvZiB0aGUgYnVzeSBwbGFjZW1l
bnRzLCBhIFRUTSBtb3ZlIHdvdWxkIGhhdmUKYmVlbiB0cmlnZ2VyZWQuIFRoYXQgaXMgbm90IHRo
ZSBjYXNlLgoKU28gd2hlbiB3ZSBpbml0aWFsbHkgcGxhY2UgTE1FTSBvYmplY3RzIGluICJMaW1i
byIsICh0aGF0IGlzIHN5c3RlbQpwbGFjZW1lbnQgd2l0aG91dCBhbnkgcGFnZXMgYWxsb2NhdGVk
KSwgdG8gYmUgYWJsZSB0byBkZWZlciBjbGVhcmluZwpvYmplY3RzIHVudGlsIGZpcnN0IGdldF9w
YWdlcygpLCB0aGUgZmlyc3QgZ2V0X3BhZ2VzKCkgd291bGQgaGFwcGlseSBrZWVwCm9iamVjdHMg
aW4gc3lzdGVtIG1lbW9yeSBpZiB0aGF0IGlzIG9uZSBvZiB0aGUgYWxsb3dlZCBwbGFjZW1lbnRz
LiBBbmQKc2luY2Ugd2UgZG9uJ3QgeWV0IHN1cHBvcnQgaTkxNSBHRU0gc3lzdGVtIG1lbW9yeSBm
cm9tIFRUTSwgZXZlcnl0aGluZwpicmVha3MgYXBhcnQuCgpTbyBtYWtlIHN1cmUgd2UgdHJ5IHRo
ZSByZXF1ZXN0ZWQgcGxhY2VtZW50IGZpcnN0LCBpZiBubyBldmljdGlvbiBpcwpuZWVkZWQuIElm
IHRoYXQgZmFpbHMsIHJldHJ5IHdpdGggYWxsIGFsbG93ZWQgcGxhY2VtZW50cyBhbHNvIGFsbG93
aW5nCmV2aWN0aW9ucy4gQWxzbyBtYWtlIHN1cmUgd2UgaGFuZGxlIFRUTSBmYWlsdXJlIGNvZGVz
IGNvcnJlY3RseS4KCkFsc28gdGVtcG9yYXJpbHkgKHVudGlsIHdlIHN1cHBvcnQgaTkxNSBHRU0g
c3lzdGVtIG9uIFRUTSksIHJlc3RyaWN0CmFsbG93ZWQgcGxhY2VtZW50cyB0byB0aGUgcmVxdWVz
dGVkIHBsYWNlbWVudCB0byBhdm9pZCB0aGluZ3MgZmFsbGluZwphcGFydCBzaG91bGQgTE1FTSBi
ZSBmdWxsLgoKRml4ZXM6IDM4ZjI4YzA2OTVjMCAoImRybS9pOTE1L3R0bTogQ2FsY3VsYXRlIHRo
ZSBvYmplY3QgcGxhY2VtZW50IGF0IGdldF9wYWdlcyB0aW1lKQpTaWduZWQtb2ZmLWJ5OiBUaG9t
YXMgSGVsbHN0csO2bSA8dGhvbWFzLmhlbGxzdHJvbUBsaW51eC5pbnRlbC5jb20+Ci0tLQogZHJp
dmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX3R0bS5jIHwgNjEgKysrKysrKysrKysrKysr
KysrKysrKystLQogMSBmaWxlIGNoYW5nZWQsIDU4IGluc2VydGlvbnMoKyksIDMgZGVsZXRpb25z
KC0pCgpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX3R0bS5j
IGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX3R0bS5jCmluZGV4IGRmNDY1MzVj
Y2E0Ny4uNGJiMDQ0MGY2OTNjIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0v
aTkxNV9nZW1fdHRtLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX3R0
bS5jCkBAIC02NCw2ICs2NCwzMCBAQCBzdGF0aWMgc3RydWN0IHR0bV9wbGFjZW1lbnQgaTkxNV9z
eXNfcGxhY2VtZW50ID0gewogCS5idXN5X3BsYWNlbWVudCA9ICZzeXNfcGxhY2VtZW50X2ZsYWdz
LAogfTsKIAorc3RhdGljIGludCBpOTE1X3R0bV9lcnJfdG9fZ2VtKGludCBlcnIpCit7CisJLyog
RmFzdHBhdGggKi8KKwlpZiAobGlrZWx5KCFlcnIpKQorCQlyZXR1cm4gMDsKKworCXN3aXRjaCAo
ZXJyKSB7CisJY2FzZSAtRUJVU1k6CisJCS8qCisJCSAqIFRUTSBsaWtlcyB0byBjb252ZXJ0IC1F
REVBRExLIHRvIC1FQlVTWSwgYW5kIHdhbnRzIHVzIHRvCisJCSAqIHJlc3RhcnQgdGhlIG9wZXJh
dGlvbiwgc2luY2Ugd2UgZG9uJ3QgcmVjb3JkIHRoZSBjb250ZW5kaW5nCisJCSAqIGxvY2suIFdl
IHVzZSAtRUFHQUlOIHRvIHJlc3RhcnQuCisJCSAqLworCQlyZXR1cm4gLUVBR0FJTjsKKwljYXNl
IC1FTk9TUEM6CisJCS8qIE1lbW9yeSB0eXBlIC8gcmVnaW9uIGlzIGZ1bGwsIGFuZCB3ZSBjYW4n
dCBldmljdC4gKi8KKwkJcmV0dXJuIC1FTlhJTzsKKwlkZWZhdWx0OgorCQlicmVhazsKKwl9CisK
KwlyZXR1cm4gZXJyOworfQorCiBzdGF0aWMgdm9pZCBpOTE1X3R0bV9hZGp1c3RfbHJ1KHN0cnVj
dCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmopOwogCiBzdGF0aWMgZW51bSB0dG1fY2FjaGluZwpA
QCAtNTIyLDE1ICs1NDYsNDYgQEAgc3RhdGljIGludCBpOTE1X3R0bV9nZXRfcGFnZXMoc3RydWN0
IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iaikKIAlzdHJ1Y3Qgc2dfdGFibGUgKnN0OwogCXN0cnVj
dCB0dG1fcGxhY2UgcmVxdWVzdGVkLCBidXN5W0k5MTVfVFRNX01BWF9QTEFDRU1FTlRTXTsKIAlz
dHJ1Y3QgdHRtX3BsYWNlbWVudCBwbGFjZW1lbnQ7CisJaW50IHJlYWxfbnVtX2J1c3k7CiAJaW50
IHJldDsKIAogCUdFTV9CVUdfT04ob2JqLT5tbS5uX3BsYWNlbWVudHMgPiBJOTE1X1RUTV9NQVhf
UExBQ0VNRU5UUyk7CiAKIAkvKiBNb3ZlIHRvIHRoZSByZXF1ZXN0ZWQgcGxhY2VtZW50LiAqLwog
CWk5MTVfdHRtX3BsYWNlbWVudF9mcm9tX29iaihvYmosICZyZXF1ZXN0ZWQsIGJ1c3ksICZwbGFj
ZW1lbnQpOworCisJLyoKKwkgKiBGb3Igbm93IHdlIHN1cHBvcnQgTE1FTSBvbmx5IHdpdGggVFRN
LgorCSAqIFRPRE86IFJlbW92ZSB3aXRoIHN5c3RlbSBzdXBwb3J0CisJICovCisJR0VNX0JVR19P
TihyZXF1ZXN0ZWQubWVtX3R5cGUgPCBJOTE1X1BMX0xNRU0wIHx8CisJCSAgIGJ1c3lbMF0ubWVt
X3R5cGUgPCBJOTE1X1BMX0xNRU0wKTsKKworCS8qIEZpcnN0IHRyeSBvbmx5IHRoZSByZXF1ZXN0
ZWQgcGxhY2VtZW50LiBObyBldmljdGlvbi4gKi8KKwlyZWFsX251bV9idXN5ID0gZmV0Y2hfYW5k
X3plcm8oJnBsYWNlbWVudC5udW1fYnVzeV9wbGFjZW1lbnQpOwogCXJldCA9IHR0bV9ib192YWxp
ZGF0ZShibywgJnBsYWNlbWVudCwgJmN0eCk7Ci0JaWYgKHJldCkKLQkJcmV0dXJuIHJldCA9PSAt
RU5PU1BDID8gLUVOWElPIDogcmV0OworCWlmIChyZXQpIHsKKwkJcmV0ID0gaTkxNV90dG1fZXJy
X3RvX2dlbShyZXQpOworCQkvKgorCQkgKiBBbnl0aGluZyB0aGF0IHdhbnRzIHRvIHJlc3RhcnQg
dGhlIG9wZXJhdGlvbiBnZXRzIHRvCisJCSAqIGRvIHRoYXQuCisJCSAqLworCQlpZiAocmV0ID09
IC1FREVBRExLIHx8IHJldCA9PSAtRUlOVFIgfHwgcmV0ID09IC1FUkVTVEFSVFNZUyB8fAorCQkg
ICAgcmV0ID09IC1FQUdBSU4pCisJCQlyZXR1cm4gcmV0OworCisJCS8qIFRPRE86IFJlbW92ZSB0
aGlzIHdoZW4gd2Ugc3VwcG9ydCBzeXN0ZW0gYXMgVFRNLiAqLworCQlyZWFsX251bV9idXN5ID0g
MTsKKworCQkvKgorCQkgKiBJZiB0aGUgaW5pdGlhbCBhdHRlbXB0IGZhaWxzLCBhbGxvdyBhbGwg
YWNjZXB0ZWQgcGxhY2VtZW50cywKKwkJICogZXZpY3RpbmcgaWYgbmVjZXNzYXJ5LgorCQkgKi8K
KwkJcGxhY2VtZW50Lm51bV9idXN5X3BsYWNlbWVudCA9IHJlYWxfbnVtX2J1c3k7CisJCXJldCA9
IHR0bV9ib192YWxpZGF0ZShibywgJnBsYWNlbWVudCwgJmN0eCk7CisJCWlmIChyZXQpCisJCQly
ZXR1cm4gaTkxNV90dG1fZXJyX3RvX2dlbShyZXQpOworCX0KIAogCS8qIE9iamVjdCBlaXRoZXIg
aGFzIGEgcGFnZSB2ZWN0b3Igb3IgaXMgYW4gaW9tZW0gb2JqZWN0ICovCiAJc3QgPSBiby0+dHRt
ID8gaTkxNV90dG1fdHRfZ2V0X3N0KGJvLT50dG0pIDogb2JqLT50dG0uY2FjaGVkX2lvX3N0OwpA
QCAtNzQxLDUgKzc5Niw1IEBAIGludCBfX2k5MTVfZ2VtX3R0bV9vYmplY3RfaW5pdChzdHJ1Y3Qg
aW50ZWxfbWVtb3J5X3JlZ2lvbiAqbWVtLAogCQlvYmotPnR0bS5jcmVhdGVkID0gdHJ1ZTsKIAog
CS8qIGk5MTUgd2FudHMgLUVOWElPIHdoZW4gb3V0IG9mIG1lbW9yeSByZWdpb24gc3BhY2UuICov
Ci0JcmV0dXJuIChyZXQgPT0gLUVOT1NQQykgPyAtRU5YSU8gOiByZXQ7CisJcmV0dXJuIGk5MTVf
dHRtX2Vycl90b19nZW0ocmV0KTsKIH0KLS0gCjIuMzEuMQoKX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX18KSW50ZWwtZ2Z4IG1haWxpbmcgbGlzdApJbnRlbC1n
ZnhAbGlzdHMuZnJlZWRlc2t0b3Aub3JnCmh0dHBzOi8vbGlzdHMuZnJlZWRlc2t0b3Aub3JnL21h
aWxtYW4vbGlzdGluZm8vaW50ZWwtZ2Z4Cg==

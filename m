Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 79AF26E60A
	for <lists+intel-gfx@lfdr.de>; Fri, 19 Jul 2019 15:04:45 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id D81B66E82A;
	Fri, 19 Jul 2019 13:04:43 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from fireflyinternet.com (mail.fireflyinternet.com [109.228.58.192])
 by gabe.freedesktop.org (Postfix) with ESMTPS id B7CBF6E829
 for <intel-gfx@lists.freedesktop.org>; Fri, 19 Jul 2019 13:04:42 +0000 (UTC)
X-Default-Received-SPF: pass (skip=forwardok (res=PASS))
 x-ip-name=78.156.65.138; 
Received: from haswell.alporthouse.com (unverified [78.156.65.138]) 
 by fireflyinternet.com (Firefly Internet (M1)) with ESMTP id 17429390-1500050 
 for multiple; Fri, 19 Jul 2019 14:04:24 +0100
From: Chris Wilson <chris@chris-wilson.co.uk>
To: intel-gfx@lists.freedesktop.org
Date: Fri, 19 Jul 2019 14:04:23 +0100
Message-Id: <20190719130423.11195-1-chris@chris-wilson.co.uk>
X-Mailer: git-send-email 2.22.0
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH] drm/i915: Hide unshrinkable context objects
 from the shrinker
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

VGhlIHNocmlua2VyIGNhbm5vdCB0b3VjaCBvYmplY3RzIHVzZWQgYnkgdGhlIGNvbnRleHRzIChs
b2dpY2FsIHN0YXRlCmFuZCByaW5nKS4gQ3VycmVudGx5IHdlIG1hcmsgdGhvc2UgYXMgInBpbl9n
bG9iYWwiIHRvIGxldCB0aGUgc2hyaW5rZXIKc2tpcCBvdmVyIHRoZW0sIGhvd2V2ZXIsIGlmIHdl
IHJlbW92ZSB0aGVtIGZyb20gdGhlIHNocmlua2VyIGxpc3RzCmVudGlyZWx5LCB3ZSBkb24ndCBl
dmVudCBoYXZlIHRvIGluY2x1ZGUgdGhlbSBpbiBvdXIgc2hyaW5rIGFjY291bnRpbmcuCgpCeSBr
ZWVwaW5nIHRoZSB1bnNocmlua2FibGUgb2JqZWN0cyBpbiBvdXIgc2hyaW5rZXIgdHJhY2tpbmcs
IHdlIHJlcG9ydAphIGxhcmdlIG51bWJlciBvZiBvYmplY3RzIGF2YWlsYWJsZSB0byBiZSBzaHJ1
bmssIGFuZCBsZWF2ZSB0aGUgc2hyaW5rZXIKZGVlcGx5IHVuc2F0aXNmaWVkIHdoZW4gd2UgZmFp
bCB0byByZWNsYWltIHRob3NlLiBUaGUgc2hyaW5rZXIgd2lsbApwZXJzaXN0IGluIHRyeWluZyB0
byByZWNsYWltIHRoZSB1bmF2YWlsYWJsZSBvYmplY3RzLCBmb3JjaW5nIHRoZSBzeXN0ZW0KaW50
byBhIGxpdmVsb2NrIChub3QgZXZlbiBoaXR0aW5nIHRoZSBkcmVhZCBvb21raWxsZXIpLgoKdjI6
IEV4dGVuZCB1bnNocmlua2FibGUgcHJvdGVjdGlvbiBmb3IgcGVybWEtcGlubmVkIHNjcmF0Y2gg
YW5kIGd1YwphbGxvY2F0aW9ucyAoVHZydGtvKQoKU2lnbmVkLW9mZi1ieTogQ2hyaXMgV2lsc29u
IDxjaHJpc0BjaHJpcy13aWxzb24uY28udWs+CkNjOiBUdnJ0a28gVXJzdWxpbiA8dHZydGtvLnVy
c3VsaW5AaW50ZWwuY29tPgotLS0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9v
YmplY3QuYyAgIHwgMTEgKystLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX29i
amVjdC5oICAgfCAgNCArKwogZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX3BhZ2Vz
LmMgICAgfCAxMyArLS0tLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX3Nocmlu
a2VyLmMgfCA1NyArKysrKysrKysrKysrKysrKysrKwogZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qv
aW50ZWxfY29udGV4dC5jICAgICAgfCAgNCArLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50
ZWxfZ3QuYyAgICAgICAgICAgfCAgMiArCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9y
aW5nYnVmZmVyLmMgICB8IDE3ICsrKy0tLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvdWMvaW50
ZWxfZ3VjLmMgICAgICAgfCAgMiArCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2RlYnVnZnMu
YyAgICAgICAgICB8ICAzICstCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3ZtYS5jICAgICAg
ICAgICAgICB8IDE1ICsrKysrKwogZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV92bWEuaCAgICAg
ICAgICAgICAgfCAgNCArKwogMTEgZmlsZXMgY2hhbmdlZCwgMTAxIGluc2VydGlvbnMoKyksIDMx
IGRlbGV0aW9ucygtKQoKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1
X2dlbV9vYmplY3QuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9vYmplY3Qu
YwppbmRleCBkNTE5N2EyYTEwNmYuLjRlYTk3ZmNhOWMzNSAxMDA2NDQKLS0tIGEvZHJpdmVycy9n
cHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX29iamVjdC5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9p
OTE1L2dlbS9pOTE1X2dlbV9vYmplY3QuYwpAQCAtNjMsNiArNjMsOCBAQCB2b2lkIGk5MTVfZ2Vt
X29iamVjdF9pbml0KHN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmosCiAJc3Bpbl9sb2Nr
X2luaXQoJm9iai0+dm1hLmxvY2spOwogCUlOSVRfTElTVF9IRUFEKCZvYmotPnZtYS5saXN0KTsK
IAorCUlOSVRfTElTVF9IRUFEKCZvYmotPm1tLmxpbmspOworCiAJSU5JVF9MSVNUX0hFQUQoJm9i
ai0+bHV0X2xpc3QpOwogCUlOSVRfTElTVF9IRUFEKCZvYmotPmJhdGNoX3Bvb2xfbGluayk7CiAK
QEAgLTI3MywxNCArMjc1LDcgQEAgdm9pZCBpOTE1X2dlbV9mcmVlX29iamVjdChzdHJ1Y3QgZHJt
X2dlbV9vYmplY3QgKmdlbV9vYmopCiAJICogb3IgZWxzZSB3ZSBtYXkgb29tIHdoaWxzdCB0aGVy
ZSBhcmUgcGxlbnR5IG9mIGRlZmVycmVkCiAJICogZnJlZWQgb2JqZWN0cy4KIAkgKi8KLQlpZiAo
aTkxNV9nZW1fb2JqZWN0X2hhc19wYWdlcyhvYmopICYmCi0JICAgIGk5MTVfZ2VtX29iamVjdF9p
c19zaHJpbmthYmxlKG9iaikpIHsKLQkJdW5zaWduZWQgbG9uZyBmbGFnczsKLQotCQlzcGluX2xv
Y2tfaXJxc2F2ZSgmaTkxNS0+bW0ub2JqX2xvY2ssIGZsYWdzKTsKLQkJbGlzdF9kZWxfaW5pdCgm
b2JqLT5tbS5saW5rKTsKLQkJc3Bpbl91bmxvY2tfaXJxcmVzdG9yZSgmaTkxNS0+bW0ub2JqX2xv
Y2ssIGZsYWdzKTsKLQl9CisJaTkxNV9nZW1fb2JqZWN0X21ha2VfdW5zaHJpbmthYmxlKG9iaik7
CiAKIAkvKgogCSAqIFNpbmNlIHdlIHJlcXVpcmUgYmxvY2tpbmcgb24gc3RydWN0X211dGV4IHRv
IHVuYmluZCB0aGUgZnJlZWQKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9p
OTE1X2dlbV9vYmplY3QuaCBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9vYmpl
Y3QuaAppbmRleCA2N2FlYTA3ZWEwMTkuLjM3MTRjZjIzNGQ2NCAxMDA2NDQKLS0tIGEvZHJpdmVy
cy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX29iamVjdC5oCisrKyBiL2RyaXZlcnMvZ3B1L2Ry
bS9pOTE1L2dlbS9pOTE1X2dlbV9vYmplY3QuaApAQCAtMzk0LDYgKzM5NCwxMCBAQCBpOTE1X2dl
bV9vYmplY3RfcGluX3RvX2Rpc3BsYXlfcGxhbmUoc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3Qg
Km9iaiwKIAkJCQkgICAgIHVuc2lnbmVkIGludCBmbGFncyk7CiB2b2lkIGk5MTVfZ2VtX29iamVj
dF91bnBpbl9mcm9tX2Rpc3BsYXlfcGxhbmUoc3RydWN0IGk5MTVfdm1hICp2bWEpOwogCit2b2lk
IGk5MTVfZ2VtX29iamVjdF9tYWtlX3Vuc2hyaW5rYWJsZShzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29i
amVjdCAqb2JqKTsKK3ZvaWQgaTkxNV9nZW1fb2JqZWN0X21ha2Vfc2hyaW5rYWJsZShzdHJ1Y3Qg
ZHJtX2k5MTVfZ2VtX29iamVjdCAqb2JqKTsKK3ZvaWQgaTkxNV9nZW1fb2JqZWN0X21ha2VfcHVy
Z2VhYmxlKHN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmopOworCiBzdGF0aWMgaW5saW5l
IGJvb2wgY3B1X3dyaXRlX25lZWRzX2NsZmx1c2goc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3Qg
Km9iaikKIHsKIAlpZiAob2JqLT5jYWNoZV9kaXJ0eSkKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1
L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9wYWdlcy5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2Vt
L2k5MTVfZ2VtX3BhZ2VzLmMKaW5kZXggYjM2YWQyNjlmNGVhLi45MmFkM2NjMjIwZTMgMTAwNjQ0
Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9wYWdlcy5jCisrKyBiL2Ry
aXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9wYWdlcy5jCkBAIC0xNTMsMjQgKzE1Mywx
MyBAQCBzdGF0aWMgdm9pZCBfX2k5MTVfZ2VtX29iamVjdF9yZXNldF9wYWdlX2l0ZXIoc3RydWN0
IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iaikKIHN0cnVjdCBzZ190YWJsZSAqCiBfX2k5MTVfZ2Vt
X29iamVjdF91bnNldF9wYWdlcyhzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2JqKQogewot
CXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0gdG9faTkxNShvYmotPmJhc2UuZGV2KTsK
IAlzdHJ1Y3Qgc2dfdGFibGUgKnBhZ2VzOwogCiAJcGFnZXMgPSBmZXRjaF9hbmRfemVybygmb2Jq
LT5tbS5wYWdlcyk7CiAJaWYgKElTX0VSUl9PUl9OVUxMKHBhZ2VzKSkKIAkJcmV0dXJuIHBhZ2Vz
OwogCi0JaWYgKGk5MTVfZ2VtX29iamVjdF9pc19zaHJpbmthYmxlKG9iaikpIHsKLQkJdW5zaWdu
ZWQgbG9uZyBmbGFnczsKLQotCQlzcGluX2xvY2tfaXJxc2F2ZSgmaTkxNS0+bW0ub2JqX2xvY2ss
IGZsYWdzKTsKLQotCQlsaXN0X2RlbCgmb2JqLT5tbS5saW5rKTsKLQkJaTkxNS0+bW0uc2hyaW5r
X2NvdW50LS07Ci0JCWk5MTUtPm1tLnNocmlua19tZW1vcnkgLT0gb2JqLT5iYXNlLnNpemU7Ci0K
LQkJc3Bpbl91bmxvY2tfaXJxcmVzdG9yZSgmaTkxNS0+bW0ub2JqX2xvY2ssIGZsYWdzKTsKLQl9
CisJaTkxNV9nZW1fb2JqZWN0X21ha2VfdW5zaHJpbmthYmxlKG9iaik7CiAKIAlpZiAob2JqLT5t
bS5tYXBwaW5nKSB7CiAJCXZvaWQgKnB0cjsKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9p
OTE1L2dlbS9pOTE1X2dlbV9zaHJpbmtlci5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5
MTVfZ2VtX3Nocmlua2VyLmMKaW5kZXggM2Y0YzZiZGNjM2MzLi4xNGFiZmQ3NzM2NWYgMTAwNjQ0
Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9zaHJpbmtlci5jCisrKyBi
L2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9zaHJpbmtlci5jCkBAIC01MzAsMyAr
NTMwLDYwIEBAIHZvaWQgaTkxNV9nZW1fc2hyaW5rZXJfdGFpbnRzX211dGV4KHN0cnVjdCBkcm1f
aTkxNV9wcml2YXRlICppOTE1LAogCWlmICh1bmxvY2spCiAJCW11dGV4X3JlbGVhc2UoJmk5MTUt
PmRybS5zdHJ1Y3RfbXV0ZXguZGVwX21hcCwgMCwgX1JFVF9JUF8pOwogfQorCit2b2lkIGk5MTVf
Z2VtX29iamVjdF9tYWtlX3Vuc2hyaW5rYWJsZShzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAq
b2JqKQoreworCWlmICghbGlzdF9lbXB0eSgmb2JqLT5tbS5saW5rKSkgeworCQlzdHJ1Y3QgZHJt
X2k5MTVfcHJpdmF0ZSAqaTkxNSA9IHRvX2k5MTUob2JqLT5iYXNlLmRldik7CisJCXVuc2lnbmVk
IGxvbmcgZmxhZ3M7CisKKwkJc3Bpbl9sb2NrX2lycXNhdmUoJmk5MTUtPm1tLm9ial9sb2NrLCBm
bGFncyk7CisJCUdFTV9CVUdfT04obGlzdF9lbXB0eSgmb2JqLT5tbS5saW5rKSk7CisKKwkJbGlz
dF9kZWxfaW5pdCgmb2JqLT5tbS5saW5rKTsKKwkJaTkxNS0+bW0uc2hyaW5rX2NvdW50LS07CisJ
CWk5MTUtPm1tLnNocmlua19tZW1vcnkgLT0gb2JqLT5iYXNlLnNpemU7CisKKwkJc3Bpbl91bmxv
Y2tfaXJxcmVzdG9yZSgmaTkxNS0+bW0ub2JqX2xvY2ssIGZsYWdzKTsKKwl9Cit9CisKK3ZvaWQg
aTkxNV9nZW1fb2JqZWN0X21ha2Vfc2hyaW5rYWJsZShzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVj
dCAqb2JqKQoreworCUdFTV9CVUdfT04oIWk5MTVfZ2VtX29iamVjdF9oYXNfcGFnZXMob2JqKSk7
CisJR0VNX0JVR19PTighbGlzdF9lbXB0eSgmb2JqLT5tbS5saW5rKSk7CisKKwlpZiAoaTkxNV9n
ZW1fb2JqZWN0X2lzX3Nocmlua2FibGUob2JqKSkgeworCQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0
ZSAqaTkxNSA9IHRvX2k5MTUob2JqLT5iYXNlLmRldik7CisJCXVuc2lnbmVkIGxvbmcgZmxhZ3M7
CisKKwkJc3Bpbl9sb2NrX2lycXNhdmUoJmk5MTUtPm1tLm9ial9sb2NrLCBmbGFncyk7CisJCUdF
TV9CVUdfT04oIWtyZWZfcmVhZCgmb2JqLT5iYXNlLnJlZmNvdW50KSk7CisKKwkJbGlzdF9hZGRf
dGFpbCgmb2JqLT5tbS5saW5rLCAmaTkxNS0+bW0uc2hyaW5rX2xpc3QpOworCQlpOTE1LT5tbS5z
aHJpbmtfY291bnQrKzsKKwkJaTkxNS0+bW0uc2hyaW5rX21lbW9yeSArPSBvYmotPmJhc2Uuc2l6
ZTsKKworCQlzcGluX3VubG9ja19pcnFyZXN0b3JlKCZpOTE1LT5tbS5vYmpfbG9jaywgZmxhZ3Mp
OworCX0KK30KKwordm9pZCBpOTE1X2dlbV9vYmplY3RfbWFrZV9wdXJnZWFibGUoc3RydWN0IGRy
bV9pOTE1X2dlbV9vYmplY3QgKm9iaikKK3sKKwlHRU1fQlVHX09OKCFpOTE1X2dlbV9vYmplY3Rf
aGFzX3BhZ2VzKG9iaikpOworCUdFTV9CVUdfT04oIWxpc3RfZW1wdHkoJm9iai0+bW0ubGluaykp
OworCisJaWYgKGk5MTVfZ2VtX29iamVjdF9pc19zaHJpbmthYmxlKG9iaikpIHsKKwkJc3RydWN0
IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSB0b19pOTE1KG9iai0+YmFzZS5kZXYpOworCQl1bnNp
Z25lZCBsb25nIGZsYWdzOworCisJCXNwaW5fbG9ja19pcnFzYXZlKCZpOTE1LT5tbS5vYmpfbG9j
aywgZmxhZ3MpOworCQlHRU1fQlVHX09OKCFrcmVmX3JlYWQoJm9iai0+YmFzZS5yZWZjb3VudCkp
OworCisJCWxpc3RfYWRkX3RhaWwoJm9iai0+bW0ubGluaywgJmk5MTUtPm1tLnB1cmdlX2xpc3Qp
OworCQlpOTE1LT5tbS5zaHJpbmtfY291bnQrKzsKKwkJaTkxNS0+bW0uc2hyaW5rX21lbW9yeSAr
PSBvYmotPmJhc2Uuc2l6ZTsKKworCQlzcGluX3VubG9ja19pcnFyZXN0b3JlKCZpOTE1LT5tbS5v
YmpfbG9jaywgZmxhZ3MpOworCX0KK30KZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1
L2d0L2ludGVsX2NvbnRleHQuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2NvbnRl
eHQuYwppbmRleCA5ZTRmNTFjZTUyZmYuLjk4MzBlZGRhMWFkZSAxMDA2NDQKLS0tIGEvZHJpdmVy
cy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfY29udGV4dC5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9p
OTE1L2d0L2ludGVsX2NvbnRleHQuYwpAQCAtMTE4LDcgKzExOCw3IEBAIHN0YXRpYyBpbnQgX19j
b250ZXh0X3Bpbl9zdGF0ZShzdHJ1Y3QgaTkxNV92bWEgKnZtYSkKIAkgKiBBbmQgbWFyayBpdCBh
cyBhIGdsb2JhbGx5IHBpbm5lZCBvYmplY3QgdG8gbGV0IHRoZSBzaHJpbmtlciBrbm93CiAJICog
aXQgY2Fubm90IHJlY2xhaW0gdGhlIG9iamVjdCB1bnRpbCB3ZSByZWxlYXNlIGl0LgogCSAqLwot
CXZtYS0+b2JqLT5waW5fZ2xvYmFsKys7CisJaTkxNV92bWFfbWFrZV91bnNocmlua2FibGUodm1h
KTsKIAl2bWEtPm9iai0+bW0uZGlydHkgPSB0cnVlOwogCiAJcmV0dXJuIDA7CkBAIC0xMjYsOCAr
MTI2LDggQEAgc3RhdGljIGludCBfX2NvbnRleHRfcGluX3N0YXRlKHN0cnVjdCBpOTE1X3ZtYSAq
dm1hKQogCiBzdGF0aWMgdm9pZCBfX2NvbnRleHRfdW5waW5fc3RhdGUoc3RydWN0IGk5MTVfdm1h
ICp2bWEpCiB7Ci0Jdm1hLT5vYmotPnBpbl9nbG9iYWwtLTsKIAlfX2k5MTVfdm1hX3VucGluKHZt
YSk7CisJaTkxNV92bWFfbWFrZV9zaHJpbmthYmxlKHZtYSk7CiB9CiAKIHN0YXRpYyB2b2lkIF9f
aW50ZWxfY29udGV4dF9yZXRpcmUoc3RydWN0IGk5MTVfYWN0aXZlICphY3RpdmUpCmRpZmYgLS1n
aXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9ndC5jIGIvZHJpdmVycy9ncHUvZHJt
L2k5MTUvZ3QvaW50ZWxfZ3QuYwppbmRleCBmN2U2OWRiNDAxOWQuLjViMTZiMjMzYTA1OSAxMDA2
NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfZ3QuYworKysgYi9kcml2ZXJz
L2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9ndC5jCkBAIC0yMzEsNiArMjMxLDggQEAgaW50IGludGVs
X2d0X2luaXRfc2NyYXRjaChzdHJ1Y3QgaW50ZWxfZ3QgKmd0LCB1bnNpZ25lZCBpbnQgc2l6ZSkK
IAlpZiAocmV0KQogCQlnb3RvIGVycl91bnJlZjsKIAorCWk5MTVfZ2VtX29iamVjdF9tYWtlX3Vu
c2hyaW5rYWJsZShvYmopOworCiAJZ3QtPnNjcmF0Y2ggPSB2bWE7CiAJcmV0dXJuIDA7CiAKZGlm
ZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX3JpbmdidWZmZXIuYyBiL2Ry
aXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX3JpbmdidWZmZXIuYwppbmRleCAzOGVjMTFhZTZl
ZDcuLmQ4ZWZiODhmMzNmMyAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50
ZWxfcmluZ2J1ZmZlci5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX3Jpbmdi
dWZmZXIuYwpAQCAtMTIzOCw3ICsxMjM4LDcgQEAgaW50IGludGVsX3JpbmdfcGluKHN0cnVjdCBp
bnRlbF9yaW5nICpyaW5nKQogCQlnb3RvIGVycl9yaW5nOwogCX0KIAotCXZtYS0+b2JqLT5waW5f
Z2xvYmFsKys7CisJaTkxNV92bWFfbWFrZV91bnNocmlua2FibGUodm1hKTsKIAogCUdFTV9CVUdf
T04ocmluZy0+dmFkZHIpOwogCXJpbmctPnZhZGRyID0gYWRkcjsKQEAgLTEyNjcsNiArMTI2Nyw4
IEBAIHZvaWQgaW50ZWxfcmluZ19yZXNldChzdHJ1Y3QgaW50ZWxfcmluZyAqcmluZywgdTMyIHRh
aWwpCiAKIHZvaWQgaW50ZWxfcmluZ191bnBpbihzdHJ1Y3QgaW50ZWxfcmluZyAqcmluZykKIHsK
KwlzdHJ1Y3QgaTkxNV92bWEgKnZtYSA9IHJpbmctPnZtYTsKKwogCWlmICghYXRvbWljX2RlY19h
bmRfdGVzdCgmcmluZy0+cGluX2NvdW50KSkKIAkJcmV0dXJuOwogCkBAIC0xMjc1LDE4ICsxMjc3
LDE3IEBAIHZvaWQgaW50ZWxfcmluZ191bnBpbihzdHJ1Y3QgaW50ZWxfcmluZyAqcmluZykKIAkv
KiBEaXNjYXJkIGFueSB1bnVzZWQgYnl0ZXMgYmV5b25kIHRoYXQgc3VibWl0dGVkIHRvIGh3LiAq
LwogCWludGVsX3JpbmdfcmVzZXQocmluZywgcmluZy0+dGFpbCk7CiAKLQlHRU1fQlVHX09OKCFy
aW5nLT52bWEpOwotCWk5MTVfdm1hX3Vuc2V0X2dndHRfd3JpdGUocmluZy0+dm1hKTsKLQlpZiAo
aTkxNV92bWFfaXNfbWFwX2FuZF9mZW5jZWFibGUocmluZy0+dm1hKSkKLQkJaTkxNV92bWFfdW5w
aW5faW9tYXAocmluZy0+dm1hKTsKKwlpOTE1X3ZtYV91bnNldF9nZ3R0X3dyaXRlKHZtYSk7CisJ
aWYgKGk5MTVfdm1hX2lzX21hcF9hbmRfZmVuY2VhYmxlKHZtYSkpCisJCWk5MTVfdm1hX3VucGlu
X2lvbWFwKHZtYSk7CiAJZWxzZQotCQlpOTE1X2dlbV9vYmplY3RfdW5waW5fbWFwKHJpbmctPnZt
YS0+b2JqKTsKKwkJaTkxNV9nZW1fb2JqZWN0X3VucGluX21hcCh2bWEtPm9iaik7CiAKIAlHRU1f
QlVHX09OKCFyaW5nLT52YWRkcik7CiAJcmluZy0+dmFkZHIgPSBOVUxMOwogCi0JcmluZy0+dm1h
LT5vYmotPnBpbl9nbG9iYWwtLTsKLQlpOTE1X3ZtYV91bnBpbihyaW5nLT52bWEpOworCWk5MTVf
dm1hX3VucGluKHZtYSk7CisJaTkxNV92bWFfbWFrZV9wdXJnZWFibGUodm1hKTsKIAogCWludGVs
X3RpbWVsaW5lX3VucGluKHJpbmctPnRpbWVsaW5lKTsKIH0KZGlmZiAtLWdpdCBhL2RyaXZlcnMv
Z3B1L2RybS9pOTE1L2d0L3VjL2ludGVsX2d1Yy5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qv
dWMvaW50ZWxfZ3VjLmMKaW5kZXggODNmMmMxOTczNzVmLi5hNWJhMDE2NGZkMTQgMTAwNjQ0Ci0t
LSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L3VjL2ludGVsX2d1Yy5jCisrKyBiL2RyaXZlcnMv
Z3B1L2RybS9pOTE1L2d0L3VjL2ludGVsX2d1Yy5jCkBAIC01OTcsNiArNTk3LDggQEAgc3RydWN0
IGk5MTVfdm1hICppbnRlbF9ndWNfYWxsb2NhdGVfdm1hKHN0cnVjdCBpbnRlbF9ndWMgKmd1Yywg
dTMyIHNpemUpCiAJCWdvdG8gZXJyOwogCX0KIAorCWk5MTVfZ2VtX29iamVjdF9tYWtlX3Vuc2hy
aW5rYWJsZShvYmopOworCiAJcmV0dXJuIHZtYTsKIAogZXJyOgpkaWZmIC0tZ2l0IGEvZHJpdmVy
cy9ncHUvZHJtL2k5MTUvaTkxNV9kZWJ1Z2ZzLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1
X2RlYnVnZnMuYwppbmRleCA2Yjg0ZDA0YTZhMjguLmM0M2YyNzAwODVmNSAxMDA2NDQKLS0tIGEv
ZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9kZWJ1Z2ZzLmMKKysrIGIvZHJpdmVycy9ncHUvZHJt
L2k5MTUvaTkxNV9kZWJ1Z2ZzLmMKQEAgLTM2Myw4ICszNjMsOSBAQCBzdGF0aWMgaW50IGk5MTVf
Z2VtX29iamVjdF9pbmZvKHN0cnVjdCBzZXFfZmlsZSAqbSwgdm9pZCAqZGF0YSkKIAlzdHJ1Y3Qg
ZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IG5vZGVfdG9faTkxNShtLT5wcml2YXRlKTsKIAlpbnQg
cmV0OwogCi0Jc2VxX3ByaW50ZihtLCAiJXUgc2hyaW5rYWJsZSBvYmplY3RzLCAlbGx1IGJ5dGVz
XG4iLAorCXNlcV9wcmludGYobSwgIiV1IHNocmlua2FibGUgWyV1IGZyZWVdIG9iamVjdHMsICVs
bHUgYnl0ZXNcbiIsCiAJCSAgIGk5MTUtPm1tLnNocmlua19jb3VudCwKKwkJICAgYXRvbWljX3Jl
YWQoJmk5MTUtPm1tLmZyZWVfY291bnQpLAogCQkgICBpOTE1LT5tbS5zaHJpbmtfbWVtb3J5KTsK
IAogCXNlcV9wdXRjKG0sICdcbicpOwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUv
aTkxNV92bWEuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfdm1hLmMKaW5kZXggZWIxNmEx
YTkzYmJjLi5lMjdkZGJmZjQ4N2UgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5
MTVfdm1hLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV92bWEuYwpAQCAtMTAzMCw2
ICsxMDMwLDIxIEBAIGludCBpOTE1X3ZtYV91bmJpbmQoc3RydWN0IGk5MTVfdm1hICp2bWEpCiAJ
cmV0dXJuIDA7CiB9CiAKK3ZvaWQgaTkxNV92bWFfbWFrZV91bnNocmlua2FibGUoc3RydWN0IGk5
MTVfdm1hICp2bWEpCit7CisJaTkxNV9nZW1fb2JqZWN0X21ha2VfdW5zaHJpbmthYmxlKHZtYS0+
b2JqKTsKK30KKwordm9pZCBpOTE1X3ZtYV9tYWtlX3Nocmlua2FibGUoc3RydWN0IGk5MTVfdm1h
ICp2bWEpCit7CisJaTkxNV9nZW1fb2JqZWN0X21ha2Vfc2hyaW5rYWJsZSh2bWEtPm9iaik7Cit9
CisKK3ZvaWQgaTkxNV92bWFfbWFrZV9wdXJnZWFibGUoc3RydWN0IGk5MTVfdm1hICp2bWEpCit7
CisJaTkxNV9nZW1fb2JqZWN0X21ha2VfcHVyZ2VhYmxlKHZtYS0+b2JqKTsKK30KKwogI2lmIElT
X0VOQUJMRUQoQ09ORklHX0RSTV9JOTE1X1NFTEZURVNUKQogI2luY2x1ZGUgInNlbGZ0ZXN0cy9p
OTE1X3ZtYS5jIgogI2VuZGlmCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1
X3ZtYS5oIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV92bWEuaAppbmRleCA0Yjc2OWRiNjQ5
YmYuLmEyNGJkNjc4N2VmNyAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV92
bWEuaAorKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3ZtYS5oCkBAIC00NTksNCArNDU5
LDggQEAgdm9pZCBpOTE1X3ZtYV9wYXJrZWQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUp
Owogc3RydWN0IGk5MTVfdm1hICppOTE1X3ZtYV9hbGxvYyh2b2lkKTsKIHZvaWQgaTkxNV92bWFf
ZnJlZShzdHJ1Y3QgaTkxNV92bWEgKnZtYSk7CiAKK3ZvaWQgaTkxNV92bWFfbWFrZV91bnNocmlu
a2FibGUoc3RydWN0IGk5MTVfdm1hICp2bWEpOwordm9pZCBpOTE1X3ZtYV9tYWtlX3Nocmlua2Fi
bGUoc3RydWN0IGk5MTVfdm1hICp2bWEpOwordm9pZCBpOTE1X3ZtYV9tYWtlX3B1cmdlYWJsZShz
dHJ1Y3QgaTkxNV92bWEgKnZtYSk7CisKICNlbmRpZgotLSAKMi4yMi4wCgpfX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fXwpJbnRlbC1nZnggbWFpbGluZyBsaXN0
CkludGVsLWdmeEBsaXN0cy5mcmVlZGVza3RvcC5vcmcKaHR0cHM6Ly9saXN0cy5mcmVlZGVza3Rv
cC5vcmcvbWFpbG1hbi9saXN0aW5mby9pbnRlbC1nZng=

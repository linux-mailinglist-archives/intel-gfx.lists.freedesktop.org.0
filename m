Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 8BA919842B
	for <lists+intel-gfx@lfdr.de>; Wed, 21 Aug 2019 21:16:23 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 7765F89BFB;
	Wed, 21 Aug 2019 19:16:21 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from fireflyinternet.com (mail.fireflyinternet.com [109.228.58.192])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 7CA8589BFB
 for <intel-gfx@lists.freedesktop.org>; Wed, 21 Aug 2019 19:16:20 +0000 (UTC)
X-Default-Received-SPF: pass (skip=forwardok (res=PASS))
 x-ip-name=78.156.65.138; 
Received: from haswell.alporthouse.com (unverified [78.156.65.138]) 
 by fireflyinternet.com (Firefly Internet (M1)) with ESMTP id 18218887-1500050 
 for <intel-gfx@lists.freedesktop.org>; Wed, 21 Aug 2019 20:16:16 +0100
From: Chris Wilson <chris@chris-wilson.co.uk>
To: intel-gfx@lists.freedesktop.org
Date: Wed, 21 Aug 2019 20:16:06 +0100
Message-Id: <20190821191606.17001-1-chris@chris-wilson.co.uk>
X-Mailer: git-send-email 2.23.0
MIME-Version: 1.0
Subject: [Intel-gfx] [CI] drm/i915: Generalise the clflush dma-worker
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

RXh0cmFjdCB0aGUgZG1hLWZlbmNlIHdvcmtlciB1c2VkIGJ5IGNsZmx1c2ggZm9yIHdpZGVyIHVz
ZSwgYXMgd2UKYW50aWNpcGF0ZSB1c2luZyB3b3JrZXJzIGNvdXBsZWQgdG8gZG1hLWZlbmNlcyBt
b3JlIGZyZXF1ZW50bHkuCgpTaWduZWQtb2ZmLWJ5OiBDaHJpcyBXaWxzb24gPGNocmlzQGNocmlz
LXdpbHNvbi5jby51az4KUmV2aWV3ZWQtYnk6IE1hdHRoZXcgQXVsZCA8bWF0dGhldy5hdWxkQGlu
dGVsLmNvbT4KLS0tCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9NYWtlZmlsZSAgICAgICAgICAgICAg
IHwgICAxICsKIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9jbGZsdXNoLmMgfCAx
MjMgKysrKysrKy0tLS0tLS0tLS0tLS0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfc3dfZmVu
Y2Vfd29yay5jICAgfCAgOTUgKysrKysrKysrKysrKysrCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9p
OTE1X3N3X2ZlbmNlX3dvcmsuaCAgIHwgIDQ0ICsrKysrKysKIDQgZmlsZXMgY2hhbmdlZCwgMTgz
IGluc2VydGlvbnMoKyksIDgwIGRlbGV0aW9ucygtKQogY3JlYXRlIG1vZGUgMTAwNjQ0IGRyaXZl
cnMvZ3B1L2RybS9pOTE1L2k5MTVfc3dfZmVuY2Vfd29yay5jCiBjcmVhdGUgbW9kZSAxMDA2NDQg
ZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9zd19mZW5jZV93b3JrLmgKCmRpZmYgLS1naXQgYS9k
cml2ZXJzL2dwdS9kcm0vaTkxNS9NYWtlZmlsZSBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L01ha2Vm
aWxlCmluZGV4IDQ1YWRkODEyMDQ4Yi4uNjU4YjkzMGQzNGE4IDEwMDY0NAotLS0gYS9kcml2ZXJz
L2dwdS9kcm0vaTkxNS9NYWtlZmlsZQorKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9NYWtlZmls
ZQpAQCAtNjIsNiArNjIsNyBAQCBpOTE1LXkgKz0gXAogCWk5MTVfbWVtY3B5Lm8gXAogCWk5MTVf
bW0ubyBcCiAJaTkxNV9zd19mZW5jZS5vIFwKKwlpOTE1X3N3X2ZlbmNlX3dvcmsubyBcCiAJaTkx
NV9zeW5jbWFwLm8gXAogCWk5MTVfdXNlcl9leHRlbnNpb25zLm8KIApkaWZmIC0tZ2l0IGEvZHJp
dmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX2NsZmx1c2guYyBiL2RyaXZlcnMvZ3B1L2Ry
bS9pOTE1L2dlbS9pOTE1X2dlbV9jbGZsdXNoLmMKaW5kZXggZmIwZWYxNzZiYTViLi5iOWY1MDRi
YTNiMzIgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9jbGZs
dXNoLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX2NsZmx1c2guYwpA
QCAtOCw4OCArOCw2NyBAQAogCiAjaW5jbHVkZSAiaTkxNV9kcnYuaCIKICNpbmNsdWRlICJpOTE1
X2dlbV9jbGZsdXNoLmgiCisjaW5jbHVkZSAiaTkxNV9zd19mZW5jZV93b3JrLmgiCiAjaW5jbHVk
ZSAiaTkxNV90cmFjZS5oIgogCi1zdGF0aWMgREVGSU5FX1NQSU5MT0NLKGNsZmx1c2hfbG9jayk7
Ci0KIHN0cnVjdCBjbGZsdXNoIHsKLQlzdHJ1Y3QgZG1hX2ZlbmNlIGRtYTsgLyogTXVzdCBiZSBm
aXJzdCBmb3IgZG1hX2ZlbmNlX2ZyZWUoKSAqLwotCXN0cnVjdCBpOTE1X3N3X2ZlbmNlIHdhaXQ7
Ci0Jc3RydWN0IHdvcmtfc3RydWN0IHdvcms7CisJc3RydWN0IGRtYV9mZW5jZV93b3JrIGJhc2U7
CiAJc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iajsKIH07CiAKLXN0YXRpYyBjb25zdCBj
aGFyICppOTE1X2NsZmx1c2hfZ2V0X2RyaXZlcl9uYW1lKHN0cnVjdCBkbWFfZmVuY2UgKmZlbmNl
KQotewotCXJldHVybiBEUklWRVJfTkFNRTsKLX0KLQotc3RhdGljIGNvbnN0IGNoYXIgKmk5MTVf
Y2xmbHVzaF9nZXRfdGltZWxpbmVfbmFtZShzdHJ1Y3QgZG1hX2ZlbmNlICpmZW5jZSkKLXsKLQly
ZXR1cm4gImNsZmx1c2giOwotfQotCi1zdGF0aWMgdm9pZCBpOTE1X2NsZmx1c2hfcmVsZWFzZShz
dHJ1Y3QgZG1hX2ZlbmNlICpmZW5jZSkKLXsKLQlzdHJ1Y3QgY2xmbHVzaCAqY2xmbHVzaCA9IGNv
bnRhaW5lcl9vZihmZW5jZSwgdHlwZW9mKCpjbGZsdXNoKSwgZG1hKTsKLQotCWk5MTVfc3dfZmVu
Y2VfZmluaSgmY2xmbHVzaC0+d2FpdCk7Ci0KLQlCVUlMRF9CVUdfT04ob2Zmc2V0b2YodHlwZW9m
KCpjbGZsdXNoKSwgZG1hKSk7Ci0JZG1hX2ZlbmNlX2ZyZWUoJmNsZmx1c2gtPmRtYSk7Ci19Ci0K
LXN0YXRpYyBjb25zdCBzdHJ1Y3QgZG1hX2ZlbmNlX29wcyBpOTE1X2NsZmx1c2hfb3BzID0gewot
CS5nZXRfZHJpdmVyX25hbWUgPSBpOTE1X2NsZmx1c2hfZ2V0X2RyaXZlcl9uYW1lLAotCS5nZXRf
dGltZWxpbmVfbmFtZSA9IGk5MTVfY2xmbHVzaF9nZXRfdGltZWxpbmVfbmFtZSwKLQkucmVsZWFz
ZSA9IGk5MTVfY2xmbHVzaF9yZWxlYXNlLAotfTsKLQotc3RhdGljIHZvaWQgX19pOTE1X2RvX2Ns
Zmx1c2goc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iaikKK3N0YXRpYyB2b2lkIF9fZG9f
Y2xmbHVzaChzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2JqKQogewogCUdFTV9CVUdfT04o
IWk5MTVfZ2VtX29iamVjdF9oYXNfcGFnZXMob2JqKSk7CiAJZHJtX2NsZmx1c2hfc2cob2JqLT5t
bS5wYWdlcyk7CiAJaW50ZWxfZnJvbnRidWZmZXJfZmx1c2gob2JqLT5mcm9udGJ1ZmZlciwgT1JJ
R0lOX0NQVSk7CiB9CiAKLXN0YXRpYyB2b2lkIGk5MTVfY2xmbHVzaF93b3JrKHN0cnVjdCB3b3Jr
X3N0cnVjdCAqd29yaykKK3N0YXRpYyBpbnQgY2xmbHVzaF93b3JrKHN0cnVjdCBkbWFfZmVuY2Vf
d29yayAqYmFzZSkKIHsKLQlzdHJ1Y3QgY2xmbHVzaCAqY2xmbHVzaCA9IGNvbnRhaW5lcl9vZih3
b3JrLCB0eXBlb2YoKmNsZmx1c2gpLCB3b3JrKTsKLQlzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVj
dCAqb2JqID0gY2xmbHVzaC0+b2JqOwotCi0JaWYgKGk5MTVfZ2VtX29iamVjdF9waW5fcGFnZXMo
b2JqKSkgewotCQlEUk1fRVJST1IoIkZhaWxlZCB0byBhY3F1aXJlIG9iai0+cGFnZXMgZm9yIGNs
Zmx1c2hpbmdcbiIpOwotCQlnb3RvIG91dDsKLQl9CisJc3RydWN0IGNsZmx1c2ggKmNsZmx1c2gg
PSBjb250YWluZXJfb2YoYmFzZSwgdHlwZW9mKCpjbGZsdXNoKSwgYmFzZSk7CisJc3RydWN0IGRy
bV9pOTE1X2dlbV9vYmplY3QgKm9iaiA9IGZldGNoX2FuZF96ZXJvKCZjbGZsdXNoLT5vYmopOwor
CWludCBlcnI7CiAKLQlfX2k5MTVfZG9fY2xmbHVzaChvYmopOworCWVyciA9IGk5MTVfZ2VtX29i
amVjdF9waW5fcGFnZXMob2JqKTsKKwlpZiAoZXJyKQorCQlnb3RvIHB1dDsKIAorCV9fZG9fY2xm
bHVzaChvYmopOwogCWk5MTVfZ2VtX29iamVjdF91bnBpbl9wYWdlcyhvYmopOwogCi1vdXQ6Citw
dXQ6CiAJaTkxNV9nZW1fb2JqZWN0X3B1dChvYmopOworCXJldHVybiBlcnI7Cit9CisKK3N0YXRp
YyB2b2lkIGNsZmx1c2hfcmVsZWFzZShzdHJ1Y3QgZG1hX2ZlbmNlX3dvcmsgKmJhc2UpCit7CisJ
c3RydWN0IGNsZmx1c2ggKmNsZmx1c2ggPSBjb250YWluZXJfb2YoYmFzZSwgdHlwZW9mKCpjbGZs
dXNoKSwgYmFzZSk7CiAKLQlkbWFfZmVuY2Vfc2lnbmFsKCZjbGZsdXNoLT5kbWEpOwotCWRtYV9m
ZW5jZV9wdXQoJmNsZmx1c2gtPmRtYSk7CisJaWYgKGNsZmx1c2gtPm9iaikKKwkJaTkxNV9nZW1f
b2JqZWN0X3B1dChjbGZsdXNoLT5vYmopOwogfQogCi1zdGF0aWMgaW50IF9faTkxNV9zd19mZW5j
ZV9jYWxsCi1pOTE1X2NsZmx1c2hfbm90aWZ5KHN0cnVjdCBpOTE1X3N3X2ZlbmNlICpmZW5jZSwK
LQkJICAgIGVudW0gaTkxNV9zd19mZW5jZV9ub3RpZnkgc3RhdGUpCitzdGF0aWMgY29uc3Qgc3Ry
dWN0IGRtYV9mZW5jZV93b3JrX29wcyBjbGZsdXNoX29wcyA9IHsKKwkubmFtZSA9ICJjbGZsdXNo
IiwKKwkud29yayA9IGNsZmx1c2hfd29yaywKKwkucmVsZWFzZSA9IGNsZmx1c2hfcmVsZWFzZSwK
K307CisKK3N0YXRpYyBzdHJ1Y3QgY2xmbHVzaCAqY2xmbHVzaF93b3JrX2NyZWF0ZShzdHJ1Y3Qg
ZHJtX2k5MTVfZ2VtX29iamVjdCAqb2JqKQogewotCXN0cnVjdCBjbGZsdXNoICpjbGZsdXNoID0g
Y29udGFpbmVyX29mKGZlbmNlLCB0eXBlb2YoKmNsZmx1c2gpLCB3YWl0KTsKKwlzdHJ1Y3QgY2xm
bHVzaCAqY2xmbHVzaDsKIAotCXN3aXRjaCAoc3RhdGUpIHsKLQljYXNlIEZFTkNFX0NPTVBMRVRF
OgotCQlzY2hlZHVsZV93b3JrKCZjbGZsdXNoLT53b3JrKTsKLQkJYnJlYWs7CisJR0VNX0JVR19P
Tighb2JqLT5jYWNoZV9kaXJ0eSk7CiAKLQljYXNlIEZFTkNFX0ZSRUU6Ci0JCWRtYV9mZW5jZV9w
dXQoJmNsZmx1c2gtPmRtYSk7Ci0JCWJyZWFrOwotCX0KKwljbGZsdXNoID0ga21hbGxvYyhzaXpl
b2YoKmNsZmx1c2gpLCBHRlBfS0VSTkVMKTsKKwlpZiAoIWNsZmx1c2gpCisJCXJldHVybiBOVUxM
OwogCi0JcmV0dXJuIE5PVElGWV9ET05FOworCWRtYV9mZW5jZV93b3JrX2luaXQoJmNsZmx1c2gt
PmJhc2UsICZjbGZsdXNoX29wcyk7CisJY2xmbHVzaC0+b2JqID0gaTkxNV9nZW1fb2JqZWN0X2dl
dChvYmopOyAvKiBvYmogPC0+IGNsZmx1c2ggY3ljbGUgKi8KKworCXJldHVybiBjbGZsdXNoOwog
fQogCiBib29sIGk5MTVfZ2VtX2NsZmx1c2hfb2JqZWN0KHN0cnVjdCBkcm1faTkxNV9nZW1fb2Jq
ZWN0ICpvYmosCkBAIC0xMjcsMzIgKzEwNiwxNiBAQCBib29sIGk5MTVfZ2VtX2NsZmx1c2hfb2Jq
ZWN0KHN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmosCiAKIAljbGZsdXNoID0gTlVMTDsK
IAlpZiAoIShmbGFncyAmIEk5MTVfQ0xGTFVTSF9TWU5DKSkKLQkJY2xmbHVzaCA9IGttYWxsb2Mo
c2l6ZW9mKCpjbGZsdXNoKSwgR0ZQX0tFUk5FTCk7CisJCWNsZmx1c2ggPSBjbGZsdXNoX3dvcmtf
Y3JlYXRlKG9iaik7CiAJaWYgKGNsZmx1c2gpIHsKLQkJR0VNX0JVR19PTighb2JqLT5jYWNoZV9k
aXJ0eSk7Ci0KLQkJZG1hX2ZlbmNlX2luaXQoJmNsZmx1c2gtPmRtYSwKLQkJCSAgICAgICAmaTkx
NV9jbGZsdXNoX29wcywKLQkJCSAgICAgICAmY2xmbHVzaF9sb2NrLAotCQkJICAgICAgIDAsIDAp
OwotCQlpOTE1X3N3X2ZlbmNlX2luaXQoJmNsZmx1c2gtPndhaXQsIGk5MTVfY2xmbHVzaF9ub3Rp
ZnkpOwotCi0JCWNsZmx1c2gtPm9iaiA9IGk5MTVfZ2VtX29iamVjdF9nZXQob2JqKTsKLQkJSU5J
VF9XT1JLKCZjbGZsdXNoLT53b3JrLCBpOTE1X2NsZmx1c2hfd29yayk7Ci0KLQkJZG1hX2ZlbmNl
X2dldCgmY2xmbHVzaC0+ZG1hKTsKLQotCQlpOTE1X3N3X2ZlbmNlX2F3YWl0X3Jlc2VydmF0aW9u
KCZjbGZsdXNoLT53YWl0LAotCQkJCQkJb2JqLT5iYXNlLnJlc3YsIE5VTEwsCi0JCQkJCQl0cnVl
LCBJOTE1X0ZFTkNFX1RJTUVPVVQsCisJCWk5MTVfc3dfZmVuY2VfYXdhaXRfcmVzZXJ2YXRpb24o
JmNsZmx1c2gtPmJhc2UuY2hhaW4sCisJCQkJCQlvYmotPmJhc2UucmVzdiwgTlVMTCwgdHJ1ZSwK
KwkJCQkJCUk5MTVfRkVOQ0VfVElNRU9VVCwKIAkJCQkJCUk5MTVfRkVOQ0VfR0ZQKTsKLQotCQlk
bWFfcmVzdl9hZGRfZXhjbF9mZW5jZShvYmotPmJhc2UucmVzdiwKLQkJCQkJCSAgJmNsZmx1c2gt
PmRtYSk7Ci0KLQkJaTkxNV9zd19mZW5jZV9jb21taXQoJmNsZmx1c2gtPndhaXQpOworCQlkbWFf
cmVzdl9hZGRfZXhjbF9mZW5jZShvYmotPmJhc2UucmVzdiwgJmNsZmx1c2gtPmJhc2UuZG1hKTsK
KwkJZG1hX2ZlbmNlX3dvcmtfY29tbWl0KCZjbGZsdXNoLT5iYXNlKTsKIAl9IGVsc2UgaWYgKG9i
ai0+bW0ucGFnZXMpIHsKLQkJX19pOTE1X2RvX2NsZmx1c2gob2JqKTsKKwkJX19kb19jbGZsdXNo
KG9iaik7CiAJfSBlbHNlIHsKIAkJR0VNX0JVR19PTihvYmotPndyaXRlX2RvbWFpbiAhPSBJOTE1
X0dFTV9ET01BSU5fQ1BVKTsKIAl9CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9p
OTE1X3N3X2ZlbmNlX3dvcmsuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfc3dfZmVuY2Vf
d29yay5jCm5ldyBmaWxlIG1vZGUgMTAwNjQ0CmluZGV4IDAwMDAwMDAwMDAwMC4uMDc1NTJjZDU0
NGYyCi0tLSAvZGV2L251bGwKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9zd19mZW5j
ZV93b3JrLmMKQEAgLTAsMCArMSw5NSBAQAorLy8gU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IE1J
VAorCisvKgorICogQ29weXJpZ2h0IMKpIDIwMTkgSW50ZWwgQ29ycG9yYXRpb24KKyAqLworCisj
aW5jbHVkZSAiaTkxNV9zd19mZW5jZV93b3JrLmgiCisKK3N0YXRpYyB2b2lkIGZlbmNlX3dvcmso
c3RydWN0IHdvcmtfc3RydWN0ICp3b3JrKQoreworCXN0cnVjdCBkbWFfZmVuY2Vfd29yayAqZiA9
IGNvbnRhaW5lcl9vZih3b3JrLCB0eXBlb2YoKmYpLCB3b3JrKTsKKwlpbnQgZXJyOworCisJZXJy
ID0gZi0+b3BzLT53b3JrKGYpOworCWlmIChlcnIpCisJCWRtYV9mZW5jZV9zZXRfZXJyb3IoJmYt
PmRtYSwgZXJyKTsKKwlkbWFfZmVuY2Vfc2lnbmFsKCZmLT5kbWEpOworCWRtYV9mZW5jZV9wdXQo
JmYtPmRtYSk7Cit9CisKK3N0YXRpYyBpbnQgX19pOTE1X3N3X2ZlbmNlX2NhbGwKK2ZlbmNlX25v
dGlmeShzdHJ1Y3QgaTkxNV9zd19mZW5jZSAqZmVuY2UsIGVudW0gaTkxNV9zd19mZW5jZV9ub3Rp
Znkgc3RhdGUpCit7CisJc3RydWN0IGRtYV9mZW5jZV93b3JrICpmID0gY29udGFpbmVyX29mKGZl
bmNlLCB0eXBlb2YoKmYpLCBjaGFpbik7CisKKwlzd2l0Y2ggKHN0YXRlKSB7CisJY2FzZSBGRU5D
RV9DT01QTEVURToKKwkJaWYgKGZlbmNlLT5lcnJvcikKKwkJCWRtYV9mZW5jZV9zZXRfZXJyb3Io
JmYtPmRtYSwgZmVuY2UtPmVycm9yKTsKKworCQlpZiAoIWYtPmRtYS5lcnJvcikgeworCQkJZG1h
X2ZlbmNlX2dldCgmZi0+ZG1hKTsKKwkJCXF1ZXVlX3dvcmsoc3lzdGVtX3VuYm91bmRfd3EsICZm
LT53b3JrKTsKKwkJfSBlbHNlIHsKKwkJCWRtYV9mZW5jZV9zaWduYWwoJmYtPmRtYSk7CisJCX0K
KwkJYnJlYWs7CisKKwljYXNlIEZFTkNFX0ZSRUU6CisJCWRtYV9mZW5jZV9wdXQoJmYtPmRtYSk7
CisJCWJyZWFrOworCX0KKworCXJldHVybiBOT1RJRllfRE9ORTsKK30KKworc3RhdGljIGNvbnN0
IGNoYXIgKmdldF9kcml2ZXJfbmFtZShzdHJ1Y3QgZG1hX2ZlbmNlICpmZW5jZSkKK3sKKwlyZXR1
cm4gImRtYS1mZW5jZSI7Cit9CisKK3N0YXRpYyBjb25zdCBjaGFyICpnZXRfdGltZWxpbmVfbmFt
ZShzdHJ1Y3QgZG1hX2ZlbmNlICpmZW5jZSkKK3sKKwlzdHJ1Y3QgZG1hX2ZlbmNlX3dvcmsgKmYg
PSBjb250YWluZXJfb2YoZmVuY2UsIHR5cGVvZigqZiksIGRtYSk7CisKKwlyZXR1cm4gZi0+b3Bz
LT5uYW1lID86ICJ3b3JrIjsKK30KKworc3RhdGljIHZvaWQgZmVuY2VfcmVsZWFzZShzdHJ1Y3Qg
ZG1hX2ZlbmNlICpmZW5jZSkKK3sKKwlzdHJ1Y3QgZG1hX2ZlbmNlX3dvcmsgKmYgPSBjb250YWlu
ZXJfb2YoZmVuY2UsIHR5cGVvZigqZiksIGRtYSk7CisKKwlpZiAoZi0+b3BzLT5yZWxlYXNlKQor
CQlmLT5vcHMtPnJlbGVhc2UoZik7CisKKwlpOTE1X3N3X2ZlbmNlX2ZpbmkoJmYtPmNoYWluKTsK
KworCUJVSUxEX0JVR19PTihvZmZzZXRvZih0eXBlb2YoKmYpLCBkbWEpKTsKKwlkbWFfZmVuY2Vf
ZnJlZSgmZi0+ZG1hKTsKK30KKworc3RhdGljIGNvbnN0IHN0cnVjdCBkbWFfZmVuY2Vfb3BzIGZl
bmNlX29wcyA9IHsKKwkuZ2V0X2RyaXZlcl9uYW1lID0gZ2V0X2RyaXZlcl9uYW1lLAorCS5nZXRf
dGltZWxpbmVfbmFtZSA9IGdldF90aW1lbGluZV9uYW1lLAorCS5yZWxlYXNlID0gZmVuY2VfcmVs
ZWFzZSwKK307CisKK3ZvaWQgZG1hX2ZlbmNlX3dvcmtfaW5pdChzdHJ1Y3QgZG1hX2ZlbmNlX3dv
cmsgKmYsCisJCQkgY29uc3Qgc3RydWN0IGRtYV9mZW5jZV93b3JrX29wcyAqb3BzKQoreworCXNw
aW5fbG9ja19pbml0KCZmLT5sb2NrKTsKKwlkbWFfZmVuY2VfaW5pdCgmZi0+ZG1hLCAmZmVuY2Vf
b3BzLCAmZi0+bG9jaywgMCwgMCk7CisJaTkxNV9zd19mZW5jZV9pbml0KCZmLT5jaGFpbiwgZmVu
Y2Vfbm90aWZ5KTsKKwlJTklUX1dPUksoJmYtPndvcmssIGZlbmNlX3dvcmspOworCisJZi0+b3Bz
ID0gb3BzOworfQorCitpbnQgZG1hX2ZlbmNlX3dvcmtfY2hhaW4oc3RydWN0IGRtYV9mZW5jZV93
b3JrICpmLCBzdHJ1Y3QgZG1hX2ZlbmNlICpzaWduYWwpCit7CisJaWYgKCFzaWduYWwpCisJCXJl
dHVybiAwOworCisJcmV0dXJuIF9faTkxNV9zd19mZW5jZV9hd2FpdF9kbWFfZmVuY2UoJmYtPmNo
YWluLCBzaWduYWwsICZmLT5jYik7Cit9CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkx
NS9pOTE1X3N3X2ZlbmNlX3dvcmsuaCBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfc3dfZmVu
Y2Vfd29yay5oCm5ldyBmaWxlIG1vZGUgMTAwNjQ0CmluZGV4IDAwMDAwMDAwMDAwMC4uM2EyMmIy
ODdlMjAxCi0tLSAvZGV2L251bGwKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9zd19m
ZW5jZV93b3JrLmgKQEAgLTAsMCArMSw0NCBAQAorLyogU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6
IE1JVCAqLworCisvKgorICogQ29weXJpZ2h0IMKpIDIwMTkgSW50ZWwgQ29ycG9yYXRpb24KKyAq
LworCisjaWZuZGVmIEk5MTVfU1dfRkVOQ0VfV09SS19ICisjZGVmaW5lIEk5MTVfU1dfRkVOQ0Vf
V09SS19ICisKKyNpbmNsdWRlIDxsaW51eC9kbWEtZmVuY2UuaD4KKyNpbmNsdWRlIDxsaW51eC9z
cGlubG9jay5oPgorI2luY2x1ZGUgPGxpbnV4L3dvcmtxdWV1ZS5oPgorCisjaW5jbHVkZSAiaTkx
NV9zd19mZW5jZS5oIgorCitzdHJ1Y3QgZG1hX2ZlbmNlX3dvcms7CisKK3N0cnVjdCBkbWFfZmVu
Y2Vfd29ya19vcHMgeworCWNvbnN0IGNoYXIgKm5hbWU7CisJaW50ICgqd29yaykoc3RydWN0IGRt
YV9mZW5jZV93b3JrICpmKTsKKwl2b2lkICgqcmVsZWFzZSkoc3RydWN0IGRtYV9mZW5jZV93b3Jr
ICpmKTsKK307CisKK3N0cnVjdCBkbWFfZmVuY2Vfd29yayB7CisJc3RydWN0IGRtYV9mZW5jZSBk
bWE7CisJc3BpbmxvY2tfdCBsb2NrOworCisJc3RydWN0IGk5MTVfc3dfZmVuY2UgY2hhaW47CisJ
c3RydWN0IGk5MTVfc3dfZG1hX2ZlbmNlX2NiIGNiOworCisJc3RydWN0IHdvcmtfc3RydWN0IHdv
cms7CisJY29uc3Qgc3RydWN0IGRtYV9mZW5jZV93b3JrX29wcyAqb3BzOworfTsKKwordm9pZCBk
bWFfZmVuY2Vfd29ya19pbml0KHN0cnVjdCBkbWFfZmVuY2Vfd29yayAqZiwKKwkJCSBjb25zdCBz
dHJ1Y3QgZG1hX2ZlbmNlX3dvcmtfb3BzICpvcHMpOworaW50IGRtYV9mZW5jZV93b3JrX2NoYWlu
KHN0cnVjdCBkbWFfZmVuY2Vfd29yayAqZiwgc3RydWN0IGRtYV9mZW5jZSAqc2lnbmFsKTsKKwor
c3RhdGljIGlubGluZSB2b2lkIGRtYV9mZW5jZV93b3JrX2NvbW1pdChzdHJ1Y3QgZG1hX2ZlbmNl
X3dvcmsgKmYpCit7CisJaTkxNV9zd19mZW5jZV9jb21taXQoJmYtPmNoYWluKTsKK30KKworI2Vu
ZGlmIC8qIEk5MTVfU1dfRkVOQ0VfV09SS19IICovCi0tIAoyLjIzLjAKCl9fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fCkludGVsLWdmeCBtYWlsaW5nIGxpc3QK
SW50ZWwtZ2Z4QGxpc3RzLmZyZWVkZXNrdG9wLm9yZwpodHRwczovL2xpc3RzLmZyZWVkZXNrdG9w
Lm9yZy9tYWlsbWFuL2xpc3RpbmZvL2ludGVsLWdmeA==

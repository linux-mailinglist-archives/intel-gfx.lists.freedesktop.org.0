Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 129A2ECEC3
	for <lists+intel-gfx@lfdr.de>; Sat,  2 Nov 2019 13:57:46 +0100 (CET)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 32D7A6E454;
	Sat,  2 Nov 2019 12:57:44 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from fireflyinternet.com (mail.fireflyinternet.com [109.228.58.192])
 by gabe.freedesktop.org (Postfix) with ESMTPS id D807D6E454
 for <intel-gfx@lists.freedesktop.org>; Sat,  2 Nov 2019 12:57:42 +0000 (UTC)
X-Default-Received-SPF: pass (skip=forwardok (res=PASS))
 x-ip-name=78.156.65.138; 
Received: from haswell.alporthouse.com (unverified [78.156.65.138]) 
 by fireflyinternet.com (Firefly Internet (M1)) with ESMTP id 19057931-1500050 
 for <intel-gfx@lists.freedesktop.org>; Sat, 02 Nov 2019 12:57:39 +0000
From: Chris Wilson <chris@chris-wilson.co.uk>
To: intel-gfx@lists.freedesktop.org
Date: Sat,  2 Nov 2019 12:57:39 +0000
Message-Id: <20191102125739.24626-1-chris@chris-wilson.co.uk>
X-Mailer: git-send-email 2.24.0.rc2
MIME-Version: 1.0
Subject: [Intel-gfx] [CI] drm/i915/execlists: Verify context register state
 before execution
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

Q2hlY2sgdGhhdCB0aGUgY29udGV4dCdzIHJpbmcgcmVnaXN0ZXIgc3RhdGUgc3RpbGwgbWF0Y2hl
cyBvdXIKZXhwZWN0YXRpb25zIHByaW9yIHRvIGV4ZWN1dGlvbi4KClNpZ25lZC1vZmYtYnk6IENo
cmlzIFdpbHNvbiA8Y2hyaXNAY2hyaXMtd2lsc29uLmNvLnVrPgpDYzogTWlrYSBLdW9wcGFsYSA8
bWlrYS5rdW9wcGFsYUBsaW51eC5pbnRlbC5jb20+ClJldmlld2VkLWJ5OiBNaWthIEt1b3BwYWxh
IDxtaWthLmt1b3BwYWxhQGxpbnV4LmludGVsLmNvbT4KLS0tCiBkcml2ZXJzL2dwdS9kcm0vaTkx
NS9ndC9pbnRlbF9scmMuYyAgICAgfCA3MSArKysrKysrKysrKysrKysrKysrKy0tLS0tCiBkcml2
ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9scmNfcmVnLmggfCAgNCArLQogZHJpdmVycy9ncHUv
ZHJtL2k5MTUvZ3Qvc2VsZnRlc3RfbHJjLmMgIHwgIDYgKy0tCiAzIGZpbGVzIGNoYW5nZWQsIDYy
IGluc2VydGlvbnMoKyksIDE5IGRlbGV0aW9ucygtKQoKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1
L2RybS9pOTE1L2d0L2ludGVsX2xyYy5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxf
bHJjLmMKaW5kZXggNTFhZWYyYTIzM2NiLi4wYTc3NWExZTk2OTYgMTAwNjQ0Ci0tLSBhL2RyaXZl
cnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2xyYy5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1
L2d0L2ludGVsX2xyYy5jCkBAIC05OTAsNiArOTkwLDU4IEBAIHN0YXRpYyB2b2lkIGludGVsX2Vu
Z2luZV9jb250ZXh0X291dChzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmUpCiAJd3JpdGVf
c2VxdW5sb2NrX2lycXJlc3RvcmUoJmVuZ2luZS0+c3RhdHMubG9jaywgZmxhZ3MpOwogfQogCitz
dGF0aWMgaW50IGxyY19yaW5nX21pX21vZGUoY29uc3Qgc3RydWN0IGludGVsX2VuZ2luZV9jcyAq
ZW5naW5lKQoreworCWlmIChJTlRFTF9HRU4oZW5naW5lLT5pOTE1KSA+PSAxMikKKwkJcmV0dXJu
IDB4NjA7CisJZWxzZSBpZiAoSU5URUxfR0VOKGVuZ2luZS0+aTkxNSkgPj0gOSkKKwkJcmV0dXJu
IDB4NTQ7CisJZWxzZSBpZiAoZW5naW5lLT5jbGFzcyA9PSBSRU5ERVJfQ0xBU1MpCisJCXJldHVy
biAweDU4OworCWVsc2UKKwkJcmV0dXJuIC0xOworfQorCitzdGF0aWMgdm9pZAorZXhlY2xpc3Rz
X2NoZWNrX2NvbnRleHQoY29uc3Qgc3RydWN0IGludGVsX2NvbnRleHQgKmNlLAorCQkJY29uc3Qg
c3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lKQoreworCWNvbnN0IHN0cnVjdCBpbnRlbF9y
aW5nICpyaW5nID0gY2UtPnJpbmc7CisJdTMyICpyZWdzID0gY2UtPmxyY19yZWdfc3RhdGU7CisJ
Ym9vbCB2YWxpZCA9IHRydWU7CisJaW50IHg7CisKKwlpZiAocmVnc1tDVFhfUklOR19TVEFSVF0g
IT0gaTkxNV9nZ3R0X29mZnNldChyaW5nLT52bWEpKSB7CisJCXByX2VycigiJXM6IGNvbnRleHQg
c3VibWl0dGVkIHdpdGggaW5jb3JyZWN0IFJJTkdfU1RBUlQgWyUwOHhdLCBleHBlY3RlZCAlMDh4
XG4iLAorCQkgICAgICAgZW5naW5lLT5uYW1lLAorCQkgICAgICAgcmVnc1tDVFhfUklOR19TVEFS
VF0sCisJCSAgICAgICBpOTE1X2dndHRfb2Zmc2V0KHJpbmctPnZtYSkpOworCQlyZWdzW0NUWF9S
SU5HX1NUQVJUXSA9IGk5MTVfZ2d0dF9vZmZzZXQocmluZy0+dm1hKTsKKwkJdmFsaWQgPSBmYWxz
ZTsKKwl9CisKKwlpZiAoKHJlZ3NbQ1RYX1JJTkdfQ1RMXSAmIH4oUklOR19XQUlUIHwgUklOR19X
QUlUX1NFTUFQSE9SRSkpICE9CisJICAgIChSSU5HX0NUTF9TSVpFKHJpbmctPnNpemUpIHwgUklO
R19WQUxJRCkpIHsKKwkJcHJfZXJyKCIlczogY29udGV4dCBzdWJtaXR0ZWQgd2l0aCBpbmNvcnJl
Y3QgUklOR19DVEwgWyUwOHhdLCBleHBlY3RlZCAlMDh4XG4iLAorCQkgICAgICAgZW5naW5lLT5u
YW1lLAorCQkgICAgICAgcmVnc1tDVFhfUklOR19DVExdLAorCQkgICAgICAgKHUzMikoUklOR19D
VExfU0laRShyaW5nLT5zaXplKSB8IFJJTkdfVkFMSUQpKTsKKwkJcmVnc1tDVFhfUklOR19DVExd
ID0gUklOR19DVExfU0laRShyaW5nLT5zaXplKSB8IFJJTkdfVkFMSUQ7CisJCXZhbGlkID0gZmFs
c2U7CisJfQorCisJeCA9IGxyY19yaW5nX21pX21vZGUoZW5naW5lKTsKKwlpZiAoeCAhPSAtMSAm
JiAocmVnc1t4ICsgMV0gJiAocmVnc1t4ICsgMV0gPj4gMTYpKSAmIFNUT1BfUklORykgeworCQlw
cl9lcnIoIiVzOiBjb250ZXh0IHN1Ym1pdHRlZCB3aXRoIFNUT1BfUklORyBbJTA4eF0gaW4gUklO
R19NSV9NT0RFXG4iLAorCQkgICAgICAgZW5naW5lLT5uYW1lLCByZWdzW3ggKyAxXSk7CisJCXJl
Z3NbeCArIDFdICY9IH5TVE9QX1JJTkc7CisJCXJlZ3NbeCArIDFdIHw9IFNUT1BfUklORyA8PCAx
NjsKKwkJdmFsaWQgPSBmYWxzZTsKKwl9CisKKwlXQVJOX09OQ0UoIXZhbGlkLCAiSW52YWxpZCBs
cmMgc3RhdGUgZm91bmQgYmVmb3JlIHN1Ym1pc3Npb25cbiIpOworfQorCiBzdGF0aWMgaW5saW5l
IHN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKgogX19leGVjbGlzdHNfc2NoZWR1bGVfaW4oc3RydWN0
IGk5MTVfcmVxdWVzdCAqcnEpCiB7CkBAIC05OTgsNiArMTA1MCw5IEBAIF9fZXhlY2xpc3RzX3Nj
aGVkdWxlX2luKHN0cnVjdCBpOTE1X3JlcXVlc3QgKnJxKQogCiAJaW50ZWxfY29udGV4dF9nZXQo
Y2UpOwogCisJaWYgKElTX0VOQUJMRUQoQ09ORklHX0RSTV9JOTE1X0RFQlVHX0dFTSkpCisJCWV4
ZWNsaXN0c19jaGVja19jb250ZXh0KGNlLCBycS0+ZW5naW5lKTsKKwogCWlmIChjZS0+dGFnKSB7
CiAJCS8qIFVzZSBhIGZpeGVkIHRhZyBmb3IgT0EgYW5kIGZyaWVuZHMgKi8KIAkJY2UtPmxyY19k
ZXNjIHw9ICh1NjQpY2UtPnRhZyA8PCAzMjsKQEAgLTIzNTMsNyArMjQwOCw3IEBAIF9fZXhlY2xp
c3RzX3VwZGF0ZV9yZWdfc3RhdGUoY29uc3Qgc3RydWN0IGludGVsX2NvbnRleHQgKmNlLAogCUdF
TV9CVUdfT04oIWludGVsX3Jpbmdfb2Zmc2V0X3ZhbGlkKHJpbmcsIHJpbmctPmhlYWQpKTsKIAlH
RU1fQlVHX09OKCFpbnRlbF9yaW5nX29mZnNldF92YWxpZChyaW5nLCByaW5nLT50YWlsKSk7CiAK
LQlyZWdzW0NUWF9SSU5HX0JVRkZFUl9TVEFSVF0gPSBpOTE1X2dndHRfb2Zmc2V0KHJpbmctPnZt
YSk7CisJcmVnc1tDVFhfUklOR19TVEFSVF0gPSBpOTE1X2dndHRfb2Zmc2V0KHJpbmctPnZtYSk7
CiAJcmVnc1tDVFhfUklOR19IRUFEXSA9IHJpbmctPmhlYWQ7CiAJcmVnc1tDVFhfUklOR19UQUlM
XSA9IHJpbmctPnRhaWw7CiAKQEAgLTI5NDAsMTggKzI5OTUsNiBAQCBzdGF0aWMgdm9pZCByZXNl
dF9jc2JfcG9pbnRlcnMoc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lKQogCQkJICAgICAg
ICZleGVjbGlzdHMtPmNzYl9zdGF0dXNbcmVzZXRfdmFsdWVdKTsKIH0KIAotc3RhdGljIGludCBs
cmNfcmluZ19taV9tb2RlKGNvbnN0IHN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZSkKLXsK
LQlpZiAoSU5URUxfR0VOKGVuZ2luZS0+aTkxNSkgPj0gMTIpCi0JCXJldHVybiAweDYwOwotCWVs
c2UgaWYgKElOVEVMX0dFTihlbmdpbmUtPmk5MTUpID49IDkpCi0JCXJldHVybiAweDU0OwotCWVs
c2UgaWYgKGVuZ2luZS0+Y2xhc3MgPT0gUkVOREVSX0NMQVNTKQotCQlyZXR1cm4gMHg1ODsKLQll
bHNlCi0JCXJldHVybiAtMTsKLX0KLQogc3RhdGljIHZvaWQgX19leGVjbGlzdHNfcmVzZXRfcmVn
X3N0YXRlKGNvbnN0IHN0cnVjdCBpbnRlbF9jb250ZXh0ICpjZSwKIAkJCQkJY29uc3Qgc3RydWN0
IGludGVsX2VuZ2luZV9jcyAqZW5naW5lKQogewpAQCAtMzg4NSw3ICszOTI4LDcgQEAgc3RhdGlj
IHZvaWQgaW5pdF9jb21tb25fcmVnX3N0YXRlKHUzMiAqIGNvbnN0IHJlZ3MsCiAJCQlfTUFTS0VE
X0JJVF9ESVNBQkxFKENUWF9DVFJMX0VOR0lORV9DVFhfU0FWRV9JTkhJQklUIHwKIAkJCQkJICAg
IENUWF9DVFJMX1JTX0NUWF9FTkFCTEUpOwogCi0JcmVnc1tDVFhfUklOR19CVUZGRVJfQ09OVFJP
TF0gPSBSSU5HX0NUTF9TSVpFKHJpbmctPnNpemUpIHwgUklOR19WQUxJRDsKKwlyZWdzW0NUWF9S
SU5HX0NUTF0gPSBSSU5HX0NUTF9TSVpFKHJpbmctPnNpemUpIHwgUklOR19WQUxJRDsKIAlyZWdz
W0NUWF9CQl9TVEFURV0gPSBSSU5HX0JCX1BQR1RUOwogfQogCmRpZmYgLS1naXQgYS9kcml2ZXJz
L2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9scmNfcmVnLmggYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9n
dC9pbnRlbF9scmNfcmVnLmgKaW5kZXggMDZhYjAyNzZlMTBlLi4wOGEzYmU2NWY3MDAgMTAwNjQ0
Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2xyY19yZWcuaAorKysgYi9kcml2
ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9scmNfcmVnLmgKQEAgLTEzLDggKzEzLDggQEAKICNk
ZWZpbmUgQ1RYX0NPTlRFWFRfQ09OVFJPTAkJKDB4MDIgKyAxKQogI2RlZmluZSBDVFhfUklOR19I
RUFECQkJKDB4MDQgKyAxKQogI2RlZmluZSBDVFhfUklOR19UQUlMCQkJKDB4MDYgKyAxKQotI2Rl
ZmluZSBDVFhfUklOR19CVUZGRVJfU1RBUlQJCSgweDA4ICsgMSkKLSNkZWZpbmUgQ1RYX1JJTkdf
QlVGRkVSX0NPTlRST0wJCSgweDBhICsgMSkKKyNkZWZpbmUgQ1RYX1JJTkdfU1RBUlQJCQkoMHgw
OCArIDEpCisjZGVmaW5lIENUWF9SSU5HX0NUTAkJCSgweDBhICsgMSkKICNkZWZpbmUgQ1RYX0JC
X1NUQVRFCQkJKDB4MTAgKyAxKQogI2RlZmluZSBDVFhfQkJfUEVSX0NUWF9QVFIJCSgweDE4ICsg
MSkKICNkZWZpbmUgQ1RYX1BEUDNfVURXCQkJKDB4MjQgKyAxKQpkaWZmIC0tZ2l0IGEvZHJpdmVy
cy9ncHUvZHJtL2k5MTUvZ3Qvc2VsZnRlc3RfbHJjLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9n
dC9zZWxmdGVzdF9scmMuYwppbmRleCBlYjcxYWMyZjk5MmMuLmQxZWQzYzBmODUxYyAxMDA2NDQK
LS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qvc2VsZnRlc3RfbHJjLmMKKysrIGIvZHJpdmVy
cy9ncHUvZHJtL2k5MTUvZ3Qvc2VsZnRlc3RfbHJjLmMKQEAgLTMyMDcsMTIgKzMyMDcsMTIgQEAg
c3RhdGljIGludCBsaXZlX2xyY19maXhlZCh2b2lkICphcmcpCiAJCX0gdGJsW10gPSB7CiAJCQl7
CiAJCQkJaTkxNV9tbWlvX3JlZ19vZmZzZXQoUklOR19TVEFSVChlbmdpbmUtPm1taW9fYmFzZSkp
LAotCQkJCUNUWF9SSU5HX0JVRkZFUl9TVEFSVCAtIDEsCisJCQkJQ1RYX1JJTkdfU1RBUlQgLSAx
LAogCQkJCSJSSU5HX1NUQVJUIgogCQkJfSwKIAkJCXsKIAkJCQlpOTE1X21taW9fcmVnX29mZnNl
dChSSU5HX0NUTChlbmdpbmUtPm1taW9fYmFzZSkpLAotCQkJCUNUWF9SSU5HX0JVRkZFUl9DT05U
Uk9MIC0gMSwKKwkJCQlDVFhfUklOR19DVEwgLSAxLAogCQkJCSJSSU5HX0NUTCIKIAkJCX0sCiAJ
CQl7CkBAIC0zMjMxLDcgKzMyMzEsNyBAQCBzdGF0aWMgaW50IGxpdmVfbHJjX2ZpeGVkKHZvaWQg
KmFyZykKIAkJCQkiUklOR19NSV9NT0RFIgogCQkJfSwKIAkJCXsKLQkJCQllbmdpbmUtPm1taW9f
YmFzZSArIDB4MTEwLAorCQkJCWk5MTVfbW1pb19yZWdfb2Zmc2V0KFJJTkdfQkJTVEFURShlbmdp
bmUtPm1taW9fYmFzZSkpLAogCQkJCUNUWF9CQl9TVEFURSAtIDEsCiAJCQkJIkJCX1NUQVRFIgog
CQkJfSwKLS0gCjIuMjQuMC5yYzIKCl9fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fCkludGVsLWdmeCBtYWlsaW5nIGxpc3QKSW50ZWwtZ2Z4QGxpc3RzLmZyZWVk
ZXNrdG9wLm9yZwpodHRwczovL2xpc3RzLmZyZWVkZXNrdG9wLm9yZy9tYWlsbWFuL2xpc3RpbmZv
L2ludGVsLWdmeA==

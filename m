Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id DF92B102752
	for <lists+intel-gfx@lfdr.de>; Tue, 19 Nov 2019 15:50:24 +0100 (CET)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 1B7166E316;
	Tue, 19 Nov 2019 14:50:23 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from fireflyinternet.com (mail.fireflyinternet.com [109.228.58.192])
 by gabe.freedesktop.org (Postfix) with ESMTPS id F335E6E316
 for <intel-gfx@lists.freedesktop.org>; Tue, 19 Nov 2019 14:50:21 +0000 (UTC)
X-Default-Received-SPF: pass (skip=forwardok (res=PASS))
 x-ip-name=78.156.65.138; 
Received: from localhost (unverified [78.156.65.138]) 
 by fireflyinternet.com (Firefly Internet (M1)) with ESMTP (TLS) id
 19259229-1500050 for multiple; Tue, 19 Nov 2019 14:50:18 +0000
MIME-Version: 1.0
From: Chris Wilson <chris@chris-wilson.co.uk>
User-Agent: alot/0.6
To: Tvrtko Ursulin <tvrtko.ursulin@linux.intel.com>,
 intel-gfx@lists.freedesktop.org
References: <20191118230254.2615942-1-chris@chris-wilson.co.uk>
 <20191118230254.2615942-5-chris@chris-wilson.co.uk>
 <58557b4d-4266-9b4b-1bb3-923f23479107@linux.intel.com>
In-Reply-To: <58557b4d-4266-9b4b-1bb3-923f23479107@linux.intel.com>
Message-ID: <157417501617.10169.6336568157379479052@skylake-alporthouse-com>
Date: Tue, 19 Nov 2019 14:50:16 +0000
Subject: Re: [Intel-gfx] [PATCH 04/19] drm/i915/gt: Unlock engine-pm after
 queuing the kernel context switch
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

UXVvdGluZyBUdnJ0a28gVXJzdWxpbiAoMjAxOS0xMS0xOSAxNDozNTowNCkKPiAKPiBPbiAxOC8x
MS8yMDE5IDIzOjAyLCBDaHJpcyBXaWxzb24gd3JvdGU6Cj4gPiBJbiBjb21taXQgYTc5Y2E2NTZi
NjQ4ICgiZHJtL2k5MTU6IFB1c2ggdGhlIHdha2VyZWYtPmNvdW50IGRlZmVycmFsIHRvCj4gPiB0
aGUgYmFja2VuZCIpLCBJIGVycm9uZW91c2x5IGNvbmNsdWRlZCB0aGF0IHdlIGxhc3QgbW9kaWZ5
IHRoZSBlbmdpbmUKPiA+IGluc2lkZSBfX2k5MTVfcmVxdWVzdF9jb21taXQoKSBtZWFuaW5nIHRo
YXQgd2UgY291bGQgZW5hYmxlIGNvbmN1cnJlbnQKPiA+IHN1Ym1pc3Npb24gZm9yIHVzZXJzcGFj
ZSBhcyB3ZSBlbnF1ZXVlZCB0aGlzIHJlcXVlc3QuIEhvd2V2ZXIsIHRoaXMKPiA+IGZhbGxzIGlu
dG8gYSB0cmFwIHdpdGggb3RoZXIgdXNlcnMgb2YgdGhlIGVuZ2luZS0+a2VybmVsX2NvbnRleHQg
d2FraW5nCj4gPiB1cCBhbmQgc3VibWl0dGluZyB0aGVpciByZXF1ZXN0IGJlZm9yZSB0aGUgaWRs
ZS1zd2l0Y2ggaXMgcXVldWVkLCB3aXRoCj4gPiB0aGUgcmVzdWx0IHRoYXQgdGhlIGtlcm5lbF9j
b250ZXh0IGlzIGV4ZWN1dGVkIG91dC1vZi1zZXF1ZW5jZSBtb3N0Cj4gPiBsaWtlbHkgdXBzZXR0
aW5nIHRoZSBHUFUgYW5kIGNlcnRhaW5seSBvdXJzZWx2ZXMgd2hlbiB3ZSB0cnkgdG8gcmV0aXJl
Cj4gPiB0aGUgb3V0LW9mLXNlcXVlbmNlIHJlcXVlc3RzLgo+ID4gCj4gPiBBcyBzdWNoIHdlIG5l
ZWQgdG8gaG9sZCBvbnRvIHRoZSBlZmZlY3RpdmUgZW5naW5lLT5rZXJuZWxfY29udGV4dCBtdXRl
eAo+ID4gbG9jayAodmlhIHRoZSBlbmdpbmUgcG0gbXV0ZXggcHJveHkpIHVudGlsIHdlIGhhdmUg
ZmluaXNoIHF1ZXVpbmcgdGhlCj4gPiByZXF1ZXN0IHRvIHRoZSBlbmdpbmUuCj4gPiAKPiA+IHYy
OiBTZXJpYWxpc2UgYWdhaW5zdCBjb25jdXJyZW50IGludGVsX2d0X3JldGlyZV9yZXF1ZXN0cygp
Cj4gPiAKPiA+IEZpeGVzOiBhNzljYTY1NmI2NDggKCJkcm0vaTkxNTogUHVzaCB0aGUgd2FrZXJl
Zi0+Y291bnQgZGVmZXJyYWwgdG8gdGhlIGJhY2tlbmQiKQo+ID4gU2lnbmVkLW9mZi1ieTogQ2hy
aXMgV2lsc29uIDxjaHJpc0BjaHJpcy13aWxzb24uY28udWs+Cj4gPiBDYzogTWlrYSBLdW9wcGFs
YSA8bWlrYS5rdW9wcGFsYUBsaW51eC5pbnRlbC5jb20+Cj4gPiBDYzogVHZydGtvIFVyc3VsaW4g
PHR2cnRrby51cnN1bGluQGludGVsLmNvbT4KPiA+IC0tLQo+ID4gICBkcml2ZXJzL2dwdS9kcm0v
aTkxNS9ndC9pbnRlbF9lbmdpbmVfcG0uYyB8IDE1ICsrKysrKysrKy0tLS0tLQo+ID4gICAxIGZp
bGUgY2hhbmdlZCwgOSBpbnNlcnRpb25zKCspLCA2IGRlbGV0aW9ucygtKQo+ID4gCj4gPiBkaWZm
IC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfZW5naW5lX3BtLmMgYi9kcml2
ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9lbmdpbmVfcG0uYwo+ID4gaW5kZXggM2MwZjQ5MGZm
MmM3Li43MjJkM2VlYzIyNmUgMTAwNjQ0Cj4gPiAtLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9n
dC9pbnRlbF9lbmdpbmVfcG0uYwo+ID4gKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50
ZWxfZW5naW5lX3BtLmMKPiA+IEBAIC03NSw2ICs3NSw3IEBAIHN0YXRpYyBpbmxpbmUgdm9pZCBf
X3RpbWVsaW5lX21hcmtfdW5sb2NrKHN0cnVjdCBpbnRlbF9jb250ZXh0ICpjZSwKPiA+ICAgCj4g
PiAgIHN0YXRpYyBib29sIHN3aXRjaF90b19rZXJuZWxfY29udGV4dChzdHJ1Y3QgaW50ZWxfZW5n
aW5lX2NzICplbmdpbmUpCj4gPiAgIHsKPiA+ICsgICAgIHN0cnVjdCBpbnRlbF9jb250ZXh0ICpj
ZSA9IGVuZ2luZS0+a2VybmVsX2NvbnRleHQ7Cj4gPiAgICAgICBzdHJ1Y3QgaTkxNV9yZXF1ZXN0
ICpycTsKPiA+ICAgICAgIHVuc2lnbmVkIGxvbmcgZmxhZ3M7Cj4gPiAgICAgICBib29sIHJlc3Vs
dCA9IHRydWU7Cj4gPiBAQCAtOTksMTUgKzEwMCwxMyBAQCBzdGF0aWMgYm9vbCBzd2l0Y2hfdG9f
a2VybmVsX2NvbnRleHQoc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lKQo+ID4gICAgICAg
ICogcmV0aXJpbmcgdGhlIGxhc3QgcmVxdWVzdCwgdGh1cyBhbGwgcmluZ3Mgc2hvdWxkIGJlIGVt
cHR5IGFuZAo+ID4gICAgICAgICogYWxsIHRpbWVsaW5lcyBpZGxlLgo+ID4gICAgICAgICovCj4g
PiAtICAgICBmbGFncyA9IF9fdGltZWxpbmVfbWFya19sb2NrKGVuZ2luZS0+a2VybmVsX2NvbnRl
eHQpOwo+ID4gKyAgICAgZmxhZ3MgPSBfX3RpbWVsaW5lX21hcmtfbG9jayhjZSk7Cj4gPiAgIAo+
ID4gLSAgICAgcnEgPSBfX2k5MTVfcmVxdWVzdF9jcmVhdGUoZW5naW5lLT5rZXJuZWxfY29udGV4
dCwgR0ZQX05PV0FJVCk7Cj4gPiArICAgICBycSA9IF9faTkxNV9yZXF1ZXN0X2NyZWF0ZShjZSwg
R0ZQX05PV0FJVCk7Cj4gPiAgICAgICBpZiAoSVNfRVJSKHJxKSkKPiA+ICAgICAgICAgICAgICAg
LyogQ29udGV4dCBzd2l0Y2ggZmFpbGVkLCBob3BlIGZvciB0aGUgYmVzdCEgTWF5YmUgcmVzZXQ/
ICovCj4gPiAgICAgICAgICAgICAgIGdvdG8gb3V0X3VubG9jazsKPiA+ICAgCj4gPiAtICAgICBp
bnRlbF90aW1lbGluZV9lbnRlcihpOTE1X3JlcXVlc3RfdGltZWxpbmUocnEpKTsKPiA+IC0KPiA+
ICAgICAgIC8qIENoZWNrIGFnYWluIG9uIHRoZSBuZXh0IHJldGlyZW1lbnQuICovCj4gPiAgICAg
ICBlbmdpbmUtPndha2VyZWZfc2VyaWFsID0gZW5naW5lLT5zZXJpYWwgKyAxOwo+ID4gICAgICAg
aTkxNV9yZXF1ZXN0X2FkZF9hY3RpdmVfYmFycmllcnMocnEpOwo+ID4gQEAgLTExNiwxMyArMTE1
LDE3IEBAIHN0YXRpYyBib29sIHN3aXRjaF90b19rZXJuZWxfY29udGV4dChzdHJ1Y3QgaW50ZWxf
ZW5naW5lX2NzICplbmdpbmUpCj4gPiAgICAgICBycS0+c2NoZWQuYXR0ci5wcmlvcml0eSA9IEk5
MTVfUFJJT1JJVFlfQkFSUklFUjsKPiA+ICAgICAgIF9faTkxNV9yZXF1ZXN0X2NvbW1pdChycSk7
Cj4gPiAgIAo+ID4gKyAgICAgX19pOTE1X3JlcXVlc3RfcXVldWUocnEsIE5VTEwpOwo+ID4gKwo+
ID4gICAgICAgLyogUmVsZWFzZSBvdXIgZXhjbHVzaXZlIGhvbGQgb24gdGhlIGVuZ2luZSAqLwo+
ID4gICAgICAgX19pbnRlbF93YWtlcmVmX2RlZmVyX3BhcmsoJmVuZ2luZS0+d2FrZXJlZik7Cj4g
PiAtICAgICBfX2k5MTVfcmVxdWVzdF9xdWV1ZShycSwgTlVMTCk7Cj4gPiArCj4gPiArICAgICAv
KiBBbmQgZmluYWxseSBleHBvc2Ugb3VyIHNlbGZzZWx2ZXMgdG8gaW50ZWxfZ3RfcmV0aXJlX3Jl
cXVlc3RzKCkgCj4gCj4gb3Vyc2VsdmVzCj4gCj4gKi8KPiA+ICsgICAgIGludGVsX3RpbWVsaW5l
X2VudGVyKGNlLT50aW1lbGluZSk7Cj4gCj4gSSBoYXZlbid0IHJlYWxseSBtYW5hZ2VkIHRvIGZv
bGxvdyB0aGlzLgo+IAo+IFdoYXQgYXJlIHRoZXNlIG90aGVyIGNsaWVudHMgd2hpY2ggY2FuIHF1
ZXVlIHJlcXVlc3RzIGFuZCB3aGF0IGluIHRoaXMgCj4gYmxvY2sgcHJldmVudHMgdGhlbSBkb2lu
ZyBzbz8KClRoZXJlIGFyZSAyIG90aGVyIHBhcnRpZXMgYW5kIHRoZSBHUFUgd2hvIGhhdmUgYSBz
dGFrZSBpbiB0aGlzLgoKQSBuZXcgZ3B1IHVzZXIgd2lsbCBiZSB3YWl0aW5nIG9uIHRoZSBlbmdp
bmUtcG0gdG8gc3RhcnQgdGhlaXIKZW5naW5lX3VucGFyay4gTmV3IHdhaXRlcnMgYXJlIHByZWRp
Y2F0ZWQgb24gZW5naW5lLT53YWtlcmVmLmNvdW50IGFuZApzbyBpbnRlbF93YWtlcmVmX2RlZmVy
X3BhcmsoKSBhY3RzIGxpa2UgYSBtdXRleF91bmxvY2sgb2YgdGhlCmVuZ2luZS0+d2FrZXJlZi4K
ClRoZSBvdGhlciBwYXJ0eSBpcyBpbnRlbF9ndF9yZXRpcmVfcmVxdWVzdHMoKSwgd2hpY2ggaXMg
d2Fsa2luZyB0aGUgbGlzdApvZiBhY3RpdmUgdGltZWxpbmVzIGxvb2tpbmcgZm9yIGNvbXBsZXRp
b25zLiAgTWVhbndoaWxlIGFzIHNvb24gYXMgd2UKY2FsbCBfX2k5MTVfcmVxdWVzdF9xdWV1ZSgp
LCB0aGUgR1BVIG1heSBjb21wbGV0ZSBvdXIgcmVxdWVzdC4gRXJnbywKaWYgd2UgcHV0IG91cnNl
bHZlcyBvbiB0aGUgdGltZWxpbmVzLmFjdGl2ZV9saXN0IChpbnRlbF90aW1lbGluZV9lbnRlcikK
YmVmb3JlIHdlIHJhaXNlIHRoZSB3YWtlcmVmLmNvdW50LCB3ZSBtYXkgc2VlIHRoZSByZXF1ZXN0
IGNvbXBsZXRpb24gYW5kCnJldGlyZSBpdCBjYXVzaW5nIGFuIHVuZGVmbG93IG9mIHRoZSBlbmdp
bmUtPndha2VyZWYuCgo+IFRoZSBjaGFuZ2Ugc2VlbXMgdG8gYmUgbW92aW5nIHRoZSBxdWV1aW5n
IHRvIGJlZm9yZSAKPiBfX2ludGVsX3dha2VyZWZfZGVmZXJfcGFyayBhbmQgaW50ZWxfdGltZWxp
bmVfZW50ZXIgdG8gbGFzdC4gV2FrZXJlZiAKPiBkZWZlciBleHRlbmRzIHRoZSBlbmdpbmUgbGlm
ZXRpbWUgdW50aWwgdGhlIHN1Ym1pdHRlZCBycSBpcyByZXRpcmVkLiBCdXQgCj4gaG93IGlzIHRo
YXQgY29uc2lkZXIgInVubG9ja2luZyI/CgpzdGF0aWMgaW5saW5lIGludAppbnRlbF93YWtlcmVm
X2dldChzdHJ1Y3QgaW50ZWxfd2FrZXJlZiAqd2YpCnsKICAgICAgICBpZiAodW5saWtlbHkoIWF0
b21pY19pbmNfbm90X3plcm8oJndmLT5jb3VudCkpKQogICAgICAgICAgICAgICAgcmV0dXJuIF9f
aW50ZWxfd2FrZXJlZl9nZXRfZmlyc3Qod2YpOwoKICAgICAgICByZXR1cm4gMDsKfQoKQXMgd2Ug
YnVpbGQgdGhlIHN3aXRjaF90b19rZXJuZWxfY29udGV4dCgpLCB3Zi0+Y291bnQgaXMgMCwgYW5k
IHNvIGFsbApuZXcgdXNlcnMgd2lsbCBlbnRlciB0aGUgc2xvdyBwYXRoIGFuZCB0YWtlIHRoZSBt
dXRleF9sb2NrKCZ3Zi0+bXV0ZXgpLgoKQXMgc29vbiBhcyB3ZSBjYWxsIGludGVsX3dha2VyZWZf
ZGVmZXJfcGFyaygpLCB3ZSBjYWxsCmF0b21pY19zZXRfcmVsZWFzZSgmd2YtPmNvdW50LCAxKSBh
bmQgc28gYWxsIG5ldyB1c2VycyB3aWxsIHRha2UgdGhlCmZhc3QgcGF0aCBhbmQgc2tpcCB0aGUg
bXV0ZXhfbG9jay4gSGVuY2Ugd2h5IEkgY29ubm90ZSBpdCB3aXRoIGJlaW5nIGEKIm11dGV4X3Vu
bG9jayIKLUNocmlzCl9fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fCkludGVsLWdmeCBtYWlsaW5nIGxpc3QKSW50ZWwtZ2Z4QGxpc3RzLmZyZWVkZXNrdG9wLm9y
ZwpodHRwczovL2xpc3RzLmZyZWVkZXNrdG9wLm9yZy9tYWlsbWFuL2xpc3RpbmZvL2ludGVsLWdm
eA==

Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 44EE417330
	for <lists+intel-gfx@lfdr.de>; Wed,  8 May 2019 10:08:05 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 289588946E;
	Wed,  8 May 2019 08:08:03 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from fireflyinternet.com (mail.fireflyinternet.com [109.228.58.192])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 4A2A2893A7
 for <intel-gfx@lists.freedesktop.org>; Wed,  8 May 2019 08:07:48 +0000 (UTC)
X-Default-Received-SPF: pass (skip=forwardok (res=PASS))
 x-ip-name=78.156.65.138; 
Received: from haswell.alporthouse.com (unverified [78.156.65.138]) 
 by fireflyinternet.com (Firefly Internet (M1)) with ESMTP id 16485923-1500050 
 for multiple; Wed, 08 May 2019 09:07:10 +0100
From: Chris Wilson <chris@chris-wilson.co.uk>
To: intel-gfx@lists.freedesktop.org
Date: Wed,  8 May 2019 09:06:47 +0100
Message-Id: <20190508080704.24223-23-chris@chris-wilson.co.uk>
X-Mailer: git-send-email 2.20.1
In-Reply-To: <20190508080704.24223-1-chris@chris-wilson.co.uk>
References: <20190508080704.24223-1-chris@chris-wilson.co.uk>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH 23/40] drm/i915: Move phys objects to its own
 file
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Cc: Matthew Auld <matthew.auld@intel.com>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

Q29udGludWluZyB0aGUgZGVjbHV0dGVyaW5nIG9mIGk5MTVfZ2VtLmMsIHRoaXMgdGltZSB0aGUg
bGVnYWN5IHBoeXNpY2FsCm9iamVjdC4KClNpZ25lZC1vZmYtYnk6IENocmlzIFdpbHNvbiA8Y2hy
aXNAY2hyaXMtd2lsc29uLmNvLnVrPgpSZXZpZXdlZC1ieTogTWF0dGhldyBBdWxkIDxtYXR0aGV3
LmF1bGRAaW50ZWwuY29tPgotLS0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L01ha2VmaWxlICAgICAg
ICAgICAgICAgICB8ICAgMiArCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fb2Jq
ZWN0LmggICAgfCAgMTEgKy0KIC4uLi9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX29iamVjdF90
eXBlcy5oICB8ICAgMiArCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fcGFnZXMu
YyAgICAgfCA1MTAgKysrKysrKysrKysrKwogZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVf
Z2VtX3BoeXMuYyAgICAgIHwgMjEyICsrKysrKwogZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5
MTVfZ2VtX3NobWVtLmMgICAgIHwgIDYxICsrCiAuLi4vZHJtL2k5MTUvZ2VtL3NlbGZ0ZXN0cy9p
OTE1X2dlbV9waHlzLmMgICAgfCAgODAgKysKIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZHJ2
LmggICAgICAgICAgICAgICB8ICAgMiAtCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2dlbS5j
ICAgICAgICAgICAgICAgfCA2OTkgKy0tLS0tLS0tLS0tLS0tLS0tCiBkcml2ZXJzL2dwdS9kcm0v
aTkxNS9pOTE1X2dlbV9zaHJpbmtlci5jICAgICAgfCAgNTkgKy0KIC4uLi9ncHUvZHJtL2k5MTUv
c2VsZnRlc3RzL2k5MTVfZ2VtX29iamVjdC5jICB8ICA1NCAtLQogLi4uL2RybS9pOTE1L3NlbGZ0
ZXN0cy9pOTE1X21vY2tfc2VsZnRlc3RzLmggIHwgICAxICsKIDEyIGZpbGVzIGNoYW5nZWQsIDg4
NSBpbnNlcnRpb25zKCspLCA4MDggZGVsZXRpb25zKC0pCiBjcmVhdGUgbW9kZSAxMDA2NDQgZHJp
dmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX3BhZ2VzLmMKIGNyZWF0ZSBtb2RlIDEwMDY0
NCBkcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fcGh5cy5jCiBjcmVhdGUgbW9kZSAx
MDA2NDQgZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL3NlbGZ0ZXN0cy9pOTE1X2dlbV9waHlzLmMK
CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9NYWtlZmlsZSBiL2RyaXZlcnMvZ3B1
L2RybS9pOTE1L01ha2VmaWxlCmluZGV4IDYyNWY5NzQ5MzU1Yi4uYmEzYjgyZjNjZDQ5IDEwMDY0
NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9NYWtlZmlsZQorKysgYi9kcml2ZXJzL2dwdS9k
cm0vaTkxNS9NYWtlZmlsZQpAQCAtODgsNiArODgsOCBAQCBpOTE1LXkgKz0gJChndC15KQogb2Jq
LXkgKz0gZ2VtLwogZ2VtLXkgKz0gXAogCWdlbS9pOTE1X2dlbV9vYmplY3QubyBcCisJZ2VtL2k5
MTVfZ2VtX3BhZ2VzLm8gXAorCWdlbS9pOTE1X2dlbV9waHlzLm8gXAogCWdlbS9pOTE1X2dlbV9z
aG1lbS5vCiBpOTE1LXkgKz0gXAogCSAgJChnZW0teSkgXApkaWZmIC0tZ2l0IGEvZHJpdmVycy9n
cHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX29iamVjdC5oIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUv
Z2VtL2k5MTVfZ2VtX29iamVjdC5oCmluZGV4IGFkODIzMDNmNzQxYS4uMmU5NjNhNTkzMjQ1IDEw
MDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fb2JqZWN0LmgKKysr
IGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX29iamVjdC5oCkBAIC0zMywxMSAr
MzMsMTcgQEAgdm9pZCBfX2k5MTVfZ2VtX29iamVjdF9yZWxlYXNlX3NobWVtKHN0cnVjdCBkcm1f
aTkxNV9nZW1fb2JqZWN0ICpvYmosCiAJCQkJICAgICBzdHJ1Y3Qgc2dfdGFibGUgKnBhZ2VzLAog
CQkJCSAgICAgYm9vbCBuZWVkc19jbGZsdXNoKTsKIAoraW50IGk5MTVfZ2VtX29iamVjdF9hdHRh
Y2hfcGh5cyhzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2JqLCBpbnQgYWxpZ24pOworCiB2
b2lkIGk5MTVfZ2VtX2Nsb3NlX29iamVjdChzdHJ1Y3QgZHJtX2dlbV9vYmplY3QgKmdlbSwgc3Ry
dWN0IGRybV9maWxlICpmaWxlKTsKIHZvaWQgaTkxNV9nZW1fZnJlZV9vYmplY3Qoc3RydWN0IGRy
bV9nZW1fb2JqZWN0ICpvYmopOwogCiB2b2lkIGk5MTVfZ2VtX2ZsdXNoX2ZyZWVfb2JqZWN0cyhz
dHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSk7CiAKK3N0cnVjdCBzZ190YWJsZSAqCitfX2k5
MTVfZ2VtX29iamVjdF91bnNldF9wYWdlcyhzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2Jq
KTsKK3ZvaWQgaTkxNV9nZW1fb2JqZWN0X3RydW5jYXRlKHN0cnVjdCBkcm1faTkxNV9nZW1fb2Jq
ZWN0ICpvYmopOworCiAvKioKICAqIGk5MTVfZ2VtX29iamVjdF9sb29rdXBfcmN1IC0gbG9vayB1
cCBhIHRlbXBvcmFyeSBHRU0gb2JqZWN0IGZyb20gaXRzIGhhbmRsZQogICogQGZpbHA6IERSTSBm
aWxlIHByaXZhdGUgZGF0ZQpAQCAtMjMxLDYgKzIzNyw4IEBAIGk5MTVfZ2VtX29iamVjdF9nZXRf
ZG1hX2FkZHJlc3Moc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iaiwKIHZvaWQgX19pOTE1
X2dlbV9vYmplY3Rfc2V0X3BhZ2VzKHN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmosCiAJ
CQkJIHN0cnVjdCBzZ190YWJsZSAqcGFnZXMsCiAJCQkJIHVuc2lnbmVkIGludCBzZ19wYWdlX3Np
emVzKTsKKworaW50IF9fX19pOTE1X2dlbV9vYmplY3RfZ2V0X3BhZ2VzKHN0cnVjdCBkcm1faTkx
NV9nZW1fb2JqZWN0ICpvYmopOwogaW50IF9faTkxNV9nZW1fb2JqZWN0X2dldF9wYWdlcyhzdHJ1
Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2JqKTsKIAogc3RhdGljIGlubGluZSBpbnQgX19tdXN0
X2NoZWNrCkBAIC0yODYsNyArMjk0LDggQEAgZW51bSBpOTE1X21tX3N1YmNsYXNzIHsgLyogbG9j
a2RlcCBzdWJjbGFzcyBmb3Igb2JqLT5tbS5sb2NrL3N0cnVjdF9tdXRleCAqLwogCiBpbnQgX19p
OTE1X2dlbV9vYmplY3RfcHV0X3BhZ2VzKHN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmos
CiAJCQkJZW51bSBpOTE1X21tX3N1YmNsYXNzIHN1YmNsYXNzKTsKLXZvaWQgX19pOTE1X2dlbV9v
YmplY3RfdHJ1bmNhdGUoc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iaik7Cit2b2lkIGk5
MTVfZ2VtX29iamVjdF90cnVuY2F0ZShzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2JqKTsK
K3ZvaWQgaTkxNV9nZW1fb2JqZWN0X3dyaXRlYmFjayhzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVj
dCAqb2JqKTsKIAogZW51bSBpOTE1X21hcF90eXBlIHsKIAlJOTE1X01BUF9XQiA9IDAsCmRpZmYg
LS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fb2JqZWN0X3R5cGVzLmgg
Yi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fb2JqZWN0X3R5cGVzLmgKaW5kZXgg
ZTRiNTA5NDRmNTUzLi4yNGFiZGQ2OTk5YjUgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9p
OTE1L2dlbS9pOTE1X2dlbV9vYmplY3RfdHlwZXMuaAorKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkx
NS9nZW0vaTkxNV9nZW1fb2JqZWN0X3R5cGVzLmgKQEAgLTUyLDYgKzUyLDggQEAgc3RydWN0IGRy
bV9pOTE1X2dlbV9vYmplY3Rfb3BzIHsKIAlpbnQgKCpnZXRfcGFnZXMpKHN0cnVjdCBkcm1faTkx
NV9nZW1fb2JqZWN0ICpvYmopOwogCXZvaWQgKCpwdXRfcGFnZXMpKHN0cnVjdCBkcm1faTkxNV9n
ZW1fb2JqZWN0ICpvYmosCiAJCQkgIHN0cnVjdCBzZ190YWJsZSAqcGFnZXMpOworCXZvaWQgKCp0
cnVuY2F0ZSkoc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iaik7CisJdm9pZCAoKndyaXRl
YmFjaykoc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iaik7CiAKIAlpbnQgKCpwd3JpdGUp
KHN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmosCiAJCSAgICAgIGNvbnN0IHN0cnVjdCBk
cm1faTkxNV9nZW1fcHdyaXRlICphcmcpOwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5
MTUvZ2VtL2k5MTVfZ2VtX3BhZ2VzLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9n
ZW1fcGFnZXMuYwpuZXcgZmlsZSBtb2RlIDEwMDY0NAppbmRleCAwMDAwMDAwMDAwMDAuLjQ1MmFi
YTBhMzM1OQotLS0gL2Rldi9udWxsCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1
X2dlbV9wYWdlcy5jCkBAIC0wLDAgKzEsNTEwIEBACisvKgorICogU1BEWC1MaWNlbnNlLUlkZW50
aWZpZXI6IE1JVAorICoKKyAqIENvcHlyaWdodCDCqSAyMDE0LTIwMTYgSW50ZWwgQ29ycG9yYXRp
b24KKyAqLworCisjaW5jbHVkZSAiaTkxNV9nZW1fb2JqZWN0LmgiCisKKyNpbmNsdWRlICIuLi9p
OTE1X2Rydi5oIgorCit2b2lkIF9faTkxNV9nZW1fb2JqZWN0X3NldF9wYWdlcyhzdHJ1Y3QgZHJt
X2k5MTVfZ2VtX29iamVjdCAqb2JqLAorCQkJCSBzdHJ1Y3Qgc2dfdGFibGUgKnBhZ2VzLAorCQkJ
CSB1bnNpZ25lZCBpbnQgc2dfcGFnZV9zaXplcykKK3sKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0
ZSAqaTkxNSA9IHRvX2k5MTUob2JqLT5iYXNlLmRldik7CisJdW5zaWduZWQgbG9uZyBzdXBwb3J0
ZWQgPSBJTlRFTF9JTkZPKGk5MTUpLT5wYWdlX3NpemVzOworCWludCBpOworCisJbG9ja2RlcF9h
c3NlcnRfaGVsZCgmb2JqLT5tbS5sb2NrKTsKKworCS8qIE1ha2UgdGhlIHBhZ2VzIGNvaGVyZW50
IHdpdGggdGhlIEdQVSAoZmx1c2hpbmcgYW55IHN3YXBpbikuICovCisJaWYgKG9iai0+Y2FjaGVf
ZGlydHkpIHsKKwkJb2JqLT53cml0ZV9kb21haW4gPSAwOworCQlpZiAoaTkxNV9nZW1fb2JqZWN0
X2hhc19zdHJ1Y3RfcGFnZShvYmopKQorCQkJZHJtX2NsZmx1c2hfc2cocGFnZXMpOworCQlvYmot
PmNhY2hlX2RpcnR5ID0gZmFsc2U7CisJfQorCisJb2JqLT5tbS5nZXRfcGFnZS5zZ19wb3MgPSBw
YWdlcy0+c2dsOworCW9iai0+bW0uZ2V0X3BhZ2Uuc2dfaWR4ID0gMDsKKworCW9iai0+bW0ucGFn
ZXMgPSBwYWdlczsKKworCWlmIChpOTE1X2dlbV9vYmplY3RfaXNfdGlsZWQob2JqKSAmJgorCSAg
ICBpOTE1LT5xdWlya3MgJiBRVUlSS19QSU5fU1dJWlpMRURfUEFHRVMpIHsKKwkJR0VNX0JVR19P
TihvYmotPm1tLnF1aXJrZWQpOworCQlfX2k5MTVfZ2VtX29iamVjdF9waW5fcGFnZXMob2JqKTsK
KwkJb2JqLT5tbS5xdWlya2VkID0gdHJ1ZTsKKwl9CisKKwlHRU1fQlVHX09OKCFzZ19wYWdlX3Np
emVzKTsKKwlvYmotPm1tLnBhZ2Vfc2l6ZXMucGh5cyA9IHNnX3BhZ2Vfc2l6ZXM7CisKKwkvKgor
CSAqIENhbGN1bGF0ZSB0aGUgc3VwcG9ydGVkIHBhZ2Utc2l6ZXMgd2hpY2ggZml0IGludG8gdGhl
IGdpdmVuCisJICogc2dfcGFnZV9zaXplcy4gVGhpcyB3aWxsIGdpdmUgdXMgdGhlIHBhZ2Utc2l6
ZXMgd2hpY2ggd2UgbWF5IGJlIGFibGUKKwkgKiB0byB1c2Ugb3Bwb3J0dW5pc3RpY2FsbHkgd2hl
biBsYXRlciBpbnNlcnRpbmcgaW50byB0aGUgR1RULiBGb3IKKwkgKiBleGFtcGxlIGlmIHBoeXM9
MkcsIHRoZW4gaW4gdGhlb3J5IHdlIHNob3VsZCBiZSBhYmxlIHRvIHVzZSAxRywgMk0sCisJICog
NjRLIG9yIDRLIHBhZ2VzLCBhbHRob3VnaCBpbiBwcmFjdGljZSB0aGlzIHdpbGwgZGVwZW5kIG9u
IGEgbnVtYmVyIG9mCisJICogb3RoZXIgZmFjdG9ycy4KKwkgKi8KKwlvYmotPm1tLnBhZ2Vfc2l6
ZXMuc2cgPSAwOworCWZvcl9lYWNoX3NldF9iaXQoaSwgJnN1cHBvcnRlZCwgaWxvZzIoSTkxNV9H
VFRfTUFYX1BBR0VfU0laRSkgKyAxKSB7CisJCWlmIChvYmotPm1tLnBhZ2Vfc2l6ZXMucGh5cyAm
IH4wdSA8PCBpKQorCQkJb2JqLT5tbS5wYWdlX3NpemVzLnNnIHw9IEJJVChpKTsKKwl9CisJR0VN
X0JVR19PTighSEFTX1BBR0VfU0laRVMoaTkxNSwgb2JqLT5tbS5wYWdlX3NpemVzLnNnKSk7CisK
KwlzcGluX2xvY2soJmk5MTUtPm1tLm9ial9sb2NrKTsKKwlsaXN0X2FkZCgmb2JqLT5tbS5saW5r
LCAmaTkxNS0+bW0udW5ib3VuZF9saXN0KTsKKwlzcGluX3VubG9jaygmaTkxNS0+bW0ub2JqX2xv
Y2spOworfQorCitpbnQgX19fX2k5MTVfZ2VtX29iamVjdF9nZXRfcGFnZXMoc3RydWN0IGRybV9p
OTE1X2dlbV9vYmplY3QgKm9iaikKK3sKKwlpbnQgZXJyOworCisJaWYgKHVubGlrZWx5KG9iai0+
bW0ubWFkdiAhPSBJOTE1X01BRFZfV0lMTE5FRUQpKSB7CisJCURSTV9ERUJVRygiQXR0ZW1wdGlu
ZyB0byBvYnRhaW4gYSBwdXJnZWFibGUgb2JqZWN0XG4iKTsKKwkJcmV0dXJuIC1FRkFVTFQ7CisJ
fQorCisJZXJyID0gb2JqLT5vcHMtPmdldF9wYWdlcyhvYmopOworCUdFTV9CVUdfT04oIWVyciAm
JiAhaTkxNV9nZW1fb2JqZWN0X2hhc19wYWdlcyhvYmopKTsKKworCXJldHVybiBlcnI7Cit9CisK
Ky8qIEVuc3VyZSB0aGF0IHRoZSBhc3NvY2lhdGVkIHBhZ2VzIGFyZSBnYXRoZXJlZCBmcm9tIHRo
ZSBiYWNraW5nIHN0b3JhZ2UKKyAqIGFuZCBwaW5uZWQgaW50byBvdXIgb2JqZWN0LiBpOTE1X2dl
bV9vYmplY3RfcGluX3BhZ2VzKCkgbWF5IGJlIGNhbGxlZAorICogbXVsdGlwbGUgdGltZXMgYmVm
b3JlIHRoZXkgYXJlIHJlbGVhc2VkIGJ5IGEgc2luZ2xlIGNhbGwgdG8KKyAqIGk5MTVfZ2VtX29i
amVjdF91bnBpbl9wYWdlcygpIC0gb25jZSB0aGUgcGFnZXMgYXJlIG5vIGxvbmdlciByZWZlcmVu
Y2VkCisgKiBlaXRoZXIgYXMgYSByZXN1bHQgb2YgbWVtb3J5IHByZXNzdXJlIChyZWFwaW5nIHBh
Z2VzIHVuZGVyIHRoZSBzaHJpbmtlcikKKyAqIG9yIGFzIHRoZSBvYmplY3QgaXMgaXRzZWxmIHJl
bGVhc2VkLgorICovCitpbnQgX19pOTE1X2dlbV9vYmplY3RfZ2V0X3BhZ2VzKHN0cnVjdCBkcm1f
aTkxNV9nZW1fb2JqZWN0ICpvYmopCit7CisJaW50IGVycjsKKworCWVyciA9IG11dGV4X2xvY2tf
aW50ZXJydXB0aWJsZSgmb2JqLT5tbS5sb2NrKTsKKwlpZiAoZXJyKQorCQlyZXR1cm4gZXJyOwor
CisJaWYgKHVubGlrZWx5KCFpOTE1X2dlbV9vYmplY3RfaGFzX3BhZ2VzKG9iaikpKSB7CisJCUdF
TV9CVUdfT04oaTkxNV9nZW1fb2JqZWN0X2hhc19waW5uZWRfcGFnZXMob2JqKSk7CisKKwkJZXJy
ID0gX19fX2k5MTVfZ2VtX29iamVjdF9nZXRfcGFnZXMob2JqKTsKKwkJaWYgKGVycikKKwkJCWdv
dG8gdW5sb2NrOworCisJCXNtcF9tYl9fYmVmb3JlX2F0b21pYygpOworCX0KKwlhdG9taWNfaW5j
KCZvYmotPm1tLnBhZ2VzX3Bpbl9jb3VudCk7CisKK3VubG9jazoKKwltdXRleF91bmxvY2soJm9i
ai0+bW0ubG9jayk7CisJcmV0dXJuIGVycjsKK30KKworLyogSW1tZWRpYXRlbHkgZGlzY2FyZCB0
aGUgYmFja2luZyBzdG9yYWdlICovCit2b2lkIGk5MTVfZ2VtX29iamVjdF90cnVuY2F0ZShzdHJ1
Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2JqKQoreworCWRybV9nZW1fZnJlZV9tbWFwX29mZnNl
dCgmb2JqLT5iYXNlKTsKKwlpZiAob2JqLT5vcHMtPnRydW5jYXRlKQorCQlvYmotPm9wcy0+dHJ1
bmNhdGUob2JqKTsKK30KKworLyogVHJ5IHRvIGRpc2NhcmQgdW53YW50ZWQgcGFnZXMgKi8KK3Zv
aWQgaTkxNV9nZW1fb2JqZWN0X3dyaXRlYmFjayhzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAq
b2JqKQoreworCWxvY2tkZXBfYXNzZXJ0X2hlbGQoJm9iai0+bW0ubG9jayk7CisJR0VNX0JVR19P
TihpOTE1X2dlbV9vYmplY3RfaGFzX3BhZ2VzKG9iaikpOworCisJaWYgKG9iai0+b3BzLT53cml0
ZWJhY2spCisJCW9iai0+b3BzLT53cml0ZWJhY2sob2JqKTsKK30KKworc3RhdGljIHZvaWQgX19p
OTE1X2dlbV9vYmplY3RfcmVzZXRfcGFnZV9pdGVyKHN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0
ICpvYmopCit7CisJc3RydWN0IHJhZGl4X3RyZWVfaXRlciBpdGVyOworCXZvaWQgX19yY3UgKipz
bG90OworCisJcmN1X3JlYWRfbG9jaygpOworCXJhZGl4X3RyZWVfZm9yX2VhY2hfc2xvdChzbG90
LCAmb2JqLT5tbS5nZXRfcGFnZS5yYWRpeCwgJml0ZXIsIDApCisJCXJhZGl4X3RyZWVfZGVsZXRl
KCZvYmotPm1tLmdldF9wYWdlLnJhZGl4LCBpdGVyLmluZGV4KTsKKwlyY3VfcmVhZF91bmxvY2so
KTsKK30KKworc3RydWN0IHNnX3RhYmxlICoKK19faTkxNV9nZW1fb2JqZWN0X3Vuc2V0X3BhZ2Vz
KHN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmopCit7CisJc3RydWN0IGRybV9pOTE1X3By
aXZhdGUgKmk5MTUgPSB0b19pOTE1KG9iai0+YmFzZS5kZXYpOworCXN0cnVjdCBzZ190YWJsZSAq
cGFnZXM7CisKKwlwYWdlcyA9IGZldGNoX2FuZF96ZXJvKCZvYmotPm1tLnBhZ2VzKTsKKwlpZiAo
SVNfRVJSX09SX05VTEwocGFnZXMpKQorCQlyZXR1cm4gcGFnZXM7CisKKwlzcGluX2xvY2soJmk5
MTUtPm1tLm9ial9sb2NrKTsKKwlsaXN0X2RlbCgmb2JqLT5tbS5saW5rKTsKKwlzcGluX3VubG9j
aygmaTkxNS0+bW0ub2JqX2xvY2spOworCisJaWYgKG9iai0+bW0ubWFwcGluZykgeworCQl2b2lk
ICpwdHI7CisKKwkJcHRyID0gcGFnZV9tYXNrX2JpdHMob2JqLT5tbS5tYXBwaW5nKTsKKwkJaWYg
KGlzX3ZtYWxsb2NfYWRkcihwdHIpKQorCQkJdnVubWFwKHB0cik7CisJCWVsc2UKKwkJCWt1bm1h
cChrbWFwX3RvX3BhZ2UocHRyKSk7CisKKwkJb2JqLT5tbS5tYXBwaW5nID0gTlVMTDsKKwl9CisK
KwlfX2k5MTVfZ2VtX29iamVjdF9yZXNldF9wYWdlX2l0ZXIob2JqKTsKKwlvYmotPm1tLnBhZ2Vf
c2l6ZXMucGh5cyA9IG9iai0+bW0ucGFnZV9zaXplcy5zZyA9IDA7CisKKwlyZXR1cm4gcGFnZXM7
Cit9CisKK2ludCBfX2k5MTVfZ2VtX29iamVjdF9wdXRfcGFnZXMoc3RydWN0IGRybV9pOTE1X2dl
bV9vYmplY3QgKm9iaiwKKwkJCQllbnVtIGk5MTVfbW1fc3ViY2xhc3Mgc3ViY2xhc3MpCit7CisJ
c3RydWN0IHNnX3RhYmxlICpwYWdlczsKKwlpbnQgZXJyOworCisJaWYgKGk5MTVfZ2VtX29iamVj
dF9oYXNfcGlubmVkX3BhZ2VzKG9iaikpCisJCXJldHVybiAtRUJVU1k7CisKKwlHRU1fQlVHX09O
KG9iai0+YmluZF9jb3VudCk7CisKKwkvKiBNYXkgYmUgY2FsbGVkIGJ5IHNocmlua2VyIGZyb20g
d2l0aGluIGdldF9wYWdlcygpIChvbiBhbm90aGVyIGJvKSAqLworCW11dGV4X2xvY2tfbmVzdGVk
KCZvYmotPm1tLmxvY2ssIHN1YmNsYXNzKTsKKwlpZiAodW5saWtlbHkoYXRvbWljX3JlYWQoJm9i
ai0+bW0ucGFnZXNfcGluX2NvdW50KSkpIHsKKwkJZXJyID0gLUVCVVNZOworCQlnb3RvIHVubG9j
azsKKwl9CisKKwkvKgorCSAqIC0+cHV0X3BhZ2VzIG1pZ2h0IG5lZWQgdG8gYWxsb2NhdGUgbWVt
b3J5IGZvciB0aGUgYml0MTcgc3dpenpsZQorCSAqIGFycmF5LCBoZW5jZSBwcm90ZWN0IHRoZW0g
ZnJvbSBiZWluZyByZWFwZWQgYnkgcmVtb3ZpbmcgdGhlbSBmcm9tIGd0dAorCSAqIGxpc3RzIGVh
cmx5LgorCSAqLworCXBhZ2VzID0gX19pOTE1X2dlbV9vYmplY3RfdW5zZXRfcGFnZXMob2JqKTsK
KworCS8qCisJICogWFhYIFRlbXBvcmFyeSBoaWppbnggdG8gYXZvaWQgdXBkYXRpbmcgYWxsIGJh
Y2tlbmRzIHRvIGhhbmRsZQorCSAqIE5VTEwgcGFnZXMuIEluIHRoZSBmdXR1cmUsIHdoZW4gd2Ug
aGF2ZSBtb3JlIGFzeW5jaHJvbm91cworCSAqIGdldF9wYWdlcyBiYWNrZW5kcyB3ZSBzaG91bGQg
YmUgYmV0dGVyIGFibGUgdG8gaGFuZGxlIHRoZQorCSAqIGNhbmNlbGxhdGlvbiBvZiB0aGUgYXN5
bmMgdGFzayBpbiBhIG1vcmUgdW5pZm9ybSBtYW5uZXIuCisJICovCisJaWYgKCFwYWdlcyAmJiAh
aTkxNV9nZW1fb2JqZWN0X25lZWRzX2FzeW5jX2NhbmNlbChvYmopKQorCQlwYWdlcyA9IEVSUl9Q
VFIoLUVJTlZBTCk7CisKKwlpZiAoIUlTX0VSUihwYWdlcykpCisJCW9iai0+b3BzLT5wdXRfcGFn
ZXMob2JqLCBwYWdlcyk7CisKKwllcnIgPSAwOwordW5sb2NrOgorCW11dGV4X3VubG9jaygmb2Jq
LT5tbS5sb2NrKTsKKworCXJldHVybiBlcnI7Cit9CisKKy8qIFRoZSAnbWFwcGluZycgcGFydCBv
ZiBpOTE1X2dlbV9vYmplY3RfcGluX21hcCgpIGJlbG93ICovCitzdGF0aWMgdm9pZCAqaTkxNV9n
ZW1fb2JqZWN0X21hcChjb25zdCBzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2JqLAorCQkJ
CSBlbnVtIGk5MTVfbWFwX3R5cGUgdHlwZSkKK3sKKwl1bnNpZ25lZCBsb25nIG5fcGFnZXMgPSBv
YmotPmJhc2Uuc2l6ZSA+PiBQQUdFX1NISUZUOworCXN0cnVjdCBzZ190YWJsZSAqc2d0ID0gb2Jq
LT5tbS5wYWdlczsKKwlzdHJ1Y3Qgc2d0X2l0ZXIgc2d0X2l0ZXI7CisJc3RydWN0IHBhZ2UgKnBh
Z2U7CisJc3RydWN0IHBhZ2UgKnN0YWNrX3BhZ2VzWzMyXTsKKwlzdHJ1Y3QgcGFnZSAqKnBhZ2Vz
ID0gc3RhY2tfcGFnZXM7CisJdW5zaWduZWQgbG9uZyBpID0gMDsKKwlwZ3Byb3RfdCBwZ3Byb3Q7
CisJdm9pZCAqYWRkcjsKKworCS8qIEEgc2luZ2xlIHBhZ2UgY2FuIGFsd2F5cyBiZSBrbWFwcGVk
ICovCisJaWYgKG5fcGFnZXMgPT0gMSAmJiB0eXBlID09IEk5MTVfTUFQX1dCKQorCQlyZXR1cm4g
a21hcChzZ19wYWdlKHNndC0+c2dsKSk7CisKKwlpZiAobl9wYWdlcyA+IEFSUkFZX1NJWkUoc3Rh
Y2tfcGFnZXMpKSB7CisJCS8qIFRvbyBiaWcgZm9yIHN0YWNrIC0tIGFsbG9jYXRlIHRlbXBvcmFy
eSBhcnJheSBpbnN0ZWFkICovCisJCXBhZ2VzID0ga3ZtYWxsb2NfYXJyYXkobl9wYWdlcywgc2l6
ZW9mKCpwYWdlcyksIEdGUF9LRVJORUwpOworCQlpZiAoIXBhZ2VzKQorCQkJcmV0dXJuIE5VTEw7
CisJfQorCisJZm9yX2VhY2hfc2d0X3BhZ2UocGFnZSwgc2d0X2l0ZXIsIHNndCkKKwkJcGFnZXNb
aSsrXSA9IHBhZ2U7CisKKwkvKiBDaGVjayB0aGF0IHdlIGhhdmUgdGhlIGV4cGVjdGVkIG51bWJl
ciBvZiBwYWdlcyAqLworCUdFTV9CVUdfT04oaSAhPSBuX3BhZ2VzKTsKKworCXN3aXRjaCAodHlw
ZSkgeworCWRlZmF1bHQ6CisJCU1JU1NJTkdfQ0FTRSh0eXBlKTsKKwkJLyogZmFsbHRocm91Z2gg
dG8gdXNlIFBBR0VfS0VSTkVMIGFueXdheSAqLworCWNhc2UgSTkxNV9NQVBfV0I6CisJCXBncHJv
dCA9IFBBR0VfS0VSTkVMOworCQlicmVhazsKKwljYXNlIEk5MTVfTUFQX1dDOgorCQlwZ3Byb3Qg
PSBwZ3Byb3Rfd3JpdGVjb21iaW5lKFBBR0VfS0VSTkVMX0lPKTsKKwkJYnJlYWs7CisJfQorCWFk
ZHIgPSB2bWFwKHBhZ2VzLCBuX3BhZ2VzLCAwLCBwZ3Byb3QpOworCisJaWYgKHBhZ2VzICE9IHN0
YWNrX3BhZ2VzKQorCQlrdmZyZWUocGFnZXMpOworCisJcmV0dXJuIGFkZHI7Cit9CisKKy8qIGdl
dCwgcGluLCBhbmQgbWFwIHRoZSBwYWdlcyBvZiB0aGUgb2JqZWN0IGludG8ga2VybmVsIHNwYWNl
ICovCit2b2lkICppOTE1X2dlbV9vYmplY3RfcGluX21hcChzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29i
amVjdCAqb2JqLAorCQkJICAgICAgZW51bSBpOTE1X21hcF90eXBlIHR5cGUpCit7CisJZW51bSBp
OTE1X21hcF90eXBlIGhhc190eXBlOworCWJvb2wgcGlubmVkOworCXZvaWQgKnB0cjsKKwlpbnQg
ZXJyOworCisJaWYgKHVubGlrZWx5KCFpOTE1X2dlbV9vYmplY3RfaGFzX3N0cnVjdF9wYWdlKG9i
aikpKQorCQlyZXR1cm4gRVJSX1BUUigtRU5YSU8pOworCisJZXJyID0gbXV0ZXhfbG9ja19pbnRl
cnJ1cHRpYmxlKCZvYmotPm1tLmxvY2spOworCWlmIChlcnIpCisJCXJldHVybiBFUlJfUFRSKGVy
cik7CisKKwlwaW5uZWQgPSAhKHR5cGUgJiBJOTE1X01BUF9PVkVSUklERSk7CisJdHlwZSAmPSB+
STkxNV9NQVBfT1ZFUlJJREU7CisKKwlpZiAoIWF0b21pY19pbmNfbm90X3plcm8oJm9iai0+bW0u
cGFnZXNfcGluX2NvdW50KSkgeworCQlpZiAodW5saWtlbHkoIWk5MTVfZ2VtX29iamVjdF9oYXNf
cGFnZXMob2JqKSkpIHsKKwkJCUdFTV9CVUdfT04oaTkxNV9nZW1fb2JqZWN0X2hhc19waW5uZWRf
cGFnZXMob2JqKSk7CisKKwkJCWVyciA9IF9fX19pOTE1X2dlbV9vYmplY3RfZ2V0X3BhZ2VzKG9i
aik7CisJCQlpZiAoZXJyKQorCQkJCWdvdG8gZXJyX3VubG9jazsKKworCQkJc21wX21iX19iZWZv
cmVfYXRvbWljKCk7CisJCX0KKwkJYXRvbWljX2luYygmb2JqLT5tbS5wYWdlc19waW5fY291bnQp
OworCQlwaW5uZWQgPSBmYWxzZTsKKwl9CisJR0VNX0JVR19PTighaTkxNV9nZW1fb2JqZWN0X2hh
c19wYWdlcyhvYmopKTsKKworCXB0ciA9IHBhZ2VfdW5wYWNrX2JpdHMob2JqLT5tbS5tYXBwaW5n
LCAmaGFzX3R5cGUpOworCWlmIChwdHIgJiYgaGFzX3R5cGUgIT0gdHlwZSkgeworCQlpZiAocGlu
bmVkKSB7CisJCQllcnIgPSAtRUJVU1k7CisJCQlnb3RvIGVycl91bnBpbjsKKwkJfQorCisJCWlm
IChpc192bWFsbG9jX2FkZHIocHRyKSkKKwkJCXZ1bm1hcChwdHIpOworCQllbHNlCisJCQlrdW5t
YXAoa21hcF90b19wYWdlKHB0cikpOworCisJCXB0ciA9IG9iai0+bW0ubWFwcGluZyA9IE5VTEw7
CisJfQorCisJaWYgKCFwdHIpIHsKKwkJcHRyID0gaTkxNV9nZW1fb2JqZWN0X21hcChvYmosIHR5
cGUpOworCQlpZiAoIXB0cikgeworCQkJZXJyID0gLUVOT01FTTsKKwkJCWdvdG8gZXJyX3VucGlu
OworCQl9CisKKwkJb2JqLT5tbS5tYXBwaW5nID0gcGFnZV9wYWNrX2JpdHMocHRyLCB0eXBlKTsK
Kwl9CisKK291dF91bmxvY2s6CisJbXV0ZXhfdW5sb2NrKCZvYmotPm1tLmxvY2spOworCXJldHVy
biBwdHI7CisKK2Vycl91bnBpbjoKKwlhdG9taWNfZGVjKCZvYmotPm1tLnBhZ2VzX3Bpbl9jb3Vu
dCk7CitlcnJfdW5sb2NrOgorCXB0ciA9IEVSUl9QVFIoZXJyKTsKKwlnb3RvIG91dF91bmxvY2s7
Cit9CisKK3ZvaWQgX19pOTE1X2dlbV9vYmplY3RfZmx1c2hfbWFwKHN0cnVjdCBkcm1faTkxNV9n
ZW1fb2JqZWN0ICpvYmosCisJCQkJIHVuc2lnbmVkIGxvbmcgb2Zmc2V0LAorCQkJCSB1bnNpZ25l
ZCBsb25nIHNpemUpCit7CisJZW51bSBpOTE1X21hcF90eXBlIGhhc190eXBlOworCXZvaWQgKnB0
cjsKKworCUdFTV9CVUdfT04oIWk5MTVfZ2VtX29iamVjdF9oYXNfcGlubmVkX3BhZ2VzKG9iaikp
OworCUdFTV9CVUdfT04ocmFuZ2Vfb3ZlcmZsb3dzX3QodHlwZW9mKG9iai0+YmFzZS5zaXplKSwK
KwkJCQkgICAgIG9mZnNldCwgc2l6ZSwgb2JqLT5iYXNlLnNpemUpKTsKKworCW9iai0+bW0uZGly
dHkgPSB0cnVlOworCisJaWYgKG9iai0+Y2FjaGVfY29oZXJlbnQgJiBJOTE1X0JPX0NBQ0hFX0NP
SEVSRU5UX0ZPUl9XUklURSkKKwkJcmV0dXJuOworCisJcHRyID0gcGFnZV91bnBhY2tfYml0cyhv
YmotPm1tLm1hcHBpbmcsICZoYXNfdHlwZSk7CisJaWYgKGhhc190eXBlID09IEk5MTVfTUFQX1dD
KQorCQlyZXR1cm47CisKKwlkcm1fY2xmbHVzaF92aXJ0X3JhbmdlKHB0ciArIG9mZnNldCwgc2l6
ZSk7CisJaWYgKHNpemUgPT0gb2JqLT5iYXNlLnNpemUpIHsKKwkJb2JqLT53cml0ZV9kb21haW4g
Jj0gfkk5MTVfR0VNX0RPTUFJTl9DUFU7CisJCW9iai0+Y2FjaGVfZGlydHkgPSBmYWxzZTsKKwl9
Cit9CisKK3N0cnVjdCBzY2F0dGVybGlzdCAqCitpOTE1X2dlbV9vYmplY3RfZ2V0X3NnKHN0cnVj
dCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmosCisJCSAgICAgICB1bnNpZ25lZCBpbnQgbiwKKwkJ
ICAgICAgIHVuc2lnbmVkIGludCAqb2Zmc2V0KQoreworCXN0cnVjdCBpOTE1X2dlbV9vYmplY3Rf
cGFnZV9pdGVyICppdGVyID0gJm9iai0+bW0uZ2V0X3BhZ2U7CisJc3RydWN0IHNjYXR0ZXJsaXN0
ICpzZzsKKwl1bnNpZ25lZCBpbnQgaWR4LCBjb3VudDsKKworCW1pZ2h0X3NsZWVwKCk7CisJR0VN
X0JVR19PTihuID49IG9iai0+YmFzZS5zaXplID4+IFBBR0VfU0hJRlQpOworCUdFTV9CVUdfT04o
IWk5MTVfZ2VtX29iamVjdF9oYXNfcGlubmVkX3BhZ2VzKG9iaikpOworCisJLyogQXMgd2UgaXRl
cmF0ZSBmb3J3YXJkIHRocm91Z2ggdGhlIHNnLCB3ZSByZWNvcmQgZWFjaCBlbnRyeSBpbiBhCisJ
ICogcmFkaXh0cmVlIGZvciBxdWljayByZXBlYXRlZCAoYmFja3dhcmRzKSBsb29rdXBzLiBJZiB3
ZSBoYXZlIHNlZW4KKwkgKiB0aGlzIGluZGV4IHByZXZpb3VzbHksIHdlIHdpbGwgaGF2ZSBhbiBl
bnRyeSBmb3IgaXQuCisJICoKKwkgKiBJbml0aWFsIGxvb2t1cCBpcyBPKE4pLCBidXQgdGhpcyBp
cyBhbW9ydGl6ZWQgdG8gTygxKSBmb3IKKwkgKiBzZXF1ZW50aWFsIHBhZ2UgYWNjZXNzICh3aGVy
ZSBlYWNoIG5ldyByZXF1ZXN0IGlzIGNvbnNlY3V0aXZlCisJICogdG8gdGhlIHByZXZpb3VzIG9u
ZSkuIFJlcGVhdGVkIGxvb2t1cHMgYXJlIE8obGcob2JqLT5iYXNlLnNpemUpKSwKKwkgKiBpLmUu
IE8oMSkgd2l0aCBhIGxhcmdlIGNvbnN0YW50IQorCSAqLworCWlmIChuIDwgUkVBRF9PTkNFKGl0
ZXItPnNnX2lkeCkpCisJCWdvdG8gbG9va3VwOworCisJbXV0ZXhfbG9jaygmaXRlci0+bG9jayk7
CisKKwkvKiBXZSBwcmVmZXIgdG8gcmV1c2UgdGhlIGxhc3Qgc2cgc28gdGhhdCByZXBlYXRlZCBs
b29rdXAgb2YgdGhpcworCSAqIChvciB0aGUgc3Vic2VxdWVudCkgc2cgYXJlIGZhc3QgLSBjb21w
YXJpbmcgYWdhaW5zdCB0aGUgbGFzdAorCSAqIHNnIGlzIGZhc3RlciB0aGFuIGdvaW5nIHRocm91
Z2ggdGhlIHJhZGl4dHJlZS4KKwkgKi8KKworCXNnID0gaXRlci0+c2dfcG9zOworCWlkeCA9IGl0
ZXItPnNnX2lkeDsKKwljb3VudCA9IF9fc2dfcGFnZV9jb3VudChzZyk7CisKKwl3aGlsZSAoaWR4
ICsgY291bnQgPD0gbikgeworCQl2b2lkICplbnRyeTsKKwkJdW5zaWduZWQgbG9uZyBpOworCQlp
bnQgcmV0OworCisJCS8qIElmIHdlIGNhbm5vdCBhbGxvY2F0ZSBhbmQgaW5zZXJ0IHRoaXMgZW50
cnksIG9yIHRoZQorCQkgKiBpbmRpdmlkdWFsIHBhZ2VzIGZyb20gdGhpcyByYW5nZSwgY2FuY2Vs
IHVwZGF0aW5nIHRoZQorCQkgKiBzZ19pZHggc28gdGhhdCBvbiB0aGlzIGxvb2t1cCB3ZSBhcmUg
Zm9yY2VkIHRvIGxpbmVhcmx5CisJCSAqIHNjYW4gb253YXJkcywgYnV0IG9uIGZ1dHVyZSBsb29r
dXBzIHdlIHdpbGwgdHJ5IHRoZQorCQkgKiBpbnNlcnRpb24gYWdhaW4gKGluIHdoaWNoIGNhc2Ug
d2UgbmVlZCB0byBiZSBjYXJlZnVsIG9mCisJCSAqIHRoZSBlcnJvciByZXR1cm4gcmVwb3J0aW5n
IHRoYXQgd2UgaGF2ZSBhbHJlYWR5IGluc2VydGVkCisJCSAqIHRoaXMgaW5kZXgpLgorCQkgKi8K
KwkJcmV0ID0gcmFkaXhfdHJlZV9pbnNlcnQoJml0ZXItPnJhZGl4LCBpZHgsIHNnKTsKKwkJaWYg
KHJldCAmJiByZXQgIT0gLUVFWElTVCkKKwkJCWdvdG8gc2NhbjsKKworCQllbnRyeSA9IHhhX21r
X3ZhbHVlKGlkeCk7CisJCWZvciAoaSA9IDE7IGkgPCBjb3VudDsgaSsrKSB7CisJCQlyZXQgPSBy
YWRpeF90cmVlX2luc2VydCgmaXRlci0+cmFkaXgsIGlkeCArIGksIGVudHJ5KTsKKwkJCWlmIChy
ZXQgJiYgcmV0ICE9IC1FRVhJU1QpCisJCQkJZ290byBzY2FuOworCQl9CisKKwkJaWR4ICs9IGNv
dW50OworCQlzZyA9IF9fX19zZ19uZXh0KHNnKTsKKwkJY291bnQgPSBfX3NnX3BhZ2VfY291bnQo
c2cpOworCX0KKworc2NhbjoKKwlpdGVyLT5zZ19wb3MgPSBzZzsKKwlpdGVyLT5zZ19pZHggPSBp
ZHg7CisKKwltdXRleF91bmxvY2soJml0ZXItPmxvY2spOworCisJaWYgKHVubGlrZWx5KG4gPCBp
ZHgpKSAvKiBpbnNlcnRpb24gY29tcGxldGVkIGJ5IGFub3RoZXIgdGhyZWFkICovCisJCWdvdG8g
bG9va3VwOworCisJLyogSW4gY2FzZSB3ZSBmYWlsZWQgdG8gaW5zZXJ0IHRoZSBlbnRyeSBpbnRv
IHRoZSByYWRpeHRyZWUsIHdlIG5lZWQKKwkgKiB0byBsb29rIGJleW9uZCB0aGUgY3VycmVudCBz
Zy4KKwkgKi8KKwl3aGlsZSAoaWR4ICsgY291bnQgPD0gbikgeworCQlpZHggKz0gY291bnQ7CisJ
CXNnID0gX19fX3NnX25leHQoc2cpOworCQljb3VudCA9IF9fc2dfcGFnZV9jb3VudChzZyk7CisJ
fQorCisJKm9mZnNldCA9IG4gLSBpZHg7CisJcmV0dXJuIHNnOworCitsb29rdXA6CisJcmN1X3Jl
YWRfbG9jaygpOworCisJc2cgPSByYWRpeF90cmVlX2xvb2t1cCgmaXRlci0+cmFkaXgsIG4pOwor
CUdFTV9CVUdfT04oIXNnKTsKKworCS8qIElmIHRoaXMgaW5kZXggaXMgaW4gdGhlIG1pZGRsZSBv
ZiBtdWx0aS1wYWdlIHNnIGVudHJ5LAorCSAqIHRoZSByYWRpeCB0cmVlIHdpbGwgY29udGFpbiBh
IHZhbHVlIGVudHJ5IHRoYXQgcG9pbnRzCisJICogdG8gdGhlIHN0YXJ0IG9mIHRoYXQgcmFuZ2Uu
IFdlIHdpbGwgcmV0dXJuIHRoZSBwb2ludGVyIHRvCisJICogdGhlIGJhc2UgcGFnZSBhbmQgdGhl
IG9mZnNldCBvZiB0aGlzIHBhZ2Ugd2l0aGluIHRoZQorCSAqIHNnIGVudHJ5J3MgcmFuZ2UuCisJ
ICovCisJKm9mZnNldCA9IDA7CisJaWYgKHVubGlrZWx5KHhhX2lzX3ZhbHVlKHNnKSkpIHsKKwkJ
dW5zaWduZWQgbG9uZyBiYXNlID0geGFfdG9fdmFsdWUoc2cpOworCisJCXNnID0gcmFkaXhfdHJl
ZV9sb29rdXAoJml0ZXItPnJhZGl4LCBiYXNlKTsKKwkJR0VNX0JVR19PTighc2cpOworCisJCSpv
ZmZzZXQgPSBuIC0gYmFzZTsKKwl9CisKKwlyY3VfcmVhZF91bmxvY2soKTsKKworCXJldHVybiBz
ZzsKK30KKworc3RydWN0IHBhZ2UgKgoraTkxNV9nZW1fb2JqZWN0X2dldF9wYWdlKHN0cnVjdCBk
cm1faTkxNV9nZW1fb2JqZWN0ICpvYmosIHVuc2lnbmVkIGludCBuKQoreworCXN0cnVjdCBzY2F0
dGVybGlzdCAqc2c7CisJdW5zaWduZWQgaW50IG9mZnNldDsKKworCUdFTV9CVUdfT04oIWk5MTVf
Z2VtX29iamVjdF9oYXNfc3RydWN0X3BhZ2Uob2JqKSk7CisKKwlzZyA9IGk5MTVfZ2VtX29iamVj
dF9nZXRfc2cob2JqLCBuLCAmb2Zmc2V0KTsKKwlyZXR1cm4gbnRoX3BhZ2Uoc2dfcGFnZShzZyks
IG9mZnNldCk7Cit9CisKKy8qIExpa2UgaTkxNV9nZW1fb2JqZWN0X2dldF9wYWdlKCksIGJ1dCBt
YXJrIHRoZSByZXR1cm5lZCBwYWdlIGRpcnR5ICovCitzdHJ1Y3QgcGFnZSAqCitpOTE1X2dlbV9v
YmplY3RfZ2V0X2RpcnR5X3BhZ2Uoc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iaiwKKwkJ
CSAgICAgICB1bnNpZ25lZCBpbnQgbikKK3sKKwlzdHJ1Y3QgcGFnZSAqcGFnZTsKKworCXBhZ2Ug
PSBpOTE1X2dlbV9vYmplY3RfZ2V0X3BhZ2Uob2JqLCBuKTsKKwlpZiAoIW9iai0+bW0uZGlydHkp
CisJCXNldF9wYWdlX2RpcnR5KHBhZ2UpOworCisJcmV0dXJuIHBhZ2U7Cit9CisKK2RtYV9hZGRy
X3QKK2k5MTVfZ2VtX29iamVjdF9nZXRfZG1hX2FkZHJlc3Moc3RydWN0IGRybV9pOTE1X2dlbV9v
YmplY3QgKm9iaiwKKwkJCQl1bnNpZ25lZCBsb25nIG4pCit7CisJc3RydWN0IHNjYXR0ZXJsaXN0
ICpzZzsKKwl1bnNpZ25lZCBpbnQgb2Zmc2V0OworCisJc2cgPSBpOTE1X2dlbV9vYmplY3RfZ2V0
X3NnKG9iaiwgbiwgJm9mZnNldCk7CisJcmV0dXJuIHNnX2RtYV9hZGRyZXNzKHNnKSArIChvZmZz
ZXQgPDwgUEFHRV9TSElGVCk7Cit9CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9n
ZW0vaTkxNV9nZW1fcGh5cy5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX3Bo
eXMuYwpuZXcgZmlsZSBtb2RlIDEwMDY0NAppbmRleCAwMDAwMDAwMDAwMDAuLjFiZjNlMGFmY2Jh
MgotLS0gL2Rldi9udWxsCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9w
aHlzLmMKQEAgLTAsMCArMSwyMTIgQEAKKy8qCisgKiBTUERYLUxpY2Vuc2UtSWRlbnRpZmllcjog
TUlUCisgKgorICogQ29weXJpZ2h0IMKpIDIwMTQtMjAxNiBJbnRlbCBDb3Jwb3JhdGlvbgorICov
CisKKyNpbmNsdWRlIDxsaW51eC9oaWdobWVtLmg+CisjaW5jbHVkZSA8bGludXgvc2htZW1fZnMu
aD4KKyNpbmNsdWRlIDxsaW51eC9zd2FwLmg+CisKKyNpbmNsdWRlIDxkcm0vZHJtLmg+IC8qIGZv
ciBkcm1fbGVnYWN5LmghICovCisjaW5jbHVkZSA8ZHJtL2RybV9jYWNoZS5oPgorI2luY2x1ZGUg
PGRybS9kcm1fbGVnYWN5Lmg+IC8qIGZvciBkcm1fcGNpLmghICovCisjaW5jbHVkZSA8ZHJtL2Ry
bV9wY2kuaD4KKworI2luY2x1ZGUgImk5MTVfZ2VtX29iamVjdC5oIgorCisjaW5jbHVkZSAiLi4v
aTkxNV9kcnYuaCIKKworc3RhdGljIGludCBpOTE1X2dlbV9vYmplY3RfZ2V0X3BhZ2VzX3BoeXMo
c3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iaikKK3sKKwlzdHJ1Y3QgYWRkcmVzc19zcGFj
ZSAqbWFwcGluZyA9IG9iai0+YmFzZS5maWxwLT5mX21hcHBpbmc7CisJc3RydWN0IGRybV9kbWFf
aGFuZGxlICpwaHlzOworCXN0cnVjdCBzZ190YWJsZSAqc3Q7CisJc3RydWN0IHNjYXR0ZXJsaXN0
ICpzZzsKKwljaGFyICp2YWRkcjsKKwlpbnQgaTsKKwlpbnQgZXJyOworCisJaWYgKFdBUk5fT04o
aTkxNV9nZW1fb2JqZWN0X25lZWRzX2JpdDE3X3N3aXp6bGUob2JqKSkpCisJCXJldHVybiAtRUlO
VkFMOworCisJLyogQWx3YXlzIGFsaWduaW5nIHRvIHRoZSBvYmplY3Qgc2l6ZSwgYWxsb3dzIGEg
c2luZ2xlIGFsbG9jYXRpb24KKwkgKiB0byBoYW5kbGUgYWxsIHBvc3NpYmxlIGNhbGxlcnMsIGFu
ZCBnaXZlbiB0eXBpY2FsIG9iamVjdCBzaXplcywKKwkgKiB0aGUgYWxpZ25tZW50IG9mIHRoZSBi
dWRkeSBhbGxvY2F0aW9uIHdpbGwgbmF0dXJhbGx5IG1hdGNoLgorCSAqLworCXBoeXMgPSBkcm1f
cGNpX2FsbG9jKG9iai0+YmFzZS5kZXYsCisJCQkgICAgIHJvdW5kdXBfcG93X29mX3R3byhvYmot
PmJhc2Uuc2l6ZSksCisJCQkgICAgIHJvdW5kdXBfcG93X29mX3R3byhvYmotPmJhc2Uuc2l6ZSkp
OworCWlmICghcGh5cykKKwkJcmV0dXJuIC1FTk9NRU07CisKKwl2YWRkciA9IHBoeXMtPnZhZGRy
OworCWZvciAoaSA9IDA7IGkgPCBvYmotPmJhc2Uuc2l6ZSAvIFBBR0VfU0laRTsgaSsrKSB7CisJ
CXN0cnVjdCBwYWdlICpwYWdlOworCQljaGFyICpzcmM7CisKKwkJcGFnZSA9IHNobWVtX3JlYWRf
bWFwcGluZ19wYWdlKG1hcHBpbmcsIGkpOworCQlpZiAoSVNfRVJSKHBhZ2UpKSB7CisJCQllcnIg
PSBQVFJfRVJSKHBhZ2UpOworCQkJZ290byBlcnJfcGh5czsKKwkJfQorCisJCXNyYyA9IGttYXBf
YXRvbWljKHBhZ2UpOworCQltZW1jcHkodmFkZHIsIHNyYywgUEFHRV9TSVpFKTsKKwkJZHJtX2Ns
Zmx1c2hfdmlydF9yYW5nZSh2YWRkciwgUEFHRV9TSVpFKTsKKwkJa3VubWFwX2F0b21pYyhzcmMp
OworCisJCXB1dF9wYWdlKHBhZ2UpOworCQl2YWRkciArPSBQQUdFX1NJWkU7CisJfQorCisJaTkx
NV9nZW1fY2hpcHNldF9mbHVzaCh0b19pOTE1KG9iai0+YmFzZS5kZXYpKTsKKworCXN0ID0ga21h
bGxvYyhzaXplb2YoKnN0KSwgR0ZQX0tFUk5FTCk7CisJaWYgKCFzdCkgeworCQllcnIgPSAtRU5P
TUVNOworCQlnb3RvIGVycl9waHlzOworCX0KKworCWlmIChzZ19hbGxvY190YWJsZShzdCwgMSwg
R0ZQX0tFUk5FTCkpIHsKKwkJa2ZyZWUoc3QpOworCQllcnIgPSAtRU5PTUVNOworCQlnb3RvIGVy
cl9waHlzOworCX0KKworCXNnID0gc3QtPnNnbDsKKwlzZy0+b2Zmc2V0ID0gMDsKKwlzZy0+bGVu
Z3RoID0gb2JqLT5iYXNlLnNpemU7CisKKwlzZ19kbWFfYWRkcmVzcyhzZykgPSBwaHlzLT5idXNh
ZGRyOworCXNnX2RtYV9sZW4oc2cpID0gb2JqLT5iYXNlLnNpemU7CisKKwlvYmotPnBoeXNfaGFu
ZGxlID0gcGh5czsKKworCV9faTkxNV9nZW1fb2JqZWN0X3NldF9wYWdlcyhvYmosIHN0LCBzZy0+
bGVuZ3RoKTsKKworCXJldHVybiAwOworCitlcnJfcGh5czoKKwlkcm1fcGNpX2ZyZWUob2JqLT5i
YXNlLmRldiwgcGh5cyk7CisKKwlyZXR1cm4gZXJyOworfQorCitzdGF0aWMgdm9pZAoraTkxNV9n
ZW1fb2JqZWN0X3B1dF9wYWdlc19waHlzKHN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmos
CisJCQkgICAgICAgc3RydWN0IHNnX3RhYmxlICpwYWdlcykKK3sKKwlfX2k5MTVfZ2VtX29iamVj
dF9yZWxlYXNlX3NobWVtKG9iaiwgcGFnZXMsIGZhbHNlKTsKKworCWlmIChvYmotPm1tLmRpcnR5
KSB7CisJCXN0cnVjdCBhZGRyZXNzX3NwYWNlICptYXBwaW5nID0gb2JqLT5iYXNlLmZpbHAtPmZf
bWFwcGluZzsKKwkJY2hhciAqdmFkZHIgPSBvYmotPnBoeXNfaGFuZGxlLT52YWRkcjsKKwkJaW50
IGk7CisKKwkJZm9yIChpID0gMDsgaSA8IG9iai0+YmFzZS5zaXplIC8gUEFHRV9TSVpFOyBpKysp
IHsKKwkJCXN0cnVjdCBwYWdlICpwYWdlOworCQkJY2hhciAqZHN0OworCisJCQlwYWdlID0gc2ht
ZW1fcmVhZF9tYXBwaW5nX3BhZ2UobWFwcGluZywgaSk7CisJCQlpZiAoSVNfRVJSKHBhZ2UpKQor
CQkJCWNvbnRpbnVlOworCisJCQlkc3QgPSBrbWFwX2F0b21pYyhwYWdlKTsKKwkJCWRybV9jbGZs
dXNoX3ZpcnRfcmFuZ2UodmFkZHIsIFBBR0VfU0laRSk7CisJCQltZW1jcHkoZHN0LCB2YWRkciwg
UEFHRV9TSVpFKTsKKwkJCWt1bm1hcF9hdG9taWMoZHN0KTsKKworCQkJc2V0X3BhZ2VfZGlydHko
cGFnZSk7CisJCQlpZiAob2JqLT5tbS5tYWR2ID09IEk5MTVfTUFEVl9XSUxMTkVFRCkKKwkJCQlt
YXJrX3BhZ2VfYWNjZXNzZWQocGFnZSk7CisJCQlwdXRfcGFnZShwYWdlKTsKKwkJCXZhZGRyICs9
IFBBR0VfU0laRTsKKwkJfQorCQlvYmotPm1tLmRpcnR5ID0gZmFsc2U7CisJfQorCisJc2dfZnJl
ZV90YWJsZShwYWdlcyk7CisJa2ZyZWUocGFnZXMpOworCisJZHJtX3BjaV9mcmVlKG9iai0+YmFz
ZS5kZXYsIG9iai0+cGh5c19oYW5kbGUpOworfQorCitzdGF0aWMgdm9pZAoraTkxNV9nZW1fb2Jq
ZWN0X3JlbGVhc2VfcGh5cyhzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2JqKQoreworCWk5
MTVfZ2VtX29iamVjdF91bnBpbl9wYWdlcyhvYmopOworfQorCitzdGF0aWMgY29uc3Qgc3RydWN0
IGRybV9pOTE1X2dlbV9vYmplY3Rfb3BzIGk5MTVfZ2VtX3BoeXNfb3BzID0geworCS5nZXRfcGFn
ZXMgPSBpOTE1X2dlbV9vYmplY3RfZ2V0X3BhZ2VzX3BoeXMsCisJLnB1dF9wYWdlcyA9IGk5MTVf
Z2VtX29iamVjdF9wdXRfcGFnZXNfcGh5cywKKwkucmVsZWFzZSA9IGk5MTVfZ2VtX29iamVjdF9y
ZWxlYXNlX3BoeXMsCit9OworCitpbnQgaTkxNV9nZW1fb2JqZWN0X2F0dGFjaF9waHlzKHN0cnVj
dCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmosIGludCBhbGlnbikKK3sKKwlzdHJ1Y3Qgc2dfdGFi
bGUgKnBhZ2VzOworCWludCBlcnI7CisKKwlpZiAoYWxpZ24gPiBvYmotPmJhc2Uuc2l6ZSkKKwkJ
cmV0dXJuIC1FSU5WQUw7CisKKwlpZiAob2JqLT5vcHMgPT0gJmk5MTVfZ2VtX3BoeXNfb3BzKQor
CQlyZXR1cm4gMDsKKworCWlmIChvYmotPm9wcyAhPSAmaTkxNV9nZW1fc2htZW1fb3BzKQorCQly
ZXR1cm4gLUVJTlZBTDsKKworCWVyciA9IGk5MTVfZ2VtX29iamVjdF91bmJpbmQob2JqKTsKKwlp
ZiAoZXJyKQorCQlyZXR1cm4gZXJyOworCisJbXV0ZXhfbG9jaygmb2JqLT5tbS5sb2NrKTsKKwor
CWlmIChvYmotPm1tLm1hZHYgIT0gSTkxNV9NQURWX1dJTExORUVEKSB7CisJCWVyciA9IC1FRkFV
TFQ7CisJCWdvdG8gZXJyX3VubG9jazsKKwl9CisKKwlpZiAob2JqLT5tbS5xdWlya2VkKSB7CisJ
CWVyciA9IC1FRkFVTFQ7CisJCWdvdG8gZXJyX3VubG9jazsKKwl9CisKKwlpZiAob2JqLT5tbS5t
YXBwaW5nKSB7CisJCWVyciA9IC1FQlVTWTsKKwkJZ290byBlcnJfdW5sb2NrOworCX0KKworCXBh
Z2VzID0gX19pOTE1X2dlbV9vYmplY3RfdW5zZXRfcGFnZXMob2JqKTsKKworCW9iai0+b3BzID0g
Jmk5MTVfZ2VtX3BoeXNfb3BzOworCisJZXJyID0gX19fX2k5MTVfZ2VtX29iamVjdF9nZXRfcGFn
ZXMob2JqKTsKKwlpZiAoZXJyKQorCQlnb3RvIGVycl94ZmVyOworCisJLyogUGVybWEtcGluICh1
bnRpbCByZWxlYXNlKSB0aGUgcGh5c2ljYWwgc2V0IG9mIHBhZ2VzICovCisJX19pOTE1X2dlbV9v
YmplY3RfcGluX3BhZ2VzKG9iaik7CisKKwlpZiAoIUlTX0VSUl9PUl9OVUxMKHBhZ2VzKSkKKwkJ
aTkxNV9nZW1fc2htZW1fb3BzLnB1dF9wYWdlcyhvYmosIHBhZ2VzKTsKKwltdXRleF91bmxvY2so
Jm9iai0+bW0ubG9jayk7CisJcmV0dXJuIDA7CisKK2Vycl94ZmVyOgorCW9iai0+b3BzID0gJmk5
MTVfZ2VtX3NobWVtX29wczsKKwlpZiAoIUlTX0VSUl9PUl9OVUxMKHBhZ2VzKSkgeworCQl1bnNp
Z25lZCBpbnQgc2dfcGFnZV9zaXplcyA9IGk5MTVfc2dfcGFnZV9zaXplcyhwYWdlcy0+c2dsKTsK
KworCQlfX2k5MTVfZ2VtX29iamVjdF9zZXRfcGFnZXMob2JqLCBwYWdlcywgc2dfcGFnZV9zaXpl
cyk7CisJfQorZXJyX3VubG9jazoKKwltdXRleF91bmxvY2soJm9iai0+bW0ubG9jayk7CisJcmV0
dXJuIGVycjsKK30KKworI2lmIElTX0VOQUJMRUQoQ09ORklHX0RSTV9JOTE1X1NFTEZURVNUKQor
I2luY2x1ZGUgInNlbGZ0ZXN0cy9pOTE1X2dlbV9waHlzLmMiCisjZW5kaWYKZGlmZiAtLWdpdCBh
L2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9zaG1lbS5jIGIvZHJpdmVycy9ncHUv
ZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX3NobWVtLmMKaW5kZXggOWQ4ODViNWU2NjQzLi43OGRmODZk
MWRiN2EgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9zaG1l
bS5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9zaG1lbS5jCkBAIC0y
MTQsNiArMjE0LDY1IEBAIHN0YXRpYyBpbnQgc2htZW1fZ2V0X3BhZ2VzKHN0cnVjdCBkcm1faTkx
NV9nZW1fb2JqZWN0ICpvYmopCiAJcmV0dXJuIHJldDsKIH0KIAorc3RhdGljIHZvaWQKK3NobWVt
X3RydW5jYXRlKHN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmopCit7CisJLyoKKwkgKiBP
dXIgZ29hbCBoZXJlIGlzIHRvIHJldHVybiBhcyBtdWNoIG9mIHRoZSBtZW1vcnkgYXMKKwkgKiBp
cyBwb3NzaWJsZSBiYWNrIHRvIHRoZSBzeXN0ZW0gYXMgd2UgYXJlIGNhbGxlZCBmcm9tIE9PTS4K
KwkgKiBUbyBkbyB0aGlzIHdlIG11c3QgaW5zdHJ1Y3QgdGhlIHNobWZzIHRvIGRyb3AgYWxsIG9m
IGl0cworCSAqIGJhY2tpbmcgcGFnZXMsICpub3cqLgorCSAqLworCXNobWVtX3RydW5jYXRlX3Jh
bmdlKGZpbGVfaW5vZGUob2JqLT5iYXNlLmZpbHApLCAwLCAobG9mZl90KS0xKTsKKwlvYmotPm1t
Lm1hZHYgPSBfX0k5MTVfTUFEVl9QVVJHRUQ7CisJb2JqLT5tbS5wYWdlcyA9IEVSUl9QVFIoLUVG
QVVMVCk7Cit9CisKK3N0YXRpYyB2b2lkCitzaG1lbV93cml0ZWJhY2soc3RydWN0IGRybV9pOTE1
X2dlbV9vYmplY3QgKm9iaikKK3sKKwlzdHJ1Y3QgYWRkcmVzc19zcGFjZSAqbWFwcGluZzsKKwlz
dHJ1Y3Qgd3JpdGViYWNrX2NvbnRyb2wgd2JjID0geworCQkuc3luY19tb2RlID0gV0JfU1lOQ19O
T05FLAorCQkubnJfdG9fd3JpdGUgPSBTV0FQX0NMVVNURVJfTUFYLAorCQkucmFuZ2Vfc3RhcnQg
PSAwLAorCQkucmFuZ2VfZW5kID0gTExPTkdfTUFYLAorCQkuZm9yX3JlY2xhaW0gPSAxLAorCX07
CisJdW5zaWduZWQgbG9uZyBpOworCisJLyoKKwkgKiBMZWF2ZSBtbWFwaW5ncyBpbnRhY3QgKEdU
VCB3aWxsIGhhdmUgYmVlbiByZXZva2VkIG9uIHVuYmluZGluZywKKwkgKiBsZWF2aW5nIG9ubHkg
Q1BVIG1tYXBpbmdzIGFyb3VuZCkgYW5kIGFkZCB0aG9zZSBwYWdlcyB0byB0aGUgTFJVCisJICog
aW5zdGVhZCBvZiBpbnZva2luZyB3cml0ZWJhY2sgc28gdGhleSBhcmUgYWdlZCBhbmQgcGFnZWQg
b3V0CisJICogYXMgbm9ybWFsLgorCSAqLworCW1hcHBpbmcgPSBvYmotPmJhc2UuZmlscC0+Zl9t
YXBwaW5nOworCisJLyogQmVnaW4gd3JpdGViYWNrIG9uIGVhY2ggZGlydHkgcGFnZSAqLworCWZv
ciAoaSA9IDA7IGkgPCBvYmotPmJhc2Uuc2l6ZSA+PiBQQUdFX1NISUZUOyBpKyspIHsKKwkJc3Ry
dWN0IHBhZ2UgKnBhZ2U7CisKKwkJcGFnZSA9IGZpbmRfbG9ja19lbnRyeShtYXBwaW5nLCBpKTsK
KwkJaWYgKCFwYWdlIHx8IHhhX2lzX3ZhbHVlKHBhZ2UpKQorCQkJY29udGludWU7CisKKwkJaWYg
KCFwYWdlX21hcHBlZChwYWdlKSAmJiBjbGVhcl9wYWdlX2RpcnR5X2Zvcl9pbyhwYWdlKSkgewor
CQkJaW50IHJldDsKKworCQkJU2V0UGFnZVJlY2xhaW0ocGFnZSk7CisJCQlyZXQgPSBtYXBwaW5n
LT5hX29wcy0+d3JpdGVwYWdlKHBhZ2UsICZ3YmMpOworCQkJaWYgKCFQYWdlV3JpdGViYWNrKHBh
Z2UpKQorCQkJCUNsZWFyUGFnZVJlY2xhaW0ocGFnZSk7CisJCQlpZiAoIXJldCkKKwkJCQlnb3Rv
IHB1dDsKKwkJfQorCQl1bmxvY2tfcGFnZShwYWdlKTsKK3B1dDoKKwkJcHV0X3BhZ2UocGFnZSk7
CisJfQorfQorCiB2b2lkCiBfX2k5MTVfZ2VtX29iamVjdF9yZWxlYXNlX3NobWVtKHN0cnVjdCBk
cm1faTkxNV9nZW1fb2JqZWN0ICpvYmosCiAJCQkJc3RydWN0IHNnX3RhYmxlICpwYWdlcywKQEAg
LTM2Myw2ICs0MjIsOCBAQCBjb25zdCBzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdF9vcHMgaTkx
NV9nZW1fc2htZW1fb3BzID0gewogCiAJLmdldF9wYWdlcyA9IHNobWVtX2dldF9wYWdlcywKIAku
cHV0X3BhZ2VzID0gc2htZW1fcHV0X3BhZ2VzLAorCS50cnVuY2F0ZSA9IHNobWVtX3RydW5jYXRl
LAorCS53cml0ZWJhY2sgPSBzaG1lbV93cml0ZWJhY2ssCiAKIAkucHdyaXRlID0gc2htZW1fcHdy
aXRlLAogfTsKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9zZWxmdGVzdHMv
aTkxNV9nZW1fcGh5cy5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL3NlbGZ0ZXN0cy9pOTE1
X2dlbV9waHlzLmMKbmV3IGZpbGUgbW9kZSAxMDA2NDQKaW5kZXggMDAwMDAwMDAwMDAwLi5iNzZi
NTAzYjM5OTkKLS0tIC9kZXYvbnVsbAorKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vc2Vs
ZnRlc3RzL2k5MTVfZ2VtX3BoeXMuYwpAQCAtMCwwICsxLDgwIEBACisvKgorICogU1BEWC1MaWNl
bnNlLUlkZW50aWZpZXI6IE1JVAorICoKKyAqIENvcHlyaWdodCDCqSAyMDE2IEludGVsIENvcnBv
cmF0aW9uCisgKi8KKworI2luY2x1ZGUgIi4uLy4uL2k5MTVfc2VsZnRlc3QuaCIKKworI2luY2x1
ZGUgIi4uLy4uL3NlbGZ0ZXN0cy9tb2NrX2dlbV9kZXZpY2UuaCIKKworc3RhdGljIGludCBtb2Nr
X3BoeXNfb2JqZWN0KHZvaWQgKmFyZykKK3sKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkx
NSA9IGFyZzsKKwlzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2JqOworCWludCBlcnI7CisK
KwkvKiBDcmVhdGUgYW4gb2JqZWN0IGFuZCBiaW5kIGl0IHRvIGEgY29udGlndW91cyBzZXQgb2Yg
cGh5c2ljYWwgcGFnZXMsCisJICogaS5lLiBleGVyY2lzZSB0aGUgaTkxNV9nZW1fb2JqZWN0X3Bo
eXMgQVBJLgorCSAqLworCisJb2JqID0gaTkxNV9nZW1fb2JqZWN0X2NyZWF0ZV9zaG1lbShpOTE1
LCBQQUdFX1NJWkUpOworCWlmIChJU19FUlIob2JqKSkgeworCQllcnIgPSBQVFJfRVJSKG9iaik7
CisJCXByX2VycigiaTkxNV9nZW1fb2JqZWN0X2NyZWF0ZSBmYWlsZWQsIGVycj0lZFxuIiwgZXJy
KTsKKwkJZ290byBvdXQ7CisJfQorCisJbXV0ZXhfbG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRl
eCk7CisJZXJyID0gaTkxNV9nZW1fb2JqZWN0X2F0dGFjaF9waHlzKG9iaiwgUEFHRV9TSVpFKTsK
KwltdXRleF91bmxvY2soJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOworCWlmIChlcnIpIHsKKwkJ
cHJfZXJyKCJpOTE1X2dlbV9vYmplY3RfYXR0YWNoX3BoeXMgZmFpbGVkLCBlcnI9JWRcbiIsIGVy
cik7CisJCWdvdG8gb3V0X29iajsKKwl9CisKKwlpZiAob2JqLT5vcHMgIT0gJmk5MTVfZ2VtX3Bo
eXNfb3BzKSB7CisJCXByX2VycigiaTkxNV9nZW1fb2JqZWN0X2F0dGFjaF9waHlzIGRpZCBub3Qg
Y3JlYXRlIGEgcGh5cyBvYmplY3RcbiIpOworCQllcnIgPSAtRUlOVkFMOworCQlnb3RvIG91dF9v
Ymo7CisJfQorCisJaWYgKCFhdG9taWNfcmVhZCgmb2JqLT5tbS5wYWdlc19waW5fY291bnQpKSB7
CisJCXByX2VycigiaTkxNV9nZW1fb2JqZWN0X2F0dGFjaF9waHlzIGRpZCBub3QgcGluIGl0cyBw
aHlzIHBhZ2VzXG4iKTsKKwkJZXJyID0gLUVJTlZBTDsKKwkJZ290byBvdXRfb2JqOworCX0KKwor
CS8qIE1ha2UgdGhlIG9iamVjdCBkaXJ0eSBzbyB0aGF0IHB1dF9wYWdlcyBtdXN0IGRvIGNvcHkg
YmFjayB0aGUgZGF0YSAqLworCW11dGV4X2xvY2soJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwor
CWVyciA9IGk5MTVfZ2VtX29iamVjdF9zZXRfdG9fZ3R0X2RvbWFpbihvYmosIHRydWUpOworCW11
dGV4X3VubG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CisJaWYgKGVycikgeworCQlwcl9l
cnIoImk5MTVfZ2VtX29iamVjdF9zZXRfdG9fZ3R0X2RvbWFpbiBmYWlsZWQgd2l0aCBlcnI9JWRc
biIsCisJCSAgICAgICBlcnIpOworCQlnb3RvIG91dF9vYmo7CisJfQorCitvdXRfb2JqOgorCWk5
MTVfZ2VtX29iamVjdF9wdXQob2JqKTsKK291dDoKKwlyZXR1cm4gZXJyOworfQorCitpbnQgaTkx
NV9nZW1fcGh5c19tb2NrX3NlbGZ0ZXN0cyh2b2lkKQoreworCXN0YXRpYyBjb25zdCBzdHJ1Y3Qg
aTkxNV9zdWJ0ZXN0IHRlc3RzW10gPSB7CisJCVNVQlRFU1QobW9ja19waHlzX29iamVjdCksCisJ
fTsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNTsKKwlpbnQgZXJyOworCisJaTkxNSA9
IG1vY2tfZ2VtX2RldmljZSgpOworCWlmICghaTkxNSkKKwkJcmV0dXJuIC1FTk9NRU07CisKKwll
cnIgPSBpOTE1X3N1YnRlc3RzKHRlc3RzLCBpOTE1KTsKKworCWRybV9kZXZfcHV0KCZpOTE1LT5k
cm0pOworCXJldHVybiBlcnI7Cit9CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9p
OTE1X2Rydi5oIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9kcnYuaAppbmRleCA2ZGU5YjY0
MTc1MWQuLmRhOWY1YTM3NTYxMyAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkx
NV9kcnYuaAorKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2Rydi5oCkBAIC0yODg3LDgg
KzI4ODcsNiBAQCBpOTE1X2dlbV9vYmplY3RfcGluX3RvX2Rpc3BsYXlfcGxhbmUoc3RydWN0IGRy
bV9pOTE1X2dlbV9vYmplY3QgKm9iaiwKIAkJCQkgICAgIGNvbnN0IHN0cnVjdCBpOTE1X2dndHRf
dmlldyAqdmlldywKIAkJCQkgICAgIHVuc2lnbmVkIGludCBmbGFncyk7CiB2b2lkIGk5MTVfZ2Vt
X29iamVjdF91bnBpbl9mcm9tX2Rpc3BsYXlfcGxhbmUoc3RydWN0IGk5MTVfdm1hICp2bWEpOwot
aW50IGk5MTVfZ2VtX29iamVjdF9hdHRhY2hfcGh5cyhzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVj
dCAqb2JqLAotCQkJCWludCBhbGlnbik7CiBpbnQgaTkxNV9nZW1fb3BlbihzdHJ1Y3QgZHJtX2k5
MTVfcHJpdmF0ZSAqaTkxNSwgc3RydWN0IGRybV9maWxlICpmaWxlKTsKIHZvaWQgaTkxNV9nZW1f
cmVsZWFzZShzdHJ1Y3QgZHJtX2RldmljZSAqZGV2LCBzdHJ1Y3QgZHJtX2ZpbGUgKmZpbGUpOwog
CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2dlbS5jIGIvZHJpdmVycy9n
cHUvZHJtL2k5MTUvaTkxNV9nZW0uYwppbmRleCA0YzVmYmEwYzdiZjYuLjA1NDliNzNmMDFmZiAx
MDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9nZW0uYworKysgYi9kcml2ZXJz
L2dwdS9kcm0vaTkxNS9pOTE1X2dlbS5jCkBAIC0yNiw3ICsyNiw2IEBACiAgKi8KIAogI2luY2x1
ZGUgPGRybS9kcm1fdm1hX21hbmFnZXIuaD4KLSNpbmNsdWRlIDxkcm0vZHJtX3BjaS5oPgogI2lu
Y2x1ZGUgPGRybS9pOTE1X2RybS5oPgogI2luY2x1ZGUgPGxpbnV4L2RtYS1mZW5jZS1hcnJheS5o
PgogI2luY2x1ZGUgPGxpbnV4L2t0aHJlYWQuaD4KQEAgLTk4LDEzMyArOTcsNiBAQCBpOTE1X2dl
bV9nZXRfYXBlcnR1cmVfaW9jdGwoc3RydWN0IGRybV9kZXZpY2UgKmRldiwgdm9pZCAqZGF0YSwK
IAlyZXR1cm4gMDsKIH0KIAotc3RhdGljIGludCBpOTE1X2dlbV9vYmplY3RfZ2V0X3BhZ2VzX3Bo
eXMoc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iaikKLXsKLQlzdHJ1Y3QgYWRkcmVzc19z
cGFjZSAqbWFwcGluZyA9IG9iai0+YmFzZS5maWxwLT5mX21hcHBpbmc7Ci0JZHJtX2RtYV9oYW5k
bGVfdCAqcGh5czsKLQlzdHJ1Y3Qgc2dfdGFibGUgKnN0OwotCXN0cnVjdCBzY2F0dGVybGlzdCAq
c2c7Ci0JY2hhciAqdmFkZHI7Ci0JaW50IGk7Ci0JaW50IGVycjsKLQotCWlmIChXQVJOX09OKGk5
MTVfZ2VtX29iamVjdF9uZWVkc19iaXQxN19zd2l6emxlKG9iaikpKQotCQlyZXR1cm4gLUVJTlZB
TDsKLQotCS8qIEFsd2F5cyBhbGlnbmluZyB0byB0aGUgb2JqZWN0IHNpemUsIGFsbG93cyBhIHNp
bmdsZSBhbGxvY2F0aW9uCi0JICogdG8gaGFuZGxlIGFsbCBwb3NzaWJsZSBjYWxsZXJzLCBhbmQg
Z2l2ZW4gdHlwaWNhbCBvYmplY3Qgc2l6ZXMsCi0JICogdGhlIGFsaWdubWVudCBvZiB0aGUgYnVk
ZHkgYWxsb2NhdGlvbiB3aWxsIG5hdHVyYWxseSBtYXRjaC4KLQkgKi8KLQlwaHlzID0gZHJtX3Bj
aV9hbGxvYyhvYmotPmJhc2UuZGV2LAotCQkJICAgICByb3VuZHVwX3Bvd19vZl90d28ob2JqLT5i
YXNlLnNpemUpLAotCQkJICAgICByb3VuZHVwX3Bvd19vZl90d28ob2JqLT5iYXNlLnNpemUpKTsK
LQlpZiAoIXBoeXMpCi0JCXJldHVybiAtRU5PTUVNOwotCi0JdmFkZHIgPSBwaHlzLT52YWRkcjsK
LQlmb3IgKGkgPSAwOyBpIDwgb2JqLT5iYXNlLnNpemUgLyBQQUdFX1NJWkU7IGkrKykgewotCQlz
dHJ1Y3QgcGFnZSAqcGFnZTsKLQkJY2hhciAqc3JjOwotCi0JCXBhZ2UgPSBzaG1lbV9yZWFkX21h
cHBpbmdfcGFnZShtYXBwaW5nLCBpKTsKLQkJaWYgKElTX0VSUihwYWdlKSkgewotCQkJZXJyID0g
UFRSX0VSUihwYWdlKTsKLQkJCWdvdG8gZXJyX3BoeXM7Ci0JCX0KLQotCQlzcmMgPSBrbWFwX2F0
b21pYyhwYWdlKTsKLQkJbWVtY3B5KHZhZGRyLCBzcmMsIFBBR0VfU0laRSk7Ci0JCWRybV9jbGZs
dXNoX3ZpcnRfcmFuZ2UodmFkZHIsIFBBR0VfU0laRSk7Ci0JCWt1bm1hcF9hdG9taWMoc3JjKTsK
LQotCQlwdXRfcGFnZShwYWdlKTsKLQkJdmFkZHIgKz0gUEFHRV9TSVpFOwotCX0KLQotCWk5MTVf
Z2VtX2NoaXBzZXRfZmx1c2godG9faTkxNShvYmotPmJhc2UuZGV2KSk7Ci0KLQlzdCA9IGttYWxs
b2Moc2l6ZW9mKCpzdCksIEdGUF9LRVJORUwpOwotCWlmICghc3QpIHsKLQkJZXJyID0gLUVOT01F
TTsKLQkJZ290byBlcnJfcGh5czsKLQl9Ci0KLQlpZiAoc2dfYWxsb2NfdGFibGUoc3QsIDEsIEdG
UF9LRVJORUwpKSB7Ci0JCWtmcmVlKHN0KTsKLQkJZXJyID0gLUVOT01FTTsKLQkJZ290byBlcnJf
cGh5czsKLQl9Ci0KLQlzZyA9IHN0LT5zZ2w7Ci0Jc2ctPm9mZnNldCA9IDA7Ci0Jc2ctPmxlbmd0
aCA9IG9iai0+YmFzZS5zaXplOwotCi0Jc2dfZG1hX2FkZHJlc3Moc2cpID0gcGh5cy0+YnVzYWRk
cjsKLQlzZ19kbWFfbGVuKHNnKSA9IG9iai0+YmFzZS5zaXplOwotCi0Jb2JqLT5waHlzX2hhbmRs
ZSA9IHBoeXM7Ci0KLQlfX2k5MTVfZ2VtX29iamVjdF9zZXRfcGFnZXMob2JqLCBzdCwgc2ctPmxl
bmd0aCk7Ci0KLQlyZXR1cm4gMDsKLQotZXJyX3BoeXM6Ci0JZHJtX3BjaV9mcmVlKG9iai0+YmFz
ZS5kZXYsIHBoeXMpOwotCi0JcmV0dXJuIGVycjsKLX0KLQotc3RhdGljIHZvaWQKLWk5MTVfZ2Vt
X29iamVjdF9wdXRfcGFnZXNfcGh5cyhzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2JqLAot
CQkJICAgICAgIHN0cnVjdCBzZ190YWJsZSAqcGFnZXMpCi17Ci0JX19pOTE1X2dlbV9vYmplY3Rf
cmVsZWFzZV9zaG1lbShvYmosIHBhZ2VzLCBmYWxzZSk7Ci0KLQlpZiAob2JqLT5tbS5kaXJ0eSkg
ewotCQlzdHJ1Y3QgYWRkcmVzc19zcGFjZSAqbWFwcGluZyA9IG9iai0+YmFzZS5maWxwLT5mX21h
cHBpbmc7Ci0JCWNoYXIgKnZhZGRyID0gb2JqLT5waHlzX2hhbmRsZS0+dmFkZHI7Ci0JCWludCBp
OwotCi0JCWZvciAoaSA9IDA7IGkgPCBvYmotPmJhc2Uuc2l6ZSAvIFBBR0VfU0laRTsgaSsrKSB7
Ci0JCQlzdHJ1Y3QgcGFnZSAqcGFnZTsKLQkJCWNoYXIgKmRzdDsKLQotCQkJcGFnZSA9IHNobWVt
X3JlYWRfbWFwcGluZ19wYWdlKG1hcHBpbmcsIGkpOwotCQkJaWYgKElTX0VSUihwYWdlKSkKLQkJ
CQljb250aW51ZTsKLQotCQkJZHN0ID0ga21hcF9hdG9taWMocGFnZSk7Ci0JCQlkcm1fY2xmbHVz
aF92aXJ0X3JhbmdlKHZhZGRyLCBQQUdFX1NJWkUpOwotCQkJbWVtY3B5KGRzdCwgdmFkZHIsIFBB
R0VfU0laRSk7Ci0JCQlrdW5tYXBfYXRvbWljKGRzdCk7Ci0KLQkJCXNldF9wYWdlX2RpcnR5KHBh
Z2UpOwotCQkJaWYgKG9iai0+bW0ubWFkdiA9PSBJOTE1X01BRFZfV0lMTE5FRUQpCi0JCQkJbWFy
a19wYWdlX2FjY2Vzc2VkKHBhZ2UpOwotCQkJcHV0X3BhZ2UocGFnZSk7Ci0JCQl2YWRkciArPSBQ
QUdFX1NJWkU7Ci0JCX0KLQkJb2JqLT5tbS5kaXJ0eSA9IGZhbHNlOwotCX0KLQotCXNnX2ZyZWVf
dGFibGUocGFnZXMpOwotCWtmcmVlKHBhZ2VzKTsKLQotCWRybV9wY2lfZnJlZShvYmotPmJhc2Uu
ZGV2LCBvYmotPnBoeXNfaGFuZGxlKTsKLX0KLQotc3RhdGljIHZvaWQKLWk5MTVfZ2VtX29iamVj
dF9yZWxlYXNlX3BoeXMoc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iaikKLXsKLQlpOTE1
X2dlbV9vYmplY3RfdW5waW5fcGFnZXMob2JqKTsKLX0KLQotc3RhdGljIGNvbnN0IHN0cnVjdCBk
cm1faTkxNV9nZW1fb2JqZWN0X29wcyBpOTE1X2dlbV9waHlzX29wcyA9IHsKLQkuZ2V0X3BhZ2Vz
ID0gaTkxNV9nZW1fb2JqZWN0X2dldF9wYWdlc19waHlzLAotCS5wdXRfcGFnZXMgPSBpOTE1X2dl
bV9vYmplY3RfcHV0X3BhZ2VzX3BoeXMsCi0JLnJlbGVhc2UgPSBpOTE1X2dlbV9vYmplY3RfcmVs
ZWFzZV9waHlzLAotfTsKLQogaW50IGk5MTVfZ2VtX29iamVjdF91bmJpbmQoc3RydWN0IGRybV9p
OTE1X2dlbV9vYmplY3QgKm9iaikKIHsKIAlzdHJ1Y3QgaTkxNV92bWEgKnZtYTsKQEAgLTE5Mzcs
MTEgKzE4MDksNiBAQCBzdGF0aWMgaW50IGk5MTVfZ2VtX29iamVjdF9jcmVhdGVfbW1hcF9vZmZz
ZXQoc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iaikKIAlyZXR1cm4gZXJyOwogfQogCi1z
dGF0aWMgdm9pZCBpOTE1X2dlbV9vYmplY3RfZnJlZV9tbWFwX29mZnNldChzdHJ1Y3QgZHJtX2k5
MTVfZ2VtX29iamVjdCAqb2JqKQotewotCWRybV9nZW1fZnJlZV9tbWFwX29mZnNldCgmb2JqLT5i
YXNlKTsKLX0KLQogaW50CiBpOTE1X2dlbV9tbWFwX2d0dChzdHJ1Y3QgZHJtX2ZpbGUgKmZpbGUs
CiAJCSAgc3RydWN0IGRybV9kZXZpY2UgKmRldiwKQEAgLTE5ODcsMTExICsxODU0LDYgQEAgaTkx
NV9nZW1fbW1hcF9ndHRfaW9jdGwoc3RydWN0IGRybV9kZXZpY2UgKmRldiwgdm9pZCAqZGF0YSwK
IAlyZXR1cm4gaTkxNV9nZW1fbW1hcF9ndHQoZmlsZSwgZGV2LCBhcmdzLT5oYW5kbGUsICZhcmdz
LT5vZmZzZXQpOwogfQogCi0vKiBJbW1lZGlhdGVseSBkaXNjYXJkIHRoZSBiYWNraW5nIHN0b3Jh
Z2UgKi8KLXZvaWQgX19pOTE1X2dlbV9vYmplY3RfdHJ1bmNhdGUoc3RydWN0IGRybV9pOTE1X2dl
bV9vYmplY3QgKm9iaikKLXsKLQlpOTE1X2dlbV9vYmplY3RfZnJlZV9tbWFwX29mZnNldChvYmop
OwotCi0JaWYgKG9iai0+YmFzZS5maWxwID09IE5VTEwpCi0JCXJldHVybjsKLQotCS8qIE91ciBn
b2FsIGhlcmUgaXMgdG8gcmV0dXJuIGFzIG11Y2ggb2YgdGhlIG1lbW9yeSBhcwotCSAqIGlzIHBv
c3NpYmxlIGJhY2sgdG8gdGhlIHN5c3RlbSBhcyB3ZSBhcmUgY2FsbGVkIGZyb20gT09NLgotCSAq
IFRvIGRvIHRoaXMgd2UgbXVzdCBpbnN0cnVjdCB0aGUgc2htZnMgdG8gZHJvcCBhbGwgb2YgaXRz
Ci0JICogYmFja2luZyBwYWdlcywgKm5vdyouCi0JICovCi0Jc2htZW1fdHJ1bmNhdGVfcmFuZ2Uo
ZmlsZV9pbm9kZShvYmotPmJhc2UuZmlscCksIDAsIChsb2ZmX3QpLTEpOwotCW9iai0+bW0ubWFk
diA9IF9fSTkxNV9NQURWX1BVUkdFRDsKLQlvYmotPm1tLnBhZ2VzID0gRVJSX1BUUigtRUZBVUxU
KTsKLX0KLQotc3RhdGljIHZvaWQgX19pOTE1X2dlbV9vYmplY3RfcmVzZXRfcGFnZV9pdGVyKHN0
cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmopCi17Ci0Jc3RydWN0IHJhZGl4X3RyZWVfaXRl
ciBpdGVyOwotCXZvaWQgX19yY3UgKipzbG90OwotCi0JcmN1X3JlYWRfbG9jaygpOwotCXJhZGl4
X3RyZWVfZm9yX2VhY2hfc2xvdChzbG90LCAmb2JqLT5tbS5nZXRfcGFnZS5yYWRpeCwgJml0ZXIs
IDApCi0JCXJhZGl4X3RyZWVfZGVsZXRlKCZvYmotPm1tLmdldF9wYWdlLnJhZGl4LCBpdGVyLmlu
ZGV4KTsKLQlyY3VfcmVhZF91bmxvY2soKTsKLX0KLQotc3RhdGljIHN0cnVjdCBzZ190YWJsZSAq
Ci1fX2k5MTVfZ2VtX29iamVjdF91bnNldF9wYWdlcyhzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVj
dCAqb2JqKQotewotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0gdG9faTkxNShvYmot
PmJhc2UuZGV2KTsKLQlzdHJ1Y3Qgc2dfdGFibGUgKnBhZ2VzOwotCi0JcGFnZXMgPSBmZXRjaF9h
bmRfemVybygmb2JqLT5tbS5wYWdlcyk7Ci0JaWYgKElTX0VSUl9PUl9OVUxMKHBhZ2VzKSkKLQkJ
cmV0dXJuIHBhZ2VzOwotCi0Jc3Bpbl9sb2NrKCZpOTE1LT5tbS5vYmpfbG9jayk7Ci0JbGlzdF9k
ZWwoJm9iai0+bW0ubGluayk7Ci0Jc3Bpbl91bmxvY2soJmk5MTUtPm1tLm9ial9sb2NrKTsKLQot
CWlmIChvYmotPm1tLm1hcHBpbmcpIHsKLQkJdm9pZCAqcHRyOwotCi0JCXB0ciA9IHBhZ2VfbWFz
a19iaXRzKG9iai0+bW0ubWFwcGluZyk7Ci0JCWlmIChpc192bWFsbG9jX2FkZHIocHRyKSkKLQkJ
CXZ1bm1hcChwdHIpOwotCQllbHNlCi0JCQlrdW5tYXAoa21hcF90b19wYWdlKHB0cikpOwotCi0J
CW9iai0+bW0ubWFwcGluZyA9IE5VTEw7Ci0JfQotCi0JX19pOTE1X2dlbV9vYmplY3RfcmVzZXRf
cGFnZV9pdGVyKG9iaik7Ci0Jb2JqLT5tbS5wYWdlX3NpemVzLnBoeXMgPSBvYmotPm1tLnBhZ2Vf
c2l6ZXMuc2cgPSAwOwotCi0JcmV0dXJuIHBhZ2VzOwotfQotCi1pbnQgX19pOTE1X2dlbV9vYmpl
Y3RfcHV0X3BhZ2VzKHN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmosCi0JCQkJZW51bSBp
OTE1X21tX3N1YmNsYXNzIHN1YmNsYXNzKQotewotCXN0cnVjdCBzZ190YWJsZSAqcGFnZXM7Ci0J
aW50IHJldDsKLQotCWlmIChpOTE1X2dlbV9vYmplY3RfaGFzX3Bpbm5lZF9wYWdlcyhvYmopKQot
CQlyZXR1cm4gLUVCVVNZOwotCi0JR0VNX0JVR19PTihvYmotPmJpbmRfY291bnQpOwotCi0JLyog
TWF5IGJlIGNhbGxlZCBieSBzaHJpbmtlciBmcm9tIHdpdGhpbiBnZXRfcGFnZXMoKSAob24gYW5v
dGhlciBibykgKi8KLQltdXRleF9sb2NrX25lc3RlZCgmb2JqLT5tbS5sb2NrLCBzdWJjbGFzcyk7
Ci0JaWYgKHVubGlrZWx5KGF0b21pY19yZWFkKCZvYmotPm1tLnBhZ2VzX3Bpbl9jb3VudCkpKSB7
Ci0JCXJldCA9IC1FQlVTWTsKLQkJZ290byB1bmxvY2s7Ci0JfQotCi0JLyoKLQkgKiAtPnB1dF9w
YWdlcyBtaWdodCBuZWVkIHRvIGFsbG9jYXRlIG1lbW9yeSBmb3IgdGhlIGJpdDE3IHN3aXp6bGUK
LQkgKiBhcnJheSwgaGVuY2UgcHJvdGVjdCB0aGVtIGZyb20gYmVpbmcgcmVhcGVkIGJ5IHJlbW92
aW5nIHRoZW0gZnJvbSBndHQKLQkgKiBsaXN0cyBlYXJseS4KLQkgKi8KLQlwYWdlcyA9IF9faTkx
NV9nZW1fb2JqZWN0X3Vuc2V0X3BhZ2VzKG9iaik7Ci0KLQkvKgotCSAqIFhYWCBUZW1wb3Jhcnkg
aGlqaW54IHRvIGF2b2lkIHVwZGF0aW5nIGFsbCBiYWNrZW5kcyB0byBoYW5kbGUKLQkgKiBOVUxM
IHBhZ2VzLiBJbiB0aGUgZnV0dXJlLCB3aGVuIHdlIGhhdmUgbW9yZSBhc3luY2hyb25vdXMKLQkg
KiBnZXRfcGFnZXMgYmFja2VuZHMgd2Ugc2hvdWxkIGJlIGJldHRlciBhYmxlIHRvIGhhbmRsZSB0
aGUKLQkgKiBjYW5jZWxsYXRpb24gb2YgdGhlIGFzeW5jIHRhc2sgaW4gYSBtb3JlIHVuaWZvcm0g
bWFubmVyLgotCSAqLwotCWlmICghcGFnZXMgJiYgIWk5MTVfZ2VtX29iamVjdF9uZWVkc19hc3lu
Y19jYW5jZWwob2JqKSkKLQkJcGFnZXMgPSBFUlJfUFRSKC1FSU5WQUwpOwotCi0JaWYgKCFJU19F
UlIocGFnZXMpKQotCQlvYmotPm9wcy0+cHV0X3BhZ2VzKG9iaiwgcGFnZXMpOwotCi0JcmV0ID0g
MDsKLXVubG9jazoKLQltdXRleF91bmxvY2soJm9iai0+bW0ubG9jayk7Ci0KLQlyZXR1cm4gcmV0
OwotfQotCiBib29sIGk5MTVfc2dfdHJpbShzdHJ1Y3Qgc2dfdGFibGUgKm9yaWdfc3QpCiB7CiAJ
c3RydWN0IHNnX3RhYmxlIG5ld19zdDsKQEAgLTIxMjAsMjUyICsxODgyLDYgQEAgYm9vbCBpOTE1
X3NnX3RyaW0oc3RydWN0IHNnX3RhYmxlICpvcmlnX3N0KQogCXJldHVybiB0cnVlOwogfQogCi12
b2lkIF9faTkxNV9nZW1fb2JqZWN0X3NldF9wYWdlcyhzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVj
dCAqb2JqLAotCQkJCSBzdHJ1Y3Qgc2dfdGFibGUgKnBhZ2VzLAotCQkJCSB1bnNpZ25lZCBpbnQg
c2dfcGFnZV9zaXplcykKLXsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IHRvX2k5
MTUob2JqLT5iYXNlLmRldik7Ci0JdW5zaWduZWQgbG9uZyBzdXBwb3J0ZWQgPSBJTlRFTF9JTkZP
KGk5MTUpLT5wYWdlX3NpemVzOwotCWludCBpOwotCi0JbG9ja2RlcF9hc3NlcnRfaGVsZCgmb2Jq
LT5tbS5sb2NrKTsKLQotCS8qIE1ha2UgdGhlIHBhZ2VzIGNvaGVyZW50IHdpdGggdGhlIEdQVSAo
Zmx1c2hpbmcgYW55IHN3YXBpbikuICovCi0JaWYgKG9iai0+Y2FjaGVfZGlydHkpIHsKLQkJb2Jq
LT53cml0ZV9kb21haW4gPSAwOwotCQlpZiAoaTkxNV9nZW1fb2JqZWN0X2hhc19zdHJ1Y3RfcGFn
ZShvYmopKQotCQkJZHJtX2NsZmx1c2hfc2cocGFnZXMpOwotCQlvYmotPmNhY2hlX2RpcnR5ID0g
ZmFsc2U7Ci0JfQotCi0Jb2JqLT5tbS5nZXRfcGFnZS5zZ19wb3MgPSBwYWdlcy0+c2dsOwotCW9i
ai0+bW0uZ2V0X3BhZ2Uuc2dfaWR4ID0gMDsKLQotCW9iai0+bW0ucGFnZXMgPSBwYWdlczsKLQot
CWlmIChpOTE1X2dlbV9vYmplY3RfaXNfdGlsZWQob2JqKSAmJgotCSAgICBpOTE1LT5xdWlya3Mg
JiBRVUlSS19QSU5fU1dJWlpMRURfUEFHRVMpIHsKLQkJR0VNX0JVR19PTihvYmotPm1tLnF1aXJr
ZWQpOwotCQlfX2k5MTVfZ2VtX29iamVjdF9waW5fcGFnZXMob2JqKTsKLQkJb2JqLT5tbS5xdWly
a2VkID0gdHJ1ZTsKLQl9Ci0KLQlHRU1fQlVHX09OKCFzZ19wYWdlX3NpemVzKTsKLQlvYmotPm1t
LnBhZ2Vfc2l6ZXMucGh5cyA9IHNnX3BhZ2Vfc2l6ZXM7Ci0KLQkvKgotCSAqIENhbGN1bGF0ZSB0
aGUgc3VwcG9ydGVkIHBhZ2Utc2l6ZXMgd2hpY2ggZml0IGludG8gdGhlIGdpdmVuCi0JICogc2df
cGFnZV9zaXplcy4gVGhpcyB3aWxsIGdpdmUgdXMgdGhlIHBhZ2Utc2l6ZXMgd2hpY2ggd2UgbWF5
IGJlIGFibGUKLQkgKiB0byB1c2Ugb3Bwb3J0dW5pc3RpY2FsbHkgd2hlbiBsYXRlciBpbnNlcnRp
bmcgaW50byB0aGUgR1RULiBGb3IKLQkgKiBleGFtcGxlIGlmIHBoeXM9MkcsIHRoZW4gaW4gdGhl
b3J5IHdlIHNob3VsZCBiZSBhYmxlIHRvIHVzZSAxRywgMk0sCi0JICogNjRLIG9yIDRLIHBhZ2Vz
LCBhbHRob3VnaCBpbiBwcmFjdGljZSB0aGlzIHdpbGwgZGVwZW5kIG9uIGEgbnVtYmVyIG9mCi0J
ICogb3RoZXIgZmFjdG9ycy4KLQkgKi8KLQlvYmotPm1tLnBhZ2Vfc2l6ZXMuc2cgPSAwOwotCWZv
cl9lYWNoX3NldF9iaXQoaSwgJnN1cHBvcnRlZCwgaWxvZzIoSTkxNV9HVFRfTUFYX1BBR0VfU0la
RSkgKyAxKSB7Ci0JCWlmIChvYmotPm1tLnBhZ2Vfc2l6ZXMucGh5cyAmIH4wdSA8PCBpKQotCQkJ
b2JqLT5tbS5wYWdlX3NpemVzLnNnIHw9IEJJVChpKTsKLQl9Ci0JR0VNX0JVR19PTighSEFTX1BB
R0VfU0laRVMoaTkxNSwgb2JqLT5tbS5wYWdlX3NpemVzLnNnKSk7Ci0KLQlzcGluX2xvY2soJmk5
MTUtPm1tLm9ial9sb2NrKTsKLQlsaXN0X2FkZCgmb2JqLT5tbS5saW5rLCAmaTkxNS0+bW0udW5i
b3VuZF9saXN0KTsKLQlzcGluX3VubG9jaygmaTkxNS0+bW0ub2JqX2xvY2spOwotfQotCi1zdGF0
aWMgaW50IF9fX19pOTE1X2dlbV9vYmplY3RfZ2V0X3BhZ2VzKHN0cnVjdCBkcm1faTkxNV9nZW1f
b2JqZWN0ICpvYmopCi17Ci0JaW50IGVycjsKLQotCWlmICh1bmxpa2VseShvYmotPm1tLm1hZHYg
IT0gSTkxNV9NQURWX1dJTExORUVEKSkgewotCQlEUk1fREVCVUcoIkF0dGVtcHRpbmcgdG8gb2J0
YWluIGEgcHVyZ2VhYmxlIG9iamVjdFxuIik7Ci0JCXJldHVybiAtRUZBVUxUOwotCX0KLQotCWVy
ciA9IG9iai0+b3BzLT5nZXRfcGFnZXMob2JqKTsKLQlHRU1fQlVHX09OKCFlcnIgJiYgIWk5MTVf
Z2VtX29iamVjdF9oYXNfcGFnZXMob2JqKSk7Ci0KLQlyZXR1cm4gZXJyOwotfQotCi0vKiBFbnN1
cmUgdGhhdCB0aGUgYXNzb2NpYXRlZCBwYWdlcyBhcmUgZ2F0aGVyZWQgZnJvbSB0aGUgYmFja2lu
ZyBzdG9yYWdlCi0gKiBhbmQgcGlubmVkIGludG8gb3VyIG9iamVjdC4gaTkxNV9nZW1fb2JqZWN0
X3Bpbl9wYWdlcygpIG1heSBiZSBjYWxsZWQKLSAqIG11bHRpcGxlIHRpbWVzIGJlZm9yZSB0aGV5
IGFyZSByZWxlYXNlZCBieSBhIHNpbmdsZSBjYWxsIHRvCi0gKiBpOTE1X2dlbV9vYmplY3RfdW5w
aW5fcGFnZXMoKSAtIG9uY2UgdGhlIHBhZ2VzIGFyZSBubyBsb25nZXIgcmVmZXJlbmNlZAotICog
ZWl0aGVyIGFzIGEgcmVzdWx0IG9mIG1lbW9yeSBwcmVzc3VyZSAocmVhcGluZyBwYWdlcyB1bmRl
ciB0aGUgc2hyaW5rZXIpCi0gKiBvciBhcyB0aGUgb2JqZWN0IGlzIGl0c2VsZiByZWxlYXNlZC4K
LSAqLwotaW50IF9faTkxNV9nZW1fb2JqZWN0X2dldF9wYWdlcyhzdHJ1Y3QgZHJtX2k5MTVfZ2Vt
X29iamVjdCAqb2JqKQotewotCWludCBlcnI7Ci0KLQllcnIgPSBtdXRleF9sb2NrX2ludGVycnVw
dGlibGUoJm9iai0+bW0ubG9jayk7Ci0JaWYgKGVycikKLQkJcmV0dXJuIGVycjsKLQotCWlmICh1
bmxpa2VseSghaTkxNV9nZW1fb2JqZWN0X2hhc19wYWdlcyhvYmopKSkgewotCQlHRU1fQlVHX09O
KGk5MTVfZ2VtX29iamVjdF9oYXNfcGlubmVkX3BhZ2VzKG9iaikpOwotCi0JCWVyciA9IF9fX19p
OTE1X2dlbV9vYmplY3RfZ2V0X3BhZ2VzKG9iaik7Ci0JCWlmIChlcnIpCi0JCQlnb3RvIHVubG9j
azsKLQotCQlzbXBfbWJfX2JlZm9yZV9hdG9taWMoKTsKLQl9Ci0JYXRvbWljX2luYygmb2JqLT5t
bS5wYWdlc19waW5fY291bnQpOwotCi11bmxvY2s6Ci0JbXV0ZXhfdW5sb2NrKCZvYmotPm1tLmxv
Y2spOwotCXJldHVybiBlcnI7Ci19Ci0KLS8qIFRoZSAnbWFwcGluZycgcGFydCBvZiBpOTE1X2dl
bV9vYmplY3RfcGluX21hcCgpIGJlbG93ICovCi1zdGF0aWMgdm9pZCAqaTkxNV9nZW1fb2JqZWN0
X21hcChjb25zdCBzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2JqLAotCQkJCSBlbnVtIGk5
MTVfbWFwX3R5cGUgdHlwZSkKLXsKLQl1bnNpZ25lZCBsb25nIG5fcGFnZXMgPSBvYmotPmJhc2Uu
c2l6ZSA+PiBQQUdFX1NISUZUOwotCXN0cnVjdCBzZ190YWJsZSAqc2d0ID0gb2JqLT5tbS5wYWdl
czsKLQlzdHJ1Y3Qgc2d0X2l0ZXIgc2d0X2l0ZXI7Ci0Jc3RydWN0IHBhZ2UgKnBhZ2U7Ci0Jc3Ry
dWN0IHBhZ2UgKnN0YWNrX3BhZ2VzWzMyXTsKLQlzdHJ1Y3QgcGFnZSAqKnBhZ2VzID0gc3RhY2tf
cGFnZXM7Ci0JdW5zaWduZWQgbG9uZyBpID0gMDsKLQlwZ3Byb3RfdCBwZ3Byb3Q7Ci0Jdm9pZCAq
YWRkcjsKLQotCS8qIEEgc2luZ2xlIHBhZ2UgY2FuIGFsd2F5cyBiZSBrbWFwcGVkICovCi0JaWYg
KG5fcGFnZXMgPT0gMSAmJiB0eXBlID09IEk5MTVfTUFQX1dCKQotCQlyZXR1cm4ga21hcChzZ19w
YWdlKHNndC0+c2dsKSk7Ci0KLQlpZiAobl9wYWdlcyA+IEFSUkFZX1NJWkUoc3RhY2tfcGFnZXMp
KSB7Ci0JCS8qIFRvbyBiaWcgZm9yIHN0YWNrIC0tIGFsbG9jYXRlIHRlbXBvcmFyeSBhcnJheSBp
bnN0ZWFkICovCi0JCXBhZ2VzID0ga3ZtYWxsb2NfYXJyYXkobl9wYWdlcywgc2l6ZW9mKCpwYWdl
cyksIEdGUF9LRVJORUwpOwotCQlpZiAoIXBhZ2VzKQotCQkJcmV0dXJuIE5VTEw7Ci0JfQotCi0J
Zm9yX2VhY2hfc2d0X3BhZ2UocGFnZSwgc2d0X2l0ZXIsIHNndCkKLQkJcGFnZXNbaSsrXSA9IHBh
Z2U7Ci0KLQkvKiBDaGVjayB0aGF0IHdlIGhhdmUgdGhlIGV4cGVjdGVkIG51bWJlciBvZiBwYWdl
cyAqLwotCUdFTV9CVUdfT04oaSAhPSBuX3BhZ2VzKTsKLQotCXN3aXRjaCAodHlwZSkgewotCWRl
ZmF1bHQ6Ci0JCU1JU1NJTkdfQ0FTRSh0eXBlKTsKLQkJLyogZmFsbHRocm91Z2ggdG8gdXNlIFBB
R0VfS0VSTkVMIGFueXdheSAqLwotCWNhc2UgSTkxNV9NQVBfV0I6Ci0JCXBncHJvdCA9IFBBR0Vf
S0VSTkVMOwotCQlicmVhazsKLQljYXNlIEk5MTVfTUFQX1dDOgotCQlwZ3Byb3QgPSBwZ3Byb3Rf
d3JpdGVjb21iaW5lKFBBR0VfS0VSTkVMX0lPKTsKLQkJYnJlYWs7Ci0JfQotCWFkZHIgPSB2bWFw
KHBhZ2VzLCBuX3BhZ2VzLCAwLCBwZ3Byb3QpOwotCi0JaWYgKHBhZ2VzICE9IHN0YWNrX3BhZ2Vz
KQotCQlrdmZyZWUocGFnZXMpOwotCi0JcmV0dXJuIGFkZHI7Ci19Ci0KLS8qIGdldCwgcGluLCBh
bmQgbWFwIHRoZSBwYWdlcyBvZiB0aGUgb2JqZWN0IGludG8ga2VybmVsIHNwYWNlICovCi12b2lk
ICppOTE1X2dlbV9vYmplY3RfcGluX21hcChzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2Jq
LAotCQkJICAgICAgZW51bSBpOTE1X21hcF90eXBlIHR5cGUpCi17Ci0JZW51bSBpOTE1X21hcF90
eXBlIGhhc190eXBlOwotCWJvb2wgcGlubmVkOwotCXZvaWQgKnB0cjsKLQlpbnQgcmV0OwotCi0J
aWYgKHVubGlrZWx5KCFpOTE1X2dlbV9vYmplY3RfaGFzX3N0cnVjdF9wYWdlKG9iaikpKQotCQly
ZXR1cm4gRVJSX1BUUigtRU5YSU8pOwotCi0JcmV0ID0gbXV0ZXhfbG9ja19pbnRlcnJ1cHRpYmxl
KCZvYmotPm1tLmxvY2spOwotCWlmIChyZXQpCi0JCXJldHVybiBFUlJfUFRSKHJldCk7Ci0KLQlw
aW5uZWQgPSAhKHR5cGUgJiBJOTE1X01BUF9PVkVSUklERSk7Ci0JdHlwZSAmPSB+STkxNV9NQVBf
T1ZFUlJJREU7Ci0KLQlpZiAoIWF0b21pY19pbmNfbm90X3plcm8oJm9iai0+bW0ucGFnZXNfcGlu
X2NvdW50KSkgewotCQlpZiAodW5saWtlbHkoIWk5MTVfZ2VtX29iamVjdF9oYXNfcGFnZXMob2Jq
KSkpIHsKLQkJCUdFTV9CVUdfT04oaTkxNV9nZW1fb2JqZWN0X2hhc19waW5uZWRfcGFnZXMob2Jq
KSk7Ci0KLQkJCXJldCA9IF9fX19pOTE1X2dlbV9vYmplY3RfZ2V0X3BhZ2VzKG9iaik7Ci0JCQlp
ZiAocmV0KQotCQkJCWdvdG8gZXJyX3VubG9jazsKLQotCQkJc21wX21iX19iZWZvcmVfYXRvbWlj
KCk7Ci0JCX0KLQkJYXRvbWljX2luYygmb2JqLT5tbS5wYWdlc19waW5fY291bnQpOwotCQlwaW5u
ZWQgPSBmYWxzZTsKLQl9Ci0JR0VNX0JVR19PTighaTkxNV9nZW1fb2JqZWN0X2hhc19wYWdlcyhv
YmopKTsKLQotCXB0ciA9IHBhZ2VfdW5wYWNrX2JpdHMob2JqLT5tbS5tYXBwaW5nLCAmaGFzX3R5
cGUpOwotCWlmIChwdHIgJiYgaGFzX3R5cGUgIT0gdHlwZSkgewotCQlpZiAocGlubmVkKSB7Ci0J
CQlyZXQgPSAtRUJVU1k7Ci0JCQlnb3RvIGVycl91bnBpbjsKLQkJfQotCi0JCWlmIChpc192bWFs
bG9jX2FkZHIocHRyKSkKLQkJCXZ1bm1hcChwdHIpOwotCQllbHNlCi0JCQlrdW5tYXAoa21hcF90
b19wYWdlKHB0cikpOwotCi0JCXB0ciA9IG9iai0+bW0ubWFwcGluZyA9IE5VTEw7Ci0JfQotCi0J
aWYgKCFwdHIpIHsKLQkJcHRyID0gaTkxNV9nZW1fb2JqZWN0X21hcChvYmosIHR5cGUpOwotCQlp
ZiAoIXB0cikgewotCQkJcmV0ID0gLUVOT01FTTsKLQkJCWdvdG8gZXJyX3VucGluOwotCQl9Ci0K
LQkJb2JqLT5tbS5tYXBwaW5nID0gcGFnZV9wYWNrX2JpdHMocHRyLCB0eXBlKTsKLQl9Ci0KLW91
dF91bmxvY2s6Ci0JbXV0ZXhfdW5sb2NrKCZvYmotPm1tLmxvY2spOwotCXJldHVybiBwdHI7Ci0K
LWVycl91bnBpbjoKLQlhdG9taWNfZGVjKCZvYmotPm1tLnBhZ2VzX3Bpbl9jb3VudCk7Ci1lcnJf
dW5sb2NrOgotCXB0ciA9IEVSUl9QVFIocmV0KTsKLQlnb3RvIG91dF91bmxvY2s7Ci19Ci0KLXZv
aWQgX19pOTE1X2dlbV9vYmplY3RfZmx1c2hfbWFwKHN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0
ICpvYmosCi0JCQkJIHVuc2lnbmVkIGxvbmcgb2Zmc2V0LAotCQkJCSB1bnNpZ25lZCBsb25nIHNp
emUpCi17Ci0JZW51bSBpOTE1X21hcF90eXBlIGhhc190eXBlOwotCXZvaWQgKnB0cjsKLQotCUdF
TV9CVUdfT04oIWk5MTVfZ2VtX29iamVjdF9oYXNfcGlubmVkX3BhZ2VzKG9iaikpOwotCUdFTV9C
VUdfT04ocmFuZ2Vfb3ZlcmZsb3dzX3QodHlwZW9mKG9iai0+YmFzZS5zaXplKSwKLQkJCQkgICAg
IG9mZnNldCwgc2l6ZSwgb2JqLT5iYXNlLnNpemUpKTsKLQotCW9iai0+bW0uZGlydHkgPSB0cnVl
OwotCi0JaWYgKG9iai0+Y2FjaGVfY29oZXJlbnQgJiBJOTE1X0JPX0NBQ0hFX0NPSEVSRU5UX0ZP
Ul9XUklURSkKLQkJcmV0dXJuOwotCi0JcHRyID0gcGFnZV91bnBhY2tfYml0cyhvYmotPm1tLm1h
cHBpbmcsICZoYXNfdHlwZSk7Ci0JaWYgKGhhc190eXBlID09IEk5MTVfTUFQX1dDKQotCQlyZXR1
cm47Ci0KLQlkcm1fY2xmbHVzaF92aXJ0X3JhbmdlKHB0ciArIG9mZnNldCwgc2l6ZSk7Ci0JaWYg
KHNpemUgPT0gb2JqLT5iYXNlLnNpemUpIHsKLQkJb2JqLT53cml0ZV9kb21haW4gJj0gfkk5MTVf
R0VNX0RPTUFJTl9DUFU7Ci0JCW9iai0+Y2FjaGVfZGlydHkgPSBmYWxzZTsKLQl9Ci19Ci0KIHN0
YXRpYyB1bnNpZ25lZCBsb25nIHRvX3dhaXRfdGltZW91dChzNjQgdGltZW91dF9ucykKIHsKIAlp
ZiAodGltZW91dF9ucyA8IDApCkBAIC0zMzU0LDcgKzI4NzAsNyBAQCBpOTE1X2dlbV9tYWR2aXNl
X2lvY3RsKHN0cnVjdCBkcm1fZGV2aWNlICpkZXYsIHZvaWQgKmRhdGEsCiAJLyogaWYgdGhlIG9i
amVjdCBpcyBubyBsb25nZXIgYXR0YWNoZWQsIGRpc2NhcmQgaXRzIGJhY2tpbmcgc3RvcmFnZSAq
LwogCWlmIChvYmotPm1tLm1hZHYgPT0gSTkxNV9NQURWX0RPTlRORUVEICYmCiAJICAgICFpOTE1
X2dlbV9vYmplY3RfaGFzX3BhZ2VzKG9iaikpCi0JCV9faTkxNV9nZW1fb2JqZWN0X3RydW5jYXRl
KG9iaik7CisJCWk5MTVfZ2VtX29iamVjdF90cnVuY2F0ZShvYmopOwogCiAJYXJncy0+cmV0YWlu
ZWQgPSBvYmotPm1tLm1hZHYgIT0gX19JOTE1X01BRFZfUFVSR0VEOwogCW11dGV4X3VubG9jaygm
b2JqLT5tbS5sb2NrKTsKQEAgLTQxMjYsMjE5ICszNjQyLDYgQEAgdm9pZCBpOTE1X2dlbV90cmFj
a19mYihzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2xkLAogCX0KIH0KIAotc3RydWN0IHNj
YXR0ZXJsaXN0ICoKLWk5MTVfZ2VtX29iamVjdF9nZXRfc2coc3RydWN0IGRybV9pOTE1X2dlbV9v
YmplY3QgKm9iaiwKLQkJICAgICAgIHVuc2lnbmVkIGludCBuLAotCQkgICAgICAgdW5zaWduZWQg
aW50ICpvZmZzZXQpCi17Ci0Jc3RydWN0IGk5MTVfZ2VtX29iamVjdF9wYWdlX2l0ZXIgKml0ZXIg
PSAmb2JqLT5tbS5nZXRfcGFnZTsKLQlzdHJ1Y3Qgc2NhdHRlcmxpc3QgKnNnOwotCXVuc2lnbmVk
IGludCBpZHgsIGNvdW50OwotCi0JbWlnaHRfc2xlZXAoKTsKLQlHRU1fQlVHX09OKG4gPj0gb2Jq
LT5iYXNlLnNpemUgPj4gUEFHRV9TSElGVCk7Ci0JR0VNX0JVR19PTighaTkxNV9nZW1fb2JqZWN0
X2hhc19waW5uZWRfcGFnZXMob2JqKSk7Ci0KLQkvKiBBcyB3ZSBpdGVyYXRlIGZvcndhcmQgdGhy
b3VnaCB0aGUgc2csIHdlIHJlY29yZCBlYWNoIGVudHJ5IGluIGEKLQkgKiByYWRpeHRyZWUgZm9y
IHF1aWNrIHJlcGVhdGVkIChiYWNrd2FyZHMpIGxvb2t1cHMuIElmIHdlIGhhdmUgc2VlbgotCSAq
IHRoaXMgaW5kZXggcHJldmlvdXNseSwgd2Ugd2lsbCBoYXZlIGFuIGVudHJ5IGZvciBpdC4KLQkg
KgotCSAqIEluaXRpYWwgbG9va3VwIGlzIE8oTiksIGJ1dCB0aGlzIGlzIGFtb3J0aXplZCB0byBP
KDEpIGZvcgotCSAqIHNlcXVlbnRpYWwgcGFnZSBhY2Nlc3MgKHdoZXJlIGVhY2ggbmV3IHJlcXVl
c3QgaXMgY29uc2VjdXRpdmUKLQkgKiB0byB0aGUgcHJldmlvdXMgb25lKS4gUmVwZWF0ZWQgbG9v
a3VwcyBhcmUgTyhsZyhvYmotPmJhc2Uuc2l6ZSkpLAotCSAqIGkuZS4gTygxKSB3aXRoIGEgbGFy
Z2UgY29uc3RhbnQhCi0JICovCi0JaWYgKG4gPCBSRUFEX09OQ0UoaXRlci0+c2dfaWR4KSkKLQkJ
Z290byBsb29rdXA7Ci0KLQltdXRleF9sb2NrKCZpdGVyLT5sb2NrKTsKLQotCS8qIFdlIHByZWZl
ciB0byByZXVzZSB0aGUgbGFzdCBzZyBzbyB0aGF0IHJlcGVhdGVkIGxvb2t1cCBvZiB0aGlzCi0J
ICogKG9yIHRoZSBzdWJzZXF1ZW50KSBzZyBhcmUgZmFzdCAtIGNvbXBhcmluZyBhZ2FpbnN0IHRo
ZSBsYXN0Ci0JICogc2cgaXMgZmFzdGVyIHRoYW4gZ29pbmcgdGhyb3VnaCB0aGUgcmFkaXh0cmVl
LgotCSAqLwotCi0Jc2cgPSBpdGVyLT5zZ19wb3M7Ci0JaWR4ID0gaXRlci0+c2dfaWR4OwotCWNv
dW50ID0gX19zZ19wYWdlX2NvdW50KHNnKTsKLQotCXdoaWxlIChpZHggKyBjb3VudCA8PSBuKSB7
Ci0JCXZvaWQgKmVudHJ5OwotCQl1bnNpZ25lZCBsb25nIGk7Ci0JCWludCByZXQ7Ci0KLQkJLyog
SWYgd2UgY2Fubm90IGFsbG9jYXRlIGFuZCBpbnNlcnQgdGhpcyBlbnRyeSwgb3IgdGhlCi0JCSAq
IGluZGl2aWR1YWwgcGFnZXMgZnJvbSB0aGlzIHJhbmdlLCBjYW5jZWwgdXBkYXRpbmcgdGhlCi0J
CSAqIHNnX2lkeCBzbyB0aGF0IG9uIHRoaXMgbG9va3VwIHdlIGFyZSBmb3JjZWQgdG8gbGluZWFy
bHkKLQkJICogc2NhbiBvbndhcmRzLCBidXQgb24gZnV0dXJlIGxvb2t1cHMgd2Ugd2lsbCB0cnkg
dGhlCi0JCSAqIGluc2VydGlvbiBhZ2FpbiAoaW4gd2hpY2ggY2FzZSB3ZSBuZWVkIHRvIGJlIGNh
cmVmdWwgb2YKLQkJICogdGhlIGVycm9yIHJldHVybiByZXBvcnRpbmcgdGhhdCB3ZSBoYXZlIGFs
cmVhZHkgaW5zZXJ0ZWQKLQkJICogdGhpcyBpbmRleCkuCi0JCSAqLwotCQlyZXQgPSByYWRpeF90
cmVlX2luc2VydCgmaXRlci0+cmFkaXgsIGlkeCwgc2cpOwotCQlpZiAocmV0ICYmIHJldCAhPSAt
RUVYSVNUKQotCQkJZ290byBzY2FuOwotCi0JCWVudHJ5ID0geGFfbWtfdmFsdWUoaWR4KTsKLQkJ
Zm9yIChpID0gMTsgaSA8IGNvdW50OyBpKyspIHsKLQkJCXJldCA9IHJhZGl4X3RyZWVfaW5zZXJ0
KCZpdGVyLT5yYWRpeCwgaWR4ICsgaSwgZW50cnkpOwotCQkJaWYgKHJldCAmJiByZXQgIT0gLUVF
WElTVCkKLQkJCQlnb3RvIHNjYW47Ci0JCX0KLQotCQlpZHggKz0gY291bnQ7Ci0JCXNnID0gX19f
X3NnX25leHQoc2cpOwotCQljb3VudCA9IF9fc2dfcGFnZV9jb3VudChzZyk7Ci0JfQotCi1zY2Fu
OgotCWl0ZXItPnNnX3BvcyA9IHNnOwotCWl0ZXItPnNnX2lkeCA9IGlkeDsKLQotCW11dGV4X3Vu
bG9jaygmaXRlci0+bG9jayk7Ci0KLQlpZiAodW5saWtlbHkobiA8IGlkeCkpIC8qIGluc2VydGlv
biBjb21wbGV0ZWQgYnkgYW5vdGhlciB0aHJlYWQgKi8KLQkJZ290byBsb29rdXA7Ci0KLQkvKiBJ
biBjYXNlIHdlIGZhaWxlZCB0byBpbnNlcnQgdGhlIGVudHJ5IGludG8gdGhlIHJhZGl4dHJlZSwg
d2UgbmVlZAotCSAqIHRvIGxvb2sgYmV5b25kIHRoZSBjdXJyZW50IHNnLgotCSAqLwotCXdoaWxl
IChpZHggKyBjb3VudCA8PSBuKSB7Ci0JCWlkeCArPSBjb3VudDsKLQkJc2cgPSBfX19fc2dfbmV4
dChzZyk7Ci0JCWNvdW50ID0gX19zZ19wYWdlX2NvdW50KHNnKTsKLQl9Ci0KLQkqb2Zmc2V0ID0g
biAtIGlkeDsKLQlyZXR1cm4gc2c7Ci0KLWxvb2t1cDoKLQlyY3VfcmVhZF9sb2NrKCk7Ci0KLQlz
ZyA9IHJhZGl4X3RyZWVfbG9va3VwKCZpdGVyLT5yYWRpeCwgbik7Ci0JR0VNX0JVR19PTighc2cp
OwotCi0JLyogSWYgdGhpcyBpbmRleCBpcyBpbiB0aGUgbWlkZGxlIG9mIG11bHRpLXBhZ2Ugc2cg
ZW50cnksCi0JICogdGhlIHJhZGl4IHRyZWUgd2lsbCBjb250YWluIGEgdmFsdWUgZW50cnkgdGhh
dCBwb2ludHMKLQkgKiB0byB0aGUgc3RhcnQgb2YgdGhhdCByYW5nZS4gV2Ugd2lsbCByZXR1cm4g
dGhlIHBvaW50ZXIgdG8KLQkgKiB0aGUgYmFzZSBwYWdlIGFuZCB0aGUgb2Zmc2V0IG9mIHRoaXMg
cGFnZSB3aXRoaW4gdGhlCi0JICogc2cgZW50cnkncyByYW5nZS4KLQkgKi8KLQkqb2Zmc2V0ID0g
MDsKLQlpZiAodW5saWtlbHkoeGFfaXNfdmFsdWUoc2cpKSkgewotCQl1bnNpZ25lZCBsb25nIGJh
c2UgPSB4YV90b192YWx1ZShzZyk7Ci0KLQkJc2cgPSByYWRpeF90cmVlX2xvb2t1cCgmaXRlci0+
cmFkaXgsIGJhc2UpOwotCQlHRU1fQlVHX09OKCFzZyk7Ci0KLQkJKm9mZnNldCA9IG4gLSBiYXNl
OwotCX0KLQotCXJjdV9yZWFkX3VubG9jaygpOwotCi0JcmV0dXJuIHNnOwotfQotCi1zdHJ1Y3Qg
cGFnZSAqCi1pOTE1X2dlbV9vYmplY3RfZ2V0X3BhZ2Uoc3RydWN0IGRybV9pOTE1X2dlbV9vYmpl
Y3QgKm9iaiwgdW5zaWduZWQgaW50IG4pCi17Ci0Jc3RydWN0IHNjYXR0ZXJsaXN0ICpzZzsKLQl1
bnNpZ25lZCBpbnQgb2Zmc2V0OwotCi0JR0VNX0JVR19PTighaTkxNV9nZW1fb2JqZWN0X2hhc19z
dHJ1Y3RfcGFnZShvYmopKTsKLQotCXNnID0gaTkxNV9nZW1fb2JqZWN0X2dldF9zZyhvYmosIG4s
ICZvZmZzZXQpOwotCXJldHVybiBudGhfcGFnZShzZ19wYWdlKHNnKSwgb2Zmc2V0KTsKLX0KLQot
LyogTGlrZSBpOTE1X2dlbV9vYmplY3RfZ2V0X3BhZ2UoKSwgYnV0IG1hcmsgdGhlIHJldHVybmVk
IHBhZ2UgZGlydHkgKi8KLXN0cnVjdCBwYWdlICoKLWk5MTVfZ2VtX29iamVjdF9nZXRfZGlydHlf
cGFnZShzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2JqLAotCQkJICAgICAgIHVuc2lnbmVk
IGludCBuKQotewotCXN0cnVjdCBwYWdlICpwYWdlOwotCi0JcGFnZSA9IGk5MTVfZ2VtX29iamVj
dF9nZXRfcGFnZShvYmosIG4pOwotCWlmICghb2JqLT5tbS5kaXJ0eSkKLQkJc2V0X3BhZ2VfZGly
dHkocGFnZSk7Ci0KLQlyZXR1cm4gcGFnZTsKLX0KLQotZG1hX2FkZHJfdAotaTkxNV9nZW1fb2Jq
ZWN0X2dldF9kbWFfYWRkcmVzcyhzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2JqLAotCQkJ
CXVuc2lnbmVkIGxvbmcgbikKLXsKLQlzdHJ1Y3Qgc2NhdHRlcmxpc3QgKnNnOwotCXVuc2lnbmVk
IGludCBvZmZzZXQ7Ci0KLQlzZyA9IGk5MTVfZ2VtX29iamVjdF9nZXRfc2cob2JqLCBuLCAmb2Zm
c2V0KTsKLQlyZXR1cm4gc2dfZG1hX2FkZHJlc3Moc2cpICsgKG9mZnNldCA8PCBQQUdFX1NISUZU
KTsKLX0KLQotaW50IGk5MTVfZ2VtX29iamVjdF9hdHRhY2hfcGh5cyhzdHJ1Y3QgZHJtX2k5MTVf
Z2VtX29iamVjdCAqb2JqLCBpbnQgYWxpZ24pCi17Ci0Jc3RydWN0IHNnX3RhYmxlICpwYWdlczsK
LQlpbnQgZXJyOwotCi0JaWYgKGFsaWduID4gb2JqLT5iYXNlLnNpemUpCi0JCXJldHVybiAtRUlO
VkFMOwotCi0JaWYgKG9iai0+b3BzID09ICZpOTE1X2dlbV9waHlzX29wcykKLQkJcmV0dXJuIDA7
Ci0KLQlpZiAob2JqLT5vcHMgIT0gJmk5MTVfZ2VtX3NobWVtX29wcykKLQkJcmV0dXJuIC1FSU5W
QUw7Ci0KLQllcnIgPSBpOTE1X2dlbV9vYmplY3RfdW5iaW5kKG9iaik7Ci0JaWYgKGVycikKLQkJ
cmV0dXJuIGVycjsKLQotCW11dGV4X2xvY2soJm9iai0+bW0ubG9jayk7Ci0KLQlpZiAob2JqLT5t
bS5tYWR2ICE9IEk5MTVfTUFEVl9XSUxMTkVFRCkgewotCQllcnIgPSAtRUZBVUxUOwotCQlnb3Rv
IGVycl91bmxvY2s7Ci0JfQotCi0JaWYgKG9iai0+bW0ucXVpcmtlZCkgewotCQllcnIgPSAtRUZB
VUxUOwotCQlnb3RvIGVycl91bmxvY2s7Ci0JfQotCi0JaWYgKG9iai0+bW0ubWFwcGluZykgewot
CQllcnIgPSAtRUJVU1k7Ci0JCWdvdG8gZXJyX3VubG9jazsKLQl9Ci0KLQlwYWdlcyA9IF9faTkx
NV9nZW1fb2JqZWN0X3Vuc2V0X3BhZ2VzKG9iaik7Ci0KLQlvYmotPm9wcyA9ICZpOTE1X2dlbV9w
aHlzX29wczsKLQotCWVyciA9IF9fX19pOTE1X2dlbV9vYmplY3RfZ2V0X3BhZ2VzKG9iaik7Ci0J
aWYgKGVycikKLQkJZ290byBlcnJfeGZlcjsKLQotCS8qIFBlcm1hLXBpbiAodW50aWwgcmVsZWFz
ZSkgdGhlIHBoeXNpY2FsIHNldCBvZiBwYWdlcyAqLwotCV9faTkxNV9nZW1fb2JqZWN0X3Bpbl9w
YWdlcyhvYmopOwotCi0JaWYgKCFJU19FUlJfT1JfTlVMTChwYWdlcykpCi0JCWk5MTVfZ2VtX3No
bWVtX29wcy5wdXRfcGFnZXMob2JqLCBwYWdlcyk7Ci0JbXV0ZXhfdW5sb2NrKCZvYmotPm1tLmxv
Y2spOwotCXJldHVybiAwOwotCi1lcnJfeGZlcjoKLQlvYmotPm9wcyA9ICZpOTE1X2dlbV9zaG1l
bV9vcHM7Ci0JaWYgKCFJU19FUlJfT1JfTlVMTChwYWdlcykpIHsKLQkJdW5zaWduZWQgaW50IHNn
X3BhZ2Vfc2l6ZXMgPSBpOTE1X3NnX3BhZ2Vfc2l6ZXMocGFnZXMtPnNnbCk7Ci0KLQkJX19pOTE1
X2dlbV9vYmplY3Rfc2V0X3BhZ2VzKG9iaiwgcGFnZXMsIHNnX3BhZ2Vfc2l6ZXMpOwotCX0KLWVy
cl91bmxvY2s6Ci0JbXV0ZXhfdW5sb2NrKCZvYmotPm1tLmxvY2spOwotCXJldHVybiBlcnI7Ci19
Ci0KICNpZiBJU19FTkFCTEVEKENPTkZJR19EUk1fSTkxNV9TRUxGVEVTVCkKICNpbmNsdWRlICJz
ZWxmdGVzdHMvc2NhdHRlcmxpc3QuYyIKICNpbmNsdWRlICJzZWxmdGVzdHMvbW9ja19nZW1fZGV2
aWNlLmMiCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2dlbV9zaHJpbmtl
ci5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9nZW1fc2hyaW5rZXIuYwppbmRleCA1ODhl
Mzg5OGIxMjAuLjJjN2FlZmIzZTEwMSAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUv
aTkxNV9nZW1fc2hyaW5rZXIuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2dlbV9z
aHJpbmtlci5jCkBAIC0xMTQsNjUgKzExNCwxOCBAQCBzdGF0aWMgYm9vbCB1bnNhZmVfZHJvcF9w
YWdlcyhzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2JqKQogCXJldHVybiAhaTkxNV9nZW1f
b2JqZWN0X2hhc19wYWdlcyhvYmopOwogfQogCi1zdGF0aWMgdm9pZCBfX3N0YXJ0X3dyaXRlYmFj
ayhzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2JqLAotCQkJICAgICAgdW5zaWduZWQgaW50
IGZsYWdzKQorc3RhdGljIHZvaWQgdHJ5X3RvX3dyaXRlYmFjayhzdHJ1Y3QgZHJtX2k5MTVfZ2Vt
X29iamVjdCAqb2JqLAorCQkJICAgICB1bnNpZ25lZCBpbnQgZmxhZ3MpCiB7Ci0Jc3RydWN0IGFk
ZHJlc3Nfc3BhY2UgKm1hcHBpbmc7Ci0Jc3RydWN0IHdyaXRlYmFja19jb250cm9sIHdiYyA9IHsK
LQkJLnN5bmNfbW9kZSA9IFdCX1NZTkNfTk9ORSwKLQkJLm5yX3RvX3dyaXRlID0gU1dBUF9DTFVT
VEVSX01BWCwKLQkJLnJhbmdlX3N0YXJ0ID0gMCwKLQkJLnJhbmdlX2VuZCA9IExMT05HX01BWCwK
LQkJLmZvcl9yZWNsYWltID0gMSwKLQl9OwotCXVuc2lnbmVkIGxvbmcgaTsKLQotCWxvY2tkZXBf
YXNzZXJ0X2hlbGQoJm9iai0+bW0ubG9jayk7Ci0JR0VNX0JVR19PTihpOTE1X2dlbV9vYmplY3Rf
aGFzX3BhZ2VzKG9iaikpOwotCiAJc3dpdGNoIChvYmotPm1tLm1hZHYpIHsKIAljYXNlIEk5MTVf
TUFEVl9ET05UTkVFRDoKLQkJX19pOTE1X2dlbV9vYmplY3RfdHJ1bmNhdGUob2JqKTsKKwkJaTkx
NV9nZW1fb2JqZWN0X3RydW5jYXRlKG9iaik7CiAJY2FzZSBfX0k5MTVfTUFEVl9QVVJHRUQ6CiAJ
CXJldHVybjsKIAl9CiAKLQlpZiAoIW9iai0+YmFzZS5maWxwKQotCQlyZXR1cm47Ci0KLQlpZiAo
IShmbGFncyAmIEk5MTVfU0hSSU5LX1dSSVRFQkFDSykpCi0JCXJldHVybjsKLQotCS8qCi0JICog
TGVhdmUgbW1hcGluZ3MgaW50YWN0IChHVFQgd2lsbCBoYXZlIGJlZW4gcmV2b2tlZCBvbiB1bmJp
bmRpbmcsCi0JICogbGVhdmluZyBvbmx5IENQVSBtbWFwaW5ncyBhcm91bmQpIGFuZCBhZGQgdGhv
c2UgcGFnZXMgdG8gdGhlIExSVQotCSAqIGluc3RlYWQgb2YgaW52b2tpbmcgd3JpdGViYWNrIHNv
IHRoZXkgYXJlIGFnZWQgYW5kIHBhZ2VkIG91dAotCSAqIGFzIG5vcm1hbC4KLQkgKi8KLQltYXBw
aW5nID0gb2JqLT5iYXNlLmZpbHAtPmZfbWFwcGluZzsKLQotCS8qIEJlZ2luIHdyaXRlYmFjayBv
biBlYWNoIGRpcnR5IHBhZ2UgKi8KLQlmb3IgKGkgPSAwOyBpIDwgb2JqLT5iYXNlLnNpemUgPj4g
UEFHRV9TSElGVDsgaSsrKSB7Ci0JCXN0cnVjdCBwYWdlICpwYWdlOwotCi0JCXBhZ2UgPSBmaW5k
X2xvY2tfZW50cnkobWFwcGluZywgaSk7Ci0JCWlmICghcGFnZSB8fCB4YV9pc192YWx1ZShwYWdl
KSkKLQkJCWNvbnRpbnVlOwotCi0JCWlmICghcGFnZV9tYXBwZWQocGFnZSkgJiYgY2xlYXJfcGFn
ZV9kaXJ0eV9mb3JfaW8ocGFnZSkpIHsKLQkJCWludCByZXQ7Ci0KLQkJCVNldFBhZ2VSZWNsYWlt
KHBhZ2UpOwotCQkJcmV0ID0gbWFwcGluZy0+YV9vcHMtPndyaXRlcGFnZShwYWdlLCAmd2JjKTsK
LQkJCWlmICghUGFnZVdyaXRlYmFjayhwYWdlKSkKLQkJCQlDbGVhclBhZ2VSZWNsYWltKHBhZ2Up
OwotCQkJaWYgKCFyZXQpCi0JCQkJZ290byBwdXQ7Ci0JCX0KLQkJdW5sb2NrX3BhZ2UocGFnZSk7
Ci1wdXQ6Ci0JCXB1dF9wYWdlKHBhZ2UpOwotCX0KKwlpZiAoZmxhZ3MgJiBJOTE1X1NIUklOS19X
UklURUJBQ0spCisJCWk5MTVfZ2VtX29iamVjdF93cml0ZWJhY2sob2JqKTsKIH0KIAogLyoqCkBA
IC0zMTUsNyArMjY4LDcgQEAgaTkxNV9nZW1fc2hyaW5rKHN0cnVjdCBkcm1faTkxNV9wcml2YXRl
ICppOTE1LAogCQkJCW11dGV4X2xvY2tfbmVzdGVkKCZvYmotPm1tLmxvY2ssCiAJCQkJCQkgIEk5
MTVfTU1fU0hSSU5LRVIpOwogCQkJCWlmICghaTkxNV9nZW1fb2JqZWN0X2hhc19wYWdlcyhvYmop
KSB7Ci0JCQkJCV9fc3RhcnRfd3JpdGViYWNrKG9iaiwgZmxhZ3MpOworCQkJCQl0cnlfdG9fd3Jp
dGViYWNrKG9iaiwgZmxhZ3MpOwogCQkJCQljb3VudCArPSBvYmotPmJhc2Uuc2l6ZSA+PiBQQUdF
X1NISUZUOwogCQkJCX0KIAkJCQltdXRleF91bmxvY2soJm9iai0+bW0ubG9jayk7CmRpZmYgLS1n
aXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMvaTkxNV9nZW1fb2JqZWN0LmMgYi9k
cml2ZXJzL2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMvaTkxNV9nZW1fb2JqZWN0LmMKaW5kZXggYTBm
NTlmYjBkNzAxLi5iOThhMjg2YThiZTUgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1
L3NlbGZ0ZXN0cy9pOTE1X2dlbV9vYmplY3QuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9z
ZWxmdGVzdHMvaTkxNV9nZW1fb2JqZWN0LmMKQEAgLTQ5LDU5ICs0OSw2IEBAIHN0YXRpYyBpbnQg
aWd0X2dlbV9vYmplY3Qodm9pZCAqYXJnKQogCXJldHVybiBlcnI7CiB9CiAKLXN0YXRpYyBpbnQg
aWd0X3BoeXNfb2JqZWN0KHZvaWQgKmFyZykKLXsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAq
aTkxNSA9IGFyZzsKLQlzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2JqOwotCWludCBlcnI7
Ci0KLQkvKiBDcmVhdGUgYW4gb2JqZWN0IGFuZCBiaW5kIGl0IHRvIGEgY29udGlndW91cyBzZXQg
b2YgcGh5c2ljYWwgcGFnZXMsCi0JICogaS5lLiBleGVyY2lzZSB0aGUgaTkxNV9nZW1fb2JqZWN0
X3BoeXMgQVBJLgotCSAqLwotCi0Jb2JqID0gaTkxNV9nZW1fb2JqZWN0X2NyZWF0ZV9zaG1lbShp
OTE1LCBQQUdFX1NJWkUpOwotCWlmIChJU19FUlIob2JqKSkgewotCQllcnIgPSBQVFJfRVJSKG9i
aik7Ci0JCXByX2VycigiaTkxNV9nZW1fb2JqZWN0X2NyZWF0ZSBmYWlsZWQsIGVycj0lZFxuIiwg
ZXJyKTsKLQkJZ290byBvdXQ7Ci0JfQotCi0JbXV0ZXhfbG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9t
dXRleCk7Ci0JZXJyID0gaTkxNV9nZW1fb2JqZWN0X2F0dGFjaF9waHlzKG9iaiwgUEFHRV9TSVpF
KTsKLQltdXRleF91bmxvY2soJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwotCWlmIChlcnIpIHsK
LQkJcHJfZXJyKCJpOTE1X2dlbV9vYmplY3RfYXR0YWNoX3BoeXMgZmFpbGVkLCBlcnI9JWRcbiIs
IGVycik7Ci0JCWdvdG8gb3V0X29iajsKLQl9Ci0KLQlpZiAob2JqLT5vcHMgIT0gJmk5MTVfZ2Vt
X3BoeXNfb3BzKSB7Ci0JCXByX2VycigiaTkxNV9nZW1fb2JqZWN0X2F0dGFjaF9waHlzIGRpZCBu
b3QgY3JlYXRlIGEgcGh5cyBvYmplY3RcbiIpOwotCQllcnIgPSAtRUlOVkFMOwotCQlnb3RvIG91
dF9vYmo7Ci0JfQotCi0JaWYgKCFhdG9taWNfcmVhZCgmb2JqLT5tbS5wYWdlc19waW5fY291bnQp
KSB7Ci0JCXByX2VycigiaTkxNV9nZW1fb2JqZWN0X2F0dGFjaF9waHlzIGRpZCBub3QgcGluIGl0
cyBwaHlzIHBhZ2VzXG4iKTsKLQkJZXJyID0gLUVJTlZBTDsKLQkJZ290byBvdXRfb2JqOwotCX0K
LQotCS8qIE1ha2UgdGhlIG9iamVjdCBkaXJ0eSBzbyB0aGF0IHB1dF9wYWdlcyBtdXN0IGRvIGNv
cHkgYmFjayB0aGUgZGF0YSAqLwotCW11dGV4X2xvY2soJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgp
OwotCWVyciA9IGk5MTVfZ2VtX29iamVjdF9zZXRfdG9fZ3R0X2RvbWFpbihvYmosIHRydWUpOwot
CW11dGV4X3VubG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7Ci0JaWYgKGVycikgewotCQlw
cl9lcnIoImk5MTVfZ2VtX29iamVjdF9zZXRfdG9fZ3R0X2RvbWFpbiBmYWlsZWQgd2l0aCBlcnI9
JWRcbiIsCi0JCSAgICAgICBlcnIpOwotCQlnb3RvIG91dF9vYmo7Ci0JfQotCi1vdXRfb2JqOgot
CWk5MTVfZ2VtX29iamVjdF9wdXQob2JqKTsKLW91dDoKLQlyZXR1cm4gZXJyOwotfQotCiBzdGF0
aWMgaW50IGlndF9nZW1faHVnZSh2b2lkICphcmcpCiB7CiAJY29uc3QgdW5zaWduZWQgaW50IG5y
ZWFsID0gNTA5OyAvKiBqdXN0IHRvIGJlIGF3a3dhcmQgKi8KQEAgLTYzMSw3ICs1NzgsNiBAQCBp
bnQgaTkxNV9nZW1fb2JqZWN0X21vY2tfc2VsZnRlc3RzKHZvaWQpCiB7CiAJc3RhdGljIGNvbnN0
IHN0cnVjdCBpOTE1X3N1YnRlc3QgdGVzdHNbXSA9IHsKIAkJU1VCVEVTVChpZ3RfZ2VtX29iamVj
dCksCi0JCVNVQlRFU1QoaWd0X3BoeXNfb2JqZWN0KSwKIAl9OwogCXN0cnVjdCBkcm1faTkxNV9w
cml2YXRlICppOTE1OwogCWludCBlcnI7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkx
NS9zZWxmdGVzdHMvaTkxNV9tb2NrX3NlbGZ0ZXN0cy5oIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUv
c2VsZnRlc3RzL2k5MTVfbW9ja19zZWxmdGVzdHMuaAppbmRleCA4OGU1YWI1ODYzMzcuLjUxMGVi
MTc2YmIyYyAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvc2VsZnRlc3RzL2k5MTVf
bW9ja19zZWxmdGVzdHMuaAorKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMvaTkx
NV9tb2NrX3NlbGZ0ZXN0cy5oCkBAIC0xOCw2ICsxOCw3IEBAIHNlbGZ0ZXN0KGVuZ2luZSwgaW50
ZWxfZW5naW5lX2NzX21vY2tfc2VsZnRlc3RzKQogc2VsZnRlc3QodGltZWxpbmVzLCBpOTE1X3Rp
bWVsaW5lX21vY2tfc2VsZnRlc3RzKQogc2VsZnRlc3QocmVxdWVzdHMsIGk5MTVfcmVxdWVzdF9t
b2NrX3NlbGZ0ZXN0cykKIHNlbGZ0ZXN0KG9iamVjdHMsIGk5MTVfZ2VtX29iamVjdF9tb2NrX3Nl
bGZ0ZXN0cykKK3NlbGZ0ZXN0KHBoeXMsIGk5MTVfZ2VtX3BoeXNfbW9ja19zZWxmdGVzdHMpCiBz
ZWxmdGVzdChkbWFidWYsIGk5MTVfZ2VtX2RtYWJ1Zl9tb2NrX3NlbGZ0ZXN0cykKIHNlbGZ0ZXN0
KHZtYSwgaTkxNV92bWFfbW9ja19zZWxmdGVzdHMpCiBzZWxmdGVzdChldmljdCwgaTkxNV9nZW1f
ZXZpY3RfbW9ja19zZWxmdGVzdHMpCi0tIAoyLjIwLjEKCl9fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fCkludGVsLWdmeCBtYWlsaW5nIGxpc3QKSW50ZWwtZ2Z4
QGxpc3RzLmZyZWVkZXNrdG9wLm9yZwpodHRwczovL2xpc3RzLmZyZWVkZXNrdG9wLm9yZy9tYWls
bWFuL2xpc3RpbmZvL2ludGVsLWdmeA==

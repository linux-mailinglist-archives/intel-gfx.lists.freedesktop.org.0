Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id D25CC5703D
	for <lists+intel-gfx@lfdr.de>; Wed, 26 Jun 2019 20:04:07 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 2268D6E4D6;
	Wed, 26 Jun 2019 18:04:06 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from mga04.intel.com (mga04.intel.com [192.55.52.120])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 901AB6E4D6
 for <intel-gfx@lists.freedesktop.org>; Wed, 26 Jun 2019 18:04:02 +0000 (UTC)
X-Amp-Result: SKIPPED(no attachment in message)
X-Amp-File-Uploaded: False
Received: from fmsmga003.fm.intel.com ([10.253.24.29])
 by fmsmga104.fm.intel.com with ESMTP/TLS/DHE-RSA-AES256-GCM-SHA384;
 26 Jun 2019 11:04:02 -0700
X-ExtLoop1: 1
X-IronPort-AV: E=Sophos;i="5.63,420,1557212400"; d="scan'208";a="170128522"
Received: from stinkbox.fi.intel.com (HELO stinkbox) ([10.237.72.174])
 by FMSMGA003.fm.intel.com with SMTP; 26 Jun 2019 11:04:00 -0700
Received: by stinkbox (sSMTP sendmail emulation);
 Wed, 26 Jun 2019 21:03:59 +0300
From: Ville Syrjala <ville.syrjala@linux.intel.com>
To: intel-gfx@lists.freedesktop.org
Date: Wed, 26 Jun 2019 21:03:44 +0300
Message-Id: <20190626180344.26314-6-ville.syrjala@linux.intel.com>
X-Mailer: git-send-email 2.21.0
In-Reply-To: <20190626180344.26314-1-ville.syrjala@linux.intel.com>
References: <20190626180344.26314-1-ville.syrjala@linux.intel.com>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH v2 5/5] drm/i915: Use raw_reg_read()/write() in
 ilk+ irq handlers
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

RnJvbTogVmlsbGUgU3lyasOkbMOkIDx2aWxsZS5zeXJqYWxhQGxpbnV4LmludGVsLmNvbT4KCk9w
dGltaXplIHRoZSBpcnEgaGFuZGxlcnMgYSBiaXQgYnkgc3dpdGNoaW5nIHRvIHRoZSByYXcgcmVn
aXN0ZXIKYWNjZXNzIGZ1bmN0aW9ucy4KCkl0IHNlZW1zIHdlIGNhbiBnbyBmdWxseSBsb2NrbGVz
cyBkdWUgdG8KV2FTZXJpYWxpemVLbWREaXNwbGF5QWNjZXNzLCBzbyBpbiBvcmRlciB0byBwcm90
ZWN0IGFnYWluc3QgdGhhdAp3ZSBncmFiIHRoZSBpcnFfbG9jayBhcm91bmQgdGhlIGFjay4gSSAq
dGhpbmsqIHRoYXQgc2hvdWxkIGJlCnN1ZmZpY2llbnQgYXMgdGhhdCdzIGhlbGQgd2hlbmV2ZXIg
d2Ugb3RoZXJ3aXNlIG1hc3NhZ2UgdGhlIGlycQpyZWdpc3RlcnMuIFRoZSB3L2EgZGF0YWJhc2Ug
bGlzdHMgdGhpcyBvbmx5IGZvciBzbmIvaXZiL2hzdywgc28KbWF5YmUgd2UgZG9uJ3QgZXZlbiBu
ZWVkIGl0IGZvciBiZHcrPyBCdXQgSSB3YXMgdG9vIGNoaWNrZW4gdG8KbGVhdmUgaXQgb3V0LgoK
VGhpcyBsZWFkcyB0byBzb21lIHNocmlua2FnZToKYWRkL3JlbW92ZTogMS81IGdyb3cvc2hyaW5r
OiAzLzIgdXAvZG93bjogMTgzLy0xMzA3ICgtMTEyNCkKRnVuY3Rpb24gICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgb2xkICAgICBuZXcgICBkZWx0YQpnZW44X2d0X2lycV9hY2sg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC0gICAgIDEwNCAgICArMTA0CmdlbjhfaXJx
X2hhbmRsZXIgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDI5MSAgICAgMzM0ICAgICArNDMK
Z2VuMTFfaXJxX2hhbmRsZXIgICAgICAgICAgICAgICAgICAgICAgICAgICAgOTAyICAgICA5MzUg
ICAgICszMwpjaGVycnl2aWV3X2lycV9oYW5kbGVyICAgICAgICAgICAgICAgICAgICAgICA2MzYg
ICAgIDYzOSAgICAgICszCmlsa19ocGRfaXJxX2Fjay5pc3JhICAgICAgICAgICAgICAgICAgICAg
ICAgICA4MiAgICAgICAtICAgICAtODIKaHN3X3Bzcl9pcnFfYWNrICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgIDkxICAgICAgIC0gICAgIC05MQpnZW44X2d0X2lycV9hY2suaXNyYSAgICAg
ICAgICAgICAgICAgICAgICAgICAxMDQgICAgICAgLSAgICAtMTA0CmlieF9ocGRfaXJxX2Fjay5p
c3JhICAgICAgICAgICAgICAgICAgICAgICAgIDEwNiAgICAgICAtICAgIC0xMDYKY3B0X2lycV9h
Y2sgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgMTE3ICAgICAgIC0gICAgLTExNwpp
cm9ubGFrZV9pcnFfaGFuZGxlciAgICAgICAgICAgICAgICAgICAgICAgIDI5NzMgICAgMjcwMCAg
ICAtMjczCmdlbjhfZGVfaXJxX2FjayAgICAgICAgICAgICAgICAgICAgICAgICAgICAgMTIyOSAg
ICAgNjk1ICAgIC01MzQKVG90YWw6IEJlZm9yZT0zNDEzMiwgQWZ0ZXI9MzMwMDgsIGNoZyAtMy4y
OSUKCnNvIHdlJ3JlIG5vdyBiZWxvdyB0aGUgb3JpZ2luYWwgcHJlLWFjay9oYW5kbGUgc3BsaXQg
bnVtYmVycy4KClNpZ25lZC1vZmYtYnk6IFZpbGxlIFN5cmrDpGzDpCA8dmlsbGUuc3lyamFsYUBs
aW51eC5pbnRlbC5jb20+Ci0tLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9pcnEuYyB8IDIy
MCArKysrKysrKysrKysrKysrKy0tLS0tLS0tLS0tLS0tLQogMSBmaWxlIGNoYW5nZWQsIDExOSBp
bnNlcnRpb25zKCspLCAxMDEgZGVsZXRpb25zKC0pCgpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUv
ZHJtL2k5MTUvaTkxNV9pcnEuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfaXJxLmMKaW5k
ZXggYjgzYzlkNzFkNjMwLi4yZWQ3MTVkNGJkZGQgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2Ry
bS9pOTE1L2k5MTVfaXJxLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9pcnEuYwpA
QCAtMTU3NywxMSArMTU3Nyw5IEBAIGdlbjhfY3NfaXJxX2hhbmRsZXIoc3RydWN0IGludGVsX2Vu
Z2luZV9jcyAqZW5naW5lLCB1MzIgaWlyKQogCQl0YXNrbGV0X2hpX3NjaGVkdWxlKCZlbmdpbmUt
PmV4ZWNsaXN0cy50YXNrbGV0KTsKIH0KIAotc3RhdGljIHZvaWQgZ2VuOF9ndF9pcnFfYWNrKHN0
cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LAorc3RhdGljIHZvaWQgZ2VuOF9ndF9pcnFfYWNr
KHZvaWQgX19pb21lbSAqIGNvbnN0IHJlZ3MsCiAJCQkgICAgdTMyIG1hc3Rlcl9jdGwsIHUzMiBn
dF9paXJbNF0pCiB7Ci0Jdm9pZCBfX2lvbWVtICogY29uc3QgcmVncyA9IGk5MTUtPnVuY29yZS5y
ZWdzOwotCiAjZGVmaW5lIEdFTjhfR1RfSVJRUyAoR0VOOF9HVF9SQ1NfSVJRIHwgXAogCQkgICAg
ICBHRU44X0dUX0JDU19JUlEgfCBcCiAJCSAgICAgIEdFTjhfR1RfVkNTMF9JUlEgfCBcCkBAIC0y
MjkzLDYgKzIyOTEsNyBAQCBzdGF0aWMgaXJxcmV0dXJuX3QgY2hlcnJ5dmlld19pcnFfaGFuZGxl
cihpbnQgaXJxLCB2b2lkICphcmcpCiAJZGlzYWJsZV9ycG1fd2FrZXJlZl9hc3NlcnRzKCZkZXZf
cHJpdi0+cnVudGltZV9wbSk7CiAKIAlkbyB7CisJCXZvaWQgX19pb21lbSAqIGNvbnN0IHJlZ3Mg
PSBkZXZfcHJpdi0+dW5jb3JlLnJlZ3M7CiAJCXUzMiBtYXN0ZXJfY3RsLCBpaXI7CiAJCXUzMiBw
aXBlX3N0YXRzW0k5MTVfTUFYX1BJUEVTXSA9IHt9OwogCQl1MzIgaG90cGx1Z19zdGF0dXMgPSAw
OwpAQCAtMjMyNCw3ICsyMzIzLDcgQEAgc3RhdGljIGlycXJldHVybl90IGNoZXJyeXZpZXdfaXJx
X2hhbmRsZXIoaW50IGlycSwgdm9pZCAqYXJnKQogCQlpZXIgPSBJOTE1X1JFQUQoVkxWX0lFUik7
CiAJCUk5MTVfV1JJVEUoVkxWX0lFUiwgMCk7CiAKLQkJZ2VuOF9ndF9pcnFfYWNrKGRldl9wcml2
LCBtYXN0ZXJfY3RsLCBndF9paXIpOworCQlnZW44X2d0X2lycV9hY2socmVncywgbWFzdGVyX2N0
bCwgZ3RfaWlyKTsKIAogCQlpZiAoaWlyICYgSTkxNV9ESVNQTEFZX1BPUlRfSU5URVJSVVBUKQog
CQkJaG90cGx1Z19zdGF0dXMgPSBpOXh4X2hwZF9pcnFfYWNrKGRldl9wcml2KTsKQEAgLTIzODEs
NyArMjM4MCw3IEBAIHN0cnVjdCBwY2hfaXJxX3JlZ3MgewogCX07CiB9OwogCi1zdGF0aWMgdm9p
ZCBpYnhfaHBkX2lycV9hY2soc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAorc3Rh
dGljIHZvaWQgaWJ4X2hwZF9pcnFfYWNrKHZvaWQgX19pb21lbSAqIGNvbnN0IHJlZ3MsCiAJCQkg
ICAgc3RydWN0IGhwZF9pcnFfcmVncyAqaHBkKQogewogCS8qCkBAIC0yMzkwLDcgKzIzODksNyBA
QCBzdGF0aWMgdm9pZCBpYnhfaHBkX2lycV9hY2soc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRl
dl9wcml2LAogCSAqIHplcm8uIE5vdCBhY2tpbmcgbGVhZHMgdG8gIlRoZSBtYXN0ZXIgY29udHJv
bCBpbnRlcnJ1cHQgbGllZCAoU0RFKSEiCiAJICogZXJyb3JzLgogCSAqLwotCWhwZC0+ZGlnX2hv
dHBsdWdfcmVnID0gSTkxNV9SRUFEKFBDSF9QT1JUX0hPVFBMVUcpOworCWhwZC0+ZGlnX2hvdHBs
dWdfcmVnID0gcmF3X3JlZ19yZWFkKHJlZ3MsIFBDSF9QT1JUX0hPVFBMVUcpOwogCWlmICghaHBk
LT5ob3RwbHVnX3RyaWdnZXIpIHsKIAkJdTMyIG1hc2sgPSBQT1JUQV9IT1RQTFVHX1NUQVRVU19N
QVNLIHwKIAkJCVBPUlREX0hPVFBMVUdfU1RBVFVTX01BU0sgfApAQCAtMjM5OSw3ICsyMzk4LDcg
QEAgc3RhdGljIHZvaWQgaWJ4X2hwZF9pcnFfYWNrKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpk
ZXZfcHJpdiwKIAkJaHBkLT5kaWdfaG90cGx1Z19yZWcgJj0gfm1hc2s7CiAJfQogCi0JSTkxNV9X
UklURShQQ0hfUE9SVF9IT1RQTFVHLCBocGQtPmRpZ19ob3RwbHVnX3JlZyk7CisJcmF3X3JlZ193
cml0ZShyZWdzLCBQQ0hfUE9SVF9IT1RQTFVHLCBocGQtPmRpZ19ob3RwbHVnX3JlZyk7CiB9CiAK
IHN0YXRpYyB2b2lkIGlieF9ocGRfaXJxX2hhbmRsZXIoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUg
KmRldl9wcml2LApAQCAtMjQxNywxMiArMjQxNiwxMiBAQCBzdGF0aWMgdm9pZCBpYnhfaHBkX2ly
cV9oYW5kbGVyKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKIAlpbnRlbF9ocGRf
aXJxX2hhbmRsZXIoZGV2X3ByaXYsIHBpbl9tYXNrLCBsb25nX21hc2spOwogfQogCi1zdGF0aWMg
dm9pZCBpYnhfaXJxX2FjayhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCitzdGF0
aWMgdm9pZCBpYnhfaXJxX2Fjayh2b2lkIF9faW9tZW0gKiBjb25zdCByZWdzLAogCQkJc3RydWN0
IHBjaF9pcnFfcmVncyAqcGNoKQogewogCXBjaC0+aHBkLmhvdHBsdWdfdHJpZ2dlciA9IHBjaC0+
aWlyICYgU0RFX0hPVFBMVUdfTUFTSzsKIAotCWlieF9ocGRfaXJxX2FjayhkZXZfcHJpdiwgJnBj
aC0+aHBkKTsKKwlpYnhfaHBkX2lycV9hY2socmVncywgJnBjaC0+aHBkKTsKIH0KIAogc3RhdGlj
IHZvaWQgaWJ4X2lycV9oYW5kbGVyKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwK
QEAgLTI0NzQsMTEgKzI0NzMsMTEgQEAgc3RhdGljIHZvaWQgaWJ4X2lycV9oYW5kbGVyKHN0cnVj
dCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKIAkJaW50ZWxfcGNoX2ZpZm9fdW5kZXJydW5f
aXJxX2hhbmRsZXIoZGV2X3ByaXYsIFBJUEVfQik7CiB9CiAKLXN0YXRpYyB2b2lkIGl2Yl9lcnJf
aW50X2FjayhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCitzdGF0aWMgdm9pZCBp
dmJfZXJyX2ludF9hY2sodm9pZCBfX2lvbWVtICogY29uc3QgcmVncywKIAkJCSAgICBzdHJ1Y3Qg
aWxrX2RlX2lycV9yZWdzICpkZSkKIHsKLQlkZS0+ZXJyX2ludCA9IEk5MTVfUkVBRChHRU43X0VS
Ul9JTlQpOwotCUk5MTVfV1JJVEUoR0VON19FUlJfSU5ULCBkZS0+ZXJyX2ludCk7CisJZGUtPmVy
cl9pbnQgPSByYXdfcmVnX3JlYWQocmVncywgR0VON19FUlJfSU5UKTsKKwlyYXdfcmVnX3dyaXRl
KHJlZ3MsIEdFTjdfRVJSX0lOVCwgZGUtPmVycl9pbnQpOwogfQogCiBzdGF0aWMgdm9pZCBpdmJf
ZXJyX2ludF9oYW5kbGVyKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKQEAgLTI1
MDMsMTEgKzI1MDIsMTEgQEAgc3RhdGljIHZvaWQgaXZiX2Vycl9pbnRfaGFuZGxlcihzdHJ1Y3Qg
ZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCiAJfQogfQogCi1zdGF0aWMgdm9pZCBjcHRfc2Vy
cl9pbnRfYWNrKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKK3N0YXRpYyB2b2lk
IGNwdF9zZXJyX2ludF9hY2sodm9pZCBfX2lvbWVtICogY29uc3QgcmVncywKIAkJCSAgICAgc3Ry
dWN0IHBjaF9pcnFfcmVncyAqcGNoKQogewotCXBjaC0+c2Vycl9pbnQgPSBJOTE1X1JFQUQoU0VS
Ul9JTlQpOwotCUk5MTVfV1JJVEUoU0VSUl9JTlQsIHBjaC0+c2Vycl9pbnQpOworCXBjaC0+c2Vy
cl9pbnQgPSByYXdfcmVnX3JlYWQocmVncywgU0VSUl9JTlQpOworCXJhd19yZWdfd3JpdGUocmVn
cywgU0VSUl9JTlQsIHBjaC0+c2Vycl9pbnQpOwogfQogCiBzdGF0aWMgdm9pZCBjcHRfc2Vycl9p
bnRfaGFuZGxlcihzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCkBAIC0yNTI0LDE1
ICsyNTIzLDE1IEBAIHN0YXRpYyB2b2lkIGNwdF9zZXJyX2ludF9oYW5kbGVyKHN0cnVjdCBkcm1f
aTkxNV9wcml2YXRlICpkZXZfcHJpdiwKIAkJCWludGVsX3BjaF9maWZvX3VuZGVycnVuX2lycV9o
YW5kbGVyKGRldl9wcml2LCBwaXBlKTsKIH0KIAotc3RhdGljIHZvaWQgY3B0X2lycV9hY2soc3Ry
dWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAorc3RhdGljIHZvaWQgY3B0X2lycV9hY2so
dm9pZCBfX2lvbWVtICogY29uc3QgcmVncywKIAkJCXN0cnVjdCBwY2hfaXJxX3JlZ3MgKnBjaCkK
IHsKIAlwY2gtPmhwZC5ob3RwbHVnX3RyaWdnZXIgPSBwY2gtPmlpciAmIFNERV9IT1RQTFVHX01B
U0tfQ1BUOwogCi0JaWJ4X2hwZF9pcnFfYWNrKGRldl9wcml2LCAmcGNoLT5ocGQpOworCWlieF9o
cGRfaXJxX2FjayhyZWdzLCAmcGNoLT5ocGQpOwogCiAJaWYgKHBjaC0+aWlyICYgU0RFX0VSUk9S
X0NQVCkKLQkJY3B0X3NlcnJfaW50X2FjayhkZXZfcHJpdiwgcGNoKTsKKwkJY3B0X3NlcnJfaW50
X2FjayhyZWdzLCBwY2gpOwogfQogCiBzdGF0aWMgdm9pZCBjcHRfaXJxX2hhbmRsZXIoc3RydWN0
IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LApAQCAtMjU3MiwyMCArMjU3MSwyMCBAQCBzdGF0
aWMgdm9pZCBjcHRfaXJxX2hhbmRsZXIoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2
LAogCQljcHRfc2Vycl9pbnRfaGFuZGxlcihkZXZfcHJpdiwgcGNoKTsKIH0KIAotc3RhdGljIHZv
aWQgaWNwX2lycV9hY2soc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAorc3RhdGlj
IHZvaWQgaWNwX2lycV9hY2sodm9pZCBfX2lvbWVtICogY29uc3QgcmVncywKIAkJCXN0cnVjdCBw
Y2hfaXJxX3JlZ3MgKnBjaCkKIHsKIAlwY2gtPmRkaS5ob3RwbHVnX3RyaWdnZXIgPSBwY2gtPmlp
ciAmIFNERV9ERElfTUFTS19JQ1A7CiAJcGNoLT50Yy5ob3RwbHVnX3RyaWdnZXIgPSBwY2gtPmlp
ciAmIFNERV9UQ19NQVNLX0lDUDsKIAogCWlmIChwY2gtPmRkaS5ob3RwbHVnX3RyaWdnZXIpIHsK
LQkJcGNoLT5kZGkuZGlnX2hvdHBsdWdfcmVnID0gSTkxNV9SRUFEKFNIT1RQTFVHX0NUTF9EREkp
OwotCQlJOTE1X1dSSVRFKFNIT1RQTFVHX0NUTF9EREksIHBjaC0+ZGRpLmRpZ19ob3RwbHVnX3Jl
Zyk7CisJCXBjaC0+ZGRpLmRpZ19ob3RwbHVnX3JlZyA9IHJhd19yZWdfcmVhZChyZWdzLCBTSE9U
UExVR19DVExfRERJKTsKKwkJcmF3X3JlZ193cml0ZShyZWdzLCBTSE9UUExVR19DVExfRERJLCBw
Y2gtPmRkaS5kaWdfaG90cGx1Z19yZWcpOwogCX0KIAogCWlmIChwY2gtPnRjLmhvdHBsdWdfdHJp
Z2dlcikgewotCQlwY2gtPnRjLmRpZ19ob3RwbHVnX3JlZyA9IEk5MTVfUkVBRChTSE9UUExVR19D
VExfVEMpOwotCQlJOTE1X1dSSVRFKFNIT1RQTFVHX0NUTF9UQywgcGNoLT50Yy5kaWdfaG90cGx1
Z19yZWcpOworCQlwY2gtPnRjLmRpZ19ob3RwbHVnX3JlZyA9IHJhd19yZWdfcmVhZChyZWdzLCBT
SE9UUExVR19DVExfVEMpOworCQlyYXdfcmVnX3dyaXRlKHJlZ3MsIFNIT1RQTFVHX0NUTF9UQywg
cGNoLT50Yy5kaWdfaG90cGx1Z19yZWcpOwogCX0KIH0KIApAQCAtMjYxNSw3ICsyNjE0LDcgQEAg
c3RhdGljIHZvaWQgaWNwX2lycV9oYW5kbGVyKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZf
cHJpdiwKIAkJZ21idXNfaXJxX2hhbmRsZXIoZGV2X3ByaXYpOwogfQogCi1zdGF0aWMgdm9pZCBz
cHRfaXJxX2FjayhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCitzdGF0aWMgdm9p
ZCBzcHRfaXJxX2Fjayh2b2lkIF9faW9tZW0gKiBjb25zdCByZWdzLAogCQkJc3RydWN0IHBjaF9p
cnFfcmVncyAqcGNoKQogewogCXBjaC0+aHBkLmhvdHBsdWdfdHJpZ2dlciA9IHBjaC0+aWlyICYg
U0RFX0hPVFBMVUdfTUFTS19TUFQgJgpAQCAtMjYyMywxMyArMjYyMiwxMyBAQCBzdGF0aWMgdm9p
ZCBzcHRfaXJxX2FjayhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCiAJcGNoLT5o
cGQyLmhvdHBsdWdfdHJpZ2dlciA9IHBjaC0+aWlyICYgU0RFX1BPUlRFX0hPVFBMVUdfU1BUOwog
CiAJaWYgKHBjaC0+aHBkLmhvdHBsdWdfdHJpZ2dlcikgewotCQlwY2gtPmhwZC5kaWdfaG90cGx1
Z19yZWcgPSBJOTE1X1JFQUQoUENIX1BPUlRfSE9UUExVRyk7Ci0JCUk5MTVfV1JJVEUoUENIX1BP
UlRfSE9UUExVRywgcGNoLT5ocGQuZGlnX2hvdHBsdWdfcmVnKTsKKwkJcGNoLT5ocGQuZGlnX2hv
dHBsdWdfcmVnID0gcmF3X3JlZ19yZWFkKHJlZ3MsIFBDSF9QT1JUX0hPVFBMVUcpOworCQlyYXdf
cmVnX3dyaXRlKHJlZ3MsIFBDSF9QT1JUX0hPVFBMVUcsIHBjaC0+aHBkLmRpZ19ob3RwbHVnX3Jl
Zyk7CiAJfQogCiAJaWYgKHBjaC0+aHBkMi5ob3RwbHVnX3RyaWdnZXIpIHsKLQkJcGNoLT5ocGQy
LmRpZ19ob3RwbHVnX3JlZyA9IEk5MTVfUkVBRChQQ0hfUE9SVF9IT1RQTFVHMik7Ci0JCUk5MTVf
V1JJVEUoUENIX1BPUlRfSE9UUExVRzIsIHBjaC0+aHBkMi5kaWdfaG90cGx1Z19yZWcpOworCQlw
Y2gtPmhwZDIuZGlnX2hvdHBsdWdfcmVnID0gcmF3X3JlZ19yZWFkKHJlZ3MsIFBDSF9QT1JUX0hP
VFBMVUcyKTsKKwkJcmF3X3JlZ193cml0ZShyZWdzLCBQQ0hfUE9SVF9IT1RQTFVHMiwgcGNoLT5o
cGQyLmRpZ19ob3RwbHVnX3JlZyk7CiAJfQogfQogCkBAIC0yNjU4LDExICsyNjU3LDExIEBAIHN0
YXRpYyB2b2lkIHNwdF9pcnFfaGFuZGxlcihzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3By
aXYsCiAJCWdtYnVzX2lycV9oYW5kbGVyKGRldl9wcml2KTsKIH0KIAotc3RhdGljIHZvaWQgaWxr
X2hwZF9pcnFfYWNrKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKK3N0YXRpYyB2
b2lkIGlsa19ocGRfaXJxX2Fjayh2b2lkIF9faW9tZW0gKiBjb25zdCByZWdzLAogCQkJICAgIHN0
cnVjdCBocGRfaXJxX3JlZ3MgKmhwZCkKIHsKLQlocGQtPmRpZ19ob3RwbHVnX3JlZyA9IEk5MTVf
UkVBRChESUdJVEFMX1BPUlRfSE9UUExVR19DTlRSTCk7Ci0JSTkxNV9XUklURShESUdJVEFMX1BP
UlRfSE9UUExVR19DTlRSTCwgaHBkLT5kaWdfaG90cGx1Z19yZWcpOworCWhwZC0+ZGlnX2hvdHBs
dWdfcmVnID0gcmF3X3JlZ19yZWFkKHJlZ3MsIERJR0lUQUxfUE9SVF9IT1RQTFVHX0NOVFJMKTsK
KwlyYXdfcmVnX3dyaXRlKHJlZ3MsIERJR0lUQUxfUE9SVF9IT1RQTFVHX0NOVFJMLCBocGQtPmRp
Z19ob3RwbHVnX3JlZyk7CiB9CiAKIHN0YXRpYyB2b2lkIGlsa19ocGRfaXJxX2hhbmRsZXIoc3Ry
dWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LApAQCAtMjY3OCwyNiArMjY3NywyNyBAQCBz
dGF0aWMgdm9pZCBpbGtfaHBkX2lycV9oYW5kbGVyKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpk
ZXZfcHJpdiwKIAlpbnRlbF9ocGRfaXJxX2hhbmRsZXIoZGV2X3ByaXYsIHBpbl9tYXNrLCBsb25n
X21hc2spOwogfQogCi1zdGF0aWMgdm9pZCBpbGtfZGlzcGxheV9pcnFfYWNrKHN0cnVjdCBkcm1f
aTkxNV9wcml2YXRlICpkZXZfcHJpdiwKK3N0YXRpYyB2b2lkIGlsa19kaXNwbGF5X2lycV9hY2so
c3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUsCisJCQkJdm9pZCBfX2lvbWVtICogY29uc3Qg
cmVncywKIAkJCQlzdHJ1Y3QgaWxrX2RlX2lycV9yZWdzICpkZSwKIAkJCQlzdHJ1Y3QgcGNoX2ly
cV9yZWdzICpwY2gpCiB7CiAJZGUtPmhwZC5ob3RwbHVnX3RyaWdnZXIgPSBkZS0+aWlyICYgREVf
RFBfQV9IT1RQTFVHOwogCiAJaWYgKGRlLT5ocGQuaG90cGx1Z190cmlnZ2VyKQotCQlpbGtfaHBk
X2lycV9hY2soZGV2X3ByaXYsICZkZS0+aHBkKTsKKwkJaWxrX2hwZF9pcnFfYWNrKHJlZ3MsICZk
ZS0+aHBkKTsKIAogCS8qIGNoZWNrIGV2ZW50IGZyb20gUENIICovCiAJaWYgKGRlLT5paXIgJiBE
RV9QQ0hfRVZFTlQpIHsKLQkJcGNoLT5paXIgPSBJOTE1X1JFQUQoU0RFSUlSKTsKKwkJcGNoLT5p
aXIgPSByYXdfcmVnX3JlYWQocmVncywgU0RFSUlSKTsKIAotCQlpZiAoSEFTX1BDSF9DUFQoZGV2
X3ByaXYpKQotCQkJY3B0X2lycV9hY2soZGV2X3ByaXYsIHBjaCk7CisJCWlmIChIQVNfUENIX0NQ
VChpOTE1KSkKKwkJCWNwdF9pcnFfYWNrKHJlZ3MsIHBjaCk7CiAJCWVsc2UKLQkJCWlieF9pcnFf
YWNrKGRldl9wcml2LCBwY2gpOworCQkJaWJ4X2lycV9hY2socmVncywgcGNoKTsKIAogCQkvKiBz
aG91bGQgY2xlYXIgUENIIGhvdHBsdWcgZXZlbnQgYmVmb3JlIGNsZWFyIENQVSBpcnEgKi8KLQkJ
STkxNV9XUklURShTREVJSVIsIHBjaC0+aWlyKTsKKwkJcmF3X3JlZ193cml0ZShyZWdzLCBTREVJ
SVIsIHBjaC0+aWlyKTsKIAl9CiB9CiAKQEAgLTI3NDMsMzcgKzI3NDMsMzggQEAgc3RhdGljIHZv
aWQgaWxrX2Rpc3BsYXlfaXJxX2hhbmRsZXIoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9w
cml2LAogCQlpcm9ubGFrZV9ycHNfY2hhbmdlX2lycV9oYW5kbGVyKGRldl9wcml2KTsKIH0KIAot
c3RhdGljIHZvaWQgaHN3X3Bzcl9pcnFfYWNrKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZf
cHJpdiwKK3N0YXRpYyB2b2lkIGhzd19wc3JfaXJxX2Fjayh2b2lkIF9faW9tZW0gKiBjb25zdCBy
ZWdzLAogCQkJICAgIHUzMiAqcHNyX2lpcikKIHsKLQkqcHNyX2lpciA9IEk5MTVfUkVBRChFRFBf
UFNSX0lJUik7CisJKnBzcl9paXIgPSByYXdfcmVnX3JlYWQocmVncywgRURQX1BTUl9JSVIpOwog
CWlmICgqcHNyX2lpcikKLQkJSTkxNV9XUklURShFRFBfUFNSX0lJUiwgKnBzcl9paXIpOworCQly
YXdfcmVnX3dyaXRlKHJlZ3MsIEVEUF9QU1JfSUlSLCAqcHNyX2lpcik7CiB9CiAKLXN0YXRpYyB2
b2lkIGl2Yl9kaXNwbGF5X2lycV9hY2soc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2
LAorc3RhdGljIHZvaWQgaXZiX2Rpc3BsYXlfaXJxX2FjayhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0
ZSAqaTkxNSwKKwkJCQl2b2lkIF9faW9tZW0gKiBjb25zdCByZWdzLAogCQkJCXN0cnVjdCBpbGtf
ZGVfaXJxX3JlZ3MgKmRlLAogCQkJCXN0cnVjdCBwY2hfaXJxX3JlZ3MgKnBjaCkKIHsKIAlkZS0+
aHBkLmhvdHBsdWdfdHJpZ2dlciA9IGRlLT5paXIgJiBERV9EUF9BX0hPVFBMVUdfSVZCOwogCiAJ
aWYgKGRlLT5ocGQuaG90cGx1Z190cmlnZ2VyKQotCQlpbGtfaHBkX2lycV9hY2soZGV2X3ByaXYs
ICZkZS0+aHBkKTsKKwkJaWxrX2hwZF9pcnFfYWNrKHJlZ3MsICZkZS0+aHBkKTsKIAogCWlmIChk
ZS0+aWlyICYgREVfRVJSX0lOVF9JVkIpCi0JCWl2Yl9lcnJfaW50X2FjayhkZXZfcHJpdiwgZGUp
OworCQlpdmJfZXJyX2ludF9hY2socmVncywgZGUpOwogCiAJaWYgKGRlLT5paXIgJiBERV9FRFBf
UFNSX0lOVF9IU1cpCi0JCWhzd19wc3JfaXJxX2FjayhkZXZfcHJpdiwgJmRlLT5wc3JfaWlyKTsK
KwkJaHN3X3Bzcl9pcnFfYWNrKHJlZ3MsICZkZS0+cHNyX2lpcik7CiAKIAkvKiBjaGVjayBldmVu
dCBmcm9tIFBDSCAqLwotCWlmICghSEFTX1BDSF9OT1AoZGV2X3ByaXYpICYmIGRlLT5paXIgJiBE
RV9QQ0hfRVZFTlRfSVZCKSB7Ci0JCXBjaC0+aWlyID0gSTkxNV9SRUFEKFNERUlJUik7CisJaWYg
KCFIQVNfUENIX05PUChpOTE1KSAmJiBkZS0+aWlyICYgREVfUENIX0VWRU5UX0lWQikgeworCQlw
Y2gtPmlpciA9IHJhd19yZWdfcmVhZChyZWdzLCBTREVJSVIpOwogCi0JCWNwdF9pcnFfYWNrKGRl
dl9wcml2LCBwY2gpOworCQljcHRfaXJxX2FjayhyZWdzLCBwY2gpOwogCiAJCS8qIGNsZWFyIFBD
SCBob3RwbHVnIGV2ZW50IGJlZm9yZSBjbGVhciBDUFUgaXJxICovCi0JCUk5MTVfV1JJVEUoU0RF
SUlSLCBwY2gtPmlpcik7CisJCXJhd19yZWdfd3JpdGUocmVncywgU0RFSUlSLCBwY2gtPmlpcik7
CiAJfQogfQogCkBAIC0yODIwLDYgKzI4MjEsNyBAQCBzdGF0aWMgdm9pZCBpdmJfZGlzcGxheV9p
cnFfaGFuZGxlcihzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCiBzdGF0aWMgaXJx
cmV0dXJuX3QgaXJvbmxha2VfaXJxX2hhbmRsZXIoaW50IGlycSwgdm9pZCAqYXJnKQogewogCXN0
cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IGFyZzsKKwl2b2lkIF9faW9tZW0gKiBj
b25zdCByZWdzID0gZGV2X3ByaXYtPnVuY29yZS5yZWdzOwogCXUzMiBndF9paXIsIHBtX2lpciA9
IDAsIGRlX2llciwgc2RlX2llciA9IDA7CiAJc3RydWN0IGlsa19kZV9pcnFfcmVncyBkZTsKIAlz
dHJ1Y3QgcGNoX2lycV9yZWdzIHBjaDsKQEAgLTI4MzEsOSArMjgzMywxMiBAQCBzdGF0aWMgaXJx
cmV0dXJuX3QgaXJvbmxha2VfaXJxX2hhbmRsZXIoaW50IGlycSwgdm9pZCAqYXJnKQogCS8qIElS
UXMgYXJlIHN5bmNlZCBkdXJpbmcgcnVudGltZV9zdXNwZW5kLCB3ZSBkb24ndCByZXF1aXJlIGEg
d2FrZXJlZiAqLwogCWRpc2FibGVfcnBtX3dha2VyZWZfYXNzZXJ0cygmZGV2X3ByaXYtPnJ1bnRp
bWVfcG0pOwogCisJLyogV2FTZXJpYWxpemVLbWREaXNwbGF5QWNjZXNzOnNuYixpdmIsaHN3ICov
CisJc3Bpbl9sb2NrKCZkZXZfcHJpdi0+aXJxX2xvY2spOworCiAJLyogZGlzYWJsZSBtYXN0ZXIg
aW50ZXJydXB0IGJlZm9yZSBjbGVhcmluZyBpaXIgICovCi0JZGVfaWVyID0gSTkxNV9SRUFEKERF
SUVSKTsKLQlJOTE1X1dSSVRFKERFSUVSLCBkZV9pZXIgJiB+REVfTUFTVEVSX0lSUV9DT05UUk9M
KTsKKwlkZV9pZXIgPSByYXdfcmVnX3JlYWQocmVncywgREVJRVIpOworCXJhd19yZWdfd3JpdGUo
cmVncywgREVJRVIsIGRlX2llciAmIH5ERV9NQVNURVJfSVJRX0NPTlRST0wpOwogCiAJLyogRGlz
YWJsZSBzb3V0aCBpbnRlcnJ1cHRzLiBXZSdsbCBvbmx5IHdyaXRlIHRvIFNERUlJUiBvbmNlLCBz
byBmdXJ0aGVyCiAJICogaW50ZXJydXB0cyB3aWxsIHdpbGwgYmUgc3RvcmVkIG9uIGl0cyBiYWNr
IHF1ZXVlLCBhbmQgdGhlbiB3ZSdsbCBiZQpAQCAtMjg0MSwzNSArMjg0NiwzNyBAQCBzdGF0aWMg
aXJxcmV0dXJuX3QgaXJvbmxha2VfaXJxX2hhbmRsZXIoaW50IGlycSwgdm9pZCAqYXJnKQogCSAq
IGl0LCB3ZSdsbCBnZXQgYW4gaW50ZXJydXB0IGlmIFNERUlJUiBzdGlsbCBoYXMgc29tZXRoaW5n
IHRvIHByb2Nlc3MKIAkgKiBkdWUgdG8gaXRzIGJhY2sgcXVldWUpLiAqLwogCWlmICghSEFTX1BD
SF9OT1AoZGV2X3ByaXYpKSB7Ci0JCXNkZV9pZXIgPSBJOTE1X1JFQUQoU0RFSUVSKTsKLQkJSTkx
NV9XUklURShTREVJRVIsIDApOworCQlzZGVfaWVyID0gcmF3X3JlZ19yZWFkKHJlZ3MsIFNERUlF
Uik7CisJCXJhd19yZWdfd3JpdGUocmVncywgU0RFSUVSLCAwKTsKIAl9CiAKIAkvKiBGaW5kLCBj
bGVhciwgdGhlbiBwcm9jZXNzIGVhY2ggc291cmNlIG9mIGludGVycnVwdCAqLwogCi0JZ3RfaWly
ID0gSTkxNV9SRUFEKEdUSUlSKTsKLQlkZS5paXIgPSBJOTE1X1JFQUQoREVJSVIpOworCWd0X2lp
ciA9IHJhd19yZWdfcmVhZChyZWdzLCBHVElJUik7CisJZGUuaWlyID0gcmF3X3JlZ19yZWFkKHJl
Z3MsIERFSUlSKTsKIAlpZiAoSU5URUxfR0VOKGRldl9wcml2KSA+PSA2KQotCQlwbV9paXIgPSBJ
OTE1X1JFQUQoR0VONl9QTUlJUik7CisJCXBtX2lpciA9IHJhd19yZWdfcmVhZChyZWdzLCBHRU42
X1BNSUlSKTsKIAogCWlmIChndF9paXIpCi0JCUk5MTVfV1JJVEUoR1RJSVIsIGd0X2lpcik7CisJ
CXJhd19yZWdfd3JpdGUocmVncywgR1RJSVIsIGd0X2lpcik7CiAKIAlpZiAoZGUuaWlyKSB7CiAJ
CWlmIChJTlRFTF9HRU4oZGV2X3ByaXYpID49IDcpCi0JCQlpdmJfZGlzcGxheV9pcnFfYWNrKGRl
dl9wcml2LCAmZGUsICZwY2gpOworCQkJaXZiX2Rpc3BsYXlfaXJxX2FjayhkZXZfcHJpdiwgcmVn
cywgJmRlLCAmcGNoKTsKIAkJZWxzZQotCQkJaWxrX2Rpc3BsYXlfaXJxX2FjayhkZXZfcHJpdiwg
JmRlLCAmcGNoKTsKKwkJCWlsa19kaXNwbGF5X2lycV9hY2soZGV2X3ByaXYsIHJlZ3MsICZkZSwg
JnBjaCk7CiAKLQkJSTkxNV9XUklURShERUlJUiwgZGUuaWlyKTsKKwkJcmF3X3JlZ193cml0ZShy
ZWdzLCBERUlJUiwgZGUuaWlyKTsKIAl9CiAKIAlpZiAocG1faWlyKQotCQlJOTE1X1dSSVRFKEdF
TjZfUE1JSVIsIHBtX2lpcik7CisJCXJhd19yZWdfd3JpdGUocmVncywgR0VONl9QTUlJUiwgcG1f
aWlyKTsKIAotCUk5MTVfV1JJVEUoREVJRVIsIGRlX2llcik7CisJcmF3X3JlZ193cml0ZShyZWdz
LCBERUlFUiwgZGVfaWVyKTsKIAlpZiAoIUhBU19QQ0hfTk9QKGRldl9wcml2KSkKLQkJSTkxNV9X
UklURShTREVJRVIsIHNkZV9pZXIpOworCQlyYXdfcmVnX3dyaXRlKHJlZ3MsIFNERUlFUiwgc2Rl
X2llcik7CisKKwlzcGluX3VubG9jaygmZGV2X3ByaXYtPmlycV9sb2NrKTsKIAogCWlmIChndF9p
aXIpIHsKIAkJcmV0ID0gSVJRX0hBTkRMRUQ7CkBAIC0yODk4LDExICsyOTA1LDExIEBAIHN0YXRp
YyBpcnFyZXR1cm5fdCBpcm9ubGFrZV9pcnFfaGFuZGxlcihpbnQgaXJxLCB2b2lkICphcmcpCiAJ
cmV0dXJuIHJldDsKIH0KIAotc3RhdGljIHZvaWQgYnh0X2hwZF9pcnFfYWNrKHN0cnVjdCBkcm1f
aTkxNV9wcml2YXRlICpkZXZfcHJpdiwKK3N0YXRpYyB2b2lkIGJ4dF9ocGRfaXJxX2Fjayh2b2lk
IF9faW9tZW0gKiBjb25zdCByZWdzLAogCQkJICAgIHN0cnVjdCBocGRfaXJxX3JlZ3MgKmhwZCkK
IHsKLQlocGQtPmRpZ19ob3RwbHVnX3JlZyA9IEk5MTVfUkVBRChQQ0hfUE9SVF9IT1RQTFVHKTsK
LQlJOTE1X1dSSVRFKFBDSF9QT1JUX0hPVFBMVUcsIGhwZC0+ZGlnX2hvdHBsdWdfcmVnKTsKKwlo
cGQtPmRpZ19ob3RwbHVnX3JlZyA9IHJhd19yZWdfcmVhZChyZWdzLCBQQ0hfUE9SVF9IT1RQTFVH
KTsKKwlyYXdfcmVnX3dyaXRlKHJlZ3MsIFBDSF9QT1JUX0hPVFBMVUcsIGhwZC0+ZGlnX2hvdHBs
dWdfcmVnKTsKIH0KIAogc3RhdGljIHZvaWQgYnh0X2hwZF9pcnFfaGFuZGxlcihzdHJ1Y3QgZHJt
X2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCkBAIC0yOTI4LDIwICsyOTM1LDIwIEBAIHN0cnVjdCBn
ZW44X2RlX2lycV9yZWdzIHsKIAlzdHJ1Y3QgaHBkX2lycV9yZWdzIHRjLCB0YnQ7IC8qIGljbCsg
Ki8KIH07CiAKLXN0YXRpYyB2b2lkIGdlbjExX2hwZF9pcnFfYWNrKHN0cnVjdCBkcm1faTkxNV9w
cml2YXRlICpkZXZfcHJpdiwKK3N0YXRpYyB2b2lkIGdlbjExX2hwZF9pcnFfYWNrKHZvaWQgX19p
b21lbSAqIGNvbnN0IHJlZ3MsCiAJCQkgICAgICBzdHJ1Y3QgZ2VuOF9kZV9pcnFfcmVncyAqZGUp
CiB7CiAJZGUtPnRjLmhvdHBsdWdfdHJpZ2dlciA9IGRlLT5ocGRfaWlyICYgR0VOMTFfREVfVENf
SE9UUExVR19NQVNLOwogCWRlLT50YnQuaG90cGx1Z190cmlnZ2VyID0gZGUtPmhwZF9paXIgJiBH
RU4xMV9ERV9UQlRfSE9UUExVR19NQVNLOwogCiAJaWYgKGRlLT50Yy5ob3RwbHVnX3RyaWdnZXIp
IHsKLQkJZGUtPnRjLmRpZ19ob3RwbHVnX3JlZyA9IEk5MTVfUkVBRChHRU4xMV9UQ19IT1RQTFVH
X0NUTCk7Ci0JCUk5MTVfV1JJVEUoR0VOMTFfVENfSE9UUExVR19DVEwsIGRlLT50Yy5kaWdfaG90
cGx1Z19yZWcpOworCQlkZS0+dGMuZGlnX2hvdHBsdWdfcmVnID0gcmF3X3JlZ19yZWFkKHJlZ3Ms
IEdFTjExX1RDX0hPVFBMVUdfQ1RMKTsKKwkJcmF3X3JlZ193cml0ZShyZWdzLCBHRU4xMV9UQ19I
T1RQTFVHX0NUTCwgZGUtPnRjLmRpZ19ob3RwbHVnX3JlZyk7CiAJfQogCiAJaWYgKGRlLT50YnQu
aG90cGx1Z190cmlnZ2VyKSB7Ci0JCWRlLT50YnQuZGlnX2hvdHBsdWdfcmVnID0gSTkxNV9SRUFE
KEdFTjExX1RCVF9IT1RQTFVHX0NUTCk7Ci0JCUk5MTVfV1JJVEUoR0VOMTFfVEJUX0hPVFBMVUdf
Q1RMLCBkZS0+dGJ0LmRpZ19ob3RwbHVnX3JlZyk7CisJCWRlLT50YnQuZGlnX2hvdHBsdWdfcmVn
ID0gcmF3X3JlZ19yZWFkKHJlZ3MsIEdFTjExX1RCVF9IT1RQTFVHX0NUTCk7CisJCXJhd19yZWdf
d3JpdGUocmVncywgR0VOMTFfVEJUX0hPVFBMVUdfQ1RMLCBkZS0+dGJ0LmRpZ19ob3RwbHVnX3Jl
Zyk7CiAJfQogfQogCkBAIC0yOTY5LDc2ICsyOTc2LDc3IEBAIHN0YXRpYyB2b2lkIGdlbjExX2hw
ZF9pcnFfaGFuZGxlcihzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCiB9CiAKIHN0
YXRpYyB2b2lkCi1nZW44X2RlX2lycV9hY2soc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9w
cml2LCB1MzIgbWFzdGVyX2N0bCwKK2dlbjhfZGVfaXJxX2FjayhzdHJ1Y3QgZHJtX2k5MTVfcHJp
dmF0ZSAqaTkxNSwKKwkJdm9pZCBfX2lvbWVtICogY29uc3QgcmVncywgdTMyIG1hc3Rlcl9jdGws
CiAJCXN0cnVjdCBnZW44X2RlX2lycV9yZWdzICpkZSwgc3RydWN0IHBjaF9pcnFfcmVncyAqcGNo
KQogewogCWVudW0gcGlwZSBwaXBlOwogCiAJaWYgKG1hc3Rlcl9jdGwgJiBHRU44X0RFX01JU0Nf
SVJRKSB7Ci0JCWRlLT5taXNjX2lpciA9IEk5MTVfUkVBRChHRU44X0RFX01JU0NfSUlSKTsKKwkJ
ZGUtPm1pc2NfaWlyID0gcmF3X3JlZ19yZWFkKHJlZ3MsIEdFTjhfREVfTUlTQ19JSVIpOwogCiAJ
CWlmIChkZS0+bWlzY19paXIpIHsKIAkJCWlmIChkZS0+bWlzY19paXIgJiBHRU44X0RFX0VEUF9Q
U1IpCi0JCQkJaHN3X3Bzcl9pcnFfYWNrKGRldl9wcml2LCAmZGUtPnBzcl9paXIpOworCQkJCWhz
d19wc3JfaXJxX2FjayhyZWdzLCAmZGUtPnBzcl9paXIpOwogCi0JCQlJOTE1X1dSSVRFKEdFTjhf
REVfTUlTQ19JSVIsIGRlLT5taXNjX2lpcik7CisJCQlyYXdfcmVnX3dyaXRlKHJlZ3MsIEdFTjhf
REVfTUlTQ19JSVIsIGRlLT5taXNjX2lpcik7CiAJCX0KIAl9CiAKIAlpZiAobWFzdGVyX2N0bCAm
IEdFTjExX0RFX0hQRF9JUlEpIHsKLQkJZGUtPmhwZF9paXIgPSBJOTE1X1JFQUQoR0VOMTFfREVf
SFBEX0lJUik7CisJCWRlLT5ocGRfaWlyID0gcmF3X3JlZ19yZWFkKHJlZ3MsIEdFTjExX0RFX0hQ
RF9JSVIpOwogCiAJCWlmIChkZS0+aHBkX2lpcikgewotCQkJZ2VuMTFfaHBkX2lycV9hY2soZGV2
X3ByaXYsIGRlKTsKKwkJCWdlbjExX2hwZF9pcnFfYWNrKHJlZ3MsIGRlKTsKIAotCQkJSTkxNV9X
UklURShHRU4xMV9ERV9IUERfSUlSLCBkZS0+aHBkX2lpcik7CisJCQlyYXdfcmVnX3dyaXRlKHJl
Z3MsIEdFTjExX0RFX0hQRF9JSVIsIGRlLT5ocGRfaWlyKTsKIAkJfQogCX0KIAogCWlmIChtYXN0
ZXJfY3RsICYgR0VOOF9ERV9QT1JUX0lSUSkgewotCQlkZS0+cG9ydF9paXIgPSBJOTE1X1JFQUQo
R0VOOF9ERV9QT1JUX0lJUik7CisJCWRlLT5wb3J0X2lpciA9IHJhd19yZWdfcmVhZChyZWdzLCBH
RU44X0RFX1BPUlRfSUlSKTsKIAogCQlpZiAoZGUtPnBvcnRfaWlyKSB7Ci0JCQlpZiAoSVNfR0VO
OV9MUChkZXZfcHJpdikpIHsKKwkJCWlmIChJU19HRU45X0xQKGk5MTUpKSB7CiAJCQkJZGUtPmRk
aS5ob3RwbHVnX3RyaWdnZXIgPSBkZS0+cG9ydF9paXIgJiBCWFRfREVfUE9SVF9IT1RQTFVHX01B
U0s7CiAJCQkJaWYgKGRlLT5kZGkuaG90cGx1Z190cmlnZ2VyKQotCQkJCQlieHRfaHBkX2lycV9h
Y2soZGV2X3ByaXYsICZkZS0+ZGRpKTsKLQkJCX0gZWxzZSBpZiAoSVNfQlJPQURXRUxMKGRldl9w
cml2KSkgeworCQkJCQlieHRfaHBkX2lycV9hY2socmVncywgJmRlLT5kZGkpOworCQkJfSBlbHNl
IGlmIChJU19CUk9BRFdFTEwoaTkxNSkpIHsKIAkJCQlkZS0+ZGRpLmhvdHBsdWdfdHJpZ2dlciA9
IGRlLT5wb3J0X2lpciAmIEdFTjhfUE9SVF9EUF9BX0hPVFBMVUc7CiAJCQkJaWYgKGRlLT5kZGku
aG90cGx1Z190cmlnZ2VyKQotCQkJCQlpbGtfaHBkX2lycV9hY2soZGV2X3ByaXYsICZkZS0+ZGRp
KTsKKwkJCQkJaWxrX2hwZF9pcnFfYWNrKHJlZ3MsICZkZS0+ZGRpKTsKIAkJCX0KIAotCQkJSTkx
NV9XUklURShHRU44X0RFX1BPUlRfSUlSLCBkZS0+cG9ydF9paXIpOworCQkJcmF3X3JlZ193cml0
ZShyZWdzLCBHRU44X0RFX1BPUlRfSUlSLCBkZS0+cG9ydF9paXIpOwogCQl9CiAJfQogCi0JZm9y
X2VhY2hfcGlwZShkZXZfcHJpdiwgcGlwZSkgeworCWZvcl9lYWNoX3BpcGUoaTkxNSwgcGlwZSkg
ewogCQlpZiAoIShtYXN0ZXJfY3RsICYgR0VOOF9ERV9QSVBFX0lSUShwaXBlKSkpCiAJCQljb250
aW51ZTsKIAotCQlkZS0+cGlwZV9paXJbcGlwZV0gPSBJOTE1X1JFQUQoR0VOOF9ERV9QSVBFX0lJ
UihwaXBlKSk7CisJCWRlLT5waXBlX2lpcltwaXBlXSA9IHJhd19yZWdfcmVhZChyZWdzLCBHRU44
X0RFX1BJUEVfSUlSKHBpcGUpKTsKIAkJaWYgKGRlLT5waXBlX2lpcltwaXBlXSkKLQkJCUk5MTVf
V1JJVEUoR0VOOF9ERV9QSVBFX0lJUihwaXBlKSwgZGUtPnBpcGVfaWlyW3BpcGVdKTsKKwkJCXJh
d19yZWdfd3JpdGUocmVncywgR0VOOF9ERV9QSVBFX0lJUihwaXBlKSwgZGUtPnBpcGVfaWlyW3Bp
cGVdKTsKIAl9CiAKLQlpZiAoSEFTX1BDSF9TUExJVChkZXZfcHJpdikgJiYgIUhBU19QQ0hfTk9Q
KGRldl9wcml2KSAmJgorCWlmIChIQVNfUENIX1NQTElUKGk5MTUpICYmICFIQVNfUENIX05PUChp
OTE1KSAmJgogCSAgICBtYXN0ZXJfY3RsICYgR0VOOF9ERV9QQ0hfSVJRKSB7CiAJCS8qCiAJCSAq
IEZJWE1FKEJEVyk6IEFzc3VtZSBmb3Igbm93IHRoYXQgdGhlIG5ldyBpbnRlcnJ1cHQgaGFuZGxp
bmcKIAkJICogc2NoZW1lIGFsc28gY2xvc2VkIHRoZSBTREUgaW50ZXJydXB0IGhhbmRsaW5nIHJh
Y2Ugd2UndmUgc2VlbgogCQkgKiBvbiBvbGRlciBwY2gtc3BsaXQgcGxhdGZvcm1zLiBCdXQgdGhp
cyBuZWVkcyB0ZXN0aW5nLgogCQkgKi8KLQkJcGNoLT5paXIgPSBJOTE1X1JFQUQoU0RFSUlSKTsK
KwkJcGNoLT5paXIgPSByYXdfcmVnX3JlYWQocmVncywgU0RFSUlSKTsKIAkJaWYgKHBjaC0+aWly
KSB7Ci0JCQlpZiAoSU5URUxfUENIX1RZUEUoZGV2X3ByaXYpID49IFBDSF9JQ1ApCi0JCQkJaWNw
X2lycV9hY2soZGV2X3ByaXYsIHBjaCk7Ci0JCQllbHNlIGlmIChJTlRFTF9QQ0hfVFlQRShkZXZf
cHJpdikgPj0gUENIX1NQVCkKLQkJCQlzcHRfaXJxX2FjayhkZXZfcHJpdiwgcGNoKTsKKwkJCWlm
IChJTlRFTF9QQ0hfVFlQRShpOTE1KSA+PSBQQ0hfSUNQKQorCQkJCWljcF9pcnFfYWNrKHJlZ3Ms
IHBjaCk7CisJCQllbHNlIGlmIChJTlRFTF9QQ0hfVFlQRShpOTE1KSA+PSBQQ0hfU1BUKQorCQkJ
CXNwdF9pcnFfYWNrKHJlZ3MsIHBjaCk7CiAJCQllbHNlCi0JCQkJY3B0X2lycV9hY2soZGV2X3By
aXYsIHBjaCk7CisJCQkJY3B0X2lycV9hY2socmVncywgcGNoKTsKIAotCQkJSTkxNV9XUklURShT
REVJSVIsIHBjaC0+aWlyKTsKKwkJCXJhd19yZWdfd3JpdGUocmVncywgU0RFSUlSLCBwY2gtPmlp
cik7CiAJCX0KIAl9CiB9CkBAIC0zMjM1LDI0ICszMjQzLDI5IEBAIHN0YXRpYyBpcnFyZXR1cm5f
dCBnZW44X2lycV9oYW5kbGVyKGludCBpcnEsIHZvaWQgKmFyZykKIAlpZiAoIWludGVsX2lycXNf
ZW5hYmxlZChkZXZfcHJpdikpCiAJCXJldHVybiBJUlFfTk9ORTsKIAorCXNwaW5fbG9jaygmZGV2
X3ByaXYtPmlycV9sb2NrKTsKKwogCW1hc3Rlcl9jdGwgPSBnZW44X21hc3Rlcl9pbnRyX2Rpc2Fi
bGUocmVncyk7CiAJaWYgKCFtYXN0ZXJfY3RsKSB7CiAJCWdlbjhfbWFzdGVyX2ludHJfZW5hYmxl
KHJlZ3MpOworCQlzcGluX3VubG9jaygmZGV2X3ByaXYtPmlycV9sb2NrKTsKIAkJcmV0dXJuIElS
UV9OT05FOwogCX0KIAogCS8qIEZpbmQsIGNsZWFyLCB0aGVuIHByb2Nlc3MgZWFjaCBzb3VyY2Ug
b2YgaW50ZXJydXB0ICovCi0JZ2VuOF9ndF9pcnFfYWNrKGRldl9wcml2LCBtYXN0ZXJfY3RsLCBn
dF9paXIpOworCWdlbjhfZ3RfaXJxX2FjayhyZWdzLCBtYXN0ZXJfY3RsLCBndF9paXIpOwogCiAJ
LyogSVJRcyBhcmUgc3luY2VkIGR1cmluZyBydW50aW1lX3N1c3BlbmQsIHdlIGRvbid0IHJlcXVp
cmUgYSB3YWtlcmVmICovCiAJaWYgKG1hc3Rlcl9jdGwgJiB+R0VOOF9HVF9JUlFTKSB7CiAJCWRp
c2FibGVfcnBtX3dha2VyZWZfYXNzZXJ0cygmZGV2X3ByaXYtPnJ1bnRpbWVfcG0pOwotCQlnZW44
X2RlX2lycV9hY2soZGV2X3ByaXYsIG1hc3Rlcl9jdGwsICZkZSwgJnBjaCk7CisJCWdlbjhfZGVf
aXJxX2FjayhkZXZfcHJpdiwgcmVncywgbWFzdGVyX2N0bCwgJmRlLCAmcGNoKTsKIAkJZW5hYmxl
X3JwbV93YWtlcmVmX2Fzc2VydHMoJmRldl9wcml2LT5ydW50aW1lX3BtKTsKIAl9CiAKIAlnZW44
X21hc3Rlcl9pbnRyX2VuYWJsZShyZWdzKTsKIAorCXNwaW5fdW5sb2NrKCZkZXZfcHJpdi0+aXJx
X2xvY2spOworCiAJZ2VuOF9ndF9pcnFfaGFuZGxlcihkZXZfcHJpdiwgbWFzdGVyX2N0bCwgZ3Rf
aWlyKTsKIAogCWlmIChtYXN0ZXJfY3RsICYgfkdFTjhfR1RfSVJRUykgewpAQCAtMzM5MCw5ICsz
NDAzLDkgQEAgZ2VuMTFfZ3RfaXJxX2hhbmRsZXIoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKiBj
b25zdCBpOTE1LAogfQogCiBzdGF0aWMgdTMyCi1nZW4xMV9ndV9taXNjX2lycV9hY2soc3RydWN0
IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LCBjb25zdCB1MzIgbWFzdGVyX2N0bCkKK2dlbjEx
X2d1X21pc2NfaXJxX2Fjayh2b2lkIF9faW9tZW0gKiBjb25zdCByZWdzLAorCQkgICAgICB1MzIg
bWFzdGVyX2N0bCkKIHsKLQl2b2lkIF9faW9tZW0gKiBjb25zdCByZWdzID0gZGV2X3ByaXYtPnVu
Y29yZS5yZWdzOwogCXUzMiBpaXI7CiAKIAlpZiAoIShtYXN0ZXJfY3RsICYgR0VOMTFfR1VfTUlT
Q19JUlEpKQpAQCAtMzQ0Myw5ICszNDU2LDEyIEBAIHN0YXRpYyBpcnFyZXR1cm5fdCBnZW4xMV9p
cnFfaGFuZGxlcihpbnQgaXJxLCB2b2lkICphcmcpCiAJaWYgKCFpbnRlbF9pcnFzX2VuYWJsZWQo
aTkxNSkpCiAJCXJldHVybiBJUlFfTk9ORTsKIAorCXNwaW5fbG9jaygmaTkxNS0+aXJxX2xvY2sp
OworCiAJbWFzdGVyX2N0bCA9IGdlbjExX21hc3Rlcl9pbnRyX2Rpc2FibGUocmVncyk7CiAJaWYg
KCFtYXN0ZXJfY3RsKSB7CiAJCWdlbjExX21hc3Rlcl9pbnRyX2VuYWJsZShyZWdzKTsKKwkJc3Bp
bl91bmxvY2soJmk5MTUtPmlycV9sb2NrKTsKIAkJcmV0dXJuIElSUV9OT05FOwogCX0KIApAQCAt
MzQ2MSwxNCArMzQ3NywxNiBAQCBzdGF0aWMgaXJxcmV0dXJuX3QgZ2VuMTFfaXJxX2hhbmRsZXIo
aW50IGlycSwgdm9pZCAqYXJnKQogCQkgKiBHRU4xMV9ESVNQTEFZX0lOVF9DVEwgaGFzIHNhbWUg
Zm9ybWF0IGFzIEdFTjhfTUFTVEVSX0lSUQogCQkgKiBmb3IgdGhlIGRpc3BsYXkgcmVsYXRlZCBi
aXRzLgogCQkgKi8KLQkJZ2VuOF9kZV9pcnFfYWNrKGk5MTUsIGRpc3BfY3RsLCAmZGUsICZwY2gp
OworCQlnZW44X2RlX2lycV9hY2soaTkxNSwgcmVncywgZGlzcF9jdGwsICZkZSwgJnBjaCk7CiAJ
CWVuYWJsZV9ycG1fd2FrZXJlZl9hc3NlcnRzKCZpOTE1LT5ydW50aW1lX3BtKTsKIAl9CiAKLQln
dV9taXNjX2lpciA9IGdlbjExX2d1X21pc2NfaXJxX2FjayhpOTE1LCBtYXN0ZXJfY3RsKTsKKwln
dV9taXNjX2lpciA9IGdlbjExX2d1X21pc2NfaXJxX2FjayhyZWdzLCBtYXN0ZXJfY3RsKTsKIAog
CWdlbjExX21hc3Rlcl9pbnRyX2VuYWJsZShyZWdzKTsKIAorCXNwaW5fdW5sb2NrKCZpOTE1LT5p
cnFfbG9jayk7CisKIAlpZiAobWFzdGVyX2N0bCAmIEdFTjExX0RJU1BMQVlfSVJRKSB7CiAJCWRp
c2FibGVfcnBtX3dha2VyZWZfYXNzZXJ0cygmaTkxNS0+cnVudGltZV9wbSk7CiAJCS8qCi0tIAoy
LjIxLjAKCl9fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fCklu
dGVsLWdmeCBtYWlsaW5nIGxpc3QKSW50ZWwtZ2Z4QGxpc3RzLmZyZWVkZXNrdG9wLm9yZwpodHRw
czovL2xpc3RzLmZyZWVkZXNrdG9wLm9yZy9tYWlsbWFuL2xpc3RpbmZvL2ludGVsLWdmeA==

Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 6439510B1A6
	for <lists+intel-gfx@lfdr.de>; Wed, 27 Nov 2019 15:50:45 +0100 (CET)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 47A706E2D5;
	Wed, 27 Nov 2019 14:50:42 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from fireflyinternet.com (mail.fireflyinternet.com [109.228.58.192])
 by gabe.freedesktop.org (Postfix) with ESMTPS id AB27D6E2D5;
 Wed, 27 Nov 2019 14:50:40 +0000 (UTC)
X-Default-Received-SPF: pass (skip=forwardok (res=PASS))
 x-ip-name=78.156.65.138; 
Received: from haswell.alporthouse.com (unverified [78.156.65.138]) 
 by fireflyinternet.com (Firefly Internet (M1)) with ESMTP id 19361202-1500050 
 for multiple; Wed, 27 Nov 2019 14:50:32 +0000
From: Chris Wilson <chris@chris-wilson.co.uk>
To: intel-gfx@lists.freedesktop.org
Date: Wed, 27 Nov 2019 14:50:26 +0000
Message-Id: <20191127145026.3438876-1-chris@chris-wilson.co.uk>
X-Mailer: git-send-email 2.24.0
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH i-g-t] i915/gem_exec_balance: Check chain of
 submit dependencies
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Cc: igt-dev@lists.freedesktop.org
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

Q2hlY2sgdGhhdCB0aGUgc3VibWl0IGZlbmNlIGNvdXBsZXMgaW50byB0aGUgZGVwZW5kZW5jeSBj
aGFpbiBzbyB0aGF0CnRoZSBib25kZWQgcGFpciBjYW5ub3Qgb3ZlciB0YWtlIGFueSBvZiB0aGUg
ZWFybGllciByZXF1ZXN0cy4KClNpZ25lZC1vZmYtYnk6IENocmlzIFdpbHNvbiA8Y2hyaXNAY2hy
aXMtd2lsc29uLmNvLnVrPgpDYzogVHZydGtvIFVyc3VsaW4gPHR2cnRrby51cnN1bGluQGludGVs
LmNvbT4KLS0tCiB0ZXN0cy9pOTE1L2dlbV9leGVjX2JhbGFuY2VyLmMgfCA4OCArKysrKysrKysr
KysrKysrKysrKysrKysrKysrKysrKysrCiAxIGZpbGUgY2hhbmdlZCwgODggaW5zZXJ0aW9ucygr
KQoKZGlmZiAtLWdpdCBhL3Rlc3RzL2k5MTUvZ2VtX2V4ZWNfYmFsYW5jZXIuYyBiL3Rlc3RzL2k5
MTUvZ2VtX2V4ZWNfYmFsYW5jZXIuYwppbmRleCA4NjAyOGNmZGQuLmZmNWJkMDEzNCAxMDA2NDQK
LS0tIGEvdGVzdHMvaTkxNS9nZW1fZXhlY19iYWxhbmNlci5jCisrKyBiL3Rlc3RzL2k5MTUvZ2Vt
X2V4ZWNfYmFsYW5jZXIuYwpAQCAtODU1LDYgKzg1NSw5MSBAQCBzdGF0aWMgdm9pZCBib25kZWRf
c2xpY2UoaW50IGk5MTUpCiAJbXVubWFwKHN0b3AsIDQwOTYpOwogfQogCitzdGF0aWMgdm9pZCBi
b25kZWRfY2hhaW4oaW50IGk5MTUpCit7CisJc3RydWN0IGRybV9pOTE1X2dlbV9leGVjX29iamVj
dDIgYmF0Y2ggPSB7CisJCS5oYW5kbGUgPSBiYXRjaF9jcmVhdGUoaTkxNSksCisJfTsKKwl1aW50
MzJfdCBjdHg7CisKKwkvKgorCSAqIEdpdmVuIGJhdGNoZXMgQSwgQiBhbmQgQicsIHdoZXJlIEIg
YW5kIEInIGFyZSBhIGJvbmRlZCBwYWlyLCB3aXRoCisJICogQicgZGVwZW5kaW5nIG9uIEIgd2l0
aCBhIHN1Ym1pdCBmZW5jZSBhbmQgQiBkZXBlbmRpbmcgb24gQSBhcworCSAqIGFuIG9yZGluYXJ5
IGZlbmNlOyBwcm92ZSBCJyBjYW5ub3QgY29tcGxldGUgYmVmb3JlIEEuCisJICovCisKKwljdHgg
PSBnZW1fY29udGV4dF9jcmVhdGUoaTkxNSk7CisKKwlmb3IgKGludCBjbGFzcyA9IDA7IGNsYXNz
IDwgMzI7IGNsYXNzKyspIHsKKwkJc3RydWN0IGk5MTVfZW5naW5lX2NsYXNzX2luc3RhbmNlICpz
aWJsaW5nczsKKwkJc3RydWN0IGRybV9pOTE1X2dlbV9leGVjYnVmZmVyMiBleGVjYnVmID0gewor
CQkJLmJ1ZmZlcnNfcHRyID0gdG9fdXNlcl9wb2ludGVyKCZiYXRjaCksCisJCQkuYnVmZmVyX2Nv
dW50ID0gMSwKKwkJCS5yc3ZkMSA9IGN0eCwKKwkJfTsKKwkJdW5zaWduZWQgaW50IGNvdW50Owor
CQlpZ3Rfc3Bpbl90ICpzcGluOworCisJCXNpYmxpbmdzID0gbGlzdF9lbmdpbmVzKGk5MTUsIDF1
IDw8IGNsYXNzLCAmY291bnQpOworCQlpZiAoIXNpYmxpbmdzKQorCQkJY29udGludWU7CisKKwkJ
aWYgKGNvdW50IDwgMikgeworCQkJZnJlZShzaWJsaW5ncyk7CisJCQljb250aW51ZTsKKwkJfQor
CisJCS8qIEE6IHNwaW4gZm9yZXZlciBvbiBlbmdpbmUgMSAqLworCQlzZXRfbG9hZF9iYWxhbmNl
cihpOTE1LCBjdHgsIHNpYmxpbmdzLCBjb3VudCwgTlVMTCk7CisJCXNwaW4gPSBpZ3Rfc3Bpbl9u
ZXcoaTkxNSwKKwkJCQkgICAgLmN0eCA9IGN0eCwKKwkJCQkgICAgLmVuZ2luZSA9IDEsCisJCQkJ
ICAgIC5mbGFncyA9IChJR1RfU1BJTl9QT0xMX1JVTiB8CisJCQkJCSAgICAgIElHVF9TUElOX0ZF
TkNFX09VVCkpOworCQlpZ3Rfc3Bpbl9idXN5d2FpdF91bnRpbF9zdGFydGVkKHNwaW4pOworCisJ
CS8qIEI6IHdhaXRzIGZvciBBIG9uIGVuZ2luZSAyICovCisJCXNldF9sb2FkX2JhbGFuY2VyKGk5
MTUsIGN0eCwgc2libGluZ3MsIGNvdW50LCBOVUxMKTsKKwkJZXhlY2J1Zi5yc3ZkMiA9IHNwaW4t
Pm91dF9mZW5jZTsKKwkJZXhlY2J1Zi5mbGFncyA9IEk5MTVfRVhFQ19GRU5DRV9JTiB8IEk5MTVf
RVhFQ19GRU5DRV9PVVQ7CisJCWV4ZWNidWYuZmxhZ3MgfD0gMjsgLyogb3Bwb3NpdGUgZW5naW5l
IHRvIHNwaW5uZXIgKi8KKwkJZ2VtX2V4ZWNidWZfd3IoaTkxNSwgJmV4ZWNidWYpOworCisJCS8q
IEInOiBydW4gaW4gcGFyYWxsZWwgd2l0aCBCIG9uIGVuZ2luZSAxLCBpLmUuIG5vdCBiZWZvcmUg
QSEgKi8KKwkJc2V0X2xvYWRfYmFsYW5jZXIoaTkxNSwgY3R4LCBzaWJsaW5ncywgY291bnQsIE5V
TEwpOworCQlleGVjYnVmLmZsYWdzID0gSTkxNV9FWEVDX0ZFTkNFX1NVQk1JVCB8IEk5MTVfRVhF
Q19GRU5DRV9PVVQ7CisJCWV4ZWNidWYuZmxhZ3MgfD0gMTsgLyogc2FtZSBlbmdpbmUgYXMgc3Bp
bm5lciAqLworCQlleGVjYnVmLnJzdmQyID4+PSAzMjsKKwkJZ2VtX2V4ZWNidWZfd3IoaTkxNSwg
JmV4ZWNidWYpOworCisJCS8qIFdhaXQgZm9yIGFueSBtYWdpYyB0aW1lc2xpY2luZyBvciBwcmVl
bXB0aW9ucy4uLiAqLworCQlpZ3RfYXNzZXJ0X2VxKHN5bmNfZmVuY2Vfd2FpdChleGVjYnVmLnJz
dmQyID4+IDMyLCAxMDAwKSwKKwkJCSAgICAgIC1FVElNRSk7CisKKwkJaWd0X2RlYnVnZnNfZHVt
cChpOTE1LCAiaTkxNV9lbmdpbmVfaW5mbyIpOworCisJCS8qCisJCSAqIC4uLiB3aGljaCBzaG91
bGQgbm90IGhhdmUgaGFwcGVuZWQsIHNvIGV2ZXJ5dGhpbmcgaXMgc3RpbGwKKwkJICogd2FpdGlu
ZyBvbiB0aGUgc3Bpbm5lcgorCQkgKi8KKwkJaWd0X2Fzc2VydF9lcShzeW5jX2ZlbmNlX3N0YXR1
cyhzcGluLT5vdXRfZmVuY2UpLCAwKTsKKwkJaWd0X2Fzc2VydF9lcShzeW5jX2ZlbmNlX3N0YXR1
cyhleGVjYnVmLnJzdmQyICYgMHhmZmZmZmZmZiksIDApOworCQlpZ3RfYXNzZXJ0X2VxKHN5bmNf
ZmVuY2Vfc3RhdHVzKGV4ZWNidWYucnN2ZDIgPj4gMzIpLCAwKTsKKworCQlpZ3Rfc3Bpbl9mcmVl
KGk5MTUsIHNwaW4pOworCQlnZW1fc3luYyhpOTE1LCBiYXRjaC5oYW5kbGUpOworCisJCWlndF9h
c3NlcnRfZXEoc3luY19mZW5jZV9zdGF0dXMoZXhlY2J1Zi5yc3ZkMiAmIDB4ZmZmZmZmZmYpLCAx
KTsKKwkJaWd0X2Fzc2VydF9lcShzeW5jX2ZlbmNlX3N0YXR1cyhleGVjYnVmLnJzdmQyID4+IDMy
KSwgMSk7CisKKwkJY2xvc2UoZXhlY2J1Zi5yc3ZkMik7CisJCWNsb3NlKGV4ZWNidWYucnN2ZDIg
Pj4gMzIpOworCX0KKworCWdlbV9jb250ZXh0X2Rlc3Ryb3koaTkxNSwgY3R4KTsKKwlnZW1fY2xv
c2UoaTkxNSwgYmF0Y2guaGFuZGxlKTsKK30KKwogc3RhdGljIHZvaWQgaW5kaWNlcyhpbnQgaTkx
NSkKIHsKIAlJOTE1X0RFRklORV9DT05URVhUX1BBUkFNX0VOR0lORVMoZW5naW5lcywgSTkxNV9F
WEVDX1JJTkdfTUFTSyArIDEpOwpAQCAtMTU4MCw2ICsxNjY1LDkgQEAgaWd0X21haW4KIAlpZ3Rf
c3VidGVzdCgiYm9uZGVkLXNsaWNlIikKIAkJYm9uZGVkX3NsaWNlKGk5MTUpOwogCisJaWd0X3N1
YnRlc3QoImJvbmRlZC1jaGFpbiIpCisJCWJvbmRlZF9jaGFpbihpOTE1KTsKKwogCWlndF9maXh0
dXJlIHsKIAkJaWd0X3N0b3BfaGFuZ19kZXRlY3RvcigpOwogCX0KLS0gCjIuMjQuMAoKX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX18KSW50ZWwtZ2Z4IG1haWxp
bmcgbGlzdApJbnRlbC1nZnhAbGlzdHMuZnJlZWRlc2t0b3Aub3JnCmh0dHBzOi8vbGlzdHMuZnJl
ZWRlc2t0b3Aub3JnL21haWxtYW4vbGlzdGluZm8vaW50ZWwtZ2Z4

Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 86762C8722
	for <lists+intel-gfx@lfdr.de>; Wed,  2 Oct 2019 13:22:02 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 6E30B6E93D;
	Wed,  2 Oct 2019 11:22:00 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from fireflyinternet.com (mail.fireflyinternet.com [109.228.58.192])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 542B56E93C
 for <intel-gfx@lists.freedesktop.org>; Wed,  2 Oct 2019 11:21:59 +0000 (UTC)
X-Default-Received-SPF: pass (skip=forwardok (res=PASS))
 x-ip-name=78.156.65.138; 
Received: from haswell.alporthouse.com (unverified [78.156.65.138]) 
 by fireflyinternet.com (Firefly Internet (M1)) with ESMTP id 18692029-1500050 
 for multiple; Wed, 02 Oct 2019 12:20:08 +0100
From: Chris Wilson <chris@chris-wilson.co.uk>
To: intel-gfx@lists.freedesktop.org
Date: Wed,  2 Oct 2019 12:19:44 +0100
Message-Id: <20191002112000.12280-14-chris@chris-wilson.co.uk>
X-Mailer: git-send-email 2.23.0
In-Reply-To: <20191002112000.12280-1-chris@chris-wilson.co.uk>
References: <20191002112000.12280-1-chris@chris-wilson.co.uk>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH 14/30] drm/i915: Move request runtime management
 onto gt
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

UmVxdWVzdHMgYXJlIHJ1biBmcm9tIHRoZSBndCBhbmQgYXJlIHRpZGVkIGludG8gdGhlIGd0IHJ1
bnRpbWUgcG93ZXIKbWFuYWdlbWVudCwgc28gcHVsbCB0aGUgcnVudGltZSByZXF1ZXN0IG1hbmFn
ZW1lbnQgdW5kZXIgZ3QvCgpTaWduZWQtb2ZmLWJ5OiBDaHJpcyBXaWxzb24gPGNocmlzQGNocmlz
LXdpbHNvbi5jby51az4KLS0tCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9NYWtlZmlsZSAgICAgICAg
ICAgICAgICAgfCAgIDEgKwogZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX21tYW4u
YyAgICAgIHwgICA0ICstCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fcG0uYyAg
ICAgICAgfCAgMjggKy0tLQogLi4uL2RybS9pOTE1L2dlbS9zZWxmdGVzdHMvaTkxNV9nZW1fY29u
dGV4dC5jIHwgICA1ICstCiAuLi4vZHJtL2k5MTUvZ2VtL3NlbGZ0ZXN0cy9pOTE1X2dlbV9tbWFu
LmMgICAgfCAgIDIgKy0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2d0LmMgICAgICAg
ICAgICB8ICAgMiArCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9ndF9wbS5jICAgICAg
ICAgfCAgIDUgKy0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2d0X3JlcXVlc3RzLmMg
ICB8IDEyMyArKysrKysrKysrKysrKysrKysKIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVs
X2d0X3JlcXVlc3RzLmggICB8ICAyNCArKysrCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRl
bF9ndF90eXBlcy5oICAgICAgfCAgMTEgKysKIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L3NlbGZ0
ZXN0X3RpbWVsaW5lLmMgICB8ICAgOCArLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9kZWJ1
Z2ZzLmMgICAgICAgICAgIHwgIDE3ICstLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9kcnYu
aCAgICAgICAgICAgICAgIHwgIDEwIC0tCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2dlbS5j
ICAgICAgICAgICAgICAgfCAgMTcgLS0tCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2dlbV9l
dmljdC5jICAgICAgICAgfCAgMTQgKy0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZ2VtX2d0
dC5jICAgICAgICAgICB8ICAgNSArLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9yZXF1ZXN0
LmMgICAgICAgICAgIHwgIDY0ICstLS0tLS0tLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9y
ZXF1ZXN0LmggICAgICAgICAgIHwgICA3ICstCiAuLi4vZ3B1L2RybS9pOTE1L3NlbGZ0ZXN0cy9p
Z3RfZmx1c2hfdGVzdC5jICAgfCAgIDkgKy0KIC4uLi9ncHUvZHJtL2k5MTUvc2VsZnRlc3RzL2ln
dF9saXZlX3Rlc3QuYyAgICB8ICAgNSArLQogLi4uL2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMvbW9j
a19nZW1fZGV2aWNlLmMgIHwgIDEwICstCiAyMSBmaWxlcyBjaGFuZ2VkLCAyMTMgaW5zZXJ0aW9u
cygrKSwgMTU4IGRlbGV0aW9ucygtKQogY3JlYXRlIG1vZGUgMTAwNjQ0IGRyaXZlcnMvZ3B1L2Ry
bS9pOTE1L2d0L2ludGVsX2d0X3JlcXVlc3RzLmMKIGNyZWF0ZSBtb2RlIDEwMDY0NCBkcml2ZXJz
L2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9ndF9yZXF1ZXN0cy5oCgpkaWZmIC0tZ2l0IGEvZHJpdmVy
cy9ncHUvZHJtL2k5MTUvTWFrZWZpbGUgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9NYWtlZmlsZQpp
bmRleCBkMmI1M2I1YWRkODEuLjA2ZTE4NzZkMDI1MCAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUv
ZHJtL2k5MTUvTWFrZWZpbGUKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvTWFrZWZpbGUKQEAg
LTgzLDYgKzgzLDcgQEAgZ3QteSArPSBcCiAJZ3QvaW50ZWxfZ3RfaXJxLm8gXAogCWd0L2ludGVs
X2d0X3BtLm8gXAogCWd0L2ludGVsX2d0X3BtX2lycS5vIFwKKwlndC9pbnRlbF9ndF9yZXF1ZXN0
cy5vIFwKIAlndC9pbnRlbF9oYW5nY2hlY2subyBcCiAJZ3QvaW50ZWxfbHJjLm8gXAogCWd0L2lu
dGVsX3JjNi5vIFwKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dl
bV9tbWFuLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fbW1hbi5jCmluZGV4
IDQ1YmJkMjJjMTRmMS4uZmQ0MTIyZDhjMGE5IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0v
aTkxNS9nZW0vaTkxNV9nZW1fbW1hbi5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9p
OTE1X2dlbV9tbWFuLmMKQEAgLTgsNiArOCw3IEBACiAjaW5jbHVkZSA8bGludXgvc2l6ZXMuaD4K
IAogI2luY2x1ZGUgImd0L2ludGVsX2d0LmgiCisjaW5jbHVkZSAiZ3QvaW50ZWxfZ3RfcmVxdWVz
dHMuaCIKIAogI2luY2x1ZGUgImk5MTVfZHJ2LmgiCiAjaW5jbHVkZSAiaTkxNV9nZW1fZ3R0Lmgi
CkBAIC00MjQsNiArNDI1LDcgQEAgdm9pZCBpOTE1X2dlbV9vYmplY3RfcmVsZWFzZV9tbWFwKHN0
cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmopCiBzdGF0aWMgaW50IGNyZWF0ZV9tbWFwX29m
ZnNldChzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2JqKQogewogCXN0cnVjdCBkcm1faTkx
NV9wcml2YXRlICppOTE1ID0gdG9faTkxNShvYmotPmJhc2UuZGV2KTsKKwlzdHJ1Y3QgaW50ZWxf
Z3QgKmd0ID0gJmk5MTUtPmd0OwogCWludCBlcnI7CiAKIAllcnIgPSBkcm1fZ2VtX2NyZWF0ZV9t
bWFwX29mZnNldCgmb2JqLT5iYXNlKTsKQEAgLTQzMSw3ICs0MzMsNyBAQCBzdGF0aWMgaW50IGNy
ZWF0ZV9tbWFwX29mZnNldChzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2JqKQogCQlyZXR1
cm4gMDsKIAogCS8qIEF0dGVtcHQgdG8gcmVhcCBzb21lIG1tYXAgc3BhY2UgZnJvbSBkZWFkIG9i
amVjdHMgKi8KLQllcnIgPSBpOTE1X3JldGlyZV9yZXF1ZXN0c190aW1lb3V0KGk5MTUsIE1BWF9T
Q0hFRFVMRV9USU1FT1VUKTsKKwllcnIgPSBpbnRlbF9ndF9yZXRpcmVfcmVxdWVzdHNfdGltZW91
dChndCwgTUFYX1NDSEVEVUxFX1RJTUVPVVQpOwogCWlmIChlcnIpCiAJCXJldHVybiBlcnI7CiAK
ZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9wbS5jIGIvZHJp
dmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX3BtLmMKaW5kZXggOTBiMjExMjU3ZjJkLi45
MTk0ZDg0NjRiZjcgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dl
bV9wbS5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9wbS5jCkBAIC03
LDMxICs3LDE4IEBACiAjaW5jbHVkZSAiZ2VtL2k5MTVfZ2VtX3BtLmgiCiAjaW5jbHVkZSAiZ3Qv
aW50ZWxfZ3QuaCIKICNpbmNsdWRlICJndC9pbnRlbF9ndF9wbS5oIgorI2luY2x1ZGUgImd0L2lu
dGVsX2d0X3JlcXVlc3RzLmgiCiAKICNpbmNsdWRlICJpOTE1X2Rydi5oIgogI2luY2x1ZGUgImk5
MTVfZ2xvYmFscy5oIgogCiBzdGF0aWMgdm9pZCBpOTE1X2dlbV9wYXJrKHN0cnVjdCBkcm1faTkx
NV9wcml2YXRlICppOTE1KQogewotCWNhbmNlbF9kZWxheWVkX3dvcmsoJmk5MTUtPmdlbS5yZXRp
cmVfd29yayk7Ci0KIAlpOTE1X3ZtYV9wYXJrZWQoaTkxNSk7CiAKIAlpOTE1X2dsb2JhbHNfcGFy
aygpOwogfQogCi1zdGF0aWMgdm9pZCByZXRpcmVfd29ya19oYW5kbGVyKHN0cnVjdCB3b3JrX3N0
cnVjdCAqd29yaykKLXsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9Ci0JCWNvbnRh
aW5lcl9vZih3b3JrLCB0eXBlb2YoKmk5MTUpLCBnZW0ucmV0aXJlX3dvcmsud29yayk7Ci0KLQlp
OTE1X3JldGlyZV9yZXF1ZXN0cyhpOTE1KTsKLQotCXF1ZXVlX2RlbGF5ZWRfd29yayhpOTE1LT53
cSwKLQkJCSAgICZpOTE1LT5nZW0ucmV0aXJlX3dvcmssCi0JCQkgICByb3VuZF9qaWZmaWVzX3Vw
X3JlbGF0aXZlKEhaKSk7Ci19Ci0KIHN0YXRpYyBpbnQgcG1fbm90aWZpZXIoc3RydWN0IG5vdGlm
aWVyX2Jsb2NrICpuYiwKIAkJICAgICAgIHVuc2lnbmVkIGxvbmcgYWN0aW9uLAogCQkgICAgICAg
dm9pZCAqZGF0YSkKQEAgLTQyLDkgKzI5LDYgQEAgc3RhdGljIGludCBwbV9ub3RpZmllcihzdHJ1
Y3Qgbm90aWZpZXJfYmxvY2sgKm5iLAogCXN3aXRjaCAoYWN0aW9uKSB7CiAJY2FzZSBJTlRFTF9H
VF9VTlBBUks6CiAJCWk5MTVfZ2xvYmFsc191bnBhcmsoKTsKLQkJcXVldWVfZGVsYXllZF93b3Jr
KGk5MTUtPndxLAotCQkJCSAgICZpOTE1LT5nZW0ucmV0aXJlX3dvcmssCi0JCQkJICAgcm91bmRf
amlmZmllc191cF9yZWxhdGl2ZShIWikpOwogCQlicmVhazsKIAogCWNhc2UgSU5URUxfR1RfUEFS
SzoKQEAgLTU5LDcgKzQzLDcgQEAgc3RhdGljIGJvb2wgc3dpdGNoX3RvX2tlcm5lbF9jb250ZXh0
X3N5bmMoc3RydWN0IGludGVsX2d0ICpndCkKIHsKIAlib29sIHJlc3VsdCA9ICFpbnRlbF9ndF9p
c193ZWRnZWQoZ3QpOwogCi0JaWYgKGk5MTVfZ2VtX3dhaXRfZm9yX2lkbGUoZ3QtPmk5MTUsIEk5
MTVfR0VNX0lETEVfVElNRU9VVCkgPT0gLUVUSU1FKSB7CisJaWYgKGludGVsX2d0X3dhaXRfZm9y
X2lkbGUoZ3QsIEk5MTVfR0VNX0lETEVfVElNRU9VVCkgPT0gLUVUSU1FKSB7CiAJCS8qIFhYWCBo
aWRlIHdhcm5pbmcgZnJvbSBnZW1fZWlvICovCiAJCWlmIChpOTE1X21vZHBhcmFtcy5yZXNldCkg
ewogCQkJZGV2X2VycihndC0+aTkxNS0+ZHJtLmRldiwKQEAgLTEyMiwxNCArMTA2LDEyIEBAIHZv
aWQgaTkxNV9nZW1fc3VzcGVuZChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkKIAkgKiBz
dGF0ZS4gRm9ydHVuYXRlbHksIHRoZSBrZXJuZWxfY29udGV4dCBpcyBkaXNwb3NhYmxlIGFuZCB3
ZSBkbwogCSAqIG5vdCByZWx5IG9uIGl0cyBzdGF0ZS4KIAkgKi8KLQlzd2l0Y2hfdG9fa2VybmVs
X2NvbnRleHRfc3luYygmaTkxNS0+Z3QpOworCWludGVsX2d0X3N1c3BlbmQoJmk5MTUtPmd0KTsK
KwlpbnRlbF91Y19zdXNwZW5kKCZpOTE1LT5ndC51Yyk7CiAKIAljYW5jZWxfZGVsYXllZF93b3Jr
X3N5bmMoJmk5MTUtPmd0LmhhbmdjaGVjay53b3JrKTsKIAogCWk5MTVfZ2VtX2RyYWluX2ZyZWVk
X29iamVjdHMoaTkxNSk7Ci0KLQlpbnRlbF91Y19zdXNwZW5kKCZpOTE1LT5ndC51Yyk7Ci0JaW50
ZWxfZ3Rfc3VzcGVuZCgmaTkxNS0+Z3QpOwogfQogCiBzdGF0aWMgc3RydWN0IGRybV9pOTE1X2dl
bV9vYmplY3QgKmZpcnN0X21tX29iamVjdChzdHJ1Y3QgbGlzdF9oZWFkICpsaXN0KQpAQCAtMjM5
LDggKzIyMSw2IEBAIHZvaWQgaTkxNV9nZW1fcmVzdW1lKHN0cnVjdCBkcm1faTkxNV9wcml2YXRl
ICppOTE1KQogCiB2b2lkIGk5MTVfZ2VtX2luaXRfX3BtKHN0cnVjdCBkcm1faTkxNV9wcml2YXRl
ICppOTE1KQogewotCUlOSVRfREVMQVlFRF9XT1JLKCZpOTE1LT5nZW0ucmV0aXJlX3dvcmssIHJl
dGlyZV93b3JrX2hhbmRsZXIpOwotCiAJaTkxNS0+Z2VtLnBtX25vdGlmaWVyLm5vdGlmaWVyX2Nh
bGwgPSBwbV9ub3RpZmllcjsKIAlibG9ja2luZ19ub3RpZmllcl9jaGFpbl9yZWdpc3RlcigmaTkx
NS0+Z3QucG1fbm90aWZpY2F0aW9ucywKIAkJCQkJICZpOTE1LT5nZW0ucG1fbm90aWZpZXIpOwpk
aWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL3NlbGZ0ZXN0cy9pOTE1X2dlbV9j
b250ZXh0LmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vc2VsZnRlc3RzL2k5MTVfZ2VtX2Nv
bnRleHQuYwppbmRleCBmOTAyYWVlZTE3NTUuLjIyODg3NTc4MDhhZSAxMDA2NDQKLS0tIGEvZHJp
dmVycy9ncHUvZHJtL2k5MTUvZ2VtL3NlbGZ0ZXN0cy9pOTE1X2dlbV9jb250ZXh0LmMKKysrIGIv
ZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL3NlbGZ0ZXN0cy9pOTE1X2dlbV9jb250ZXh0LmMKQEAg
LTgsNiArOCw3IEBACiAKICNpbmNsdWRlICJnZW0vaTkxNV9nZW1fcG0uaCIKICNpbmNsdWRlICJn
dC9pbnRlbF9ndC5oIgorI2luY2x1ZGUgImd0L2ludGVsX2d0X3JlcXVlc3RzLmgiCiAjaW5jbHVk
ZSAiZ3QvaW50ZWxfcmVzZXQuaCIKICNpbmNsdWRlICJpOTE1X3NlbGZ0ZXN0LmgiCiAKQEAgLTUx
OCw3ICs1MTksNyBAQCBjcmVhdGVfdGVzdF9vYmplY3Qoc3RydWN0IGk5MTVfYWRkcmVzc19zcGFj
ZSAqdm0sCiAJaW50IGVycjsKIAogCS8qIEtlZXAgaW4gR0VNJ3MgZ29vZCBncmFjZXMgKi8KLQlp
OTE1X3JldGlyZV9yZXF1ZXN0cyh2bS0+aTkxNSk7CisJaW50ZWxfZ3RfcmV0aXJlX3JlcXVlc3Rz
KHZtLT5ndCk7CiAKIAlzaXplID0gbWluKHZtLT50b3RhbCAvIDIsIDEwMjR1bGwgKiBEV19QRVJf
UEFHRSAqIFBBR0VfU0laRSk7CiAJc2l6ZSA9IHJvdW5kX2Rvd24oc2l6ZSwgRFdfUEVSX1BBR0Ug
KiBQQUdFX1NJWkUpOwpAQCAtMTEzNiw3ICsxMTM3LDcgQEAgX19zc2V1X2ZpbmlzaChjb25zdCBj
aGFyICpuYW1lLAogCQlpZ3Rfc3Bpbm5lcl9lbmQoc3Bpbik7CiAKIAlpZiAoKGZsYWdzICYgVEVT
VF9JRExFKSAmJiByZXQgPT0gMCkgewotCQlyZXQgPSBpOTE1X2dlbV93YWl0X2Zvcl9pZGxlKGNl
LT5lbmdpbmUtPmk5MTUsCisJCXJldCA9IGludGVsX2d0X3dhaXRfZm9yX2lkbGUoY2UtPmVuZ2lu
ZS0+Z3QsCiAJCQkJCSAgICAgTUFYX1NDSEVEVUxFX1RJTUVPVVQpOwogCQlpZiAocmV0KQogCQkJ
cmV0dXJuIHJldDsKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9zZWxmdGVz
dHMvaTkxNV9nZW1fbW1hbi5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL3NlbGZ0ZXN0cy9p
OTE1X2dlbV9tbWFuLmMKaW5kZXggNGJhNmVkNWM4MzEzLi4xY2QyNWNmZDAyNDYgMTAwNjQ0Ci0t
LSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9zZWxmdGVzdHMvaTkxNV9nZW1fbW1hbi5jCisr
KyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9zZWxmdGVzdHMvaTkxNV9nZW1fbW1hbi5jCkBA
IC01NzMsNyArNTczLDcgQEAgc3RhdGljIHZvaWQgZGlzYWJsZV9yZXRpcmVfd29ya2VyKHN0cnVj
dCBkcm1faTkxNV9wcml2YXRlICppOTE1KQogewogCWk5MTVfZ2VtX2RyaXZlcl91bnJlZ2lzdGVy
X19zaHJpbmtlcihpOTE1KTsKIAlpbnRlbF9ndF9wbV9nZXQoJmk5MTUtPmd0KTsKLQljYW5jZWxf
ZGVsYXllZF93b3JrX3N5bmMoJmk5MTUtPmdlbS5yZXRpcmVfd29yayk7CisJY2FuY2VsX2RlbGF5
ZWRfd29ya19zeW5jKCZpOTE1LT5ndC5yZXF1ZXN0cy5yZXRpcmVfd29yayk7CiB9CiAKIHN0YXRp
YyB2b2lkIHJlc3RvcmVfcmV0aXJlX3dvcmtlcihzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkx
NSkKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2d0LmMgYi9kcml2
ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9ndC5jCmluZGV4IDcyMDU1OTUzNjliZS4uNTMyMjA3
NDFlNDllIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9ndC5jCisr
KyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2d0LmMKQEAgLTYsNiArNiw3IEBACiAj
aW5jbHVkZSAiaTkxNV9kcnYuaCIKICNpbmNsdWRlICJpbnRlbF9ndC5oIgogI2luY2x1ZGUgImlu
dGVsX2d0X3BtLmgiCisjaW5jbHVkZSAiaW50ZWxfZ3RfcmVxdWVzdHMuaCIKICNpbmNsdWRlICJp
bnRlbF9tb2NzLmgiCiAjaW5jbHVkZSAiaW50ZWxfcmM2LmgiCiAjaW5jbHVkZSAiaW50ZWxfdW5j
b3JlLmgiCkBAIC0yMyw2ICsyNCw3IEBAIHZvaWQgaW50ZWxfZ3RfaW5pdF9lYXJseShzdHJ1Y3Qg
aW50ZWxfZ3QgKmd0LCBzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkKIAogCWludGVsX2d0
X2luaXRfaGFuZ2NoZWNrKGd0KTsKIAlpbnRlbF9ndF9pbml0X3Jlc2V0KGd0KTsKKwlpbnRlbF9n
dF9pbml0X3JlcXVlc3RzKGd0KTsKIAlpbnRlbF9ndF9wbV9pbml0X2Vhcmx5KGd0KTsKIAlpbnRl
bF91Y19pbml0X2Vhcmx5KCZndC0+dWMpOwogfQpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJt
L2k5MTUvZ3QvaW50ZWxfZ3RfcG0uYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2d0
X3BtLmMKaW5kZXggYmRiMzRmMDNlYzQ3Li5kMmU4MGJhNjRkNjkgMTAwNjQ0Ci0tLSBhL2RyaXZl
cnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2d0X3BtLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5
MTUvZ3QvaW50ZWxfZ3RfcG0uYwpAQCAtMTAsNiArMTAsNyBAQAogI2luY2x1ZGUgImludGVsX2Vu
Z2luZV9wbS5oIgogI2luY2x1ZGUgImludGVsX2d0LmgiCiAjaW5jbHVkZSAiaW50ZWxfZ3RfcG0u
aCIKKyNpbmNsdWRlICJpbnRlbF9ndF9yZXF1ZXN0cy5oIgogI2luY2x1ZGUgImludGVsX3BtLmgi
CiAjaW5jbHVkZSAiaW50ZWxfcmM2LmgiCiAjaW5jbHVkZSAiaW50ZWxfd2FrZXJlZi5oIgpAQCAt
NDksNiArNTAsNyBAQCBzdGF0aWMgaW50IF9fZ3RfdW5wYXJrKHN0cnVjdCBpbnRlbF93YWtlcmVm
ICp3ZikKIAlpOTE1X3BtdV9ndF91bnBhcmtlZChpOTE1KTsKIAogCWludGVsX2d0X3F1ZXVlX2hh
bmdjaGVjayhndCk7CisJaW50ZWxfZ3RfdW5wYXJrX3JlcXVlc3RzKGd0KTsKIAogCXBtX25vdGlm
eShndCwgSU5URUxfR1RfVU5QQVJLKTsKIApAQCAtNjQsNiArNjYsNyBAQCBzdGF0aWMgaW50IF9f
Z3RfcGFyayhzdHJ1Y3QgaW50ZWxfd2FrZXJlZiAqd2YpCiAJR0VNX1RSQUNFKCJcbiIpOwogCiAJ
cG1fbm90aWZ5KGd0LCBJTlRFTF9HVF9QQVJLKTsKKwlpbnRlbF9ndF9wYXJrX3JlcXVlc3RzKGd0
KTsKIAogCWk5MTVfcG11X2d0X3BhcmtlZChpOTE1KTsKIAlpZiAoSU5URUxfR0VOKGk5MTUpID49
IDYpCkBAIC0xOTYsNyArMTk5LDcgQEAgaW50IGludGVsX2d0X3Jlc3VtZShzdHJ1Y3QgaW50ZWxf
Z3QgKmd0KQogCiBzdGF0aWMgdm9pZCB3YWl0X2Zvcl9pZGxlKHN0cnVjdCBpbnRlbF9ndCAqZ3Qp
CiB7Ci0JaWYgKGk5MTVfZ2VtX3dhaXRfZm9yX2lkbGUoZ3QtPmk5MTUsIEk5MTVfR0VNX0lETEVf
VElNRU9VVCkgPT0gLUVUSU1FKSB7CisJaWYgKGludGVsX2d0X3dhaXRfZm9yX2lkbGUoZ3QsIEk5
MTVfR0VNX0lETEVfVElNRU9VVCkgPT0gLUVUSU1FKSB7CiAJCS8qCiAJCSAqIEZvcmNpYmx5IGNh
bmNlbCBvdXRzdGFuZGluZyB3b3JrIGFuZCBsZWF2ZQogCQkgKiB0aGUgZ3B1IHF1aWV0LgpkaWZm
IC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfZ3RfcmVxdWVzdHMuYyBiL2Ry
aXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2d0X3JlcXVlc3RzLmMKbmV3IGZpbGUgbW9kZSAx
MDA2NDQKaW5kZXggMDAwMDAwMDAwMDAwLi44YWVkODlmZDJjZGMKLS0tIC9kZXYvbnVsbAorKysg
Yi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9ndF9yZXF1ZXN0cy5jCkBAIC0wLDAgKzEs
MTIzIEBACisvKgorICogU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IE1JVAorICoKKyAqIENvcHly
aWdodCDCqSAyMDE5IEludGVsIENvcnBvcmF0aW9uCisgKi8KKworI2luY2x1ZGUgImk5MTVfcmVx
dWVzdC5oIgorI2luY2x1ZGUgImludGVsX2d0LmgiCisjaW5jbHVkZSAiaW50ZWxfZ3RfcG0uaCIK
KyNpbmNsdWRlICJpbnRlbF9ndF9yZXF1ZXN0cy5oIgorI2luY2x1ZGUgImludGVsX3RpbWVsaW5l
LmgiCisKK3N0YXRpYyB2b2lkIHJldGlyZV9yZXF1ZXN0cyhzdHJ1Y3QgaW50ZWxfdGltZWxpbmUg
KnRsKQoreworCXN0cnVjdCBpOTE1X3JlcXVlc3QgKnJxLCAqcm47CisKKwlsaXN0X2Zvcl9lYWNo
X2VudHJ5X3NhZmUocnEsIHJuLCAmdGwtPnJlcXVlc3RzLCBsaW5rKQorCQlpZiAoIWk5MTVfcmVx
dWVzdF9yZXRpcmUocnEpKQorCQkJYnJlYWs7Cit9CisKK2xvbmcgaW50ZWxfZ3RfcmV0aXJlX3Jl
cXVlc3RzX3RpbWVvdXQoc3RydWN0IGludGVsX2d0ICpndCwgbG9uZyB0aW1lb3V0KQoreworCXN0
cnVjdCBpbnRlbF9ndF90aW1lbGluZXMgKnRpbWVsaW5lcyA9ICZndC0+dGltZWxpbmVzOworCXN0
cnVjdCBpbnRlbF90aW1lbGluZSAqdGwsICp0bjsKKwl1bnNpZ25lZCBsb25nIGFjdGl2ZV9jb3Vu
dCA9IDA7CisJdW5zaWduZWQgbG9uZyBmbGFnczsKKwlib29sIGludGVycnVwdGlibGU7CisJTElT
VF9IRUFEKGZyZWUpOworCisJaW50ZXJydXB0aWJsZSA9IHRydWU7CisJaWYgKHVubGlrZWx5KHRp
bWVvdXQgPCAwKSkKKwkJdGltZW91dCA9IC10aW1lb3V0LCBpbnRlcnJ1cHRpYmxlID0gZmFsc2U7
CisKKwlzcGluX2xvY2tfaXJxc2F2ZSgmdGltZWxpbmVzLT5sb2NrLCBmbGFncyk7CisJbGlzdF9m
b3JfZWFjaF9lbnRyeV9zYWZlKHRsLCB0biwgJnRpbWVsaW5lcy0+YWN0aXZlX2xpc3QsIGxpbmsp
IHsKKwkJaWYgKCFtdXRleF90cnlsb2NrKCZ0bC0+bXV0ZXgpKQorCQkJY29udGludWU7CisKKwkJ
aW50ZWxfdGltZWxpbmVfZ2V0KHRsKTsKKwkJR0VNX0JVR19PTighdGwtPmFjdGl2ZV9jb3VudCk7
CisJCXRsLT5hY3RpdmVfY291bnQrKzsgLyogcGluIHRoZSBsaXN0IGVsZW1lbnQgKi8KKwkJc3Bp
bl91bmxvY2tfaXJxcmVzdG9yZSgmdGltZWxpbmVzLT5sb2NrLCBmbGFncyk7CisKKwkJaWYgKHRp
bWVvdXQgPiAwKSB7CisJCQlzdHJ1Y3QgZG1hX2ZlbmNlICpmZW5jZTsKKworCQkJZmVuY2UgPSBp
OTE1X2FjdGl2ZV9mZW5jZV9nZXQoJnRsLT5sYXN0X3JlcXVlc3QpOworCQkJaWYgKGZlbmNlKSB7
CisJCQkJdGltZW91dCA9IGRtYV9mZW5jZV93YWl0X3RpbWVvdXQoZmVuY2UsCisJCQkJCQkJCSB0
cnVlLAorCQkJCQkJCQkgdGltZW91dCk7CisJCQkJZG1hX2ZlbmNlX3B1dChmZW5jZSk7CisJCQl9
CisJCX0KKworCQlyZXRpcmVfcmVxdWVzdHModGwpOworCisJCXNwaW5fbG9ja19pcnFzYXZlKCZ0
aW1lbGluZXMtPmxvY2ssIGZsYWdzKTsKKworCQkvKiBSZXN1bWUgaXRlcmF0aW9uIGFmdGVyIGRy
b3BwaW5nIGxvY2sgKi8KKwkJbGlzdF9zYWZlX3Jlc2V0X25leHQodGwsIHRuLCBsaW5rKTsKKwkJ
aWYgKC0tdGwtPmFjdGl2ZV9jb3VudCkKKwkJCWFjdGl2ZV9jb3VudCArPSAhIXJjdV9hY2Nlc3Nf
cG9pbnRlcih0bC0+bGFzdF9yZXF1ZXN0LmZlbmNlKTsKKwkJZWxzZQorCQkJbGlzdF9kZWwoJnRs
LT5saW5rKTsKKworCQltdXRleF91bmxvY2soJnRsLT5tdXRleCk7CisKKwkJLyogRGVmZXIgdGhl
IGZpbmFsIHJlbGVhc2UgdG8gYWZ0ZXIgdGhlIHNwaW5sb2NrICovCisJCWlmIChyZWZjb3VudF9k
ZWNfYW5kX3Rlc3QoJnRsLT5rcmVmLnJlZmNvdW50KSkgeworCQkJR0VNX0JVR19PTih0bC0+YWN0
aXZlX2NvdW50KTsKKwkJCWxpc3RfYWRkKCZ0bC0+bGluaywgJmZyZWUpOworCQl9CisJfQorCXNw
aW5fdW5sb2NrX2lycXJlc3RvcmUoJnRpbWVsaW5lcy0+bG9jaywgZmxhZ3MpOworCisJbGlzdF9m
b3JfZWFjaF9lbnRyeV9zYWZlKHRsLCB0biwgJmZyZWUsIGxpbmspCisJCV9faW50ZWxfdGltZWxp
bmVfZnJlZSgmdGwtPmtyZWYpOworCisJcmV0dXJuIGFjdGl2ZV9jb3VudCA/IHRpbWVvdXQgOiAw
OworfQorCitpbnQgaW50ZWxfZ3Rfd2FpdF9mb3JfaWRsZShzdHJ1Y3QgaW50ZWxfZ3QgKmd0LCBs
b25nIHRpbWVvdXQpCit7CisJLyogSWYgdGhlIGRldmljZSBpcyBhc2xlZXAsIHdlIGhhdmUgbm8g
cmVxdWVzdHMgb3V0c3RhbmRpbmcgKi8KKwlpZiAoIWludGVsX2d0X3BtX2lzX2F3YWtlKGd0KSkK
KwkJcmV0dXJuIDA7CisKKwl3aGlsZSAoKHRpbWVvdXQgPSBpbnRlbF9ndF9yZXRpcmVfcmVxdWVz
dHNfdGltZW91dChndCwgdGltZW91dCkpID4gMCkgeworCQljb25kX3Jlc2NoZWQoKTsKKwkJaWYg
KHNpZ25hbF9wZW5kaW5nKGN1cnJlbnQpKQorCQkJcmV0dXJuIC1FSU5UUjsKKwl9CisKKwlyZXR1
cm4gdGltZW91dDsKK30KKworc3RhdGljIHZvaWQgcmV0aXJlX3dvcmtfaGFuZGxlcihzdHJ1Y3Qg
d29ya19zdHJ1Y3QgKndvcmspCit7CisJc3RydWN0IGludGVsX2d0ICpndCA9CisJCWNvbnRhaW5l
cl9vZih3b3JrLCB0eXBlb2YoKmd0KSwgcmVxdWVzdHMucmV0aXJlX3dvcmsud29yayk7CisKKwlp
bnRlbF9ndF9yZXRpcmVfcmVxdWVzdHMoZ3QpOworCXNjaGVkdWxlX2RlbGF5ZWRfd29yaygmZ3Qt
PnJlcXVlc3RzLnJldGlyZV93b3JrLAorCQkJICAgICAgcm91bmRfamlmZmllc191cF9yZWxhdGl2
ZShIWikpOworfQorCit2b2lkIGludGVsX2d0X2luaXRfcmVxdWVzdHMoc3RydWN0IGludGVsX2d0
ICpndCkKK3sKKwlJTklUX0RFTEFZRURfV09SSygmZ3QtPnJlcXVlc3RzLnJldGlyZV93b3JrLCBy
ZXRpcmVfd29ya19oYW5kbGVyKTsKK30KKwordm9pZCBpbnRlbF9ndF9wYXJrX3JlcXVlc3RzKHN0
cnVjdCBpbnRlbF9ndCAqZ3QpCit7CisJY2FuY2VsX2RlbGF5ZWRfd29yaygmZ3QtPnJlcXVlc3Rz
LnJldGlyZV93b3JrKTsKK30KKwordm9pZCBpbnRlbF9ndF91bnBhcmtfcmVxdWVzdHMoc3RydWN0
IGludGVsX2d0ICpndCkKK3sKKwlzY2hlZHVsZV9kZWxheWVkX3dvcmsoJmd0LT5yZXF1ZXN0cy5y
ZXRpcmVfd29yaywKKwkJCSAgICAgIHJvdW5kX2ppZmZpZXNfdXBfcmVsYXRpdmUoSFopKTsKK30K
ZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2d0X3JlcXVlc3RzLmgg
Yi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9ndF9yZXF1ZXN0cy5oCm5ldyBmaWxlIG1v
ZGUgMTAwNjQ0CmluZGV4IDAwMDAwMDAwMDAwMC4uYmQzMWNiY2U0N2UwCi0tLSAvZGV2L251bGwK
KysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfZ3RfcmVxdWVzdHMuaApAQCAtMCww
ICsxLDI0IEBACisvKgorICogU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IE1JVAorICoKKyAqIENv
cHlyaWdodCDCqSAyMDE5IEludGVsIENvcnBvcmF0aW9uCisgKi8KKworI2lmbmRlZiBJTlRFTF9H
VF9SRVFVRVNUU19ICisjZGVmaW5lIElOVEVMX0dUX1JFUVVFU1RTX0gKKworc3RydWN0IGludGVs
X2d0OworCitsb25nIGludGVsX2d0X3JldGlyZV9yZXF1ZXN0c190aW1lb3V0KHN0cnVjdCBpbnRl
bF9ndCAqZ3QsIGxvbmcgdGltZW91dCk7CitzdGF0aWMgaW5saW5lIHZvaWQgaW50ZWxfZ3RfcmV0
aXJlX3JlcXVlc3RzKHN0cnVjdCBpbnRlbF9ndCAqZ3QpCit7CisJaW50ZWxfZ3RfcmV0aXJlX3Jl
cXVlc3RzX3RpbWVvdXQoZ3QsIDApOworfQorCitpbnQgaW50ZWxfZ3Rfd2FpdF9mb3JfaWRsZShz
dHJ1Y3QgaW50ZWxfZ3QgKmd0LCBsb25nIHRpbWVvdXQpOworCit2b2lkIGludGVsX2d0X2luaXRf
cmVxdWVzdHMoc3RydWN0IGludGVsX2d0ICpndCk7Cit2b2lkIGludGVsX2d0X3BhcmtfcmVxdWVz
dHMoc3RydWN0IGludGVsX2d0ICpndCk7Cit2b2lkIGludGVsX2d0X3VucGFya19yZXF1ZXN0cyhz
dHJ1Y3QgaW50ZWxfZ3QgKmd0KTsKKworI2VuZGlmIC8qIElOVEVMX0dUX1JFUVVFU1RTX0ggKi8K
ZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2d0X3R5cGVzLmggYi9k
cml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9ndF90eXBlcy5oCmluZGV4IDcxMzRmMTMxOWJi
ZS4uODAyZjUxNmEzNDMwIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRl
bF9ndF90eXBlcy5oCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2d0X3R5cGVz
LmgKQEAgLTUwLDYgKzUwLDE3IEBAIHN0cnVjdCBpbnRlbF9ndCB7CiAJCXN0cnVjdCBsaXN0X2hl
YWQgaHdzcF9mcmVlX2xpc3Q7CiAJfSB0aW1lbGluZXM7CiAKKwlzdHJ1Y3QgaW50ZWxfZ3RfcmVx
dWVzdHMgeworCQkvKioKKwkJICogV2UgbGVhdmUgdGhlIHVzZXIgSVJRIG9mZiBhcyBtdWNoIGFz
IHBvc3NpYmxlLAorCQkgKiBidXQgdGhpcyBtZWFucyB0aGF0IHJlcXVlc3RzIHdpbGwgZmluaXNo
IGFuZCBuZXZlcgorCQkgKiBiZSByZXRpcmVkIG9uY2UgdGhlIHN5c3RlbSBnb2VzIGlkbGUuIFNl
dCBhIHRpbWVyIHRvCisJCSAqIGZpcmUgcGVyaW9kaWNhbGx5IHdoaWxlIHRoZSByaW5nIGlzIHJ1
bm5pbmcuIFdoZW4gaXQKKwkJICogZmlyZXMsIGdvIHJldGlyZSByZXF1ZXN0cy4KKwkJICovCisJ
CXN0cnVjdCBkZWxheWVkX3dvcmsgcmV0aXJlX3dvcms7CisJfSByZXF1ZXN0czsKKwogCXN0cnVj
dCBpbnRlbF93YWtlcmVmIHdha2VyZWY7CiAJYXRvbWljX3QgdXNlcl93YWtlcmVmOwogCmRpZmYg
LS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9zZWxmdGVzdF90aW1lbGluZS5jIGIvZHJp
dmVycy9ncHUvZHJtL2k5MTUvZ3Qvc2VsZnRlc3RfdGltZWxpbmUuYwppbmRleCAxNmFiZmFiZjA4
YzcuLmQ2ZGY0MGNkYzhhNiAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qvc2Vs
ZnRlc3RfdGltZWxpbmUuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9zZWxmdGVzdF90
aW1lbGluZS5jCkBAIC04LDYgKzgsNyBAQAogCiAjaW5jbHVkZSAiaW50ZWxfZW5naW5lX3BtLmgi
CiAjaW5jbHVkZSAiaW50ZWxfZ3QuaCIKKyNpbmNsdWRlICJpbnRlbF9ndF9yZXF1ZXN0cy5oIgog
CiAjaW5jbHVkZSAiLi4vc2VsZnRlc3RzL2k5MTVfcmFuZG9tLmgiCiAjaW5jbHVkZSAiLi4vaTkx
NV9zZWxmdGVzdC5oIgpAQCAtNjQxLDYgKzY0Miw3IEBAIHN0YXRpYyBpbnQgbGl2ZV9od3NwX2Fs
dGVybmF0ZSh2b2lkICphcmcpCiBzdGF0aWMgaW50IGxpdmVfaHdzcF93cmFwKHZvaWQgKmFyZykK
IHsKIAlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IGFyZzsKKwlzdHJ1Y3QgaW50ZWxf
Z3QgKmd0ID0gJmk5MTUtPmd0OwogCXN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZTsKIAlz
dHJ1Y3QgaW50ZWxfdGltZWxpbmUgKnRsOwogCWVudW0gaW50ZWxfZW5naW5lX2lkIGlkOwpAQCAt
NjUxLDcgKzY1Myw3IEBAIHN0YXRpYyBpbnQgbGl2ZV9od3NwX3dyYXAodm9pZCAqYXJnKQogCSAq
IGZvcmVpZ24gR1BVIHJlZmVyZW5jZXMuCiAJICovCiAKLQl0bCA9IGludGVsX3RpbWVsaW5lX2Ny
ZWF0ZSgmaTkxNS0+Z3QsIE5VTEwpOworCXRsID0gaW50ZWxfdGltZWxpbmVfY3JlYXRlKGd0LCBO
VUxMKTsKIAlpZiAoSVNfRVJSKHRsKSkKIAkJcmV0dXJuIFBUUl9FUlIodGwpOwogCkBAIC02NjIs
NyArNjY0LDcgQEAgc3RhdGljIGludCBsaXZlX2h3c3Bfd3JhcCh2b2lkICphcmcpCiAJaWYgKGVy
cikKIAkJZ290byBvdXRfZnJlZTsKIAotCWZvcl9lYWNoX2VuZ2luZShlbmdpbmUsIGk5MTUsIGlk
KSB7CisJZm9yX2VhY2hfZW5naW5lKGVuZ2luZSwgZ3QtPmk5MTUsIGlkKSB7CiAJCWNvbnN0IHUz
MiAqaHdzcF9zZXFub1syXTsKIAkJc3RydWN0IGk5MTVfcmVxdWVzdCAqcnE7CiAJCXUzMiBzZXFu
b1syXTsKQEAgLTczNCw3ICs3MzYsNyBAQCBzdGF0aWMgaW50IGxpdmVfaHdzcF93cmFwKHZvaWQg
KmFyZykKIAkJCWdvdG8gb3V0OwogCQl9CiAKLQkJaTkxNV9yZXRpcmVfcmVxdWVzdHMoaTkxNSk7
IC8qIHJlY3ljbGUgSFdTUCAqLworCQlpbnRlbF9ndF9yZXRpcmVfcmVxdWVzdHMoZ3QpOyAvKiBy
ZWN5Y2xlIEhXU1AgKi8KIAl9CiAKIG91dDoKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9p
OTE1L2k5MTVfZGVidWdmcy5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9kZWJ1Z2ZzLmMK
aW5kZXggNTg4OGE2NThlMmI3Li4yYWZjNDFlNDNiNmUgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1
L2RybS9pOTE1L2k5MTVfZGVidWdmcy5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVf
ZGVidWdmcy5jCkBAIC00MSw2ICs0MSw3IEBACiAKICNpbmNsdWRlICJnZW0vaTkxNV9nZW1fY29u
dGV4dC5oIgogI2luY2x1ZGUgImd0L2ludGVsX2d0X3BtLmgiCisjaW5jbHVkZSAiZ3QvaW50ZWxf
Z3RfcmVxdWVzdHMuaCIKICNpbmNsdWRlICJndC9pbnRlbF9yZXNldC5oIgogI2luY2x1ZGUgImd0
L2ludGVsX3JjNi5oIgogI2luY2x1ZGUgImd0L3VjL2ludGVsX2d1Y19zdWJtaXNzaW9uLmgiCkBA
IC0zNjIxLDMzICszNjIyLDMzIEBAIHN0YXRpYyBpbnQKIGk5MTVfZHJvcF9jYWNoZXNfc2V0KHZv
aWQgKmRhdGEsIHU2NCB2YWwpCiB7CiAJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSBk
YXRhOworCXN0cnVjdCBpbnRlbF9ndCAqZ3QgPSAmaTkxNS0+Z3Q7CiAJaW50IHJldDsKIAogCURS
TV9ERUJVRygiRHJvcHBpbmcgY2FjaGVzOiAweCUwOGxseCBbMHglMDhsbHhdXG4iLAogCQkgIHZh
bCwgdmFsICYgRFJPUF9BTEwpOwogCiAJaWYgKHZhbCAmIERST1BfUkVTRVRfQUNUSVZFICYmCi0J
ICAgIHdhaXRfZm9yKGludGVsX2VuZ2luZXNfYXJlX2lkbGUoJmk5MTUtPmd0KSwKLQkJICAgICBJ
OTE1X0lETEVfRU5HSU5FU19USU1FT1VUKSkKLQkJaW50ZWxfZ3Rfc2V0X3dlZGdlZCgmaTkxNS0+
Z3QpOworCSAgICB3YWl0X2ZvcihpbnRlbF9lbmdpbmVzX2FyZV9pZGxlKGd0KSwgSTkxNV9JRExF
X0VOR0lORVNfVElNRU9VVCkpCisJCWludGVsX2d0X3NldF93ZWRnZWQoZ3QpOwogCiAJaWYgKHZh
bCAmIERST1BfUkVUSVJFKQotCQlpOTE1X3JldGlyZV9yZXF1ZXN0cyhpOTE1KTsKKwkJaW50ZWxf
Z3RfcmV0aXJlX3JlcXVlc3RzKGd0KTsKIAogCWlmICh2YWwgJiAoRFJPUF9JRExFIHwgRFJPUF9B
Q1RJVkUpKSB7Ci0JCXJldCA9IGk5MTVfZ2VtX3dhaXRfZm9yX2lkbGUoaTkxNSwgTUFYX1NDSEVE
VUxFX1RJTUVPVVQpOworCQlyZXQgPSBpbnRlbF9ndF93YWl0X2Zvcl9pZGxlKGd0LCBNQVhfU0NI
RURVTEVfVElNRU9VVCk7CiAJCWlmIChyZXQpCiAJCQlyZXR1cm4gcmV0OwogCX0KIAogCWlmICh2
YWwgJiBEUk9QX0lETEUpIHsKLQkJcmV0ID0gaW50ZWxfZ3RfcG1fd2FpdF9mb3JfaWRsZSgmaTkx
NS0+Z3QpOworCQlyZXQgPSBpbnRlbF9ndF9wbV93YWl0X2Zvcl9pZGxlKGd0KTsKIAkJaWYgKHJl
dCkKIAkJCXJldHVybiByZXQ7CiAJfQogCi0JaWYgKHZhbCAmIERST1BfUkVTRVRfQUNUSVZFICYm
IGludGVsX2d0X3Rlcm1pbmFsbHlfd2VkZ2VkKCZpOTE1LT5ndCkpCi0JCWludGVsX2d0X2hhbmRs
ZV9lcnJvcigmaTkxNS0+Z3QsIEFMTF9FTkdJTkVTLCAwLCBOVUxMKTsKKwlpZiAodmFsICYgRFJP
UF9SRVNFVF9BQ1RJVkUgJiYgaW50ZWxfZ3RfdGVybWluYWxseV93ZWRnZWQoZ3QpKQorCQlpbnRl
bF9ndF9oYW5kbGVfZXJyb3IoZ3QsIEFMTF9FTkdJTkVTLCAwLCBOVUxMKTsKIAogCWZzX3JlY2xh
aW1fYWNxdWlyZShHRlBfS0VSTkVMKTsKIAlpZiAodmFsICYgRFJPUF9CT1VORCkKZGlmZiAtLWdp
dCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZHJ2LmggYi9kcml2ZXJzL2dwdS9kcm0vaTkx
NS9pOTE1X2Rydi5oCmluZGV4IDQ0ZjM0NjNmZjlmMS4uY2I2M2IyYmQwY2U4IDEwMDY0NAotLS0g
YS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2Rydi5oCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9p
OTE1L2k5MTVfZHJ2LmgKQEAgLTE3MTAsMTUgKzE3MTAsNiBAQCBzdHJ1Y3QgZHJtX2k5MTVfcHJp
dmF0ZSB7CiAKIAlzdHJ1Y3QgewogCQlzdHJ1Y3Qgbm90aWZpZXJfYmxvY2sgcG1fbm90aWZpZXI7
Ci0KLQkJLyoqCi0JCSAqIFdlIGxlYXZlIHRoZSB1c2VyIElSUSBvZmYgYXMgbXVjaCBhcyBwb3Nz
aWJsZSwKLQkJICogYnV0IHRoaXMgbWVhbnMgdGhhdCByZXF1ZXN0cyB3aWxsIGZpbmlzaCBhbmQg
bmV2ZXIKLQkJICogYmUgcmV0aXJlZCBvbmNlIHRoZSBzeXN0ZW0gZ29lcyBpZGxlLiBTZXQgYSB0
aW1lciB0bwotCQkgKiBmaXJlIHBlcmlvZGljYWxseSB3aGlsZSB0aGUgcmluZyBpcyBydW5uaW5n
LiBXaGVuIGl0Ci0JCSAqIGZpcmVzLCBnbyByZXRpcmUgcmVxdWVzdHMuCi0JCSAqLwotCQlzdHJ1
Y3QgZGVsYXllZF93b3JrIHJldGlyZV93b3JrOwogCX0gZ2VtOwogCiAJLyogRm9yIGk5NDVnbSB2
YmxhbmsgaXJxIHZzLiBDMyB3b3JrYXJvdW5kICovCkBAIC0yMzIxLDcgKzIzMTIsNiBAQCB2b2lk
IGk5MTVfZ2VtX2RyaXZlcl9yZWdpc3RlcihzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSk7
CiB2b2lkIGk5MTVfZ2VtX2RyaXZlcl91bnJlZ2lzdGVyKHN0cnVjdCBkcm1faTkxNV9wcml2YXRl
ICppOTE1KTsKIHZvaWQgaTkxNV9nZW1fZHJpdmVyX3JlbW92ZShzdHJ1Y3QgZHJtX2k5MTVfcHJp
dmF0ZSAqZGV2X3ByaXYpOwogdm9pZCBpOTE1X2dlbV9kcml2ZXJfcmVsZWFzZShzdHJ1Y3QgZHJt
X2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpOwotaW50IGk5MTVfZ2VtX3dhaXRfZm9yX2lkbGUoc3Ry
dWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LCBsb25nIHRpbWVvdXQpOwogdm9pZCBpOTE1
X2dlbV9zdXNwZW5kKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdik7CiB2b2lkIGk5
MTVfZ2VtX3N1c3BlbmRfbGF0ZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpOwog
dm9pZCBpOTE1X2dlbV9yZXN1bWUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KTsK
ZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZ2VtLmMgYi9kcml2ZXJzL2dw
dS9kcm0vaTkxNS9pOTE1X2dlbS5jCmluZGV4IDdjODJmYzM5ZjY1NS4uNWE2NjRiZGVhZDhjIDEw
MDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2dlbS5jCisrKyBiL2RyaXZlcnMv
Z3B1L2RybS9pOTE1L2k5MTVfZ2VtLmMKQEAgLTg4MywyMyArODgzLDYgQEAgdm9pZCBpOTE1X2dl
bV9ydW50aW1lX3N1c3BlbmQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpCiAJfQogfQog
Ci1pbnQgaTkxNV9nZW1fd2FpdF9mb3JfaWRsZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkx
NSwgbG9uZyB0aW1lb3V0KQotewotCXN0cnVjdCBpbnRlbF9ndCAqZ3QgPSAmaTkxNS0+Z3Q7Ci0K
LQkvKiBJZiB0aGUgZGV2aWNlIGlzIGFzbGVlcCwgd2UgaGF2ZSBubyByZXF1ZXN0cyBvdXRzdGFu
ZGluZyAqLwotCWlmICghaW50ZWxfZ3RfcG1faXNfYXdha2UoZ3QpKQotCQlyZXR1cm4gMDsKLQot
CXdoaWxlICgodGltZW91dCA9IGk5MTVfcmV0aXJlX3JlcXVlc3RzX3RpbWVvdXQoaTkxNSwgdGlt
ZW91dCkpID4gMCkgewotCQljb25kX3Jlc2NoZWQoKTsKLQkJaWYgKHNpZ25hbF9wZW5kaW5nKGN1
cnJlbnQpKQotCQkJcmV0dXJuIC1FSU5UUjsKLQl9Ci0KLQlyZXR1cm4gdGltZW91dDsKLX0KLQog
c3RydWN0IGk5MTVfdm1hICoKIGk5MTVfZ2VtX29iamVjdF9nZ3R0X3BpbihzdHJ1Y3QgZHJtX2k5
MTVfZ2VtX29iamVjdCAqb2JqLAogCQkJIGNvbnN0IHN0cnVjdCBpOTE1X2dndHRfdmlldyAqdmll
dywKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZ2VtX2V2aWN0LmMgYi9k
cml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2dlbV9ldmljdC5jCmluZGV4IDBhNDEyZjZkMDFkNy4u
N2U2MmMzMTAyOTBmIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2dlbV9l
dmljdC5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZ2VtX2V2aWN0LmMKQEAgLTI5
LDYgKzI5LDcgQEAKICNpbmNsdWRlIDxkcm0vaTkxNV9kcm0uaD4KIAogI2luY2x1ZGUgImdlbS9p
OTE1X2dlbV9jb250ZXh0LmgiCisjaW5jbHVkZSAiZ3QvaW50ZWxfZ3RfcmVxdWVzdHMuaCIKIAog
I2luY2x1ZGUgImk5MTVfZHJ2LmgiCiAjaW5jbHVkZSAiaTkxNV90cmFjZS5oIgpAQCAtMzcsNyAr
MzgsNyBAQCBJOTE1X1NFTEZURVNUX0RFQ0xBUkUoc3RhdGljIHN0cnVjdCBpZ3RfZXZpY3RfY3Rs
IHsKIAlib29sIGZhaWxfaWZfYnVzeToxOwogfSBpZ3RfZXZpY3RfY3RsOykKIAotc3RhdGljIGlu
dCBnZ3R0X2ZsdXNoKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KQorc3RhdGljIGludCBn
Z3R0X2ZsdXNoKHN0cnVjdCBpbnRlbF9ndCAqZ3QpCiB7CiAJLyoKIAkgKiBOb3QgZXZlcnl0aGlu
ZyBpbiB0aGUgR0dUVCBpcyB0cmFja2VkIHZpYSB2bWEgKG90aGVyd2lzZSB3ZQpAQCAtNDYsNyAr
NDcsNyBAQCBzdGF0aWMgaW50IGdndHRfZmx1c2goc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5
MTUpCiAJICogdGhlIGhvcGVzIHRoYXQgd2UgY2FuIHRoZW4gcmVtb3ZlIGNvbnRleHRzIGFuZCB0
aGUgbGlrZSBvbmx5CiAJICogYm91bmQgYnkgdGhlaXIgYWN0aXZlIHJlZmVyZW5jZS4KIAkgKi8K
LQlyZXR1cm4gaTkxNV9nZW1fd2FpdF9mb3JfaWRsZShpOTE1LCBNQVhfU0NIRURVTEVfVElNRU9V
VCk7CisJcmV0dXJuIGludGVsX2d0X3dhaXRfZm9yX2lkbGUoZ3QsIE1BWF9TQ0hFRFVMRV9USU1F
T1VUKTsKIH0KIAogc3RhdGljIGJvb2wKQEAgLTkyLDcgKzkzLDYgQEAgaTkxNV9nZW1fZXZpY3Rf
c29tZXRoaW5nKHN0cnVjdCBpOTE1X2FkZHJlc3Nfc3BhY2UgKnZtLAogCQkJIHU2NCBzdGFydCwg
dTY0IGVuZCwKIAkJCSB1bnNpZ25lZCBmbGFncykKIHsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0
ZSAqZGV2X3ByaXYgPSB2bS0+aTkxNTsKIAlzdHJ1Y3QgZHJtX21tX3NjYW4gc2NhbjsKIAlzdHJ1
Y3QgbGlzdF9oZWFkIGV2aWN0aW9uX2xpc3Q7CiAJc3RydWN0IGk5MTVfdm1hICp2bWEsICpuZXh0
OwpAQCAtMTI0LDcgKzEyNCw3IEBAIGk5MTVfZ2VtX2V2aWN0X3NvbWV0aGluZyhzdHJ1Y3QgaTkx
NV9hZGRyZXNzX3NwYWNlICp2bSwKIAkJCQkgICAgbWluX3NpemUsIGFsaWdubWVudCwgY29sb3Is
CiAJCQkJICAgIHN0YXJ0LCBlbmQsIG1vZGUpOwogCi0JaTkxNV9yZXRpcmVfcmVxdWVzdHModm0t
Pmk5MTUpOworCWludGVsX2d0X3JldGlyZV9yZXF1ZXN0cyh2bS0+Z3QpOwogCiBzZWFyY2hfYWdh
aW46CiAJYWN0aXZlID0gTlVMTDsKQEAgLTE5Nyw3ICsxOTcsNyBAQCBpOTE1X2dlbV9ldmljdF9z
b21ldGhpbmcoc3RydWN0IGk5MTVfYWRkcmVzc19zcGFjZSAqdm0sCiAJaWYgKEk5MTVfU0VMRlRF
U1RfT05MWShpZ3RfZXZpY3RfY3RsLmZhaWxfaWZfYnVzeSkpCiAJCXJldHVybiAtRUJVU1k7CiAK
LQlyZXQgPSBnZ3R0X2ZsdXNoKGRldl9wcml2KTsKKwlyZXQgPSBnZ3R0X2ZsdXNoKHZtLT5ndCk7
CiAJaWYgKHJldCkKIAkJcmV0dXJuIHJldDsKIApAQCAtMjcwLDcgKzI3MCw3IEBAIGludCBpOTE1
X2dlbV9ldmljdF9mb3Jfbm9kZShzdHJ1Y3QgaTkxNV9hZGRyZXNzX3NwYWNlICp2bSwKIAkgKiBh
IHN0cmF5IHBpbiAocHJldmVudGluZyBldmljdGlvbikgdGhhdCBjYW4gb25seSBiZSByZXNvbHZl
ZCBieQogCSAqIHJldGlyaW5nLgogCSAqLwotCWk5MTVfcmV0aXJlX3JlcXVlc3RzKHZtLT5pOTE1
KTsKKwlpbnRlbF9ndF9yZXRpcmVfcmVxdWVzdHModm0tPmd0KTsKIAogCWlmIChpOTE1X3ZtX2hh
c19jYWNoZV9jb2xvcmluZyh2bSkpIHsKIAkJLyogRXhwYW5kIHNlYXJjaCB0byBjb3ZlciBuZWln
aGJvdXJpbmcgZ3VhcmQgcGFnZXMgKG9yIGxhY2shKSAqLwpAQCAtMzcyLDcgKzM3Miw3IEBAIGlu
dCBpOTE1X2dlbV9ldmljdF92bShzdHJ1Y3QgaTkxNV9hZGRyZXNzX3NwYWNlICp2bSkKIAkgKiBz
d2l0Y2ggb3RoZXJ3aXNlIGlzIGluZWZmZWN0aXZlLgogCSAqLwogCWlmIChpOTE1X2lzX2dndHQo
dm0pKSB7Ci0JCXJldCA9IGdndHRfZmx1c2godm0tPmk5MTUpOworCQlyZXQgPSBnZ3R0X2ZsdXNo
KHZtLT5ndCk7CiAJCWlmIChyZXQpCiAJCQlyZXR1cm4gcmV0OwogCX0KZGlmZiAtLWdpdCBhL2Ry
aXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZ2VtX2d0dC5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUv
aTkxNV9nZW1fZ3R0LmMKaW5kZXggMDgyZmNmOTA4NWE2Li4xZDI2NjM0Y2E1OTcgMTAwNjQ0Ci0t
LSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZ2VtX2d0dC5jCisrKyBiL2RyaXZlcnMvZ3B1
L2RybS9pOTE1L2k5MTVfZ2VtX2d0dC5jCkBAIC0zOCw2ICszOCw3IEBACiAKICNpbmNsdWRlICJk
aXNwbGF5L2ludGVsX2Zyb250YnVmZmVyLmgiCiAjaW5jbHVkZSAiZ3QvaW50ZWxfZ3QuaCIKKyNp
bmNsdWRlICJndC9pbnRlbF9ndF9yZXF1ZXN0cy5oIgogCiAjaW5jbHVkZSAiaTkxNV9kcnYuaCIK
ICNpbmNsdWRlICJpOTE1X3NjYXR0ZXJsaXN0LmgiCkBAIC0yNTI5LDggKzI1MzAsOCBAQCB2b2lk
IGk5MTVfZ2VtX2d0dF9maW5pc2hfcGFnZXMoc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9i
aiwKIAogCWlmICh1bmxpa2VseShnZ3R0LT5kb19pZGxlX21hcHMpKSB7CiAJCS8qIFhYWCBUaGlz
IGRvZXMgbm90IHByZXZlbnQgbW9yZSByZXF1ZXN0cyBiZWluZyBzdWJtaXR0ZWQhICovCi0JCWlm
IChpOTE1X3JldGlyZV9yZXF1ZXN0c190aW1lb3V0KGRldl9wcml2LAotCQkJCQkJIC1NQVhfU0NI
RURVTEVfVElNRU9VVCkpIHsKKwkJaWYgKGludGVsX2d0X3JldGlyZV9yZXF1ZXN0c190aW1lb3V0
KGdndHQtPnZtLmd0LAorCQkJCQkJICAgICAtTUFYX1NDSEVEVUxFX1RJTUVPVVQpKSB7CiAJCQlE
Uk1fRVJST1IoIkZhaWxlZCB0byB3YWl0IGZvciBpZGxlOyBWVCdkIG1heSBoYW5nLlxuIik7CiAJ
CQkvKiBXYWl0IGEgYml0LCBpbiBob3BlcyBpdCBhdm9pZHMgdGhlIGhhbmcgKi8KIAkJCXVkZWxh
eSgxMCk7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3JlcXVlc3QuYyBi
L2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfcmVxdWVzdC5jCmluZGV4IDUyZjdjNGU1YjY0NC4u
NDM3ZjlmYzYyODJlIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3JlcXVl
c3QuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3JlcXVlc3QuYwpAQCAtMjE2LDcg
KzIxNiw3IEBAIHN0YXRpYyB2b2lkIHJlbW92ZV9mcm9tX2VuZ2luZShzdHJ1Y3QgaTkxNV9yZXF1
ZXN0ICpycSkKIAlzcGluX3VubG9jaygmbG9ja2VkLT5hY3RpdmUubG9jayk7CiB9CiAKLXN0YXRp
YyBib29sIGk5MTVfcmVxdWVzdF9yZXRpcmUoc3RydWN0IGk5MTVfcmVxdWVzdCAqcnEpCitib29s
IGk5MTVfcmVxdWVzdF9yZXRpcmUoc3RydWN0IGk5MTVfcmVxdWVzdCAqcnEpCiB7CiAJaWYgKCFp
OTE1X3JlcXVlc3RfY29tcGxldGVkKHJxKSkKIAkJcmV0dXJuIGZhbHNlOwpAQCAtMTUwOCw2OCAr
MTUwOCw2IEBAIGxvbmcgaTkxNV9yZXF1ZXN0X3dhaXQoc3RydWN0IGk5MTVfcmVxdWVzdCAqcnEs
CiAJcmV0dXJuIHRpbWVvdXQ7CiB9CiAKLWxvbmcgaTkxNV9yZXRpcmVfcmVxdWVzdHNfdGltZW91
dChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwgbG9uZyB0aW1lb3V0KQotewotCXN0cnVj
dCBpbnRlbF9ndF90aW1lbGluZXMgKnRpbWVsaW5lcyA9ICZpOTE1LT5ndC50aW1lbGluZXM7Ci0J
c3RydWN0IGludGVsX3RpbWVsaW5lICp0bCwgKnRuOwotCXVuc2lnbmVkIGxvbmcgYWN0aXZlX2Nv
dW50ID0gMDsKLQl1bnNpZ25lZCBsb25nIGZsYWdzOwotCWJvb2wgaW50ZXJydXB0aWJsZTsKLQlM
SVNUX0hFQUQoZnJlZSk7Ci0KLQlpbnRlcnJ1cHRpYmxlID0gdHJ1ZTsKLQlpZiAodGltZW91dCA8
IDApCi0JCXRpbWVvdXQgPSAtdGltZW91dCwgaW50ZXJydXB0aWJsZSA9IGZhbHNlOwotCi0Jc3Bp
bl9sb2NrX2lycXNhdmUoJnRpbWVsaW5lcy0+bG9jaywgZmxhZ3MpOwotCWxpc3RfZm9yX2VhY2hf
ZW50cnlfc2FmZSh0bCwgdG4sICZ0aW1lbGluZXMtPmFjdGl2ZV9saXN0LCBsaW5rKSB7Ci0JCWlm
ICghbXV0ZXhfdHJ5bG9jaygmdGwtPm11dGV4KSkKLQkJCWNvbnRpbnVlOwotCi0JCWludGVsX3Rp
bWVsaW5lX2dldCh0bCk7Ci0JCUdFTV9CVUdfT04oIXRsLT5hY3RpdmVfY291bnQpOwotCQl0bC0+
YWN0aXZlX2NvdW50Kys7IC8qIHBpbiB0aGUgbGlzdCBlbGVtZW50ICovCi0JCXNwaW5fdW5sb2Nr
X2lycXJlc3RvcmUoJnRpbWVsaW5lcy0+bG9jaywgZmxhZ3MpOwotCi0JCWlmICh0aW1lb3V0ID4g
MCkgewotCQkJc3RydWN0IGRtYV9mZW5jZSAqZmVuY2U7Ci0KLQkJCWZlbmNlID0gaTkxNV9hY3Rp
dmVfZmVuY2VfZ2V0KCZ0bC0+bGFzdF9yZXF1ZXN0KTsKLQkJCWlmIChmZW5jZSkgewotCQkJCXRp
bWVvdXQgPSBkbWFfZmVuY2Vfd2FpdF90aW1lb3V0KGZlbmNlLAotCQkJCQkJCQkgaW50ZXJydXB0
aWJsZSwKLQkJCQkJCQkJIHRpbWVvdXQpOwotCQkJCWRtYV9mZW5jZV9wdXQoZmVuY2UpOwotCQkJ
fQotCQl9Ci0KLQkJcmV0aXJlX3JlcXVlc3RzKHRsKTsKLQotCQlzcGluX2xvY2tfaXJxc2F2ZSgm
dGltZWxpbmVzLT5sb2NrLCBmbGFncyk7Ci0KLQkJLyogUmVzdW1lIGl0ZXJhdGlvbiBhZnRlciBk
cm9wcGluZyBsb2NrICovCi0JCWxpc3Rfc2FmZV9yZXNldF9uZXh0KHRsLCB0biwgbGluayk7Ci0J
CWlmICgtLXRsLT5hY3RpdmVfY291bnQpCi0JCQlhY3RpdmVfY291bnQgKz0gISFyY3VfYWNjZXNz
X3BvaW50ZXIodGwtPmxhc3RfcmVxdWVzdC5mZW5jZSk7Ci0JCWVsc2UKLQkJCWxpc3RfZGVsKCZ0
bC0+bGluayk7Ci0KLQkJbXV0ZXhfdW5sb2NrKCZ0bC0+bXV0ZXgpOwotCi0JCS8qIERlZmVyIHRo
ZSBmaW5hbCByZWxlYXNlIHRvIGFmdGVyIHRoZSBzcGlubG9jayAqLwotCQlpZiAocmVmY291bnRf
ZGVjX2FuZF90ZXN0KCZ0bC0+a3JlZi5yZWZjb3VudCkpIHsKLQkJCUdFTV9CVUdfT04odGwtPmFj
dGl2ZV9jb3VudCk7Ci0JCQlsaXN0X2FkZCgmdGwtPmxpbmssICZmcmVlKTsKLQkJfQotCX0KLQlz
cGluX3VubG9ja19pcnFyZXN0b3JlKCZ0aW1lbGluZXMtPmxvY2ssIGZsYWdzKTsKLQotCWxpc3Rf
Zm9yX2VhY2hfZW50cnlfc2FmZSh0bCwgdG4sICZmcmVlLCBsaW5rKQotCQlfX2ludGVsX3RpbWVs
aW5lX2ZyZWUoJnRsLT5rcmVmKTsKLQotCXJldHVybiBhY3RpdmVfY291bnQgPyB0aW1lb3V0IDog
MDsKLX0KLQogI2lmIElTX0VOQUJMRUQoQ09ORklHX0RSTV9JOTE1X1NFTEZURVNUKQogI2luY2x1
ZGUgInNlbGZ0ZXN0cy9tb2NrX3JlcXVlc3QuYyIKICNpbmNsdWRlICJzZWxmdGVzdHMvaTkxNV9y
ZXF1ZXN0LmMiCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3JlcXVlc3Qu
aCBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfcmVxdWVzdC5oCmluZGV4IDI1NmIwNzE1MTgw
Zi4uNmE5NTI0MmIyODBkIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3Jl
cXVlc3QuaAorKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3JlcXVlc3QuaApAQCAtMjUw
LDYgKzI1MCw3IEBAIHN0cnVjdCBpOTE1X3JlcXVlc3QgKl9faTkxNV9yZXF1ZXN0X2NvbW1pdChz
dHJ1Y3QgaTkxNV9yZXF1ZXN0ICpyZXF1ZXN0KTsKIHZvaWQgX19pOTE1X3JlcXVlc3RfcXVldWUo
c3RydWN0IGk5MTVfcmVxdWVzdCAqcnEsCiAJCQkgIGNvbnN0IHN0cnVjdCBpOTE1X3NjaGVkX2F0
dHIgKmF0dHIpOwogCitib29sIGk5MTVfcmVxdWVzdF9yZXRpcmUoc3RydWN0IGk5MTVfcmVxdWVz
dCAqcnEpOwogdm9pZCBpOTE1X3JlcXVlc3RfcmV0aXJlX3VwdG8oc3RydWN0IGk5MTVfcmVxdWVz
dCAqcnEpOwogCiBzdGF0aWMgaW5saW5lIHN0cnVjdCBpOTE1X3JlcXVlc3QgKgpAQCAtNDU5LDEw
ICs0NjAsNCBAQCBpOTE1X3JlcXVlc3RfYWN0aXZlX3RpbWVsaW5lKHN0cnVjdCBpOTE1X3JlcXVl
c3QgKnJxKQogCQkJCQkgbG9ja2RlcF9pc19oZWxkKCZycS0+ZW5naW5lLT5hY3RpdmUubG9jaykp
OwogfQogCi1sb25nIGk5MTVfcmV0aXJlX3JlcXVlc3RzX3RpbWVvdXQoc3RydWN0IGRybV9pOTE1
X3ByaXZhdGUgKmk5MTUsIGxvbmcgdGltZW91dCk7Ci1zdGF0aWMgaW5saW5lIHZvaWQgaTkxNV9y
ZXRpcmVfcmVxdWVzdHMoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpCi17Ci0JaTkxNV9y
ZXRpcmVfcmVxdWVzdHNfdGltZW91dChpOTE1LCAwKTsKLX0KLQogI2VuZGlmIC8qIEk5MTVfUkVR
VUVTVF9IICovCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMvaWd0
X2ZsdXNoX3Rlc3QuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L3NlbGZ0ZXN0cy9pZ3RfZmx1c2hf
dGVzdC5jCmluZGV4IGVkNDk2YmQ2ZDg0Zi4uN2IwOTM5ZTNmMDA3IDEwMDY0NAotLS0gYS9kcml2
ZXJzL2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMvaWd0X2ZsdXNoX3Rlc3QuYworKysgYi9kcml2ZXJz
L2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMvaWd0X2ZsdXNoX3Rlc3QuYwpAQCAtNCw4ICs0LDggQEAK
ICAqIENvcHlyaWdodCDCqSAyMDE4IEludGVsIENvcnBvcmF0aW9uCiAgKi8KIAotI2luY2x1ZGUg
ImdlbS9pOTE1X2dlbV9jb250ZXh0LmgiCiAjaW5jbHVkZSAiZ3QvaW50ZWxfZ3QuaCIKKyNpbmNs
dWRlICJndC9pbnRlbF9ndF9yZXF1ZXN0cy5oIgogCiAjaW5jbHVkZSAiaTkxNV9kcnYuaCIKICNp
bmNsdWRlICJpOTE1X3NlbGZ0ZXN0LmgiCkBAIC0xNCwxMSArMTQsMTIgQEAKIAogaW50IGlndF9m
bHVzaF90ZXN0KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KQogewotCWludCByZXQgPSBp
bnRlbF9ndF9pc193ZWRnZWQoJmk5MTUtPmd0KSA/IC1FSU8gOiAwOworCXN0cnVjdCBpbnRlbF9n
dCAqZ3QgPSAmaTkxNS0+Z3Q7CisJaW50IHJldCA9IGludGVsX2d0X2lzX3dlZGdlZChndCkgPyAt
RUlPIDogMDsKIAogCWNvbmRfcmVzY2hlZCgpOwogCi0JaWYgKGk5MTVfZ2VtX3dhaXRfZm9yX2lk
bGUoaTkxNSwgSFogLyA1KSA9PSAtRVRJTUUpIHsKKwlpZiAoaW50ZWxfZ3Rfd2FpdF9mb3JfaWRs
ZShndCwgSFogLyA1KSA9PSAtRVRJTUUpIHsKIAkJcHJfZXJyKCIlcFMgdGltZWQgb3V0LCBjYW5j
ZWxsaW5nIGFsbCBmdXJ0aGVyIHRlc3RpbmcuXG4iLAogCQkgICAgICAgX19idWlsdGluX3JldHVy
bl9hZGRyZXNzKDApKTsKIApAQCAtMjYsNyArMjcsNyBAQCBpbnQgaWd0X2ZsdXNoX3Rlc3Qoc3Ry
dWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpCiAJCQkgIF9fYnVpbHRpbl9yZXR1cm5fYWRkcmVz
cygwKSk7CiAJCUdFTV9UUkFDRV9EVU1QKCk7CiAKLQkJaW50ZWxfZ3Rfc2V0X3dlZGdlZCgmaTkx
NS0+Z3QpOworCQlpbnRlbF9ndF9zZXRfd2VkZ2VkKGd0KTsKIAkJcmV0ID0gLUVJTzsKIAl9CiAK
ZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L3NlbGZ0ZXN0cy9pZ3RfbGl2ZV90ZXN0
LmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMvaWd0X2xpdmVfdGVzdC5jCmluZGV4
IGVhZTkwZjk3ZGY2Yy4uODEwYjYwMTAwYzJjIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0v
aTkxNS9zZWxmdGVzdHMvaWd0X2xpdmVfdGVzdC5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1
L3NlbGZ0ZXN0cy9pZ3RfbGl2ZV90ZXN0LmMKQEAgLTQsNyArNCw4IEBACiAgKiBDb3B5cmlnaHQg
wqkgMjAxOCBJbnRlbCBDb3Jwb3JhdGlvbgogICovCiAKLSNpbmNsdWRlICIuLi9pOTE1X2Rydi5o
IgorI2luY2x1ZGUgImk5MTVfZHJ2LmgiCisjaW5jbHVkZSAiZ3QvaW50ZWxfZ3RfcmVxdWVzdHMu
aCIKIAogI2luY2x1ZGUgIi4uL2k5MTVfc2VsZnRlc3QuaCIKICNpbmNsdWRlICJpZ3RfZmx1c2hf
dGVzdC5oIgpAQCAtMjMsNyArMjQsNyBAQCBpbnQgaWd0X2xpdmVfdGVzdF9iZWdpbihzdHJ1Y3Qg
aWd0X2xpdmVfdGVzdCAqdCwKIAl0LT5mdW5jID0gZnVuYzsKIAl0LT5uYW1lID0gbmFtZTsKIAot
CWVyciA9IGk5MTVfZ2VtX3dhaXRfZm9yX2lkbGUoaTkxNSwgTUFYX1NDSEVEVUxFX1RJTUVPVVQp
OworCWVyciA9IGludGVsX2d0X3dhaXRfZm9yX2lkbGUoJmk5MTUtPmd0LCBNQVhfU0NIRURVTEVf
VElNRU9VVCk7CiAJaWYgKGVycikgewogCQlwcl9lcnIoIiVzKCVzKTogZmFpbGVkIHRvIGlkbGUg
YmVmb3JlLCB3aXRoIGVycj0lZCEiLAogCQkgICAgICAgZnVuYywgbmFtZSwgZXJyKTsKZGlmZiAt
LWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L3NlbGZ0ZXN0cy9tb2NrX2dlbV9kZXZpY2UuYyBi
L2RyaXZlcnMvZ3B1L2RybS9pOTE1L3NlbGZ0ZXN0cy9tb2NrX2dlbV9kZXZpY2UuYwppbmRleCAz
YjU4OWJiYjJjMmQuLjRlNmNkZTBkNDg1OSAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5
MTUvc2VsZnRlc3RzL21vY2tfZ2VtX2RldmljZS5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1
L3NlbGZ0ZXN0cy9tb2NrX2dlbV9kZXZpY2UuYwpAQCAtMjYsNiArMjYsNyBAQAogI2luY2x1ZGUg
PGxpbnV4L3BtX3J1bnRpbWUuaD4KIAogI2luY2x1ZGUgImd0L2ludGVsX2d0LmgiCisjaW5jbHVk
ZSAiZ3QvaW50ZWxfZ3RfcmVxdWVzdHMuaCIKICNpbmNsdWRlICJndC9tb2NrX2VuZ2luZS5oIgog
CiAjaW5jbHVkZSAibW9ja19yZXF1ZXN0LmgiCkBAIC00NCw3ICs0NSw4IEBAIHZvaWQgbW9ja19k
ZXZpY2VfZmx1c2goc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpCiAJZG8gewogCQlmb3Jf
ZWFjaF9lbmdpbmUoZW5naW5lLCBpOTE1LCBpZCkKIAkJCW1vY2tfZW5naW5lX2ZsdXNoKGVuZ2lu
ZSk7Ci0JfSB3aGlsZSAoaTkxNV9yZXRpcmVfcmVxdWVzdHNfdGltZW91dChpOTE1LCBNQVhfU0NI
RURVTEVfVElNRU9VVCkpOworCX0gd2hpbGUgKGludGVsX2d0X3JldGlyZV9yZXF1ZXN0c190aW1l
b3V0KCZpOTE1LT5ndCwKKwkJCQkJCSAgTUFYX1NDSEVEVUxFX1RJTUVPVVQpKTsKIH0KIAogc3Rh
dGljIHZvaWQgbW9ja19kZXZpY2VfcmVsZWFzZShzdHJ1Y3QgZHJtX2RldmljZSAqZGV2KQpAQCAt
OTgsMTAgKzEwMCw2IEBAIHN0YXRpYyB2b2lkIHJlbGVhc2VfZGV2KHN0cnVjdCBkZXZpY2UgKmRl
dikKIAlrZnJlZShwZGV2KTsKIH0KIAotc3RhdGljIHZvaWQgbW9ja19yZXRpcmVfd29ya19oYW5k
bGVyKHN0cnVjdCB3b3JrX3N0cnVjdCAqd29yaykKLXsKLX0KLQogc3RhdGljIGludCBwbV9kb21h
aW5fcmVzdW1lKHN0cnVjdCBkZXZpY2UgKmRldikKIHsKIAlyZXR1cm4gcG1fZ2VuZXJpY19ydW50
aW1lX3Jlc3VtZShkZXYpOwpAQCAtMTgxLDggKzE3OSw2IEBAIHN0cnVjdCBkcm1faTkxNV9wcml2
YXRlICptb2NrX2dlbV9kZXZpY2Uodm9pZCkKIAogCW1vY2tfaW5pdF9jb250ZXh0cyhpOTE1KTsK
IAotCUlOSVRfREVMQVlFRF9XT1JLKCZpOTE1LT5nZW0ucmV0aXJlX3dvcmssIG1vY2tfcmV0aXJl
X3dvcmtfaGFuZGxlcik7Ci0KIAlpbnRlbF90aW1lbGluZXNfaW5pdChpOTE1KTsKIAogCW11dGV4
X2xvY2soJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwotLSAKMi4yMy4wCgpfX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fXwpJbnRlbC1nZnggbWFpbGluZyBsaXN0
CkludGVsLWdmeEBsaXN0cy5mcmVlZGVza3RvcC5vcmcKaHR0cHM6Ly9saXN0cy5mcmVlZGVza3Rv
cC5vcmcvbWFpbG1hbi9saXN0aW5mby9pbnRlbC1nZng=

Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 04FB3AA2A1
	for <lists+intel-gfx@lfdr.de>; Thu,  5 Sep 2019 14:05:20 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 5EA566E07D;
	Thu,  5 Sep 2019 12:05:18 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from mga05.intel.com (mga05.intel.com [192.55.52.43])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 64BA46E09F
 for <intel-gfx@lists.freedesktop.org>; Thu,  5 Sep 2019 12:05:16 +0000 (UTC)
X-Amp-Result: SKIPPED(no attachment in message)
X-Amp-File-Uploaded: False
Received: from fmsmga003.fm.intel.com ([10.253.24.29])
 by fmsmga105.fm.intel.com with ESMTP/TLS/DHE-RSA-AES256-GCM-SHA384;
 05 Sep 2019 05:05:16 -0700
X-ExtLoop1: 1
X-IronPort-AV: E=Sophos;i="5.64,470,1559545200"; d="scan'208";a="190474688"
Received: from aandueza-mobl1.amr.corp.intel.com (HELO
 delly.ger.corp.intel.com) ([10.252.38.201])
 by FMSMGA003.fm.intel.com with ESMTP; 05 Sep 2019 05:05:15 -0700
From: Lionel Landwerlin <lionel.g.landwerlin@intel.com>
To: intel-gfx@lists.freedesktop.org
Date: Thu,  5 Sep 2019 15:04:51 +0300
Message-Id: <20190905120451.14327-13-lionel.g.landwerlin@intel.com>
X-Mailer: git-send-email 2.23.0
In-Reply-To: <20190905120451.14327-1-lionel.g.landwerlin@intel.com>
References: <20190905120451.14327-1-lionel.g.landwerlin@intel.com>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH v14 12/12] drm/i915: add support for perf
 configuration queries
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

TGlzdGluZyBjb25maWd1cmF0aW9ucyBhdCB0aGUgbW9tZW50IGlzIHN1cHBvcnRlZCBvbmx5IHRo
cm91Z2ggc3lzZnMuClRoaXMgbWlnaHQgY2F1c2UgaXNzdWVzIGZvciBhcHBsaWNhdGlvbnMgd2Fu
dGluZyB0byBsaXN0CmNvbmZpZ3VyYXRpb25zIGZyb20gYSBjb250YWluZXIgd2hlcmUgc3lzZnMg
aXNuJ3QgYXZhaWxhYmxlLgoKVGhpcyBjaGFuZ2UgYWRkcyBhIHdheSB0byBxdWVyeSB0aGUgbnVt
YmVyIG9mIGNvbmZpZ3VyYXRpb25zIGFuZCB0aGVpcgpjb250ZW50IHRocm91Z2ggdGhlIGk5MTUg
cXVlcnkgdUFQSS4KCnYyOiBGaXggc3BhcnNlIHdhcm5pbmdzIChMaW9uZWwpCiAgICBBZGQgc3Vw
cG9ydCB0byBxdWVyeSBjb25maWd1cmF0aW9uIHVzaW5nIHV1aWQgKExpb25lbCkKCnYzOiBGaXgg
c29tZSBpbmNvbnNpc3RlbmN5IGluIHVhcGkgaGVhZGVyIChMaW9uZWwpCiAgICBGaXggdW5sb2Nr
aW5nIHdoZW4gbm90IGxvY2tlZCBpc3N1ZSAoTGlvbmVsKQogICAgQWRkIGRlYnVnIG1lc3NhZ2Vz
IChMaW9uZWwpCgp2NDogRml4IG1pc3NpbmcgdW5sb2NrIChEYW4pCgp2NTogRHJvcCBsb2NrIHdo
ZW4gY29weWluZyBjb25maWcgY29udGVudCB0byB1c2Vyc3BhY2UgKENocmlzKQoKdjY6IERyb3Ag
bG9jayB3aGVuIGNvcHlpbmcgY29uZmlnIGxpc3QgdG8gdXNlcnNwYWNlIChDaHJpcykKICAgIEZp
eCBkZWFkbG9jayB3aGVuIGNhbGxpbmcgaTkxNV9wZXJmX2dldF9vYV9jb25maWcoKSB1bmRlcgog
ICAgcGVyZi5tZXRyaWNzX2xvY2sgKExpb25lbCkKICAgIEFkZCBpOTE1X29hX2NvbmZpZ19nZXQo
KSAoQ2hyaXMpCgp2NzogUmV0dXJuIC1FRkFVTFQgbm90IHRoZSB2YWx1ZSBvZiBjb3B5X3RvX3Vz
ZXIoKSB3aGVuIGl0IGZhaWxzIChEYW4pCgpTaWduZWQtb2ZmLWJ5OiBMaW9uZWwgTGFuZHdlcmxp
biA8bGlvbmVsLmcubGFuZHdlcmxpbkBpbnRlbC5jb20+ClJldmlld2VkLWJ5OiBDaHJpcyBXaWxz
b24gPGNocmlzQGNocmlzLXdpbHNvbi5jby51az4KLS0tCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9p
OTE1X2Rydi5oICAgfCAgIDYgKwogZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9wZXJmLmMgIHwg
ICAzICsKIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfcXVlcnkuYyB8IDI4MyArKysrKysrKysr
KysrKysrKysrKysrKysrKysrKysKIGluY2x1ZGUvdWFwaS9kcm0vaTkxNV9kcm0uaCAgICAgICB8
ICA2NSArKysrKystCiA0IGZpbGVzIGNoYW5nZWQsIDM1NCBpbnNlcnRpb25zKCspLCAzIGRlbGV0
aW9ucygtKQoKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZHJ2LmggYi9k
cml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2Rydi5oCmluZGV4IGQxOGUxMmFkYTRlMS4uMDRkNTM4
ZGNjM2MxIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2Rydi5oCisrKyBi
L2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZHJ2LmgKQEAgLTE3MDQsNiArMTcwNCwxMiBAQCBz
dHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSB7CiAJCSAqLwogCQlzdHJ1Y3QgaWRyIG1ldHJpY3NfaWRy
OwogCisJCS8qCisJCSAqIE51bWJlciBvZiBkeW5hbWljIGNvbmZpZ3VyYXRpb25zLCB5b3UgbmVl
ZCB0byBob2xkCisJCSAqIGRldl9wcml2LT5wZXJmLm1ldHJpY3NfbG9jayB0byBhY2Nlc3MgaXQu
CisJCSAqLworCQl1MzIgbl9tZXRyaWNzOworCiAJCS8qCiAJCSAqIExvY2sgYXNzb2NpYXRlZCB3
aXRoIGFueXRoaW5nIGJlbG93IHdpdGhpbiB0aGlzIHN0cnVjdHVyZQogCQkgKiBleGNlcHQgZXhj
bHVzaXZlX3N0cmVhbS4KZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfcGVy
Zi5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9wZXJmLmMKaW5kZXggN2FkYzUxODkxMmJi
Li4zNzJjZGYyZTdlYzggMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfcGVy
Zi5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfcGVyZi5jCkBAIC0zOTE1LDYgKzM5
MTUsOCBAQCBpbnQgaTkxNV9wZXJmX2FkZF9jb25maWdfaW9jdGwoc3RydWN0IGRybV9kZXZpY2Ug
KmRldiwgdm9pZCAqZGF0YSwKIAkJZ290byBzeXNmc19lcnI7CiAJfQogCisJZGV2X3ByaXYtPnBl
cmYubl9tZXRyaWNzKys7CisKIAltdXRleF91bmxvY2soJmRldl9wcml2LT5wZXJmLm1ldHJpY3Nf
bG9jayk7CiAKIAlEUk1fREVCVUcoIkFkZGVkIGNvbmZpZyAlcyBpZD0laVxuIiwgb2FfY29uZmln
LT51dWlkLCBvYV9jb25maWctPmlkKTsKQEAgLTM5NzUsNiArMzk3Nyw3IEBAIGludCBpOTE1X3Bl
cmZfcmVtb3ZlX2NvbmZpZ19pb2N0bChzdHJ1Y3QgZHJtX2RldmljZSAqZGV2LCB2b2lkICpkYXRh
LAogCQkJICAgJm9hX2NvbmZpZy0+c3lzZnNfbWV0cmljKTsKIAogCWlkcl9yZW1vdmUoJmRldl9w
cml2LT5wZXJmLm1ldHJpY3NfaWRyLCAqYXJnKTsKKwlkZXZfcHJpdi0+cGVyZi5uX21ldHJpY3Mt
LTsKIAogCW11dGV4X3VubG9jaygmZGV2X3ByaXYtPnBlcmYubWV0cmljc19sb2NrKTsKIApkaWZm
IC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9xdWVyeS5jIGIvZHJpdmVycy9ncHUv
ZHJtL2k5MTUvaTkxNV9xdWVyeS5jCmluZGV4IGFiYWM1MDQyZGEyYi4uMWFjNDkyMzQ1NDNiIDEw
MDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3F1ZXJ5LmMKKysrIGIvZHJpdmVy
cy9ncHUvZHJtL2k5MTUvaTkxNV9xdWVyeS5jCkBAIC03LDYgKzcsNyBAQAogI2luY2x1ZGUgPGxp
bnV4L25vc3BlYy5oPgogCiAjaW5jbHVkZSAiaTkxNV9kcnYuaCIKKyNpbmNsdWRlICJpOTE1X3Bl
cmYuaCIKICNpbmNsdWRlICJpOTE1X3F1ZXJ5LmgiCiAjaW5jbHVkZSA8dWFwaS9kcm0vaTkxNV9k
cm0uaD4KIApAQCAtMTQwLDEwICsxNDEsMjkyIEBAIHF1ZXJ5X2VuZ2luZV9pbmZvKHN0cnVjdCBk
cm1faTkxNV9wcml2YXRlICppOTE1LAogCXJldHVybiBsZW47CiB9CiAKK3N0YXRpYyBpbnQgY2Fu
X2NvcHlfcGVyZl9jb25maWdfcmVnaXN0ZXJzX29yX251bWJlcih1MzIgdXNlcl9uX3JlZ3MsCisJ
CQkJCQkgICAgdTY0IHVzZXJfcmVnc19wdHIsCisJCQkJCQkgICAgdTMyIGtlcm5lbF9uX3JlZ3Mp
Cit7CisJLyoKKwkgKiBXZSdsbCBqdXN0IHB1dCB0aGUgbnVtYmVyIG9mIHJlZ2lzdGVycywgYW5k
IHdvbid0IGNvcHkgdGhlCisJICogcmVnaXN0ZXIuCisJICovCisJaWYgKHVzZXJfbl9yZWdzID09
IDApCisJCXJldHVybiAwOworCisJaWYgKHVzZXJfbl9yZWdzIDwga2VybmVsX25fcmVncykKKwkJ
cmV0dXJuIC1FSU5WQUw7CisKKwlpZiAoIWFjY2Vzc19vayh1NjRfdG9fdXNlcl9wdHIodXNlcl9y
ZWdzX3B0ciksCisJCSAgICAgICAyICogc2l6ZW9mKHUzMikgKiBrZXJuZWxfbl9yZWdzKSkKKwkJ
cmV0dXJuIC1FRkFVTFQ7CisKKwlyZXR1cm4gMDsKK30KKworc3RhdGljIGludCBjb3B5X3BlcmZf
Y29uZmlnX3JlZ2lzdGVyc19vcl9udW1iZXIoY29uc3Qgc3RydWN0IGk5MTVfb2FfcmVnICprZXJu
ZWxfcmVncywKKwkJCQkJCXUzMiBrZXJuZWxfbl9yZWdzLAorCQkJCQkJdTY0IHVzZXJfcmVnc19w
dHIsCisJCQkJCQl1MzIgKnVzZXJfbl9yZWdzKQoreworCXUzMiByOworCisJaWYgKCp1c2VyX25f
cmVncyA9PSAwKSB7CisJCSp1c2VyX25fcmVncyA9IGtlcm5lbF9uX3JlZ3M7CisJCXJldHVybiAw
OworCX0KKworCSp1c2VyX25fcmVncyA9IGtlcm5lbF9uX3JlZ3M7CisKKwlmb3IgKHIgPSAwOyBy
IDwga2VybmVsX25fcmVnczsgcisrKSB7CisJCXUzMiBfX3VzZXIgKnVzZXJfcmVnX3B0ciA9CisJ
CQl1NjRfdG9fdXNlcl9wdHIodXNlcl9yZWdzX3B0ciArIHNpemVvZih1MzIpICogciAqIDIpOwor
CQl1MzIgX191c2VyICp1c2VyX3ZhbF9wdHIgPQorCQkJdTY0X3RvX3VzZXJfcHRyKHVzZXJfcmVn
c19wdHIgKyBzaXplb2YodTMyKSAqIHIgKiAyICsKKwkJCQkJc2l6ZW9mKHUzMikpOworCQlpbnQg
cmV0OworCisJCXJldCA9IF9fcHV0X3VzZXIoaTkxNV9tbWlvX3JlZ19vZmZzZXQoa2VybmVsX3Jl
Z3Nbcl0uYWRkciksCisJCQkJIHVzZXJfcmVnX3B0cik7CisJCWlmIChyZXQpCisJCQlyZXR1cm4g
LUVGQVVMVDsKKworCQlyZXQgPSBfX3B1dF91c2VyKGtlcm5lbF9yZWdzW3JdLnZhbHVlLCB1c2Vy
X3ZhbF9wdHIpOworCQlpZiAocmV0KQorCQkJcmV0dXJuIC1FRkFVTFQ7CisJfQorCisJcmV0dXJu
IDA7Cit9CisKK3N0YXRpYyBpbnQgcXVlcnlfcGVyZl9jb25maWdfZGF0YShzdHJ1Y3QgZHJtX2k5
MTVfcHJpdmF0ZSAqaTkxNSwKKwkJCQkgIHN0cnVjdCBkcm1faTkxNV9xdWVyeV9pdGVtICpxdWVy
eV9pdGVtLAorCQkJCSAgYm9vbCB1c2VfdXVpZCkKK3sKKwlzdHJ1Y3QgZHJtX2k5MTVfcXVlcnlf
cGVyZl9jb25maWcgX191c2VyICp1c2VyX3F1ZXJ5X2NvbmZpZ19wdHIgPQorCQl1NjRfdG9fdXNl
cl9wdHIocXVlcnlfaXRlbS0+ZGF0YV9wdHIpOworCXN0cnVjdCBkcm1faTkxNV9wZXJmX29hX2Nv
bmZpZyBfX3VzZXIgKnVzZXJfY29uZmlnX3B0ciA9CisJCXU2NF90b191c2VyX3B0cihxdWVyeV9p
dGVtLT5kYXRhX3B0ciArCisJCQkJc2l6ZW9mKHN0cnVjdCBkcm1faTkxNV9xdWVyeV9wZXJmX2Nv
bmZpZykpOworCXN0cnVjdCBkcm1faTkxNV9wZXJmX29hX2NvbmZpZyB1c2VyX2NvbmZpZzsKKwlz
dHJ1Y3QgaTkxNV9vYV9jb25maWcgKm9hX2NvbmZpZyA9IE5VTEw7CisJY2hhciB1dWlkW1VVSURf
U1RSSU5HX0xFTiArIDFdOworCXU2NCBjb25maWdfaWQ7CisJdTMyIGZsYWdzLCB0b3RhbF9zaXpl
OworCWludCByZXQ7CisKKwlpZiAoIWk5MTUtPnBlcmYuaW5pdGlhbGl6ZWQpCisJCXJldHVybiAt
RU5PREVWOworCisJdG90YWxfc2l6ZSA9IHNpemVvZihzdHJ1Y3QgZHJtX2k5MTVfcXVlcnlfcGVy
Zl9jb25maWcpICsKKwkJc2l6ZW9mKHN0cnVjdCBkcm1faTkxNV9wZXJmX29hX2NvbmZpZyk7CisK
KwlpZiAocXVlcnlfaXRlbS0+bGVuZ3RoID09IDApCisJCXJldHVybiB0b3RhbF9zaXplOworCisJ
aWYgKHF1ZXJ5X2l0ZW0tPmxlbmd0aCA8IHRvdGFsX3NpemUpIHsKKwkJRFJNX0RFQlVHKCJJbnZh
bGlkIHF1ZXJ5IGNvbmZpZyBkYXRhIGl0ZW0gc2l6ZT0ldSBleHBlY3RlZD0ldVxuIiwKKwkJCSAg
cXVlcnlfaXRlbS0+bGVuZ3RoLCB0b3RhbF9zaXplKTsKKwkJcmV0dXJuIC1FSU5WQUw7CisJfQor
CisJaWYgKCFhY2Nlc3Nfb2sodXNlcl9xdWVyeV9jb25maWdfcHRyLCB0b3RhbF9zaXplKSkKKwkJ
cmV0dXJuIC1FRkFVTFQ7CisKKwlpZiAoX19nZXRfdXNlcihmbGFncywgJnVzZXJfcXVlcnlfY29u
ZmlnX3B0ci0+ZmxhZ3MpKQorCQlyZXR1cm4gLUVGQVVMVDsKKworCWlmIChmbGFncyAhPSAwKQor
CQlyZXR1cm4gLUVJTlZBTDsKKworCWlmICh1c2VfdXVpZCkgeworCQlCVUlMRF9CVUdfT04oc2l6
ZW9mKHVzZXJfcXVlcnlfY29uZmlnX3B0ci0+dXVpZCkgPj0gc2l6ZW9mKHV1aWQpKTsKKworCQlt
ZW1zZXQoJnV1aWQsIDAsIHNpemVvZih1dWlkKSk7CisJCWlmIChfX2NvcHlfZnJvbV91c2VyKHV1
aWQsIHVzZXJfcXVlcnlfY29uZmlnX3B0ci0+dXVpZCwKKwkJCQkgICAgIHNpemVvZih1c2VyX3F1
ZXJ5X2NvbmZpZ19wdHItPnV1aWQpKSkKKwkJCXJldHVybiAtRUZBVUxUOworCX0gZWxzZSB7CisJ
CWlmIChfX2dldF91c2VyKGNvbmZpZ19pZCwgJnVzZXJfcXVlcnlfY29uZmlnX3B0ci0+Y29uZmln
KSkgeworCQkJcmV0dXJuIC1FRkFVTFQ7CisJCX0KKwl9CisKKwlpZiAodXNlX3V1aWQpIHsKKwkJ
c3RydWN0IGk5MTVfb2FfY29uZmlnICp0bXA7CisJCWludCBpZDsKKworCQlyZXQgPSBtdXRleF9s
b2NrX2ludGVycnVwdGlibGUoJmk5MTUtPnBlcmYubWV0cmljc19sb2NrKTsKKwkJaWYgKHJldCkK
KwkJCXJldHVybiByZXQ7CisKKwkJaWRyX2Zvcl9lYWNoX2VudHJ5KCZpOTE1LT5wZXJmLm1ldHJp
Y3NfaWRyLCB0bXAsIGlkKSB7CisJCQlpZiAoIXN0cmNtcCh0bXAtPnV1aWQsIHV1aWQpKSB7CisJ
CQkJb2FfY29uZmlnID0gaTkxNV9vYV9jb25maWdfZ2V0KHRtcCk7CisJCQkJYnJlYWs7CisJCQl9
CisJCX0KKworCQltdXRleF91bmxvY2soJmk5MTUtPnBlcmYubWV0cmljc19sb2NrKTsKKwl9IGVs
c2UgeworCQlyZXQgPSBpOTE1X3BlcmZfZ2V0X29hX2NvbmZpZyhpOTE1LCBjb25maWdfaWQsICZv
YV9jb25maWcpOworCX0KKworCWlmIChyZXQgfHwgIW9hX2NvbmZpZykKKwkJcmV0dXJuIC1FTk9F
TlQ7CisKKwlpZiAoX19jb3B5X2Zyb21fdXNlcigmdXNlcl9jb25maWcsIHVzZXJfY29uZmlnX3B0
ciwKKwkJCSAgICAgc2l6ZW9mKHVzZXJfY29uZmlnKSkpIHsKKwkJcmV0ID0gLUVGQVVMVDsKKwkJ
Z290byBvdXQ7CisJfQorCisJcmV0ID0gY2FuX2NvcHlfcGVyZl9jb25maWdfcmVnaXN0ZXJzX29y
X251bWJlcih1c2VyX2NvbmZpZy5uX2Jvb2xlYW5fcmVncywKKwkJCQkJCSAgICAgICB1c2VyX2Nv
bmZpZy5ib29sZWFuX3JlZ3NfcHRyLAorCQkJCQkJICAgICAgIG9hX2NvbmZpZy0+Yl9jb3VudGVy
X3JlZ3NfbGVuKTsKKwlpZiAocmV0KQorCQlnb3RvIG91dDsKKworCXJldCA9IGNhbl9jb3B5X3Bl
cmZfY29uZmlnX3JlZ2lzdGVyc19vcl9udW1iZXIodXNlcl9jb25maWcubl9mbGV4X3JlZ3MsCisJ
CQkJCQkgICAgICAgdXNlcl9jb25maWcuZmxleF9yZWdzX3B0ciwKKwkJCQkJCSAgICAgICBvYV9j
b25maWctPmZsZXhfcmVnc19sZW4pOworCWlmIChyZXQpCisJCWdvdG8gb3V0OworCisJcmV0ID0g
Y2FuX2NvcHlfcGVyZl9jb25maWdfcmVnaXN0ZXJzX29yX251bWJlcih1c2VyX2NvbmZpZy5uX211
eF9yZWdzLAorCQkJCQkJICAgICAgIHVzZXJfY29uZmlnLm11eF9yZWdzX3B0ciwKKwkJCQkJCSAg
ICAgICBvYV9jb25maWctPm11eF9yZWdzX2xlbik7CisJaWYgKHJldCkKKwkJZ290byBvdXQ7CisK
KwlyZXQgPSBjb3B5X3BlcmZfY29uZmlnX3JlZ2lzdGVyc19vcl9udW1iZXIob2FfY29uZmlnLT5i
X2NvdW50ZXJfcmVncywKKwkJCQkJCSAgIG9hX2NvbmZpZy0+Yl9jb3VudGVyX3JlZ3NfbGVuLAor
CQkJCQkJICAgdXNlcl9jb25maWcuYm9vbGVhbl9yZWdzX3B0ciwKKwkJCQkJCSAgICZ1c2VyX2Nv
bmZpZy5uX2Jvb2xlYW5fcmVncyk7CisJaWYgKHJldCkKKwkJZ290byBvdXQ7CisKKwlyZXQgPSBj
b3B5X3BlcmZfY29uZmlnX3JlZ2lzdGVyc19vcl9udW1iZXIob2FfY29uZmlnLT5mbGV4X3JlZ3Ms
CisJCQkJCQkgICBvYV9jb25maWctPmZsZXhfcmVnc19sZW4sCisJCQkJCQkgICB1c2VyX2NvbmZp
Zy5mbGV4X3JlZ3NfcHRyLAorCQkJCQkJICAgJnVzZXJfY29uZmlnLm5fZmxleF9yZWdzKTsKKwlp
ZiAocmV0KQorCQlnb3RvIG91dDsKKworCXJldCA9IGNvcHlfcGVyZl9jb25maWdfcmVnaXN0ZXJz
X29yX251bWJlcihvYV9jb25maWctPm11eF9yZWdzLAorCQkJCQkJICAgb2FfY29uZmlnLT5tdXhf
cmVnc19sZW4sCisJCQkJCQkgICB1c2VyX2NvbmZpZy5tdXhfcmVnc19wdHIsCisJCQkJCQkgICAm
dXNlcl9jb25maWcubl9tdXhfcmVncyk7CisJaWYgKHJldCkKKwkJZ290byBvdXQ7CisKKwltZW1j
cHkodXNlcl9jb25maWcudXVpZCwgb2FfY29uZmlnLT51dWlkLCBzaXplb2YodXNlcl9jb25maWcu
dXVpZCkpOworCisJaWYgKF9fY29weV90b191c2VyKHVzZXJfY29uZmlnX3B0ciwgJnVzZXJfY29u
ZmlnLAorCQkJICAgc2l6ZW9mKHVzZXJfY29uZmlnKSkpIHsKKwkJcmV0ID0gLUVGQVVMVDsKKwkJ
Z290byBvdXQ7CisJfQorCisJcmV0ID0gdG90YWxfc2l6ZTsKKworb3V0OgorCWk5MTVfb2FfY29u
ZmlnX3B1dChvYV9jb25maWcpOworCisJcmV0dXJuIHJldDsKK30KKworc3RhdGljIGludCBxdWVy
eV9wZXJmX2NvbmZpZ19saXN0KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LAorCQkJCSAg
c3RydWN0IGRybV9pOTE1X3F1ZXJ5X2l0ZW0gKnF1ZXJ5X2l0ZW0pCit7CisJc3RydWN0IGRybV9p
OTE1X3F1ZXJ5X3BlcmZfY29uZmlnIF9fdXNlciAqdXNlcl9xdWVyeV9jb25maWdfcHRyID0KKwkJ
dTY0X3RvX3VzZXJfcHRyKHF1ZXJ5X2l0ZW0tPmRhdGFfcHRyKTsKKwlzdHJ1Y3QgaTkxNV9vYV9j
b25maWcgKm9hX2NvbmZpZzsKKwl1MzIgZmxhZ3MsIHRvdGFsX3NpemU7CisJdTY0IGksIG5fY29u
ZmlncywgKm9hX2NvbmZpZ19pZHM7CisJaW50IHJldCwgaWQ7CisKKwlpZiAoIWk5MTUtPnBlcmYu
aW5pdGlhbGl6ZWQpCisJCXJldHVybiAtRU5PREVWOworCisJLyogQ291bnQgdGhlIGRlZmF1bHQg
dGVzdCBjb25maWd1cmF0aW9uICovCisJbl9jb25maWdzID0gaTkxNS0+cGVyZi5uX21ldHJpY3Mg
KyAxOworCXRvdGFsX3NpemUgPSBzaXplb2Yoc3RydWN0IGRybV9pOTE1X3F1ZXJ5X3BlcmZfY29u
ZmlnKSArCisJCXNpemVvZih1NjQpICogbl9jb25maWdzOworCisJaWYgKHF1ZXJ5X2l0ZW0tPmxl
bmd0aCA9PSAwKQorCQlyZXR1cm4gdG90YWxfc2l6ZTsKKworCWlmIChxdWVyeV9pdGVtLT5sZW5n
dGggPCB0b3RhbF9zaXplKSB7CisJCURSTV9ERUJVRygiSW52YWxpZCBxdWVyeSBjb25maWcgbGlz
dCBpdGVtIHNpemU9JXUgZXhwZWN0ZWQ9JXVcbiIsCisJCQkgIHF1ZXJ5X2l0ZW0tPmxlbmd0aCwg
dG90YWxfc2l6ZSk7CisJCXJldHVybiAtRUlOVkFMOworCX0KKworCWlmICghYWNjZXNzX29rKHVz
ZXJfcXVlcnlfY29uZmlnX3B0ciwgdG90YWxfc2l6ZSkpCisJCXJldHVybiAtRUZBVUxUOworCisJ
aWYgKF9fZ2V0X3VzZXIoZmxhZ3MsICZ1c2VyX3F1ZXJ5X2NvbmZpZ19wdHItPmZsYWdzKSkKKwkJ
cmV0dXJuIC1FRkFVTFQ7CisKKwlpZiAoZmxhZ3MgIT0gMCkKKwkJcmV0dXJuIC1FSU5WQUw7CisK
KwlpZiAoX19wdXRfdXNlcihuX2NvbmZpZ3MsICZ1c2VyX3F1ZXJ5X2NvbmZpZ19wdHItPmNvbmZp
ZykpCisJCXJldHVybiAtRUZBVUxUOworCisJcmV0ID0gbXV0ZXhfbG9ja19pbnRlcnJ1cHRpYmxl
KCZpOTE1LT5wZXJmLm1ldHJpY3NfbG9jayk7CisJaWYgKHJldCkKKwkJcmV0dXJuIHJldDsKKwor
CS8qIENvdW50IHRoZSBjb25maWdzLiAqLworCW5fY29uZmlncyA9IDE7CisJaWRyX2Zvcl9lYWNo
X2VudHJ5KCZpOTE1LT5wZXJmLm1ldHJpY3NfaWRyLCBvYV9jb25maWcsIGlkKQorCQluX2NvbmZp
Z3MrKzsKKworCW9hX2NvbmZpZ19pZHMgPQorCQlrbWFsbG9jX2FycmF5KG5fY29uZmlncywgc2l6
ZW9mKCpvYV9jb25maWdfaWRzKSwgR0ZQX0tFUk5FTCk7CisJaWYgKCFvYV9jb25maWdfaWRzKSB7
CisJCW11dGV4X3VubG9jaygmaTkxNS0+cGVyZi5tZXRyaWNzX2xvY2spOworCQlyZXR1cm4gLUVO
T01FTTsKKwl9CisKKwlpID0gMDsKKwlvYV9jb25maWdfaWRzW2krK10gPSAxdWxsOworCWlkcl9m
b3JfZWFjaF9lbnRyeSgmaTkxNS0+cGVyZi5tZXRyaWNzX2lkciwgb2FfY29uZmlnLCBpZCkKKwkJ
b2FfY29uZmlnX2lkc1tpKytdID0gaWQ7CisKKwltdXRleF91bmxvY2soJmk5MTUtPnBlcmYubWV0
cmljc19sb2NrKTsKKworCXJldCA9IGNvcHlfdG9fdXNlcih1NjRfdG9fdXNlcl9wdHIocXVlcnlf
aXRlbS0+ZGF0YV9wdHIgKworCQkJCQkgICBzaXplb2Yoc3RydWN0IGRybV9pOTE1X3F1ZXJ5X3Bl
cmZfY29uZmlnKSksCisJCQkgICBvYV9jb25maWdfaWRzLAorCQkJICAgbl9jb25maWdzICogc2l6
ZW9mKCpvYV9jb25maWdfaWRzKSk7CisJa2ZyZWUob2FfY29uZmlnX2lkcyk7CisJaWYgKHJldCkK
KwkJcmV0dXJuIC1FRkFVTFQ7CisKKwlyZXR1cm4gdG90YWxfc2l6ZTsKK30KKworc3RhdGljIGlu
dCBxdWVyeV9wZXJmX2NvbmZpZyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwKKwkJCSAg
ICAgc3RydWN0IGRybV9pOTE1X3F1ZXJ5X2l0ZW0gKnF1ZXJ5X2l0ZW0pCit7CisJc3dpdGNoIChx
dWVyeV9pdGVtLT5mbGFncykgeworCWNhc2UgRFJNX0k5MTVfUVVFUllfUEVSRl9DT05GSUdfTElT
VDoKKwkJcmV0dXJuIHF1ZXJ5X3BlcmZfY29uZmlnX2xpc3QoaTkxNSwgcXVlcnlfaXRlbSk7CisJ
Y2FzZSBEUk1fSTkxNV9RVUVSWV9QRVJGX0NPTkZJR19EQVRBX0ZPUl9VVUlEOgorCQlyZXR1cm4g
cXVlcnlfcGVyZl9jb25maWdfZGF0YShpOTE1LCBxdWVyeV9pdGVtLCB0cnVlKTsKKwljYXNlIERS
TV9JOTE1X1FVRVJZX1BFUkZfQ09ORklHX0RBVEFfRk9SX0lEOgorCQlyZXR1cm4gcXVlcnlfcGVy
Zl9jb25maWdfZGF0YShpOTE1LCBxdWVyeV9pdGVtLCBmYWxzZSk7CisJZGVmYXVsdDoKKwkJcmV0
dXJuIC1FSU5WQUw7CisJfQorfQorCiBzdGF0aWMgaW50ICgqIGNvbnN0IGk5MTVfcXVlcnlfZnVu
Y3NbXSkoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAogCQkJCQlzdHJ1Y3QgZHJt
X2k5MTVfcXVlcnlfaXRlbSAqcXVlcnlfaXRlbSkgPSB7CiAJcXVlcnlfdG9wb2xvZ3lfaW5mbywK
IAlxdWVyeV9lbmdpbmVfaW5mbywKKwlxdWVyeV9wZXJmX2NvbmZpZywKIH07CiAKIGludCBpOTE1
X3F1ZXJ5X2lvY3RsKHN0cnVjdCBkcm1fZGV2aWNlICpkZXYsIHZvaWQgKmRhdGEsIHN0cnVjdCBk
cm1fZmlsZSAqZmlsZSkKZGlmZiAtLWdpdCBhL2luY2x1ZGUvdWFwaS9kcm0vaTkxNV9kcm0uaCBi
L2luY2x1ZGUvdWFwaS9kcm0vaTkxNV9kcm0uaAppbmRleCA1ODUwZDY4MzI3ZWMuLjJlNzIxNTk4
OWRmMiAxMDA2NDQKLS0tIGEvaW5jbHVkZS91YXBpL2RybS9pOTE1X2RybS5oCisrKyBiL2luY2x1
ZGUvdWFwaS9kcm0vaTkxNV9kcm0uaApAQCAtMTAzNyw4ICsxMDM3LDcgQEAgZW51bSBkcm1faTkx
NV9nZW1fZXhlY2J1ZmZlcl9leHQgewogCURSTV9JOTE1X0dFTV9FWEVDQlVGRkVSX0VYVF9USU1F
TElORV9GRU5DRVMgPSAxLAogCiAJLyoqCi0JICogVGhpcyBpZGVudGlmaWVyIGlzIGFzc29jaWF0
ZWQgd2l0aAotCSAqIGRybV9pOTE1X2dlbV9leGVjYnVmZmVyX3BlcmZfZXh0LgorCSAqIFNlZSBk
cm1faTkxNV9nZW1fZXhlY2J1ZmZlcl9wZXJmX2V4dC4KIAkgKi8KIAlEUk1fSTkxNV9HRU1fRVhF
Q0JVRkZFUl9FWFRfUEVSRiwKIApAQCAtMjExMyw2ICsyMTEyLDcgQEAgc3RydWN0IGRybV9pOTE1
X3F1ZXJ5X2l0ZW0gewogCV9fdTY0IHF1ZXJ5X2lkOwogI2RlZmluZSBEUk1fSTkxNV9RVUVSWV9U
T1BPTE9HWV9JTkZPICAgIDEKICNkZWZpbmUgRFJNX0k5MTVfUVVFUllfRU5HSU5FX0lORk8JMgor
I2RlZmluZSBEUk1fSTkxNV9RVUVSWV9QRVJGX0NPTkZJRyAgICAgIDMKIC8qIE11c3QgYmUga2Vw
dCBjb21wYWN0IC0tIG5vIGhvbGVzIGFuZCB3ZWxsIGRvY3VtZW50ZWQgKi8KIAogCS8qCkBAIC0y
MTI0LDkgKzIxMjQsMTggQEAgc3RydWN0IGRybV9pOTE1X3F1ZXJ5X2l0ZW0gewogCV9fczMyIGxl
bmd0aDsKIAogCS8qCi0JICogVW51c2VkIGZvciBub3cuIE11c3QgYmUgY2xlYXJlZCB0byB6ZXJv
LgorCSAqIFdoZW4gcXVlcnlfaWQgPT0gRFJNX0k5MTVfUVVFUllfVE9QT0xPR1lfSU5GTywgbXVz
dCBiZSAwLgorCSAqCisJICogV2hlbiBxdWVyeV9pZCA9PSBEUk1fSTkxNV9RVUVSWV9QRVJGX0NP
TkZJRywgbXVzdCBiZSBvbmUgb2YgdGhlCisJICogZm9sbG93aW5nIDoKKwkgKiAgICAgICAgIC0g
RFJNX0k5MTVfUVVFUllfUEVSRl9DT05GSUdfTElTVAorCSAqICAgICAgICAgLSBEUk1fSTkxNV9R
VUVSWV9QRVJGX0NPTkZJR19EQVRBX0ZPUl9VVUlECisJICogICAgICAgICAtIERSTV9JOTE1X1FV
RVJZX1BFUkZfQ09ORklHX0ZPUl9VVUlECiAJICovCiAJX191MzIgZmxhZ3M7CisjZGVmaW5lIERS
TV9JOTE1X1FVRVJZX1BFUkZfQ09ORklHX0xJU1QgICAgICAgICAgMQorI2RlZmluZSBEUk1fSTkx
NV9RVUVSWV9QRVJGX0NPTkZJR19EQVRBX0ZPUl9VVUlEIDIKKyNkZWZpbmUgRFJNX0k5MTVfUVVF
UllfUEVSRl9DT05GSUdfREFUQV9GT1JfSUQgICAzCiAKIAkvKgogCSAqIERhdGEgd2lsbCBiZSB3
cml0dGVuIGF0IHRoZSBsb2NhdGlvbiBwb2ludGVkIGJ5IGRhdGFfcHRyIHdoZW4gdGhlCkBAIC0y
MjUyLDYgKzIyNjEsNTYgQEAgc3RydWN0IGRybV9pOTE1X3F1ZXJ5X2VuZ2luZV9pbmZvIHsKIAlz
dHJ1Y3QgZHJtX2k5MTVfZW5naW5lX2luZm8gZW5naW5lc1tdOwogfTsKIAorLyoKKyAqIERhdGEg
d3JpdHRlbiBieSB0aGUga2VybmVsIHdpdGggcXVlcnkgRFJNX0k5MTVfUVVFUllfUEVSRl9DT05G
SUcuCisgKi8KK3N0cnVjdCBkcm1faTkxNV9xdWVyeV9wZXJmX2NvbmZpZyB7CisJdW5pb24gewor
CQkvKgorCQkgKiBXaGVuIHF1ZXJ5X2l0ZW0uZmxhZ3MgPT0gRFJNX0k5MTVfUVVFUllfUEVSRl9D
T05GSUdfTElTVCwgaTkxNSBzZXRzCisJCSAqIHRoaXMgZmllbGRzIHRvIHRoZSBudW1iZXIgb2Yg
Y29uZmlndXJhdGlvbnMgYXZhaWxhYmxlLgorCQkgKi8KKwkJX191NjQgbl9jb25maWdzOworCisJ
CS8qCisJCSAqIFdoZW4gcXVlcnlfaWQgPT0gRFJNX0k5MTVfUVVFUllfUEVSRl9DT05GSUdfREFU
QV9GT1JfSUQsCisJCSAqIGk5MTUgd2lsbCB1c2UgdGhlIHZhbHVlIGluIHRoaXMgZmllbGQgYXMg
Y29uZmlndXJhdGlvbgorCQkgKiBpZGVudGlmaWVyIHRvIGRlY2lkZSB3aGF0IGRhdGEgdG8gd3Jp
dGUgaW50byBjb25maWdfcHRyLgorCQkgKi8KKwkJX191NjQgY29uZmlnOworCisJCS8qCisJCSAq
IFdoZW4gcXVlcnlfaWQgPT0gRFJNX0k5MTVfUVVFUllfUEVSRl9DT05GSUdfREFUQV9GT1JfVVVJ
RCwKKwkJICogaTkxNSB3aWxsIHVzZSB0aGUgdmFsdWUgaW4gdGhpcyBmaWVsZCBhcyBjb25maWd1
cmF0aW9uCisJCSAqIGlkZW50aWZpZXIgdG8gZGVjaWRlIHdoYXQgZGF0YSB0byB3cml0ZSBpbnRv
IGNvbmZpZ19wdHIuCisJCSAqCisJCSAqIFN0cmluZyBmb3JtYXR0ZWQgbGlrZSAiJTA4eC0lMDR4
LSUwNHgtJTA0eC0lMDEyeCIKKwkJICovCisJCWNoYXIgdXVpZFszNl07CisJfTsKKworCS8qCisJ
ICogVW51c2VkIGZvciBub3cuIE11c3QgYmUgY2xlYXJlZCB0byB6ZXJvLgorCSAqLworCV9fdTMy
IGZsYWdzOworCisJLyoKKwkgKiBXaGVuIHF1ZXJ5X2l0ZW0uZmxhZ3MgPT0gRFJNX0k5MTVfUVVF
UllfUEVSRl9DT05GSUdfTElTVCwgaTkxNSB3aWxsCisJICogd3JpdGUgYW4gYXJyYXkgb2YgX191
NjQgb2YgY29uZmlndXJhdGlvbiBpZGVudGlmaWVycy4KKwkgKgorCSAqIFdoZW4gcXVlcnlfaXRl
bS5mbGFncyA9PSBEUk1fSTkxNV9RVUVSWV9QRVJGX0NPTkZJR19EQVRBLCBpOTE1IHdpbGwKKwkg
KiB3cml0ZSBhIHN0cnVjdCBkcm1faTkxNV9wZXJmX29hX2NvbmZpZy4gSWYgdGhlIGZvbGxvd2lu
ZyBmaWVsZHMgb2YKKwkgKiBkcm1faTkxNV9wZXJmX29hX2NvbmZpZyBhcmUgc2V0IG5vdCBzZXQg
dG8gMCwgaTkxNSB3aWxsIHdyaXRlIGludG8KKwkgKiB0aGUgYXNzb2NpYXRlZCBwb2ludGVycyB0
aGUgdmFsdWVzIG9mIHN1Ym1pdHRlZCB3aGVuIHRoZQorCSAqIGNvbmZpZ3VyYXRpb24gd2FzIGNy
ZWF0ZWQgOgorCSAqCisJICogICAgICAgICAtIG5fbXV4X3JlZ3MKKwkgKiAgICAgICAgIC0gbl9i
b29sZWFuX3JlZ3MKKwkgKiAgICAgICAgIC0gbl9mbGV4X3JlZ3MKKwkgKi8KKwlfX3U4IGRhdGFb
XTsKK307CisKICNpZiBkZWZpbmVkKF9fY3BsdXNwbHVzKQogfQogI2VuZGlmCi0tIAoyLjIzLjAK
Cl9fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fCkludGVsLWdm
eCBtYWlsaW5nIGxpc3QKSW50ZWwtZ2Z4QGxpc3RzLmZyZWVkZXNrdG9wLm9yZwpodHRwczovL2xp
c3RzLmZyZWVkZXNrdG9wLm9yZy9tYWlsbWFuL2xpc3RpbmZvL2ludGVsLWdmeA==

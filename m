Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 632E7EF880
	for <lists+intel-gfx@lfdr.de>; Tue,  5 Nov 2019 10:21:37 +0100 (CET)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 5AB746E94A;
	Tue,  5 Nov 2019 09:21:31 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from fireflyinternet.com (mail.fireflyinternet.com [109.228.58.192])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 758416E949
 for <intel-gfx@lists.freedesktop.org>; Tue,  5 Nov 2019 09:21:29 +0000 (UTC)
X-Default-Received-SPF: pass (skip=forwardok (res=PASS))
 x-ip-name=78.156.65.138; 
Received: from haswell.alporthouse.com (unverified [78.156.65.138]) 
 by fireflyinternet.com (Firefly Internet (M1)) with ESMTP id 19084825-1500050 
 for multiple; Tue, 05 Nov 2019 09:21:17 +0000
From: Chris Wilson <chris@chris-wilson.co.uk>
To: intel-gfx@lists.freedesktop.org
Date: Tue,  5 Nov 2019 09:21:14 +0000
Message-Id: <20191105092115.11451-9-chris@chris-wilson.co.uk>
X-Mailer: git-send-email 2.24.0
In-Reply-To: <20191105092115.11451-1-chris@chris-wilson.co.uk>
References: <20191105092115.11451-1-chris@chris-wilson.co.uk>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH 09/10] drm/i915/gt: Pull GT initialisation under
 intel_gt_init()
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

QmVnaW4gcHVsbGluZyB0aGUgR1Qgc2V0dXAgdW5kZXJuZWF0aCBhIHNpbmdsZSBHVCB1bWJyZWxs
YTsgbGV0IGludGVsX2d0CnRha2Ugb3duZXJzaGlwIG9mIGl0cyBlbmdpbmVzISBBcyBoaW50ZWQs
IHRoZSBjb21wbGljYXRpb24gaXMgdGhlCmxpZmV0aW1lIG9mIHRoZSBwcm9iZWQgZW5naW5lIHZl
cnN1cyB0aGUgYWN0aXZlIGxpZmV0aW1lIG9mIHRoZSBHVApiYWNrZW5kcy4gV2UgbmVlZCB0byBk
ZXRlY3QgdGhlIGVuZ2luZSBsYXlvdXQgZWFybHkgYW5kIGtlZXAgaXQgdW50aWwKdGhlIGVuZCBz
byB0aGF0IHdlIGNhbiBzYW5pdGl6ZSBzdGF0ZSBvbiB0YWtlb3ZlciBhbmQgcmVsZWFzZS4KClNp
Z25lZC1vZmYtYnk6IENocmlzIFdpbHNvbiA8Y2hyaXNAY2hyaXMtd2lsc29uLmNvLnVrPgotLS0K
IGRyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2VuZ2luZS5oICAgICAgICB8ICAgNCArLQog
ZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfZW5naW5lX2NzLmMgICAgIHwgIDQyICsrLS0K
IGRyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2VuZ2luZV90eXBlcy5oICB8ICAgMiArLQog
ZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfZ3QuYyAgICAgICAgICAgIHwgMTkzICsrKysr
KysrKysrKysrKystCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9scmMuYyAgICAgICAg
ICAgfCAgIDUgKy0KIC4uLi9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfcmluZ19zdWJtaXNzaW9uLmMg
ICB8ICAgNiArLQogLi4uL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF90aW1lbGluZV90eXBlcy5oICAg
IHwgICA0ICstCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2Rydi5jICAgICAgICAgICAgICAg
fCAgIDEgLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9nZW0uYyAgICAgICAgICAgICAgIHwg
MjAzICstLS0tLS0tLS0tLS0tLS0tLQogOSBmaWxlcyBjaGFuZ2VkLCAyMzUgaW5zZXJ0aW9ucygr
KSwgMjI1IGRlbGV0aW9ucygtKQoKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0
L2ludGVsX2VuZ2luZS5oIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfZW5naW5lLmgK
aW5kZXggYmMzYjcyYmZhOWUzLi4xMTRjNDJkMzU3NzQgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1
L2RybS9pOTE1L2d0L2ludGVsX2VuZ2luZS5oCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0
L2ludGVsX2VuZ2luZS5oCkBAIC0xODEsNyArMTgxLDkgQEAgdm9pZCBpbnRlbF9lbmdpbmVfY2xl
YW51cChzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmUpOwogaW50IGludGVsX2VuZ2luZXNf
aW5pdF9tbWlvKHN0cnVjdCBpbnRlbF9ndCAqZ3QpOwogaW50IGludGVsX2VuZ2luZXNfc2V0dXAo
c3RydWN0IGludGVsX2d0ICpndCk7CiBpbnQgaW50ZWxfZW5naW5lc19pbml0KHN0cnVjdCBpbnRl
bF9ndCAqZ3QpOwotdm9pZCBpbnRlbF9lbmdpbmVzX2NsZWFudXAoc3RydWN0IGludGVsX2d0ICpn
dCk7CisKK3ZvaWQgaW50ZWxfZW5naW5lc19yZWxlYXNlKHN0cnVjdCBpbnRlbF9ndCAqZ3QpOwor
dm9pZCBpbnRlbF9lbmdpbmVzX2ZyZWUoc3RydWN0IGludGVsX2d0ICpndCk7CiAKIGludCBpbnRl
bF9lbmdpbmVfaW5pdF9jb21tb24oc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lKTsKIHZv
aWQgaW50ZWxfZW5naW5lX2NsZWFudXBfY29tbW9uKHN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVu
Z2luZSk7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9lbmdpbmVf
Y3MuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2VuZ2luZV9jcy5jCmluZGV4IDVl
NDAwNDQ0NzhmZi4uZmYzMTM4N2I3NTUzIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkx
NS9ndC9pbnRlbF9lbmdpbmVfY3MuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRl
bF9lbmdpbmVfY3MuYwpAQCAtMzE4LDEyICszMTgsNiBAQCBzdGF0aWMgaW50IGludGVsX2VuZ2lu
ZV9zZXR1cChzdHJ1Y3QgaW50ZWxfZ3QgKmd0LCBlbnVtIGludGVsX2VuZ2luZV9pZCBpZCkKIAll
bmdpbmUtPnByb3BzLnRpbWVzbGljZV9kdXJhdGlvbl9tcyA9CiAJCUNPTkZJR19EUk1fSTkxNV9U
SU1FU0xJQ0VfRFVSQVRJT047CiAKLQkvKgotCSAqIFRvIGJlIG92ZXJyaWRkZW4gYnkgdGhlIGJh
Y2tlbmQgb24gc2V0dXAuIEhvd2V2ZXIgdG8gZmFjaWxpdGF0ZQotCSAqIGNsZWFudXAgb24gZXJy
b3IgZHVyaW5nIHNldHVwLCB3ZSBhbHdheXMgcHJvdmlkZSB0aGUgZGVzdHJveSB2ZnVuYy4KLQkg
Ki8KLQllbmdpbmUtPmRlc3Ryb3kgPSAodHlwZW9mKGVuZ2luZS0+ZGVzdHJveSkpa2ZyZWU7Ci0K
IAllbmdpbmUtPmNvbnRleHRfc2l6ZSA9IGludGVsX2VuZ2luZV9jb250ZXh0X3NpemUoZ3QtPmk5
MTUsCiAJCQkJCQkJIGVuZ2luZS0+Y2xhc3MpOwogCWlmIChXQVJOX09OKGVuZ2luZS0+Y29udGV4
dF9zaXplID4gQklUKDIwKSkpCkBAIC0zODksMjEgKzM4MywzOSBAQCBzdGF0aWMgdm9pZCBpbnRl
bF9zZXR1cF9lbmdpbmVfY2FwYWJpbGl0aWVzKHN0cnVjdCBpbnRlbF9ndCAqZ3QpCiB9CiAKIC8q
KgotICogaW50ZWxfZW5naW5lc19jbGVhbnVwKCkgLSBmcmVlIHRoZSByZXNvdXJjZXMgYWxsb2Nh
dGVkIGZvciBDb21tYW5kIFN0cmVhbWVycworICogaW50ZWxfZW5naW5lc19yZWxlYXNlKCkgLSBm
cmVlIHRoZSByZXNvdXJjZXMgYWxsb2NhdGVkIGZvciBDb21tYW5kIFN0cmVhbWVycwogICogQGd0
OiBwb2ludGVyIHRvIHN0cnVjdCBpbnRlbF9ndAogICovCi12b2lkIGludGVsX2VuZ2luZXNfY2xl
YW51cChzdHJ1Y3QgaW50ZWxfZ3QgKmd0KQordm9pZCBpbnRlbF9lbmdpbmVzX3JlbGVhc2Uoc3Ry
dWN0IGludGVsX2d0ICpndCkKIHsKIAlzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmU7CiAJ
ZW51bSBpbnRlbF9lbmdpbmVfaWQgaWQ7CiAKKwkvKiBEZWNvdXBsZSB0aGUgYmFja2VuZDsgYnV0
IGtlZXAgdGhlIGxheW91dCBmb3IgbGF0ZSBHUFUgcmVzZXRzICovCiAJZm9yX2VhY2hfZW5naW5l
KGVuZ2luZSwgZ3QsIGlkKSB7Ci0JCWVuZ2luZS0+ZGVzdHJveShlbmdpbmUpOwotCQlndC0+ZW5n
aW5lW2lkXSA9IE5VTEw7CisJCWlmICghZW5naW5lLT5yZWxlYXNlKQorCQkJY29udGludWU7CisK
KwkJZW5naW5lLT5yZWxlYXNlKGVuZ2luZSk7CisJCWVuZ2luZS0+cmVsZWFzZSA9IE5VTEw7CisK
KwkJbWVtc2V0KCZlbmdpbmUtPnJlc2V0LCAwLCBzaXplb2YoZW5naW5lLT5yZXNldCkpOworCiAJ
CWd0LT5pOTE1LT5lbmdpbmVbaWRdID0gTlVMTDsKIAl9CiB9CiAKK3ZvaWQgaW50ZWxfZW5naW5l
c19mcmVlKHN0cnVjdCBpbnRlbF9ndCAqZ3QpCit7CisJc3RydWN0IGludGVsX2VuZ2luZV9jcyAq
ZW5naW5lOworCWVudW0gaW50ZWxfZW5naW5lX2lkIGlkOworCisJZm9yX2VhY2hfZW5naW5lKGVu
Z2luZSwgZ3QsIGlkKSB7CisJCWtmcmVlKGVuZ2luZSk7CisJCWd0LT5lbmdpbmVbaWRdID0gTlVM
TDsKKwl9Cit9CisKIC8qKgogICogaW50ZWxfZW5naW5lc19pbml0X21taW8oKSAtIGFsbG9jYXRl
IGFuZCBwcmVwYXJlIHRoZSBFbmdpbmUgQ29tbWFuZCBTdHJlYW1lcnMKICAqIEBndDogcG9pbnRl
ciB0byBzdHJ1Y3QgaW50ZWxfZ3QKQEAgLTQ1NCw3ICs0NjYsNyBAQCBpbnQgaW50ZWxfZW5naW5l
c19pbml0X21taW8oc3RydWN0IGludGVsX2d0ICpndCkKIAlyZXR1cm4gMDsKIAogY2xlYW51cDoK
LQlpbnRlbF9lbmdpbmVzX2NsZWFudXAoZ3QpOworCWludGVsX2VuZ2luZXNfZnJlZShndCk7CiAJ
cmV0dXJuIGVycjsKIH0KIApAQCAtNDg3LDcgKzQ5OSw3IEBAIGludCBpbnRlbF9lbmdpbmVzX2lu
aXQoc3RydWN0IGludGVsX2d0ICpndCkKIAlyZXR1cm4gMDsKIAogY2xlYW51cDoKLQlpbnRlbF9l
bmdpbmVzX2NsZWFudXAoZ3QpOworCWludGVsX2VuZ2luZXNfcmVsZWFzZShndCk7CiAJcmV0dXJu
IGVycjsKIH0KIApAQCAtNjYxLDE2ICs2NzMsMTMgQEAgaW50IGludGVsX2VuZ2luZXNfc2V0dXAo
c3RydWN0IGludGVsX2d0ICpndCkKIAkJaWYgKGVycikKIAkJCWdvdG8gY2xlYW51cDsKIAotCQkv
KiBXZSBleHBlY3QgdGhlIGJhY2tlbmQgdG8gdGFrZSBjb250cm9sIG92ZXIgaXRzIHN0YXRlICov
Ci0JCUdFTV9CVUdfT04oZW5naW5lLT5kZXN0cm95ID09ICh0eXBlb2YoZW5naW5lLT5kZXN0cm95
KSlrZnJlZSk7Ci0KIAkJR0VNX0JVR19PTighZW5naW5lLT5jb3BzKTsKIAl9CiAKIAlyZXR1cm4g
MDsKIAogY2xlYW51cDoKLQlpbnRlbF9lbmdpbmVzX2NsZWFudXAoZ3QpOworCWludGVsX2VuZ2lu
ZXNfcmVsZWFzZShndCk7CiAJcmV0dXJuIGVycjsKIH0KIApAQCAtODI5LDYgKzgzOCw3IEBAIGlu
dCBpbnRlbF9lbmdpbmVfaW5pdF9jb21tb24oc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5l
KQogdm9pZCBpbnRlbF9lbmdpbmVfY2xlYW51cF9jb21tb24oc3RydWN0IGludGVsX2VuZ2luZV9j
cyAqZW5naW5lKQogewogCUdFTV9CVUdfT04oIWxpc3RfZW1wdHkoJmVuZ2luZS0+YWN0aXZlLnJl
cXVlc3RzKSk7CisJdGFza2xldF9raWxsKCZlbmdpbmUtPmV4ZWNsaXN0cy50YXNrbGV0KTsgLyog
Zmx1c2ggdGhlIGNhbGxiYWNrICovCiAKIAljbGVhbnVwX3N0YXR1c19wYWdlKGVuZ2luZSk7CiAK
ZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2VuZ2luZV90eXBlcy5o
IGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfZW5naW5lX3R5cGVzLmgKaW5kZXggYzVk
MTA0N2E0YmM1Li4wODVkMGZkN2RiMjQgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1
L2d0L2ludGVsX2VuZ2luZV90eXBlcy5oCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2lu
dGVsX2VuZ2luZV90eXBlcy5oCkBAIC00NDcsNyArNDQ3LDcgQEAgc3RydWN0IGludGVsX2VuZ2lu
ZV9jcyB7CiAJICovCiAJdm9pZAkJKCpjYW5jZWxfcmVxdWVzdHMpKHN0cnVjdCBpbnRlbF9lbmdp
bmVfY3MgKmVuZ2luZSk7CiAKLQl2b2lkCQkoKmRlc3Ryb3kpKHN0cnVjdCBpbnRlbF9lbmdpbmVf
Y3MgKmVuZ2luZSk7CisJdm9pZAkJKCpyZWxlYXNlKShzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICpl
bmdpbmUpOwogCiAJc3RydWN0IGludGVsX2VuZ2luZV9leGVjbGlzdHMgZXhlY2xpc3RzOwogCmRp
ZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9ndC5jIGIvZHJpdmVycy9n
cHUvZHJtL2k5MTUvZ3QvaW50ZWxfZ3QuYwppbmRleCAwMjQ4NDg2MGNhYTguLmVhOTljYzJmMzdl
NiAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfZ3QuYworKysgYi9k
cml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9ndC5jCkBAIC00LDExICs0LDEzIEBACiAgKi8K
IAogI2luY2x1ZGUgImk5MTVfZHJ2LmgiCisjaW5jbHVkZSAiaW50ZWxfY29udGV4dC5oIgogI2lu
Y2x1ZGUgImludGVsX2d0LmgiCiAjaW5jbHVkZSAiaW50ZWxfZ3RfcG0uaCIKICNpbmNsdWRlICJp
bnRlbF9ndF9yZXF1ZXN0cy5oIgogI2luY2x1ZGUgImludGVsX21vY3MuaCIKICNpbmNsdWRlICJp
bnRlbF9yYzYuaCIKKyNpbmNsdWRlICJpbnRlbF9yZW5kZXJzdGF0ZS5oIgogI2luY2x1ZGUgImlu
dGVsX3Jwcy5oIgogI2luY2x1ZGUgImludGVsX3VuY29yZS5oIgogI2luY2x1ZGUgImludGVsX3Bt
LmgiCkBAIC0zNzIsNiArMzc0LDE1MiBAQCBzdGF0aWMgc3RydWN0IGk5MTVfYWRkcmVzc19zcGFj
ZSAqa2VybmVsX3ZtKHN0cnVjdCBpbnRlbF9ndCAqZ3QpCiAJCXJldHVybiBpOTE1X3ZtX2dldCgm
Z3QtPmdndHQtPnZtKTsKIH0KIAorc3RhdGljIGludCBfX2VuZ2luZXNfcmVjb3JkX2RlZmF1bHRz
KHN0cnVjdCBpbnRlbF9ndCAqZ3QpCit7CisJc3RydWN0IGk5MTVfcmVxdWVzdCAqcmVxdWVzdHNb
STkxNV9OVU1fRU5HSU5FU10gPSB7fTsKKwlzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmU7
CisJZW51bSBpbnRlbF9lbmdpbmVfaWQgaWQ7CisJaW50IGVyciA9IDA7CisKKwkvKgorCSAqIEFz
IHdlIHJlc2V0IHRoZSBncHUgZHVyaW5nIHZlcnkgZWFybHkgc2FuaXRpc2F0aW9uLCB0aGUgY3Vy
cmVudAorCSAqIHJlZ2lzdGVyIHN0YXRlIG9uIHRoZSBHUFUgc2hvdWxkIHJlZmxlY3QgaXRzIGRl
ZmF1bHRzIHZhbHVlcy4KKwkgKiBXZSBsb2FkIGEgY29udGV4dCBvbnRvIHRoZSBodyAod2l0aCBy
ZXN0b3JlLWluaGliaXQpLCB0aGVuIHN3aXRjaAorCSAqIG92ZXIgdG8gYSBzZWNvbmQgY29udGV4
dCB0byBzYXZlIHRoYXQgZGVmYXVsdCByZWdpc3RlciBzdGF0ZS4gV2UKKwkgKiBjYW4gdGhlbiBw
cmltZSBldmVyeSBuZXcgY29udGV4dCB3aXRoIHRoYXQgc3RhdGUgc28gdGhleSBhbGwgc3RhcnQK
KwkgKiBmcm9tIHRoZSBzYW1lIGRlZmF1bHQgSFcgdmFsdWVzLgorCSAqLworCisJZm9yX2VhY2hf
ZW5naW5lKGVuZ2luZSwgZ3QsIGlkKSB7CisJCXN0cnVjdCBpbnRlbF9jb250ZXh0ICpjZTsKKwkJ
c3RydWN0IGk5MTVfcmVxdWVzdCAqcnE7CisKKwkJLyogV2UgbXVzdCBiZSBhYmxlIHRvIHN3aXRj
aCB0byBzb21ldGhpbmchICovCisJCUdFTV9CVUdfT04oIWVuZ2luZS0+a2VybmVsX2NvbnRleHQp
OworCQllbmdpbmUtPnNlcmlhbCsrOyAvKiBmb3JjZSB0aGUga2VybmVsIGNvbnRleHQgc3dpdGNo
ICovCisKKwkJY2UgPSBpbnRlbF9jb250ZXh0X2NyZWF0ZShlbmdpbmUpOworCQlpZiAoSVNfRVJS
KGNlKSkgeworCQkJZXJyID0gUFRSX0VSUihjZSk7CisJCQlnb3RvIG91dDsKKwkJfQorCisJCXJx
ID0gaW50ZWxfY29udGV4dF9jcmVhdGVfcmVxdWVzdChjZSk7CisJCWlmIChJU19FUlIocnEpKSB7
CisJCQllcnIgPSBQVFJfRVJSKHJxKTsKKwkJCWludGVsX2NvbnRleHRfcHV0KGNlKTsKKwkJCWdv
dG8gb3V0OworCQl9CisKKwkJZXJyID0gaW50ZWxfZW5naW5lX2VtaXRfY3R4X3dhKHJxKTsKKwkJ
aWYgKGVycikKKwkJCWdvdG8gZXJyX3JxOworCisJCWVyciA9IGludGVsX3JlbmRlcnN0YXRlX2Vt
aXQocnEpOworCQlpZiAoZXJyKQorCQkJZ290byBlcnJfcnE7CisKK2Vycl9ycToKKwkJcmVxdWVz
dHNbaWRdID0gaTkxNV9yZXF1ZXN0X2dldChycSk7CisJCWk5MTVfcmVxdWVzdF9hZGQocnEpOwor
CQlpZiAoZXJyKQorCQkJZ290byBvdXQ7CisJfQorCisJLyogRmx1c2ggdGhlIGRlZmF1bHQgY29u
dGV4dCBpbWFnZSB0byBtZW1vcnksIGFuZCBlbmFibGUgcG93ZXJzYXZpbmcuICovCisJaWYgKGlu
dGVsX2d0X3dhaXRfZm9yX2lkbGUoZ3QsIEk5MTVfR0VNX0lETEVfVElNRU9VVCkgPT0gLUVUSU1F
KSB7CisJCWVyciA9IC1FSU87CisJCWdvdG8gb3V0OworCX0KKworCWZvciAoaWQgPSAwOyBpZCA8
IEFSUkFZX1NJWkUocmVxdWVzdHMpOyBpZCsrKSB7CisJCXN0cnVjdCBpOTE1X3JlcXVlc3QgKnJx
OworCQlzdHJ1Y3QgaTkxNV92bWEgKnN0YXRlOworCQl2b2lkICp2YWRkcjsKKworCQlycSA9IHJl
cXVlc3RzW2lkXTsKKwkJaWYgKCFycSkKKwkJCWNvbnRpbnVlOworCisJCS8qIFdlIHdhbnQgdG8g
YmUgYWJsZSB0byB1bmJpbmQgdGhlIHN0YXRlIGZyb20gdGhlIEdHVFQgKi8KKwkJR0VNX0JVR19P
TihpbnRlbF9jb250ZXh0X2lzX3Bpbm5lZChycS0+Y29udGV4dCkpOworCisJCXN0YXRlID0gcnEt
PmNvbnRleHQtPnN0YXRlOworCQlpZiAoIXN0YXRlKQorCQkJY29udGludWU7CisKKwkJLyoKKwkJ
ICogQXMgd2Ugd2lsbCBob2xkIGEgcmVmZXJlbmNlIHRvIHRoZSBsb2dpY2FsIHN0YXRlLCBpdCB3
aWxsCisJCSAqIG5vdCBiZSB0b3JuIGRvd24gd2l0aCB0aGUgY29udGV4dCwgYW5kIGltcG9ydGFu
dGx5IHRoZQorCQkgKiBvYmplY3Qgd2lsbCBob2xkIG9udG8gaXRzIHZtYSAobWFraW5nIGl0IHBv
c3NpYmxlIGZvciBhCisJCSAqIHN0cmF5IEdUVCB3cml0ZSB0byBjb3JydXB0IG91ciBkZWZhdWx0
cykuIFVubWFwIHRoZSB2bWEKKwkJICogZnJvbSB0aGUgR1RUIHRvIHByZXZlbnQgc3VjaCBhY2Np
ZGVudHMgYW5kIHJlY2xhaW0gdGhlCisJCSAqIHNwYWNlLgorCQkgKi8KKwkJZXJyID0gaTkxNV92
bWFfdW5iaW5kKHN0YXRlKTsKKwkJaWYgKGVycikKKwkJCWdvdG8gb3V0OworCisJCWk5MTVfZ2Vt
X29iamVjdF9sb2NrKHN0YXRlLT5vYmopOworCQllcnIgPSBpOTE1X2dlbV9vYmplY3Rfc2V0X3Rv
X2NwdV9kb21haW4oc3RhdGUtPm9iaiwgZmFsc2UpOworCQlpOTE1X2dlbV9vYmplY3RfdW5sb2Nr
KHN0YXRlLT5vYmopOworCQlpZiAoZXJyKQorCQkJZ290byBvdXQ7CisKKwkJaTkxNV9nZW1fb2Jq
ZWN0X3NldF9jYWNoZV9jb2hlcmVuY3koc3RhdGUtPm9iaiwgSTkxNV9DQUNIRV9MTEMpOworCisJ
CS8qIENoZWNrIHdlIGNhbiBhY3F1aXJlIHRoZSBpbWFnZSBvZiB0aGUgY29udGV4dCBzdGF0ZSAq
LworCQl2YWRkciA9IGk5MTVfZ2VtX29iamVjdF9waW5fbWFwKHN0YXRlLT5vYmosIEk5MTVfTUFQ
X0ZPUkNFX1dCKTsKKwkJaWYgKElTX0VSUih2YWRkcikpIHsKKwkJCWVyciA9IFBUUl9FUlIodmFk
ZHIpOworCQkJZ290byBvdXQ7CisJCX0KKworCQlycS0+ZW5naW5lLT5kZWZhdWx0X3N0YXRlID0g
aTkxNV9nZW1fb2JqZWN0X2dldChzdGF0ZS0+b2JqKTsKKwkJaTkxNV9nZW1fb2JqZWN0X3VucGlu
X21hcChzdGF0ZS0+b2JqKTsKKwl9CisKK291dDoKKwkvKgorCSAqIElmIHdlIGhhdmUgdG8gYWJh
bmRvbiBub3csIHdlIGV4cGVjdCB0aGUgZW5naW5lcyB0byBiZSBpZGxlCisJICogYW5kIHJlYWR5
IHRvIGJlIHRvcm4tZG93bi4gVGhlIHF1aWNrZXN0IHdheSB3ZSBjYW4gYWNjb21wbGlzaAorCSAq
IHRoaXMgaXMgYnkgZGVjbGFyaW5nIG91cnNlbHZlcyB3ZWRnZWQuCisJICovCisJaWYgKGVycikK
KwkJaW50ZWxfZ3Rfc2V0X3dlZGdlZChndCk7CisKKwlmb3IgKGlkID0gMDsgaWQgPCBBUlJBWV9T
SVpFKHJlcXVlc3RzKTsgaWQrKykgeworCQlzdHJ1Y3QgaW50ZWxfY29udGV4dCAqY2U7CisJCXN0
cnVjdCBpOTE1X3JlcXVlc3QgKnJxOworCisJCXJxID0gcmVxdWVzdHNbaWRdOworCQlpZiAoIXJx
KQorCQkJY29udGludWU7CisKKwkJY2UgPSBycS0+Y29udGV4dDsKKwkJaTkxNV9yZXF1ZXN0X3B1
dChycSk7CisJCWludGVsX2NvbnRleHRfcHV0KGNlKTsKKwl9CisJcmV0dXJuIGVycjsKK30KKwor
c3RhdGljIGludCBfX2VuZ2luZXNfdmVyaWZ5X3dvcmthcm91bmRzKHN0cnVjdCBpbnRlbF9ndCAq
Z3QpCit7CisJc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lOworCWVudW0gaW50ZWxfZW5n
aW5lX2lkIGlkOworCWludCBlcnIgPSAwOworCisJaWYgKCFJU19FTkFCTEVEKENPTkZJR19EUk1f
STkxNV9ERUJVR19HRU0pKQorCQlyZXR1cm4gMDsKKworCWZvcl9lYWNoX2VuZ2luZShlbmdpbmUs
IGd0LCBpZCkgeworCQlpZiAoaW50ZWxfZW5naW5lX3ZlcmlmeV93b3JrYXJvdW5kcyhlbmdpbmUs
ICJsb2FkIikpCisJCQllcnIgPSAtRUlPOworCX0KKworCXJldHVybiBlcnI7Cit9CisKIGludCBp
bnRlbF9ndF9pbml0KHN0cnVjdCBpbnRlbF9ndCAqZ3QpCiB7CiAJaW50IGVycjsKQEAgLTM4OCw4
ICs1MzYsNDQgQEAgaW50IGludGVsX2d0X2luaXQoc3RydWN0IGludGVsX2d0ICpndCkKIAkJZ290
byBlcnJfc2NyYXRjaDsKIAl9CiAKKwllcnIgPSBpbnRlbF9lbmdpbmVzX3NldHVwKGd0KTsKKwlp
ZiAoZXJyKQorCQlnb3RvIGVycl92bTsKKworCWVyciA9IGludGVsX2VuZ2luZXNfaW5pdChndCk7
CisJaWYgKGVycikKKwkJZ290byBlcnJfZW5naW5lczsKKworCWludGVsX3VjX2luaXQoJmd0LT51
Yyk7CisKKwllcnIgPSBpbnRlbF9ndF9pbml0X2h3KGd0KTsKKwlpZiAoZXJyKQorCQlnb3RvIGVy
cl91Y19pbml0OworCisJLyogT25seSB3aGVuIHRoZSBIVyBpcyByZS1pbml0aWFsaXNlZCwgY2Fu
IHdlIHJlcGxheSB0aGUgcmVxdWVzdHMgKi8KKwllcnIgPSBpbnRlbF9ndF9yZXN1bWUoZ3QpOwor
CWlmIChlcnIpCisJCWdvdG8gZXJyX3VjX2luaXQ7CisKKwllcnIgPSBfX2VuZ2luZXNfcmVjb3Jk
X2RlZmF1bHRzKGd0KTsKKwlpZiAoZXJyKQorCQlnb3RvIGVycl9ndDsKKworCWVyciA9IF9fZW5n
aW5lc192ZXJpZnlfd29ya2Fyb3VuZHMoZ3QpOworCWlmIChlcnIpCisJCWdvdG8gZXJyX2d0Owor
CiAJcmV0dXJuIDA7CiAKK2Vycl9ndDoKKwlpbnRlbF9ndF9zZXRfd2VkZ2VkX29uX2luaXQoZ3Qp
OworCWludGVsX2d0X3N1c3BlbmRfbGF0ZShndCk7CitlcnJfdWNfaW5pdDoKKwlpbnRlbF91Y19m
aW5pKCZndC0+dWMpOworZXJyX2VuZ2luZXM6CisJaW50ZWxfZW5naW5lc19yZWxlYXNlKGd0KTsK
K2Vycl92bToKKwlpOTE1X3ZtX3B1dChndC0+dm0pOwogZXJyX3NjcmF0Y2g6CiAJaW50ZWxfZ3Rf
ZmluaV9zY3JhdGNoKGd0KTsKIAlyZXR1cm4gZXJyOwpAQCAtMzk3LDcgKzU4MSwxMiBAQCBpbnQg
aW50ZWxfZ3RfaW5pdChzdHJ1Y3QgaW50ZWxfZ3QgKmd0KQogCiB2b2lkIGludGVsX2d0X2RyaXZl
cl9yZW1vdmUoc3RydWN0IGludGVsX2d0ICpndCkKIHsKLQlHRU1fQlVHX09OKGd0LT5hd2FrZSk7
CisJaW50ZWxfZ3Rfc2V0X3dlZGdlZF9vbl9pbml0KGd0KTsKKwlpbnRlbF9ndF9zdXNwZW5kX2xh
dGUoZ3QpOworCisJaW50ZWxfdWNfZmluaSgmZ3QtPnVjKTsKKwlpbnRlbF9lbmdpbmVzX3JlbGVh
c2UoZ3QpOworCWludGVsX2d0X2Zpbmlfc2NyYXRjaChndCk7CiB9CiAKIHZvaWQgaW50ZWxfZ3Rf
ZHJpdmVyX3VucmVnaXN0ZXIoc3RydWN0IGludGVsX2d0ICpndCkKQEAgLTQxNSw3ICs2MDQsNiBA
QCB2b2lkIGludGVsX2d0X2RyaXZlcl9yZWxlYXNlKHN0cnVjdCBpbnRlbF9ndCAqZ3QpCiAKIAlp
OTE1X3ZtX3B1dCh2bSk7CiAJaW50ZWxfZ3RfcG1fZmluaShndCk7Ci0JaW50ZWxfZ3RfZmluaV9z
Y3JhdGNoKGd0KTsKIH0KIAogdm9pZCBpbnRlbF9ndF9kcml2ZXJfbGF0ZV9yZWxlYXNlKHN0cnVj
dCBpbnRlbF9ndCAqZ3QpCkBAIC00MjMsNCArNjExLDUgQEAgdm9pZCBpbnRlbF9ndF9kcml2ZXJf
bGF0ZV9yZWxlYXNlKHN0cnVjdCBpbnRlbF9ndCAqZ3QpCiAJaW50ZWxfdWNfZHJpdmVyX2xhdGVf
cmVsZWFzZSgmZ3QtPnVjKTsKIAlpbnRlbF9ndF9maW5pX3Jlc2V0KGd0KTsKIAlpbnRlbF9ndF9m
aW5pX3RpbWVsaW5lcyhndCk7CisJaW50ZWxfZW5naW5lc19mcmVlKGd0KTsKIH0KZGlmZiAtLWdp
dCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2xyYy5jIGIvZHJpdmVycy9ncHUvZHJt
L2k5MTUvZ3QvaW50ZWxfbHJjLmMKaW5kZXggZDI1NWU5MDdmODZjLi5mYzZjYjQxMzZmZjUgMTAw
NjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2xyYy5jCisrKyBiL2RyaXZl
cnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2xyYy5jCkBAIC0zNzQ1LDExICszNzQ1LDEwIEBAIHZv
aWQgaW50ZWxfZXhlY2xpc3RzX3NldF9kZWZhdWx0X3N1Ym1pc3Npb24oc3RydWN0IGludGVsX2Vu
Z2luZV9jcyAqZW5naW5lKQogCQllbmdpbmUtPmZsYWdzIHw9IEk5MTVfRU5HSU5FX0hBU19SRUxB
VElWRV9NTUlPOwogfQogCi1zdGF0aWMgdm9pZCBleGVjbGlzdHNfZGVzdHJveShzdHJ1Y3QgaW50
ZWxfZW5naW5lX2NzICplbmdpbmUpCitzdGF0aWMgdm9pZCBleGVjbGlzdHNfcmVsZWFzZShzdHJ1
Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmUpCiB7CiAJaW50ZWxfZW5naW5lX2NsZWFudXBfY29t
bW9uKGVuZ2luZSk7CiAJbHJjX2Rlc3Ryb3lfd2FfY3R4KGVuZ2luZSk7Ci0Ja2ZyZWUoZW5naW5l
KTsKIH0KIAogc3RhdGljIHZvaWQKQEAgLTM3NTcsNyArMzc1Niw3IEBAIGxvZ2ljYWxfcmluZ19k
ZWZhdWx0X3ZmdW5jcyhzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmUpCiB7CiAJLyogRGVm
YXVsdCB2ZnVuY3Mgd2hpY2ggY2FuIGJlIG92ZXJyaWRlbiBieSBlYWNoIGVuZ2luZS4gKi8KIAot
CWVuZ2luZS0+ZGVzdHJveSA9IGV4ZWNsaXN0c19kZXN0cm95OworCWVuZ2luZS0+cmVsZWFzZSA9
IGV4ZWNsaXN0c19yZWxlYXNlOwogCWVuZ2luZS0+cmVzdW1lID0gZXhlY2xpc3RzX3Jlc3VtZTsK
IAogCWVuZ2luZS0+cmVzZXQucHJlcGFyZSA9IGV4ZWNsaXN0c19yZXNldF9wcmVwYXJlOwpkaWZm
IC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfcmluZ19zdWJtaXNzaW9uLmMg
Yi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9yaW5nX3N1Ym1pc3Npb24uYwppbmRleCA2
ZGRmZThhODZkYmUuLjBlOTQyMWU1MmY3ZiAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5
MTUvZ3QvaW50ZWxfcmluZ19zdWJtaXNzaW9uLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUv
Z3QvaW50ZWxfcmluZ19zdWJtaXNzaW9uLmMKQEAgLTE4MTYsNyArMTgxNiw3IEBAIHN0YXRpYyB2
b2lkIGdlbjZfYnNkX3NldF9kZWZhdWx0X3N1Ym1pc3Npb24oc3RydWN0IGludGVsX2VuZ2luZV9j
cyAqZW5naW5lKQogCWVuZ2luZS0+c3VibWl0X3JlcXVlc3QgPSBnZW42X2JzZF9zdWJtaXRfcmVx
dWVzdDsKIH0KIAotc3RhdGljIHZvaWQgcmluZ19kZXN0cm95KHN0cnVjdCBpbnRlbF9lbmdpbmVf
Y3MgKmVuZ2luZSkKK3N0YXRpYyB2b2lkIHJpbmdfcmVsZWFzZShzdHJ1Y3QgaW50ZWxfZW5naW5l
X2NzICplbmdpbmUpCiB7CiAJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gZW5n
aW5lLT5pOTE1OwogCkBAIC0xODMwLDggKzE4MzAsNiBAQCBzdGF0aWMgdm9pZCByaW5nX2Rlc3Ry
b3koc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lKQogCiAJaW50ZWxfdGltZWxpbmVfdW5w
aW4oZW5naW5lLT5sZWdhY3kudGltZWxpbmUpOwogCWludGVsX3RpbWVsaW5lX3B1dChlbmdpbmUt
PmxlZ2FjeS50aW1lbGluZSk7Ci0KLQlrZnJlZShlbmdpbmUpOwogfQogCiBzdGF0aWMgdm9pZCBz
ZXR1cF9pcnEoc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lKQpAQCAtMTg2Miw3ICsxODYw
LDcgQEAgc3RhdGljIHZvaWQgc2V0dXBfY29tbW9uKHN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVu
Z2luZSkKIAogCXNldHVwX2lycShlbmdpbmUpOwogCi0JZW5naW5lLT5kZXN0cm95ID0gcmluZ19k
ZXN0cm95OworCWVuZ2luZS0+cmVsZWFzZSA9IHJpbmdfcmVsZWFzZTsKIAogCWVuZ2luZS0+cmVz
dW1lID0geGNzX3Jlc3VtZTsKIAllbmdpbmUtPnJlc2V0LnByZXBhcmUgPSByZXNldF9wcmVwYXJl
OwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfdGltZWxpbmVfdHlw
ZXMuaCBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX3RpbWVsaW5lX3R5cGVzLmgKaW5k
ZXggOThkOWVlMTY2Mzc5Li4zNGQyOGQ3NzcxZDEgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2Ry
bS9pOTE1L2d0L2ludGVsX3RpbWVsaW5lX3R5cGVzLmgKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5
MTUvZ3QvaW50ZWxfdGltZWxpbmVfdHlwZXMuaApAQCAtMTQsMTAgKzE0LDEwIEBACiAKICNpbmNs
dWRlICJpOTE1X2FjdGl2ZV90eXBlcy5oIgogCi1zdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZTsKIHN0
cnVjdCBpOTE1X3ZtYTsKLXN0cnVjdCBpbnRlbF90aW1lbGluZV9jYWNoZWxpbmU7CiBzdHJ1Y3Qg
aTkxNV9zeW5jbWFwOworc3RydWN0IGludGVsX2d0Oworc3RydWN0IGludGVsX3RpbWVsaW5lX2Nh
Y2hlbGluZTsKIAogc3RydWN0IGludGVsX3RpbWVsaW5lIHsKIAl1NjQgZmVuY2VfY29udGV4dDsK
ZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZHJ2LmMgYi9kcml2ZXJzL2dw
dS9kcm0vaTkxNS9pOTE1X2Rydi5jCmluZGV4IDgyZTRlNmJmMDhjMy4uMzNiNDhkZDQ3NjMxIDEw
MDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2Rydi5jCisrKyBiL2RyaXZlcnMv
Z3B1L2RybS9pOTE1L2k5MTVfZHJ2LmMKQEAgLTYxNyw3ICs2MTcsNiBAQCBzdGF0aWMgaW50IGk5
MTVfZHJpdmVyX21taW9fcHJvYmUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQog
ICovCiBzdGF0aWMgdm9pZCBpOTE1X2RyaXZlcl9tbWlvX3JlbGVhc2Uoc3RydWN0IGRybV9pOTE1
X3ByaXZhdGUgKmRldl9wcml2KQogewotCWludGVsX2VuZ2luZXNfY2xlYW51cCgmZGV2X3ByaXYt
Pmd0KTsKIAlpbnRlbF90ZWFyZG93bl9tY2hiYXIoZGV2X3ByaXYpOwogCWludGVsX3VuY29yZV9m
aW5pX21taW8oJmRldl9wcml2LT51bmNvcmUpOwogCXBjaV9kZXZfcHV0KGRldl9wcml2LT5icmlk
Z2VfZGV2KTsKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZ2VtLmMgYi9k
cml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2dlbS5jCmluZGV4IDA0MzUwZTYxYzg2Yy4uZGZiMmM2
YWJmOWVmIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2dlbS5jCisrKyBi
L2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZ2VtLmMKQEAgLTEwMzksMTUyICsxMDM5LDYgQEAg
aTkxNV9nZW1fbWFkdmlzZV9pb2N0bChzdHJ1Y3QgZHJtX2RldmljZSAqZGV2LCB2b2lkICpkYXRh
LAogCXJldHVybiBlcnI7CiB9CiAKLXN0YXRpYyBpbnQgX19pbnRlbF9lbmdpbmVzX3JlY29yZF9k
ZWZhdWx0cyhzdHJ1Y3QgaW50ZWxfZ3QgKmd0KQotewotCXN0cnVjdCBpOTE1X3JlcXVlc3QgKnJl
cXVlc3RzW0k5MTVfTlVNX0VOR0lORVNdID0ge307Ci0Jc3RydWN0IGludGVsX2VuZ2luZV9jcyAq
ZW5naW5lOwotCWVudW0gaW50ZWxfZW5naW5lX2lkIGlkOwotCWludCBlcnIgPSAwOwotCi0JLyoK
LQkgKiBBcyB3ZSByZXNldCB0aGUgZ3B1IGR1cmluZyB2ZXJ5IGVhcmx5IHNhbml0aXNhdGlvbiwg
dGhlIGN1cnJlbnQKLQkgKiByZWdpc3RlciBzdGF0ZSBvbiB0aGUgR1BVIHNob3VsZCByZWZsZWN0
IGl0cyBkZWZhdWx0cyB2YWx1ZXMuCi0JICogV2UgbG9hZCBhIGNvbnRleHQgb250byB0aGUgaHcg
KHdpdGggcmVzdG9yZS1pbmhpYml0KSwgdGhlbiBzd2l0Y2gKLQkgKiBvdmVyIHRvIGEgc2Vjb25k
IGNvbnRleHQgdG8gc2F2ZSB0aGF0IGRlZmF1bHQgcmVnaXN0ZXIgc3RhdGUuIFdlCi0JICogY2Fu
IHRoZW4gcHJpbWUgZXZlcnkgbmV3IGNvbnRleHQgd2l0aCB0aGF0IHN0YXRlIHNvIHRoZXkgYWxs
IHN0YXJ0Ci0JICogZnJvbSB0aGUgc2FtZSBkZWZhdWx0IEhXIHZhbHVlcy4KLQkgKi8KLQotCWZv
cl9lYWNoX2VuZ2luZShlbmdpbmUsIGd0LCBpZCkgewotCQlzdHJ1Y3QgaW50ZWxfY29udGV4dCAq
Y2U7Ci0JCXN0cnVjdCBpOTE1X3JlcXVlc3QgKnJxOwotCi0JCS8qIFdlIG11c3QgYmUgYWJsZSB0
byBzd2l0Y2ggdG8gc29tZXRoaW5nISAqLwotCQlHRU1fQlVHX09OKCFlbmdpbmUtPmtlcm5lbF9j
b250ZXh0KTsKLQkJZW5naW5lLT5zZXJpYWwrKzsgLyogZm9yY2UgdGhlIGtlcm5lbCBjb250ZXh0
IHN3aXRjaCAqLwotCi0JCWNlID0gaW50ZWxfY29udGV4dF9jcmVhdGUoZW5naW5lKTsKLQkJaWYg
KElTX0VSUihjZSkpIHsKLQkJCWVyciA9IFBUUl9FUlIoY2UpOwotCQkJZ290byBvdXQ7Ci0JCX0K
LQotCQlycSA9IGludGVsX2NvbnRleHRfY3JlYXRlX3JlcXVlc3QoY2UpOwotCQlpZiAoSVNfRVJS
KHJxKSkgewotCQkJZXJyID0gUFRSX0VSUihycSk7Ci0JCQlpbnRlbF9jb250ZXh0X3B1dChjZSk7
Ci0JCQlnb3RvIG91dDsKLQkJfQotCi0JCWVyciA9IGludGVsX2VuZ2luZV9lbWl0X2N0eF93YShy
cSk7Ci0JCWlmIChlcnIpCi0JCQlnb3RvIGVycl9ycTsKLQotCQllcnIgPSBpbnRlbF9yZW5kZXJz
dGF0ZV9lbWl0KHJxKTsKLQkJaWYgKGVycikKLQkJCWdvdG8gZXJyX3JxOwotCi1lcnJfcnE6Ci0J
CXJlcXVlc3RzW2lkXSA9IGk5MTVfcmVxdWVzdF9nZXQocnEpOwotCQlpOTE1X3JlcXVlc3RfYWRk
KHJxKTsKLQkJaWYgKGVycikKLQkJCWdvdG8gb3V0OwotCX0KLQotCS8qIEZsdXNoIHRoZSBkZWZh
dWx0IGNvbnRleHQgaW1hZ2UgdG8gbWVtb3J5LCBhbmQgZW5hYmxlIHBvd2Vyc2F2aW5nLiAqLwot
CWlmIChpbnRlbF9ndF93YWl0X2Zvcl9pZGxlKGd0LCBJOTE1X0dFTV9JRExFX1RJTUVPVVQpID09
IC1FVElNRSkgewotCQllcnIgPSAtRUlPOwotCQlnb3RvIG91dDsKLQl9Ci0KLQlmb3IgKGlkID0g
MDsgaWQgPCBBUlJBWV9TSVpFKHJlcXVlc3RzKTsgaWQrKykgewotCQlzdHJ1Y3QgaTkxNV9yZXF1
ZXN0ICpycTsKLQkJc3RydWN0IGk5MTVfdm1hICpzdGF0ZTsKLQkJdm9pZCAqdmFkZHI7Ci0KLQkJ
cnEgPSByZXF1ZXN0c1tpZF07Ci0JCWlmICghcnEpCi0JCQljb250aW51ZTsKLQotCQkvKiBXZSB3
YW50IHRvIGJlIGFibGUgdG8gdW5iaW5kIHRoZSBzdGF0ZSBmcm9tIHRoZSBHR1RUICovCi0JCUdF
TV9CVUdfT04oaW50ZWxfY29udGV4dF9pc19waW5uZWQocnEtPmNvbnRleHQpKTsKLQotCQlzdGF0
ZSA9IHJxLT5jb250ZXh0LT5zdGF0ZTsKLQkJaWYgKCFzdGF0ZSkKLQkJCWNvbnRpbnVlOwotCi0J
CS8qCi0JCSAqIEFzIHdlIHdpbGwgaG9sZCBhIHJlZmVyZW5jZSB0byB0aGUgbG9naWNhbCBzdGF0
ZSwgaXQgd2lsbAotCQkgKiBub3QgYmUgdG9ybiBkb3duIHdpdGggdGhlIGNvbnRleHQsIGFuZCBp
bXBvcnRhbnRseSB0aGUKLQkJICogb2JqZWN0IHdpbGwgaG9sZCBvbnRvIGl0cyB2bWEgKG1ha2lu
ZyBpdCBwb3NzaWJsZSBmb3IgYQotCQkgKiBzdHJheSBHVFQgd3JpdGUgdG8gY29ycnVwdCBvdXIg
ZGVmYXVsdHMpLiBVbm1hcCB0aGUgdm1hCi0JCSAqIGZyb20gdGhlIEdUVCB0byBwcmV2ZW50IHN1
Y2ggYWNjaWRlbnRzIGFuZCByZWNsYWltIHRoZQotCQkgKiBzcGFjZS4KLQkJICovCi0JCWVyciA9
IGk5MTVfdm1hX3VuYmluZChzdGF0ZSk7Ci0JCWlmIChlcnIpCi0JCQlnb3RvIG91dDsKLQotCQlp
OTE1X2dlbV9vYmplY3RfbG9jayhzdGF0ZS0+b2JqKTsKLQkJZXJyID0gaTkxNV9nZW1fb2JqZWN0
X3NldF90b19jcHVfZG9tYWluKHN0YXRlLT5vYmosIGZhbHNlKTsKLQkJaTkxNV9nZW1fb2JqZWN0
X3VubG9jayhzdGF0ZS0+b2JqKTsKLQkJaWYgKGVycikKLQkJCWdvdG8gb3V0OwotCi0JCWk5MTVf
Z2VtX29iamVjdF9zZXRfY2FjaGVfY29oZXJlbmN5KHN0YXRlLT5vYmosIEk5MTVfQ0FDSEVfTExD
KTsKLQotCQkvKiBDaGVjayB3ZSBjYW4gYWNxdWlyZSB0aGUgaW1hZ2Ugb2YgdGhlIGNvbnRleHQg
c3RhdGUgKi8KLQkJdmFkZHIgPSBpOTE1X2dlbV9vYmplY3RfcGluX21hcChzdGF0ZS0+b2JqLCBJ
OTE1X01BUF9GT1JDRV9XQik7Ci0JCWlmIChJU19FUlIodmFkZHIpKSB7Ci0JCQllcnIgPSBQVFJf
RVJSKHZhZGRyKTsKLQkJCWdvdG8gb3V0OwotCQl9Ci0KLQkJcnEtPmVuZ2luZS0+ZGVmYXVsdF9z
dGF0ZSA9IGk5MTVfZ2VtX29iamVjdF9nZXQoc3RhdGUtPm9iaik7Ci0JCWk5MTVfZ2VtX29iamVj
dF91bnBpbl9tYXAoc3RhdGUtPm9iaik7Ci0JfQotCi1vdXQ6Ci0JLyoKLQkgKiBJZiB3ZSBoYXZl
IHRvIGFiYW5kb24gbm93LCB3ZSBleHBlY3QgdGhlIGVuZ2luZXMgdG8gYmUgaWRsZQotCSAqIGFu
ZCByZWFkeSB0byBiZSB0b3JuLWRvd24uIFRoZSBxdWlja2VzdCB3YXkgd2UgY2FuIGFjY29tcGxp
c2gKLQkgKiB0aGlzIGlzIGJ5IGRlY2xhcmluZyBvdXJzZWx2ZXMgd2VkZ2VkLgotCSAqLwotCWlm
IChlcnIpCi0JCWludGVsX2d0X3NldF93ZWRnZWQoZ3QpOwotCi0JZm9yIChpZCA9IDA7IGlkIDwg
QVJSQVlfU0laRShyZXF1ZXN0cyk7IGlkKyspIHsKLQkJc3RydWN0IGludGVsX2NvbnRleHQgKmNl
OwotCQlzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpycTsKLQotCQlycSA9IHJlcXVlc3RzW2lkXTsKLQkJ
aWYgKCFycSkKLQkJCWNvbnRpbnVlOwotCi0JCWNlID0gcnEtPmNvbnRleHQ7Ci0JCWk5MTVfcmVx
dWVzdF9wdXQocnEpOwotCQlpbnRlbF9jb250ZXh0X3B1dChjZSk7Ci0JfQotCXJldHVybiBlcnI7
Ci19Ci0KLXN0YXRpYyBpbnQgaW50ZWxfZW5naW5lc192ZXJpZnlfd29ya2Fyb3VuZHMoc3RydWN0
IGludGVsX2d0ICpndCkKLXsKLQlzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmU7Ci0JZW51
bSBpbnRlbF9lbmdpbmVfaWQgaWQ7Ci0JaW50IGVyciA9IDA7Ci0KLQlpZiAoIUlTX0VOQUJMRUQo
Q09ORklHX0RSTV9JOTE1X0RFQlVHX0dFTSkpCi0JCXJldHVybiAwOwotCi0JZm9yX2VhY2hfZW5n
aW5lKGVuZ2luZSwgZ3QsIGlkKSB7Ci0JCWlmIChpbnRlbF9lbmdpbmVfdmVyaWZ5X3dvcmthcm91
bmRzKGVuZ2luZSwgImxvYWQiKSkKLQkJCWVyciA9IC1FSU87Ci0JfQotCi0JcmV0dXJuIGVycjsK
LX0KLQogaW50IGk5MTVfZ2VtX2luaXQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2
KQogewogCWludCByZXQ7CkBAIC0xMjE1LDMxICsxMDY5LDYgQEAgaW50IGk5MTVfZ2VtX2luaXQo
c3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQogCQlnb3RvIGVycl91bmxvY2s7CiAJ
fQogCi0JaW50ZWxfZ3RfaW5pdCgmZGV2X3ByaXYtPmd0KTsKLQotCXJldCA9IGludGVsX2VuZ2lu
ZXNfc2V0dXAoJmRldl9wcml2LT5ndCk7Ci0JaWYgKHJldCkgewotCQlHRU1fQlVHX09OKHJldCA9
PSAtRUlPKTsKLQkJZ290byBlcnJfZ3RfZWFybHk7Ci0JfQotCi0JcmV0ID0gaW50ZWxfZW5naW5l
c19pbml0KCZkZXZfcHJpdi0+Z3QpOwotCWlmIChyZXQpIHsKLQkJR0VNX0JVR19PTihyZXQgPT0g
LUVJTyk7Ci0JCWdvdG8gZXJyX2VuZ2luZXM7Ci0JfQotCi0JaW50ZWxfdWNfaW5pdCgmZGV2X3By
aXYtPmd0LnVjKTsKLQotCXJldCA9IGludGVsX2d0X2luaXRfaHcoJmRldl9wcml2LT5ndCk7Ci0J
aWYgKHJldCkKLQkJZ290byBlcnJfdWNfaW5pdDsKLQotCS8qIE9ubHkgd2hlbiB0aGUgSFcgaXMg
cmUtaW5pdGlhbGlzZWQsIGNhbiB3ZSByZXBsYXkgdGhlIHJlcXVlc3RzICovCi0JcmV0ID0gaW50
ZWxfZ3RfcmVzdW1lKCZkZXZfcHJpdi0+Z3QpOwotCWlmIChyZXQpCi0JCWdvdG8gZXJyX2luaXRf
aHc7Ci0KIAkvKgogCSAqIERlc3BpdGUgaXRzIG5hbWUgaW50ZWxfaW5pdF9jbG9ja19nYXRpbmcg
YXBwbGllcyBib3RoIGRpc3BsYXkKIAkgKiBjbG9jayBnYXRpbmcgd29ya2Fyb3VuZHM7IEdUIG1t
aW8gd29ya2Fyb3VuZHMgYW5kIHRoZSBvY2Nhc2lvbmFsCkBAIC0xMjUxLDIxICsxMDgwLDE3IEBA
IGludCBpOTE1X2dlbV9pbml0KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikKIAkg
Ki8KIAlpbnRlbF9pbml0X2Nsb2NrX2dhdGluZyhkZXZfcHJpdik7CiAKLQlyZXQgPSBpbnRlbF9l
bmdpbmVzX3ZlcmlmeV93b3JrYXJvdW5kcygmZGV2X3ByaXYtPmd0KTsKKwlyZXQgPSBpbnRlbF9n
dF9pbml0KCZkZXZfcHJpdi0+Z3QpOwogCWlmIChyZXQpCi0JCWdvdG8gZXJyX2d0X2xhdGU7Ci0K
LQlyZXQgPSBfX2ludGVsX2VuZ2luZXNfcmVjb3JkX2RlZmF1bHRzKCZkZXZfcHJpdi0+Z3QpOwot
CWlmIChyZXQpCi0JCWdvdG8gZXJyX2d0X2xhdGU7CisJCWdvdG8gZXJyX3VubG9jazsKIAogCXJl
dCA9IGk5MTVfaW5qZWN0X3Byb2JlX2Vycm9yKGRldl9wcml2LCAtRU5PREVWKTsKIAlpZiAocmV0
KQotCQlnb3RvIGVycl9ndF9sYXRlOworCQlnb3RvIGVycl9ndDsKIAogCXJldCA9IGk5MTVfaW5q
ZWN0X3Byb2JlX2Vycm9yKGRldl9wcml2LCAtRUlPKTsKIAlpZiAocmV0KQotCQlnb3RvIGVycl9n
dF9sYXRlOworCQlnb3RvIGVycl9ndDsKIAogCWludGVsX3VuY29yZV9mb3JjZXdha2VfcHV0KCZk
ZXZfcHJpdi0+dW5jb3JlLCBGT1JDRVdBS0VfQUxMKTsKIApAQCAtMTI3NywyMiArMTEwMiwxMSBA
QCBpbnQgaTkxNV9nZW1faW5pdChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCiAJ
ICogSFcgYXMgaXJyZXZpc2libHkgd2VkZ2VkLCBidXQga2VlcCBlbm91Z2ggc3RhdGUgYXJvdW5k
IHRoYXQgdGhlCiAJICogZHJpdmVyIGRvZXNuJ3QgZXhwbG9kZSBkdXJpbmcgcnVudGltZS4KIAkg
Ki8KLWVycl9ndF9sYXRlOgotCWludGVsX2d0X3NldF93ZWRnZWRfb25faW5pdCgmZGV2X3ByaXYt
Pmd0KTsKLQlpOTE1X2dlbV9zdXNwZW5kKGRldl9wcml2KTsKLQlpOTE1X2dlbV9zdXNwZW5kX2xh
dGUoZGV2X3ByaXYpOworZXJyX2d0OgorCWludGVsX2d0X2RyaXZlcl9yZW1vdmUoJmRldl9wcml2
LT5ndCk7CisJZGV2X3ByaXYtPnVhYmlfZW5naW5lcyA9IFJCX1JPT1Q7CiAKIAlpOTE1X2dlbV9k
cmFpbl93b3JrcXVldWUoZGV2X3ByaXYpOwotZXJyX2luaXRfaHc6Ci0JaW50ZWxfdWNfZmluaV9o
dygmZGV2X3ByaXYtPmd0LnVjKTsKLWVycl91Y19pbml0OgotCWlmIChyZXQgIT0gLUVJTykKLQkJ
aW50ZWxfdWNfZmluaSgmZGV2X3ByaXYtPmd0LnVjKTsKLWVycl9lbmdpbmVzOgotCWlmIChyZXQg
IT0gLUVJTykKLQkJaW50ZWxfZW5naW5lc19jbGVhbnVwKCZkZXZfcHJpdi0+Z3QpOwotZXJyX2d0
X2Vhcmx5OgotCWludGVsX2d0X2RyaXZlcl9yZWxlYXNlKCZkZXZfcHJpdi0+Z3QpOwogZXJyX3Vu
bG9jazoKIAlpbnRlbF91bmNvcmVfZm9yY2V3YWtlX3B1dCgmZGV2X3ByaXYtPnVuY29yZSwgRk9S
Q0VXQUtFX0FMTCk7CiAKQEAgLTEzNDIsMTkgKzExNTYsMTggQEAgdm9pZCBpOTE1X2dlbV9kcml2
ZXJfcmVtb3ZlKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikKIAogCWk5MTVfZ2Vt
X3N1c3BlbmRfbGF0ZShkZXZfcHJpdik7CiAJaW50ZWxfZ3RfZHJpdmVyX3JlbW92ZSgmZGV2X3By
aXYtPmd0KTsKKwlkZXZfcHJpdi0+dWFiaV9lbmdpbmVzID0gUkJfUk9PVDsKIAogCS8qIEZsdXNo
IGFueSBvdXRzdGFuZGluZyB1bnBpbl93b3JrLiAqLwogCWk5MTVfZ2VtX2RyYWluX3dvcmtxdWV1
ZShkZXZfcHJpdik7CiAKIAlpbnRlbF91Y19maW5pX2h3KCZkZXZfcHJpdi0+Z3QudWMpOwotCWlu
dGVsX3VjX2ZpbmkoJmRldl9wcml2LT5ndC51Yyk7CiAKIAlpOTE1X2dlbV9kcmFpbl9mcmVlZF9v
YmplY3RzKGRldl9wcml2KTsKIH0KIAogdm9pZCBpOTE1X2dlbV9kcml2ZXJfcmVsZWFzZShzdHJ1
Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCiB7Ci0JaW50ZWxfZW5naW5lc19jbGVhbnVw
KCZkZXZfcHJpdi0+Z3QpOwogCWludGVsX2d0X2RyaXZlcl9yZWxlYXNlKCZkZXZfcHJpdi0+Z3Qp
OwogCiAJaW50ZWxfd2FfbGlzdF9mcmVlKCZkZXZfcHJpdi0+Z3Rfd2FfbGlzdCk7Ci0tIAoyLjI0
LjAKCl9fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fCkludGVs
LWdmeCBtYWlsaW5nIGxpc3QKSW50ZWwtZ2Z4QGxpc3RzLmZyZWVkZXNrdG9wLm9yZwpodHRwczov
L2xpc3RzLmZyZWVkZXNrdG9wLm9yZy9tYWlsbWFuL2xpc3RpbmZvL2ludGVsLWdmeA==

Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 019631BCE41
	for <lists+intel-gfx@lfdr.de>; Tue, 28 Apr 2020 23:12:23 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 28C726E9B1;
	Tue, 28 Apr 2020 21:12:21 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from fireflyinternet.com (mail.fireflyinternet.com [109.228.58.192])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 87EA46E0D8
 for <intel-gfx@lists.freedesktop.org>; Tue, 28 Apr 2020 21:12:19 +0000 (UTC)
X-Default-Received-SPF: pass (skip=forwardok (res=PASS))
 x-ip-name=78.156.65.138; 
Received: from build.alporthouse.com (unverified [78.156.65.138]) 
 by fireflyinternet.com (Firefly Internet (M1)) with ESMTP id 21052025-1500050 
 for multiple; Tue, 28 Apr 2020 22:11:48 +0100
From: Chris Wilson <chris@chris-wilson.co.uk>
To: intel-gfx@lists.freedesktop.org
Date: Tue, 28 Apr 2020 22:11:47 +0100
Message-Id: <20200428211147.26954-1-chris@chris-wilson.co.uk>
X-Mailer: git-send-email 2.20.1
In-Reply-To: <20200428205520.29559-1-chris@chris-wilson.co.uk>
References: <20200428205520.29559-1-chris@chris-wilson.co.uk>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH] drm/i915/gt: Keep a no-frills swappable copy of
 the default context state
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.29
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Cc: Matthew Auld <matthew.auld@intel.com>,
 Chris Wilson <chris@chris-wilson.co.uk>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

V2UgbmVlZCB0byBrZWVwIHRoZSBkZWZhdWx0IGNvbnRleHQgc3RhdGUgYXJvdW5kIHRvIGluc3Rh
bnRpYXRlIG5ldwpjb250ZXh0cyAoYWthIGdvbGRlbiByZW5kZXJjb250ZXh0KSwgYW5kIHdlIGFs
c28ga2VlcCBpdCBwaW5uZWQgd2hpbGUKdGhlIGVuZ2luZSBpcyBhY3RpdmUgc28gdGhhdCB3ZSBj
YW4gcXVpY2tseSByZXNldCBhIGhhbmdpbmcgY29udGV4dC4KSG93ZXZlciwgdGhlIGRlZmF1bHQg
Y29udGV4dHMgYXJlIGxhcmdlIGVub3VnaCB0byBtZXJpdCBrZWVwaW5nIGluCnN3YXBwYWJsZSBt
ZW1vcnkgYXMgb3Bwb3NlZCB0byBrZXJuZWwgbWVtb3J5LCBzbyB3ZSBzdG9yZSB0aGVtIGluc2lk
ZQpzaG1lbWZzLiBDdXJyZW50bHksIHdlIHVzZSB0aGUgbm9ybWFsIEdFTSBvYmplY3RzIHRvIGNy
ZWF0ZSB0aGUgZGVmYXVsdApjb250ZXh0IGltYWdlLCBidXQgd2UgY2FuIHRocm93IGF3YXkgYWxs
IGJ1dCB0aGUgc2htZW1mcyBmaWxlLgoKVGhpcyBncmVhdGx5IHNpbXBsaWZpZXMgdGhlIHRyaWNr
eSBwb3dlciBtYW5hZ2VtZW50IGNvZGUgd2hpY2ggd2FudHMgdG8KcnVuIHVuZGVybmVhdGggdGhl
IG5vcm1hbCBHVCBsb2NraW5nLCBhbmQgd2UgZGVmaW5pdGVseSBkbyBub3Qgd2FudCB0bwp1c2Ug
YW55IGhpZ2ggbGV2ZWwgb2JqZWN0cyB0aGF0IG1heSBhcHBlYXIgdG8gcmVjdXJzZSBiYWNrIGlu
dG8gdGhlIEdULgpUaG91Z2ggcGVyaGFwcyB0aGUgcHJpbWFyeSBhZHZhbnRhZ2Ugb2YgdGhlIGNv
bXBsZXggR0VNIG9iamVjdCBpcyB0aGF0CndlIGFnZ3Jlc3NpdmVseSBjYWNoZSB0aGUgbWFwcGlu
ZywgYnV0IGhlcmUgd2UgYXJlIHJlY3JlYXRpbmcgdGhlCnZtX2FyZWEgZXZlcnl0aW1lIHRpbWUg
d2UgdW5wYXJrLiBBdCB0aGUgd29yc3QsIHdlIGFkZCBhIGxpZ2h0d2VpZ2h0CmNhY2hlLCBidXQg
Zmlyc3QgZmluZCBhIG1pY3JvYmVuY2htYXJrIHRoYXQgaXMgaW1wYWN0ZWQuCgpIYXZpbmcgc3Rh
cnRlZCB0byBjcmVhdGUgc29tZSB1dGlsaXR5IGZ1bmN0aW9ucyB0byBtYWtlIHdvcmtpbmcgd2l0
aApzaG1lbWZzIG9iamVjdHMgZWFzaWVyLCB3ZSBjYW4gc3RhcnQgcHV0dGluZyB0aGVtIHRvIHdp
ZGVyIHVzZSwgd2hlcmUKR0VNIG9iamVjdHMgYXJlIG92ZXJraWxsLCBzdWNoIGFzIHN0b3Jpbmcg
cGVyc2lzdGVudCBlcnJvciBzdGF0ZS4KClNpZ25lZC1vZmYtYnk6IENocmlzIFdpbHNvbiA8Y2hy
aXNAY2hyaXMtd2lsc29uLmNvLnVrPgpDYzogTWF0dGhldyBBdWxkIDxtYXR0aGV3LmF1bGRAaW50
ZWwuY29tPgpDYzogUmFtYWxpbmdhbSBDIDxyYW1hbGluZ2FtLmNAaW50ZWwuY29tPgpDYzogVHZy
dGtvIFVyc3VsaW4gPHR2cnRrby51cnN1bGluQGludGVsLmNvbT4KLS0tCkVhc2llciBub3cgdG8g
dXNlIHRoZSBmLT5mX21hcHBpbmcuCi0tLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvTWFrZWZpbGUg
ICAgICAgICAgICAgICAgIHwgICAxICsKIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2Vu
Z2luZV9jcy5jICAgICB8ICAgMiArLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfZW5n
aW5lX3BtLmMgICAgIHwgIDEwICstCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9lbmdp
bmVfdHlwZXMuaCAgfCAgIDIgKy0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2d0LmMg
ICAgICAgICAgICB8ICAgNCArLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfbHJjLmMg
ICAgICAgICAgIHwgIDI1ICstLQogLi4uL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9yaW5nX3N1Ym1p
c3Npb24uYyAgIHwgIDE2ICstCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9zZWxmdGVzdF9jb250
ZXh0LmMgICAgfCAgIDIgKy0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L3NlbGZ0ZXN0X2xyYy5j
ICAgICAgICB8ICAxMCArLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qvc2htZW1fdXRpbHMuYyAg
ICAgICAgIHwgMTc4ICsrKysrKysrKysrKysrKysrKwogZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qv
c2htZW1fdXRpbHMuaCAgICAgICAgIHwgIDIyICsrKwogZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkx
NV9ncHVfZXJyb3IuYyAgICAgICAgIHwgIDI2IC0tLQogMTIgZmlsZXMgY2hhbmdlZCwgMjI2IGlu
c2VydGlvbnMoKyksIDcyIGRlbGV0aW9ucygtKQogY3JlYXRlIG1vZGUgMTAwNjQ0IGRyaXZlcnMv
Z3B1L2RybS9pOTE1L2d0L3NobWVtX3V0aWxzLmMKIGNyZWF0ZSBtb2RlIDEwMDY0NCBkcml2ZXJz
L2dwdS9kcm0vaTkxNS9ndC9zaG1lbV91dGlscy5oCgpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUv
ZHJtL2k5MTUvTWFrZWZpbGUgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9NYWtlZmlsZQppbmRleCAy
MWJiMmZiNWE2YjguLmNhZjAwZDkyZWE5ZCAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5
MTUvTWFrZWZpbGUKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvTWFrZWZpbGUKQEAgLTExMSw2
ICsxMTEsNyBAQCBndC15ICs9IFwKIAlndC9pbnRlbF9zc2V1Lm8gXAogCWd0L2ludGVsX3RpbWVs
aW5lLm8gXAogCWd0L2ludGVsX3dvcmthcm91bmRzLm8gXAorCWd0L3NobWVtX3V0aWxzLm8gXAog
CWd0L3N5c2ZzX2VuZ2luZXMubwogIyBhdXRvZ2VuZXJhdGVkIG51bGwgcmVuZGVyIHN0YXRlCiBn
dC15ICs9IFwKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2VuZ2lu
ZV9jcy5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfZW5naW5lX2NzLmMKaW5kZXgg
N2MzY2I1YWVkZmRmLi44MGJmNzE2MzZjMGYgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9p
OTE1L2d0L2ludGVsX2VuZ2luZV9jcy5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2lu
dGVsX2VuZ2luZV9jcy5jCkBAIC04MzQsNyArODM0LDcgQEAgdm9pZCBpbnRlbF9lbmdpbmVfY2xl
YW51cF9jb21tb24oc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lKQogCWludGVsX2VuZ2lu
ZV9jbGVhbnVwX2NtZF9wYXJzZXIoZW5naW5lKTsKIAogCWlmIChlbmdpbmUtPmRlZmF1bHRfc3Rh
dGUpCi0JCWk5MTVfZ2VtX29iamVjdF9wdXQoZW5naW5lLT5kZWZhdWx0X3N0YXRlKTsKKwkJZnB1
dChlbmdpbmUtPmRlZmF1bHRfc3RhdGUpOwogCiAJaWYgKGVuZ2luZS0+a2VybmVsX2NvbnRleHQp
IHsKIAkJaW50ZWxfY29udGV4dF91bnBpbihlbmdpbmUtPmtlcm5lbF9jb250ZXh0KTsKZGlmZiAt
LWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2VuZ2luZV9wbS5jIGIvZHJpdmVy
cy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfZW5naW5lX3BtLmMKaW5kZXggM2JlNjc5NzQxZDIyLi40
NDZlMzVhYzAyMjQgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2Vu
Z2luZV9wbS5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2VuZ2luZV9wbS5j
CkBAIC0xNSw2ICsxNSw3IEBACiAjaW5jbHVkZSAiaW50ZWxfZ3RfcG0uaCIKICNpbmNsdWRlICJp
bnRlbF9yYzYuaCIKICNpbmNsdWRlICJpbnRlbF9yaW5nLmgiCisjaW5jbHVkZSAic2htZW1fdXRp
bHMuaCIKIAogc3RhdGljIGludCBfX2VuZ2luZV91bnBhcmsoc3RydWN0IGludGVsX3dha2VyZWYg
KndmKQogewpAQCAtMzAsMTAgKzMxLDggQEAgc3RhdGljIGludCBfX2VuZ2luZV91bnBhcmsoc3Ry
dWN0IGludGVsX3dha2VyZWYgKndmKQogCS8qIFBpbiB0aGUgZGVmYXVsdCBzdGF0ZSBmb3IgZmFz
dCByZXNldHMgZnJvbSBhdG9taWMgY29udGV4dC4gKi8KIAltYXAgPSBOVUxMOwogCWlmIChlbmdp
bmUtPmRlZmF1bHRfc3RhdGUpCi0JCW1hcCA9IGk5MTVfZ2VtX29iamVjdF9waW5fbWFwKGVuZ2lu
ZS0+ZGVmYXVsdF9zdGF0ZSwKLQkJCQkJICAgICAgSTkxNV9NQVBfV0IpOwotCWlmICghSVNfRVJS
X09SX05VTEwobWFwKSkKLQkJZW5naW5lLT5waW5uZWRfZGVmYXVsdF9zdGF0ZSA9IG1hcDsKKwkJ
bWFwID0gc2htZW1fcGluX21hcChlbmdpbmUtPmRlZmF1bHRfc3RhdGUpOworCWVuZ2luZS0+cGlu
bmVkX2RlZmF1bHRfc3RhdGUgPSBtYXA7CiAKIAkvKiBEaXNjYXJkIHN0YWxlIGNvbnRleHQgc3Rh
dGUgZnJvbSBhY3Jvc3MgaWRsaW5nICovCiAJY2UgPSBlbmdpbmUtPmtlcm5lbF9jb250ZXh0OwpA
QCAtMjY0LDcgKzI2Myw4IEBAIHN0YXRpYyBpbnQgX19lbmdpbmVfcGFyayhzdHJ1Y3QgaW50ZWxf
d2FrZXJlZiAqd2YpCiAJCWVuZ2luZS0+cGFyayhlbmdpbmUpOwogCiAJaWYgKGVuZ2luZS0+cGlu
bmVkX2RlZmF1bHRfc3RhdGUpIHsKLQkJaTkxNV9nZW1fb2JqZWN0X3VucGluX21hcChlbmdpbmUt
PmRlZmF1bHRfc3RhdGUpOworCQlzaG1lbV91bnBpbl9tYXAoZW5naW5lLT5kZWZhdWx0X3N0YXRl
LAorCQkJCWVuZ2luZS0+cGlubmVkX2RlZmF1bHRfc3RhdGUpOwogCQllbmdpbmUtPnBpbm5lZF9k
ZWZhdWx0X3N0YXRlID0gTlVMTDsKIAl9CiAKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9p
OTE1L2d0L2ludGVsX2VuZ2luZV90eXBlcy5oIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50
ZWxfZW5naW5lX3R5cGVzLmgKaW5kZXggY2ZlNGZlYWVlOTgyLi40ODNkOGZmMzlhMGQgMTAwNjQ0
Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2VuZ2luZV90eXBlcy5oCisrKyBi
L2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2VuZ2luZV90eXBlcy5oCkBAIC0zMzksNyAr
MzM5LDcgQEAgc3RydWN0IGludGVsX2VuZ2luZV9jcyB7CiAKIAl1bnNpZ25lZCBsb25nIHdha2Vy
ZWZfc2VyaWFsOwogCXN0cnVjdCBpbnRlbF93YWtlcmVmIHdha2VyZWY7Ci0Jc3RydWN0IGRybV9p
OTE1X2dlbV9vYmplY3QgKmRlZmF1bHRfc3RhdGU7CisJc3RydWN0IGZpbGUgKmRlZmF1bHRfc3Rh
dGU7CiAJdm9pZCAqcGlubmVkX2RlZmF1bHRfc3RhdGU7CiAKIAlzdHJ1Y3QgewpkaWZmIC0tZ2l0
IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfZ3QuYyBiL2RyaXZlcnMvZ3B1L2RybS9p
OTE1L2d0L2ludGVsX2d0LmMKaW5kZXggZDljZjgxOTRjOTk3Li5jM2YyNWEyYTU3MDYgMTAwNjQ0
Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2d0LmMKKysrIGIvZHJpdmVycy9n
cHUvZHJtL2k5MTUvZ3QvaW50ZWxfZ3QuYwpAQCAtMTYsNiArMTYsNyBAQAogI2luY2x1ZGUgImlu
dGVsX3Jwcy5oIgogI2luY2x1ZGUgImludGVsX3VuY29yZS5oIgogI2luY2x1ZGUgImludGVsX3Bt
LmgiCisjaW5jbHVkZSAic2htZW1fdXRpbHMuaCIKIAogdm9pZCBpbnRlbF9ndF9pbml0X2Vhcmx5
KHN0cnVjdCBpbnRlbF9ndCAqZ3QsIHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KQogewpA
QCAtNTAxLDcgKzUwMiw4IEBAIHN0YXRpYyBpbnQgX19lbmdpbmVzX3JlY29yZF9kZWZhdWx0cyhz
dHJ1Y3QgaW50ZWxfZ3QgKmd0KQogCQkJZ290byBvdXQ7CiAJCX0KIAotCQlycS0+ZW5naW5lLT5k
ZWZhdWx0X3N0YXRlID0gaTkxNV9nZW1fb2JqZWN0X2dldChzdGF0ZS0+b2JqKTsKKwkJcnEtPmVu
Z2luZS0+ZGVmYXVsdF9zdGF0ZSA9CisJCQlzaG1lbV9jcmVhdGVfZnJvbV9vYmplY3Qoc3RhdGUt
Pm9iaik7CiAJCWk5MTVfZ2VtX29iamVjdF91bnBpbl9tYXAoc3RhdGUtPm9iaik7CiAJfQogCmRp
ZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9scmMuYyBiL2RyaXZlcnMv
Z3B1L2RybS9pOTE1L2d0L2ludGVsX2xyYy5jCmluZGV4IDkwYWNjM2QyNDQwYi4uN2ZjNDA4MWMz
NGZlIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9scmMuYworKysg
Yi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9scmMuYwpAQCAtMTQ3LDYgKzE0Nyw3IEBA
CiAjaW5jbHVkZSAiaW50ZWxfcmVzZXQuaCIKICNpbmNsdWRlICJpbnRlbF9yaW5nLmgiCiAjaW5j
bHVkZSAiaW50ZWxfd29ya2Fyb3VuZHMuaCIKKyNpbmNsdWRlICJzaG1lbV91dGlscy5oIgogCiAj
ZGVmaW5lIFJJTkdfRVhFQ0xJU1RfUUZVTEwJCSgxIDw8IDB4MikKICNkZWZpbmUgUklOR19FWEVD
TElTVDFfVkFMSUQJCSgxIDw8IDB4MykKQEAgLTUwODMsMzAgKzUwODQsMTggQEAgcG9wdWxhdGVf
bHJfY29udGV4dChzdHJ1Y3QgaW50ZWxfY29udGV4dCAqY2UsCiB7CiAJYm9vbCBpbmhpYml0ID0g
dHJ1ZTsKIAl2b2lkICp2YWRkcjsKLQlpbnQgcmV0OwogCiAJdmFkZHIgPSBpOTE1X2dlbV9vYmpl
Y3RfcGluX21hcChjdHhfb2JqLCBJOTE1X01BUF9XQik7CiAJaWYgKElTX0VSUih2YWRkcikpIHsK
LQkJcmV0ID0gUFRSX0VSUih2YWRkcik7Ci0JCWRybV9kYmcoJmVuZ2luZS0+aTkxNS0+ZHJtLAot
CQkJIkNvdWxkIG5vdCBtYXAgb2JqZWN0IHBhZ2VzISAoJWQpXG4iLCByZXQpOwotCQlyZXR1cm4g
cmV0OworCQlkcm1fZGJnKCZlbmdpbmUtPmk5MTUtPmRybSwgIkNvdWxkIG5vdCBtYXAgb2JqZWN0
IHBhZ2VzIVxuIik7CisJCXJldHVybiBQVFJfRVJSKHZhZGRyKTsKIAl9CiAKIAlzZXRfcmVkem9u
ZSh2YWRkciwgZW5naW5lKTsKIAogCWlmIChlbmdpbmUtPmRlZmF1bHRfc3RhdGUpIHsKLQkJdm9p
ZCAqZGVmYXVsdHM7Ci0KLQkJZGVmYXVsdHMgPSBpOTE1X2dlbV9vYmplY3RfcGluX21hcChlbmdp
bmUtPmRlZmF1bHRfc3RhdGUsCi0JCQkJCQkgICBJOTE1X01BUF9XQik7Ci0JCWlmIChJU19FUlIo
ZGVmYXVsdHMpKSB7Ci0JCQlyZXQgPSBQVFJfRVJSKGRlZmF1bHRzKTsKLQkJCWdvdG8gZXJyX3Vu
cGluX2N0eDsKLQkJfQotCi0JCW1lbWNweSh2YWRkciwgZGVmYXVsdHMsIGVuZ2luZS0+Y29udGV4
dF9zaXplKTsKLQkJaTkxNV9nZW1fb2JqZWN0X3VucGluX21hcChlbmdpbmUtPmRlZmF1bHRfc3Rh
dGUpOworCQlzaG1lbV9yZWFkKGVuZ2luZS0+ZGVmYXVsdF9zdGF0ZSwgMCwKKwkJCSAgIHZhZGRy
LCBlbmdpbmUtPmNvbnRleHRfc2l6ZSk7CiAJCV9fc2V0X2JpdChDT05URVhUX1ZBTElEX0JJVCwg
JmNlLT5mbGFncyk7CiAJCWluaGliaXQgPSBmYWxzZTsKIAl9CkBAIC01MTIxLDExICs1MTEwLDkg
QEAgcG9wdWxhdGVfbHJfY29udGV4dChzdHJ1Y3QgaW50ZWxfY29udGV4dCAqY2UsCiAJZXhlY2xp
c3RzX2luaXRfcmVnX3N0YXRlKHZhZGRyICsgTFJDX1NUQVRFX09GRlNFVCwKIAkJCQkgY2UsIGVu
Z2luZSwgcmluZywgaW5oaWJpdCk7CiAKLQlyZXQgPSAwOwotZXJyX3VucGluX2N0eDoKIAlfX2k5
MTVfZ2VtX29iamVjdF9mbHVzaF9tYXAoY3R4X29iaiwgMCwgZW5naW5lLT5jb250ZXh0X3NpemUp
OwogCWk5MTVfZ2VtX29iamVjdF91bnBpbl9tYXAoY3R4X29iaik7Ci0JcmV0dXJuIHJldDsKKwly
ZXR1cm4gMDsKIH0KIAogc3RhdGljIGludCBfX2V4ZWNsaXN0c19jb250ZXh0X2FsbG9jKHN0cnVj
dCBpbnRlbF9jb250ZXh0ICpjZSwKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0
L2ludGVsX3Jpbmdfc3VibWlzc2lvbi5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxf
cmluZ19zdWJtaXNzaW9uLmMKaW5kZXggZDAxNWY3YjhiMjhlLi5jYTcyODZlNTg0MDkgMTAwNjQ0
Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX3Jpbmdfc3VibWlzc2lvbi5jCisr
KyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX3Jpbmdfc3VibWlzc2lvbi5jCkBAIC00
Miw2ICs0Miw3IEBACiAjaW5jbHVkZSAiaW50ZWxfcmVzZXQuaCIKICNpbmNsdWRlICJpbnRlbF9y
aW5nLmgiCiAjaW5jbHVkZSAiaW50ZWxfd29ya2Fyb3VuZHMuaCIKKyNpbmNsdWRlICJzaG1lbV91
dGlscy5oIgogCiAvKiBSb3VnaCBlc3RpbWF0ZSBvZiB0aGUgdHlwaWNhbCByZXF1ZXN0IHNpemUs
IHBlcmZvcm1pbmcgYSBmbHVzaCwKICAqIHNldC1jb250ZXh0IGFuZCB0aGVuIGVtaXR0aW5nIHRo
ZSBiYXRjaC4KQEAgLTEyNDEsNyArMTI0Miw3IEBAIGFsbG9jX2NvbnRleHRfdm1hKHN0cnVjdCBp
bnRlbF9lbmdpbmVfY3MgKmVuZ2luZSkKIAkJaTkxNV9nZW1fb2JqZWN0X3NldF9jYWNoZV9jb2hl
cmVuY3kob2JqLCBJOTE1X0NBQ0hFX0wzX0xMQyk7CiAKIAlpZiAoZW5naW5lLT5kZWZhdWx0X3N0
YXRlKSB7Ci0JCXZvaWQgKmRlZmF1bHRzLCAqdmFkZHI7CisJCXZvaWQgKnZhZGRyOwogCiAJCXZh
ZGRyID0gaTkxNV9nZW1fb2JqZWN0X3Bpbl9tYXAob2JqLCBJOTE1X01BUF9XQik7CiAJCWlmIChJ
U19FUlIodmFkZHIpKSB7CkBAIC0xMjQ5LDE1ICsxMjUwLDggQEAgYWxsb2NfY29udGV4dF92bWEo
c3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lKQogCQkJZ290byBlcnJfb2JqOwogCQl9CiAK
LQkJZGVmYXVsdHMgPSBpOTE1X2dlbV9vYmplY3RfcGluX21hcChlbmdpbmUtPmRlZmF1bHRfc3Rh
dGUsCi0JCQkJCQkgICBJOTE1X01BUF9XQik7Ci0JCWlmIChJU19FUlIoZGVmYXVsdHMpKSB7Ci0J
CQllcnIgPSBQVFJfRVJSKGRlZmF1bHRzKTsKLQkJCWdvdG8gZXJyX21hcDsKLQkJfQotCi0JCW1l
bWNweSh2YWRkciwgZGVmYXVsdHMsIGVuZ2luZS0+Y29udGV4dF9zaXplKTsKLQkJaTkxNV9nZW1f
b2JqZWN0X3VucGluX21hcChlbmdpbmUtPmRlZmF1bHRfc3RhdGUpOworCQlzaG1lbV9yZWFkKGVu
Z2luZS0+ZGVmYXVsdF9zdGF0ZSwgMCwKKwkJCSAgIHZhZGRyLCBlbmdpbmUtPmNvbnRleHRfc2l6
ZSk7CiAKIAkJaTkxNV9nZW1fb2JqZWN0X2ZsdXNoX21hcChvYmopOwogCQlpOTE1X2dlbV9vYmpl
Y3RfdW5waW5fbWFwKG9iaik7CkBAIC0xMjcxLDggKzEyNjUsNiBAQCBhbGxvY19jb250ZXh0X3Zt
YShzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmUpCiAKIAlyZXR1cm4gdm1hOwogCi1lcnJf
bWFwOgotCWk5MTVfZ2VtX29iamVjdF91bnBpbl9tYXAob2JqKTsKIGVycl9vYmo6CiAJaTkxNV9n
ZW1fb2JqZWN0X3B1dChvYmopOwogCXJldHVybiBFUlJfUFRSKGVycik7CmRpZmYgLS1naXQgYS9k
cml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9zZWxmdGVzdF9jb250ZXh0LmMgYi9kcml2ZXJzL2dwdS9k
cm0vaTkxNS9ndC9zZWxmdGVzdF9jb250ZXh0LmMKaW5kZXggZTg3NGRmYWE1MzE2Li5iOGVkM2Ni
ZTEyNzcgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L3NlbGZ0ZXN0X2NvbnRl
eHQuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9zZWxmdGVzdF9jb250ZXh0LmMKQEAg
LTE1NSw3ICsxNTUsNyBAQCBzdGF0aWMgaW50IGxpdmVfY29udGV4dF9zaXplKHZvaWQgKmFyZykK
IAogCWZvcl9lYWNoX2VuZ2luZShlbmdpbmUsIGd0LCBpZCkgewogCQlzdHJ1Y3QgewotCQkJc3Ry
dWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKnN0YXRlOworCQkJc3RydWN0IGZpbGUgKnN0YXRlOwog
CQkJdm9pZCAqcGlubmVkOwogCQl9IHNhdmVkOwogCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9k
cm0vaTkxNS9ndC9zZWxmdGVzdF9scmMuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L3NlbGZ0
ZXN0X2xyYy5jCmluZGV4IGQzZmE5MWFlZDdkZS4uZDkwMGJiY2NkNWRiIDEwMDY0NAotLS0gYS9k
cml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9zZWxmdGVzdF9scmMuYworKysgYi9kcml2ZXJzL2dwdS9k
cm0vaTkxNS9ndC9zZWxmdGVzdF9scmMuYwpAQCAtNDQ1Miw4ICs0NDUyLDcgQEAgc3RhdGljIGlu
dCBsaXZlX2xyY19sYXlvdXQodm9pZCAqYXJnKQogCQlpZiAoIWVuZ2luZS0+ZGVmYXVsdF9zdGF0
ZSkKIAkJCWNvbnRpbnVlOwogCi0JCWh3ID0gaTkxNV9nZW1fb2JqZWN0X3Bpbl9tYXAoZW5naW5l
LT5kZWZhdWx0X3N0YXRlLAotCQkJCQkgICAgIEk5MTVfTUFQX1dCKTsKKwkJaHcgPSBzaG1lbV9w
aW5fbWFwKGVuZ2luZS0+ZGVmYXVsdF9zdGF0ZSk7CiAJCWlmIChJU19FUlIoaHcpKSB7CiAJCQll
cnIgPSBQVFJfRVJSKGh3KTsKIAkJCWJyZWFrOwpAQCAtNDUyNSw3ICs0NTI0LDcgQEAgc3RhdGlj
IGludCBsaXZlX2xyY19sYXlvdXQodm9pZCAqYXJnKQogCQkJaGV4ZHVtcChscmMsIFBBR0VfU0la
RSk7CiAJCX0KIAotCQlpOTE1X2dlbV9vYmplY3RfdW5waW5fbWFwKGVuZ2luZS0+ZGVmYXVsdF9z
dGF0ZSk7CisJCXNobWVtX3VucGluX21hcChlbmdpbmUtPmRlZmF1bHRfc3RhdGUsIGh3KTsKIAkJ
aWYgKGVycikKIAkJCWJyZWFrOwogCX0KQEAgLTQ2MzAsOCArNDYyOSw3IEBAIHN0YXRpYyBpbnQg
bGl2ZV9scmNfZml4ZWQodm9pZCAqYXJnKQogCQlpZiAoIWVuZ2luZS0+ZGVmYXVsdF9zdGF0ZSkK
IAkJCWNvbnRpbnVlOwogCi0JCWh3ID0gaTkxNV9nZW1fb2JqZWN0X3Bpbl9tYXAoZW5naW5lLT5k
ZWZhdWx0X3N0YXRlLAotCQkJCQkgICAgIEk5MTVfTUFQX1dCKTsKKwkJaHcgPSBzaG1lbV9waW5f
bWFwKGVuZ2luZS0+ZGVmYXVsdF9zdGF0ZSk7CiAJCWlmIChJU19FUlIoaHcpKSB7CiAJCQllcnIg
PSBQVFJfRVJSKGh3KTsKIAkJCWJyZWFrOwpAQCAtNDY1Miw3ICs0NjUwLDcgQEAgc3RhdGljIGlu
dCBsaXZlX2xyY19maXhlZCh2b2lkICphcmcpCiAJCQl9CiAJCX0KIAotCQlpOTE1X2dlbV9vYmpl
Y3RfdW5waW5fbWFwKGVuZ2luZS0+ZGVmYXVsdF9zdGF0ZSk7CisJCXNobWVtX3VucGluX21hcChl
bmdpbmUtPmRlZmF1bHRfc3RhdGUsIGh3KTsKIAl9CiAKIAlyZXR1cm4gZXJyOwpkaWZmIC0tZ2l0
IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qvc2htZW1fdXRpbHMuYyBiL2RyaXZlcnMvZ3B1L2Ry
bS9pOTE1L2d0L3NobWVtX3V0aWxzLmMKbmV3IGZpbGUgbW9kZSAxMDA2NDQKaW5kZXggMDAwMDAw
MDAwMDAwLi5kYjZmYmU1MzRkMDIKLS0tIC9kZXYvbnVsbAorKysgYi9kcml2ZXJzL2dwdS9kcm0v
aTkxNS9ndC9zaG1lbV91dGlscy5jCkBAIC0wLDAgKzEsMTc4IEBACisvLyBTUERYLUxpY2Vuc2Ut
SWRlbnRpZmllcjogTUlUCisvKgorICogQ29weXJpZ2h0IMKpIDIwMjAgSW50ZWwgQ29ycG9yYXRp
b24KKyAqLworCisjaW5jbHVkZSA8bGludXgvbW0uaD4KKyNpbmNsdWRlIDxsaW51eC9wYWdlbWFw
Lmg+CisjaW5jbHVkZSA8bGludXgvc2htZW1fZnMuaD4KKworI2luY2x1ZGUgImdlbS9pOTE1X2dl
bV9vYmplY3QuaCIKKyNpbmNsdWRlICJzaG1lbV91dGlscy5oIgorCitzdHJ1Y3QgZmlsZSAqc2ht
ZW1fY3JlYXRlX2Zyb21fZGF0YShjb25zdCBjaGFyICpuYW1lLCB2b2lkICpkYXRhLCBzaXplX3Qg
bGVuKQoreworCXN0cnVjdCBmaWxlICpmaWxlOworCXVuc2lnbmVkIGxvbmcgcGZuOworCXVuc2ln
bmVkIGxvbmcgc3o7CisJaW50IGVycjsKKworCXN6ID0gUEFHRV9BTElHTihsZW4pOworCWZpbGUg
PSBzaG1lbV9maWxlX3NldHVwKG5hbWUsIHN6LCBWTV9OT1JFU0VSVkUpOworCWlmIChJU19FUlIo
ZmlsZSkpCisJCXJldHVybiBmaWxlOworCisJZm9yIChwZm4gPSAwOyBwZm4gPCBzeiA+PiBQQUdF
X1NISUZUOyBwZm4rKykgeworCQlzdHJ1Y3QgcGFnZSAqcGFnZTsKKwkJdW5zaWduZWQgaW50IHRo
aXM7CisJCXZvaWQgKnZhZGRyOworCisJCXBhZ2UgPSBzaG1lbV9yZWFkX21hcHBpbmdfcGFnZV9n
ZnAoZmlsZS0+Zl9tYXBwaW5nLCBwZm4sCisJCQkJCQkgICBHRlBfS0VSTkVMKTsKKwkJaWYgKElT
X0VSUihwYWdlKSkgeworCQkJZXJyID0gUFRSX0VSUihwYWdlKTsKKwkJCWdvdG8gZXJyX2ZpbGU7
CisJCX0KKworCQl0aGlzID0gbWF4X3Qoc2l6ZV90LCBQQUdFX1NJWkUsIGxlbik7CisKKwkJdmFk
ZHIgPSBrbWFwKHBhZ2UpOworCQltZW1jcHkodmFkZHIsIGRhdGEsIHRoaXMpOworCQlrdW5tYXAo
cGFnZSk7CisJCXB1dF9wYWdlKHBhZ2UpOworCisJCWxlbiAtPSB0aGlzOworCQlkYXRhICs9IHRo
aXM7CisJfQorCisJcmV0dXJuIGZpbGU7CisKK2Vycl9maWxlOgorCWZwdXQoZmlsZSk7CisJcmV0
dXJuIEVSUl9QVFIoZXJyKTsKK30KKworc3RydWN0IGZpbGUgKnNobWVtX2NyZWF0ZV9mcm9tX29i
amVjdChzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2JqKQoreworCXN0cnVjdCBmaWxlICpm
aWxlOworCXZvaWQgKnB0cjsKKworCWlmIChvYmotPm9wcyA9PSAmaTkxNV9nZW1fc2htZW1fb3Bz
KSB7CisJCWZpbGUgPSBvYmotPmJhc2UuZmlscDsKKwkJYXRvbWljX2xvbmdfaW5jKCZmaWxlLT5m
X2NvdW50KTsKKwkJcmV0dXJuIGZpbGU7CisJfQorCisJcHRyID0gaTkxNV9nZW1fb2JqZWN0X3Bp
bl9tYXAob2JqLCBJOTE1X01BUF9XQik7CisJaWYgKElTX0VSUihwdHIpKQorCQlyZXR1cm4gRVJS
X0NBU1QocHRyKTsKKworCWZpbGUgPSBzaG1lbV9jcmVhdGVfZnJvbV9kYXRhKCIiLCBwdHIsIG9i
ai0+YmFzZS5zaXplKTsKKwlpOTE1X2dlbV9vYmplY3RfdW5waW5fbWFwKG9iaik7CisKKwlyZXR1
cm4gZmlsZTsKK30KKworc3RhdGljIHNpemVfdCBzaG1lbV9ucHRlKHN0cnVjdCBmaWxlICpmaWxl
KQoreworCXJldHVybiBmaWxlLT5mX21hcHBpbmctPmhvc3QtPmlfc2l6ZSA+PiBQQUdFX1NISUZU
OworfQorCitzdGF0aWMgdm9pZCBfX3NobWVtX3VucGluX21hcChzdHJ1Y3QgZmlsZSAqZmlsZSwg
dm9pZCAqcHRyLCBzaXplX3Qgbl9wdGUpCit7CisJdW5zaWduZWQgbG9uZyBwZm47CisKKwl2dW5t
YXAocHRyKTsKKworCWZvciAocGZuID0gMDsgcGZuIDwgbl9wdGU7IHBmbisrKSB7CisJCXN0cnVj
dCBwYWdlICpwYWdlOworCisJCXBhZ2UgPSBzaG1lbV9yZWFkX21hcHBpbmdfcGFnZV9nZnAoZmls
ZS0+Zl9tYXBwaW5nLCBwZm4sCisJCQkJCQkgICBHRlBfS0VSTkVMKTsKKwkJaWYgKCFXQVJOX09O
KElTX0VSUihwYWdlKSkpIHsKKwkJCXB1dF9wYWdlKHBhZ2UpOworCQkJcHV0X3BhZ2UocGFnZSk7
CisJCX0KKwl9Cit9CisKK3ZvaWQgKnNobWVtX3Bpbl9tYXAoc3RydWN0IGZpbGUgKmZpbGUpCit7
CisJY29uc3Qgc2l6ZV90IG5fcHRlID0gc2htZW1fbnB0ZShmaWxlKTsKKwlwdGVfdCAqc3RhY2tb
MzJdLCAqKnB0ZXMsICoqbWVtOworCXN0cnVjdCB2bV9zdHJ1Y3QgKmFyZWE7CisJdW5zaWduZWQg
bG9uZyBwZm47CisKKwltZW0gPSBzdGFjazsKKwlpZiAobl9wdGUgPiBBUlJBWV9TSVpFKHN0YWNr
KSkgeworCQltZW0gPSBrdm1hbGxvY19hcnJheShuX3B0ZSwgc2l6ZW9mKCptZW0pLCBHRlBfS0VS
TkVMKTsKKwkJaWYgKCFtZW0pCisJCQlyZXR1cm4gTlVMTDsKKwl9CisKKwlhcmVhID0gYWxsb2Nf
dm1fYXJlYShuX3B0ZSA8PCBQQUdFX1NISUZULCBtZW0pOworCWlmICghYXJlYSkgeworCQlpZiAo
bWVtICE9IHN0YWNrKQorCQkJa3ZmcmVlKG1lbSk7CisJCXJldHVybiBOVUxMOworCX0KKworCXB0
ZXMgPSBtZW07CisJZm9yIChwZm4gPSAwOyBwZm4gPCBuX3B0ZTsgcGZuKyspIHsKKwkJc3RydWN0
IHBhZ2UgKnBhZ2U7CisKKwkJcGFnZSA9IHNobWVtX3JlYWRfbWFwcGluZ19wYWdlX2dmcChmaWxl
LT5mX21hcHBpbmcsIHBmbiwKKwkJCQkJCSAgIEdGUF9LRVJORUwpOworCQlpZiAoSVNfRVJSKHBh
Z2UpKQorCQkJZ290byBlcnJfcGFnZTsKKworCQkqKnB0ZXMrKyA9IG1rX3B0ZShwYWdlLCAgUEFH
RV9LRVJORUwpOworCX0KKworCWlmIChtZW0gIT0gc3RhY2spCisJCWt2ZnJlZShtZW0pOworCisJ
bWFwcGluZ19zZXRfdW5ldmljdGFibGUoZmlsZS0+Zl9tYXBwaW5nKTsKKwlyZXR1cm4gYXJlYS0+
YWRkcjsKKworZXJyX3BhZ2U6CisJaWYgKG1lbSAhPSBzdGFjaykKKwkJa3ZmcmVlKG1lbSk7CisK
KwlfX3NobWVtX3VucGluX21hcChmaWxlLCBhcmVhLT5hZGRyLCBwZm4pOworCXJldHVybiBOVUxM
OworfQorCit2b2lkIHNobWVtX3VucGluX21hcChzdHJ1Y3QgZmlsZSAqZmlsZSwgdm9pZCAqcHRy
KQoreworCW1hcHBpbmdfY2xlYXJfdW5ldmljdGFibGUoZmlsZS0+Zl9tYXBwaW5nKTsKKwlfX3No
bWVtX3VucGluX21hcChmaWxlLCBwdHIsIHNobWVtX25wdGUoZmlsZSkpOworfQorCitpbnQgc2ht
ZW1fcmVhZChzdHJ1Y3QgZmlsZSAqZmlsZSwgbG9mZl90IG9mZiwgdm9pZCAqZHN0LCBzaXplX3Qg
bGVuKQoreworCXVuc2lnbmVkIGxvbmcgcGZuOworCisJZm9yIChwZm4gPSBvZmYgPj4gUEFHRV9T
SElGVDsgbGVuOyBwZm4rKykgeworCQl1bnNpZ25lZCBpbnQgdGhpcyA9CisJCQltYXhfdChzaXpl
X3QsIFBBR0VfU0laRSAtIG9mZnNldF9pbl9wYWdlKG9mZiksIGxlbik7CisJCXN0cnVjdCBwYWdl
ICpwYWdlOworCQl2b2lkICp2YWRkcjsKKworCQlwYWdlID0gc2htZW1fcmVhZF9tYXBwaW5nX3Bh
Z2VfZ2ZwKGZpbGUtPmZfbWFwcGluZywgcGZuLAorCQkJCQkJICAgR0ZQX0tFUk5FTCk7CisJCWlm
IChJU19FUlIocGFnZSkpCisJCQlyZXR1cm4gUFRSX0VSUihwYWdlKTsKKworCQl2YWRkciA9IGtt
YXAocGFnZSk7CisJCW1lbWNweShkc3QsIHZhZGRyICsgb2Zmc2V0X2luX3BhZ2Uob2ZmKSwgdGhp
cyk7CisJCWt1bm1hcChwYWdlKTsKKwkJcHV0X3BhZ2UocGFnZSk7CisKKwkJbGVuIC09IHRoaXM7
CisJCWRzdCArPSB0aGlzOworCQlvZmYgPSAwOworCX0KKworCXJldHVybiAwOworfQpkaWZmIC0t
Z2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qvc2htZW1fdXRpbHMuaCBiL2RyaXZlcnMvZ3B1
L2RybS9pOTE1L2d0L3NobWVtX3V0aWxzLmgKbmV3IGZpbGUgbW9kZSAxMDA2NDQKaW5kZXggMDAw
MDAwMDAwMDAwLi4yMTNmYWU4YTk0M2EKLS0tIC9kZXYvbnVsbAorKysgYi9kcml2ZXJzL2dwdS9k
cm0vaTkxNS9ndC9zaG1lbV91dGlscy5oCkBAIC0wLDAgKzEsMjIgQEAKKy8qIFNQRFgtTGljZW5z
ZS1JZGVudGlmaWVyOiBNSVQgKi8KKy8qCisgKiBDb3B5cmlnaHQgwqkgMjAyMCBJbnRlbCBDb3Jw
b3JhdGlvbgorICovCisKKyNpZm5kZWYgU0hNRU1fVVRJTFNfSAorI2RlZmluZSBTSE1FTV9VVElM
U19ICisKKyNpbmNsdWRlIDxsaW51eC90eXBlcy5oPgorCitzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29i
amVjdDsKK3N0cnVjdCBmaWxlOworCitzdHJ1Y3QgZmlsZSAqc2htZW1fY3JlYXRlX2Zyb21fZGF0
YShjb25zdCBjaGFyICpuYW1lLCB2b2lkICpkYXRhLCBzaXplX3QgbGVuKTsKK3N0cnVjdCBmaWxl
ICpzaG1lbV9jcmVhdGVfZnJvbV9vYmplY3Qoc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9i
aik7CisKK3ZvaWQgKnNobWVtX3Bpbl9tYXAoc3RydWN0IGZpbGUgKmZpbGUpOwordm9pZCBzaG1l
bV91bnBpbl9tYXAoc3RydWN0IGZpbGUgKmZpbGUsIHZvaWQgKnB0cik7CisKK2ludCBzaG1lbV9y
ZWFkKHN0cnVjdCBmaWxlICpmaWxlLCBsb2ZmX3Qgb2ZmLCB2b2lkICpkc3QsIHNpemVfdCBsZW4p
OworCisjZW5kaWYgLyogU0hNRU1fVVRJTFNfSCAqLwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUv
ZHJtL2k5MTUvaTkxNV9ncHVfZXJyb3IuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZ3B1
X2Vycm9yLmMKaW5kZXggNGQ1NGRiYTM1MzAyLi44NTA2Y2E0M2VjYTYgMTAwNjQ0Ci0tLSBhL2Ry
aXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZ3B1X2Vycm9yLmMKKysrIGIvZHJpdmVycy9ncHUvZHJt
L2k5MTUvaTkxNV9ncHVfZXJyb3IuYwpAQCAtMTMxOCwyNiArMTMxOCw2IEBAIGNhcHR1cmVfdXNl
cihzdHJ1Y3QgaW50ZWxfZW5naW5lX2NhcHR1cmVfdm1hICpjYXB0dXJlLAogCXJldHVybiBjYXB0
dXJlOwogfQogCi1zdGF0aWMgc3RydWN0IGk5MTVfdm1hX2NvcmVkdW1wICoKLWNhcHR1cmVfb2Jq
ZWN0KGNvbnN0IHN0cnVjdCBpbnRlbF9ndCAqZ3QsCi0JICAgICAgIHN0cnVjdCBkcm1faTkxNV9n
ZW1fb2JqZWN0ICpvYmosCi0JICAgICAgIGNvbnN0IGNoYXIgKm5hbWUsCi0JICAgICAgIHN0cnVj
dCBpOTE1X3ZtYV9jb21wcmVzcyAqY29tcHJlc3MpCi17Ci0JaWYgKG9iaiAmJiBpOTE1X2dlbV9v
YmplY3RfaGFzX3BhZ2VzKG9iaikpIHsKLQkJc3RydWN0IGk5MTVfdm1hIGZha2UgPSB7Ci0JCQku
bm9kZSA9IHsgLnN0YXJ0ID0gVTY0X01BWCwgLnNpemUgPSBvYmotPmJhc2Uuc2l6ZSB9LAotCQkJ
LnNpemUgPSBvYmotPmJhc2Uuc2l6ZSwKLQkJCS5wYWdlcyA9IG9iai0+bW0ucGFnZXMsCi0JCQku
b2JqID0gb2JqLAotCQl9OwotCi0JCXJldHVybiBpOTE1X3ZtYV9jb3JlZHVtcF9jcmVhdGUoZ3Qs
ICZmYWtlLCBuYW1lLCBjb21wcmVzcyk7Ci0JfSBlbHNlIHsKLQkJcmV0dXJuIE5VTEw7Ci0JfQot
fQotCiBzdGF0aWMgdm9pZCBhZGRfdm1hKHN0cnVjdCBpbnRlbF9lbmdpbmVfY29yZWR1bXAgKmVl
LAogCQkgICAgc3RydWN0IGk5MTVfdm1hX2NvcmVkdW1wICp2bWEpCiB7CkBAIC0xNDI2LDEyICsx
NDA2LDYgQEAgaW50ZWxfZW5naW5lX2NvcmVkdW1wX2FkZF92bWEoc3RydWN0IGludGVsX2VuZ2lu
ZV9jb3JlZHVtcCAqZWUsCiAJCQkJCSBlbmdpbmUtPndhX2N0eC52bWEsCiAJCQkJCSAiV0EgY29u
dGV4dCIsCiAJCQkJCSBjb21wcmVzcykpOwotCi0JYWRkX3ZtYShlZSwKLQkJY2FwdHVyZV9vYmpl
Y3QoZW5naW5lLT5ndCwKLQkJCSAgICAgICBlbmdpbmUtPmRlZmF1bHRfc3RhdGUsCi0JCQkgICAg
ICAgIk5VTEwgY29udGV4dCIsCi0JCQkgICAgICAgY29tcHJlc3MpKTsKIH0KIAogc3RhdGljIHN0
cnVjdCBpbnRlbF9lbmdpbmVfY29yZWR1bXAgKgotLSAKMi4yMC4xCgpfX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fXwpJbnRlbC1nZnggbWFpbGluZyBsaXN0Cklu
dGVsLWdmeEBsaXN0cy5mcmVlZGVza3RvcC5vcmcKaHR0cHM6Ly9saXN0cy5mcmVlZGVza3RvcC5v
cmcvbWFpbG1hbi9saXN0aW5mby9pbnRlbC1nZngK

Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 1833AB7DF3
	for <lists+intel-gfx@lfdr.de>; Thu, 19 Sep 2019 17:19:11 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id DF7456F64D;
	Thu, 19 Sep 2019 15:19:08 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from fireflyinternet.com (mail.fireflyinternet.com [109.228.58.192])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 5D3006F519
 for <intel-gfx@lists.freedesktop.org>; Thu, 19 Sep 2019 15:19:07 +0000 (UTC)
X-Default-Received-SPF: pass (skip=forwardok (res=PASS))
 x-ip-name=78.156.65.138; 
Received: from haswell.alporthouse.com (unverified [78.156.65.138]) 
 by fireflyinternet.com (Firefly Internet (M1)) with ESMTP id 18547793-1500050 
 for multiple; Thu, 19 Sep 2019 16:18:13 +0100
From: Chris Wilson <chris@chris-wilson.co.uk>
To: intel-gfx@lists.freedesktop.org
Date: Thu, 19 Sep 2019 16:18:11 +0100
Message-Id: <20190919151811.9526-1-chris@chris-wilson.co.uk>
X-Mailer: git-send-email 2.23.0
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH v2] drm/i915/tgl: Suspend pre-parser across GTT
 invalidations
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

QmVmb3JlIHdlIGV4ZWN1dGUgYSBiYXRjaCwgd2UgbXVzdCBmaXJzdCBpc3N1ZSBhbnkgYW5kIGFs
bCBUTEIKaW52YWxpZGF0aW9ucyBzbyB0aGF0IGJhdGNoIHBpY2tzIHVwIHRoZSBuZXcgcGFnZSB0
YWJsZSBlbnRyaWVzLgpUaWdlcmxha2UncyBwcmVwYXJzZXIgaXMgd2Vha2VuaW5nIG91ciBwb3N0
LXN5bmMgQ1NfU1RBTEwgaW5zaWRlIHRoZQppbnZhbGlkYXRlIHBpcGUtY29udHJvbCBhbmQgYWxs
b3dpbmcgdGhlIGxvYWRpbmcgb2YgdGhlIGJhdGNoIGJ1ZmZlcgpiZWZvcmUgd2UgaGF2ZSBzZXR1
cCBpdHMgcGFnZSB0YWJsZSAoYW5kIHNvIGl0IGxvYWRzIHRoZSB3cm9uZyBwYWdlIGFuZApleGVj
dXRlcyBpbmRlZmluaXRlbHkpLgoKVGhlIGlndF9jc190bGIgaW5kaWNhdGVzIHRoYXQgdGhpcyBp
c3N1ZSBjYW4gb25seSBiZSBvYnNlcnZlZCBvbiByY3MsCmV2ZW4gdGhvdWdoIHRoZSBwcmVwYXJz
ZXIgaXMgY29tbW9uIHRvIGFsbCBlbmdpbmVzLiBBbHRlcm5hdGl2ZWx5LCB3ZQpjb3VsZCBkbyBU
TEIgc2hvb3Rkb3duIHZpYSBtbWlvIG9uIHVwZGF0aW5nIHRoZSBHVFQuCgpCeSBpbnNlcnRpbmcg
dGhlIHByZS1wYXJzZXIgZGlzYWJsZSBpbnNpZGUgRU1JVF9JTlZBTElEQVRFLCB3ZSB3aWxsIGFs
c28KYWNjaWRlbnRhbGx5IGZpeHVwIGV4ZWN1dGlvbiB0aGF0IHdyaXRlcyBpbnRvIHN1YnNlcXVl
bnQgYmF0Y2hlcywgc3VjaAphcyBnZW1fZXhlY193aGlzcGVyIGFuZCBldmVuIHJlbG9jYXRpb25z
IHBlcmZvcm1lZCBvbiB0aGUgR1BVLiBXZSBzaG91bGQKYmUgY2FyZWZ1bCBub3QgdG8gYWxsb3cg
dGhpcyBkaXNhYmxlIHRvIGJlY29tZSBiYWtlZCBpbnRvIHRoZSB1QUJJIQoKVGVzdGNhc2U6IGln
dC9pOTE1X3NlbGZ0ZXN0cy9saXZlX2d0dC9pZ3RfY3NfdGxiClNpZ25lZC1vZmYtYnk6IENocmlz
IFdpbHNvbiA8Y2hyaXNAY2hyaXMtd2lsc29uLmNvLnVrPgpDYzogRGFuaWVsZSBDZXJhb2xvIFNw
dXJpbyA8ZGFuaWVsZS5jZXJhb2xvc3B1cmlvQGludGVsLmNvbT4KQ2M6IE1pa2EgS3VvcHBhbGEg
PG1pa2Eua3VvcHBhbGFAbGludXguaW50ZWwuY29tPgotLS0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1
L2d0L2ludGVsX2xyYy5jIHwgNzUgKysrKysrKysrKysrKysrKysrKysrKysrKysrKy0KIDEgZmls
ZSBjaGFuZ2VkLCA3NCBpbnNlcnRpb25zKCspLCAxIGRlbGV0aW9uKC0pCgpkaWZmIC0tZ2l0IGEv
ZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfbHJjLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkx
NS9ndC9pbnRlbF9scmMuYwppbmRleCBhOTkxNjZhMmQyZWIuLjYwYjdiMTYzYzNkMCAxMDA2NDQK
LS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfbHJjLmMKKysrIGIvZHJpdmVycy9n
cHUvZHJtL2k5MTUvZ3QvaW50ZWxfbHJjLmMKQEAgLTI4MDcsNiArMjgwNyw3OSBAQCBzdGF0aWMg
aW50IGdlbjExX2VtaXRfZmx1c2hfcmVuZGVyKHN0cnVjdCBpOTE1X3JlcXVlc3QgKnJlcXVlc3Qs
CiAJcmV0dXJuIDA7CiB9CiAKK3N0YXRpYyB1MzIgcHJlcGFyc2VyX2Rpc2FibGUoYm9vbCBzdGF0
ZSkKK3sKKwlyZXR1cm4gTUlfQVJCX0NIRUNLIHwgMSA8PCA4IHwgc3RhdGU7Cit9CisKK3N0YXRp
YyBpbnQgZ2VuMTJfZW1pdF9mbHVzaF9yZW5kZXIoc3RydWN0IGk5MTVfcmVxdWVzdCAqcmVxdWVz
dCwKKwkJCQkgICB1MzIgbW9kZSkKK3sKKwlzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmUg
PSByZXF1ZXN0LT5lbmdpbmU7CisJY29uc3QgdTMyIHNjcmF0Y2hfYWRkciA9CisJCWludGVsX2d0
X3NjcmF0Y2hfb2Zmc2V0KGVuZ2luZS0+Z3QsCisJCQkJCUlOVEVMX0dUX1NDUkFUQ0hfRklFTERf
UkVOREVSX0ZMVVNIKTsKKworCWlmIChtb2RlICYgRU1JVF9GTFVTSCkgeworCQl1MzIgZmxhZ3Mg
PSAwOworCQl1MzIgKmNzOworCisJCWZsYWdzIHw9IFBJUEVfQ09OVFJPTF9USUxFX0NBQ0hFX0ZM
VVNIOworCQlmbGFncyB8PSBQSVBFX0NPTlRST0xfUkVOREVSX1RBUkdFVF9DQUNIRV9GTFVTSDsK
KwkJZmxhZ3MgfD0gUElQRV9DT05UUk9MX0RFUFRIX0NBQ0hFX0ZMVVNIOworCQlmbGFncyB8PSBQ
SVBFX0NPTlRST0xfRENfRkxVU0hfRU5BQkxFOworCQlmbGFncyB8PSBQSVBFX0NPTlRST0xfRkxV
U0hfRU5BQkxFOworCisJCWZsYWdzIHw9IFBJUEVfQ09OVFJPTF9RV19XUklURTsKKwkJZmxhZ3Mg
fD0gUElQRV9DT05UUk9MX0dMT0JBTF9HVFRfSVZCOworCisJCWZsYWdzIHw9IFBJUEVfQ09OVFJP
TF9DU19TVEFMTDsKKworCQljcyA9IGludGVsX3JpbmdfYmVnaW4ocmVxdWVzdCwgNik7CisJCWlm
IChJU19FUlIoY3MpKQorCQkJcmV0dXJuIFBUUl9FUlIoY3MpOworCisJCWNzID0gZ2VuOF9lbWl0
X3BpcGVfY29udHJvbChjcywgZmxhZ3MsIHNjcmF0Y2hfYWRkcik7CisJCWludGVsX3JpbmdfYWR2
YW5jZShyZXF1ZXN0LCBjcyk7CisJfQorCisJaWYgKG1vZGUgJiBFTUlUX0lOVkFMSURBVEUpIHsK
KwkJdTMyIGZsYWdzID0gMDsKKwkJdTMyICpjczsKKworCQlmbGFncyB8PSBQSVBFX0NPTlRST0xf
Q09NTUFORF9DQUNIRV9JTlZBTElEQVRFOworCQlmbGFncyB8PSBQSVBFX0NPTlRST0xfVExCX0lO
VkFMSURBVEU7CisJCWZsYWdzIHw9IFBJUEVfQ09OVFJPTF9JTlNUUlVDVElPTl9DQUNIRV9JTlZB
TElEQVRFOworCQlmbGFncyB8PSBQSVBFX0NPTlRST0xfVEVYVFVSRV9DQUNIRV9JTlZBTElEQVRF
OworCQlmbGFncyB8PSBQSVBFX0NPTlRST0xfVkZfQ0FDSEVfSU5WQUxJREFURTsKKwkJZmxhZ3Mg
fD0gUElQRV9DT05UUk9MX0NPTlNUX0NBQ0hFX0lOVkFMSURBVEU7CisJCWZsYWdzIHw9IFBJUEVf
Q09OVFJPTF9TVEFURV9DQUNIRV9JTlZBTElEQVRFOworCisJCWZsYWdzIHw9IFBJUEVfQ09OVFJP
TF9HTE9CQUxfR1RUX0lWQjsKKwkJZmxhZ3MgfD0gUElQRV9DT05UUk9MX1FXX1dSSVRFOworCisJ
CWZsYWdzIHw9IFBJUEVfQ09OVFJPTF9DU19TVEFMTDsKKworCQljcyA9IGludGVsX3JpbmdfYmVn
aW4ocmVxdWVzdCwgOCk7CisJCWlmIChJU19FUlIoY3MpKQorCQkJcmV0dXJuIFBUUl9FUlIoY3Mp
OworCisJCS8qCisJCSAqIFByZXZlbnQgdGhlIHByZS1wYXJzZXIgZnJvbSBza2lwcGluZyBwYXN0
IHRoZSBUTEIKKwkJICogaW52YWxpZGF0ZSBhbmQgbG9hZGluZyBhIHN0YWxlIHBhZ2UgZm9yIHRo
ZSBiYXRjaAorCQkgKiBidWZmZXIgLyByZXF1ZXN0IHBheWxvYWQuCisJCSAqLworCQkqY3MrKyA9
IHByZXBhcnNlcl9kaXNhYmxlKHRydWUpOworCisJCWNzID0gZ2VuOF9lbWl0X3BpcGVfY29udHJv
bChjcywgZmxhZ3MsIHNjcmF0Y2hfYWRkcik7CisKKwkJKmNzKysgPSBwcmVwYXJzZXJfZGlzYWJs
ZShmYWxzZSk7CisJCWludGVsX3JpbmdfYWR2YW5jZShyZXF1ZXN0LCBjcyk7CisJfQorCisJcmV0
dXJuIDA7Cit9CisKIC8qCiAgKiBSZXNlcnZlIHNwYWNlIGZvciAyIE5PT1BzIGF0IHRoZSBlbmQg
b2YgZWFjaCByZXF1ZXN0IHRvIGJlCiAgKiB1c2VkIGFzIGEgd29ya2Fyb3VuZCBmb3Igbm90IGJl
aW5nIGFsbG93ZWQgdG8gZG8gbGl0ZQpAQCAtMzA3Miw3ICszMTQ1LDcgQEAgc3RhdGljIHZvaWQg
cmNzX3N1Ym1pc3Npb25fb3ZlcnJpZGUoc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lKQog
ewogCXN3aXRjaCAoSU5URUxfR0VOKGVuZ2luZS0+aTkxNSkpIHsKIAljYXNlIDEyOgotCQllbmdp
bmUtPmVtaXRfZmx1c2ggPSBnZW4xMV9lbWl0X2ZsdXNoX3JlbmRlcjsKKwkJZW5naW5lLT5lbWl0
X2ZsdXNoID0gZ2VuMTJfZW1pdF9mbHVzaF9yZW5kZXI7CiAJCWVuZ2luZS0+ZW1pdF9maW5pX2Jy
ZWFkY3J1bWIgPSBnZW4xMl9lbWl0X2ZpbmlfYnJlYWRjcnVtYl9yY3M7CiAJCWJyZWFrOwogCWNh
c2UgMTE6Ci0tIAoyLjIzLjAKCl9fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fCkludGVsLWdmeCBtYWlsaW5nIGxpc3QKSW50ZWwtZ2Z4QGxpc3RzLmZyZWVkZXNr
dG9wLm9yZwpodHRwczovL2xpc3RzLmZyZWVkZXNrdG9wLm9yZy9tYWlsbWFuL2xpc3RpbmZvL2lu
dGVsLWdmeA==

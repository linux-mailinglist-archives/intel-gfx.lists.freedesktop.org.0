Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id EBE944555F
	for <lists+intel-gfx@lfdr.de>; Fri, 14 Jun 2019 09:11:08 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 675B48944A;
	Fri, 14 Jun 2019 07:11:01 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from fireflyinternet.com (mail.fireflyinternet.com [109.228.58.192])
 by gabe.freedesktop.org (Postfix) with ESMTPS id C679A89356
 for <intel-gfx@lists.freedesktop.org>; Fri, 14 Jun 2019 07:10:43 +0000 (UTC)
X-Default-Received-SPF: pass (skip=forwardok (res=PASS))
 x-ip-name=78.156.65.138; 
Received: from haswell.alporthouse.com (unverified [78.156.65.138]) 
 by fireflyinternet.com (Firefly Internet (M1)) with ESMTP id 16897547-1500050 
 for multiple; Fri, 14 Jun 2019 08:10:42 +0100
From: Chris Wilson <chris@chris-wilson.co.uk>
To: intel-gfx@lists.freedesktop.org
Date: Fri, 14 Jun 2019 08:10:20 +0100
Message-Id: <20190614071023.17929-37-chris@chris-wilson.co.uk>
X-Mailer: git-send-email 2.20.1
In-Reply-To: <20190614071023.17929-1-chris@chris-wilson.co.uk>
References: <20190614071023.17929-1-chris@chris-wilson.co.uk>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH 36/39] drm/i915: Use reservation_object to
 coordinate userptr get_pages()
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

U2lnbmVkLW9mZi1ieTogQ2hyaXMgV2lsc29uIDxjaHJpc0BjaHJpcy13aWxzb24uY28udWs+Ci0t
LQogZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX2RtYWJ1Zi5jICAgIHwgIDI3ICst
LQogLi4uL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fZXhlY2J1ZmZlci5jICAgIHwgICAzIC0K
IGRyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9pbnRlcm5hbC5jICB8ICAzMCArLS0K
IC4uLi9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX29iamVjdF90eXBlcy5oICB8ICAxMSArLQog
ZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX3BhZ2VzLmMgICAgIHwgMTM3ICsrKysr
KysrKystCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fcGh5cy5jICAgICAgfCAg
MzMgKystCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fc2htZW0uYyAgICAgfCAg
MzAgKy0tCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fc3RvbGVuLmMgICAgfCAg
MjUgKy0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV91c2VycHRyLmMgICB8IDIy
MSArKysrLS0tLS0tLS0tLS0tLS0KIC4uLi9kcm0vaTkxNS9nZW0vc2VsZnRlc3RzL2h1Z2VfZ2Vt
X29iamVjdC5jICB8ICAxNyArLQogLi4uL2dwdS9kcm0vaTkxNS9nZW0vc2VsZnRlc3RzL2h1Z2Vf
cGFnZXMuYyAgIHwgIDQ1ICsrLS0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2d2dC9kbWFidWYuYyAg
ICAgICAgICAgICB8ICAxNyArLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9kcnYuaCAgICAg
ICAgICAgICAgIHwgICA5ICstCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2dlbS5jICAgICAg
ICAgICAgICAgfCAgIDUgKy0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L3NlbGZ0ZXN0cy9pOTE1X2dl
bV9ndHQuYyB8ICAxNCArLQogMTUgZmlsZXMgY2hhbmdlZCwgMzAwIGluc2VydGlvbnMoKyksIDMy
NCBkZWxldGlvbnMoLSkKCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkx
NV9nZW1fZG1hYnVmLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fZG1hYnVm
LmMKaW5kZXggODQ5OTJkNTkwZGE1Li5hNDRkNmQyZWY3ZWQgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMv
Z3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9kbWFidWYuYworKysgYi9kcml2ZXJzL2dwdS9kcm0v
aTkxNS9nZW0vaTkxNV9nZW1fZG1hYnVmLmMKQEAgLTIyNSwzMyArMjI1LDI0IEBAIHN0cnVjdCBk
bWFfYnVmICppOTE1X2dlbV9wcmltZV9leHBvcnQoc3RydWN0IGRybV9kZXZpY2UgKmRldiwKIAly
ZXR1cm4gZHJtX2dlbV9kbWFidWZfZXhwb3J0KGRldiwgJmV4cF9pbmZvKTsKIH0KIAotc3RhdGlj
IGludCBpOTE1X2dlbV9vYmplY3RfZ2V0X3BhZ2VzX2RtYWJ1ZihzdHJ1Y3QgZHJtX2k5MTVfZ2Vt
X29iamVjdCAqb2JqKQorc3RhdGljIHN0cnVjdCBzZ190YWJsZSAqCitkbWFidWZfZ2V0X3BhZ2Vz
KHN0cnVjdCBpOTE1X2dlbV9vYmplY3RfZ2V0X3BhZ2VzX2NvbnRleHQgKmN0eCwKKwkJIHVuc2ln
bmVkIGludCAqc2l6ZXMpCiB7Ci0Jc3RydWN0IHNnX3RhYmxlICpwYWdlczsKLQl1bnNpZ25lZCBp
bnQgc2dfcGFnZV9zaXplczsKLQotCXBhZ2VzID0gZG1hX2J1Zl9tYXBfYXR0YWNobWVudChvYmot
PmJhc2UuaW1wb3J0X2F0dGFjaCwKLQkJCQkgICAgICAgRE1BX0JJRElSRUNUSU9OQUwpOwotCWlm
IChJU19FUlIocGFnZXMpKQotCQlyZXR1cm4gUFRSX0VSUihwYWdlcyk7Ci0KLQlzZ19wYWdlX3Np
emVzID0gaTkxNV9zZ19wYWdlX3NpemVzKHBhZ2VzLT5zZ2wpOwotCi0JX19pOTE1X2dlbV9vYmpl
Y3Rfc2V0X3BhZ2VzKG9iaiwgcGFnZXMsIHNnX3BhZ2Vfc2l6ZXMpOwotCi0JcmV0dXJuIDA7CisJ
cmV0dXJuIGRtYV9idWZfbWFwX2F0dGFjaG1lbnQoY3R4LT5vYmplY3QtPmJhc2UuaW1wb3J0X2F0
dGFjaCwKKwkJCQkgICAgICBETUFfQklESVJFQ1RJT05BTCk7CiB9CiAKLXN0YXRpYyB2b2lkIGk5
MTVfZ2VtX29iamVjdF9wdXRfcGFnZXNfZG1hYnVmKHN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0
ICpvYmosCi0JCQkJCSAgICAgc3RydWN0IHNnX3RhYmxlICpwYWdlcykKK3N0YXRpYyB2b2lkIGRt
YWJ1Zl9wdXRfcGFnZXMoc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iaiwKKwkJCSAgICAg
c3RydWN0IHNnX3RhYmxlICpwYWdlcykKIHsKIAlkbWFfYnVmX3VubWFwX2F0dGFjaG1lbnQob2Jq
LT5iYXNlLmltcG9ydF9hdHRhY2gsIHBhZ2VzLAogCQkJCSBETUFfQklESVJFQ1RJT05BTCk7CiB9
CiAKIHN0YXRpYyBjb25zdCBzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdF9vcHMgaTkxNV9nZW1f
b2JqZWN0X2RtYWJ1Zl9vcHMgPSB7Ci0JLmdldF9wYWdlcyA9IGk5MTVfZ2VtX29iamVjdF9nZXRf
cGFnZXNfZG1hYnVmLAotCS5wdXRfcGFnZXMgPSBpOTE1X2dlbV9vYmplY3RfcHV0X3BhZ2VzX2Rt
YWJ1ZiwKKwkuZ2V0X3BhZ2VzID0gZG1hYnVmX2dldF9wYWdlcywKKwkucHV0X3BhZ2VzID0gZG1h
YnVmX3B1dF9wYWdlcywKIH07CiAKIHN0cnVjdCBkcm1fZ2VtX29iamVjdCAqaTkxNV9nZW1fcHJp
bWVfaW1wb3J0KHN0cnVjdCBkcm1fZGV2aWNlICpkZXYsCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dw
dS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fZXhlY2J1ZmZlci5jIGIvZHJpdmVycy9ncHUvZHJtL2k5
MTUvZ2VtL2k5MTVfZ2VtX2V4ZWNidWZmZXIuYwppbmRleCA0NGJjYjY4MWMxNjguLjY4ZmFmMWE3
MWM5NyAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX2V4ZWNi
dWZmZXIuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fZXhlY2J1ZmZl
ci5jCkBAIC0xNzg0LDkgKzE3ODQsNiBAQCBzdGF0aWMgbm9pbmxpbmUgaW50IGViX3JlbG9jYXRl
X3Nsb3coc3RydWN0IGk5MTVfZXhlY2J1ZmZlciAqZWIpCiAJCWdvdG8gb3V0OwogCX0KIAotCS8q
IEEgZnJlcXVlbnQgY2F1c2UgZm9yIEVBR0FJTiBhcmUgY3VycmVudGx5IHVuYXZhaWxhYmxlIGNs
aWVudCBwYWdlcyAqLwotCWZsdXNoX3dvcmtxdWV1ZShlYi0+aTkxNS0+bW0udXNlcnB0cl93cSk7
Ci0KIAllcnIgPSBpOTE1X211dGV4X2xvY2tfaW50ZXJydXB0aWJsZShkZXYpOwogCWlmIChlcnIp
IHsKIAkJbXV0ZXhfbG9jaygmZGV2LT5zdHJ1Y3RfbXV0ZXgpOwpkaWZmIC0tZ2l0IGEvZHJpdmVy
cy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX2ludGVybmFsLmMgYi9kcml2ZXJzL2dwdS9kcm0v
aTkxNS9nZW0vaTkxNV9nZW1faW50ZXJuYWwuYwppbmRleCAwYzQxZTA0YWI4ZmEuLmFhMGJkNWRl
MzEzYiAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX2ludGVy
bmFsLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX2ludGVybmFsLmMK
QEAgLTMyLDExICszMiwxNCBAQCBzdGF0aWMgdm9pZCBpbnRlcm5hbF9mcmVlX3BhZ2VzKHN0cnVj
dCBzZ190YWJsZSAqc3QpCiAJa2ZyZWUoc3QpOwogfQogCi1zdGF0aWMgaW50IGk5MTVfZ2VtX29i
amVjdF9nZXRfcGFnZXNfaW50ZXJuYWwoc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iaikK
K3N0YXRpYyBzdHJ1Y3Qgc2dfdGFibGUgKgoraW50ZXJuYWxfZ2V0X3BhZ2VzKHN0cnVjdCBpOTE1
X2dlbV9vYmplY3RfZ2V0X3BhZ2VzX2NvbnRleHQgKmN0eCwKKwkJICAgdW5zaWduZWQgaW50ICpz
aXplcykKIHsKKwlzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2JqID0gY3R4LT5vYmplY3Q7
CiAJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSB0b19pOTE1KG9iai0+YmFzZS5kZXYp
OwotCXN0cnVjdCBzZ190YWJsZSAqc3Q7CiAJc3RydWN0IHNjYXR0ZXJsaXN0ICpzZzsKKwlzdHJ1
Y3Qgc2dfdGFibGUgKnN0OwogCXVuc2lnbmVkIGludCBzZ19wYWdlX3NpemVzOwogCXVuc2lnbmVk
IGludCBucGFnZXM7CiAJaW50IG1heF9vcmRlcjsKQEAgLTY2LDEyICs2OSwxMiBAQCBzdGF0aWMg
aW50IGk5MTVfZ2VtX29iamVjdF9nZXRfcGFnZXNfaW50ZXJuYWwoc3RydWN0IGRybV9pOTE1X2dl
bV9vYmplY3QgKm9iaikKIGNyZWF0ZV9zdDoKIAlzdCA9IGttYWxsb2Moc2l6ZW9mKCpzdCksIEdG
UF9LRVJORUwpOwogCWlmICghc3QpCi0JCXJldHVybiAtRU5PTUVNOworCQlyZXR1cm4gRVJSX1BU
UigtRU5PTUVNKTsKIAogCW5wYWdlcyA9IG9iai0+YmFzZS5zaXplIC8gUEFHRV9TSVpFOwogCWlm
IChzZ19hbGxvY190YWJsZShzdCwgbnBhZ2VzLCBHRlBfS0VSTkVMKSkgewogCQlrZnJlZShzdCk7
Ci0JCXJldHVybiAtRU5PTUVNOworCQlyZXR1cm4gRVJSX1BUUigtRU5PTUVNKTsKIAl9CiAKIAlz
ZyA9IHN0LT5zZ2w7CkBAIC0xMTcsMjcgKzEyMCwyNiBAQCBzdGF0aWMgaW50IGk5MTVfZ2VtX29i
amVjdF9nZXRfcGFnZXNfaW50ZXJuYWwoc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iaikK
IAkJZ290byBlcnI7CiAJfQogCi0JLyogTWFyayB0aGUgcGFnZXMgYXMgZG9udG5lZWQgd2hpbHN0
IHRoZXkgYXJlIHN0aWxsIHBpbm5lZC4gQXMgc29vbgorCS8qCisJICogTWFyayB0aGUgcGFnZXMg
YXMgZG9udG5lZWQgd2hpbHN0IHRoZXkgYXJlIHN0aWxsIHBpbm5lZC4gQXMgc29vbgogCSAqIGFz
IHRoZXkgYXJlIHVucGlubmVkIHRoZXkgYXJlIGFsbG93ZWQgdG8gYmUgcmVhcGVkIGJ5IHRoZSBz
aHJpbmtlciwKIAkgKiBhbmQgdGhlIGNhbGxlciBpcyBleHBlY3RlZCB0byByZXBvcHVsYXRlIC0g
dGhlIGNvbnRlbnRzIG9mIHRoaXMKIAkgKiBvYmplY3QgYXJlIG9ubHkgdmFsaWQgd2hpbHN0IGFj
dGl2ZSBhbmQgcGlubmVkLgogCSAqLwogCW9iai0+bW0ubWFkdiA9IEk5MTVfTUFEVl9ET05UTkVF
RDsKIAotCV9faTkxNV9nZW1fb2JqZWN0X3NldF9wYWdlcyhvYmosIHN0LCBzZ19wYWdlX3NpemVz
KTsKLQotCXJldHVybiAwOworCSpzaXplcyA9IHNnX3BhZ2Vfc2l6ZXM7CisJcmV0dXJuIHN0Owog
CiBlcnI6CiAJc2dfc2V0X3BhZ2Uoc2csIE5VTEwsIDAsIDApOwogCXNnX21hcmtfZW5kKHNnKTsK
IAlpbnRlcm5hbF9mcmVlX3BhZ2VzKHN0KTsKLQotCXJldHVybiAtRU5PTUVNOworCXJldHVybiBF
UlJfUFRSKC1FTk9NRU0pOwogfQogCi1zdGF0aWMgdm9pZCBpOTE1X2dlbV9vYmplY3RfcHV0X3Bh
Z2VzX2ludGVybmFsKHN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmosCi0JCQkJCSAgICAg
ICBzdHJ1Y3Qgc2dfdGFibGUgKnBhZ2VzKQorc3RhdGljIHZvaWQgaW50ZXJuYWxfcHV0X3BhZ2Vz
KHN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmosCisJCQkgICAgICAgc3RydWN0IHNnX3Rh
YmxlICpwYWdlcykKIHsKIAlpOTE1X2dlbV9ndHRfZmluaXNoX3BhZ2VzKG9iaiwgcGFnZXMpOwog
CWludGVybmFsX2ZyZWVfcGFnZXMocGFnZXMpOwpAQCAtMTQ5LDggKzE1MSw4IEBAIHN0YXRpYyB2
b2lkIGk5MTVfZ2VtX29iamVjdF9wdXRfcGFnZXNfaW50ZXJuYWwoc3RydWN0IGRybV9pOTE1X2dl
bV9vYmplY3QgKm9iaiwKIHN0YXRpYyBjb25zdCBzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdF9v
cHMgaTkxNV9nZW1fb2JqZWN0X2ludGVybmFsX29wcyA9IHsKIAkuZmxhZ3MgPSBJOTE1X0dFTV9P
QkpFQ1RfSEFTX1NUUlVDVF9QQUdFIHwKIAkJIEk5MTVfR0VNX09CSkVDVF9JU19TSFJJTktBQkxF
LAotCS5nZXRfcGFnZXMgPSBpOTE1X2dlbV9vYmplY3RfZ2V0X3BhZ2VzX2ludGVybmFsLAotCS5w
dXRfcGFnZXMgPSBpOTE1X2dlbV9vYmplY3RfcHV0X3BhZ2VzX2ludGVybmFsLAorCS5nZXRfcGFn
ZXMgPSBpbnRlcm5hbF9nZXRfcGFnZXMsCisJLnB1dF9wYWdlcyA9IGludGVybmFsX3B1dF9wYWdl
cywKIH07CiAKIC8qKgpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVf
Z2VtX29iamVjdF90eXBlcy5oIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX29i
amVjdF90eXBlcy5oCmluZGV4IGY3OTI5NTNiOGE3MS4uMGVhNDA0Y2ZiYzFjIDEwMDY0NAotLS0g
YS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fb2JqZWN0X3R5cGVzLmgKKysrIGIv
ZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX29iamVjdF90eXBlcy5oCkBAIC0xOSw2
ICsxOSw3IEBACiAKIHN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0Owogc3RydWN0IGludGVsX2Zy
b25idWZmZXI7CitzdHJ1Y3QgdGFza19zdHJ1Y3Q7CiAKIC8qCiAgKiBzdHJ1Y3QgaTkxNV9sdXRf
aGFuZGxlIHRyYWNrcyB0aGUgZmFzdCBsb29rdXBzIGZyb20gaGFuZGxlIHRvIHZtYSB1c2VkCkBA
IC0zMiw2ICszMywxMSBAQCBzdHJ1Y3QgaTkxNV9sdXRfaGFuZGxlIHsKIAl1MzIgaGFuZGxlOwog
fTsKIAorc3RydWN0IGk5MTVfZ2VtX29iamVjdF9nZXRfcGFnZXNfY29udGV4dCAgeworCXN0cnVj
dCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmplY3Q7CisJc3RydWN0IHRhc2tfc3RydWN0ICp0YXNr
OworfTsKKwogc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3Rfb3BzIHsKIAl1bnNpZ25lZCBpbnQg
ZmxhZ3M7CiAjZGVmaW5lIEk5MTVfR0VNX09CSkVDVF9IQVNfU1RSVUNUX1BBR0UJQklUKDApCkBA
IC01Miw5ICs1OCwxMSBAQCBzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdF9vcHMgewogCSAqIGJl
aW5nIHJlbGVhc2VkIG9yIHVuZGVyIG1lbW9yeSBwcmVzc3VyZSAod2hlcmUgd2UgYXR0ZW1wdCB0
bwogCSAqIHJlYXAgcGFnZXMgZm9yIHRoZSBzaHJpbmtlcikuCiAJICovCi0JaW50ICgqZ2V0X3Bh
Z2VzKShzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2JqKTsKKwlzdHJ1Y3Qgc2dfdGFibGUg
KigqZ2V0X3BhZ2VzKShzdHJ1Y3QgaTkxNV9nZW1fb2JqZWN0X2dldF9wYWdlc19jb250ZXh0ICpj
dHgsCisJCQkJICAgICAgdW5zaWduZWQgaW50ICpzaXplcyk7CiAJdm9pZCAoKnB1dF9wYWdlcyko
c3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iaiwKIAkJCSAgc3RydWN0IHNnX3RhYmxlICpw
YWdlcyk7CisKIAl2b2lkICgqdHJ1bmNhdGUpKHN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpv
YmopOwogCXZvaWQgKCp3cml0ZWJhY2spKHN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmop
OwogCkBAIC0yNTIsNyArMjYwLDYgQEAgc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgewogCiAJ
CQlzdHJ1Y3QgaTkxNV9tbV9zdHJ1Y3QgKm1tOwogCQkJc3RydWN0IGk5MTVfbW11X29iamVjdCAq
bW11X29iamVjdDsKLQkJCXN0cnVjdCB3b3JrX3N0cnVjdCAqd29yazsKIAkJfSB1c2VycHRyOwog
CiAJCXVuc2lnbmVkIGxvbmcgc2NyYXRjaDsKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9p
OTE1L2dlbS9pOTE1X2dlbV9wYWdlcy5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVf
Z2VtX3BhZ2VzLmMKaW5kZXggNmJlYzMwMWNlZTc5Li5mNjVhOTgzMjQ4YzYgMTAwNjQ0Ci0tLSBh
L2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9wYWdlcy5jCisrKyBiL2RyaXZlcnMv
Z3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9wYWdlcy5jCkBAIC04LDE2ICs4LDQ5IEBACiAjaW5j
bHVkZSAiaTkxNV9nZW1fb2JqZWN0LmgiCiAjaW5jbHVkZSAiaTkxNV9zY2F0dGVybGlzdC5oIgog
Ci12b2lkIF9faTkxNV9nZW1fb2JqZWN0X3NldF9wYWdlcyhzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29i
amVjdCAqb2JqLAotCQkJCSBzdHJ1Y3Qgc2dfdGFibGUgKnBhZ2VzLAotCQkJCSB1bnNpZ25lZCBp
bnQgc2dfcGFnZV9zaXplcykKK3N0YXRpYyBERUZJTkVfU1BJTkxPQ0soZmVuY2VfbG9jayk7CisK
K3N0cnVjdCBnZXRfcGFnZXNfd29yayB7CisJc3RydWN0IGRtYV9mZW5jZSBkbWE7IC8qIE11c3Qg
YmUgZmlyc3QgZm9yIGRtYV9mZW5jZV9mcmVlKCkgKi8KKwlzdHJ1Y3QgaTkxNV9zd19mZW5jZSB3
YWl0OworCXN0cnVjdCB3b3JrX3N0cnVjdCB3b3JrOworCXN0cnVjdCBpOTE1X2dlbV9vYmplY3Rf
Z2V0X3BhZ2VzX2NvbnRleHQgY3R4OworfTsKKworc3RhdGljIGNvbnN0IGNoYXIgKmdldF9wYWdl
c193b3JrX2RyaXZlcl9uYW1lKHN0cnVjdCBkbWFfZmVuY2UgKmZlbmNlKQoreworCXJldHVybiBE
UklWRVJfTkFNRTsKK30KKworc3RhdGljIGNvbnN0IGNoYXIgKmdldF9wYWdlc193b3JrX3RpbWVs
aW5lX25hbWUoc3RydWN0IGRtYV9mZW5jZSAqZmVuY2UpCit7CisJcmV0dXJuICJhbGxvY2F0aW9u
IjsKK30KKworc3RhdGljIHZvaWQgZ2V0X3BhZ2VzX3dvcmtfcmVsZWFzZShzdHJ1Y3QgZG1hX2Zl
bmNlICpmZW5jZSkKK3sKKwlzdHJ1Y3QgZ2V0X3BhZ2VzX3dvcmsgKncgPSBjb250YWluZXJfb2Yo
ZmVuY2UsIHR5cGVvZigqdyksIGRtYSk7CisKKwlpOTE1X3N3X2ZlbmNlX2ZpbmkoJnctPndhaXQp
OworCisJQlVJTERfQlVHX09OKG9mZnNldG9mKHR5cGVvZigqdyksIGRtYSkpOworCWRtYV9mZW5j
ZV9mcmVlKCZ3LT5kbWEpOworfQorCitzdGF0aWMgY29uc3Qgc3RydWN0IGRtYV9mZW5jZV9vcHMg
Z2V0X3BhZ2VzX3dvcmtfb3BzID0geworCS5nZXRfZHJpdmVyX25hbWUgPSBnZXRfcGFnZXNfd29y
a19kcml2ZXJfbmFtZSwKKwkuZ2V0X3RpbWVsaW5lX25hbWUgPSBnZXRfcGFnZXNfd29ya190aW1l
bGluZV9uYW1lLAorCS5yZWxlYXNlID0gZ2V0X3BhZ2VzX3dvcmtfcmVsZWFzZSwKK307CisKK3N0
YXRpYyB2b2lkIF9fc2V0X3BhZ2VzKHN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmosCisJ
CQlzdHJ1Y3Qgc2dfdGFibGUgKnBhZ2VzLAorCQkJdW5zaWduZWQgaW50IHNnX3BhZ2Vfc2l6ZXMp
CiB7CiAJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSB0b19pOTE1KG9iai0+YmFzZS5k
ZXYpOwogCXVuc2lnbmVkIGxvbmcgc3VwcG9ydGVkID0gSU5URUxfSU5GTyhpOTE1KS0+cGFnZV9z
aXplczsKIAlpbnQgaTsKIAotCWxvY2tkZXBfYXNzZXJ0X2hlbGQoJm9iai0+bW0ubG9jayk7Ci0K
IAkvKiBNYWtlIHRoZSBwYWdlcyBjb2hlcmVudCB3aXRoIHRoZSBHUFUgKGZsdXNoaW5nIGFueSBz
d2FwaW4pLiAqLwogCWlmIChvYmotPmNhY2hlX2RpcnR5KSB7CiAJCW9iai0+d3JpdGVfZG9tYWlu
ID0gMDsKQEAgLTI5LDggKzYyLDYgQEAgdm9pZCBfX2k5MTVfZ2VtX29iamVjdF9zZXRfcGFnZXMo
c3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iaiwKIAlvYmotPm1tLmdldF9wYWdlLnNnX3Bv
cyA9IHBhZ2VzLT5zZ2w7CiAJb2JqLT5tbS5nZXRfcGFnZS5zZ19pZHggPSAwOwogCi0Jb2JqLT5t
bS5wYWdlcyA9IHBhZ2VzOwotCiAJaWYgKGk5MTVfZ2VtX29iamVjdF9pc190aWxlZChvYmopICYm
CiAJICAgIGk5MTUtPnF1aXJrcyAmIFFVSVJLX1BJTl9TV0laWkxFRF9QQUdFUykgewogCQlHRU1f
QlVHX09OKG9iai0+bW0ucXVpcmtlZCk7CkBAIC0zOCw3ICs2OSw4IEBAIHZvaWQgX19pOTE1X2dl
bV9vYmplY3Rfc2V0X3BhZ2VzKHN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmosCiAJCW9i
ai0+bW0ucXVpcmtlZCA9IHRydWU7CiAJfQogCi0JR0VNX0JVR19PTighc2dfcGFnZV9zaXplcyk7
CisJaWYgKCFzZ19wYWdlX3NpemVzKQorCQlzZ19wYWdlX3NpemVzID0gaTkxNV9zZ19wYWdlX3Np
emVzKHBhZ2VzLT5zZ2wpOwogCW9iai0+bW0ucGFnZV9zaXplcy5waHlzID0gc2dfcGFnZV9zaXpl
czsKIAogCS8qCkBAIC03MywxOCArMTA1LDEwNSBAQCB2b2lkIF9faTkxNV9nZW1fb2JqZWN0X3Nl
dF9wYWdlcyhzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2JqLAogCiAJCXNwaW5fdW5sb2Nr
X2lycXJlc3RvcmUoJmk5MTUtPm1tLm9ial9sb2NrLCBmbGFncyk7CiAJfQorfQogCitzdGF0aWMg
dm9pZAorZ2V0X3BhZ2VzX3dvcmtlcihzdHJ1Y3Qgd29ya19zdHJ1Y3QgKl93b3JrKQoreworCXN0
cnVjdCBnZXRfcGFnZXNfd29yayAqd29yayA9IGNvbnRhaW5lcl9vZihfd29yaywgdHlwZW9mKCp3
b3JrKSwgd29yayk7CisJc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iaiA9IHdvcmstPmN0
eC5vYmplY3Q7CisJc3RydWN0IHNnX3RhYmxlICpwYWdlczsKKwl1bnNpZ25lZCBpbnQgc2l6ZXMg
PSAwOworCisJaWYgKCF3b3JrLT5kbWEuZXJyb3IpIHsKKwkJcGFnZXMgPSBvYmotPm9wcy0+Z2V0
X3BhZ2VzKCZ3b3JrLT5jdHgsICZzaXplcyk7CisJCWlmICghSVNfRVJSKHBhZ2VzKSkKKwkJCV9f
c2V0X3BhZ2VzKG9iaiwgcGFnZXMsIHNpemVzKTsKKwkJZWxzZQorCQkJZG1hX2ZlbmNlX3NldF9l
cnJvcigmd29yay0+ZG1hLCBQVFJfRVJSKHBhZ2VzKSk7CisJfSBlbHNlIHsKKwkJcGFnZXMgPSBF
UlJfUFRSKHdvcmstPmRtYS5lcnJvcik7CisJfQorCisJb2JqLT5tbS5wYWdlcyA9IHBhZ2VzOwog
CWNvbXBsZXRlX2FsbCgmb2JqLT5tbS5jb21wbGV0aW9uKTsKKwlhdG9taWNfZGVjKCZvYmotPm1t
LnBhZ2VzX3Bpbl9jb3VudCk7CisKKwlpOTE1X2dlbV9vYmplY3RfcHV0KG9iaik7CisJcHV0X3Rh
c2tfc3RydWN0KHdvcmstPmN0eC50YXNrKTsKKworCWRtYV9mZW5jZV9zaWduYWwoJndvcmstPmRt
YSk7CisJZG1hX2ZlbmNlX3B1dCgmd29yay0+ZG1hKTsKK30KKworc3RhdGljIGludCBfX2k5MTVf
c3dfZmVuY2VfY2FsbAorZ2V0X3BhZ2VzX25vdGlmeShzdHJ1Y3QgaTkxNV9zd19mZW5jZSAqZmVu
Y2UsIGVudW0gaTkxNV9zd19mZW5jZV9ub3RpZnkgc3RhdGUpCit7CisJc3RydWN0IGdldF9wYWdl
c193b3JrICp3ID0gY29udGFpbmVyX29mKGZlbmNlLCB0eXBlb2YoKncpLCB3YWl0KTsKKworCXN3
aXRjaCAoc3RhdGUpIHsKKwljYXNlIEZFTkNFX0NPTVBMRVRFOgorCQlpZiAoZmVuY2UtPmVycm9y
KQorCQkJZG1hX2ZlbmNlX3NldF9lcnJvcigmdy0+ZG1hLCBmZW5jZS0+ZXJyb3IpOworCQlxdWV1
ZV93b3JrKHN5c3RlbV91bmJvdW5kX3dxLCAmdy0+d29yayk7CisJCWJyZWFrOworCisJY2FzZSBG
RU5DRV9GUkVFOgorCQlkbWFfZmVuY2VfcHV0KCZ3LT5kbWEpOworCQlicmVhazsKKwl9CisKKwly
ZXR1cm4gTk9USUZZX0RPTkU7CiB9CiAKIGludCBfX19faTkxNV9nZW1fb2JqZWN0X2dldF9wYWdl
cyhzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2JqKQogeworCXN0cnVjdCBnZXRfcGFnZXNf
d29yayAqd29yazsKKwlpbnQgZXJyOworCiAJaWYgKHVubGlrZWx5KG9iai0+bW0ubWFkdiAhPSBJ
OTE1X01BRFZfV0lMTE5FRUQpKSB7CiAJCURSTV9ERUJVRygiQXR0ZW1wdGluZyB0byBvYnRhaW4g
YSBwdXJnZWFibGUgb2JqZWN0XG4iKTsKIAkJcmV0dXJuIC1FRkFVTFQ7CiAJfQogCi0JcmV0dXJu
IG9iai0+b3BzLT5nZXRfcGFnZXMob2JqKTsKKwkvKiBYWFggaW5saW5lPyAqLworCisJd29yayA9
IGttYWxsb2Moc2l6ZW9mKCp3b3JrKSwgR0ZQX0tFUk5FTCk7CisJaWYgKCF3b3JrKQorCQlyZXR1
cm4gLUVOT01FTTsKKworCWRtYV9mZW5jZV9pbml0KCZ3b3JrLT5kbWEsCisJCSAgICAgICAmZ2V0
X3BhZ2VzX3dvcmtfb3BzLAorCQkgICAgICAgJmZlbmNlX2xvY2ssCisJCSAgICAgICB0b19pOTE1
KG9iai0+YmFzZS5kZXYpLT5tbS51bm9yZGVyZWRfdGltZWxpbmUsCisJCSAgICAgICAwKTsKKwlp
OTE1X3N3X2ZlbmNlX2luaXQoJndvcmstPndhaXQsIGdldF9wYWdlc19ub3RpZnkpOworCisJd29y
ay0+Y3R4Lm9iamVjdCA9IGk5MTVfZ2VtX29iamVjdF9nZXQob2JqKTsKKworCXdvcmstPmN0eC50
YXNrID0gY3VycmVudDsKKwlnZXRfdGFza19zdHJ1Y3Qod29yay0+Y3R4LnRhc2spOworCisJSU5J
VF9XT1JLKCZ3b3JrLT53b3JrLCBnZXRfcGFnZXNfd29ya2VyKTsKKworCWk5MTVfZ2VtX29iamVj
dF9sb2NrKG9iaik7CisJR0VNX0JVR19PTighcmVzZXJ2YXRpb25fb2JqZWN0X3Rlc3Rfc2lnbmFs
ZWRfcmN1KG9iai0+cmVzdiwgdHJ1ZSkpOworCWVyciA9IGk5MTVfc3dfZmVuY2VfYXdhaXRfcmVz
ZXJ2YXRpb24oJndvcmstPndhaXQsCisJCQkJCSAgICAgIG9iai0+cmVzdiwgTlVMTCwKKwkJCQkJ
ICAgICAgdHJ1ZSwgSTkxNV9GRU5DRV9USU1FT1VULAorCQkJCQkgICAgICBJOTE1X0ZFTkNFX0dG
UCk7CisJaWYgKGVyciA9PSAwKSB7CisJCXJlc2VydmF0aW9uX29iamVjdF9hZGRfZXhjbF9mZW5j
ZShvYmotPnJlc3YsICZ3b3JrLT5kbWEpOworCQlhdG9taWNfaW5jKCZvYmotPm1tLnBhZ2VzX3Bp
bl9jb3VudCk7CisJfSBlbHNlIHsKKwkJZG1hX2ZlbmNlX3NldF9lcnJvcigmd29yay0+ZG1hLCBl
cnIpOworCX0KKwlpOTE1X2dlbV9vYmplY3RfdW5sb2NrKG9iaik7CisKKwlkbWFfZmVuY2VfZ2V0
KCZ3b3JrLT5kbWEpOworCWk5MTVfc3dfZmVuY2VfY29tbWl0KCZ3b3JrLT53YWl0KTsKKworCXJl
dHVybiBlcnI7CiB9CiAKIC8qIEVuc3VyZSB0aGF0IHRoZSBhc3NvY2lhdGVkIHBhZ2VzIGFyZSBn
YXRoZXJlZCBmcm9tIHRoZSBiYWNraW5nIHN0b3JhZ2UKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1
L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9waHlzLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0v
aTkxNV9nZW1fcGh5cy5jCmluZGV4IDJkZWFjOTMzY2Y1OS4uNmI0YTVmYjUyMDU1IDEwMDY0NAot
LS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fcGh5cy5jCisrKyBiL2RyaXZl
cnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9waHlzLmMKQEAgLTE3LDE4ICsxNywyMSBAQAog
I2luY2x1ZGUgImk5MTVfZ2VtX29iamVjdC5oIgogI2luY2x1ZGUgImk5MTVfc2NhdHRlcmxpc3Qu
aCIKIAotc3RhdGljIGludCBpOTE1X2dlbV9vYmplY3RfZ2V0X3BhZ2VzX3BoeXMoc3RydWN0IGRy
bV9pOTE1X2dlbV9vYmplY3QgKm9iaikKK3N0YXRpYyBzdHJ1Y3Qgc2dfdGFibGUgKgorcGh5c19n
ZXRfcGFnZXMoc3RydWN0IGk5MTVfZ2VtX29iamVjdF9nZXRfcGFnZXNfY29udGV4dCAqY3R4LAor
CSAgICAgICB1bnNpZ25lZCBpbnQgKnNpemVzKQogeworCXN0cnVjdCBkcm1faTkxNV9nZW1fb2Jq
ZWN0ICpvYmogPSBjdHgtPm9iamVjdDsKIAlzdHJ1Y3QgYWRkcmVzc19zcGFjZSAqbWFwcGluZyA9
IG9iai0+YmFzZS5maWxwLT5mX21hcHBpbmc7CiAJc3RydWN0IGRybV9kbWFfaGFuZGxlICpwaHlz
OwotCXN0cnVjdCBzZ190YWJsZSAqc3Q7CiAJc3RydWN0IHNjYXR0ZXJsaXN0ICpzZzsKKwlzdHJ1
Y3Qgc2dfdGFibGUgKnN0OwogCWNoYXIgKnZhZGRyOwogCWludCBpOwogCWludCBlcnI7CiAKIAlp
ZiAoV0FSTl9PTihpOTE1X2dlbV9vYmplY3RfbmVlZHNfYml0MTdfc3dpenpsZShvYmopKSkKLQkJ
cmV0dXJuIC1FSU5WQUw7CisJCXJldHVybiBFUlJfUFRSKC1FSU5WQUwpOwogCiAJLyogQWx3YXlz
IGFsaWduaW5nIHRvIHRoZSBvYmplY3Qgc2l6ZSwgYWxsb3dzIGEgc2luZ2xlIGFsbG9jYXRpb24K
IAkgKiB0byBoYW5kbGUgYWxsIHBvc3NpYmxlIGNhbGxlcnMsIGFuZCBnaXZlbiB0eXBpY2FsIG9i
amVjdCBzaXplcywKQEAgLTM4LDcgKzQxLDcgQEAgc3RhdGljIGludCBpOTE1X2dlbV9vYmplY3Rf
Z2V0X3BhZ2VzX3BoeXMoc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iaikKIAkJCSAgICAg
cm91bmR1cF9wb3dfb2ZfdHdvKG9iai0+YmFzZS5zaXplKSwKIAkJCSAgICAgcm91bmR1cF9wb3df
b2ZfdHdvKG9iai0+YmFzZS5zaXplKSk7CiAJaWYgKCFwaHlzKQotCQlyZXR1cm4gLUVOT01FTTsK
KwkJcmV0dXJuIEVSUl9QVFIoLUVOT01FTSk7CiAKIAl2YWRkciA9IHBoeXMtPnZhZGRyOwogCWZv
ciAoaSA9IDA7IGkgPCBvYmotPmJhc2Uuc2l6ZSAvIFBBR0VfU0laRTsgaSsrKSB7CkBAIC04Mywx
OSArODYsMTYgQEAgc3RhdGljIGludCBpOTE1X2dlbV9vYmplY3RfZ2V0X3BhZ2VzX3BoeXMoc3Ry
dWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iaikKIAogCW9iai0+cGh5c19oYW5kbGUgPSBwaHlz
OwogCi0JX19pOTE1X2dlbV9vYmplY3Rfc2V0X3BhZ2VzKG9iaiwgc3QsIHNnLT5sZW5ndGgpOwot
Ci0JcmV0dXJuIDA7CisJKnNpemVzID0gc2ctPmxlbmd0aDsKKwlyZXR1cm4gc3Q7CiAKIGVycl9w
aHlzOgogCWRybV9wY2lfZnJlZShvYmotPmJhc2UuZGV2LCBwaHlzKTsKLQotCXJldHVybiBlcnI7
CisJcmV0dXJuIEVSUl9QVFIoZXJyKTsKIH0KIAogc3RhdGljIHZvaWQKLWk5MTVfZ2VtX29iamVj
dF9wdXRfcGFnZXNfcGh5cyhzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2JqLAotCQkJICAg
ICAgIHN0cnVjdCBzZ190YWJsZSAqcGFnZXMpCitwaHlzX3B1dF9wYWdlcyhzdHJ1Y3QgZHJtX2k5
MTVfZ2VtX29iamVjdCAqb2JqLCBzdHJ1Y3Qgc2dfdGFibGUgKnBhZ2VzKQogewogCV9faTkxNV9n
ZW1fb2JqZWN0X3JlbGVhc2Vfc2htZW0ob2JqLCBwYWdlcywgZmFsc2UpOwogCkBAIC0xMzksOCAr
MTM5LDggQEAgaTkxNV9nZW1fb2JqZWN0X3JlbGVhc2VfcGh5cyhzdHJ1Y3QgZHJtX2k5MTVfZ2Vt
X29iamVjdCAqb2JqKQogfQogCiBzdGF0aWMgY29uc3Qgc3RydWN0IGRybV9pOTE1X2dlbV9vYmpl
Y3Rfb3BzIGk5MTVfZ2VtX3BoeXNfb3BzID0gewotCS5nZXRfcGFnZXMgPSBpOTE1X2dlbV9vYmpl
Y3RfZ2V0X3BhZ2VzX3BoeXMsCi0JLnB1dF9wYWdlcyA9IGk5MTVfZ2VtX29iamVjdF9wdXRfcGFn
ZXNfcGh5cywKKwkuZ2V0X3BhZ2VzID0gcGh5c19nZXRfcGFnZXMsCisJLnB1dF9wYWdlcyA9IHBo
eXNfcHV0X3BhZ2VzLAogCS5yZWxlYXNlID0gaTkxNV9nZW1fb2JqZWN0X3JlbGVhc2VfcGh5cywK
IH07CiAKQEAgLTE5MywxNSArMTkzLDEyIEBAIGludCBpOTE1X2dlbV9vYmplY3RfYXR0YWNoX3Bo
eXMoc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iaiwgaW50IGFsaWduKQogCWlmICghSVNf
RVJSX09SX05VTEwocGFnZXMpKQogCQlpOTE1X2dlbV9zaG1lbV9vcHMucHV0X3BhZ2VzKG9iaiwg
cGFnZXMpOwogCW11dGV4X3VubG9jaygmb2JqLT5tbS5sb2NrKTsKKworCXdhaXRfZm9yX2NvbXBs
ZXRpb24oJm9iai0+bW0uY29tcGxldGlvbik7CiAJcmV0dXJuIDA7CiAKIGVycl94ZmVyOgogCW9i
ai0+b3BzID0gJmk5MTVfZ2VtX3NobWVtX29wczsKLQlpZiAoIUlTX0VSUl9PUl9OVUxMKHBhZ2Vz
KSkgewotCQl1bnNpZ25lZCBpbnQgc2dfcGFnZV9zaXplcyA9IGk5MTVfc2dfcGFnZV9zaXplcyhw
YWdlcy0+c2dsKTsKLQotCQlfX2k5MTVfZ2VtX29iamVjdF9zZXRfcGFnZXMob2JqLCBwYWdlcywg
c2dfcGFnZV9zaXplcyk7Ci0JfQogZXJyX3VubG9jazoKIAltdXRleF91bmxvY2soJm9iai0+bW0u
bG9jayk7CiAJcmV0dXJuIGVycjsKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dl
bS9pOTE1X2dlbV9zaG1lbS5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX3No
bWVtLmMKaW5kZXggMTlkOWVjZGIyODk0Li5jNDMzMDRlM2JhZGEgMTAwNjQ0Ci0tLSBhL2RyaXZl
cnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9zaG1lbS5jCisrKyBiL2RyaXZlcnMvZ3B1L2Ry
bS9pOTE1L2dlbS9pOTE1X2dlbV9zaG1lbS5jCkBAIC0yMiwxMSArMjIsMTMgQEAgc3RhdGljIHZv
aWQgY2hlY2tfcmVsZWFzZV9wYWdldmVjKHN0cnVjdCBwYWdldmVjICpwdmVjKQogCWNvbmRfcmVz
Y2hlZCgpOwogfQogCi1zdGF0aWMgaW50IHNobWVtX2dldF9wYWdlcyhzdHJ1Y3QgZHJtX2k5MTVf
Z2VtX29iamVjdCAqb2JqKQorc3RhdGljIHN0cnVjdCBzZ190YWJsZSAqCitzaG1lbV9nZXRfcGFn
ZXMoc3RydWN0IGk5MTVfZ2VtX29iamVjdF9nZXRfcGFnZXNfY29udGV4dCAqY3R4LAorCQl1bnNp
Z25lZCBpbnQgKnNpemVzKQogeworCXN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmogPSBj
dHgtPm9iamVjdDsKIAlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IHRvX2k5MTUob2Jq
LT5iYXNlLmRldik7CiAJY29uc3QgdW5zaWduZWQgbG9uZyBwYWdlX2NvdW50ID0gb2JqLT5iYXNl
LnNpemUgLyBQQUdFX1NJWkU7Ci0JdW5zaWduZWQgbG9uZyBpOwogCXN0cnVjdCBhZGRyZXNzX3Nw
YWNlICptYXBwaW5nOwogCXN0cnVjdCBzZ190YWJsZSAqc3Q7CiAJc3RydWN0IHNjYXR0ZXJsaXN0
ICpzZzsKQEAgLTM3LDMxICszOSwyNCBAQCBzdGF0aWMgaW50IHNobWVtX2dldF9wYWdlcyhzdHJ1
Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2JqKQogCXVuc2lnbmVkIGludCBzZ19wYWdlX3NpemVz
OwogCXN0cnVjdCBwYWdldmVjIHB2ZWM7CiAJZ2ZwX3Qgbm9yZWNsYWltOworCXVuc2lnbmVkIGxv
bmcgaTsKIAlpbnQgcmV0OwogCi0JLyoKLQkgKiBBc3NlcnQgdGhhdCB0aGUgb2JqZWN0IGlzIG5v
dCBjdXJyZW50bHkgaW4gYW55IEdQVSBkb21haW4uIEFzIGl0Ci0JICogd2Fzbid0IGluIHRoZSBH
VFQsIHRoZXJlIHNob3VsZG4ndCBiZSBhbnkgd2F5IGl0IGNvdWxkIGhhdmUgYmVlbiBpbgotCSAq
IGEgR1BVIGNhY2hlCi0JICovCi0JR0VNX0JVR19PTihvYmotPnJlYWRfZG9tYWlucyAmIEk5MTVf
R0VNX0dQVV9ET01BSU5TKTsKLQlHRU1fQlVHX09OKG9iai0+d3JpdGVfZG9tYWluICYgSTkxNV9H
RU1fR1BVX0RPTUFJTlMpOwotCiAJLyoKIAkgKiBJZiB0aGVyZSdzIG5vIGNoYW5jZSBvZiBhbGxv
Y2F0aW5nIGVub3VnaCBwYWdlcyBmb3IgdGhlIHdob2xlCiAJICogb2JqZWN0LCBiYWlsIGVhcmx5
LgogCSAqLwogCWlmIChwYWdlX2NvdW50ID4gdG90YWxyYW1fcGFnZXMoKSkKLQkJcmV0dXJuIC1F
Tk9NRU07CisJCXJldHVybiBFUlJfUFRSKC1FTk9NRU0pOwogCiAJc3QgPSBrbWFsbG9jKHNpemVv
Zigqc3QpLCBHRlBfS0VSTkVMKTsKIAlpZiAoIXN0KQotCQlyZXR1cm4gLUVOT01FTTsKKwkJcmV0
dXJuIEVSUl9QVFIoLUVOT01FTSk7CiAKIHJlYnVpbGRfc3Q6CiAJaWYgKHNnX2FsbG9jX3RhYmxl
KHN0LCBwYWdlX2NvdW50LCBHRlBfS0VSTkVMKSkgewogCQlrZnJlZShzdCk7Ci0JCXJldHVybiAt
RU5PTUVNOworCQlyZXR1cm4gRVJSX1BUUigtRU5PTUVNKTsKIAl9CiAKIAkvKgpAQCAtMTc5LDkg
KzE3NCw4IEBAIHN0YXRpYyBpbnQgc2htZW1fZ2V0X3BhZ2VzKHN0cnVjdCBkcm1faTkxNV9nZW1f
b2JqZWN0ICpvYmopCiAJaWYgKGk5MTVfZ2VtX29iamVjdF9uZWVkc19iaXQxN19zd2l6emxlKG9i
aikpCiAJCWk5MTVfZ2VtX29iamVjdF9kb19iaXRfMTdfc3dpenpsZShvYmosIHN0KTsKIAotCV9f
aTkxNV9nZW1fb2JqZWN0X3NldF9wYWdlcyhvYmosIHN0LCBzZ19wYWdlX3NpemVzKTsKLQotCXJl
dHVybiAwOworCSpzaXplcyA9IHNnX3BhZ2Vfc2l6ZXM7CisJcmV0dXJuIHN0OwogCiBlcnJfc2c6
CiAJc2dfbWFya19lbmQoc2cpOwpAQCAtMjA5LDcgKzIwMyw3IEBAIHN0YXRpYyBpbnQgc2htZW1f
Z2V0X3BhZ2VzKHN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmopCiAJaWYgKHJldCA9PSAt
RU5PU1BDKQogCQlyZXQgPSAtRU5PTUVNOwogCi0JcmV0dXJuIHJldDsKKwlyZXR1cm4gRVJSX1BU
UihyZXQpOwogfQogCiBzdGF0aWMgdm9pZApAQCAtMjc2LDggKzI3MCw2IEBAIF9faTkxNV9nZW1f
b2JqZWN0X3JlbGVhc2Vfc2htZW0oc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iaiwKIAkJ
CQlzdHJ1Y3Qgc2dfdGFibGUgKnBhZ2VzLAogCQkJCWJvb2wgbmVlZHNfY2xmbHVzaCkKIHsKLQlH
RU1fQlVHX09OKG9iai0+bW0ubWFkdiA9PSBfX0k5MTVfTUFEVl9QVVJHRUQpOwotCiAJaWYgKG9i
ai0+bW0ubWFkdiA9PSBJOTE1X01BRFZfRE9OVE5FRUQpCiAJCW9iai0+bW0uZGlydHkgPSBmYWxz
ZTsKIApkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX3N0b2xl
bi5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX3N0b2xlbi5jCmluZGV4IDcw
NjYwNDRkNjNjZi4uMjhlYTA2ZTY2N2NkIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkx
NS9nZW0vaTkxNV9nZW1fc3RvbGVuLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5
MTVfZ2VtX3N0b2xlbi5jCkBAIC00OTksMjIgKzQ5OSwxOSBAQCBpOTE1X3BhZ2VzX2NyZWF0ZV9m
b3Jfc3RvbGVuKHN0cnVjdCBkcm1fZGV2aWNlICpkZXYsCiAJcmV0dXJuIHN0OwogfQogCi1zdGF0
aWMgaW50IGk5MTVfZ2VtX29iamVjdF9nZXRfcGFnZXNfc3RvbGVuKHN0cnVjdCBkcm1faTkxNV9n
ZW1fb2JqZWN0ICpvYmopCitzdGF0aWMgc3RydWN0IHNnX3RhYmxlICoKK3N0b2xlbl9nZXRfcGFn
ZXMoc3RydWN0IGk5MTVfZ2VtX29iamVjdF9nZXRfcGFnZXNfY29udGV4dCAqY3R4LAorCQkgdW5z
aWduZWQgaW50ICpzaXplcykKIHsKLQlzdHJ1Y3Qgc2dfdGFibGUgKnBhZ2VzID0KLQkJaTkxNV9w
YWdlc19jcmVhdGVfZm9yX3N0b2xlbihvYmotPmJhc2UuZGV2LAotCQkJCQkgICAgIG9iai0+c3Rv
bGVuLT5zdGFydCwKLQkJCQkJICAgICBvYmotPnN0b2xlbi0+c2l6ZSk7Ci0JaWYgKElTX0VSUihw
YWdlcykpCi0JCXJldHVybiBQVFJfRVJSKHBhZ2VzKTsKLQotCV9faTkxNV9nZW1fb2JqZWN0X3Nl
dF9wYWdlcyhvYmosIHBhZ2VzLCBvYmotPnN0b2xlbi0+c2l6ZSk7CisJc3RydWN0IGRybV9pOTE1
X2dlbV9vYmplY3QgKm9iaiA9IGN0eC0+b2JqZWN0OwogCi0JcmV0dXJuIDA7CisJcmV0dXJuIGk5
MTVfcGFnZXNfY3JlYXRlX2Zvcl9zdG9sZW4ob2JqLT5iYXNlLmRldiwKKwkJCQkJICAgIG9iai0+
c3RvbGVuLT5zdGFydCwKKwkJCQkJICAgIG9iai0+c3RvbGVuLT5zaXplKTsKIH0KIAotc3RhdGlj
IHZvaWQgaTkxNV9nZW1fb2JqZWN0X3B1dF9wYWdlc19zdG9sZW4oc3RydWN0IGRybV9pOTE1X2dl
bV9vYmplY3QgKm9iaiwKLQkJCQkJICAgICBzdHJ1Y3Qgc2dfdGFibGUgKnBhZ2VzKQorc3RhdGlj
IHZvaWQKK3N0b2xlbl9wdXRfcGFnZXMoc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iaiwg
c3RydWN0IHNnX3RhYmxlICpwYWdlcykKIHsKIAkvKiBTaG91bGQgb25seSBiZSBjYWxsZWQgZnJv
bSBpOTE1X2dlbV9vYmplY3RfcmVsZWFzZV9zdG9sZW4oKSAqLwogCXNnX2ZyZWVfdGFibGUocGFn
ZXMpOwpAQCAtNTM2LDggKzUzMyw4IEBAIGk5MTVfZ2VtX29iamVjdF9yZWxlYXNlX3N0b2xlbihz
dHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2JqKQogfQogCiBzdGF0aWMgY29uc3Qgc3RydWN0
IGRybV9pOTE1X2dlbV9vYmplY3Rfb3BzIGk5MTVfZ2VtX29iamVjdF9zdG9sZW5fb3BzID0gewot
CS5nZXRfcGFnZXMgPSBpOTE1X2dlbV9vYmplY3RfZ2V0X3BhZ2VzX3N0b2xlbiwKLQkucHV0X3Bh
Z2VzID0gaTkxNV9nZW1fb2JqZWN0X3B1dF9wYWdlc19zdG9sZW4sCisJLmdldF9wYWdlcyA9IHN0
b2xlbl9nZXRfcGFnZXMsCisJLnB1dF9wYWdlcyA9IHN0b2xlbl9wdXRfcGFnZXMsCiAJLnJlbGVh
c2UgPSBpOTE1X2dlbV9vYmplY3RfcmVsZWFzZV9zdG9sZW4sCiB9OwogCmRpZmYgLS1naXQgYS9k
cml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fdXNlcnB0ci5jIGIvZHJpdmVycy9ncHUv
ZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX3VzZXJwdHIuYwppbmRleCBmMDkzZGVhZWI1YzAuLjY3NDhl
MTViZjg5YSAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX3Vz
ZXJwdHIuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fdXNlcnB0ci5j
CkBAIC0zNzgsNyArMzc4LDcgQEAgX19pOTE1X21tX3N0cnVjdF9mcmVlKHN0cnVjdCBrcmVmICpr
cmVmKQogCW11dGV4X3VubG9jaygmbW0tPmk5MTUtPm1tX2xvY2spOwogCiAJSU5JVF9XT1JLKCZt
bS0+d29yaywgX19pOTE1X21tX3N0cnVjdF9mcmVlX193b3JrZXIpOwotCXF1ZXVlX3dvcmsobW0t
Pmk5MTUtPm1tLnVzZXJwdHJfd3EsICZtbS0+d29yayk7CisJc2NoZWR1bGVfd29yaygmbW0tPndv
cmspOwogfQogCiBzdGF0aWMgdm9pZApAQCAtMzkzLDE5ICszOTMsMTIgQEAgaTkxNV9nZW1fdXNl
cnB0cl9yZWxlYXNlX19tbV9zdHJ1Y3Qoc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iaikK
IAlvYmotPnVzZXJwdHIubW0gPSBOVUxMOwogfQogCi1zdHJ1Y3QgZ2V0X3BhZ2VzX3dvcmsgewot
CXN0cnVjdCB3b3JrX3N0cnVjdCB3b3JrOwotCXN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpv
Ymo7Ci0Jc3RydWN0IHRhc2tfc3RydWN0ICp0YXNrOwotfTsKLQogc3RhdGljIHN0cnVjdCBzZ190
YWJsZSAqCiBfX2k5MTVfZ2VtX3VzZXJwdHJfYWxsb2NfcGFnZXMoc3RydWN0IGRybV9pOTE1X2dl
bV9vYmplY3QgKm9iaiwKIAkJCSAgICAgICBzdHJ1Y3QgcGFnZSAqKnB2ZWMsIGludCBudW1fcGFn
ZXMpCiB7CiAJdW5zaWduZWQgaW50IG1heF9zZWdtZW50ID0gaTkxNV9zZ19zZWdtZW50X3NpemUo
KTsKIAlzdHJ1Y3Qgc2dfdGFibGUgKnN0OwotCXVuc2lnbmVkIGludCBzZ19wYWdlX3NpemVzOwog
CWludCByZXQ7CiAKIAlzdCA9IGttYWxsb2Moc2l6ZW9mKCpzdCksIEdGUF9LRVJORUwpOwpAQCAt
NDM1LDEzMSArNDI4LDIzIEBAIF9faTkxNV9nZW1fdXNlcnB0cl9hbGxvY19wYWdlcyhzdHJ1Y3Qg
ZHJtX2k5MTVfZ2VtX29iamVjdCAqb2JqLAogCQlyZXR1cm4gRVJSX1BUUihyZXQpOwogCX0KIAot
CXNnX3BhZ2Vfc2l6ZXMgPSBpOTE1X3NnX3BhZ2Vfc2l6ZXMoc3QtPnNnbCk7Ci0KLQlfX2k5MTVf
Z2VtX29iamVjdF9zZXRfcGFnZXMob2JqLCBzdCwgc2dfcGFnZV9zaXplcyk7Ci0KIAlyZXR1cm4g
c3Q7CiB9CiAKLXN0YXRpYyB2b2lkCi1fX2k5MTVfZ2VtX3VzZXJwdHJfZ2V0X3BhZ2VzX3dvcmtl
cihzdHJ1Y3Qgd29ya19zdHJ1Y3QgKl93b3JrKQotewotCXN0cnVjdCBnZXRfcGFnZXNfd29yayAq
d29yayA9IGNvbnRhaW5lcl9vZihfd29yaywgdHlwZW9mKCp3b3JrKSwgd29yayk7Ci0Jc3RydWN0
IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iaiA9IHdvcmstPm9iajsKLQljb25zdCBpbnQgbnBhZ2Vz
ID0gb2JqLT5iYXNlLnNpemUgPj4gUEFHRV9TSElGVDsKLQlzdHJ1Y3QgcGFnZSAqKnB2ZWM7Ci0J
aW50IHBpbm5lZCwgcmV0OwotCi0JcmV0ID0gLUVOT01FTTsKLQlwaW5uZWQgPSAwOwotCi0JcHZl
YyA9IGt2bWFsbG9jX2FycmF5KG5wYWdlcywgc2l6ZW9mKHN0cnVjdCBwYWdlICopLCBHRlBfS0VS
TkVMKTsKLQlpZiAocHZlYyAhPSBOVUxMKSB7Ci0JCXN0cnVjdCBtbV9zdHJ1Y3QgKm1tID0gb2Jq
LT51c2VycHRyLm1tLT5tbTsKLQkJdW5zaWduZWQgaW50IGZsYWdzID0gMDsKLQotCQlpZiAoIWk5
MTVfZ2VtX29iamVjdF9pc19yZWFkb25seShvYmopKQotCQkJZmxhZ3MgfD0gRk9MTF9XUklURTsK
LQotCQlyZXQgPSAtRUZBVUxUOwotCQlpZiAobW1nZXRfbm90X3plcm8obW0pKSB7Ci0JCQlkb3du
X3JlYWQoJm1tLT5tbWFwX3NlbSk7Ci0JCQl3aGlsZSAocGlubmVkIDwgbnBhZ2VzKSB7Ci0JCQkJ
cmV0ID0gZ2V0X3VzZXJfcGFnZXNfcmVtb3RlCi0JCQkJCSh3b3JrLT50YXNrLCBtbSwKLQkJCQkJ
IG9iai0+dXNlcnB0ci5wdHIgKyBwaW5uZWQgKiBQQUdFX1NJWkUsCi0JCQkJCSBucGFnZXMgLSBw
aW5uZWQsCi0JCQkJCSBmbGFncywKLQkJCQkJIHB2ZWMgKyBwaW5uZWQsIE5VTEwsIE5VTEwpOwot
CQkJCWlmIChyZXQgPCAwKQotCQkJCQlicmVhazsKLQotCQkJCXBpbm5lZCArPSByZXQ7Ci0JCQl9
Ci0JCQl1cF9yZWFkKCZtbS0+bW1hcF9zZW0pOwotCQkJbW1wdXQobW0pOwotCQl9Ci0JfQotCi0J
bXV0ZXhfbG9jaygmb2JqLT5tbS5sb2NrKTsKLQlpZiAob2JqLT51c2VycHRyLndvcmsgPT0gJndv
cmstPndvcmspIHsKLQkJc3RydWN0IHNnX3RhYmxlICpwYWdlcyA9IEVSUl9QVFIocmV0KTsKLQot
CQlpZiAocGlubmVkID09IG5wYWdlcykgewotCQkJcGFnZXMgPSBfX2k5MTVfZ2VtX3VzZXJwdHJf
YWxsb2NfcGFnZXMob2JqLCBwdmVjLAotCQkJCQkJCSAgICAgICBucGFnZXMpOwotCQkJaWYgKCFJ
U19FUlIocGFnZXMpKSB7Ci0JCQkJcGlubmVkID0gMDsKLQkJCQlwYWdlcyA9IE5VTEw7Ci0JCQl9
Ci0JCX0KLQotCQlvYmotPnVzZXJwdHIud29yayA9IEVSUl9DQVNUKHBhZ2VzKTsKLQkJaWYgKElT
X0VSUihwYWdlcykpCi0JCQlfX2k5MTVfZ2VtX3VzZXJwdHJfc2V0X2FjdGl2ZShvYmosIGZhbHNl
KTsKLQl9Ci0JbXV0ZXhfdW5sb2NrKCZvYmotPm1tLmxvY2spOwotCi0JcmVsZWFzZV9wYWdlcyhw
dmVjLCBwaW5uZWQpOwotCWt2ZnJlZShwdmVjKTsKLQotCWk5MTVfZ2VtX29iamVjdF9wdXQob2Jq
KTsKLQlwdXRfdGFza19zdHJ1Y3Qod29yay0+dGFzayk7Ci0Ja2ZyZWUod29yayk7Ci19Ci0KIHN0
YXRpYyBzdHJ1Y3Qgc2dfdGFibGUgKgotX19pOTE1X2dlbV91c2VycHRyX2dldF9wYWdlc19zY2hl
ZHVsZShzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2JqKQotewotCXN0cnVjdCBnZXRfcGFn
ZXNfd29yayAqd29yazsKLQotCS8qIFNwYXduIGEgd29ya2VyIHNvIHRoYXQgd2UgY2FuIGFjcXVp
cmUgdGhlCi0JICogdXNlciBwYWdlcyB3aXRob3V0IGhvbGRpbmcgb3VyIG11dGV4LiBBY2Nlc3MK
LQkgKiB0byB0aGUgdXNlciBwYWdlcyByZXF1aXJlcyBtbWFwX3NlbSwgYW5kIHdlIGhhdmUKLQkg
KiBhIHN0cmljdCBsb2NrIG9yZGVyaW5nIG9mIG1tYXBfc2VtLCBzdHJ1Y3RfbXV0ZXggLQotCSAq
IHdlIGFscmVhZHkgaG9sZCBzdHJ1Y3RfbXV0ZXggaGVyZSBhbmQgc28gY2Fubm90Ci0JICogY2Fs
bCBndXAgd2l0aG91dCBlbmNvdW50ZXJpbmcgYSBsb2NrIGludmVyc2lvbi4KLQkgKgotCSAqIFVz
ZXJzcGFjZSB3aWxsIGtlZXAgb24gcmVwZWF0aW5nIHRoZSBvcGVyYXRpb24KLQkgKiAodGhhbmtz
IHRvIEVBR0FJTikgdW50aWwgZWl0aGVyIHdlIGhpdCB0aGUgZmFzdAotCSAqIHBhdGggb3IgdGhl
IHdvcmtlciBjb21wbGV0ZXMuIElmIHRoZSB3b3JrZXIgaXMKLQkgKiBjYW5jZWxsZWQgb3Igc3Vw
ZXJzZWRlZCwgdGhlIHRhc2sgaXMgc3RpbGwgcnVuCi0JICogYnV0IHRoZSByZXN1bHRzIGlnbm9y
ZWQuIChUaGlzIGxlYWRzIHRvCi0JICogY29tcGxpY2F0aW9ucyB0aGF0IHdlIG1heSBoYXZlIGEg
c3RyYXkgb2JqZWN0Ci0JICogcmVmY291bnQgdGhhdCB3ZSBuZWVkIHRvIGJlIHdhcnkgb2Ygd2hl
bgotCSAqIGNoZWNraW5nIGZvciBleGlzdGluZyBvYmplY3RzIGR1cmluZyBjcmVhdGlvbi4pCi0J
ICogSWYgdGhlIHdvcmtlciBlbmNvdW50ZXJzIGFuIGVycm9yLCBpdCByZXBvcnRzCi0JICogdGhh
dCBlcnJvciBiYWNrIHRvIHRoaXMgZnVuY3Rpb24gdGhyb3VnaAotCSAqIG9iai0+dXNlcnB0ci53
b3JrID0gRVJSX1BUUi4KLQkgKi8KLQl3b3JrID0ga21hbGxvYyhzaXplb2YoKndvcmspLCBHRlBf
S0VSTkVMKTsKLQlpZiAod29yayA9PSBOVUxMKQotCQlyZXR1cm4gRVJSX1BUUigtRU5PTUVNKTsK
LQotCW9iai0+dXNlcnB0ci53b3JrID0gJndvcmstPndvcms7Ci0KLQl3b3JrLT5vYmogPSBpOTE1
X2dlbV9vYmplY3RfZ2V0KG9iaik7Ci0KLQl3b3JrLT50YXNrID0gY3VycmVudDsKLQlnZXRfdGFz
a19zdHJ1Y3Qod29yay0+dGFzayk7Ci0KLQlJTklUX1dPUksoJndvcmstPndvcmssIF9faTkxNV9n
ZW1fdXNlcnB0cl9nZXRfcGFnZXNfd29ya2VyKTsKLQlxdWV1ZV93b3JrKHRvX2k5MTUob2JqLT5i
YXNlLmRldiktPm1tLnVzZXJwdHJfd3EsICZ3b3JrLT53b3JrKTsKLQotCXJldHVybiBFUlJfUFRS
KC1FQUdBSU4pOwotfQotCi1zdGF0aWMgaW50IGk5MTVfZ2VtX3VzZXJwdHJfZ2V0X3BhZ2VzKHN0
cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmopCit1c2VycHRyX2dldF9wYWdlcyhzdHJ1Y3Qg
aTkxNV9nZW1fb2JqZWN0X2dldF9wYWdlc19jb250ZXh0ICpjdHgsCisJCSAgdW5zaWduZWQgaW50
ICpzaXplcykKIHsKKwlzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2JqID0gY3R4LT5vYmpl
Y3Q7CiAJY29uc3QgaW50IG51bV9wYWdlcyA9IG9iai0+YmFzZS5zaXplID4+IFBBR0VfU0hJRlQ7
CiAJc3RydWN0IG1tX3N0cnVjdCAqbW0gPSBvYmotPnVzZXJwdHIubW0tPm1tOwotCXN0cnVjdCBw
YWdlICoqcHZlYzsKIAlzdHJ1Y3Qgc2dfdGFibGUgKnBhZ2VzOwotCWJvb2wgYWN0aXZlOworCXN0
cnVjdCBwYWdlICoqcHZlYzsKIAlpbnQgcGlubmVkOworCWludCByZXQ7CiAKLQkvKiBJZiB1c2Vy
c3BhY2Ugc2hvdWxkIGVuZ2luZWVyIHRoYXQgdGhlc2UgcGFnZXMgYXJlIHJlcGxhY2VkIGluCisJ
LyoKKwkgKiBJZiB1c2Vyc3BhY2Ugc2hvdWxkIGVuZ2luZWVyIHRoYXQgdGhlc2UgcGFnZXMgYXJl
IHJlcGxhY2VkIGluCiAJICogdGhlIHZtYSBiZXR3ZWVuIHVzIGJpbmRpbmcgdGhpcyBwYWdlIGlu
dG8gdGhlIEdUVCBhbmQgY29tcGxldGlvbgogCSAqIG9mIHJlbmRlcmluZy4uLiBUaGVpciBsb3Nz
LiBJZiB0aGV5IGNoYW5nZSB0aGUgbWFwcGluZyBvZiB0aGVpcgogCSAqIHBhZ2VzIHRoZXkgbmVl
ZCB0byBjcmVhdGUgYSBuZXcgYm8gdG8gcG9pbnQgdG8gdGhlIG5ldyB2bWEuCkBAIC01NzYsNTkg
KzQ2MSw1OCBAQCBzdGF0aWMgaW50IGk5MTVfZ2VtX3VzZXJwdHJfZ2V0X3BhZ2VzKHN0cnVjdCBk
cm1faTkxNV9nZW1fb2JqZWN0ICpvYmopCiAJICogZWdyZWdpb3VzIGNhc2VzIGZyb20gY2F1c2lu
ZyBoYXJtLgogCSAqLwogCi0JaWYgKG9iai0+dXNlcnB0ci53b3JrKSB7Ci0JCS8qIGFjdGl2ZSBm
bGFnIHNob3VsZCBzdGlsbCBiZSBoZWxkIGZvciB0aGUgcGVuZGluZyB3b3JrICovCi0JCWlmIChJ
U19FUlIob2JqLT51c2VycHRyLndvcmspKQotCQkJcmV0dXJuIFBUUl9FUlIob2JqLT51c2VycHRy
LndvcmspOwotCQllbHNlCi0JCQlyZXR1cm4gLUVBR0FJTjsKLQl9CisJcHZlYyA9IGt2bWFsbG9j
X2FycmF5KG51bV9wYWdlcywgc2l6ZW9mKHN0cnVjdCBwYWdlICopLAorCQkJICAgICAgR0ZQX0tF
Uk5FTCB8IF9fR0ZQX05PUkVUUlkgfCBfX0dGUF9OT1dBUk4pOworCWlmICghcHZlYykKKwkJcmV0
dXJuIEVSUl9QVFIoLUVOT01FTSk7CisKKwlfX2k5MTVfZ2VtX3VzZXJwdHJfc2V0X2FjdGl2ZShv
YmosIHRydWUpOwogCi0JcHZlYyA9IE5VTEw7CiAJcGlubmVkID0gMDsKKwlyZXQgPSAtRUZBVUxU
OworCWlmIChtbWdldF9ub3RfemVybyhtbSkpIHsKKwkJdW5zaWduZWQgaW50IGZsYWdzOwogCi0J
aWYgKG1tID09IGN1cnJlbnQtPm1tKSB7Ci0JCXB2ZWMgPSBrdm1hbGxvY19hcnJheShudW1fcGFn
ZXMsIHNpemVvZihzdHJ1Y3QgcGFnZSAqKSwKLQkJCQkgICAgICBHRlBfS0VSTkVMIHwKLQkJCQkg
ICAgICBfX0dGUF9OT1JFVFJZIHwKLQkJCQkgICAgICBfX0dGUF9OT1dBUk4pOwotCQlpZiAocHZl
YykgLyogZGVmZXIgdG8gd29ya2VyIGlmIG1hbGxvYyBmYWlscyAqLwotCQkJcGlubmVkID0gX19n
ZXRfdXNlcl9wYWdlc19mYXN0KG9iai0+dXNlcnB0ci5wdHIsCi0JCQkJCQkgICAgICAgbnVtX3Bh
Z2VzLAotCQkJCQkJICAgICAgICFpOTE1X2dlbV9vYmplY3RfaXNfcmVhZG9ubHkob2JqKSwKLQkJ
CQkJCSAgICAgICBwdmVjKTsKLQl9CisJCWZsYWdzID0gMDsKKwkJaWYgKCFpOTE1X2dlbV9vYmpl
Y3RfaXNfcmVhZG9ubHkob2JqKSkKKwkJCWZsYWdzIHw9IEZPTExfV1JJVEU7CiAKLQlhY3RpdmUg
PSBmYWxzZTsKLQlpZiAocGlubmVkIDwgMCkgewotCQlwYWdlcyA9IEVSUl9QVFIocGlubmVkKTsK
LQkJcGlubmVkID0gMDsKLQl9IGVsc2UgaWYgKHBpbm5lZCA8IG51bV9wYWdlcykgewotCQlwYWdl
cyA9IF9faTkxNV9nZW1fdXNlcnB0cl9nZXRfcGFnZXNfc2NoZWR1bGUob2JqKTsKLQkJYWN0aXZl
ID0gcGFnZXMgPT0gRVJSX1BUUigtRUFHQUlOKTsKLQl9IGVsc2UgewotCQlwYWdlcyA9IF9faTkx
NV9nZW1fdXNlcnB0cl9hbGxvY19wYWdlcyhvYmosIHB2ZWMsIG51bV9wYWdlcyk7Ci0JCWFjdGl2
ZSA9ICFJU19FUlIocGFnZXMpOworCQlkb3duX3JlYWQoJm1tLT5tbWFwX3NlbSk7CisJCXdoaWxl
IChwaW5uZWQgPCBudW1fcGFnZXMpIHsKKwkJCXJldCA9IGdldF91c2VyX3BhZ2VzX3JlbW90ZQor
CQkJCShjdHgtPnRhc2ssIG1tLAorCQkJCSBvYmotPnVzZXJwdHIucHRyICsgcGlubmVkICogUEFH
RV9TSVpFLAorCQkJCSBudW1fcGFnZXMgLSBwaW5uZWQsCisJCQkJIGZsYWdzLAorCQkJCSBwdmVj
ICsgcGlubmVkLCBOVUxMLCBOVUxMKTsKKwkJCWlmIChyZXQgPCAwKQorCQkJCWJyZWFrOworCisJ
CQlwaW5uZWQgKz0gcmV0OworCQl9CisJCXVwX3JlYWQoJm1tLT5tbWFwX3NlbSk7CisJCW1tcHV0
KG1tKTsKIAl9Ci0JaWYgKGFjdGl2ZSkKLQkJX19pOTE1X2dlbV91c2VycHRyX3NldF9hY3RpdmUo
b2JqLCB0cnVlKTsKIAotCWlmIChJU19FUlIocGFnZXMpKQorCWlmIChyZXQpCisJCXBhZ2VzID0g
RVJSX1BUUihyZXQpOworCWVsc2UKKwkJcGFnZXMgPSBfX2k5MTVfZ2VtX3VzZXJwdHJfYWxsb2Nf
cGFnZXMob2JqLCBwdmVjLCBudW1fcGFnZXMpOworCWlmIChJU19FUlIocGFnZXMpKSB7CiAJCXJl
bGVhc2VfcGFnZXMocHZlYywgcGlubmVkKTsKKwkJX19pOTE1X2dlbV91c2VycHRyX3NldF9hY3Rp
dmUob2JqLCBmYWxzZSk7CisJfQogCWt2ZnJlZShwdmVjKTsKIAotCXJldHVybiBQVFJfRVJSX09S
X1pFUk8ocGFnZXMpOworCXJldHVybiBwYWdlczsKIH0KIAogc3RhdGljIHZvaWQKLWk5MTVfZ2Vt
X3VzZXJwdHJfcHV0X3BhZ2VzKHN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmosCi0JCQkg
ICBzdHJ1Y3Qgc2dfdGFibGUgKnBhZ2VzKQordXNlcnB0cl9wdXRfcGFnZXMoc3RydWN0IGRybV9p
OTE1X2dlbV9vYmplY3QgKm9iaiwgc3RydWN0IHNnX3RhYmxlICpwYWdlcykKIHsKIAlzdHJ1Y3Qg
c2d0X2l0ZXIgc2d0X2l0ZXI7CiAJc3RydWN0IHBhZ2UgKnBhZ2U7CiAKLQkvKiBDYW5jZWwgYW55
IGluZmxpZ2h0IHdvcmsgYW5kIGZvcmNlIHRoZW0gdG8gcmVzdGFydCB0aGVpciBndXAgKi8KLQlv
YmotPnVzZXJwdHIud29yayA9IE5VTEw7CiAJX19pOTE1X2dlbV91c2VycHRyX3NldF9hY3RpdmUo
b2JqLCBmYWxzZSk7CiAJaWYgKCFwYWdlcykKIAkJcmV0dXJuOwpAQCAtNjY5LDggKzU1Myw4IEBA
IHN0YXRpYyBjb25zdCBzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdF9vcHMgaTkxNV9nZW1fdXNl
cnB0cl9vcHMgPSB7CiAJLmZsYWdzID0gSTkxNV9HRU1fT0JKRUNUX0hBU19TVFJVQ1RfUEFHRSB8
CiAJCSBJOTE1X0dFTV9PQkpFQ1RfSVNfU0hSSU5LQUJMRSB8CiAJCSBJOTE1X0dFTV9PQkpFQ1Rf
QVNZTkNfQ0FOQ0VMLAotCS5nZXRfcGFnZXMgPSBpOTE1X2dlbV91c2VycHRyX2dldF9wYWdlcywK
LQkucHV0X3BhZ2VzID0gaTkxNV9nZW1fdXNlcnB0cl9wdXRfcGFnZXMsCisJLmdldF9wYWdlcyA9
IHVzZXJwdHJfZ2V0X3BhZ2VzLAorCS5wdXRfcGFnZXMgPSB1c2VycHRyX3B1dF9wYWdlcywKIAku
ZG1hYnVmX2V4cG9ydCA9IGk5MTVfZ2VtX3VzZXJwdHJfZG1hYnVmX2V4cG9ydCwKIAkucmVsZWFz
ZSA9IGk5MTVfZ2VtX3VzZXJwdHJfcmVsZWFzZSwKIH07CkBAIC03ODYsMjIgKzY3MCwxMyBAQCBp
OTE1X2dlbV91c2VycHRyX2lvY3RsKHN0cnVjdCBkcm1fZGV2aWNlICpkZXYsCiAJcmV0dXJuIDA7
CiB9CiAKLWludCBpOTE1X2dlbV9pbml0X3VzZXJwdHIoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUg
KmRldl9wcml2KQordm9pZCBpOTE1X2dlbV9pbml0X3VzZXJwdHIoc3RydWN0IGRybV9pOTE1X3By
aXZhdGUgKmRldl9wcml2KQogewogCW11dGV4X2luaXQoJmRldl9wcml2LT5tbV9sb2NrKTsKIAlo
YXNoX2luaXQoZGV2X3ByaXYtPm1tX3N0cnVjdHMpOwotCi0JZGV2X3ByaXYtPm1tLnVzZXJwdHJf
d3EgPQotCQlhbGxvY193b3JrcXVldWUoImk5MTUtdXNlcnB0ci1hY3F1aXJlIiwKLQkJCQlXUV9I
SUdIUFJJIHwgV1FfVU5CT1VORCwKLQkJCQkwKTsKLQlpZiAoIWRldl9wcml2LT5tbS51c2VycHRy
X3dxKQotCQlyZXR1cm4gLUVOT01FTTsKLQotCXJldHVybiAwOwogfQogCiB2b2lkIGk5MTVfZ2Vt
X2NsZWFudXBfdXNlcnB0cihzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCiB7Ci0J
ZGVzdHJveV93b3JrcXVldWUoZGV2X3ByaXYtPm1tLnVzZXJwdHJfd3EpOworCW11dGV4X2Rlc3Ry
b3koJmRldl9wcml2LT5tbV9sb2NrKTsKIH0KZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9p
OTE1L2dlbS9zZWxmdGVzdHMvaHVnZV9nZW1fb2JqZWN0LmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkx
NS9nZW0vc2VsZnRlc3RzL2h1Z2VfZ2VtX29iamVjdC5jCmluZGV4IDNjNWQxN2IyYjY3MC4uMDJl
NmVkY2U3MTVlIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vc2VsZnRlc3Rz
L2h1Z2VfZ2VtX29iamVjdC5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9zZWxmdGVz
dHMvaHVnZV9nZW1fb2JqZWN0LmMKQEAgLTIxLDkgKzIxLDEyIEBAIHN0YXRpYyB2b2lkIGh1Z2Vf
ZnJlZV9wYWdlcyhzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2JqLAogCWtmcmVlKHBhZ2Vz
KTsKIH0KIAotc3RhdGljIGludCBodWdlX2dldF9wYWdlcyhzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29i
amVjdCAqb2JqKQorc3RhdGljIHN0cnVjdCBzZ190YWJsZSAqCitodWdlX2dldF9wYWdlcyhzdHJ1
Y3QgaTkxNV9nZW1fb2JqZWN0X2dldF9wYWdlc19jb250ZXh0ICpjdHgsCisJICAgICAgIHVuc2ln
bmVkIGludCAqc2l6ZXMpCiB7CiAjZGVmaW5lIEdGUCAoR0ZQX0tFUk5FTCB8IF9fR0ZQX05PV0FS
TiB8IF9fR0ZQX05PUkVUUlkpCisJc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iaiA9IGN0
eC0+b2JqZWN0OwogCWNvbnN0IHVuc2lnbmVkIGxvbmcgbnJlYWwgPSBvYmotPnNjcmF0Y2ggLyBQ
QUdFX1NJWkU7CiAJY29uc3QgdW5zaWduZWQgbG9uZyBucGFnZXMgPSBvYmotPmJhc2Uuc2l6ZSAv
IFBBR0VfU0laRTsKIAlzdHJ1Y3Qgc2NhdHRlcmxpc3QgKnNnLCAqc3JjLCAqZW5kOwpAQCAtMzIs
MTEgKzM1LDExIEBAIHN0YXRpYyBpbnQgaHVnZV9nZXRfcGFnZXMoc3RydWN0IGRybV9pOTE1X2dl
bV9vYmplY3QgKm9iaikKIAogCXBhZ2VzID0ga21hbGxvYyhzaXplb2YoKnBhZ2VzKSwgR0ZQKTsK
IAlpZiAoIXBhZ2VzKQotCQlyZXR1cm4gLUVOT01FTTsKKwkJcmV0dXJuIEVSUl9QVFIoLUVOT01F
TSk7CiAKIAlpZiAoc2dfYWxsb2NfdGFibGUocGFnZXMsIG5wYWdlcywgR0ZQKSkgewogCQlrZnJl
ZShwYWdlcyk7Ci0JCXJldHVybiAtRU5PTUVNOworCQlyZXR1cm4gRVJSX1BUUigtRU5PTUVNKTsK
IAl9CiAKIAlzZyA9IHBhZ2VzLT5zZ2w7CkBAIC02NCwxNCArNjcsMTIgQEAgc3RhdGljIGludCBo
dWdlX2dldF9wYWdlcyhzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2JqKQogCWlmIChpOTE1
X2dlbV9ndHRfcHJlcGFyZV9wYWdlcyhvYmosIHBhZ2VzKSkKIAkJZ290byBlcnI7CiAKLQlfX2k5
MTVfZ2VtX29iamVjdF9zZXRfcGFnZXMob2JqLCBwYWdlcywgUEFHRV9TSVpFKTsKLQotCXJldHVy
biAwOworCSpzaXplcyA9IFBBR0VfU0laRTsKKwlyZXR1cm4gcGFnZXM7CiAKIGVycjoKIAlodWdl
X2ZyZWVfcGFnZXMob2JqLCBwYWdlcyk7Ci0KLQlyZXR1cm4gLUVOT01FTTsKKwlyZXR1cm4gRVJS
X1BUUigtRU5PTUVNKTsKICN1bmRlZiBHRlAKIH0KIApkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUv
ZHJtL2k5MTUvZ2VtL3NlbGZ0ZXN0cy9odWdlX3BhZ2VzLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkx
NS9nZW0vc2VsZnRlc3RzL2h1Z2VfcGFnZXMuYwppbmRleCBiMDNhMjkzNjZiZDEuLjNiOTNhNzMz
N2YyNyAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL3NlbGZ0ZXN0cy9odWdl
X3BhZ2VzLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL3NlbGZ0ZXN0cy9odWdlX3Bh
Z2VzLmMKQEAgLTUxLDkgKzUxLDEyIEBAIHN0YXRpYyB2b2lkIGh1Z2VfcGFnZXNfZnJlZV9wYWdl
cyhzdHJ1Y3Qgc2dfdGFibGUgKnN0KQogCWtmcmVlKHN0KTsKIH0KIAotc3RhdGljIGludCBnZXRf
aHVnZV9wYWdlcyhzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2JqKQorc3RhdGljIHN0cnVj
dCBzZ190YWJsZSAqCitnZXRfaHVnZV9wYWdlcyhzdHJ1Y3QgaTkxNV9nZW1fb2JqZWN0X2dldF9w
YWdlc19jb250ZXh0ICpjdHgsCisJICAgICAgIHVuc2lnbmVkIGludCAqc2l6ZXMpCiB7CiAjZGVm
aW5lIEdGUCAoR0ZQX0tFUk5FTCB8IF9fR0ZQX05PV0FSTiB8IF9fR0ZQX05PUkVUUlkpCisJc3Ry
dWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iaiA9IGN0eC0+b2JqZWN0OwogCXVuc2lnbmVkIGlu
dCBwYWdlX21hc2sgPSBvYmotPm1tLnBhZ2VfbWFzazsKIAlzdHJ1Y3Qgc2dfdGFibGUgKnN0Owog
CXN0cnVjdCBzY2F0dGVybGlzdCAqc2c7CkBAIC02MiwxMSArNjUsMTEgQEAgc3RhdGljIGludCBn
ZXRfaHVnZV9wYWdlcyhzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2JqKQogCiAJc3QgPSBr
bWFsbG9jKHNpemVvZigqc3QpLCBHRlApOwogCWlmICghc3QpCi0JCXJldHVybiAtRU5PTUVNOwor
CQlyZXR1cm4gRVJSX1BUUigtRU5PTUVNKTsKIAogCWlmIChzZ19hbGxvY190YWJsZShzdCwgb2Jq
LT5iYXNlLnNpemUgPj4gUEFHRV9TSElGVCwgR0ZQKSkgewogCQlrZnJlZShzdCk7Ci0JCXJldHVy
biAtRU5PTUVNOworCQlyZXR1cm4gRVJSX1BUUigtRU5PTUVNKTsKIAl9CiAKIAlyZW0gPSBvYmot
PmJhc2Uuc2l6ZTsKQEAgLTExNCwxNiArMTE3LDE0IEBAIHN0YXRpYyBpbnQgZ2V0X2h1Z2VfcGFn
ZXMoc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iaikKIAlvYmotPm1tLm1hZHYgPSBJOTE1
X01BRFZfRE9OVE5FRUQ7CiAKIAlHRU1fQlVHX09OKHNnX3BhZ2Vfc2l6ZXMgIT0gb2JqLT5tbS5w
YWdlX21hc2spOwotCV9faTkxNV9nZW1fb2JqZWN0X3NldF9wYWdlcyhvYmosIHN0LCBzZ19wYWdl
X3NpemVzKTsKLQotCXJldHVybiAwOworCSpzaXplcyA9IHNnX3BhZ2Vfc2l6ZXM7CisJcmV0dXJu
IHN0OwogCiBlcnI6CiAJc2dfc2V0X3BhZ2Uoc2csIE5VTEwsIDAsIDApOwogCXNnX21hcmtfZW5k
KHNnKTsKIAlodWdlX3BhZ2VzX2ZyZWVfcGFnZXMoc3QpOwotCi0JcmV0dXJuIC1FTk9NRU07CisJ
cmV0dXJuIEVSUl9QVFIoLUVOT01FTSk7CiB9CiAKIHN0YXRpYyB2b2lkIHB1dF9odWdlX3BhZ2Vz
KHN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmosCkBAIC0xNzUsOCArMTc2LDExIEBAIGh1
Z2VfcGFnZXNfb2JqZWN0KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LAogCXJldHVybiBv
Ymo7CiB9CiAKLXN0YXRpYyBpbnQgZmFrZV9nZXRfaHVnZV9wYWdlcyhzdHJ1Y3QgZHJtX2k5MTVf
Z2VtX29iamVjdCAqb2JqKQorc3RhdGljIHN0cnVjdCBzZ190YWJsZSAqCitmYWtlX2dldF9odWdl
X3BhZ2VzKHN0cnVjdCBpOTE1X2dlbV9vYmplY3RfZ2V0X3BhZ2VzX2NvbnRleHQgKmN0eCwKKwkJ
ICAgIHVuc2lnbmVkIGludCAqc2l6ZXMpCiB7CisJc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3Qg
Km9iaiA9IGN0eC0+b2JqZWN0OwogCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0gdG9f
aTkxNShvYmotPmJhc2UuZGV2KTsKIAljb25zdCB1NjQgbWF4X2xlbiA9IHJvdW5kZG93bl9wb3df
b2ZfdHdvKFVJTlRfTUFYKTsKIAlzdHJ1Y3Qgc2dfdGFibGUgKnN0OwpAQCAtMTg2LDExICsxOTAs
MTEgQEAgc3RhdGljIGludCBmYWtlX2dldF9odWdlX3BhZ2VzKHN0cnVjdCBkcm1faTkxNV9nZW1f
b2JqZWN0ICpvYmopCiAKIAlzdCA9IGttYWxsb2Moc2l6ZW9mKCpzdCksIEdGUCk7CiAJaWYgKCFz
dCkKLQkJcmV0dXJuIC1FTk9NRU07CisJCXJldHVybiBFUlJfUFRSKC1FTk9NRU0pOwogCiAJaWYg
KHNnX2FsbG9jX3RhYmxlKHN0LCBvYmotPmJhc2Uuc2l6ZSA+PiBQQUdFX1NISUZULCBHRlApKSB7
CiAJCWtmcmVlKHN0KTsKLQkJcmV0dXJuIC1FTk9NRU07CisJCXJldHVybiBFUlJfUFRSKC1FTk9N
RU0pOwogCX0KIAogCS8qIFVzZSBvcHRpbWFsIHBhZ2Ugc2l6ZWQgY2h1bmtzIHRvIGZpbGwgaW4g
dGhlIHNnIHRhYmxlICovCkBAIC0yMjcsMTMgKzIzMSwxNSBAQCBzdGF0aWMgaW50IGZha2VfZ2V0
X2h1Z2VfcGFnZXMoc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iaikKIAogCW9iai0+bW0u
bWFkdiA9IEk5MTVfTUFEVl9ET05UTkVFRDsKIAotCV9faTkxNV9nZW1fb2JqZWN0X3NldF9wYWdl
cyhvYmosIHN0LCBzZ19wYWdlX3NpemVzKTsKLQotCXJldHVybiAwOworCSpzaXplcyA9IHNnX3Bh
Z2Vfc2l6ZXM7CisJcmV0dXJuIHN0OwogfQogCi1zdGF0aWMgaW50IGZha2VfZ2V0X2h1Z2VfcGFn
ZXNfc2luZ2xlKHN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmopCitzdGF0aWMgc3RydWN0
IHNnX3RhYmxlICoKK2Zha2VfZ2V0X2h1Z2VfcGFnZXNfc2luZ2xlKHN0cnVjdCBpOTE1X2dlbV9v
YmplY3RfZ2V0X3BhZ2VzX2NvbnRleHQgKmN0eCwKKwkJCSAgIHVuc2lnbmVkIGludCAqc2l6ZXMp
CiB7CisJc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iaiA9IGN0eC0+b2JqZWN0OwogCXN0
cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0gdG9faTkxNShvYmotPmJhc2UuZGV2KTsKIAlz
dHJ1Y3Qgc2dfdGFibGUgKnN0OwogCXN0cnVjdCBzY2F0dGVybGlzdCAqc2c7CkBAIC0yNDEsMTEg
KzI0NywxMSBAQCBzdGF0aWMgaW50IGZha2VfZ2V0X2h1Z2VfcGFnZXNfc2luZ2xlKHN0cnVjdCBk
cm1faTkxNV9nZW1fb2JqZWN0ICpvYmopCiAKIAlzdCA9IGttYWxsb2Moc2l6ZW9mKCpzdCksIEdG
UCk7CiAJaWYgKCFzdCkKLQkJcmV0dXJuIC1FTk9NRU07CisJCXJldHVybiBFUlJfUFRSKC1FTk9N
RU0pOwogCiAJaWYgKHNnX2FsbG9jX3RhYmxlKHN0LCAxLCBHRlApKSB7CiAJCWtmcmVlKHN0KTsK
LQkJcmV0dXJuIC1FTk9NRU07CisJCXJldHVybiBFUlJfUFRSKC1FTk9NRU0pOwogCX0KIAogCXNn
ID0gc3QtPnNnbDsKQEAgLTI2MSw5ICsyNjcsOCBAQCBzdGF0aWMgaW50IGZha2VfZ2V0X2h1Z2Vf
cGFnZXNfc2luZ2xlKHN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmopCiAKIAlvYmotPm1t
Lm1hZHYgPSBJOTE1X01BRFZfRE9OVE5FRUQ7CiAKLQlfX2k5MTVfZ2VtX29iamVjdF9zZXRfcGFn
ZXMob2JqLCBzdCwgc2ctPmxlbmd0aCk7Ci0KLQlyZXR1cm4gMDsKKwkqc2l6ZXMgPSBzZy0+bGVu
Z3RoOworCXJldHVybiBzdDsKICN1bmRlZiBHRlAKIH0KIApkaWZmIC0tZ2l0IGEvZHJpdmVycy9n
cHUvZHJtL2k5MTUvZ3Z0L2RtYWJ1Zi5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Z0L2RtYWJ1
Zi5jCmluZGV4IDQxYzhlYmM2MGM2My4uYzJhODE5MzlmNjk4IDEwMDY0NAotLS0gYS9kcml2ZXJz
L2dwdS9kcm0vaTkxNS9ndnQvZG1hYnVmLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Z0
L2RtYWJ1Zi5jCkBAIC0zNiw5ICszNiwxMSBAQAogCiAjZGVmaW5lIEdFTjhfREVDT0RFX1BURShw
dGUpIChwdGUgJiBHRU5NQVNLX1VMTCg2MywgMTIpKQogCi1zdGF0aWMgaW50IHZncHVfZ2VtX2dl
dF9wYWdlcygKLQkJc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iaikKK3N0YXRpYyBzdHJ1
Y3Qgc2dfdGFibGUgKgordmdwdV9nZW1fZ2V0X3BhZ2VzKHN0cnVjdCBpOTE1X2dlbV9vYmplY3Rf
Z2V0X3BhZ2VzX2NvbnRleHQgKmN0eCwKKwkJICAgdW5zaWduZWQgaW50ICpzaXplcykKIHsKKwlz
dHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2JqID0gY3R4LT5vYmplY3Q7CiAJc3RydWN0IGRy
bV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShvYmotPmJhc2UuZGV2KTsKIAlzdHJ1
Y3Qgc2dfdGFibGUgKnN0OwogCXN0cnVjdCBzY2F0dGVybGlzdCAqc2c7CkBAIC00OSwxNyArNTEs
MTcgQEAgc3RhdGljIGludCB2Z3B1X2dlbV9nZXRfcGFnZXMoCiAKIAlmYl9pbmZvID0gKHN0cnVj
dCBpbnRlbF92Z3B1X2ZiX2luZm8gKilvYmotPmd2dF9pbmZvOwogCWlmIChXQVJOX09OKCFmYl9p
bmZvKSkKLQkJcmV0dXJuIC1FTk9ERVY7CisJCXJldHVybiBFUlJfUFRSKC1FTk9ERVYpOwogCiAJ
c3QgPSBrbWFsbG9jKHNpemVvZigqc3QpLCBHRlBfS0VSTkVMKTsKIAlpZiAodW5saWtlbHkoIXN0
KSkKLQkJcmV0dXJuIC1FTk9NRU07CisJCXJldHVybiBFUlJfUFRSKC1FTk9NRU0pOwogCiAJcGFn
ZV9udW0gPSBvYmotPmJhc2Uuc2l6ZSA+PiBQQUdFX1NISUZUOwogCXJldCA9IHNnX2FsbG9jX3Rh
YmxlKHN0LCBwYWdlX251bSwgR0ZQX0tFUk5FTCk7CiAJaWYgKHJldCkgewogCQlrZnJlZShzdCk7
Ci0JCXJldHVybiByZXQ7CisJCXJldHVybiBFUlJfUFRSKHJldCk7CiAJfQogCWd0dF9lbnRyaWVz
ID0gKGdlbjhfcHRlX3QgX19pb21lbSAqKWRldl9wcml2LT5nZ3R0LmdzbSArCiAJCShmYl9pbmZv
LT5zdGFydCA+PiBQQUdFX1NISUZUKTsKQEAgLTcxLDkgKzczLDggQEAgc3RhdGljIGludCB2Z3B1
X2dlbV9nZXRfcGFnZXMoCiAJCXNnX2RtYV9sZW4oc2cpID0gUEFHRV9TSVpFOwogCX0KIAotCV9f
aTkxNV9nZW1fb2JqZWN0X3NldF9wYWdlcyhvYmosIHN0LCBQQUdFX1NJWkUpOwotCi0JcmV0dXJu
IDA7CisJKnNpemVzID0gUEFHRV9TSVpFOworCXJldHVybiBzdDsKIH0KIAogc3RhdGljIHZvaWQg
dmdwdV9nZW1fcHV0X3BhZ2VzKHN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmosCmRpZmYg
LS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2Rydi5oIGIvZHJpdmVycy9ncHUvZHJt
L2k5MTUvaTkxNV9kcnYuaAppbmRleCA5YTFlYzQ4N2U4YjEuLmVmOWU0Y2I0OWI0YSAxMDA2NDQK
LS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9kcnYuaAorKysgYi9kcml2ZXJzL2dwdS9k
cm0vaTkxNS9pOTE1X2Rydi5oCkBAIC03ODYsMTMgKzc4Niw2IEBAIHN0cnVjdCBpOTE1X2dlbV9t
bSB7CiAJc3RydWN0IG5vdGlmaWVyX2Jsb2NrIHZtYXBfbm90aWZpZXI7CiAJc3RydWN0IHNocmlu
a2VyIHNocmlua2VyOwogCi0JLyoqCi0JICogV29ya3F1ZXVlIHRvIGZhdWx0IGluIHVzZXJwdHIg
cGFnZXMsIGZsdXNoZWQgYnkgdGhlIGV4ZWNidWYKLQkgKiB3aGVuIHJlcXVpcmVkIGJ1dCBvdGhl
cndpc2UgbGVmdCB0byB1c2Vyc3BhY2UgdG8gdHJ5IGFnYWluCi0JICogb24gRUFHQUlOLgotCSAq
LwotCXN0cnVjdCB3b3JrcXVldWVfc3RydWN0ICp1c2VycHRyX3dxOwotCiAJdTY0IHVub3JkZXJl
ZF90aW1lbGluZTsKIAogCS8qIHRoZSBpbmRpY2F0b3IgZm9yIGRpc3BhdGNoIHZpZGVvIGNvbW1h
bmRzIG9uIHR3byBCU0QgcmluZ3MgKi8KQEAgLTI1MTQsNyArMjUwNyw3IEBAIHN0YXRpYyBpbmxp
bmUgYm9vbCBpbnRlbF92Z3B1X2FjdGl2ZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3By
aXYpCiB9CiAKIC8qIGk5MTVfZ2VtLmMgKi8KLWludCBpOTE1X2dlbV9pbml0X3VzZXJwdHIoc3Ry
dWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KTsKK3ZvaWQgaTkxNV9nZW1faW5pdF91c2Vy
cHRyKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdik7CiB2b2lkIGk5MTVfZ2VtX2Ns
ZWFudXBfdXNlcnB0cihzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpOwogdm9pZCBp
OTE1X2dlbV9zYW5pdGl6ZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSk7CiBpbnQgaTkx
NV9nZW1faW5pdF9lYXJseShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpOwpkaWZm
IC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9nZW0uYyBiL2RyaXZlcnMvZ3B1L2Ry
bS9pOTE1L2k5MTVfZ2VtLmMKaW5kZXggMjE0MTZiODc5MDVlLi4xNTcxYzcwN2FkMTUgMTAwNjQ0
Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZ2VtLmMKKysrIGIvZHJpdmVycy9ncHUv
ZHJtL2k5MTUvaTkxNV9nZW0uYwpAQCAtMTU0NCwxMCArMTU0NCw3IEBAIGludCBpOTE1X2dlbV9p
bml0KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikKIAlkZXZfcHJpdi0+bW0udW5v
cmRlcmVkX3RpbWVsaW5lID0gZG1hX2ZlbmNlX2NvbnRleHRfYWxsb2MoMSk7CiAKIAlpOTE1X3Rp
bWVsaW5lc19pbml0KGRldl9wcml2KTsKLQotCXJldCA9IGk5MTVfZ2VtX2luaXRfdXNlcnB0cihk
ZXZfcHJpdik7Ci0JaWYgKHJldCkKLQkJcmV0dXJuIHJldDsKKwlpOTE1X2dlbV9pbml0X3VzZXJw
dHIoZGV2X3ByaXYpOwogCiAJcmV0ID0gaW50ZWxfdWNfaW5pdF9taXNjKGRldl9wcml2KTsKIAlp
ZiAocmV0KQpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvc2VsZnRlc3RzL2k5MTVf
Z2VtX2d0dC5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvc2VsZnRlc3RzL2k5MTVfZ2VtX2d0dC5j
CmluZGV4IDY2NGI3ZTNlMWQ3Yy4uZGFlMWY4NjM0YTM4IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dw
dS9kcm0vaTkxNS9zZWxmdGVzdHMvaTkxNV9nZW1fZ3R0LmMKKysrIGIvZHJpdmVycy9ncHUvZHJt
L2k5MTUvc2VsZnRlc3RzL2k5MTVfZ2VtX2d0dC5jCkBAIC01NCwxMCArNTQsMTMgQEAgc3RhdGlj
IHZvaWQgZmFrZV9mcmVlX3BhZ2VzKHN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmosCiAJ
a2ZyZWUocGFnZXMpOwogfQogCi1zdGF0aWMgaW50IGZha2VfZ2V0X3BhZ2VzKHN0cnVjdCBkcm1f
aTkxNV9nZW1fb2JqZWN0ICpvYmopCitzdGF0aWMgc3RydWN0IHNnX3RhYmxlICoKK2Zha2VfZ2V0
X3BhZ2VzKHN0cnVjdCBpOTE1X2dlbV9vYmplY3RfZ2V0X3BhZ2VzX2NvbnRleHQgKmN0eCwKKwkg
ICAgICAgdW5zaWduZWQgaW50ICpzaXplcykKIHsKICNkZWZpbmUgR0ZQIChHRlBfS0VSTkVMIHwg
X19HRlBfTk9XQVJOIHwgX19HRlBfTk9SRVRSWSkKICNkZWZpbmUgUEZOX0JJQVMgMHgxMDAwCisJ
c3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iaiA9IGN0eC0+b2JqZWN0OwogCXN0cnVjdCBz
Z190YWJsZSAqcGFnZXM7CiAJc3RydWN0IHNjYXR0ZXJsaXN0ICpzZzsKIAl1bnNpZ25lZCBpbnQg
c2dfcGFnZV9zaXplczsKQEAgLTY1LDEyICs2OCwxMiBAQCBzdGF0aWMgaW50IGZha2VfZ2V0X3Bh
Z2VzKHN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmopCiAKIAlwYWdlcyA9IGttYWxsb2Mo
c2l6ZW9mKCpwYWdlcyksIEdGUCk7CiAJaWYgKCFwYWdlcykKLQkJcmV0dXJuIC1FTk9NRU07CisJ
CXJldHVybiBFUlJfUFRSKC1FTk9NRU0pOwogCiAJcmVtID0gcm91bmRfdXAob2JqLT5iYXNlLnNp
emUsIEJJVCgzMSkpID4+IDMxOwogCWlmIChzZ19hbGxvY190YWJsZShwYWdlcywgcmVtLCBHRlAp
KSB7CiAJCWtmcmVlKHBhZ2VzKTsKLQkJcmV0dXJuIC1FTk9NRU07CisJCXJldHVybiBFUlJfUFRS
KC1FTk9NRU0pOwogCX0KIAogCXNnX3BhZ2Vfc2l6ZXMgPSAwOwpAQCAtOTAsOSArOTMsOCBAQCBz
dGF0aWMgaW50IGZha2VfZ2V0X3BhZ2VzKHN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmop
CiAKIAlvYmotPm1tLm1hZHYgPSBJOTE1X01BRFZfRE9OVE5FRUQ7CiAKLQlfX2k5MTVfZ2VtX29i
amVjdF9zZXRfcGFnZXMob2JqLCBwYWdlcywgc2dfcGFnZV9zaXplcyk7Ci0KLQlyZXR1cm4gMDsK
Kwkqc2l6ZXMgPSBzZ19wYWdlX3NpemVzOworCXJldHVybiBwYWdlczsKICN1bmRlZiBHRlAKIH0K
IAotLSAKMi4yMC4xCgpfX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fXwpJbnRlbC1nZnggbWFpbGluZyBsaXN0CkludGVsLWdmeEBsaXN0cy5mcmVlZGVza3RvcC5v
cmcKaHR0cHM6Ly9saXN0cy5mcmVlZGVza3RvcC5vcmcvbWFpbG1hbi9saXN0aW5mby9pbnRlbC1n
Zng=

Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 3CCCB234184
	for <lists+intel-gfx@lfdr.de>; Fri, 31 Jul 2020 10:50:29 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 6583D6EA27;
	Fri, 31 Jul 2020 08:50:26 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from fireflyinternet.com (unknown [77.68.26.236])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 3B9A86EA1B
 for <intel-gfx@lists.freedesktop.org>; Fri, 31 Jul 2020 08:50:21 +0000 (UTC)
X-Default-Received-SPF: pass (skip=forwardok (res=PASS))
 x-ip-name=78.156.65.138; 
Received: from build.alporthouse.com (unverified [78.156.65.138]) 
 by fireflyinternet.com (Firefly Internet (M1)) with ESMTP id 21990227-1500050 
 for <intel-gfx@lists.freedesktop.org>; Fri, 31 Jul 2020 09:50:16 +0100
From: Chris Wilson <chris@chris-wilson.co.uk>
To: intel-gfx@lists.freedesktop.org
Date: Fri, 31 Jul 2020 09:50:11 +0100
Message-Id: <20200731085015.32368-3-chris@chris-wilson.co.uk>
X-Mailer: git-send-email 2.20.1
In-Reply-To: <20200731085015.32368-1-chris@chris-wilson.co.uk>
References: <20200731085015.32368-1-chris@chris-wilson.co.uk>
MIME-Version: 1.0
Subject: [Intel-gfx] [CI 3/7] drm/i915: Export a preallocate variant of
 i915_active_acquire()
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.29
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

U29tZXRpbWVzIHdlIGhhdmUgdG8gYmUgdmVyeSBjYXJlZnVsIG5vdCB0byBhbGxvY2F0ZSB1bmRl
cm5lYXRoIGEgbXV0ZXgKKG9yIHNwaW5sb2NrKSBhbmQgeWV0IHN0aWxsIHdhbnQgdG8gdHJhY2sg
YWN0aXZpdHkuIEVudGVyCmk5MTVfYWN0aXZlX2FjcXVpcmVfZm9yX2NvbnRleHQoKS4gVGhpcyBy
YWlzZXMgdGhlIGFjdGl2aXR5IGNvdW50ZXIgb24KaTkxNV9hY3RpdmUgcHJpb3IgdG8gdXNlIGFu
ZCBlbnN1cmVzIHRoYXQgdGhlIGZlbmNlLXRyZWUgY29udGFpbnMgYSBzbG90CmZvciB0aGUgY29u
dGV4dC4KCnYyOiBSZWZhY3RvciBhY3RpdmVfbG9va3VwKCkgc28gaXQgY2FuIGJlIGNhbGxlZCBh
Z2FpbiBiZWZvcmUvYWZ0ZXIKbG9ja2luZyB0byByZXNvbHZlIGNvbnRlbnRpb24uIFNpbmNlIHdl
IHByb3RlY3QgdGhlIHJidHJlZSB1bnRpbCB3ZQppZGxlLCB3ZSBjYW4gZG8gYSBsb2NrZnJlZSBs
b29rdXAsIHdpdGggdGhlIGNhdmVhdCB0aGF0IGlmIGFub3RoZXIKdGhyZWFkIHBlcmZvcm1zIGEg
Y29uY3VycmVudCBpbnNlcnRpb24sIHRoZSByb3RhdGlvbnMgZnJvbSB0aGUgaW5zZXJ0Cm1heSBj
YXVzZSB1cyB0byBub3QgZmluZCBvdXIgdGFyZ2V0LiBBIHNlY29uZCBwYXNzIGhvbGRpbmcgdGhl
IHRyZWVsb2NrCndpbGwgZmluZCB0aGUgdGFyZ2V0IGlmIGl0IGV4aXN0cywgb3IgdGhlIHBsYWNl
IHRvIHBlcmZvcm0gb3VyCmluc2VydGlvbi4KClNpZ25lZC1vZmYtYnk6IENocmlzIFdpbHNvbiA8
Y2hyaXNAY2hyaXMtd2lsc29uLmNvLnVrPgpSZXZpZXdlZC1ieTogVGhvbWFzIEhlbGxzdHLDtm0g
PHRob21hcy5oZWxsc3Ryb21AaW50ZWwuY29tPgotLS0KIC4uLi9ncHUvZHJtL2k5MTUvZ2VtL2k5
MTVfZ2VtX2V4ZWNidWZmZXIuYyAgICB8ICAgMiArLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qv
aW50ZWxfdGltZWxpbmUuYyAgICAgIHwgICA0ICstCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1
X2FjdGl2ZS5jICAgICAgICAgICAgfCAxNTAgKysrKysrKysrKysrKystLS0tCiBkcml2ZXJzL2dw
dS9kcm0vaTkxNS9pOTE1X2FjdGl2ZS5oICAgICAgICAgICAgfCAgMTIgKy0KIDQgZmlsZXMgY2hh
bmdlZCwgMTMwIGluc2VydGlvbnMoKyksIDM4IGRlbGV0aW9ucygtKQoKZGlmZiAtLWdpdCBhL2Ry
aXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9leGVjYnVmZmVyLmMgYi9kcml2ZXJzL2dw
dS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fZXhlY2J1ZmZlci5jCmluZGV4IGI3YTg2Y2RlYzliNS4u
MDdjYjJkZDBmNzk1IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9n
ZW1fZXhlY2J1ZmZlci5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9l
eGVjYnVmZmVyLmMKQEAgLTE3MjksNyArMTcyOSw3IEBAIF9fcGFyc2VyX21hcmtfYWN0aXZlKHN0
cnVjdCBpOTE1X3ZtYSAqdm1hLAogewogCXN0cnVjdCBpbnRlbF9ndF9idWZmZXJfcG9vbF9ub2Rl
ICpub2RlID0gdm1hLT5wcml2YXRlOwogCi0JcmV0dXJuIGk5MTVfYWN0aXZlX3JlZigmbm9kZS0+
YWN0aXZlLCB0bCwgZmVuY2UpOworCXJldHVybiBpOTE1X2FjdGl2ZV9yZWYoJm5vZGUtPmFjdGl2
ZSwgdGwtPmZlbmNlX2NvbnRleHQsIGZlbmNlKTsKIH0KIAogc3RhdGljIGludApkaWZmIC0tZ2l0
IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfdGltZWxpbmUuYyBiL2RyaXZlcnMvZ3B1
L2RybS9pOTE1L2d0L2ludGVsX3RpbWVsaW5lLmMKaW5kZXggNGY0NDY1MzRiYWQwLi4yYmFlY2Y0
MTRhY2IgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX3RpbWVsaW5l
LmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfdGltZWxpbmUuYwpAQCAtNDg2
LDcgKzQ4Niw5IEBAIF9faW50ZWxfdGltZWxpbmVfZ2V0X3NlcW5vKHN0cnVjdCBpbnRlbF90aW1l
bGluZSAqdGwsCiAJICogZnJlZSBpdCBhZnRlciB0aGUgY3VycmVudCByZXF1ZXN0IGlzIHJldGly
ZWQsIHdoaWNoIGVuc3VyZXMgdGhhdAogCSAqIGFsbCB3cml0ZXMgaW50byB0aGUgY2FjaGVsaW5l
IGZyb20gcHJldmlvdXMgcmVxdWVzdHMgYXJlIGNvbXBsZXRlLgogCSAqLwotCWVyciA9IGk5MTVf
YWN0aXZlX3JlZigmdGwtPmh3c3BfY2FjaGVsaW5lLT5hY3RpdmUsIHRsLCAmcnEtPmZlbmNlKTsK
KwllcnIgPSBpOTE1X2FjdGl2ZV9yZWYoJnRsLT5od3NwX2NhY2hlbGluZS0+YWN0aXZlLAorCQkJ
ICAgICAgdGwtPmZlbmNlX2NvbnRleHQsCisJCQkgICAgICAmcnEtPmZlbmNlKTsKIAlpZiAoZXJy
KQogCQlnb3RvIGVycl9jYWNoZWxpbmU7CiAKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9p
OTE1L2k5MTVfYWN0aXZlLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2FjdGl2ZS5jCmlu
ZGV4IDUwMDUzNzg4OWU2Ni4uM2E3Mjg0MDFjMDljIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9k
cm0vaTkxNS9pOTE1X2FjdGl2ZS5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfYWN0
aXZlLmMKQEAgLTI4LDEyICsyOCwxNCBAQCBzdGF0aWMgc3RydWN0IGk5MTVfZ2xvYmFsX2FjdGl2
ZSB7CiB9IGdsb2JhbDsKIAogc3RydWN0IGFjdGl2ZV9ub2RlIHsKKwlzdHJ1Y3QgcmJfbm9kZSBu
b2RlOwogCXN0cnVjdCBpOTE1X2FjdGl2ZV9mZW5jZSBiYXNlOwogCXN0cnVjdCBpOTE1X2FjdGl2
ZSAqcmVmOwotCXN0cnVjdCByYl9ub2RlIG5vZGU7CiAJdTY0IHRpbWVsaW5lOwogfTsKIAorI2Rl
ZmluZSBmZXRjaF9ub2RlKHgpIHJiX2VudHJ5KFJFQURfT05DRSh4KSwgdHlwZW9mKHN0cnVjdCBh
Y3RpdmVfbm9kZSksIG5vZGUpCisKIHN0YXRpYyBpbmxpbmUgc3RydWN0IGFjdGl2ZV9ub2RlICoK
IG5vZGVfZnJvbV9hY3RpdmUoc3RydWN0IGk5MTVfYWN0aXZlX2ZlbmNlICphY3RpdmUpCiB7CkBA
IC0yMTYsMTIgKzIxOCw5IEBAIGV4Y2xfcmV0aXJlKHN0cnVjdCBkbWFfZmVuY2UgKmZlbmNlLCBz
dHJ1Y3QgZG1hX2ZlbmNlX2NiICpjYikKIAkJYWN0aXZlX3JldGlyZShjb250YWluZXJfb2YoY2Is
IHN0cnVjdCBpOTE1X2FjdGl2ZSwgZXhjbC5jYikpOwogfQogCi1zdGF0aWMgc3RydWN0IGk5MTVf
YWN0aXZlX2ZlbmNlICoKLWFjdGl2ZV9pbnN0YW5jZShzdHJ1Y3QgaTkxNV9hY3RpdmUgKnJlZiwg
c3RydWN0IGludGVsX3RpbWVsaW5lICp0bCkKK3N0YXRpYyBzdHJ1Y3QgYWN0aXZlX25vZGUgKl9f
YWN0aXZlX2xvb2t1cChzdHJ1Y3QgaTkxNV9hY3RpdmUgKnJlZiwgdTY0IGlkeCkKIHsKLQlzdHJ1
Y3QgYWN0aXZlX25vZGUgKm5vZGUsICpwcmVhbGxvYzsKLQlzdHJ1Y3QgcmJfbm9kZSAqKnAsICpw
YXJlbnQ7Ci0JdTY0IGlkeCA9IHRsLT5mZW5jZV9jb250ZXh0OworCXN0cnVjdCBhY3RpdmVfbm9k
ZSAqaXQ7CiAKIAkvKgogCSAqIFdlIHRyYWNrIHRoZSBtb3N0IHJlY2VudGx5IHVzZWQgdGltZWxp
bmUgdG8gc2tpcCBhIHJidHJlZSBzZWFyY2gKQEAgLTIzMCw4ICsyMjksMzkgQEAgYWN0aXZlX2lu
c3RhbmNlKHN0cnVjdCBpOTE1X2FjdGl2ZSAqcmVmLCBzdHJ1Y3QgaW50ZWxfdGltZWxpbmUgKnRs
KQogCSAqIGFmdGVyIHRoZSBwcmV2aW91cyBhY3Rpdml0eSBoYXMgYmVlbiByZXRpcmVkLCBvciBp
ZiBpdCBtYXRjaGVzIHRoZQogCSAqIGN1cnJlbnQgdGltZWxpbmUuCiAJICovCi0Jbm9kZSA9IFJF
QURfT05DRShyZWYtPmNhY2hlKTsKLQlpZiAobm9kZSAmJiBub2RlLT50aW1lbGluZSA9PSBpZHgp
CisJaXQgPSBSRUFEX09OQ0UocmVmLT5jYWNoZSk7CisJaWYgKGl0ICYmIGl0LT50aW1lbGluZSA9
PSBpZHgpCisJCXJldHVybiBpdDsKKworCUJVSUxEX0JVR19PTihvZmZzZXRvZih0eXBlb2YoKml0
KSwgbm9kZSkpOworCisJLyogV2hpbGUgYWN0aXZlLCB0aGUgdHJlZSBjYW4gb25seSBiZSBidWls
dDsgbm90IGRlc3Ryb3llZCAqLworCUdFTV9CVUdfT04oaTkxNV9hY3RpdmVfaXNfaWRsZShyZWYp
KTsKKworCWl0ID0gZmV0Y2hfbm9kZShyZWYtPnRyZWUucmJfbm9kZSk7CisJd2hpbGUgKGl0KSB7
CisJCWlmIChpdC0+dGltZWxpbmUgPCBpZHgpIHsKKwkJCWl0ID0gZmV0Y2hfbm9kZShpdC0+bm9k
ZS5yYl9yaWdodCk7CisJCX0gZWxzZSBpZiAoaXQtPnRpbWVsaW5lID4gaWR4KSB7CisJCQlpdCA9
IGZldGNoX25vZGUoaXQtPm5vZGUucmJfbGVmdCk7CisJCX0gZWxzZSB7CisJCQlXUklURV9PTkNF
KHJlZi0+Y2FjaGUsIGl0KTsKKwkJCWJyZWFrOworCQl9CisJfQorCisJLyogTkI6IElmIHRoZSB0
cmVlIHJvdGF0ZWQgYmVuZWF0aCB1cywgd2UgbWF5IG1pc3Mgb3VyIHRhcmdldC4gKi8KKwlyZXR1
cm4gaXQ7Cit9CisKK3N0YXRpYyBzdHJ1Y3QgaTkxNV9hY3RpdmVfZmVuY2UgKgorYWN0aXZlX2lu
c3RhbmNlKHN0cnVjdCBpOTE1X2FjdGl2ZSAqcmVmLCB1NjQgaWR4KQoreworCXN0cnVjdCBhY3Rp
dmVfbm9kZSAqbm9kZSwgKnByZWFsbG9jOworCXN0cnVjdCByYl9ub2RlICoqcCwgKnBhcmVudDsK
KworCW5vZGUgPSBfX2FjdGl2ZV9sb29rdXAocmVmLCBpZHgpOworCWlmIChsaWtlbHkobm9kZSkp
CiAJCXJldHVybiAmbm9kZS0+YmFzZTsKIAogCS8qIFByZWFsbG9jYXRlIGEgcmVwbGFjZW1lbnQs
IGp1c3QgaW4gY2FzZSAqLwpAQCAtMjY4LDEwICsyOTgsOSBAQCBhY3RpdmVfaW5zdGFuY2Uoc3Ry
dWN0IGk5MTVfYWN0aXZlICpyZWYsIHN0cnVjdCBpbnRlbF90aW1lbGluZSAqdGwpCiAJcmJfaW5z
ZXJ0X2NvbG9yKCZub2RlLT5ub2RlLCAmcmVmLT50cmVlKTsKIAogb3V0OgotCXJlZi0+Y2FjaGUg
PSBub2RlOworCVdSSVRFX09OQ0UocmVmLT5jYWNoZSwgbm9kZSk7CiAJc3Bpbl91bmxvY2tfaXJx
KCZyZWYtPnRyZWVfbG9jayk7CiAKLQlCVUlMRF9CVUdfT04ob2Zmc2V0b2YodHlwZW9mKCpub2Rl
KSwgYmFzZSkpOwogCXJldHVybiAmbm9kZS0+YmFzZTsKIH0KIApAQCAtMzUzLDYzICszODIsMTAy
IEBAIF9fYWN0aXZlX2RlbF9iYXJyaWVyKHN0cnVjdCBpOTE1X2FjdGl2ZSAqcmVmLCBzdHJ1Y3Qg
YWN0aXZlX25vZGUgKm5vZGUpCiAJcmV0dXJuIF9fX19hY3RpdmVfZGVsX2JhcnJpZXIocmVmLCBu
b2RlLCBiYXJyaWVyX3RvX2VuZ2luZShub2RlKSk7CiB9CiAKLWludCBpOTE1X2FjdGl2ZV9yZWYo
c3RydWN0IGk5MTVfYWN0aXZlICpyZWYsCi0JCSAgICBzdHJ1Y3QgaW50ZWxfdGltZWxpbmUgKnRs
LAotCQkgICAgc3RydWN0IGRtYV9mZW5jZSAqZmVuY2UpCitzdGF0aWMgYm9vbAorcmVwbGFjZV9i
YXJyaWVyKHN0cnVjdCBpOTE1X2FjdGl2ZSAqcmVmLCBzdHJ1Y3QgaTkxNV9hY3RpdmVfZmVuY2Ug
KmFjdGl2ZSkKK3sKKwlpZiAoIWlzX2JhcnJpZXIoYWN0aXZlKSkgLyogcHJvdG8tbm9kZSB1c2Vk
IGJ5IG91ciBpZGxlIGJhcnJpZXI/ICovCisJCXJldHVybiBmYWxzZTsKKworCS8qCisJICogVGhp
cyByZXF1ZXN0IGlzIG9uIHRoZSBrZXJuZWxfY29udGV4dCB0aW1lbGluZSwgYW5kIHNvCisJICog
d2UgY2FuIHVzZSBpdCB0byBzdWJzdGl0dXRlIGZvciB0aGUgcGVuZGluZyBpZGxlLWJhcnJlcgor
CSAqIHJlcXVlc3QgdGhhdCB3ZSB3YW50IHRvIGVtaXQgb24gdGhlIGtlcm5lbF9jb250ZXh0Lgor
CSAqLworCV9fYWN0aXZlX2RlbF9iYXJyaWVyKHJlZiwgbm9kZV9mcm9tX2FjdGl2ZShhY3RpdmUp
KTsKKwlyZXR1cm4gdHJ1ZTsKK30KKworaW50IGk5MTVfYWN0aXZlX3JlZihzdHJ1Y3QgaTkxNV9h
Y3RpdmUgKnJlZiwgdTY0IGlkeCwgc3RydWN0IGRtYV9mZW5jZSAqZmVuY2UpCiB7CiAJc3RydWN0
IGk5MTVfYWN0aXZlX2ZlbmNlICphY3RpdmU7CiAJaW50IGVycjsKIAotCWxvY2tkZXBfYXNzZXJ0
X2hlbGQoJnRsLT5tdXRleCk7Ci0KIAkvKiBQcmV2ZW50IHJlYXBpbmcgaW4gY2FzZSB3ZSBtYWxs
b2Mvd2FpdCB3aGlsZSBidWlsZGluZyB0aGUgdHJlZSAqLwogCWVyciA9IGk5MTVfYWN0aXZlX2Fj
cXVpcmUocmVmKTsKIAlpZiAoZXJyKQogCQlyZXR1cm4gZXJyOwogCi0JYWN0aXZlID0gYWN0aXZl
X2luc3RhbmNlKHJlZiwgdGwpOworCWFjdGl2ZSA9IGFjdGl2ZV9pbnN0YW5jZShyZWYsIGlkeCk7
CiAJaWYgKCFhY3RpdmUpIHsKIAkJZXJyID0gLUVOT01FTTsKIAkJZ290byBvdXQ7CiAJfQogCi0J
aWYgKGlzX2JhcnJpZXIoYWN0aXZlKSkgeyAvKiBwcm90by1ub2RlIHVzZWQgYnkgb3VyIGlkbGUg
YmFycmllciAqLwotCQkvKgotCQkgKiBUaGlzIHJlcXVlc3QgaXMgb24gdGhlIGtlcm5lbF9jb250
ZXh0IHRpbWVsaW5lLCBhbmQgc28KLQkJICogd2UgY2FuIHVzZSBpdCB0byBzdWJzdGl0dXRlIGZv
ciB0aGUgcGVuZGluZyBpZGxlLWJhcnJlcgotCQkgKiByZXF1ZXN0IHRoYXQgd2Ugd2FudCB0byBl
bWl0IG9uIHRoZSBrZXJuZWxfY29udGV4dC4KLQkJICovCi0JCV9fYWN0aXZlX2RlbF9iYXJyaWVy
KHJlZiwgbm9kZV9mcm9tX2FjdGl2ZShhY3RpdmUpKTsKKwlpZiAocmVwbGFjZV9iYXJyaWVyKHJl
ZiwgYWN0aXZlKSkgewogCQlSQ1VfSU5JVF9QT0lOVEVSKGFjdGl2ZS0+ZmVuY2UsIE5VTEwpOwog
CQlhdG9taWNfZGVjKCZyZWYtPmNvdW50KTsKIAl9CiAJaWYgKCFfX2k5MTVfYWN0aXZlX2ZlbmNl
X3NldChhY3RpdmUsIGZlbmNlKSkKLQkJYXRvbWljX2luYygmcmVmLT5jb3VudCk7CisJCV9faTkx
NV9hY3RpdmVfYWNxdWlyZShyZWYpOwogCiBvdXQ6CiAJaTkxNV9hY3RpdmVfcmVsZWFzZShyZWYp
OwogCXJldHVybiBlcnI7CiB9CiAKLXN0cnVjdCBkbWFfZmVuY2UgKgotaTkxNV9hY3RpdmVfc2V0
X2V4Y2x1c2l2ZShzdHJ1Y3QgaTkxNV9hY3RpdmUgKnJlZiwgc3RydWN0IGRtYV9mZW5jZSAqZikK
K3N0YXRpYyBzdHJ1Y3QgZG1hX2ZlbmNlICoKK19faTkxNV9hY3RpdmVfc2V0X2ZlbmNlKHN0cnVj
dCBpOTE1X2FjdGl2ZSAqcmVmLAorCQkJc3RydWN0IGk5MTVfYWN0aXZlX2ZlbmNlICphY3RpdmUs
CisJCQlzdHJ1Y3QgZG1hX2ZlbmNlICpmZW5jZSkKIHsKIAlzdHJ1Y3QgZG1hX2ZlbmNlICpwcmV2
OwogCi0JLyogV2UgZXhwZWN0IHRoZSBjYWxsZXIgdG8gbWFuYWdlIHRoZSBleGNsdXNpdmUgdGlt
ZWxpbmUgb3JkZXJpbmcgKi8KLQlHRU1fQlVHX09OKGk5MTVfYWN0aXZlX2lzX2lkbGUocmVmKSk7
CisJaWYgKHJlcGxhY2VfYmFycmllcihyZWYsIGFjdGl2ZSkpIHsKKwkJUkNVX0lOSVRfUE9JTlRF
UihhY3RpdmUtPmZlbmNlLCBmZW5jZSk7CisJCXJldHVybiBOVUxMOworCX0KIAogCXJjdV9yZWFk
X2xvY2soKTsKLQlwcmV2ID0gX19pOTE1X2FjdGl2ZV9mZW5jZV9zZXQoJnJlZi0+ZXhjbCwgZik7
CisJcHJldiA9IF9faTkxNV9hY3RpdmVfZmVuY2Vfc2V0KGFjdGl2ZSwgZmVuY2UpOwogCWlmIChw
cmV2KQogCQlwcmV2ID0gZG1hX2ZlbmNlX2dldF9yY3UocHJldik7CiAJZWxzZQotCQlhdG9taWNf
aW5jKCZyZWYtPmNvdW50KTsKKwkJX19pOTE1X2FjdGl2ZV9hY3F1aXJlKHJlZik7CiAJcmN1X3Jl
YWRfdW5sb2NrKCk7CiAKIAlyZXR1cm4gcHJldjsKIH0KIAorc3RhdGljIHN0cnVjdCBpOTE1X2Fj
dGl2ZV9mZW5jZSAqCitfX2FjdGl2ZV9mZW5jZShzdHJ1Y3QgaTkxNV9hY3RpdmUgKnJlZiwgdTY0
IGlkeCkKK3sKKwlzdHJ1Y3QgYWN0aXZlX25vZGUgKml0OworCisJaXQgPSBfX2FjdGl2ZV9sb29r
dXAocmVmLCBpZHgpOworCWlmICh1bmxpa2VseSghaXQpKSB7IC8qIENvbnRlbnRpb24gd2l0aCBw
YXJhbGxlbCB0cmVlIGJ1aWxkZXJzISAqLworCQlzcGluX2xvY2tfaXJxKCZyZWYtPnRyZWVfbG9j
ayk7CisJCWl0ID0gX19hY3RpdmVfbG9va3VwKHJlZiwgaWR4KTsKKwkJc3Bpbl91bmxvY2tfaXJx
KCZyZWYtPnRyZWVfbG9jayk7CisJfQorCUdFTV9CVUdfT04oIWl0KTsgLyogc2xvdCBtdXN0IGJl
IHByZWFsbG9jYXRlZCAqLworCisJcmV0dXJuICZpdC0+YmFzZTsKK30KKworc3RydWN0IGRtYV9m
ZW5jZSAqCitfX2k5MTVfYWN0aXZlX3JlZihzdHJ1Y3QgaTkxNV9hY3RpdmUgKnJlZiwgdTY0IGlk
eCwgc3RydWN0IGRtYV9mZW5jZSAqZmVuY2UpCit7CisJLyogT25seSB2YWxpZCB3aGlsZSBhY3Rp
dmUsIHNlZSBpOTE1X2FjdGl2ZV9hY3F1aXJlX2Zvcl9jb250ZXh0KCkgKi8KKwlyZXR1cm4gX19p
OTE1X2FjdGl2ZV9zZXRfZmVuY2UocmVmLCBfX2FjdGl2ZV9mZW5jZShyZWYsIGlkeCksIGZlbmNl
KTsKK30KKworc3RydWN0IGRtYV9mZW5jZSAqCitpOTE1X2FjdGl2ZV9zZXRfZXhjbHVzaXZlKHN0
cnVjdCBpOTE1X2FjdGl2ZSAqcmVmLCBzdHJ1Y3QgZG1hX2ZlbmNlICpmKQoreworCS8qIFdlIGV4
cGVjdCB0aGUgY2FsbGVyIHRvIG1hbmFnZSB0aGUgZXhjbHVzaXZlIHRpbWVsaW5lIG9yZGVyaW5n
ICovCisJcmV0dXJuIF9faTkxNV9hY3RpdmVfc2V0X2ZlbmNlKHJlZiwgJnJlZi0+ZXhjbCwgZik7
Cit9CisKIGJvb2wgaTkxNV9hY3RpdmVfYWNxdWlyZV9pZl9idXN5KHN0cnVjdCBpOTE1X2FjdGl2
ZSAqcmVmKQogewogCWRlYnVnX2FjdGl2ZV9hc3NlcnQocmVmKTsKQEAgLTQ1MSw2ICs1MTksMjQg
QEAgaW50IGk5MTVfYWN0aXZlX2FjcXVpcmUoc3RydWN0IGk5MTVfYWN0aXZlICpyZWYpCiAJcmV0
dXJuIGVycjsKIH0KIAoraW50IGk5MTVfYWN0aXZlX2FjcXVpcmVfZm9yX2NvbnRleHQoc3RydWN0
IGk5MTVfYWN0aXZlICpyZWYsIHU2NCBpZHgpCit7CisJc3RydWN0IGk5MTVfYWN0aXZlX2ZlbmNl
ICphY3RpdmU7CisJaW50IGVycjsKKworCWVyciA9IGk5MTVfYWN0aXZlX2FjcXVpcmUocmVmKTsK
KwlpZiAoZXJyKQorCQlyZXR1cm4gZXJyOworCisJYWN0aXZlID0gYWN0aXZlX2luc3RhbmNlKHJl
ZiwgaWR4KTsKKwlpZiAoIWFjdGl2ZSkgeworCQlpOTE1X2FjdGl2ZV9yZWxlYXNlKHJlZik7CisJ
CXJldHVybiAtRU5PTUVNOworCX0KKworCXJldHVybiAwOyAvKiByZXR1cm4gd2l0aCBhY3RpdmUg
cmVmICovCit9CisKIHZvaWQgaTkxNV9hY3RpdmVfcmVsZWFzZShzdHJ1Y3QgaTkxNV9hY3RpdmUg
KnJlZikKIHsKIAlkZWJ1Z19hY3RpdmVfYXNzZXJ0KHJlZik7CkBAIC03NTQsNyArODQwLDcgQEAg
c3RhdGljIHN0cnVjdCBhY3RpdmVfbm9kZSAqcmV1c2VfaWRsZV9iYXJyaWVyKHN0cnVjdCBpOTE1
X2FjdGl2ZSAqcmVmLCB1NjQgaWR4KQogbWF0Y2g6CiAJcmJfZXJhc2UocCwgJnJlZi0+dHJlZSk7
IC8qIEhpZGUgZnJvbSB3YWl0cyBhbmQgc2libGluZyBhbGxvY2F0aW9ucyAqLwogCWlmIChwID09
ICZyZWYtPmNhY2hlLT5ub2RlKQotCQlyZWYtPmNhY2hlID0gTlVMTDsKKwkJV1JJVEVfT05DRShy
ZWYtPmNhY2hlLCBOVUxMKTsKIAlzcGluX3VubG9ja19pcnEoJnJlZi0+dHJlZV9sb2NrKTsKIAog
CXJldHVybiByYl9lbnRyeShwLCBzdHJ1Y3QgYWN0aXZlX25vZGUsIG5vZGUpOwpAQCAtODEyLDcg
Kzg5OCw3IEBAIGludCBpOTE1X2FjdGl2ZV9hY3F1aXJlX3ByZWFsbG9jYXRlX2JhcnJpZXIoc3Ry
dWN0IGk5MTVfYWN0aXZlICpyZWYsCiAJCQkgKi8KIAkJCVJDVV9JTklUX1BPSU5URVIobm9kZS0+
YmFzZS5mZW5jZSwgRVJSX1BUUigtRUFHQUlOKSk7CiAJCQlub2RlLT5iYXNlLmNiLm5vZGUucHJl
diA9ICh2b2lkICopZW5naW5lOwotCQkJYXRvbWljX2luYygmcmVmLT5jb3VudCk7CisJCQlfX2k5
MTVfYWN0aXZlX2FjcXVpcmUocmVmKTsKIAkJfQogCQlHRU1fQlVHX09OKHJjdV9hY2Nlc3NfcG9p
bnRlcihub2RlLT5iYXNlLmZlbmNlKSAhPSBFUlJfUFRSKC1FQUdBSU4pKTsKIApkaWZmIC0tZ2l0
IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9hY3RpdmUuaCBiL2RyaXZlcnMvZ3B1L2RybS9p
OTE1L2k5MTVfYWN0aXZlLmgKaW5kZXggY2Y0MDU4MTUwOTY2Li43M2RlZDNjNTJhMDQgMTAwNjQ0
Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfYWN0aXZlLmgKKysrIGIvZHJpdmVycy9n
cHUvZHJtL2k5MTUvaTkxNV9hY3RpdmUuaApAQCAtMTYzLDE0ICsxNjMsMTYgQEAgdm9pZCBfX2k5
MTVfYWN0aXZlX2luaXQoc3RydWN0IGk5MTVfYWN0aXZlICpyZWYsCiAJX19pOTE1X2FjdGl2ZV9p
bml0KHJlZiwgYWN0aXZlLCByZXRpcmUsICZfX21rZXksICZfX3drZXkpOwlcCiB9IHdoaWxlICgw
KQogCi1pbnQgaTkxNV9hY3RpdmVfcmVmKHN0cnVjdCBpOTE1X2FjdGl2ZSAqcmVmLAotCQkgICAg
c3RydWN0IGludGVsX3RpbWVsaW5lICp0bCwKLQkJICAgIHN0cnVjdCBkbWFfZmVuY2UgKmZlbmNl
KTsKK3N0cnVjdCBkbWFfZmVuY2UgKgorX19pOTE1X2FjdGl2ZV9yZWYoc3RydWN0IGk5MTVfYWN0
aXZlICpyZWYsIHU2NCBpZHgsIHN0cnVjdCBkbWFfZmVuY2UgKmZlbmNlKTsKK2ludCBpOTE1X2Fj
dGl2ZV9yZWYoc3RydWN0IGk5MTVfYWN0aXZlICpyZWYsIHU2NCBpZHgsIHN0cnVjdCBkbWFfZmVu
Y2UgKmZlbmNlKTsKIAogc3RhdGljIGlubGluZSBpbnQKIGk5MTVfYWN0aXZlX2FkZF9yZXF1ZXN0
KHN0cnVjdCBpOTE1X2FjdGl2ZSAqcmVmLCBzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpycSkKIHsKLQly
ZXR1cm4gaTkxNV9hY3RpdmVfcmVmKHJlZiwgaTkxNV9yZXF1ZXN0X3RpbWVsaW5lKHJxKSwgJnJx
LT5mZW5jZSk7CisJcmV0dXJuIGk5MTVfYWN0aXZlX3JlZihyZWYsCisJCQkgICAgICAgaTkxNV9y
ZXF1ZXN0X3RpbWVsaW5lKHJxKS0+ZmVuY2VfY29udGV4dCwKKwkJCSAgICAgICAmcnEtPmZlbmNl
KTsKIH0KIAogc3RydWN0IGRtYV9mZW5jZSAqCkBAIC0xOTgsNyArMjAwLDkgQEAgaW50IGk5MTVf
cmVxdWVzdF9hd2FpdF9hY3RpdmUoc3RydWN0IGk5MTVfcmVxdWVzdCAqcnEsCiAjZGVmaW5lIEk5
MTVfQUNUSVZFX0FXQUlUX0JBUlJJRVIgQklUKDIpCiAKIGludCBpOTE1X2FjdGl2ZV9hY3F1aXJl
KHN0cnVjdCBpOTE1X2FjdGl2ZSAqcmVmKTsKK2ludCBpOTE1X2FjdGl2ZV9hY3F1aXJlX2Zvcl9j
b250ZXh0KHN0cnVjdCBpOTE1X2FjdGl2ZSAqcmVmLCB1NjQgaWR4KTsKIGJvb2wgaTkxNV9hY3Rp
dmVfYWNxdWlyZV9pZl9idXN5KHN0cnVjdCBpOTE1X2FjdGl2ZSAqcmVmKTsKKwogdm9pZCBpOTE1
X2FjdGl2ZV9yZWxlYXNlKHN0cnVjdCBpOTE1X2FjdGl2ZSAqcmVmKTsKIAogc3RhdGljIGlubGlu
ZSB2b2lkIF9faTkxNV9hY3RpdmVfYWNxdWlyZShzdHJ1Y3QgaTkxNV9hY3RpdmUgKnJlZikKLS0g
CjIuMjAuMQoKX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX18K
SW50ZWwtZ2Z4IG1haWxpbmcgbGlzdApJbnRlbC1nZnhAbGlzdHMuZnJlZWRlc2t0b3Aub3JnCmh0
dHBzOi8vbGlzdHMuZnJlZWRlc2t0b3Aub3JnL21haWxtYW4vbGlzdGluZm8vaW50ZWwtZ2Z4Cg==

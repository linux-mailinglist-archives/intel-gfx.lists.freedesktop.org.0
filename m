Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id D4DA5150821
	for <lists+intel-gfx@lfdr.de>; Mon,  3 Feb 2020 15:11:25 +0100 (CET)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 201D66EC01;
	Mon,  3 Feb 2020 14:11:24 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from mga07.intel.com (mga07.intel.com [134.134.136.100])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 10CD26EC02
 for <intel-gfx@lists.freedesktop.org>; Mon,  3 Feb 2020 14:11:22 +0000 (UTC)
X-Amp-Result: SKIPPED(no attachment in message)
X-Amp-File-Uploaded: False
Received: from fmsmga005.fm.intel.com ([10.253.24.32])
 by orsmga105.jf.intel.com with ESMTP/TLS/DHE-RSA-AES256-GCM-SHA384;
 03 Feb 2020 06:11:21 -0800
X-ExtLoop1: 1
X-IronPort-AV: E=Sophos;i="5.70,398,1574150400"; d="scan'208";a="429455591"
Received: from slisovsk-lenovo-ideapad-720s-13ikb.fi.intel.com ([10.237.72.89])
 by fmsmga005.fm.intel.com with ESMTP; 03 Feb 2020 06:11:19 -0800
From: Stanislav Lisovskiy <stanislav.lisovskiy@intel.com>
To: intel-gfx@lists.freedesktop.org
Date: Mon,  3 Feb 2020 16:07:44 +0200
Message-Id: <20200203140747.22771-5-stanislav.lisovskiy@intel.com>
X-Mailer: git-send-email 2.24.1.485.gad05a3d8e5
In-Reply-To: <20200203140747.22771-1-stanislav.lisovskiy@intel.com>
References: <20200203140747.22771-1-stanislav.lisovskiy@intel.com>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH v14 4/7] drm/i915: Refactor intel_can_enable_sagv
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.29
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

Q3VycmVudGx5IGludGVsX2Nhbl9lbmFibGVfc2FndiBmdW5jdGlvbiBjb250YWlucwphIG1peCBv
ZiB3b3JrYXJvdW5kcyBmb3IgZGlmZmVyZW50IHBsYXRmb3Jtcwpzb21lIG9mIHRoZW0gYXJlIG5v
dCB2YWxpZCBmb3IgZ2VucyA+PSAxMSBhbHJlYWR5LApzbyBsZXRzIHNwbGl0IGl0IGludG8gc2Vw
YXJhdGUgZnVuY3Rpb25zLgoKdjI6CiAgICAtIFJld29yayB3YXRlcm1hcmsgY2FsY3VsYXRpb24g
YWxnb3JpdGhtIHRvCiAgICAgIGF0dGVtcHQgdG8gY2FsY3VsYXRlIExldmVsIDAgd2F0ZXJtYXJr
CiAgICAgIHdpdGggYWRkZWQgc2FndiBibG9jayB0aW1lIGxhdGVuY3kgYW5kCiAgICAgIGNoZWNr
IGlmIGl0IGZpdHMgaW4gREJ1ZiBpbiBvcmRlciB0bwogICAgICBkZXRlcm1pbmUgaWYgU0FHViBj
YW4gYmUgZW5hYmxlZCBhbHJlYWR5CiAgICAgIGF0IHRoaXMgc3RhZ2UsIGp1c3QgYXMgQlNwZWMg
NDkzMjUgc3RhdGVzLgogICAgICBpZiB0aGF0IGZhaWxzIHJvbGxiYWNrIHRvIHVzdWFsIExldmVs
IDAKICAgICAgbGF0ZW5jeSBhbmQgZGlzYWJsZSBTQUdWLgogICAgLSBSZW1vdmUgdW5uZWVkZWQg
dGFicyhKYW1lcyBBdXNtdXMpCgp2MzogUmViYXNlZCB0aGUgcGF0Y2gKCnY0OiAtIEFkZGVkIGJh
Y2sgaW50ZXJsYWNlZCBjaGVjayBmb3IgR2VuMTIgYW5kCiAgICAgIGFkZGVkIHNlcGFyYXRlIGZ1
bmN0aW9uIGZvciBUR0wgU0FHViBjaGVjawogICAgICAodGhhbmtzIHRvIEphbWVzIEF1c211cyBm
b3Igc3BvdHRpbmcpCiAgICAtIFJlbW92ZWQgdW5uZWVkZWQgZ2VuIGNoZWNrCiAgICAtIEV4dHJh
Y3RlZCBHZW4xMiBTQUdWIGRlY2lzaW9uIG1ha2luZyBjb2RlCiAgICAgIHRvIGEgc2VwYXJhdGUg
ZnVuY3Rpb24gZnJvbSBza2xfY29tcHV0ZV93bQoKdjU6IC0gQWRkZWQgU0FHViBnbG9iYWwgc3Rh
dGUgdG8gZGV2X3ByaXYsIGJlY2F1c2UKICAgICAgd2UgbmVlZCB0byB0cmFjayBhbGwgcGlwZXMs
IG5vdCBvbmx5IHRob3NlCiAgICAgIGluIGF0b21pYyBzdGF0ZS4gRWFjaCBwaXBlIGhhcyBub3cg
Y29ycmVzcG9uZGVudAogICAgICBiaXQgbWFzayByZWZsZWN0aW5nLCB3aGV0aGVyIGl0IGNhbiB0
b2xlcmF0ZQogICAgICBTQUdWIG9yIG5vdCh0aGFua3MgdG8gVmlsbGUgU3lyamFsYSBmb3Igc3Vn
Z2VzdGlvbnMpLgogICAgLSBOb3cgdXNpbmcgYWN0aXZlIGZsYWcgaW5zdGVhZCBvZiBlbmFibGUg
aW4gY3JjCiAgICAgIHVzYWdlIGNoZWNrLgoKdjY6IC0gRml4ZWQgcmViYXNlIGNvbmZsaWN0cwoK
djc6IC0ga21zX2N1cnNvcl9sZWdhY3kgc2VlbXMgdG8gZ2V0IGJyb2tlbiBiZWNhdXNlIG9mIG11
bHRpcGxlIG1lbWNweQogICAgICBjYWxscyB3aGVuIGNvcHlpbmcgbGV2ZWwgMCB3YXRlciBtYXJr
cyBmb3IgZW5hYmxlZCBTQUdWLCB0bwogICAgICBmaXggdGhpcyBub3cgc2ltcGx5IHVzaW5nIHRo
YXQgZmllbGQgcmlnaHQgYXdheSwgd2l0aG91dCBjb3B5aW5nLAogICAgICBmb3IgdGhhdCBpbnRy
b2R1Y2VkIGEgbmV3IHdtX2xldmVsIGFjY2Vzc29yIHdoaWNoIGRlY2lkZXMgd2hpY2gKICAgICAg
d21fbGV2ZWwgdG8gcmV0dXJuIGJhc2VkIG9uIFNBR1Ygc3RhdGUuCgp2ODogLSBQcm90ZWN0IGNy
dGNfc2Fndl9tYXNrIHNhbWUgd2F5IGFzIHdlIGRvIGZvciBvdGhlciBnbG9iYWwgc3RhdGUKICAg
ICAgY2hhbmdlczogaS5lIGNoZWNrIGlmIGNoYW5nZXMgYXJlIG5lZWRlZCwgdGhlbiBncmFiIGFs
bCBjcnRjIGxvY2tzCiAgICAgIHRvIHNlcmlhbGl6ZSB0aGUgY2hhbmdlcyhWaWxsZSBTeXJqw6Rs
w6QpCiAgICAtIEFkZCBjcnRjX3NhZ3ZfbWFzayBjYWNoaW5nIGluIG9yZGVyIHRvIGF2b2lkIG5l
ZWRsZXNzIHJlY2FsY3VsYXRpb25zCiAgICAgIChNYXR0aGV3IFJvcGVyKQogICAgLSBQdXQgYmFj
ayBHZW4xMiBTQUdWIHN3aXRjaCBpbiBvcmRlciB0byBnZXQgaXQgZW5hYmxlZCBpbiBzZXBhcmF0
ZQogICAgICBwYXRjaChNYXR0aGV3IFJvcGVyKQogICAgLSBSZW5hbWUgKl9zZXRfc2Fndl9tYXNr
IHRvICpfY29tcHV0ZV9zYWd2X21hc2soTWF0dGhldyBSb3BlcikKICAgIC0gQ2hlY2sgaWYgdGhl
cmUgYXJlIG5vIGFjdGl2ZSBwaXBlcyBpbiBpbnRlbF9jYW5fZW5hYmxlX3NhZ3YKICAgICAgaW5z
dGVhZCBvZiBwbGF0Zm9ybSBzcGVjaWZpYyBmdW5jdGlvbnMoTWF0dGhldyBSb3BlciksIHNhbWUK
ICAgICAgZm9yIGludGVsX2hhc19zYWd2IGNoZWNrLgoKdjkgIC0gU3dpdGNoZWQgdG8gdTggZm9y
IGNydGNfc2Fndl9tYXNrKFZpbGxlIFN5cmrDpGzDpCkKICAgIC0gY3J0Y19zYWd2X21hc2sgbm93
IGlzIHBpcGVfc2Fndl9tYXNrKFZpbGxlIFN5cmrDpGzDpCkKICAgIC0gRXh0cmFjdGVkIHNhZ3Yg
Y2hlY2tpbmcgbG9naWMgZnJvbSBza2wvaWNsL3RnbF9jb21wdXRlX3NhZ3ZfbWFzawogICAgLSBF
eHRyYWN0ZWQgc2tsX3BsYW5lX3dtX2xldmVsIGZ1bmN0aW9uIGFuZCBwYXNzaW5nIGxhdGVuY3kg
dG8KICAgICAgc2VwYXJhdGUgcGF0Y2hlcyhWaWxsZSBTeXJqw6Rsw6QpCiAgICAtIFJlbW92ZWQg
cGFydCBvZiB1bm5lZWRlZCBjb3B5LXBhc3RlIGZyb20gdGdsX2NoZWNrX3BpcGVfZml0c19zYWd2
X3dtCiAgICAgIChWaWxsZSBTeXJqw6Rsw6QpCiAgICAtIE5vdyB1c2luZyBzaW1wbGUgYXNzaWdu
bWVudCBmb3Igc2Fndl93bTAgYXMgaXQgY29udGFpbnMgb25seQogICAgICBwb2QgdHlwZXMgYW5k
IG5vIHBvaW50ZXJzKFZpbGxlIFN5cmrDpGzDpCkKICAgIC0gRml4ZWQgaW50ZWxfY2FuX2VuYWJs
ZV9zYWd2IG5vdCB0byBkbyBkb3VibGUgZHV0eSwgbm93IGl0IG9ubHkKICAgICAgY2hlY2sgU0FH
ViBiaXRzIGJ5IEFORGluZyB0aG9zZSBiZXR3ZWVuIGxvY2FsIGFuZCBnbG9iYWwgc3RhdGUuCiAg
ICAgIFRoZSBTQUdWIG1hc2tzIGFyZSBub3cgY29tcHV0ZWQgYWZ0ZXIgd2F0ZXJtYXJrcyBhcmUg
YXZhaWxhYmxlLAogICAgICBpbiBvcmRlciB0byBiZSBhYmxlIHRvIGZpZ3VyZSBvdXQgaWYgZGRi
IHJhbmdlcyBhcmUgZml0dGluZyBuaWNlbHkuCiAgICAgIChWaWxsZSBTeXJqw6Rsw6QpCiAgICAt
IE5vdyBoYXZpbmcgdXZfc2Fndl93bTAgYW5kIHNhZ3Zfd20wLCBvdGhlcndpc2Ugd2UgaGF2ZSB3
cm9uZyBsb2dpYwogICAgICB3aGVuIHVzaW5nIHNrbF9wbGFuZV93bV9sZXZlbCBhY2Nlc3Nvciwg
YXMgd2UgaGFkIHByZXZpb3VzbHkgZm9yIEdlbjExKwogICAgICBjb2xvciBwbGFuZSBhbmQgcmVn
dWxhciB3bSBsZXZlbHMsIHNvIHByb2JhYmx5IGJvdGggaGFzIHRvIGJlIHJlY2FsY3VsYXRlZAog
ICAgICB3aXRoIGFkZGl0aW9uYWwgU0FHViBibG9jayB0aW1lIGZvciBMZXZlbCAwLgoKdjEwOiAt
IFN0YXJ0aW5nIHRvIHVzZSBuZXcgZ2xvYmFsIHN0YXRlIGZvciBzdG9yaW5nIHBpcGVfc2Fndl9t
YXNrCgpTaWduZWQtb2ZmLWJ5OiBTdGFuaXNsYXYgTGlzb3Zza2l5IDxzdGFuaXNsYXYubGlzb3Zz
a2l5QGludGVsLmNvbT4KQ2M6IFZpbGxlIFN5cmrDpGzDpCA8dmlsbGUuc3lyamFsYUBpbnRlbC5j
b20+CkNjOiBKYW1lcyBBdXNtdXMgPGphbWVzLmF1c211c0BpbnRlbC5jb20+Ci0tLQogZHJpdmVy
cy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9idy5oICAgICAgIHwgICA2ICsKIGRyaXZlcnMv
Z3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZGlzcGxheS5jICB8ICAyMiArLQogLi4uL2RybS9p
OTE1L2Rpc3BsYXkvaW50ZWxfZGlzcGxheV90eXBlcy5oICAgIHwgICA4ICsKIGRyaXZlcnMvZ3B1
L2RybS9pOTE1L2ludGVsX3BtLmMgICAgICAgICAgICAgICB8IDQyNiArKysrKysrKysrKysrKysr
LS0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2ludGVsX3BtLmggICAgICAgICAgICAgICB8ICAgNCAr
LQogNSBmaWxlcyBjaGFuZ2VkLCA0MjYgaW5zZXJ0aW9ucygrKSwgNDAgZGVsZXRpb25zKC0pCgpk
aWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9idy5oIGIvZHJp
dmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9idy5oCmluZGV4IGFjMDA0ZDZmNDI3Ni4u
NmMzM2QzYWY1MGE5IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2lu
dGVsX2J3LmgKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9idy5oCkBA
IC0xOCw2ICsxOCwxMiBAQCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZTsKIHN0cnVjdCBpbnRlbF9i
d19zdGF0ZSB7CiAJc3RydWN0IGludGVsX2dsb2JhbF9zdGF0ZSBiYXNlOwogCisJLyoKKwkgKiBD
b250YWlucyBhIGJpdCBtYXNrLCB3aGV0aGVyIGNvcnJlc3BvbmRlbnQKKwkgKiBwaXBlIGFsbG93
cyBTQUdWIG9yIG5vdC4KKwkgKi8KKwl1OCBwaXBlX3NhZ3ZfbWFzazsKKwogCXVuc2lnbmVkIGlu
dCBkYXRhX3JhdGVbSTkxNV9NQVhfUElQRVNdOwogCXU4IG51bV9hY3RpdmVfcGxhbmVzW0k5MTVf
TUFYX1BJUEVTXTsKIH07CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5
L2ludGVsX2Rpc3BsYXkuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZGlz
cGxheS5jCmluZGV4IGIwYWYzN2ZiNmQ0YS4uZGViZTNlOTNkMmU3IDEwMDY0NAotLS0gYS9kcml2
ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2Rpc3BsYXkuYworKysgYi9kcml2ZXJzL2dw
dS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2Rpc3BsYXkuYwpAQCAtMTQwODAsNyArMTQwODAsMTAg
QEAgc3RhdGljIHZvaWQgdmVyaWZ5X3dtX3N0YXRlKHN0cnVjdCBpbnRlbF9jcnRjICpjcnRjLAog
CQkvKiBXYXRlcm1hcmtzICovCiAJCWZvciAobGV2ZWwgPSAwOyBsZXZlbCA8PSBtYXhfbGV2ZWw7
IGxldmVsKyspIHsKIAkJCWlmIChza2xfd21fbGV2ZWxfZXF1YWxzKCZod19wbGFuZV93bS0+d21b
bGV2ZWxdLAotCQkJCQkJJnN3X3BsYW5lX3dtLT53bVtsZXZlbF0pKQorCQkJCQkJJnN3X3BsYW5l
X3dtLT53bVtsZXZlbF0pIHx8CisJCQkgICAoc2tsX3dtX2xldmVsX2VxdWFscygmaHdfcGxhbmVf
d20tPndtW2xldmVsXSwKKwkJCQkJCSZzd19wbGFuZV93bS0+c2Fndl93bTApICYmCisJCQkgICAo
bGV2ZWwgPT0gMCkpKQogCQkJCWNvbnRpbnVlOwogCiAJCQlkcm1fZXJyKCZkZXZfcHJpdi0+ZHJt
LApAQCAtMTQxMzUsNyArMTQxMzgsMTAgQEAgc3RhdGljIHZvaWQgdmVyaWZ5X3dtX3N0YXRlKHN0
cnVjdCBpbnRlbF9jcnRjICpjcnRjLAogCQkvKiBXYXRlcm1hcmtzICovCiAJCWZvciAobGV2ZWwg
PSAwOyBsZXZlbCA8PSBtYXhfbGV2ZWw7IGxldmVsKyspIHsKIAkJCWlmIChza2xfd21fbGV2ZWxf
ZXF1YWxzKCZod19wbGFuZV93bS0+d21bbGV2ZWxdLAotCQkJCQkJJnN3X3BsYW5lX3dtLT53bVts
ZXZlbF0pKQorCQkJCQkJJnN3X3BsYW5lX3dtLT53bVtsZXZlbF0pIHx8CisJCQkgICAoc2tsX3dt
X2xldmVsX2VxdWFscygmaHdfcGxhbmVfd20tPndtW2xldmVsXSwKKwkJCQkJCSZzd19wbGFuZV93
bS0+c2Fndl93bTApICYmCisJCQkgICAobGV2ZWwgPT0gMCkpKQogCQkJCWNvbnRpbnVlOwogCiAJ
CQlkcm1fZXJyKCZkZXZfcHJpdi0+ZHJtLApAQCAtMTU2NTksOCArMTU2NjUsOSBAQCBzdGF0aWMg
dm9pZCBpbnRlbF9hdG9taWNfY29tbWl0X3RhaWwoc3RydWN0IGludGVsX2F0b21pY19zdGF0ZSAq
c3RhdGUpCiAJCSAqIFNLTCB3b3JrYXJvdW5kOiBic3BlYyByZWNvbW1lbmRzIHdlIGRpc2FibGUg
dGhlIFNBR1Ygd2hlbiB3ZQogCQkgKiBoYXZlIG1vcmUgdGhlbiBvbmUgcGlwZSBlbmFibGVkCiAJ
CSAqLwotCQlpZiAoIWludGVsX2Nhbl9lbmFibGVfc2FndihzdGF0ZSkpCi0JCQlpbnRlbF9kaXNh
YmxlX3NhZ3YoZGV2X3ByaXYpOworCQlpZiAoSU5URUxfR0VOKGRldl9wcml2KSA8IDExKQorCQkJ
aWYgKCFpbnRlbF9jYW5fZW5hYmxlX3NhZ3YoZGV2X3ByaXYpKQorCQkJCWludGVsX2Rpc2FibGVf
c2FndihkZXZfcHJpdik7CiAKIAkJaW50ZWxfbW9kZXNldF92ZXJpZnlfZGlzYWJsZWQoZGV2X3By
aXYsIHN0YXRlKTsKIAl9CkBAIC0xNTc1Miw4ICsxNTc1OSwxMCBAQCBzdGF0aWMgdm9pZCBpbnRl
bF9hdG9taWNfY29tbWl0X3RhaWwoc3RydWN0IGludGVsX2F0b21pY19zdGF0ZSAqc3RhdGUpCiAJ
aWYgKHN0YXRlLT5tb2Rlc2V0KQogCQlpbnRlbF92ZXJpZnlfcGxhbmVzKHN0YXRlKTsKIAotCWlm
IChzdGF0ZS0+bW9kZXNldCAmJiBpbnRlbF9jYW5fZW5hYmxlX3NhZ3Yoc3RhdGUpKQotCQlpbnRl
bF9lbmFibGVfc2FndihkZXZfcHJpdik7CisJaWYgKElOVEVMX0dFTihkZXZfcHJpdikgPCAxMSkg
eworCQlpZiAoc3RhdGUtPm1vZGVzZXQgJiYgaW50ZWxfY2FuX2VuYWJsZV9zYWd2KGRldl9wcml2
KSkKKwkJCWludGVsX2VuYWJsZV9zYWd2KGRldl9wcml2KTsKKwl9CiAKIAlkcm1fYXRvbWljX2hl
bHBlcl9jb21taXRfaHdfZG9uZSgmc3RhdGUtPmJhc2UpOwogCkBAIC0xNTkwNSw3ICsxNTkxNCw2
IEBAIHN0YXRpYyBpbnQgaW50ZWxfYXRvbWljX2NvbW1pdChzdHJ1Y3QgZHJtX2RldmljZSAqZGV2
LAogCiAJaWYgKHN0YXRlLT5nbG9iYWxfc3RhdGVfY2hhbmdlZCkgewogCQlhc3NlcnRfZ2xvYmFs
X3N0YXRlX2xvY2tlZChkZXZfcHJpdik7Ci0KIAkJZGV2X3ByaXYtPmFjdGl2ZV9waXBlcyA9IHN0
YXRlLT5hY3RpdmVfcGlwZXM7CiAJfQogCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkx
NS9kaXNwbGF5L2ludGVsX2Rpc3BsYXlfdHlwZXMuaCBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rp
c3BsYXkvaW50ZWxfZGlzcGxheV90eXBlcy5oCmluZGV4IDdjNjEzM2E5YzUxYi4uZDQ4NzI2Mjg0
ODdjIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2Rpc3Bs
YXlfdHlwZXMuaAorKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2Rpc3Bs
YXlfdHlwZXMuaApAQCAtNDc4LDYgKzQ3OCwxMiBAQCBzdHJ1Y3QgaW50ZWxfYXRvbWljX3N0YXRl
IHsKIAkgKi8KIAl1OCBhY3RpdmVfcGlwZV9jaGFuZ2VzOwogCisJLyoKKwkgKiBVc2VkIHRvIGRl
dGVybWluZSBpZiB3ZSBhbHJlYWR5IGhhZCBjYWxjdWxhdGVkCisJICogU0FHViBtYXNrIGZvciB0
aGlzIHN0YXRlIG9uY2UuCisJICovCisJYm9vbCBzYWd2X2NhbGN1bGF0ZWQ7CisKIAl1OCBhY3Rp
dmVfcGlwZXM7CiAKIAlzdHJ1Y3QgaW50ZWxfc2hhcmVkX2RwbGxfc3RhdGUgc2hhcmVkX2RwbGxb
STkxNV9OVU1fUExMU107CkBAIC02NTAsNiArNjU2LDggQEAgc3RydWN0IHNrbF9wbGFuZV93bSB7
CiAJc3RydWN0IHNrbF93bV9sZXZlbCB3bVs4XTsKIAlzdHJ1Y3Qgc2tsX3dtX2xldmVsIHV2X3dt
WzhdOwogCXN0cnVjdCBza2xfd21fbGV2ZWwgdHJhbnNfd207CisJc3RydWN0IHNrbF93bV9sZXZl
bCBzYWd2X3dtMDsKKwlzdHJ1Y3Qgc2tsX3dtX2xldmVsIHV2X3NhZ3Zfd20wOwogCWJvb2wgaXNf
cGxhbmFyOwogfTsKIApkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50ZWxfcG0u
YyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2ludGVsX3BtLmMKaW5kZXggYjUwNDNjY2QxNTliLi4w
ZWU0YWM2OTc2ZjggMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2ludGVsX3BtLmMK
KysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50ZWxfcG0uYwpAQCAtNDIsNiArNDIsNyBAQAog
I2luY2x1ZGUgImk5MTVfZHJ2LmgiCiAjaW5jbHVkZSAiaTkxNV9pcnEuaCIKICNpbmNsdWRlICJp
OTE1X3RyYWNlLmgiCisjaW5jbHVkZSAiZGlzcGxheS9pbnRlbF9idy5oIgogI2luY2x1ZGUgImlu
dGVsX3BtLmgiCiAjaW5jbHVkZSAiaW50ZWxfc2lkZWJhbmQuaCIKICNpbmNsdWRlICIuLi8uLi8u
Li9wbGF0Zm9ybS94ODYvaW50ZWxfaXBzLmgiCkBAIC0zNjI4LDcgKzM2MjksNyBAQCBzdGF0aWMg
Ym9vbCBza2xfbmVlZHNfbWVtb3J5X2J3X3dhKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZf
cHJpdikKIAlyZXR1cm4gSVNfR0VOOV9CQyhkZXZfcHJpdikgfHwgSVNfQlJPWFRPTihkZXZfcHJp
dik7CiB9CiAKLXN0YXRpYyBib29sCitib29sCiBpbnRlbF9oYXNfc2FndihzdHJ1Y3QgZHJtX2k5
MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCiB7CiAJLyogSEFDSyEgKi8KQEAgLTM3NTEsMzkgKzM3NTIs
MjQgQEAgaW50ZWxfZGlzYWJsZV9zYWd2KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJp
dikKIAlyZXR1cm4gMDsKIH0KIAotYm9vbCBpbnRlbF9jYW5fZW5hYmxlX3NhZ3Yoc3RydWN0IGlu
dGVsX2F0b21pY19zdGF0ZSAqc3RhdGUpCitzdGF0aWMgYm9vbCBza2xfY2FuX2VuYWJsZV9zYWd2
X29uX3BpcGUoc3RydWN0IGludGVsX2F0b21pY19zdGF0ZSAqc3RhdGUsCisJCQkJCWVudW0gcGlw
ZSBwaXBlKQogewogCXN0cnVjdCBkcm1fZGV2aWNlICpkZXYgPSBzdGF0ZS0+YmFzZS5kZXY7CiAJ
c3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShkZXYpOwogCXN0cnVj
dCBpbnRlbF9jcnRjICpjcnRjOwogCXN0cnVjdCBpbnRlbF9wbGFuZSAqcGxhbmU7CiAJc3RydWN0
IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGU7Ci0JZW51bSBwaXBlIHBpcGU7CiAJaW50IGxl
dmVsLCBsYXRlbmN5OwogCi0JaWYgKCFpbnRlbF9oYXNfc2FndihkZXZfcHJpdikpCi0JCXJldHVy
biBmYWxzZTsKLQotCS8qCi0JICogSWYgdGhlcmUgYXJlIG5vIGFjdGl2ZSBDUlRDcywgbm8gYWRk
aXRpb25hbCBjaGVja3MgbmVlZCBiZSBwZXJmb3JtZWQKLQkgKi8KLQlpZiAoaHdlaWdodDgoc3Rh
dGUtPmFjdGl2ZV9waXBlcykgPT0gMCkKLQkJcmV0dXJuIHRydWU7Ci0KLQkvKgotCSAqIFNLTCsg
d29ya2Fyb3VuZDogYnNwZWMgcmVjb21tZW5kcyB3ZSBkaXNhYmxlIFNBR1Ygd2hlbiB3ZSBoYXZl
Ci0JICogbW9yZSB0aGVuIG9uZSBwaXBlIGVuYWJsZWQKLQkgKi8KLQlpZiAoaHdlaWdodDgoc3Rh
dGUtPmFjdGl2ZV9waXBlcykgPiAxKQotCQlyZXR1cm4gZmFsc2U7Ci0KLQkvKiBTaW5jZSB3ZSdy
ZSBub3cgZ3VhcmFudGVlZCB0byBvbmx5IGhhdmUgb25lIGFjdGl2ZSBDUlRDLi4uICovCi0JcGlw
ZSA9IGZmcyhzdGF0ZS0+YWN0aXZlX3BpcGVzKSAtIDE7CiAJY3J0YyA9IGludGVsX2dldF9jcnRj
X2Zvcl9waXBlKGRldl9wcml2LCBwaXBlKTsKIAljcnRjX3N0YXRlID0gdG9faW50ZWxfY3J0Y19z
dGF0ZShjcnRjLT5iYXNlLnN0YXRlKTsKIAotCWlmIChjcnRjX3N0YXRlLT5ody5hZGp1c3RlZF9t
b2RlLmZsYWdzICYgRFJNX01PREVfRkxBR19JTlRFUkxBQ0UpCisJaWYgKGNydGNfc3RhdGUtPmh3
LmFkanVzdGVkX21vZGUuZmxhZ3MgJiBEUk1fTU9ERV9GTEFHX0lOVEVSTEFDRSkgeworCQlEUk1f
REVCVUdfS01TKCJObyBTQUdWIGZvciBpbnRlcmxhY2VkIG1vZGUgb24gcGlwZSAlY1xuIiwKKwkJ
CSAgICAgIHBpcGVfbmFtZShwaXBlKSk7CiAJCXJldHVybiBmYWxzZTsKKwl9CiAKIAlmb3JfZWFj
aF9pbnRlbF9wbGFuZV9vbl9jcnRjKGRldiwgY3J0YywgcGxhbmUpIHsKIAkJc3RydWN0IHNrbF9w
bGFuZV93bSAqd20gPQpAQCAtMzgxMCwxMyArMzc5NiwxOTAgQEAgYm9vbCBpbnRlbF9jYW5fZW5h
YmxlX3NhZ3Yoc3RydWN0IGludGVsX2F0b21pY19zdGF0ZSAqc3RhdGUpCiAJCSAqIGluY3VyIG1l
bW9yeSBsYXRlbmNpZXMgaGlnaGVyIHRoYW4gc2Fndl9ibG9ja190aW1lX3VzIHdlCiAJCSAqIGNh
bid0IGVuYWJsZSBTQUdWLgogCQkgKi8KLQkJaWYgKGxhdGVuY3kgPCBkZXZfcHJpdi0+c2Fndl9i
bG9ja190aW1lX3VzKQorCQlpZiAobGF0ZW5jeSA8IGRldl9wcml2LT5zYWd2X2Jsb2NrX3RpbWVf
dXMpIHsKKwkJCURSTV9ERUJVR19LTVMoIkxhdGVuY3kgJWQgPCBzYWd2IGJsb2NrIHRpbWUgJWQs
IG5vIFNBR1YgZm9yIHBpcGUgJWNcbiIsCisJCQkJICAgICAgbGF0ZW5jeSwgZGV2X3ByaXYtPnNh
Z3ZfYmxvY2tfdGltZV91cywgcGlwZV9uYW1lKHBpcGUpKTsKKwkJCXJldHVybiBmYWxzZTsKKwkJ
fQorCX0KKworCXJldHVybiB0cnVlOworfQorCitzdGF0aWMgdm9pZCBza2xfY29tcHV0ZV9zYWd2
X21hc2soc3RydWN0IGludGVsX2F0b21pY19zdGF0ZSAqc3RhdGUpCit7CisJc3RydWN0IGludGVs
X2NydGMgKmNydGM7CisJZW51bSBwaXBlIHBpcGU7CisJc3RydWN0IGludGVsX2J3X3N0YXRlICpu
ZXdfYndfc3RhdGUgPSBpbnRlbF9hdG9taWNfZ2V0X25ld19id19zdGF0ZShzdGF0ZSk7CisKKwlp
ZiAoSVNfRVJSKG5ld19id19zdGF0ZSkpIHsKKwkJV0FSTigxLCAiQ291bGQgbm90IGdldCBid19z
dGF0ZVxuIik7CisJCXJldHVybjsKKwl9CisKKworCWlmIChzdGF0ZS0+YWN0aXZlX3BpcGVzICE9
IDEpIHsKKwkJbmV3X2J3X3N0YXRlLT5waXBlX3NhZ3ZfbWFzayA9IDA7CisJCURSTV9ERUJVR19L
TVMoIk5vIFNBR1YgZm9yIG11bHRpcGxlIHBpcGVzIG9uIEdlbiA5XG4iKTsKKwkJcmV0dXJuOwor
CX0KKworCS8qIFNpbmNlIHdlJ3JlIG5vdyBndWFyYW50ZWVkIHRvIG9ubHkgaGF2ZSBvbmUgYWN0
aXZlIENSVEMuLi4gKi8KKwlwaXBlID0gZmZzKHN0YXRlLT5hY3RpdmVfcGlwZXMpIC0gMTsKKwor
CWlmIChza2xfY2FuX2VuYWJsZV9zYWd2X29uX3BpcGUoc3RhdGUsIHBpcGUpKQorCQluZXdfYndf
c3RhdGUtPnBpcGVfc2Fndl9tYXNrIHw9IEJJVChjcnRjLT5waXBlKTsKKwllbHNlCisJCW5ld19i
d19zdGF0ZS0+cGlwZV9zYWd2X21hc2sgJj0gfkJJVChjcnRjLT5waXBlKTsKK30KKworc3RhdGlj
IHZvaWQgdGdsX2NvbXB1dGVfc2Fndl9tYXNrKHN0cnVjdCBpbnRlbF9hdG9taWNfc3RhdGUgKnN0
YXRlKTsKKworc3RhdGljIHZvaWQgaWNsX2NvbXB1dGVfc2Fndl9tYXNrKHN0cnVjdCBpbnRlbF9h
dG9taWNfc3RhdGUgKnN0YXRlKQoreworCXN0cnVjdCBpbnRlbF9jcnRjICpjcnRjOworCXN0cnVj
dCBpbnRlbF9jcnRjX3N0YXRlICpuZXdfY3J0Y19zdGF0ZTsKKwlpbnQgaTsKKwlzdHJ1Y3QgaW50
ZWxfYndfc3RhdGUgKm5ld19id19zdGF0ZSA9IGludGVsX2F0b21pY19nZXRfbmV3X2J3X3N0YXRl
KHN0YXRlKTsKKworCWlmIChJU19FUlIobmV3X2J3X3N0YXRlKSkgeworCQlXQVJOKDEsICJDb3Vs
ZCBub3QgZ2V0IGJ3X3N0YXRlXG4iKTsKKwkJcmV0dXJuOworCX0KKworCWZvcl9lYWNoX25ld19p
bnRlbF9jcnRjX2luX3N0YXRlKHN0YXRlLCBjcnRjLAorCQkJCQkgbmV3X2NydGNfc3RhdGUsIGkp
IHsKKwkJaWYgKHNrbF9jYW5fZW5hYmxlX3NhZ3Zfb25fcGlwZShzdGF0ZSwgY3J0Yy0+cGlwZSkp
CisJCQluZXdfYndfc3RhdGUtPnBpcGVfc2Fndl9tYXNrIHw9IEJJVChjcnRjLT5waXBlKTsKKwkJ
ZWxzZQorCQkJbmV3X2J3X3N0YXRlLT5waXBlX3NhZ3ZfbWFzayAmPSB+QklUKGNydGMtPnBpcGUp
OworCX0KK30KKwordm9pZCBpbnRlbF9jb21wdXRlX3NhZ3ZfbWFzayhzdHJ1Y3QgaW50ZWxfYXRv
bWljX3N0YXRlICpzdGF0ZSkKK3sKKwlpbnQgcmV0OworCXN0cnVjdCBkcm1fZGV2aWNlICpkZXYg
PSBzdGF0ZS0+YmFzZS5kZXY7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0g
dG9faTkxNShkZXYpOworCXN0cnVjdCBpbnRlbF9id19zdGF0ZSAqbmV3X2J3X3N0YXRlID0gaW50
ZWxfYXRvbWljX2dldF9uZXdfYndfc3RhdGUoc3RhdGUpOworCXN0cnVjdCBpbnRlbF9id19zdGF0
ZSAqb2xkX2J3X3N0YXRlID0gaW50ZWxfYXRvbWljX2dldF9vbGRfYndfc3RhdGUoc3RhdGUpOwor
CisJaWYgKElTX0VSUihuZXdfYndfc3RhdGUpIHx8IElTX0VSUihvbGRfYndfc3RhdGUpKSB7CisJ
CVdBUk4oMSwgIkNvdWxkIG5vdCBnZXQgYndfc3RhdGVcbiIpOworCQlyZXR1cm47CisJfQorCisJ
LyoKKwkgKiBNYWtlIHN1cmUgd2UgYWx3YXlzIHBpY2sgZ2xvYmFsIHN0YXRlIGZpcnN0LAorCSAq
IHRoZXJlIHNob3VsZG4ndCBiZSBhbnkgaXNzdWUgYXMgd2UgaG9sZCBvbmx5IGxvY2tzCisJICog
dG8gY29ycmVzcG9uZGVudCBjcnRjcyBpbiBzdGF0ZSwgaG93ZXZlciBvbmNlCisJICogd2UgZGV0
ZWN0IHRoYXQgd2UgbmVlZCB0byBjaGFuZ2UgU0FHViBtYXNrCisJICogaW4gZ2xvYmFsIHN0YXRl
LCB3ZSB3aWxsIGdyYWIgYWxsIHRoZSBjcnRjIGxvY2tzCisJICogaW4gb3JkZXIgdG8gZ2V0IHRo
aXMgc2VyaWFsaXplZCwgdGh1cyBvdGhlcgorCSAqIHJhY2luZyBjb21taXRzIGhhdmluZyBvdGhl
ciBjcnRjIGxvY2tzLCB3aWxsIGhhdmUKKwkgKiB0byBzdGFydCBvdmVyIGFnYWluLCBhcyBzdGF0
ZWQgYnkgV291bmQtV2FpdAorCSAqIGFsZ29yaXRobS4KKwkgKi8KKwluZXdfYndfc3RhdGUtPnBp
cGVfc2Fndl9tYXNrID0gb2xkX2J3X3N0YXRlLT5waXBlX3NhZ3ZfbWFzazsKKworCWlmIChJTlRF
TF9HRU4oZGV2X3ByaXYpID49IDEyKQorCQl0Z2xfY29tcHV0ZV9zYWd2X21hc2soc3RhdGUpOwor
CWVsc2UgaWYgKElOVEVMX0dFTihkZXZfcHJpdikgPT0gMTEpCisJCWljbF9jb21wdXRlX3NhZ3Zf
bWFzayhzdGF0ZSk7CisJZWxzZQorCQlza2xfY29tcHV0ZV9zYWd2X21hc2soc3RhdGUpOworCisJ
c3RhdGUtPnNhZ3ZfY2FsY3VsYXRlZCA9IHRydWU7CisJLyoKKwkgKiBGb3IgU0FHViB3ZSBuZWVk
IHRvIGFjY291bnQgYWxsIHRoZSBwaXBlcywKKwkgKiBub3Qgb25seSB0aGUgb25lcyB3aGljaCBh
cmUgaW4gc3RhdGUgY3VycmVudGx5LgorCSAqIEdyYWIgYWxsIGxvY2tzIGlmIHdlIGRldGVjdCB0
aGF0IHdlIGFyZSBhY3R1YWxseQorCSAqIGdvaW5nIHRvIGRvIHNvbWV0aGluZy4KKwkgKi8KKwlp
ZiAobmV3X2J3X3N0YXRlLT5waXBlX3NhZ3ZfbWFzayAhPSBvbGRfYndfc3RhdGUtPnBpcGVfc2Fn
dl9tYXNrKSB7CisJCXJldCA9IGludGVsX2F0b21pY19zZXJpYWxpemVfZ2xvYmFsX3N0YXRlKCZu
ZXdfYndfc3RhdGUtPmJhc2UpOworCQlpZiAocmV0KSB7CisJCQlEUk1fREVCVUdfS01TKCJDb3Vs
ZCBub3Qgc2VyaWFsaXplIGdsb2JhbCBzdGF0ZVxuIik7CisJCQlyZXR1cm47CisJCX0KKwl9Cit9
CisKKy8qCisgKiBUaGlzIGZ1bmN0aW9uIHRvIGJlIHVzZWQgYmVmb3JlIHN3YXAgc3RhdGUKKyAq
LworYm9vbCBpbnRlbF9jYW5fZW5hYmxlX3NhZ3ZfZm9yX3N0YXRlKHN0cnVjdCBpbnRlbF9hdG9t
aWNfc3RhdGUgKnN0YXRlKQoreworCXN0cnVjdCBkcm1fZGV2aWNlICpkZXYgPSBzdGF0ZS0+YmFz
ZS5kZXY7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShkZXYp
OworCWludCBpOworCXN0cnVjdCBpbnRlbF9jcnRjICpjcnRjOworCXN0cnVjdCBpbnRlbF9jcnRj
X3N0YXRlICpuZXdfY3J0Y19zdGF0ZTsKKwlzdHJ1Y3QgaW50ZWxfYndfc3RhdGUgKm5ld19id19z
dGF0ZSAgPSBpbnRlbF9hdG9taWNfZ2V0X25ld19id19zdGF0ZShzdGF0ZSk7CisKKwlpZiAoSVNf
RVJSKG5ld19id19zdGF0ZSkpIHsKKwkJV0FSTigxLCAiQ291bGQgbm90IGdldCBid19zdGF0ZVxu
Iik7CisJCXJldHVybiBmYWxzZTsKKwl9CisKKwlpZiAoIWludGVsX2hhc19zYWd2KGRldl9wcml2
KSkgeworCQlEUk1fREVCVUdfS01TKCJObyBTQUdWIHN1cHBvcnQgZGV0ZWN0ZWRcbiIpOworCQly
ZXR1cm4gZmFsc2U7CisJfQorCisJLyoKKwkgKiBTaG91bGQgaGF2ZSB0aGlzIGNhbGN1bGF0ZWQg
YnkgdGhhdCB0aW1lLAorCSAqIG1lYW5zIHNvbWV0aGluZyBnb3QgY2hhbmdlZCBvciB3cm9uZyBp
biB0aGUgZHJpdmVyCisJICogY3VycmVudGx5LCBzdXBwb3NlZCBwbGFjZXMgd2hpY2ggY2FsbCB0
aGlzIGZ1bmN0aW9uIGFyZToKKwkgKiBpbnRlbF9hdG9taWNfY29tbWl0X3RhaWwsIGludGVsX2F0
b21pY19id19jaGVjaywKKwkgKiBza2xfYWxsb2NhdGVfcGlwZV9kZGIsIHNrbF93cml0ZV9wbGFu
ZV93bS4KKwkgKiBBbGwgb2YgdGhvc2UgYXJlIHN1cHBvc2VkIHRvIGJlIGNhbGxlZCBhZnRlcgor
CSAqIHNrbF9jb21wdXRlX3dtLT5pbnRlbF9jb21wdXRlX3NhZ3ZfbWFzayBpcyBjYWxsZWQuCisJ
ICovCisJZHJtX1dBUk5fT04oJmRldl9wcml2LT5kcm0sICFzdGF0ZS0+c2Fndl9jYWxjdWxhdGVk
KTsKKworCWZvcl9lYWNoX25ld19pbnRlbF9jcnRjX2luX3N0YXRlKHN0YXRlLCBjcnRjLCBuZXdf
Y3J0Y19zdGF0ZSwgaSkgeworCQl1MzIgbWFzayA9IEJJVChjcnRjLT5waXBlKTsKKwkJYm9vbCBz
dGF0ZV9zYWd2X21hc2tlZCA9IChtYXNrICYgbmV3X2J3X3N0YXRlLT5waXBlX3NhZ3ZfbWFzaykg
PT0gMDsKKworCQlpZiAoIW5ld19jcnRjX3N0YXRlLT5ody5hY3RpdmUpCisJCQljb250aW51ZTsK
KworCQlpZiAoc3RhdGVfc2Fndl9tYXNrZWQpCiAJCQlyZXR1cm4gZmFsc2U7CiAJfQogCiAJcmV0
dXJuIHRydWU7CiB9CiAKKy8qCisgKiBUbyBiZSB1c2VkIGFmdGVyIHdlIHN3YXAgc3RhdGUKKyAq
LworYm9vbCBpbnRlbF9jYW5fZW5hYmxlX3NhZ3Yoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRl
dl9wcml2KQoreworCWludCBpOworCXN0cnVjdCBpbnRlbF9nbG9iYWxfc3RhdGUgKmdsb2JhbF9z
dGF0ZTsKKwlzdHJ1Y3QgaW50ZWxfYndfc3RhdGUgKmJ3X3N0YXRlOworCisJZ2xvYmFsX3N0YXRl
ID0gZGV2X3ByaXYtPmJ3X29iai5zdGF0ZTsKKwlpZiAoSVNfRVJSKGdsb2JhbF9zdGF0ZSkpIHsK
KwkJV0FSTigxLCAiQ291bGQgbm90IGdldCBnbG9iYWwgc3RhdGVcbiIpOworCQlyZXR1cm4gZmFs
c2U7CisJfQorCisJYndfc3RhdGUgPSB0b19pbnRlbF9id19zdGF0ZShnbG9iYWxfc3RhdGUpOwor
CisJZm9yIChpID0gMDsgaSA8IEk5MTVfTUFYX1BJUEVTOyBpKyspIHsKKwkJaW50IGFjdGl2ZV9w
aXBlX2JpdCA9IGRldl9wcml2LT5hY3RpdmVfcGlwZXMgJiBCSVQoaSk7CisJCWlmIChhY3RpdmVf
cGlwZV9iaXQpIHsKKwkJCWlmICgoYndfc3RhdGUtPnBpcGVfc2Fndl9tYXNrICYgQklUKGkpKSA9
PSAwKQorCQkJCXJldHVybiBmYWxzZTsKKwkJfQorCX0KKworCXJldHVybiB0cnVlOworfQorCiBz
dGF0aWMgdTE2IGludGVsX2dldF9kZGJfc2l6ZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2
X3ByaXYsCiAJCQkgICAgICBjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0
ZSwKIAkJCSAgICAgIGNvbnN0IHU2NCB0b3RhbF9kYXRhX3JhdGUsCkBAIC0zOTYyLDYgKzQxMjUs
NyBAQCBza2xfY3Vyc29yX2FsbG9jYXRpb24oY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUg
KmNydGNfc3RhdGUsCiAJCXUzMiBsYXRlbmN5ID0gZGV2X3ByaXYtPndtLnNrbF9sYXRlbmN5W2xl
dmVsXTsKIAogCQlza2xfY29tcHV0ZV9wbGFuZV93bShjcnRjX3N0YXRlLCBsZXZlbCwgbGF0ZW5j
eSwgJndwLCAmd20sICZ3bSk7CisKIAkJaWYgKHdtLm1pbl9kZGJfYWxsb2MgPT0gVTE2X01BWCkK
IAkJCWJyZWFrOwogCkBAIC00MjMyLDEyICs0Mzk2LDkzIEBAIHNrbF9wbGFuZV93bV9sZXZlbChz
dHJ1Y3QgaW50ZWxfcGxhbmUgKnBsYW5lLAogCQkgICBpbnQgbGV2ZWwsCiAJCSAgIGludCBjb2xv
cl9wbGFuZSkKIHsKKwlzdHJ1Y3QgZHJtX2F0b21pY19zdGF0ZSAqc3RhdGUgPSBjcnRjX3N0YXRl
LT51YXBpLnN0YXRlOworCXN0cnVjdCBkcm1fY3J0YyAqY3J0YyA9IGNydGNfc3RhdGUtPnVhcGku
Y3J0YzsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGNydGMt
PmRldik7CiAJY29uc3Qgc3RydWN0IHNrbF9wbGFuZV93bSAqd20gPQogCQkmY3J0Y19zdGF0ZS0+
d20uc2tsLm9wdGltYWwucGxhbmVzW3BsYW5lLT5pZF07CiAKKwlpZiAoIWxldmVsKSB7CisJCWJv
b2wgY2FuX3NhZ3YgPSBmYWxzZTsKKworCQkvKgorCQkgKiBJZiB3ZSBoYXZlbid0IHlldCBzd2Fw
cGVkIG91ciBzdGF0ZSwgd2Ugc2hvdWxkIHVzZQorCQkgKiB0aGUgc3RhdGUgdG8gZGV0ZXJtaW5l
IFNBR1YsIG90aGVyd2lzZSB1c2UgZ2xvYmFsCisJCSAqIHN0YXRlIGFzIGF0b21pYyBzdGF0ZSBw
b2ludGVyIG1pZ2h0IGJlY29tZSBzdGFsZQorCQkgKiBhbmQgemVyb2VkIG91dC4KKwkJICovCisJ
CWlmIChzdGF0ZSkgeworCQkJc3RydWN0IGludGVsX2F0b21pY19zdGF0ZSAqaW50ZWxfc3RhdGUg
PQorCQkJCXRvX2ludGVsX2F0b21pY19zdGF0ZShzdGF0ZSk7CisJCQljYW5fc2FndiA9IGludGVs
X2Nhbl9lbmFibGVfc2Fndl9mb3Jfc3RhdGUoaW50ZWxfc3RhdGUpOworCQl9IGVsc2UgeworCQkJ
Y2FuX3NhZ3YgPSBpbnRlbF9jYW5fZW5hYmxlX3NhZ3YoZGV2X3ByaXYpOworCQl9CisKKwkJaWYg
KGNhbl9zYWd2KQorCQkJcmV0dXJuIGNvbG9yX3BsYW5lID8gJndtLT51dl9zYWd2X3dtMCA6ICZ3
bS0+c2Fndl93bTA7CisJfQorCiAJcmV0dXJuIGNvbG9yX3BsYW5lID8gJndtLT51dl93bVtsZXZl
bF0gOiAmd20tPndtW2xldmVsXTsKIH0KIAorc3RhdGljIGludAordGdsX2NoZWNrX3BpcGVfZml0
c19zYWd2X3dtKHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlLAorCQkJICAgIHN0
cnVjdCBza2xfZGRiX2FsbG9jYXRpb24gKmRkYiAvKiBvdXQgKi8pCit7CisJc3RydWN0IGRybV9j
cnRjICpjcnRjID0gY3J0Y19zdGF0ZS0+dWFwaS5jcnRjOworCXN0cnVjdCBkcm1faTkxNV9wcml2
YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoY3J0Yy0+ZGV2KTsKKwlzdHJ1Y3QgaW50ZWxfY3J0YyAq
aW50ZWxfY3J0YyA9IHRvX2ludGVsX2NydGMoY3J0Yyk7CisJc3RydWN0IHNrbF9kZGJfZW50cnkg
KmFsbG9jID0gJmNydGNfc3RhdGUtPndtLnNrbC5kZGI7CisJdTE2IGFsbG9jX3NpemU7CisJdTY0
IHRvdGFsX2RhdGFfcmF0ZTsKKwllbnVtIHBsYW5lX2lkIHBsYW5lX2lkOworCWludCBudW1fYWN0
aXZlOworCXU2NCBwbGFuZV9kYXRhX3JhdGVbSTkxNV9NQVhfUExBTkVTXSA9IHt9OworCXUzMiBi
bG9ja3M7CisKKwkvKgorCSAqIE5vIG5lZWQgdG8gY2hlY2sgZ2VuIGhlcmUsIHdlIGNhbGwgdGhp
cyBvbmx5IGZvciBnZW4xMgorCSAqLworCXRvdGFsX2RhdGFfcmF0ZSA9CisJCWljbF9nZXRfdG90
YWxfcmVsYXRpdmVfZGF0YV9yYXRlKGNydGNfc3RhdGUsCisJCQkJCQkgcGxhbmVfZGF0YV9yYXRl
KTsKKworCXNrbF9kZGJfZ2V0X3BpcGVfYWxsb2NhdGlvbl9saW1pdHMoZGV2X3ByaXYsIGNydGNf
c3RhdGUsCisJCQkJCSAgIHRvdGFsX2RhdGFfcmF0ZSwKKwkJCQkJICAgZGRiLCBhbGxvYywgJm51
bV9hY3RpdmUpOworCWFsbG9jX3NpemUgPSBza2xfZGRiX2VudHJ5X3NpemUoYWxsb2MpOworCWlm
IChhbGxvY19zaXplID09IDApCisJCXJldHVybiAtRU5PU1BDOworCisJLyoKKwkgKiBEbyBjaGVj
ayBpZiB3ZSBjYW4gZml0IEwwICsgc2Fndl9ibG9ja190aW1lIGFuZAorCSAqIGRpc2FibGUgU0FH
ViBpZiB3ZSBjYW4ndC4KKwkgKi8KKwlibG9ja3MgPSAwOworCWZvcl9lYWNoX3BsYW5lX2lkX29u
X2NydGMoaW50ZWxfY3J0YywgcGxhbmVfaWQpIHsKKwkJLyoKKwkJICogVGhlIG9ubHkgcGxhY2Us
IHdoZXJlIHdlIGNhbid0IHVzZSBza2xfcGxhbmVfd21fbGV2ZWwKKwkJICogYWNjZXNzb3IsIGJl
Y2F1c2UgaWYgYWN0dWFsbHkgY2FsbHMgaW50ZWxfY2FuX2VuYWJsZV9zYWd2CisJCSAqIHdoaWNo
IGRlcGVuZHMgb24gdGhhdCBmdW5jdGlvbi4KKwkJICovCisJCWNvbnN0IHN0cnVjdCBza2xfcGxh
bmVfd20gKndtID0KKwkJCSZjcnRjX3N0YXRlLT53bS5za2wub3B0aW1hbC5wbGFuZXNbcGxhbmVf
aWRdOworCisJCWJsb2NrcyArPSB3bS0+c2Fndl93bTAubWluX2RkYl9hbGxvYzsKKwkJYmxvY2tz
ICs9IHdtLT51dl9zYWd2X3dtMC5taW5fZGRiX2FsbG9jOworCisJCWlmIChibG9ja3MgPiBhbGxv
Y19zaXplKSB7CisJCQlEUk1fREVCVUdfS01TKCJOb3QgZW5vdWdoIGRkYiBibG9ja3MoJWQ8JWQp
IGZvciBTQUdWIG9uIHBpcGUgJWNcbiIsCisJCQkJICAgICAgYWxsb2Nfc2l6ZSwgYmxvY2tzLCBw
aXBlX25hbWUoaW50ZWxfY3J0Yy0+cGlwZSkpOworCQkJcmV0dXJuIC1FTk9TUEM7CisJCX0KKwl9
CisJRFJNX0RFQlVHX0tNUygiJWQgdG90YWwgYmxvY2tzIHJlcXVpcmVkIGZvciBTQUdWLCBkZGIg
ZW50cnkgc2l6ZSAlZFxuIiwKKwkJICAgICAgYmxvY2tzLCBhbGxvY19zaXplKTsKKwlyZXR1cm4g
MDsKK30KKwogc3RhdGljIGludAogc2tsX2FsbG9jYXRlX3BpcGVfZGRiKHN0cnVjdCBpbnRlbF9j
cnRjX3N0YXRlICpjcnRjX3N0YXRlLAogCQkgICAgICBzdHJ1Y3Qgc2tsX2RkYl9hbGxvY2F0aW9u
ICpkZGIgLyogb3V0ICovKQpAQCAtNDgyMiwxMSArNTA2NywxOSBAQCBzdGF0aWMgdm9pZCBza2xf
Y29tcHV0ZV9wbGFuZV93bShjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0
ZSwKIHN0YXRpYyB2b2lkCiBza2xfY29tcHV0ZV93bV9sZXZlbHMoY29uc3Qgc3RydWN0IGludGVs
X2NydGNfc3RhdGUgKmNydGNfc3RhdGUsCiAJCSAgICAgIGNvbnN0IHN0cnVjdCBza2xfd21fcGFy
YW1zICp3bV9wYXJhbXMsCi0JCSAgICAgIHN0cnVjdCBza2xfd21fbGV2ZWwgKmxldmVscykKKwkJ
ICAgICAgc3RydWN0IHNrbF9wbGFuZV93bSAqcGxhbmVfd20sCisJCSAgICAgIGJvb2wgeXV2KQog
ewogCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoY3J0Y19zdGF0
ZS0+dWFwaS5jcnRjLT5kZXYpOwogCWludCBsZXZlbCwgbWF4X2xldmVsID0gaWxrX3dtX21heF9s
ZXZlbChkZXZfcHJpdik7CisJLyoKKwkgKiBDaGVjayB3aGljaCBraW5kIG9mIHBsYW5lIGlzIGl0
IGFuZCBiYXNlZCBvbiB0aGF0IGNhbGN1bGF0ZQorCSAqIGNvcnJlc3BvbmRlbnQgV00gbGV2ZWxz
LgorCSAqLworCXN0cnVjdCBza2xfd21fbGV2ZWwgKmxldmVscyA9IHl1diA/IHBsYW5lX3dtLT51
dl93bSA6IHBsYW5lX3dtLT53bTsKIAlzdHJ1Y3Qgc2tsX3dtX2xldmVsICpyZXN1bHRfcHJldiA9
ICZsZXZlbHNbMF07CisJc3RydWN0IHNrbF93bV9sZXZlbCAqc2Fndl93bSA9IHl1diA/CisJCQkJ
JnBsYW5lX3dtLT51dl9zYWd2X3dtMCA6ICZwbGFuZV93bS0+c2Fndl93bTA7CiAKIAlmb3IgKGxl
dmVsID0gMDsgbGV2ZWwgPD0gbWF4X2xldmVsOyBsZXZlbCsrKSB7CiAJCXN0cnVjdCBza2xfd21f
bGV2ZWwgKnJlc3VsdCA9ICZsZXZlbHNbbGV2ZWxdOwpAQCAtNDgzNyw2ICs1MDkwLDI3IEBAIHNr
bF9jb21wdXRlX3dtX2xldmVscyhjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19z
dGF0ZSwKIAogCQlyZXN1bHRfcHJldiA9IHJlc3VsdDsKIAl9CisJLyoKKwkgKiBGb3IgR2VuMTIg
aWYgaXQgaXMgYW4gTDAgd2UgbmVlZCB0byBhbHNvCisJICogY29uc2lkZXIgc2Fndl9ibG9ja190
aW1lIHdoZW4gY2FsY3VsYXRpbmcKKwkgKiBMMCB3YXRlcm1hcmsgLSB3ZSB3aWxsIG5lZWQgdGhh
dCB3aGVuIG1ha2luZworCSAqIGEgZGVjaXNpb24gd2hldGhlciBlbmFibGUgU0FHViBvciBub3Qu
CisJICogRm9yIG9sZGVyIGdlbnMgd2UgYWdyZWVkIHRvIGNvcHkgTDAgdmFsdWUgZm9yCisJICog
Y29tcGF0aWJpbGl0eS4KKwkgKi8KKwlpZiAoKElOVEVMX0dFTihkZXZfcHJpdikgPj0gMTIpKSB7
CisJCXUzMiBsYXRlbmN5ID0gZGV2X3ByaXYtPndtLnNrbF9sYXRlbmN5WzBdOworCisJCWxhdGVu
Y3kgKz0gZGV2X3ByaXYtPnNhZ3ZfYmxvY2tfdGltZV91czsKKwkJc2tsX2NvbXB1dGVfcGxhbmVf
d20oY3J0Y19zdGF0ZSwgMCwgbGF0ZW5jeSwKKwkJCQkgICAgIHdtX3BhcmFtcywgJmxldmVsc1sw
XSwKKwkJCQkgICAgIHNhZ3Zfd20pOworCQlEUk1fREVCVUdfS01TKCIlZCBMMCBibG9ja3MgcmVx
dWlyZWQgZm9yIFNBR1YgdnMgJWQgZm9yIG5vbi1TQUdWXG4iLAorCQkJICAgICAgc2Fndl93bS0+
bWluX2RkYl9hbGxvYywgbGV2ZWxzWzBdLm1pbl9kZGJfYWxsb2MpOworCX0gZWxzZSB7CisJCS8q
IFNpbmNlIGFsbCBtZW1iZXJzIGFyZSBQT0QgKi8KKwkJKnNhZ3Zfd20gPSBsZXZlbHNbMF07CisJ
fQogfQogCiBzdGF0aWMgdm9pZCBza2xfY29tcHV0ZV90cmFuc2l0aW9uX3dtKGNvbnN0IHN0cnVj
dCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlLApAQCAtNDkxMSw3ICs1MTg1LDcgQEAgc3Rh
dGljIGludCBza2xfYnVpbGRfcGxhbmVfd21fc2luZ2xlKHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRl
ICpjcnRjX3N0YXRlLAogCWlmIChyZXQpCiAJCXJldHVybiByZXQ7CiAKLQlza2xfY29tcHV0ZV93
bV9sZXZlbHMoY3J0Y19zdGF0ZSwgJndtX3BhcmFtcywgd20tPndtKTsKKwlza2xfY29tcHV0ZV93
bV9sZXZlbHMoY3J0Y19zdGF0ZSwgJndtX3BhcmFtcywgd20sIGZhbHNlKTsKIAlza2xfY29tcHV0
ZV90cmFuc2l0aW9uX3dtKGNydGNfc3RhdGUsICZ3bV9wYXJhbXMsIHdtKTsKIAogCXJldHVybiAw
OwpAQCAtNDkzMyw3ICs1MjA3LDcgQEAgc3RhdGljIGludCBza2xfYnVpbGRfcGxhbmVfd21fdXYo
c3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUsCiAJaWYgKHJldCkKIAkJcmV0dXJu
IHJldDsKIAotCXNrbF9jb21wdXRlX3dtX2xldmVscyhjcnRjX3N0YXRlLCAmd21fcGFyYW1zLCB3
bS0+dXZfd20pOworCXNrbF9jb21wdXRlX3dtX2xldmVscyhjcnRjX3N0YXRlLCAmd21fcGFyYW1z
LCB3bSwgdHJ1ZSk7CiAKIAlyZXR1cm4gMDsKIH0KQEAgLTUyNjUsMTAgKzU1MzksMjkgQEAgc2ts
X3ByaW50X3dtX2NoYW5nZXMoc3RydWN0IGludGVsX2F0b21pY19zdGF0ZSAqc3RhdGUpCiAJCWZv
cl9lYWNoX2ludGVsX3BsYW5lX29uX2NydGMoJmRldl9wcml2LT5kcm0sIGNydGMsIHBsYW5lKSB7
CiAJCQllbnVtIHBsYW5lX2lkIHBsYW5lX2lkID0gcGxhbmUtPmlkOwogCQkJY29uc3Qgc3RydWN0
IHNrbF9wbGFuZV93bSAqb2xkX3dtLCAqbmV3X3dtOworCQkJdTE2IG9sZF9wbGFuZV9yZXNfbCwg
bmV3X3BsYW5lX3Jlc19sOworCQkJdTggIG9sZF9wbGFuZV9yZXNfYiwgbmV3X3BsYW5lX3Jlc19i
OworCQkJdTE2IG9sZF9taW5fZGRiX2FsbG9jLCBuZXdfbWluX2RkYl9hbGxvYzsKIAogCQkJb2xk
X3dtID0gJm9sZF9waXBlX3dtLT5wbGFuZXNbcGxhbmVfaWRdOwogCQkJbmV3X3dtID0gJm5ld19w
aXBlX3dtLT5wbGFuZXNbcGxhbmVfaWRdOwogCisJCQlvbGRfcGxhbmVfcmVzX2wgPSBpbnRlbF9j
YW5fZW5hYmxlX3NhZ3YoZGV2X3ByaXYpID8KKwkJCQkJICBvbGRfd20tPnNhZ3Zfd20wLnBsYW5l
X3Jlc19sIDogb2xkX3dtLT53bVswXS5wbGFuZV9yZXNfbDsKKwkJCW9sZF9wbGFuZV9yZXNfYiA9
IGludGVsX2Nhbl9lbmFibGVfc2FndihkZXZfcHJpdikgPworCQkJCQkgIG9sZF93bS0+c2Fndl93
bTAucGxhbmVfcmVzX2IgOiBvbGRfd20tPndtWzBdLnBsYW5lX3Jlc19iOworCisJCQluZXdfcGxh
bmVfcmVzX2wgPSBpbnRlbF9jYW5fZW5hYmxlX3NhZ3ZfZm9yX3N0YXRlKHN0YXRlKSA/CisJCQkJ
CSAgbmV3X3dtLT5zYWd2X3dtMC5wbGFuZV9yZXNfbCA6IG5ld193bS0+d21bMF0ucGxhbmVfcmVz
X2w7CisJCQluZXdfcGxhbmVfcmVzX2IgPSBpbnRlbF9jYW5fZW5hYmxlX3NhZ3ZfZm9yX3N0YXRl
KHN0YXRlKSA/CisJCQkJCSAgbmV3X3dtLT5zYWd2X3dtMC5wbGFuZV9yZXNfYiA6IG5ld193bS0+
d21bMF0ucGxhbmVfcmVzX2I7CisKKwkJCW9sZF9taW5fZGRiX2FsbG9jID0gaW50ZWxfY2FuX2Vu
YWJsZV9zYWd2KGRldl9wcml2KSA/CisJCQkJCSAgICBvbGRfd20tPnNhZ3Zfd20wLm1pbl9kZGJf
YWxsb2MgOiBvbGRfd20tPndtWzBdLm1pbl9kZGJfYWxsb2M7CisKKwkJCW5ld19taW5fZGRiX2Fs
bG9jID0gaW50ZWxfY2FuX2VuYWJsZV9zYWd2X2Zvcl9zdGF0ZShzdGF0ZSkgPworCQkJCQkgICAg
bmV3X3dtLT5zYWd2X3dtMC5taW5fZGRiX2FsbG9jIDogbmV3X3dtLT53bVswXS5taW5fZGRiX2Fs
bG9jOworCiAJCQlpZiAoc2tsX3BsYW5lX3dtX2VxdWFscyhkZXZfcHJpdiwgb2xkX3dtLCBuZXdf
d20pKQogCQkJCWNvbnRpbnVlOwogCkBAIC01MjkxLDcgKzU1ODQsNyBAQCBza2xfcHJpbnRfd21f
Y2hhbmdlcyhzdHJ1Y3QgaW50ZWxfYXRvbWljX3N0YXRlICpzdGF0ZSkKIAkJCQkgICAgIltQTEFO
RTolZDolc10gICBsaW5lcyAlYyUzZCwlYyUzZCwlYyUzZCwlYyUzZCwlYyUzZCwlYyUzZCwlYyUz
ZCwlYyUzZCwlYyUzZCIKIAkJCQkgICAgICAiIC0+ICVjJTNkLCVjJTNkLCVjJTNkLCVjJTNkLCVj
JTNkLCVjJTNkLCVjJTNkLCVjJTNkLCVjJTNkXG4iLAogCQkJCSAgICBwbGFuZS0+YmFzZS5iYXNl
LmlkLCBwbGFuZS0+YmFzZS5uYW1lLAotCQkJCSAgICBlbmFzdChvbGRfd20tPndtWzBdLmlnbm9y
ZV9saW5lcyksIG9sZF93bS0+d21bMF0ucGxhbmVfcmVzX2wsCisJCQkJICAgIGVuYXN0KG9sZF93
bS0+d21bMF0uaWdub3JlX2xpbmVzKSwgb2xkX3BsYW5lX3Jlc19sLAogCQkJCSAgICBlbmFzdChv
bGRfd20tPndtWzFdLmlnbm9yZV9saW5lcyksIG9sZF93bS0+d21bMV0ucGxhbmVfcmVzX2wsCiAJ
CQkJICAgIGVuYXN0KG9sZF93bS0+d21bMl0uaWdub3JlX2xpbmVzKSwgb2xkX3dtLT53bVsyXS5w
bGFuZV9yZXNfbCwKIAkJCQkgICAgZW5hc3Qob2xkX3dtLT53bVszXS5pZ25vcmVfbGluZXMpLCBv
bGRfd20tPndtWzNdLnBsYW5lX3Jlc19sLApAQCAtNTMwMSw3ICs1NTk0LDcgQEAgc2tsX3ByaW50
X3dtX2NoYW5nZXMoc3RydWN0IGludGVsX2F0b21pY19zdGF0ZSAqc3RhdGUpCiAJCQkJICAgIGVu
YXN0KG9sZF93bS0+d21bN10uaWdub3JlX2xpbmVzKSwgb2xkX3dtLT53bVs3XS5wbGFuZV9yZXNf
bCwKIAkJCQkgICAgZW5hc3Qob2xkX3dtLT50cmFuc193bS5pZ25vcmVfbGluZXMpLCBvbGRfd20t
PnRyYW5zX3dtLnBsYW5lX3Jlc19sLAogCi0JCQkJICAgIGVuYXN0KG5ld193bS0+d21bMF0uaWdu
b3JlX2xpbmVzKSwgbmV3X3dtLT53bVswXS5wbGFuZV9yZXNfbCwKKwkJCQkgICAgZW5hc3QobmV3
X3dtLT53bVswXS5pZ25vcmVfbGluZXMpLCBuZXdfcGxhbmVfcmVzX2wsCiAJCQkJICAgIGVuYXN0
KG5ld193bS0+d21bMV0uaWdub3JlX2xpbmVzKSwgbmV3X3dtLT53bVsxXS5wbGFuZV9yZXNfbCwK
IAkJCQkgICAgZW5hc3QobmV3X3dtLT53bVsyXS5pZ25vcmVfbGluZXMpLCBuZXdfd20tPndtWzJd
LnBsYW5lX3Jlc19sLAogCQkJCSAgICBlbmFzdChuZXdfd20tPndtWzNdLmlnbm9yZV9saW5lcyks
IG5ld193bS0+d21bM10ucGxhbmVfcmVzX2wsCkBAIC01MzE1LDEyICs1NjA4LDEyIEBAIHNrbF9w
cmludF93bV9jaGFuZ2VzKHN0cnVjdCBpbnRlbF9hdG9taWNfc3RhdGUgKnN0YXRlKQogCQkJCSAg
ICAiW1BMQU5FOiVkOiVzXSAgYmxvY2tzICU0ZCwlNGQsJTRkLCU0ZCwlNGQsJTRkLCU0ZCwlNGQs
JTRkIgogCQkJCSAgICAiIC0+ICU0ZCwlNGQsJTRkLCU0ZCwlNGQsJTRkLCU0ZCwlNGQsJTRkXG4i
LAogCQkJCSAgICBwbGFuZS0+YmFzZS5iYXNlLmlkLCBwbGFuZS0+YmFzZS5uYW1lLAotCQkJCSAg
ICBvbGRfd20tPndtWzBdLnBsYW5lX3Jlc19iLCBvbGRfd20tPndtWzFdLnBsYW5lX3Jlc19iLAor
CQkJCSAgICBvbGRfcGxhbmVfcmVzX2IsIG9sZF93bS0+d21bMV0ucGxhbmVfcmVzX2IsCiAJCQkJ
ICAgIG9sZF93bS0+d21bMl0ucGxhbmVfcmVzX2IsIG9sZF93bS0+d21bM10ucGxhbmVfcmVzX2Is
CiAJCQkJICAgIG9sZF93bS0+d21bNF0ucGxhbmVfcmVzX2IsIG9sZF93bS0+d21bNV0ucGxhbmVf
cmVzX2IsCiAJCQkJICAgIG9sZF93bS0+d21bNl0ucGxhbmVfcmVzX2IsIG9sZF93bS0+d21bN10u
cGxhbmVfcmVzX2IsCiAJCQkJICAgIG9sZF93bS0+dHJhbnNfd20ucGxhbmVfcmVzX2IsCi0JCQkJ
ICAgIG5ld193bS0+d21bMF0ucGxhbmVfcmVzX2IsIG5ld193bS0+d21bMV0ucGxhbmVfcmVzX2Is
CisJCQkJICAgIG5ld19wbGFuZV9yZXNfYiwgbmV3X3dtLT53bVsxXS5wbGFuZV9yZXNfYiwKIAkJ
CQkgICAgbmV3X3dtLT53bVsyXS5wbGFuZV9yZXNfYiwgbmV3X3dtLT53bVszXS5wbGFuZV9yZXNf
YiwKIAkJCQkgICAgbmV3X3dtLT53bVs0XS5wbGFuZV9yZXNfYiwgbmV3X3dtLT53bVs1XS5wbGFu
ZV9yZXNfYiwKIAkJCQkgICAgbmV3X3dtLT53bVs2XS5wbGFuZV9yZXNfYiwgbmV3X3dtLT53bVs3
XS5wbGFuZV9yZXNfYiwKQEAgLTUzMzAsMTIgKzU2MjMsMTIgQEAgc2tsX3ByaW50X3dtX2NoYW5n
ZXMoc3RydWN0IGludGVsX2F0b21pY19zdGF0ZSAqc3RhdGUpCiAJCQkJICAgICJbUExBTkU6JWQ6
JXNdIG1pbl9kZGIgJTRkLCU0ZCwlNGQsJTRkLCU0ZCwlNGQsJTRkLCU0ZCwlNGQiCiAJCQkJICAg
ICIgLT4gJTRkLCU0ZCwlNGQsJTRkLCU0ZCwlNGQsJTRkLCU0ZCwlNGRcbiIsCiAJCQkJICAgIHBs
YW5lLT5iYXNlLmJhc2UuaWQsIHBsYW5lLT5iYXNlLm5hbWUsCi0JCQkJICAgIG9sZF93bS0+d21b
MF0ubWluX2RkYl9hbGxvYywgb2xkX3dtLT53bVsxXS5taW5fZGRiX2FsbG9jLAorCQkJCSAgICBv
bGRfbWluX2RkYl9hbGxvYywgb2xkX3dtLT53bVsxXS5taW5fZGRiX2FsbG9jLAogCQkJCSAgICBv
bGRfd20tPndtWzJdLm1pbl9kZGJfYWxsb2MsIG9sZF93bS0+d21bM10ubWluX2RkYl9hbGxvYywK
IAkJCQkgICAgb2xkX3dtLT53bVs0XS5taW5fZGRiX2FsbG9jLCBvbGRfd20tPndtWzVdLm1pbl9k
ZGJfYWxsb2MsCiAJCQkJICAgIG9sZF93bS0+d21bNl0ubWluX2RkYl9hbGxvYywgb2xkX3dtLT53
bVs3XS5taW5fZGRiX2FsbG9jLAogCQkJCSAgICBvbGRfd20tPnRyYW5zX3dtLm1pbl9kZGJfYWxs
b2MsCi0JCQkJICAgIG5ld193bS0+d21bMF0ubWluX2RkYl9hbGxvYywgbmV3X3dtLT53bVsxXS5t
aW5fZGRiX2FsbG9jLAorCQkJCSAgICBuZXdfbWluX2RkYl9hbGxvYywgbmV3X3dtLT53bVsxXS5t
aW5fZGRiX2FsbG9jLAogCQkJCSAgICBuZXdfd20tPndtWzJdLm1pbl9kZGJfYWxsb2MsIG5ld193
bS0+d21bM10ubWluX2RkYl9hbGxvYywKIAkJCQkgICAgbmV3X3dtLT53bVs0XS5taW5fZGRiX2Fs
bG9jLCBuZXdfd20tPndtWzVdLm1pbl9kZGJfYWxsb2MsCiAJCQkJICAgIG5ld193bS0+d21bNl0u
bWluX2RkYl9hbGxvYywgbmV3X3dtLT53bVs3XS5taW5fZGRiX2FsbG9jLApAQCAtNTQ3Miw2ICs1
NzY1LDU5IEBAIHN0YXRpYyBpbnQgc2tsX3dtX2FkZF9hZmZlY3RlZF9wbGFuZXMoc3RydWN0IGlu
dGVsX2F0b21pY19zdGF0ZSAqc3RhdGUsCiAJcmV0dXJuIDA7CiB9CiAKK3N0YXRpYyB2b2lkIHRn
bF9jb21wdXRlX3NhZ3ZfbWFzayhzdHJ1Y3QgaW50ZWxfYXRvbWljX3N0YXRlICpzdGF0ZSkKK3sK
KwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KHN0YXRlLT5iYXNl
LmRldik7CisJc3RydWN0IGludGVsX2NydGMgKmNydGM7CisJc3RydWN0IGludGVsX2NydGNfc3Rh
dGUgKm5ld19jcnRjX3N0YXRlOworCXN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpvbGRfY3J0Y19z
dGF0ZTsKKwlzdHJ1Y3Qgc2tsX2RkYl9hbGxvY2F0aW9uICpkZGIgPSAmc3RhdGUtPndtX3Jlc3Vs
dHMuZGRiOworCWludCByZXQ7CisJaW50IGk7CisJc3RydWN0IGludGVsX3BsYW5lICpwbGFuZTsK
KwlzdHJ1Y3QgaW50ZWxfYndfc3RhdGUgKm5ld19id19zdGF0ZSAgPSBpbnRlbF9hdG9taWNfZ2V0
X25ld19id19zdGF0ZShzdGF0ZSk7CisKKwlpZiAoSVNfRVJSKG5ld19id19zdGF0ZSkpIHsKKwkJ
V0FSTigxLCAiQ291bGQgbm90IGdldCBid19zdGF0ZVxuIik7CisJCXJldHVybjsKKwl9CisKKwlm
b3JfZWFjaF9vbGRuZXdfaW50ZWxfY3J0Y19pbl9zdGF0ZShzdGF0ZSwgY3J0Yywgb2xkX2NydGNf
c3RhdGUsCisJCQkJCSAgICBuZXdfY3J0Y19zdGF0ZSwgaSkgeworCQlpbnQgcGlwZV9iaXQgPSBC
SVQoY3J0Yy0+cGlwZSk7CisJCWJvb2wgc2tpcCA9IHRydWU7CisKKwkJLyoKKwkJICogSWYgd2Ug
aGFkIHNldCB0aGlzIG1hc3QgYWxyZWFkeSBvbmNlIGZvciB0aGlzIHN0YXRlLAorCQkgKiBubyBu
ZWVkIHRvIHdhc3RlIENQVSBjeWNsZXMgZm9yIGRvaW5nIHRoaXMgYWdhaW4uCisJCSAqLworCQlm
b3JfZWFjaF9pbnRlbF9wbGFuZV9vbl9jcnRjKCZkZXZfcHJpdi0+ZHJtLCBjcnRjLCBwbGFuZSkg
eworCQkJZW51bSBwbGFuZV9pZCBwbGFuZV9pZCA9IHBsYW5lLT5pZDsKKworCQkJaWYgKCFza2xf
cGxhbmVfd21fZXF1YWxzKGRldl9wcml2LAorCQkJCQkJICZvbGRfY3J0Y19zdGF0ZS0+d20uc2ts
Lm9wdGltYWwucGxhbmVzW3BsYW5lX2lkXSwKKwkJCQkJCSAmbmV3X2NydGNfc3RhdGUtPndtLnNr
bC5vcHRpbWFsLnBsYW5lc1twbGFuZV9pZF0pKSB7CisJCQkJc2tpcCA9IGZhbHNlOworCQkJCWJy
ZWFrOworCQkJfQorCQl9CisKKwkJLyoKKwkJICogQ2hlY2sgaWYgd20gbGV2ZWxzIGFyZSBhY3R1
YWxseSB0aGUgc2FtZSBhcyBmb3IgcHJldmlvdXMKKwkJICogc3RhdGUsIHdoaWNoIG1lYW5zIHdl
IGNhbiBqdXN0IHNraXAgZG9pbmcgdGhpcyBsb25nIGNoZWNrCisJCSAqIGFuZCBqdXN0ICBjb3B5
IGNvcnJlc3BvbmRlbnQgYml0IGZyb20gcHJldmlvdXMgc3RhdGUuCisJCSAqLworCQlpZiAoc2tp
cCkKKwkJCWNvbnRpbnVlOworCisJCXJldCA9IHRnbF9jaGVja19waXBlX2ZpdHNfc2Fndl93bShu
ZXdfY3J0Y19zdGF0ZSwgZGRiKTsKKwkJaWYgKCFyZXQpCisJCQluZXdfYndfc3RhdGUtPnBpcGVf
c2Fndl9tYXNrIHw9IHBpcGVfYml0OworCQllbHNlCisJCQluZXdfYndfc3RhdGUtPnBpcGVfc2Fn
dl9tYXNrICY9IH5waXBlX2JpdDsKKwl9Cit9CisKIHN0YXRpYyBpbnQKIHNrbF9jb21wdXRlX3dt
KHN0cnVjdCBpbnRlbF9hdG9taWNfc3RhdGUgKnN0YXRlKQogewpAQCAtNTQ3OSw2ICs1ODI1LDEz
IEBAIHNrbF9jb21wdXRlX3dtKHN0cnVjdCBpbnRlbF9hdG9taWNfc3RhdGUgKnN0YXRlKQogCXN0
cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpuZXdfY3J0Y19zdGF0ZTsKIAlzdHJ1Y3QgaW50ZWxfY3J0
Y19zdGF0ZSAqb2xkX2NydGNfc3RhdGU7CiAJaW50IHJldCwgaTsKKwlzdHJ1Y3QgaW50ZWxfYndf
c3RhdGUgKm5ld19id19zdGF0ZSAgPSBpbnRlbF9hdG9taWNfZ2V0X25ld19id19zdGF0ZShzdGF0
ZSk7CisKKwlpZiAoSVNfRVJSKG5ld19id19zdGF0ZSkpCisJCXJldHVybiBQVFJfRVJSKG5ld19i
d19zdGF0ZSk7CisKKwkvKiBObyBTQUdWIGZvciB0aGlzIHN0YXRlLCB1bnRpbCB3ZSBjaGVjayBp
ZiBpdCdzIHBvc3NpYmxlICovCisJbmV3X2J3X3N0YXRlLT5waXBlX3NhZ3ZfbWFzayA9IDA7CiAK
IAlyZXQgPSBza2xfZGRiX2FkZF9hZmZlY3RlZF9waXBlcyhzdGF0ZSk7CiAJaWYgKHJldCkKQEAg
LTU1MDAsNiArNTg1MywxMiBAQCBza2xfY29tcHV0ZV93bShzdHJ1Y3QgaW50ZWxfYXRvbWljX3N0
YXRlICpzdGF0ZSkKIAkJCXJldHVybiByZXQ7CiAJfQogCisJLyoKKwkgKiBOb3cgb25jZSB3ZSBn
b3Qgd20gbGV2ZWxzIGNhbGN1bGF0ZWQsCisJICogY2hlY2sgaWYgd2UgY2FuIGhhdmUgU0FHVi4K
KwkgKi8KKwlpbnRlbF9jb21wdXRlX3NhZ3ZfbWFzayhzdGF0ZSk7CisKIAlyZXQgPSBza2xfY29t
cHV0ZV9kZGIoc3RhdGUpOwogCWlmIChyZXQpCiAJCXJldHVybiByZXQ7CkBAIC01NjE5LDYgKzU5
NzgsOSBAQCB2b2lkIHNrbF9waXBlX3dtX2dldF9od19zdGF0ZShzdHJ1Y3QgaW50ZWxfY3J0YyAq
Y3J0YywKIAkJCQl2YWwgPSBJOTE1X1JFQUQoQ1VSX1dNKHBpcGUsIGxldmVsKSk7CiAKIAkJCXNr
bF93bV9sZXZlbF9mcm9tX3JlZ192YWwodmFsLCAmd20tPndtW2xldmVsXSk7CisJCQlpZiAobGV2
ZWwgPT0gMCkKKwkJCQltZW1jcHkoJndtLT5zYWd2X3dtMCwgJndtLT53bVtsZXZlbF0sCisJCQkJ
ICAgICAgIHNpemVvZihzdHJ1Y3Qgc2tsX3dtX2xldmVsKSk7CiAJCX0KIAogCQlpZiAocGxhbmVf
aWQgIT0gUExBTkVfQ1VSU09SKQpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50
ZWxfcG0uaCBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2ludGVsX3BtLmgKaW5kZXggYzA2YzZhODQ2
ZDlhLi45ZmIyNTkyZDY3YjUgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2ludGVs
X3BtLmgKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50ZWxfcG0uaApAQCAtNDIsNyArNDIs
OSBAQCB2b2lkIHNrbF9waXBlX3dtX2dldF9od19zdGF0ZShzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0
YywKIAkJCSAgICAgIHN0cnVjdCBza2xfcGlwZV93bSAqb3V0KTsKIHZvaWQgZzR4X3dtX3Nhbml0
aXplKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdik7CiB2b2lkIHZsdl93bV9zYW5p
dGl6ZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpOwotYm9vbCBpbnRlbF9jYW5f
ZW5hYmxlX3NhZ3Yoc3RydWN0IGludGVsX2F0b21pY19zdGF0ZSAqc3RhdGUpOworYm9vbCBpbnRl
bF9jYW5fZW5hYmxlX3NhZ3Yoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KTsKK2Jv
b2wgaW50ZWxfY2FuX2VuYWJsZV9zYWd2X2Zvcl9zdGF0ZShzdHJ1Y3QgaW50ZWxfYXRvbWljX3N0
YXRlICpzdGF0ZSk7Citib29sIGludGVsX2hhc19zYWd2KHN0cnVjdCBkcm1faTkxNV9wcml2YXRl
ICpkZXZfcHJpdik7CiBpbnQgaW50ZWxfZW5hYmxlX3NhZ3Yoc3RydWN0IGRybV9pOTE1X3ByaXZh
dGUgKmRldl9wcml2KTsKIGludCBpbnRlbF9kaXNhYmxlX3NhZ3Yoc3RydWN0IGRybV9pOTE1X3By
aXZhdGUgKmRldl9wcml2KTsKIGJvb2wgc2tsX3dtX2xldmVsX2VxdWFscyhjb25zdCBzdHJ1Y3Qg
c2tsX3dtX2xldmVsICpsMSwKLS0gCjIuMjQuMS40ODUuZ2FkMDVhM2Q4ZTUKCl9fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fCkludGVsLWdmeCBtYWlsaW5nIGxp
c3QKSW50ZWwtZ2Z4QGxpc3RzLmZyZWVkZXNrdG9wLm9yZwpodHRwczovL2xpc3RzLmZyZWVkZXNr
dG9wLm9yZy9tYWlsbWFuL2xpc3RpbmZvL2ludGVsLWdmeAo=

Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id E67309CA0B
	for <lists+intel-gfx@lfdr.de>; Mon, 26 Aug 2019 09:22:23 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id EDB8C6E1BA;
	Mon, 26 Aug 2019 07:22:20 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from fireflyinternet.com (mail.fireflyinternet.com [109.228.58.192])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 217296E194
 for <intel-gfx@lists.freedesktop.org>; Mon, 26 Aug 2019 07:22:13 +0000 (UTC)
X-Default-Received-SPF: pass (skip=forwardok (res=PASS))
 x-ip-name=78.156.65.138; 
Received: from haswell.alporthouse.com (unverified [78.156.65.138]) 
 by fireflyinternet.com (Firefly Internet (M1)) with ESMTP id 18262696-1500050 
 for multiple; Mon, 26 Aug 2019 08:21:55 +0100
From: Chris Wilson <chris@chris-wilson.co.uk>
To: intel-gfx@lists.freedesktop.org
Date: Mon, 26 Aug 2019 08:21:42 +0100
Message-Id: <20190826072149.9447-21-chris@chris-wilson.co.uk>
X-Mailer: git-send-email 2.23.0
In-Reply-To: <20190826072149.9447-1-chris@chris-wilson.co.uk>
References: <20190826072149.9447-1-chris@chris-wilson.co.uk>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH 21/28] drm/i915: Serialise the fill BLT with the
 vma pinning
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Cc: Matthew Auld <matthew.auld@intel.com>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

TWFrZSBzdXJlIHRoYXQgd2Ugd2FpdCBmb3IgdGhlIHZtYSB0byBiZSBwaW5uZWQgcHJpb3IgdG8g
dGVsbGluZyB0aGUgR1BVCnRvIGZpbGwgdGhlIHBhZ2VzIHRocm91Z2ggdGhhdCB2bWEuCgpIb3dl
dmVyLCBzaW5jZSBvdXIgYXN5bmMgb3BlcmF0aW9ucyBmaWdodCBvdmVyIG9iai0+cmVzdi0+ZXhj
bF9mZW5jZSB3ZQptdXN0IG1hbnVhbGx5IG9yZGVyIHRoZW0uIFRoaXMgbWFrZXMgaXQgbXVjaCBt
b3JlIGZyYWdpbGUsIGFuZCBnaXZlcyBhbgpvdXRzaWRlIG9ic2VydmVyIHRoZSBjaGFuY2UgdG8g
c2VlIHRoZSBpbnRlcm1lZGlhdGUgZmVuY2VzLiBUbyBiZQpkaXNjdXNzZWQhCgpTaWduZWQtb2Zm
LWJ5OiBDaHJpcyBXaWxzb24gPGNocmlzQGNocmlzLXdpbHNvbi5jby51az4KQ2M6IE1hdHRoZXcg
QXVsZCA8bWF0dGhldy5hdWxkQGludGVsLmNvbT4KUmV2aWV3ZWQtYnk6IE1hdHRoZXcgQXVsZCA8
bWF0dGhldy5hdWxkQGludGVsLmNvbT4KLS0tCiAuLi4vZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dl
bV9jbGllbnRfYmx0LmMgICAgfCA0NiArKysrKysrKysrKysrKy0tLS0tCiBkcml2ZXJzL2dwdS9k
cm0vaTkxNS9ndC9pbnRlbF9yaW5nYnVmZmVyLmMgICAgfCAgMyArLQogMiBmaWxlcyBjaGFuZ2Vk
LCAzNiBpbnNlcnRpb25zKCspLCAxMyBkZWxldGlvbnMoLSkKCmRpZmYgLS1naXQgYS9kcml2ZXJz
L2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fY2xpZW50X2JsdC5jIGIvZHJpdmVycy9ncHUvZHJt
L2k5MTUvZ2VtL2k5MTVfZ2VtX2NsaWVudF9ibHQuYwppbmRleCAzNTAyMDcxZTEzOTEuLmJiYmMx
MDQ5OTA5OSAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX2Ns
aWVudF9ibHQuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fY2xpZW50
X2JsdC5jCkBAIC03MSwxMCArNzEsMzAgQEAgc3RhdGljIHN0cnVjdCBpOTE1X3NsZWV2ZSAqY3Jl
YXRlX3NsZWV2ZShzdHJ1Y3QgaTkxNV9hZGRyZXNzX3NwYWNlICp2bSwKIAkJZ290byBlcnJfZnJl
ZTsKIAl9CiAKKwkvKgorCSAqIFhYWCBmaXggc2NoZWR1bGluZyB3aXRoIGdldF9wYWdlcyAmIGNs
ZWFyIHdvcmtlcnMKKwkgKgorCSAqIFRoZSBjb21wbGljYXRpb24gaXMgdGhhdCB3ZSBlbmQgdXAg
b3ZlcndyaXRpbmcgdGhlIHNhbWUKKwkgKiBvYmotPnJlc3YtPmV4Y2xfZmVuY2UgZm9yIGVhY2gg
c3RhZ2Ugb2YgdGhlIG9wZXJhdGlvbi4gVGhhdCBmZW5jZQorCSAqIHNob3VsZCBiZSBzZXQgb24g
c2NoZWR1bGluZyB0aGUgd29yaywgYW5kIG9ubHkgc2lnbmFsZWQgdXBvbgorCSAqIGNvbXBsZXRp
b24gb2YgdGhlIGVudGlyZSB3b3JrcXVldWUuCisJICoKKwkgKiBXaXRoaW4gdGhlIHdvcmtxdWV1
ZSwgd2UgdXNlIHRoZSBmZW5jZSB0byBzY2hlZHVsZSBlYWNoIGluZGl2aWR1YWwKKwkgKiB0YXNr
LiBFYWNoIGluZGl2aWR1YWwgdGFzayBrbm93cyB0byB1c2Ugb2JqLT5yZXN2LT5mZW5jZS4KKwkg
KgorCSAqIFRvIGFuIG91dHNpZGVyLCB0aGV5IG11c3Qgd2FpdCB1bnRpbCB0aGUgZW5kIGFuZCBz
byB0aGUKKwkgKiBvYmotPnJlc3YtPmZlbmNlIG11c3QgYmUgdGhlIGNvbXBvc2l0ZS4KKwkgKgor
CSAqIElkZWFzPworCSAqLworCWVyciA9IGk5MTVfdm1hX3Bpbih2bWEsIDAsIDAsIFBJTl9VU0VS
KTsKKwlpZiAodW5saWtlbHkoZXJyKSkKKwkJZ290byBlcnJfZnJlZTsKKwogCXZtYS0+cHJpdmF0
ZSA9IHNsZWV2ZTsKIAl2bWEtPm9wcyA9ICZwcm94eV92bWFfb3BzOwogCi0Jc2xlZXZlLT52bWEg
PSB2bWE7CisJc2xlZXZlLT52bWEgPSBpOTE1X3ZtYV9nZXQodm1hKTsKIAlzbGVldmUtPnBhZ2Vz
ID0gcGFnZXM7CiAJc2xlZXZlLT5wYWdlX3NpemVzID0gKnBhZ2Vfc2l6ZXM7CiAKQEAgLTg3LDYg
KzEwNywxMyBAQCBzdGF0aWMgc3RydWN0IGk5MTVfc2xlZXZlICpjcmVhdGVfc2xlZXZlKHN0cnVj
dCBpOTE1X2FkZHJlc3Nfc3BhY2UgKnZtLAogCiBzdGF0aWMgdm9pZCBkZXN0cm95X3NsZWV2ZShz
dHJ1Y3QgaTkxNV9zbGVldmUgKnNsZWV2ZSkKIHsKKwlzdHJ1Y3QgaTkxNV92bWEgKnZtYSA9IHNs
ZWV2ZS0+dm1hOworCisJaWYgKHZtYSkgeworCQlpOTE1X3ZtYV91bnBpbih2bWEpOworCQlpOTE1
X3ZtYV9wdXQodm1hKTsKKwl9CisKIAlrZnJlZShzbGVldmUpOwogfQogCkBAIC0xNTUsOCArMTgy
LDggQEAgc3RhdGljIHZvaWQgY2xlYXJfcGFnZXNfZG1hX2ZlbmNlX2NiKHN0cnVjdCBkbWFfZmVu
Y2UgKmZlbmNlLAogc3RhdGljIHZvaWQgY2xlYXJfcGFnZXNfd29ya2VyKHN0cnVjdCB3b3JrX3N0
cnVjdCAqd29yaykKIHsKIAlzdHJ1Y3QgY2xlYXJfcGFnZXNfd29yayAqdyA9IGNvbnRhaW5lcl9v
Zih3b3JrLCB0eXBlb2YoKncpLCB3b3JrKTsKLQlzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAq
b2JqID0gdy0+c2xlZXZlLT52bWEtPm9iajsKLQlzdHJ1Y3QgaTkxNV92bWEgKnZtYSA9IHctPnNs
ZWV2ZS0+dm1hOworCXN0cnVjdCBpOTE1X3ZtYSAqdm1hID0gZmV0Y2hfYW5kX3plcm8oJnctPnNs
ZWV2ZS0+dm1hKTsKKwlzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2JqID0gdm1hLT5vYmo7
CiAJc3RydWN0IGk5MTVfcmVxdWVzdCAqcnE7CiAJc3RydWN0IGk5MTVfdm1hICpiYXRjaDsKIAlp
bnQgZXJyID0gdy0+ZG1hLmVycm9yOwpAQCAtMTY2LDIwICsxOTMsMTYgQEAgc3RhdGljIHZvaWQg
Y2xlYXJfcGFnZXNfd29ya2VyKHN0cnVjdCB3b3JrX3N0cnVjdCAqd29yaykKIAogCWlmIChvYmot
PmNhY2hlX2RpcnR5KSB7CiAJCWlmIChpOTE1X2dlbV9vYmplY3RfaGFzX3N0cnVjdF9wYWdlKG9i
aikpCi0JCQlkcm1fY2xmbHVzaF9zZyh3LT5zbGVldmUtPnBhZ2VzKTsKKwkJCWRybV9jbGZsdXNo
X3NnKHZtYS0+cGFnZXMpOwogCQlvYmotPmNhY2hlX2RpcnR5ID0gZmFsc2U7CiAJfQogCW9iai0+
cmVhZF9kb21haW5zID0gSTkxNV9HRU1fR1BVX0RPTUFJTlM7CiAJb2JqLT53cml0ZV9kb21haW4g
PSAwOwogCi0JZXJyID0gaTkxNV92bWFfcGluKHZtYSwgMCwgMCwgUElOX1VTRVIpOwotCWlmICh1
bmxpa2VseShlcnIpKQotCQlnb3RvIG91dF9zaWduYWw7Ci0KIAliYXRjaCA9IGludGVsX2VtaXRf
dm1hX2ZpbGxfYmx0KHctPmNlLCB2bWEsIHctPnZhbHVlKTsKIAlpZiAoSVNfRVJSKGJhdGNoKSkg
ewogCQllcnIgPSBQVFJfRVJSKGJhdGNoKTsKLQkJZ290byBvdXRfdW5waW47CisJCWdvdG8gb3V0
X3NpZ25hbDsKIAl9CiAKIAlycSA9IGludGVsX2NvbnRleHRfY3JlYXRlX3JlcXVlc3Qody0+Y2Up
OwpAQCAtMjI0LDE0ICsyNDcsMTUgQEAgc3RhdGljIHZvaWQgY2xlYXJfcGFnZXNfd29ya2VyKHN0
cnVjdCB3b3JrX3N0cnVjdCAqd29yaykKIAlpOTE1X3JlcXVlc3RfYWRkKHJxKTsKIG91dF9iYXRj
aDoKIAlpbnRlbF9lbWl0X3ZtYV9yZWxlYXNlKHctPmNlLCBiYXRjaCk7Ci1vdXRfdW5waW46Ci0J
aTkxNV92bWFfdW5waW4odm1hKTsKIG91dF9zaWduYWw6CiAJaWYgKHVubGlrZWx5KGVycikpIHsK
IAkJZG1hX2ZlbmNlX3NldF9lcnJvcigmdy0+ZG1hLCBlcnIpOwogCQlkbWFfZmVuY2Vfc2lnbmFs
KCZ3LT5kbWEpOwogCQlkbWFfZmVuY2VfcHV0KCZ3LT5kbWEpOwogCX0KKworCWk5MTVfdm1hX3Vu
cGluKHZtYSk7CisJaTkxNV92bWFfcHV0KHZtYSk7CiB9CiAKIHN0YXRpYyBpbnQgX19pOTE1X3N3
X2ZlbmNlX2NhbGwKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX3Jp
bmdidWZmZXIuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX3JpbmdidWZmZXIuYwpp
bmRleCBkNmUyZjViM2RkNjIuLjI3MWFlYTQyNzljMyAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUv
ZHJtL2k5MTUvZ3QvaW50ZWxfcmluZ2J1ZmZlci5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1
L2d0L2ludGVsX3JpbmdidWZmZXIuYwpAQCAtOTQxLDEzICs5NDEsMTIgQEAgc3RhdGljIHUzMiAq
aTl4eF9lbWl0X2JyZWFkY3J1bWIoc3RydWN0IGk5MTVfcmVxdWVzdCAqcnEsIHUzMiAqY3MpCiAJ
R0VNX0JVR19PTihvZmZzZXRfaW5fcGFnZShycS0+dGltZWxpbmUtPmh3c3Bfb2Zmc2V0KSAhPSBJ
OTE1X0dFTV9IV1NfU0VRTk9fQUREUik7CiAKIAkqY3MrKyA9IE1JX0ZMVVNIOwotCiAJKmNzKysg
PSBNSV9TVE9SRV9EV09SRF9JTkRFWDsKIAkqY3MrKyA9IEk5MTVfR0VNX0hXU19TRVFOT19BRERS
OwogCSpjcysrID0gcnEtPmZlbmNlLnNlcW5vOwogCisJKmNzKysgPSBNSV9GTFVTSCB8IE1JX05P
X1dSSVRFX0ZMVVNIOwogCSpjcysrID0gTUlfVVNFUl9JTlRFUlJVUFQ7Ci0JKmNzKysgPSBNSV9O
T09QOwogCiAJcnEtPnRhaWwgPSBpbnRlbF9yaW5nX29mZnNldChycSwgY3MpOwogCWFzc2VydF9y
aW5nX3RhaWxfdmFsaWQocnEtPnJpbmcsIHJxLT50YWlsKTsKLS0gCjIuMjMuMAoKX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX18KSW50ZWwtZ2Z4IG1haWxpbmcg
bGlzdApJbnRlbC1nZnhAbGlzdHMuZnJlZWRlc2t0b3Aub3JnCmh0dHBzOi8vbGlzdHMuZnJlZWRl
c2t0b3Aub3JnL21haWxtYW4vbGlzdGluZm8vaW50ZWwtZ2Z4

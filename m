Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 2472F100975
	for <lists+intel-gfx@lfdr.de>; Mon, 18 Nov 2019 17:45:03 +0100 (CET)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 4ED9D6E629;
	Mon, 18 Nov 2019 16:45:01 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from mga01.intel.com (mga01.intel.com [192.55.52.88])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 2787B6E612
 for <intel-gfx@lists.freedesktop.org>; Mon, 18 Nov 2019 16:44:58 +0000 (UTC)
X-Amp-Result: SKIPPED(no attachment in message)
X-Amp-File-Uploaded: False
Received: from orsmga006.jf.intel.com ([10.7.209.51])
 by fmsmga101.fm.intel.com with ESMTP/TLS/DHE-RSA-AES256-GCM-SHA384;
 18 Nov 2019 08:44:51 -0800
X-ExtLoop1: 1
X-IronPort-AV: E=Sophos;i="5.68,320,1569308400"; d="scan'208";a="209133942"
Received: from stinkbox.fi.intel.com (HELO stinkbox) ([10.237.72.174])
 by orsmga006.jf.intel.com with SMTP; 18 Nov 2019 08:44:48 -0800
Received: by stinkbox (sSMTP sendmail emulation);
 Mon, 18 Nov 2019 18:44:48 +0200
From: Ville Syrjala <ville.syrjala@linux.intel.com>
To: intel-gfx@lists.freedesktop.org
Date: Mon, 18 Nov 2019 18:44:26 +0200
Message-Id: <20191118164430.27265-7-ville.syrjala@linux.intel.com>
X-Mailer: git-send-email 2.23.0
In-Reply-To: <20191118164430.27265-1-ville.syrjala@linux.intel.com>
References: <20191118164430.27265-1-ville.syrjala@linux.intel.com>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH v2 06/10] drm/i915: Change watermark hook
 calling convention
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

RnJvbTogVmlsbGUgU3lyasOkbMOkIDx2aWxsZS5zeXJqYWxhQGxpbnV4LmludGVsLmNvbT4KCkp1
c3QgcGFzcyB0aGUgYXRvbWljX3N0YXRlK2NydGMgdG8gdGhlIHdhdGVybWFya3MgaG9va3MuIEVl
YXNpZXIKdGltZSBmb3IgdGhlIGNhbGxlciB3aGVuIGl0IGRvZXNuJ3QgaGF2ZSB0byB0aGluayB3
aGF0IHRvIHBhc3MuCgpSZXZpZXdlZC1ieTogTWFuYXNpIE5hdmFyZSA8bWFuYXNpLmQubmF2YXJl
QGludGVsLmNvbT4KU2lnbmVkLW9mZi1ieTogVmlsbGUgU3lyasOkbMOkIDx2aWxsZS5zeXJqYWxh
QGxpbnV4LmludGVsLmNvbT4KLS0tCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVs
X2Rpc3BsYXkuYyB8IDMyICsrKysrLS0tLS0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZHJ2
LmggICAgICAgICAgICAgIHwgIDYgKy0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2ludGVsX3BtLmMg
ICAgICAgICAgICAgIHwgNjMgKysrKysrKysrKystLS0tLS0tLS0KIDMgZmlsZXMgY2hhbmdlZCwg
NTMgaW5zZXJ0aW9ucygrKSwgNDggZGVsZXRpb25zKC0pCgpkaWZmIC0tZ2l0IGEvZHJpdmVycy9n
cHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kaXNwbGF5LmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkx
NS9kaXNwbGF5L2ludGVsX2Rpc3BsYXkuYwppbmRleCBjODczYzg1YTY5YTcuLjY4YTdlNWQ0Njdm
ZiAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kaXNwbGF5
LmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kaXNwbGF5LmMKQEAg
LTYxODksOSArNjE4OSw4IEBAIHN0YXRpYyB2b2lkIGludGVsX3ByZV9wbGFuZV91cGRhdGUoc3Ry
dWN0IGludGVsX2NydGNfc3RhdGUgKm9sZF9jcnRjX3N0YXRlLAogCSAqIHdlJ2xsIGNvbnRpbnVl
IHRvIHVwZGF0ZSB3YXRlcm1hcmtzIHRoZSBvbGQgd2F5LCBpZiBmbGFncyB0ZWxsCiAJICogdXMg
dG8uCiAJICovCi0JaWYgKGRldl9wcml2LT5kaXNwbGF5LmluaXRpYWxfd2F0ZXJtYXJrcyAhPSBO
VUxMKQotCQlkZXZfcHJpdi0+ZGlzcGxheS5pbml0aWFsX3dhdGVybWFya3MoaW50ZWxfc3RhdGUs
Ci0JCQkJCQkgICAgIHBpcGVfY29uZmlnKTsKKwlpZiAoZGV2X3ByaXYtPmRpc3BsYXkuaW5pdGlh
bF93YXRlcm1hcmtzKQorCQlkZXZfcHJpdi0+ZGlzcGxheS5pbml0aWFsX3dhdGVybWFya3MoaW50
ZWxfc3RhdGUsIGNydGMpOwogCWVsc2UgaWYgKHBpcGVfY29uZmlnLT51cGRhdGVfd21fcHJlKQog
CQlpbnRlbF91cGRhdGVfd2F0ZXJtYXJrcyhjcnRjKTsKIH0KQEAgLTY1MzksOCArNjUzOCw4IEBA
IHN0YXRpYyB2b2lkIGlyb25sYWtlX2NydGNfZW5hYmxlKHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRl
ICpwaXBlX2NvbmZpZywKIAkvKiB1cGRhdGUgRFNQQ05UUiB0byBjb25maWd1cmUgZ2FtbWEgZm9y
IHBpcGUgYm90dG9tIGNvbG9yICovCiAJaW50ZWxfZGlzYWJsZV9wcmltYXJ5X3BsYW5lKHBpcGVf
Y29uZmlnKTsKIAotCWlmIChkZXZfcHJpdi0+ZGlzcGxheS5pbml0aWFsX3dhdGVybWFya3MgIT0g
TlVMTCkKLQkJZGV2X3ByaXYtPmRpc3BsYXkuaW5pdGlhbF93YXRlcm1hcmtzKHN0YXRlLCBwaXBl
X2NvbmZpZyk7CisJaWYgKGRldl9wcml2LT5kaXNwbGF5LmluaXRpYWxfd2F0ZXJtYXJrcykKKwkJ
ZGV2X3ByaXYtPmRpc3BsYXkuaW5pdGlhbF93YXRlcm1hcmtzKHN0YXRlLCBpbnRlbF9jcnRjKTsK
IAlpbnRlbF9lbmFibGVfcGlwZShwaXBlX2NvbmZpZyk7CiAKIAlpZiAocGlwZV9jb25maWctPmhh
c19wY2hfZW5jb2RlcikKQEAgLTY2OTgsOCArNjY5Nyw4IEBAIHN0YXRpYyB2b2lkIGhhc3dlbGxf
Y3J0Y19lbmFibGUoc3RydWN0IGludGVsX2NydGNfc3RhdGUgKnBpcGVfY29uZmlnLAogCWlmICgh
dHJhbnNjb2Rlcl9pc19kc2koY3B1X3RyYW5zY29kZXIpKQogCQlpbnRlbF9kZGlfZW5hYmxlX3Ry
YW5zY29kZXJfZnVuYyhwaXBlX2NvbmZpZyk7CiAKLQlpZiAoZGV2X3ByaXYtPmRpc3BsYXkuaW5p
dGlhbF93YXRlcm1hcmtzICE9IE5VTEwpCi0JCWRldl9wcml2LT5kaXNwbGF5LmluaXRpYWxfd2F0
ZXJtYXJrcyhzdGF0ZSwgcGlwZV9jb25maWcpOworCWlmIChkZXZfcHJpdi0+ZGlzcGxheS5pbml0
aWFsX3dhdGVybWFya3MpCisJCWRldl9wcml2LT5kaXNwbGF5LmluaXRpYWxfd2F0ZXJtYXJrcyhz
dGF0ZSwgaW50ZWxfY3J0Yyk7CiAKIAlpZiAoSU5URUxfR0VOKGRldl9wcml2KSA+PSAxMSkKIAkJ
aWNsX3BpcGVfbWJ1c19lbmFibGUoaW50ZWxfY3J0Yyk7CkBAIC03MDgzLDcgKzcwODIsNyBAQCBz
dGF0aWMgdm9pZCB2YWxsZXl2aWV3X2NydGNfZW5hYmxlKHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRl
ICpwaXBlX2NvbmZpZywKIAkvKiB1cGRhdGUgRFNQQ05UUiB0byBjb25maWd1cmUgZ2FtbWEgZm9y
IHBpcGUgYm90dG9tIGNvbG9yICovCiAJaW50ZWxfZGlzYWJsZV9wcmltYXJ5X3BsYW5lKHBpcGVf
Y29uZmlnKTsKIAotCWRldl9wcml2LT5kaXNwbGF5LmluaXRpYWxfd2F0ZXJtYXJrcyhzdGF0ZSwg
cGlwZV9jb25maWcpOworCWRldl9wcml2LT5kaXNwbGF5LmluaXRpYWxfd2F0ZXJtYXJrcyhzdGF0
ZSwgaW50ZWxfY3J0Yyk7CiAJaW50ZWxfZW5hYmxlX3BpcGUocGlwZV9jb25maWcpOwogCiAJaW50
ZWxfY3J0Y192Ymxhbmtfb24ocGlwZV9jb25maWcpOwpAQCAtNzEzOCw5ICs3MTM3LDggQEAgc3Rh
dGljIHZvaWQgaTl4eF9jcnRjX2VuYWJsZShzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqcGlwZV9j
b25maWcsCiAJLyogdXBkYXRlIERTUENOVFIgdG8gY29uZmlndXJlIGdhbW1hIGZvciBwaXBlIGJv
dHRvbSBjb2xvciAqLwogCWludGVsX2Rpc2FibGVfcHJpbWFyeV9wbGFuZShwaXBlX2NvbmZpZyk7
CiAKLQlpZiAoZGV2X3ByaXYtPmRpc3BsYXkuaW5pdGlhbF93YXRlcm1hcmtzICE9IE5VTEwpCi0J
CWRldl9wcml2LT5kaXNwbGF5LmluaXRpYWxfd2F0ZXJtYXJrcyhzdGF0ZSwKLQkJCQkJCSAgICAg
cGlwZV9jb25maWcpOworCWlmIChkZXZfcHJpdi0+ZGlzcGxheS5pbml0aWFsX3dhdGVybWFya3Mp
CisJCWRldl9wcml2LT5kaXNwbGF5LmluaXRpYWxfd2F0ZXJtYXJrcyhzdGF0ZSwgaW50ZWxfY3J0
Yyk7CiAJZWxzZQogCQlpbnRlbF91cGRhdGVfd2F0ZXJtYXJrcyhpbnRlbF9jcnRjKTsKIAlpbnRl
bF9lbmFibGVfcGlwZShwaXBlX2NvbmZpZyk7CkBAIC0xNDMxNiw2ICsxNDMxNCw3IEBAIHN0YXRp
YyB2b2lkIGNvbW1pdF9waXBlX2NvbmZpZyhzdHJ1Y3QgaW50ZWxfYXRvbWljX3N0YXRlICpzdGF0
ZSwKIAkJCSAgICAgICBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqb2xkX2NydGNfc3RhdGUsCiAJ
CQkgICAgICAgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKm5ld19jcnRjX3N0YXRlKQogeworCXN0
cnVjdCBpbnRlbF9jcnRjICpjcnRjID0gdG9faW50ZWxfY3J0YyhuZXdfY3J0Y19zdGF0ZS0+dWFw
aS5jcnRjKTsKIAlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KHN0
YXRlLT5iYXNlLmRldik7CiAJYm9vbCBtb2Rlc2V0ID0gbmVlZHNfbW9kZXNldChuZXdfY3J0Y19z
dGF0ZSk7CiAKQEAgLTE0MzM5LDggKzE0MzM4LDcgQEAgc3RhdGljIHZvaWQgY29tbWl0X3BpcGVf
Y29uZmlnKHN0cnVjdCBpbnRlbF9hdG9taWNfc3RhdGUgKnN0YXRlLAogCX0KIAogCWlmIChkZXZf
cHJpdi0+ZGlzcGxheS5hdG9taWNfdXBkYXRlX3dhdGVybWFya3MpCi0JCWRldl9wcml2LT5kaXNw
bGF5LmF0b21pY191cGRhdGVfd2F0ZXJtYXJrcyhzdGF0ZSwKLQkJCQkJCQkgICBuZXdfY3J0Y19z
dGF0ZSk7CisJCWRldl9wcml2LT5kaXNwbGF5LmF0b21pY191cGRhdGVfd2F0ZXJtYXJrcyhzdGF0
ZSwgY3J0Yyk7CiB9CiAKIHN0YXRpYyB2b2lkIGludGVsX3VwZGF0ZV9jcnRjKHN0cnVjdCBpbnRl
bF9jcnRjICpjcnRjLApAQCAtMTQ0NDQsOCArMTQ0NDIsNyBAQCBzdGF0aWMgdm9pZCBpbnRlbF9v
bGRfY3J0Y19zdGF0ZV9kaXNhYmxlcyhzdHJ1Y3QgaW50ZWxfYXRvbWljX3N0YXRlICpzdGF0ZSwK
IAlpZiAoIW5ld19jcnRjX3N0YXRlLT5ody5hY3RpdmUgJiYKIAkgICAgIUhBU19HTUNIKGRldl9w
cml2KSAmJgogCSAgICBkZXZfcHJpdi0+ZGlzcGxheS5pbml0aWFsX3dhdGVybWFya3MpCi0JCWRl
dl9wcml2LT5kaXNwbGF5LmluaXRpYWxfd2F0ZXJtYXJrcyhzdGF0ZSwKLQkJCQkJCSAgICAgbmV3
X2NydGNfc3RhdGUpOworCQlkZXZfcHJpdi0+ZGlzcGxheS5pbml0aWFsX3dhdGVybWFya3Moc3Rh
dGUsIGNydGMpOwogfQogCiBzdGF0aWMgdm9pZCBpbnRlbF90cmFuc19wb3J0X3N5bmNfbW9kZXNl
dF9kaXNhYmxlcyhzdHJ1Y3QgaW50ZWxfYXRvbWljX3N0YXRlICpzdGF0ZSwKQEAgLTE0ODk1LDgg
KzE0ODkyLDcgQEAgc3RhdGljIHZvaWQgaW50ZWxfYXRvbWljX2NvbW1pdF90YWlsKHN0cnVjdCBp
bnRlbF9hdG9taWNfc3RhdGUgKnN0YXRlKQogCSAqLwogCWZvcl9lYWNoX25ld19pbnRlbF9jcnRj
X2luX3N0YXRlKHN0YXRlLCBjcnRjLCBuZXdfY3J0Y19zdGF0ZSwgaSkgewogCQlpZiAoZGV2X3By
aXYtPmRpc3BsYXkub3B0aW1pemVfd2F0ZXJtYXJrcykKLQkJCWRldl9wcml2LT5kaXNwbGF5Lm9w
dGltaXplX3dhdGVybWFya3Moc3RhdGUsCi0JCQkJCQkJICAgICAgbmV3X2NydGNfc3RhdGUpOwor
CQkJZGV2X3ByaXYtPmRpc3BsYXkub3B0aW1pemVfd2F0ZXJtYXJrcyhzdGF0ZSwgY3J0Yyk7CiAJ
fQogCiAJZm9yX2VhY2hfb2xkbmV3X2ludGVsX2NydGNfaW5fc3RhdGUoc3RhdGUsIGNydGMsIG9s
ZF9jcnRjX3N0YXRlLCBuZXdfY3J0Y19zdGF0ZSwgaSkgewpAQCAtMTY4NTEsNyArMTY4NDcsNyBA
QCBzdGF0aWMgdm9pZCBzYW5pdGl6ZV93YXRlcm1hcmtzKHN0cnVjdCBkcm1fZGV2aWNlICpkZXYp
CiAJLyogV3JpdGUgY2FsY3VsYXRlZCB3YXRlcm1hcmsgdmFsdWVzIGJhY2sgKi8KIAlmb3JfZWFj
aF9uZXdfaW50ZWxfY3J0Y19pbl9zdGF0ZShpbnRlbF9zdGF0ZSwgY3J0YywgY3J0Y19zdGF0ZSwg
aSkgewogCQljcnRjX3N0YXRlLT53bS5uZWVkX3Bvc3R2YmxfdXBkYXRlID0gdHJ1ZTsKLQkJZGV2
X3ByaXYtPmRpc3BsYXkub3B0aW1pemVfd2F0ZXJtYXJrcyhpbnRlbF9zdGF0ZSwgY3J0Y19zdGF0
ZSk7CisJCWRldl9wcml2LT5kaXNwbGF5Lm9wdGltaXplX3dhdGVybWFya3MoaW50ZWxfc3RhdGUs
IGNydGMpOwogCiAJCXRvX2ludGVsX2NydGNfc3RhdGUoY3J0Yy0+YmFzZS5zdGF0ZSktPndtID0g
Y3J0Y19zdGF0ZS0+d207CiAJfQpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkx
NV9kcnYuaCBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZHJ2LmgKaW5kZXggYmJmNGRmZGZh
OGJhLi45YjM3YzBkNjU3ZGUgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVf
ZHJ2LmgKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9kcnYuaApAQCAtMjczLDExICsy
NzMsMTEgQEAgc3RydWN0IGRybV9pOTE1X2Rpc3BsYXlfZnVuY3MgewogCWludCAoKmNvbXB1dGVf
cGlwZV93bSkoc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUpOwogCWludCAoKmNv
bXB1dGVfaW50ZXJtZWRpYXRlX3dtKShzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0
ZSk7CiAJdm9pZCAoKmluaXRpYWxfd2F0ZXJtYXJrcykoc3RydWN0IGludGVsX2F0b21pY19zdGF0
ZSAqc3RhdGUsCi0JCQkJICAgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUpOwor
CQkJCSAgIHN0cnVjdCBpbnRlbF9jcnRjICpjcnRjKTsKIAl2b2lkICgqYXRvbWljX3VwZGF0ZV93
YXRlcm1hcmtzKShzdHJ1Y3QgaW50ZWxfYXRvbWljX3N0YXRlICpzdGF0ZSwKLQkJCQkJIHN0cnVj
dCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlKTsKKwkJCQkJIHN0cnVjdCBpbnRlbF9jcnRj
ICpjcnRjKTsKIAl2b2lkICgqb3B0aW1pemVfd2F0ZXJtYXJrcykoc3RydWN0IGludGVsX2F0b21p
Y19zdGF0ZSAqc3RhdGUsCi0JCQkJICAgIHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0
YXRlKTsKKwkJCQkgICAgc3RydWN0IGludGVsX2NydGMgKmNydGMpOwogCWludCAoKmNvbXB1dGVf
Z2xvYmFsX3dhdGVybWFya3MpKHN0cnVjdCBpbnRlbF9hdG9taWNfc3RhdGUgKnN0YXRlKTsKIAl2
b2lkICgqdXBkYXRlX3dtKShzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0Yyk7CiAJaW50ICgqbW9kZXNl
dF9jYWxjX2NkY2xrKShzdHJ1Y3QgaW50ZWxfYXRvbWljX3N0YXRlICpzdGF0ZSk7CmRpZmYgLS1n
aXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pbnRlbF9wbS5jIGIvZHJpdmVycy9ncHUvZHJtL2k5
MTUvaW50ZWxfcG0uYwppbmRleCAyODc2MDJiMWU0MjYuLjVhYWQ5ZDQ5YTUyOCAxMDA2NDQKLS0t
IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50ZWxfcG0uYworKysgYi9kcml2ZXJzL2dwdS9kcm0v
aTkxNS9pbnRlbF9wbS5jCkBAIC0xNTI4LDEwICsxNTI4LDExIEBAIHN0YXRpYyB2b2lkIGc0eF9w
cm9ncmFtX3dhdGVybWFya3Moc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQogfQog
CiBzdGF0aWMgdm9pZCBnNHhfaW5pdGlhbF93YXRlcm1hcmtzKHN0cnVjdCBpbnRlbF9hdG9taWNf
c3RhdGUgKnN0YXRlLAotCQkJCSAgIHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRl
KQorCQkJCSAgIHN0cnVjdCBpbnRlbF9jcnRjICpjcnRjKQogewotCXN0cnVjdCBkcm1faTkxNV9w
cml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoY3J0Y19zdGF0ZS0+dWFwaS5jcnRjLT5kZXYpOwot
CXN0cnVjdCBpbnRlbF9jcnRjICpjcnRjID0gdG9faW50ZWxfY3J0YyhjcnRjX3N0YXRlLT51YXBp
LmNydGMpOworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoY3J0
Yy0+YmFzZS5kZXYpOworCWNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRl
ID0KKwkJaW50ZWxfYXRvbWljX2dldF9uZXdfY3J0Y19zdGF0ZShzdGF0ZSwgY3J0Yyk7CiAKIAlt
dXRleF9sb2NrKCZkZXZfcHJpdi0+d20ud21fbXV0ZXgpOwogCWNydGMtPndtLmFjdGl2ZS5nNHgg
PSBjcnRjX3N0YXRlLT53bS5nNHguaW50ZXJtZWRpYXRlOwpAQCAtMTU0MCwxMCArMTU0MSwxMSBA
QCBzdGF0aWMgdm9pZCBnNHhfaW5pdGlhbF93YXRlcm1hcmtzKHN0cnVjdCBpbnRlbF9hdG9taWNf
c3RhdGUgKnN0YXRlLAogfQogCiBzdGF0aWMgdm9pZCBnNHhfb3B0aW1pemVfd2F0ZXJtYXJrcyhz
dHJ1Y3QgaW50ZWxfYXRvbWljX3N0YXRlICpzdGF0ZSwKLQkJCQkgICAgc3RydWN0IGludGVsX2Ny
dGNfc3RhdGUgKmNydGNfc3RhdGUpCisJCQkJICAgIHN0cnVjdCBpbnRlbF9jcnRjICpjcnRjKQog
ewotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoY3J0Y19zdGF0
ZS0+dWFwaS5jcnRjLT5kZXYpOwotCXN0cnVjdCBpbnRlbF9jcnRjICpjcnRjID0gdG9faW50ZWxf
Y3J0YyhjcnRjX3N0YXRlLT51YXBpLmNydGMpOworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpk
ZXZfcHJpdiA9IHRvX2k5MTUoY3J0Yy0+YmFzZS5kZXYpOworCWNvbnN0IHN0cnVjdCBpbnRlbF9j
cnRjX3N0YXRlICpjcnRjX3N0YXRlID0KKwkJaW50ZWxfYXRvbWljX2dldF9uZXdfY3J0Y19zdGF0
ZShzdGF0ZSwgY3J0Yyk7CiAKIAlpZiAoIWNydGNfc3RhdGUtPndtLm5lZWRfcG9zdHZibF91cGRh
dGUpCiAJCXJldHVybjsKQEAgLTE5MjMsMTEgKzE5MjUsMTIgQEAgc3RhdGljIGludCB2bHZfY29t
cHV0ZV9waXBlX3dtKHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlKQogCSgoKHZh
bHVlKSA8PCBEU1BBUkJfICMjIHBsYW5lICMjIF9TSElGVF9WTFYpICYgRFNQQVJCXyAjIyBwbGFu
ZSAjIyBfTUFTS19WTFYpCiAKIHN0YXRpYyB2b2lkIHZsdl9hdG9taWNfdXBkYXRlX2ZpZm8oc3Ry
dWN0IGludGVsX2F0b21pY19zdGF0ZSAqc3RhdGUsCi0JCQkJICAgc3RydWN0IGludGVsX2NydGNf
c3RhdGUgKmNydGNfc3RhdGUpCisJCQkJICAgc3RydWN0IGludGVsX2NydGMgKmNydGMpCiB7Ci0J
c3RydWN0IGludGVsX2NydGMgKmNydGMgPSB0b19pbnRlbF9jcnRjKGNydGNfc3RhdGUtPnVhcGku
Y3J0Yyk7CiAJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShjcnRj
LT5iYXNlLmRldik7CiAJc3RydWN0IGludGVsX3VuY29yZSAqdW5jb3JlID0gJmRldl9wcml2LT51
bmNvcmU7CisJY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUgPQorCQlp
bnRlbF9hdG9taWNfZ2V0X25ld19jcnRjX3N0YXRlKHN0YXRlLCBjcnRjKTsKIAljb25zdCBzdHJ1
Y3Qgdmx2X2ZpZm9fc3RhdGUgKmZpZm9fc3RhdGUgPQogCQkmY3J0Y19zdGF0ZS0+d20udmx2LmZp
Zm9fc3RhdGU7CiAJaW50IHNwcml0ZTBfc3RhcnQsIHNwcml0ZTFfc3RhcnQsIGZpZm9fc2l6ZTsK
QEAgLTIxNDcsMTAgKzIxNTAsMTEgQEAgc3RhdGljIHZvaWQgdmx2X3Byb2dyYW1fd2F0ZXJtYXJr
cyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCiB9CiAKIHN0YXRpYyB2b2lkIHZs
dl9pbml0aWFsX3dhdGVybWFya3Moc3RydWN0IGludGVsX2F0b21pY19zdGF0ZSAqc3RhdGUsCi0J
CQkJICAgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUpCisJCQkJICAgc3RydWN0
IGludGVsX2NydGMgKmNydGMpCiB7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2
ID0gdG9faTkxNShjcnRjX3N0YXRlLT51YXBpLmNydGMtPmRldik7Ci0Jc3RydWN0IGludGVsX2Ny
dGMgKmNydGMgPSB0b19pbnRlbF9jcnRjKGNydGNfc3RhdGUtPnVhcGkuY3J0Yyk7CisJc3RydWN0
IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShjcnRjLT5iYXNlLmRldik7CisJ
Y29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUgPQorCQlpbnRlbF9hdG9t
aWNfZ2V0X25ld19jcnRjX3N0YXRlKHN0YXRlLCBjcnRjKTsKIAogCW11dGV4X2xvY2soJmRldl9w
cml2LT53bS53bV9tdXRleCk7CiAJY3J0Yy0+d20uYWN0aXZlLnZsdiA9IGNydGNfc3RhdGUtPndt
LnZsdi5pbnRlcm1lZGlhdGU7CkBAIC0yMTU5LDEwICsyMTYzLDExIEBAIHN0YXRpYyB2b2lkIHZs
dl9pbml0aWFsX3dhdGVybWFya3Moc3RydWN0IGludGVsX2F0b21pY19zdGF0ZSAqc3RhdGUsCiB9
CiAKIHN0YXRpYyB2b2lkIHZsdl9vcHRpbWl6ZV93YXRlcm1hcmtzKHN0cnVjdCBpbnRlbF9hdG9t
aWNfc3RhdGUgKnN0YXRlLAotCQkJCSAgICBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19z
dGF0ZSkKKwkJCQkgICAgc3RydWN0IGludGVsX2NydGMgKmNydGMpCiB7Ci0Jc3RydWN0IGRybV9p
OTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShjcnRjX3N0YXRlLT51YXBpLmNydGMtPmRl
dik7Ci0Jc3RydWN0IGludGVsX2NydGMgKmNydGMgPSB0b19pbnRlbF9jcnRjKGNydGNfc3RhdGUt
PnVhcGkuY3J0Yyk7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkx
NShjcnRjLT5iYXNlLmRldik7CisJY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNf
c3RhdGUgPQorCQlpbnRlbF9hdG9taWNfZ2V0X25ld19jcnRjX3N0YXRlKHN0YXRlLCBjcnRjKTsK
IAogCWlmICghY3J0Y19zdGF0ZS0+d20ubmVlZF9wb3N0dmJsX3VwZGF0ZSkKIAkJcmV0dXJuOwpA
QCAtNTQ5OSwxMSArNTUwNCwxMiBAQCBza2xfY29tcHV0ZV93bShzdHJ1Y3QgaW50ZWxfYXRvbWlj
X3N0YXRlICpzdGF0ZSkKIH0KIAogc3RhdGljIHZvaWQgc2tsX2F0b21pY191cGRhdGVfY3J0Y193
bShzdHJ1Y3QgaW50ZWxfYXRvbWljX3N0YXRlICpzdGF0ZSwKLQkJCQkgICAgICBzdHJ1Y3QgaW50
ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSkKKwkJCQkgICAgICBzdHJ1Y3QgaW50ZWxfY3J0YyAq
Y3J0YykKIHsKLQlzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YyA9IHRvX2ludGVsX2NydGMoY3J0Y19z
dGF0ZS0+dWFwaS5jcnRjKTsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0
b19pOTE1KHN0YXRlLT5iYXNlLmRldik7Ci0Jc3RydWN0IHNrbF9waXBlX3dtICpwaXBlX3dtID0g
JmNydGNfc3RhdGUtPndtLnNrbC5vcHRpbWFsOworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpk
ZXZfcHJpdiA9IHRvX2k5MTUoY3J0Yy0+YmFzZS5kZXYpOworCWNvbnN0IHN0cnVjdCBpbnRlbF9j
cnRjX3N0YXRlICpjcnRjX3N0YXRlID0KKwkJaW50ZWxfYXRvbWljX2dldF9uZXdfY3J0Y19zdGF0
ZShzdGF0ZSwgY3J0Yyk7CisJY29uc3Qgc3RydWN0IHNrbF9waXBlX3dtICpwaXBlX3dtID0gJmNy
dGNfc3RhdGUtPndtLnNrbC5vcHRpbWFsOwogCWVudW0gcGlwZSBwaXBlID0gY3J0Yy0+cGlwZTsK
IAogCWlmICgoc3RhdGUtPndtX3Jlc3VsdHMuZGlydHlfcGlwZXMgJiBCSVQoY3J0Yy0+cGlwZSkp
ID09IDApCkBAIC01NTEzLDEwICs1NTE5LDExIEBAIHN0YXRpYyB2b2lkIHNrbF9hdG9taWNfdXBk
YXRlX2NydGNfd20oc3RydWN0IGludGVsX2F0b21pY19zdGF0ZSAqc3RhdGUsCiB9CiAKIHN0YXRp
YyB2b2lkIHNrbF9pbml0aWFsX3dtKHN0cnVjdCBpbnRlbF9hdG9taWNfc3RhdGUgKnN0YXRlLAot
CQkJICAgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUpCisJCQkgICBzdHJ1Y3Qg
aW50ZWxfY3J0YyAqY3J0YykKIHsKLQlzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YyA9IHRvX2ludGVs
X2NydGMoY3J0Y19zdGF0ZS0+dWFwaS5jcnRjKTsKIAlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAq
ZGV2X3ByaXYgPSB0b19pOTE1KGNydGMtPmJhc2UuZGV2KTsKKwljb25zdCBzdHJ1Y3QgaW50ZWxf
Y3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSA9CisJCWludGVsX2F0b21pY19nZXRfbmV3X2NydGNfc3Rh
dGUoc3RhdGUsIGNydGMpOwogCXN0cnVjdCBza2xfZGRiX3ZhbHVlcyAqcmVzdWx0cyA9ICZzdGF0
ZS0+d21fcmVzdWx0czsKIAogCWlmICgocmVzdWx0cy0+ZGlydHlfcGlwZXMgJiBCSVQoY3J0Yy0+
cGlwZSkpID09IDApCkBAIC01NTI1LDcgKzU1MzIsNyBAQCBzdGF0aWMgdm9pZCBza2xfaW5pdGlh
bF93bShzdHJ1Y3QgaW50ZWxfYXRvbWljX3N0YXRlICpzdGF0ZSwKIAltdXRleF9sb2NrKCZkZXZf
cHJpdi0+d20ud21fbXV0ZXgpOwogCiAJaWYgKGNydGNfc3RhdGUtPnVhcGkuYWN0aXZlX2NoYW5n
ZWQpCi0JCXNrbF9hdG9taWNfdXBkYXRlX2NydGNfd20oc3RhdGUsIGNydGNfc3RhdGUpOworCQlz
a2xfYXRvbWljX3VwZGF0ZV9jcnRjX3dtKHN0YXRlLCBjcnRjKTsKIAogCW11dGV4X3VubG9jaygm
ZGV2X3ByaXYtPndtLndtX211dGV4KTsKIH0KQEAgLTU1ODEsMTAgKzU1ODgsMTEgQEAgc3RhdGlj
IHZvaWQgaWxrX3Byb2dyYW1fd2F0ZXJtYXJrcyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2
X3ByaXYpCiB9CiAKIHN0YXRpYyB2b2lkIGlsa19pbml0aWFsX3dhdGVybWFya3Moc3RydWN0IGlu
dGVsX2F0b21pY19zdGF0ZSAqc3RhdGUsCi0JCQkJICAgc3RydWN0IGludGVsX2NydGNfc3RhdGUg
KmNydGNfc3RhdGUpCisJCQkJICAgc3RydWN0IGludGVsX2NydGMgKmNydGMpCiB7Ci0Jc3RydWN0
IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShjcnRjX3N0YXRlLT51YXBpLmNy
dGMtPmRldik7Ci0Jc3RydWN0IGludGVsX2NydGMgKmNydGMgPSB0b19pbnRlbF9jcnRjKGNydGNf
c3RhdGUtPnVhcGkuY3J0Yyk7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0g
dG9faTkxNShjcnRjLT5iYXNlLmRldik7CisJY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUg
KmNydGNfc3RhdGUgPQorCQlpbnRlbF9hdG9taWNfZ2V0X25ld19jcnRjX3N0YXRlKHN0YXRlLCBj
cnRjKTsKIAogCW11dGV4X2xvY2soJmRldl9wcml2LT53bS53bV9tdXRleCk7CiAJY3J0Yy0+d20u
YWN0aXZlLmlsayA9IGNydGNfc3RhdGUtPndtLmlsay5pbnRlcm1lZGlhdGU7CkBAIC01NTkzLDEw
ICs1NjAxLDExIEBAIHN0YXRpYyB2b2lkIGlsa19pbml0aWFsX3dhdGVybWFya3Moc3RydWN0IGlu
dGVsX2F0b21pY19zdGF0ZSAqc3RhdGUsCiB9CiAKIHN0YXRpYyB2b2lkIGlsa19vcHRpbWl6ZV93
YXRlcm1hcmtzKHN0cnVjdCBpbnRlbF9hdG9taWNfc3RhdGUgKnN0YXRlLAotCQkJCSAgICBzdHJ1
Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSkKKwkJCQkgICAgc3RydWN0IGludGVsX2Ny
dGMgKmNydGMpCiB7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkx
NShjcnRjX3N0YXRlLT51YXBpLmNydGMtPmRldik7Ci0Jc3RydWN0IGludGVsX2NydGMgKmNydGMg
PSB0b19pbnRlbF9jcnRjKGNydGNfc3RhdGUtPnVhcGkuY3J0Yyk7CisJc3RydWN0IGRybV9pOTE1
X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShjcnRjLT5iYXNlLmRldik7CisJY29uc3Qgc3Ry
dWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUgPQorCQlpbnRlbF9hdG9taWNfZ2V0X25l
d19jcnRjX3N0YXRlKHN0YXRlLCBjcnRjKTsKIAogCWlmICghY3J0Y19zdGF0ZS0+d20ubmVlZF9w
b3N0dmJsX3VwZGF0ZSkKIAkJcmV0dXJuOwotLSAKMi4yMy4wCgpfX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fXwpJbnRlbC1nZnggbWFpbGluZyBsaXN0CkludGVs
LWdmeEBsaXN0cy5mcmVlZGVza3RvcC5vcmcKaHR0cHM6Ly9saXN0cy5mcmVlZGVza3RvcC5vcmcv
bWFpbG1hbi9saXN0aW5mby9pbnRlbC1nZng=

Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 9025839E68D
	for <lists+intel-gfx@lfdr.de>; Mon,  7 Jun 2021 20:24:11 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 17B0D6E457;
	Mon,  7 Jun 2021 18:24:05 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from mga17.intel.com (mga17.intel.com [192.55.52.151])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 3016D6E9B3;
 Mon,  7 Jun 2021 18:24:03 +0000 (UTC)
IronPort-SDR: NWzHCcEfnSGUUSyDCzQRLAJWUNFe7koOAEEVZHw5hBBWCTcpB3U63gaO5pIf2NoWnLYIVHo1Kf
 UBiViAi0V2bw==
X-IronPort-AV: E=McAfee;i="6200,9189,10008"; a="185051938"
X-IronPort-AV: E=Sophos;i="5.83,255,1616482800"; d="scan'208";a="185051938"
Received: from fmsmga003.fm.intel.com ([10.253.24.29])
 by fmsmga107.fm.intel.com with ESMTP/TLS/ECDHE-RSA-AES256-GCM-SHA384;
 07 Jun 2021 11:24:03 -0700
IronPort-SDR: WT9yjL+vc7jdTrgqsAUCjAajZFt75r8inGb4/XnkSJAB3oNJKyWikZT+fHO9G4TzVcU/fEZr0q
 veSnxFV+zg1A==
X-IronPort-AV: E=Sophos;i="5.83,255,1616482800"; d="scan'208";a="476295028"
Received: from iwilsonx-mobl1.ger.corp.intel.com (HELO mwauld-desk1.intel.com)
 ([10.252.28.48])
 by fmsmga003-auth.fm.intel.com with ESMTP/TLS/ECDHE-RSA-AES256-GCM-SHA384;
 07 Jun 2021 11:24:01 -0700
From: Matthew Auld <matthew.auld@intel.com>
To: intel-gfx@lists.freedesktop.org
Date: Mon,  7 Jun 2021 19:22:05 +0100
Message-Id: <20210607182210.99036-2-matthew.auld@intel.com>
X-Mailer: git-send-email 2.26.3
In-Reply-To: <20210607182210.99036-1-matthew.auld@intel.com>
References: <20210607182210.99036-1-matthew.auld@intel.com>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH 1/6] drm/i915/ttm: add ttm_buddy_man
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.29
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Cc: =?UTF-8?q?Thomas=20Hellstr=C3=B6m?= <thomas.hellstrom@linux.intel.com>,
 dri-devel@lists.freedesktop.org
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

QWRkIGJhY2sgb3VyIHN0YW5kYWxvbmUgaTkxNV9idWRkeSBhbGxvY2F0b3IgYW5kIGludGVncmF0
ZSBpdCBpbnRvIGEKdHRtX3Jlc291cmNlX21hbmFnZXIuIFRoaXMgd2lsbCBwbHVnIGludG8gb3Vy
IHR0bSBiYWNrZW5kIGZvciBtYW5hZ2luZwpkZXZpY2UgbG9jYWwtbWVtb3J5IGluIHRoZSBuZXh0
IGNvdXBsZSBvZiBwYXRjaGVzLgoKU2lnbmVkLW9mZi1ieTogTWF0dGhldyBBdWxkIDxtYXR0aGV3
LmF1bGRAaW50ZWwuY29tPgpDYzogVGhvbWFzIEhlbGxzdHLDtm0gPHRob21hcy5oZWxsc3Ryb21A
bGludXguaW50ZWwuY29tPgotLS0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L01ha2VmaWxlICAgICAg
ICAgICAgICAgICB8ICAgMiArCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2J1ZGR5LmMgICAg
ICAgICAgICAgfCA0MTIgKysrKysrKysrCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2J1ZGR5
LmggICAgICAgICAgICAgfCAxMzMgKysrCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3R0bV9i
dWRkeV9tYW5hZ2VyLmMgfCAyNDYgKysrKysrCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3R0
bV9idWRkeV9tYW5hZ2VyLmggfCAgNTYgKysKIGRyaXZlcnMvZ3B1L2RybS9pOTE1L3NlbGZ0ZXN0
cy9pOTE1X2J1ZGR5LmMgICB8IDc4OSArKysrKysrKysrKysrKysrKysKIDYgZmlsZXMgY2hhbmdl
ZCwgMTYzOCBpbnNlcnRpb25zKCspCiBjcmVhdGUgbW9kZSAxMDA2NDQgZHJpdmVycy9ncHUvZHJt
L2k5MTUvaTkxNV9idWRkeS5jCiBjcmVhdGUgbW9kZSAxMDA2NDQgZHJpdmVycy9ncHUvZHJtL2k5
MTUvaTkxNV9idWRkeS5oCiBjcmVhdGUgbW9kZSAxMDA2NDQgZHJpdmVycy9ncHUvZHJtL2k5MTUv
aTkxNV90dG1fYnVkZHlfbWFuYWdlci5jCiBjcmVhdGUgbW9kZSAxMDA2NDQgZHJpdmVycy9ncHUv
ZHJtL2k5MTUvaTkxNV90dG1fYnVkZHlfbWFuYWdlci5oCiBjcmVhdGUgbW9kZSAxMDA2NDQgZHJp
dmVycy9ncHUvZHJtL2k5MTUvc2VsZnRlc3RzL2k5MTVfYnVkZHkuYwoKZGlmZiAtLWdpdCBhL2Ry
aXZlcnMvZ3B1L2RybS9pOTE1L01ha2VmaWxlIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvTWFrZWZp
bGUKaW5kZXggZjU3ZGZjNzRkNmNlLi42Yzg0ZTk2YWIyNmEgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMv
Z3B1L2RybS9pOTE1L01ha2VmaWxlCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L01ha2VmaWxl
CkBAIC0xNjIsNiArMTYyLDcgQEAgZ2VtLXkgKz0gXAogaTkxNS15ICs9IFwKIAkgICQoZ2VtLXkp
IFwKIAkgIGk5MTVfYWN0aXZlLm8gXAorCSAgaTkxNV9idWRkeS5vIFwKIAkgIGk5MTVfY21kX3Bh
cnNlci5vIFwKIAkgIGk5MTVfZ2VtX2V2aWN0Lm8gXAogCSAgaTkxNV9nZW1fZ3R0Lm8gXApAQCAt
MTcxLDYgKzE3Miw3IEBAIGk5MTUteSArPSBcCiAJICBpOTE1X3JlcXVlc3QubyBcCiAJICBpOTE1
X3NjaGVkdWxlci5vIFwKIAkgIGk5MTVfdHJhY2VfcG9pbnRzLm8gXAorCSAgaTkxNV90dG1fYnVk
ZHlfbWFuYWdlci5vIFwKIAkgIGk5MTVfdm1hLm8gXAogCSAgaW50ZWxfd29wY20ubwogCmRpZmYg
LS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2J1ZGR5LmMgYi9kcml2ZXJzL2dwdS9k
cm0vaTkxNS9pOTE1X2J1ZGR5LmMKbmV3IGZpbGUgbW9kZSAxMDA2NDQKaW5kZXggMDAwMDAwMDAw
MDAwLi4yOWRkN2QwMzEwYzEKLS0tIC9kZXYvbnVsbAorKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkx
NS9pOTE1X2J1ZGR5LmMKQEAgLTAsMCArMSw0MTIgQEAKKy8vIFNQRFgtTGljZW5zZS1JZGVudGlm
aWVyOiBNSVQKKy8qCisgKiBDb3B5cmlnaHQgwqkgMjAyMSBJbnRlbCBDb3Jwb3JhdGlvbgorICov
CisKKyNpbmNsdWRlIDxsaW51eC9rbWVtbGVhay5oPgorCisjaW5jbHVkZSAiaTkxNV9idWRkeS5o
IgorCisjaW5jbHVkZSAiaTkxNV9nZW0uaCIKKyNpbmNsdWRlICJpOTE1X3V0aWxzLmgiCisKK3N0
YXRpYyBzdHJ1Y3QgaTkxNV9idWRkeV9ibG9jayAqaTkxNV9ibG9ja19hbGxvYyhzdHJ1Y3QgaTkx
NV9idWRkeV9tbSAqbW0sCisJCQkJCQkgc3RydWN0IGk5MTVfYnVkZHlfYmxvY2sgKnBhcmVudCwK
KwkJCQkJCSB1bnNpZ25lZCBpbnQgb3JkZXIsCisJCQkJCQkgdTY0IG9mZnNldCkKK3sKKwlzdHJ1
Y3QgaTkxNV9idWRkeV9ibG9jayAqYmxvY2s7CisKKwlHRU1fQlVHX09OKG9yZGVyID4gSTkxNV9C
VUREWV9NQVhfT1JERVIpOworCisJYmxvY2sgPSBrbWVtX2NhY2hlX3phbGxvYyhtbS0+c2xhYl9i
bG9ja3MsIEdGUF9LRVJORUwpOworCWlmICghYmxvY2spCisJCXJldHVybiBOVUxMOworCisJYmxv
Y2stPmhlYWRlciA9IG9mZnNldDsKKwlibG9jay0+aGVhZGVyIHw9IG9yZGVyOworCWJsb2NrLT5w
YXJlbnQgPSBwYXJlbnQ7CisKKwlHRU1fQlVHX09OKGJsb2NrLT5oZWFkZXIgJiBJOTE1X0JVRERZ
X0hFQURFUl9VTlVTRUQpOworCXJldHVybiBibG9jazsKK30KKworc3RhdGljIHZvaWQgaTkxNV9i
bG9ja19mcmVlKHN0cnVjdCBpOTE1X2J1ZGR5X21tICptbSwKKwkJCSAgICBzdHJ1Y3QgaTkxNV9i
dWRkeV9ibG9jayAqYmxvY2spCit7CisJa21lbV9jYWNoZV9mcmVlKG1tLT5zbGFiX2Jsb2Nrcywg
YmxvY2spOworfQorCitzdGF0aWMgdm9pZCBtYXJrX2FsbG9jYXRlZChzdHJ1Y3QgaTkxNV9idWRk
eV9ibG9jayAqYmxvY2spCit7CisJYmxvY2stPmhlYWRlciAmPSB+STkxNV9CVUREWV9IRUFERVJf
U1RBVEU7CisJYmxvY2stPmhlYWRlciB8PSBJOTE1X0JVRERZX0FMTE9DQVRFRDsKKworCWxpc3Rf
ZGVsKCZibG9jay0+bGluayk7Cit9CisKK3N0YXRpYyB2b2lkIG1hcmtfZnJlZShzdHJ1Y3QgaTkx
NV9idWRkeV9tbSAqbW0sCisJCSAgICAgIHN0cnVjdCBpOTE1X2J1ZGR5X2Jsb2NrICpibG9jaykK
K3sKKwlibG9jay0+aGVhZGVyICY9IH5JOTE1X0JVRERZX0hFQURFUl9TVEFURTsKKwlibG9jay0+
aGVhZGVyIHw9IEk5MTVfQlVERFlfRlJFRTsKKworCWxpc3RfYWRkKCZibG9jay0+bGluaywKKwkJ
ICZtbS0+ZnJlZV9saXN0W2k5MTVfYnVkZHlfYmxvY2tfb3JkZXIoYmxvY2spXSk7Cit9CisKK3N0
YXRpYyB2b2lkIG1hcmtfc3BsaXQoc3RydWN0IGk5MTVfYnVkZHlfYmxvY2sgKmJsb2NrKQorewor
CWJsb2NrLT5oZWFkZXIgJj0gfkk5MTVfQlVERFlfSEVBREVSX1NUQVRFOworCWJsb2NrLT5oZWFk
ZXIgfD0gSTkxNV9CVUREWV9TUExJVDsKKworCWxpc3RfZGVsKCZibG9jay0+bGluayk7Cit9CisK
K2ludCBpOTE1X2J1ZGR5X2luaXQoc3RydWN0IGk5MTVfYnVkZHlfbW0gKm1tLCB1NjQgc2l6ZSwg
dTY0IGNodW5rX3NpemUpCit7CisJdW5zaWduZWQgaW50IGk7CisJdTY0IG9mZnNldDsKKworCWlm
IChzaXplIDwgY2h1bmtfc2l6ZSkKKwkJcmV0dXJuIC1FSU5WQUw7CisKKwlpZiAoY2h1bmtfc2l6
ZSA8IFBBR0VfU0laRSkKKwkJcmV0dXJuIC1FSU5WQUw7CisKKwlpZiAoIWlzX3Bvd2VyX29mXzIo
Y2h1bmtfc2l6ZSkpCisJCXJldHVybiAtRUlOVkFMOworCisJc2l6ZSA9IHJvdW5kX2Rvd24oc2l6
ZSwgY2h1bmtfc2l6ZSk7CisKKwltbS0+c2l6ZSA9IHNpemU7CisJbW0tPmNodW5rX3NpemUgPSBj
aHVua19zaXplOworCW1tLT5tYXhfb3JkZXIgPSBpbG9nMihzaXplKSAtIGlsb2cyKGNodW5rX3Np
emUpOworCisJR0VNX0JVR19PTihtbS0+bWF4X29yZGVyID4gSTkxNV9CVUREWV9NQVhfT1JERVIp
OworCisJbW0tPnNsYWJfYmxvY2tzID0gS01FTV9DQUNIRShpOTE1X2J1ZGR5X2Jsb2NrLCBTTEFC
X0hXQ0FDSEVfQUxJR04pOworCWlmICghbW0tPnNsYWJfYmxvY2tzKQorCQlyZXR1cm4gLUVOT01F
TTsKKworCW1tLT5mcmVlX2xpc3QgPSBrbWFsbG9jX2FycmF5KG1tLT5tYXhfb3JkZXIgKyAxLAor
CQkJCSAgICAgIHNpemVvZihzdHJ1Y3QgbGlzdF9oZWFkKSwKKwkJCQkgICAgICBHRlBfS0VSTkVM
KTsKKwlpZiAoIW1tLT5mcmVlX2xpc3QpCisJCWdvdG8gb3V0X2Rlc3Ryb3lfc2xhYjsKKworCWZv
ciAoaSA9IDA7IGkgPD0gbW0tPm1heF9vcmRlcjsgKytpKQorCQlJTklUX0xJU1RfSEVBRCgmbW0t
PmZyZWVfbGlzdFtpXSk7CisKKwltbS0+bl9yb290cyA9IGh3ZWlnaHQ2NChzaXplKTsKKworCW1t
LT5yb290cyA9IGttYWxsb2NfYXJyYXkobW0tPm5fcm9vdHMsCisJCQkJICBzaXplb2Yoc3RydWN0
IGk5MTVfYnVkZHlfYmxvY2sgKiksCisJCQkJICBHRlBfS0VSTkVMKTsKKwlpZiAoIW1tLT5yb290
cykKKwkJZ290byBvdXRfZnJlZV9saXN0OworCisJb2Zmc2V0ID0gMDsKKwlpID0gMDsKKworCS8q
CisJICogU3BsaXQgaW50byBwb3dlci1vZi10d28gYmxvY2tzLCBpbiBjYXNlIHdlIGFyZSBnaXZl
biBhIHNpemUgdGhhdCBpcworCSAqIG5vdCBpdHNlbGYgYSBwb3dlci1vZi10d28uCisJICovCisJ
ZG8geworCQlzdHJ1Y3QgaTkxNV9idWRkeV9ibG9jayAqcm9vdDsKKwkJdW5zaWduZWQgaW50IG9y
ZGVyOworCQl1NjQgcm9vdF9zaXplOworCisJCXJvb3Rfc2l6ZSA9IHJvdW5kZG93bl9wb3dfb2Zf
dHdvKHNpemUpOworCQlvcmRlciA9IGlsb2cyKHJvb3Rfc2l6ZSkgLSBpbG9nMihjaHVua19zaXpl
KTsKKworCQlyb290ID0gaTkxNV9ibG9ja19hbGxvYyhtbSwgTlVMTCwgb3JkZXIsIG9mZnNldCk7
CisJCWlmICghcm9vdCkKKwkJCWdvdG8gb3V0X2ZyZWVfcm9vdHM7CisKKwkJbWFya19mcmVlKG1t
LCByb290KTsKKworCQlHRU1fQlVHX09OKGkgPiBtbS0+bWF4X29yZGVyKTsKKwkJR0VNX0JVR19P
TihpOTE1X2J1ZGR5X2Jsb2NrX3NpemUobW0sIHJvb3QpIDwgY2h1bmtfc2l6ZSk7CisKKwkJbW0t
PnJvb3RzW2ldID0gcm9vdDsKKworCQlvZmZzZXQgKz0gcm9vdF9zaXplOworCQlzaXplIC09IHJv
b3Rfc2l6ZTsKKwkJaSsrOworCX0gd2hpbGUgKHNpemUpOworCisJcmV0dXJuIDA7CisKK291dF9m
cmVlX3Jvb3RzOgorCXdoaWxlIChpLS0pCisJCWk5MTVfYmxvY2tfZnJlZShtbSwgbW0tPnJvb3Rz
W2ldKTsKKwlrZnJlZShtbS0+cm9vdHMpOworb3V0X2ZyZWVfbGlzdDoKKwlrZnJlZShtbS0+ZnJl
ZV9saXN0KTsKK291dF9kZXN0cm95X3NsYWI6CisJa21lbV9jYWNoZV9kZXN0cm95KG1tLT5zbGFi
X2Jsb2Nrcyk7CisJcmV0dXJuIC1FTk9NRU07Cit9CisKK3ZvaWQgaTkxNV9idWRkeV9maW5pKHN0
cnVjdCBpOTE1X2J1ZGR5X21tICptbSkKK3sKKwlpbnQgaTsKKworCWZvciAoaSA9IDA7IGkgPCBt
bS0+bl9yb290czsgKytpKSB7CisJCUdFTV9XQVJOX09OKCFpOTE1X2J1ZGR5X2Jsb2NrX2lzX2Zy
ZWUobW0tPnJvb3RzW2ldKSk7CisJCWk5MTVfYmxvY2tfZnJlZShtbSwgbW0tPnJvb3RzW2ldKTsK
Kwl9CisKKwlrZnJlZShtbS0+cm9vdHMpOworCWtmcmVlKG1tLT5mcmVlX2xpc3QpOworCWttZW1f
Y2FjaGVfZGVzdHJveShtbS0+c2xhYl9ibG9ja3MpOworfQorCitzdGF0aWMgaW50IHNwbGl0X2Js
b2NrKHN0cnVjdCBpOTE1X2J1ZGR5X21tICptbSwKKwkJICAgICAgIHN0cnVjdCBpOTE1X2J1ZGR5
X2Jsb2NrICpibG9jaykKK3sKKwl1bnNpZ25lZCBpbnQgYmxvY2tfb3JkZXIgPSBpOTE1X2J1ZGR5
X2Jsb2NrX29yZGVyKGJsb2NrKSAtIDE7CisJdTY0IG9mZnNldCA9IGk5MTVfYnVkZHlfYmxvY2tf
b2Zmc2V0KGJsb2NrKTsKKworCUdFTV9CVUdfT04oIWk5MTVfYnVkZHlfYmxvY2tfaXNfZnJlZShi
bG9jaykpOworCUdFTV9CVUdfT04oIWk5MTVfYnVkZHlfYmxvY2tfb3JkZXIoYmxvY2spKTsKKwor
CWJsb2NrLT5sZWZ0ID0gaTkxNV9ibG9ja19hbGxvYyhtbSwgYmxvY2ssIGJsb2NrX29yZGVyLCBv
ZmZzZXQpOworCWlmICghYmxvY2stPmxlZnQpCisJCXJldHVybiAtRU5PTUVNOworCisJYmxvY2st
PnJpZ2h0ID0gaTkxNV9ibG9ja19hbGxvYyhtbSwgYmxvY2ssIGJsb2NrX29yZGVyLAorCQkJCQlv
ZmZzZXQgKyAobW0tPmNodW5rX3NpemUgPDwgYmxvY2tfb3JkZXIpKTsKKwlpZiAoIWJsb2NrLT5y
aWdodCkgeworCQlpOTE1X2Jsb2NrX2ZyZWUobW0sIGJsb2NrLT5sZWZ0KTsKKwkJcmV0dXJuIC1F
Tk9NRU07CisJfQorCisJbWFya19mcmVlKG1tLCBibG9jay0+bGVmdCk7CisJbWFya19mcmVlKG1t
LCBibG9jay0+cmlnaHQpOworCisJbWFya19zcGxpdChibG9jayk7CisKKwlyZXR1cm4gMDsKK30K
Kworc3RhdGljIHN0cnVjdCBpOTE1X2J1ZGR5X2Jsb2NrICoKK2dldF9idWRkeShzdHJ1Y3QgaTkx
NV9idWRkeV9ibG9jayAqYmxvY2spCit7CisJc3RydWN0IGk5MTVfYnVkZHlfYmxvY2sgKnBhcmVu
dDsKKworCXBhcmVudCA9IGJsb2NrLT5wYXJlbnQ7CisJaWYgKCFwYXJlbnQpCisJCXJldHVybiBO
VUxMOworCisJaWYgKHBhcmVudC0+bGVmdCA9PSBibG9jaykKKwkJcmV0dXJuIHBhcmVudC0+cmln
aHQ7CisKKwlyZXR1cm4gcGFyZW50LT5sZWZ0OworfQorCitzdGF0aWMgdm9pZCBfX2k5MTVfYnVk
ZHlfZnJlZShzdHJ1Y3QgaTkxNV9idWRkeV9tbSAqbW0sCisJCQkgICAgICBzdHJ1Y3QgaTkxNV9i
dWRkeV9ibG9jayAqYmxvY2spCit7CisJc3RydWN0IGk5MTVfYnVkZHlfYmxvY2sgKnBhcmVudDsK
KworCXdoaWxlICgocGFyZW50ID0gYmxvY2stPnBhcmVudCkpIHsKKwkJc3RydWN0IGk5MTVfYnVk
ZHlfYmxvY2sgKmJ1ZGR5OworCisJCWJ1ZGR5ID0gZ2V0X2J1ZGR5KGJsb2NrKTsKKworCQlpZiAo
IWk5MTVfYnVkZHlfYmxvY2tfaXNfZnJlZShidWRkeSkpCisJCQlicmVhazsKKworCQlsaXN0X2Rl
bCgmYnVkZHktPmxpbmspOworCisJCWk5MTVfYmxvY2tfZnJlZShtbSwgYmxvY2spOworCQlpOTE1
X2Jsb2NrX2ZyZWUobW0sIGJ1ZGR5KTsKKworCQlibG9jayA9IHBhcmVudDsKKwl9CisKKwltYXJr
X2ZyZWUobW0sIGJsb2NrKTsKK30KKwordm9pZCBpOTE1X2J1ZGR5X2ZyZWUoc3RydWN0IGk5MTVf
YnVkZHlfbW0gKm1tLAorCQkgICAgIHN0cnVjdCBpOTE1X2J1ZGR5X2Jsb2NrICpibG9jaykKK3sK
KwlHRU1fQlVHX09OKCFpOTE1X2J1ZGR5X2Jsb2NrX2lzX2FsbG9jYXRlZChibG9jaykpOworCV9f
aTkxNV9idWRkeV9mcmVlKG1tLCBibG9jayk7Cit9CisKK3ZvaWQgaTkxNV9idWRkeV9mcmVlX2xp
c3Qoc3RydWN0IGk5MTVfYnVkZHlfbW0gKm1tLCBzdHJ1Y3QgbGlzdF9oZWFkICpvYmplY3RzKQor
eworCXN0cnVjdCBpOTE1X2J1ZGR5X2Jsb2NrICpibG9jaywgKm9uOworCisJbGlzdF9mb3JfZWFj
aF9lbnRyeV9zYWZlKGJsb2NrLCBvbiwgb2JqZWN0cywgbGluaykgeworCQlpOTE1X2J1ZGR5X2Zy
ZWUobW0sIGJsb2NrKTsKKwkJY29uZF9yZXNjaGVkKCk7CisJfQorCUlOSVRfTElTVF9IRUFEKG9i
amVjdHMpOworfQorCisvKgorICogQWxsb2NhdGUgcG93ZXItb2YtdHdvIGJsb2NrLiBUaGUgb3Jk
ZXIgdmFsdWUgaGVyZSB0cmFuc2xhdGVzIHRvOgorICoKKyAqICAgMCA9IDJeMCAqIG1tLT5jaHVu
a19zaXplCisgKiAgIDEgPSAyXjEgKiBtbS0+Y2h1bmtfc2l6ZQorICogICAyID0gMl4yICogbW0t
PmNodW5rX3NpemUKKyAqICAgLi4uCisgKi8KK3N0cnVjdCBpOTE1X2J1ZGR5X2Jsb2NrICoKK2k5
MTVfYnVkZHlfYWxsb2Moc3RydWN0IGk5MTVfYnVkZHlfbW0gKm1tLCB1bnNpZ25lZCBpbnQgb3Jk
ZXIpCit7CisJc3RydWN0IGk5MTVfYnVkZHlfYmxvY2sgKmJsb2NrID0gTlVMTDsKKwl1bnNpZ25l
ZCBpbnQgaTsKKwlpbnQgZXJyOworCisJZm9yIChpID0gb3JkZXI7IGkgPD0gbW0tPm1heF9vcmRl
cjsgKytpKSB7CisJCWJsb2NrID0gbGlzdF9maXJzdF9lbnRyeV9vcl9udWxsKCZtbS0+ZnJlZV9s
aXN0W2ldLAorCQkJCQkJIHN0cnVjdCBpOTE1X2J1ZGR5X2Jsb2NrLAorCQkJCQkJIGxpbmspOwor
CQlpZiAoYmxvY2spCisJCQlicmVhazsKKwl9CisKKwlpZiAoIWJsb2NrKQorCQlyZXR1cm4gRVJS
X1BUUigtRU5PU1BDKTsKKworCUdFTV9CVUdfT04oIWk5MTVfYnVkZHlfYmxvY2tfaXNfZnJlZShi
bG9jaykpOworCisJd2hpbGUgKGkgIT0gb3JkZXIpIHsKKwkJZXJyID0gc3BsaXRfYmxvY2sobW0s
IGJsb2NrKTsKKwkJaWYgKHVubGlrZWx5KGVycikpCisJCQlnb3RvIG91dF9mcmVlOworCisJCS8q
IEdvIGxvdyAqLworCQlibG9jayA9IGJsb2NrLT5sZWZ0OworCQlpLS07CisJfQorCisJbWFya19h
bGxvY2F0ZWQoYmxvY2spOworCWttZW1sZWFrX3VwZGF0ZV90cmFjZShibG9jayk7CisJcmV0dXJu
IGJsb2NrOworCitvdXRfZnJlZToKKwlpZiAoaSAhPSBvcmRlcikKKwkJX19pOTE1X2J1ZGR5X2Zy
ZWUobW0sIGJsb2NrKTsKKwlyZXR1cm4gRVJSX1BUUihlcnIpOworfQorCitzdGF0aWMgaW5saW5l
IGJvb2wgb3ZlcmxhcHModTY0IHMxLCB1NjQgZTEsIHU2NCBzMiwgdTY0IGUyKQoreworCXJldHVy
biBzMSA8PSBlMiAmJiBlMSA+PSBzMjsKK30KKworc3RhdGljIGlubGluZSBib29sIGNvbnRhaW5z
KHU2NCBzMSwgdTY0IGUxLCB1NjQgczIsIHU2NCBlMikKK3sKKwlyZXR1cm4gczEgPD0gczIgJiYg
ZTEgPj0gZTI7Cit9CisKKy8qCisgKiBBbGxvY2F0ZSByYW5nZS4gTm90ZSB0aGF0IGl0J3Mgc2Fm
ZSB0byBjaGFpbiB0b2dldGhlciBtdWx0aXBsZSBhbGxvY19yYW5nZXMKKyAqIHdpdGggdGhlIHNh
bWUgYmxvY2tzIGxpc3QuCisgKgorICogSW50ZW5kZWQgZm9yIHByZS1hbGxvY2F0aW5nIHBvcnRp
b25zIG9mIHRoZSBhZGRyZXNzIHNwYWNlLCBmb3IgZXhhbXBsZSB0bworICogcmVzZXJ2ZSBhIGJs
b2NrIGZvciB0aGUgaW5pdGlhbCBmcmFtZWJ1ZmZlciBvciBzaW1pbGFyLCBoZW5jZSB0aGUgZXhw
ZWN0YXRpb24KKyAqIGhlcmUgaXMgdGhhdCBpOTE1X2J1ZGR5X2FsbG9jKCkgaXMgc3RpbGwgdGhl
IG1haW4gdmVoaWNsZSBmb3IKKyAqIGFsbG9jYXRpb25zLCBzbyBpZiB0aGF0J3Mgbm90IHRoZSBj
YXNlIHRoZW4gdGhlIGRybV9tbSByYW5nZSBhbGxvY2F0b3IgaXMKKyAqIHByb2JhYmx5IGEgbXVj
aCBiZXR0ZXIgZml0LCBhbmQgc28geW91IHNob3VsZCBwcm9iYWJseSBnbyB1c2UgdGhhdCBpbnN0
ZWFkLgorICovCitpbnQgaTkxNV9idWRkeV9hbGxvY19yYW5nZShzdHJ1Y3QgaTkxNV9idWRkeV9t
bSAqbW0sCisJCQkgICBzdHJ1Y3QgbGlzdF9oZWFkICpibG9ja3MsCisJCQkgICB1NjQgc3RhcnQs
IHU2NCBzaXplKQoreworCXN0cnVjdCBpOTE1X2J1ZGR5X2Jsb2NrICpibG9jazsKKwlzdHJ1Y3Qg
aTkxNV9idWRkeV9ibG9jayAqYnVkZHk7CisJTElTVF9IRUFEKGFsbG9jYXRlZCk7CisJTElTVF9I
RUFEKGRmcyk7CisJdTY0IGVuZDsKKwlpbnQgZXJyOworCWludCBpOworCisJaWYgKHNpemUgPCBt
bS0+Y2h1bmtfc2l6ZSkKKwkJcmV0dXJuIC1FSU5WQUw7CisKKwlpZiAoIUlTX0FMSUdORUQoc2l6
ZSB8IHN0YXJ0LCBtbS0+Y2h1bmtfc2l6ZSkpCisJCXJldHVybiAtRUlOVkFMOworCisJaWYgKHJh
bmdlX292ZXJmbG93cyhzdGFydCwgc2l6ZSwgbW0tPnNpemUpKQorCQlyZXR1cm4gLUVJTlZBTDsK
KworCWZvciAoaSA9IDA7IGkgPCBtbS0+bl9yb290czsgKytpKQorCQlsaXN0X2FkZF90YWlsKCZt
bS0+cm9vdHNbaV0tPnRtcF9saW5rLCAmZGZzKTsKKworCWVuZCA9IHN0YXJ0ICsgc2l6ZSAtIDE7
CisKKwlkbyB7CisJCXU2NCBibG9ja19zdGFydDsKKwkJdTY0IGJsb2NrX2VuZDsKKworCQlibG9j
ayA9IGxpc3RfZmlyc3RfZW50cnlfb3JfbnVsbCgmZGZzLAorCQkJCQkJIHN0cnVjdCBpOTE1X2J1
ZGR5X2Jsb2NrLAorCQkJCQkJIHRtcF9saW5rKTsKKwkJaWYgKCFibG9jaykKKwkJCWJyZWFrOwor
CisJCWxpc3RfZGVsKCZibG9jay0+dG1wX2xpbmspOworCisJCWJsb2NrX3N0YXJ0ID0gaTkxNV9i
dWRkeV9ibG9ja19vZmZzZXQoYmxvY2spOworCQlibG9ja19lbmQgPSBibG9ja19zdGFydCArIGk5
MTVfYnVkZHlfYmxvY2tfc2l6ZShtbSwgYmxvY2spIC0gMTsKKworCQlpZiAoIW92ZXJsYXBzKHN0
YXJ0LCBlbmQsIGJsb2NrX3N0YXJ0LCBibG9ja19lbmQpKQorCQkJY29udGludWU7CisKKwkJaWYg
KGk5MTVfYnVkZHlfYmxvY2tfaXNfYWxsb2NhdGVkKGJsb2NrKSkgeworCQkJZXJyID0gLUVOT1NQ
QzsKKwkJCWdvdG8gZXJyX2ZyZWU7CisJCX0KKworCQlpZiAoY29udGFpbnMoc3RhcnQsIGVuZCwg
YmxvY2tfc3RhcnQsIGJsb2NrX2VuZCkpIHsKKwkJCWlmICghaTkxNV9idWRkeV9ibG9ja19pc19m
cmVlKGJsb2NrKSkgeworCQkJCWVyciA9IC1FTk9TUEM7CisJCQkJZ290byBlcnJfZnJlZTsKKwkJ
CX0KKworCQkJbWFya19hbGxvY2F0ZWQoYmxvY2spOworCQkJbGlzdF9hZGRfdGFpbCgmYmxvY2st
PmxpbmssICZhbGxvY2F0ZWQpOworCQkJY29udGludWU7CisJCX0KKworCQlpZiAoIWk5MTVfYnVk
ZHlfYmxvY2tfaXNfc3BsaXQoYmxvY2spKSB7CisJCQllcnIgPSBzcGxpdF9ibG9jayhtbSwgYmxv
Y2spOworCQkJaWYgKHVubGlrZWx5KGVycikpCisJCQkJZ290byBlcnJfdW5kbzsKKwkJfQorCisJ
CWxpc3RfYWRkKCZibG9jay0+cmlnaHQtPnRtcF9saW5rLCAmZGZzKTsKKwkJbGlzdF9hZGQoJmJs
b2NrLT5sZWZ0LT50bXBfbGluaywgJmRmcyk7CisJfSB3aGlsZSAoMSk7CisKKwlsaXN0X3NwbGlj
ZV90YWlsKCZhbGxvY2F0ZWQsIGJsb2Nrcyk7CisJcmV0dXJuIDA7CisKK2Vycl91bmRvOgorCS8q
CisJICogV2UgcmVhbGx5IGRvbid0IHdhbnQgdG8gbGVhdmUgYXJvdW5kIGEgYnVuY2ggb2Ygc3Bs
aXQgYmxvY2tzLCBzaW5jZQorCSAqIGJpZ2dlciBpcyBiZXR0ZXIsIHNvIG1ha2Ugc3VyZSB3ZSBt
ZXJnZSBldmVyeXRoaW5nIGJhY2sgYmVmb3JlIHdlCisJICogZnJlZSB0aGUgYWxsb2NhdGVkIGJs
b2Nrcy4KKwkgKi8KKwlidWRkeSA9IGdldF9idWRkeShibG9jayk7CisJaWYgKGJ1ZGR5ICYmCisJ
ICAgIChpOTE1X2J1ZGR5X2Jsb2NrX2lzX2ZyZWUoYmxvY2spICYmCisJICAgICBpOTE1X2J1ZGR5
X2Jsb2NrX2lzX2ZyZWUoYnVkZHkpKSkKKwkJX19pOTE1X2J1ZGR5X2ZyZWUobW0sIGJsb2NrKTsK
KworZXJyX2ZyZWU6CisJaTkxNV9idWRkeV9mcmVlX2xpc3QobW0sICZhbGxvY2F0ZWQpOworCXJl
dHVybiBlcnI7Cit9CisKKyNpZiBJU19FTkFCTEVEKENPTkZJR19EUk1fSTkxNV9TRUxGVEVTVCkK
KyNpbmNsdWRlICJzZWxmdGVzdHMvaTkxNV9idWRkeS5jIgorI2VuZGlmCmRpZmYgLS1naXQgYS9k
cml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2J1ZGR5LmggYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9p
OTE1X2J1ZGR5LmgKbmV3IGZpbGUgbW9kZSAxMDA2NDQKaW5kZXggMDAwMDAwMDAwMDAwLi4zN2Y4
YzQyMDcxZDEKLS0tIC9kZXYvbnVsbAorKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2J1
ZGR5LmgKQEAgLTAsMCArMSwxMzMgQEAKKy8qIFNQRFgtTGljZW5zZS1JZGVudGlmaWVyOiBNSVQg
Ki8KKy8qCisgKiBDb3B5cmlnaHQgwqkgMjAyMSBJbnRlbCBDb3Jwb3JhdGlvbgorICovCisKKyNp
Zm5kZWYgX19JOTE1X0JVRERZX0hfXworI2RlZmluZSBfX0k5MTVfQlVERFlfSF9fCisKKyNpbmNs
dWRlIDxsaW51eC9iaXRvcHMuaD4KKyNpbmNsdWRlIDxsaW51eC9saXN0Lmg+CisjaW5jbHVkZSA8
bGludXgvc2xhYi5oPgorCitzdHJ1Y3QgaTkxNV9idWRkeV9ibG9jayB7CisjZGVmaW5lIEk5MTVf
QlVERFlfSEVBREVSX09GRlNFVCBHRU5NQVNLX1VMTCg2MywgMTIpCisjZGVmaW5lIEk5MTVfQlVE
RFlfSEVBREVSX1NUQVRFICBHRU5NQVNLX1VMTCgxMSwgMTApCisjZGVmaW5lICAgSTkxNV9CVURE
WV9BTExPQ0FURUQJICAgKDEgPDwgMTApCisjZGVmaW5lICAgSTkxNV9CVUREWV9GUkVFCSAgICgy
IDw8IDEwKQorI2RlZmluZSAgIEk5MTVfQlVERFlfU1BMSVQJICAgKDMgPDwgMTApCisvKiBGcmVl
IHRvIGJlIHVzZWQsIGlmIG5lZWRlZCBpbiB0aGUgZnV0dXJlICovCisjZGVmaW5lIEk5MTVfQlVE
RFlfSEVBREVSX1VOVVNFRCBHRU5NQVNLX1VMTCg5LCA2KQorI2RlZmluZSBJOTE1X0JVRERZX0hF
QURFUl9PUkRFUiAgR0VOTUFTS19VTEwoNSwgMCkKKwl1NjQgaGVhZGVyOworCisJc3RydWN0IGk5
MTVfYnVkZHlfYmxvY2sgKmxlZnQ7CisJc3RydWN0IGk5MTVfYnVkZHlfYmxvY2sgKnJpZ2h0Owor
CXN0cnVjdCBpOTE1X2J1ZGR5X2Jsb2NrICpwYXJlbnQ7CisKKwl2b2lkICpwcml2YXRlOyAvKiBv
d25lZCBieSBjcmVhdG9yICovCisKKwkvKgorCSAqIFdoaWxlIHRoZSBibG9jayBpcyBhbGxvY2F0
ZWQgYnkgdGhlIHVzZXIgdGhyb3VnaCBpOTE1X2J1ZGR5X2FsbG9jKiwKKwkgKiB0aGUgdXNlciBo
YXMgb3duZXJzaGlwIG9mIHRoZSBsaW5rLCBmb3IgZXhhbXBsZSB0byBtYWludGFpbiB3aXRoaW4K
KwkgKiBhIGxpc3QsIGlmIHNvIGRlc2lyZWQuIEFzIHNvb24gYXMgdGhlIGJsb2NrIGlzIGZyZWVk
IHdpdGgKKwkgKiBpOTE1X2J1ZGR5X2ZyZWUqIG93bmVyc2hpcCBpcyBnaXZlbiBiYWNrIHRvIHRo
ZSBtbS4KKwkgKi8KKwlzdHJ1Y3QgbGlzdF9oZWFkIGxpbms7CisJc3RydWN0IGxpc3RfaGVhZCB0
bXBfbGluazsKK307CisKKy8qIE9yZGVyLXplcm8gbXVzdCBiZSBhdCBsZWFzdCBQQUdFX1NJWkUg
Ki8KKyNkZWZpbmUgSTkxNV9CVUREWV9NQVhfT1JERVIgKDYzIC0gUEFHRV9TSElGVCkKKworLyoK
KyAqIEJpbmFyeSBCdWRkeSBTeXN0ZW0uCisgKgorICogTG9ja2luZyBzaG91bGQgYmUgaGFuZGxl
ZCBieSB0aGUgdXNlciwgYSBzaW1wbGUgbXV0ZXggYXJvdW5kCisgKiBpOTE1X2J1ZGR5X2FsbG9j
KiBhbmQgaTkxNV9idWRkeV9mcmVlKiBzaG91bGQgc3VmZmljZS4KKyAqLworc3RydWN0IGk5MTVf
YnVkZHlfbW0geworCXN0cnVjdCBrbWVtX2NhY2hlICpzbGFiX2Jsb2NrczsKKwkvKiBNYWludGFp
biBhIGZyZWUgbGlzdCBmb3IgZWFjaCBvcmRlci4gKi8KKwlzdHJ1Y3QgbGlzdF9oZWFkICpmcmVl
X2xpc3Q7CisKKwkvKgorCSAqIE1haW50YWluIGV4cGxpY2l0IGJpbmFyeSB0cmVlKHMpIHRvIHRy
YWNrIHRoZSBhbGxvY2F0aW9uIG9mIHRoZQorCSAqIGFkZHJlc3Mgc3BhY2UuIFRoaXMgZ2l2ZXMg
dXMgYSBzaW1wbGUgd2F5IG9mIGZpbmRpbmcgYSBidWRkeSBibG9jaworCSAqIGFuZCBwZXJmb3Jt
aW5nIHRoZSBwb3RlbnRpYWxseSByZWN1cnNpdmUgbWVyZ2Ugc3RlcCB3aGVuIGZyZWVpbmcgYQor
CSAqIGJsb2NrLiAgTm9kZXMgYXJlIGVpdGhlciBhbGxvY2F0ZWQgb3IgZnJlZSwgaW4gd2hpY2gg
Y2FzZSB0aGV5IHdpbGwKKwkgKiBhbHNvIGV4aXN0IG9uIHRoZSByZXNwZWN0aXZlIGZyZWUgbGlz
dC4KKwkgKi8KKwlzdHJ1Y3QgaTkxNV9idWRkeV9ibG9jayAqKnJvb3RzOworCisJLyoKKwkgKiBB
bnl0aGluZyBmcm9tIGhlcmUgaXMgcHVibGljLCBhbmQgcmVtYWlucyBzdGF0aWMgZm9yIHRoZSBs
aWZldGltZSBvZgorCSAqIHRoZSBtbS4gRXZlcnl0aGluZyBhYm92ZSBpcyBjb25zaWRlcmVkIGRv
LW5vdC10b3VjaC4KKwkgKi8KKwl1bnNpZ25lZCBpbnQgbl9yb290czsKKwl1bnNpZ25lZCBpbnQg
bWF4X29yZGVyOworCisJLyogTXVzdCBiZSBhdCBsZWFzdCBQQUdFX1NJWkUgKi8KKwl1NjQgY2h1
bmtfc2l6ZTsKKwl1NjQgc2l6ZTsKK307CisKK3N0YXRpYyBpbmxpbmUgdTY0CitpOTE1X2J1ZGR5
X2Jsb2NrX29mZnNldChzdHJ1Y3QgaTkxNV9idWRkeV9ibG9jayAqYmxvY2spCit7CisJcmV0dXJu
IGJsb2NrLT5oZWFkZXIgJiBJOTE1X0JVRERZX0hFQURFUl9PRkZTRVQ7Cit9CisKK3N0YXRpYyBp
bmxpbmUgdW5zaWduZWQgaW50CitpOTE1X2J1ZGR5X2Jsb2NrX29yZGVyKHN0cnVjdCBpOTE1X2J1
ZGR5X2Jsb2NrICpibG9jaykKK3sKKwlyZXR1cm4gYmxvY2stPmhlYWRlciAmIEk5MTVfQlVERFlf
SEVBREVSX09SREVSOworfQorCitzdGF0aWMgaW5saW5lIHVuc2lnbmVkIGludAoraTkxNV9idWRk
eV9ibG9ja19zdGF0ZShzdHJ1Y3QgaTkxNV9idWRkeV9ibG9jayAqYmxvY2spCit7CisJcmV0dXJu
IGJsb2NrLT5oZWFkZXIgJiBJOTE1X0JVRERZX0hFQURFUl9TVEFURTsKK30KKworc3RhdGljIGlu
bGluZSBib29sCitpOTE1X2J1ZGR5X2Jsb2NrX2lzX2FsbG9jYXRlZChzdHJ1Y3QgaTkxNV9idWRk
eV9ibG9jayAqYmxvY2spCit7CisJcmV0dXJuIGk5MTVfYnVkZHlfYmxvY2tfc3RhdGUoYmxvY2sp
ID09IEk5MTVfQlVERFlfQUxMT0NBVEVEOworfQorCitzdGF0aWMgaW5saW5lIGJvb2wKK2k5MTVf
YnVkZHlfYmxvY2tfaXNfZnJlZShzdHJ1Y3QgaTkxNV9idWRkeV9ibG9jayAqYmxvY2spCit7CisJ
cmV0dXJuIGk5MTVfYnVkZHlfYmxvY2tfc3RhdGUoYmxvY2spID09IEk5MTVfQlVERFlfRlJFRTsK
K30KKworc3RhdGljIGlubGluZSBib29sCitpOTE1X2J1ZGR5X2Jsb2NrX2lzX3NwbGl0KHN0cnVj
dCBpOTE1X2J1ZGR5X2Jsb2NrICpibG9jaykKK3sKKwlyZXR1cm4gaTkxNV9idWRkeV9ibG9ja19z
dGF0ZShibG9jaykgPT0gSTkxNV9CVUREWV9TUExJVDsKK30KKworc3RhdGljIGlubGluZSB1NjQK
K2k5MTVfYnVkZHlfYmxvY2tfc2l6ZShzdHJ1Y3QgaTkxNV9idWRkeV9tbSAqbW0sCisJCSAgICAg
IHN0cnVjdCBpOTE1X2J1ZGR5X2Jsb2NrICpibG9jaykKK3sKKwlyZXR1cm4gbW0tPmNodW5rX3Np
emUgPDwgaTkxNV9idWRkeV9ibG9ja19vcmRlcihibG9jayk7Cit9CisKK2ludCBpOTE1X2J1ZGR5
X2luaXQoc3RydWN0IGk5MTVfYnVkZHlfbW0gKm1tLCB1NjQgc2l6ZSwgdTY0IGNodW5rX3NpemUp
OworCit2b2lkIGk5MTVfYnVkZHlfZmluaShzdHJ1Y3QgaTkxNV9idWRkeV9tbSAqbW0pOworCitz
dHJ1Y3QgaTkxNV9idWRkeV9ibG9jayAqCitpOTE1X2J1ZGR5X2FsbG9jKHN0cnVjdCBpOTE1X2J1
ZGR5X21tICptbSwgdW5zaWduZWQgaW50IG9yZGVyKTsKKworaW50IGk5MTVfYnVkZHlfYWxsb2Nf
cmFuZ2Uoc3RydWN0IGk5MTVfYnVkZHlfbW0gKm1tLAorCQkJICAgc3RydWN0IGxpc3RfaGVhZCAq
YmxvY2tzLAorCQkJICAgdTY0IHN0YXJ0LCB1NjQgc2l6ZSk7CisKK3ZvaWQgaTkxNV9idWRkeV9m
cmVlKHN0cnVjdCBpOTE1X2J1ZGR5X21tICptbSwgc3RydWN0IGk5MTVfYnVkZHlfYmxvY2sgKmJs
b2NrKTsKKwordm9pZCBpOTE1X2J1ZGR5X2ZyZWVfbGlzdChzdHJ1Y3QgaTkxNV9idWRkeV9tbSAq
bW0sIHN0cnVjdCBsaXN0X2hlYWQgKm9iamVjdHMpOworCisjZW5kaWYKZGlmZiAtLWdpdCBhL2Ry
aXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfdHRtX2J1ZGR5X21hbmFnZXIuYyBiL2RyaXZlcnMvZ3B1
L2RybS9pOTE1L2k5MTVfdHRtX2J1ZGR5X21hbmFnZXIuYwpuZXcgZmlsZSBtb2RlIDEwMDY0NApp
bmRleCAwMDAwMDAwMDAwMDAuLmQ3YmYzN2JlMTkzMgotLS0gL2Rldi9udWxsCisrKyBiL2RyaXZl
cnMvZ3B1L2RybS9pOTE1L2k5MTVfdHRtX2J1ZGR5X21hbmFnZXIuYwpAQCAtMCwwICsxLDI0NiBA
QAorLy8gU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IE1JVAorLyoKKyAqIENvcHlyaWdodCDCqSAy
MDIxIEludGVsIENvcnBvcmF0aW9uCisgKi8KKworI2luY2x1ZGUgPGxpbnV4L3NsYWIuaD4KKwor
I2luY2x1ZGUgPGRybS90dG0vdHRtX2JvX2RyaXZlci5oPgorI2luY2x1ZGUgPGRybS90dG0vdHRt
X3BsYWNlbWVudC5oPgorCisjaW5jbHVkZSAiaTkxNV90dG1fYnVkZHlfbWFuYWdlci5oIgorCisj
aW5jbHVkZSAiaTkxNV9idWRkeS5oIgorI2luY2x1ZGUgImk5MTVfZ2VtLmgiCisKK3N0cnVjdCBp
OTE1X3R0bV9idWRkeV9tYW5hZ2VyIHsKKwlzdHJ1Y3QgdHRtX3Jlc291cmNlX21hbmFnZXIgbWFu
YWdlcjsKKwlzdHJ1Y3QgaTkxNV9idWRkeV9tbSBtbTsKKwlzdHJ1Y3QgbGlzdF9oZWFkIHJlc2Vy
dmVkOworCXN0cnVjdCBtdXRleCBsb2NrOworfTsKKworc3RhdGljIGlubGluZSBzdHJ1Y3QgaTkx
NV90dG1fYnVkZHlfbWFuYWdlciAqCit0b19idWRkeV9tYW5hZ2VyKHN0cnVjdCB0dG1fcmVzb3Vy
Y2VfbWFuYWdlciAqbWFuKQoreworCXJldHVybiBjb250YWluZXJfb2YobWFuLCBzdHJ1Y3QgaTkx
NV90dG1fYnVkZHlfbWFuYWdlciwgbWFuYWdlcik7Cit9CisKK3N0YXRpYyBpbnQgaTkxNV90dG1f
YnVkZHlfbWFuX2FsbG9jKHN0cnVjdCB0dG1fcmVzb3VyY2VfbWFuYWdlciAqbWFuLAorCQkJCSAg
ICBzdHJ1Y3QgdHRtX2J1ZmZlcl9vYmplY3QgKmJvLAorCQkJCSAgICBjb25zdCBzdHJ1Y3QgdHRt
X3BsYWNlICpwbGFjZSwKKwkJCQkgICAgc3RydWN0IHR0bV9yZXNvdXJjZSAqKnJlcykKK3sKKwlz
dHJ1Y3QgaTkxNV90dG1fYnVkZHlfbWFuYWdlciAqYm1hbiA9IHRvX2J1ZGR5X21hbmFnZXIobWFu
KTsKKwlzdHJ1Y3QgaTkxNV90dG1fYnVkZHlfcmVzb3VyY2UgKmJtYW5fcmVzOworCXN0cnVjdCBp
OTE1X2J1ZGR5X21tICptbSA9ICZibWFuLT5tbTsKKwl1bnNpZ25lZCBsb25nIG5fcGFnZXM7CisJ
dW5zaWduZWQgaW50IG1pbl9vcmRlcjsKKwl1NjQgc2l6ZTsKKwlpbnQgZXJyOworCisJR0VNX0JV
R19PTihwbGFjZS0+ZnBmbiB8fCBwbGFjZS0+bHBmbik7CisJR0VNX0JVR19PTihiby0+cGFnZV9h
bGlnbm1lbnQgPCBtbS0+Y2h1bmtfc2l6ZSk7CisKKwlibWFuX3JlcyA9IGt6YWxsb2Moc2l6ZW9m
KCpibWFuX3JlcyksIEdGUF9LRVJORUwpOworCWlmICghYm1hbl9yZXMpCisJCXJldHVybiAtRU5P
TUVNOworCisJdHRtX3Jlc291cmNlX2luaXQoYm8sIHBsYWNlLCAmYm1hbl9yZXMtPmJhc2UpOwor
CUlOSVRfTElTVF9IRUFEKCZibWFuX3Jlcy0+YmxvY2tzKTsKKwlibWFuX3Jlcy0+bW0gPSBtbTsK
KworCUdFTV9CVUdfT04oIWJtYW5fcmVzLT5iYXNlLm51bV9wYWdlcyk7CisJc2l6ZSA9IGJtYW5f
cmVzLT5iYXNlLm51bV9wYWdlcyA8PCBQQUdFX1NISUZUOworCisJbWluX29yZGVyID0gaWxvZzIo
Ym8tPnBhZ2VfYWxpZ25tZW50KSAtIGlsb2cyKG1tLT5jaHVua19zaXplKTsKKwlpZiAocGxhY2Ut
PmZsYWdzICYgVFRNX1BMX0ZMQUdfQ09OVElHVU9VUykgeworCQlzaXplID0gcm91bmR1cF9wb3df
b2ZfdHdvKHNpemUpOworCQltaW5fb3JkZXIgPSBpbG9nMihzaXplKSAtIGlsb2cyKG1tLT5jaHVu
a19zaXplKTsKKwl9CisKKwlpZiAoc2l6ZSA+IG1tLT5zaXplKSB7CisJCWVyciA9IC1FMkJJRzsK
KwkJZ290byBlcnJfZnJlZV9yZXM7CisJfQorCisJbl9wYWdlcyA9IHNpemUgPj4gaWxvZzIobW0t
PmNodW5rX3NpemUpOworCisJZG8geworCQlzdHJ1Y3QgaTkxNV9idWRkeV9ibG9jayAqYmxvY2s7
CisJCXVuc2lnbmVkIGludCBvcmRlcjsKKworCQlvcmRlciA9IGZscyhuX3BhZ2VzKSAtIDE7CisJ
CUdFTV9CVUdfT04ob3JkZXIgPiBtbS0+bWF4X29yZGVyKTsKKwkJR0VNX0JVR19PTihvcmRlciA8
IG1pbl9vcmRlcik7CisKKwkJZG8geworCQkJbXV0ZXhfbG9jaygmYm1hbi0+bG9jayk7CisJCQli
bG9jayA9IGk5MTVfYnVkZHlfYWxsb2MobW0sIG9yZGVyKTsKKwkJCW11dGV4X3VubG9jaygmYm1h
bi0+bG9jayk7CisJCQlpZiAoIUlTX0VSUihibG9jaykpCisJCQkJYnJlYWs7CisKKwkJCWlmIChv
cmRlci0tID09IG1pbl9vcmRlcikgeworCQkJCWVyciA9IC1FTlhJTzsKKwkJCQlnb3RvIGVycl9m
cmVlX2Jsb2NrczsKKwkJCX0KKwkJfSB3aGlsZSAoMSk7CisKKwkJbl9wYWdlcyAtPSBCSVQob3Jk
ZXIpOworCisJCWxpc3RfYWRkX3RhaWwoJmJsb2NrLT5saW5rLCAmYm1hbl9yZXMtPmJsb2Nrcyk7
CisKKwkJaWYgKCFuX3BhZ2VzKQorCQkJYnJlYWs7CisJfSB3aGlsZSAoMSk7CisKKwkqcmVzID0g
JmJtYW5fcmVzLT5iYXNlOworCXJldHVybiAwOworCitlcnJfZnJlZV9ibG9ja3M6CisJbXV0ZXhf
bG9jaygmYm1hbi0+bG9jayk7CisJaTkxNV9idWRkeV9mcmVlX2xpc3QobW0sICZibWFuX3Jlcy0+
YmxvY2tzKTsKKwltdXRleF91bmxvY2soJmJtYW4tPmxvY2spOworZXJyX2ZyZWVfcmVzOgorCWtm
cmVlKGJtYW5fcmVzKTsKKwlyZXR1cm4gZXJyOworfQorCitzdGF0aWMgdm9pZCBpOTE1X3R0bV9i
dWRkeV9tYW5fZnJlZShzdHJ1Y3QgdHRtX3Jlc291cmNlX21hbmFnZXIgKm1hbiwKKwkJCQkgICAg
c3RydWN0IHR0bV9yZXNvdXJjZSAqcmVzKQoreworCXN0cnVjdCBpOTE1X3R0bV9idWRkeV9yZXNv
dXJjZSAqYm1hbl9yZXMgPSB0b190dG1fYnVkZHlfcmVzb3VyY2UocmVzKTsKKwlzdHJ1Y3QgaTkx
NV90dG1fYnVkZHlfbWFuYWdlciAqYm1hbiA9IHRvX2J1ZGR5X21hbmFnZXIobWFuKTsKKworCW11
dGV4X2xvY2soJmJtYW4tPmxvY2spOworCWk5MTVfYnVkZHlfZnJlZV9saXN0KCZibWFuLT5tbSwg
JmJtYW5fcmVzLT5ibG9ja3MpOworCW11dGV4X3VubG9jaygmYm1hbi0+bG9jayk7CisKKwlrZnJl
ZShibWFuX3Jlcyk7Cit9CisKK3N0YXRpYyBjb25zdCBzdHJ1Y3QgdHRtX3Jlc291cmNlX21hbmFn
ZXJfZnVuYyBpOTE1X3R0bV9idWRkeV9tYW5hZ2VyX2Z1bmMgPSB7CisJLmFsbG9jID0gaTkxNV90
dG1fYnVkZHlfbWFuX2FsbG9jLAorCS5mcmVlID0gaTkxNV90dG1fYnVkZHlfbWFuX2ZyZWUsCit9
OworCisKKy8qKgorICogaTkxNV90dG1fYnVkZHlfbWFuX2luaXQgLSBTZXR1cCBidWRkeSBhbGxv
Y2F0b3IgYmFzZWQgdHRtIG1hbmFnZXIKKyAqIEBiZGV2OiBUaGUgdHRtIGRldmljZQorICogQHR5
cGU6IE1lbW9yeSB0eXBlIHdlIHdhbnQgdG8gbWFuYWdlCisgKiBAdXNlX3R0OiBTZXQgdXNlX3R0
IGZvciB0aGUgbWFuYWdlcgorICogQHNpemU6IFRoZSBzaXplIGluIGJ5dGVzIHRvIG1hbmFnZQor
ICogQGNodW5rX3NpemU6IFRoZSBtaW5pbXVtIHBhZ2Ugc2l6ZSBpbiBieXRlcyBmb3Igb3VyIGFs
bG9jYXRpb25zIGkuZQorICogb3JkZXItemVybworICoKKyAqIE5vdGUgdGhhdCB0aGUgc3RhcnRp
bmcgYWRkcmVzcyBpcyBhc3N1bWVkIHRvIGJlIHplcm8gaGVyZSwgc2luY2UgdGhpcworICogc2lt
cGxpZmllcyBrZWVwaW5nIHRoZSBwcm9wZXJ0eSB3aGVyZSBhbGxvY2F0ZWQgYmxvY2tzIGhhdmlu
ZyBuYXR1cmFsCisgKiBwb3dlci1vZi10d28gYWxpZ25tZW50LiBTbyBsb25nIGFzIHRoZSByZWFs
IHN0YXJ0aW5nIGFkZHJlc3MgaXMgc29tZSBsYXJnZQorICogcG93ZXItb2YtdHdvLCBvciBuYXR1
cmFsbHkgc3RhcnQgZnJvbSB6ZXJvLCB0aGVuIHRoaXMgc2hvdWxkIGJlIGZpbmUuICBBbHNvCisg
KiB0aGUgJmk5MTVfdHRtX2J1ZGR5X21hbl9yZXNlcnZlIGludGVyZmFjZSBjYW4gYmUgdXNlZCB0
byBwcmVzZXJ2ZSBhbGlnbm1lbnQKKyAqIGlmIHNheSB0aGVyZSBpcyBzb21lIHVudXNhYmxlIHJh
bmdlIGZyb20gdGhlIHN0YXJ0IG9mIHRoZSByZWdpb24uIFdlIGNhbgorICogcmV2aXNpdCB0aGlz
IGluIHRoZSBmdXR1cmUgYW5kIG1ha2UgdGhlIGludGVyZmFjZSBhY2NlcHQgYW4gYWN0dWFsIHN0
YXJ0aW5nCisgKiBvZmZzZXQgYW5kIGxldCBpdCB0YWtlIGNhcmUgb2YgdGhlIHJlc3QuCisgKgor
ICogTm90ZSB0aGF0IGlmIHRoZSBAc2l6ZSBpcyBub3QgYWxpZ25lZCB0byB0aGUgQGNodW5rX3Np
emUgdGhlbiB3ZSBwZXJmb3JtIHRoZQorICogcmVxdWlyZWQgcm91bmRpbmcgdG8gZ2V0IHRoZSB1
c2FibGUgc2l6ZS4gVGhlIGZpbmFsIHNpemUgaW4gcGFnZXMgY2FuIGJlCisgKiB0YWtlbiBmcm9t
ICZ0dG1fcmVzb3VyY2VfbWFuYWdlci5zaXplLgorICoKKyAqIFJldHVybjogMCBvbiBzdWNjZXNz
LCBuZWdhdGl2ZSBlcnJvciBjb2RlIG9uIGZhaWx1cmUuCisgKi8KK2ludCBpOTE1X3R0bV9idWRk
eV9tYW5faW5pdChzdHJ1Y3QgdHRtX2RldmljZSAqYmRldiwKKwkJCSAgICB1bnNpZ25lZCBpbnQg
dHlwZSwgYm9vbCB1c2VfdHQsCisJCQkgICAgdTY0IHNpemUsIHU2NCBjaHVua19zaXplKQorewor
CXN0cnVjdCB0dG1fcmVzb3VyY2VfbWFuYWdlciAqbWFuOworCXN0cnVjdCBpOTE1X3R0bV9idWRk
eV9tYW5hZ2VyICpibWFuOworCWludCBlcnI7CisKKwlibWFuID0ga3phbGxvYyhzaXplb2YoKmJt
YW4pLCBHRlBfS0VSTkVMKTsKKwlpZiAoIWJtYW4pCisJCXJldHVybiAtRU5PTUVNOworCisJZXJy
ID0gaTkxNV9idWRkeV9pbml0KCZibWFuLT5tbSwgc2l6ZSwgY2h1bmtfc2l6ZSk7CisJaWYgKGVy
cikKKwkJZ290byBlcnJfZnJlZV9ibWFuOworCisJbXV0ZXhfaW5pdCgmYm1hbi0+bG9jayk7CisJ
SU5JVF9MSVNUX0hFQUQoJmJtYW4tPnJlc2VydmVkKTsKKworCW1hbiA9ICZibWFuLT5tYW5hZ2Vy
OworCW1hbi0+dXNlX3R0ID0gdXNlX3R0OworCW1hbi0+ZnVuYyA9ICZpOTE1X3R0bV9idWRkeV9t
YW5hZ2VyX2Z1bmM7CisJdHRtX3Jlc291cmNlX21hbmFnZXJfaW5pdChtYW4sIGJtYW4tPm1tLnNp
emUgPj4gUEFHRV9TSElGVCk7CisKKwl0dG1fcmVzb3VyY2VfbWFuYWdlcl9zZXRfdXNlZChtYW4s
IHRydWUpOworCXR0bV9zZXRfZHJpdmVyX21hbmFnZXIoYmRldiwgdHlwZSwgbWFuKTsKKworCXJl
dHVybiAwOworCitlcnJfZnJlZV9ibWFuOgorCWtmcmVlKGJtYW4pOworCXJldHVybiBlcnI7Cit9
CisKKy8qKgorICogaTkxNV90dG1fYnVkZHlfbWFuX2ZpbmkgLSBEZXN0cm95IHRoZSBidWRkeSBh
bGxvY2F0b3IgdHRtIG1hbmFnZXIKKyAqIEBiZGV2OiBUaGUgdHRtIGRldmljZQorICogQHR5cGU6
IE1lbW9yeSB0eXBlIHdlIHdhbnQgdG8gbWFuYWdlCisgKgorICogTm90ZSB0aGF0IGlmIHdlIHJl
c2VydmVkIGFueXRoaW5nIHdpdGggJmk5MTVfdHRtX2J1ZGR5X21hbl9yZXNlcnZlLCB0aGlzIHdp
bGwKKyAqIGFsc28gYmUgZnJlZWQgZm9yIHVzIGhlcmUuCisgKgorICogUmV0dXJuOiAwIG9uIHN1
Y2Nlc3MsIG5lZ2F0aXZlIGVycm9yIGNvZGUgb24gZmFpbHVyZS4KKyAqLworaW50IGk5MTVfdHRt
X2J1ZGR5X21hbl9maW5pKHN0cnVjdCB0dG1fZGV2aWNlICpiZGV2LCB1bnNpZ25lZCBpbnQgdHlw
ZSkKK3sKKwlzdHJ1Y3QgdHRtX3Jlc291cmNlX21hbmFnZXIgKm1hbiA9IHR0bV9tYW5hZ2VyX3R5
cGUoYmRldiwgdHlwZSk7CisJc3RydWN0IGk5MTVfdHRtX2J1ZGR5X21hbmFnZXIgKmJtYW4gPSB0
b19idWRkeV9tYW5hZ2VyKG1hbik7CisJc3RydWN0IGk5MTVfYnVkZHlfbW0gKm1tID0gJmJtYW4t
Pm1tOworCWludCByZXQ7CisKKwl0dG1fcmVzb3VyY2VfbWFuYWdlcl9zZXRfdXNlZChtYW4sIGZh
bHNlKTsKKworCXJldCA9IHR0bV9yZXNvdXJjZV9tYW5hZ2VyX2V2aWN0X2FsbChiZGV2LCBtYW4p
OworCWlmIChyZXQpCisJCXJldHVybiByZXQ7CisKKwl0dG1fc2V0X2RyaXZlcl9tYW5hZ2VyKGJk
ZXYsIHR5cGUsIE5VTEwpOworCisJbXV0ZXhfbG9jaygmYm1hbi0+bG9jayk7CisJaTkxNV9idWRk
eV9mcmVlX2xpc3QobW0sICZibWFuLT5yZXNlcnZlZCk7CisJaTkxNV9idWRkeV9maW5pKG1tKTsK
KwltdXRleF91bmxvY2soJmJtYW4tPmxvY2spOworCisJdHRtX3Jlc291cmNlX21hbmFnZXJfY2xl
YW51cChtYW4pOworCWtmcmVlKGJtYW4pOworCisJcmV0dXJuIDA7Cit9CisKKy8qKgorICogaTkx
NV90dG1fYnVkZHlfbWFuX3Jlc2VydmUgLSBSZXNlcnZlIGFkZHJlc3MgcmFuZ2UKKyAqIEBtYW46
IFRoZSBidWRkeSBhbGxvY2F0b3IgdHRtIG1hbmFnZXIKKyAqIEBzdGFydDogVGhlIG9mZnNldCBp
biBieXRlcywgd2hlcmUgdGhlIHJlZ2lvbiBzdGFydCBpcyBhc3N1bWVkIHRvIGJlIHplcm8KKyAq
IEBzaXplOiBUaGUgc2l6ZSBpbiBieXRlcworICoKKyAqIE5vdGUgdGhhdCB0aGUgc3RhcnRpbmcg
YWRkcmVzcyBmb3IgdGhlIHJlZ2lvbiBpcyBhbHdheXMgYXNzdW1lZCB0byBiZSB6ZXJvLgorICoK
KyAqIFJldHVybjogMCBvbiBzdWNjZXNzLCBuZWdhdGl2ZSBlcnJvciBjb2RlIG9uIGZhaWx1cmUu
CisgKi8KK2ludCBpOTE1X3R0bV9idWRkeV9tYW5fcmVzZXJ2ZShzdHJ1Y3QgdHRtX3Jlc291cmNl
X21hbmFnZXIgKm1hbiwKKwkJCSAgICAgICB1NjQgc3RhcnQsIHU2NCBzaXplKQoreworCXN0cnVj
dCBpOTE1X3R0bV9idWRkeV9tYW5hZ2VyICpibWFuID0gdG9fYnVkZHlfbWFuYWdlcihtYW4pOwor
CXN0cnVjdCBpOTE1X2J1ZGR5X21tICptbSA9ICZibWFuLT5tbTsKKwlpbnQgcmV0OworCisJbXV0
ZXhfbG9jaygmYm1hbi0+bG9jayk7CisJcmV0ID0gaTkxNV9idWRkeV9hbGxvY19yYW5nZShtbSwg
JmJtYW4tPnJlc2VydmVkLCBzdGFydCwgc2l6ZSk7CisJbXV0ZXhfdW5sb2NrKCZibWFuLT5sb2Nr
KTsKKworCXJldHVybiByZXQ7Cit9CisKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1
L2k5MTVfdHRtX2J1ZGR5X21hbmFnZXIuaCBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfdHRt
X2J1ZGR5X21hbmFnZXIuaApuZXcgZmlsZSBtb2RlIDEwMDY0NAppbmRleCAwMDAwMDAwMDAwMDAu
LjFkNThlOTA1NDhjOQotLS0gL2Rldi9udWxsCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5
MTVfdHRtX2J1ZGR5X21hbmFnZXIuaApAQCAtMCwwICsxLDU2IEBACisvKiBTUERYLUxpY2Vuc2Ut
SWRlbnRpZmllcjogTUlUICovCisvKgorICogQ29weXJpZ2h0IMKpIDIwMjEgSW50ZWwgQ29ycG9y
YXRpb24KKyAqLworCisjaWZuZGVmIF9fSTkxNV9UVE1fQlVERFlfTUFOQUdFUl9IX18KKyNkZWZp
bmUgX19JOTE1X1RUTV9CVUREWV9NQU5BR0VSX0hfXworCisjaW5jbHVkZSA8bGludXgvbGlzdC5o
PgorI2luY2x1ZGUgPGxpbnV4L3R5cGVzLmg+CisKKyNpbmNsdWRlIDxkcm0vdHRtL3R0bV9yZXNv
dXJjZS5oPgorCitzdHJ1Y3QgdHRtX2RldmljZTsKK3N0cnVjdCB0dG1fcmVzb3VyY2VfbWFuYWdl
cjsKK3N0cnVjdCBpOTE1X2J1ZGR5X21tOworCisvKioKKyAqIHN0cnVjdCBpOTE1X3R0bV9idWRk
eV9yZXNvdXJjZQorICoKKyAqIEBiYXNlOiBzdHJ1Y3QgdHRtX3Jlc291cmNlIGJhc2UgY2xhc3Mg
d2UgZXh0ZW5kCisgKiBAYmxvY2tzOiB0aGUgbGlzdCBvZiBzdHJ1Y3QgaTkxNV9idWRkeV9ibG9j
ayBmb3IgdGhpcyByZXNvdXJjZS9hbGxvY2F0aW9uCisgKiBAbW06IHRoZSBzdHJ1Y3QgaTkxNV9i
dWRkeV9tbSBmb3IgdGhpcyByZXNvdXJjZQorICoKKyAqIEV4dGVuZHMgdGhlIHN0cnVjdCB0dG1f
cmVzb3VyY2UgdG8gbWFuYWdlIGFuIGFkZHJlc3Mgc3BhY2UgYWxsb2NhdGlvbiB3aXRoCisgKiBv
bmUgb3IgbW9yZSBzdHJ1Y3QgaTkxNV9idWRkeV9ibG9jay4KKyAqLworc3RydWN0IGk5MTVfdHRt
X2J1ZGR5X3Jlc291cmNlIHsKKwlzdHJ1Y3QgdHRtX3Jlc291cmNlIGJhc2U7CisJc3RydWN0IGxp
c3RfaGVhZCBibG9ja3M7CisJc3RydWN0IGk5MTVfYnVkZHlfbW0gKm1tOworfTsKKworLyoqCisg
KiB0b190dG1fYnVkZHlfcmVzb3VyY2UKKyAqCisgKiBAcmVzOiB0aGUgcmVzb3VyY2UgdG8gdXBj
YXN0CisgKgorICogVXBjYXN0IHRoZSB0dG1fcmVzb3VyY2Ugb2JqZWN0IGludG8gYSBpOTE1X3R0
bV9idWRkeV9yZXNvdXJjZS4KKyAqLworc3RhdGljIGlubGluZSBzdHJ1Y3QgaTkxNV90dG1fYnVk
ZHlfcmVzb3VyY2UgKgordG9fdHRtX2J1ZGR5X3Jlc291cmNlKHN0cnVjdCB0dG1fcmVzb3VyY2Ug
KnJlcykKK3sKKwlyZXR1cm4gY29udGFpbmVyX29mKHJlcywgc3RydWN0IGk5MTVfdHRtX2J1ZGR5
X3Jlc291cmNlLCBiYXNlKTsKK30KKworaW50IGk5MTVfdHRtX2J1ZGR5X21hbl9pbml0KHN0cnVj
dCB0dG1fZGV2aWNlICpiZGV2LAorCQkJICAgIHVuc2lnbmVkIHR5cGUsIGJvb2wgdXNlX3R0LAor
CQkJICAgIHU2NCBzaXplLCB1NjQgY2h1bmtfc2l6ZSk7CitpbnQgaTkxNV90dG1fYnVkZHlfbWFu
X2Zpbmkoc3RydWN0IHR0bV9kZXZpY2UgKmJkZXYsCisJCQkgICAgdW5zaWduZWQgaW50IHR5cGUp
OworCitpbnQgaTkxNV90dG1fYnVkZHlfbWFuX3Jlc2VydmUoc3RydWN0IHR0bV9yZXNvdXJjZV9t
YW5hZ2VyICptYW4sCisJCQkgICAgICAgdTY0IHN0YXJ0LCB1NjQgc2l6ZSk7CisKKyNlbmRpZgpk
aWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvc2VsZnRlc3RzL2k5MTVfYnVkZHkuYyBi
L2RyaXZlcnMvZ3B1L2RybS9pOTE1L3NlbGZ0ZXN0cy9pOTE1X2J1ZGR5LmMKbmV3IGZpbGUgbW9k
ZSAxMDA2NDQKaW5kZXggMDAwMDAwMDAwMDAwLi5mMGY1YzRkZjhkYmMKLS0tIC9kZXYvbnVsbAor
KysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMvaTkxNV9idWRkeS5jCkBAIC0wLDAg
KzEsNzg5IEBACisvLyBTUERYLUxpY2Vuc2UtSWRlbnRpZmllcjogTUlUCisvKgorICogQ29weXJp
Z2h0IMKpIDIwMTkgSW50ZWwgQ29ycG9yYXRpb24KKyAqLworCisjaW5jbHVkZSA8bGludXgvcHJp
bWVfbnVtYmVycy5oPgorCisjaW5jbHVkZSAiLi4vaTkxNV9zZWxmdGVzdC5oIgorI2luY2x1ZGUg
Imk5MTVfcmFuZG9tLmgiCisKK3N0YXRpYyB2b2lkIF9faWd0X2R1bXBfYmxvY2soc3RydWN0IGk5
MTVfYnVkZHlfbW0gKm1tLAorCQkJICAgICBzdHJ1Y3QgaTkxNV9idWRkeV9ibG9jayAqYmxvY2ss
CisJCQkgICAgIGJvb2wgYnVkZHkpCit7CisJcHJfZXJyKCJibG9jayBpbmZvOiBoZWFkZXI9JWxs
eCwgc3RhdGU9JXUsIG9yZGVyPSVkLCBvZmZzZXQ9JWxseCBzaXplPSVsbHggcm9vdD0lcyBidWRk
eT0lc1xuIiwKKwkgICAgICAgYmxvY2stPmhlYWRlciwKKwkgICAgICAgaTkxNV9idWRkeV9ibG9j
a19zdGF0ZShibG9jayksCisJICAgICAgIGk5MTVfYnVkZHlfYmxvY2tfb3JkZXIoYmxvY2spLAor
CSAgICAgICBpOTE1X2J1ZGR5X2Jsb2NrX29mZnNldChibG9jayksCisJICAgICAgIGk5MTVfYnVk
ZHlfYmxvY2tfc2l6ZShtbSwgYmxvY2spLAorCSAgICAgICB5ZXNubyghYmxvY2stPnBhcmVudCks
CisJICAgICAgIHllc25vKGJ1ZGR5KSk7Cit9CisKK3N0YXRpYyB2b2lkIGlndF9kdW1wX2Jsb2Nr
KHN0cnVjdCBpOTE1X2J1ZGR5X21tICptbSwKKwkJCSAgIHN0cnVjdCBpOTE1X2J1ZGR5X2Jsb2Nr
ICpibG9jaykKK3sKKwlzdHJ1Y3QgaTkxNV9idWRkeV9ibG9jayAqYnVkZHk7CisKKwlfX2lndF9k
dW1wX2Jsb2NrKG1tLCBibG9jaywgZmFsc2UpOworCisJYnVkZHkgPSBnZXRfYnVkZHkoYmxvY2sp
OworCWlmIChidWRkeSkKKwkJX19pZ3RfZHVtcF9ibG9jayhtbSwgYnVkZHksIHRydWUpOworfQor
CitzdGF0aWMgaW50IGlndF9jaGVja19ibG9jayhzdHJ1Y3QgaTkxNV9idWRkeV9tbSAqbW0sCisJ
CQkgICBzdHJ1Y3QgaTkxNV9idWRkeV9ibG9jayAqYmxvY2spCit7CisJc3RydWN0IGk5MTVfYnVk
ZHlfYmxvY2sgKmJ1ZGR5OworCXVuc2lnbmVkIGludCBibG9ja19zdGF0ZTsKKwl1NjQgYmxvY2tf
c2l6ZTsKKwl1NjQgb2Zmc2V0OworCWludCBlcnIgPSAwOworCisJYmxvY2tfc3RhdGUgPSBpOTE1
X2J1ZGR5X2Jsb2NrX3N0YXRlKGJsb2NrKTsKKworCWlmIChibG9ja19zdGF0ZSAhPSBJOTE1X0JV
RERZX0FMTE9DQVRFRCAmJgorCSAgICBibG9ja19zdGF0ZSAhPSBJOTE1X0JVRERZX0ZSRUUgJiYK
KwkgICAgYmxvY2tfc3RhdGUgIT0gSTkxNV9CVUREWV9TUExJVCkgeworCQlwcl9lcnIoImJsb2Nr
IHN0YXRlIG1pc21hdGNoXG4iKTsKKwkJZXJyID0gLUVJTlZBTDsKKwl9CisKKwlibG9ja19zaXpl
ID0gaTkxNV9idWRkeV9ibG9ja19zaXplKG1tLCBibG9jayk7CisJb2Zmc2V0ID0gaTkxNV9idWRk
eV9ibG9ja19vZmZzZXQoYmxvY2spOworCisJaWYgKGJsb2NrX3NpemUgPCBtbS0+Y2h1bmtfc2l6
ZSkgeworCQlwcl9lcnIoImJsb2NrIHNpemUgc21hbGxlciB0aGFuIG1pbiBzaXplXG4iKTsKKwkJ
ZXJyID0gLUVJTlZBTDsKKwl9CisKKwlpZiAoIWlzX3Bvd2VyX29mXzIoYmxvY2tfc2l6ZSkpIHsK
KwkJcHJfZXJyKCJibG9jayBzaXplIG5vdCBwb3dlciBvZiB0d29cbiIpOworCQllcnIgPSAtRUlO
VkFMOworCX0KKworCWlmICghSVNfQUxJR05FRChibG9ja19zaXplLCBtbS0+Y2h1bmtfc2l6ZSkp
IHsKKwkJcHJfZXJyKCJibG9jayBzaXplIG5vdCBhbGlnbmVkIHRvIG1pbiBzaXplXG4iKTsKKwkJ
ZXJyID0gLUVJTlZBTDsKKwl9CisKKwlpZiAoIUlTX0FMSUdORUQob2Zmc2V0LCBtbS0+Y2h1bmtf
c2l6ZSkpIHsKKwkJcHJfZXJyKCJibG9jayBvZmZzZXQgbm90IGFsaWduZWQgdG8gbWluIHNpemVc
biIpOworCQllcnIgPSAtRUlOVkFMOworCX0KKworCWlmICghSVNfQUxJR05FRChvZmZzZXQsIGJs
b2NrX3NpemUpKSB7CisJCXByX2VycigiYmxvY2sgb2Zmc2V0IG5vdCBhbGlnbmVkIHRvIGJsb2Nr
IHNpemVcbiIpOworCQllcnIgPSAtRUlOVkFMOworCX0KKworCWJ1ZGR5ID0gZ2V0X2J1ZGR5KGJs
b2NrKTsKKworCWlmICghYnVkZHkgJiYgYmxvY2stPnBhcmVudCkgeworCQlwcl9lcnIoImJ1ZGR5
IGhhcyBnb25lIGZpc2hpbmdcbiIpOworCQllcnIgPSAtRUlOVkFMOworCX0KKworCWlmIChidWRk
eSkgeworCQlpZiAoaTkxNV9idWRkeV9ibG9ja19vZmZzZXQoYnVkZHkpICE9IChvZmZzZXQgXiBi
bG9ja19zaXplKSkgeworCQkJcHJfZXJyKCJidWRkeSBoYXMgd3Jvbmcgb2Zmc2V0XG4iKTsKKwkJ
CWVyciA9IC1FSU5WQUw7CisJCX0KKworCQlpZiAoaTkxNV9idWRkeV9ibG9ja19zaXplKG1tLCBi
dWRkeSkgIT0gYmxvY2tfc2l6ZSkgeworCQkJcHJfZXJyKCJidWRkeSBzaXplIG1pc21hdGNoXG4i
KTsKKwkJCWVyciA9IC1FSU5WQUw7CisJCX0KKworCQlpZiAoaTkxNV9idWRkeV9ibG9ja19zdGF0
ZShidWRkeSkgPT0gYmxvY2tfc3RhdGUgJiYKKwkJICAgIGJsb2NrX3N0YXRlID09IEk5MTVfQlVE
RFlfRlJFRSkgeworCQkJcHJfZXJyKCJibG9jayBhbmQgaXRzIGJ1ZGR5IGFyZSBmcmVlXG4iKTsK
KwkJCWVyciA9IC1FSU5WQUw7CisJCX0KKwl9CisKKwlyZXR1cm4gZXJyOworfQorCitzdGF0aWMg
aW50IGlndF9jaGVja19ibG9ja3Moc3RydWN0IGk5MTVfYnVkZHlfbW0gKm1tLAorCQkJICAgIHN0
cnVjdCBsaXN0X2hlYWQgKmJsb2NrcywKKwkJCSAgICB1NjQgZXhwZWN0ZWRfc2l6ZSwKKwkJCSAg
ICBib29sIGlzX2NvbnRpZ3VvdXMpCit7CisJc3RydWN0IGk5MTVfYnVkZHlfYmxvY2sgKmJsb2Nr
OworCXN0cnVjdCBpOTE1X2J1ZGR5X2Jsb2NrICpwcmV2OworCXU2NCB0b3RhbDsKKwlpbnQgZXJy
ID0gMDsKKworCWJsb2NrID0gTlVMTDsKKwlwcmV2ID0gTlVMTDsKKwl0b3RhbCA9IDA7CisKKwls
aXN0X2Zvcl9lYWNoX2VudHJ5KGJsb2NrLCBibG9ja3MsIGxpbmspIHsKKwkJZXJyID0gaWd0X2No
ZWNrX2Jsb2NrKG1tLCBibG9jayk7CisKKwkJaWYgKCFpOTE1X2J1ZGR5X2Jsb2NrX2lzX2FsbG9j
YXRlZChibG9jaykpIHsKKwkJCXByX2VycigiYmxvY2sgbm90IGFsbG9jYXRlZFxuIiksCisJCQll
cnIgPSAtRUlOVkFMOworCQl9CisKKwkJaWYgKGlzX2NvbnRpZ3VvdXMgJiYgcHJldikgeworCQkJ
dTY0IHByZXZfYmxvY2tfc2l6ZTsKKwkJCXU2NCBwcmV2X29mZnNldDsKKwkJCXU2NCBvZmZzZXQ7
CisKKwkJCXByZXZfb2Zmc2V0ID0gaTkxNV9idWRkeV9ibG9ja19vZmZzZXQocHJldik7CisJCQlw
cmV2X2Jsb2NrX3NpemUgPSBpOTE1X2J1ZGR5X2Jsb2NrX3NpemUobW0sIHByZXYpOworCQkJb2Zm
c2V0ID0gaTkxNV9idWRkeV9ibG9ja19vZmZzZXQoYmxvY2spOworCisJCQlpZiAob2Zmc2V0ICE9
IChwcmV2X29mZnNldCArIHByZXZfYmxvY2tfc2l6ZSkpIHsKKwkJCQlwcl9lcnIoImJsb2NrIG9m
ZnNldCBtaXNtYXRjaFxuIik7CisJCQkJZXJyID0gLUVJTlZBTDsKKwkJCX0KKwkJfQorCisJCWlm
IChlcnIpCisJCQlicmVhazsKKworCQl0b3RhbCArPSBpOTE1X2J1ZGR5X2Jsb2NrX3NpemUobW0s
IGJsb2NrKTsKKwkJcHJldiA9IGJsb2NrOworCX0KKworCWlmICghZXJyKSB7CisJCWlmICh0b3Rh
bCAhPSBleHBlY3RlZF9zaXplKSB7CisJCQlwcl9lcnIoInNpemUgbWlzbWF0Y2gsIGV4cGVjdGVk
PSVsbHgsIGZvdW5kPSVsbHhcbiIsCisJCQkgICAgICAgZXhwZWN0ZWRfc2l6ZSwgdG90YWwpOwor
CQkJZXJyID0gLUVJTlZBTDsKKwkJfQorCQlyZXR1cm4gZXJyOworCX0KKworCWlmIChwcmV2KSB7
CisJCXByX2VycigicHJldiBibG9jaywgZHVtcDpcbiIpOworCQlpZ3RfZHVtcF9ibG9jayhtbSwg
cHJldik7CisJfQorCisJaWYgKGJsb2NrKSB7CisJCXByX2VycigiYmFkIGJsb2NrLCBkdW1wOlxu
Iik7CisJCWlndF9kdW1wX2Jsb2NrKG1tLCBibG9jayk7CisJfQorCisJcmV0dXJuIGVycjsKK30K
Kworc3RhdGljIGludCBpZ3RfY2hlY2tfbW0oc3RydWN0IGk5MTVfYnVkZHlfbW0gKm1tKQorewor
CXN0cnVjdCBpOTE1X2J1ZGR5X2Jsb2NrICpyb290OworCXN0cnVjdCBpOTE1X2J1ZGR5X2Jsb2Nr
ICpwcmV2OworCXVuc2lnbmVkIGludCBpOworCXU2NCB0b3RhbDsKKwlpbnQgZXJyID0gMDsKKwor
CWlmICghbW0tPm5fcm9vdHMpIHsKKwkJcHJfZXJyKCJuX3Jvb3RzIGlzIHplcm9cbiIpOworCQly
ZXR1cm4gLUVJTlZBTDsKKwl9CisKKwlpZiAobW0tPm5fcm9vdHMgIT0gaHdlaWdodDY0KG1tLT5z
aXplKSkgeworCQlwcl9lcnIoIm5fcm9vdHMgbWlzbWF0Y2gsIG5fcm9vdHM9JXUsIGV4cGVjdGVk
PSVsdVxuIiwKKwkJICAgICAgIG1tLT5uX3Jvb3RzLCBod2VpZ2h0NjQobW0tPnNpemUpKTsKKwkJ
cmV0dXJuIC1FSU5WQUw7CisJfQorCisJcm9vdCA9IE5VTEw7CisJcHJldiA9IE5VTEw7CisJdG90
YWwgPSAwOworCisJZm9yIChpID0gMDsgaSA8IG1tLT5uX3Jvb3RzOyArK2kpIHsKKwkJc3RydWN0
IGk5MTVfYnVkZHlfYmxvY2sgKmJsb2NrOworCQl1bnNpZ25lZCBpbnQgb3JkZXI7CisKKwkJcm9v
dCA9IG1tLT5yb290c1tpXTsKKwkJaWYgKCFyb290KSB7CisJCQlwcl9lcnIoInJvb3QoJXUpIGlz
IE5VTExcbiIsIGkpOworCQkJZXJyID0gLUVJTlZBTDsKKwkJCWJyZWFrOworCQl9CisKKwkJZXJy
ID0gaWd0X2NoZWNrX2Jsb2NrKG1tLCByb290KTsKKworCQlpZiAoIWk5MTVfYnVkZHlfYmxvY2tf
aXNfZnJlZShyb290KSkgeworCQkJcHJfZXJyKCJyb290IG5vdCBmcmVlXG4iKTsKKwkJCWVyciA9
IC1FSU5WQUw7CisJCX0KKworCQlvcmRlciA9IGk5MTVfYnVkZHlfYmxvY2tfb3JkZXIocm9vdCk7
CisKKwkJaWYgKCFpKSB7CisJCQlpZiAob3JkZXIgIT0gbW0tPm1heF9vcmRlcikgeworCQkJCXBy
X2VycigibWF4IG9yZGVyIHJvb3QgbWlzc2luZ1xuIik7CisJCQkJZXJyID0gLUVJTlZBTDsKKwkJ
CX0KKwkJfQorCisJCWlmIChwcmV2KSB7CisJCQl1NjQgcHJldl9ibG9ja19zaXplOworCQkJdTY0
IHByZXZfb2Zmc2V0OworCQkJdTY0IG9mZnNldDsKKworCQkJcHJldl9vZmZzZXQgPSBpOTE1X2J1
ZGR5X2Jsb2NrX29mZnNldChwcmV2KTsKKwkJCXByZXZfYmxvY2tfc2l6ZSA9IGk5MTVfYnVkZHlf
YmxvY2tfc2l6ZShtbSwgcHJldik7CisJCQlvZmZzZXQgPSBpOTE1X2J1ZGR5X2Jsb2NrX29mZnNl
dChyb290KTsKKworCQkJaWYgKG9mZnNldCAhPSAocHJldl9vZmZzZXQgKyBwcmV2X2Jsb2NrX3Np
emUpKSB7CisJCQkJcHJfZXJyKCJyb290IG9mZnNldCBtaXNtYXRjaFxuIik7CisJCQkJZXJyID0g
LUVJTlZBTDsKKwkJCX0KKwkJfQorCisJCWJsb2NrID0gbGlzdF9maXJzdF9lbnRyeV9vcl9udWxs
KCZtbS0+ZnJlZV9saXN0W29yZGVyXSwKKwkJCQkJCSBzdHJ1Y3QgaTkxNV9idWRkeV9ibG9jaywK
KwkJCQkJCSBsaW5rKTsKKwkJaWYgKGJsb2NrICE9IHJvb3QpIHsKKwkJCXByX2Vycigicm9vdCBt
aXNtYXRjaCBhdCBvcmRlcj0ldVxuIiwgb3JkZXIpOworCQkJZXJyID0gLUVJTlZBTDsKKwkJfQor
CisJCWlmIChlcnIpCisJCQlicmVhazsKKworCQlwcmV2ID0gcm9vdDsKKwkJdG90YWwgKz0gaTkx
NV9idWRkeV9ibG9ja19zaXplKG1tLCByb290KTsKKwl9CisKKwlpZiAoIWVycikgeworCQlpZiAo
dG90YWwgIT0gbW0tPnNpemUpIHsKKwkJCXByX2VycigiZXhwZWN0ZWQgbW0gc2l6ZT0lbGx4LCBm
b3VuZD0lbGx4XG4iLCBtbS0+c2l6ZSwKKwkJCSAgICAgICB0b3RhbCk7CisJCQllcnIgPSAtRUlO
VkFMOworCQl9CisJCXJldHVybiBlcnI7CisJfQorCisJaWYgKHByZXYpIHsKKwkJcHJfZXJyKCJw
cmV2IHJvb3QoJXUpLCBkdW1wOlxuIiwgaSAtIDEpOworCQlpZ3RfZHVtcF9ibG9jayhtbSwgcHJl
dik7CisJfQorCisJaWYgKHJvb3QpIHsKKwkJcHJfZXJyKCJiYWQgcm9vdCgldSksIGR1bXA6XG4i
LCBpKTsKKwkJaWd0X2R1bXBfYmxvY2sobW0sIHJvb3QpOworCX0KKworCXJldHVybiBlcnI7Cit9
CisKK3N0YXRpYyB2b2lkIGlndF9tbV9jb25maWcodTY0ICpzaXplLCB1NjQgKmNodW5rX3NpemUp
Cit7CisJSTkxNV9STkRfU1RBVEUocHJuZyk7CisJdTMyIHMsIG1zOworCisJLyogTm90aGluZyBm
YW5jeSwganVzdCB0cnkgdG8gZ2V0IGFuIGludGVyZXN0aW5nIGJpdCBwYXR0ZXJuICovCisKKwlw
cmFuZG9tX3NlZWRfc3RhdGUoJnBybmcsIGk5MTVfc2VsZnRlc3QucmFuZG9tX3NlZWQpOworCisJ
LyogTGV0IHNpemUgYmUgYSByYW5kb20gbnVtYmVyIG9mIHBhZ2VzIHVwIHRvIDggR0IgKDJNIHBh
Z2VzKSAqLworCXMgPSAxICsgaTkxNV9wcmFuZG9tX3UzMl9tYXhfc3RhdGUoKEJJVCgzMyAtIDEy
KSkgLSAxLCAmcHJuZyk7CisJLyogTGV0IHRoZSBjaHVuayBzaXplIGJlIGEgcmFuZG9tIHBvd2Vy
IG9mIDIgbGVzcyB0aGFuIHNpemUgKi8KKwltcyA9IEJJVChpOTE1X3ByYW5kb21fdTMyX21heF9z
dGF0ZShpbG9nMihzKSwgJnBybmcpKTsKKwkvKiBSb3VuZCBzaXplIGRvd24gdG8gdGhlIGNodW5r
IHNpemUgKi8KKwlzICY9IC1tczsKKworCS8qIENvbnZlcnQgZnJvbSBwYWdlcyB0byBieXRlcyAq
LworCSpjaHVua19zaXplID0gKHU2NCltcyA8PCAxMjsKKwkqc2l6ZSA9ICh1NjQpcyA8PCAxMjsK
K30KKworc3RhdGljIGludCBpZ3RfYnVkZHlfYWxsb2Nfc21va2Uodm9pZCAqYXJnKQoreworCXN0
cnVjdCBpOTE1X2J1ZGR5X21tIG1tOworCUlHVF9USU1FT1VUKGVuZF90aW1lKTsKKwlJOTE1X1JO
RF9TVEFURShwcm5nKTsKKwl1NjQgY2h1bmtfc2l6ZTsKKwl1NjQgbW1fc2l6ZTsKKwlpbnQgKm9y
ZGVyOworCWludCBlcnIsIGk7CisKKwlpZ3RfbW1fY29uZmlnKCZtbV9zaXplLCAmY2h1bmtfc2l6
ZSk7CisKKwlwcl9pbmZvKCJidWRkeV9pbml0IHdpdGggc2l6ZT0lbGx4LCBjaHVua19zaXplPSVs
bHhcbiIsIG1tX3NpemUsIGNodW5rX3NpemUpOworCisJZXJyID0gaTkxNV9idWRkeV9pbml0KCZt
bSwgbW1fc2l6ZSwgY2h1bmtfc2l6ZSk7CisJaWYgKGVycikgeworCQlwcl9lcnIoImJ1ZGR5X2lu
aXQgZmFpbGVkKCVkKVxuIiwgZXJyKTsKKwkJcmV0dXJuIGVycjsKKwl9CisKKwlvcmRlciA9IGk5
MTVfcmFuZG9tX29yZGVyKG1tLm1heF9vcmRlciArIDEsICZwcm5nKTsKKwlpZiAoIW9yZGVyKQor
CQlnb3RvIG91dF9maW5pOworCisJZm9yIChpID0gMDsgaSA8PSBtbS5tYXhfb3JkZXI7ICsraSkg
eworCQlzdHJ1Y3QgaTkxNV9idWRkeV9ibG9jayAqYmxvY2s7CisJCWludCBtYXhfb3JkZXIgPSBv
cmRlcltpXTsKKwkJYm9vbCB0aW1lb3V0ID0gZmFsc2U7CisJCUxJU1RfSEVBRChibG9ja3MpOwor
CQlpbnQgb3JkZXI7CisJCXU2NCB0b3RhbDsKKworCQllcnIgPSBpZ3RfY2hlY2tfbW0oJm1tKTsK
KwkJaWYgKGVycikgeworCQkJcHJfZXJyKCJwcmUtbW0gY2hlY2sgZmFpbGVkLCBhYm9ydFxuIik7
CisJCQlicmVhazsKKwkJfQorCisJCXByX2luZm8oImZpbGxpbmcgZnJvbSBtYXhfb3JkZXI9JXVc
biIsIG1heF9vcmRlcik7CisKKwkJb3JkZXIgPSBtYXhfb3JkZXI7CisJCXRvdGFsID0gMDsKKwor
CQlkbyB7CityZXRyeToKKwkJCWJsb2NrID0gaTkxNV9idWRkeV9hbGxvYygmbW0sIG9yZGVyKTsK
KwkJCWlmIChJU19FUlIoYmxvY2spKSB7CisJCQkJZXJyID0gUFRSX0VSUihibG9jayk7CisJCQkJ
aWYgKGVyciA9PSAtRU5PTUVNKSB7CisJCQkJCXByX2luZm8oImJ1ZGR5X2FsbG9jIGhpdCAtRU5P
TUVNIHdpdGggb3JkZXI9JWRcbiIsCisJCQkJCQlvcmRlcik7CisJCQkJfSBlbHNlIHsKKwkJCQkJ
aWYgKG9yZGVyLS0pIHsKKwkJCQkJCWVyciA9IDA7CisJCQkJCQlnb3RvIHJldHJ5OworCQkJCQl9
CisKKwkJCQkJcHJfZXJyKCJidWRkeV9hbGxvYyB3aXRoIG9yZGVyPSVkIGZhaWxlZCglZClcbiIs
CisJCQkJCSAgICAgICBvcmRlciwgZXJyKTsKKwkJCQl9CisKKwkJCQlicmVhazsKKwkJCX0KKwor
CQkJbGlzdF9hZGRfdGFpbCgmYmxvY2stPmxpbmssICZibG9ja3MpOworCisJCQlpZiAoaTkxNV9i
dWRkeV9ibG9ja19vcmRlcihibG9jaykgIT0gb3JkZXIpIHsKKwkJCQlwcl9lcnIoImJ1ZGR5X2Fs
bG9jIG9yZGVyIG1pc21hdGNoXG4iKTsKKwkJCQllcnIgPSAtRUlOVkFMOworCQkJCWJyZWFrOwor
CQkJfQorCisJCQl0b3RhbCArPSBpOTE1X2J1ZGR5X2Jsb2NrX3NpemUoJm1tLCBibG9jayk7CisK
KwkJCWlmIChfX2lndF90aW1lb3V0KGVuZF90aW1lLCBOVUxMKSkgeworCQkJCXRpbWVvdXQgPSB0
cnVlOworCQkJCWJyZWFrOworCQkJfQorCQl9IHdoaWxlICh0b3RhbCA8IG1tLnNpemUpOworCisJ
CWlmICghZXJyKQorCQkJZXJyID0gaWd0X2NoZWNrX2Jsb2NrcygmbW0sICZibG9ja3MsIHRvdGFs
LCBmYWxzZSk7CisKKwkJaTkxNV9idWRkeV9mcmVlX2xpc3QoJm1tLCAmYmxvY2tzKTsKKworCQlp
ZiAoIWVycikgeworCQkJZXJyID0gaWd0X2NoZWNrX21tKCZtbSk7CisJCQlpZiAoZXJyKQorCQkJ
CXByX2VycigicG9zdC1tbSBjaGVjayBmYWlsZWRcbiIpOworCQl9CisKKwkJaWYgKGVyciB8fCB0
aW1lb3V0KQorCQkJYnJlYWs7CisKKwkJY29uZF9yZXNjaGVkKCk7CisJfQorCisJaWYgKGVyciA9
PSAtRU5PTUVNKQorCQllcnIgPSAwOworCisJa2ZyZWUob3JkZXIpOworb3V0X2Zpbmk6CisJaTkx
NV9idWRkeV9maW5pKCZtbSk7CisKKwlyZXR1cm4gZXJyOworfQorCitzdGF0aWMgaW50IGlndF9i
dWRkeV9hbGxvY19wZXNzaW1pc3RpYyh2b2lkICphcmcpCit7CisJY29uc3QgdW5zaWduZWQgaW50
IG1heF9vcmRlciA9IDE2OworCXN0cnVjdCBpOTE1X2J1ZGR5X2Jsb2NrICpibG9jaywgKmJuOwor
CXN0cnVjdCBpOTE1X2J1ZGR5X21tIG1tOworCXVuc2lnbmVkIGludCBvcmRlcjsKKwlMSVNUX0hF
QUQoYmxvY2tzKTsKKwlpbnQgZXJyOworCisJLyoKKwkgKiBDcmVhdGUgYSBwb3Qtc2l6ZWQgbW0s
IHRoZW4gYWxsb2NhdGUgb25lIG9mIGVhY2ggcG9zc2libGUKKwkgKiBvcmRlciB3aXRoaW4uIFRo
aXMgc2hvdWxkIGxlYXZlIHRoZSBtbSB3aXRoIGV4YWN0bHkgb25lCisJICogcGFnZSBsZWZ0Lgor
CSAqLworCisJZXJyID0gaTkxNV9idWRkeV9pbml0KCZtbSwgUEFHRV9TSVpFIDw8IG1heF9vcmRl
ciwgUEFHRV9TSVpFKTsKKwlpZiAoZXJyKSB7CisJCXByX2VycigiYnVkZHlfaW5pdCBmYWlsZWQo
JWQpXG4iLCBlcnIpOworCQlyZXR1cm4gZXJyOworCX0KKwlHRU1fQlVHX09OKG1tLm1heF9vcmRl
ciAhPSBtYXhfb3JkZXIpOworCisJZm9yIChvcmRlciA9IDA7IG9yZGVyIDwgbWF4X29yZGVyOyBv
cmRlcisrKSB7CisJCWJsb2NrID0gaTkxNV9idWRkeV9hbGxvYygmbW0sIG9yZGVyKTsKKwkJaWYg
KElTX0VSUihibG9jaykpIHsKKwkJCXByX2luZm8oImJ1ZGR5X2FsbG9jIGhpdCAtRU5PTUVNIHdp
dGggb3JkZXI9JWRcbiIsCisJCQkJb3JkZXIpOworCQkJZXJyID0gUFRSX0VSUihibG9jayk7CisJ
CQlnb3RvIGVycjsKKwkJfQorCisJCWxpc3RfYWRkX3RhaWwoJmJsb2NrLT5saW5rLCAmYmxvY2tz
KTsKKwl9CisKKwkvKiBBbmQgbm93IHRoZSBsYXN0IHJlbWFpbmluZyBibG9jayBhdmFpbGFibGUg
Ki8KKwlibG9jayA9IGk5MTVfYnVkZHlfYWxsb2MoJm1tLCAwKTsKKwlpZiAoSVNfRVJSKGJsb2Nr
KSkgeworCQlwcl9pbmZvKCJidWRkeV9hbGxvYyBoaXQgLUVOT01FTSBvbiBmaW5hbCBhbGxvY1xu
Iik7CisJCWVyciA9IFBUUl9FUlIoYmxvY2spOworCQlnb3RvIGVycjsKKwl9CisJbGlzdF9hZGRf
dGFpbCgmYmxvY2stPmxpbmssICZibG9ja3MpOworCisJLyogU2hvdWxkIGJlIGNvbXBsZXRlbHkg
ZnVsbCEgKi8KKwlmb3IgKG9yZGVyID0gbWF4X29yZGVyOyBvcmRlci0tOyApIHsKKwkJYmxvY2sg
PSBpOTE1X2J1ZGR5X2FsbG9jKCZtbSwgb3JkZXIpOworCQlpZiAoIUlTX0VSUihibG9jaykpIHsK
KwkJCXByX2luZm8oImJ1ZGR5X2FsbG9jIHVuZXhwZWN0ZWRseSBzdWNjZWVkZWQgYXQgb3JkZXIg
JWQsIGl0IHNob3VsZCBiZSBmdWxsISIsCisJCQkJb3JkZXIpOworCQkJbGlzdF9hZGRfdGFpbCgm
YmxvY2stPmxpbmssICZibG9ja3MpOworCQkJZXJyID0gLUVJTlZBTDsKKwkJCWdvdG8gZXJyOwor
CQl9CisJfQorCisJYmxvY2sgPSBsaXN0X2xhc3RfZW50cnkoJmJsb2NrcywgdHlwZW9mKCpibG9j
ayksIGxpbmspOworCWxpc3RfZGVsKCZibG9jay0+bGluayk7CisJaTkxNV9idWRkeV9mcmVlKCZt
bSwgYmxvY2spOworCisJLyogQXMgd2UgZnJlZSBpbiBpbmNyZWFzaW5nIHNpemUsIHdlIG1ha2Ug
YXZhaWxhYmxlIGxhcmdlciBibG9ja3MgKi8KKwlvcmRlciA9IDE7CisJbGlzdF9mb3JfZWFjaF9l
bnRyeV9zYWZlKGJsb2NrLCBibiwgJmJsb2NrcywgbGluaykgeworCQlsaXN0X2RlbCgmYmxvY2st
PmxpbmspOworCQlpOTE1X2J1ZGR5X2ZyZWUoJm1tLCBibG9jayk7CisKKwkJYmxvY2sgPSBpOTE1
X2J1ZGR5X2FsbG9jKCZtbSwgb3JkZXIpOworCQlpZiAoSVNfRVJSKGJsb2NrKSkgeworCQkJcHJf
aW5mbygiYnVkZHlfYWxsb2MgKHJlYWxsb2MpIGhpdCAtRU5PTUVNIHdpdGggb3JkZXI9JWRcbiIs
CisJCQkJb3JkZXIpOworCQkJZXJyID0gUFRSX0VSUihibG9jayk7CisJCQlnb3RvIGVycjsKKwkJ
fQorCQlpOTE1X2J1ZGR5X2ZyZWUoJm1tLCBibG9jayk7CisJCW9yZGVyKys7CisJfQorCisJLyog
VG8gY29uZmlybSwgbm93IHRoZSB3aG9sZSBtbSBzaG91bGQgYmUgYXZhaWxhYmxlICovCisJYmxv
Y2sgPSBpOTE1X2J1ZGR5X2FsbG9jKCZtbSwgbWF4X29yZGVyKTsKKwlpZiAoSVNfRVJSKGJsb2Nr
KSkgeworCQlwcl9pbmZvKCJidWRkeV9hbGxvYyAocmVhbGxvYykgaGl0IC1FTk9NRU0gd2l0aCBv
cmRlcj0lZFxuIiwKKwkJCW1heF9vcmRlcik7CisJCWVyciA9IFBUUl9FUlIoYmxvY2spOworCQln
b3RvIGVycjsKKwl9CisJaTkxNV9idWRkeV9mcmVlKCZtbSwgYmxvY2spOworCitlcnI6CisJaTkx
NV9idWRkeV9mcmVlX2xpc3QoJm1tLCAmYmxvY2tzKTsKKwlpOTE1X2J1ZGR5X2ZpbmkoJm1tKTsK
KwlyZXR1cm4gZXJyOworfQorCitzdGF0aWMgaW50IGlndF9idWRkeV9hbGxvY19vcHRpbWlzdGlj
KHZvaWQgKmFyZykKK3sKKwljb25zdCBpbnQgbWF4X29yZGVyID0gMTY7CisJc3RydWN0IGk5MTVf
YnVkZHlfYmxvY2sgKmJsb2NrOworCXN0cnVjdCBpOTE1X2J1ZGR5X21tIG1tOworCUxJU1RfSEVB
RChibG9ja3MpOworCWludCBvcmRlcjsKKwlpbnQgZXJyOworCisJLyoKKwkgKiBDcmVhdGUgYSBt
bSB3aXRoIG9uZSBibG9jayBvZiBlYWNoIG9yZGVyIGF2YWlsYWJsZSwgYW5kCisJICogdHJ5IHRv
IGFsbG9jYXRlIHRoZW0gYWxsLgorCSAqLworCisJZXJyID0gaTkxNV9idWRkeV9pbml0KCZtbSwK
KwkJCSAgICAgIFBBR0VfU0laRSAqICgoMSA8PCAobWF4X29yZGVyICsgMSkpIC0gMSksCisJCQkg
ICAgICBQQUdFX1NJWkUpOworCWlmIChlcnIpIHsKKwkJcHJfZXJyKCJidWRkeV9pbml0IGZhaWxl
ZCglZClcbiIsIGVycik7CisJCXJldHVybiBlcnI7CisJfQorCUdFTV9CVUdfT04obW0ubWF4X29y
ZGVyICE9IG1heF9vcmRlcik7CisKKwlmb3IgKG9yZGVyID0gMDsgb3JkZXIgPD0gbWF4X29yZGVy
OyBvcmRlcisrKSB7CisJCWJsb2NrID0gaTkxNV9idWRkeV9hbGxvYygmbW0sIG9yZGVyKTsKKwkJ
aWYgKElTX0VSUihibG9jaykpIHsKKwkJCXByX2luZm8oImJ1ZGR5X2FsbG9jIGhpdCAtRU5PTUVN
IHdpdGggb3JkZXI9JWRcbiIsCisJCQkJb3JkZXIpOworCQkJZXJyID0gUFRSX0VSUihibG9jayk7
CisJCQlnb3RvIGVycjsKKwkJfQorCisJCWxpc3RfYWRkX3RhaWwoJmJsb2NrLT5saW5rLCAmYmxv
Y2tzKTsKKwl9CisKKwkvKiBTaG91bGQgYmUgY29tcGxldGVseSBmdWxsISAqLworCWJsb2NrID0g
aTkxNV9idWRkeV9hbGxvYygmbW0sIDApOworCWlmICghSVNfRVJSKGJsb2NrKSkgeworCQlwcl9p
bmZvKCJidWRkeV9hbGxvYyB1bmV4cGVjdGVkbHkgc3VjY2VlZGVkLCBpdCBzaG91bGQgYmUgZnVs
bCEiKTsKKwkJbGlzdF9hZGRfdGFpbCgmYmxvY2stPmxpbmssICZibG9ja3MpOworCQllcnIgPSAt
RUlOVkFMOworCQlnb3RvIGVycjsKKwl9CisKK2VycjoKKwlpOTE1X2J1ZGR5X2ZyZWVfbGlzdCgm
bW0sICZibG9ja3MpOworCWk5MTVfYnVkZHlfZmluaSgmbW0pOworCXJldHVybiBlcnI7Cit9CisK
K3N0YXRpYyBpbnQgaWd0X2J1ZGR5X2FsbG9jX3BhdGhvbG9naWNhbCh2b2lkICphcmcpCit7CisJ
Y29uc3QgaW50IG1heF9vcmRlciA9IDE2OworCXN0cnVjdCBpOTE1X2J1ZGR5X2Jsb2NrICpibG9j
azsKKwlzdHJ1Y3QgaTkxNV9idWRkeV9tbSBtbTsKKwlMSVNUX0hFQUQoYmxvY2tzKTsKKwlMSVNU
X0hFQUQoaG9sZXMpOworCWludCBvcmRlciwgdG9wOworCWludCBlcnI7CisKKwkvKgorCSAqIENy
ZWF0ZSBhIHBvdC1zaXplZCBtbSwgdGhlbiBhbGxvY2F0ZSBvbmUgb2YgZWFjaCBwb3NzaWJsZQor
CSAqIG9yZGVyIHdpdGhpbi4gVGhpcyBzaG91bGQgbGVhdmUgdGhlIG1tIHdpdGggZXhhY3RseSBv
bmUKKwkgKiBwYWdlIGxlZnQuIEZyZWUgdGhlIGxhcmdlc3QgYmxvY2ssIHRoZW4gd2hpdHRsZSBk
b3duIGFnYWluLgorCSAqIEV2ZW50dWFsbHkgd2Ugd2lsbCBoYXZlIGEgZnVsbHkgNTAlIGZyYWdt
ZW50ZWQgbW0uCisJICovCisKKwllcnIgPSBpOTE1X2J1ZGR5X2luaXQoJm1tLCBQQUdFX1NJWkUg
PDwgbWF4X29yZGVyLCBQQUdFX1NJWkUpOworCWlmIChlcnIpIHsKKwkJcHJfZXJyKCJidWRkeV9p
bml0IGZhaWxlZCglZClcbiIsIGVycik7CisJCXJldHVybiBlcnI7CisJfQorCUdFTV9CVUdfT04o
bW0ubWF4X29yZGVyICE9IG1heF9vcmRlcik7CisKKwlmb3IgKHRvcCA9IG1heF9vcmRlcjsgdG9w
OyB0b3AtLSkgeworCQkvKiBNYWtlIHJvb20gYnkgZnJlZWluZyB0aGUgbGFyZ2VzdCBhbGxvY2F0
ZWQgYmxvY2sgKi8KKwkJYmxvY2sgPSBsaXN0X2ZpcnN0X2VudHJ5X29yX251bGwoJmJsb2Nrcywg
dHlwZW9mKCpibG9jayksIGxpbmspOworCQlpZiAoYmxvY2spIHsKKwkJCWxpc3RfZGVsKCZibG9j
ay0+bGluayk7CisJCQlpOTE1X2J1ZGR5X2ZyZWUoJm1tLCBibG9jayk7CisJCX0KKworCQlmb3Ig
KG9yZGVyID0gdG9wOyBvcmRlci0tOyApIHsKKwkJCWJsb2NrID0gaTkxNV9idWRkeV9hbGxvYygm
bW0sIG9yZGVyKTsKKwkJCWlmIChJU19FUlIoYmxvY2spKSB7CisJCQkJcHJfaW5mbygiYnVkZHlf
YWxsb2MgaGl0IC1FTk9NRU0gd2l0aCBvcmRlcj0lZCwgdG9wPSVkXG4iLAorCQkJCQlvcmRlciwg
dG9wKTsKKwkJCQllcnIgPSBQVFJfRVJSKGJsb2NrKTsKKwkJCQlnb3RvIGVycjsKKwkJCX0KKwkJ
CWxpc3RfYWRkX3RhaWwoJmJsb2NrLT5saW5rLCAmYmxvY2tzKTsKKwkJfQorCisJCS8qIFRoZXJl
IHNob3VsZCBiZSBvbmUgZmluYWwgcGFnZSBmb3IgdGhpcyBzdWItYWxsb2NhdGlvbiAqLworCQli
bG9jayA9IGk5MTVfYnVkZHlfYWxsb2MoJm1tLCAwKTsKKwkJaWYgKElTX0VSUihibG9jaykpIHsK
KwkJCXByX2luZm8oImJ1ZGR5X2FsbG9jIGhpdCAtRU5PTUVNIGZvciBob2xlXG4iKTsKKwkJCWVy
ciA9IFBUUl9FUlIoYmxvY2spOworCQkJZ290byBlcnI7CisJCX0KKwkJbGlzdF9hZGRfdGFpbCgm
YmxvY2stPmxpbmssICZob2xlcyk7CisKKwkJYmxvY2sgPSBpOTE1X2J1ZGR5X2FsbG9jKCZtbSwg
dG9wKTsKKwkJaWYgKCFJU19FUlIoYmxvY2spKSB7CisJCQlwcl9pbmZvKCJidWRkeV9hbGxvYyB1
bmV4cGVjdGVkbHkgc3VjY2VlZGVkIGF0IHRvcC1vcmRlciAlZC8lZCwgaXQgc2hvdWxkIGJlIGZ1
bGwhIiwKKwkJCQl0b3AsIG1heF9vcmRlcik7CisJCQlsaXN0X2FkZF90YWlsKCZibG9jay0+bGlu
aywgJmJsb2Nrcyk7CisJCQllcnIgPSAtRUlOVkFMOworCQkJZ290byBlcnI7CisJCX0KKwl9CisK
KwlpOTE1X2J1ZGR5X2ZyZWVfbGlzdCgmbW0sICZob2xlcyk7CisKKwkvKiBOb3RoaW5nIGxhcmdl
ciB0aGFuIGJsb2NrcyBvZiBjaHVua19zaXplIG5vdyBhdmFpbGFibGUgKi8KKwlmb3IgKG9yZGVy
ID0gMTsgb3JkZXIgPD0gbWF4X29yZGVyOyBvcmRlcisrKSB7CisJCWJsb2NrID0gaTkxNV9idWRk
eV9hbGxvYygmbW0sIG9yZGVyKTsKKwkJaWYgKCFJU19FUlIoYmxvY2spKSB7CisJCQlwcl9pbmZv
KCJidWRkeV9hbGxvYyB1bmV4cGVjdGVkbHkgc3VjY2VlZGVkIGF0IG9yZGVyICVkLCBpdCBzaG91
bGQgYmUgZnVsbCEiLAorCQkJCW9yZGVyKTsKKwkJCWxpc3RfYWRkX3RhaWwoJmJsb2NrLT5saW5r
LCAmYmxvY2tzKTsKKwkJCWVyciA9IC1FSU5WQUw7CisJCQlnb3RvIGVycjsKKwkJfQorCX0KKwor
ZXJyOgorCWxpc3Rfc3BsaWNlX3RhaWwoJmhvbGVzLCAmYmxvY2tzKTsKKwlpOTE1X2J1ZGR5X2Zy
ZWVfbGlzdCgmbW0sICZibG9ja3MpOworCWk5MTVfYnVkZHlfZmluaSgmbW0pOworCXJldHVybiBl
cnI7Cit9CisKK3N0YXRpYyBpbnQgaWd0X2J1ZGR5X2FsbG9jX3JhbmdlKHZvaWQgKmFyZykKK3sK
KwlzdHJ1Y3QgaTkxNV9idWRkeV9tbSBtbTsKKwl1bnNpZ25lZCBsb25nIHBhZ2VfbnVtOworCUxJ
U1RfSEVBRChibG9ja3MpOworCXU2NCBjaHVua19zaXplOworCXU2NCBvZmZzZXQ7CisJdTY0IHNp
emU7CisJdTY0IHJlbTsKKwlpbnQgZXJyOworCisJaWd0X21tX2NvbmZpZygmc2l6ZSwgJmNodW5r
X3NpemUpOworCisJcHJfaW5mbygiYnVkZHlfaW5pdCB3aXRoIHNpemU9JWxseCwgY2h1bmtfc2l6
ZT0lbGx4XG4iLCBzaXplLCBjaHVua19zaXplKTsKKworCWVyciA9IGk5MTVfYnVkZHlfaW5pdCgm
bW0sIHNpemUsIGNodW5rX3NpemUpOworCWlmIChlcnIpIHsKKwkJcHJfZXJyKCJidWRkeV9pbml0
IGZhaWxlZCglZClcbiIsIGVycik7CisJCXJldHVybiBlcnI7CisJfQorCisJZXJyID0gaWd0X2No
ZWNrX21tKCZtbSk7CisJaWYgKGVycikgeworCQlwcl9lcnIoInByZS1tbSBjaGVjayBmYWlsZWQs
IGFib3J0LCBhYm9ydCwgYWJvcnQhXG4iKTsKKwkJZ290byBlcnJfZmluaTsKKwl9CisKKwlyZW0g
PSBtbS5zaXplOworCW9mZnNldCA9IDA7CisKKwlmb3JfZWFjaF9wcmltZV9udW1iZXJfZnJvbShw
YWdlX251bSwgMSwgVUxPTkdfTUFYIC0gMSkgeworCQlzdHJ1Y3QgaTkxNV9idWRkeV9ibG9jayAq
YmxvY2s7CisJCUxJU1RfSEVBRCh0bXApOworCisJCXNpemUgPSBtaW4ocGFnZV9udW0gKiBtbS5j
aHVua19zaXplLCByZW0pOworCisJCWVyciA9IGk5MTVfYnVkZHlfYWxsb2NfcmFuZ2UoJm1tLCAm
dG1wLCBvZmZzZXQsIHNpemUpOworCQlpZiAoZXJyKSB7CisJCQlpZiAoZXJyID09IC1FTk9NRU0p
IHsKKwkJCQlwcl9pbmZvKCJhbGxvY19yYW5nZSBoaXQgLUVOT01FTSB3aXRoIHNpemU9JWxseFxu
IiwKKwkJCQkJc2l6ZSk7CisJCQl9IGVsc2UgeworCQkJCXByX2VycigiYWxsb2NfcmFuZ2Ugd2l0
aCBvZmZzZXQ9JWxseCwgc2l6ZT0lbGx4IGZhaWxlZCglZClcbiIsCisJCQkJICAgICAgIG9mZnNl
dCwgc2l6ZSwgZXJyKTsKKwkJCX0KKworCQkJYnJlYWs7CisJCX0KKworCQlibG9jayA9IGxpc3Rf
Zmlyc3RfZW50cnlfb3JfbnVsbCgmdG1wLAorCQkJCQkJIHN0cnVjdCBpOTE1X2J1ZGR5X2Jsb2Nr
LAorCQkJCQkJIGxpbmspOworCQlpZiAoIWJsb2NrKSB7CisJCQlwcl9lcnIoImFsbG9jX3Jhbmdl
IGhhcyBubyBibG9ja3NcbiIpOworCQkJZXJyID0gLUVJTlZBTDsKKwkJCWJyZWFrOworCQl9CisK
KwkJaWYgKGk5MTVfYnVkZHlfYmxvY2tfb2Zmc2V0KGJsb2NrKSAhPSBvZmZzZXQpIHsKKwkJCXBy
X2VycigiYWxsb2NfcmFuZ2Ugc3RhcnQgb2Zmc2V0IG1pc21hdGNoLCBmb3VuZD0lbGx4LCBleHBl
Y3RlZD0lbGx4XG4iLAorCQkJICAgICAgIGk5MTVfYnVkZHlfYmxvY2tfb2Zmc2V0KGJsb2NrKSwg
b2Zmc2V0KTsKKwkJCWVyciA9IC1FSU5WQUw7CisJCX0KKworCQlpZiAoIWVycikKKwkJCWVyciA9
IGlndF9jaGVja19ibG9ja3MoJm1tLCAmdG1wLCBzaXplLCB0cnVlKTsKKworCQlsaXN0X3NwbGlj
ZV90YWlsKCZ0bXAsICZibG9ja3MpOworCisJCWlmIChlcnIpCisJCQlicmVhazsKKworCQlvZmZz
ZXQgKz0gc2l6ZTsKKworCQlyZW0gLT0gc2l6ZTsKKwkJaWYgKCFyZW0pCisJCQlicmVhazsKKwor
CQljb25kX3Jlc2NoZWQoKTsKKwl9CisKKwlpZiAoZXJyID09IC1FTk9NRU0pCisJCWVyciA9IDA7
CisKKwlpOTE1X2J1ZGR5X2ZyZWVfbGlzdCgmbW0sICZibG9ja3MpOworCisJaWYgKCFlcnIpIHsK
KwkJZXJyID0gaWd0X2NoZWNrX21tKCZtbSk7CisJCWlmIChlcnIpCisJCQlwcl9lcnIoInBvc3Qt
bW0gY2hlY2sgZmFpbGVkXG4iKTsKKwl9CisKK2Vycl9maW5pOgorCWk5MTVfYnVkZHlfZmluaSgm
bW0pOworCisJcmV0dXJuIGVycjsKK30KKworc3RhdGljIGludCBpZ3RfYnVkZHlfYWxsb2NfbGlt
aXQodm9pZCAqYXJnKQoreworCXN0cnVjdCBpOTE1X2J1ZGR5X2Jsb2NrICpibG9jazsKKwlzdHJ1
Y3QgaTkxNV9idWRkeV9tbSBtbTsKKwljb25zdCB1NjQgc2l6ZSA9IFU2NF9NQVg7CisJaW50IGVy
cjsKKworCWVyciA9IGk5MTVfYnVkZHlfaW5pdCgmbW0sIHNpemUsIFBBR0VfU0laRSk7CisJaWYg
KGVycikKKwkJcmV0dXJuIGVycjsKKworCWlmIChtbS5tYXhfb3JkZXIgIT0gSTkxNV9CVUREWV9N
QVhfT1JERVIpIHsKKwkJcHJfZXJyKCJtbS5tYXhfb3JkZXIoJWQpICE9ICVkXG4iLAorCQkgICAg
ICAgbW0ubWF4X29yZGVyLCBJOTE1X0JVRERZX01BWF9PUkRFUik7CisJCWVyciA9IC1FSU5WQUw7
CisJCWdvdG8gb3V0X2Zpbmk7CisJfQorCisJYmxvY2sgPSBpOTE1X2J1ZGR5X2FsbG9jKCZtbSwg
bW0ubWF4X29yZGVyKTsKKwlpZiAoSVNfRVJSKGJsb2NrKSkgeworCQllcnIgPSBQVFJfRVJSKGJs
b2NrKTsKKwkJZ290byBvdXRfZmluaTsKKwl9CisKKwlpZiAoaTkxNV9idWRkeV9ibG9ja19vcmRl
cihibG9jaykgIT0gbW0ubWF4X29yZGVyKSB7CisJCXByX2VycigiYmxvY2sgb3JkZXIoJWQpICE9
ICVkXG4iLAorCQkgICAgICAgaTkxNV9idWRkeV9ibG9ja19vcmRlcihibG9jayksIG1tLm1heF9v
cmRlcik7CisJCWVyciA9IC1FSU5WQUw7CisJCWdvdG8gb3V0X2ZyZWU7CisJfQorCisJaWYgKGk5
MTVfYnVkZHlfYmxvY2tfc2l6ZSgmbW0sIGJsb2NrKSAhPQorCSAgICBCSVRfVUxMKG1tLm1heF9v
cmRlcikgKiBQQUdFX1NJWkUpIHsKKwkJcHJfZXJyKCJibG9jayBzaXplKCVsbHUpICE9ICVsbHVc
biIsCisJCSAgICAgICBpOTE1X2J1ZGR5X2Jsb2NrX3NpemUoJm1tLCBibG9jayksCisJCSAgICAg
ICBCSVRfVUxMKG1tLm1heF9vcmRlcikgKiBQQUdFX1NJWkUpOworCQllcnIgPSAtRUlOVkFMOwor
CQlnb3RvIG91dF9mcmVlOworCX0KKworb3V0X2ZyZWU6CisJaTkxNV9idWRkeV9mcmVlKCZtbSwg
YmxvY2spOworb3V0X2Zpbmk6CisJaTkxNV9idWRkeV9maW5pKCZtbSk7CisJcmV0dXJuIGVycjsK
K30KKworaW50IGk5MTVfYnVkZHlfbW9ja19zZWxmdGVzdHModm9pZCkKK3sKKwlzdGF0aWMgY29u
c3Qgc3RydWN0IGk5MTVfc3VidGVzdCB0ZXN0c1tdID0geworCQlTVUJURVNUKGlndF9idWRkeV9h
bGxvY19wZXNzaW1pc3RpYyksCisJCVNVQlRFU1QoaWd0X2J1ZGR5X2FsbG9jX29wdGltaXN0aWMp
LAorCQlTVUJURVNUKGlndF9idWRkeV9hbGxvY19wYXRob2xvZ2ljYWwpLAorCQlTVUJURVNUKGln
dF9idWRkeV9hbGxvY19zbW9rZSksCisJCVNVQlRFU1QoaWd0X2J1ZGR5X2FsbG9jX3JhbmdlKSwK
KwkJU1VCVEVTVChpZ3RfYnVkZHlfYWxsb2NfbGltaXQpLAorCX07CisKKwlyZXR1cm4gaTkxNV9z
dWJ0ZXN0cyh0ZXN0cywgTlVMTCk7Cit9Ci0tIAoyLjI2LjMKCl9fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fCkludGVsLWdmeCBtYWlsaW5nIGxpc3QKSW50ZWwt
Z2Z4QGxpc3RzLmZyZWVkZXNrdG9wLm9yZwpodHRwczovL2xpc3RzLmZyZWVkZXNrdG9wLm9yZy9t
YWlsbWFuL2xpc3RpbmZvL2ludGVsLWdmeAo=

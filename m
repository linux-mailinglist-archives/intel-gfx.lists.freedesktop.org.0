Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 5F0916E8D4
	for <lists+intel-gfx@lfdr.de>; Fri, 19 Jul 2019 18:32:50 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id B7FC36E84B;
	Fri, 19 Jul 2019 16:32:48 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from fireflyinternet.com (mail.fireflyinternet.com [109.228.58.192])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 8FF256E84B
 for <intel-gfx@lists.freedesktop.org>; Fri, 19 Jul 2019 16:32:46 +0000 (UTC)
X-Default-Received-SPF: pass (skip=forwardok (res=PASS))
 x-ip-name=78.156.65.138; 
Received: from haswell.alporthouse.com (unverified [78.156.65.138]) 
 by fireflyinternet.com (Firefly Internet (M1)) with ESMTP id 17434024-1500050 
 for multiple; Fri, 19 Jul 2019 17:32:35 +0100
From: Chris Wilson <chris@chris-wilson.co.uk>
To: intel-gfx@lists.freedesktop.org
Date: Fri, 19 Jul 2019 17:32:34 +0100
Message-Id: <20190719163234.6540-1-chris@chris-wilson.co.uk>
X-Mailer: git-send-email 2.22.0
In-Reply-To: <20190719130423.11195-1-chris@chris-wilson.co.uk>
References: <20190719130423.11195-1-chris@chris-wilson.co.uk>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH] drm/i915: Hide unshrinkable context objects
 from the shrinker
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

VGhlIHNocmlua2VyIGNhbm5vdCB0b3VjaCBvYmplY3RzIHVzZWQgYnkgdGhlIGNvbnRleHRzIChs
b2dpY2FsIHN0YXRlCmFuZCByaW5nKS4gQ3VycmVudGx5IHdlIG1hcmsgdGhvc2UgYXMgInBpbl9n
bG9iYWwiIHRvIGxldCB0aGUgc2hyaW5rZXIKc2tpcCBvdmVyIHRoZW0sIGhvd2V2ZXIsIGlmIHdl
IHJlbW92ZSB0aGVtIGZyb20gdGhlIHNocmlua2VyIGxpc3RzCmVudGlyZWx5LCB3ZSBkb24ndCBl
dmVudCBoYXZlIHRvIGluY2x1ZGUgdGhlbSBpbiBvdXIgc2hyaW5rIGFjY291bnRpbmcuCgpCeSBr
ZWVwaW5nIHRoZSB1bnNocmlua2FibGUgb2JqZWN0cyBpbiBvdXIgc2hyaW5rZXIgdHJhY2tpbmcs
IHdlIHJlcG9ydAphIGxhcmdlIG51bWJlciBvZiBvYmplY3RzIGF2YWlsYWJsZSB0byBiZSBzaHJ1
bmssIGFuZCBsZWF2ZSB0aGUgc2hyaW5rZXIKZGVlcGx5IHVuc2F0aXNmaWVkIHdoZW4gd2UgZmFp
bCB0byByZWNsYWltIHRob3NlLiBUaGUgc2hyaW5rZXIgd2lsbApwZXJzaXN0IGluIHRyeWluZyB0
byByZWNsYWltIHRoZSB1bmF2YWlsYWJsZSBvYmplY3RzLCBmb3JjaW5nIHRoZSBzeXN0ZW0KaW50
byBhIGxpdmVsb2NrIChub3QgZXZlbiBoaXR0aW5nIHRoZSBkcmVhZCBvb21raWxsZXIpLgoKdjI6
IEV4dGVuZCB1bnNocmlua2FibGUgcHJvdGVjdGlvbiBmb3IgcGVybWEtcGlubmVkIHNjcmF0Y2gg
YW5kIGd1YwphbGxvY2F0aW9ucyAoVHZydGtvKQp2MzogTm90aWNlIHRoYXQgd2Ugc2hvdWxkIGJl
IHBpbm5lZCB3aGVuIG1hcmtpbmcgdW5zaHJpbmthYmxlIGFuZCBzbyB0aGUKbGluayBjYW5ub3Qg
YmUgZW1wdHk7IG1lcmdlIGR1cGxpY2F0ZSBwYXRocy4KClNpZ25lZC1vZmYtYnk6IENocmlzIFdp
bHNvbiA8Y2hyaXNAY2hyaXMtd2lsc29uLmNvLnVrPgpDYzogVHZydGtvIFVyc3VsaW4gPHR2cnRr
by51cnN1bGluQGludGVsLmNvbT4KLS0tCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9n
ZW1fb2JqZWN0LmMgICB8IDExICsrLS0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dl
bV9vYmplY3QuaCAgIHwgIDQgKysKIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9w
YWdlcy5jICAgIHwgMTMgKy0tLS0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9z
aHJpbmtlci5jIHwgNTQgKysrKysrKysrKysrKysrKysrKysKIGRyaXZlcnMvZ3B1L2RybS9pOTE1
L2d0L2ludGVsX2NvbnRleHQuYyAgICAgIHwgIDQgKy0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2d0
L2ludGVsX2d0LmMgICAgICAgICAgIHwgIDMgKy0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2lu
dGVsX3JpbmdidWZmZXIuYyAgIHwgMTcgKysrLS0tCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC91
Yy9pbnRlbF9ndWMuYyAgICAgICB8ICAyICstCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2Rl
YnVnZnMuYyAgICAgICAgICB8ICAzICstCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3ZtYS5j
ICAgICAgICAgICAgICB8IDE2ICsrKysrKwogZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV92bWEu
aCAgICAgICAgICAgICAgfCAgNCArKwogMTEgZmlsZXMgY2hhbmdlZCwgOTggaW5zZXJ0aW9ucygr
KSwgMzMgZGVsZXRpb25zKC0pCgpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2Vt
L2k5MTVfZ2VtX29iamVjdC5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX29i
amVjdC5jCmluZGV4IGQ1MTk3YTJhMTA2Zi4uNGVhOTdmY2E5YzM1IDEwMDY0NAotLS0gYS9kcml2
ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fb2JqZWN0LmMKKysrIGIvZHJpdmVycy9ncHUv
ZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX29iamVjdC5jCkBAIC02Myw2ICs2Myw4IEBAIHZvaWQgaTkx
NV9nZW1fb2JqZWN0X2luaXQoc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iaiwKIAlzcGlu
X2xvY2tfaW5pdCgmb2JqLT52bWEubG9jayk7CiAJSU5JVF9MSVNUX0hFQUQoJm9iai0+dm1hLmxp
c3QpOwogCisJSU5JVF9MSVNUX0hFQUQoJm9iai0+bW0ubGluayk7CisKIAlJTklUX0xJU1RfSEVB
RCgmb2JqLT5sdXRfbGlzdCk7CiAJSU5JVF9MSVNUX0hFQUQoJm9iai0+YmF0Y2hfcG9vbF9saW5r
KTsKIApAQCAtMjczLDE0ICsyNzUsNyBAQCB2b2lkIGk5MTVfZ2VtX2ZyZWVfb2JqZWN0KHN0cnVj
dCBkcm1fZ2VtX29iamVjdCAqZ2VtX29iaikKIAkgKiBvciBlbHNlIHdlIG1heSBvb20gd2hpbHN0
IHRoZXJlIGFyZSBwbGVudHkgb2YgZGVmZXJyZWQKIAkgKiBmcmVlZCBvYmplY3RzLgogCSAqLwot
CWlmIChpOTE1X2dlbV9vYmplY3RfaGFzX3BhZ2VzKG9iaikgJiYKLQkgICAgaTkxNV9nZW1fb2Jq
ZWN0X2lzX3Nocmlua2FibGUob2JqKSkgewotCQl1bnNpZ25lZCBsb25nIGZsYWdzOwotCi0JCXNw
aW5fbG9ja19pcnFzYXZlKCZpOTE1LT5tbS5vYmpfbG9jaywgZmxhZ3MpOwotCQlsaXN0X2RlbF9p
bml0KCZvYmotPm1tLmxpbmspOwotCQlzcGluX3VubG9ja19pcnFyZXN0b3JlKCZpOTE1LT5tbS5v
YmpfbG9jaywgZmxhZ3MpOwotCX0KKwlpOTE1X2dlbV9vYmplY3RfbWFrZV91bnNocmlua2FibGUo
b2JqKTsKIAogCS8qCiAJICogU2luY2Ugd2UgcmVxdWlyZSBibG9ja2luZyBvbiBzdHJ1Y3RfbXV0
ZXggdG8gdW5iaW5kIHRoZSBmcmVlZApkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUv
Z2VtL2k5MTVfZ2VtX29iamVjdC5oIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2Vt
X29iamVjdC5oCmluZGV4IDY3YWVhMDdlYTAxOS4uMzcxNGNmMjM0ZDY0IDEwMDY0NAotLS0gYS9k
cml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fb2JqZWN0LmgKKysrIGIvZHJpdmVycy9n
cHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX29iamVjdC5oCkBAIC0zOTQsNiArMzk0LDEwIEBAIGk5
MTVfZ2VtX29iamVjdF9waW5fdG9fZGlzcGxheV9wbGFuZShzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29i
amVjdCAqb2JqLAogCQkJCSAgICAgdW5zaWduZWQgaW50IGZsYWdzKTsKIHZvaWQgaTkxNV9nZW1f
b2JqZWN0X3VucGluX2Zyb21fZGlzcGxheV9wbGFuZShzdHJ1Y3QgaTkxNV92bWEgKnZtYSk7CiAK
K3ZvaWQgaTkxNV9nZW1fb2JqZWN0X21ha2VfdW5zaHJpbmthYmxlKHN0cnVjdCBkcm1faTkxNV9n
ZW1fb2JqZWN0ICpvYmopOwordm9pZCBpOTE1X2dlbV9vYmplY3RfbWFrZV9zaHJpbmthYmxlKHN0
cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmopOwordm9pZCBpOTE1X2dlbV9vYmplY3RfbWFr
ZV9wdXJnZWFibGUoc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iaik7CisKIHN0YXRpYyBp
bmxpbmUgYm9vbCBjcHVfd3JpdGVfbmVlZHNfY2xmbHVzaChzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29i
amVjdCAqb2JqKQogewogCWlmIChvYmotPmNhY2hlX2RpcnR5KQpkaWZmIC0tZ2l0IGEvZHJpdmVy
cy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX3BhZ2VzLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkx
NS9nZW0vaTkxNV9nZW1fcGFnZXMuYwppbmRleCBiMzZhZDI2OWY0ZWEuLjkyYWQzY2MyMjBlMyAx
MDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX3BhZ2VzLmMKKysr
IGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX3BhZ2VzLmMKQEAgLTE1MywyNCAr
MTUzLDEzIEBAIHN0YXRpYyB2b2lkIF9faTkxNV9nZW1fb2JqZWN0X3Jlc2V0X3BhZ2VfaXRlcihz
dHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2JqKQogc3RydWN0IHNnX3RhYmxlICoKIF9faTkx
NV9nZW1fb2JqZWN0X3Vuc2V0X3BhZ2VzKHN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmop
CiB7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSB0b19pOTE1KG9iai0+YmFzZS5k
ZXYpOwogCXN0cnVjdCBzZ190YWJsZSAqcGFnZXM7CiAKIAlwYWdlcyA9IGZldGNoX2FuZF96ZXJv
KCZvYmotPm1tLnBhZ2VzKTsKIAlpZiAoSVNfRVJSX09SX05VTEwocGFnZXMpKQogCQlyZXR1cm4g
cGFnZXM7CiAKLQlpZiAoaTkxNV9nZW1fb2JqZWN0X2lzX3Nocmlua2FibGUob2JqKSkgewotCQl1
bnNpZ25lZCBsb25nIGZsYWdzOwotCi0JCXNwaW5fbG9ja19pcnFzYXZlKCZpOTE1LT5tbS5vYmpf
bG9jaywgZmxhZ3MpOwotCi0JCWxpc3RfZGVsKCZvYmotPm1tLmxpbmspOwotCQlpOTE1LT5tbS5z
aHJpbmtfY291bnQtLTsKLQkJaTkxNS0+bW0uc2hyaW5rX21lbW9yeSAtPSBvYmotPmJhc2Uuc2l6
ZTsKLQotCQlzcGluX3VubG9ja19pcnFyZXN0b3JlKCZpOTE1LT5tbS5vYmpfbG9jaywgZmxhZ3Mp
OwotCX0KKwlpOTE1X2dlbV9vYmplY3RfbWFrZV91bnNocmlua2FibGUob2JqKTsKIAogCWlmIChv
YmotPm1tLm1hcHBpbmcpIHsKIAkJdm9pZCAqcHRyOwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUv
ZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX3Nocmlua2VyLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9n
ZW0vaTkxNV9nZW1fc2hyaW5rZXIuYwppbmRleCAzZjRjNmJkY2MzYzMuLjU2ZjZkODFjOGU2YSAx
MDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX3Nocmlua2VyLmMK
KysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX3Nocmlua2VyLmMKQEAgLTUz
MCwzICs1MzAsNTcgQEAgdm9pZCBpOTE1X2dlbV9zaHJpbmtlcl90YWludHNfbXV0ZXgoc3RydWN0
IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUsCiAJaWYgKHVubG9jaykKIAkJbXV0ZXhfcmVsZWFzZSgm
aTkxNS0+ZHJtLnN0cnVjdF9tdXRleC5kZXBfbWFwLCAwLCBfUkVUX0lQXyk7CiB9CisKKyNkZWZp
bmUgb2JqX3RvX2k5MTUob2JqX18pIHRvX2k5MTUoKG9ial9fKS0+YmFzZS5kZXYpCisKK3ZvaWQg
aTkxNV9nZW1fb2JqZWN0X21ha2VfdW5zaHJpbmthYmxlKHN0cnVjdCBkcm1faTkxNV9nZW1fb2Jq
ZWN0ICpvYmopCit7CisJR0VNX0JVR19PTighaTkxNV9nZW1fb2JqZWN0X2hhc19waW5uZWRfcGFn
ZXMob2JqKSk7CisKKwlpZiAoIWxpc3RfZW1wdHkoJm9iai0+bW0ubGluaykpIHsgLyogcGlubmVk
IGJ5IGNhbGxlciAqLworCQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IG9ial90b19p
OTE1KG9iaik7CisJCXVuc2lnbmVkIGxvbmcgZmxhZ3M7CisKKwkJc3Bpbl9sb2NrX2lycXNhdmUo
Jmk5MTUtPm1tLm9ial9sb2NrLCBmbGFncyk7CisJCUdFTV9CVUdfT04obGlzdF9lbXB0eSgmb2Jq
LT5tbS5saW5rKSk7CisKKwkJbGlzdF9kZWxfaW5pdCgmb2JqLT5tbS5saW5rKTsKKwkJaTkxNS0+
bW0uc2hyaW5rX2NvdW50LS07CisJCWk5MTUtPm1tLnNocmlua19tZW1vcnkgLT0gb2JqLT5iYXNl
LnNpemU7CisKKwkJc3Bpbl91bmxvY2tfaXJxcmVzdG9yZSgmaTkxNS0+bW0ub2JqX2xvY2ssIGZs
YWdzKTsKKwl9Cit9CisKK3N0YXRpYyB2b2lkIF9faTkxNV9nZW1fb2JqZWN0X21ha2Vfc2hyaW5r
YWJsZShzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2JqLAorCQkJCQkgICAgICBzdHJ1Y3Qg
bGlzdF9oZWFkICpoZWFkKQoreworCUdFTV9CVUdfT04oIWk5MTVfZ2VtX29iamVjdF9oYXNfcGFn
ZXMob2JqKSk7CisJR0VNX0JVR19PTighbGlzdF9lbXB0eSgmb2JqLT5tbS5saW5rKSk7CisKKwlp
ZiAoaTkxNV9nZW1fb2JqZWN0X2lzX3Nocmlua2FibGUob2JqKSkgeworCQlzdHJ1Y3QgZHJtX2k5
MTVfcHJpdmF0ZSAqaTkxNSA9IG9ial90b19pOTE1KG9iaik7CisJCXVuc2lnbmVkIGxvbmcgZmxh
Z3M7CisKKwkJc3Bpbl9sb2NrX2lycXNhdmUoJmk5MTUtPm1tLm9ial9sb2NrLCBmbGFncyk7CisJ
CUdFTV9CVUdfT04oIWtyZWZfcmVhZCgmb2JqLT5iYXNlLnJlZmNvdW50KSk7CisKKwkJbGlzdF9h
ZGRfdGFpbCgmb2JqLT5tbS5saW5rLCBoZWFkKTsKKwkJaTkxNS0+bW0uc2hyaW5rX2NvdW50Kys7
CisJCWk5MTUtPm1tLnNocmlua19tZW1vcnkgKz0gb2JqLT5iYXNlLnNpemU7CisKKwkJc3Bpbl91
bmxvY2tfaXJxcmVzdG9yZSgmaTkxNS0+bW0ub2JqX2xvY2ssIGZsYWdzKTsKKwl9Cit9CisKK3Zv
aWQgaTkxNV9nZW1fb2JqZWN0X21ha2Vfc2hyaW5rYWJsZShzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29i
amVjdCAqb2JqKQoreworCV9faTkxNV9nZW1fb2JqZWN0X21ha2Vfc2hyaW5rYWJsZShvYmosCisJ
CQkJCSAgJm9ial90b19pOTE1KG9iaiktPm1tLnNocmlua19saXN0KTsKK30KKwordm9pZCBpOTE1
X2dlbV9vYmplY3RfbWFrZV9wdXJnZWFibGUoc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9i
aikKK3sKKwlfX2k5MTVfZ2VtX29iamVjdF9tYWtlX3Nocmlua2FibGUob2JqLAorCQkJCQkgICZv
YmpfdG9faTkxNShvYmopLT5tbS5wdXJnZV9saXN0KTsKK30KZGlmZiAtLWdpdCBhL2RyaXZlcnMv
Z3B1L2RybS9pOTE1L2d0L2ludGVsX2NvbnRleHQuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0
L2ludGVsX2NvbnRleHQuYwppbmRleCA5ZTRmNTFjZTUyZmYuLjk4MzBlZGRhMWFkZSAxMDA2NDQK
LS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfY29udGV4dC5jCisrKyBiL2RyaXZl
cnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2NvbnRleHQuYwpAQCAtMTE4LDcgKzExOCw3IEBAIHN0
YXRpYyBpbnQgX19jb250ZXh0X3Bpbl9zdGF0ZShzdHJ1Y3QgaTkxNV92bWEgKnZtYSkKIAkgKiBB
bmQgbWFyayBpdCBhcyBhIGdsb2JhbGx5IHBpbm5lZCBvYmplY3QgdG8gbGV0IHRoZSBzaHJpbmtl
ciBrbm93CiAJICogaXQgY2Fubm90IHJlY2xhaW0gdGhlIG9iamVjdCB1bnRpbCB3ZSByZWxlYXNl
IGl0LgogCSAqLwotCXZtYS0+b2JqLT5waW5fZ2xvYmFsKys7CisJaTkxNV92bWFfbWFrZV91bnNo
cmlua2FibGUodm1hKTsKIAl2bWEtPm9iai0+bW0uZGlydHkgPSB0cnVlOwogCiAJcmV0dXJuIDA7
CkBAIC0xMjYsOCArMTI2LDggQEAgc3RhdGljIGludCBfX2NvbnRleHRfcGluX3N0YXRlKHN0cnVj
dCBpOTE1X3ZtYSAqdm1hKQogCiBzdGF0aWMgdm9pZCBfX2NvbnRleHRfdW5waW5fc3RhdGUoc3Ry
dWN0IGk5MTVfdm1hICp2bWEpCiB7Ci0Jdm1hLT5vYmotPnBpbl9nbG9iYWwtLTsKIAlfX2k5MTVf
dm1hX3VucGluKHZtYSk7CisJaTkxNV92bWFfbWFrZV9zaHJpbmthYmxlKHZtYSk7CiB9CiAKIHN0
YXRpYyB2b2lkIF9faW50ZWxfY29udGV4dF9yZXRpcmUoc3RydWN0IGk5MTVfYWN0aXZlICphY3Rp
dmUpCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9ndC5jIGIvZHJp
dmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfZ3QuYwppbmRleCBmN2U2OWRiNDAxOWQuLmRlMGQ2
YWQ1ZjkzYyAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfZ3QuYwor
KysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9ndC5jCkBAIC0yMzEsNyArMjMxLDgg
QEAgaW50IGludGVsX2d0X2luaXRfc2NyYXRjaChzdHJ1Y3QgaW50ZWxfZ3QgKmd0LCB1bnNpZ25l
ZCBpbnQgc2l6ZSkKIAlpZiAocmV0KQogCQlnb3RvIGVycl91bnJlZjsKIAotCWd0LT5zY3JhdGNo
ID0gdm1hOworCWd0LT5zY3JhdGNoID0gaTkxNV92bWFfbWFrZV91bnNocmlua2FibGUodm1hKTsK
KwogCXJldHVybiAwOwogCiBlcnJfdW5yZWY6CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0v
aTkxNS9ndC9pbnRlbF9yaW5nYnVmZmVyLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRl
bF9yaW5nYnVmZmVyLmMKaW5kZXggMzhlYzExYWU2ZWQ3Li5kOGVmYjg4ZjMzZjMgMTAwNjQ0Ci0t
LSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX3JpbmdidWZmZXIuYworKysgYi9kcml2
ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9yaW5nYnVmZmVyLmMKQEAgLTEyMzgsNyArMTIzOCw3
IEBAIGludCBpbnRlbF9yaW5nX3BpbihzdHJ1Y3QgaW50ZWxfcmluZyAqcmluZykKIAkJZ290byBl
cnJfcmluZzsKIAl9CiAKLQl2bWEtPm9iai0+cGluX2dsb2JhbCsrOworCWk5MTVfdm1hX21ha2Vf
dW5zaHJpbmthYmxlKHZtYSk7CiAKIAlHRU1fQlVHX09OKHJpbmctPnZhZGRyKTsKIAlyaW5nLT52
YWRkciA9IGFkZHI7CkBAIC0xMjY3LDYgKzEyNjcsOCBAQCB2b2lkIGludGVsX3JpbmdfcmVzZXQo
c3RydWN0IGludGVsX3JpbmcgKnJpbmcsIHUzMiB0YWlsKQogCiB2b2lkIGludGVsX3JpbmdfdW5w
aW4oc3RydWN0IGludGVsX3JpbmcgKnJpbmcpCiB7CisJc3RydWN0IGk5MTVfdm1hICp2bWEgPSBy
aW5nLT52bWE7CisKIAlpZiAoIWF0b21pY19kZWNfYW5kX3Rlc3QoJnJpbmctPnBpbl9jb3VudCkp
CiAJCXJldHVybjsKIApAQCAtMTI3NSwxOCArMTI3NywxNyBAQCB2b2lkIGludGVsX3JpbmdfdW5w
aW4oc3RydWN0IGludGVsX3JpbmcgKnJpbmcpCiAJLyogRGlzY2FyZCBhbnkgdW51c2VkIGJ5dGVz
IGJleW9uZCB0aGF0IHN1Ym1pdHRlZCB0byBody4gKi8KIAlpbnRlbF9yaW5nX3Jlc2V0KHJpbmcs
IHJpbmctPnRhaWwpOwogCi0JR0VNX0JVR19PTighcmluZy0+dm1hKTsKLQlpOTE1X3ZtYV91bnNl
dF9nZ3R0X3dyaXRlKHJpbmctPnZtYSk7Ci0JaWYgKGk5MTVfdm1hX2lzX21hcF9hbmRfZmVuY2Vh
YmxlKHJpbmctPnZtYSkpCi0JCWk5MTVfdm1hX3VucGluX2lvbWFwKHJpbmctPnZtYSk7CisJaTkx
NV92bWFfdW5zZXRfZ2d0dF93cml0ZSh2bWEpOworCWlmIChpOTE1X3ZtYV9pc19tYXBfYW5kX2Zl
bmNlYWJsZSh2bWEpKQorCQlpOTE1X3ZtYV91bnBpbl9pb21hcCh2bWEpOwogCWVsc2UKLQkJaTkx
NV9nZW1fb2JqZWN0X3VucGluX21hcChyaW5nLT52bWEtPm9iaik7CisJCWk5MTVfZ2VtX29iamVj
dF91bnBpbl9tYXAodm1hLT5vYmopOwogCiAJR0VNX0JVR19PTighcmluZy0+dmFkZHIpOwogCXJp
bmctPnZhZGRyID0gTlVMTDsKIAotCXJpbmctPnZtYS0+b2JqLT5waW5fZ2xvYmFsLS07Ci0JaTkx
NV92bWFfdW5waW4ocmluZy0+dm1hKTsKKwlpOTE1X3ZtYV91bnBpbih2bWEpOworCWk5MTVfdm1h
X21ha2VfcHVyZ2VhYmxlKHZtYSk7CiAKIAlpbnRlbF90aW1lbGluZV91bnBpbihyaW5nLT50aW1l
bGluZSk7CiB9CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC91Yy9pbnRlbF9n
dWMuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L3VjL2ludGVsX2d1Yy5jCmluZGV4IDgzZjJj
MTk3Mzc1Zi4uOWMxNzEyNzQ4NTI3IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9n
dC91Yy9pbnRlbF9ndWMuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC91Yy9pbnRlbF9n
dWMuYwpAQCAtNTk3LDcgKzU5Nyw3IEBAIHN0cnVjdCBpOTE1X3ZtYSAqaW50ZWxfZ3VjX2FsbG9j
YXRlX3ZtYShzdHJ1Y3QgaW50ZWxfZ3VjICpndWMsIHUzMiBzaXplKQogCQlnb3RvIGVycjsKIAl9
CiAKLQlyZXR1cm4gdm1hOworCXJldHVybiBpOTE1X3ZtYV9tYWtlX3Vuc2hyaW5rYWJsZSh2bWEp
OwogCiBlcnI6CiAJaTkxNV9nZW1fb2JqZWN0X3B1dChvYmopOwpkaWZmIC0tZ2l0IGEvZHJpdmVy
cy9ncHUvZHJtL2k5MTUvaTkxNV9kZWJ1Z2ZzLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1
X2RlYnVnZnMuYwppbmRleCA2Yjg0ZDA0YTZhMjguLmM0M2YyNzAwODVmNSAxMDA2NDQKLS0tIGEv
ZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9kZWJ1Z2ZzLmMKKysrIGIvZHJpdmVycy9ncHUvZHJt
L2k5MTUvaTkxNV9kZWJ1Z2ZzLmMKQEAgLTM2Myw4ICszNjMsOSBAQCBzdGF0aWMgaW50IGk5MTVf
Z2VtX29iamVjdF9pbmZvKHN0cnVjdCBzZXFfZmlsZSAqbSwgdm9pZCAqZGF0YSkKIAlzdHJ1Y3Qg
ZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IG5vZGVfdG9faTkxNShtLT5wcml2YXRlKTsKIAlpbnQg
cmV0OwogCi0Jc2VxX3ByaW50ZihtLCAiJXUgc2hyaW5rYWJsZSBvYmplY3RzLCAlbGx1IGJ5dGVz
XG4iLAorCXNlcV9wcmludGYobSwgIiV1IHNocmlua2FibGUgWyV1IGZyZWVdIG9iamVjdHMsICVs
bHUgYnl0ZXNcbiIsCiAJCSAgIGk5MTUtPm1tLnNocmlua19jb3VudCwKKwkJICAgYXRvbWljX3Jl
YWQoJmk5MTUtPm1tLmZyZWVfY291bnQpLAogCQkgICBpOTE1LT5tbS5zaHJpbmtfbWVtb3J5KTsK
IAogCXNlcV9wdXRjKG0sICdcbicpOwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUv
aTkxNV92bWEuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfdm1hLmMKaW5kZXggZWIxNmEx
YTkzYmJjLi5iNTJmNzFlMGFkZTYgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5
MTVfdm1hLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV92bWEuYwpAQCAtMTAzMCw2
ICsxMDMwLDIyIEBAIGludCBpOTE1X3ZtYV91bmJpbmQoc3RydWN0IGk5MTVfdm1hICp2bWEpCiAJ
cmV0dXJuIDA7CiB9CiAKK3N0cnVjdCBpOTE1X3ZtYSAqaTkxNV92bWFfbWFrZV91bnNocmlua2Fi
bGUoc3RydWN0IGk5MTVfdm1hICp2bWEpCit7CisJaTkxNV9nZW1fb2JqZWN0X21ha2VfdW5zaHJp
bmthYmxlKHZtYS0+b2JqKTsKKwlyZXR1cm4gdm1hOworfQorCit2b2lkIGk5MTVfdm1hX21ha2Vf
c2hyaW5rYWJsZShzdHJ1Y3QgaTkxNV92bWEgKnZtYSkKK3sKKwlpOTE1X2dlbV9vYmplY3RfbWFr
ZV9zaHJpbmthYmxlKHZtYS0+b2JqKTsKK30KKwordm9pZCBpOTE1X3ZtYV9tYWtlX3B1cmdlYWJs
ZShzdHJ1Y3QgaTkxNV92bWEgKnZtYSkKK3sKKwlpOTE1X2dlbV9vYmplY3RfbWFrZV9wdXJnZWFi
bGUodm1hLT5vYmopOworfQorCiAjaWYgSVNfRU5BQkxFRChDT05GSUdfRFJNX0k5MTVfU0VMRlRF
U1QpCiAjaW5jbHVkZSAic2VsZnRlc3RzL2k5MTVfdm1hLmMiCiAjZW5kaWYKZGlmZiAtLWdpdCBh
L2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfdm1hLmggYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9p
OTE1X3ZtYS5oCmluZGV4IDRiNzY5ZGI2NDliZi4uNWM0MjI0NzQ5YmRlIDEwMDY0NAotLS0gYS9k
cml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3ZtYS5oCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1
L2k5MTVfdm1hLmgKQEAgLTQ1OSw0ICs0NTksOCBAQCB2b2lkIGk5MTVfdm1hX3BhcmtlZChzdHJ1
Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSk7CiBzdHJ1Y3QgaTkxNV92bWEgKmk5MTVfdm1hX2Fs
bG9jKHZvaWQpOwogdm9pZCBpOTE1X3ZtYV9mcmVlKHN0cnVjdCBpOTE1X3ZtYSAqdm1hKTsKIAor
c3RydWN0IGk5MTVfdm1hICppOTE1X3ZtYV9tYWtlX3Vuc2hyaW5rYWJsZShzdHJ1Y3QgaTkxNV92
bWEgKnZtYSk7Cit2b2lkIGk5MTVfdm1hX21ha2Vfc2hyaW5rYWJsZShzdHJ1Y3QgaTkxNV92bWEg
KnZtYSk7Cit2b2lkIGk5MTVfdm1hX21ha2VfcHVyZ2VhYmxlKHN0cnVjdCBpOTE1X3ZtYSAqdm1h
KTsKKwogI2VuZGlmCi0tIAoyLjIyLjAKCl9fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fCkludGVsLWdmeCBtYWlsaW5nIGxpc3QKSW50ZWwtZ2Z4QGxpc3RzLmZy
ZWVkZXNrdG9wLm9yZwpodHRwczovL2xpc3RzLmZyZWVkZXNrdG9wLm9yZy9tYWlsbWFuL2xpc3Rp
bmZvL2ludGVsLWdmeA==

Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id DC72C19DA7D
	for <lists+intel-gfx@lfdr.de>; Fri,  3 Apr 2020 17:47:11 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 4C51B6EC15;
	Fri,  3 Apr 2020 15:47:10 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from mga14.intel.com (mga14.intel.com [192.55.52.115])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 178006EC15
 for <intel-gfx@lists.freedesktop.org>; Fri,  3 Apr 2020 15:47:09 +0000 (UTC)
IronPort-SDR: YBJ4aOIYmwMstAshdS3voRd+R5zdhB0DA7u+OXD4X1OpEknmIIX2n+qpVJyHQZ/Sj4pPujerme
 rZE/v1PGct9g==
X-Amp-Result: SKIPPED(no attachment in message)
X-Amp-File-Uploaded: False
Received: from fmsmga002.fm.intel.com ([10.253.24.26])
 by fmsmga103.fm.intel.com with ESMTP/TLS/ECDHE-RSA-AES256-GCM-SHA384;
 03 Apr 2020 08:47:08 -0700
IronPort-SDR: 6JtDM8ok5QiXzX+0XY9GZaDypUj+RwDVc0ng8h1jId1fNF0txaiJ64cJbHMmM+hYaPa877AYLd
 20GTzQVKUaSA==
X-ExtLoop1: 1
X-IronPort-AV: E=Sophos;i="5.72,340,1580803200"; d="scan'208";a="285156851"
Received: from unknown (HELO slisovsk-Lenovo-ideapad-720S-13IKB.fi.intel.com)
 ([10.237.72.89])
 by fmsmga002.fm.intel.com with ESMTP; 03 Apr 2020 08:47:05 -0700
From: Stanislav Lisovskiy <stanislav.lisovskiy@intel.com>
To: intel-gfx@lists.freedesktop.org
Date: Fri,  3 Apr 2020 18:43:30 +0300
Message-Id: <20200403154330.10164-1-stanislav.lisovskiy@intel.com>
X-Mailer: git-send-email 2.24.1.485.gad05a3d8e5
In-Reply-To: <20200403062910.12162-1-stanislav.lisovskiy@intel.com>
References: <20200403062910.12162-1-stanislav.lisovskiy@intel.com>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH v21 06/10] drm/i915: Add proper SAGV support for
 TGL+
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.29
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Cc: jani.nikula@intel.com
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

TGV0J3MgcmVmYWN0b3IgdGhlIHdob2xlIFNBR1YgbG9naWMsIG1vdmluZwp0aGUgbWFpbiBjYWxj
dWxhdGlvbnMgZnJvbSBpbnRlbF9jYW5fZW5hYmxlX3NhZ3YKdG8gaW50ZWxfY29tcHV0ZV9zYWd2
X21hc2ssIHdoaWNoIGFsc28gaGFuZGxlcwp0aGlzIGluIGEgdW5pZmllZCB3YXkgY2FsbGluZyBn
ZW4gc3BlY2lmaWMKZnVuY3Rpb25zIHRvIGV2YWx1YXRlIGlmIFNBR1YgaXMgYWxsb3dlZCBmb3IK
ZWFjaCBjcnRjLiBJZiBjcnRjIHNhZ3YgbWFzayBoYXZlIGJlZW4gY2hhbmdlZAp3ZSBzZXJpYWxp
emUgYWNjZXNzIGFuZCBtb2RpZnkgZ2xvYmFsIHN0YXRlLgoKaW50ZWxfY2FuX2VuYWJsZV9zYWd2
IG5vdyB1c2VzIGJ3X3N0YXRlIHdoaWNoCnN0b3JlcyBhbGwgaW5mb3JtYXRpb24gcmVsYXRlZCB0
byBTQUdWIGFuZAppcyBub3cgYSB0cml2aWFsIGhlbHBlci4KCnYyOgogICAgLSBSZXdvcmsgd2F0
ZXJtYXJrIGNhbGN1bGF0aW9uIGFsZ29yaXRobSB0bwogICAgICBhdHRlbXB0IHRvIGNhbGN1bGF0
ZSBMZXZlbCAwIHdhdGVybWFyawogICAgICB3aXRoIGFkZGVkIHNhZ3YgYmxvY2sgdGltZSBsYXRl
bmN5IGFuZAogICAgICBjaGVjayBpZiBpdCBmaXRzIGluIERCdWYgaW4gb3JkZXIgdG8KICAgICAg
ZGV0ZXJtaW5lIGlmIFNBR1YgY2FuIGJlIGVuYWJsZWQgYWxyZWFkeQogICAgICBhdCB0aGlzIHN0
YWdlLCBqdXN0IGFzIEJTcGVjIDQ5MzI1IHN0YXRlcy4KICAgICAgaWYgdGhhdCBmYWlscyByb2xs
YmFjayB0byB1c3VhbCBMZXZlbCAwCiAgICAgIGxhdGVuY3kgYW5kIGRpc2FibGUgU0FHVi4KICAg
IC0gUmVtb3ZlIHVubmVlZGVkIHRhYnMoSmFtZXMgQXVzbXVzKQoKdjM6IFJlYmFzZWQgdGhlIHBh
dGNoCgp2NDogLSBBZGRlZCBiYWNrIGludGVybGFjZWQgY2hlY2sgZm9yIEdlbjEyIGFuZAogICAg
ICBhZGRlZCBzZXBhcmF0ZSBmdW5jdGlvbiBmb3IgVEdMIFNBR1YgY2hlY2sKICAgICAgKHRoYW5r
cyB0byBKYW1lcyBBdXNtdXMgZm9yIHNwb3R0aW5nKQogICAgLSBSZW1vdmVkIHVubmVlZGVkIGdl
biBjaGVjawogICAgLSBFeHRyYWN0ZWQgR2VuMTIgU0FHViBkZWNpc2lvbiBtYWtpbmcgY29kZQog
ICAgICB0byBhIHNlcGFyYXRlIGZ1bmN0aW9uIGZyb20gc2tsX2NvbXB1dGVfd20KCnY1OiAtIEFk
ZGVkIFNBR1YgZ2xvYmFsIHN0YXRlIHRvIGRldl9wcml2LCBiZWNhdXNlCiAgICAgIHdlIG5lZWQg
dG8gdHJhY2sgYWxsIHBpcGVzLCBub3Qgb25seSB0aG9zZQogICAgICBpbiBhdG9taWMgc3RhdGUu
IEVhY2ggcGlwZSBoYXMgbm93IGNvcnJlc3BvbmRlbnQKICAgICAgYml0IG1hc2sgcmVmbGVjdGlu
Zywgd2hldGhlciBpdCBjYW4gdG9sZXJhdGUKICAgICAgU0FHViBvciBub3QodGhhbmtzIHRvIFZp
bGxlIFN5cmphbGEgZm9yIHN1Z2dlc3Rpb25zKS4KICAgIC0gTm93IHVzaW5nIGFjdGl2ZSBmbGFn
IGluc3RlYWQgb2YgZW5hYmxlIGluIGNyYwogICAgICB1c2FnZSBjaGVjay4KCnY2OiAtIEZpeGVk
IHJlYmFzZSBjb25mbGljdHMKCnY3OiAtIGttc19jdXJzb3JfbGVnYWN5IHNlZW1zIHRvIGdldCBi
cm9rZW4gYmVjYXVzZSBvZiBtdWx0aXBsZSBtZW1jcHkKICAgICAgY2FsbHMgd2hlbiBjb3B5aW5n
IGxldmVsIDAgd2F0ZXIgbWFya3MgZm9yIGVuYWJsZWQgU0FHViwgdG8KICAgICAgZml4IHRoaXMg
bm93IHNpbXBseSB1c2luZyB0aGF0IGZpZWxkIHJpZ2h0IGF3YXksIHdpdGhvdXQgY29weWluZywK
ICAgICAgZm9yIHRoYXQgaW50cm9kdWNlZCBhIG5ldyB3bV9sZXZlbCBhY2Nlc3NvciB3aGljaCBk
ZWNpZGVzIHdoaWNoCiAgICAgIHdtX2xldmVsIHRvIHJldHVybiBiYXNlZCBvbiBTQUdWIHN0YXRl
LgoKdjg6IC0gUHJvdGVjdCBjcnRjX3NhZ3ZfbWFzayBzYW1lIHdheSBhcyB3ZSBkbyBmb3Igb3Ro
ZXIgZ2xvYmFsIHN0YXRlCiAgICAgIGNoYW5nZXM6IGkuZSBjaGVjayBpZiBjaGFuZ2VzIGFyZSBu
ZWVkZWQsIHRoZW4gZ3JhYiBhbGwgY3J0YyBsb2NrcwogICAgICB0byBzZXJpYWxpemUgdGhlIGNo
YW5nZXMoVmlsbGUgU3lyasOkbMOkKQogICAgLSBBZGQgY3J0Y19zYWd2X21hc2sgY2FjaGluZyBp
biBvcmRlciB0byBhdm9pZCBuZWVkbGVzcyByZWNhbGN1bGF0aW9ucwogICAgICAoTWF0dGhldyBS
b3BlcikKICAgIC0gUHV0IGJhY2sgR2VuMTIgU0FHViBzd2l0Y2ggaW4gb3JkZXIgdG8gZ2V0IGl0
IGVuYWJsZWQgaW4gc2VwYXJhdGUKICAgICAgcGF0Y2goTWF0dGhldyBSb3BlcikKICAgIC0gUmVu
YW1lICpfc2V0X3NhZ3ZfbWFzayB0byAqX2NvbXB1dGVfc2Fndl9tYXNrKE1hdHRoZXcgUm9wZXIp
CiAgICAtIENoZWNrIGlmIHRoZXJlIGFyZSBubyBhY3RpdmUgcGlwZXMgaW4gaW50ZWxfY2FuX2Vu
YWJsZV9zYWd2CiAgICAgIGluc3RlYWQgb2YgcGxhdGZvcm0gc3BlY2lmaWMgZnVuY3Rpb25zKE1h
dHRoZXcgUm9wZXIpLCBzYW1lCiAgICAgIGZvciBpbnRlbF9oYXNfc2FndiBjaGVjay4KCnY5ICAt
IFN3aXRjaGVkIHRvIHU4IGZvciBjcnRjX3NhZ3ZfbWFzayhWaWxsZSBTeXJqw6Rsw6QpCiAgICAt
IGNydGNfc2Fndl9tYXNrIG5vdyBpcyBwaXBlX3NhZ3ZfbWFzayhWaWxsZSBTeXJqw6Rsw6QpCiAg
ICAtIEV4dHJhY3RlZCBzYWd2IGNoZWNraW5nIGxvZ2ljIGZyb20gc2tsL2ljbC90Z2xfY29tcHV0
ZV9zYWd2X21hc2sKICAgIC0gRXh0cmFjdGVkIHNrbF9wbGFuZV93bV9sZXZlbCBmdW5jdGlvbiBh
bmQgcGFzc2luZyBsYXRlbmN5IHRvCiAgICAgIHNlcGFyYXRlIHBhdGNoZXMoVmlsbGUgU3lyasOk
bMOkKQogICAgLSBSZW1vdmVkIHBhcnQgb2YgdW5uZWVkZWQgY29weS1wYXN0ZSBmcm9tIHRnbF9j
aGVja19waXBlX2ZpdHNfc2Fndl93bQogICAgICAoVmlsbGUgU3lyasOkbMOkKQogICAgLSBOb3cg
dXNpbmcgc2ltcGxlIGFzc2lnbm1lbnQgZm9yIHNhZ3Zfd20wIGFzIGl0IGNvbnRhaW5zIG9ubHkK
ICAgICAgcG9kIHR5cGVzIGFuZCBubyBwb2ludGVycyhWaWxsZSBTeXJqw6Rsw6QpCiAgICAtIEZp
eGVkIGludGVsX2Nhbl9lbmFibGVfc2FndiBub3QgdG8gZG8gZG91YmxlIGR1dHksIG5vdyBpdCBv
bmx5CiAgICAgIGNoZWNrIFNBR1YgYml0cyBieSBBTkRpbmcgdGhvc2UgYmV0d2VlbiBsb2NhbCBh
bmQgZ2xvYmFsIHN0YXRlLgogICAgICBUaGUgU0FHViBtYXNrcyBhcmUgbm93IGNvbXB1dGVkIGFm
dGVyIHdhdGVybWFya3MgYXJlIGF2YWlsYWJsZSwKICAgICAgaW4gb3JkZXIgdG8gYmUgYWJsZSB0
byBmaWd1cmUgb3V0IGlmIGRkYiByYW5nZXMgYXJlIGZpdHRpbmcgbmljZWx5LgogICAgICAoVmls
bGUgU3lyasOkbMOkKQogICAgLSBOb3cgaGF2aW5nIHV2X3NhZ3Zfd20wIGFuZCBzYWd2X3dtMCwg
b3RoZXJ3aXNlIHdlIGhhdmUgd3JvbmcgbG9naWMKICAgICAgd2hlbiB1c2luZyBza2xfcGxhbmVf
d21fbGV2ZWwgYWNjZXNzb3IsIGFzIHdlIGhhZCBwcmV2aW91c2x5IGZvcgogICAgICBHZW4xMSsg
Y29sb3IgcGxhbmUgYW5kIHJlZ3VsYXIgd20gbGV2ZWxzLCBzbyBwcm9iYWJseSBib3RoCiAgICAg
IGhhcyB0byBiZSByZWNhbGN1bGF0ZWQgd2l0aCBhZGRpdGlvbmFsIFNBR1YgYmxvY2sgdGltZSBm
b3IgTGV2ZWwgMC4KCnYxMDogLSBTdGFydGluZyB0byB1c2UgbmV3IGdsb2JhbCBzdGF0ZSBmb3Ig
c3RvcmluZyBwaXBlX3NhZ3ZfbWFzawoKdjExOiAtIEZpeGVkIHJlYmFzZSBjb25mbGljdCB3aXRo
IHJlY2VudCBkcm0tdGlwCiAgICAgLSBDaGVjayBpZiB3ZSByZWFsbHkgbmVlZCB0byByZWNhbGN1
bGF0ZSBTQUdWIG1hc2ssIG90aGVyd2lzZQogICAgICAgYmFpbCBvdXQgd2l0aG91dCBtYWtpbmcg
YW55IGNoYW5nZXMuCiAgICAgLSBVc2UgY2FjaGVkIFNBR1YgcmVzdWx0LCBpbnN0ZWFkIG9mIHJl
Y2FsY3VsYXRpbmcgaXQgZXZlcnl0aW1lLAogICAgICAgaWYgYndfc3RhdGUgaGFzbid0IGNoYW5n
ZWQuCgp2MTI6IC0gUmVtb3ZlZCBXQVJOIGZyb20gaW50ZWxfY2FuX2VuYWJsZV9zYWd2LCBpbiBz
b21lIG9mIHRoZSBjb21taXRzCiAgICAgICBpZiB3ZSBkb24ndCByZWNhbGN1bGF0ZWQgd2F0ZXJt
YXJrcywgYndfc3RhdGUgaXMgbm90IHJlY2FsY3VsYXRlZCwKICAgICAgIHRodXMgbGVhZGluZyB0
byBTQUdWIHN0YXRlIG5vdCByZWNhbGN1bGF0ZWQgYnkgdGhlIGNvbW1pdCBzdGF0ZSwKICAgICAg
IHdoaWNoIGlzIHN0aWxsIGNhbGxpbmcgaW50ZWxfY2FuX2VuYWJsZV9zYWd2IGZ1bmN0aW9uLiBG
aXggdGhhdAogICAgICAgYnkganVzdCBhbmFseXppbmcgdGhlIGN1cnJlbnQgZ2xvYmFsIGJ3X3N0
YXRlIG9iamVjdCAtIGJlY2F1c2UKICAgICAgIHdlIHNpbXBseSBoYXZlIG5vIG90aGVyIG9iamVj
dHMgcmVsYXRlZCB0byB0aGF0LgoKdjEzOiAtIFJlYmFzZWQsIGZpeGVkIHdhcm5pbmdzIHJlZ2Fy
ZGluZyBsb25nIGxpbmVzCiAgICAgLSBDaGFuZ2VkIGZ1bmN0aW9uIGNhbGwgc2l0ZXMgZnJvbSBp
bnRlbF9hdG9taWNfYncqIHRvCiAgICAgICBpbnRlbF93Yl8qIGFzIHdhcyBzdWdnZXN0ZWQuKEph
bmkgTmlrdWxhKQogICAgIC0gVGFrZW4gZGRiX3N0YXRlX2NoYW5nZWQgYW5kIGJ3X3N0YXRlX2No
YW5nZWQgaW50byB1c2UuCgp2MTQ6IC0gdG90YWxfYWZmZWN0ZWRfcGxhbmVzIGlzIG5vIGxvbmdl
ciBuZWVkZWQgdG8gY2hlY2sgZm9yIGRkYiBjaGFuZ2VzLAogICAgICAganVzdCBhcyBhY3RpdmVf
cGlwZV9jaGFuZ2VzLgoKdjE1OiAtIEZpeGVkIHN0dXBpZCBtaXN0YWtlIHdpdGggdW5pbml0aWFs
aXplZCBjcnRjIGluCiAgICAgICBza2xfY29tcHV0ZV9zYWd2X21hc2suCgp2MTY6IC0gQ29udmVy
dCBwaXBlX3NhZ3ZfbWFzayB0byBwaXBlX3NhZ3ZfcmVqZWN0IGFuZCBub3cgdXNpbmcgaW52ZXJ0
ZWQKICAgICAgIGZsYWcgdG8gaW5kaWNhdGUgU0FHViByZWFkaW5lc3MgZm9yIHRoZSBwaXBlKFZp
bGxlIFN5cmrDpGzDpCkKICAgICAtIEFkZGVkIHJldHVybiB2YWx1ZSB0byBpbnRlbF9jb21wdXRl
X3NhZ3ZfbWFzayB3aGljaCBjYWxsCiAgICAgICBpbnRlbF9hdG9taWNfc2VyaWFsaXplX2dsb2Jh
bF9zdGF0ZSBpbiBvcmRlciB0byBwcm9wZXJseQogICAgICAgcHJvcGFnYXRlIEVERUFETENLIHRv
IGRybS4KICAgICAtIEJhc2VkIG9uIHRoZSBkaXNjdXNzaW9uIHdpdGggVmlsbGUsIHJlbW92ZWQg
YWN0aXZlX3BpcGVfY2hhbmdlcwogICAgICAgY2hlY2sgYW5kIGFsc28gdGhlcmUgc2VlbXMgdG8g
YmUgbm8gbmVlZCBmb3IgY2hlY2tpbmcKICAgICAgIGRkYl9zdGF0ZV9jaGFuZ2VzIGFzIHdlbGwu
CiAgICAgICBJbnN0ZWFkIHdlIGp1c3QgaXRlcmF0ZSB0aHJvdWdoIGNydGNzIGluIHN0YXRlIC0g
aGF2aW5nCiAgICAgICBjcnRjIGluIGEgc3RhdGUgYWxyZWFkeSBndWFyYW50ZWVzIHRoYXQgaXQg
aXMgYXQgbGVhc3QgcmVhZC1sb2NrZWQKICAgICAgIEhhdmluZyBhZGRpdGlvbmFsIGZsYWcgdG8g
Y2hlY2sgaWYgdGhlcmUgYWN0dWFsbHkgd2VyZSBzb21lIHBsYW5lCiAgICAgICB3bS9kZGIgY2hh
bmdlcyB3b3VsZCBiZSBwcm9iYWJseSBhZGRlZCBsYXRlciBhcyBhbiBvcHRpbWl6YXRpb24uCiAg
ICAgLSBXZSBjYW4ndCBnZXQgcGFyZW50IGF0b21pYyBzdGF0ZSBmcm9tIGNydGNfc3RhdGUgYXQg
Y29tbWl0IHN0YWdlCiAgICAgICAobmljZSBkcm0gZmVhdHVyZSksIGFsc28gcHJvcGFnYXRpbmcg
c3RhdGUgdGhyb3VnaCBmdW5jdGlvbiBjYWxsCiAgICAgICBjaGFpbiBzZWVtcyB0byBiZSBvdmVy
a2lsbCBhbmQgbm90IHBvc3NpYmxlKGN1cnNvciBsZWdhY3kgdXBkYXRlcykKICAgICAgIFF1ZXJ5
aW5nIGZvciBid19zdGF0ZSBvYmplY3QgZnJvbSBnbG9iYWwgc3RhdGUgaXMgbm90IHBvc3NpYmxl
IGFzCiAgICAgICBpdCBtaWdodCBnZXQgc3dhcHBlZCB3aXRoIG90aGVyIGdsb2JhbCBzdGF0ZS4K
ICAgICAgIFNvLi4uIGp1c3Qgc3RpY2tlZCBjYW5fc2FndiBib29sZWFuIGludG8gd20gY3J0YyBz
dGF0ZS4KCnYxNzogLSBTa2lwIGluYWN0aXZlIGNydGNzLCB3aGVuIGNoZWNraW5nIGZvciBTQUdW
LXJlYWRpbmVzcy4KCnYxODogLSBTd2l0Y2ggdG8gdXNlIGludGVsX2F0b21pY19jcnRjX3N0YXRl
X2Zvcl9lYWNoX3BsYW5lX3N0YXRlCiAgICAgICBpbnN0ZWFkIG9mIGZvcl9lYWNoX2ludGVsX3Bs
YW5lX29uX2NydGMgYW5kIGZpeGVkIHByZXZpb3VzCiAgICAgICBjb2RlLCB3aGljaCB3YXMgdXNp
bmcgb2xkIHBsYW5lIHN0YXRlLCB3aGljaCBjYXVzZWQgTlVMTCBwdHIKICAgICAgIGRlcmVmZXJl
bmNlLCBiYWNhdXNlIHRoYXQgY29kZSBpcyBub3cgY2FsbGVkIGJlZm9yZSB3ZSBzd2FwIHRoZQog
ICAgICAgc3RhdGUuCgp2MTk6IC0gVXNlIGludGVsX2F0b21pY19id18qIHBhdHRlcm4gYWdhaW4K
ICAgICAtIE9wdGltaXplZCBzYWd2IGNoZWNrcyBpbiB2ZXJpZnlfd21fc3RhdGUoVmlsbGUgU3ly
asOkbMOkKQogICAgIC0gRG8gaW50ZWxfY29tcHV0ZV9zYWd2X21hc2sgYWZ0ZXIgZGRiIGlzIGFs
bG9jYXRlZChWaWxsZSBTeXJqw6Rsw6QpLAogICAgICAgdXNpbmcgaXQncyByZXN1bHRzCiAgICAg
LSBVc2UgYndfc3RhdGUgaW4gaW50ZWxfY2FuX2VuYWJsZV9zYWd2CiAgICAgLSBVc2UgQ09MT1Jf
UExBTkUgZW51bSBpbnN0ZWFkIG9mIGJvb2xlYW4geXV2IG9yICIwIiwgIjEiIG1hZ2ljCiAgICAg
LSBFeHRyYWN0ZWQgc2FndiB3bTAgY2FsY3VsYXRpb24gaW50byBzZXBhcmF0ZSBza2xfY29tcHV0
ZV9zYWd2X3dtCiAgICAgICBmdW5jdGlvbihWaWxsZSBTeXJqw6Rsw6QpCgp2MjA6IC0gQWRkZWQg
Y2hlY2sgZm9yIE5VTEwgZm9yIGJ3X3N0YXRlIGluIGNvbW1pdF90YWlsCiAgICAgLSBSZW1vdmVk
IGxvbmcgY29tbWVudHMgYW5kIHdhcm5zKFZpbGxlKQogICAgIC0gRXh0cmFjdGVkIGlmIGxhZGRl
ciBmcm9tIGNvbXB1dGVfc2FndihWaWxsZSkKICAgICAtIFJlbW92ZWQgc29tZSBkZWJ1Z3MoVmls
bGUpCiAgICAgLSBFeHRyYWN0ZWQgc2Fndl93bTAgaW5pdCBmcm9tIHRoZSBsb29wIGluIHNrbF9w
aXBlX3dtX2dldF9od19zdGF0ZQogICAgICAgKFZpbGxlKQogICAgIC0gTm93IHByaW50aW5nIHNh
Z3Zfd20wIHNlcGFyYXRlbHkoVmlsbGUpCgp2MjE6IC0gRml4IHNvbWUgbml0cGlja3MgdG8gbWFr
ZSBjaGVja3BhdGNoIGhhcHB5CgpTaWduZWQtb2ZmLWJ5OiBTdGFuaXNsYXYgTGlzb3Zza2l5IDxz
dGFuaXNsYXYubGlzb3Zza2l5QGludGVsLmNvbT4KQ2M6IFZpbGxlIFN5cmrDpGzDpCA8dmlsbGUu
c3lyamFsYUBpbnRlbC5jb20+CkNjOiBKYW1lcyBBdXNtdXMgPGphbWVzLmF1c211c0BpbnRlbC5j
b20+Ci0tLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9idy5oICAgICAgIHwg
ICA2ICsKIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZGlzcGxheS5jICB8ICAy
NyArKy0KIC4uLi9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2Rpc3BsYXlfdHlwZXMuaCAgICB8ICAg
MyArCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9pbnRlbF9wbS5jICAgICAgICAgICAgICAgfCAxNzkg
KysrKysrKysrKysrKysrKy0tCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9pbnRlbF9wbS5oICAgICAg
ICAgICAgICAgfCAgIDQgKy0KIDUgZmlsZXMgY2hhbmdlZCwgMTk1IGluc2VydGlvbnMoKyksIDI0
IGRlbGV0aW9ucygtKQoKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkv
aW50ZWxfYncuaCBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfYncuaAppbmRl
eCBhYzAwNGQ2ZjQyNzYuLmQ2ZGY5MTA1ODIyMyAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJt
L2k5MTUvZGlzcGxheS9pbnRlbF9idy5oCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3Bs
YXkvaW50ZWxfYncuaApAQCAtMTgsNiArMTgsMTIgQEAgc3RydWN0IGludGVsX2NydGNfc3RhdGU7
CiBzdHJ1Y3QgaW50ZWxfYndfc3RhdGUgewogCXN0cnVjdCBpbnRlbF9nbG9iYWxfc3RhdGUgYmFz
ZTsKIAorCS8qCisJICogQ29udGFpbnMgYSBiaXQgbWFzaywgdXNlZCB0byBkZXRlcm1pbmUsIHdo
ZXRoZXIgY29ycmVzcG9uZGVudAorCSAqIHBpcGUgYWxsb3dzIFNBR1Ygb3Igbm90LgorCSAqLwor
CXU4IHBpcGVfc2Fndl9yZWplY3Q7CisKIAl1bnNpZ25lZCBpbnQgZGF0YV9yYXRlW0k5MTVfTUFY
X1BJUEVTXTsKIAl1OCBudW1fYWN0aXZlX3BsYW5lc1tJOTE1X01BWF9QSVBFU107CiB9OwpkaWZm
IC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kaXNwbGF5LmMgYi9k
cml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2Rpc3BsYXkuYwppbmRleCBlNjMwNDI5
YWYyYzAuLmE4YTM2NDA3YWI5NiAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlz
cGxheS9pbnRlbF9kaXNwbGF5LmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9p
bnRlbF9kaXNwbGF5LmMKQEAgLTE0MDA5LDcgKzE0MDA5LDkgQEAgc3RhdGljIHZvaWQgdmVyaWZ5
X3dtX3N0YXRlKHN0cnVjdCBpbnRlbF9jcnRjICpjcnRjLAogCQkvKiBXYXRlcm1hcmtzICovCiAJ
CWZvciAobGV2ZWwgPSAwOyBsZXZlbCA8PSBtYXhfbGV2ZWw7IGxldmVsKyspIHsKIAkJCWlmIChz
a2xfd21fbGV2ZWxfZXF1YWxzKCZod19wbGFuZV93bS0+d21bbGV2ZWxdLAotCQkJCQkJJnN3X3Bs
YW5lX3dtLT53bVtsZXZlbF0pKQorCQkJCQkJJnN3X3BsYW5lX3dtLT53bVtsZXZlbF0pIHx8CisJ
CQkgICAgKGxldmVsID09IDAgJiYgc2tsX3dtX2xldmVsX2VxdWFscygmaHdfcGxhbmVfd20tPndt
W2xldmVsXSwKKwkJCQkJCQkgICAgICAgJnN3X3BsYW5lX3dtLT5zYWd2X3dtMCkpKQogCQkJCWNv
bnRpbnVlOwogCiAJCQlkcm1fZXJyKCZkZXZfcHJpdi0+ZHJtLApAQCAtMTQwNjQsNyArMTQwNjYs
OSBAQCBzdGF0aWMgdm9pZCB2ZXJpZnlfd21fc3RhdGUoc3RydWN0IGludGVsX2NydGMgKmNydGMs
CiAJCS8qIFdhdGVybWFya3MgKi8KIAkJZm9yIChsZXZlbCA9IDA7IGxldmVsIDw9IG1heF9sZXZl
bDsgbGV2ZWwrKykgewogCQkJaWYgKHNrbF93bV9sZXZlbF9lcXVhbHMoJmh3X3BsYW5lX3dtLT53
bVtsZXZlbF0sCi0JCQkJCQkmc3dfcGxhbmVfd20tPndtW2xldmVsXSkpCisJCQkJCQkmc3dfcGxh
bmVfd20tPndtW2xldmVsXSkgfHwKKwkJCSAgICAobGV2ZWwgPT0gMCAmJiBza2xfd21fbGV2ZWxf
ZXF1YWxzKCZod19wbGFuZV93bS0+d21bbGV2ZWxdLAorCQkJCQkJCSAgICAgICAmc3dfcGxhbmVf
d20tPnNhZ3Zfd20wKSkpCiAJCQkJY29udGludWU7CiAKIAkJCWRybV9lcnIoJmRldl9wcml2LT5k
cm0sCkBAIC0xNTU0Myw4ICsxNTU0NywxMyBAQCBzdGF0aWMgdm9pZCBpbnRlbF9hdG9taWNfY29t
bWl0X3RhaWwoc3RydWN0IGludGVsX2F0b21pY19zdGF0ZSAqc3RhdGUpCiAJCSAqIFNLTCB3b3Jr
YXJvdW5kOiBic3BlYyByZWNvbW1lbmRzIHdlIGRpc2FibGUgdGhlIFNBR1Ygd2hlbiB3ZQogCQkg
KiBoYXZlIG1vcmUgdGhlbiBvbmUgcGlwZSBlbmFibGVkCiAJCSAqLwotCQlpZiAoIWludGVsX2Nh
bl9lbmFibGVfc2FndihzdGF0ZSkpCi0JCQlpbnRlbF9kaXNhYmxlX3NhZ3YoZGV2X3ByaXYpOwor
CQlpZiAoSU5URUxfR0VOKGRldl9wcml2KSA8IDExKSB7CisJCQljb25zdCBzdHJ1Y3QgaW50ZWxf
Yndfc3RhdGUgKmJ3X3N0YXRlID0KKwkJCQlpbnRlbF9hdG9taWNfZ2V0X25ld19id19zdGF0ZShz
dGF0ZSk7CisKKwkJCWlmIChid19zdGF0ZSAmJiAhaW50ZWxfY2FuX2VuYWJsZV9zYWd2KGJ3X3N0
YXRlKSkKKwkJCQlpbnRlbF9kaXNhYmxlX3NhZ3YoZGV2X3ByaXYpOworCQl9CiAKIAkJaW50ZWxf
bW9kZXNldF92ZXJpZnlfZGlzYWJsZWQoZGV2X3ByaXYsIHN0YXRlKTsKIAl9CkBAIC0xNTY0NCw4
ICsxNTY1MywxNCBAQCBzdGF0aWMgdm9pZCBpbnRlbF9hdG9taWNfY29tbWl0X3RhaWwoc3RydWN0
IGludGVsX2F0b21pY19zdGF0ZSAqc3RhdGUpCiAJaWYgKHN0YXRlLT5tb2Rlc2V0KQogCQlpbnRl
bF92ZXJpZnlfcGxhbmVzKHN0YXRlKTsKIAotCWlmIChzdGF0ZS0+bW9kZXNldCAmJiBpbnRlbF9j
YW5fZW5hYmxlX3NhZ3Yoc3RhdGUpKQotCQlpbnRlbF9lbmFibGVfc2FndihkZXZfcHJpdik7CisJ
aWYgKElOVEVMX0dFTihkZXZfcHJpdikgPCAxMSkgeworCQlzdHJ1Y3QgaW50ZWxfYndfc3RhdGUg
KmJ3X3N0YXRlOworCisJCWJ3X3N0YXRlID0gaW50ZWxfYXRvbWljX2dldF9uZXdfYndfc3RhdGUo
c3RhdGUpOworCisJCWlmIChid19zdGF0ZSAmJiBzdGF0ZS0+bW9kZXNldCAmJiBpbnRlbF9jYW5f
ZW5hYmxlX3NhZ3YoYndfc3RhdGUpKQorCQkJaW50ZWxfZW5hYmxlX3NhZ3YoZGV2X3ByaXYpOwor
CX0KIAogCWRybV9hdG9taWNfaGVscGVyX2NvbW1pdF9od19kb25lKCZzdGF0ZS0+YmFzZSk7CiAK
ZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZGlzcGxheV90
eXBlcy5oIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kaXNwbGF5X3R5cGVz
LmgKaW5kZXggNTIzZTA0NDRiMzczLi41MWZhNWE3NDZhNWYgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMv
Z3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZGlzcGxheV90eXBlcy5oCisrKyBiL2RyaXZlcnMv
Z3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZGlzcGxheV90eXBlcy5oCkBAIC02NzksNiArNjc5
LDggQEAgc3RydWN0IHNrbF9wbGFuZV93bSB7CiAJc3RydWN0IHNrbF93bV9sZXZlbCB3bVs4XTsK
IAlzdHJ1Y3Qgc2tsX3dtX2xldmVsIHV2X3dtWzhdOwogCXN0cnVjdCBza2xfd21fbGV2ZWwgdHJh
bnNfd207CisJc3RydWN0IHNrbF93bV9sZXZlbCBzYWd2X3dtMDsKKwlzdHJ1Y3Qgc2tsX3dtX2xl
dmVsIHV2X3NhZ3Zfd20wOwogCWJvb2wgaXNfcGxhbmFyOwogfTsKIApAQCAtNjg5LDYgKzY5MSw3
IEBAIGVudW0gY29sb3JfcGxhbmUgewogCiBzdHJ1Y3Qgc2tsX3BpcGVfd20gewogCXN0cnVjdCBz
a2xfcGxhbmVfd20gcGxhbmVzW0k5MTVfTUFYX1BMQU5FU107CisJYm9vbCBjYW5fc2FndjsKIH07
CiAKIGVudW0gdmx2X3dtX2xldmVsIHsKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1
L2ludGVsX3BtLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pbnRlbF9wbS5jCmluZGV4IGUxMjE3
ODY3ZGJkYy4uMTc3ZDdlY2IwY2RkIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9p
bnRlbF9wbS5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2ludGVsX3BtLmMKQEAgLTQzLDYg
KzQzLDcgQEAKICNpbmNsdWRlICJpOTE1X2ZpeGVkLmgiCiAjaW5jbHVkZSAiaTkxNV9pcnEuaCIK
ICNpbmNsdWRlICJpOTE1X3RyYWNlLmgiCisjaW5jbHVkZSAiZGlzcGxheS9pbnRlbF9idy5oIgog
I2luY2x1ZGUgImludGVsX3BtLmgiCiAjaW5jbHVkZSAiaW50ZWxfc2lkZWJhbmQuaCIKICNpbmNs
dWRlICIuLi8uLi8uLi9wbGF0Zm9ybS94ODYvaW50ZWxfaXBzLmgiCkBAIC0zNjM0LDcgKzM2MzUs
NyBAQCBzdGF0aWMgYm9vbCBza2xfbmVlZHNfbWVtb3J5X2J3X3dhKHN0cnVjdCBkcm1faTkxNV9w
cml2YXRlICpkZXZfcHJpdikKIAlyZXR1cm4gSVNfR0VOOV9CQyhkZXZfcHJpdikgfHwgSVNfQlJP
WFRPTihkZXZfcHJpdik7CiB9CiAKLXN0YXRpYyBib29sCitib29sCiBpbnRlbF9oYXNfc2Fndihz
dHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCiB7CiAJLyogSEFDSyEgKi8KQEAgLTM4
MjQsMjkgKzM4MjUsODggQEAgc3RhdGljIGJvb2wgc2tsX2NydGNfY2FuX2VuYWJsZV9zYWd2KGNv
bnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlKQogCXJldHVybiBpY2xfY3J0
Y19jYW5fZW5hYmxlX3NhZ3YoY3J0Y19zdGF0ZSk7CiB9CiAKLWJvb2wgaW50ZWxfY2FuX2VuYWJs
ZV9zYWd2KHN0cnVjdCBpbnRlbF9hdG9taWNfc3RhdGUgKnN0YXRlKQorc3RhdGljIGJvb2wKK3Rn
bF9jcnRjX2Nhbl9lbmFibGVfc2Fndihjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0
Y19zdGF0ZSk7CisKK2Jvb2wgaW50ZWxfY2FuX2VuYWJsZV9zYWd2KGNvbnN0IHN0cnVjdCBpbnRl
bF9id19zdGF0ZSAqYndfc3RhdGUpCit7CisJcmV0dXJuIGJ3X3N0YXRlLT5waXBlX3NhZ3ZfcmVq
ZWN0ID09IDA7Cit9CisKK3N0YXRpYyBib29sIGludGVsX2Nhbl9lbmFibGVfc2Fndl9vbl9waXBl
KGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpuZXdfY3J0Y19zdGF0ZSkKK3sKKwlzdHJ1
Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KG5ld19jcnRjX3N0YXRlLT51
YXBpLmNydGMtPmRldik7CisJYm9vbCByZXM7CisKKwlpZiAoSU5URUxfR0VOKGRldl9wcml2KSA+
PSAxMikKKwkJcmVzID0gdGdsX2NydGNfY2FuX2VuYWJsZV9zYWd2KG5ld19jcnRjX3N0YXRlKTsK
KwllbHNlIGlmIChJTlRFTF9HRU4oZGV2X3ByaXYpID49IDExKQorCQlyZXMgPSBpY2xfY3J0Y19j
YW5fZW5hYmxlX3NhZ3YobmV3X2NydGNfc3RhdGUpOworCWVsc2UKKwkJcmVzID0gc2tsX2NydGNf
Y2FuX2VuYWJsZV9zYWd2KG5ld19jcnRjX3N0YXRlKTsKKworCXJldHVybiByZXM7Cit9CisKK3N0
YXRpYyBpbnQgaW50ZWxfY29tcHV0ZV9zYWd2X21hc2soc3RydWN0IGludGVsX2F0b21pY19zdGF0
ZSAqc3RhdGUpCiB7CiAJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkx
NShzdGF0ZS0+YmFzZS5kZXYpOworCWludCByZXQ7CiAJc3RydWN0IGludGVsX2NydGMgKmNydGM7
Ci0JY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGU7CisJc3RydWN0IGlu
dGVsX2NydGNfc3RhdGUgKm5ld19jcnRjX3N0YXRlOworCXN0cnVjdCBpbnRlbF9id19zdGF0ZSAq
bmV3X2J3X3N0YXRlID0gTlVMTDsKKwljb25zdCBzdHJ1Y3QgaW50ZWxfYndfc3RhdGUgKm9sZF9i
d19zdGF0ZSA9IE5VTEw7CiAJaW50IGk7CisJYm9vbCBjYW5fc2FndjsKIAogCWlmICghaW50ZWxf
aGFzX3NhZ3YoZGV2X3ByaXYpKQotCQlyZXR1cm4gZmFsc2U7CisJCXJldHVybiAwOwogCi0JZm9y
X2VhY2hfbmV3X2ludGVsX2NydGNfaW5fc3RhdGUoc3RhdGUsIGNydGMsIGNydGNfc3RhdGUsIGkp
IHsKLQkJYm9vbCBjYW5fc2FndjsKKwlmb3JfZWFjaF9uZXdfaW50ZWxfY3J0Y19pbl9zdGF0ZShz
dGF0ZSwgY3J0YywKKwkJCQkJIG5ld19jcnRjX3N0YXRlLCBpKSB7CiAKLQkJaWYgKElOVEVMX0dF
TihkZXZfcHJpdikgPj0gMTEpCi0JCQljYW5fc2FndiA9IGljbF9jcnRjX2Nhbl9lbmFibGVfc2Fn
dihjcnRjX3N0YXRlKTsKKwkJbmV3X2J3X3N0YXRlID0gaW50ZWxfYXRvbWljX2dldF9id19zdGF0
ZShzdGF0ZSk7CisJCWlmIChJU19FUlIobmV3X2J3X3N0YXRlKSkKKwkJCXJldHVybiBQVFJfRVJS
KG5ld19id19zdGF0ZSk7CisKKwkJb2xkX2J3X3N0YXRlID0gaW50ZWxfYXRvbWljX2dldF9vbGRf
Yndfc3RhdGUoc3RhdGUpOworCisJCWlmIChpbnRlbF9jYW5fZW5hYmxlX3NhZ3Zfb25fcGlwZShu
ZXdfY3J0Y19zdGF0ZSkpCisJCQluZXdfYndfc3RhdGUtPnBpcGVfc2Fndl9yZWplY3QgJj0gfkJJ
VChjcnRjLT5waXBlKTsKIAkJZWxzZQotCQkJY2FuX3NhZ3YgPSBza2xfY3J0Y19jYW5fZW5hYmxl
X3NhZ3YoY3J0Y19zdGF0ZSk7CisJCQluZXdfYndfc3RhdGUtPnBpcGVfc2Fndl9yZWplY3QgfD0g
QklUKGNydGMtPnBpcGUpOworCX0KIAotCQlpZiAoIWNhbl9zYWd2KQotCQkJcmV0dXJuIGZhbHNl
OworCWlmICghbmV3X2J3X3N0YXRlIHx8ICFvbGRfYndfc3RhdGUpCisJCXJldHVybiAwOworCisJ
Y2FuX3NhZ3YgPSBuZXdfYndfc3RhdGUtPnBpcGVfc2Fndl9yZWplY3QgPT0gMDsKKworCWZvcl9l
YWNoX25ld19pbnRlbF9jcnRjX2luX3N0YXRlKHN0YXRlLCBjcnRjLAorCQkJCQkgbmV3X2NydGNf
c3RhdGUsIGkpIHsKKwkJc3RydWN0IHNrbF9waXBlX3dtICpwaXBlX3dtID0gJm5ld19jcnRjX3N0
YXRlLT53bS5za2wub3B0aW1hbDsKKworCQkvKgorCQkgKiBEdWUgdG8gZHJtIGxpbWl0YXRpb24g
YXQgY29tbWl0IHN0YXRlLCB3aGVuCisJCSAqIGNoYW5nZXMgYXJlIHdyaXR0ZW4gdGhlIHdob2xl
IGF0b21pYyBzdGF0ZSBpcworCQkgKiB6ZXJvZWQgYXdheSA9PiB3aGljaCBwcmV2ZW50cyBmcm9t
IHVzaW5nIGl0LAorCQkgKiBzbyBqdXN0IHN0aWNraW5nIGl0IGludG8gcGlwZSB3bSBzdGF0ZSBm
b3IKKwkJICoga2VlcGluZyBpdCBzaW1wbGUgLSBhbnl3YXkgdGhpcyBpcyByZWxhdGVkIHRvIHdt
LgorCQkgKiBQcm9wZXIgd2F5IGluIGlkZWFsIHVuaXZlcnNlIHdvdWxkIGJlIG9mIGNvdXJzZSBu
b3QKKwkJICogdG8gbG9zZSBwYXJlbnQgYXRvbWljIHN0YXRlIG9iamVjdCBmcm9tIGNoaWxkIGNy
dGNfc3RhdGUsCisJCSAqIGFuZCBzdGljayB0byBPT1AgcHJvZ3JhbW1pbmcgcHJpbmNpcGxlcywg
d2hpY2ggaGFkIGJlZW4KKwkJICogc2NpZW50aWZpY2FsbHkgcHJvdmVuIHRvIHdvcmsuCisJCSAq
LworCQlwaXBlX3dtLT5jYW5fc2FndiA9IGNhbl9zYWd2OwogCX0KIAotCXJldHVybiB0cnVlOwor
CWlmIChuZXdfYndfc3RhdGUtPnBpcGVfc2Fndl9yZWplY3QgIT0gb2xkX2J3X3N0YXRlLT5waXBl
X3NhZ3ZfcmVqZWN0KSB7CisJCXJldCA9IGludGVsX2F0b21pY19zZXJpYWxpemVfZ2xvYmFsX3N0
YXRlKCZuZXdfYndfc3RhdGUtPmJhc2UpOworCQlpZiAocmV0KQorCQkJcmV0dXJuIHJldDsKKwl9
CisKKwlyZXR1cm4gMDsKIH0KIAogLyoKQEAgLTQ1ODEsMTIgKzQ2NDEsMzkgQEAgc2tsX3BsYW5l
X3dtX2xldmVsKGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlLAogCQkg
ICBpbnQgbGV2ZWwsCiAJCSAgIGVudW0gY29sb3JfcGxhbmUgY29sb3JfcGxhbmUpCiB7Ci0JY29u
c3Qgc3RydWN0IHNrbF9wbGFuZV93bSAqd20gPQotCQkmY3J0Y19zdGF0ZS0+d20uc2tsLm9wdGlt
YWwucGxhbmVzW3BsYW5lX2lkXTsKKwljb25zdCBzdHJ1Y3Qgc2tsX3BpcGVfd20gKnBpcGVfd20g
PSAmY3J0Y19zdGF0ZS0+d20uc2tsLm9wdGltYWw7CisJY29uc3Qgc3RydWN0IHNrbF9wbGFuZV93
bSAqd20gPSAmcGlwZV93bS0+cGxhbmVzW3BsYW5lX2lkXTsKKworCWlmICghbGV2ZWwpIHsKKwkJ
aWYgKHBpcGVfd20tPmNhbl9zYWd2KQorCQkJcmV0dXJuIGNvbG9yX3BsYW5lID09IENPTE9SX1BM
QU5FX1kgPyAmd20tPnNhZ3Zfd20wIDogJndtLT51dl9zYWd2X3dtMDsKKwl9CiAKIAlyZXR1cm4g
Y29sb3JfcGxhbmUgPT0gQ09MT1JfUExBTkVfWSA/ICZ3bS0+d21bbGV2ZWxdIDogJndtLT51dl93
bVtsZXZlbF07CiB9CiAKK3N0YXRpYyBib29sCit0Z2xfY3J0Y19jYW5fZW5hYmxlX3NhZ3YoY29u
c3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUpCit7CisJc3RydWN0IGludGVs
X2NydGMgKmNydGMgPSB0b19pbnRlbF9jcnRjKGNydGNfc3RhdGUtPnVhcGkuY3J0Yyk7CisJZW51
bSBwbGFuZV9pZCBwbGFuZV9pZDsKKworCWlmICghY3J0Y19zdGF0ZS0+aHcuYWN0aXZlKQorCQly
ZXR1cm4gdHJ1ZTsKKworCWZvcl9lYWNoX3BsYW5lX2lkX29uX2NydGMoY3J0YywgcGxhbmVfaWQp
IHsKKwkJY29uc3Qgc3RydWN0IHNrbF9kZGJfZW50cnkgKnBsYW5lX2FsbG9jID0KKwkJCSZjcnRj
X3N0YXRlLT53bS5za2wucGxhbmVfZGRiX3lbcGxhbmVfaWRdOworCQljb25zdCBzdHJ1Y3Qgc2ts
X3BsYW5lX3dtICp3bSA9CisJCQkmY3J0Y19zdGF0ZS0+d20uc2tsLm9wdGltYWwucGxhbmVzW3Bs
YW5lX2lkXTsKKworCQlpZiAoc2tsX2RkYl9lbnRyeV9zaXplKHBsYW5lX2FsbG9jKSA8IHdtLT5z
YWd2X3dtMC5taW5fZGRiX2FsbG9jKQorCQkJcmV0dXJuIGZhbHNlOworCX0KKworCXJldHVybiB0
cnVlOworfQorCiBzdGF0aWMgaW50CiBza2xfYWxsb2NhdGVfcGlwZV9kZGIoc3RydWN0IGludGVs
X2NydGNfc3RhdGUgKmNydGNfc3RhdGUpCiB7CkBAIC01MTY4LDEwICs1MjU1LDE3IEBAIHN0YXRp
YyB2b2lkIHNrbF9jb21wdXRlX3BsYW5lX3dtKGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRl
ICpjcnRjX3N0YXRlLAogc3RhdGljIHZvaWQKIHNrbF9jb21wdXRlX3dtX2xldmVscyhjb25zdCBz
dHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSwKIAkJICAgICAgY29uc3Qgc3RydWN0
IHNrbF93bV9wYXJhbXMgKndtX3BhcmFtcywKLQkJICAgICAgc3RydWN0IHNrbF93bV9sZXZlbCAq
bGV2ZWxzKQorCQkgICAgICBzdHJ1Y3Qgc2tsX3BsYW5lX3dtICpwbGFuZV93bSwKKwkJICAgICAg
ZW51bSBjb2xvcl9wbGFuZSBjb2xvcl9wbGFuZSkKIHsKIAlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0
ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGNydGNfc3RhdGUtPnVhcGkuY3J0Yy0+ZGV2KTsKIAlpbnQg
bGV2ZWwsIG1heF9sZXZlbCA9IGlsa193bV9tYXhfbGV2ZWwoZGV2X3ByaXYpOworCS8qCisJICog
Q2hlY2sgd2hpY2gga2luZCBvZiBwbGFuZSBpcyBpdCBhbmQgYmFzZWQgb24gdGhhdCBjYWxjdWxh
dGUKKwkgKiBjb3JyZXNwb25kZW50IFdNIGxldmVscy4KKwkgKi8KKwlzdHJ1Y3Qgc2tsX3dtX2xl
dmVsICpsZXZlbHMgPSBjb2xvcl9wbGFuZSA9PSBDT0xPUl9QTEFORV9VViA/CisJCQkJICAgICAg
cGxhbmVfd20tPnV2X3dtIDogcGxhbmVfd20tPndtOwogCXN0cnVjdCBza2xfd21fbGV2ZWwgKnJl
c3VsdF9wcmV2ID0gJmxldmVsc1swXTsKIAogCWZvciAobGV2ZWwgPSAwOyBsZXZlbCA8PSBtYXhf
bGV2ZWw7IGxldmVsKyspIHsKQEAgLTUxODUsNiArNTI3OSw0MCBAQCBza2xfY29tcHV0ZV93bV9s
ZXZlbHMoY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUsCiAJfQogfQog
CitzdGF0aWMgdm9pZCBza2xfY29tcHV0ZV9zYWd2X3dtKGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRj
X3N0YXRlICpjcnRjX3N0YXRlLAorCQkJCWNvbnN0IHN0cnVjdCBza2xfd21fcGFyYW1zICp3bV9w
YXJhbXMsCisJCQkJc3RydWN0IHNrbF9wbGFuZV93bSAqcGxhbmVfd20sCisJCQkJZW51bSBjb2xv
cl9wbGFuZSBjb2xvcl9wbGFuZSkKK3sKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3By
aXYgPSB0b19pOTE1KGNydGNfc3RhdGUtPnVhcGkuY3J0Yy0+ZGV2KTsKKwlzdHJ1Y3Qgc2tsX3dt
X2xldmVsICpzYWd2X3dtID0gY29sb3JfcGxhbmUgPT0gQ09MT1JfUExBTkVfVVYgPworCQkJCSZw
bGFuZV93bS0+dXZfc2Fndl93bTAgOiAmcGxhbmVfd20tPnNhZ3Zfd20wOworCXN0cnVjdCBza2xf
d21fbGV2ZWwgKmxldmVscyA9IGNvbG9yX3BsYW5lID09IENPTE9SX1BMQU5FX1VWID8KKwkJCQlw
bGFuZV93bS0+dXZfd20gOiBwbGFuZV93bS0+d207CisKKwkvKgorCSAqIEZvciBHZW4xMiBpZiBp
dCBpcyBhbiBMMCB3ZSBuZWVkIHRvIGFsc28KKwkgKiBjb25zaWRlciBzYWd2X2Jsb2NrX3RpbWUg
d2hlbiBjYWxjdWxhdGluZworCSAqIEwwIHdhdGVybWFyayAtIHdlIHdpbGwgbmVlZCB0aGF0IHdo
ZW4gbWFraW5nCisJICogYSBkZWNpc2lvbiB3aGV0aGVyIGVuYWJsZSBTQUdWIG9yIG5vdC4KKwkg
KiBGb3Igb2xkZXIgZ2VucyB3ZSBhZ3JlZWQgdG8gY29weSBMMCB2YWx1ZSBmb3IKKwkgKiBjb21w
YXRpYmlsaXR5LgorCSAqLworCWlmICgoSU5URUxfR0VOKGRldl9wcml2KSA+PSAxMikpIHsKKwkJ
dTMyIGxhdGVuY3kgPSBkZXZfcHJpdi0+d20uc2tsX2xhdGVuY3lbMF07CisKKwkJbGF0ZW5jeSAr
PSBkZXZfcHJpdi0+c2Fndl9ibG9ja190aW1lX3VzOworCQlza2xfY29tcHV0ZV9wbGFuZV93bShj
cnRjX3N0YXRlLCAwLCBsYXRlbmN5LAorCQkJCSAgICAgd21fcGFyYW1zLCAmbGV2ZWxzWzBdLAor
CQkJCSAgICAgc2Fndl93bSk7CisJCURSTV9ERUJVR19LTVMoIiVkIEwwIGJsb2NrcyByZXF1aXJl
ZCBmb3IgU0FHViB2cyAlZCBmb3Igbm9uLVNBR1ZcbiIsCisJCQkgICAgICBzYWd2X3dtLT5taW5f
ZGRiX2FsbG9jLCBsZXZlbHNbMF0ubWluX2RkYl9hbGxvYyk7CisJfSBlbHNlIHsKKwkJLyogU2lu
Y2UgYWxsIG1lbWJlcnMgYXJlIFBPRCAqLworCQkqc2Fndl93bSA9IGxldmVsc1swXTsKKwl9Cit9
CisKIHN0YXRpYyB2b2lkIHNrbF9jb21wdXRlX3RyYW5zaXRpb25fd20oY29uc3Qgc3RydWN0IGlu
dGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUsCiAJCQkJICAgICAgY29uc3Qgc3RydWN0IHNrbF93
bV9wYXJhbXMgKndwLAogCQkJCSAgICAgIHN0cnVjdCBza2xfcGxhbmVfd20gKndtKQpAQCAtNTI2
NSw3ICs1MzkzLDggQEAgc3RhdGljIGludCBza2xfYnVpbGRfcGxhbmVfd21fc2luZ2xlKHN0cnVj
dCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlLAogCWlmIChyZXQpCiAJCXJldHVybiByZXQ7
CiAKLQlza2xfY29tcHV0ZV93bV9sZXZlbHMoY3J0Y19zdGF0ZSwgJndtX3BhcmFtcywgd20tPndt
KTsKKwlza2xfY29tcHV0ZV93bV9sZXZlbHMoY3J0Y19zdGF0ZSwgJndtX3BhcmFtcywgd20sIENP
TE9SX1BMQU5FX1kpOworCXNrbF9jb21wdXRlX3NhZ3Zfd20oY3J0Y19zdGF0ZSwgJndtX3BhcmFt
cywgd20sIENPTE9SX1BMQU5FX1kpOwogCXNrbF9jb21wdXRlX3RyYW5zaXRpb25fd20oY3J0Y19z
dGF0ZSwgJndtX3BhcmFtcywgd20pOwogCiAJcmV0dXJuIDA7CkBAIC01Mjg3LDcgKzU0MTYsOCBA
QCBzdGF0aWMgaW50IHNrbF9idWlsZF9wbGFuZV93bV91dihzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0
ZSAqY3J0Y19zdGF0ZSwKIAlpZiAocmV0KQogCQlyZXR1cm4gcmV0OwogCi0Jc2tsX2NvbXB1dGVf
d21fbGV2ZWxzKGNydGNfc3RhdGUsICZ3bV9wYXJhbXMsIHdtLT51dl93bSk7CisJc2tsX2NvbXB1
dGVfd21fbGV2ZWxzKGNydGNfc3RhdGUsICZ3bV9wYXJhbXMsIHdtLCBDT0xPUl9QTEFORV9VVik7
CisJc2tsX2NvbXB1dGVfc2Fndl93bShjcnRjX3N0YXRlLCAmd21fcGFyYW1zLCB3bSwgQ09MT1Jf
UExBTkVfVVYpOwogCiAJcmV0dXJuIDA7CiB9CkBAIC01NzAxLDYgKzU4MzEsMTQgQEAgc2tsX3By
aW50X3dtX2NoYW5nZXMoc3RydWN0IGludGVsX2F0b21pY19zdGF0ZSAqc3RhdGUpCiAJCQkJICAg
IG5ld193bS0+d21bNF0ubWluX2RkYl9hbGxvYywgbmV3X3dtLT53bVs1XS5taW5fZGRiX2FsbG9j
LAogCQkJCSAgICBuZXdfd20tPndtWzZdLm1pbl9kZGJfYWxsb2MsIG5ld193bS0+d21bN10ubWlu
X2RkYl9hbGxvYywKIAkJCQkgICAgbmV3X3dtLT50cmFuc193bS5taW5fZGRiX2FsbG9jKTsKKwor
CQkJZHJtX2RiZ19rbXMoJmRldl9wcml2LT5kcm0sCisJCQkJICAgICJbUExBTkU6JWQ6JXNdIHNh
Z3Ygd20wIG1pbiBkZGIgJTRkIGJsb2NrcyAlNGQgbGluZXMgJTRkXG4iCisJCQkJICAgICItPiBt
aW5fZGRiICU0ZCBibG9ja3MgJTRkIGxpbmVzICU0ZFxuIiwKKwkJCQkgICAgcGxhbmUtPmJhc2Uu
YmFzZS5pZCwgcGxhbmUtPmJhc2UubmFtZSwgb2xkX3dtLT5zYWd2X3dtMC5taW5fZGRiX2FsbG9j
LAorCQkJCSAgICBvbGRfd20tPnNhZ3Zfd20wLnBsYW5lX3Jlc19iLCBvbGRfd20tPnNhZ3Zfd20w
LnBsYW5lX3Jlc19sLAorCQkJCSAgICBuZXdfd20tPnNhZ3Zfd20wLm1pbl9kZGJfYWxsb2MsIG5l
d193bS0+c2Fndl93bTAucGxhbmVfcmVzX2IsCisJCQkJICAgIG5ld193bS0+c2Fndl93bTAucGxh
bmVfcmVzX2wpOwogCQl9CiAJfQogfQpAQCAtNTg2MSw2ICs1OTk5LDEwIEBAIHNrbF9jb21wdXRl
X3dtKHN0cnVjdCBpbnRlbF9hdG9taWNfc3RhdGUgKnN0YXRlKQogCWlmIChyZXQpCiAJCXJldHVy
biByZXQ7CiAKKwlyZXQgPSBpbnRlbF9jb21wdXRlX3NhZ3ZfbWFzayhzdGF0ZSk7CisJaWYgKHJl
dCkKKwkJcmV0dXJuIHJldDsKKwogCS8qCiAJICogc2tsX2NvbXB1dGVfZGRiKCkgd2lsbCBoYXZl
IGFkanVzdGVkIHRoZSBmaW5hbCB3YXRlcm1hcmtzCiAJICogYmFzZWQgb24gaG93IG11Y2ggZGRi
IGlzIGF2YWlsYWJsZS4gTm93IHdlIGNhbiBhY3R1YWxseQpAQCAtNTk5MCw2ICs2MTMyLDkgQEAg
dm9pZCBza2xfcGlwZV93bV9nZXRfaHdfc3RhdGUoc3RydWN0IGludGVsX2NydGMgKmNydGMsCiAJ
CQlza2xfd21fbGV2ZWxfZnJvbV9yZWdfdmFsKHZhbCwgJndtLT53bVtsZXZlbF0pOwogCQl9CiAK
KwkJbWVtY3B5KCZ3bS0+c2Fndl93bTAsICZ3bS0+d21bMF0sCisJCSAgICAgICBzaXplb2Yoc3Ry
dWN0IHNrbF93bV9sZXZlbCkpOworCiAJCWlmIChwbGFuZV9pZCAhPSBQTEFORV9DVVJTT1IpCiAJ
CQl2YWwgPSBJOTE1X1JFQUQoUExBTkVfV01fVFJBTlMocGlwZSwgcGxhbmVfaWQpKTsKIAkJZWxz
ZQpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50ZWxfcG0uaCBiL2RyaXZlcnMv
Z3B1L2RybS9pOTE1L2ludGVsX3BtLmgKaW5kZXggZDYwYTg1NDIxYzVhLi5lNDE2MzdiM2EwNWQg
MTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2ludGVsX3BtLmgKKysrIGIvZHJpdmVy
cy9ncHUvZHJtL2k5MTUvaW50ZWxfcG0uaApAQCAtOSw2ICs5LDcgQEAKICNpbmNsdWRlIDxsaW51
eC90eXBlcy5oPgogCiAjaW5jbHVkZSAiaTkxNV9yZWcuaCIKKyNpbmNsdWRlICJkaXNwbGF5L2lu
dGVsX2J3LmgiCiAKIHN0cnVjdCBkcm1fZGV2aWNlOwogc3RydWN0IGRybV9pOTE1X3ByaXZhdGU7
CkBAIC00MSw3ICs0Miw4IEBAIHZvaWQgc2tsX3BpcGVfd21fZ2V0X2h3X3N0YXRlKHN0cnVjdCBp
bnRlbF9jcnRjICpjcnRjLAogCQkJICAgICAgc3RydWN0IHNrbF9waXBlX3dtICpvdXQpOwogdm9p
ZCBnNHhfd21fc2FuaXRpemUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KTsKIHZv
aWQgdmx2X3dtX3Nhbml0aXplKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdik7Ci1i
b29sIGludGVsX2Nhbl9lbmFibGVfc2FndihzdHJ1Y3QgaW50ZWxfYXRvbWljX3N0YXRlICpzdGF0
ZSk7Citib29sIGludGVsX2hhc19zYWd2KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJp
dik7Citib29sIGludGVsX2Nhbl9lbmFibGVfc2Fndihjb25zdCBzdHJ1Y3QgaW50ZWxfYndfc3Rh
dGUgKmJ3X3N0YXRlKTsKIGludCBpbnRlbF9lbmFibGVfc2FndihzdHJ1Y3QgZHJtX2k5MTVfcHJp
dmF0ZSAqZGV2X3ByaXYpOwogaW50IGludGVsX2Rpc2FibGVfc2FndihzdHJ1Y3QgZHJtX2k5MTVf
cHJpdmF0ZSAqZGV2X3ByaXYpOwogYm9vbCBza2xfd21fbGV2ZWxfZXF1YWxzKGNvbnN0IHN0cnVj
dCBza2xfd21fbGV2ZWwgKmwxLAotLSAKMi4yNC4xLjQ4NS5nYWQwNWEzZDhlNQoKX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX18KSW50ZWwtZ2Z4IG1haWxpbmcg
bGlzdApJbnRlbC1nZnhAbGlzdHMuZnJlZWRlc2t0b3Aub3JnCmh0dHBzOi8vbGlzdHMuZnJlZWRl
c2t0b3Aub3JnL21haWxtYW4vbGlzdGluZm8vaW50ZWwtZ2Z4Cg==

Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 2CCE3E33AD
	for <lists+intel-gfx@lfdr.de>; Thu, 24 Oct 2019 15:14:13 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 2F2526E3F2;
	Thu, 24 Oct 2019 13:14:11 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from fireflyinternet.com (mail.fireflyinternet.com [109.228.58.192])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 5D78E6E3F0
 for <intel-gfx@lists.freedesktop.org>; Thu, 24 Oct 2019 13:14:00 +0000 (UTC)
X-Default-Received-SPF: pass (skip=forwardok (res=PASS))
 x-ip-name=78.156.65.138; 
Received: from haswell.alporthouse.com (unverified [78.156.65.138]) 
 by fireflyinternet.com (Firefly Internet (M1)) with ESMTP id 18949965-1500050 
 for multiple; Thu, 24 Oct 2019 14:13:46 +0100
From: Chris Wilson <chris@chris-wilson.co.uk>
To: intel-gfx@lists.freedesktop.org
Date: Thu, 24 Oct 2019 14:13:41 +0100
Message-Id: <20191024131343.16194-3-chris@chris-wilson.co.uk>
X-Mailer: git-send-email 2.24.0.rc0
In-Reply-To: <20191024131343.16194-1-chris@chris-wilson.co.uk>
References: <20191024131343.16194-1-chris@chris-wilson.co.uk>
MIME-Version: 1.0
Subject: [Intel-gfx] [RFC 3/5] drm/i915: Remove i915->kernel_context
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

QWxsb2NhdGUgb25seSBhbiBpbnRlcm5hbCBpbnRlbF9jb250ZXh0IGZvciB0aGUga2VybmVsX2Nv
bnRleHQsIGZvcmdvaW5nCmEgZ2xvYmFsIEdFTSBjb250ZXh0IGZvciBpbnRlcm5hbCB1c2UgYXMg
d2Ugb25seSByZXF1aXJlIGEgc2VwYXJhdGUKYWRkcmVzcyBzcGFjZSAoZm9yIG91ciBvd24gcHJv
dGVjdGlvbikuCgpTaWduZWQtb2ZmLWJ5OiBDaHJpcyBXaWxzb24gPGNocmlzQGNocmlzLXdpbHNv
bi5jby51az4KLS0tCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fY29udGV4dC5j
ICAgfCAzNSArLS0tLS0tLS0tLS0tLS0tLS0tCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkx
NV9nZW1fY29udGV4dC5oICAgfCAgMyArLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVf
Z2VtX3VzZXJwdHIuYyAgIHwgIDUgKystCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9l
bmdpbmVfY3MuYyAgICAgfCAgMyArLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfZ3Qu
YyAgICAgICAgICAgIHwgMTEgKysrKystCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9n
dF90eXBlcy5oICAgICAgfCAgMiArKwogZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9kcnYuaCAg
ICAgICAgICAgICAgIHwgIDMgLS0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZ2VtLmMgICAg
ICAgICAgICAgICB8IDE2ICsrLS0tLS0tLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9nZW1f
Z3R0LmMgICAgICAgICAgIHwgIDggKystLS0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfcGVy
Zi5jICAgICAgICAgICAgICB8ICAzIC0tCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3JlcXVl
c3QuYyAgICAgICAgICAgfCAgNSArKy0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L3NlbGZ0ZXN0cy9p
OTE1X3JlcXVlc3QuYyB8ICA2ICstLS0KIC4uLi9ncHUvZHJtL2k5MTUvc2VsZnRlc3RzL21vY2tf
Z2VtX2RldmljZS5jICB8ICA4ICstLS0tCiAxMyBmaWxlcyBjaGFuZ2VkLCAyOSBpbnNlcnRpb25z
KCspLCA3OSBkZWxldGlvbnMoLSkKCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9n
ZW0vaTkxNV9nZW1fY29udGV4dC5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2Vt
X2NvbnRleHQuYwppbmRleCBmMzRkYzQ0MGIzN2UuLjVlYTk2MmMxOWYyMiAxMDA2NDQKLS0tIGEv
ZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX2NvbnRleHQuYworKysgYi9kcml2ZXJz
L2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fY29udGV4dC5jCkBAIC02MDUsMTkgKzYwNSw2IEBA
IGk5MTVfZ2VtX2NyZWF0ZV9jb250ZXh0KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LCB1
bnNpZ25lZCBpbnQgZmxhZ3MpCiAJcmV0dXJuIGN0eDsKIH0KIAotc3RhdGljIHZvaWQKLWRlc3Ry
b3lfa2VybmVsX2NvbnRleHQoc3RydWN0IGk5MTVfZ2VtX2NvbnRleHQgKipjdHhwKQotewotCXN0
cnVjdCBpOTE1X2dlbV9jb250ZXh0ICpjdHg7Ci0KLQkvKiBLZWVwIHRoZSBjb250ZXh0IHJlZiBz
byB0aGF0IHdlIGNhbiBmcmVlIGl0IGltbWVkaWF0ZWx5IG91cnNlbHZlcyAqLwotCWN0eCA9IGk5
MTVfZ2VtX2NvbnRleHRfZ2V0KGZldGNoX2FuZF96ZXJvKGN0eHApKTsKLQlHRU1fQlVHX09OKCFp
OTE1X2dlbV9jb250ZXh0X2lzX2tlcm5lbChjdHgpKTsKLQotCWNvbnRleHRfY2xvc2UoY3R4KTsK
LQlpOTE1X2dlbV9jb250ZXh0X2ZyZWUoY3R4KTsKLX0KLQogc3RydWN0IGk5MTVfZ2VtX2NvbnRl
eHQgKgogaTkxNV9nZW1fY29udGV4dF9jcmVhdGVfa2VybmVsKHN0cnVjdCBkcm1faTkxNV9wcml2
YXRlICppOTE1LCBpbnQgcHJpbykKIHsKQEAgLTY0NCwzMiArNjMxLDEyIEBAIHN0YXRpYyB2b2lk
IGluaXRfY29udGV4dHMoc3RydWN0IGk5MTVfZ2VtX2NvbnRleHRzICpnYykKIAlpbml0X2xsaXN0
X2hlYWQoJmdjLT5mcmVlX2xpc3QpOwogfQogCi1pbnQgaTkxNV9nZW1faW5pdF9jb250ZXh0cyhz
dHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkKK3ZvaWQgaTkxNV9nZW1faW5pdF9jb250ZXh0
cyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkKIHsKLQlzdHJ1Y3QgaTkxNV9nZW1fY29u
dGV4dCAqY3R4OwotCi0JLyogUmVhc3N1cmUgb3Vyc2VsdmVzIHdlIGFyZSBvbmx5IGNhbGxlZCBv
bmNlICovCi0JR0VNX0JVR19PTihpOTE1LT5rZXJuZWxfY29udGV4dCk7Ci0KIAlpbml0X2NvbnRl
eHRzKCZpOTE1LT5nZW0uY29udGV4dHMpOwotCi0JLyogbG93ZXN0IHByaW9yaXR5OyBpZGxlIHRh
c2sgKi8KLQljdHggPSBpOTE1X2dlbV9jb250ZXh0X2NyZWF0ZV9rZXJuZWwoaTkxNSwgSTkxNV9Q
UklPUklUWV9NSU4pOwotCWlmIChJU19FUlIoY3R4KSkgewotCQlEUk1fRVJST1IoIkZhaWxlZCB0
byBjcmVhdGUgZGVmYXVsdCBnbG9iYWwgY29udGV4dFxuIik7Ci0JCXJldHVybiBQVFJfRVJSKGN0
eCk7Ci0JfQotCWk5MTUtPmtlcm5lbF9jb250ZXh0ID0gY3R4OwotCiAJRFJNX0RFQlVHX0RSSVZF
UigiJXMgY29udGV4dCBzdXBwb3J0IGluaXRpYWxpemVkXG4iLAogCQkJIERSSVZFUl9DQVBTKGk5
MTUpLT5oYXNfbG9naWNhbF9jb250ZXh0cyA/CiAJCQkgImxvZ2ljYWwiIDogImZha2UiKTsKLQly
ZXR1cm4gMDsKLX0KLQotdm9pZCBpOTE1X2dlbV9kcml2ZXJfcmVsZWFzZV9fY29udGV4dHMoc3Ry
dWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpCi17Ci0JZGVzdHJveV9rZXJuZWxfY29udGV4dCgm
aTkxNS0+a2VybmVsX2NvbnRleHQpOwogfQogCiBzdGF0aWMgaW50IGNvbnRleHRfaWRyX2NsZWFu
dXAoaW50IGlkLCB2b2lkICpwLCB2b2lkICpkYXRhKQpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUv
ZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX2NvbnRleHQuaCBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dl
bS9pOTE1X2dlbV9jb250ZXh0LmgKaW5kZXggNmQyMjYzNjU4ZWRiLi4zODQ0YjFiMTQ4NDkgMTAw
NjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9jb250ZXh0LmgKKysr
IGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX2NvbnRleHQuaApAQCAtMTAwLDgg
KzEwMCw3IEBAIHN0YXRpYyBpbmxpbmUgYm9vbCBpOTE1X2dlbV9jb250ZXh0X2lzX2tlcm5lbChz
dHJ1Y3QgaTkxNV9nZW1fY29udGV4dCAqY3R4KQogfQogCiAvKiBpOTE1X2dlbV9jb250ZXh0LmMg
Ki8KLWludCBfX211c3RfY2hlY2sgaTkxNV9nZW1faW5pdF9jb250ZXh0cyhzdHJ1Y3QgZHJtX2k5
MTVfcHJpdmF0ZSAqaTkxNSk7Ci12b2lkIGk5MTVfZ2VtX2RyaXZlcl9yZWxlYXNlX19jb250ZXh0
cyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSk7Cit2b2lkIGk5MTVfZ2VtX2luaXRfY29u
dGV4dHMoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpOwogCiBpbnQgaTkxNV9nZW1fY29u
dGV4dF9vcGVuKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LAogCQkJICBzdHJ1Y3QgZHJt
X2ZpbGUgKmZpbGUpOwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVf
Z2VtX3VzZXJwdHIuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV91c2VycHRy
LmMKaW5kZXggMWUwNDVjMzM3MDQ0Li43MGRmN2M5N2I1NWQgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMv
Z3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV91c2VycHRyLmMKKysrIGIvZHJpdmVycy9ncHUvZHJt
L2k5MTUvZ2VtL2k5MTVfZ2VtX3VzZXJwdHIuYwpAQCAtNzU5LDkgKzc1OSw4IEBAIGk5MTVfZ2Vt
X3VzZXJwdHJfaW9jdGwoc3RydWN0IGRybV9kZXZpY2UgKmRldiwKIAkJICogT24gYWxtb3N0IGFs
bCBvZiB0aGUgb2xkZXIgaHcsIHdlIGNhbm5vdCB0ZWxsIHRoZSBHUFUgdGhhdAogCQkgKiBhIHBh
Z2UgaXMgcmVhZG9ubHkuCiAJCSAqLwotCQl2bSA9IHJjdV9kZXJlZmVyZW5jZV9wcm90ZWN0ZWQo
ZGV2X3ByaXYtPmtlcm5lbF9jb250ZXh0LT52bSwKLQkJCQkJICAgICAgIHRydWUpOyAvKiBzdGF0
aWMgdm0gKi8KLQkJaWYgKCF2bSB8fCAhdm0tPmhhc19yZWFkX29ubHkpCisJCXZtID0gZGV2X3By
aXYtPmd0Lmtlcm5lbF92bTsKKwkJaWYgKCF2bS0+aGFzX3JlYWRfb25seSkKIAkJCXJldHVybiAt
RU5PREVWOwogCX0KIApkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxf
ZW5naW5lX2NzLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9lbmdpbmVfY3MuYwpp
bmRleCBmMTRmODc3NzE5YzcuLmRiOTczNmNiMDZlNCAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUv
ZHJtL2k5MTUvZ3QvaW50ZWxfZW5naW5lX2NzLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUv
Z3QvaW50ZWxfZW5naW5lX2NzLmMKQEAgLTc1NCwxMSArNzU0LDEyIEBAIGNyZWF0ZV9rZXJuZWxf
Y29udGV4dChzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmUpCiAJc3RydWN0IGludGVsX2Nv
bnRleHQgKmNlOwogCWludCBlcnI7CiAKLQljZSA9IGludGVsX2NvbnRleHRfY3JlYXRlKGVuZ2lu
ZS0+aTkxNS0+a2VybmVsX2NvbnRleHQsIGVuZ2luZSk7CisJY2UgPSBpbnRlbF9jb250ZXh0X2Ny
ZWF0ZShOVUxMLCBlbmdpbmUpOwogCWlmIChJU19FUlIoY2UpKQogCQlyZXR1cm4gY2U7CiAKIAlj
ZS0+cmluZyA9IF9faW50ZWxfY29udGV4dF9yaW5nX3NpemUoU1pfNEspOworCWNlLT52bSA9IGk5
MTVfdm1fZ2V0KGVuZ2luZS0+Z3QtPmtlcm5lbF92bSk7CiAKIAllcnIgPSBpbnRlbF9jb250ZXh0
X3BpbihjZSk7CiAJaWYgKGVycikgewpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUv
Z3QvaW50ZWxfZ3QuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2d0LmMKaW5kZXgg
MzUxMjc2OTk1OTFkLi4xNTA3OGM4MGEzMTUgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9p
OTE1L2d0L2ludGVsX2d0LmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfZ3Qu
YwpAQCAtNzEsNyArNzEsNiBAQCBpbnQgaW50ZWxfZ3RfaW5pdF9odyhzdHJ1Y3QgaW50ZWxfZ3Qg
Kmd0KQogCXN0cnVjdCBpbnRlbF91bmNvcmUgKnVuY29yZSA9IGd0LT51bmNvcmU7CiAJaW50IHJl
dDsKIAotCUJVR19PTighaTkxNS0+a2VybmVsX2NvbnRleHQpOwogCXJldCA9IGludGVsX2d0X3Rl
cm1pbmFsbHlfd2VkZ2VkKGd0KTsKIAlpZiAocmV0KQogCQlyZXR1cm4gcmV0OwpAQCAtMzczLDcg
KzM3MiwxNyBAQCBpbnQgaW50ZWxfZ3RfaW5pdChzdHJ1Y3QgaW50ZWxfZ3QgKmd0KQogCiAJaW50
ZWxfZ3RfcG1faW5pdChndCk7CiAKKwlndC0+a2VybmVsX3ZtID0gJmk5MTVfcHBndHRfY3JlYXRl
KGd0LT5pOTE1KS0+dm07CisJaWYgKCFndC0+a2VybmVsX3ZtKSB7CisJCWVyciA9IC1FTk9NRU07
CisJCWdvdG8gZXJyX3NjcmF0Y2g7CisJfQorCiAJcmV0dXJuIDA7CisKK2Vycl9zY3JhdGNoOgor
CWludGVsX2d0X2Zpbmlfc2NyYXRjaChndCk7CisJcmV0dXJuIGVycjsKIH0KIAogdm9pZCBpbnRl
bF9ndF9kcml2ZXJfcmVtb3ZlKHN0cnVjdCBpbnRlbF9ndCAqZ3QpCmRpZmYgLS1naXQgYS9kcml2
ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9ndF90eXBlcy5oIGIvZHJpdmVycy9ncHUvZHJtL2k5
MTUvZ3QvaW50ZWxfZ3RfdHlwZXMuaAppbmRleCBmY2IzYTZjOTQyMWMuLjcyOTU0NTg1YTcxOSAx
MDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfZ3RfdHlwZXMuaAorKysg
Yi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9ndF90eXBlcy5oCkBAIC04OCw2ICs4OCw4
IEBAIHN0cnVjdCBpbnRlbF9ndCB7CiAJc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lW0k5
MTVfTlVNX0VOR0lORVNdOwogCXN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZV9jbGFzc1tN
QVhfRU5HSU5FX0NMQVNTICsgMV0KIAkJCQkJICAgIFtNQVhfRU5HSU5FX0lOU1RBTkNFICsgMV07
CisKKwlzdHJ1Y3QgaTkxNV9hZGRyZXNzX3NwYWNlICprZXJuZWxfdm07CiB9OwogCiBlbnVtIGlu
dGVsX2d0X3NjcmF0Y2hfZmllbGQgewpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUv
aTkxNV9kcnYuaCBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZHJ2LmgKaW5kZXggNjc0ZTll
OTIxODM5Li4yOWQyNjE5ZTJlM2UgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5
MTVfZHJ2LmgKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9kcnYuaApAQCAtMTA0Miw5
ICsxMDQyLDYgQEAgc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgewogCiAJc3RydWN0IHBjaV9kZXYg
KmJyaWRnZV9kZXY7CiAKLQkvKiBDb250ZXh0IHVzZWQgaW50ZXJuYWxseSB0byBpZGxlIHRoZSBH
UFUgYW5kIHNldHVwIGluaXRpYWwgc3RhdGUgKi8KLQlzdHJ1Y3QgaTkxNV9nZW1fY29udGV4dCAq
a2VybmVsX2NvbnRleHQ7Ci0KIAlzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmVbSTkxNV9O
VU1fRU5HSU5FU107CiAJc3RydWN0IHJiX3Jvb3QgdWFiaV9lbmdpbmVzOwogCmRpZmYgLS1naXQg
YS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2dlbS5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUv
aTkxNV9nZW0uYwppbmRleCA0YzA1YTc3OWQ5ZDcuLmM3YmY4ZDJlMTdhYyAxMDA2NDQKLS0tIGEv
ZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9nZW0uYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkx
NS9pOTE1X2dlbS5jCkBAIC0xMDk0LDggKzEwOTQsNyBAQCBzdGF0aWMgaW50IF9faW50ZWxfZW5n
aW5lc19yZWNvcmRfZGVmYXVsdHMoc3RydWN0IGludGVsX2d0ICpndCkKIAkJR0VNX0JVR19PTigh
ZW5naW5lLT5rZXJuZWxfY29udGV4dCk7CiAJCWVuZ2luZS0+c2VyaWFsKys7IC8qIGZvcmNlIHRo
ZSBrZXJuZWwgY29udGV4dCBzd2l0Y2ggKi8KIAotCQljZSA9IGludGVsX2NvbnRleHRfY3JlYXRl
KGVuZ2luZS0+a2VybmVsX2NvbnRleHQtPmdlbV9jb250ZXh0LAotCQkJCQkgIGVuZ2luZSk7CisJ
CWNlID0gaW50ZWxfY29udGV4dF9jcmVhdGUoTlVMTCwgZW5naW5lKTsKIAkJaWYgKElTX0VSUihj
ZSkpIHsKIAkJCWVyciA9IFBUUl9FUlIoY2UpOwogCQkJZ290byBvdXQ7CkBAIC0xMjUwLDYgKzEy
NDksNyBAQCBpbnQgaTkxNV9nZW1faW5pdChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3By
aXYpCiAJfQogCiAJaW50ZWxfZ3RfaW5pdCgmZGV2X3ByaXYtPmd0KTsKKwlpOTE1X2dlbV9pbml0
X2NvbnRleHRzKGRldl9wcml2KTsKIAogCXJldCA9IGludGVsX2VuZ2luZXNfc2V0dXAoJmRldl9w
cml2LT5ndCk7CiAJaWYgKHJldCkgewpAQCAtMTI1NywxNiArMTI1NywxMCBAQCBpbnQgaTkxNV9n
ZW1faW5pdChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCiAJCWdvdG8gZXJyX3Vu
bG9jazsKIAl9CiAKLQlyZXQgPSBpOTE1X2dlbV9pbml0X2NvbnRleHRzKGRldl9wcml2KTsKLQlp
ZiAocmV0KSB7Ci0JCUdFTV9CVUdfT04ocmV0ID09IC1FSU8pOwotCQlnb3RvIGVycl9zY3JhdGNo
OwotCX0KLQogCXJldCA9IGludGVsX2VuZ2luZXNfaW5pdCgmZGV2X3ByaXYtPmd0KTsKIAlpZiAo
cmV0KSB7CiAJCUdFTV9CVUdfT04ocmV0ID09IC1FSU8pOwotCQlnb3RvIGVycl9jb250ZXh0Owor
CQlnb3RvIGVycl9zY3JhdGNoOwogCX0KIAogCWludGVsX2luaXRfZ3RfcG93ZXJzYXZlKGRldl9w
cml2KTsKQEAgLTEzMzIsOSArMTMyNiw2IEBAIGludCBpOTE1X2dlbV9pbml0KHN0cnVjdCBkcm1f
aTkxNV9wcml2YXRlICpkZXZfcHJpdikKIAkJaW50ZWxfdWNfZmluaSgmZGV2X3ByaXYtPmd0LnVj
KTsKIAkJaW50ZWxfZW5naW5lc19jbGVhbnVwKCZkZXZfcHJpdi0+Z3QpOwogCX0KLWVycl9jb250
ZXh0OgotCWlmIChyZXQgIT0gLUVJTykKLQkJaTkxNV9nZW1fZHJpdmVyX3JlbGVhc2VfX2NvbnRl
eHRzKGRldl9wcml2KTsKIGVycl9zY3JhdGNoOgogCWludGVsX2d0X2RyaXZlcl9yZWxlYXNlKCZk
ZXZfcHJpdi0+Z3QpOwogZXJyX3VubG9jazoKQEAgLTE0MDAsNyArMTM5MSw2IEBAIHZvaWQgaTkx
NV9nZW1fZHJpdmVyX3JlbW92ZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCiB2
b2lkIGk5MTVfZ2VtX2RyaXZlcl9yZWxlYXNlKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZf
cHJpdikKIHsKIAlpbnRlbF9lbmdpbmVzX2NsZWFudXAoJmRldl9wcml2LT5ndCk7Ci0JaTkxNV9n
ZW1fZHJpdmVyX3JlbGVhc2VfX2NvbnRleHRzKGRldl9wcml2KTsKIAlpbnRlbF9ndF9kcml2ZXJf
cmVsZWFzZSgmZGV2X3ByaXYtPmd0KTsKIAogCWludGVsX3dhX2xpc3RfZnJlZSgmZGV2X3ByaXYt
Pmd0X3dhX2xpc3QpOwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9nZW1f
Z3R0LmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2dlbV9ndHQuYwppbmRleCAzZDNhOGRi
MThhMDcuLjA1OWJmMzcwY2Q0ZSAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkx
NV9nZW1fZ3R0LmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9nZW1fZ3R0LmMKQEAg
LTEzNjMsMTIgKzEzNjMsOCBAQCBzdGF0aWMgaW50IGdlbjhfaW5pdF9zY3JhdGNoKHN0cnVjdCBp
OTE1X2FkZHJlc3Nfc3BhY2UgKnZtKQogCSAqIElmIGV2ZXJ5Ym9keSBhZ3JlZXMgdG8gbm90IHRv
IHdyaXRlIGludG8gdGhlIHNjcmF0Y2ggcGFnZSwKIAkgKiB3ZSBjYW4gcmV1c2UgaXQgZm9yIGFs
bCB2bSwga2VlcGluZyBjb250ZXh0cyBhbmQgcHJvY2Vzc2VzIHNlcGFyYXRlLgogCSAqLwotCWlm
ICh2bS0+aGFzX3JlYWRfb25seSAmJgotCSAgICB2bS0+aTkxNS0+a2VybmVsX2NvbnRleHQgJiYK
LQkgICAgdm0tPmk5MTUtPmtlcm5lbF9jb250ZXh0LT52bSkgewotCQlzdHJ1Y3QgaTkxNV9hZGRy
ZXNzX3NwYWNlICpjbG9uZSA9Ci0JCQlyY3VfZGVyZWZlcmVuY2VfcHJvdGVjdGVkKHZtLT5pOTE1
LT5rZXJuZWxfY29udGV4dC0+dm0sCi0JCQkJCQkgIHRydWUpOyAvKiBzdGF0aWMgKi8KKwlpZiAo
dm0tPmhhc19yZWFkX29ubHkgJiYgdm0tPmd0LT5rZXJuZWxfdm0pIHsKKwkJc3RydWN0IGk5MTVf
YWRkcmVzc19zcGFjZSAqY2xvbmUgPSB2bS0+Z3QtPmtlcm5lbF92bTsKIAogCQlHRU1fQlVHX09O
KCFjbG9uZS0+aGFzX3JlYWRfb25seSk7CiAKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9p
OTE1L2k5MTVfcGVyZi5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9wZXJmLmMKaW5kZXgg
YTliOTdkOWJhODNhLi40ZWI4YjhmY2Y1NTkgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9p
OTE1L2k5MTVfcGVyZi5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfcGVyZi5jCkBA
IC0yMjA4LDkgKzIyMDgsNiBAQCBzdGF0aWMgaW50IGdlbjhfY29uZmlndXJlX2FsbF9jb250ZXh0
cyhzdHJ1Y3QgaTkxNV9wZXJmX3N0cmVhbSAqc3RyZWFtLAogCSAqLwogCXNwaW5fbG9jaygmaTkx
NS0+Z2VtLmNvbnRleHRzLmxvY2spOwogCWxpc3RfZm9yX2VhY2hfZW50cnlfc2FmZShjdHgsIGNu
LCAmaTkxNS0+Z2VtLmNvbnRleHRzLmxpc3QsIGxpbmspIHsKLQkJaWYgKGN0eCA9PSBpOTE1LT5r
ZXJuZWxfY29udGV4dCkKLQkJCWNvbnRpbnVlOwotCiAJCWlmICgha3JlZl9nZXRfdW5sZXNzX3pl
cm8oJmN0eC0+cmVmKSkKIAkJCWNvbnRpbnVlOwogCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9k
cm0vaTkxNS9pOTE1X3JlcXVlc3QuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfcmVxdWVz
dC5jCmluZGV4IGNiZGJkZDg1NDdlMS4uMTdjMDlhMjc3OGEyIDEwMDY0NAotLS0gYS9kcml2ZXJz
L2dwdS9kcm0vaTkxNS9pOTE1X3JlcXVlc3QuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9p
OTE1X3JlcXVlc3QuYwpAQCAtMTIyMyw4ICsxMjIzLDggQEAgdm9pZCBfX2k5MTVfcmVxdWVzdF9x
dWV1ZShzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpycSwKIAogdm9pZCBpOTE1X3JlcXVlc3RfYWRkKHN0
cnVjdCBpOTE1X3JlcXVlc3QgKnJxKQogewotCXN0cnVjdCBpOTE1X3NjaGVkX2F0dHIgYXR0ciA9
IHJxLT5jb250ZXh0LT5nZW1fY29udGV4dC0+c2NoZWQ7CiAJc3RydWN0IGludGVsX3RpbWVsaW5l
ICogY29uc3QgdGwgPSBpOTE1X3JlcXVlc3RfdGltZWxpbmUocnEpOworCXN0cnVjdCBpOTE1X3Nj
aGVkX2F0dHIgYXR0ciA9IHt9OwogCXN0cnVjdCBpOTE1X3JlcXVlc3QgKnByZXY7CiAKIAlsb2Nr
ZGVwX2Fzc2VydF9oZWxkKCZ0bC0+bXV0ZXgpOwpAQCAtMTIzNCw2ICsxMjM0LDkgQEAgdm9pZCBp
OTE1X3JlcXVlc3RfYWRkKHN0cnVjdCBpOTE1X3JlcXVlc3QgKnJxKQogCiAJcHJldiA9IF9faTkx
NV9yZXF1ZXN0X2NvbW1pdChycSk7CiAKKwlpZiAocnEtPmNvbnRleHQtPmdlbV9jb250ZXh0KQor
CQlhdHRyID0gcnEtPmNvbnRleHQtPmdlbV9jb250ZXh0LT5zY2hlZDsKKwogCS8qCiAJICogQm9v
c3QgYWN0dWFsIHdvcmtsb2FkcyBwYXN0IHNlbWFwaG9yZXMhCiAJICoKZGlmZiAtLWdpdCBhL2Ry
aXZlcnMvZ3B1L2RybS9pOTE1L3NlbGZ0ZXN0cy9pOTE1X3JlcXVlc3QuYyBiL2RyaXZlcnMvZ3B1
L2RybS9pOTE1L3NlbGZ0ZXN0cy9pOTE1X3JlcXVlc3QuYwppbmRleCAzMGFlMzRmNjIxNzYuLjUw
ZGNjZjcyOTQyOSAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvc2VsZnRlc3RzL2k5
MTVfcmVxdWVzdC5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L3NlbGZ0ZXN0cy9pOTE1X3Jl
cXVlc3QuYwpAQCAtNzM5LDEwICs3MzksOCBAQCBzdGF0aWMgaW50IGxpdmVfZW1wdHlfcmVxdWVz
dCh2b2lkICphcmcpCiAKIHN0YXRpYyBzdHJ1Y3QgaTkxNV92bWEgKnJlY3Vyc2l2ZV9iYXRjaChz
dHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkKIHsKLQlzdHJ1Y3QgaTkxNV9nZW1fY29udGV4
dCAqY3R4ID0gaTkxNS0+a2VybmVsX2NvbnRleHQ7CiAJc3RydWN0IGRybV9pOTE1X2dlbV9vYmpl
Y3QgKm9iajsKIAljb25zdCBpbnQgZ2VuID0gSU5URUxfR0VOKGk5MTUpOwotCXN0cnVjdCBpOTE1
X2FkZHJlc3Nfc3BhY2UgKnZtOwogCXN0cnVjdCBpOTE1X3ZtYSAqdm1hOwogCXUzMiAqY21kOwog
CWludCBlcnI7CkBAIC03NTEsOSArNzQ5LDcgQEAgc3RhdGljIHN0cnVjdCBpOTE1X3ZtYSAqcmVj
dXJzaXZlX2JhdGNoKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KQogCWlmIChJU19FUlIo
b2JqKSkKIAkJcmV0dXJuIEVSUl9DQVNUKG9iaik7CiAKLQl2bSA9IGk5MTVfZ2VtX2NvbnRleHRf
Z2V0X3ZtX3JjdShjdHgpOwotCXZtYSA9IGk5MTVfdm1hX2luc3RhbmNlKG9iaiwgdm0sIE5VTEwp
OwotCWk5MTVfdm1fcHV0KHZtKTsKKwl2bWEgPSBpOTE1X3ZtYV9pbnN0YW5jZShvYmosIGk5MTUt
Pmd0Lmtlcm5lbF92bSwgTlVMTCk7CiAJaWYgKElTX0VSUih2bWEpKSB7CiAJCWVyciA9IFBUUl9F
UlIodm1hKTsKIAkJZ290byBlcnI7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9z
ZWxmdGVzdHMvbW9ja19nZW1fZGV2aWNlLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9zZWxmdGVz
dHMvbW9ja19nZW1fZGV2aWNlLmMKaW5kZXggYzJmNTc3NWI2ZDU4Li4wNWFlMGVhMTgxNzEgMTAw
NjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L3NlbGZ0ZXN0cy9tb2NrX2dlbV9kZXZpY2Uu
YworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMvbW9ja19nZW1fZGV2aWNlLmMK
QEAgLTYyLDcgKzYyLDYgQEAgc3RhdGljIHZvaWQgbW9ja19kZXZpY2VfcmVsZWFzZShzdHJ1Y3Qg
ZHJtX2RldmljZSAqZGV2KQogCiAJZm9yX2VhY2hfZW5naW5lKGVuZ2luZSwgJmk5MTUtPmd0LCBp
ZCkKIAkJbW9ja19lbmdpbmVfZnJlZShlbmdpbmUpOwotCWk5MTVfZ2VtX2RyaXZlcl9yZWxlYXNl
X19jb250ZXh0cyhpOTE1KTsKIAogCWludGVsX3RpbWVsaW5lc19maW5pKGk5MTUpOwogCkBAIC0x
ODIsNiArMTgxLDcgQEAgc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKm1vY2tfZ2VtX2RldmljZSh2
b2lkKQogCiAJbW9ja19pbml0X2dndHQoaTkxNSwgJmk5MTUtPmdndHQpOwogCWk5MTUtPmd0Lmdn
dHQgPSAmaTkxNS0+Z2d0dDsKKwlpOTE1LT5ndC5rZXJuZWxfdm0gPSBpOTE1X3ZtX2dldCgmaTkx
NS0+Z2d0dC52bSk7CiAKIAlta3dyaXRlX2RldmljZV9pbmZvKGk5MTUpLT5lbmdpbmVfbWFzayA9
IEJJVCgwKTsKIApAQCAtMTg5LDEwICsxODksNiBAQCBzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAq
bW9ja19nZW1fZGV2aWNlKHZvaWQpCiAJaWYgKCFpOTE1LT5lbmdpbmVbUkNTMF0pCiAJCWdvdG8g
ZXJyX3VubG9jazsKIAotCWk5MTUtPmtlcm5lbF9jb250ZXh0ID0gbW9ja19jb250ZXh0KGk5MTUs
IE5VTEwpOwotCWlmICghaTkxNS0+a2VybmVsX2NvbnRleHQpCi0JCWdvdG8gZXJyX2VuZ2luZTsK
LQogCWlmIChtb2NrX2VuZ2luZV9pbml0KGk5MTUtPmVuZ2luZVtSQ1MwXSkpCiAJCWdvdG8gZXJy
X2NvbnRleHQ7CiAKQEAgLTIwNSw4ICsyMDEsNiBAQCBzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAq
bW9ja19nZW1fZGV2aWNlKHZvaWQpCiAJcmV0dXJuIGk5MTU7CiAKIGVycl9jb250ZXh0OgotCWk5
MTVfZ2VtX2RyaXZlcl9yZWxlYXNlX19jb250ZXh0cyhpOTE1KTsKLWVycl9lbmdpbmU6CiAJbW9j
a19lbmdpbmVfZnJlZShpOTE1LT5lbmdpbmVbUkNTMF0pOwogZXJyX3VubG9jazoKIAlpbnRlbF90
aW1lbGluZXNfZmluaShpOTE1KTsKLS0gCjIuMjQuMC5yYzAKCl9fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fCkludGVsLWdmeCBtYWlsaW5nIGxpc3QKSW50ZWwt
Z2Z4QGxpc3RzLmZyZWVkZXNrdG9wLm9yZwpodHRwczovL2xpc3RzLmZyZWVkZXNrdG9wLm9yZy9t
YWlsbWFuL2xpc3RpbmZvL2ludGVsLWdmeA==

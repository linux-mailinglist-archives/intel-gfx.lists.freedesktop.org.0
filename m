Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id CD862E9D7D
	for <lists+intel-gfx@lfdr.de>; Wed, 30 Oct 2019 15:27:24 +0100 (CET)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 7DB366EA3F;
	Wed, 30 Oct 2019 14:27:18 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from mblankhorst.nl (mblankhorst.nl [141.105.120.124])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 507876EA30
 for <intel-gfx@lists.freedesktop.org>; Wed, 30 Oct 2019 14:27:06 +0000 (UTC)
From: Maarten Lankhorst <maarten.lankhorst@linux.intel.com>
To: intel-gfx@lists.freedesktop.org
Date: Wed, 30 Oct 2019 15:26:55 +0100
Message-Id: <20191030142657.22405-10-maarten.lankhorst@linux.intel.com>
X-Mailer: git-send-email 2.23.0
In-Reply-To: <20191030142657.22405-1-maarten.lankhorst@linux.intel.com>
References: <20191030142657.22405-1-maarten.lankhorst@linux.intel.com>
MIME-Version: 1.0
Subject: [Intel-gfx] [CI 10/12] drm/i915: Perform automated conversions for
 plane uapi/hw split, base -> uapi.
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

U3BsaXQgdXAgcGxhbmVfc3RhdGUtPmJhc2UgdG8gdWFwaS4gVGhpcyBpcyBkb25lIHVzaW5nIHRo
ZSBmb2xsb3dpbmcgcGF0Y2gsCnJhbiBhZnRlciB0aGUgcHJldmlvdXMgY29tbWl0IHRoYXQgc3Bs
aXRzIG91dCBhbnkgaHcgcmVmZXJlbmNlczoKCkBACnN0cnVjdCBpbnRlbF9wbGFuZV9zdGF0ZSAq
VDsKaWRlbnRpZmllciB4OwpAQAotVC0+YmFzZS54CitULT51YXBpLngKCkBACnN0cnVjdCBpbnRl
bF9wbGFuZV9zdGF0ZSAqVDsKQEAKLVQtPmJhc2UKK1QtPnVhcGkKClNpZ25lZC1vZmYtYnk6IE1h
YXJ0ZW4gTGFua2hvcnN0IDxtYWFydGVuLmxhbmtob3JzdEBsaW51eC5pbnRlbC5jb20+Ci0tLQog
ZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9hdG9taWMuYyAgIHwgICAyICstCiAu
Li4vZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfYXRvbWljX3BsYW5lLmMgfCAgMzIgKy0tCiBk
cml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2Rpc3BsYXkuYyAgfCAyNjIgKysrKysr
KysrLS0tLS0tLS0tCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2ZiYy5jICAg
ICAgfCAgMTIgKy0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfb3ZlcmxheS5j
ICB8ICAgMiArLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9zcHJpdGUuYyAg
IHwgMTM2ICsrKystLS0tLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50ZWxfcG0uYyAgICAgICAg
ICAgICAgIHwgIDU3ICsrLS0KIDcgZmlsZXMgY2hhbmdlZCwgMjUyIGluc2VydGlvbnMoKyksIDI1
MSBkZWxldGlvbnMoLSkKCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5
L2ludGVsX2F0b21pYy5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9hdG9t
aWMuYwppbmRleCAwYTVlZWU0YzM1MGYuLmVhMjRhNDVkYWI4NiAxMDA2NDQKLS0tIGEvZHJpdmVy
cy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9hdG9taWMuYworKysgYi9kcml2ZXJzL2dwdS9k
cm0vaTkxNS9kaXNwbGF5L2ludGVsX2F0b21pYy5jCkBAIC0yODYsNyArMjg2LDcgQEAgc3RhdGlj
IHZvaWQgaW50ZWxfYXRvbWljX3NldHVwX3NjYWxlcihzdHJ1Y3QgaW50ZWxfY3J0Y19zY2FsZXJf
c3RhdGUgKnNjYWxlcl9zdGEKIAlpZiAocGxhbmVfc3RhdGUgJiYgcGxhbmVfc3RhdGUtPmh3LmZi
ICYmCiAJICAgIHBsYW5lX3N0YXRlLT5ody5mYi0+Zm9ybWF0LT5pc195dXYgJiYKIAkgICAgcGxh
bmVfc3RhdGUtPmh3LmZiLT5mb3JtYXQtPm51bV9wbGFuZXMgPiAxKSB7Ci0JCXN0cnVjdCBpbnRl
bF9wbGFuZSAqcGxhbmUgPSB0b19pbnRlbF9wbGFuZShwbGFuZV9zdGF0ZS0+YmFzZS5wbGFuZSk7
CisJCXN0cnVjdCBpbnRlbF9wbGFuZSAqcGxhbmUgPSB0b19pbnRlbF9wbGFuZShwbGFuZV9zdGF0
ZS0+dWFwaS5wbGFuZSk7CiAJCWlmIChJU19HRU4oZGV2X3ByaXYsIDkpICYmCiAJCSAgICAhSVNf
R0VNSU5JTEFLRShkZXZfcHJpdikpIHsKIAkJCW1vZGUgPSBTS0xfUFNfU0NBTEVSX01PREVfTlYx
MjsKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfYXRvbWlj
X3BsYW5lLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2F0b21pY19wbGFu
ZS5jCmluZGV4IDRlOTI4ZTM2MWJlMS4uMTgwMjM0MjJhMzRkIDEwMDY0NAotLS0gYS9kcml2ZXJz
L2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2F0b21pY19wbGFuZS5jCisrKyBiL2RyaXZlcnMv
Z3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfYXRvbWljX3BsYW5lLmMKQEAgLTU2LDcgKzU2LDcg
QEAgc3RydWN0IGludGVsX3BsYW5lICppbnRlbF9wbGFuZV9hbGxvYyh2b2lkKQogCQlyZXR1cm4g
RVJSX1BUUigtRU5PTUVNKTsKIAl9CiAKLQlfX2RybV9hdG9taWNfaGVscGVyX3BsYW5lX3Jlc2V0
KCZwbGFuZS0+YmFzZSwgJnBsYW5lX3N0YXRlLT5iYXNlKTsKKwlfX2RybV9hdG9taWNfaGVscGVy
X3BsYW5lX3Jlc2V0KCZwbGFuZS0+YmFzZSwgJnBsYW5lX3N0YXRlLT51YXBpKTsKIAlwbGFuZV9z
dGF0ZS0+c2NhbGVyX2lkID0gLTE7CiAKIAlyZXR1cm4gcGxhbmU7CkBAIC04OCwxMiArODgsMTIg
QEAgaW50ZWxfcGxhbmVfZHVwbGljYXRlX3N0YXRlKHN0cnVjdCBkcm1fcGxhbmUgKnBsYW5lKQog
CWlmICghaW50ZWxfc3RhdGUpCiAJCXJldHVybiBOVUxMOwogCi0JX19kcm1fYXRvbWljX2hlbHBl
cl9wbGFuZV9kdXBsaWNhdGVfc3RhdGUocGxhbmUsICZpbnRlbF9zdGF0ZS0+YmFzZSk7CisJX19k
cm1fYXRvbWljX2hlbHBlcl9wbGFuZV9kdXBsaWNhdGVfc3RhdGUocGxhbmUsICZpbnRlbF9zdGF0
ZS0+dWFwaSk7CiAKIAlpbnRlbF9zdGF0ZS0+dm1hID0gTlVMTDsKIAlpbnRlbF9zdGF0ZS0+Zmxh
Z3MgPSAwOwogCi0JcmV0dXJuICZpbnRlbF9zdGF0ZS0+YmFzZTsKKwlyZXR1cm4gJmludGVsX3N0
YXRlLT51YXBpOwogfQogCiAvKioKQEAgLTExMSw3ICsxMTEsNyBAQCBpbnRlbF9wbGFuZV9kZXN0
cm95X3N0YXRlKHN0cnVjdCBkcm1fcGxhbmUgKnBsYW5lLAogCXN0cnVjdCBpbnRlbF9wbGFuZV9z
dGF0ZSAqcGxhbmVfc3RhdGUgPSB0b19pbnRlbF9wbGFuZV9zdGF0ZShzdGF0ZSk7CiAJV0FSTl9P
TihwbGFuZV9zdGF0ZS0+dm1hKTsKIAotCV9fZHJtX2F0b21pY19oZWxwZXJfcGxhbmVfZGVzdHJv
eV9zdGF0ZSgmcGxhbmVfc3RhdGUtPmJhc2UpOworCV9fZHJtX2F0b21pY19oZWxwZXJfcGxhbmVf
ZGVzdHJveV9zdGF0ZSgmcGxhbmVfc3RhdGUtPnVhcGkpOwogCWtmcmVlKHBsYW5lX3N0YXRlKTsK
IH0KIApAQCAtMTIxLDcgKzEyMSw3IEBAIHVuc2lnbmVkIGludCBpbnRlbF9wbGFuZV9kYXRhX3Jh
dGUoY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUsCiAJY29uc3Qgc3Ry
dWN0IGRybV9mcmFtZWJ1ZmZlciAqZmIgPSBwbGFuZV9zdGF0ZS0+aHcuZmI7CiAJdW5zaWduZWQg
aW50IGNwcDsKIAotCWlmICghcGxhbmVfc3RhdGUtPmJhc2UudmlzaWJsZSkKKwlpZiAoIXBsYW5l
X3N0YXRlLT51YXBpLnZpc2libGUpCiAJCXJldHVybiAwOwogCiAJY3BwID0gZmItPmZvcm1hdC0+
Y3BwWzBdOwpAQCAtMTQ0LDEwICsxNDQsMTAgQEAgYm9vbCBpbnRlbF9wbGFuZV9jYWxjX21pbl9j
ZGNsayhzdHJ1Y3QgaW50ZWxfYXRvbWljX3N0YXRlICpzdGF0ZSwKIAlzdHJ1Y3QgZHJtX2k5MTVf
cHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KHBsYW5lLT5iYXNlLmRldik7CiAJY29uc3Qgc3Ry
dWN0IGludGVsX3BsYW5lX3N0YXRlICpwbGFuZV9zdGF0ZSA9CiAJCWludGVsX2F0b21pY19nZXRf
bmV3X3BsYW5lX3N0YXRlKHN0YXRlLCBwbGFuZSk7Ci0Jc3RydWN0IGludGVsX2NydGMgKmNydGMg
PSB0b19pbnRlbF9jcnRjKHBsYW5lX3N0YXRlLT5iYXNlLmNydGMpOworCXN0cnVjdCBpbnRlbF9j
cnRjICpjcnRjID0gdG9faW50ZWxfY3J0YyhwbGFuZV9zdGF0ZS0+dWFwaS5jcnRjKTsKIAlzdHJ1
Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZTsKIAotCWlmICghcGxhbmVfc3RhdGUtPmJh
c2UudmlzaWJsZSB8fCAhcGxhbmUtPm1pbl9jZGNsaykKKwlpZiAoIXBsYW5lX3N0YXRlLT51YXBp
LnZpc2libGUgfHwgIXBsYW5lLT5taW5fY2RjbGspCiAJCXJldHVybiBmYWxzZTsKIAogCWNydGNf
c3RhdGUgPSBpbnRlbF9hdG9taWNfZ2V0X25ld19jcnRjX3N0YXRlKHN0YXRlLCBjcnRjKTsKQEAg
LTE4MSw3ICsxODEsNyBAQCBpbnQgaW50ZWxfcGxhbmVfYXRvbWljX2NoZWNrX3dpdGhfc3RhdGUo
Y29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKm9sZF9jcnRjXwogCQkJCQljb25zdCBzdHJ1
Y3QgaW50ZWxfcGxhbmVfc3RhdGUgKm9sZF9wbGFuZV9zdGF0ZSwKIAkJCQkJc3RydWN0IGludGVs
X3BsYW5lX3N0YXRlICpuZXdfcGxhbmVfc3RhdGUpCiB7Ci0Jc3RydWN0IGludGVsX3BsYW5lICpw
bGFuZSA9IHRvX2ludGVsX3BsYW5lKG5ld19wbGFuZV9zdGF0ZS0+YmFzZS5wbGFuZSk7CisJc3Ry
dWN0IGludGVsX3BsYW5lICpwbGFuZSA9IHRvX2ludGVsX3BsYW5lKG5ld19wbGFuZV9zdGF0ZS0+
dWFwaS5wbGFuZSk7CiAJY29uc3Qgc3RydWN0IGRybV9mcmFtZWJ1ZmZlciAqZmIgPSBuZXdfcGxh
bmVfc3RhdGUtPmh3LmZiOwogCWludCByZXQ7CiAKQEAgLTE5MCw3ICsxOTAsNyBAQCBpbnQgaW50
ZWxfcGxhbmVfYXRvbWljX2NoZWNrX3dpdGhfc3RhdGUoY29uc3Qgc3RydWN0IGludGVsX2NydGNf
c3RhdGUgKm9sZF9jcnRjXwogCW5ld19jcnRjX3N0YXRlLT5jOF9wbGFuZXMgJj0gfkJJVChwbGFu
ZS0+aWQpOwogCW5ld19jcnRjX3N0YXRlLT5kYXRhX3JhdGVbcGxhbmUtPmlkXSA9IDA7CiAJbmV3
X2NydGNfc3RhdGUtPm1pbl9jZGNsa1twbGFuZS0+aWRdID0gMDsKLQluZXdfcGxhbmVfc3RhdGUt
PmJhc2UudmlzaWJsZSA9IGZhbHNlOworCW5ld19wbGFuZV9zdGF0ZS0+dWFwaS52aXNpYmxlID0g
ZmFsc2U7CiAKIAlpZiAoIW5ld19wbGFuZV9zdGF0ZS0+aHcuY3J0YyAmJiAhb2xkX3BsYW5lX3N0
YXRlLT5ody5jcnRjKQogCQlyZXR1cm4gMDsKQEAgLTIwMCwxOCArMjAwLDE4IEBAIGludCBpbnRl
bF9wbGFuZV9hdG9taWNfY2hlY2tfd2l0aF9zdGF0ZShjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19z
dGF0ZSAqb2xkX2NydGNfCiAJCXJldHVybiByZXQ7CiAKIAkvKiBGSVhNRSBwcmUtZzR4IGRvbid0
IHdvcmsgbGlrZSB0aGlzICovCi0JaWYgKG5ld19wbGFuZV9zdGF0ZS0+YmFzZS52aXNpYmxlKQor
CWlmIChuZXdfcGxhbmVfc3RhdGUtPnVhcGkudmlzaWJsZSkKIAkJbmV3X2NydGNfc3RhdGUtPmFj
dGl2ZV9wbGFuZXMgfD0gQklUKHBsYW5lLT5pZCk7CiAKLQlpZiAobmV3X3BsYW5lX3N0YXRlLT5i
YXNlLnZpc2libGUgJiYKKwlpZiAobmV3X3BsYW5lX3N0YXRlLT51YXBpLnZpc2libGUgJiYKIAkg
ICAgZHJtX2Zvcm1hdF9pbmZvX2lzX3l1dl9zZW1pcGxhbmFyKGZiLT5mb3JtYXQpKQogCQluZXdf
Y3J0Y19zdGF0ZS0+bnYxMl9wbGFuZXMgfD0gQklUKHBsYW5lLT5pZCk7CiAKLQlpZiAobmV3X3Bs
YW5lX3N0YXRlLT5iYXNlLnZpc2libGUgJiYKKwlpZiAobmV3X3BsYW5lX3N0YXRlLT51YXBpLnZp
c2libGUgJiYKIAkgICAgZmItPmZvcm1hdC0+Zm9ybWF0ID09IERSTV9GT1JNQVRfQzgpCiAJCW5l
d19jcnRjX3N0YXRlLT5jOF9wbGFuZXMgfD0gQklUKHBsYW5lLT5pZCk7CiAKLQlpZiAobmV3X3Bs
YW5lX3N0YXRlLT5iYXNlLnZpc2libGUgfHwgb2xkX3BsYW5lX3N0YXRlLT5iYXNlLnZpc2libGUp
CisJaWYgKG5ld19wbGFuZV9zdGF0ZS0+dWFwaS52aXNpYmxlIHx8IG9sZF9wbGFuZV9zdGF0ZS0+
dWFwaS52aXNpYmxlKQogCQluZXdfY3J0Y19zdGF0ZS0+dXBkYXRlX3BsYW5lcyB8PSBCSVQocGxh
bmUtPmlkKTsKIAogCW5ld19jcnRjX3N0YXRlLT5kYXRhX3JhdGVbcGxhbmUtPmlkXSA9CkBAIC0y
NDYsNyArMjQ2LDcgQEAgaW50IGludGVsX3BsYW5lX2F0b21pY19jaGVjayhzdHJ1Y3QgaW50ZWxf
YXRvbWljX3N0YXRlICpzdGF0ZSwKIAljb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqb2xk
X2NydGNfc3RhdGU7CiAJc3RydWN0IGludGVsX2NydGNfc3RhdGUgKm5ld19jcnRjX3N0YXRlOwog
Ci0JbmV3X3BsYW5lX3N0YXRlLT5iYXNlLnZpc2libGUgPSBmYWxzZTsKKwluZXdfcGxhbmVfc3Rh
dGUtPnVhcGkudmlzaWJsZSA9IGZhbHNlOwogCWlmICghY3J0YykKIAkJcmV0dXJuIDA7CiAKQEAg
LTM1NSw3ICszNTUsNyBAQCB2b2lkIHNrbF91cGRhdGVfcGxhbmVzX29uX2NydGMoc3RydWN0IGlu
dGVsX2F0b21pY19zdGF0ZSAqc3RhdGUsCiAJCXN0cnVjdCBpbnRlbF9wbGFuZV9zdGF0ZSAqbmV3
X3BsYW5lX3N0YXRlID0KIAkJCWludGVsX2F0b21pY19nZXRfbmV3X3BsYW5lX3N0YXRlKHN0YXRl
LCBwbGFuZSk7CiAKLQkJaWYgKG5ld19wbGFuZV9zdGF0ZS0+YmFzZS52aXNpYmxlKSB7CisJCWlm
IChuZXdfcGxhbmVfc3RhdGUtPnVhcGkudmlzaWJsZSkgewogCQkJaW50ZWxfdXBkYXRlX3BsYW5l
KHBsYW5lLCBuZXdfY3J0Y19zdGF0ZSwgbmV3X3BsYW5lX3N0YXRlKTsKIAkJfSBlbHNlIGlmIChu
ZXdfcGxhbmVfc3RhdGUtPnBsYW5hcl9zbGF2ZSkgewogCQkJc3RydWN0IGludGVsX3BsYW5lICpt
YXN0ZXIgPQpAQCAtMzk1LDcgKzM5NSw3IEBAIHZvaWQgaTl4eF91cGRhdGVfcGxhbmVzX29uX2Ny
dGMoc3RydWN0IGludGVsX2F0b21pY19zdGF0ZSAqc3RhdGUsCiAJCSAgICAhKHVwZGF0ZV9tYXNr
ICYgQklUKHBsYW5lLT5pZCkpKQogCQkJY29udGludWU7CiAKLQkJaWYgKG5ld19wbGFuZV9zdGF0
ZS0+YmFzZS52aXNpYmxlKQorCQlpZiAobmV3X3BsYW5lX3N0YXRlLT51YXBpLnZpc2libGUpCiAJ
CQlpbnRlbF91cGRhdGVfcGxhbmUocGxhbmUsIG5ld19jcnRjX3N0YXRlLCBuZXdfcGxhbmVfc3Rh
dGUpOwogCQllbHNlCiAJCQlpbnRlbF9kaXNhYmxlX3BsYW5lKHBsYW5lLCBuZXdfY3J0Y19zdGF0
ZSk7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2Rpc3Bs
YXkuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZGlzcGxheS5jCmluZGV4
IDFjMGM1NWE3OGQwMy4uMTU4NDQyMWM3NmI5IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0v
aTkxNS9kaXNwbGF5L2ludGVsX2Rpc3BsYXkuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9k
aXNwbGF5L2ludGVsX2Rpc3BsYXkuYwpAQCAtMjA4Miw3ICsyMDgyLDcgQEAgc3RhdGljIHVuc2ln
bmVkIGludCBpbnRlbF9zdXJmX2FsaWdubWVudChjb25zdCBzdHJ1Y3QgZHJtX2ZyYW1lYnVmZmVy
ICpmYiwKIAogc3RhdGljIGJvb2wgaW50ZWxfcGxhbmVfdXNlc19mZW5jZShjb25zdCBzdHJ1Y3Qg
aW50ZWxfcGxhbmVfc3RhdGUgKnBsYW5lX3N0YXRlKQogewotCXN0cnVjdCBpbnRlbF9wbGFuZSAq
cGxhbmUgPSB0b19pbnRlbF9wbGFuZShwbGFuZV9zdGF0ZS0+YmFzZS5wbGFuZSk7CisJc3RydWN0
IGludGVsX3BsYW5lICpwbGFuZSA9IHRvX2ludGVsX3BsYW5lKHBsYW5lX3N0YXRlLT51YXBpLnBs
YW5lKTsKIAlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KHBsYW5l
LT5iYXNlLmRldik7CiAKIAlyZXR1cm4gSU5URUxfR0VOKGRldl9wcml2KSA8IDQgfHwKQEAgLTIz
OTEsNyArMjM5MSw3IEBAIHN0YXRpYyB1MzIgaW50ZWxfcGxhbmVfY29tcHV0ZV9hbGlnbmVkX29m
ZnNldChpbnQgKngsIGludCAqeSwKIAkJCQkJICAgICAgY29uc3Qgc3RydWN0IGludGVsX3BsYW5l
X3N0YXRlICpzdGF0ZSwKIAkJCQkJICAgICAgaW50IGNvbG9yX3BsYW5lKQogewotCXN0cnVjdCBp
bnRlbF9wbGFuZSAqaW50ZWxfcGxhbmUgPSB0b19pbnRlbF9wbGFuZShzdGF0ZS0+YmFzZS5wbGFu
ZSk7CisJc3RydWN0IGludGVsX3BsYW5lICppbnRlbF9wbGFuZSA9IHRvX2ludGVsX3BsYW5lKHN0
YXRlLT51YXBpLnBsYW5lKTsKIAlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0
b19pOTE1KGludGVsX3BsYW5lLT5iYXNlLmRldik7CiAJY29uc3Qgc3RydWN0IGRybV9mcmFtZWJ1
ZmZlciAqZmIgPSBzdGF0ZS0+aHcuZmI7CiAJdW5zaWduZWQgaW50IHJvdGF0aW9uID0gc3RhdGUt
Pmh3LnJvdGF0aW9uOwpAQCAtMjU3OSw3ICsyNTc5LDcgQEAgaW50ZWxfZmJfc3RyaWRlX2FsaWdu
bWVudChjb25zdCBzdHJ1Y3QgZHJtX2ZyYW1lYnVmZmVyICpmYiwgaW50IGNvbG9yX3BsYW5lKQog
CiBib29sIGludGVsX3BsYW5lX2Nhbl9yZW1hcChjb25zdCBzdHJ1Y3QgaW50ZWxfcGxhbmVfc3Rh
dGUgKnBsYW5lX3N0YXRlKQogewotCXN0cnVjdCBpbnRlbF9wbGFuZSAqcGxhbmUgPSB0b19pbnRl
bF9wbGFuZShwbGFuZV9zdGF0ZS0+YmFzZS5wbGFuZSk7CisJc3RydWN0IGludGVsX3BsYW5lICpw
bGFuZSA9IHRvX2ludGVsX3BsYW5lKHBsYW5lX3N0YXRlLT51YXBpLnBsYW5lKTsKIAlzdHJ1Y3Qg
ZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KHBsYW5lLT5iYXNlLmRldik7CiAJ
Y29uc3Qgc3RydWN0IGRybV9mcmFtZWJ1ZmZlciAqZmIgPSBwbGFuZV9zdGF0ZS0+aHcuZmI7CiAJ
aW50IGk7CkBAIC0yNjE5LDcgKzI2MTksNyBAQCBib29sIGludGVsX3BsYW5lX2Nhbl9yZW1hcChj
b25zdCBzdHJ1Y3QgaW50ZWxfcGxhbmVfc3RhdGUgKnBsYW5lX3N0YXRlKQogCiBzdGF0aWMgYm9v
bCBpbnRlbF9wbGFuZV9uZWVkc19yZW1hcChjb25zdCBzdHJ1Y3QgaW50ZWxfcGxhbmVfc3RhdGUg
KnBsYW5lX3N0YXRlKQogewotCXN0cnVjdCBpbnRlbF9wbGFuZSAqcGxhbmUgPSB0b19pbnRlbF9w
bGFuZShwbGFuZV9zdGF0ZS0+YmFzZS5wbGFuZSk7CisJc3RydWN0IGludGVsX3BsYW5lICpwbGFu
ZSA9IHRvX2ludGVsX3BsYW5lKHBsYW5lX3N0YXRlLT51YXBpLnBsYW5lKTsKIAljb25zdCBzdHJ1
Y3QgZHJtX2ZyYW1lYnVmZmVyICpmYiA9IHBsYW5lX3N0YXRlLT5ody5mYjsKIAl1bnNpZ25lZCBp
bnQgcm90YXRpb24gPSBwbGFuZV9zdGF0ZS0+aHcucm90YXRpb247CiAJdTMyIHN0cmlkZSwgbWF4
X3N0cmlkZTsKQEAgLTI2MjgsNyArMjYyOCw3IEBAIHN0YXRpYyBib29sIGludGVsX3BsYW5lX25l
ZWRzX3JlbWFwKGNvbnN0IHN0cnVjdCBpbnRlbF9wbGFuZV9zdGF0ZSAqcGxhbmVfc3RhdGUpCiAJ
ICogTm8gcmVtYXBwaW5nIGZvciBpbnZpc2libGUgcGxhbmVzIHNpbmNlIHdlIGRvbid0IGhhdmUK
IAkgKiBhbiBhY3R1YWwgc291cmNlIHZpZXdwb3J0IHRvIHJlbWFwLgogCSAqLwotCWlmICghcGxh
bmVfc3RhdGUtPmJhc2UudmlzaWJsZSkKKwlpZiAoIXBsYW5lX3N0YXRlLT51YXBpLnZpc2libGUp
CiAJCXJldHVybiBmYWxzZTsKIAogCWlmICghaW50ZWxfcGxhbmVfY2FuX3JlbWFwKHBsYW5lX3N0
YXRlKSkKQEAgLTI4MTEsNyArMjgxMSw3IEBAIHN0YXRpYyB2b2lkCiBpbnRlbF9wbGFuZV9yZW1h
cF9ndHQoc3RydWN0IGludGVsX3BsYW5lX3N0YXRlICpwbGFuZV9zdGF0ZSkKIHsKIAlzdHJ1Y3Qg
ZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPQotCQl0b19pOTE1KHBsYW5lX3N0YXRlLT5iYXNl
LnBsYW5lLT5kZXYpOworCQl0b19pOTE1KHBsYW5lX3N0YXRlLT51YXBpLnBsYW5lLT5kZXYpOwog
CXN0cnVjdCBkcm1fZnJhbWVidWZmZXIgKmZiID0gcGxhbmVfc3RhdGUtPmh3LmZiOwogCXN0cnVj
dCBpbnRlbF9mcmFtZWJ1ZmZlciAqaW50ZWxfZmIgPSB0b19pbnRlbF9mcmFtZWJ1ZmZlcihmYik7
CiAJc3RydWN0IGludGVsX3JvdGF0aW9uX2luZm8gKmluZm8gPSAmcGxhbmVfc3RhdGUtPnZpZXcu
cm90YXRlZDsKQEAgLTI4MjYsMjAgKzI4MjYsMjAgQEAgaW50ZWxfcGxhbmVfcmVtYXBfZ3R0KHN0
cnVjdCBpbnRlbF9wbGFuZV9zdGF0ZSAqcGxhbmVfc3RhdGUpCiAJcGxhbmVfc3RhdGUtPnZpZXcu
dHlwZSA9IGRybV9yb3RhdGlvbl85MF9vcl8yNzAocm90YXRpb24pID8KIAkJSTkxNV9HR1RUX1ZJ
RVdfUk9UQVRFRCA6IEk5MTVfR0dUVF9WSUVXX1JFTUFQUEVEOwogCi0Jc3JjX3ggPSBwbGFuZV9z
dGF0ZS0+YmFzZS5zcmMueDEgPj4gMTY7Ci0Jc3JjX3kgPSBwbGFuZV9zdGF0ZS0+YmFzZS5zcmMu
eTEgPj4gMTY7Ci0Jc3JjX3cgPSBkcm1fcmVjdF93aWR0aCgmcGxhbmVfc3RhdGUtPmJhc2Uuc3Jj
KSA+PiAxNjsKLQlzcmNfaCA9IGRybV9yZWN0X2hlaWdodCgmcGxhbmVfc3RhdGUtPmJhc2Uuc3Jj
KSA+PiAxNjsKKwlzcmNfeCA9IHBsYW5lX3N0YXRlLT51YXBpLnNyYy54MSA+PiAxNjsKKwlzcmNf
eSA9IHBsYW5lX3N0YXRlLT51YXBpLnNyYy55MSA+PiAxNjsKKwlzcmNfdyA9IGRybV9yZWN0X3dp
ZHRoKCZwbGFuZV9zdGF0ZS0+dWFwaS5zcmMpID4+IDE2OworCXNyY19oID0gZHJtX3JlY3RfaGVp
Z2h0KCZwbGFuZV9zdGF0ZS0+dWFwaS5zcmMpID4+IDE2OwogCiAJV0FSTl9PTihpc19jY3NfbW9k
aWZpZXIoZmItPm1vZGlmaWVyKSk7CiAKIAkvKiBNYWtlIHNyYyBjb29yZGluYXRlcyByZWxhdGl2
ZSB0byB0aGUgdmlld3BvcnQgKi8KLQlkcm1fcmVjdF90cmFuc2xhdGUoJnBsYW5lX3N0YXRlLT5i
YXNlLnNyYywKKwlkcm1fcmVjdF90cmFuc2xhdGUoJnBsYW5lX3N0YXRlLT51YXBpLnNyYywKIAkJ
CSAgIC0oc3JjX3ggPDwgMTYpLCAtKHNyY195IDw8IDE2KSk7CiAKIAkvKiBSb3RhdGUgc3JjIGNv
b3JkaW5hdGVzIHRvIG1hdGNoIHJvdGF0ZWQgR1RUIHZpZXcgKi8KIAlpZiAoZHJtX3JvdGF0aW9u
XzkwX29yXzI3MChyb3RhdGlvbikpCi0JCWRybV9yZWN0X3JvdGF0ZSgmcGxhbmVfc3RhdGUtPmJh
c2Uuc3JjLAorCQlkcm1fcmVjdF9yb3RhdGUoJnBsYW5lX3N0YXRlLT51YXBpLnNyYywKIAkJCQlz
cmNfdyA8PCAxNiwgc3JjX2ggPDwgMTYsCiAJCQkJRFJNX01PREVfUk9UQVRFXzI3MCk7CiAKQEAg
LTI5NTksNyArMjk1OSw3IEBAIGludGVsX3BsYW5lX2NvbXB1dGVfZ3R0KHN0cnVjdCBpbnRlbF9w
bGFuZV9zdGF0ZSAqcGxhbmVfc3RhdGUpCiAKIAkvKiBSb3RhdGUgc3JjIGNvb3JkaW5hdGVzIHRv
IG1hdGNoIHJvdGF0ZWQgR1RUIHZpZXcgKi8KIAlpZiAoZHJtX3JvdGF0aW9uXzkwX29yXzI3MChy
b3RhdGlvbikpCi0JCWRybV9yZWN0X3JvdGF0ZSgmcGxhbmVfc3RhdGUtPmJhc2Uuc3JjLAorCQlk
cm1fcmVjdF9yb3RhdGUoJnBsYW5lX3N0YXRlLT51YXBpLnNyYywKIAkJCQlmYi0+YmFzZS53aWR0
aCA8PCAxNiwgZmItPmJhc2UuaGVpZ2h0IDw8IDE2LAogCQkJCURSTV9NT0RFX1JPVEFURV8yNzAp
OwogCkBAIC0zMTI3LDkgKzMxMjcsOSBAQCBpbnRlbF9zZXRfcGxhbmVfdmlzaWJsZShzdHJ1Y3Qg
aW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSwKIAkJCXN0cnVjdCBpbnRlbF9wbGFuZV9zdGF0
ZSAqcGxhbmVfc3RhdGUsCiAJCQlib29sIHZpc2libGUpCiB7Ci0Jc3RydWN0IGludGVsX3BsYW5l
ICpwbGFuZSA9IHRvX2ludGVsX3BsYW5lKHBsYW5lX3N0YXRlLT5iYXNlLnBsYW5lKTsKKwlzdHJ1
Y3QgaW50ZWxfcGxhbmUgKnBsYW5lID0gdG9faW50ZWxfcGxhbmUocGxhbmVfc3RhdGUtPnVhcGku
cGxhbmUpOwogCi0JcGxhbmVfc3RhdGUtPmJhc2UudmlzaWJsZSA9IHZpc2libGU7CisJcGxhbmVf
c3RhdGUtPnVhcGkudmlzaWJsZSA9IHZpc2libGU7CiAKIAlpZiAodmlzaWJsZSkKIAkJY3J0Y19z
dGF0ZS0+dWFwaS5wbGFuZV9tYXNrIHw9IGRybV9wbGFuZV9tYXNrKCZwbGFuZS0+YmFzZSk7CkBA
IC0zMjc1LDggKzMyNzUsOCBAQCBpbnRlbF9maW5kX2luaXRpYWxfcGxhbmVfb2JqKHN0cnVjdCBp
bnRlbF9jcnRjICppbnRlbF9jcnRjLAogCXBsYW5lX3N0YXRlLT5jcnRjX3cgPSBmYi0+d2lkdGg7
CiAJcGxhbmVfc3RhdGUtPmNydGNfaCA9IGZiLT5oZWlnaHQ7CiAKLQlpbnRlbF9zdGF0ZS0+YmFz
ZS5zcmMgPSBkcm1fcGxhbmVfc3RhdGVfc3JjKHBsYW5lX3N0YXRlKTsKLQlpbnRlbF9zdGF0ZS0+
YmFzZS5kc3QgPSBkcm1fcGxhbmVfc3RhdGVfZGVzdChwbGFuZV9zdGF0ZSk7CisJaW50ZWxfc3Rh
dGUtPnVhcGkuc3JjID0gZHJtX3BsYW5lX3N0YXRlX3NyYyhwbGFuZV9zdGF0ZSk7CisJaW50ZWxf
c3RhdGUtPnVhcGkuZHN0ID0gZHJtX3BsYW5lX3N0YXRlX2Rlc3QocGxhbmVfc3RhdGUpOwogCiAJ
aWYgKHBsYW5lX2NvbmZpZy0+dGlsaW5nKQogCQlkZXZfcHJpdi0+cHJlc2VydmVfYmlvc19zd2l6
emxlID0gdHJ1ZTsKQEAgLTM0MTEsMTMgKzM0MTEsMTMgQEAgc3RhdGljIGJvb2wgc2tsX2NoZWNr
X21haW5fY2NzX2Nvb3JkaW5hdGVzKHN0cnVjdCBpbnRlbF9wbGFuZV9zdGF0ZSAqcGxhbmVfc3Rh
dGUKIAogc3RhdGljIGludCBza2xfY2hlY2tfbWFpbl9zdXJmYWNlKHN0cnVjdCBpbnRlbF9wbGFu
ZV9zdGF0ZSAqcGxhbmVfc3RhdGUpCiB7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9w
cml2ID0gdG9faTkxNShwbGFuZV9zdGF0ZS0+YmFzZS5wbGFuZS0+ZGV2KTsKKwlzdHJ1Y3QgZHJt
X2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KHBsYW5lX3N0YXRlLT51YXBpLnBsYW5l
LT5kZXYpOwogCWNvbnN0IHN0cnVjdCBkcm1fZnJhbWVidWZmZXIgKmZiID0gcGxhbmVfc3RhdGUt
Pmh3LmZiOwogCXVuc2lnbmVkIGludCByb3RhdGlvbiA9IHBsYW5lX3N0YXRlLT5ody5yb3RhdGlv
bjsKLQlpbnQgeCA9IHBsYW5lX3N0YXRlLT5iYXNlLnNyYy54MSA+PiAxNjsKLQlpbnQgeSA9IHBs
YW5lX3N0YXRlLT5iYXNlLnNyYy55MSA+PiAxNjsKLQlpbnQgdyA9IGRybV9yZWN0X3dpZHRoKCZw
bGFuZV9zdGF0ZS0+YmFzZS5zcmMpID4+IDE2OwotCWludCBoID0gZHJtX3JlY3RfaGVpZ2h0KCZw
bGFuZV9zdGF0ZS0+YmFzZS5zcmMpID4+IDE2OworCWludCB4ID0gcGxhbmVfc3RhdGUtPnVhcGku
c3JjLngxID4+IDE2OworCWludCB5ID0gcGxhbmVfc3RhdGUtPnVhcGkuc3JjLnkxID4+IDE2Owor
CWludCB3ID0gZHJtX3JlY3Rfd2lkdGgoJnBsYW5lX3N0YXRlLT51YXBpLnNyYykgPj4gMTY7CisJ
aW50IGggPSBkcm1fcmVjdF9oZWlnaHQoJnBsYW5lX3N0YXRlLT51YXBpLnNyYykgPj4gMTY7CiAJ
aW50IG1heF93aWR0aDsKIAlpbnQgbWF4X2hlaWdodDsKIAl1MzIgYWxpZ25tZW50LCBvZmZzZXQs
IGF1eF9vZmZzZXQgPSBwbGFuZV9zdGF0ZS0+Y29sb3JfcGxhbmVbMV0ub2Zmc2V0OwpAQCAtMzUw
MCw3ICszNTAwLDcgQEAgc3RhdGljIGludCBza2xfY2hlY2tfbWFpbl9zdXJmYWNlKHN0cnVjdCBp
bnRlbF9wbGFuZV9zdGF0ZSAqcGxhbmVfc3RhdGUpCiAJICogUHV0IHRoZSBmaW5hbCBjb29yZGlu
YXRlcyBiYWNrIHNvIHRoYXQgdGhlIHNyYwogCSAqIGNvb3JkaW5hdGUgY2hlY2tzIHdpbGwgc2Vl
IHRoZSByaWdodCB2YWx1ZXMuCiAJICovCi0JZHJtX3JlY3RfdHJhbnNsYXRlX3RvKCZwbGFuZV9z
dGF0ZS0+YmFzZS5zcmMsCisJZHJtX3JlY3RfdHJhbnNsYXRlX3RvKCZwbGFuZV9zdGF0ZS0+dWFw
aS5zcmMsCiAJCQkgICAgICB4IDw8IDE2LCB5IDw8IDE2KTsKIAogCXJldHVybiAwOwpAQCAtMzUx
MiwxMCArMzUxMiwxMCBAQCBzdGF0aWMgaW50IHNrbF9jaGVja19udjEyX2F1eF9zdXJmYWNlKHN0
cnVjdCBpbnRlbF9wbGFuZV9zdGF0ZSAqcGxhbmVfc3RhdGUpCiAJdW5zaWduZWQgaW50IHJvdGF0
aW9uID0gcGxhbmVfc3RhdGUtPmh3LnJvdGF0aW9uOwogCWludCBtYXhfd2lkdGggPSBza2xfbWF4
X3BsYW5lX3dpZHRoKGZiLCAxLCByb3RhdGlvbik7CiAJaW50IG1heF9oZWlnaHQgPSA0MDk2Owot
CWludCB4ID0gcGxhbmVfc3RhdGUtPmJhc2Uuc3JjLngxID4+IDE3OwotCWludCB5ID0gcGxhbmVf
c3RhdGUtPmJhc2Uuc3JjLnkxID4+IDE3OwotCWludCB3ID0gZHJtX3JlY3Rfd2lkdGgoJnBsYW5l
X3N0YXRlLT5iYXNlLnNyYykgPj4gMTc7Ci0JaW50IGggPSBkcm1fcmVjdF9oZWlnaHQoJnBsYW5l
X3N0YXRlLT5iYXNlLnNyYykgPj4gMTc7CisJaW50IHggPSBwbGFuZV9zdGF0ZS0+dWFwaS5zcmMu
eDEgPj4gMTc7CisJaW50IHkgPSBwbGFuZV9zdGF0ZS0+dWFwaS5zcmMueTEgPj4gMTc7CisJaW50
IHcgPSBkcm1fcmVjdF93aWR0aCgmcGxhbmVfc3RhdGUtPnVhcGkuc3JjKSA+PiAxNzsKKwlpbnQg
aCA9IGRybV9yZWN0X2hlaWdodCgmcGxhbmVfc3RhdGUtPnVhcGkuc3JjKSA+PiAxNzsKIAl1MzIg
b2Zmc2V0OwogCiAJaW50ZWxfYWRkX2ZiX29mZnNldHMoJngsICZ5LCBwbGFuZV9zdGF0ZSwgMSk7
CkBAIC0zNTM4LDggKzM1MzgsOCBAQCBzdGF0aWMgaW50IHNrbF9jaGVja19udjEyX2F1eF9zdXJm
YWNlKHN0cnVjdCBpbnRlbF9wbGFuZV9zdGF0ZSAqcGxhbmVfc3RhdGUpCiBzdGF0aWMgaW50IHNr
bF9jaGVja19jY3NfYXV4X3N1cmZhY2Uoc3RydWN0IGludGVsX3BsYW5lX3N0YXRlICpwbGFuZV9z
dGF0ZSkKIHsKIAljb25zdCBzdHJ1Y3QgZHJtX2ZyYW1lYnVmZmVyICpmYiA9IHBsYW5lX3N0YXRl
LT5ody5mYjsKLQlpbnQgc3JjX3ggPSBwbGFuZV9zdGF0ZS0+YmFzZS5zcmMueDEgPj4gMTY7Ci0J
aW50IHNyY195ID0gcGxhbmVfc3RhdGUtPmJhc2Uuc3JjLnkxID4+IDE2OworCWludCBzcmNfeCA9
IHBsYW5lX3N0YXRlLT51YXBpLnNyYy54MSA+PiAxNjsKKwlpbnQgc3JjX3kgPSBwbGFuZV9zdGF0
ZS0+dWFwaS5zcmMueTEgPj4gMTY7CiAJaW50IGhzdWIgPSBmYi0+Zm9ybWF0LT5oc3ViOwogCWlu
dCB2c3ViID0gZmItPmZvcm1hdC0+dnN1YjsKIAlpbnQgeCA9IHNyY194IC8gaHN1YjsKQEAgLTM1
NjUsNyArMzU2NSw3IEBAIGludCBza2xfY2hlY2tfcGxhbmVfc3VyZmFjZShzdHJ1Y3QgaW50ZWxf
cGxhbmVfc3RhdGUgKnBsYW5lX3N0YXRlKQogCWlmIChyZXQpCiAJCXJldHVybiByZXQ7CiAKLQlp
ZiAoIXBsYW5lX3N0YXRlLT5iYXNlLnZpc2libGUpCisJaWYgKCFwbGFuZV9zdGF0ZS0+dWFwaS52
aXNpYmxlKQogCQlyZXR1cm4gMDsKIAogCS8qCkBAIC0zNjg5LDcgKzM2ODksNyBAQCBzdGF0aWMg
dTMyIGk5eHhfcGxhbmVfY3RsKGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0
YXRlLAogCQkJICBjb25zdCBzdHJ1Y3QgaW50ZWxfcGxhbmVfc3RhdGUgKnBsYW5lX3N0YXRlKQog
ewogCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9Ci0JCXRvX2k5MTUocGxhbmVf
c3RhdGUtPmJhc2UucGxhbmUtPmRldik7CisJCXRvX2k5MTUocGxhbmVfc3RhdGUtPnVhcGkucGxh
bmUtPmRldik7CiAJY29uc3Qgc3RydWN0IGRybV9mcmFtZWJ1ZmZlciAqZmIgPSBwbGFuZV9zdGF0
ZS0+aHcuZmI7CiAJdW5zaWduZWQgaW50IHJvdGF0aW9uID0gcGxhbmVfc3RhdGUtPmh3LnJvdGF0
aW9uOwogCXUzMiBkc3BjbnRyOwpAQCAtMzc0Niw3ICszNzQ2LDcgQEAgc3RhdGljIHUzMiBpOXh4
X3BsYW5lX2N0bChjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSwKIGlu
dCBpOXh4X2NoZWNrX3BsYW5lX3N1cmZhY2Uoc3RydWN0IGludGVsX3BsYW5lX3N0YXRlICpwbGFu
ZV9zdGF0ZSkKIHsKIAlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPQotCQl0b19p
OTE1KHBsYW5lX3N0YXRlLT5iYXNlLnBsYW5lLT5kZXYpOworCQl0b19pOTE1KHBsYW5lX3N0YXRl
LT51YXBpLnBsYW5lLT5kZXYpOwogCWNvbnN0IHN0cnVjdCBkcm1fZnJhbWVidWZmZXIgKmZiID0g
cGxhbmVfc3RhdGUtPmh3LmZiOwogCWludCBzcmNfeCwgc3JjX3ksIHNyY193OwogCXUzMiBvZmZz
ZXQ7CkBAIC0zNzU2LDEyICszNzU2LDEyIEBAIGludCBpOXh4X2NoZWNrX3BsYW5lX3N1cmZhY2Uo
c3RydWN0IGludGVsX3BsYW5lX3N0YXRlICpwbGFuZV9zdGF0ZSkKIAlpZiAocmV0KQogCQlyZXR1
cm4gcmV0OwogCi0JaWYgKCFwbGFuZV9zdGF0ZS0+YmFzZS52aXNpYmxlKQorCWlmICghcGxhbmVf
c3RhdGUtPnVhcGkudmlzaWJsZSkKIAkJcmV0dXJuIDA7CiAKLQlzcmNfdyA9IGRybV9yZWN0X3dp
ZHRoKCZwbGFuZV9zdGF0ZS0+YmFzZS5zcmMpID4+IDE2OwotCXNyY194ID0gcGxhbmVfc3RhdGUt
PmJhc2Uuc3JjLngxID4+IDE2OwotCXNyY195ID0gcGxhbmVfc3RhdGUtPmJhc2Uuc3JjLnkxID4+
IDE2OworCXNyY193ID0gZHJtX3JlY3Rfd2lkdGgoJnBsYW5lX3N0YXRlLT51YXBpLnNyYykgPj4g
MTY7CisJc3JjX3ggPSBwbGFuZV9zdGF0ZS0+dWFwaS5zcmMueDEgPj4gMTY7CisJc3JjX3kgPSBw
bGFuZV9zdGF0ZS0+dWFwaS5zcmMueTEgPj4gMTY7CiAKIAkvKiBVbmRvY3VtZW50ZWQgaGFyZHdh
cmUgbGltaXQgb24gaTk2NS9nNHgvdmx2L2NodiAqLwogCWlmIChIQVNfR01DSChkZXZfcHJpdikg
JiYgZmItPmZvcm1hdC0+Y3BwWzBdID09IDggJiYgc3JjX3cgPiAyMDQ4KQpAQCAtMzc3OSwxNCAr
Mzc3OSwxNCBAQCBpbnQgaTl4eF9jaGVja19wbGFuZV9zdXJmYWNlKHN0cnVjdCBpbnRlbF9wbGFu
ZV9zdGF0ZSAqcGxhbmVfc3RhdGUpCiAJICogUHV0IHRoZSBmaW5hbCBjb29yZGluYXRlcyBiYWNr
IHNvIHRoYXQgdGhlIHNyYwogCSAqIGNvb3JkaW5hdGUgY2hlY2tzIHdpbGwgc2VlIHRoZSByaWdo
dCB2YWx1ZXMuCiAJICovCi0JZHJtX3JlY3RfdHJhbnNsYXRlX3RvKCZwbGFuZV9zdGF0ZS0+YmFz
ZS5zcmMsCisJZHJtX3JlY3RfdHJhbnNsYXRlX3RvKCZwbGFuZV9zdGF0ZS0+dWFwaS5zcmMsCiAJ
CQkgICAgICBzcmNfeCA8PCAxNiwgc3JjX3kgPDwgMTYpOwogCiAJLyogSFNXL0JEVyBkbyB0aGlz
IGF1dG9tYWdpY2FsbHkgaW4gaGFyZHdhcmUgKi8KIAlpZiAoIUlTX0hBU1dFTEwoZGV2X3ByaXYp
ICYmICFJU19CUk9BRFdFTEwoZGV2X3ByaXYpKSB7CiAJCXVuc2lnbmVkIGludCByb3RhdGlvbiA9
IHBsYW5lX3N0YXRlLT5ody5yb3RhdGlvbjsKLQkJaW50IHNyY193ID0gZHJtX3JlY3Rfd2lkdGgo
JnBsYW5lX3N0YXRlLT5iYXNlLnNyYykgPj4gMTY7Ci0JCWludCBzcmNfaCA9IGRybV9yZWN0X2hl
aWdodCgmcGxhbmVfc3RhdGUtPmJhc2Uuc3JjKSA+PiAxNjsKKwkJaW50IHNyY193ID0gZHJtX3Jl
Y3Rfd2lkdGgoJnBsYW5lX3N0YXRlLT51YXBpLnNyYykgPj4gMTY7CisJCWludCBzcmNfaCA9IGRy
bV9yZWN0X2hlaWdodCgmcGxhbmVfc3RhdGUtPnVhcGkuc3JjKSA+PiAxNjsKIAogCQlpZiAocm90
YXRpb24gJiBEUk1fTU9ERV9ST1RBVEVfMTgwKSB7CiAJCQlzcmNfeCArPSBzcmNfdyAtIDE7CkBA
IC0zODIzLDE0ICszODIzLDE0IEBAIHN0YXRpYyBpbnQKIGk5eHhfcGxhbmVfY2hlY2soc3RydWN0
IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUsCiAJCSBzdHJ1Y3QgaW50ZWxfcGxhbmVfc3Rh
dGUgKnBsYW5lX3N0YXRlKQogewotCXN0cnVjdCBpbnRlbF9wbGFuZSAqcGxhbmUgPSB0b19pbnRl
bF9wbGFuZShwbGFuZV9zdGF0ZS0+YmFzZS5wbGFuZSk7CisJc3RydWN0IGludGVsX3BsYW5lICpw
bGFuZSA9IHRvX2ludGVsX3BsYW5lKHBsYW5lX3N0YXRlLT51YXBpLnBsYW5lKTsKIAlpbnQgcmV0
OwogCiAJcmV0ID0gY2h2X3BsYW5lX2NoZWNrX3JvdGF0aW9uKHBsYW5lX3N0YXRlKTsKIAlpZiAo
cmV0KQogCQlyZXR1cm4gcmV0OwogCi0JcmV0ID0gZHJtX2F0b21pY19oZWxwZXJfY2hlY2tfcGxh
bmVfc3RhdGUoJnBsYW5lX3N0YXRlLT5iYXNlLAorCXJldCA9IGRybV9hdG9taWNfaGVscGVyX2No
ZWNrX3BsYW5lX3N0YXRlKCZwbGFuZV9zdGF0ZS0+dWFwaSwKIAkJCQkJCSAgJmNydGNfc3RhdGUt
PnVhcGksCiAJCQkJCQkgIERSTV9QTEFORV9IRUxQRVJfTk9fU0NBTElORywKIAkJCQkJCSAgRFJN
X1BMQU5FX0hFTFBFUl9OT19TQ0FMSU5HLApAQCAtMzg0Myw3ICszODQzLDcgQEAgaTl4eF9wbGFu
ZV9jaGVjayhzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSwKIAlpZiAocmV0KQog
CQlyZXR1cm4gcmV0OwogCi0JaWYgKCFwbGFuZV9zdGF0ZS0+YmFzZS52aXNpYmxlKQorCWlmICgh
cGxhbmVfc3RhdGUtPnVhcGkudmlzaWJsZSkKIAkJcmV0dXJuIDA7CiAKIAlyZXQgPSBpbnRlbF9w
bGFuZV9jaGVja19zcmNfY29vcmRpbmF0ZXMocGxhbmVfc3RhdGUpOwpAQCAtMzg2NCwxMCArMzg2
NCwxMCBAQCBzdGF0aWMgdm9pZCBpOXh4X3VwZGF0ZV9wbGFuZShzdHJ1Y3QgaW50ZWxfcGxhbmUg
KnBsYW5lLAogCXUzMiBsaW5lYXJfb2Zmc2V0OwogCWludCB4ID0gcGxhbmVfc3RhdGUtPmNvbG9y
X3BsYW5lWzBdLng7CiAJaW50IHkgPSBwbGFuZV9zdGF0ZS0+Y29sb3JfcGxhbmVbMF0ueTsKLQlp
bnQgY3J0Y194ID0gcGxhbmVfc3RhdGUtPmJhc2UuZHN0LngxOwotCWludCBjcnRjX3kgPSBwbGFu
ZV9zdGF0ZS0+YmFzZS5kc3QueTE7Ci0JaW50IGNydGNfdyA9IGRybV9yZWN0X3dpZHRoKCZwbGFu
ZV9zdGF0ZS0+YmFzZS5kc3QpOwotCWludCBjcnRjX2ggPSBkcm1fcmVjdF9oZWlnaHQoJnBsYW5l
X3N0YXRlLT5iYXNlLmRzdCk7CisJaW50IGNydGNfeCA9IHBsYW5lX3N0YXRlLT51YXBpLmRzdC54
MTsKKwlpbnQgY3J0Y195ID0gcGxhbmVfc3RhdGUtPnVhcGkuZHN0LnkxOworCWludCBjcnRjX3cg
PSBkcm1fcmVjdF93aWR0aCgmcGxhbmVfc3RhdGUtPnVhcGkuZHN0KTsKKwlpbnQgY3J0Y19oID0g
ZHJtX3JlY3RfaGVpZ2h0KCZwbGFuZV9zdGF0ZS0+dWFwaS5kc3QpOwogCXVuc2lnbmVkIGxvbmcg
aXJxZmxhZ3M7CiAJdTMyIGRzcGFkZHJfb2Zmc2V0OwogCXUzMiBkc3BjbnRyOwpAQCAtNDIyMSw3
ICs0MjIxLDcgQEAgdTMyIHNrbF9wbGFuZV9jdGwoY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3Rh
dGUgKmNydGNfc3RhdGUsCiAJCSAgY29uc3Qgc3RydWN0IGludGVsX3BsYW5lX3N0YXRlICpwbGFu
ZV9zdGF0ZSkKIHsKIAlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPQotCQl0b19p
OTE1KHBsYW5lX3N0YXRlLT5iYXNlLnBsYW5lLT5kZXYpOworCQl0b19pOTE1KHBsYW5lX3N0YXRl
LT51YXBpLnBsYW5lLT5kZXYpOwogCWNvbnN0IHN0cnVjdCBkcm1fZnJhbWVidWZmZXIgKmZiID0g
cGxhbmVfc3RhdGUtPmh3LmZiOwogCXVuc2lnbmVkIGludCByb3RhdGlvbiA9IHBsYW5lX3N0YXRl
LT5ody5yb3RhdGlvbjsKIAljb25zdCBzdHJ1Y3QgZHJtX2ludGVsX3Nwcml0ZV9jb2xvcmtleSAq
a2V5ID0gJnBsYW5lX3N0YXRlLT5ja2V5OwpAQCAtNDI3Nyw5ICs0Mjc3LDkgQEAgdTMyIGdsa19w
bGFuZV9jb2xvcl9jdGwoY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUs
CiAJCQljb25zdCBzdHJ1Y3QgaW50ZWxfcGxhbmVfc3RhdGUgKnBsYW5lX3N0YXRlKQogewogCXN0
cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9Ci0JCXRvX2k5MTUocGxhbmVfc3RhdGUt
PmJhc2UucGxhbmUtPmRldik7CisJCXRvX2k5MTUocGxhbmVfc3RhdGUtPnVhcGkucGxhbmUtPmRl
dik7CiAJY29uc3Qgc3RydWN0IGRybV9mcmFtZWJ1ZmZlciAqZmIgPSBwbGFuZV9zdGF0ZS0+aHcu
ZmI7Ci0Jc3RydWN0IGludGVsX3BsYW5lICpwbGFuZSA9IHRvX2ludGVsX3BsYW5lKHBsYW5lX3N0
YXRlLT5iYXNlLnBsYW5lKTsKKwlzdHJ1Y3QgaW50ZWxfcGxhbmUgKnBsYW5lID0gdG9faW50ZWxf
cGxhbmUocGxhbmVfc3RhdGUtPnVhcGkucGxhbmUpOwogCXUzMiBwbGFuZV9jb2xvcl9jdGwgPSAw
OwogCiAJcGxhbmVfY29sb3JfY3RsIHw9IFBMQU5FX0NPTE9SX1BMQU5FX0dBTU1BX0RJU0FCTEU7
CkBAIC01NjIzLDExICs1NjIzLDExIEBAIHN0YXRpYyBpbnQgc2tsX3VwZGF0ZV9zY2FsZXJfcGxh
bmUoc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUsCiAJCQkJICAgc3RydWN0IGlu
dGVsX3BsYW5lX3N0YXRlICpwbGFuZV9zdGF0ZSkKIHsKIAlzdHJ1Y3QgaW50ZWxfcGxhbmUgKmlu
dGVsX3BsYW5lID0KLQkJdG9faW50ZWxfcGxhbmUocGxhbmVfc3RhdGUtPmJhc2UucGxhbmUpOwor
CQl0b19pbnRlbF9wbGFuZShwbGFuZV9zdGF0ZS0+dWFwaS5wbGFuZSk7CiAJc3RydWN0IGRybV9p
OTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShpbnRlbF9wbGFuZS0+YmFzZS5kZXYpOwog
CXN0cnVjdCBkcm1fZnJhbWVidWZmZXIgKmZiID0gcGxhbmVfc3RhdGUtPmh3LmZiOwogCWludCBy
ZXQ7Ci0JYm9vbCBmb3JjZV9kZXRhY2ggPSAhZmIgfHwgIXBsYW5lX3N0YXRlLT5iYXNlLnZpc2li
bGU7CisJYm9vbCBmb3JjZV9kZXRhY2ggPSAhZmIgfHwgIXBsYW5lX3N0YXRlLT51YXBpLnZpc2li
bGU7CiAJYm9vbCBuZWVkX3NjYWxlciA9IGZhbHNlOwogCiAJLyogUHJlLWdlbjExIGFuZCBTRFIg
cGxhbmVzIGFsd2F5cyBuZWVkIGEgc2NhbGVyIGZvciBwbGFuYXIgZm9ybWF0cy4gKi8KQEAgLTU2
MzgsMTAgKzU2MzgsMTAgQEAgc3RhdGljIGludCBza2xfdXBkYXRlX3NjYWxlcl9wbGFuZShzdHJ1
Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSwKIAlyZXQgPSBza2xfdXBkYXRlX3NjYWxl
cihjcnRjX3N0YXRlLCBmb3JjZV9kZXRhY2gsCiAJCQkJZHJtX3BsYW5lX2luZGV4KCZpbnRlbF9w
bGFuZS0+YmFzZSksCiAJCQkJJnBsYW5lX3N0YXRlLT5zY2FsZXJfaWQsCi0JCQkJZHJtX3JlY3Rf
d2lkdGgoJnBsYW5lX3N0YXRlLT5iYXNlLnNyYykgPj4gMTYsCi0JCQkJZHJtX3JlY3RfaGVpZ2h0
KCZwbGFuZV9zdGF0ZS0+YmFzZS5zcmMpID4+IDE2LAotCQkJCWRybV9yZWN0X3dpZHRoKCZwbGFu
ZV9zdGF0ZS0+YmFzZS5kc3QpLAotCQkJCWRybV9yZWN0X2hlaWdodCgmcGxhbmVfc3RhdGUtPmJh
c2UuZHN0KSwKKwkJCQlkcm1fcmVjdF93aWR0aCgmcGxhbmVfc3RhdGUtPnVhcGkuc3JjKSA+PiAx
NiwKKwkJCQlkcm1fcmVjdF9oZWlnaHQoJnBsYW5lX3N0YXRlLT51YXBpLnNyYykgPj4gMTYsCisJ
CQkJZHJtX3JlY3Rfd2lkdGgoJnBsYW5lX3N0YXRlLT51YXBpLmRzdCksCisJCQkJZHJtX3JlY3Rf
aGVpZ2h0KCZwbGFuZV9zdGF0ZS0+dWFwaS5kc3QpLAogCQkJCWZiID8gZmItPmZvcm1hdCA6IE5V
TEwsIG5lZWRfc2NhbGVyKTsKIAogCWlmIChyZXQgfHwgcGxhbmVfc3RhdGUtPnNjYWxlcl9pZCA8
IDApCkBAIC02MDU3LDcgKzYwNTcsNyBAQCBzdGF0aWMgdm9pZCBpbnRlbF9wcmVfcGxhbmVfdXBk
YXRlKHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpvbGRfY3J0Y19zdGF0ZSwKIAkJICogU28gZGlz
YWJsZSB1bmRlcnJ1biByZXBvcnRpbmcgYmVmb3JlIGFsbCB0aGUgcGxhbmVzIGdldCBkaXNhYmxl
ZC4KIAkJICovCiAJCWlmIChJU19HRU4oZGV2X3ByaXYsIDIpICYmIG9sZF9wcmltYXJ5X3N0YXRl
LT52aXNpYmxlICYmCi0JCSAgICAobW9kZXNldCB8fCAhbmV3X3ByaW1hcnlfc3RhdGUtPmJhc2Uu
dmlzaWJsZSkpCisJCSAgICAobW9kZXNldCB8fCAhbmV3X3ByaW1hcnlfc3RhdGUtPnVhcGkudmlz
aWJsZSkpCiAJCQlpbnRlbF9zZXRfY3B1X2ZpZm9fdW5kZXJydW5fcmVwb3J0aW5nKGRldl9wcml2
LCBjcnRjLT5waXBlLCBmYWxzZSk7CiAJfQogCkBAIC02MTQ0LDcgKzYxNDQsNyBAQCBzdGF0aWMg
dm9pZCBpbnRlbF9jcnRjX2Rpc2FibGVfcGxhbmVzKHN0cnVjdCBpbnRlbF9hdG9taWNfc3RhdGUg
KnN0YXRlLAogCiAJCWludGVsX2Rpc2FibGVfcGxhbmUocGxhbmUsIG5ld19jcnRjX3N0YXRlKTsK
IAotCQlpZiAob2xkX3BsYW5lX3N0YXRlLT5iYXNlLnZpc2libGUpCisJCWlmIChvbGRfcGxhbmVf
c3RhdGUtPnVhcGkudmlzaWJsZSkKIAkJCWZiX2JpdHMgfD0gcGxhbmUtPmZyb250YnVmZmVyX2Jp
dDsKIAl9CiAKQEAgLTcxNTMsNyArNzE1Myw3IEBAIHN0YXRpYyB2b2lkIGludGVsX2NydGNfZGlz
YWJsZV9ub2F0b21pYyhzdHJ1Y3QgZHJtX2NydGMgKmNydGMsCiAJCWNvbnN0IHN0cnVjdCBpbnRl
bF9wbGFuZV9zdGF0ZSAqcGxhbmVfc3RhdGUgPQogCQkJdG9faW50ZWxfcGxhbmVfc3RhdGUocGxh
bmUtPmJhc2Uuc3RhdGUpOwogCi0JCWlmIChwbGFuZV9zdGF0ZS0+YmFzZS52aXNpYmxlKQorCQlp
ZiAocGxhbmVfc3RhdGUtPnVhcGkudmlzaWJsZSkKIAkJCWludGVsX3BsYW5lX2Rpc2FibGVfbm9h
dG9taWMoaW50ZWxfY3J0YywgcGxhbmUpOwogCX0KIApAQCAtMTA3MjgsNyArMTA3MjgsNyBAQCBz
dGF0aWMgYm9vbCBoYXN3ZWxsX2dldF9waXBlX2NvbmZpZyhzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0
YywKIHN0YXRpYyB1MzIgaW50ZWxfY3Vyc29yX2Jhc2UoY29uc3Qgc3RydWN0IGludGVsX3BsYW5l
X3N0YXRlICpwbGFuZV9zdGF0ZSkKIHsKIAlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3By
aXYgPQotCQl0b19pOTE1KHBsYW5lX3N0YXRlLT5iYXNlLnBsYW5lLT5kZXYpOworCQl0b19pOTE1
KHBsYW5lX3N0YXRlLT51YXBpLnBsYW5lLT5kZXYpOwogCWNvbnN0IHN0cnVjdCBkcm1fZnJhbWVi
dWZmZXIgKmZiID0gcGxhbmVfc3RhdGUtPmh3LmZiOwogCWNvbnN0IHN0cnVjdCBkcm1faTkxNV9n
ZW1fb2JqZWN0ICpvYmogPSBpbnRlbF9mYl9vYmooZmIpOwogCXUzMiBiYXNlOwpAQCAtMTA3NDMs
OCArMTA3NDMsOCBAQCBzdGF0aWMgdTMyIGludGVsX2N1cnNvcl9iYXNlKGNvbnN0IHN0cnVjdCBp
bnRlbF9wbGFuZV9zdGF0ZSAqcGxhbmVfc3RhdGUpCiAKIHN0YXRpYyB1MzIgaW50ZWxfY3Vyc29y
X3Bvc2l0aW9uKGNvbnN0IHN0cnVjdCBpbnRlbF9wbGFuZV9zdGF0ZSAqcGxhbmVfc3RhdGUpCiB7
Ci0JaW50IHggPSBwbGFuZV9zdGF0ZS0+YmFzZS5kc3QueDE7Ci0JaW50IHkgPSBwbGFuZV9zdGF0
ZS0+YmFzZS5kc3QueTE7CisJaW50IHggPSBwbGFuZV9zdGF0ZS0+dWFwaS5kc3QueDE7CisJaW50
IHkgPSBwbGFuZV9zdGF0ZS0+dWFwaS5kc3QueTE7CiAJdTMyIHBvcyA9IDA7CiAKIAlpZiAoeCA8
IDApIHsKQEAgLTEwNzY1LDkgKzEwNzY1LDkgQEAgc3RhdGljIHUzMiBpbnRlbF9jdXJzb3JfcG9z
aXRpb24oY29uc3Qgc3RydWN0IGludGVsX3BsYW5lX3N0YXRlICpwbGFuZV9zdGF0ZSkKIHN0YXRp
YyBib29sIGludGVsX2N1cnNvcl9zaXplX29rKGNvbnN0IHN0cnVjdCBpbnRlbF9wbGFuZV9zdGF0
ZSAqcGxhbmVfc3RhdGUpCiB7CiAJY29uc3Qgc3RydWN0IGRybV9tb2RlX2NvbmZpZyAqY29uZmln
ID0KLQkJJnBsYW5lX3N0YXRlLT5iYXNlLnBsYW5lLT5kZXYtPm1vZGVfY29uZmlnOwotCWludCB3
aWR0aCA9IGRybV9yZWN0X3dpZHRoKCZwbGFuZV9zdGF0ZS0+YmFzZS5kc3QpOwotCWludCBoZWln
aHQgPSBkcm1fcmVjdF9oZWlnaHQoJnBsYW5lX3N0YXRlLT5iYXNlLmRzdCk7CisJCSZwbGFuZV9z
dGF0ZS0+dWFwaS5wbGFuZS0+ZGV2LT5tb2RlX2NvbmZpZzsKKwlpbnQgd2lkdGggPSBkcm1fcmVj
dF93aWR0aCgmcGxhbmVfc3RhdGUtPnVhcGkuZHN0KTsKKwlpbnQgaGVpZ2h0ID0gZHJtX3JlY3Rf
aGVpZ2h0KCZwbGFuZV9zdGF0ZS0+dWFwaS5kc3QpOwogCiAJcmV0dXJuIHdpZHRoID4gMCAmJiB3
aWR0aCA8PSBjb25maWctPmN1cnNvcl93aWR0aCAmJgogCQloZWlnaHQgPiAwICYmIGhlaWdodCA8
PSBjb25maWctPmN1cnNvcl9oZWlnaHQ7CkBAIC0xMDc3Niw3ICsxMDc3Niw3IEBAIHN0YXRpYyBi
b29sIGludGVsX2N1cnNvcl9zaXplX29rKGNvbnN0IHN0cnVjdCBpbnRlbF9wbGFuZV9zdGF0ZSAq
cGxhbmVfc3RhdGUpCiBzdGF0aWMgaW50IGludGVsX2N1cnNvcl9jaGVja19zdXJmYWNlKHN0cnVj
dCBpbnRlbF9wbGFuZV9zdGF0ZSAqcGxhbmVfc3RhdGUpCiB7CiAJc3RydWN0IGRybV9pOTE1X3By
aXZhdGUgKmRldl9wcml2ID0KLQkJdG9faTkxNShwbGFuZV9zdGF0ZS0+YmFzZS5wbGFuZS0+ZGV2
KTsKKwkJdG9faTkxNShwbGFuZV9zdGF0ZS0+dWFwaS5wbGFuZS0+ZGV2KTsKIAl1bnNpZ25lZCBp
bnQgcm90YXRpb24gPSBwbGFuZV9zdGF0ZS0+aHcucm90YXRpb247CiAJaW50IHNyY194LCBzcmNf
eTsKIAl1MzIgb2Zmc2V0OwpAQCAtMTA3ODYsMTEgKzEwNzg2LDExIEBAIHN0YXRpYyBpbnQgaW50
ZWxfY3Vyc29yX2NoZWNrX3N1cmZhY2Uoc3RydWN0IGludGVsX3BsYW5lX3N0YXRlICpwbGFuZV9z
dGF0ZSkKIAlpZiAocmV0KQogCQlyZXR1cm4gcmV0OwogCi0JaWYgKCFwbGFuZV9zdGF0ZS0+YmFz
ZS52aXNpYmxlKQorCWlmICghcGxhbmVfc3RhdGUtPnVhcGkudmlzaWJsZSkKIAkJcmV0dXJuIDA7
CiAKLQlzcmNfeCA9IHBsYW5lX3N0YXRlLT5iYXNlLnNyYy54MSA+PiAxNjsKLQlzcmNfeSA9IHBs
YW5lX3N0YXRlLT5iYXNlLnNyYy55MSA+PiAxNjsKKwlzcmNfeCA9IHBsYW5lX3N0YXRlLT51YXBp
LnNyYy54MSA+PiAxNjsKKwlzcmNfeSA9IHBsYW5lX3N0YXRlLT51YXBpLnNyYy55MSA+PiAxNjsK
IAogCWludGVsX2FkZF9mYl9vZmZzZXRzKCZzcmNfeCwgJnNyY195LCBwbGFuZV9zdGF0ZSwgMCk7
CiAJb2Zmc2V0ID0gaW50ZWxfcGxhbmVfY29tcHV0ZV9hbGlnbmVkX29mZnNldCgmc3JjX3gsICZz
cmNfeSwKQEAgLTEwODA1LDE0ICsxMDgwNSwxNCBAQCBzdGF0aWMgaW50IGludGVsX2N1cnNvcl9j
aGVja19zdXJmYWNlKHN0cnVjdCBpbnRlbF9wbGFuZV9zdGF0ZSAqcGxhbmVfc3RhdGUpCiAJICog
UHV0IHRoZSBmaW5hbCBjb29yZGluYXRlcyBiYWNrIHNvIHRoYXQgdGhlIHNyYwogCSAqIGNvb3Jk
aW5hdGUgY2hlY2tzIHdpbGwgc2VlIHRoZSByaWdodCB2YWx1ZXMuCiAJICovCi0JZHJtX3JlY3Rf
dHJhbnNsYXRlX3RvKCZwbGFuZV9zdGF0ZS0+YmFzZS5zcmMsCisJZHJtX3JlY3RfdHJhbnNsYXRl
X3RvKCZwbGFuZV9zdGF0ZS0+dWFwaS5zcmMsCiAJCQkgICAgICBzcmNfeCA8PCAxNiwgc3JjX3kg
PDwgMTYpOwogCiAJLyogSUxLKyBkbyB0aGlzIGF1dG9tYWdpY2FsbHkgaW4gaGFyZHdhcmUgKi8K
IAlpZiAoSEFTX0dNQ0goZGV2X3ByaXYpICYmIHJvdGF0aW9uICYgRFJNX01PREVfUk9UQVRFXzE4
MCkgewogCQljb25zdCBzdHJ1Y3QgZHJtX2ZyYW1lYnVmZmVyICpmYiA9IHBsYW5lX3N0YXRlLT5o
dy5mYjsKLQkJaW50IHNyY193ID0gZHJtX3JlY3Rfd2lkdGgoJnBsYW5lX3N0YXRlLT5iYXNlLnNy
YykgPj4gMTY7Ci0JCWludCBzcmNfaCA9IGRybV9yZWN0X2hlaWdodCgmcGxhbmVfc3RhdGUtPmJh
c2Uuc3JjKSA+PiAxNjsKKwkJaW50IHNyY193ID0gZHJtX3JlY3Rfd2lkdGgoJnBsYW5lX3N0YXRl
LT51YXBpLnNyYykgPj4gMTY7CisJCWludCBzcmNfaCA9IGRybV9yZWN0X2hlaWdodCgmcGxhbmVf
c3RhdGUtPnVhcGkuc3JjKSA+PiAxNjsKIAogCQlvZmZzZXQgKz0gKHNyY19oICogc3JjX3cgLSAx
KSAqIGZiLT5mb3JtYXQtPmNwcFswXTsKIAl9CkBAIC0xMDgzNSw3ICsxMDgzNSw3IEBAIHN0YXRp
YyBpbnQgaW50ZWxfY2hlY2tfY3Vyc29yKHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0
YXRlLAogCQlyZXR1cm4gLUVJTlZBTDsKIAl9CiAKLQlyZXQgPSBkcm1fYXRvbWljX2hlbHBlcl9j
aGVja19wbGFuZV9zdGF0ZSgmcGxhbmVfc3RhdGUtPmJhc2UsCisJcmV0ID0gZHJtX2F0b21pY19o
ZWxwZXJfY2hlY2tfcGxhbmVfc3RhdGUoJnBsYW5lX3N0YXRlLT51YXBpLAogCQkJCQkJICAmY3J0
Y19zdGF0ZS0+dWFwaSwKIAkJCQkJCSAgRFJNX1BMQU5FX0hFTFBFUl9OT19TQ0FMSU5HLAogCQkJ
CQkJICBEUk1fUExBTkVfSEVMUEVSX05PX1NDQUxJTkcsCkBAIC0xMDg0NCwxNCArMTA4NDQsMTQg
QEAgc3RhdGljIGludCBpbnRlbF9jaGVja19jdXJzb3Ioc3RydWN0IGludGVsX2NydGNfc3RhdGUg
KmNydGNfc3RhdGUsCiAJCXJldHVybiByZXQ7CiAKIAkvKiBVc2UgdGhlIHVuY2xpcHBlZCBzcmMv
ZHN0IHJlY3RhbmdsZXMsIHdoaWNoIHdlIHByb2dyYW0gdG8gaHcgKi8KLQlwbGFuZV9zdGF0ZS0+
YmFzZS5zcmMgPSBkcm1fcGxhbmVfc3RhdGVfc3JjKCZwbGFuZV9zdGF0ZS0+YmFzZSk7Ci0JcGxh
bmVfc3RhdGUtPmJhc2UuZHN0ID0gZHJtX3BsYW5lX3N0YXRlX2Rlc3QoJnBsYW5lX3N0YXRlLT5i
YXNlKTsKKwlwbGFuZV9zdGF0ZS0+dWFwaS5zcmMgPSBkcm1fcGxhbmVfc3RhdGVfc3JjKCZwbGFu
ZV9zdGF0ZS0+dWFwaSk7CisJcGxhbmVfc3RhdGUtPnVhcGkuZHN0ID0gZHJtX3BsYW5lX3N0YXRl
X2Rlc3QoJnBsYW5lX3N0YXRlLT51YXBpKTsKIAogCXJldCA9IGludGVsX2N1cnNvcl9jaGVja19z
dXJmYWNlKHBsYW5lX3N0YXRlKTsKIAlpZiAocmV0KQogCQlyZXR1cm4gcmV0OwogCi0JaWYgKCFw
bGFuZV9zdGF0ZS0+YmFzZS52aXNpYmxlKQorCWlmICghcGxhbmVfc3RhdGUtPnVhcGkudmlzaWJs
ZSkKIAkJcmV0dXJuIDA7CiAKIAlyZXQgPSBpbnRlbF9wbGFuZV9jaGVja19zcmNfY29vcmRpbmF0
ZXMocGxhbmVfc3RhdGUpOwpAQCAtMTA4ODksNyArMTA4ODksNyBAQCBzdGF0aWMgdTMyIGk4NDVf
Y3Vyc29yX2N0bChjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSwKIAog
c3RhdGljIGJvb2wgaTg0NV9jdXJzb3Jfc2l6ZV9vayhjb25zdCBzdHJ1Y3QgaW50ZWxfcGxhbmVf
c3RhdGUgKnBsYW5lX3N0YXRlKQogewotCWludCB3aWR0aCA9IGRybV9yZWN0X3dpZHRoKCZwbGFu
ZV9zdGF0ZS0+YmFzZS5kc3QpOworCWludCB3aWR0aCA9IGRybV9yZWN0X3dpZHRoKCZwbGFuZV9z
dGF0ZS0+dWFwaS5kc3QpOwogCiAJLyoKIAkgKiA4NDVnLzg2NWcgYXJlIG9ubHkgbGltaXRlZCBi
eSB0aGUgd2lkdGggb2YgdGhlaXIgY3Vyc29ycywKQEAgLTEwOTE1LDEyICsxMDkxNSwxMiBAQCBz
dGF0aWMgaW50IGk4NDVfY2hlY2tfY3Vyc29yKHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRj
X3N0YXRlLAogCS8qIENoZWNrIGZvciB3aGljaCBjdXJzb3IgdHlwZXMgd2Ugc3VwcG9ydCAqLwog
CWlmICghaTg0NV9jdXJzb3Jfc2l6ZV9vayhwbGFuZV9zdGF0ZSkpIHsKIAkJRFJNX0RFQlVHKCJD
dXJzb3IgZGltZW5zaW9uICVkeCVkIG5vdCBzdXBwb3J0ZWRcbiIsCi0JCQkgIGRybV9yZWN0X3dp
ZHRoKCZwbGFuZV9zdGF0ZS0+YmFzZS5kc3QpLAotCQkJICBkcm1fcmVjdF9oZWlnaHQoJnBsYW5l
X3N0YXRlLT5iYXNlLmRzdCkpOworCQkJICBkcm1fcmVjdF93aWR0aCgmcGxhbmVfc3RhdGUtPnVh
cGkuZHN0KSwKKwkJCSAgZHJtX3JlY3RfaGVpZ2h0KCZwbGFuZV9zdGF0ZS0+dWFwaS5kc3QpKTsK
IAkJcmV0dXJuIC1FSU5WQUw7CiAJfQogCi0JV0FSTl9PTihwbGFuZV9zdGF0ZS0+YmFzZS52aXNp
YmxlICYmCisJV0FSTl9PTihwbGFuZV9zdGF0ZS0+dWFwaS52aXNpYmxlICYmCiAJCXBsYW5lX3N0
YXRlLT5jb2xvcl9wbGFuZVswXS5zdHJpZGUgIT0gZmItPnBpdGNoZXNbMF0pOwogCiAJc3dpdGNo
IChmYi0+cGl0Y2hlc1swXSkgewpAQCAtMTA5NDgsOSArMTA5NDgsOSBAQCBzdGF0aWMgdm9pZCBp
ODQ1X3VwZGF0ZV9jdXJzb3Ioc3RydWN0IGludGVsX3BsYW5lICpwbGFuZSwKIAl1MzIgY250bCA9
IDAsIGJhc2UgPSAwLCBwb3MgPSAwLCBzaXplID0gMDsKIAl1bnNpZ25lZCBsb25nIGlycWZsYWdz
OwogCi0JaWYgKHBsYW5lX3N0YXRlICYmIHBsYW5lX3N0YXRlLT5iYXNlLnZpc2libGUpIHsKLQkJ
dW5zaWduZWQgaW50IHdpZHRoID0gZHJtX3JlY3Rfd2lkdGgoJnBsYW5lX3N0YXRlLT5iYXNlLmRz
dCk7Ci0JCXVuc2lnbmVkIGludCBoZWlnaHQgPSBkcm1fcmVjdF9oZWlnaHQoJnBsYW5lX3N0YXRl
LT5iYXNlLmRzdCk7CisJaWYgKHBsYW5lX3N0YXRlICYmIHBsYW5lX3N0YXRlLT51YXBpLnZpc2li
bGUpIHsKKwkJdW5zaWduZWQgaW50IHdpZHRoID0gZHJtX3JlY3Rfd2lkdGgoJnBsYW5lX3N0YXRl
LT51YXBpLmRzdCk7CisJCXVuc2lnbmVkIGludCBoZWlnaHQgPSBkcm1fcmVjdF9oZWlnaHQoJnBs
YW5lX3N0YXRlLT51YXBpLmRzdCk7CiAKIAkJY250bCA9IHBsYW5lX3N0YXRlLT5jdGwgfAogCQkJ
aTg0NV9jdXJzb3JfY3RsX2NydGMoY3J0Y19zdGF0ZSk7CkBAIC0xMTA0NiwxMyArMTEwNDYsMTMg
QEAgc3RhdGljIHUzMiBpOXh4X2N1cnNvcl9jdGwoY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3Rh
dGUgKmNydGNfc3RhdGUsCiAJCQkgICBjb25zdCBzdHJ1Y3QgaW50ZWxfcGxhbmVfc3RhdGUgKnBs
YW5lX3N0YXRlKQogewogCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9Ci0JCXRv
X2k5MTUocGxhbmVfc3RhdGUtPmJhc2UucGxhbmUtPmRldik7CisJCXRvX2k5MTUocGxhbmVfc3Rh
dGUtPnVhcGkucGxhbmUtPmRldik7CiAJdTMyIGNudGwgPSAwOwogCiAJaWYgKElTX0dFTihkZXZf
cHJpdiwgNikgfHwgSVNfSVZZQlJJREdFKGRldl9wcml2KSkKIAkJY250bCB8PSBNQ1VSU09SX1RS
SUNLTEVfRkVFRF9ESVNBQkxFOwogCi0Jc3dpdGNoIChkcm1fcmVjdF93aWR0aCgmcGxhbmVfc3Rh
dGUtPmJhc2UuZHN0KSkgeworCXN3aXRjaCAoZHJtX3JlY3Rfd2lkdGgoJnBsYW5lX3N0YXRlLT51
YXBpLmRzdCkpIHsKIAljYXNlIDY0OgogCQljbnRsIHw9IE1DVVJTT1JfTU9ERV82NF9BUkdCX0FY
OwogCQlicmVhazsKQEAgLTExMDYzLDcgKzExMDYzLDcgQEAgc3RhdGljIHUzMiBpOXh4X2N1cnNv
cl9jdGwoY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUsCiAJCWNudGwg
fD0gTUNVUlNPUl9NT0RFXzI1Nl9BUkdCX0FYOwogCQlicmVhazsKIAlkZWZhdWx0OgotCQlNSVNT
SU5HX0NBU0UoZHJtX3JlY3Rfd2lkdGgoJnBsYW5lX3N0YXRlLT5iYXNlLmRzdCkpOworCQlNSVNT
SU5HX0NBU0UoZHJtX3JlY3Rfd2lkdGgoJnBsYW5lX3N0YXRlLT51YXBpLmRzdCkpOwogCQlyZXR1
cm4gMDsKIAl9CiAKQEAgLTExMDc2LDkgKzExMDc2LDkgQEAgc3RhdGljIHUzMiBpOXh4X2N1cnNv
cl9jdGwoY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUsCiBzdGF0aWMg
Ym9vbCBpOXh4X2N1cnNvcl9zaXplX29rKGNvbnN0IHN0cnVjdCBpbnRlbF9wbGFuZV9zdGF0ZSAq
cGxhbmVfc3RhdGUpCiB7CiAJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0KLQkJ
dG9faTkxNShwbGFuZV9zdGF0ZS0+YmFzZS5wbGFuZS0+ZGV2KTsKLQlpbnQgd2lkdGggPSBkcm1f
cmVjdF93aWR0aCgmcGxhbmVfc3RhdGUtPmJhc2UuZHN0KTsKLQlpbnQgaGVpZ2h0ID0gZHJtX3Jl
Y3RfaGVpZ2h0KCZwbGFuZV9zdGF0ZS0+YmFzZS5kc3QpOworCQl0b19pOTE1KHBsYW5lX3N0YXRl
LT51YXBpLnBsYW5lLT5kZXYpOworCWludCB3aWR0aCA9IGRybV9yZWN0X3dpZHRoKCZwbGFuZV9z
dGF0ZS0+dWFwaS5kc3QpOworCWludCBoZWlnaHQgPSBkcm1fcmVjdF9oZWlnaHQoJnBsYW5lX3N0
YXRlLT51YXBpLmRzdCk7CiAKIAlpZiAoIWludGVsX2N1cnNvcl9zaXplX29rKHBsYW5lX3N0YXRl
KSkKIAkJcmV0dXJuIGZhbHNlOwpAQCAtMTExMTQsNyArMTExMTQsNyBAQCBzdGF0aWMgYm9vbCBp
OXh4X2N1cnNvcl9zaXplX29rKGNvbnN0IHN0cnVjdCBpbnRlbF9wbGFuZV9zdGF0ZSAqcGxhbmVf
c3RhdGUpCiBzdGF0aWMgaW50IGk5eHhfY2hlY2tfY3Vyc29yKHN0cnVjdCBpbnRlbF9jcnRjX3N0
YXRlICpjcnRjX3N0YXRlLAogCQkJICAgICBzdHJ1Y3QgaW50ZWxfcGxhbmVfc3RhdGUgKnBsYW5l
X3N0YXRlKQogewotCXN0cnVjdCBpbnRlbF9wbGFuZSAqcGxhbmUgPSB0b19pbnRlbF9wbGFuZShw
bGFuZV9zdGF0ZS0+YmFzZS5wbGFuZSk7CisJc3RydWN0IGludGVsX3BsYW5lICpwbGFuZSA9IHRv
X2ludGVsX3BsYW5lKHBsYW5lX3N0YXRlLT51YXBpLnBsYW5lKTsKIAlzdHJ1Y3QgZHJtX2k5MTVf
cHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KHBsYW5lLT5iYXNlLmRldik7CiAJY29uc3Qgc3Ry
dWN0IGRybV9mcmFtZWJ1ZmZlciAqZmIgPSBwbGFuZV9zdGF0ZS0+aHcuZmI7CiAJZW51bSBwaXBl
IHBpcGUgPSBwbGFuZS0+cGlwZTsKQEAgLTExMTMxLDE5ICsxMTEzMSwxOSBAQCBzdGF0aWMgaW50
IGk5eHhfY2hlY2tfY3Vyc29yKHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlLAog
CS8qIENoZWNrIGZvciB3aGljaCBjdXJzb3IgdHlwZXMgd2Ugc3VwcG9ydCAqLwogCWlmICghaTl4
eF9jdXJzb3Jfc2l6ZV9vayhwbGFuZV9zdGF0ZSkpIHsKIAkJRFJNX0RFQlVHKCJDdXJzb3IgZGlt
ZW5zaW9uICVkeCVkIG5vdCBzdXBwb3J0ZWRcbiIsCi0JCQkgIGRybV9yZWN0X3dpZHRoKCZwbGFu
ZV9zdGF0ZS0+YmFzZS5kc3QpLAotCQkJICBkcm1fcmVjdF9oZWlnaHQoJnBsYW5lX3N0YXRlLT5i
YXNlLmRzdCkpOworCQkJICBkcm1fcmVjdF93aWR0aCgmcGxhbmVfc3RhdGUtPnVhcGkuZHN0KSwK
KwkJCSAgZHJtX3JlY3RfaGVpZ2h0KCZwbGFuZV9zdGF0ZS0+dWFwaS5kc3QpKTsKIAkJcmV0dXJu
IC1FSU5WQUw7CiAJfQogCi0JV0FSTl9PTihwbGFuZV9zdGF0ZS0+YmFzZS52aXNpYmxlICYmCisJ
V0FSTl9PTihwbGFuZV9zdGF0ZS0+dWFwaS52aXNpYmxlICYmCiAJCXBsYW5lX3N0YXRlLT5jb2xv
cl9wbGFuZVswXS5zdHJpZGUgIT0gZmItPnBpdGNoZXNbMF0pOwogCiAJaWYgKGZiLT5waXRjaGVz
WzBdICE9Ci0JICAgIGRybV9yZWN0X3dpZHRoKCZwbGFuZV9zdGF0ZS0+YmFzZS5kc3QpICogZmIt
PmZvcm1hdC0+Y3BwWzBdKSB7CisJICAgIGRybV9yZWN0X3dpZHRoKCZwbGFuZV9zdGF0ZS0+dWFw
aS5kc3QpICogZmItPmZvcm1hdC0+Y3BwWzBdKSB7CiAJCURSTV9ERUJVR19LTVMoIkludmFsaWQg
Y3Vyc29yIHN0cmlkZSAoJXUpIChjdXJzb3Igd2lkdGggJWQpXG4iLAogCQkJICAgICAgZmItPnBp
dGNoZXNbMF0sCi0JCQkgICAgICBkcm1fcmVjdF93aWR0aCgmcGxhbmVfc3RhdGUtPmJhc2UuZHN0
KSk7CisJCQkgICAgICBkcm1fcmVjdF93aWR0aCgmcGxhbmVfc3RhdGUtPnVhcGkuZHN0KSk7CiAJ
CXJldHVybiAtRUlOVkFMOwogCX0KIApAQCAtMTExNTgsNyArMTExNTgsNyBAQCBzdGF0aWMgaW50
IGk5eHhfY2hlY2tfY3Vyc29yKHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlLAog
CSAqIFJlZnVzZSB0aGUgcHV0IHRoZSBjdXJzb3IgaW50byB0aGF0IGNvbXByb21pc2VkIHBvc2l0
aW9uLgogCSAqLwogCWlmIChJU19DSEVSUllWSUVXKGRldl9wcml2KSAmJiBwaXBlID09IFBJUEVf
QyAmJgotCSAgICBwbGFuZV9zdGF0ZS0+YmFzZS52aXNpYmxlICYmIHBsYW5lX3N0YXRlLT5iYXNl
LmRzdC54MSA8IDApIHsKKwkgICAgcGxhbmVfc3RhdGUtPnVhcGkudmlzaWJsZSAmJiBwbGFuZV9z
dGF0ZS0+dWFwaS5kc3QueDEgPCAwKSB7CiAJCURSTV9ERUJVR19LTVMoIkNIViBjdXJzb3IgQyBu
b3QgYWxsb3dlZCB0byBzdHJhZGRsZSB0aGUgbGVmdCBzY3JlZW4gZWRnZVxuIik7CiAJCXJldHVy
biAtRUlOVkFMOwogCX0KQEAgLTExMTc3LDkgKzExMTc3LDkgQEAgc3RhdGljIHZvaWQgaTl4eF91
cGRhdGVfY3Vyc29yKHN0cnVjdCBpbnRlbF9wbGFuZSAqcGxhbmUsCiAJdTMyIGNudGwgPSAwLCBi
YXNlID0gMCwgcG9zID0gMCwgZmJjX2N0bCA9IDA7CiAJdW5zaWduZWQgbG9uZyBpcnFmbGFnczsK
IAotCWlmIChwbGFuZV9zdGF0ZSAmJiBwbGFuZV9zdGF0ZS0+YmFzZS52aXNpYmxlKSB7Ci0JCXVu
c2lnbmVkIHdpZHRoID0gZHJtX3JlY3Rfd2lkdGgoJnBsYW5lX3N0YXRlLT5iYXNlLmRzdCk7Ci0J
CXVuc2lnbmVkIGhlaWdodCA9IGRybV9yZWN0X2hlaWdodCgmcGxhbmVfc3RhdGUtPmJhc2UuZHN0
KTsKKwlpZiAocGxhbmVfc3RhdGUgJiYgcGxhbmVfc3RhdGUtPnVhcGkudmlzaWJsZSkgeworCQl1
bnNpZ25lZCB3aWR0aCA9IGRybV9yZWN0X3dpZHRoKCZwbGFuZV9zdGF0ZS0+dWFwaS5kc3QpOwor
CQl1bnNpZ25lZCBoZWlnaHQgPSBkcm1fcmVjdF9oZWlnaHQoJnBsYW5lX3N0YXRlLT51YXBpLmRz
dCk7CiAKIAkJY250bCA9IHBsYW5lX3N0YXRlLT5jdGwgfAogCQkJaTl4eF9jdXJzb3JfY3RsX2Ny
dGMoY3J0Y19zdGF0ZSk7CkBAIC0xMTcxNyw3ICsxMTcxNyw3IEBAIHN0YXRpYyBib29sIGludGVs
X3dtX25lZWRfdXBkYXRlKGNvbnN0IHN0cnVjdCBpbnRlbF9wbGFuZV9zdGF0ZSAqY3VyLAogCQkJ
CSBzdHJ1Y3QgaW50ZWxfcGxhbmVfc3RhdGUgKm5ldykKIHsKIAkvKiBVcGRhdGUgd2F0ZXJtYXJr
cyBvbiB0aWxpbmcgb3Igc2l6ZSBjaGFuZ2VzLiAqLwotCWlmIChuZXctPmJhc2UudmlzaWJsZSAh
PSBjdXItPmJhc2UudmlzaWJsZSkKKwlpZiAobmV3LT51YXBpLnZpc2libGUgIT0gY3VyLT51YXBp
LnZpc2libGUpCiAJCXJldHVybiB0cnVlOwogCiAJaWYgKCFjdXItPmh3LmZiIHx8ICFuZXctPmh3
LmZiKQpAQCAtMTE3MjUsMTAgKzExNzI1LDEwIEBAIHN0YXRpYyBib29sIGludGVsX3dtX25lZWRf
dXBkYXRlKGNvbnN0IHN0cnVjdCBpbnRlbF9wbGFuZV9zdGF0ZSAqY3VyLAogCiAJaWYgKGN1ci0+
aHcuZmItPm1vZGlmaWVyICE9IG5ldy0+aHcuZmItPm1vZGlmaWVyIHx8CiAJICAgIGN1ci0+aHcu
cm90YXRpb24gIT0gbmV3LT5ody5yb3RhdGlvbiB8fAotCSAgICBkcm1fcmVjdF93aWR0aCgmbmV3
LT5iYXNlLnNyYykgIT0gZHJtX3JlY3Rfd2lkdGgoJmN1ci0+YmFzZS5zcmMpIHx8Ci0JICAgIGRy
bV9yZWN0X2hlaWdodCgmbmV3LT5iYXNlLnNyYykgIT0gZHJtX3JlY3RfaGVpZ2h0KCZjdXItPmJh
c2Uuc3JjKSB8fAotCSAgICBkcm1fcmVjdF93aWR0aCgmbmV3LT5iYXNlLmRzdCkgIT0gZHJtX3Jl
Y3Rfd2lkdGgoJmN1ci0+YmFzZS5kc3QpIHx8Ci0JICAgIGRybV9yZWN0X2hlaWdodCgmbmV3LT5i
YXNlLmRzdCkgIT0gZHJtX3JlY3RfaGVpZ2h0KCZjdXItPmJhc2UuZHN0KSkKKwkgICAgZHJtX3Jl
Y3Rfd2lkdGgoJm5ldy0+dWFwaS5zcmMpICE9IGRybV9yZWN0X3dpZHRoKCZjdXItPnVhcGkuc3Jj
KSB8fAorCSAgICBkcm1fcmVjdF9oZWlnaHQoJm5ldy0+dWFwaS5zcmMpICE9IGRybV9yZWN0X2hl
aWdodCgmY3VyLT51YXBpLnNyYykgfHwKKwkgICAgZHJtX3JlY3Rfd2lkdGgoJm5ldy0+dWFwaS5k
c3QpICE9IGRybV9yZWN0X3dpZHRoKCZjdXItPnVhcGkuZHN0KSB8fAorCSAgICBkcm1fcmVjdF9o
ZWlnaHQoJm5ldy0+dWFwaS5kc3QpICE9IGRybV9yZWN0X2hlaWdodCgmY3VyLT51YXBpLmRzdCkp
CiAJCXJldHVybiB0cnVlOwogCiAJcmV0dXJuIGZhbHNlOwpAQCAtMTE3MzYsMTAgKzExNzM2LDEw
IEBAIHN0YXRpYyBib29sIGludGVsX3dtX25lZWRfdXBkYXRlKGNvbnN0IHN0cnVjdCBpbnRlbF9w
bGFuZV9zdGF0ZSAqY3VyLAogCiBzdGF0aWMgYm9vbCBuZWVkc19zY2FsaW5nKGNvbnN0IHN0cnVj
dCBpbnRlbF9wbGFuZV9zdGF0ZSAqc3RhdGUpCiB7Ci0JaW50IHNyY193ID0gZHJtX3JlY3Rfd2lk
dGgoJnN0YXRlLT5iYXNlLnNyYykgPj4gMTY7Ci0JaW50IHNyY19oID0gZHJtX3JlY3RfaGVpZ2h0
KCZzdGF0ZS0+YmFzZS5zcmMpID4+IDE2OwotCWludCBkc3RfdyA9IGRybV9yZWN0X3dpZHRoKCZz
dGF0ZS0+YmFzZS5kc3QpOwotCWludCBkc3RfaCA9IGRybV9yZWN0X2hlaWdodCgmc3RhdGUtPmJh
c2UuZHN0KTsKKwlpbnQgc3JjX3cgPSBkcm1fcmVjdF93aWR0aCgmc3RhdGUtPnVhcGkuc3JjKSA+
PiAxNjsKKwlpbnQgc3JjX2ggPSBkcm1fcmVjdF9oZWlnaHQoJnN0YXRlLT51YXBpLnNyYykgPj4g
MTY7CisJaW50IGRzdF93ID0gZHJtX3JlY3Rfd2lkdGgoJnN0YXRlLT51YXBpLmRzdCk7CisJaW50
IGRzdF9oID0gZHJtX3JlY3RfaGVpZ2h0KCZzdGF0ZS0+dWFwaS5kc3QpOwogCiAJcmV0dXJuIChz
cmNfdyAhPSBkc3RfdyB8fCBzcmNfaCAhPSBkc3RfaCk7CiB9CkBAIC0xMTc1MCw3ICsxMTc1MCw3
IEBAIGludCBpbnRlbF9wbGFuZV9hdG9taWNfY2FsY19jaGFuZ2VzKGNvbnN0IHN0cnVjdCBpbnRl
bF9jcnRjX3N0YXRlICpvbGRfY3J0Y19zdGF0CiAJCQkJICAgIHN0cnVjdCBpbnRlbF9wbGFuZV9z
dGF0ZSAqcGxhbmVfc3RhdGUpCiB7CiAJc3RydWN0IGludGVsX2NydGMgKmNydGMgPSB0b19pbnRl
bF9jcnRjKGNydGNfc3RhdGUtPnVhcGkuY3J0Yyk7Ci0Jc3RydWN0IGludGVsX3BsYW5lICpwbGFu
ZSA9IHRvX2ludGVsX3BsYW5lKHBsYW5lX3N0YXRlLT5iYXNlLnBsYW5lKTsKKwlzdHJ1Y3QgaW50
ZWxfcGxhbmUgKnBsYW5lID0gdG9faW50ZWxfcGxhbmUocGxhbmVfc3RhdGUtPnVhcGkucGxhbmUp
OwogCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoY3J0Yy0+YmFz
ZS5kZXYpOwogCWJvb2wgbW9kZV9jaGFuZ2VkID0gbmVlZHNfbW9kZXNldChjcnRjX3N0YXRlKTsK
IAlib29sIHdhc19jcnRjX2VuYWJsZWQgPSBvbGRfY3J0Y19zdGF0ZS0+aHcuYWN0aXZlOwpAQCAt
MTE3NjQsOCArMTE3NjQsOCBAQCBpbnQgaW50ZWxfcGxhbmVfYXRvbWljX2NhbGNfY2hhbmdlcyhj
b25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqb2xkX2NydGNfc3RhdAogCQkJcmV0dXJuIHJl
dDsKIAl9CiAKLQl3YXNfdmlzaWJsZSA9IG9sZF9wbGFuZV9zdGF0ZS0+YmFzZS52aXNpYmxlOwot
CXZpc2libGUgPSBwbGFuZV9zdGF0ZS0+YmFzZS52aXNpYmxlOworCXdhc192aXNpYmxlID0gb2xk
X3BsYW5lX3N0YXRlLT51YXBpLnZpc2libGU7CisJdmlzaWJsZSA9IHBsYW5lX3N0YXRlLT51YXBp
LnZpc2libGU7CiAKIAlpZiAoIXdhc19jcnRjX2VuYWJsZWQgJiYgV0FSTl9PTih3YXNfdmlzaWJs
ZSkpCiAJCXdhc192aXNpYmxlID0gZmFsc2U7CkBAIC0xMTc4MSw3ICsxMTc4MSw3IEBAIGludCBp
bnRlbF9wbGFuZV9hdG9taWNfY2FsY19jaGFuZ2VzKGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0
YXRlICpvbGRfY3J0Y19zdGF0CiAJICogb25seSBjb21iaW5lIHRoZSByZXN1bHRzIGZyb20gYWxs
IHBsYW5lcyBpbiB0aGUgY3VycmVudCBwbGFjZT8KIAkgKi8KIAlpZiAoIWlzX2NydGNfZW5hYmxl
ZCkgewotCQlwbGFuZV9zdGF0ZS0+YmFzZS52aXNpYmxlID0gdmlzaWJsZSA9IGZhbHNlOworCQlw
bGFuZV9zdGF0ZS0+dWFwaS52aXNpYmxlID0gdmlzaWJsZSA9IGZhbHNlOwogCQljcnRjX3N0YXRl
LT5hY3RpdmVfcGxhbmVzICY9IH5CSVQocGxhbmUtPmlkKTsKIAkJY3J0Y19zdGF0ZS0+ZGF0YV9y
YXRlW3BsYW5lLT5pZF0gPSAwOwogCQljcnRjX3N0YXRlLT5taW5fY2RjbGtbcGxhbmUtPmlkXSA9
IDA7CkBAIC0xMTk0MSw3ICsxMTk0MSw3IEBAIHN0YXRpYyBpbnQgaWNsX2NoZWNrX252MTJfcGxh
bmVzKHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlKQogCQkJY29udGludWU7CiAK
IAkJcGxhbmVfc3RhdGUtPnBsYW5hcl9saW5rZWRfcGxhbmUgPSBOVUxMOwotCQlpZiAocGxhbmVf
c3RhdGUtPnBsYW5hcl9zbGF2ZSAmJiAhcGxhbmVfc3RhdGUtPmJhc2UudmlzaWJsZSkgeworCQlp
ZiAocGxhbmVfc3RhdGUtPnBsYW5hcl9zbGF2ZSAmJiAhcGxhbmVfc3RhdGUtPnVhcGkudmlzaWJs
ZSkgewogCQkJY3J0Y19zdGF0ZS0+YWN0aXZlX3BsYW5lcyAmPSB+QklUKHBsYW5lLT5pZCk7CiAJ
CQljcnRjX3N0YXRlLT51cGRhdGVfcGxhbmVzIHw9IEJJVChwbGFuZS0+aWQpOwogCQl9CkBAIC0x
MjM1NSwxNCArMTIzNTUsMTQgQEAgc3RhdGljIGNvbnN0IGNoYXIgKm91dHB1dF9mb3JtYXRzKGVu
dW0gaW50ZWxfb3V0cHV0X2Zvcm1hdCBmb3JtYXQpCiAKIHN0YXRpYyB2b2lkIGludGVsX2R1bXBf
cGxhbmVfc3RhdGUoY29uc3Qgc3RydWN0IGludGVsX3BsYW5lX3N0YXRlICpwbGFuZV9zdGF0ZSkK
IHsKLQlzdHJ1Y3QgaW50ZWxfcGxhbmUgKnBsYW5lID0gdG9faW50ZWxfcGxhbmUocGxhbmVfc3Rh
dGUtPmJhc2UucGxhbmUpOworCXN0cnVjdCBpbnRlbF9wbGFuZSAqcGxhbmUgPSB0b19pbnRlbF9w
bGFuZShwbGFuZV9zdGF0ZS0+dWFwaS5wbGFuZSk7CiAJY29uc3Qgc3RydWN0IGRybV9mcmFtZWJ1
ZmZlciAqZmIgPSBwbGFuZV9zdGF0ZS0+aHcuZmI7CiAJc3RydWN0IGRybV9mb3JtYXRfbmFtZV9i
dWYgZm9ybWF0X25hbWU7CiAKIAlpZiAoIWZiKSB7CiAJCURSTV9ERUJVR19LTVMoIltQTEFORTol
ZDolc10gZmI6IFtOT0ZCXSwgdmlzaWJsZTogJXNcbiIsCiAJCQkgICAgICBwbGFuZS0+YmFzZS5i
YXNlLmlkLCBwbGFuZS0+YmFzZS5uYW1lLAotCQkJICAgICAgeWVzbm8ocGxhbmVfc3RhdGUtPmJh
c2UudmlzaWJsZSkpOworCQkJICAgICAgeWVzbm8ocGxhbmVfc3RhdGUtPnVhcGkudmlzaWJsZSkp
OwogCQlyZXR1cm47CiAJfQogCkBAIC0xMjM3MCwxMyArMTIzNzAsMTMgQEAgc3RhdGljIHZvaWQg
aW50ZWxfZHVtcF9wbGFuZV9zdGF0ZShjb25zdCBzdHJ1Y3QgaW50ZWxfcGxhbmVfc3RhdGUgKnBs
YW5lX3N0YXRlKQogCQkgICAgICBwbGFuZS0+YmFzZS5iYXNlLmlkLCBwbGFuZS0+YmFzZS5uYW1l
LAogCQkgICAgICBmYi0+YmFzZS5pZCwgZmItPndpZHRoLCBmYi0+aGVpZ2h0LAogCQkgICAgICBk
cm1fZ2V0X2Zvcm1hdF9uYW1lKGZiLT5mb3JtYXQtPmZvcm1hdCwgJmZvcm1hdF9uYW1lKSwKLQkJ
ICAgICAgeWVzbm8ocGxhbmVfc3RhdGUtPmJhc2UudmlzaWJsZSkpOworCQkgICAgICB5ZXNubyhw
bGFuZV9zdGF0ZS0+dWFwaS52aXNpYmxlKSk7CiAJRFJNX0RFQlVHX0tNUygiXHRyb3RhdGlvbjog
MHgleCwgc2NhbGVyOiAlZFxuIiwKIAkJICAgICAgcGxhbmVfc3RhdGUtPmh3LnJvdGF0aW9uLCBw
bGFuZV9zdGF0ZS0+c2NhbGVyX2lkKTsKLQlpZiAocGxhbmVfc3RhdGUtPmJhc2UudmlzaWJsZSkK
KwlpZiAocGxhbmVfc3RhdGUtPnVhcGkudmlzaWJsZSkKIAkJRFJNX0RFQlVHX0tNUygiXHRzcmM6
ICIgRFJNX1JFQ1RfRlBfRk1UICIgZHN0OiAiIERSTV9SRUNUX0ZNVCAiXG4iLAotCQkJICAgICAg
RFJNX1JFQ1RfRlBfQVJHKCZwbGFuZV9zdGF0ZS0+YmFzZS5zcmMpLAotCQkJICAgICAgRFJNX1JF
Q1RfQVJHKCZwbGFuZV9zdGF0ZS0+YmFzZS5kc3QpKTsKKwkJCSAgICAgIERSTV9SRUNUX0ZQX0FS
RygmcGxhbmVfc3RhdGUtPnVhcGkuc3JjKSwKKwkJCSAgICAgIERSTV9SRUNUX0FSRygmcGxhbmVf
c3RhdGUtPnVhcGkuZHN0KSk7CiB9CiAKIHN0YXRpYyB2b2lkIGludGVsX2R1bXBfcGlwZV9jb25m
aWcoY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKnBpcGVfY29uZmlnLApAQCAtMTM1ODAs
NyArMTM1ODAsNyBAQCBpbnRlbF92ZXJpZnlfcGxhbmVzKHN0cnVjdCBpbnRlbF9hdG9taWNfc3Rh
dGUgKnN0YXRlKQogCWZvcl9lYWNoX25ld19pbnRlbF9wbGFuZV9pbl9zdGF0ZShzdGF0ZSwgcGxh
bmUsCiAJCQkJCSAgcGxhbmVfc3RhdGUsIGkpCiAJCWFzc2VydF9wbGFuZShwbGFuZSwgcGxhbmVf
c3RhdGUtPnBsYW5hcl9zbGF2ZSB8fAotCQkJICAgICBwbGFuZV9zdGF0ZS0+YmFzZS52aXNpYmxl
KTsKKwkJCSAgICAgcGxhbmVfc3RhdGUtPnVhcGkudmlzaWJsZSk7CiB9CiAKIHN0YXRpYyB2b2lk
CkBAIC0xNTA0Miw3ICsxNTA0Miw3IEBAIHN0YXRpYyB2b2lkIGFkZF9ycHNfYm9vc3RfYWZ0ZXJf
dmJsYW5rKHN0cnVjdCBkcm1fY3J0YyAqY3J0YywKIAogc3RhdGljIGludCBpbnRlbF9wbGFuZV9w
aW5fZmIoc3RydWN0IGludGVsX3BsYW5lX3N0YXRlICpwbGFuZV9zdGF0ZSkKIHsKLQlzdHJ1Y3Qg
aW50ZWxfcGxhbmUgKnBsYW5lID0gdG9faW50ZWxfcGxhbmUocGxhbmVfc3RhdGUtPmJhc2UucGxh
bmUpOworCXN0cnVjdCBpbnRlbF9wbGFuZSAqcGxhbmUgPSB0b19pbnRlbF9wbGFuZShwbGFuZV9z
dGF0ZS0+dWFwaS5wbGFuZSk7CiAJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0g
dG9faTkxNShwbGFuZS0+YmFzZS5kZXYpOwogCXN0cnVjdCBkcm1fZnJhbWVidWZmZXIgKmZiID0g
cGxhbmVfc3RhdGUtPmh3LmZiOwogCXN0cnVjdCBpOTE1X3ZtYSAqdm1hOwpAQCAtMTUxMDcsNyAr
MTUxMDcsNyBAQCBpbnRlbF9wcmVwYXJlX3BsYW5lX2ZiKHN0cnVjdCBkcm1fcGxhbmUgKnBsYW5l
LAogCXN0cnVjdCBpbnRlbF9wbGFuZV9zdGF0ZSAqbmV3X3BsYW5lX3N0YXRlID0KIAkJdG9faW50
ZWxfcGxhbmVfc3RhdGUoX25ld19wbGFuZV9zdGF0ZSk7CiAJc3RydWN0IGludGVsX2F0b21pY19z
dGF0ZSAqaW50ZWxfc3RhdGUgPQotCQl0b19pbnRlbF9hdG9taWNfc3RhdGUobmV3X3BsYW5lX3N0
YXRlLT5iYXNlLnN0YXRlKTsKKwkJdG9faW50ZWxfYXRvbWljX3N0YXRlKG5ld19wbGFuZV9zdGF0
ZS0+dWFwaS5zdGF0ZSk7CiAJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9f
aTkxNShwbGFuZS0+ZGV2KTsKIAlzdHJ1Y3QgZHJtX2ZyYW1lYnVmZmVyICpmYiA9IG5ld19wbGFu
ZV9zdGF0ZS0+aHcuZmI7CiAJc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iaiA9IGludGVs
X2ZiX29iaihmYik7CkBAIC0xNTE0MCw5ICsxNTE0MCw5IEBAIGludGVsX3ByZXBhcmVfcGxhbmVf
ZmIoc3RydWN0IGRybV9wbGFuZSAqcGxhbmUsCiAJCX0KIAl9CiAKLQlpZiAobmV3X3BsYW5lX3N0
YXRlLT5iYXNlLmZlbmNlKSB7IC8qIGV4cGxpY2l0IGZlbmNpbmcgKi8KKwlpZiAobmV3X3BsYW5l
X3N0YXRlLT51YXBpLmZlbmNlKSB7IC8qIGV4cGxpY2l0IGZlbmNpbmcgKi8KIAkJcmV0ID0gaTkx
NV9zd19mZW5jZV9hd2FpdF9kbWFfZmVuY2UoJmludGVsX3N0YXRlLT5jb21taXRfcmVhZHksCi0J
CQkJCQkgICAgbmV3X3BsYW5lX3N0YXRlLT5iYXNlLmZlbmNlLAorCQkJCQkJICAgIG5ld19wbGFu
ZV9zdGF0ZS0+dWFwaS5mZW5jZSwKIAkJCQkJCSAgICBJOTE1X0ZFTkNFX1RJTUVPVVQsCiAJCQkJ
CQkgICAgR0ZQX0tFUk5FTCk7CiAJCWlmIChyZXQgPCAwKQpAQCAtMTUxNjUsNyArMTUxNjUsNyBA
QCBpbnRlbF9wcmVwYXJlX3BsYW5lX2ZiKHN0cnVjdCBkcm1fcGxhbmUgKnBsYW5lLAogCWZiX29i
al9idW1wX3JlbmRlcl9wcmlvcml0eShvYmopOwogCWludGVsX2Zyb250YnVmZmVyX2ZsdXNoKG9i
ai0+ZnJvbnRidWZmZXIsIE9SSUdJTl9ESVJUWUZCKTsKIAotCWlmICghbmV3X3BsYW5lX3N0YXRl
LT5iYXNlLmZlbmNlKSB7IC8qIGltcGxpY2l0IGZlbmNpbmcgKi8KKwlpZiAoIW5ld19wbGFuZV9z
dGF0ZS0+dWFwaS5mZW5jZSkgeyAvKiBpbXBsaWNpdCBmZW5jaW5nICovCiAJCXN0cnVjdCBkbWFf
ZmVuY2UgKmZlbmNlOwogCiAJCXJldCA9IGk5MTVfc3dfZmVuY2VfYXdhaXRfcmVzZXJ2YXRpb24o
JmludGVsX3N0YXRlLT5jb21taXRfcmVhZHksCkBAIC0xNTE4Myw3ICsxNTE4Myw3IEBAIGludGVs
X3ByZXBhcmVfcGxhbmVfZmIoc3RydWN0IGRybV9wbGFuZSAqcGxhbmUsCiAJCX0KIAl9IGVsc2Ug
ewogCQlhZGRfcnBzX2Jvb3N0X2FmdGVyX3ZibGFuayhuZXdfcGxhbmVfc3RhdGUtPmh3LmNydGMs
Ci0JCQkJCSAgIG5ld19wbGFuZV9zdGF0ZS0+YmFzZS5mZW5jZSk7CisJCQkJCSAgIG5ld19wbGFu
ZV9zdGF0ZS0+dWFwaS5mZW5jZSk7CiAJfQogCiAJLyoKQEAgLTE1MjE2LDcgKzE1MjE2LDcgQEAg
aW50ZWxfY2xlYW51cF9wbGFuZV9mYihzdHJ1Y3QgZHJtX3BsYW5lICpwbGFuZSwKIAlzdHJ1Y3Qg
aW50ZWxfcGxhbmVfc3RhdGUgKm9sZF9wbGFuZV9zdGF0ZSA9CiAJCXRvX2ludGVsX3BsYW5lX3N0
YXRlKF9vbGRfcGxhbmVfc3RhdGUpOwogCXN0cnVjdCBpbnRlbF9hdG9taWNfc3RhdGUgKmludGVs
X3N0YXRlID0KLQkJdG9faW50ZWxfYXRvbWljX3N0YXRlKG9sZF9wbGFuZV9zdGF0ZS0+YmFzZS5z
dGF0ZSk7CisJCXRvX2ludGVsX2F0b21pY19zdGF0ZShvbGRfcGxhbmVfc3RhdGUtPnVhcGkuc3Rh
dGUpOwogCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUocGxhbmUt
PmRldik7CiAKIAlpZiAoaW50ZWxfc3RhdGUtPnJwc19pbnRlcmFjdGl2ZSkgewpAQCAtMTUzNDgs
OCArMTUzNDgsOCBAQCBpbnRlbF9sZWdhY3lfY3Vyc29yX3VwZGF0ZShzdHJ1Y3QgZHJtX3BsYW5l
ICpfcGxhbmUsCiAJICogdGhlIHBsYW5lLiAgVGhpcyBwcmV2ZW50cyBvdXIgYXN5bmMgdXBkYXRl
J3MgY2hhbmdlcyBmcm9tIGdldHRpbmcKIAkgKiBvdmVycmlkZGVuIGJ5IGEgcHJldmlvdXMgc3lu
Y2hyb25vdXMgdXBkYXRlJ3Mgc3RhdGUuCiAJICovCi0JaWYgKG9sZF9wbGFuZV9zdGF0ZS0+YmFz
ZS5jb21taXQgJiYKLQkgICAgIXRyeV93YWl0X2Zvcl9jb21wbGV0aW9uKCZvbGRfcGxhbmVfc3Rh
dGUtPmJhc2UuY29tbWl0LT5od19kb25lKSkKKwlpZiAob2xkX3BsYW5lX3N0YXRlLT51YXBpLmNv
bW1pdCAmJgorCSAgICAhdHJ5X3dhaXRfZm9yX2NvbXBsZXRpb24oJm9sZF9wbGFuZV9zdGF0ZS0+
dWFwaS5jb21taXQtPmh3X2RvbmUpKQogCQlnb3RvIHNsb3c7CiAKIAkvKgpAQCAtMTcxNTUsNyAr
MTcxNTUsNyBAQCBzdGF0aWMgdm9pZCBpbnRlbF9zYW5pdGl6ZV9jcnRjKHN0cnVjdCBpbnRlbF9j
cnRjICpjcnRjLAogCQkJY29uc3Qgc3RydWN0IGludGVsX3BsYW5lX3N0YXRlICpwbGFuZV9zdGF0
ZSA9CiAJCQkJdG9faW50ZWxfcGxhbmVfc3RhdGUocGxhbmUtPmJhc2Uuc3RhdGUpOwogCi0JCQlp
ZiAocGxhbmVfc3RhdGUtPmJhc2UudmlzaWJsZSAmJgorCQkJaWYgKHBsYW5lX3N0YXRlLT51YXBp
LnZpc2libGUgJiYKIAkJCSAgICBwbGFuZS0+YmFzZS50eXBlICE9IERSTV9QTEFORV9UWVBFX1BS
SU1BUlkpCiAJCQkJaW50ZWxfcGxhbmVfZGlzYWJsZV9ub2F0b21pYyhjcnRjLCBwbGFuZSk7CiAJ
CX0KQEAgLTE3NDg2LDE0ICsxNzQ4NiwxNCBAQCBzdGF0aWMgdm9pZCBpbnRlbF9tb2Rlc2V0X3Jl
YWRvdXRfaHdfc3RhdGUoc3RydWN0IGRybV9kZXZpY2UgKmRldikKIAkJCSAqIEZJWE1FIGRvbid0
IGhhdmUgdGhlIGZiIHlldCwgc28gY2FuJ3QKIAkJCSAqIHVzZSBpbnRlbF9wbGFuZV9kYXRhX3Jh
dGUoKSA6KAogCQkJICovCi0JCQlpZiAocGxhbmVfc3RhdGUtPmJhc2UudmlzaWJsZSkKKwkJCWlm
IChwbGFuZV9zdGF0ZS0+dWFwaS52aXNpYmxlKQogCQkJCWNydGNfc3RhdGUtPmRhdGFfcmF0ZVtw
bGFuZS0+aWRdID0KIAkJCQkJNCAqIGNydGNfc3RhdGUtPnBpeGVsX3JhdGU7CiAJCQkvKgogCQkJ
ICogRklYTUUgZG9uJ3QgaGF2ZSB0aGUgZmIgeWV0LCBzbyBjYW4ndAogCQkJICogdXNlIHBsYW5l
LT5taW5fY2RjbGsoKSA6KAogCQkJICovCi0JCQlpZiAocGxhbmVfc3RhdGUtPmJhc2UudmlzaWJs
ZSAmJiBwbGFuZS0+bWluX2NkY2xrKSB7CisJCQlpZiAocGxhbmVfc3RhdGUtPnVhcGkudmlzaWJs
ZSAmJiBwbGFuZS0+bWluX2NkY2xrKSB7CiAJCQkJaWYgKGNydGNfc3RhdGUtPmRvdWJsZV93aWRl
IHx8CiAJCQkJICAgIElOVEVMX0dFTihkZXZfcHJpdikgPj0gMTAgfHwgSVNfR0VNSU5JTEFLRShk
ZXZfcHJpdikpCiAJCQkJCWNydGNfc3RhdGUtPm1pbl9jZGNsa1twbGFuZS0+aWRdID0KZGlmZiAt
LWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZmJjLmMgYi9kcml2ZXJz
L2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2ZiYy5jCmluZGV4IDNlYThkMDEwZGI2Yy4uOTJj
N2ViMjQzNTU5IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVs
X2ZiYy5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZmJjLmMKQEAg
LTQzMCw3ICs0MzAsNyBAQCBzdGF0aWMgYm9vbCBtdWx0aXBsZV9waXBlc19vayhzdHJ1Y3QgaW50
ZWxfY3J0YyAqY3J0YywKIAlpZiAoIW5vX2ZiY19vbl9tdWx0aXBsZV9waXBlcyhkZXZfcHJpdikp
CiAJCXJldHVybiB0cnVlOwogCi0JaWYgKHBsYW5lX3N0YXRlLT5iYXNlLnZpc2libGUpCisJaWYg
KHBsYW5lX3N0YXRlLT51YXBpLnZpc2libGUpCiAJCWZiYy0+dmlzaWJsZV9waXBlc19tYXNrIHw9
ICgxIDw8IHBpcGUpOwogCWVsc2UKIAkJZmJjLT52aXNpYmxlX3BpcGVzX21hc2sgJj0gfigxIDw8
IHBpcGUpOwpAQCAtNjc3LDEyICs2NzcsMTIgQEAgc3RhdGljIHZvaWQgaW50ZWxfZmJjX3VwZGF0
ZV9zdGF0ZV9jYWNoZShzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YywKIAkgKiB0aGUgOTAvMjcwIGRl
Z3JlZSBwbGFuZSByb3RhdGlvbiBjYXNlcyAodG8gbWF0Y2ggdGhlCiAJICogR1RUIG1hcHBpbmcp
LCBoZW5jZSBubyBuZWVkIHRvIGFjY291bnQgZm9yIHJvdGF0aW9uIGhlcmUuCiAJICovCi0JY2Fj
aGUtPnBsYW5lLnNyY193ID0gZHJtX3JlY3Rfd2lkdGgoJnBsYW5lX3N0YXRlLT5iYXNlLnNyYykg
Pj4gMTY7Ci0JY2FjaGUtPnBsYW5lLnNyY19oID0gZHJtX3JlY3RfaGVpZ2h0KCZwbGFuZV9zdGF0
ZS0+YmFzZS5zcmMpID4+IDE2OwotCWNhY2hlLT5wbGFuZS52aXNpYmxlID0gcGxhbmVfc3RhdGUt
PmJhc2UudmlzaWJsZTsKKwljYWNoZS0+cGxhbmUuc3JjX3cgPSBkcm1fcmVjdF93aWR0aCgmcGxh
bmVfc3RhdGUtPnVhcGkuc3JjKSA+PiAxNjsKKwljYWNoZS0+cGxhbmUuc3JjX2ggPSBkcm1fcmVj
dF9oZWlnaHQoJnBsYW5lX3N0YXRlLT51YXBpLnNyYykgPj4gMTY7CisJY2FjaGUtPnBsYW5lLnZp
c2libGUgPSBwbGFuZV9zdGF0ZS0+dWFwaS52aXNpYmxlOwogCWNhY2hlLT5wbGFuZS5hZGp1c3Rl
ZF94ID0gcGxhbmVfc3RhdGUtPmNvbG9yX3BsYW5lWzBdLng7CiAJY2FjaGUtPnBsYW5lLmFkanVz
dGVkX3kgPSBwbGFuZV9zdGF0ZS0+Y29sb3JfcGxhbmVbMF0ueTsKLQljYWNoZS0+cGxhbmUueSA9
IHBsYW5lX3N0YXRlLT5iYXNlLnNyYy55MSA+PiAxNjsKKwljYWNoZS0+cGxhbmUueSA9IHBsYW5l
X3N0YXRlLT51YXBpLnNyYy55MSA+PiAxNjsKIAogCWNhY2hlLT5wbGFuZS5waXhlbF9ibGVuZF9t
b2RlID0gcGxhbmVfc3RhdGUtPmh3LnBpeGVsX2JsZW5kX21vZGU7CiAKQEAgLTEwNTIsNyArMTA1
Miw3IEBAIHZvaWQgaW50ZWxfZmJjX2Nob29zZV9jcnRjKHN0cnVjdCBkcm1faTkxNV9wcml2YXRl
ICpkZXZfcHJpdiwKIAkJaWYgKCFwbGFuZS0+aGFzX2ZiYykKIAkJCWNvbnRpbnVlOwogCi0JCWlm
ICghcGxhbmVfc3RhdGUtPmJhc2UudmlzaWJsZSkKKwkJaWYgKCFwbGFuZV9zdGF0ZS0+dWFwaS52
aXNpYmxlKQogCQkJY29udGludWU7CiAKIAkJY3J0Y19zdGF0ZSA9IGludGVsX2F0b21pY19nZXRf
bmV3X2NydGNfc3RhdGUoc3RhdGUsIGNydGMpOwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJt
L2k5MTUvZGlzcGxheS9pbnRlbF9vdmVybGF5LmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNw
bGF5L2ludGVsX292ZXJsYXkuYwppbmRleCA0NmUzZDZjZjU5NzYuLjhjZmI3ODVlNzYxYyAxMDA2
NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9vdmVybGF5LmMKKysr
IGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9vdmVybGF5LmMKQEAgLTY2OCw3
ICs2NjgsNyBAQCBzdGF0aWMgdm9pZCB1cGRhdGVfY29sb3JrZXkoc3RydWN0IGludGVsX292ZXJs
YXkgKm92ZXJsYXksCiAJaWYgKG92ZXJsYXktPmNvbG9yX2tleV9lbmFibGVkKQogCQlmbGFncyB8
PSBEU1RfS0VZX0VOQUJMRTsKIAotCWlmIChzdGF0ZS0+YmFzZS52aXNpYmxlKQorCWlmIChzdGF0
ZS0+dWFwaS52aXNpYmxlKQogCQlmb3JtYXQgPSBzdGF0ZS0+aHcuZmItPmZvcm1hdC0+Zm9ybWF0
OwogCiAJc3dpdGNoIChmb3JtYXQpIHsKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1
L2Rpc3BsYXkvaW50ZWxfc3ByaXRlLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2lu
dGVsX3Nwcml0ZS5jCmluZGV4IGIyMTE2ZDEyMzU0OC4uZWY3NDA5ZjY5NWY5IDEwMDY0NAotLS0g
YS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX3Nwcml0ZS5jCisrKyBiL2RyaXZl
cnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfc3ByaXRlLmMKQEAgLTI0MCw3ICsyNDAsNyBA
QCB2b2lkIGludGVsX3BpcGVfdXBkYXRlX2VuZChzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqbmV3
X2NydGNfc3RhdGUpCiAKIGludCBpbnRlbF9wbGFuZV9jaGVja19zdHJpZGUoY29uc3Qgc3RydWN0
IGludGVsX3BsYW5lX3N0YXRlICpwbGFuZV9zdGF0ZSkKIHsKLQlzdHJ1Y3QgaW50ZWxfcGxhbmUg
KnBsYW5lID0gdG9faW50ZWxfcGxhbmUocGxhbmVfc3RhdGUtPmJhc2UucGxhbmUpOworCXN0cnVj
dCBpbnRlbF9wbGFuZSAqcGxhbmUgPSB0b19pbnRlbF9wbGFuZShwbGFuZV9zdGF0ZS0+dWFwaS5w
bGFuZSk7CiAJY29uc3Qgc3RydWN0IGRybV9mcmFtZWJ1ZmZlciAqZmIgPSBwbGFuZV9zdGF0ZS0+
aHcuZmI7CiAJdW5zaWduZWQgaW50IHJvdGF0aW9uID0gcGxhbmVfc3RhdGUtPmh3LnJvdGF0aW9u
OwogCXUzMiBzdHJpZGUsIG1heF9zdHJpZGU7CkBAIC0yNTIsNyArMjUyLDcgQEAgaW50IGludGVs
X3BsYW5lX2NoZWNrX3N0cmlkZShjb25zdCBzdHJ1Y3QgaW50ZWxfcGxhbmVfc3RhdGUgKnBsYW5l
X3N0YXRlKQogCSAqIGtpY2sgaW4gZHVlIHRoZSBwbGFuZSBiZWluZyBpbnZpc2libGUuCiAJICov
CiAJaWYgKGludGVsX3BsYW5lX2Nhbl9yZW1hcChwbGFuZV9zdGF0ZSkgJiYKLQkgICAgIXBsYW5l
X3N0YXRlLT5iYXNlLnZpc2libGUpCisJICAgICFwbGFuZV9zdGF0ZS0+dWFwaS52aXNpYmxlKQog
CQlyZXR1cm4gMDsKIAogCS8qIEZJWE1FIG90aGVyIGNvbG9yIHBsYW5lcz8gKi8KQEAgLTI3Myw3
ICsyNzMsNyBAQCBpbnQgaW50ZWxfcGxhbmVfY2hlY2tfc3RyaWRlKGNvbnN0IHN0cnVjdCBpbnRl
bF9wbGFuZV9zdGF0ZSAqcGxhbmVfc3RhdGUpCiBpbnQgaW50ZWxfcGxhbmVfY2hlY2tfc3JjX2Nv
b3JkaW5hdGVzKHN0cnVjdCBpbnRlbF9wbGFuZV9zdGF0ZSAqcGxhbmVfc3RhdGUpCiB7CiAJY29u
c3Qgc3RydWN0IGRybV9mcmFtZWJ1ZmZlciAqZmIgPSBwbGFuZV9zdGF0ZS0+aHcuZmI7Ci0Jc3Ry
dWN0IGRybV9yZWN0ICpzcmMgPSAmcGxhbmVfc3RhdGUtPmJhc2Uuc3JjOworCXN0cnVjdCBkcm1f
cmVjdCAqc3JjID0gJnBsYW5lX3N0YXRlLT51YXBpLnNyYzsKIAl1MzIgc3JjX3gsIHNyY195LCBz
cmNfdywgc3JjX2gsIGhzdWIsIHZzdWI7CiAJYm9vbCByb3RhdGVkID0gZHJtX3JvdGF0aW9uXzkw
X29yXzI3MChwbGFuZV9zdGF0ZS0+aHcucm90YXRpb24pOwogCkBAIC0zMjgsNyArMzI4LDcgQEAg
c2tsX3BsYW5lX3JhdGlvKGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRl
LAogCQljb25zdCBzdHJ1Y3QgaW50ZWxfcGxhbmVfc3RhdGUgKnBsYW5lX3N0YXRlLAogCQl1bnNp
Z25lZCBpbnQgKm51bSwgdW5zaWduZWQgaW50ICpkZW4pCiB7Ci0Jc3RydWN0IGRybV9pOTE1X3By
aXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShwbGFuZV9zdGF0ZS0+YmFzZS5wbGFuZS0+ZGV2KTsK
KwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KHBsYW5lX3N0YXRl
LT51YXBpLnBsYW5lLT5kZXYpOwogCWNvbnN0IHN0cnVjdCBkcm1fZnJhbWVidWZmZXIgKmZiID0g
cGxhbmVfc3RhdGUtPmh3LmZiOwogCiAJaWYgKGZiLT5mb3JtYXQtPmNwcFswXSA9PSA4KSB7CkBA
IC0zNDgsNyArMzQ4LDcgQEAgc2tsX3BsYW5lX3JhdGlvKGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRj
X3N0YXRlICpjcnRjX3N0YXRlLAogc3RhdGljIGludCBza2xfcGxhbmVfbWluX2NkY2xrKGNvbnN0
IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlLAogCQkJICAgICAgIGNvbnN0IHN0
cnVjdCBpbnRlbF9wbGFuZV9zdGF0ZSAqcGxhbmVfc3RhdGUpCiB7Ci0Jc3RydWN0IGRybV9pOTE1
X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShwbGFuZV9zdGF0ZS0+YmFzZS5wbGFuZS0+ZGV2
KTsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KHBsYW5lX3N0
YXRlLT51YXBpLnBsYW5lLT5kZXYpOwogCXVuc2lnbmVkIGludCBwaXhlbF9yYXRlID0gY3J0Y19z
dGF0ZS0+cGl4ZWxfcmF0ZTsKIAl1bnNpZ25lZCBpbnQgc3JjX3csIHNyY19oLCBkc3RfdywgZHN0
X2g7CiAJdW5zaWduZWQgaW50IG51bSwgZGVuOwpAQCAtMzU5LDEwICszNTksMTAgQEAgc3RhdGlj
IGludCBza2xfcGxhbmVfbWluX2NkY2xrKGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpj
cnRjX3N0YXRlLAogCWlmIChJTlRFTF9HRU4oZGV2X3ByaXYpID49IDEwIHx8IElTX0dFTUlOSUxB
S0UoZGV2X3ByaXYpKQogCQlkZW4gKj0gMjsKIAotCXNyY193ID0gZHJtX3JlY3Rfd2lkdGgoJnBs
YW5lX3N0YXRlLT5iYXNlLnNyYykgPj4gMTY7Ci0Jc3JjX2ggPSBkcm1fcmVjdF9oZWlnaHQoJnBs
YW5lX3N0YXRlLT5iYXNlLnNyYykgPj4gMTY7Ci0JZHN0X3cgPSBkcm1fcmVjdF93aWR0aCgmcGxh
bmVfc3RhdGUtPmJhc2UuZHN0KTsKLQlkc3RfaCA9IGRybV9yZWN0X2hlaWdodCgmcGxhbmVfc3Rh
dGUtPmJhc2UuZHN0KTsKKwlzcmNfdyA9IGRybV9yZWN0X3dpZHRoKCZwbGFuZV9zdGF0ZS0+dWFw
aS5zcmMpID4+IDE2OworCXNyY19oID0gZHJtX3JlY3RfaGVpZ2h0KCZwbGFuZV9zdGF0ZS0+dWFw
aS5zcmMpID4+IDE2OworCWRzdF93ID0gZHJtX3JlY3Rfd2lkdGgoJnBsYW5lX3N0YXRlLT51YXBp
LmRzdCk7CisJZHN0X2ggPSBkcm1fcmVjdF9oZWlnaHQoJnBsYW5lX3N0YXRlLT51YXBpLmRzdCk7
CiAKIAkvKiBEb3duc2NhbGluZyBsaW1pdHMgdGhlIG1heGltdW0gcGl4ZWwgcmF0ZSAqLwogCWRz
dF93ID0gbWluKHNyY193LCBkc3Rfdyk7CkBAIC00MDEsMTkgKzQwMSwxOSBAQCBza2xfcHJvZ3Jh
bV9zY2FsZXIoc3RydWN0IGludGVsX3BsYW5lICpwbGFuZSwKIAlpbnQgc2NhbGVyX2lkID0gcGxh
bmVfc3RhdGUtPnNjYWxlcl9pZDsKIAljb25zdCBzdHJ1Y3QgaW50ZWxfc2NhbGVyICpzY2FsZXIg
PQogCQkmY3J0Y19zdGF0ZS0+c2NhbGVyX3N0YXRlLnNjYWxlcnNbc2NhbGVyX2lkXTsKLQlpbnQg
Y3J0Y194ID0gcGxhbmVfc3RhdGUtPmJhc2UuZHN0LngxOwotCWludCBjcnRjX3kgPSBwbGFuZV9z
dGF0ZS0+YmFzZS5kc3QueTE7Ci0JdTMyIGNydGNfdyA9IGRybV9yZWN0X3dpZHRoKCZwbGFuZV9z
dGF0ZS0+YmFzZS5kc3QpOwotCXUzMiBjcnRjX2ggPSBkcm1fcmVjdF9oZWlnaHQoJnBsYW5lX3N0
YXRlLT5iYXNlLmRzdCk7CisJaW50IGNydGNfeCA9IHBsYW5lX3N0YXRlLT51YXBpLmRzdC54MTsK
KwlpbnQgY3J0Y195ID0gcGxhbmVfc3RhdGUtPnVhcGkuZHN0LnkxOworCXUzMiBjcnRjX3cgPSBk
cm1fcmVjdF93aWR0aCgmcGxhbmVfc3RhdGUtPnVhcGkuZHN0KTsKKwl1MzIgY3J0Y19oID0gZHJt
X3JlY3RfaGVpZ2h0KCZwbGFuZV9zdGF0ZS0+dWFwaS5kc3QpOwogCXUxNiB5X2hwaGFzZSwgdXZf
cmdiX2hwaGFzZTsKIAl1MTYgeV92cGhhc2UsIHV2X3JnYl92cGhhc2U7CiAJaW50IGhzY2FsZSwg
dnNjYWxlOwogCi0JaHNjYWxlID0gZHJtX3JlY3RfY2FsY19oc2NhbGUoJnBsYW5lX3N0YXRlLT5i
YXNlLnNyYywKLQkJCQkgICAgICAmcGxhbmVfc3RhdGUtPmJhc2UuZHN0LAorCWhzY2FsZSA9IGRy
bV9yZWN0X2NhbGNfaHNjYWxlKCZwbGFuZV9zdGF0ZS0+dWFwaS5zcmMsCisJCQkJICAgICAgJnBs
YW5lX3N0YXRlLT51YXBpLmRzdCwKIAkJCQkgICAgICAwLCBJTlRfTUFYKTsKLQl2c2NhbGUgPSBk
cm1fcmVjdF9jYWxjX3ZzY2FsZSgmcGxhbmVfc3RhdGUtPmJhc2Uuc3JjLAotCQkJCSAgICAgICZw
bGFuZV9zdGF0ZS0+YmFzZS5kc3QsCisJdnNjYWxlID0gZHJtX3JlY3RfY2FsY192c2NhbGUoJnBs
YW5lX3N0YXRlLT51YXBpLnNyYywKKwkJCQkgICAgICAmcGxhbmVfc3RhdGUtPnVhcGkuZHN0LAog
CQkJCSAgICAgIDAsIElOVF9NQVgpOwogCiAJLyogVE9ETzogaGFuZGxlIHN1Yi1waXhlbCBjb29y
ZGluYXRlcyAqLwpAQCAtNTg0LDEyICs1ODQsMTIgQEAgc2tsX3Byb2dyYW1fcGxhbmUoc3RydWN0
IGludGVsX3BsYW5lICpwbGFuZSwKIAl1MzIgc3VyZl9hZGRyID0gcGxhbmVfc3RhdGUtPmNvbG9y
X3BsYW5lW2NvbG9yX3BsYW5lXS5vZmZzZXQ7CiAJdTMyIHN0cmlkZSA9IHNrbF9wbGFuZV9zdHJp
ZGUocGxhbmVfc3RhdGUsIGNvbG9yX3BsYW5lKTsKIAl1MzIgYXV4X3N0cmlkZSA9IHNrbF9wbGFu
ZV9zdHJpZGUocGxhbmVfc3RhdGUsIDEpOwotCWludCBjcnRjX3ggPSBwbGFuZV9zdGF0ZS0+YmFz
ZS5kc3QueDE7Ci0JaW50IGNydGNfeSA9IHBsYW5lX3N0YXRlLT5iYXNlLmRzdC55MTsKKwlpbnQg
Y3J0Y194ID0gcGxhbmVfc3RhdGUtPnVhcGkuZHN0LngxOworCWludCBjcnRjX3kgPSBwbGFuZV9z
dGF0ZS0+dWFwaS5kc3QueTE7CiAJdTMyIHggPSBwbGFuZV9zdGF0ZS0+Y29sb3JfcGxhbmVbY29s
b3JfcGxhbmVdLng7CiAJdTMyIHkgPSBwbGFuZV9zdGF0ZS0+Y29sb3JfcGxhbmVbY29sb3JfcGxh
bmVdLnk7Ci0JdTMyIHNyY193ID0gZHJtX3JlY3Rfd2lkdGgoJnBsYW5lX3N0YXRlLT5iYXNlLnNy
YykgPj4gMTY7Ci0JdTMyIHNyY19oID0gZHJtX3JlY3RfaGVpZ2h0KCZwbGFuZV9zdGF0ZS0+YmFz
ZS5zcmMpID4+IDE2OworCXUzMiBzcmNfdyA9IGRybV9yZWN0X3dpZHRoKCZwbGFuZV9zdGF0ZS0+
dWFwaS5zcmMpID4+IDE2OworCXUzMiBzcmNfaCA9IGRybV9yZWN0X2hlaWdodCgmcGxhbmVfc3Rh
dGUtPnVhcGkuc3JjKSA+PiAxNjsKIAlzdHJ1Y3QgaW50ZWxfcGxhbmUgKmxpbmtlZCA9IHBsYW5l
X3N0YXRlLT5wbGFuYXJfbGlua2VkX3BsYW5lOwogCWNvbnN0IHN0cnVjdCBkcm1fZnJhbWVidWZm
ZXIgKmZiID0gcGxhbmVfc3RhdGUtPmh3LmZiOwogCXU4IGFscGhhID0gcGxhbmVfc3RhdGUtPmh3
LmFscGhhID4+IDg7CkBAIC03NjYsNyArNzY2LDcgQEAgc3RhdGljIHZvaWQgaTl4eF9wbGFuZV9s
aW5lYXJfZ2FtbWEodTE2IGdhbW1hWzhdKQogc3RhdGljIHZvaWQKIGNodl91cGRhdGVfY3NjKGNv
bnN0IHN0cnVjdCBpbnRlbF9wbGFuZV9zdGF0ZSAqcGxhbmVfc3RhdGUpCiB7Ci0Jc3RydWN0IGlu
dGVsX3BsYW5lICpwbGFuZSA9IHRvX2ludGVsX3BsYW5lKHBsYW5lX3N0YXRlLT5iYXNlLnBsYW5l
KTsKKwlzdHJ1Y3QgaW50ZWxfcGxhbmUgKnBsYW5lID0gdG9faW50ZWxfcGxhbmUocGxhbmVfc3Rh
dGUtPnVhcGkucGxhbmUpOwogCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRv
X2k5MTUocGxhbmUtPmJhc2UuZGV2KTsKIAljb25zdCBzdHJ1Y3QgZHJtX2ZyYW1lYnVmZmVyICpm
YiA9IHBsYW5lX3N0YXRlLT5ody5mYjsKIAllbnVtIHBsYW5lX2lkIHBsYW5lX2lkID0gcGxhbmUt
PmlkOwpAQCAtODI1LDcgKzgyNSw3IEBAIGNodl91cGRhdGVfY3NjKGNvbnN0IHN0cnVjdCBpbnRl
bF9wbGFuZV9zdGF0ZSAqcGxhbmVfc3RhdGUpCiBzdGF0aWMgdm9pZAogdmx2X3VwZGF0ZV9jbHJj
KGNvbnN0IHN0cnVjdCBpbnRlbF9wbGFuZV9zdGF0ZSAqcGxhbmVfc3RhdGUpCiB7Ci0Jc3RydWN0
IGludGVsX3BsYW5lICpwbGFuZSA9IHRvX2ludGVsX3BsYW5lKHBsYW5lX3N0YXRlLT5iYXNlLnBs
YW5lKTsKKwlzdHJ1Y3QgaW50ZWxfcGxhbmUgKnBsYW5lID0gdG9faW50ZWxfcGxhbmUocGxhbmVf
c3RhdGUtPnVhcGkucGxhbmUpOwogCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9
IHRvX2k5MTUocGxhbmUtPmJhc2UuZGV2KTsKIAljb25zdCBzdHJ1Y3QgZHJtX2ZyYW1lYnVmZmVy
ICpmYiA9IHBsYW5lX3N0YXRlLT5ody5mYjsKIAllbnVtIHBpcGUgcGlwZSA9IHBsYW5lLT5waXBl
OwpAQCAtMTAxOSw3ICsxMDE5LDcgQEAgc3RhdGljIHUzMiB2bHZfc3ByaXRlX2N0bChjb25zdCBz
dHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSwKIAogc3RhdGljIHZvaWQgdmx2X3Vw
ZGF0ZV9nYW1tYShjb25zdCBzdHJ1Y3QgaW50ZWxfcGxhbmVfc3RhdGUgKnBsYW5lX3N0YXRlKQog
ewotCXN0cnVjdCBpbnRlbF9wbGFuZSAqcGxhbmUgPSB0b19pbnRlbF9wbGFuZShwbGFuZV9zdGF0
ZS0+YmFzZS5wbGFuZSk7CisJc3RydWN0IGludGVsX3BsYW5lICpwbGFuZSA9IHRvX2ludGVsX3Bs
YW5lKHBsYW5lX3N0YXRlLT51YXBpLnBsYW5lKTsKIAlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAq
ZGV2X3ByaXYgPSB0b19pOTE1KHBsYW5lLT5iYXNlLmRldik7CiAJY29uc3Qgc3RydWN0IGRybV9m
cmFtZWJ1ZmZlciAqZmIgPSBwbGFuZV9zdGF0ZS0+aHcuZmI7CiAJZW51bSBwaXBlIHBpcGUgPSBw
bGFuZS0+cGlwZTsKQEAgLTEwNTMsMTAgKzEwNTMsMTAgQEAgdmx2X3VwZGF0ZV9wbGFuZShzdHJ1
Y3QgaW50ZWxfcGxhbmUgKnBsYW5lLAogCXUzMiBzcHJzdXJmX29mZnNldCA9IHBsYW5lX3N0YXRl
LT5jb2xvcl9wbGFuZVswXS5vZmZzZXQ7CiAJdTMyIGxpbmVhcl9vZmZzZXQ7CiAJY29uc3Qgc3Ry
dWN0IGRybV9pbnRlbF9zcHJpdGVfY29sb3JrZXkgKmtleSA9ICZwbGFuZV9zdGF0ZS0+Y2tleTsK
LQlpbnQgY3J0Y194ID0gcGxhbmVfc3RhdGUtPmJhc2UuZHN0LngxOwotCWludCBjcnRjX3kgPSBw
bGFuZV9zdGF0ZS0+YmFzZS5kc3QueTE7Ci0JdTMyIGNydGNfdyA9IGRybV9yZWN0X3dpZHRoKCZw
bGFuZV9zdGF0ZS0+YmFzZS5kc3QpOwotCXUzMiBjcnRjX2ggPSBkcm1fcmVjdF9oZWlnaHQoJnBs
YW5lX3N0YXRlLT5iYXNlLmRzdCk7CisJaW50IGNydGNfeCA9IHBsYW5lX3N0YXRlLT51YXBpLmRz
dC54MTsKKwlpbnQgY3J0Y195ID0gcGxhbmVfc3RhdGUtPnVhcGkuZHN0LnkxOworCXUzMiBjcnRj
X3cgPSBkcm1fcmVjdF93aWR0aCgmcGxhbmVfc3RhdGUtPnVhcGkuZHN0KTsKKwl1MzIgY3J0Y19o
ID0gZHJtX3JlY3RfaGVpZ2h0KCZwbGFuZV9zdGF0ZS0+dWFwaS5kc3QpOwogCXUzMiB4ID0gcGxh
bmVfc3RhdGUtPmNvbG9yX3BsYW5lWzBdLng7CiAJdTMyIHkgPSBwbGFuZV9zdGF0ZS0+Y29sb3Jf
cGxhbmVbMF0ueTsKIAl1bnNpZ25lZCBsb25nIGlycWZsYWdzOwpAQCAtMTI0NSw4ICsxMjQ1LDgg
QEAgc3RhdGljIGludCBpdmJfc3ByaXRlX21pbl9jZGNsayhjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0
Y19zdGF0ZSAqY3J0Y19zdGF0ZSwKIAkgKi8KIAlwaXhlbF9yYXRlID0gY3J0Y19zdGF0ZS0+cGl4
ZWxfcmF0ZTsKIAotCXNyY193ID0gZHJtX3JlY3Rfd2lkdGgoJnBsYW5lX3N0YXRlLT5iYXNlLnNy
YykgPj4gMTY7Ci0JZHN0X3cgPSBkcm1fcmVjdF93aWR0aCgmcGxhbmVfc3RhdGUtPmJhc2UuZHN0
KTsKKwlzcmNfdyA9IGRybV9yZWN0X3dpZHRoKCZwbGFuZV9zdGF0ZS0+dWFwaS5zcmMpID4+IDE2
OworCWRzdF93ID0gZHJtX3JlY3Rfd2lkdGgoJnBsYW5lX3N0YXRlLT51YXBpLmRzdCk7CiAKIAlp
ZiAoc3JjX3cgIT0gZHN0X3cpCiAJCWl2Yl9wbGFuZV9yYXRpb19zY2FsaW5nKGNydGNfc3RhdGUs
IHBsYW5lX3N0YXRlLCAmbnVtLCAmZGVuKTsKQEAgLTEzMjAsNyArMTMyMCw3IEBAIHN0YXRpYyB1
MzIgaXZiX3Nwcml0ZV9jdGxfY3J0Yyhjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0
Y19zdGF0ZSkKIHN0YXRpYyBib29sIGl2Yl9uZWVkX3Nwcml0ZV9nYW1tYShjb25zdCBzdHJ1Y3Qg
aW50ZWxfcGxhbmVfc3RhdGUgKnBsYW5lX3N0YXRlKQogewogCXN0cnVjdCBkcm1faTkxNV9wcml2
YXRlICpkZXZfcHJpdiA9Ci0JCXRvX2k5MTUocGxhbmVfc3RhdGUtPmJhc2UucGxhbmUtPmRldik7
CisJCXRvX2k5MTUocGxhbmVfc3RhdGUtPnVhcGkucGxhbmUtPmRldik7CiAJY29uc3Qgc3RydWN0
IGRybV9mcmFtZWJ1ZmZlciAqZmIgPSBwbGFuZV9zdGF0ZS0+aHcuZmI7CiAKIAlyZXR1cm4gZmIt
PmZvcm1hdC0+Y3BwWzBdID09IDggJiYKQEAgLTEzMzEsNyArMTMzMSw3IEBAIHN0YXRpYyB1MzIg
aXZiX3Nwcml0ZV9jdGwoY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUs
CiAJCQkgIGNvbnN0IHN0cnVjdCBpbnRlbF9wbGFuZV9zdGF0ZSAqcGxhbmVfc3RhdGUpCiB7CiAJ
c3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0KLQkJdG9faTkxNShwbGFuZV9zdGF0
ZS0+YmFzZS5wbGFuZS0+ZGV2KTsKKwkJdG9faTkxNShwbGFuZV9zdGF0ZS0+dWFwaS5wbGFuZS0+
ZGV2KTsKIAljb25zdCBzdHJ1Y3QgZHJtX2ZyYW1lYnVmZmVyICpmYiA9IHBsYW5lX3N0YXRlLT5o
dy5mYjsKIAl1bnNpZ25lZCBpbnQgcm90YXRpb24gPSBwbGFuZV9zdGF0ZS0+aHcucm90YXRpb247
CiAJY29uc3Qgc3RydWN0IGRybV9pbnRlbF9zcHJpdGVfY29sb3JrZXkgKmtleSA9ICZwbGFuZV9z
dGF0ZS0+Y2tleTsKQEAgLTE0MjIsNyArMTQyMiw3IEBAIHN0YXRpYyB2b2lkIGl2Yl9zcHJpdGVf
bGluZWFyX2dhbW1hKGNvbnN0IHN0cnVjdCBpbnRlbF9wbGFuZV9zdGF0ZSAqcGxhbmVfc3RhdGUs
CiAKIHN0YXRpYyB2b2lkIGl2Yl91cGRhdGVfZ2FtbWEoY29uc3Qgc3RydWN0IGludGVsX3BsYW5l
X3N0YXRlICpwbGFuZV9zdGF0ZSkKIHsKLQlzdHJ1Y3QgaW50ZWxfcGxhbmUgKnBsYW5lID0gdG9f
aW50ZWxfcGxhbmUocGxhbmVfc3RhdGUtPmJhc2UucGxhbmUpOworCXN0cnVjdCBpbnRlbF9wbGFu
ZSAqcGxhbmUgPSB0b19pbnRlbF9wbGFuZShwbGFuZV9zdGF0ZS0+dWFwaS5wbGFuZSk7CiAJc3Ry
dWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShwbGFuZS0+YmFzZS5kZXYp
OwogCWVudW0gcGlwZSBwaXBlID0gcGxhbmUtPnBpcGU7CiAJdTE2IGdhbW1hWzE4XTsKQEAgLTE0
NjEsMTQgKzE0NjEsMTQgQEAgaXZiX3VwZGF0ZV9wbGFuZShzdHJ1Y3QgaW50ZWxfcGxhbmUgKnBs
YW5lLAogCXUzMiBzcHJzdXJmX29mZnNldCA9IHBsYW5lX3N0YXRlLT5jb2xvcl9wbGFuZVswXS5v
ZmZzZXQ7CiAJdTMyIGxpbmVhcl9vZmZzZXQ7CiAJY29uc3Qgc3RydWN0IGRybV9pbnRlbF9zcHJp
dGVfY29sb3JrZXkgKmtleSA9ICZwbGFuZV9zdGF0ZS0+Y2tleTsKLQlpbnQgY3J0Y194ID0gcGxh
bmVfc3RhdGUtPmJhc2UuZHN0LngxOwotCWludCBjcnRjX3kgPSBwbGFuZV9zdGF0ZS0+YmFzZS5k
c3QueTE7Ci0JdTMyIGNydGNfdyA9IGRybV9yZWN0X3dpZHRoKCZwbGFuZV9zdGF0ZS0+YmFzZS5k
c3QpOwotCXUzMiBjcnRjX2ggPSBkcm1fcmVjdF9oZWlnaHQoJnBsYW5lX3N0YXRlLT5iYXNlLmRz
dCk7CisJaW50IGNydGNfeCA9IHBsYW5lX3N0YXRlLT51YXBpLmRzdC54MTsKKwlpbnQgY3J0Y195
ID0gcGxhbmVfc3RhdGUtPnVhcGkuZHN0LnkxOworCXUzMiBjcnRjX3cgPSBkcm1fcmVjdF93aWR0
aCgmcGxhbmVfc3RhdGUtPnVhcGkuZHN0KTsKKwl1MzIgY3J0Y19oID0gZHJtX3JlY3RfaGVpZ2h0
KCZwbGFuZV9zdGF0ZS0+dWFwaS5kc3QpOwogCXUzMiB4ID0gcGxhbmVfc3RhdGUtPmNvbG9yX3Bs
YW5lWzBdLng7CiAJdTMyIHkgPSBwbGFuZV9zdGF0ZS0+Y29sb3JfcGxhbmVbMF0ueTsKLQl1MzIg
c3JjX3cgPSBkcm1fcmVjdF93aWR0aCgmcGxhbmVfc3RhdGUtPmJhc2Uuc3JjKSA+PiAxNjsKLQl1
MzIgc3JjX2ggPSBkcm1fcmVjdF9oZWlnaHQoJnBsYW5lX3N0YXRlLT5iYXNlLnNyYykgPj4gMTY7
CisJdTMyIHNyY193ID0gZHJtX3JlY3Rfd2lkdGgoJnBsYW5lX3N0YXRlLT51YXBpLnNyYykgPj4g
MTY7CisJdTMyIHNyY19oID0gZHJtX3JlY3RfaGVpZ2h0KCZwbGFuZV9zdGF0ZS0+dWFwaS5zcmMp
ID4+IDE2OwogCXUzMiBzcHJjdGwsIHNwcnNjYWxlID0gMDsKIAl1bnNpZ25lZCBsb25nIGlycWZs
YWdzOwogCkBAIC0xNTgxLDggKzE1ODEsOCBAQCBzdGF0aWMgaW50IGc0eF9zcHJpdGVfbWluX2Nk
Y2xrKGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlLAogCXBpeGVsX3Jh
dGUgPSBjcnRjX3N0YXRlLT5waXhlbF9yYXRlOwogCiAJLyogSG9yaXpvbnRhbCBkb3duc2NhbGlu
ZyBsaW1pdHMgdGhlIG1heGltdW0gcGl4ZWwgcmF0ZSAqLwotCWhzY2FsZSA9IGRybV9yZWN0X2Nh
bGNfaHNjYWxlKCZwbGFuZV9zdGF0ZS0+YmFzZS5zcmMsCi0JCQkJICAgICAgJnBsYW5lX3N0YXRl
LT5iYXNlLmRzdCwKKwloc2NhbGUgPSBkcm1fcmVjdF9jYWxjX2hzY2FsZSgmcGxhbmVfc3RhdGUt
PnVhcGkuc3JjLAorCQkJCSAgICAgICZwbGFuZV9zdGF0ZS0+dWFwaS5kc3QsCiAJCQkJICAgICAg
MCwgSU5UX01BWCk7CiAJaWYgKGhzY2FsZSA8IDB4MTAwMDApCiAJCXJldHVybiBwaXhlbF9yYXRl
OwpAQCAtMTYzNiw3ICsxNjM2LDcgQEAgc3RhdGljIHUzMiBnNHhfc3ByaXRlX2N0bChjb25zdCBz
dHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSwKIAkJCSAgY29uc3Qgc3RydWN0IGlu
dGVsX3BsYW5lX3N0YXRlICpwbGFuZV9zdGF0ZSkKIHsKIAlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0
ZSAqZGV2X3ByaXYgPQotCQl0b19pOTE1KHBsYW5lX3N0YXRlLT5iYXNlLnBsYW5lLT5kZXYpOwor
CQl0b19pOTE1KHBsYW5lX3N0YXRlLT51YXBpLnBsYW5lLT5kZXYpOwogCWNvbnN0IHN0cnVjdCBk
cm1fZnJhbWVidWZmZXIgKmZiID0gcGxhbmVfc3RhdGUtPmh3LmZiOwogCXVuc2lnbmVkIGludCBy
b3RhdGlvbiA9IHBsYW5lX3N0YXRlLT5ody5yb3RhdGlvbjsKIAljb25zdCBzdHJ1Y3QgZHJtX2lu
dGVsX3Nwcml0ZV9jb2xvcmtleSAqa2V5ID0gJnBsYW5lX3N0YXRlLT5ja2V5OwpAQCAtMTY5OSw3
ICsxNjk5LDcgQEAgc3RhdGljIHUzMiBnNHhfc3ByaXRlX2N0bChjb25zdCBzdHJ1Y3QgaW50ZWxf
Y3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSwKIAogc3RhdGljIHZvaWQgZzR4X3VwZGF0ZV9nYW1tYShj
b25zdCBzdHJ1Y3QgaW50ZWxfcGxhbmVfc3RhdGUgKnBsYW5lX3N0YXRlKQogewotCXN0cnVjdCBp
bnRlbF9wbGFuZSAqcGxhbmUgPSB0b19pbnRlbF9wbGFuZShwbGFuZV9zdGF0ZS0+YmFzZS5wbGFu
ZSk7CisJc3RydWN0IGludGVsX3BsYW5lICpwbGFuZSA9IHRvX2ludGVsX3BsYW5lKHBsYW5lX3N0
YXRlLT51YXBpLnBsYW5lKTsKIAlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0
b19pOTE1KHBsYW5lLT5iYXNlLmRldik7CiAJY29uc3Qgc3RydWN0IGRybV9mcmFtZWJ1ZmZlciAq
ZmIgPSBwbGFuZV9zdGF0ZS0+aHcuZmI7CiAJZW51bSBwaXBlIHBpcGUgPSBwbGFuZS0+cGlwZTsK
QEAgLTE3MzEsNyArMTczMSw3IEBAIHN0YXRpYyB2b2lkIGlsa19zcHJpdGVfbGluZWFyX2dhbW1h
KHUxNiBnYW1tYVsxN10pCiAKIHN0YXRpYyB2b2lkIGlsa191cGRhdGVfZ2FtbWEoY29uc3Qgc3Ry
dWN0IGludGVsX3BsYW5lX3N0YXRlICpwbGFuZV9zdGF0ZSkKIHsKLQlzdHJ1Y3QgaW50ZWxfcGxh
bmUgKnBsYW5lID0gdG9faW50ZWxfcGxhbmUocGxhbmVfc3RhdGUtPmJhc2UucGxhbmUpOworCXN0
cnVjdCBpbnRlbF9wbGFuZSAqcGxhbmUgPSB0b19pbnRlbF9wbGFuZShwbGFuZV9zdGF0ZS0+dWFw
aS5wbGFuZSk7CiAJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShw
bGFuZS0+YmFzZS5kZXYpOwogCWNvbnN0IHN0cnVjdCBkcm1fZnJhbWVidWZmZXIgKmZiID0gcGxh
bmVfc3RhdGUtPmh3LmZiOwogCWVudW0gcGlwZSBwaXBlID0gcGxhbmUtPnBpcGU7CkBAIC0xNzY3
LDE0ICsxNzY3LDE0IEBAIGc0eF91cGRhdGVfcGxhbmUoc3RydWN0IGludGVsX3BsYW5lICpwbGFu
ZSwKIAl1MzIgZHZzc3VyZl9vZmZzZXQgPSBwbGFuZV9zdGF0ZS0+Y29sb3JfcGxhbmVbMF0ub2Zm
c2V0OwogCXUzMiBsaW5lYXJfb2Zmc2V0OwogCWNvbnN0IHN0cnVjdCBkcm1faW50ZWxfc3ByaXRl
X2NvbG9ya2V5ICprZXkgPSAmcGxhbmVfc3RhdGUtPmNrZXk7Ci0JaW50IGNydGNfeCA9IHBsYW5l
X3N0YXRlLT5iYXNlLmRzdC54MTsKLQlpbnQgY3J0Y195ID0gcGxhbmVfc3RhdGUtPmJhc2UuZHN0
LnkxOwotCXUzMiBjcnRjX3cgPSBkcm1fcmVjdF93aWR0aCgmcGxhbmVfc3RhdGUtPmJhc2UuZHN0
KTsKLQl1MzIgY3J0Y19oID0gZHJtX3JlY3RfaGVpZ2h0KCZwbGFuZV9zdGF0ZS0+YmFzZS5kc3Qp
OworCWludCBjcnRjX3ggPSBwbGFuZV9zdGF0ZS0+dWFwaS5kc3QueDE7CisJaW50IGNydGNfeSA9
IHBsYW5lX3N0YXRlLT51YXBpLmRzdC55MTsKKwl1MzIgY3J0Y193ID0gZHJtX3JlY3Rfd2lkdGgo
JnBsYW5lX3N0YXRlLT51YXBpLmRzdCk7CisJdTMyIGNydGNfaCA9IGRybV9yZWN0X2hlaWdodCgm
cGxhbmVfc3RhdGUtPnVhcGkuZHN0KTsKIAl1MzIgeCA9IHBsYW5lX3N0YXRlLT5jb2xvcl9wbGFu
ZVswXS54OwogCXUzMiB5ID0gcGxhbmVfc3RhdGUtPmNvbG9yX3BsYW5lWzBdLnk7Ci0JdTMyIHNy
Y193ID0gZHJtX3JlY3Rfd2lkdGgoJnBsYW5lX3N0YXRlLT5iYXNlLnNyYykgPj4gMTY7Ci0JdTMy
IHNyY19oID0gZHJtX3JlY3RfaGVpZ2h0KCZwbGFuZV9zdGF0ZS0+YmFzZS5zcmMpID4+IDE2Owor
CXUzMiBzcmNfdyA9IGRybV9yZWN0X3dpZHRoKCZwbGFuZV9zdGF0ZS0+dWFwaS5zcmMpID4+IDE2
OworCXUzMiBzcmNfaCA9IGRybV9yZWN0X2hlaWdodCgmcGxhbmVfc3RhdGUtPnVhcGkuc3JjKSA+
PiAxNjsKIAl1MzIgZHZzY250ciwgZHZzc2NhbGUgPSAwOwogCXVuc2lnbmVkIGxvbmcgaXJxZmxh
Z3M7CiAKQEAgLTE4ODgsOCArMTg4OCw4IEBAIGc0eF9zcHJpdGVfY2hlY2tfc2NhbGluZyhzdHJ1
Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSwKIAkJCSBzdHJ1Y3QgaW50ZWxfcGxhbmVf
c3RhdGUgKnBsYW5lX3N0YXRlKQogewogCWNvbnN0IHN0cnVjdCBkcm1fZnJhbWVidWZmZXIgKmZi
ID0gcGxhbmVfc3RhdGUtPmh3LmZiOwotCWNvbnN0IHN0cnVjdCBkcm1fcmVjdCAqc3JjID0gJnBs
YW5lX3N0YXRlLT5iYXNlLnNyYzsKLQljb25zdCBzdHJ1Y3QgZHJtX3JlY3QgKmRzdCA9ICZwbGFu
ZV9zdGF0ZS0+YmFzZS5kc3Q7CisJY29uc3Qgc3RydWN0IGRybV9yZWN0ICpzcmMgPSAmcGxhbmVf
c3RhdGUtPnVhcGkuc3JjOworCWNvbnN0IHN0cnVjdCBkcm1fcmVjdCAqZHN0ID0gJnBsYW5lX3N0
YXRlLT51YXBpLmRzdDsKIAlpbnQgc3JjX3gsIHNyY193LCBzcmNfaCwgY3J0Y193LCBjcnRjX2g7
CiAJY29uc3Qgc3RydWN0IGRybV9kaXNwbGF5X21vZGUgKmFkanVzdGVkX21vZGUgPQogCQkmY3J0
Y19zdGF0ZS0+aHcuYWRqdXN0ZWRfbW9kZTsKQEAgLTE5NDgsNyArMTk0OCw3IEBAIHN0YXRpYyBp
bnQKIGc0eF9zcHJpdGVfY2hlY2soc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUs
CiAJCSBzdHJ1Y3QgaW50ZWxfcGxhbmVfc3RhdGUgKnBsYW5lX3N0YXRlKQogewotCXN0cnVjdCBp
bnRlbF9wbGFuZSAqcGxhbmUgPSB0b19pbnRlbF9wbGFuZShwbGFuZV9zdGF0ZS0+YmFzZS5wbGFu
ZSk7CisJc3RydWN0IGludGVsX3BsYW5lICpwbGFuZSA9IHRvX2ludGVsX3BsYW5lKHBsYW5lX3N0
YXRlLT51YXBpLnBsYW5lKTsKIAlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0
b19pOTE1KHBsYW5lLT5iYXNlLmRldik7CiAJaW50IG1pbl9zY2FsZSA9IERSTV9QTEFORV9IRUxQ
RVJfTk9fU0NBTElORzsKIAlpbnQgbWF4X3NjYWxlID0gRFJNX1BMQU5FX0hFTFBFUl9OT19TQ0FM
SU5HOwpAQCAtMTk2NCw3ICsxOTY0LDcgQEAgZzR4X3Nwcml0ZV9jaGVjayhzdHJ1Y3QgaW50ZWxf
Y3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSwKIAkJfQogCX0KIAotCXJldCA9IGRybV9hdG9taWNfaGVs
cGVyX2NoZWNrX3BsYW5lX3N0YXRlKCZwbGFuZV9zdGF0ZS0+YmFzZSwKKwlyZXQgPSBkcm1fYXRv
bWljX2hlbHBlcl9jaGVja19wbGFuZV9zdGF0ZSgmcGxhbmVfc3RhdGUtPnVhcGksCiAJCQkJCQkg
ICZjcnRjX3N0YXRlLT51YXBpLAogCQkJCQkJICBtaW5fc2NhbGUsIG1heF9zY2FsZSwKIAkJCQkJ
CSAgdHJ1ZSwgdHJ1ZSk7CkBAIC0xOTc1LDcgKzE5NzUsNyBAQCBnNHhfc3ByaXRlX2NoZWNrKHN0
cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlLAogCWlmIChyZXQpCiAJCXJldHVybiBy
ZXQ7CiAKLQlpZiAoIXBsYW5lX3N0YXRlLT5iYXNlLnZpc2libGUpCisJaWYgKCFwbGFuZV9zdGF0
ZS0+dWFwaS52aXNpYmxlKQogCQlyZXR1cm4gMDsKIAogCXJldCA9IGludGVsX3BsYW5lX2NoZWNr
X3NyY19jb29yZGluYXRlcyhwbGFuZV9zdGF0ZSk7CkBAIC0xOTk2LDcgKzE5OTYsNyBAQCBnNHhf
c3ByaXRlX2NoZWNrKHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlLAogCiBpbnQg
Y2h2X3BsYW5lX2NoZWNrX3JvdGF0aW9uKGNvbnN0IHN0cnVjdCBpbnRlbF9wbGFuZV9zdGF0ZSAq
cGxhbmVfc3RhdGUpCiB7Ci0Jc3RydWN0IGludGVsX3BsYW5lICpwbGFuZSA9IHRvX2ludGVsX3Bs
YW5lKHBsYW5lX3N0YXRlLT5iYXNlLnBsYW5lKTsKKwlzdHJ1Y3QgaW50ZWxfcGxhbmUgKnBsYW5l
ID0gdG9faW50ZWxfcGxhbmUocGxhbmVfc3RhdGUtPnVhcGkucGxhbmUpOwogCXN0cnVjdCBkcm1f
aTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUocGxhbmUtPmJhc2UuZGV2KTsKIAl1bnNp
Z25lZCBpbnQgcm90YXRpb24gPSBwbGFuZV9zdGF0ZS0+aHcucm90YXRpb247CiAKQEAgLTIwMjEs
NyArMjAyMSw3IEBAIHZsdl9zcHJpdGVfY2hlY2soc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNy
dGNfc3RhdGUsCiAJaWYgKHJldCkKIAkJcmV0dXJuIHJldDsKIAotCXJldCA9IGRybV9hdG9taWNf
aGVscGVyX2NoZWNrX3BsYW5lX3N0YXRlKCZwbGFuZV9zdGF0ZS0+YmFzZSwKKwlyZXQgPSBkcm1f
YXRvbWljX2hlbHBlcl9jaGVja19wbGFuZV9zdGF0ZSgmcGxhbmVfc3RhdGUtPnVhcGksCiAJCQkJ
CQkgICZjcnRjX3N0YXRlLT51YXBpLAogCQkJCQkJICBEUk1fUExBTkVfSEVMUEVSX05PX1NDQUxJ
TkcsCiAJCQkJCQkgIERSTV9QTEFORV9IRUxQRVJfTk9fU0NBTElORywKQEAgLTIwMzMsNyArMjAz
Myw3IEBAIHZsdl9zcHJpdGVfY2hlY2soc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3Rh
dGUsCiAJaWYgKHJldCkKIAkJcmV0dXJuIHJldDsKIAotCWlmICghcGxhbmVfc3RhdGUtPmJhc2Uu
dmlzaWJsZSkKKwlpZiAoIXBsYW5lX3N0YXRlLT51YXBpLnZpc2libGUpCiAJCXJldHVybiAwOwog
CiAJcmV0ID0gaW50ZWxfcGxhbmVfY2hlY2tfc3JjX2Nvb3JkaW5hdGVzKHBsYW5lX3N0YXRlKTsK
QEAgLTIwNDgsNyArMjA0OCw3IEBAIHZsdl9zcHJpdGVfY2hlY2soc3RydWN0IGludGVsX2NydGNf
c3RhdGUgKmNydGNfc3RhdGUsCiBzdGF0aWMgaW50IHNrbF9wbGFuZV9jaGVja19mYihjb25zdCBz
dHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSwKIAkJCSAgICAgIGNvbnN0IHN0cnVj
dCBpbnRlbF9wbGFuZV9zdGF0ZSAqcGxhbmVfc3RhdGUpCiB7Ci0Jc3RydWN0IGludGVsX3BsYW5l
ICpwbGFuZSA9IHRvX2ludGVsX3BsYW5lKHBsYW5lX3N0YXRlLT5iYXNlLnBsYW5lKTsKKwlzdHJ1
Y3QgaW50ZWxfcGxhbmUgKnBsYW5lID0gdG9faW50ZWxfcGxhbmUocGxhbmVfc3RhdGUtPnVhcGku
cGxhbmUpOwogCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUocGxh
bmUtPmJhc2UuZGV2KTsKIAljb25zdCBzdHJ1Y3QgZHJtX2ZyYW1lYnVmZmVyICpmYiA9IHBsYW5l
X3N0YXRlLT5ody5mYjsKIAl1bnNpZ25lZCBpbnQgcm90YXRpb24gPSBwbGFuZV9zdGF0ZS0+aHcu
cm90YXRpb247CkBAIC0yMTIzLDkgKzIxMjMsOSBAQCBzdGF0aWMgaW50IHNrbF9wbGFuZV9jaGVj
a19kc3RfY29vcmRpbmF0ZXMoY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfcwog
CQkJCQkgICBjb25zdCBzdHJ1Y3QgaW50ZWxfcGxhbmVfc3RhdGUgKnBsYW5lX3N0YXRlKQogewog
CXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9Ci0JCXRvX2k5MTUocGxhbmVfc3Rh
dGUtPmJhc2UucGxhbmUtPmRldik7Ci0JaW50IGNydGNfeCA9IHBsYW5lX3N0YXRlLT5iYXNlLmRz
dC54MTsKLQlpbnQgY3J0Y193ID0gZHJtX3JlY3Rfd2lkdGgoJnBsYW5lX3N0YXRlLT5iYXNlLmRz
dCk7CisJCXRvX2k5MTUocGxhbmVfc3RhdGUtPnVhcGkucGxhbmUtPmRldik7CisJaW50IGNydGNf
eCA9IHBsYW5lX3N0YXRlLT51YXBpLmRzdC54MTsKKwlpbnQgY3J0Y193ID0gZHJtX3JlY3Rfd2lk
dGgoJnBsYW5lX3N0YXRlLT51YXBpLmRzdCk7CiAJaW50IHBpcGVfc3JjX3cgPSBjcnRjX3N0YXRl
LT5waXBlX3NyY193OwogCiAJLyoKQEAgLTIxNTMsNyArMjE1Myw3IEBAIHN0YXRpYyBpbnQgc2ts
X3BsYW5lX2NoZWNrX252MTJfcm90YXRpb24oY29uc3Qgc3RydWN0IGludGVsX3BsYW5lX3N0YXRl
ICpwbGFuZV9zCiB7CiAJY29uc3Qgc3RydWN0IGRybV9mcmFtZWJ1ZmZlciAqZmIgPSBwbGFuZV9z
dGF0ZS0+aHcuZmI7CiAJdW5zaWduZWQgaW50IHJvdGF0aW9uID0gcGxhbmVfc3RhdGUtPmh3LnJv
dGF0aW9uOwotCWludCBzcmNfdyA9IGRybV9yZWN0X3dpZHRoKCZwbGFuZV9zdGF0ZS0+YmFzZS5z
cmMpID4+IDE2OworCWludCBzcmNfdyA9IGRybV9yZWN0X3dpZHRoKCZwbGFuZV9zdGF0ZS0+dWFw
aS5zcmMpID4+IDE2OwogCiAJLyogRGlzcGxheSBXQSAjMTEwNiAqLwogCWlmIChkcm1fZm9ybWF0
X2luZm9faXNfeXV2X3NlbWlwbGFuYXIoZmItPmZvcm1hdCkgJiYgc3JjX3cgJiAzICYmCkBAIC0y
MTg1LDcgKzIxODUsNyBAQCBzdGF0aWMgaW50IHNrbF9wbGFuZV9tYXhfc2NhbGUoc3RydWN0IGRy
bV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAogc3RhdGljIGludCBza2xfcGxhbmVfY2hlY2soc3Ry
dWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUsCiAJCQkgICBzdHJ1Y3QgaW50ZWxfcGxh
bmVfc3RhdGUgKnBsYW5lX3N0YXRlKQogewotCXN0cnVjdCBpbnRlbF9wbGFuZSAqcGxhbmUgPSB0
b19pbnRlbF9wbGFuZShwbGFuZV9zdGF0ZS0+YmFzZS5wbGFuZSk7CisJc3RydWN0IGludGVsX3Bs
YW5lICpwbGFuZSA9IHRvX2ludGVsX3BsYW5lKHBsYW5lX3N0YXRlLT51YXBpLnBsYW5lKTsKIAlz
dHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KHBsYW5lLT5iYXNlLmRl
dik7CiAJY29uc3Qgc3RydWN0IGRybV9mcmFtZWJ1ZmZlciAqZmIgPSBwbGFuZV9zdGF0ZS0+aHcu
ZmI7CiAJaW50IG1pbl9zY2FsZSA9IERSTV9QTEFORV9IRUxQRVJfTk9fU0NBTElORzsKQEAgLTIy
MDIsNyArMjIwMiw3IEBAIHN0YXRpYyBpbnQgc2tsX3BsYW5lX2NoZWNrKHN0cnVjdCBpbnRlbF9j
cnRjX3N0YXRlICpjcnRjX3N0YXRlLAogCQltYXhfc2NhbGUgPSBza2xfcGxhbmVfbWF4X3NjYWxl
KGRldl9wcml2LCBmYik7CiAJfQogCi0JcmV0ID0gZHJtX2F0b21pY19oZWxwZXJfY2hlY2tfcGxh
bmVfc3RhdGUoJnBsYW5lX3N0YXRlLT5iYXNlLAorCXJldCA9IGRybV9hdG9taWNfaGVscGVyX2No
ZWNrX3BsYW5lX3N0YXRlKCZwbGFuZV9zdGF0ZS0+dWFwaSwKIAkJCQkJCSAgJmNydGNfc3RhdGUt
PnVhcGksCiAJCQkJCQkgIG1pbl9zY2FsZSwgbWF4X3NjYWxlLAogCQkJCQkJICB0cnVlLCB0cnVl
KTsKQEAgLTIyMTMsNyArMjIxMyw3IEBAIHN0YXRpYyBpbnQgc2tsX3BsYW5lX2NoZWNrKHN0cnVj
dCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlLAogCWlmIChyZXQpCiAJCXJldHVybiByZXQ7
CiAKLQlpZiAoIXBsYW5lX3N0YXRlLT5iYXNlLnZpc2libGUpCisJaWYgKCFwbGFuZV9zdGF0ZS0+
dWFwaS52aXNpYmxlKQogCQlyZXR1cm4gMDsKIAogCXJldCA9IHNrbF9wbGFuZV9jaGVja19kc3Rf
Y29vcmRpbmF0ZXMoY3J0Y19zdGF0ZSwgcGxhbmVfc3RhdGUpOwpAQCAtMjIzMCw3ICsyMjMwLDcg
QEAgc3RhdGljIGludCBza2xfcGxhbmVfY2hlY2soc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNy
dGNfc3RhdGUsCiAKIAkvKiBIVyBvbmx5IGhhcyA4IGJpdHMgcGl4ZWwgcHJlY2lzaW9uLCBkaXNh
YmxlIHBsYW5lIGlmIGludmlzaWJsZSAqLwogCWlmICghKHBsYW5lX3N0YXRlLT5ody5hbHBoYSA+
PiA4KSkKLQkJcGxhbmVfc3RhdGUtPmJhc2UudmlzaWJsZSA9IGZhbHNlOworCQlwbGFuZV9zdGF0
ZS0+dWFwaS52aXNpYmxlID0gZmFsc2U7CiAKIAlwbGFuZV9zdGF0ZS0+Y3RsID0gc2tsX3BsYW5l
X2N0bChjcnRjX3N0YXRlLCBwbGFuZV9zdGF0ZSk7CiAKQEAgLTIyNDksNyArMjI0OSw3IEBAIHN0
YXRpYyBib29sIGhhc19kc3Rfa2V5X2luX3ByaW1hcnlfcGxhbmUoc3RydWN0IGRybV9pOTE1X3By
aXZhdGUgKmRldl9wcml2KQogc3RhdGljIHZvaWQgaW50ZWxfcGxhbmVfc2V0X2NrZXkoc3RydWN0
IGludGVsX3BsYW5lX3N0YXRlICpwbGFuZV9zdGF0ZSwKIAkJCQkgY29uc3Qgc3RydWN0IGRybV9p
bnRlbF9zcHJpdGVfY29sb3JrZXkgKnNldCkKIHsKLQlzdHJ1Y3QgaW50ZWxfcGxhbmUgKnBsYW5l
ID0gdG9faW50ZWxfcGxhbmUocGxhbmVfc3RhdGUtPmJhc2UucGxhbmUpOworCXN0cnVjdCBpbnRl
bF9wbGFuZSAqcGxhbmUgPSB0b19pbnRlbF9wbGFuZShwbGFuZV9zdGF0ZS0+dWFwaS5wbGFuZSk7
CiAJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShwbGFuZS0+YmFz
ZS5kZXYpOwogCXN0cnVjdCBkcm1faW50ZWxfc3ByaXRlX2NvbG9ya2V5ICprZXkgPSAmcGxhbmVf
c3RhdGUtPmNrZXk7CiAKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2ludGVsX3Bt
LmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pbnRlbF9wbS5jCmluZGV4IDBhMDEwM2VjZjdiYy4u
MmQzODllNDM3ZTg3IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pbnRlbF9wbS5j
CisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2ludGVsX3BtLmMKQEAgLTc4Niw3ICs3ODYsNyBA
QCBzdGF0aWMgaW50IGludGVsX3dtX251bV9sZXZlbHMoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUg
KmRldl9wcml2KQogc3RhdGljIGJvb2wgaW50ZWxfd21fcGxhbmVfdmlzaWJsZShjb25zdCBzdHJ1
Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSwKIAkJCQkgICBjb25zdCBzdHJ1Y3QgaW50
ZWxfcGxhbmVfc3RhdGUgKnBsYW5lX3N0YXRlKQogewotCXN0cnVjdCBpbnRlbF9wbGFuZSAqcGxh
bmUgPSB0b19pbnRlbF9wbGFuZShwbGFuZV9zdGF0ZS0+YmFzZS5wbGFuZSk7CisJc3RydWN0IGlu
dGVsX3BsYW5lICpwbGFuZSA9IHRvX2ludGVsX3BsYW5lKHBsYW5lX3N0YXRlLT51YXBpLnBsYW5l
KTsKIAogCS8qIEZJWE1FIGNoZWNrIHRoZSAnZW5hYmxlJyBpbnN0ZWFkICovCiAJaWYgKCFjcnRj
X3N0YXRlLT5ody5hY3RpdmUpCkBAIC04MDMsNyArODAzLDcgQEAgc3RhdGljIGJvb2wgaW50ZWxf
d21fcGxhbmVfdmlzaWJsZShjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0
ZSwKIAlpZiAocGxhbmUtPmlkID09IFBMQU5FX0NVUlNPUikKIAkJcmV0dXJuIHBsYW5lX3N0YXRl
LT5ody5mYiAhPSBOVUxMOwogCWVsc2UKLQkJcmV0dXJuIHBsYW5lX3N0YXRlLT5iYXNlLnZpc2li
bGU7CisJCXJldHVybiBwbGFuZV9zdGF0ZS0+dWFwaS52aXNpYmxlOwogfQogCiBzdGF0aWMgc3Ry
dWN0IGludGVsX2NydGMgKnNpbmdsZV9lbmFibGVkX2NydGMoc3RydWN0IGRybV9pOTE1X3ByaXZh
dGUgKmRldl9wcml2KQpAQCAtMTA3NSw3ICsxMDc1LDcgQEAgc3RhdGljIHUxNiBnNHhfY29tcHV0
ZV93bShjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSwKIAkJCSAgY29u
c3Qgc3RydWN0IGludGVsX3BsYW5lX3N0YXRlICpwbGFuZV9zdGF0ZSwKIAkJCSAgaW50IGxldmVs
KQogewotCXN0cnVjdCBpbnRlbF9wbGFuZSAqcGxhbmUgPSB0b19pbnRlbF9wbGFuZShwbGFuZV9z
dGF0ZS0+YmFzZS5wbGFuZSk7CisJc3RydWN0IGludGVsX3BsYW5lICpwbGFuZSA9IHRvX2ludGVs
X3BsYW5lKHBsYW5lX3N0YXRlLT51YXBpLnBsYW5lKTsKIAlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0
ZSAqZGV2X3ByaXYgPSB0b19pOTE1KHBsYW5lLT5iYXNlLmRldik7CiAJY29uc3Qgc3RydWN0IGRy
bV9kaXNwbGF5X21vZGUgKmFkanVzdGVkX21vZGUgPQogCQkmY3J0Y19zdGF0ZS0+aHcuYWRqdXN0
ZWRfbW9kZTsKQEAgLTExMDgsNyArMTEwOCw3IEBAIHN0YXRpYyB1MTYgZzR4X2NvbXB1dGVfd20o
Y29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUsCiAJY2xvY2sgPSBhZGp1
c3RlZF9tb2RlLT5jcnRjX2Nsb2NrOwogCWh0b3RhbCA9IGFkanVzdGVkX21vZGUtPmNydGNfaHRv
dGFsOwogCi0Jd2lkdGggPSBkcm1fcmVjdF93aWR0aCgmcGxhbmVfc3RhdGUtPmJhc2UuZHN0KTsK
Kwl3aWR0aCA9IGRybV9yZWN0X3dpZHRoKCZwbGFuZV9zdGF0ZS0+dWFwaS5kc3QpOwogCiAJaWYg
KHBsYW5lLT5pZCA9PSBQTEFORV9DVVJTT1IpIHsKIAkJd20gPSBpbnRlbF93bV9tZXRob2QyKGNs
b2NrLCBodG90YWwsIHdpZHRoLCBjcHAsIGxhdGVuY3kpOwpAQCAtMTE3NCw3ICsxMTc0LDcgQEAg
c3RhdGljIHUzMiBpbGtfY29tcHV0ZV9mYmNfd20oY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3Rh
dGUgKmNydGNfc3RhdGUsCiBzdGF0aWMgYm9vbCBnNHhfcmF3X3BsYW5lX3dtX2NvbXB1dGUoc3Ry
dWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUsCiAJCQkJICAgICBjb25zdCBzdHJ1Y3Qg
aW50ZWxfcGxhbmVfc3RhdGUgKnBsYW5lX3N0YXRlKQogewotCXN0cnVjdCBpbnRlbF9wbGFuZSAq
cGxhbmUgPSB0b19pbnRlbF9wbGFuZShwbGFuZV9zdGF0ZS0+YmFzZS5wbGFuZSk7CisJc3RydWN0
IGludGVsX3BsYW5lICpwbGFuZSA9IHRvX2ludGVsX3BsYW5lKHBsYW5lX3N0YXRlLT51YXBpLnBs
YW5lKTsKIAlpbnQgbnVtX2xldmVscyA9IGludGVsX3dtX251bV9sZXZlbHModG9faTkxNShwbGFu
ZS0+YmFzZS5kZXYpKTsKIAllbnVtIHBsYW5lX2lkIHBsYW5lX2lkID0gcGxhbmUtPmlkOwogCWJv
b2wgZGlydHkgPSBmYWxzZTsKQEAgLTE1ODEsNyArMTU4MSw3IEBAIHN0YXRpYyB1MTYgdmx2X2Nv
bXB1dGVfd21fbGV2ZWwoY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUs
CiAJCQkJY29uc3Qgc3RydWN0IGludGVsX3BsYW5lX3N0YXRlICpwbGFuZV9zdGF0ZSwKIAkJCQlp
bnQgbGV2ZWwpCiB7Ci0Jc3RydWN0IGludGVsX3BsYW5lICpwbGFuZSA9IHRvX2ludGVsX3BsYW5l
KHBsYW5lX3N0YXRlLT5iYXNlLnBsYW5lKTsKKwlzdHJ1Y3QgaW50ZWxfcGxhbmUgKnBsYW5lID0g
dG9faW50ZWxfcGxhbmUocGxhbmVfc3RhdGUtPnVhcGkucGxhbmUpOwogCXN0cnVjdCBkcm1faTkx
NV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUocGxhbmUtPmJhc2UuZGV2KTsKIAljb25zdCBz
dHJ1Y3QgZHJtX2Rpc3BsYXlfbW9kZSAqYWRqdXN0ZWRfbW9kZSA9CiAJCSZjcnRjX3N0YXRlLT5o
dy5hZGp1c3RlZF9tb2RlOwpAQCAtMTc1MSw3ICsxNzUxLDcgQEAgc3RhdGljIGJvb2wgdmx2X3Jh
d19wbGFuZV93bV9zZXQoc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUsCiBzdGF0
aWMgYm9vbCB2bHZfcmF3X3BsYW5lX3dtX2NvbXB1dGUoc3RydWN0IGludGVsX2NydGNfc3RhdGUg
KmNydGNfc3RhdGUsCiAJCQkJICAgICBjb25zdCBzdHJ1Y3QgaW50ZWxfcGxhbmVfc3RhdGUgKnBs
YW5lX3N0YXRlKQogewotCXN0cnVjdCBpbnRlbF9wbGFuZSAqcGxhbmUgPSB0b19pbnRlbF9wbGFu
ZShwbGFuZV9zdGF0ZS0+YmFzZS5wbGFuZSk7CisJc3RydWN0IGludGVsX3BsYW5lICpwbGFuZSA9
IHRvX2ludGVsX3BsYW5lKHBsYW5lX3N0YXRlLT51YXBpLnBsYW5lKTsKIAllbnVtIHBsYW5lX2lk
IHBsYW5lX2lkID0gcGxhbmUtPmlkOwogCWludCBudW1fbGV2ZWxzID0gaW50ZWxfd21fbnVtX2xl
dmVscyh0b19pOTE1KHBsYW5lLT5iYXNlLmRldikpOwogCWludCBsZXZlbDsKQEAgLTI0ODQsNyAr
MjQ4NCw3IEBAIHN0YXRpYyB1MzIgaWxrX2NvbXB1dGVfcHJpX3dtKGNvbnN0IHN0cnVjdCBpbnRl
bF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlLAogCiAJbWV0aG9kMiA9IGlsa193bV9tZXRob2QyKGNy
dGNfc3RhdGUtPnBpeGVsX3JhdGUsCiAJCQkJIGNydGNfc3RhdGUtPmh3LmFkanVzdGVkX21vZGUu
Y3J0Y19odG90YWwsCi0JCQkJIGRybV9yZWN0X3dpZHRoKCZwbGFuZV9zdGF0ZS0+YmFzZS5kc3Qp
LAorCQkJCSBkcm1fcmVjdF93aWR0aCgmcGxhbmVfc3RhdGUtPnVhcGkuZHN0KSwKIAkJCQkgY3Bw
LCBtZW1fdmFsdWUpOwogCiAJcmV0dXJuIG1pbihtZXRob2QxLCBtZXRob2QyKTsKQEAgLTI1MTIs
NyArMjUxMiw3IEBAIHN0YXRpYyB1MzIgaWxrX2NvbXB1dGVfc3ByX3dtKGNvbnN0IHN0cnVjdCBp
bnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlLAogCW1ldGhvZDEgPSBpbGtfd21fbWV0aG9kMShj
cnRjX3N0YXRlLT5waXhlbF9yYXRlLCBjcHAsIG1lbV92YWx1ZSk7CiAJbWV0aG9kMiA9IGlsa193
bV9tZXRob2QyKGNydGNfc3RhdGUtPnBpeGVsX3JhdGUsCiAJCQkJIGNydGNfc3RhdGUtPmh3LmFk
anVzdGVkX21vZGUuY3J0Y19odG90YWwsCi0JCQkJIGRybV9yZWN0X3dpZHRoKCZwbGFuZV9zdGF0
ZS0+YmFzZS5kc3QpLAorCQkJCSBkcm1fcmVjdF93aWR0aCgmcGxhbmVfc3RhdGUtPnVhcGkuZHN0
KSwKIAkJCQkgY3BwLCBtZW1fdmFsdWUpOwogCXJldHVybiBtaW4obWV0aG9kMSwgbWV0aG9kMik7
CiB9CkBAIC0yNTM3LDcgKzI1MzcsNyBAQCBzdGF0aWMgdTMyIGlsa19jb21wdXRlX2N1cl93bShj
b25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSwKIAogCXJldHVybiBpbGtf
d21fbWV0aG9kMihjcnRjX3N0YXRlLT5waXhlbF9yYXRlLAogCQkJICAgICAgY3J0Y19zdGF0ZS0+
aHcuYWRqdXN0ZWRfbW9kZS5jcnRjX2h0b3RhbCwKLQkJCSAgICAgIGRybV9yZWN0X3dpZHRoKCZw
bGFuZV9zdGF0ZS0+YmFzZS5kc3QpLAorCQkJICAgICAgZHJtX3JlY3Rfd2lkdGgoJnBsYW5lX3N0
YXRlLT51YXBpLmRzdCksCiAJCQkgICAgICBjcHAsIG1lbV92YWx1ZSk7CiB9CiAKQEAgLTI1NTMs
NyArMjU1Myw4IEBAIHN0YXRpYyB1MzIgaWxrX2NvbXB1dGVfZmJjX3dtKGNvbnN0IHN0cnVjdCBp
bnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlLAogCiAJY3BwID0gcGxhbmVfc3RhdGUtPmh3LmZi
LT5mb3JtYXQtPmNwcFswXTsKIAotCXJldHVybiBpbGtfd21fZmJjKHByaV92YWwsIGRybV9yZWN0
X3dpZHRoKCZwbGFuZV9zdGF0ZS0+YmFzZS5kc3QpLCBjcHApOworCXJldHVybiBpbGtfd21fZmJj
KHByaV92YWwsIGRybV9yZWN0X3dpZHRoKCZwbGFuZV9zdGF0ZS0+dWFwaS5kc3QpLAorCQkJICBj
cHApOwogfQogCiBzdGF0aWMgdW5zaWduZWQgaW50CkBAIC0zMDk3LDEwICszMDk4LDEwIEBAIHN0
YXRpYyBpbnQgaWxrX2NvbXB1dGVfcGlwZV93bShzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0
Y19zdGF0ZSkKIAogCXBpcGVfd20tPnBpcGVfZW5hYmxlZCA9IGNydGNfc3RhdGUtPmh3LmFjdGl2
ZTsKIAlpZiAoc3Byc3RhdGUpIHsKLQkJcGlwZV93bS0+c3ByaXRlc19lbmFibGVkID0gc3Byc3Rh
dGUtPmJhc2UudmlzaWJsZTsKLQkJcGlwZV93bS0+c3ByaXRlc19zY2FsZWQgPSBzcHJzdGF0ZS0+
YmFzZS52aXNpYmxlICYmCi0JCQkoZHJtX3JlY3Rfd2lkdGgoJnNwcnN0YXRlLT5iYXNlLmRzdCkg
IT0gZHJtX3JlY3Rfd2lkdGgoJnNwcnN0YXRlLT5iYXNlLnNyYykgPj4gMTYgfHwKLQkJCSBkcm1f
cmVjdF9oZWlnaHQoJnNwcnN0YXRlLT5iYXNlLmRzdCkgIT0gZHJtX3JlY3RfaGVpZ2h0KCZzcHJz
dGF0ZS0+YmFzZS5zcmMpID4+IDE2KTsKKwkJcGlwZV93bS0+c3ByaXRlc19lbmFibGVkID0gc3By
c3RhdGUtPnVhcGkudmlzaWJsZTsKKwkJcGlwZV93bS0+c3ByaXRlc19zY2FsZWQgPSBzcHJzdGF0
ZS0+dWFwaS52aXNpYmxlICYmCisJCQkoZHJtX3JlY3Rfd2lkdGgoJnNwcnN0YXRlLT51YXBpLmRz
dCkgIT0gZHJtX3JlY3Rfd2lkdGgoJnNwcnN0YXRlLT51YXBpLnNyYykgPj4gMTYgfHwKKwkJCSBk
cm1fcmVjdF9oZWlnaHQoJnNwcnN0YXRlLT51YXBpLmRzdCkgIT0gZHJtX3JlY3RfaGVpZ2h0KCZz
cHJzdGF0ZS0+dWFwaS5zcmMpID4+IDE2KTsKIAl9CiAKIAl1c2FibGVfbGV2ZWwgPSBtYXhfbGV2
ZWw7CkBAIC00MDcyLDEwICs0MDczLDEwIEBAIHNrbF9wbGFuZV9kb3duc2NhbGVfYW1vdW50KGNv
bnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlLAogCSAqCiAJICogbi5iLiwg
c3JjIGlzIDE2LjE2IGZpeGVkIHBvaW50LCBkc3QgaXMgd2hvbGUgaW50ZWdlci4KIAkgKi8KLQlz
cmNfdyA9IGRybV9yZWN0X3dpZHRoKCZwbGFuZV9zdGF0ZS0+YmFzZS5zcmMpID4+IDE2OwotCXNy
Y19oID0gZHJtX3JlY3RfaGVpZ2h0KCZwbGFuZV9zdGF0ZS0+YmFzZS5zcmMpID4+IDE2OwotCWRz
dF93ID0gZHJtX3JlY3Rfd2lkdGgoJnBsYW5lX3N0YXRlLT5iYXNlLmRzdCk7Ci0JZHN0X2ggPSBk
cm1fcmVjdF9oZWlnaHQoJnBsYW5lX3N0YXRlLT5iYXNlLmRzdCk7CisJc3JjX3cgPSBkcm1fcmVj
dF93aWR0aCgmcGxhbmVfc3RhdGUtPnVhcGkuc3JjKSA+PiAxNjsKKwlzcmNfaCA9IGRybV9yZWN0
X2hlaWdodCgmcGxhbmVfc3RhdGUtPnVhcGkuc3JjKSA+PiAxNjsKKwlkc3RfdyA9IGRybV9yZWN0
X3dpZHRoKCZwbGFuZV9zdGF0ZS0+dWFwaS5kc3QpOworCWRzdF9oID0gZHJtX3JlY3RfaGVpZ2h0
KCZwbGFuZV9zdGF0ZS0+dWFwaS5kc3QpOwogCiAJZnBfd19yYXRpbyA9IGRpdl9maXhlZDE2KHNy
Y193LCBkc3Rfdyk7CiAJZnBfaF9yYXRpbyA9IGRpdl9maXhlZDE2KHNyY19oLCBkc3RfaCk7CkBA
IC00MDkwLDE0ICs0MDkxLDE0IEBAIHNrbF9wbGFuZV9yZWxhdGl2ZV9kYXRhX3JhdGUoY29uc3Qg
c3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUsCiAJCQkgICAgIGNvbnN0IHN0cnVj
dCBpbnRlbF9wbGFuZV9zdGF0ZSAqcGxhbmVfc3RhdGUsCiAJCQkgICAgIGludCBjb2xvcl9wbGFu
ZSkKIHsKLQlzdHJ1Y3QgaW50ZWxfcGxhbmUgKnBsYW5lID0gdG9faW50ZWxfcGxhbmUocGxhbmVf
c3RhdGUtPmJhc2UucGxhbmUpOworCXN0cnVjdCBpbnRlbF9wbGFuZSAqcGxhbmUgPSB0b19pbnRl
bF9wbGFuZShwbGFuZV9zdGF0ZS0+dWFwaS5wbGFuZSk7CiAJY29uc3Qgc3RydWN0IGRybV9mcmFt
ZWJ1ZmZlciAqZmIgPSBwbGFuZV9zdGF0ZS0+aHcuZmI7CiAJdTMyIGRhdGFfcmF0ZTsKIAl1MzIg
d2lkdGggPSAwLCBoZWlnaHQgPSAwOwogCXVpbnRfZml4ZWRfMTZfMTZfdCBkb3duX3NjYWxlX2Ft
b3VudDsKIAl1NjQgcmF0ZTsKIAotCWlmICghcGxhbmVfc3RhdGUtPmJhc2UudmlzaWJsZSkKKwlp
ZiAoIXBsYW5lX3N0YXRlLT51YXBpLnZpc2libGUpCiAJCXJldHVybiAwOwogCiAJaWYgKHBsYW5l
LT5pZCA9PSBQTEFORV9DVVJTT1IpCkBAIC00MTEyLDggKzQxMTMsOCBAQCBza2xfcGxhbmVfcmVs
YXRpdmVfZGF0YV9yYXRlKGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRl
LAogCSAqIHRoZSA5MC8yNzAgZGVncmVlIHBsYW5lIHJvdGF0aW9uIGNhc2VzICh0byBtYXRjaCB0
aGUKIAkgKiBHVFQgbWFwcGluZyksIGhlbmNlIG5vIG5lZWQgdG8gYWNjb3VudCBmb3Igcm90YXRp
b24gaGVyZS4KIAkgKi8KLQl3aWR0aCA9IGRybV9yZWN0X3dpZHRoKCZwbGFuZV9zdGF0ZS0+YmFz
ZS5zcmMpID4+IDE2OwotCWhlaWdodCA9IGRybV9yZWN0X2hlaWdodCgmcGxhbmVfc3RhdGUtPmJh
c2Uuc3JjKSA+PiAxNjsKKwl3aWR0aCA9IGRybV9yZWN0X3dpZHRoKCZwbGFuZV9zdGF0ZS0+dWFw
aS5zcmMpID4+IDE2OworCWhlaWdodCA9IGRybV9yZWN0X2hlaWdodCgmcGxhbmVfc3RhdGUtPnVh
cGkuc3JjKSA+PiAxNjsKIAogCS8qIFVWIHBsYW5lIGRvZXMgMS8yIHBpeGVsIHN1Yi1zYW1wbGlu
ZyAqLwogCWlmIChjb2xvcl9wbGFuZSA9PSAxKSB7CkBAIC00NjIwLDcgKzQ2MjEsNyBAQCBza2xf
Y29tcHV0ZV9wbGFuZV93bV9wYXJhbXMoY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNy
dGNfc3RhdGUsCiAJICogdGhlIDkwLzI3MCBkZWdyZWUgcGxhbmUgcm90YXRpb24gY2FzZXMgKHRv
IG1hdGNoIHRoZQogCSAqIEdUVCBtYXBwaW5nKSwgaGVuY2Ugbm8gbmVlZCB0byBhY2NvdW50IGZv
ciByb3RhdGlvbiBoZXJlLgogCSAqLwotCXdpZHRoID0gZHJtX3JlY3Rfd2lkdGgoJnBsYW5lX3N0
YXRlLT5iYXNlLnNyYykgPj4gMTY7CisJd2lkdGggPSBkcm1fcmVjdF93aWR0aCgmcGxhbmVfc3Rh
dGUtPnVhcGkuc3JjKSA+PiAxNjsKIAogCXJldHVybiBza2xfY29tcHV0ZV93bV9wYXJhbXMoY3J0
Y19zdGF0ZSwgd2lkdGgsCiAJCQkJICAgICBmYi0+Zm9ybWF0LCBmYi0+bW9kaWZpZXIsCkBAIC00
OTAyLDcgKzQ5MDMsNyBAQCBzdGF0aWMgaW50IHNrbF9idWlsZF9wbGFuZV93bV91dihzdHJ1Y3Qg
aW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSwKIHN0YXRpYyBpbnQgc2tsX2J1aWxkX3BsYW5l
X3dtKHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlLAogCQkJICAgICAgY29uc3Qg
c3RydWN0IGludGVsX3BsYW5lX3N0YXRlICpwbGFuZV9zdGF0ZSkKIHsKLQlzdHJ1Y3QgaW50ZWxf
cGxhbmUgKnBsYW5lID0gdG9faW50ZWxfcGxhbmUocGxhbmVfc3RhdGUtPmJhc2UucGxhbmUpOwor
CXN0cnVjdCBpbnRlbF9wbGFuZSAqcGxhbmUgPSB0b19pbnRlbF9wbGFuZShwbGFuZV9zdGF0ZS0+
dWFwaS5wbGFuZSk7CiAJY29uc3Qgc3RydWN0IGRybV9mcmFtZWJ1ZmZlciAqZmIgPSBwbGFuZV9z
dGF0ZS0+aHcuZmI7CiAJZW51bSBwbGFuZV9pZCBwbGFuZV9pZCA9IHBsYW5lLT5pZDsKIAlpbnQg
cmV0OwpAQCAtNDkyOCw3ICs0OTI5LDcgQEAgc3RhdGljIGludCBza2xfYnVpbGRfcGxhbmVfd20o
c3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUsCiBzdGF0aWMgaW50IGljbF9idWls
ZF9wbGFuZV93bShzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSwKIAkJCSAgICAg
IGNvbnN0IHN0cnVjdCBpbnRlbF9wbGFuZV9zdGF0ZSAqcGxhbmVfc3RhdGUpCiB7Ci0JZW51bSBw
bGFuZV9pZCBwbGFuZV9pZCA9IHRvX2ludGVsX3BsYW5lKHBsYW5lX3N0YXRlLT5iYXNlLnBsYW5l
KS0+aWQ7CisJZW51bSBwbGFuZV9pZCBwbGFuZV9pZCA9IHRvX2ludGVsX3BsYW5lKHBsYW5lX3N0
YXRlLT51YXBpLnBsYW5lKS0+aWQ7CiAJaW50IHJldDsKIAogCS8qIFdhdGVybWFya3MgY2FsY3Vs
YXRlZCBpbiBtYXN0ZXIgKi8KQEAgLTU5MjgsNyArNTkyOSw3IEBAIHZvaWQgZzR4X3dtX3Nhbml0
aXplKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikKIAkJZW51bSBwbGFuZV9pZCBw
bGFuZV9pZCA9IHBsYW5lLT5pZDsKIAkJaW50IGxldmVsOwogCi0JCWlmIChwbGFuZV9zdGF0ZS0+
YmFzZS52aXNpYmxlKQorCQlpZiAocGxhbmVfc3RhdGUtPnVhcGkudmlzaWJsZSkKIAkJCWNvbnRp
bnVlOwogCiAJCWZvciAobGV2ZWwgPSAwOyBsZXZlbCA8IDM7IGxldmVsKyspIHsKQEAgLTYwODMs
NyArNjA4NCw3IEBAIHZvaWQgdmx2X3dtX3Nhbml0aXplKHN0cnVjdCBkcm1faTkxNV9wcml2YXRl
ICpkZXZfcHJpdikKIAkJZW51bSBwbGFuZV9pZCBwbGFuZV9pZCA9IHBsYW5lLT5pZDsKIAkJaW50
IGxldmVsOwogCi0JCWlmIChwbGFuZV9zdGF0ZS0+YmFzZS52aXNpYmxlKQorCQlpZiAocGxhbmVf
c3RhdGUtPnVhcGkudmlzaWJsZSkKIAkJCWNvbnRpbnVlOwogCiAJCWZvciAobGV2ZWwgPSAwOyBs
ZXZlbCA8IHdtX3N0YXRlLT5udW1fbGV2ZWxzOyBsZXZlbCsrKSB7Ci0tIAoyLjIzLjAKCl9fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fCkludGVsLWdmeCBtYWls
aW5nIGxpc3QKSW50ZWwtZ2Z4QGxpc3RzLmZyZWVkZXNrdG9wLm9yZwpodHRwczovL2xpc3RzLmZy
ZWVkZXNrdG9wLm9yZy9tYWlsbWFuL2xpc3RpbmZvL2ludGVsLWdmeA==

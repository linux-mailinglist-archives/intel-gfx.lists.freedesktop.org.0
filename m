Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 6474E4C33A
	for <lists+intel-gfx@lfdr.de>; Wed, 19 Jun 2019 23:44:17 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id D1F2D6E47F;
	Wed, 19 Jun 2019 21:44:15 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from mga02.intel.com (mga02.intel.com [134.134.136.20])
 by gabe.freedesktop.org (Postfix) with ESMTPS id D06186E47F
 for <intel-gfx@lists.freedesktop.org>; Wed, 19 Jun 2019 21:44:13 +0000 (UTC)
X-Amp-Result: SKIPPED(no attachment in message)
X-Amp-File-Uploaded: False
Received: from orsmga008.jf.intel.com ([10.7.209.65])
 by orsmga101.jf.intel.com with ESMTP/TLS/DHE-RSA-AES256-GCM-SHA384;
 19 Jun 2019 14:44:13 -0700
X-ExtLoop1: 1
X-IronPort-AV: E=Sophos;i="5.63,394,1557212400"; d="scan'208";a="153925267"
Received: from dceraolo-linux.fm.intel.com ([10.1.27.145])
 by orsmga008.jf.intel.com with ESMTP; 19 Jun 2019 14:44:13 -0700
From: Daniele Ceraolo Spurio <daniele.ceraolospurio@intel.com>
To: intel-gfx@lists.freedesktop.org
Date: Wed, 19 Jun 2019 14:43:51 -0700
Message-Id: <20190619214351.12000-3-daniele.ceraolospurio@intel.com>
X-Mailer: git-send-email 2.20.1
In-Reply-To: <20190619214351.12000-1-daniele.ceraolospurio@intel.com>
References: <20190619214351.12000-1-daniele.ceraolospurio@intel.com>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH 2/2] drm/i915/guc: handle GuC messages received
 with CTB disabled
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

VGhlcmUgaXMgYSB2ZXJ5IHNtYWxsIGNoYW5jZSBvZiB0cmlnZ2VyaW5nIGEgbG9nIGZsdXNoIGV2
ZW50IHdoZW4KZW5hYmxpbmcgb3IgZGlzYWJsaW5nIENUIGJ1ZmZlcnMuIEV2ZW50cyB0cmlnZ2Vy
ZWQgd2hpbGUgQ1QgYnVmZmVycwphcmUgZGlzYWJsZWQgYXJlIGxvZ2dlZCBpbiB0aGUgU0NSQVRD
SF8xNSByZWdpc3RlciB1c2luZyB0aGUgc2FtZSBiaXRzCnVzZWQgaW4gdGhlIENUIG1lc3NhZ2Ug
cGF5bG9hZC4gU2luY2Ugb3VyIGNvbW11bmljYXRpb24gY2hhbm5lbCB3aXRoCkd1QyBpcyB0dXJu
ZWQgb2ZmLCB3ZSBjYW4gc2F2ZSB0aGUgbWVzc2FnZSBhbmQgaGFuZGxlIGl0IGFmdGVyIHdlIHR1
cm4KaXQgYmFjayBvbi4KR3VDIHNob3VsZCBiZSBpZGxlIGFuZCBub3QgZ2VuZXJhdGUgbW9yZSBl
dmVudHMgaW4gdGhlIG1lYW50aW1lIGJlY2F1c2UKd2UncmUgbm90IHRhbGtpbmcgdG8gaXQuCgpT
aWduZWQtb2ZmLWJ5OiBEYW5pZWxlIENlcmFvbG8gU3B1cmlvIDxkYW5pZWxlLmNlcmFvbG9zcHVy
aW9AaW50ZWwuY29tPgpDYzogTWljaGFsIFdhamRlY3prbyA8bWljaGFsLndhamRlY3prb0BpbnRl
bC5jb20+CkNjOiBDaHJpcyBXaWxzb24gPGNocmlzQGNocmlzLXdpbHNvbi5jby51az4KLS0tCiBk
cml2ZXJzL2dwdS9kcm0vaTkxNS9pbnRlbF9ndWMuaCB8ICA1ICsrKwogZHJpdmVycy9ncHUvZHJt
L2k5MTUvaW50ZWxfdWMuYyAgfCA3MyArKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKwog
MiBmaWxlcyBjaGFuZ2VkLCA3OCBpbnNlcnRpb25zKCspCgpkaWZmIC0tZ2l0IGEvZHJpdmVycy9n
cHUvZHJtL2k5MTUvaW50ZWxfZ3VjLmggYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pbnRlbF9ndWMu
aAppbmRleCAwOGM5MDZhYmRmYTIuLmQ2YTc1YmMzZDdmNCAxMDA2NDQKLS0tIGEvZHJpdmVycy9n
cHUvZHJtL2k5MTUvaW50ZWxfZ3VjLmgKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50ZWxf
Z3VjLmgKQEAgLTg4LDYgKzg4LDkgQEAgc3RydWN0IGludGVsX2d1YyB7CiAJCWVudW0gZm9yY2V3
YWtlX2RvbWFpbnMgZndfZG9tYWluczsKIAl9IHNlbmRfcmVnczsKIAorCS8qIFN0b3JlIG1zZyAo
ZS5nLiBsb2cgZmx1c2gpIHRoYXQgd2Ugc2VlIHdoaWxlIENUQnMgYXJlIGRpc2FibGVkICovCisJ
dTMyIG1taW9fbXNnOworCiAJLyogVG8gc2VyaWFsaXplIHRoZSBpbnRlbF9ndWNfc2VuZCBhY3Rp
b25zICovCiAJc3RydWN0IG11dGV4IHNlbmRfbXV0ZXg7CiAKQEAgLTE4MSw2ICsxODQsOCBAQCBz
dGF0aWMgaW5saW5lIGJvb2wgaW50ZWxfZ3VjX2lzX2xvYWRlZChzdHJ1Y3QgaW50ZWxfZ3VjICpn
dWMpCiBzdGF0aWMgaW5saW5lIGludCBpbnRlbF9ndWNfc2FuaXRpemUoc3RydWN0IGludGVsX2d1
YyAqZ3VjKQogewogCWludGVsX3VjX2Z3X3Nhbml0aXplKCZndWMtPmZ3KTsKKwlndWMtPm1taW9f
bXNnID0gMDsKKwogCXJldHVybiAwOwogfQogCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0v
aTkxNS9pbnRlbF91Yy5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50ZWxfdWMuYwppbmRleCBj
N2Y4MmM5NDRkZDYuLjM4Yzg3ODg1YWFlMyAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5
MTUvaW50ZWxfdWMuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pbnRlbF91Yy5jCkBAIC0y
MTgsNiArMjE4LDU0IEBAIHN0YXRpYyB2b2lkIGd1Y19mcmVlX2xvYWRfZXJyX2xvZyhzdHJ1Y3Qg
aW50ZWxfZ3VjICpndWMpCiAJCWk5MTVfZ2VtX29iamVjdF9wdXQoZ3VjLT5sb2FkX2Vycl9sb2cp
OwogfQogCisvKgorICogRXZlbnRzIHRyaWdnZXJlZCB3aGlsZSBDVCBidWZmZXJzIGFyZSBkaXNh
YmxlZCBhcmUgbG9nZ2VkIGluIHRoZSBTQ1JBVENIXzE1CisgKiByZWdpc3RlciB1c2luZyB0aGUg
c2FtZSBiaXRzIHVzZWQgaW4gdGhlIENUIG1lc3NhZ2UgcGF5bG9hZC4gU2luY2Ugb3VyCisgKiBj
b21tdW5pY2F0aW9uIGNoYW5uZWwgd2l0aCBndWMgaXMgdHVybmVkIG9mZiBhdCB0aGlzIHBvaW50
LCB3ZSBjYW4gc2F2ZSB0aGUKKyAqIG1lc3NhZ2UgYW5kIGhhbmRsZSBpdCBhZnRlciB3ZSB0dXJu
IGl0IGJhY2sgb24uCisgKi8KK3N0YXRpYyB2b2lkIGd1Y19jbGVhcl9tbWlvX21zZyhzdHJ1Y3Qg
aW50ZWxfZ3VjICpndWMpCit7CisJaW50ZWxfdW5jb3JlX3dyaXRlKCZndWNfdG9faTkxNShndWMp
LT51bmNvcmUsIFNPRlRfU0NSQVRDSCgxNSksIDApOworfQorCitzdGF0aWMgdm9pZCBndWNfZ2V0
X21taW9fbXNnKHN0cnVjdCBpbnRlbF9ndWMgKmd1YykKK3sKKwl1MzIgdmFsOworCisJc3Bpbl9s
b2NrX2lycSgmZ3VjLT5pcnFfbG9jayk7CisKKwl2YWwgPSBpbnRlbF91bmNvcmVfcmVhZCgmZ3Vj
X3RvX2k5MTUoZ3VjKS0+dW5jb3JlLCBTT0ZUX1NDUkFUQ0goMTUpKTsKKwlndWMtPm1taW9fbXNn
IHw9IHZhbCAmIGd1Yy0+bXNnX2VuYWJsZWRfbWFzazsKKworCS8qCisJICogY2xlYXIgYWxsIGV2
ZW50cywgaW5jbHVkaW5nIHRoZSBvbmVzIHdlJ3JlIG5vdCBjdXJyZW50bHkgc2VydmljaW5nLAor
CSAqIHRvIG1ha2Ugc3VyZSB3ZSBkb24ndCB0cnkgdG8gcHJvY2VzcyBhIHN0YWxlIG1lc3NhZ2Ug
aWYgd2UgZW5hYmxlCisJICogaGFuZGxpbmcgb2YgbW9yZSBldmVudHMgbGF0ZXIuCisJICovCisJ
Z3VjX2NsZWFyX21taW9fbXNnKGd1Yyk7CisKKwlzcGluX3VubG9ja19pcnEoJmd1Yy0+aXJxX2xv
Y2spOworfQorCitzdGF0aWMgdm9pZCBndWNfaGFuZGxlX21taW9fbXNnKHN0cnVjdCBpbnRlbF9n
dWMgKmd1YykKK3sKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IGd1Y190b19pOTE1
KGd1Yyk7CisKKwkvKiB3ZSBuZWVkIGNvbW11bmljYXRpb24gdG8gYmUgZW5hYmxlZCB0byByZXBs
eSB0byBHdUMgKi8KKwlHRU1fQlVHX09OKGd1Yy0+aGFuZGxlciA9PSBpbnRlbF9ndWNfdG9faG9z
dF9ldmVudF9oYW5kbGVyX25vcCk7CisKKwlpZiAoIWd1Yy0+bW1pb19tc2cpCisJCXJldHVybjsK
KworCXNwaW5fbG9ja19pcnEoJmk5MTUtPmlycV9sb2NrKTsKKwlpbnRlbF9ndWNfdG9faG9zdF9w
cm9jZXNzX3JlY3ZfbXNnKGd1YywgJmd1Yy0+bW1pb19tc2csIDEpOworCXNwaW5fdW5sb2NrX2ly
cSgmaTkxNS0+aXJxX2xvY2spOworCisJZ3VjLT5tbWlvX21zZyA9IDA7Cit9CisKKwogc3RhdGlj
IHZvaWQgZ3VjX3Jlc2V0X2ludGVycnVwdHMoc3RydWN0IGludGVsX2d1YyAqZ3VjKQogewogCWd1
Yy0+aW50ZXJydXB0cy5yZXNldChndWNfdG9faTkxNShndWMpKTsKQEAgLTIzNSw2ICsyODMsNyBA
QCBzdGF0aWMgdm9pZCBndWNfZGlzYWJsZV9pbnRlcnJ1cHRzKHN0cnVjdCBpbnRlbF9ndWMgKmd1
YykKIAogc3RhdGljIGludCBndWNfZW5hYmxlX2NvbW11bmljYXRpb24oc3RydWN0IGludGVsX2d1
YyAqZ3VjKQogeworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0gZ3VjX3RvX2k5MTUo
Z3VjKTsKIAlpbnQgcmV0OwogCiAJcmV0ID0gaW50ZWxfZ3VjX2N0X2VuYWJsZSgmZ3VjLT5jdCk7
CkBAIC0yNDQsOCArMjkzLDE3IEBAIHN0YXRpYyBpbnQgZ3VjX2VuYWJsZV9jb21tdW5pY2F0aW9u
KHN0cnVjdCBpbnRlbF9ndWMgKmd1YykKIAlndWMtPnNlbmQgPSBpbnRlbF9ndWNfc2VuZF9jdDsK
IAlndWMtPmhhbmRsZXIgPSBpbnRlbF9ndWNfdG9faG9zdF9ldmVudF9oYW5kbGVyX2N0OwogCisJ
LyogY2hlY2sgZm9yIG1taW8gbWVzc2FnZXMgcmVjZWl2ZWQgYmVmb3JlL2R1cmluZyB0aGUgQ1Qg
ZW5hYmxlICovCisJZ3VjX2dldF9tbWlvX21zZyhndWMpOworCWd1Y19oYW5kbGVfbW1pb19tc2co
Z3VjKTsKKwogCWd1Y19lbmFibGVfaW50ZXJydXB0cyhndWMpOwogCisJLyogY2hlY2sgZm9yIENU
IG1lc3NhZ2VzIHJlY2VpdmVkIGJlZm9yZSB3ZSBlbmFibGVkIGludGVycnVwdHMgKi8KKwlzcGlu
X2xvY2tfaXJxKCZpOTE1LT5pcnFfbG9jayk7CisJaW50ZWxfZ3VjX3RvX2hvc3RfZXZlbnRfaGFu
ZGxlcl9jdChndWMpOworCXNwaW5fdW5sb2NrX2lycSgmaTkxNS0+aXJxX2xvY2spOworCiAJRFJN
X0lORk8oIkd1QyBjb21tdW5pY2F0aW9uIGVuYWJsZWRcbiIpOwogCiAJcmV0dXJuIDA7CkBAIC0y
NjEsNiArMzE5LDEzIEBAIHN0YXRpYyB2b2lkIGd1Y19zdG9wX2NvbW11bmljYXRpb24oc3RydWN0
IGludGVsX2d1YyAqZ3VjKQogCiBzdGF0aWMgdm9pZCBndWNfZGlzYWJsZV9jb21tdW5pY2F0aW9u
KHN0cnVjdCBpbnRlbF9ndWMgKmd1YykKIHsKKwkvKgorCSAqIEV2ZW50cyBnZW5lcmF0ZWQgZHVy
aW5nIG9yIGFmdGVyIENUIGRpc2FibGUgYXJlIGxvZ2dlZCBieSBndWMgaW4KKwkgKiB2aWEgbW1p
by4gTWFrZSBzdXJlIHRoZSByZWdpc3RlciBpcyBjbGVhciBiZWZvcmUgZGlzYWJsaW5nIENUIHNp
bmNlCisJICogYWxsIGV2ZW50cyB3ZSBjYXJlZCBhYm91dCBoYXZlIGFscmVhZHkgYmVlbiBwcm9j
ZXNzZWQgdmlhIENULgorCSAqLworCWd1Y19jbGVhcl9tbWlvX21zZyhndWMpOworCiAJZ3VjX2Rp
c2FibGVfaW50ZXJydXB0cyhndWMpOwogCiAJZ3VjLT5zZW5kID0gaW50ZWxfZ3VjX3NlbmRfbm9w
OwpAQCAtMjY4LDYgKzMzMywxNCBAQCBzdGF0aWMgdm9pZCBndWNfZGlzYWJsZV9jb21tdW5pY2F0
aW9uKHN0cnVjdCBpbnRlbF9ndWMgKmd1YykKIAogCWludGVsX2d1Y19jdF9kaXNhYmxlKCZndWMt
PmN0KTsKIAorCS8qCisJICogQ2hlY2sgZm9yIG1lc3NhZ2VzIHJlY2VpdmVkIGR1cmluZy9hZnRl
ciB0aGUgQ1QgZGlzYWJsZS4gV2UgZG8gbm90CisJICogZXhwZWN0IGFueSBtZXNzYWdlcyB0byBo
YXZlIGFycml2ZWQgdmlhIENUIGJldHdlZW4gdGhlIGludGVycnVwdAorCSAqIGRpc2FibGUgYW5k
IHRoZSBDVCBkaXNhYmxlIGJlY2F1c2UgR3VDIHNob3VsZCd2ZSBiZWVuIGlkbGUgdW50aWwgd2UK
KwkgKiB0cmlnZ2VyZWQgdGhlIENUIGRpc2FibGUgcHJvdG9jb2wuCisJICovCisJZ3VjX2dldF9t
bWlvX21zZyhndWMpOworCiAJRFJNX0lORk8oIkd1QyBjb21tdW5pY2F0aW9uIGRpc2FibGVkXG4i
KTsKIH0KIAotLSAKMi4yMC4xCgpfX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fXwpJbnRlbC1nZnggbWFpbGluZyBsaXN0CkludGVsLWdmeEBsaXN0cy5mcmVlZGVz
a3RvcC5vcmcKaHR0cHM6Ly9saXN0cy5mcmVlZGVza3RvcC5vcmcvbWFpbG1hbi9saXN0aW5mby9p
bnRlbC1nZng=

Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 3D1F3E824B
	for <lists+intel-gfx@lfdr.de>; Tue, 29 Oct 2019 08:22:52 +0100 (CET)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 4D12A6EAEC;
	Tue, 29 Oct 2019 07:22:44 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from mblankhorst.nl (mblankhorst.nl
 [IPv6:2a02:2308::216:3eff:fe92:dfa3])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 0C2866E0F4
 for <intel-gfx@lists.freedesktop.org>; Tue, 29 Oct 2019 07:22:37 +0000 (UTC)
From: Maarten Lankhorst <maarten.lankhorst@linux.intel.com>
To: intel-gfx@lists.freedesktop.org
Date: Tue, 29 Oct 2019 08:22:27 +0100
Message-Id: <20191029072229.27092-10-maarten.lankhorst@linux.intel.com>
X-Mailer: git-send-email 2.23.0
In-Reply-To: <20191029072229.27092-1-maarten.lankhorst@linux.intel.com>
References: <20191029072229.27092-1-maarten.lankhorst@linux.intel.com>
MIME-Version: 1.0
Subject: [Intel-gfx] [CI 10/12] drm/i915: Perform automated conversions for
 plane uapi/hw split, base -> hw.
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

U3BsaXQgdXAgcGxhbmVfc3RhdGUtPmJhc2UgdG8gaHcuIFRoaXMgaXMgZG9uZSB1c2luZyB0aGUg
Zm9sbG93aW5nIHBhdGNoOgoKQEAKc3RydWN0IGludGVsX3BsYW5lX3N0YXRlICpUOwppZGVudGlm
aWVyIHggPX4gIl4oY3J0Y3xmYnxhbHBoYXxwaXhlbF9ibGVuZF9tb2RlfHJvdGF0aW9ufGNvbG9y
X2VuY29kaW5nfGNvbG9yX3JhbmdlKSQiOwpAQAotVC0+YmFzZS54CitULT5ody54CgpTaWduZWQt
b2ZmLWJ5OiBNYWFydGVuIExhbmtob3JzdCA8bWFhcnRlbi5sYW5raG9yc3RAbGludXguaW50ZWwu
Y29tPgotLS0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfYXRvbWljLmMgICB8
ICAgNiArLQogLi4uL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2F0b21pY19wbGFuZS5jIHwg
ICA2ICstCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2Rpc3BsYXkuYyAgfCAx
MzMgKysrKysrKysrLS0tLS0tLS0tCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVs
X2ZiYy5jICAgICAgfCAgIDggKy0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxf
b3ZlcmxheS5jICB8ICAgMiArLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9z
cHJpdGUuYyAgIHwgIDkwICsrKysrKy0tLS0tLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50ZWxf
cG0uYyAgICAgICAgICAgICAgIHwgIDMyICsrLS0tCiA3IGZpbGVzIGNoYW5nZWQsIDEzOSBpbnNl
cnRpb25zKCspLCAxMzggZGVsZXRpb25zKC0pCgpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJt
L2k5MTUvZGlzcGxheS9pbnRlbF9hdG9taWMuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3Bs
YXkvaW50ZWxfYXRvbWljLmMKaW5kZXggNTU3MTc4OTA2Y2NmLi5mYjQxMjZkZTk5NGQgMTAwNjQ0
Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfYXRvbWljLmMKKysrIGIv
ZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9hdG9taWMuYwpAQCAtMjk2LDkgKzI5
Niw5IEBAIHN0YXRpYyB2b2lkIGludGVsX2F0b21pY19zZXR1cF9zY2FsZXIoc3RydWN0IGludGVs
X2NydGNfc2NhbGVyX3N0YXRlICpzY2FsZXJfc3RhCiAJCXJldHVybjsKIAogCS8qIHNldCBzY2Fs
ZXIgbW9kZSAqLwotCWlmIChwbGFuZV9zdGF0ZSAmJiBwbGFuZV9zdGF0ZS0+YmFzZS5mYiAmJgot
CSAgICBwbGFuZV9zdGF0ZS0+YmFzZS5mYi0+Zm9ybWF0LT5pc195dXYgJiYKLQkgICAgcGxhbmVf
c3RhdGUtPmJhc2UuZmItPmZvcm1hdC0+bnVtX3BsYW5lcyA+IDEpIHsKKwlpZiAocGxhbmVfc3Rh
dGUgJiYgcGxhbmVfc3RhdGUtPmh3LmZiICYmCisJICAgIHBsYW5lX3N0YXRlLT5ody5mYi0+Zm9y
bWF0LT5pc195dXYgJiYKKwkgICAgcGxhbmVfc3RhdGUtPmh3LmZiLT5mb3JtYXQtPm51bV9wbGFu
ZXMgPiAxKSB7CiAJCXN0cnVjdCBpbnRlbF9wbGFuZSAqcGxhbmUgPSB0b19pbnRlbF9wbGFuZShw
bGFuZV9zdGF0ZS0+YmFzZS5wbGFuZSk7CiAJCWlmIChJU19HRU4oZGV2X3ByaXYsIDkpICYmCiAJ
CSAgICAhSVNfR0VNSU5JTEFLRShkZXZfcHJpdikpIHsKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1
L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfYXRvbWljX3BsYW5lLmMgYi9kcml2ZXJzL2dwdS9kcm0v
aTkxNS9kaXNwbGF5L2ludGVsX2F0b21pY19wbGFuZS5jCmluZGV4IDk4N2Y3NTQ1ZDQ1Zi4uY2Fj
MWQ2YWU2N2Y2IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVs
X2F0b21pY19wbGFuZS5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxf
YXRvbWljX3BsYW5lLmMKQEAgLTExOCw3ICsxMTgsNyBAQCBpbnRlbF9wbGFuZV9kZXN0cm95X3N0
YXRlKHN0cnVjdCBkcm1fcGxhbmUgKnBsYW5lLAogdW5zaWduZWQgaW50IGludGVsX3BsYW5lX2Rh
dGFfcmF0ZShjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSwKIAkJCQkg
ICBjb25zdCBzdHJ1Y3QgaW50ZWxfcGxhbmVfc3RhdGUgKnBsYW5lX3N0YXRlKQogewotCWNvbnN0
IHN0cnVjdCBkcm1fZnJhbWVidWZmZXIgKmZiID0gcGxhbmVfc3RhdGUtPmJhc2UuZmI7CisJY29u
c3Qgc3RydWN0IGRybV9mcmFtZWJ1ZmZlciAqZmIgPSBwbGFuZV9zdGF0ZS0+aHcuZmI7CiAJdW5z
aWduZWQgaW50IGNwcDsKIAogCWlmICghcGxhbmVfc3RhdGUtPmJhc2UudmlzaWJsZSkKQEAgLTE4
Miw3ICsxODIsNyBAQCBpbnQgaW50ZWxfcGxhbmVfYXRvbWljX2NoZWNrX3dpdGhfc3RhdGUoY29u
c3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKm9sZF9jcnRjXwogCQkJCQlzdHJ1Y3QgaW50ZWxf
cGxhbmVfc3RhdGUgKm5ld19wbGFuZV9zdGF0ZSkKIHsKIAlzdHJ1Y3QgaW50ZWxfcGxhbmUgKnBs
YW5lID0gdG9faW50ZWxfcGxhbmUobmV3X3BsYW5lX3N0YXRlLT5iYXNlLnBsYW5lKTsKLQljb25z
dCBzdHJ1Y3QgZHJtX2ZyYW1lYnVmZmVyICpmYiA9IG5ld19wbGFuZV9zdGF0ZS0+YmFzZS5mYjsK
Kwljb25zdCBzdHJ1Y3QgZHJtX2ZyYW1lYnVmZmVyICpmYiA9IG5ld19wbGFuZV9zdGF0ZS0+aHcu
ZmI7CiAJaW50IHJldDsKIAogCW5ld19jcnRjX3N0YXRlLT5hY3RpdmVfcGxhbmVzICY9IH5CSVQo
cGxhbmUtPmlkKTsKQEAgLTE5Miw3ICsxOTIsNyBAQCBpbnQgaW50ZWxfcGxhbmVfYXRvbWljX2No
ZWNrX3dpdGhfc3RhdGUoY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKm9sZF9jcnRjXwog
CW5ld19jcnRjX3N0YXRlLT5taW5fY2RjbGtbcGxhbmUtPmlkXSA9IDA7CiAJbmV3X3BsYW5lX3N0
YXRlLT5iYXNlLnZpc2libGUgPSBmYWxzZTsKIAotCWlmICghbmV3X3BsYW5lX3N0YXRlLT5iYXNl
LmNydGMgJiYgIW9sZF9wbGFuZV9zdGF0ZS0+YmFzZS5jcnRjKQorCWlmICghbmV3X3BsYW5lX3N0
YXRlLT5ody5jcnRjICYmICFvbGRfcGxhbmVfc3RhdGUtPmh3LmNydGMpCiAJCXJldHVybiAwOwog
CiAJcmV0ID0gcGxhbmUtPmNoZWNrX3BsYW5lKG5ld19jcnRjX3N0YXRlLCBuZXdfcGxhbmVfc3Rh
dGUpOwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kaXNw
bGF5LmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2Rpc3BsYXkuYwppbmRl
eCBjZDlkNjgyNDVmNTMuLmZiYmU2Zjc1MjcxNiAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJt
L2k5MTUvZGlzcGxheS9pbnRlbF9kaXNwbGF5LmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUv
ZGlzcGxheS9pbnRlbF9kaXNwbGF5LmMKQEAgLTIyMTUsNyArMjIxNSw3IEBAIHUzMiBpbnRlbF9m
Yl94eV90b19saW5lYXIoaW50IHgsIGludCB5LAogCQkJICBjb25zdCBzdHJ1Y3QgaW50ZWxfcGxh
bmVfc3RhdGUgKnN0YXRlLAogCQkJICBpbnQgY29sb3JfcGxhbmUpCiB7Ci0JY29uc3Qgc3RydWN0
IGRybV9mcmFtZWJ1ZmZlciAqZmIgPSBzdGF0ZS0+YmFzZS5mYjsKKwljb25zdCBzdHJ1Y3QgZHJt
X2ZyYW1lYnVmZmVyICpmYiA9IHN0YXRlLT5ody5mYjsKIAl1bnNpZ25lZCBpbnQgY3BwID0gZmIt
PmZvcm1hdC0+Y3BwW2NvbG9yX3BsYW5lXTsKIAl1bnNpZ25lZCBpbnQgcGl0Y2ggPSBzdGF0ZS0+
Y29sb3JfcGxhbmVbY29sb3JfcGxhbmVdLnN0cmlkZTsKIApAQCAtMjMxNiw4ICsyMzE2LDggQEAg
c3RhdGljIHUzMiBpbnRlbF9wbGFuZV9hZGp1c3RfYWxpZ25lZF9vZmZzZXQoaW50ICp4LCBpbnQg
KnksCiAJCQkJCSAgICAgaW50IGNvbG9yX3BsYW5lLAogCQkJCQkgICAgIHUzMiBvbGRfb2Zmc2V0
LCB1MzIgbmV3X29mZnNldCkKIHsKLQlyZXR1cm4gaW50ZWxfYWRqdXN0X2FsaWduZWRfb2Zmc2V0
KHgsIHksIHN0YXRlLT5iYXNlLmZiLCBjb2xvcl9wbGFuZSwKLQkJCQkJICAgc3RhdGUtPmJhc2Uu
cm90YXRpb24sCisJcmV0dXJuIGludGVsX2FkanVzdF9hbGlnbmVkX29mZnNldCh4LCB5LCBzdGF0
ZS0+aHcuZmIsIGNvbG9yX3BsYW5lLAorCQkJCQkgICBzdGF0ZS0+aHcucm90YXRpb24sCiAJCQkJ
CSAgIHN0YXRlLT5jb2xvcl9wbGFuZVtjb2xvcl9wbGFuZV0uc3RyaWRlLAogCQkJCQkgICBvbGRf
b2Zmc2V0LCBuZXdfb2Zmc2V0KTsKIH0KQEAgLTIzOTMsOCArMjM5Myw4IEBAIHN0YXRpYyB1MzIg
aW50ZWxfcGxhbmVfY29tcHV0ZV9hbGlnbmVkX29mZnNldChpbnQgKngsIGludCAqeSwKIHsKIAlz
dHJ1Y3QgaW50ZWxfcGxhbmUgKmludGVsX3BsYW5lID0gdG9faW50ZWxfcGxhbmUoc3RhdGUtPmJh
c2UucGxhbmUpOwogCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUo
aW50ZWxfcGxhbmUtPmJhc2UuZGV2KTsKLQljb25zdCBzdHJ1Y3QgZHJtX2ZyYW1lYnVmZmVyICpm
YiA9IHN0YXRlLT5iYXNlLmZiOwotCXVuc2lnbmVkIGludCByb3RhdGlvbiA9IHN0YXRlLT5iYXNl
LnJvdGF0aW9uOworCWNvbnN0IHN0cnVjdCBkcm1fZnJhbWVidWZmZXIgKmZiID0gc3RhdGUtPmh3
LmZiOworCXVuc2lnbmVkIGludCByb3RhdGlvbiA9IHN0YXRlLT5ody5yb3RhdGlvbjsKIAlpbnQg
cGl0Y2ggPSBzdGF0ZS0+Y29sb3JfcGxhbmVbY29sb3JfcGxhbmVdLnN0cmlkZTsKIAl1MzIgYWxp
Z25tZW50OwogCkBAIC0yNTgxLDcgKzI1ODEsNyBAQCBib29sIGludGVsX3BsYW5lX2Nhbl9yZW1h
cChjb25zdCBzdHJ1Y3QgaW50ZWxfcGxhbmVfc3RhdGUgKnBsYW5lX3N0YXRlKQogewogCXN0cnVj
dCBpbnRlbF9wbGFuZSAqcGxhbmUgPSB0b19pbnRlbF9wbGFuZShwbGFuZV9zdGF0ZS0+YmFzZS5w
bGFuZSk7CiAJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShwbGFu
ZS0+YmFzZS5kZXYpOwotCWNvbnN0IHN0cnVjdCBkcm1fZnJhbWVidWZmZXIgKmZiID0gcGxhbmVf
c3RhdGUtPmJhc2UuZmI7CisJY29uc3Qgc3RydWN0IGRybV9mcmFtZWJ1ZmZlciAqZmIgPSBwbGFu
ZV9zdGF0ZS0+aHcuZmI7CiAJaW50IGk7CiAKIAkvKiBXZSBkb24ndCB3YW50IHRvIGRlYWwgd2l0
aCByZW1hcHBpbmcgd2l0aCBjdXJzb3JzICovCkBAIC0yNjIwLDggKzI2MjAsOCBAQCBib29sIGlu
dGVsX3BsYW5lX2Nhbl9yZW1hcChjb25zdCBzdHJ1Y3QgaW50ZWxfcGxhbmVfc3RhdGUgKnBsYW5l
X3N0YXRlKQogc3RhdGljIGJvb2wgaW50ZWxfcGxhbmVfbmVlZHNfcmVtYXAoY29uc3Qgc3RydWN0
IGludGVsX3BsYW5lX3N0YXRlICpwbGFuZV9zdGF0ZSkKIHsKIAlzdHJ1Y3QgaW50ZWxfcGxhbmUg
KnBsYW5lID0gdG9faW50ZWxfcGxhbmUocGxhbmVfc3RhdGUtPmJhc2UucGxhbmUpOwotCWNvbnN0
IHN0cnVjdCBkcm1fZnJhbWVidWZmZXIgKmZiID0gcGxhbmVfc3RhdGUtPmJhc2UuZmI7Ci0JdW5z
aWduZWQgaW50IHJvdGF0aW9uID0gcGxhbmVfc3RhdGUtPmJhc2Uucm90YXRpb247CisJY29uc3Qg
c3RydWN0IGRybV9mcmFtZWJ1ZmZlciAqZmIgPSBwbGFuZV9zdGF0ZS0+aHcuZmI7CisJdW5zaWdu
ZWQgaW50IHJvdGF0aW9uID0gcGxhbmVfc3RhdGUtPmh3LnJvdGF0aW9uOwogCXUzMiBzdHJpZGUs
IG1heF9zdHJpZGU7CiAKIAkvKgpAQCAtMjgxMiwxMCArMjgxMiwxMCBAQCBpbnRlbF9wbGFuZV9y
ZW1hcF9ndHQoc3RydWN0IGludGVsX3BsYW5lX3N0YXRlICpwbGFuZV9zdGF0ZSkKIHsKIAlzdHJ1
Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPQogCQl0b19pOTE1KHBsYW5lX3N0YXRlLT5i
YXNlLnBsYW5lLT5kZXYpOwotCXN0cnVjdCBkcm1fZnJhbWVidWZmZXIgKmZiID0gcGxhbmVfc3Rh
dGUtPmJhc2UuZmI7CisJc3RydWN0IGRybV9mcmFtZWJ1ZmZlciAqZmIgPSBwbGFuZV9zdGF0ZS0+
aHcuZmI7CiAJc3RydWN0IGludGVsX2ZyYW1lYnVmZmVyICppbnRlbF9mYiA9IHRvX2ludGVsX2Zy
YW1lYnVmZmVyKGZiKTsKIAlzdHJ1Y3QgaW50ZWxfcm90YXRpb25faW5mbyAqaW5mbyA9ICZwbGFu
ZV9zdGF0ZS0+dmlldy5yb3RhdGVkOwotCXVuc2lnbmVkIGludCByb3RhdGlvbiA9IHBsYW5lX3N0
YXRlLT5iYXNlLnJvdGF0aW9uOworCXVuc2lnbmVkIGludCByb3RhdGlvbiA9IHBsYW5lX3N0YXRl
LT5ody5yb3RhdGlvbjsKIAlpbnQgaSwgbnVtX3BsYW5lcyA9IGZiLT5mb3JtYXQtPm51bV9wbGFu
ZXM7CiAJdW5zaWduZWQgaW50IHRpbGVfc2l6ZSA9IGludGVsX3RpbGVfc2l6ZShkZXZfcHJpdik7
CiAJdW5zaWduZWQgaW50IHNyY194LCBzcmNfeTsKQEAgLTI5MjEsOCArMjkyMSw4IEBAIHN0YXRp
YyBpbnQKIGludGVsX3BsYW5lX2NvbXB1dGVfZ3R0KHN0cnVjdCBpbnRlbF9wbGFuZV9zdGF0ZSAq
cGxhbmVfc3RhdGUpCiB7CiAJY29uc3Qgc3RydWN0IGludGVsX2ZyYW1lYnVmZmVyICpmYiA9Ci0J
CXRvX2ludGVsX2ZyYW1lYnVmZmVyKHBsYW5lX3N0YXRlLT5iYXNlLmZiKTsKLQl1bnNpZ25lZCBp
bnQgcm90YXRpb24gPSBwbGFuZV9zdGF0ZS0+YmFzZS5yb3RhdGlvbjsKKwkJdG9faW50ZWxfZnJh
bWVidWZmZXIocGxhbmVfc3RhdGUtPmh3LmZiKTsKKwl1bnNpZ25lZCBpbnQgcm90YXRpb24gPSBw
bGFuZV9zdGF0ZS0+aHcucm90YXRpb247CiAJaW50IGksIG51bV9wbGFuZXM7CiAKIAlpZiAoIWZi
KQpAQCAtMzIyNSw3ICszMjI1LDcgQEAgaW50ZWxfZmluZF9pbml0aWFsX3BsYW5lX29iaihzdHJ1
Y3QgaW50ZWxfY3J0YyAqaW50ZWxfY3J0YywKIAkJCWNvbnRpbnVlOwogCiAJCWlmIChpbnRlbF9w
bGFuZV9nZ3R0X29mZnNldChzdGF0ZSkgPT0gcGxhbmVfY29uZmlnLT5iYXNlKSB7Ci0JCQlmYiA9
IHN0YXRlLT5iYXNlLmZiOworCQkJZmIgPSBzdGF0ZS0+aHcuZmI7CiAJCQlkcm1fZnJhbWVidWZm
ZXJfZ2V0KGZiKTsKIAkJCWdvdG8gdmFsaWRfZmI7CiAJCX0KQEAgLTMyNDMsMTEgKzMyNDMsMTEg
QEAgaW50ZWxfZmluZF9pbml0aWFsX3BsYW5lX29iaihzdHJ1Y3QgaW50ZWxfY3J0YyAqaW50ZWxf
Y3J0YywKIAlyZXR1cm47CiAKIHZhbGlkX2ZiOgotCWludGVsX3N0YXRlLT5iYXNlLnJvdGF0aW9u
ID0gcGxhbmVfY29uZmlnLT5yb3RhdGlvbjsKKwlpbnRlbF9zdGF0ZS0+aHcucm90YXRpb24gPSBw
bGFuZV9jb25maWctPnJvdGF0aW9uOwogCWludGVsX2ZpbGxfZmJfZ2d0dF92aWV3KCZpbnRlbF9z
dGF0ZS0+dmlldywgZmIsCi0JCQkJaW50ZWxfc3RhdGUtPmJhc2Uucm90YXRpb24pOworCQkJCWlu
dGVsX3N0YXRlLT5ody5yb3RhdGlvbik7CiAJaW50ZWxfc3RhdGUtPmNvbG9yX3BsYW5lWzBdLnN0
cmlkZSA9Ci0JCWludGVsX2ZiX3BpdGNoKGZiLCAwLCBpbnRlbF9zdGF0ZS0+YmFzZS5yb3RhdGlv
bik7CisJCWludGVsX2ZiX3BpdGNoKGZiLCAwLCBpbnRlbF9zdGF0ZS0+aHcucm90YXRpb24pOwog
CiAJaW50ZWxfc3RhdGUtPnZtYSA9CiAJCWludGVsX3Bpbl9hbmRfZmVuY2VfZmJfb2JqKGZiLApA
QCAtMzM3NCw3ICszMzc0LDcgQEAgc3RhdGljIGludCBpY2xfbWF4X3BsYW5lX2hlaWdodCh2b2lk
KQogc3RhdGljIGJvb2wgc2tsX2NoZWNrX21haW5fY2NzX2Nvb3JkaW5hdGVzKHN0cnVjdCBpbnRl
bF9wbGFuZV9zdGF0ZSAqcGxhbmVfc3RhdGUsCiAJCQkJCSAgIGludCBtYWluX3gsIGludCBtYWlu
X3ksIHUzMiBtYWluX29mZnNldCkKIHsKLQljb25zdCBzdHJ1Y3QgZHJtX2ZyYW1lYnVmZmVyICpm
YiA9IHBsYW5lX3N0YXRlLT5iYXNlLmZiOworCWNvbnN0IHN0cnVjdCBkcm1fZnJhbWVidWZmZXIg
KmZiID0gcGxhbmVfc3RhdGUtPmh3LmZiOwogCWludCBoc3ViID0gZmItPmZvcm1hdC0+aHN1YjsK
IAlpbnQgdnN1YiA9IGZiLT5mb3JtYXQtPnZzdWI7CiAJaW50IGF1eF94ID0gcGxhbmVfc3RhdGUt
PmNvbG9yX3BsYW5lWzFdLng7CkBAIC0zNDEyLDggKzM0MTIsOCBAQCBzdGF0aWMgYm9vbCBza2xf
Y2hlY2tfbWFpbl9jY3NfY29vcmRpbmF0ZXMoc3RydWN0IGludGVsX3BsYW5lX3N0YXRlICpwbGFu
ZV9zdGF0ZQogc3RhdGljIGludCBza2xfY2hlY2tfbWFpbl9zdXJmYWNlKHN0cnVjdCBpbnRlbF9w
bGFuZV9zdGF0ZSAqcGxhbmVfc3RhdGUpCiB7CiAJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRl
dl9wcml2ID0gdG9faTkxNShwbGFuZV9zdGF0ZS0+YmFzZS5wbGFuZS0+ZGV2KTsKLQljb25zdCBz
dHJ1Y3QgZHJtX2ZyYW1lYnVmZmVyICpmYiA9IHBsYW5lX3N0YXRlLT5iYXNlLmZiOwotCXVuc2ln
bmVkIGludCByb3RhdGlvbiA9IHBsYW5lX3N0YXRlLT5iYXNlLnJvdGF0aW9uOworCWNvbnN0IHN0
cnVjdCBkcm1fZnJhbWVidWZmZXIgKmZiID0gcGxhbmVfc3RhdGUtPmh3LmZiOworCXVuc2lnbmVk
IGludCByb3RhdGlvbiA9IHBsYW5lX3N0YXRlLT5ody5yb3RhdGlvbjsKIAlpbnQgeCA9IHBsYW5l
X3N0YXRlLT5iYXNlLnNyYy54MSA+PiAxNjsKIAlpbnQgeSA9IHBsYW5lX3N0YXRlLT5iYXNlLnNy
Yy55MSA+PiAxNjsKIAlpbnQgdyA9IGRybV9yZWN0X3dpZHRoKCZwbGFuZV9zdGF0ZS0+YmFzZS5z
cmMpID4+IDE2OwpAQCAtMzUwOCw4ICszNTA4LDggQEAgc3RhdGljIGludCBza2xfY2hlY2tfbWFp
bl9zdXJmYWNlKHN0cnVjdCBpbnRlbF9wbGFuZV9zdGF0ZSAqcGxhbmVfc3RhdGUpCiAKIHN0YXRp
YyBpbnQgc2tsX2NoZWNrX252MTJfYXV4X3N1cmZhY2Uoc3RydWN0IGludGVsX3BsYW5lX3N0YXRl
ICpwbGFuZV9zdGF0ZSkKIHsKLQljb25zdCBzdHJ1Y3QgZHJtX2ZyYW1lYnVmZmVyICpmYiA9IHBs
YW5lX3N0YXRlLT5iYXNlLmZiOwotCXVuc2lnbmVkIGludCByb3RhdGlvbiA9IHBsYW5lX3N0YXRl
LT5iYXNlLnJvdGF0aW9uOworCWNvbnN0IHN0cnVjdCBkcm1fZnJhbWVidWZmZXIgKmZiID0gcGxh
bmVfc3RhdGUtPmh3LmZiOworCXVuc2lnbmVkIGludCByb3RhdGlvbiA9IHBsYW5lX3N0YXRlLT5o
dy5yb3RhdGlvbjsKIAlpbnQgbWF4X3dpZHRoID0gc2tsX21heF9wbGFuZV93aWR0aChmYiwgMSwg
cm90YXRpb24pOwogCWludCBtYXhfaGVpZ2h0ID0gNDA5NjsKIAlpbnQgeCA9IHBsYW5lX3N0YXRl
LT5iYXNlLnNyYy54MSA+PiAxNzsKQEAgLTM1MzcsNyArMzUzNyw3IEBAIHN0YXRpYyBpbnQgc2ts
X2NoZWNrX252MTJfYXV4X3N1cmZhY2Uoc3RydWN0IGludGVsX3BsYW5lX3N0YXRlICpwbGFuZV9z
dGF0ZSkKIAogc3RhdGljIGludCBza2xfY2hlY2tfY2NzX2F1eF9zdXJmYWNlKHN0cnVjdCBpbnRl
bF9wbGFuZV9zdGF0ZSAqcGxhbmVfc3RhdGUpCiB7Ci0JY29uc3Qgc3RydWN0IGRybV9mcmFtZWJ1
ZmZlciAqZmIgPSBwbGFuZV9zdGF0ZS0+YmFzZS5mYjsKKwljb25zdCBzdHJ1Y3QgZHJtX2ZyYW1l
YnVmZmVyICpmYiA9IHBsYW5lX3N0YXRlLT5ody5mYjsKIAlpbnQgc3JjX3ggPSBwbGFuZV9zdGF0
ZS0+YmFzZS5zcmMueDEgPj4gMTY7CiAJaW50IHNyY195ID0gcGxhbmVfc3RhdGUtPmJhc2Uuc3Jj
LnkxID4+IDE2OwogCWludCBoc3ViID0gZmItPmZvcm1hdC0+aHN1YjsKQEAgLTM1NTgsNyArMzU1
OCw3IEBAIHN0YXRpYyBpbnQgc2tsX2NoZWNrX2Njc19hdXhfc3VyZmFjZShzdHJ1Y3QgaW50ZWxf
cGxhbmVfc3RhdGUgKnBsYW5lX3N0YXRlKQogCiBpbnQgc2tsX2NoZWNrX3BsYW5lX3N1cmZhY2Uo
c3RydWN0IGludGVsX3BsYW5lX3N0YXRlICpwbGFuZV9zdGF0ZSkKIHsKLQljb25zdCBzdHJ1Y3Qg
ZHJtX2ZyYW1lYnVmZmVyICpmYiA9IHBsYW5lX3N0YXRlLT5iYXNlLmZiOworCWNvbnN0IHN0cnVj
dCBkcm1fZnJhbWVidWZmZXIgKmZiID0gcGxhbmVfc3RhdGUtPmh3LmZiOwogCWludCByZXQ7CiAK
IAlyZXQgPSBpbnRlbF9wbGFuZV9jb21wdXRlX2d0dChwbGFuZV9zdGF0ZSk7CkBAIC0zNTk3LDcg
KzM1OTcsNyBAQCBzdGF0aWMgdm9pZCBpOXh4X3BsYW5lX3JhdGlvKGNvbnN0IHN0cnVjdCBpbnRl
bF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlLAogCQkJICAgICBjb25zdCBzdHJ1Y3QgaW50ZWxfcGxh
bmVfc3RhdGUgKnBsYW5lX3N0YXRlLAogCQkJICAgICB1bnNpZ25lZCBpbnQgKm51bSwgdW5zaWdu
ZWQgaW50ICpkZW4pCiB7Ci0JY29uc3Qgc3RydWN0IGRybV9mcmFtZWJ1ZmZlciAqZmIgPSBwbGFu
ZV9zdGF0ZS0+YmFzZS5mYjsKKwljb25zdCBzdHJ1Y3QgZHJtX2ZyYW1lYnVmZmVyICpmYiA9IHBs
YW5lX3N0YXRlLT5ody5mYjsKIAl1bnNpZ25lZCBpbnQgY3BwID0gZmItPmZvcm1hdC0+Y3BwWzBd
OwogCiAJLyoKQEAgLTM2OTAsOCArMzY5MCw4IEBAIHN0YXRpYyB1MzIgaTl4eF9wbGFuZV9jdGwo
Y29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUsCiB7CiAJc3RydWN0IGRy
bV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0KIAkJdG9faTkxNShwbGFuZV9zdGF0ZS0+YmFzZS5w
bGFuZS0+ZGV2KTsKLQljb25zdCBzdHJ1Y3QgZHJtX2ZyYW1lYnVmZmVyICpmYiA9IHBsYW5lX3N0
YXRlLT5iYXNlLmZiOwotCXVuc2lnbmVkIGludCByb3RhdGlvbiA9IHBsYW5lX3N0YXRlLT5iYXNl
LnJvdGF0aW9uOworCWNvbnN0IHN0cnVjdCBkcm1fZnJhbWVidWZmZXIgKmZiID0gcGxhbmVfc3Rh
dGUtPmh3LmZiOworCXVuc2lnbmVkIGludCByb3RhdGlvbiA9IHBsYW5lX3N0YXRlLT5ody5yb3Rh
dGlvbjsKIAl1MzIgZHNwY250cjsKIAogCWRzcGNudHIgPSBESVNQTEFZX1BMQU5FX0VOQUJMRTsK
QEAgLTM3NDcsNyArMzc0Nyw3IEBAIGludCBpOXh4X2NoZWNrX3BsYW5lX3N1cmZhY2Uoc3RydWN0
IGludGVsX3BsYW5lX3N0YXRlICpwbGFuZV9zdGF0ZSkKIHsKIAlzdHJ1Y3QgZHJtX2k5MTVfcHJp
dmF0ZSAqZGV2X3ByaXYgPQogCQl0b19pOTE1KHBsYW5lX3N0YXRlLT5iYXNlLnBsYW5lLT5kZXYp
OwotCWNvbnN0IHN0cnVjdCBkcm1fZnJhbWVidWZmZXIgKmZiID0gcGxhbmVfc3RhdGUtPmJhc2Uu
ZmI7CisJY29uc3Qgc3RydWN0IGRybV9mcmFtZWJ1ZmZlciAqZmIgPSBwbGFuZV9zdGF0ZS0+aHcu
ZmI7CiAJaW50IHNyY194LCBzcmNfeSwgc3JjX3c7CiAJdTMyIG9mZnNldDsKIAlpbnQgcmV0OwpA
QCAtMzc4NCw3ICszNzg0LDcgQEAgaW50IGk5eHhfY2hlY2tfcGxhbmVfc3VyZmFjZShzdHJ1Y3Qg
aW50ZWxfcGxhbmVfc3RhdGUgKnBsYW5lX3N0YXRlKQogCiAJLyogSFNXL0JEVyBkbyB0aGlzIGF1
dG9tYWdpY2FsbHkgaW4gaGFyZHdhcmUgKi8KIAlpZiAoIUlTX0hBU1dFTEwoZGV2X3ByaXYpICYm
ICFJU19CUk9BRFdFTEwoZGV2X3ByaXYpKSB7Ci0JCXVuc2lnbmVkIGludCByb3RhdGlvbiA9IHBs
YW5lX3N0YXRlLT5iYXNlLnJvdGF0aW9uOworCQl1bnNpZ25lZCBpbnQgcm90YXRpb24gPSBwbGFu
ZV9zdGF0ZS0+aHcucm90YXRpb247CiAJCWludCBzcmNfdyA9IGRybV9yZWN0X3dpZHRoKCZwbGFu
ZV9zdGF0ZS0+YmFzZS5zcmMpID4+IDE2OwogCQlpbnQgc3JjX2ggPSBkcm1fcmVjdF9oZWlnaHQo
JnBsYW5lX3N0YXRlLT5iYXNlLnNyYykgPj4gMTY7CiAKQEAgLTQwMzcsOCArNDAzNyw4IEBAIHN0
YXRpYyB1bnNpZ25lZCBpbnQgc2tsX3BsYW5lX3N0cmlkZV9tdWx0KGNvbnN0IHN0cnVjdCBkcm1f
ZnJhbWVidWZmZXIgKmZiLAogdTMyIHNrbF9wbGFuZV9zdHJpZGUoY29uc3Qgc3RydWN0IGludGVs
X3BsYW5lX3N0YXRlICpwbGFuZV9zdGF0ZSwKIAkJICAgICBpbnQgY29sb3JfcGxhbmUpCiB7Ci0J
Y29uc3Qgc3RydWN0IGRybV9mcmFtZWJ1ZmZlciAqZmIgPSBwbGFuZV9zdGF0ZS0+YmFzZS5mYjsK
LQl1bnNpZ25lZCBpbnQgcm90YXRpb24gPSBwbGFuZV9zdGF0ZS0+YmFzZS5yb3RhdGlvbjsKKwlj
b25zdCBzdHJ1Y3QgZHJtX2ZyYW1lYnVmZmVyICpmYiA9IHBsYW5lX3N0YXRlLT5ody5mYjsKKwl1
bnNpZ25lZCBpbnQgcm90YXRpb24gPSBwbGFuZV9zdGF0ZS0+aHcucm90YXRpb247CiAJdTMyIHN0
cmlkZSA9IHBsYW5lX3N0YXRlLT5jb2xvcl9wbGFuZVtjb2xvcl9wbGFuZV0uc3RyaWRlOwogCiAJ
aWYgKGNvbG9yX3BsYW5lID49IGZiLT5mb3JtYXQtPm51bV9wbGFuZXMpCkBAIC00MTA3LDEwICs0
MTA3LDEwIEBAIHN0YXRpYyB1MzIgc2tsX3BsYW5lX2N0bF9mb3JtYXQodTMyIHBpeGVsX2Zvcm1h
dCkKIAogc3RhdGljIHUzMiBza2xfcGxhbmVfY3RsX2FscGhhKGNvbnN0IHN0cnVjdCBpbnRlbF9w
bGFuZV9zdGF0ZSAqcGxhbmVfc3RhdGUpCiB7Ci0JaWYgKCFwbGFuZV9zdGF0ZS0+YmFzZS5mYi0+
Zm9ybWF0LT5oYXNfYWxwaGEpCisJaWYgKCFwbGFuZV9zdGF0ZS0+aHcuZmItPmZvcm1hdC0+aGFz
X2FscGhhKQogCQlyZXR1cm4gUExBTkVfQ1RMX0FMUEhBX0RJU0FCTEU7CiAKLQlzd2l0Y2ggKHBs
YW5lX3N0YXRlLT5iYXNlLnBpeGVsX2JsZW5kX21vZGUpIHsKKwlzd2l0Y2ggKHBsYW5lX3N0YXRl
LT5ody5waXhlbF9ibGVuZF9tb2RlKSB7CiAJY2FzZSBEUk1fTU9ERV9CTEVORF9QSVhFTF9OT05F
OgogCQlyZXR1cm4gUExBTkVfQ1RMX0FMUEhBX0RJU0FCTEU7CiAJY2FzZSBEUk1fTU9ERV9CTEVO
RF9QUkVNVUxUSToKQEAgLTQxMTgsMTcgKzQxMTgsMTcgQEAgc3RhdGljIHUzMiBza2xfcGxhbmVf
Y3RsX2FscGhhKGNvbnN0IHN0cnVjdCBpbnRlbF9wbGFuZV9zdGF0ZSAqcGxhbmVfc3RhdGUpCiAJ
Y2FzZSBEUk1fTU9ERV9CTEVORF9DT1ZFUkFHRToKIAkJcmV0dXJuIFBMQU5FX0NUTF9BTFBIQV9I
V19QUkVNVUxUSVBMWTsKIAlkZWZhdWx0OgotCQlNSVNTSU5HX0NBU0UocGxhbmVfc3RhdGUtPmJh
c2UucGl4ZWxfYmxlbmRfbW9kZSk7CisJCU1JU1NJTkdfQ0FTRShwbGFuZV9zdGF0ZS0+aHcucGl4
ZWxfYmxlbmRfbW9kZSk7CiAJCXJldHVybiBQTEFORV9DVExfQUxQSEFfRElTQUJMRTsKIAl9CiB9
CiAKIHN0YXRpYyB1MzIgZ2xrX3BsYW5lX2NvbG9yX2N0bF9hbHBoYShjb25zdCBzdHJ1Y3QgaW50
ZWxfcGxhbmVfc3RhdGUgKnBsYW5lX3N0YXRlKQogewotCWlmICghcGxhbmVfc3RhdGUtPmJhc2Uu
ZmItPmZvcm1hdC0+aGFzX2FscGhhKQorCWlmICghcGxhbmVfc3RhdGUtPmh3LmZiLT5mb3JtYXQt
Pmhhc19hbHBoYSkKIAkJcmV0dXJuIFBMQU5FX0NPTE9SX0FMUEhBX0RJU0FCTEU7CiAKLQlzd2l0
Y2ggKHBsYW5lX3N0YXRlLT5iYXNlLnBpeGVsX2JsZW5kX21vZGUpIHsKKwlzd2l0Y2ggKHBsYW5l
X3N0YXRlLT5ody5waXhlbF9ibGVuZF9tb2RlKSB7CiAJY2FzZSBEUk1fTU9ERV9CTEVORF9QSVhF
TF9OT05FOgogCQlyZXR1cm4gUExBTkVfQ09MT1JfQUxQSEFfRElTQUJMRTsKIAljYXNlIERSTV9N
T0RFX0JMRU5EX1BSRU1VTFRJOgpAQCAtNDEzNiw3ICs0MTM2LDcgQEAgc3RhdGljIHUzMiBnbGtf
cGxhbmVfY29sb3JfY3RsX2FscGhhKGNvbnN0IHN0cnVjdCBpbnRlbF9wbGFuZV9zdGF0ZSAqcGxh
bmVfc3RhdGUKIAljYXNlIERSTV9NT0RFX0JMRU5EX0NPVkVSQUdFOgogCQlyZXR1cm4gUExBTkVf
Q09MT1JfQUxQSEFfSFdfUFJFTVVMVElQTFk7CiAJZGVmYXVsdDoKLQkJTUlTU0lOR19DQVNFKHBs
YW5lX3N0YXRlLT5iYXNlLnBpeGVsX2JsZW5kX21vZGUpOworCQlNSVNTSU5HX0NBU0UocGxhbmVf
c3RhdGUtPmh3LnBpeGVsX2JsZW5kX21vZGUpOwogCQlyZXR1cm4gUExBTkVfQ09MT1JfQUxQSEFf
RElTQUJMRTsKIAl9CiB9CkBAIC00MjIyLDggKzQyMjIsOCBAQCB1MzIgc2tsX3BsYW5lX2N0bChj
b25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSwKIHsKIAlzdHJ1Y3QgZHJt
X2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPQogCQl0b19pOTE1KHBsYW5lX3N0YXRlLT5iYXNlLnBs
YW5lLT5kZXYpOwotCWNvbnN0IHN0cnVjdCBkcm1fZnJhbWVidWZmZXIgKmZiID0gcGxhbmVfc3Rh
dGUtPmJhc2UuZmI7Ci0JdW5zaWduZWQgaW50IHJvdGF0aW9uID0gcGxhbmVfc3RhdGUtPmJhc2Uu
cm90YXRpb247CisJY29uc3Qgc3RydWN0IGRybV9mcmFtZWJ1ZmZlciAqZmIgPSBwbGFuZV9zdGF0
ZS0+aHcuZmI7CisJdW5zaWduZWQgaW50IHJvdGF0aW9uID0gcGxhbmVfc3RhdGUtPmh3LnJvdGF0
aW9uOwogCWNvbnN0IHN0cnVjdCBkcm1faW50ZWxfc3ByaXRlX2NvbG9ya2V5ICprZXkgPSAmcGxh
bmVfc3RhdGUtPmNrZXk7CiAJdTMyIHBsYW5lX2N0bDsKIApAQCAtNDIzMywxMCArNDIzMywxMCBA
QCB1MzIgc2tsX3BsYW5lX2N0bChjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19z
dGF0ZSwKIAkJcGxhbmVfY3RsIHw9IHNrbF9wbGFuZV9jdGxfYWxwaGEocGxhbmVfc3RhdGUpOwog
CQlwbGFuZV9jdGwgfD0gUExBTkVfQ1RMX1BMQU5FX0dBTU1BX0RJU0FCTEU7CiAKLQkJaWYgKHBs
YW5lX3N0YXRlLT5iYXNlLmNvbG9yX2VuY29kaW5nID09IERSTV9DT0xPUl9ZQ0JDUl9CVDcwOSkK
KwkJaWYgKHBsYW5lX3N0YXRlLT5ody5jb2xvcl9lbmNvZGluZyA9PSBEUk1fQ09MT1JfWUNCQ1Jf
QlQ3MDkpCiAJCQlwbGFuZV9jdGwgfD0gUExBTkVfQ1RMX1lVVl9UT19SR0JfQ1NDX0ZPUk1BVF9C
VDcwOTsKIAotCQlpZiAocGxhbmVfc3RhdGUtPmJhc2UuY29sb3JfcmFuZ2UgPT0gRFJNX0NPTE9S
X1lDQkNSX0ZVTExfUkFOR0UpCisJCWlmIChwbGFuZV9zdGF0ZS0+aHcuY29sb3JfcmFuZ2UgPT0g
RFJNX0NPTE9SX1lDQkNSX0ZVTExfUkFOR0UpCiAJCQlwbGFuZV9jdGwgfD0gUExBTkVfQ1RMX1lV
Vl9SQU5HRV9DT1JSRUNUSU9OX0RJU0FCTEU7CiAJfQogCkBAIC00Mjc4LDcgKzQyNzgsNyBAQCB1
MzIgZ2xrX3BsYW5lX2NvbG9yX2N0bChjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0
Y19zdGF0ZSwKIHsKIAlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPQogCQl0b19p
OTE1KHBsYW5lX3N0YXRlLT5iYXNlLnBsYW5lLT5kZXYpOwotCWNvbnN0IHN0cnVjdCBkcm1fZnJh
bWVidWZmZXIgKmZiID0gcGxhbmVfc3RhdGUtPmJhc2UuZmI7CisJY29uc3Qgc3RydWN0IGRybV9m
cmFtZWJ1ZmZlciAqZmIgPSBwbGFuZV9zdGF0ZS0+aHcuZmI7CiAJc3RydWN0IGludGVsX3BsYW5l
ICpwbGFuZSA9IHRvX2ludGVsX3BsYW5lKHBsYW5lX3N0YXRlLT5iYXNlLnBsYW5lKTsKIAl1MzIg
cGxhbmVfY29sb3JfY3RsID0gMDsKIApAQCAtNDI4NiwxMiArNDI4NiwxMiBAQCB1MzIgZ2xrX3Bs
YW5lX2NvbG9yX2N0bChjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSwK
IAlwbGFuZV9jb2xvcl9jdGwgfD0gZ2xrX3BsYW5lX2NvbG9yX2N0bF9hbHBoYShwbGFuZV9zdGF0
ZSk7CiAKIAlpZiAoZmItPmZvcm1hdC0+aXNfeXV2ICYmICFpY2xfaXNfaGRyX3BsYW5lKGRldl9w
cml2LCBwbGFuZS0+aWQpKSB7Ci0JCWlmIChwbGFuZV9zdGF0ZS0+YmFzZS5jb2xvcl9lbmNvZGlu
ZyA9PSBEUk1fQ09MT1JfWUNCQ1JfQlQ3MDkpCisJCWlmIChwbGFuZV9zdGF0ZS0+aHcuY29sb3Jf
ZW5jb2RpbmcgPT0gRFJNX0NPTE9SX1lDQkNSX0JUNzA5KQogCQkJcGxhbmVfY29sb3JfY3RsIHw9
IFBMQU5FX0NPTE9SX0NTQ19NT0RFX1lVVjcwOV9UT19SR0I3MDk7CiAJCWVsc2UKIAkJCXBsYW5l
X2NvbG9yX2N0bCB8PSBQTEFORV9DT0xPUl9DU0NfTU9ERV9ZVVY2MDFfVE9fUkdCNzA5OwogCi0J
CWlmIChwbGFuZV9zdGF0ZS0+YmFzZS5jb2xvcl9yYW5nZSA9PSBEUk1fQ09MT1JfWUNCQ1JfRlVM
TF9SQU5HRSkKKwkJaWYgKHBsYW5lX3N0YXRlLT5ody5jb2xvcl9yYW5nZSA9PSBEUk1fQ09MT1Jf
WUNCQ1JfRlVMTF9SQU5HRSkKIAkJCXBsYW5lX2NvbG9yX2N0bCB8PSBQTEFORV9DT0xPUl9ZVVZf
UkFOR0VfQ09SUkVDVElPTl9ESVNBQkxFOwogCX0gZWxzZSBpZiAoZmItPmZvcm1hdC0+aXNfeXV2
KSB7CiAJCXBsYW5lX2NvbG9yX2N0bCB8PSBQTEFORV9DT0xPUl9JTlBVVF9DU0NfRU5BQkxFOwpA
QCAtNTYyNSw3ICs1NjI1LDcgQEAgc3RhdGljIGludCBza2xfdXBkYXRlX3NjYWxlcl9wbGFuZShz
dHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSwKIAlzdHJ1Y3QgaW50ZWxfcGxhbmUg
KmludGVsX3BsYW5lID0KIAkJdG9faW50ZWxfcGxhbmUocGxhbmVfc3RhdGUtPmJhc2UucGxhbmUp
OwogCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoaW50ZWxfcGxh
bmUtPmJhc2UuZGV2KTsKLQlzdHJ1Y3QgZHJtX2ZyYW1lYnVmZmVyICpmYiA9IHBsYW5lX3N0YXRl
LT5iYXNlLmZiOworCXN0cnVjdCBkcm1fZnJhbWVidWZmZXIgKmZiID0gcGxhbmVfc3RhdGUtPmh3
LmZiOwogCWludCByZXQ7CiAJYm9vbCBmb3JjZV9kZXRhY2ggPSAhZmIgfHwgIXBsYW5lX3N0YXRl
LT5iYXNlLnZpc2libGU7CiAJYm9vbCBuZWVkX3NjYWxlciA9IGZhbHNlOwpAQCAtMTA3MjksNyAr
MTA3MjksNyBAQCBzdGF0aWMgdTMyIGludGVsX2N1cnNvcl9iYXNlKGNvbnN0IHN0cnVjdCBpbnRl
bF9wbGFuZV9zdGF0ZSAqcGxhbmVfc3RhdGUpCiB7CiAJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUg
KmRldl9wcml2ID0KIAkJdG9faTkxNShwbGFuZV9zdGF0ZS0+YmFzZS5wbGFuZS0+ZGV2KTsKLQlj
b25zdCBzdHJ1Y3QgZHJtX2ZyYW1lYnVmZmVyICpmYiA9IHBsYW5lX3N0YXRlLT5iYXNlLmZiOwor
CWNvbnN0IHN0cnVjdCBkcm1fZnJhbWVidWZmZXIgKmZiID0gcGxhbmVfc3RhdGUtPmh3LmZiOwog
CWNvbnN0IHN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmogPSBpbnRlbF9mYl9vYmooZmIp
OwogCXUzMiBiYXNlOwogCkBAIC0xMDc3Nyw3ICsxMDc3Nyw3IEBAIHN0YXRpYyBpbnQgaW50ZWxf
Y3Vyc29yX2NoZWNrX3N1cmZhY2Uoc3RydWN0IGludGVsX3BsYW5lX3N0YXRlICpwbGFuZV9zdGF0
ZSkKIHsKIAlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPQogCQl0b19pOTE1KHBs
YW5lX3N0YXRlLT5iYXNlLnBsYW5lLT5kZXYpOwotCXVuc2lnbmVkIGludCByb3RhdGlvbiA9IHBs
YW5lX3N0YXRlLT5iYXNlLnJvdGF0aW9uOworCXVuc2lnbmVkIGludCByb3RhdGlvbiA9IHBsYW5l
X3N0YXRlLT5ody5yb3RhdGlvbjsKIAlpbnQgc3JjX3gsIHNyY195OwogCXUzMiBvZmZzZXQ7CiAJ
aW50IHJldDsKQEAgLTEwODEwLDcgKzEwODEwLDcgQEAgc3RhdGljIGludCBpbnRlbF9jdXJzb3Jf
Y2hlY2tfc3VyZmFjZShzdHJ1Y3QgaW50ZWxfcGxhbmVfc3RhdGUgKnBsYW5lX3N0YXRlKQogCiAJ
LyogSUxLKyBkbyB0aGlzIGF1dG9tYWdpY2FsbHkgaW4gaGFyZHdhcmUgKi8KIAlpZiAoSEFTX0dN
Q0goZGV2X3ByaXYpICYmIHJvdGF0aW9uICYgRFJNX01PREVfUk9UQVRFXzE4MCkgewotCQljb25z
dCBzdHJ1Y3QgZHJtX2ZyYW1lYnVmZmVyICpmYiA9IHBsYW5lX3N0YXRlLT5iYXNlLmZiOworCQlj
b25zdCBzdHJ1Y3QgZHJtX2ZyYW1lYnVmZmVyICpmYiA9IHBsYW5lX3N0YXRlLT5ody5mYjsKIAkJ
aW50IHNyY193ID0gZHJtX3JlY3Rfd2lkdGgoJnBsYW5lX3N0YXRlLT5iYXNlLnNyYykgPj4gMTY7
CiAJCWludCBzcmNfaCA9IGRybV9yZWN0X2hlaWdodCgmcGxhbmVfc3RhdGUtPmJhc2Uuc3JjKSA+
PiAxNjsKIApAQCAtMTA4MjcsNyArMTA4MjcsNyBAQCBzdGF0aWMgaW50IGludGVsX2N1cnNvcl9j
aGVja19zdXJmYWNlKHN0cnVjdCBpbnRlbF9wbGFuZV9zdGF0ZSAqcGxhbmVfc3RhdGUpCiBzdGF0
aWMgaW50IGludGVsX2NoZWNrX2N1cnNvcihzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19z
dGF0ZSwKIAkJCSAgICAgIHN0cnVjdCBpbnRlbF9wbGFuZV9zdGF0ZSAqcGxhbmVfc3RhdGUpCiB7
Ci0JY29uc3Qgc3RydWN0IGRybV9mcmFtZWJ1ZmZlciAqZmIgPSBwbGFuZV9zdGF0ZS0+YmFzZS5m
YjsKKwljb25zdCBzdHJ1Y3QgZHJtX2ZyYW1lYnVmZmVyICpmYiA9IHBsYW5lX3N0YXRlLT5ody5m
YjsKIAlpbnQgcmV0OwogCiAJaWYgKGZiICYmIGZiLT5tb2RpZmllciAhPSBEUk1fRk9STUFUX01P
RF9MSU5FQVIpIHsKQEAgLTEwOTAxLDcgKzEwOTAxLDcgQEAgc3RhdGljIGJvb2wgaTg0NV9jdXJz
b3Jfc2l6ZV9vayhjb25zdCBzdHJ1Y3QgaW50ZWxfcGxhbmVfc3RhdGUgKnBsYW5lX3N0YXRlKQog
c3RhdGljIGludCBpODQ1X2NoZWNrX2N1cnNvcihzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0
Y19zdGF0ZSwKIAkJCSAgICAgc3RydWN0IGludGVsX3BsYW5lX3N0YXRlICpwbGFuZV9zdGF0ZSkK
IHsKLQljb25zdCBzdHJ1Y3QgZHJtX2ZyYW1lYnVmZmVyICpmYiA9IHBsYW5lX3N0YXRlLT5iYXNl
LmZiOworCWNvbnN0IHN0cnVjdCBkcm1fZnJhbWVidWZmZXIgKmZiID0gcGxhbmVfc3RhdGUtPmh3
LmZiOwogCWludCByZXQ7CiAKIAlyZXQgPSBpbnRlbF9jaGVja19jdXJzb3IoY3J0Y19zdGF0ZSwg
cGxhbmVfc3RhdGUpOwpAQCAtMTEwNjcsNyArMTEwNjcsNyBAQCBzdGF0aWMgdTMyIGk5eHhfY3Vy
c29yX2N0bChjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSwKIAkJcmV0
dXJuIDA7CiAJfQogCi0JaWYgKHBsYW5lX3N0YXRlLT5iYXNlLnJvdGF0aW9uICYgRFJNX01PREVf
Uk9UQVRFXzE4MCkKKwlpZiAocGxhbmVfc3RhdGUtPmh3LnJvdGF0aW9uICYgRFJNX01PREVfUk9U
QVRFXzE4MCkKIAkJY250bCB8PSBNQ1VSU09SX1JPVEFURV8xODA7CiAKIAlyZXR1cm4gY250bDsK
QEAgLTExMTAwLDcgKzExMTAwLDcgQEAgc3RhdGljIGJvb2wgaTl4eF9jdXJzb3Jfc2l6ZV9vayhj
b25zdCBzdHJ1Y3QgaW50ZWxfcGxhbmVfc3RhdGUgKnBsYW5lX3N0YXRlKQogCSAqIGN1cnNvcnMu
CiAJICovCiAJaWYgKEhBU19DVVJfRkJDKGRldl9wcml2KSAmJgotCSAgICBwbGFuZV9zdGF0ZS0+
YmFzZS5yb3RhdGlvbiAmIERSTV9NT0RFX1JPVEFURV8wKSB7CisJICAgIHBsYW5lX3N0YXRlLT5o
dy5yb3RhdGlvbiAmIERSTV9NT0RFX1JPVEFURV8wKSB7CiAJCWlmIChoZWlnaHQgPCA4IHx8IGhl
aWdodCA+IHdpZHRoKQogCQkJcmV0dXJuIGZhbHNlOwogCX0gZWxzZSB7CkBAIC0xMTExNiw3ICsx
MTExNiw3IEBAIHN0YXRpYyBpbnQgaTl4eF9jaGVja19jdXJzb3Ioc3RydWN0IGludGVsX2NydGNf
c3RhdGUgKmNydGNfc3RhdGUsCiB7CiAJc3RydWN0IGludGVsX3BsYW5lICpwbGFuZSA9IHRvX2lu
dGVsX3BsYW5lKHBsYW5lX3N0YXRlLT5iYXNlLnBsYW5lKTsKIAlzdHJ1Y3QgZHJtX2k5MTVfcHJp
dmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KHBsYW5lLT5iYXNlLmRldik7Ci0JY29uc3Qgc3RydWN0
IGRybV9mcmFtZWJ1ZmZlciAqZmIgPSBwbGFuZV9zdGF0ZS0+YmFzZS5mYjsKKwljb25zdCBzdHJ1
Y3QgZHJtX2ZyYW1lYnVmZmVyICpmYiA9IHBsYW5lX3N0YXRlLT5ody5mYjsKIAllbnVtIHBpcGUg
cGlwZSA9IHBsYW5lLT5waXBlOwogCWludCByZXQ7CiAKQEAgLTExNzIwLDExICsxMTcyMCwxMSBA
QCBzdGF0aWMgYm9vbCBpbnRlbF93bV9uZWVkX3VwZGF0ZShjb25zdCBzdHJ1Y3QgaW50ZWxfcGxh
bmVfc3RhdGUgKmN1ciwKIAlpZiAobmV3LT5iYXNlLnZpc2libGUgIT0gY3VyLT5iYXNlLnZpc2li
bGUpCiAJCXJldHVybiB0cnVlOwogCi0JaWYgKCFjdXItPmJhc2UuZmIgfHwgIW5ldy0+YmFzZS5m
YikKKwlpZiAoIWN1ci0+aHcuZmIgfHwgIW5ldy0+aHcuZmIpCiAJCXJldHVybiBmYWxzZTsKIAot
CWlmIChjdXItPmJhc2UuZmItPm1vZGlmaWVyICE9IG5ldy0+YmFzZS5mYi0+bW9kaWZpZXIgfHwK
LQkgICAgY3VyLT5iYXNlLnJvdGF0aW9uICE9IG5ldy0+YmFzZS5yb3RhdGlvbiB8fAorCWlmIChj
dXItPmh3LmZiLT5tb2RpZmllciAhPSBuZXctPmh3LmZiLT5tb2RpZmllciB8fAorCSAgICBjdXIt
Pmh3LnJvdGF0aW9uICE9IG5ldy0+aHcucm90YXRpb24gfHwKIAkgICAgZHJtX3JlY3Rfd2lkdGgo
Jm5ldy0+YmFzZS5zcmMpICE9IGRybV9yZWN0X3dpZHRoKCZjdXItPmJhc2Uuc3JjKSB8fAogCSAg
ICBkcm1fcmVjdF9oZWlnaHQoJm5ldy0+YmFzZS5zcmMpICE9IGRybV9yZWN0X2hlaWdodCgmY3Vy
LT5iYXNlLnNyYykgfHwKIAkgICAgZHJtX3JlY3Rfd2lkdGgoJm5ldy0+YmFzZS5kc3QpICE9IGRy
bV9yZWN0X3dpZHRoKCZjdXItPmJhc2UuZHN0KSB8fApAQCAtMTIzNTYsNyArMTIzNTYsNyBAQCBz
dGF0aWMgY29uc3QgY2hhciAqb3V0cHV0X2Zvcm1hdHMoZW51bSBpbnRlbF9vdXRwdXRfZm9ybWF0
IGZvcm1hdCkKIHN0YXRpYyB2b2lkIGludGVsX2R1bXBfcGxhbmVfc3RhdGUoY29uc3Qgc3RydWN0
IGludGVsX3BsYW5lX3N0YXRlICpwbGFuZV9zdGF0ZSkKIHsKIAlzdHJ1Y3QgaW50ZWxfcGxhbmUg
KnBsYW5lID0gdG9faW50ZWxfcGxhbmUocGxhbmVfc3RhdGUtPmJhc2UucGxhbmUpOwotCWNvbnN0
IHN0cnVjdCBkcm1fZnJhbWVidWZmZXIgKmZiID0gcGxhbmVfc3RhdGUtPmJhc2UuZmI7CisJY29u
c3Qgc3RydWN0IGRybV9mcmFtZWJ1ZmZlciAqZmIgPSBwbGFuZV9zdGF0ZS0+aHcuZmI7CiAJc3Ry
dWN0IGRybV9mb3JtYXRfbmFtZV9idWYgZm9ybWF0X25hbWU7CiAKIAlpZiAoIWZiKSB7CkBAIC0x
MjM3Miw3ICsxMjM3Miw3IEBAIHN0YXRpYyB2b2lkIGludGVsX2R1bXBfcGxhbmVfc3RhdGUoY29u
c3Qgc3RydWN0IGludGVsX3BsYW5lX3N0YXRlICpwbGFuZV9zdGF0ZSkKIAkJICAgICAgZHJtX2dl
dF9mb3JtYXRfbmFtZShmYi0+Zm9ybWF0LT5mb3JtYXQsICZmb3JtYXRfbmFtZSksCiAJCSAgICAg
IHllc25vKHBsYW5lX3N0YXRlLT5iYXNlLnZpc2libGUpKTsKIAlEUk1fREVCVUdfS01TKCJcdHJv
dGF0aW9uOiAweCV4LCBzY2FsZXI6ICVkXG4iLAotCQkgICAgICBwbGFuZV9zdGF0ZS0+YmFzZS5y
b3RhdGlvbiwgcGxhbmVfc3RhdGUtPnNjYWxlcl9pZCk7CisJCSAgICAgIHBsYW5lX3N0YXRlLT5o
dy5yb3RhdGlvbiwgcGxhbmVfc3RhdGUtPnNjYWxlcl9pZCk7CiAJaWYgKHBsYW5lX3N0YXRlLT5i
YXNlLnZpc2libGUpCiAJCURSTV9ERUJVR19LTVMoIlx0c3JjOiAiIERSTV9SRUNUX0ZQX0ZNVCAi
IGRzdDogIiBEUk1fUkVDVF9GTVQgIlxuIiwKIAkJCSAgICAgIERSTV9SRUNUX0ZQX0FSRygmcGxh
bmVfc3RhdGUtPmJhc2Uuc3JjKSwKQEAgLTE0ODc2LDggKzE0ODc2LDggQEAgc3RhdGljIHZvaWQg
aW50ZWxfYXRvbWljX3RyYWNrX2ZicyhzdHJ1Y3QgaW50ZWxfYXRvbWljX3N0YXRlICpzdGF0ZSkK
IAogCWZvcl9lYWNoX29sZG5ld19pbnRlbF9wbGFuZV9pbl9zdGF0ZShzdGF0ZSwgcGxhbmUsIG9s
ZF9wbGFuZV9zdGF0ZSwKIAkJCQkJICAgICBuZXdfcGxhbmVfc3RhdGUsIGkpCi0JCWludGVsX2Zy
b250YnVmZmVyX3RyYWNrKHRvX2ludGVsX2Zyb250YnVmZmVyKG9sZF9wbGFuZV9zdGF0ZS0+YmFz
ZS5mYiksCi0JCQkJCXRvX2ludGVsX2Zyb250YnVmZmVyKG5ld19wbGFuZV9zdGF0ZS0+YmFzZS5m
YiksCisJCWludGVsX2Zyb250YnVmZmVyX3RyYWNrKHRvX2ludGVsX2Zyb250YnVmZmVyKG9sZF9w
bGFuZV9zdGF0ZS0+aHcuZmIpLAorCQkJCQl0b19pbnRlbF9mcm9udGJ1ZmZlcihuZXdfcGxhbmVf
c3RhdGUtPmh3LmZiKSwKIAkJCQkJcGxhbmUtPmZyb250YnVmZmVyX2JpdCk7CiB9CiAKQEAgLTE1
MDQ2LDcgKzE1MDQ2LDcgQEAgc3RhdGljIGludCBpbnRlbF9wbGFuZV9waW5fZmIoc3RydWN0IGlu
dGVsX3BsYW5lX3N0YXRlICpwbGFuZV9zdGF0ZSkKIHsKIAlzdHJ1Y3QgaW50ZWxfcGxhbmUgKnBs
YW5lID0gdG9faW50ZWxfcGxhbmUocGxhbmVfc3RhdGUtPmJhc2UucGxhbmUpOwogCXN0cnVjdCBk
cm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUocGxhbmUtPmJhc2UuZGV2KTsKLQlz
dHJ1Y3QgZHJtX2ZyYW1lYnVmZmVyICpmYiA9IHBsYW5lX3N0YXRlLT5iYXNlLmZiOworCXN0cnVj
dCBkcm1fZnJhbWVidWZmZXIgKmZiID0gcGxhbmVfc3RhdGUtPmh3LmZiOwogCXN0cnVjdCBpOTE1
X3ZtYSAqdm1hOwogCiAJaWYgKHBsYW5lLT5pZCA9PSBQTEFORV9DVVJTT1IgJiYKQEAgLTE1MTEx
LDcgKzE1MTExLDcgQEAgaW50ZWxfcHJlcGFyZV9wbGFuZV9mYihzdHJ1Y3QgZHJtX3BsYW5lICpw
bGFuZSwKIAlzdHJ1Y3QgaW50ZWxfYXRvbWljX3N0YXRlICppbnRlbF9zdGF0ZSA9CiAJCXRvX2lu
dGVsX2F0b21pY19zdGF0ZShuZXdfcGxhbmVfc3RhdGUtPmJhc2Uuc3RhdGUpOwogCXN0cnVjdCBk
cm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUocGxhbmUtPmRldik7Ci0Jc3RydWN0
IGRybV9mcmFtZWJ1ZmZlciAqZmIgPSBuZXdfcGxhbmVfc3RhdGUtPmJhc2UuZmI7CisJc3RydWN0
IGRybV9mcmFtZWJ1ZmZlciAqZmIgPSBuZXdfcGxhbmVfc3RhdGUtPmh3LmZiOwogCXN0cnVjdCBk
cm1faTkxNV9nZW1fb2JqZWN0ICpvYmogPSBpbnRlbF9mYl9vYmooZmIpOwogCXN0cnVjdCBkcm1f
aTkxNV9nZW1fb2JqZWN0ICpvbGRfb2JqID0gaW50ZWxfZmJfb2JqKHBsYW5lLT5zdGF0ZS0+ZmIp
OwogCWludCByZXQ7CkBAIC0xNTE3OSwxMiArMTUxNzksMTIgQEAgaW50ZWxfcHJlcGFyZV9wbGFu
ZV9mYihzdHJ1Y3QgZHJtX3BsYW5lICpwbGFuZSwKIAogCQlmZW5jZSA9IGRtYV9yZXN2X2dldF9l
eGNsX3JjdShvYmotPmJhc2UucmVzdik7CiAJCWlmIChmZW5jZSkgewotCQkJYWRkX3Jwc19ib29z
dF9hZnRlcl92YmxhbmsobmV3X3BsYW5lX3N0YXRlLT5iYXNlLmNydGMsCisJCQlhZGRfcnBzX2Jv
b3N0X2FmdGVyX3ZibGFuayhuZXdfcGxhbmVfc3RhdGUtPmh3LmNydGMsCiAJCQkJCQkgICBmZW5j
ZSk7CiAJCQlkbWFfZmVuY2VfcHV0KGZlbmNlKTsKIAkJfQogCX0gZWxzZSB7Ci0JCWFkZF9ycHNf
Ym9vc3RfYWZ0ZXJfdmJsYW5rKG5ld19wbGFuZV9zdGF0ZS0+YmFzZS5jcnRjLAorCQlhZGRfcnBz
X2Jvb3N0X2FmdGVyX3ZibGFuayhuZXdfcGxhbmVfc3RhdGUtPmh3LmNydGMsCiAJCQkJCSAgIG5l
d19wbGFuZV9zdGF0ZS0+YmFzZS5mZW5jZSk7CiAJfQogCkBAIC0xNTM5Nyw5ICsxNTM5NywxMCBA
QCBpbnRlbF9sZWdhY3lfY3Vyc29yX3VwZGF0ZShzdHJ1Y3QgZHJtX3BsYW5lICpfcGxhbmUsCiAJ
aWYgKHJldCkKIAkJZ290byBvdXRfZnJlZTsKIAotCWludGVsX2Zyb250YnVmZmVyX2ZsdXNoKHRv
X2ludGVsX2Zyb250YnVmZmVyKG5ld19wbGFuZV9zdGF0ZS0+YmFzZS5mYiksIE9SSUdJTl9GTElQ
KTsKLQlpbnRlbF9mcm9udGJ1ZmZlcl90cmFjayh0b19pbnRlbF9mcm9udGJ1ZmZlcihvbGRfcGxh
bmVfc3RhdGUtPmJhc2UuZmIpLAotCQkJCXRvX2ludGVsX2Zyb250YnVmZmVyKG5ld19wbGFuZV9z
dGF0ZS0+YmFzZS5mYiksCisJaW50ZWxfZnJvbnRidWZmZXJfZmx1c2godG9faW50ZWxfZnJvbnRi
dWZmZXIobmV3X3BsYW5lX3N0YXRlLT5ody5mYiksCisJCQkJT1JJR0lOX0ZMSVApOworCWludGVs
X2Zyb250YnVmZmVyX3RyYWNrKHRvX2ludGVsX2Zyb250YnVmZmVyKG9sZF9wbGFuZV9zdGF0ZS0+
aHcuZmIpLAorCQkJCXRvX2ludGVsX2Zyb250YnVmZmVyKG5ld19wbGFuZV9zdGF0ZS0+aHcuZmIp
LAogCQkJCXBsYW5lLT5mcm9udGJ1ZmZlcl9iaXQpOwogCiAJLyogU3dhcCBwbGFuZSBzdGF0ZSAq
LwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9mYmMuYyBi
L2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZmJjLmMKaW5kZXggYzZjYzM3NzVm
M2I4Li4zZWE4ZDAxMGRiNmMgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3Bs
YXkvaW50ZWxfZmJjLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9m
YmMuYwpAQCAtNjYyLDcgKzY2Miw3IEBAIHN0YXRpYyB2b2lkIGludGVsX2ZiY191cGRhdGVfc3Rh
dGVfY2FjaGUoc3RydWN0IGludGVsX2NydGMgKmNydGMsCiAJc3RydWN0IGRybV9pOTE1X3ByaXZh
dGUgKmRldl9wcml2ID0gdG9faTkxNShjcnRjLT5iYXNlLmRldik7CiAJc3RydWN0IGludGVsX2Zi
YyAqZmJjID0gJmRldl9wcml2LT5mYmM7CiAJc3RydWN0IGludGVsX2ZiY19zdGF0ZV9jYWNoZSAq
Y2FjaGUgPSAmZmJjLT5zdGF0ZV9jYWNoZTsKLQlzdHJ1Y3QgZHJtX2ZyYW1lYnVmZmVyICpmYiA9
IHBsYW5lX3N0YXRlLT5iYXNlLmZiOworCXN0cnVjdCBkcm1fZnJhbWVidWZmZXIgKmZiID0gcGxh
bmVfc3RhdGUtPmh3LmZiOwogCiAJY2FjaGUtPnZtYSA9IE5VTEw7CiAJY2FjaGUtPmZsYWdzID0g
MDsKQEAgLTY3MSw3ICs2NzEsNyBAQCBzdGF0aWMgdm9pZCBpbnRlbF9mYmNfdXBkYXRlX3N0YXRl
X2NhY2hlKHN0cnVjdCBpbnRlbF9jcnRjICpjcnRjLAogCWlmIChJU19IQVNXRUxMKGRldl9wcml2
KSB8fCBJU19CUk9BRFdFTEwoZGV2X3ByaXYpKQogCQljYWNoZS0+Y3J0Yy5oc3dfYmR3X3BpeGVs
X3JhdGUgPSBjcnRjX3N0YXRlLT5waXhlbF9yYXRlOwogCi0JY2FjaGUtPnBsYW5lLnJvdGF0aW9u
ID0gcGxhbmVfc3RhdGUtPmJhc2Uucm90YXRpb247CisJY2FjaGUtPnBsYW5lLnJvdGF0aW9uID0g
cGxhbmVfc3RhdGUtPmh3LnJvdGF0aW9uOwogCS8qCiAJICogU3JjIGNvb3JkaW5hdGVzIGFyZSBh
bHJlYWR5IHJvdGF0ZWQgYnkgMjcwIGRlZ3JlZXMgZm9yCiAJICogdGhlIDkwLzI3MCBkZWdyZWUg
cGxhbmUgcm90YXRpb24gY2FzZXMgKHRvIG1hdGNoIHRoZQpAQCAtNjg0LDcgKzY4NCw3IEBAIHN0
YXRpYyB2b2lkIGludGVsX2ZiY191cGRhdGVfc3RhdGVfY2FjaGUoc3RydWN0IGludGVsX2NydGMg
KmNydGMsCiAJY2FjaGUtPnBsYW5lLmFkanVzdGVkX3kgPSBwbGFuZV9zdGF0ZS0+Y29sb3JfcGxh
bmVbMF0ueTsKIAljYWNoZS0+cGxhbmUueSA9IHBsYW5lX3N0YXRlLT5iYXNlLnNyYy55MSA+PiAx
NjsKIAotCWNhY2hlLT5wbGFuZS5waXhlbF9ibGVuZF9tb2RlID0gcGxhbmVfc3RhdGUtPmJhc2Uu
cGl4ZWxfYmxlbmRfbW9kZTsKKwljYWNoZS0+cGxhbmUucGl4ZWxfYmxlbmRfbW9kZSA9IHBsYW5l
X3N0YXRlLT5ody5waXhlbF9ibGVuZF9tb2RlOwogCiAJaWYgKCFjYWNoZS0+cGxhbmUudmlzaWJs
ZSkKIAkJcmV0dXJuOwpAQCAtMTA0Nyw3ICsxMDQ3LDcgQEAgdm9pZCBpbnRlbF9mYmNfY2hvb3Nl
X2NydGMoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAogCSAqIHRvIHBpcGUgb3Ig
cGxhbmUgQS4gKi8KIAlmb3JfZWFjaF9uZXdfaW50ZWxfcGxhbmVfaW5fc3RhdGUoc3RhdGUsIHBs
YW5lLCBwbGFuZV9zdGF0ZSwgaSkgewogCQlzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19z
dGF0ZTsKLQkJc3RydWN0IGludGVsX2NydGMgKmNydGMgPSB0b19pbnRlbF9jcnRjKHBsYW5lX3N0
YXRlLT5iYXNlLmNydGMpOworCQlzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YyA9IHRvX2ludGVsX2Ny
dGMocGxhbmVfc3RhdGUtPmh3LmNydGMpOwogCiAJCWlmICghcGxhbmUtPmhhc19mYmMpCiAJCQlj
b250aW51ZTsKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxf
b3ZlcmxheS5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9vdmVybGF5LmMK
aW5kZXggODQ4Y2UwN2E4ZWMyLi40NmUzZDZjZjU5NzYgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1
L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfb3ZlcmxheS5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9p
OTE1L2Rpc3BsYXkvaW50ZWxfb3ZlcmxheS5jCkBAIC02NjksNyArNjY5LDcgQEAgc3RhdGljIHZv
aWQgdXBkYXRlX2NvbG9ya2V5KHN0cnVjdCBpbnRlbF9vdmVybGF5ICpvdmVybGF5LAogCQlmbGFn
cyB8PSBEU1RfS0VZX0VOQUJMRTsKIAogCWlmIChzdGF0ZS0+YmFzZS52aXNpYmxlKQotCQlmb3Jt
YXQgPSBzdGF0ZS0+YmFzZS5mYi0+Zm9ybWF0LT5mb3JtYXQ7CisJCWZvcm1hdCA9IHN0YXRlLT5o
dy5mYi0+Zm9ybWF0LT5mb3JtYXQ7CiAKIAlzd2l0Y2ggKGZvcm1hdCkgewogCWNhc2UgRFJNX0ZP
Uk1BVF9DODoKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxf
c3ByaXRlLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX3Nwcml0ZS5jCmlu
ZGV4IDViYThmYWYwY2NmZS4uYjIxMTZkMTIzNTQ4IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9k
cm0vaTkxNS9kaXNwbGF5L2ludGVsX3Nwcml0ZS5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1
L2Rpc3BsYXkvaW50ZWxfc3ByaXRlLmMKQEAgLTI0MSw4ICsyNDEsOCBAQCB2b2lkIGludGVsX3Bp
cGVfdXBkYXRlX2VuZChzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqbmV3X2NydGNfc3RhdGUpCiBp
bnQgaW50ZWxfcGxhbmVfY2hlY2tfc3RyaWRlKGNvbnN0IHN0cnVjdCBpbnRlbF9wbGFuZV9zdGF0
ZSAqcGxhbmVfc3RhdGUpCiB7CiAJc3RydWN0IGludGVsX3BsYW5lICpwbGFuZSA9IHRvX2ludGVs
X3BsYW5lKHBsYW5lX3N0YXRlLT5iYXNlLnBsYW5lKTsKLQljb25zdCBzdHJ1Y3QgZHJtX2ZyYW1l
YnVmZmVyICpmYiA9IHBsYW5lX3N0YXRlLT5iYXNlLmZiOwotCXVuc2lnbmVkIGludCByb3RhdGlv
biA9IHBsYW5lX3N0YXRlLT5iYXNlLnJvdGF0aW9uOworCWNvbnN0IHN0cnVjdCBkcm1fZnJhbWVi
dWZmZXIgKmZiID0gcGxhbmVfc3RhdGUtPmh3LmZiOworCXVuc2lnbmVkIGludCByb3RhdGlvbiA9
IHBsYW5lX3N0YXRlLT5ody5yb3RhdGlvbjsKIAl1MzIgc3RyaWRlLCBtYXhfc3RyaWRlOwogCiAJ
LyoKQEAgLTI3MiwxMCArMjcyLDEwIEBAIGludCBpbnRlbF9wbGFuZV9jaGVja19zdHJpZGUoY29u
c3Qgc3RydWN0IGludGVsX3BsYW5lX3N0YXRlICpwbGFuZV9zdGF0ZSkKIAogaW50IGludGVsX3Bs
YW5lX2NoZWNrX3NyY19jb29yZGluYXRlcyhzdHJ1Y3QgaW50ZWxfcGxhbmVfc3RhdGUgKnBsYW5l
X3N0YXRlKQogewotCWNvbnN0IHN0cnVjdCBkcm1fZnJhbWVidWZmZXIgKmZiID0gcGxhbmVfc3Rh
dGUtPmJhc2UuZmI7CisJY29uc3Qgc3RydWN0IGRybV9mcmFtZWJ1ZmZlciAqZmIgPSBwbGFuZV9z
dGF0ZS0+aHcuZmI7CiAJc3RydWN0IGRybV9yZWN0ICpzcmMgPSAmcGxhbmVfc3RhdGUtPmJhc2Uu
c3JjOwogCXUzMiBzcmNfeCwgc3JjX3ksIHNyY193LCBzcmNfaCwgaHN1YiwgdnN1YjsKLQlib29s
IHJvdGF0ZWQgPSBkcm1fcm90YXRpb25fOTBfb3JfMjcwKHBsYW5lX3N0YXRlLT5iYXNlLnJvdGF0
aW9uKTsKKwlib29sIHJvdGF0ZWQgPSBkcm1fcm90YXRpb25fOTBfb3JfMjcwKHBsYW5lX3N0YXRl
LT5ody5yb3RhdGlvbik7CiAKIAkvKgogCSAqIEhhcmR3YXJlIGRvZXNuJ3QgaGFuZGxlIHN1YnBp
eGVsIGNvb3JkaW5hdGVzLgpAQCAtMzI5LDcgKzMyOSw3IEBAIHNrbF9wbGFuZV9yYXRpbyhjb25z
dCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSwKIAkJdW5zaWduZWQgaW50ICpu
dW0sIHVuc2lnbmVkIGludCAqZGVuKQogewogCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZf
cHJpdiA9IHRvX2k5MTUocGxhbmVfc3RhdGUtPmJhc2UucGxhbmUtPmRldik7Ci0JY29uc3Qgc3Ry
dWN0IGRybV9mcmFtZWJ1ZmZlciAqZmIgPSBwbGFuZV9zdGF0ZS0+YmFzZS5mYjsKKwljb25zdCBz
dHJ1Y3QgZHJtX2ZyYW1lYnVmZmVyICpmYiA9IHBsYW5lX3N0YXRlLT5ody5mYjsKIAogCWlmIChm
Yi0+Zm9ybWF0LT5jcHBbMF0gPT0gOCkgewogCQlpZiAoSU5URUxfR0VOKGRldl9wcml2KSA+PSAx
MCB8fCBJU19HRU1JTklMQUtFKGRldl9wcml2KSkgewpAQCAtMzk2LDcgKzM5Niw3IEBAIHNrbF9w
cm9ncmFtX3NjYWxlcihzdHJ1Y3QgaW50ZWxfcGxhbmUgKnBsYW5lLAogCQkgICBjb25zdCBzdHJ1
Y3QgaW50ZWxfcGxhbmVfc3RhdGUgKnBsYW5lX3N0YXRlKQogewogCXN0cnVjdCBkcm1faTkxNV9w
cml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUocGxhbmUtPmJhc2UuZGV2KTsKLQljb25zdCBzdHJ1
Y3QgZHJtX2ZyYW1lYnVmZmVyICpmYiA9IHBsYW5lX3N0YXRlLT5iYXNlLmZiOworCWNvbnN0IHN0
cnVjdCBkcm1fZnJhbWVidWZmZXIgKmZiID0gcGxhbmVfc3RhdGUtPmh3LmZiOwogCWVudW0gcGlw
ZSBwaXBlID0gcGxhbmUtPnBpcGU7CiAJaW50IHNjYWxlcl9pZCA9IHBsYW5lX3N0YXRlLT5zY2Fs
ZXJfaWQ7CiAJY29uc3Qgc3RydWN0IGludGVsX3NjYWxlciAqc2NhbGVyID0KQEAgLTU0MiwxMCAr
NTQyLDEwIEBAIGljbF9wcm9ncmFtX2lucHV0X2NzYyhzdHJ1Y3QgaW50ZWxfcGxhbmUgKnBsYW5l
LAogCX07CiAJY29uc3QgdTE2ICpjc2M7CiAKLQlpZiAocGxhbmVfc3RhdGUtPmJhc2UuY29sb3Jf
cmFuZ2UgPT0gRFJNX0NPTE9SX1lDQkNSX0ZVTExfUkFOR0UpCi0JCWNzYyA9IGlucHV0X2NzY19t
YXRyaXhbcGxhbmVfc3RhdGUtPmJhc2UuY29sb3JfZW5jb2RpbmddOworCWlmIChwbGFuZV9zdGF0
ZS0+aHcuY29sb3JfcmFuZ2UgPT0gRFJNX0NPTE9SX1lDQkNSX0ZVTExfUkFOR0UpCisJCWNzYyA9
IGlucHV0X2NzY19tYXRyaXhbcGxhbmVfc3RhdGUtPmh3LmNvbG9yX2VuY29kaW5nXTsKIAllbHNl
Ci0JCWNzYyA9IGlucHV0X2NzY19tYXRyaXhfbHJbcGxhbmVfc3RhdGUtPmJhc2UuY29sb3JfZW5j
b2RpbmddOworCQljc2MgPSBpbnB1dF9jc2NfbWF0cml4X2xyW3BsYW5lX3N0YXRlLT5ody5jb2xv
cl9lbmNvZGluZ107CiAKIAlJOTE1X1dSSVRFX0ZXKFBMQU5FX0lOUFVUX0NTQ19DT0VGRihwaXBl
LCBwbGFuZV9pZCwgMCksIFJPRkYoY3NjWzBdKSB8CiAJCSAgICAgIEdPRkYoY3NjWzFdKSk7CkBA
IC01NTksNyArNTU5LDcgQEAgaWNsX3Byb2dyYW1faW5wdXRfY3NjKHN0cnVjdCBpbnRlbF9wbGFu
ZSAqcGxhbmUsCiAKIAlJOTE1X1dSSVRFX0ZXKFBMQU5FX0lOUFVUX0NTQ19QUkVPRkYocGlwZSwg
cGxhbmVfaWQsIDApLAogCQkgICAgICBQUkVPRkZfWVVWX1RPX1JHQl9ISSk7Ci0JaWYgKHBsYW5l
X3N0YXRlLT5iYXNlLmNvbG9yX3JhbmdlID09IERSTV9DT0xPUl9ZQ0JDUl9GVUxMX1JBTkdFKQor
CWlmIChwbGFuZV9zdGF0ZS0+aHcuY29sb3JfcmFuZ2UgPT0gRFJNX0NPTE9SX1lDQkNSX0ZVTExf
UkFOR0UpCiAJCUk5MTVfV1JJVEVfRlcoUExBTkVfSU5QVVRfQ1NDX1BSRU9GRihwaXBlLCBwbGFu
ZV9pZCwgMSksIDApOwogCWVsc2UKIAkJSTkxNV9XUklURV9GVyhQTEFORV9JTlBVVF9DU0NfUFJF
T0ZGKHBpcGUsIHBsYW5lX2lkLCAxKSwKQEAgLTU5MSw4ICs1OTEsOCBAQCBza2xfcHJvZ3JhbV9w
bGFuZShzdHJ1Y3QgaW50ZWxfcGxhbmUgKnBsYW5lLAogCXUzMiBzcmNfdyA9IGRybV9yZWN0X3dp
ZHRoKCZwbGFuZV9zdGF0ZS0+YmFzZS5zcmMpID4+IDE2OwogCXUzMiBzcmNfaCA9IGRybV9yZWN0
X2hlaWdodCgmcGxhbmVfc3RhdGUtPmJhc2Uuc3JjKSA+PiAxNjsKIAlzdHJ1Y3QgaW50ZWxfcGxh
bmUgKmxpbmtlZCA9IHBsYW5lX3N0YXRlLT5wbGFuYXJfbGlua2VkX3BsYW5lOwotCWNvbnN0IHN0
cnVjdCBkcm1fZnJhbWVidWZmZXIgKmZiID0gcGxhbmVfc3RhdGUtPmJhc2UuZmI7Ci0JdTggYWxw
aGEgPSBwbGFuZV9zdGF0ZS0+YmFzZS5hbHBoYSA+PiA4OworCWNvbnN0IHN0cnVjdCBkcm1fZnJh
bWVidWZmZXIgKmZiID0gcGxhbmVfc3RhdGUtPmh3LmZiOworCXU4IGFscGhhID0gcGxhbmVfc3Rh
dGUtPmh3LmFscGhhID4+IDg7CiAJdTMyIHBsYW5lX2NvbG9yX2N0bCA9IDA7CiAJdW5zaWduZWQg
bG9uZyBpcnFmbGFnczsKIAl1MzIga2V5bXNrLCBrZXltYXg7CkBAIC03NjgsNyArNzY4LDcgQEAg
Y2h2X3VwZGF0ZV9jc2MoY29uc3Qgc3RydWN0IGludGVsX3BsYW5lX3N0YXRlICpwbGFuZV9zdGF0
ZSkKIHsKIAlzdHJ1Y3QgaW50ZWxfcGxhbmUgKnBsYW5lID0gdG9faW50ZWxfcGxhbmUocGxhbmVf
c3RhdGUtPmJhc2UucGxhbmUpOwogCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9
IHRvX2k5MTUocGxhbmUtPmJhc2UuZGV2KTsKLQljb25zdCBzdHJ1Y3QgZHJtX2ZyYW1lYnVmZmVy
ICpmYiA9IHBsYW5lX3N0YXRlLT5iYXNlLmZiOworCWNvbnN0IHN0cnVjdCBkcm1fZnJhbWVidWZm
ZXIgKmZiID0gcGxhbmVfc3RhdGUtPmh3LmZiOwogCWVudW0gcGxhbmVfaWQgcGxhbmVfaWQgPSBw
bGFuZS0+aWQ7CiAJLyoKIAkgKiB8cnwgICB8IGMwIGMxIGMyIHwgICB8Y3J8CkBAIC03OTQsNyAr
Nzk0LDcgQEAgY2h2X3VwZGF0ZV9jc2MoY29uc3Qgc3RydWN0IGludGVsX3BsYW5lX3N0YXRlICpw
bGFuZV9zdGF0ZSkKIAkJCSAgICAwLCA0MDk2LCAgNzYwMSwKIAkJfSwKIAl9OwotCWNvbnN0IHMx
NiAqY3NjID0gY3NjX21hdHJpeFtwbGFuZV9zdGF0ZS0+YmFzZS5jb2xvcl9lbmNvZGluZ107CisJ
Y29uc3QgczE2ICpjc2MgPSBjc2NfbWF0cml4W3BsYW5lX3N0YXRlLT5ody5jb2xvcl9lbmNvZGlu
Z107CiAKIAkvKiBTZWVtcyBSR0IgZGF0YSBieXBhc3NlcyB0aGUgQ1NDIGFsd2F5cyAqLwogCWlm
ICghZmItPmZvcm1hdC0+aXNfeXV2KQpAQCAtODI3LDEzICs4MjcsMTMgQEAgdmx2X3VwZGF0ZV9j
bHJjKGNvbnN0IHN0cnVjdCBpbnRlbF9wbGFuZV9zdGF0ZSAqcGxhbmVfc3RhdGUpCiB7CiAJc3Ry
dWN0IGludGVsX3BsYW5lICpwbGFuZSA9IHRvX2ludGVsX3BsYW5lKHBsYW5lX3N0YXRlLT5iYXNl
LnBsYW5lKTsKIAlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KHBs
YW5lLT5iYXNlLmRldik7Ci0JY29uc3Qgc3RydWN0IGRybV9mcmFtZWJ1ZmZlciAqZmIgPSBwbGFu
ZV9zdGF0ZS0+YmFzZS5mYjsKKwljb25zdCBzdHJ1Y3QgZHJtX2ZyYW1lYnVmZmVyICpmYiA9IHBs
YW5lX3N0YXRlLT5ody5mYjsKIAllbnVtIHBpcGUgcGlwZSA9IHBsYW5lLT5waXBlOwogCWVudW0g
cGxhbmVfaWQgcGxhbmVfaWQgPSBwbGFuZS0+aWQ7CiAJaW50IGNvbnRyYXN0LCBicmlnaHRuZXNz
LCBzaF9zY2FsZSwgc2hfc2luLCBzaF9jb3M7CiAKIAlpZiAoZmItPmZvcm1hdC0+aXNfeXV2ICYm
Ci0JICAgIHBsYW5lX3N0YXRlLT5iYXNlLmNvbG9yX3JhbmdlID09IERSTV9DT0xPUl9ZQ0JDUl9M
SU1JVEVEX1JBTkdFKSB7CisJICAgIHBsYW5lX3N0YXRlLT5ody5jb2xvcl9yYW5nZSA9PSBEUk1f
Q09MT1JfWUNCQ1JfTElNSVRFRF9SQU5HRSkgewogCQkvKgogCQkgKiBFeHBhbmQgbGltaXRlZCBy
YW5nZSB0byBmdWxsIHJhbmdlOgogCQkgKiBDb250cmFzdCBpcyBhcHBsaWVkIGZpcnN0IGFuZCBp
cyB1c2VkIHRvIGV4cGFuZCBZIHJhbmdlLgpAQCAtODY3LDcgKzg2Nyw3IEBAIHZsdl9wbGFuZV9y
YXRpbyhjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSwKIAkJdW5zaWdu
ZWQgaW50ICpudW0sIHVuc2lnbmVkIGludCAqZGVuKQogewogCXU4IGFjdGl2ZV9wbGFuZXMgPSBj
cnRjX3N0YXRlLT5hY3RpdmVfcGxhbmVzICYgfkJJVChQTEFORV9DVVJTT1IpOwotCWNvbnN0IHN0
cnVjdCBkcm1fZnJhbWVidWZmZXIgKmZiID0gcGxhbmVfc3RhdGUtPmJhc2UuZmI7CisJY29uc3Qg
c3RydWN0IGRybV9mcmFtZWJ1ZmZlciAqZmIgPSBwbGFuZV9zdGF0ZS0+aHcuZmI7CiAJdW5zaWdu
ZWQgaW50IGNwcCA9IGZiLT5mb3JtYXQtPmNwcFswXTsKIAogCS8qCkBAIC05NTMsOCArOTUzLDgg
QEAgc3RhdGljIHUzMiB2bHZfc3ByaXRlX2N0bF9jcnRjKGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRj
X3N0YXRlICpjcnRjX3N0YXRlKQogc3RhdGljIHUzMiB2bHZfc3ByaXRlX2N0bChjb25zdCBzdHJ1
Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSwKIAkJCSAgY29uc3Qgc3RydWN0IGludGVs
X3BsYW5lX3N0YXRlICpwbGFuZV9zdGF0ZSkKIHsKLQljb25zdCBzdHJ1Y3QgZHJtX2ZyYW1lYnVm
ZmVyICpmYiA9IHBsYW5lX3N0YXRlLT5iYXNlLmZiOwotCXVuc2lnbmVkIGludCByb3RhdGlvbiA9
IHBsYW5lX3N0YXRlLT5iYXNlLnJvdGF0aW9uOworCWNvbnN0IHN0cnVjdCBkcm1fZnJhbWVidWZm
ZXIgKmZiID0gcGxhbmVfc3RhdGUtPmh3LmZiOworCXVuc2lnbmVkIGludCByb3RhdGlvbiA9IHBs
YW5lX3N0YXRlLT5ody5yb3RhdGlvbjsKIAljb25zdCBzdHJ1Y3QgZHJtX2ludGVsX3Nwcml0ZV9j
b2xvcmtleSAqa2V5ID0gJnBsYW5lX3N0YXRlLT5ja2V5OwogCXUzMiBzcHJjdGw7CiAKQEAgLTk5
OSw3ICs5OTksNyBAQCBzdGF0aWMgdTMyIHZsdl9zcHJpdGVfY3RsKGNvbnN0IHN0cnVjdCBpbnRl
bF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlLAogCQlyZXR1cm4gMDsKIAl9CiAKLQlpZiAocGxhbmVf
c3RhdGUtPmJhc2UuY29sb3JfZW5jb2RpbmcgPT0gRFJNX0NPTE9SX1lDQkNSX0JUNzA5KQorCWlm
IChwbGFuZV9zdGF0ZS0+aHcuY29sb3JfZW5jb2RpbmcgPT0gRFJNX0NPTE9SX1lDQkNSX0JUNzA5
KQogCQlzcHJjdGwgfD0gU1BfWVVWX0ZPUk1BVF9CVDcwOTsKIAogCWlmIChmYi0+bW9kaWZpZXIg
PT0gSTkxNV9GT1JNQVRfTU9EX1hfVElMRUQpCkBAIC0xMDIxLDcgKzEwMjEsNyBAQCBzdGF0aWMg
dm9pZCB2bHZfdXBkYXRlX2dhbW1hKGNvbnN0IHN0cnVjdCBpbnRlbF9wbGFuZV9zdGF0ZSAqcGxh
bmVfc3RhdGUpCiB7CiAJc3RydWN0IGludGVsX3BsYW5lICpwbGFuZSA9IHRvX2ludGVsX3BsYW5l
KHBsYW5lX3N0YXRlLT5iYXNlLnBsYW5lKTsKIAlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2
X3ByaXYgPSB0b19pOTE1KHBsYW5lLT5iYXNlLmRldik7Ci0JY29uc3Qgc3RydWN0IGRybV9mcmFt
ZWJ1ZmZlciAqZmIgPSBwbGFuZV9zdGF0ZS0+YmFzZS5mYjsKKwljb25zdCBzdHJ1Y3QgZHJtX2Zy
YW1lYnVmZmVyICpmYiA9IHBsYW5lX3N0YXRlLT5ody5mYjsKIAllbnVtIHBpcGUgcGlwZSA9IHBs
YW5lLT5waXBlOwogCWVudW0gcGxhbmVfaWQgcGxhbmVfaWQgPSBwbGFuZS0+aWQ7CiAJdTE2IGdh
bW1hWzhdOwpAQCAtMTE1MSw3ICsxMTUxLDcgQEAgc3RhdGljIHZvaWQgaXZiX3BsYW5lX3JhdGlv
KGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlLAogCQkJICAgIHVuc2ln
bmVkIGludCAqbnVtLCB1bnNpZ25lZCBpbnQgKmRlbikKIHsKIAl1OCBhY3RpdmVfcGxhbmVzID0g
Y3J0Y19zdGF0ZS0+YWN0aXZlX3BsYW5lcyAmIH5CSVQoUExBTkVfQ1VSU09SKTsKLQljb25zdCBz
dHJ1Y3QgZHJtX2ZyYW1lYnVmZmVyICpmYiA9IHBsYW5lX3N0YXRlLT5iYXNlLmZiOworCWNvbnN0
IHN0cnVjdCBkcm1fZnJhbWVidWZmZXIgKmZiID0gcGxhbmVfc3RhdGUtPmh3LmZiOwogCXVuc2ln
bmVkIGludCBjcHAgPSBmYi0+Zm9ybWF0LT5jcHBbMF07CiAKIAlpZiAoaHdlaWdodDgoYWN0aXZl
X3BsYW5lcykgPT0gMikgewpAQCAtMTE4Nyw3ICsxMTg3LDcgQEAgc3RhdGljIHZvaWQgaXZiX3Bs
YW5lX3JhdGlvX3NjYWxpbmcoY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3Rh
dGUsCiAJCQkJICAgIGNvbnN0IHN0cnVjdCBpbnRlbF9wbGFuZV9zdGF0ZSAqcGxhbmVfc3RhdGUs
CiAJCQkJICAgIHVuc2lnbmVkIGludCAqbnVtLCB1bnNpZ25lZCBpbnQgKmRlbikKIHsKLQljb25z
dCBzdHJ1Y3QgZHJtX2ZyYW1lYnVmZmVyICpmYiA9IHBsYW5lX3N0YXRlLT5iYXNlLmZiOworCWNv
bnN0IHN0cnVjdCBkcm1fZnJhbWVidWZmZXIgKmZiID0gcGxhbmVfc3RhdGUtPmh3LmZiOwogCXVu
c2lnbmVkIGludCBjcHAgPSBmYi0+Zm9ybWF0LT5jcHBbMF07CiAKIAlzd2l0Y2ggKGNwcCkgewpA
QCAtMTI2NSw3ICsxMjY1LDcgQEAgc3RhdGljIHZvaWQgaHN3X3BsYW5lX3JhdGlvKGNvbnN0IHN0
cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlLAogCQkJICAgIHVuc2lnbmVkIGludCAq
bnVtLCB1bnNpZ25lZCBpbnQgKmRlbikKIHsKIAl1OCBhY3RpdmVfcGxhbmVzID0gY3J0Y19zdGF0
ZS0+YWN0aXZlX3BsYW5lcyAmIH5CSVQoUExBTkVfQ1VSU09SKTsKLQljb25zdCBzdHJ1Y3QgZHJt
X2ZyYW1lYnVmZmVyICpmYiA9IHBsYW5lX3N0YXRlLT5iYXNlLmZiOworCWNvbnN0IHN0cnVjdCBk
cm1fZnJhbWVidWZmZXIgKmZiID0gcGxhbmVfc3RhdGUtPmh3LmZiOwogCXVuc2lnbmVkIGludCBj
cHAgPSBmYi0+Zm9ybWF0LT5jcHBbMF07CiAKIAlpZiAoaHdlaWdodDgoYWN0aXZlX3BsYW5lcykg
PT0gMikgewpAQCAtMTMyMSw3ICsxMzIxLDcgQEAgc3RhdGljIGJvb2wgaXZiX25lZWRfc3ByaXRl
X2dhbW1hKGNvbnN0IHN0cnVjdCBpbnRlbF9wbGFuZV9zdGF0ZSAqcGxhbmVfc3RhdGUpCiB7CiAJ
c3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0KIAkJdG9faTkxNShwbGFuZV9zdGF0
ZS0+YmFzZS5wbGFuZS0+ZGV2KTsKLQljb25zdCBzdHJ1Y3QgZHJtX2ZyYW1lYnVmZmVyICpmYiA9
IHBsYW5lX3N0YXRlLT5iYXNlLmZiOworCWNvbnN0IHN0cnVjdCBkcm1fZnJhbWVidWZmZXIgKmZi
ID0gcGxhbmVfc3RhdGUtPmh3LmZiOwogCiAJcmV0dXJuIGZiLT5mb3JtYXQtPmNwcFswXSA9PSA4
ICYmCiAJCShJU19JVllCUklER0UoZGV2X3ByaXYpIHx8IElTX0hBU1dFTEwoZGV2X3ByaXYpKTsK
QEAgLTEzMzIsOCArMTMzMiw4IEBAIHN0YXRpYyB1MzIgaXZiX3Nwcml0ZV9jdGwoY29uc3Qgc3Ry
dWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUsCiB7CiAJc3RydWN0IGRybV9pOTE1X3By
aXZhdGUgKmRldl9wcml2ID0KIAkJdG9faTkxNShwbGFuZV9zdGF0ZS0+YmFzZS5wbGFuZS0+ZGV2
KTsKLQljb25zdCBzdHJ1Y3QgZHJtX2ZyYW1lYnVmZmVyICpmYiA9IHBsYW5lX3N0YXRlLT5iYXNl
LmZiOwotCXVuc2lnbmVkIGludCByb3RhdGlvbiA9IHBsYW5lX3N0YXRlLT5iYXNlLnJvdGF0aW9u
OworCWNvbnN0IHN0cnVjdCBkcm1fZnJhbWVidWZmZXIgKmZiID0gcGxhbmVfc3RhdGUtPmh3LmZi
OworCXVuc2lnbmVkIGludCByb3RhdGlvbiA9IHBsYW5lX3N0YXRlLT5ody5yb3RhdGlvbjsKIAlj
b25zdCBzdHJ1Y3QgZHJtX2ludGVsX3Nwcml0ZV9jb2xvcmtleSAqa2V5ID0gJnBsYW5lX3N0YXRl
LT5ja2V5OwogCXUzMiBzcHJjdGw7CiAKQEAgLTEzNzUsMTAgKzEzNzUsMTAgQEAgc3RhdGljIHUz
MiBpdmJfc3ByaXRlX2N0bChjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0
ZSwKIAlpZiAoIWl2Yl9uZWVkX3Nwcml0ZV9nYW1tYShwbGFuZV9zdGF0ZSkpCiAJCXNwcmN0bCB8
PSBTUFJJVEVfSU5UX0dBTU1BX0RJU0FCTEU7CiAKLQlpZiAocGxhbmVfc3RhdGUtPmJhc2UuY29s
b3JfZW5jb2RpbmcgPT0gRFJNX0NPTE9SX1lDQkNSX0JUNzA5KQorCWlmIChwbGFuZV9zdGF0ZS0+
aHcuY29sb3JfZW5jb2RpbmcgPT0gRFJNX0NPTE9SX1lDQkNSX0JUNzA5KQogCQlzcHJjdGwgfD0g
U1BSSVRFX1lVVl9UT19SR0JfQ1NDX0ZPUk1BVF9CVDcwOTsKIAotCWlmIChwbGFuZV9zdGF0ZS0+
YmFzZS5jb2xvcl9yYW5nZSA9PSBEUk1fQ09MT1JfWUNCQ1JfRlVMTF9SQU5HRSkKKwlpZiAocGxh
bmVfc3RhdGUtPmh3LmNvbG9yX3JhbmdlID09IERSTV9DT0xPUl9ZQ0JDUl9GVUxMX1JBTkdFKQog
CQlzcHJjdGwgfD0gU1BSSVRFX1lVVl9SQU5HRV9DT1JSRUNUSU9OX0RJU0FCTEU7CiAKIAlpZiAo
ZmItPm1vZGlmaWVyID09IEk5MTVfRk9STUFUX01PRF9YX1RJTEVEKQpAQCAtMTU2Nyw3ICsxNTY3
LDcgQEAgaXZiX3BsYW5lX2dldF9od19zdGF0ZShzdHJ1Y3QgaW50ZWxfcGxhbmUgKnBsYW5lLAog
c3RhdGljIGludCBnNHhfc3ByaXRlX21pbl9jZGNsayhjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19z
dGF0ZSAqY3J0Y19zdGF0ZSwKIAkJCQljb25zdCBzdHJ1Y3QgaW50ZWxfcGxhbmVfc3RhdGUgKnBs
YW5lX3N0YXRlKQogewotCWNvbnN0IHN0cnVjdCBkcm1fZnJhbWVidWZmZXIgKmZiID0gcGxhbmVf
c3RhdGUtPmJhc2UuZmI7CisJY29uc3Qgc3RydWN0IGRybV9mcmFtZWJ1ZmZlciAqZmIgPSBwbGFu
ZV9zdGF0ZS0+aHcuZmI7CiAJdW5zaWduZWQgaW50IGhzY2FsZSwgcGl4ZWxfcmF0ZTsKIAl1bnNp
Z25lZCBpbnQgbGltaXQsIGRlY2ltYXRlOwogCkBAIC0xNjM3LDggKzE2MzcsOCBAQCBzdGF0aWMg
dTMyIGc0eF9zcHJpdGVfY3RsKGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0
YXRlLAogewogCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9CiAJCXRvX2k5MTUo
cGxhbmVfc3RhdGUtPmJhc2UucGxhbmUtPmRldik7Ci0JY29uc3Qgc3RydWN0IGRybV9mcmFtZWJ1
ZmZlciAqZmIgPSBwbGFuZV9zdGF0ZS0+YmFzZS5mYjsKLQl1bnNpZ25lZCBpbnQgcm90YXRpb24g
PSBwbGFuZV9zdGF0ZS0+YmFzZS5yb3RhdGlvbjsKKwljb25zdCBzdHJ1Y3QgZHJtX2ZyYW1lYnVm
ZmVyICpmYiA9IHBsYW5lX3N0YXRlLT5ody5mYjsKKwl1bnNpZ25lZCBpbnQgcm90YXRpb24gPSBw
bGFuZV9zdGF0ZS0+aHcucm90YXRpb247CiAJY29uc3Qgc3RydWN0IGRybV9pbnRlbF9zcHJpdGVf
Y29sb3JrZXkgKmtleSA9ICZwbGFuZV9zdGF0ZS0+Y2tleTsKIAl1MzIgZHZzY250cjsKIApAQCAt
MTY3NywxMCArMTY3NywxMCBAQCBzdGF0aWMgdTMyIGc0eF9zcHJpdGVfY3RsKGNvbnN0IHN0cnVj
dCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlLAogCQlyZXR1cm4gMDsKIAl9CiAKLQlpZiAo
cGxhbmVfc3RhdGUtPmJhc2UuY29sb3JfZW5jb2RpbmcgPT0gRFJNX0NPTE9SX1lDQkNSX0JUNzA5
KQorCWlmIChwbGFuZV9zdGF0ZS0+aHcuY29sb3JfZW5jb2RpbmcgPT0gRFJNX0NPTE9SX1lDQkNS
X0JUNzA5KQogCQlkdnNjbnRyIHw9IERWU19ZVVZfRk9STUFUX0JUNzA5OwogCi0JaWYgKHBsYW5l
X3N0YXRlLT5iYXNlLmNvbG9yX3JhbmdlID09IERSTV9DT0xPUl9ZQ0JDUl9GVUxMX1JBTkdFKQor
CWlmIChwbGFuZV9zdGF0ZS0+aHcuY29sb3JfcmFuZ2UgPT0gRFJNX0NPTE9SX1lDQkNSX0ZVTExf
UkFOR0UpCiAJCWR2c2NudHIgfD0gRFZTX1lVVl9SQU5HRV9DT1JSRUNUSU9OX0RJU0FCTEU7CiAK
IAlpZiAoZmItPm1vZGlmaWVyID09IEk5MTVfRk9STUFUX01PRF9YX1RJTEVEKQpAQCAtMTcwMSw3
ICsxNzAxLDcgQEAgc3RhdGljIHZvaWQgZzR4X3VwZGF0ZV9nYW1tYShjb25zdCBzdHJ1Y3QgaW50
ZWxfcGxhbmVfc3RhdGUgKnBsYW5lX3N0YXRlKQogewogCXN0cnVjdCBpbnRlbF9wbGFuZSAqcGxh
bmUgPSB0b19pbnRlbF9wbGFuZShwbGFuZV9zdGF0ZS0+YmFzZS5wbGFuZSk7CiAJc3RydWN0IGRy
bV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShwbGFuZS0+YmFzZS5kZXYpOwotCWNv
bnN0IHN0cnVjdCBkcm1fZnJhbWVidWZmZXIgKmZiID0gcGxhbmVfc3RhdGUtPmJhc2UuZmI7CisJ
Y29uc3Qgc3RydWN0IGRybV9mcmFtZWJ1ZmZlciAqZmIgPSBwbGFuZV9zdGF0ZS0+aHcuZmI7CiAJ
ZW51bSBwaXBlIHBpcGUgPSBwbGFuZS0+cGlwZTsKIAl1MTYgZ2FtbWFbOF07CiAJaW50IGk7CkBA
IC0xNzMzLDcgKzE3MzMsNyBAQCBzdGF0aWMgdm9pZCBpbGtfdXBkYXRlX2dhbW1hKGNvbnN0IHN0
cnVjdCBpbnRlbF9wbGFuZV9zdGF0ZSAqcGxhbmVfc3RhdGUpCiB7CiAJc3RydWN0IGludGVsX3Bs
YW5lICpwbGFuZSA9IHRvX2ludGVsX3BsYW5lKHBsYW5lX3N0YXRlLT5iYXNlLnBsYW5lKTsKIAlz
dHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KHBsYW5lLT5iYXNlLmRl
dik7Ci0JY29uc3Qgc3RydWN0IGRybV9mcmFtZWJ1ZmZlciAqZmIgPSBwbGFuZV9zdGF0ZS0+YmFz
ZS5mYjsKKwljb25zdCBzdHJ1Y3QgZHJtX2ZyYW1lYnVmZmVyICpmYiA9IHBsYW5lX3N0YXRlLT5o
dy5mYjsKIAllbnVtIHBpcGUgcGlwZSA9IHBsYW5lLT5waXBlOwogCXUxNiBnYW1tYVsxN107CiAJ
aW50IGk7CkBAIC0xODg3LDcgKzE4ODcsNyBAQCBzdGF0aWMgaW50CiBnNHhfc3ByaXRlX2NoZWNr
X3NjYWxpbmcoc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUsCiAJCQkgc3RydWN0
IGludGVsX3BsYW5lX3N0YXRlICpwbGFuZV9zdGF0ZSkKIHsKLQljb25zdCBzdHJ1Y3QgZHJtX2Zy
YW1lYnVmZmVyICpmYiA9IHBsYW5lX3N0YXRlLT5iYXNlLmZiOworCWNvbnN0IHN0cnVjdCBkcm1f
ZnJhbWVidWZmZXIgKmZiID0gcGxhbmVfc3RhdGUtPmh3LmZiOwogCWNvbnN0IHN0cnVjdCBkcm1f
cmVjdCAqc3JjID0gJnBsYW5lX3N0YXRlLT5iYXNlLnNyYzsKIAljb25zdCBzdHJ1Y3QgZHJtX3Jl
Y3QgKmRzdCA9ICZwbGFuZV9zdGF0ZS0+YmFzZS5kc3Q7CiAJaW50IHNyY194LCBzcmNfdywgc3Jj
X2gsIGNydGNfdywgY3J0Y19oOwpAQCAtMTk1NCw3ICsxOTU0LDcgQEAgZzR4X3Nwcml0ZV9jaGVj
ayhzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSwKIAlpbnQgbWF4X3NjYWxlID0g
RFJNX1BMQU5FX0hFTFBFUl9OT19TQ0FMSU5HOwogCWludCByZXQ7CiAKLQlpZiAoaW50ZWxfZmJf
c2NhbGFibGUocGxhbmVfc3RhdGUtPmJhc2UuZmIpKSB7CisJaWYgKGludGVsX2ZiX3NjYWxhYmxl
KHBsYW5lX3N0YXRlLT5ody5mYikpIHsKIAkJaWYgKElOVEVMX0dFTihkZXZfcHJpdikgPCA3KSB7
CiAJCQltaW5fc2NhbGUgPSAxOwogCQkJbWF4X3NjYWxlID0gMTYgPDwgMTY7CkBAIC0xOTk4LDcg
KzE5OTgsNyBAQCBpbnQgY2h2X3BsYW5lX2NoZWNrX3JvdGF0aW9uKGNvbnN0IHN0cnVjdCBpbnRl
bF9wbGFuZV9zdGF0ZSAqcGxhbmVfc3RhdGUpCiB7CiAJc3RydWN0IGludGVsX3BsYW5lICpwbGFu
ZSA9IHRvX2ludGVsX3BsYW5lKHBsYW5lX3N0YXRlLT5iYXNlLnBsYW5lKTsKIAlzdHJ1Y3QgZHJt
X2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KHBsYW5lLT5iYXNlLmRldik7Ci0JdW5z
aWduZWQgaW50IHJvdGF0aW9uID0gcGxhbmVfc3RhdGUtPmJhc2Uucm90YXRpb247CisJdW5zaWdu
ZWQgaW50IHJvdGF0aW9uID0gcGxhbmVfc3RhdGUtPmh3LnJvdGF0aW9uOwogCiAJLyogQ0hWIGln
bm9yZXMgdGhlIG1pcnJvciBiaXQgd2hlbiB0aGUgcm90YXRlIGJpdCBpcyBzZXQgOiggKi8KIAlp
ZiAoSVNfQ0hFUlJZVklFVyhkZXZfcHJpdikgJiYKQEAgLTIwNTAsOCArMjA1MCw4IEBAIHN0YXRp
YyBpbnQgc2tsX3BsYW5lX2NoZWNrX2ZiKGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpj
cnRjX3N0YXRlLAogewogCXN0cnVjdCBpbnRlbF9wbGFuZSAqcGxhbmUgPSB0b19pbnRlbF9wbGFu
ZShwbGFuZV9zdGF0ZS0+YmFzZS5wbGFuZSk7CiAJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRl
dl9wcml2ID0gdG9faTkxNShwbGFuZS0+YmFzZS5kZXYpOwotCWNvbnN0IHN0cnVjdCBkcm1fZnJh
bWVidWZmZXIgKmZiID0gcGxhbmVfc3RhdGUtPmJhc2UuZmI7Ci0JdW5zaWduZWQgaW50IHJvdGF0
aW9uID0gcGxhbmVfc3RhdGUtPmJhc2Uucm90YXRpb247CisJY29uc3Qgc3RydWN0IGRybV9mcmFt
ZWJ1ZmZlciAqZmIgPSBwbGFuZV9zdGF0ZS0+aHcuZmI7CisJdW5zaWduZWQgaW50IHJvdGF0aW9u
ID0gcGxhbmVfc3RhdGUtPmh3LnJvdGF0aW9uOwogCXN0cnVjdCBkcm1fZm9ybWF0X25hbWVfYnVm
IGZvcm1hdF9uYW1lOwogCiAJaWYgKCFmYikKQEAgLTIxNTEsOCArMjE1MSw4IEBAIHN0YXRpYyBp
bnQgc2tsX3BsYW5lX2NoZWNrX2RzdF9jb29yZGluYXRlcyhjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0
Y19zdGF0ZSAqY3J0Y19zCiAKIHN0YXRpYyBpbnQgc2tsX3BsYW5lX2NoZWNrX252MTJfcm90YXRp
b24oY29uc3Qgc3RydWN0IGludGVsX3BsYW5lX3N0YXRlICpwbGFuZV9zdGF0ZSkKIHsKLQljb25z
dCBzdHJ1Y3QgZHJtX2ZyYW1lYnVmZmVyICpmYiA9IHBsYW5lX3N0YXRlLT5iYXNlLmZiOwotCXVu
c2lnbmVkIGludCByb3RhdGlvbiA9IHBsYW5lX3N0YXRlLT5iYXNlLnJvdGF0aW9uOworCWNvbnN0
IHN0cnVjdCBkcm1fZnJhbWVidWZmZXIgKmZiID0gcGxhbmVfc3RhdGUtPmh3LmZiOworCXVuc2ln
bmVkIGludCByb3RhdGlvbiA9IHBsYW5lX3N0YXRlLT5ody5yb3RhdGlvbjsKIAlpbnQgc3JjX3cg
PSBkcm1fcmVjdF93aWR0aCgmcGxhbmVfc3RhdGUtPmJhc2Uuc3JjKSA+PiAxNjsKIAogCS8qIERp
c3BsYXkgV0EgIzExMDYgKi8KQEAgLTIxODcsNyArMjE4Nyw3IEBAIHN0YXRpYyBpbnQgc2tsX3Bs
YW5lX2NoZWNrKHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlLAogewogCXN0cnVj
dCBpbnRlbF9wbGFuZSAqcGxhbmUgPSB0b19pbnRlbF9wbGFuZShwbGFuZV9zdGF0ZS0+YmFzZS5w
bGFuZSk7CiAJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShwbGFu
ZS0+YmFzZS5kZXYpOwotCWNvbnN0IHN0cnVjdCBkcm1fZnJhbWVidWZmZXIgKmZiID0gcGxhbmVf
c3RhdGUtPmJhc2UuZmI7CisJY29uc3Qgc3RydWN0IGRybV9mcmFtZWJ1ZmZlciAqZmIgPSBwbGFu
ZV9zdGF0ZS0+aHcuZmI7CiAJaW50IG1pbl9zY2FsZSA9IERSTV9QTEFORV9IRUxQRVJfTk9fU0NB
TElORzsKIAlpbnQgbWF4X3NjYWxlID0gRFJNX1BMQU5FX0hFTFBFUl9OT19TQ0FMSU5HOwogCWlu
dCByZXQ7CkBAIC0yMjI5LDcgKzIyMjksNyBAQCBzdGF0aWMgaW50IHNrbF9wbGFuZV9jaGVjayhz
dHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSwKIAkJcmV0dXJuIHJldDsKIAogCS8q
IEhXIG9ubHkgaGFzIDggYml0cyBwaXhlbCBwcmVjaXNpb24sIGRpc2FibGUgcGxhbmUgaWYgaW52
aXNpYmxlICovCi0JaWYgKCEocGxhbmVfc3RhdGUtPmJhc2UuYWxwaGEgPj4gOCkpCisJaWYgKCEo
cGxhbmVfc3RhdGUtPmh3LmFscGhhID4+IDgpKQogCQlwbGFuZV9zdGF0ZS0+YmFzZS52aXNpYmxl
ID0gZmFsc2U7CiAKIAlwbGFuZV9zdGF0ZS0+Y3RsID0gc2tsX3BsYW5lX2N0bChjcnRjX3N0YXRl
LCBwbGFuZV9zdGF0ZSk7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pbnRlbF9w
bS5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50ZWxfcG0uYwppbmRleCBkZTc3MDNhYzUyOGQu
LjI1YThlMjBkMjExMiAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50ZWxfcG0u
YworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pbnRlbF9wbS5jCkBAIC04MDEsNyArODAxLDcg
QEAgc3RhdGljIGJvb2wgaW50ZWxfd21fcGxhbmVfdmlzaWJsZShjb25zdCBzdHJ1Y3QgaW50ZWxf
Y3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSwKIAkgKiBhcm91bmQgdGhpcyBwcm9ibGVtIHdpdGggdGhl
IHdhdGVybWFyayBjb2RlLgogCSAqLwogCWlmIChwbGFuZS0+aWQgPT0gUExBTkVfQ1VSU09SKQot
CQlyZXR1cm4gcGxhbmVfc3RhdGUtPmJhc2UuZmIgIT0gTlVMTDsKKwkJcmV0dXJuIHBsYW5lX3N0
YXRlLT5ody5mYiAhPSBOVUxMOwogCWVsc2UKIAkJcmV0dXJuIHBsYW5lX3N0YXRlLT5iYXNlLnZp
c2libGU7CiB9CkBAIC0xMDg4LDcgKzEwODgsNyBAQCBzdGF0aWMgdTE2IGc0eF9jb21wdXRlX3dt
KGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlLAogCWlmICghaW50ZWxf
d21fcGxhbmVfdmlzaWJsZShjcnRjX3N0YXRlLCBwbGFuZV9zdGF0ZSkpCiAJCXJldHVybiAwOwog
Ci0JY3BwID0gcGxhbmVfc3RhdGUtPmJhc2UuZmItPmZvcm1hdC0+Y3BwWzBdOworCWNwcCA9IHBs
YW5lX3N0YXRlLT5ody5mYi0+Zm9ybWF0LT5jcHBbMF07CiAKIAkvKgogCSAqIE5vdCAxMDAlIHN1
cmUgd2hpY2ggd2F5IEVMSyBzaG91bGQgZ28gaGVyZSBhcyB0aGUKQEAgLTEzMDgsOCArMTMwOCw4
IEBAIHN0YXRpYyBpbnQgZzR4X2NvbXB1dGVfcGlwZV93bShzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0
ZSAqY3J0Y19zdGF0ZSkKIAlmb3JfZWFjaF9vbGRuZXdfaW50ZWxfcGxhbmVfaW5fc3RhdGUoc3Rh
dGUsIHBsYW5lLAogCQkJCQkgICAgIG9sZF9wbGFuZV9zdGF0ZSwKIAkJCQkJICAgICBuZXdfcGxh
bmVfc3RhdGUsIGkpIHsKLQkJaWYgKG5ld19wbGFuZV9zdGF0ZS0+YmFzZS5jcnRjICE9ICZjcnRj
LT5iYXNlICYmCi0JCSAgICBvbGRfcGxhbmVfc3RhdGUtPmJhc2UuY3J0YyAhPSAmY3J0Yy0+YmFz
ZSkKKwkJaWYgKG5ld19wbGFuZV9zdGF0ZS0+aHcuY3J0YyAhPSAmY3J0Yy0+YmFzZSAmJgorCQkg
ICAgb2xkX3BsYW5lX3N0YXRlLT5ody5jcnRjICE9ICZjcnRjLT5iYXNlKQogCQkJY29udGludWU7
CiAKIAkJaWYgKGc0eF9yYXdfcGxhbmVfd21fY29tcHV0ZShjcnRjX3N0YXRlLCBuZXdfcGxhbmVf
c3RhdGUpKQpAQCAtMTU5Myw3ICsxNTkzLDcgQEAgc3RhdGljIHUxNiB2bHZfY29tcHV0ZV93bV9s
ZXZlbChjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSwKIAlpZiAoIWlu
dGVsX3dtX3BsYW5lX3Zpc2libGUoY3J0Y19zdGF0ZSwgcGxhbmVfc3RhdGUpKQogCQlyZXR1cm4g
MDsKIAotCWNwcCA9IHBsYW5lX3N0YXRlLT5iYXNlLmZiLT5mb3JtYXQtPmNwcFswXTsKKwljcHAg
PSBwbGFuZV9zdGF0ZS0+aHcuZmItPmZvcm1hdC0+Y3BwWzBdOwogCWNsb2NrID0gYWRqdXN0ZWRf
bW9kZS0+Y3J0Y19jbG9jazsKIAlodG90YWwgPSBhZGp1c3RlZF9tb2RlLT5jcnRjX2h0b3RhbDsK
IAl3aWR0aCA9IGNydGNfc3RhdGUtPnBpcGVfc3JjX3c7CkBAIC0xODI5LDggKzE4MjksOCBAQCBz
dGF0aWMgaW50IHZsdl9jb21wdXRlX3BpcGVfd20oc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNy
dGNfc3RhdGUpCiAJZm9yX2VhY2hfb2xkbmV3X2ludGVsX3BsYW5lX2luX3N0YXRlKHN0YXRlLCBw
bGFuZSwKIAkJCQkJICAgICBvbGRfcGxhbmVfc3RhdGUsCiAJCQkJCSAgICAgbmV3X3BsYW5lX3N0
YXRlLCBpKSB7Ci0JCWlmIChuZXdfcGxhbmVfc3RhdGUtPmJhc2UuY3J0YyAhPSAmY3J0Yy0+YmFz
ZSAmJgotCQkgICAgb2xkX3BsYW5lX3N0YXRlLT5iYXNlLmNydGMgIT0gJmNydGMtPmJhc2UpCisJ
CWlmIChuZXdfcGxhbmVfc3RhdGUtPmh3LmNydGMgIT0gJmNydGMtPmJhc2UgJiYKKwkJICAgIG9s
ZF9wbGFuZV9zdGF0ZS0+aHcuY3J0YyAhPSAmY3J0Yy0+YmFzZSkKIAkJCWNvbnRpbnVlOwogCiAJ
CWlmICh2bHZfcmF3X3BsYW5lX3dtX2NvbXB1dGUoY3J0Y19zdGF0ZSwgbmV3X3BsYW5lX3N0YXRl
KSkKQEAgLTI0NzUsNyArMjQ3NSw3IEBAIHN0YXRpYyB1MzIgaWxrX2NvbXB1dGVfcHJpX3dtKGNv
bnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlLAogCWlmICghaW50ZWxfd21f
cGxhbmVfdmlzaWJsZShjcnRjX3N0YXRlLCBwbGFuZV9zdGF0ZSkpCiAJCXJldHVybiAwOwogCi0J
Y3BwID0gcGxhbmVfc3RhdGUtPmJhc2UuZmItPmZvcm1hdC0+Y3BwWzBdOworCWNwcCA9IHBsYW5l
X3N0YXRlLT5ody5mYi0+Zm9ybWF0LT5jcHBbMF07CiAKIAltZXRob2QxID0gaWxrX3dtX21ldGhv
ZDEoY3J0Y19zdGF0ZS0+cGl4ZWxfcmF0ZSwgY3BwLCBtZW1fdmFsdWUpOwogCkBAIC0yNTA3LDcg
KzI1MDcsNyBAQCBzdGF0aWMgdTMyIGlsa19jb21wdXRlX3Nwcl93bShjb25zdCBzdHJ1Y3QgaW50
ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSwKIAlpZiAoIWludGVsX3dtX3BsYW5lX3Zpc2libGUo
Y3J0Y19zdGF0ZSwgcGxhbmVfc3RhdGUpKQogCQlyZXR1cm4gMDsKIAotCWNwcCA9IHBsYW5lX3N0
YXRlLT5iYXNlLmZiLT5mb3JtYXQtPmNwcFswXTsKKwljcHAgPSBwbGFuZV9zdGF0ZS0+aHcuZmIt
PmZvcm1hdC0+Y3BwWzBdOwogCiAJbWV0aG9kMSA9IGlsa193bV9tZXRob2QxKGNydGNfc3RhdGUt
PnBpeGVsX3JhdGUsIGNwcCwgbWVtX3ZhbHVlKTsKIAltZXRob2QyID0gaWxrX3dtX21ldGhvZDIo
Y3J0Y19zdGF0ZS0+cGl4ZWxfcmF0ZSwKQEAgLTI1MzMsNyArMjUzMyw3IEBAIHN0YXRpYyB1MzIg
aWxrX2NvbXB1dGVfY3VyX3dtKGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0
YXRlLAogCWlmICghaW50ZWxfd21fcGxhbmVfdmlzaWJsZShjcnRjX3N0YXRlLCBwbGFuZV9zdGF0
ZSkpCiAJCXJldHVybiAwOwogCi0JY3BwID0gcGxhbmVfc3RhdGUtPmJhc2UuZmItPmZvcm1hdC0+
Y3BwWzBdOworCWNwcCA9IHBsYW5lX3N0YXRlLT5ody5mYi0+Zm9ybWF0LT5jcHBbMF07CiAKIAly
ZXR1cm4gaWxrX3dtX21ldGhvZDIoY3J0Y19zdGF0ZS0+cGl4ZWxfcmF0ZSwKIAkJCSAgICAgIGNy
dGNfc3RhdGUtPmh3LmFkanVzdGVkX21vZGUuY3J0Y19odG90YWwsCkBAIC0yNTUxLDcgKzI1NTEs
NyBAQCBzdGF0aWMgdTMyIGlsa19jb21wdXRlX2ZiY193bShjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0
Y19zdGF0ZSAqY3J0Y19zdGF0ZSwKIAlpZiAoIWludGVsX3dtX3BsYW5lX3Zpc2libGUoY3J0Y19z
dGF0ZSwgcGxhbmVfc3RhdGUpKQogCQlyZXR1cm4gMDsKIAotCWNwcCA9IHBsYW5lX3N0YXRlLT5i
YXNlLmZiLT5mb3JtYXQtPmNwcFswXTsKKwljcHAgPSBwbGFuZV9zdGF0ZS0+aHcuZmItPmZvcm1h
dC0+Y3BwWzBdOwogCiAJcmV0dXJuIGlsa193bV9mYmMocHJpX3ZhbCwgZHJtX3JlY3Rfd2lkdGgo
JnBsYW5lX3N0YXRlLT5iYXNlLmRzdCksIGNwcCk7CiB9CkBAIC00MDkxLDcgKzQwOTEsNyBAQCBz
a2xfcGxhbmVfcmVsYXRpdmVfZGF0YV9yYXRlKGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRl
ICpjcnRjX3N0YXRlLAogCQkJICAgICBpbnQgY29sb3JfcGxhbmUpCiB7CiAJc3RydWN0IGludGVs
X3BsYW5lICpwbGFuZSA9IHRvX2ludGVsX3BsYW5lKHBsYW5lX3N0YXRlLT5iYXNlLnBsYW5lKTsK
LQljb25zdCBzdHJ1Y3QgZHJtX2ZyYW1lYnVmZmVyICpmYiA9IHBsYW5lX3N0YXRlLT5iYXNlLmZi
OworCWNvbnN0IHN0cnVjdCBkcm1fZnJhbWVidWZmZXIgKmZiID0gcGxhbmVfc3RhdGUtPmh3LmZi
OwogCXUzMiBkYXRhX3JhdGU7CiAJdTMyIHdpZHRoID0gMCwgaGVpZ2h0ID0gMDsKIAl1aW50X2Zp
eGVkXzE2XzE2X3QgZG93bl9zY2FsZV9hbW91bnQ7CkBAIC00NjEyLDcgKzQ2MTIsNyBAQCBza2xf
Y29tcHV0ZV9wbGFuZV93bV9wYXJhbXMoY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNy
dGNfc3RhdGUsCiAJCQkgICAgY29uc3Qgc3RydWN0IGludGVsX3BsYW5lX3N0YXRlICpwbGFuZV9z
dGF0ZSwKIAkJCSAgICBzdHJ1Y3Qgc2tsX3dtX3BhcmFtcyAqd3AsIGludCBjb2xvcl9wbGFuZSkK
IHsKLQljb25zdCBzdHJ1Y3QgZHJtX2ZyYW1lYnVmZmVyICpmYiA9IHBsYW5lX3N0YXRlLT5iYXNl
LmZiOworCWNvbnN0IHN0cnVjdCBkcm1fZnJhbWVidWZmZXIgKmZiID0gcGxhbmVfc3RhdGUtPmh3
LmZiOwogCWludCB3aWR0aDsKIAogCS8qCkBAIC00NjI0LDcgKzQ2MjQsNyBAQCBza2xfY29tcHV0
ZV9wbGFuZV93bV9wYXJhbXMoY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3Rh
dGUsCiAKIAlyZXR1cm4gc2tsX2NvbXB1dGVfd21fcGFyYW1zKGNydGNfc3RhdGUsIHdpZHRoLAog
CQkJCSAgICAgZmItPmZvcm1hdCwgZmItPm1vZGlmaWVyLAotCQkJCSAgICAgcGxhbmVfc3RhdGUt
PmJhc2Uucm90YXRpb24sCisJCQkJICAgICBwbGFuZV9zdGF0ZS0+aHcucm90YXRpb24sCiAJCQkJ
ICAgICBza2xfYWRqdXN0ZWRfcGxhbmVfcGl4ZWxfcmF0ZShjcnRjX3N0YXRlLCBwbGFuZV9zdGF0
ZSksCiAJCQkJICAgICB3cCwgY29sb3JfcGxhbmUpOwogfQpAQCAtNDkwMyw3ICs0OTAzLDcgQEAg
c3RhdGljIGludCBza2xfYnVpbGRfcGxhbmVfd20oc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNy
dGNfc3RhdGUsCiAJCQkgICAgICBjb25zdCBzdHJ1Y3QgaW50ZWxfcGxhbmVfc3RhdGUgKnBsYW5l
X3N0YXRlKQogewogCXN0cnVjdCBpbnRlbF9wbGFuZSAqcGxhbmUgPSB0b19pbnRlbF9wbGFuZShw
bGFuZV9zdGF0ZS0+YmFzZS5wbGFuZSk7Ci0JY29uc3Qgc3RydWN0IGRybV9mcmFtZWJ1ZmZlciAq
ZmIgPSBwbGFuZV9zdGF0ZS0+YmFzZS5mYjsKKwljb25zdCBzdHJ1Y3QgZHJtX2ZyYW1lYnVmZmVy
ICpmYiA9IHBsYW5lX3N0YXRlLT5ody5mYjsKIAllbnVtIHBsYW5lX2lkIHBsYW5lX2lkID0gcGxh
bmUtPmlkOwogCWludCByZXQ7CiAKQEAgLTQ5MzYsNyArNDkzNiw3IEBAIHN0YXRpYyBpbnQgaWNs
X2J1aWxkX3BsYW5lX3dtKHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlLAogCQly
ZXR1cm4gMDsKIAogCWlmIChwbGFuZV9zdGF0ZS0+cGxhbmFyX2xpbmtlZF9wbGFuZSkgewotCQlj
b25zdCBzdHJ1Y3QgZHJtX2ZyYW1lYnVmZmVyICpmYiA9IHBsYW5lX3N0YXRlLT5iYXNlLmZiOwor
CQljb25zdCBzdHJ1Y3QgZHJtX2ZyYW1lYnVmZmVyICpmYiA9IHBsYW5lX3N0YXRlLT5ody5mYjsK
IAkJZW51bSBwbGFuZV9pZCB5X3BsYW5lX2lkID0gcGxhbmVfc3RhdGUtPnBsYW5hcl9saW5rZWRf
cGxhbmUtPmlkOwogCiAJCVdBUk5fT04oIWludGVsX3dtX3BsYW5lX3Zpc2libGUoY3J0Y19zdGF0
ZSwgcGxhbmVfc3RhdGUpKTsKLS0gCjIuMjMuMAoKX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX18KSW50ZWwtZ2Z4IG1haWxpbmcgbGlzdApJbnRlbC1nZnhAbGlz
dHMuZnJlZWRlc2t0b3Aub3JnCmh0dHBzOi8vbGlzdHMuZnJlZWRlc2t0b3Aub3JnL21haWxtYW4v
bGlzdGluZm8vaW50ZWwtZ2Z4

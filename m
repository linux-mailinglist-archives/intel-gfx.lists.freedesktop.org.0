Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id EC6C610A223
	for <lists+intel-gfx@lfdr.de>; Tue, 26 Nov 2019 17:31:14 +0100 (CET)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id E19B76E434;
	Tue, 26 Nov 2019 16:31:12 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from mga05.intel.com (mga05.intel.com [192.55.52.43])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 68D8C6E43A
 for <intel-gfx@lists.freedesktop.org>; Tue, 26 Nov 2019 16:31:11 +0000 (UTC)
X-Amp-Result: SKIPPED(no attachment in message)
X-Amp-File-Uploaded: False
Received: from orsmga006.jf.intel.com ([10.7.209.51])
 by fmsmga105.fm.intel.com with ESMTP/TLS/DHE-RSA-AES256-GCM-SHA384;
 26 Nov 2019 08:31:11 -0800
X-ExtLoop1: 1
X-IronPort-AV: E=Sophos;i="5.69,246,1571727600"; d="scan'208";a="211464558"
Received: from slisovsk-lenovo-ideapad-720s-13ikb.fi.intel.com ([10.237.72.89])
 by orsmga006.jf.intel.com with ESMTP; 26 Nov 2019 08:31:09 -0800
From: Stanislav Lisovskiy <stanislav.lisovskiy@intel.com>
To: intel-gfx@lists.freedesktop.org
Date: Tue, 26 Nov 2019 18:28:39 +0200
Message-Id: <20191126162839.28094-5-stanislav.lisovskiy@intel.com>
X-Mailer: git-send-email 2.17.1
In-Reply-To: <20191126162839.28094-1-stanislav.lisovskiy@intel.com>
References: <20191126162839.28094-1-stanislav.lisovskiy@intel.com>
Subject: [Intel-gfx] [PATCH v5 4/4] drm/i915: Correctly map DBUF slices to
 pipes
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
MIME-Version: 1.0
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

QWRkZWQgcHJvcGVyIERCdWYgc2xpY2UgbWFwcGluZyB0byBjb3JyZXNwb25kZW50CnBpcGVzLCBk
ZXBlbmRpbmcgb24gcGlwZSBjb25maWd1cmF0aW9uIGFzIHN0YXRlZAppbiBCU3BlYy4KClNpZ25l
ZC1vZmYtYnk6IFN0YW5pc2xhdiBMaXNvdnNraXkgPHN0YW5pc2xhdi5saXNvdnNraXlAaW50ZWwu
Y29tPgotLS0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2ludGVsX3BtLmMgfCAyNTAgKysrKysrKysr
KysrKysrKysrKysrKysrKysrKysrLS0KIDEgZmlsZSBjaGFuZ2VkLCAyMzYgaW5zZXJ0aW9ucygr
KSwgMTQgZGVsZXRpb25zKC0pCgpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50
ZWxfcG0uYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2ludGVsX3BtLmMKaW5kZXggNGMzMGRkZGI5
NDNhLi42NjY1N2EyMDdlZDQgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2ludGVs
X3BtLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50ZWxfcG0uYwpAQCAtMzgxNSw2ICsz
ODE1LDI1IEBAIGJvb2wgaW50ZWxfY2FuX2VuYWJsZV9zYWd2KHN0cnVjdCBpbnRlbF9hdG9taWNf
c3RhdGUgKnN0YXRlKQogCXJldHVybiB0cnVlOwogfQogCisvKgorICogQ2FsY3VsYXRlIGluaXRp
YWwgREJ1ZiBzbGljZSBvZmZzZXQsIGJhc2VkIG9uIHNsaWNlIHNpemUKKyAqIGFuZCBtYXNrKGku
ZSBpZiBzbGljZSBzaXplIGlzIDEwMjQgYW5kIHNlY29uZCBzbGljZSBpcyBlbmFibGVkCisgKiBv
ZmZzZXQgd291bGQgYmUgMTAyNCkKKyAqLworc3RhdGljIHUzMiBpY2xfZ2V0X2ZpcnN0X2RidWZf
c2xpY2Vfb2Zmc2V0KHUzMiBkYnVmX3NsaWNlX21hc2ssCisJCQkJCSAgIHUzMiBzbGljZV9zaXpl
LCB1MzIgZGRiX3NpemUpCit7CisJdTMyIG9mZnNldCA9IDA7CisKKwlpZiAoIWRidWZfc2xpY2Vf
bWFzaykKKwkJcmV0dXJuIDA7CisKKwlvZmZzZXQgPSAoZmZzKGRidWZfc2xpY2VfbWFzaykgLSAx
KSAqIHNsaWNlX3NpemU7CisKKwlXQVJOX09OKG9mZnNldCA+PSBkZGJfc2l6ZSk7CisJcmV0dXJu
IG9mZnNldDsKK30KKwogc3RhdGljIHUxNiBpbnRlbF9nZXRfZGRiX3NpemUoc3RydWN0IGRybV9p
OTE1X3ByaXZhdGUgKmRldl9wcml2LAogCQkJICAgICAgY29uc3Qgc3RydWN0IGludGVsX2NydGNf
c3RhdGUgKmNydGNfc3RhdGUsCiAJCQkgICAgICBjb25zdCB1NjQgdG90YWxfZGF0YV9yYXRlLApA
QCAtMzgyOCwxOCArMzg0NywxMyBAQCBzdGF0aWMgdTE2IGludGVsX2dldF9kZGJfc2l6ZShzdHJ1
Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCiAJaWYgKElOVEVMX0dFTihkZXZfcHJpdikg
PCAxMSkKIAkJcmV0dXJuIGRkYl9zaXplIC0gNDsgLyogNCBibG9ja3MgZm9yIGJ5cGFzcyBwYXRo
IGFsbG9jYXRpb24gKi8KIAotCS8qCi0JICogRklYTUU6IEVuYWJsZWQgc2xpY2VzIHNob3VsZCBi
ZSBvbmx5Ci0JICogaW4gYWNjb3JkaW5nIHRvIEJTcGVjIGFuZCBiZSBkZXRlcm1pbmVkCi0JICog
YnkgbnVtIGFjdGl2ZSBwaXBlcyhCU3BlYyAxMjcxNiBhbmQgNDkyNTUpLgotCSAqIEZvciBub3cg
c2V0IG1hc2sgZm9yIDFzdCBzbGljZSBvbmx5LgotCSAqLwotCWRkYi0+ZW5hYmxlZF9zbGljZXMg
PSBEQlVGX1MxX0JJVDsKLQlkZGJfc2l6ZSAvPSAyOwotCiAJcmV0dXJuIGRkYl9zaXplOwogfQog
Cit1MzIgaTkxNV9wb3NzaWJsZV9kYnVmX3NsaWNlcyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAq
ZGV2X3ByaXYsCisJCQkgICAgICBpbnQgcGlwZSwgdTMyIGFjdGl2ZV9waXBlcywKKwkJCSAgICAg
IGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlKTsKKwogc3RhdGljIHZv
aWQKIHNrbF9kZGJfZ2V0X3BpcGVfYWxsb2NhdGlvbl9saW1pdHMoc3RydWN0IGRybV9pOTE1X3By
aXZhdGUgKmRldl9wcml2LAogCQkJCSAgIGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpj
cnRjX3N0YXRlLApAQCAtMzg1NSw3ICszODY5LDE0IEBAIHNrbF9kZGJfZ2V0X3BpcGVfYWxsb2Nh
dGlvbl9saW1pdHMoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAogCXUzMiBwaXBl
X3dpZHRoID0gMCwgdG90YWxfd2lkdGggPSAwLCB3aWR0aF9iZWZvcmVfcGlwZSA9IDA7CiAJZW51
bSBwaXBlIGZvcl9waXBlID0gdG9faW50ZWxfY3J0Yyhmb3JfY3J0YyktPnBpcGU7CiAJdTE2IGRk
Yl9zaXplOworCXUzMiBkZGJfcmFuZ2Vfc2l6ZTsKIAl1MzIgaTsKKwl1MzIgZGJ1Zl9zbGljZV9t
YXNrOworCXUzMiBhY3RpdmVfcGlwZXM7CisJdTMyIG9mZnNldDsKKwl1MzIgc2xpY2Vfc2l6ZTsK
Kwl1MzIgdG90YWxfc2xpY2VfbWFzazsKKwl1MzIgc3RhcnQsIGVuZDsKIAogCWlmIChXQVJOX09O
KCFzdGF0ZSkgfHwgIWNydGNfc3RhdGUtPmh3LmFjdGl2ZSkgewogCQlhbGxvYy0+c3RhcnQgPSAw
OwpAQCAtMzg2NCwxNCArMzg4NSwyMyBAQCBza2xfZGRiX2dldF9waXBlX2FsbG9jYXRpb25fbGlt
aXRzKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKIAkJcmV0dXJuOwogCX0KIAot
CWlmIChpbnRlbF9zdGF0ZS0+YWN0aXZlX3BpcGVfY2hhbmdlcykKKwlpZiAoaW50ZWxfc3RhdGUt
PmFjdGl2ZV9waXBlX2NoYW5nZXMpIHsKIAkJKm51bV9hY3RpdmUgPSBod2VpZ2h0OChpbnRlbF9z
dGF0ZS0+YWN0aXZlX3BpcGVzKTsKLQllbHNlCisJCWFjdGl2ZV9waXBlcyA9IGludGVsX3N0YXRl
LT5hY3RpdmVfcGlwZXM7CisJfSBlbHNlIHsKIAkJKm51bV9hY3RpdmUgPSBod2VpZ2h0OChkZXZf
cHJpdi0+YWN0aXZlX3BpcGVzKTsKKwkJYWN0aXZlX3BpcGVzID0gZGV2X3ByaXYtPmFjdGl2ZV9w
aXBlczsKKwl9CiAKIAlkZGJfc2l6ZSA9IGludGVsX2dldF9kZGJfc2l6ZShkZXZfcHJpdiwgY3J0
Y19zdGF0ZSwgdG90YWxfZGF0YV9yYXRlLAogCQkJCSAgICAgICpudW1fYWN0aXZlLCBkZGIpOwog
CisJRFJNX0RFQlVHX0tNUygiR290IHRvdGFsIGRkYiBzaXplICVkXG4iLCBkZGJfc2l6ZSk7CisK
KwlzbGljZV9zaXplID0gZGRiX3NpemUgLyBJTlRFTF9JTkZPKGRldl9wcml2KS0+bnVtX3N1cHBv
cnRlZF9kYnVmX3NsaWNlczsKKworCURSTV9ERUJVR19LTVMoIkdvdCBEQnVmIHNsaWNlIHNpemUg
JWRcbiIsIHNsaWNlX3NpemUpOworCiAJLyoKIAkgKiBJZiB0aGUgc3RhdGUgZG9lc24ndCBjaGFu
Z2UgdGhlIGFjdGl2ZSBDUlRDJ3Mgb3IgdGhlcmUgaXMgbm8KIAkgKiBtb2Rlc2V0IHJlcXVlc3Qs
IHRoZW4gdGhlcmUncyBubyBuZWVkIHRvIHJlY2FsY3VsYXRlOwpAQCAtMzg4OSwxOCArMzkxOSw2
OCBAQCBza2xfZGRiX2dldF9waXBlX2FsbG9jYXRpb25fbGltaXRzKHN0cnVjdCBkcm1faTkxNV9w
cml2YXRlICpkZXZfcHJpdiwKIAkJcmV0dXJuOwogCX0KIAorCS8qCisJICogR2V0IGFsbG93ZWQg
REJ1ZiBzbGljZXMgZm9yIGNvcnJlc3BvbmRlbnQgcGlwZSBhbmQgcGxhdGZvcm0uCisJICovCisJ
ZGJ1Zl9zbGljZV9tYXNrID0gaTkxNV9wb3NzaWJsZV9kYnVmX3NsaWNlcyhkZXZfcHJpdiwgZm9y
X3BpcGUsCisJCQkJCQkgICAgYWN0aXZlX3BpcGVzLCBjcnRjX3N0YXRlKTsKKworCURSTV9ERUJV
R19LTVMoIkRCdWYgc2xpY2UgbWFzayAleCBwaXBlICVkIGFjdGl2ZSBwaXBlcyAleFxuIiwKKwkJ
ICAgICAgZGJ1Zl9zbGljZV9tYXNrLAorCQkgICAgICBmb3JfcGlwZSwgYWN0aXZlX3BpcGVzKTsK
KworCS8qCisJICogRmlndXJlIG91dCBhdCB3aGljaCBEQnVmIHNsaWNlIHdlIHN0YXJ0LCBpLmUg
aWYgd2Ugc3RhcnQgYXQgRGJ1ZiBTMgorCSAqIGFuZCBzbGljZSBzaXplIGlzIDEwMjQsIHRoZSBv
ZmZzZXQgd291bGQgYmUgMTAyNAorCSAqLworCW9mZnNldCA9IGljbF9nZXRfZmlyc3RfZGJ1Zl9z
bGljZV9vZmZzZXQoZGJ1Zl9zbGljZV9tYXNrLAorCQkJCQkJIHNsaWNlX3NpemUsIGRkYl9zaXpl
KTsKKworCS8qCisJICogRmlndXJlIG91dCB0b3RhbCBzaXplIG9mIGFsbG93ZWQgREJ1ZiBzbGlj
ZXMsIHdoaWNoIGlzIGJhc2ljYWxseQorCSAqIGEgbnVtYmVyIG9mIGFsbG93ZWQgc2xpY2VzIGZv
ciB0aGF0IHBpcGUgbXVsdGlwbGllZCBieSBzbGljZSBzaXplLgorCSAqIEluc2lkZSBvZiB0aGlz
CisJICogcmFuZ2UgZGRiIGVudHJpZXMgYXJlIHN0aWxsIGFsbG9jYXRlZCBpbiBwcm9wb3J0aW9u
IHRvIGRpc3BsYXkgd2lkdGguCisJICovCisJZGRiX3JhbmdlX3NpemUgPSBod2VpZ2h0OChkYnVm
X3NsaWNlX21hc2spICogc2xpY2Vfc2l6ZTsKKwogCS8qCiAJICogV2F0ZXJtYXJrL2RkYiByZXF1
aXJlbWVudCBoaWdobHkgZGVwZW5kcyB1cG9uIHdpZHRoIG9mIHRoZQogCSAqIGZyYW1lYnVmZmVy
LCBTbyBpbnN0ZWFkIG9mIGFsbG9jYXRpbmcgRERCIGVxdWFsbHkgYW1vbmcgcGlwZXMKIAkgKiBk
aXN0cmlidXRlIEREQiBiYXNlZCBvbiByZXNvbHV0aW9uL3dpZHRoIG9mIHRoZSBkaXNwbGF5Lgog
CSAqLworCXRvdGFsX3NsaWNlX21hc2sgPSBkYnVmX3NsaWNlX21hc2s7CiAJZm9yX2VhY2hfbmV3
X2ludGVsX2NydGNfaW5fc3RhdGUoaW50ZWxfc3RhdGUsIGNydGMsIGNydGNfc3RhdGUsIGkpIHsK
IAkJY29uc3Qgc3RydWN0IGRybV9kaXNwbGF5X21vZGUgKmFkanVzdGVkX21vZGUgPQogCQkJJmNy
dGNfc3RhdGUtPmh3LmFkanVzdGVkX21vZGU7CiAJCWVudW0gcGlwZSBwaXBlID0gY3J0Yy0+cGlw
ZTsKIAkJaW50IGhkaXNwbGF5LCB2ZGlzcGxheTsKKwkJdTMyIHBpcGVfZGJ1Zl9zbGljZV9tYXNr
ID0KKwkJCQkJaTkxNV9wb3NzaWJsZV9kYnVmX3NsaWNlcyhkZXZfcHJpdiwKKwkJCQkJCQkJICBw
aXBlLAorCQkJCQkJCQkgIGFjdGl2ZV9waXBlcywKKwkJCQkJCQkJICBjcnRjX3N0YXRlKTsKIAot
CQlpZiAoIWNydGNfc3RhdGUtPmh3LmVuYWJsZSkKKwkJaWYgKCFjcnRjX3N0YXRlLT5ody5hY3Rp
dmUpCisJCQljb250aW51ZTsKKworCQkvKgorCQkgKiBBY2NvcmRpbmcgdG8gQlNwZWMgcGlwZSBj
YW4gc2hhcmUgb25lIGRidWYgc2xpY2Ugd2l0aCBhbm90aGVyCisJCSAqIHBpcGVzIG9yIHBpcGUg
Y2FuIHVzZSBtdWx0aXBsZSBkYnVmcywgaW4gYm90aCBjYXNlcyB3ZQorCQkgKiBhY2NvdW50IGZv
ciBvdGhlciBwaXBlcyBvbmx5IGlmIHRoZXkgaGF2ZSBleGFjdGx5IHNhbWUgbWFzay4KKwkJICog
SG93ZXZlciB3ZSBuZWVkIHRvIGFjY291bnQgaG93IG1hbnkgc2xpY2VzIHdlIHNob3VsZCBlbmFi
bGUKKwkJICogaW4gdG90YWwuCisJCSAqLworCQl0b3RhbF9zbGljZV9tYXNrIHw9IHBpcGVfZGJ1
Zl9zbGljZV9tYXNrOworCisJCS8qCisJCSAqIERvIG5vdCBhY2NvdW50IHBpcGVzIHVzaW5nIG90
aGVyIHNsaWNlIHNldHMKKwkJICogbHVja2lseSBhcyBvZiBjdXJyZW50IEJTcGVjIHNsaWNlIHNl
dHMgZG8gbm90IHBhcnRpYWxseQorCQkgKiBpbnRlcnNlY3QocGlwZXMgc2hhcmUgZWl0aGVyIHNh
bWUgb25lIHNsaWNlIG9yIHNhbWUgc2xpY2Ugc2V0CisJCSAqIGkuZSBubyBwYXJ0aWFsIGludGVy
c2VjdGlvbiksIHNvIGl0IGlzIGVub3VnaCB0byBjaGVjayBmb3IKKwkJICogZXF1YWxpdHkgZm9y
IG5vdy4KKwkJICovCisJCWlmIChkYnVmX3NsaWNlX21hc2sgIT0gcGlwZV9kYnVmX3NsaWNlX21h
c2spCiAJCQljb250aW51ZTsKIAogCQlkcm1fbW9kZV9nZXRfaHZfdGltaW5nKGFkanVzdGVkX21v
ZGUsICZoZGlzcGxheSwgJnZkaXNwbGF5KTsKQEAgLTM5MTIsOCArMzk5MiwxOSBAQCBza2xfZGRi
X2dldF9waXBlX2FsbG9jYXRpb25fbGltaXRzKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZf
cHJpdiwKIAkJCXBpcGVfd2lkdGggPSBoZGlzcGxheTsKIAl9CiAKLQlhbGxvYy0+c3RhcnQgPSBk
ZGJfc2l6ZSAqIHdpZHRoX2JlZm9yZV9waXBlIC8gdG90YWxfd2lkdGg7Ci0JYWxsb2MtPmVuZCA9
IGRkYl9zaXplICogKHdpZHRoX2JlZm9yZV9waXBlICsgcGlwZV93aWR0aCkgLyB0b3RhbF93aWR0
aDsKKwlkZGItPmVuYWJsZWRfc2xpY2VzID0gdG90YWxfc2xpY2VfbWFzazsKKworCXN0YXJ0ID0g
ZGRiX3JhbmdlX3NpemUgKiB3aWR0aF9iZWZvcmVfcGlwZSAvIHRvdGFsX3dpZHRoOworCWVuZCA9
IGRkYl9yYW5nZV9zaXplICogKHdpZHRoX2JlZm9yZV9waXBlICsgcGlwZV93aWR0aCkgLyB0b3Rh
bF93aWR0aDsKKworCWFsbG9jLT5zdGFydCA9IG9mZnNldCArIHN0YXJ0OworCWFsbG9jLT5lbmQg
PSBvZmZzZXQgKyBlbmQ7CisKKwlEUk1fREVCVUdfS01TKCJQaXBlICVkIGRkYiAlZC0lZFxuIiwg
Zm9yX3BpcGUsCisJCSAgICAgIGFsbG9jLT5zdGFydCwgYWxsb2MtPmVuZCk7CisJRFJNX0RFQlVH
X0tNUygiRW5hYmxlZCBkZGIgc2xpY2VzIG1hc2sgJXggbnVtIHN1cHBvcnRlZCAlZFxuIiwKKwkJ
ICAgICAgZGRiLT5lbmFibGVkX3NsaWNlcywKKwkJICAgICAgSU5URUxfSU5GTyhkZXZfcHJpdikt
Pm51bV9zdXBwb3J0ZWRfZGJ1Zl9zbGljZXMpOwogfQogCiBzdGF0aWMgaW50IHNrbF9jb21wdXRl
X3dtX3BhcmFtcyhjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSwKQEAg
LTQwMzUsNiArNDEyNiw3IEBAIHZvaWQgc2tsX2RkYl9nZXRfaHdfc3RhdGUoc3RydWN0IGRybV9p
OTE1X3ByaXZhdGUgKmRldl9wcml2LAogCQkJICBzdHJ1Y3Qgc2tsX2RkYl92YWx1ZXMgKmRkYiAv
KiBvdXQgKi8pCiB7CiAJZGRiLT5lbmFibGVkX3NsaWNlcyA9IGludGVsX2VuYWJsZWRfZGJ1Zl9z
bGljZXNfbnVtKGRldl9wcml2KTsKKwlEUk1fREVCVUdfS01TKCJHb3QgaHcgZGJ1ZiBzbGljZXMg
bWFzayAleFxuIiwgZGRiLT5lbmFibGVkX3NsaWNlcyk7CiB9CiAKIC8qCkBAIC00MDg0LDYgKzQx
NzYsMTM2IEBAIHNrbF9wbGFuZV9kb3duc2NhbGVfYW1vdW50KGNvbnN0IHN0cnVjdCBpbnRlbF9j
cnRjX3N0YXRlICpjcnRjX3N0YXRlLAogCXJldHVybiBtdWxfZml4ZWQxNihkb3duc2NhbGVfdywg
ZG93bnNjYWxlX2gpOwogfQogCisKK3N0cnVjdCBkYnVmX3NsaWNlX2NvbmZfZW50cnkgeworCXUz
MiBhY3RpdmVfcGlwZXM7CisJdTMyIGRidWZfbWFza1tJOTE1X01BWF9QSVBFU107Cit9OworCisK
KyNkZWZpbmUgREJVRl9UT180X1BJUEVTX01BUChhY3RpdmVfcGlwZXMsIGRidWYxLCBkYnVmMiwg
ZGJ1ZjMsIGRidWY0KSBcCisJeyBhY3RpdmVfcGlwZXMsIHsgZGJ1ZjEsIGRidWYyLCBkYnVmMywg
ZGJ1ZjQgfSB9CisKKy8qCisgKiBUYWJsZSB0YWtlbiBmcm9tIEJzcGVjIDEyNzE2CisgKiBQaXBl
cyBkbyBoYXZlIHNvbWUgcHJlZmVycmVkIERCdWYgc2xpY2UgYWZmaW5pdHksCisgKiBwbHVzIHRo
ZXJlIGFyZSBzb21lIGhhcmRjb2RlZCByZXF1aXJlbWVudHMgb24gaG93CisgKiB0aG9zZSBzaG91
bGQgYmUgZGlzdHJpYnV0ZWQgZm9yIG11bHRpcGlwZSBzY2VuYXJpb3MuCisgKiBGb3IgbW9yZSBE
QnVmIHNsaWNlcyBhbGdvcml0aG0gY2FuIGdldCBldmVuIG1vcmUgbWVzc3kKKyAqIGFuZCBsZXNz
IHJlYWRhYmxlLCBzbyBkZWNpZGVkIHRvIHVzZSBhIHRhYmxlIGFsbW9zdAorICogYXMgaXMgZnJv
bSBCU3BlYyBpdHNlbGYgLSB0aGF0IHdheSBpdCBpcyBhdCBsZWFzdCBlYXNpZXIKKyAqIHRvIGNv
bXBhcmUsIGNoYW5nZSBhbmQgY2hlY2suCisgKi8KK3N0YXRpYyBzdHJ1Y3QgZGJ1Zl9zbGljZV9j
b25mX2VudHJ5IGljbF9hbGxvd2VkX2RidWZzW10gPSB7CisJREJVRl9UT180X1BJUEVTX01BUChC
SVQoUElQRV9BKSwgREJVRl9TMV9CSVQsIDAsIDAsIDApLAorCURCVUZfVE9fNF9QSVBFU19NQVAo
QklUKFBJUEVfQiksIDAsIERCVUZfUzFfQklULCAwLCAwKSwKKwlEQlVGX1RPXzRfUElQRVNfTUFQ
KEJJVChQSVBFX0MpLCAwLCAwLCBEQlVGX1MyX0JJVCwgMCksCisJREJVRl9UT180X1BJUEVTX01B
UChCSVQoUElQRV9BKSB8IEJJVChQSVBFX0IpLAorCQkJICAgICBEQlVGX1MxX0JJVCwgREJVRl9T
Ml9CSVQsIDAsIDApLAorCURCVUZfVE9fNF9QSVBFU19NQVAoQklUKFBJUEVfQSkgfCBCSVQoUElQ
RV9DKSwKKwkJCSAgICAgREJVRl9TMV9CSVQsIDAsIERCVUZfUzJfQklULCAwKSwKKwlEQlVGX1RP
XzRfUElQRVNfTUFQKEJJVChQSVBFX0IpIHwgQklUKFBJUEVfQyksIDAsCisJCQkgICAgIERCVUZf
UzFfQklULCBEQlVGX1MyX0JJVCwgMCksCisJREJVRl9UT180X1BJUEVTX01BUChCSVQoUElQRV9B
KSB8IEJJVChQSVBFX0IpIHwgQklUKFBJUEVfQyksCisJCQkgICAgIERCVUZfUzFfQklULCBEQlVG
X1MxX0JJVCwgREJVRl9TMl9CSVQsIDApCit9OworCisvKgorICogVGFibGUgdGFrZW4gZnJvbSBC
c3BlYyA0OTI1NQorICogUGlwZXMgZG8gaGF2ZSBzb21lIHByZWZlcnJlZCBEQnVmIHNsaWNlIGFm
ZmluaXR5LAorICogcGx1cyB0aGVyZSBhcmUgc29tZSBoYXJkY29kZWQgcmVxdWlyZW1lbnRzIG9u
IGhvdworICogdGhvc2Ugc2hvdWxkIGJlIGRpc3RyaWJ1dGVkIGZvciBtdWx0aXBpcGUgc2NlbmFy
aW9zLgorICogRm9yIG1vcmUgREJ1ZiBzbGljZXMgYWxnb3JpdGhtIGNhbiBnZXQgZXZlbiBtb3Jl
IG1lc3N5CisgKiBhbmQgbGVzcyByZWFkYWJsZSwgc28gZGVjaWRlZCB0byB1c2UgYSB0YWJsZSBh
bG1vc3QKKyAqIGFzIGlzIGZyb20gQlNwZWMgaXRzZWxmIC0gdGhhdCB3YXkgaXQgaXMgYXQgbGVh
c3QgZWFzaWVyCisgKiB0byBjb21wYXJlLCBjaGFuZ2UgYW5kIGNoZWNrLgorICovCitzdGF0aWMg
c3RydWN0IGRidWZfc2xpY2VfY29uZl9lbnRyeSB0Z2xfYWxsb3dlZF9kYnVmc1tdID0geworCURC
VUZfVE9fNF9QSVBFU19NQVAoQklUKFBJUEVfQSksIERCVUZfUzFfQklUIHwgREJVRl9TMl9CSVQs
IDAsIDAsIDApLAorCURCVUZfVE9fNF9QSVBFU19NQVAoQklUKFBJUEVfQiksIDAsIERCVUZfUzFf
QklUIHwgREJVRl9TMl9CSVQsIDAsIDApLAorCURCVUZfVE9fNF9QSVBFU19NQVAoQklUKFBJUEVf
QyksIDAsIDAsIERCVUZfUzFfQklUIHwgREJVRl9TMl9CSVQsIDApLAorCURCVUZfVE9fNF9QSVBF
U19NQVAoQklUKFBJUEVfQyksIDAsIDAsIDAsIERCVUZfUzFfQklUIHwgREJVRl9TMl9CSVQpLAor
CURCVUZfVE9fNF9QSVBFU19NQVAoQklUKFBJUEVfQSkgfCBCSVQoUElQRV9CKSwKKwkJCSAgICAg
REJVRl9TMl9CSVQsIERCVUZfUzFfQklULCAwLCAwKSwKKwlEQlVGX1RPXzRfUElQRVNfTUFQKEJJ
VChQSVBFX0EpIHwgQklUKFBJUEVfQyksCisJCQkgICAgIERCVUZfUzFfQklULCAwLCBEQlVGX1My
X0JJVCwgMCksCisJREJVRl9UT180X1BJUEVTX01BUChCSVQoUElQRV9BKSB8IEJJVChQSVBFX0Qp
LAorCQkJICAgICBEQlVGX1MxX0JJVCwgMCwgMCwgREJVRl9TMl9CSVQpLAorCURCVUZfVE9fNF9Q
SVBFU19NQVAoQklUKFBJUEVfQikgfCBCSVQoUElQRV9DKSwKKwkJCSAgICAgMCwgREJVRl9TMV9C
SVQsIERCVUZfUzJfQklULCAwKSwKKwlEQlVGX1RPXzRfUElQRVNfTUFQKEJJVChQSVBFX0IpIHwg
QklUKFBJUEVfRCksCisJCQkgICAgIDAsIERCVUZfUzFfQklULCAwLCBEQlVGX1MyX0JJVCksCisJ
REJVRl9UT180X1BJUEVTX01BUChCSVQoUElQRV9DKSB8IEJJVChQSVBFX0QpLAorCQkJICAgICAw
LCAwLCBEQlVGX1MxX0JJVCwgREJVRl9TMl9CSVQpLAorCURCVUZfVE9fNF9QSVBFU19NQVAoQklU
KFBJUEVfQykgfCBCSVQoUElQRV9EKSwKKwkJCSAgICAgMCwgMCwgREJVRl9TMV9CSVQsIERCVUZf
UzJfQklUKSwKKwlEQlVGX1RPXzRfUElQRVNfTUFQKEJJVChQSVBFX0EpIHwgQklUKFBJUEVfQikg
fCBCSVQoUElQRV9DKSwKKwkJCSAgICAgREJVRl9TMV9CSVQsIERCVUZfUzFfQklULCBEQlVGX1My
X0JJVCwgMCksCisJREJVRl9UT180X1BJUEVTX01BUChCSVQoUElQRV9BKSB8IEJJVChQSVBFX0Ip
IHwgQklUKFBJUEVfRCksCisJCQkgICAgIERCVUZfUzFfQklULCBEQlVGX1MxX0JJVCwgMCwgREJV
Rl9TMl9CSVQpLAorCURCVUZfVE9fNF9QSVBFU19NQVAoQklUKFBJUEVfQSkgfCBCSVQoUElQRV9D
KSB8IEJJVChQSVBFX0QpLAorCQkJICAgICBEQlVGX1MxX0JJVCwgMCwgREJVRl9TMl9CSVQsIERC
VUZfUzJfQklUKSwKKwlEQlVGX1RPXzRfUElQRVNfTUFQKEJJVChQSVBFX0IpIHwgQklUKFBJUEVf
QykgfCBCSVQoUElQRV9EKSwKKwkJCSAgICAgMCwgREJVRl9TMV9CSVQsIERCVUZfUzJfQklULCBE
QlVGX1MyX0JJVCkKK307CisKK3N0YXRpYyB1MzIgaTkxNV9maW5kX3BpcGVfY29uZihpbnQgcGlw
ZSwKKwkJCSAgICAgICB1MzIgYWN0aXZlX3BpcGVzLAorCQkJICAgICAgIGNvbnN0IHN0cnVjdCBk
YnVmX3NsaWNlX2NvbmZfZW50cnkgKmRidWZfc2xpY2VzLAorCQkJICAgICAgIGludCBzaXplKQor
eworCWludCBpOworCisJZm9yIChpID0gMDsgaSA8IHNpemU7IGkrKykgeworCQlpZiAoZGJ1Zl9z
bGljZXNbaV0uYWN0aXZlX3BpcGVzID09IGFjdGl2ZV9waXBlcykgeworCQkJcmV0dXJuIGRidWZf
c2xpY2VzW2ldLmRidWZfbWFza1twaXBlXTsKKwkJfQorCX0KKwlyZXR1cm4gMDsKK30KKworLyoK
KyAqIFRoaXMgZnVuY3Rpb24gZmluZHMgYW4gZW50cnkgd2l0aCBzYW1lIGVuYWJsZWQgcGlwZSBj
b25maWd1cmF0aW9uIGFuZAorICogcmV0dXJucyBjb3JyZXNwb25kZW50IERCdWYgc2xpY2UgbWFz
ayBhcyBzdGF0ZWQgaW4gQlNwZWMgZm9yIHBhcnRpY3VsYXIKKyAqIHBsYXRmb3JtLgorICovCitz
dGF0aWMgdTMyIGljbF9wb3NzaWJsZV9kYnVmX3NsaWNlcyhpbnQgcGlwZSwKKwkJCQkgICAgdTMy
IGFjdGl2ZV9waXBlcywKKwkJCQkgICAgY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNy
dGNfc3RhdGUpCit7CisJcmV0dXJuIGk5MTVfZmluZF9waXBlX2NvbmYocGlwZSwgYWN0aXZlX3Bp
cGVzLAorCQkJCSAgIGljbF9hbGxvd2VkX2RidWZzLAorCQkJCSAgIEFSUkFZX1NJWkUoaWNsX2Fs
bG93ZWRfZGJ1ZnMpKTsKK30KKworc3RhdGljIHUzMiB0Z2xfcG9zc2libGVfZGJ1Zl9zbGljZXMo
aW50IHBpcGUsCisJCQkJICAgIHUzMiBhY3RpdmVfcGlwZXMsCisJCQkJICAgIGNvbnN0IHN0cnVj
dCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlKQoreworCXJldHVybiBpOTE1X2ZpbmRfcGlw
ZV9jb25mKHBpcGUsIGFjdGl2ZV9waXBlcywKKwkJCQkgICB0Z2xfYWxsb3dlZF9kYnVmcywKKwkJ
CQkgICBBUlJBWV9TSVpFKHRnbF9hbGxvd2VkX2RidWZzKSk7Cit9CisKK3UzMiBpOTE1X3Bvc3Np
YmxlX2RidWZfc2xpY2VzKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKKwkJCSAg
ICAgIGludCBwaXBlLCB1MzIgYWN0aXZlX3BpcGVzLAorCQkJICAgICAgY29uc3Qgc3RydWN0IGlu
dGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUpCit7CisJaWYgKElTX0dFTihkZXZfcHJpdiwgMTEp
KQorCQlyZXR1cm4gaWNsX3Bvc3NpYmxlX2RidWZfc2xpY2VzKHBpcGUsCisJCQkJCQlhY3RpdmVf
cGlwZXMsCisJCQkJCQljcnRjX3N0YXRlKTsKKwllbHNlIGlmIChJU19HRU4oZGV2X3ByaXYsIDEy
KSkKKwkJcmV0dXJuIHRnbF9wb3NzaWJsZV9kYnVmX3NsaWNlcyhwaXBlLAorCQkJCQkJYWN0aXZl
X3BpcGVzLAorCQkJCQkJY3J0Y19zdGF0ZSk7CisJLyoKKwkgKiBGb3IgYW55dGhpbmcgZWxzZSBq
dXN0IHJldHVybiBvbmUgc2xpY2UgeWV0LgorCSAqIFNob3VsZCBiZSBleHRlbmRlZCBmb3Igb3Ro
ZXIgcGxhdGZvcm1zLgorCSAqLworCXJldHVybiBEQlVGX1MxX0JJVDsKK30KKwogc3RhdGljIHU2
NAogc2tsX3BsYW5lX3JlbGF0aXZlX2RhdGFfcmF0ZShjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19z
dGF0ZSAqY3J0Y19zdGF0ZSwKIAkJCSAgICAgY29uc3Qgc3RydWN0IGludGVsX3BsYW5lX3N0YXRl
ICpwbGFuZV9zdGF0ZSwKLS0gCjIuMTcuMQoKX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX18KSW50ZWwtZ2Z4IG1haWxpbmcgbGlzdApJbnRlbC1nZnhAbGlzdHMu
ZnJlZWRlc2t0b3Aub3JnCmh0dHBzOi8vbGlzdHMuZnJlZWRlc2t0b3Aub3JnL21haWxtYW4vbGlz
dGluZm8vaW50ZWwtZ2Z4

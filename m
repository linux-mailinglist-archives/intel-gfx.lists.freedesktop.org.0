Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id D4273108440
	for <lists+intel-gfx@lfdr.de>; Sun, 24 Nov 2019 18:05:32 +0100 (CET)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 41F5689D46;
	Sun, 24 Nov 2019 17:05:30 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from fireflyinternet.com (mail.fireflyinternet.com [109.228.58.192])
 by gabe.freedesktop.org (Postfix) with ESMTPS id E4D5689DDF
 for <intel-gfx@lists.freedesktop.org>; Sun, 24 Nov 2019 17:05:27 +0000 (UTC)
X-Default-Received-SPF: pass (skip=forwardok (res=PASS))
 x-ip-name=78.156.65.138; 
Received: from haswell.alporthouse.com (unverified [78.156.65.138]) 
 by fireflyinternet.com (Firefly Internet (M1)) with ESMTP id 19320354-1500050 
 for <intel-gfx@lists.freedesktop.org>; Sun, 24 Nov 2019 17:05:27 +0000
From: Chris Wilson <chris@chris-wilson.co.uk>
To: intel-gfx@lists.freedesktop.org
Date: Sun, 24 Nov 2019 17:05:22 +0000
Message-Id: <20191124170524.1436498-2-chris@chris-wilson.co.uk>
X-Mailer: git-send-email 2.24.0
In-Reply-To: <20191124170524.1436498-1-chris@chris-wilson.co.uk>
References: <20191124170524.1436498-1-chris@chris-wilson.co.uk>
MIME-Version: 1.0
Subject: [Intel-gfx] [CI 2/4] drm/i915: Serialise with engine-pm around
 requests on the kernel_context
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

QXMgdGhlIGVuZ2luZS0+a2VybmVsX2NvbnRleHQgaXMgdXNlZCB3aXRoaW4gdGhlIGVuZ2luZS1w
bSBiYXJyaWVyLCB3ZQpoYXZlIHRvIGJlIGNhcmVmdWwgd2hlbiBlbWl0dGluZyByZXF1ZXN0cyBv
dXRzaWRlIG9mIHRoZSBiYXJyaWVyLCBhcyB0aGUKc3RyaWN0IHRpbWVsaW5lIGxvY2tpbmcgcnVs
ZXMgZG8gbm90IGFwcGx5LiBJbnN0ZWFkLCB3ZSBtdXN0IGVuc3VyZSB0aGUKZW5naW5lX3Bhcmso
KSBjYW5ub3QgYmUgZW50ZXJlZCBhcyB3ZSBidWlsZCB0aGUgcmVxdWVzdCwgd2hpY2ggaXMKc2lt
cGxlc3QgYnkgdGFraW5nIGFuIGV4cGxpY2l0IGVuZ2luZS1wbSB3YWtlcmVmIGFyb3VuZCB0aGUg
cmVxdWVzdApjb25zdHJ1Y3Rpb24uCgpTaWduZWQtb2ZmLWJ5OiBDaHJpcyBXaWxzb24gPGNocmlz
QGNocmlzLXdpbHNvbi5jby51az4KLS0tCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9n
ZW1fY29udGV4dC5jICAgfCAgMyArLQogLi4uL2k5MTUvZ2VtL3NlbGZ0ZXN0cy9pOTE1X2dlbV9j
bGllbnRfYmx0LmMgIHwgIDIgKwogLi4uL2k5MTUvZ2VtL3NlbGZ0ZXN0cy9pOTE1X2dlbV9jb2hl
cmVuY3kuYyAgIHwgIDMgKy0KIC4uLi9kcm0vaTkxNS9nZW0vc2VsZnRlc3RzL2k5MTVfZ2VtX2Nv
bnRleHQuYyB8ICA3ICsrKy0KIC4uLi9kcm0vaTkxNS9nZW0vc2VsZnRlc3RzL2k5MTVfZ2VtX21t
YW4uYyAgICB8ICAzICstCiAuLi4vaTkxNS9nZW0vc2VsZnRlc3RzL2k5MTVfZ2VtX29iamVjdF9i
bHQuYyAgfCAxOCArKysrKystLS0KIC4uLi9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfZW5naW5lX2hl
YXJ0YmVhdC5jICB8IDE0ICsrKysrLS0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2Vu
Z2luZV9wbS5oICAgICB8IDIxICsrKysrKysrKysKIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2lu
dGVsX3dvcmthcm91bmRzLmMgICB8ICAzICsrCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9zZWxm
dGVzdF9jb250ZXh0LmMgICAgfCAgMiArLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qvc2VsZnRl
c3RfZW5naW5lX2NzLmMgIHwgMTIgKysrKysrCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9zZWxm
dGVzdF9scmMuYyAgICAgICAgfCAgNiArLS0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L3NlbGZ0
ZXN0X21vY3MuYyAgICAgICB8ICAyICsKIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L3NlbGZ0ZXN0
X3RpbWVsaW5lLmMgICB8ICA2ICstLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9wZXJmLmMg
ICAgICAgICAgICAgIHwgIDQgKy0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L3NlbGZ0ZXN0cy9pOTE1
X2FjdGl2ZS5jICB8ICAyICstCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMvaTkxNV9w
ZXJmLmMgICAgfCAgMiArLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvc2VsZnRlc3RzL2k5MTVfcmVx
dWVzdC5jIHwgNDAgKysrKysrKysrKysrKystLS0tLQogLi4uL2RybS9pOTE1L3NlbGZ0ZXN0cy9p
bnRlbF9tZW1vcnlfcmVnaW9uLmMgIHwgIDIgKwogMTkgZmlsZXMgY2hhbmdlZCwgMTE5IGluc2Vy
dGlvbnMoKyksIDMzIGRlbGV0aW9ucygtKQoKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9p
OTE1L2dlbS9pOTE1X2dlbV9jb250ZXh0LmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkx
NV9nZW1fY29udGV4dC5jCmluZGV4IDZmMWU2MTgxZjY3YS4uYzk0YWM4Mzg0MDFhIDEwMDY0NAot
LS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fY29udGV4dC5jCisrKyBiL2Ry
aXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9jb250ZXh0LmMKQEAgLTcwLDYgKzcwLDcg
QEAKICNpbmNsdWRlIDxkcm0vaTkxNV9kcm0uaD4KIAogI2luY2x1ZGUgImd0L2ludGVsX2VuZ2lu
ZV9oZWFydGJlYXQuaCIKKyNpbmNsdWRlICJndC9pbnRlbF9lbmdpbmVfcG0uaCIKICNpbmNsdWRl
ICJndC9pbnRlbF9lbmdpbmVfdXNlci5oIgogI2luY2x1ZGUgImd0L2ludGVsX2xyY19yZWcuaCIK
ICNpbmNsdWRlICJndC9pbnRlbF9yaW5nLmgiCkBAIC0xMjY1LDcgKzEyNjYsNyBAQCBnZW44X21v
ZGlmeV9ycGNzKHN0cnVjdCBpbnRlbF9jb250ZXh0ICpjZSwgc3RydWN0IGludGVsX3NzZXUgc3Nl
dSkKIAlpZiAoIWludGVsX2NvbnRleHRfaXNfcGlubmVkKGNlKSkKIAkJcmV0dXJuIDA7CiAKLQly
cSA9IGk5MTVfcmVxdWVzdF9jcmVhdGUoY2UtPmVuZ2luZS0+a2VybmVsX2NvbnRleHQpOworCXJx
ID0gaW50ZWxfZW5naW5lX2NyZWF0ZV9rZXJuZWxfcmVxdWVzdChjZS0+ZW5naW5lKTsKIAlpZiAo
SVNfRVJSKHJxKSkKIAkJcmV0dXJuIFBUUl9FUlIocnEpOwogCmRpZmYgLS1naXQgYS9kcml2ZXJz
L2dwdS9kcm0vaTkxNS9nZW0vc2VsZnRlc3RzL2k5MTVfZ2VtX2NsaWVudF9ibHQuYyBiL2RyaXZl
cnMvZ3B1L2RybS9pOTE1L2dlbS9zZWxmdGVzdHMvaTkxNV9nZW1fY2xpZW50X2JsdC5jCmluZGV4
IGRhOGVkZWU0ZmUwYS4uYjk3MmJlMTY1ZTg1IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0v
aTkxNS9nZW0vc2VsZnRlc3RzL2k5MTVfZ2VtX2NsaWVudF9ibHQuYworKysgYi9kcml2ZXJzL2dw
dS9kcm0vaTkxNS9nZW0vc2VsZnRlc3RzL2k5MTVfZ2VtX2NsaWVudF9ibHQuYwpAQCAtMjQsNiAr
MjQsNyBAQCBzdGF0aWMgaW50IF9faWd0X2NsaWVudF9maWxsKHN0cnVjdCBpbnRlbF9lbmdpbmVf
Y3MgKmVuZ2luZSkKIAogCXByYW5kb21fc2VlZF9zdGF0ZSgmcHJuZywgaTkxNV9zZWxmdGVzdC5y
YW5kb21fc2VlZCk7CiAKKwlpbnRlbF9lbmdpbmVfcG1fZ2V0KGVuZ2luZSk7CiAJZG8gewogCQlj
b25zdCB1MzIgbWF4X2Jsb2NrX3NpemUgPSBTMTZfTUFYICogUEFHRV9TSVpFOwogCQl1MzIgc3og
PSBtaW5fdCh1NjQsIGNlLT52bS0+dG90YWwgPj4gNCwgcHJhbmRvbV91MzJfc3RhdGUoJnBybmcp
KTsKQEAgLTk5LDYgKzEwMCw3IEBAIHN0YXRpYyBpbnQgX19pZ3RfY2xpZW50X2ZpbGwoc3RydWN0
IGludGVsX2VuZ2luZV9jcyAqZW5naW5lKQogZXJyX2ZsdXNoOgogCWlmIChlcnIgPT0gLUVOT01F
TSkKIAkJZXJyID0gMDsKKwlpbnRlbF9lbmdpbmVfcG1fcHV0KGVuZ2luZSk7CiAKIAlyZXR1cm4g
ZXJyOwogfQpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL3NlbGZ0ZXN0cy9p
OTE1X2dlbV9jb2hlcmVuY3kuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9zZWxmdGVzdHMv
aTkxNV9nZW1fY29oZXJlbmN5LmMKaW5kZXggMmIyOWY2YjRlMWRkLi45ZDNjZDFhZjYxZjYgMTAw
NjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9zZWxmdGVzdHMvaTkxNV9nZW1fY29o
ZXJlbmN5LmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL3NlbGZ0ZXN0cy9pOTE1X2dl
bV9jb2hlcmVuY3kuYwpAQCAtNiw2ICs2LDcgQEAKIAogI2luY2x1ZGUgPGxpbnV4L3ByaW1lX251
bWJlcnMuaD4KIAorI2luY2x1ZGUgImd0L2ludGVsX2VuZ2luZV9wbS5oIgogI2luY2x1ZGUgImd0
L2ludGVsX2d0LmgiCiAjaW5jbHVkZSAiZ3QvaW50ZWxfZ3RfcG0uaCIKICNpbmNsdWRlICJndC9p
bnRlbF9yaW5nLmgiCkBAIC0yMDAsNyArMjAxLDcgQEAgc3RhdGljIGludCBncHVfc2V0KHN0cnVj
dCBjb250ZXh0ICpjdHgsIHVuc2lnbmVkIGxvbmcgb2Zmc2V0LCB1MzIgdikKIAlpZiAoSVNfRVJS
KHZtYSkpCiAJCXJldHVybiBQVFJfRVJSKHZtYSk7CiAKLQlycSA9IGk5MTVfcmVxdWVzdF9jcmVh
dGUoY3R4LT5lbmdpbmUtPmtlcm5lbF9jb250ZXh0KTsKKwlycSA9IGludGVsX2VuZ2luZV9jcmVh
dGVfa2VybmVsX3JlcXVlc3QoY3R4LT5lbmdpbmUpOwogCWlmIChJU19FUlIocnEpKSB7CiAJCWk5
MTVfdm1hX3VucGluKHZtYSk7CiAJCXJldHVybiBQVFJfRVJSKHJxKTsKZGlmZiAtLWdpdCBhL2Ry
aXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9zZWxmdGVzdHMvaTkxNV9nZW1fY29udGV4dC5jIGIvZHJp
dmVycy9ncHUvZHJtL2k5MTUvZ2VtL3NlbGZ0ZXN0cy9pOTE1X2dlbV9jb250ZXh0LmMKaW5kZXgg
ZTFkOGNjZDExNDA5Li4yZWE0NzkwZjM3MjEgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9p
OTE1L2dlbS9zZWxmdGVzdHMvaTkxNV9nZW1fY29udGV4dC5jCisrKyBiL2RyaXZlcnMvZ3B1L2Ry
bS9pOTE1L2dlbS9zZWxmdGVzdHMvaTkxNV9nZW1fY29udGV4dC5jCkBAIC03LDYgKzcsNyBAQAog
I2luY2x1ZGUgPGxpbnV4L3ByaW1lX251bWJlcnMuaD4KIAogI2luY2x1ZGUgImdlbS9pOTE1X2dl
bV9wbS5oIgorI2luY2x1ZGUgImd0L2ludGVsX2VuZ2luZV9wbS5oIgogI2luY2x1ZGUgImd0L2lu
dGVsX2d0LmgiCiAjaW5jbHVkZSAiZ3QvaW50ZWxfZ3RfcmVxdWVzdHMuaCIKICNpbmNsdWRlICJn
dC9pbnRlbF9yZXNldC5oIgpAQCAtMTE5MCw5ICsxMTkxLDExIEBAIF9fc3NldV90ZXN0KGNvbnN0
IGNoYXIgKm5hbWUsCiAJc3RydWN0IGlndF9zcGlubmVyICpzcGluID0gTlVMTDsKIAlpbnQgcmV0
OwogCisJaW50ZWxfZW5naW5lX3BtX2dldChjZS0+ZW5naW5lKTsKKwogCXJldCA9IF9fc3NldV9w
cmVwYXJlKG5hbWUsIGZsYWdzLCBjZSwgJnNwaW4pOwogCWlmIChyZXQpCi0JCXJldHVybiByZXQ7
CisJCWdvdG8gb3V0X3BtOwogCiAJcmV0ID0gaW50ZWxfY29udGV4dF9yZWNvbmZpZ3VyZV9zc2V1
KGNlLCBzc2V1KTsKIAlpZiAocmV0KQpAQCAtMTIwNyw2ICsxMjEwLDggQEAgX19zc2V1X3Rlc3Qo
Y29uc3QgY2hhciAqbmFtZSwKIAkJaWd0X3NwaW5uZXJfZmluaShzcGluKTsKIAkJa2ZyZWUoc3Bp
bik7CiAJfQorb3V0X3BtOgorCWludGVsX2VuZ2luZV9wbV9wdXQoY2UtPmVuZ2luZSk7CiAJcmV0
dXJuIHJldDsKIH0KIApkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL3NlbGZ0
ZXN0cy9pOTE1X2dlbV9tbWFuLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vc2VsZnRlc3Rz
L2k5MTVfZ2VtX21tYW4uYwppbmRleCA5ZjFhNjkwMjdhMDQuLjZjZTkxNjdmOGM5ZiAxMDA2NDQK
LS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL3NlbGZ0ZXN0cy9pOTE1X2dlbV9tbWFuLmMK
KysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL3NlbGZ0ZXN0cy9pOTE1X2dlbV9tbWFuLmMK
QEAgLTYsNiArNiw3IEBACiAKICNpbmNsdWRlIDxsaW51eC9wcmltZV9udW1iZXJzLmg+CiAKKyNp
bmNsdWRlICJndC9pbnRlbF9lbmdpbmVfcG0uaCIKICNpbmNsdWRlICJndC9pbnRlbF9ndC5oIgog
I2luY2x1ZGUgImd0L2ludGVsX2d0X3BtLmgiCiAjaW5jbHVkZSAiaHVnZV9nZW1fb2JqZWN0Lmgi
CkBAIC01MzYsNyArNTM3LDcgQEAgc3RhdGljIGludCBtYWtlX29ial9idXN5KHN0cnVjdCBkcm1f
aTkxNV9nZW1fb2JqZWN0ICpvYmopCiAJCWlmIChlcnIpCiAJCQlyZXR1cm4gZXJyOwogCi0JCXJx
ID0gaTkxNV9yZXF1ZXN0X2NyZWF0ZShlbmdpbmUtPmtlcm5lbF9jb250ZXh0KTsKKwkJcnEgPSBp
bnRlbF9lbmdpbmVfY3JlYXRlX2tlcm5lbF9yZXF1ZXN0KGVuZ2luZSk7CiAJCWlmIChJU19FUlIo
cnEpKSB7CiAJCQlpOTE1X3ZtYV91bnBpbih2bWEpOwogCQkJcmV0dXJuIFBUUl9FUlIocnEpOwpk
aWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL3NlbGZ0ZXN0cy9pOTE1X2dlbV9v
YmplY3RfYmx0LmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vc2VsZnRlc3RzL2k5MTVfZ2Vt
X29iamVjdF9ibHQuYwppbmRleCA2NzVjMWEyMGEyZjEuLjYyMDc3ZmU0NjcxNSAxMDA2NDQKLS0t
IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL3NlbGZ0ZXN0cy9pOTE1X2dlbV9vYmplY3RfYmx0
LmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL3NlbGZ0ZXN0cy9pOTE1X2dlbV9vYmpl
Y3RfYmx0LmMKQEAgLTQxLDYgKzQxLDcgQEAgc3RhdGljIGludCBfX3BlcmZfZmlsbF9ibHQoc3Ry
dWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iaikKIAkJaWYgKCFlbmdpbmUpCiAJCQlyZXR1cm4g
MDsKIAorCQlpbnRlbF9lbmdpbmVfcG1fZ2V0KGVuZ2luZSk7CiAJCWZvciAocGFzcyA9IDA7IHBh
c3MgPCBBUlJBWV9TSVpFKHQpOyBwYXNzKyspIHsKIAkJCXN0cnVjdCBpbnRlbF9jb250ZXh0ICpj
ZSA9IGVuZ2luZS0+a2VybmVsX2NvbnRleHQ7CiAJCQlrdGltZV90IHQwLCB0MTsKQEAgLTQ5LDE3
ICs1MCwyMCBAQCBzdGF0aWMgaW50IF9fcGVyZl9maWxsX2JsdChzdHJ1Y3QgZHJtX2k5MTVfZ2Vt
X29iamVjdCAqb2JqKQogCiAJCQllcnIgPSBpOTE1X2dlbV9vYmplY3RfZmlsbF9ibHQob2JqLCBj
ZSwgMCk7CiAJCQlpZiAoZXJyKQotCQkJCXJldHVybiBlcnI7CisJCQkJYnJlYWs7CiAKIAkJCWVy
ciA9IGk5MTVfZ2VtX29iamVjdF93YWl0KG9iaiwKIAkJCQkJCSAgIEk5MTVfV0FJVF9BTEwsCiAJ
CQkJCQkgICBNQVhfU0NIRURVTEVfVElNRU9VVCk7CiAJCQlpZiAoZXJyKQotCQkJCXJldHVybiBl
cnI7CisJCQkJYnJlYWs7CiAKIAkJCXQxID0ga3RpbWVfZ2V0KCk7CiAJCQl0W3Bhc3NdID0ga3Rp
bWVfc3ViKHQxLCB0MCk7CiAJCX0KKwkJaW50ZWxfZW5naW5lX3BtX3B1dChlbmdpbmUpOworCQlp
ZiAoZXJyKQorCQkJcmV0dXJuIGVycjsKIAogCQlzb3J0KHQsIEFSUkFZX1NJWkUodCksIHNpemVv
ZigqdCksIHdyYXBfa3RpbWVfY29tcGFyZSwgTlVMTCk7CiAJCXByX2luZm8oIiVzOiBibHQgJXpk
IEtpQiBmaWxsOiAlbGxkIE1pQi9zXG4iLApAQCAtMTA5LDYgKzExMyw3IEBAIHN0YXRpYyBpbnQg
X19wZXJmX2NvcHlfYmx0KHN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpzcmMsCiAJCXN0cnVj
dCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZTsKIAkJa3RpbWVfdCB0WzVdOwogCQlpbnQgcGFzczsK
KwkJaW50IGVyciA9IDA7CiAKIAkJZW5naW5lID0gaW50ZWxfZW5naW5lX2xvb2t1cF91c2VyKGk5
MTUsCiAJCQkJCQkgIEk5MTVfRU5HSU5FX0NMQVNTX0NPUFksCkBAIC0xMTYsMjYgKzEyMSwyOSBA
QCBzdGF0aWMgaW50IF9fcGVyZl9jb3B5X2JsdChzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAq
c3JjLAogCQlpZiAoIWVuZ2luZSkKIAkJCXJldHVybiAwOwogCisJCWludGVsX2VuZ2luZV9wbV9n
ZXQoZW5naW5lKTsKIAkJZm9yIChwYXNzID0gMDsgcGFzcyA8IEFSUkFZX1NJWkUodCk7IHBhc3Mr
KykgewogCQkJc3RydWN0IGludGVsX2NvbnRleHQgKmNlID0gZW5naW5lLT5rZXJuZWxfY29udGV4
dDsKIAkJCWt0aW1lX3QgdDAsIHQxOwotCQkJaW50IGVycjsKIAogCQkJdDAgPSBrdGltZV9nZXQo
KTsKIAogCQkJZXJyID0gaTkxNV9nZW1fb2JqZWN0X2NvcHlfYmx0KHNyYywgZHN0LCBjZSk7CiAJ
CQlpZiAoZXJyKQotCQkJCXJldHVybiBlcnI7CisJCQkJYnJlYWs7CiAKIAkJCWVyciA9IGk5MTVf
Z2VtX29iamVjdF93YWl0KGRzdCwKIAkJCQkJCSAgIEk5MTVfV0FJVF9BTEwsCiAJCQkJCQkgICBN
QVhfU0NIRURVTEVfVElNRU9VVCk7CiAJCQlpZiAoZXJyKQotCQkJCXJldHVybiBlcnI7CisJCQkJ
YnJlYWs7CiAKIAkJCXQxID0ga3RpbWVfZ2V0KCk7CiAJCQl0W3Bhc3NdID0ga3RpbWVfc3ViKHQx
LCB0MCk7CiAJCX0KKwkJaW50ZWxfZW5naW5lX3BtX3B1dChlbmdpbmUpOworCQlpZiAoZXJyKQor
CQkJcmV0dXJuIGVycjsKIAogCQlzb3J0KHQsIEFSUkFZX1NJWkUodCksIHNpemVvZigqdCksIHdy
YXBfa3RpbWVfY29tcGFyZSwgTlVMTCk7CiAJCXByX2luZm8oIiVzOiBibHQgJXpkIEtpQiBjb3B5
OiAlbGxkIE1pQi9zXG4iLApkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50
ZWxfZW5naW5lX2hlYXJ0YmVhdC5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfZW5n
aW5lX2hlYXJ0YmVhdC5jCmluZGV4IGM5MWZkNGU0YWYyOS4uNzQyNjI4ZTQwMjAxIDEwMDY0NAot
LS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9lbmdpbmVfaGVhcnRiZWF0LmMKKysr
IGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfZW5naW5lX2hlYXJ0YmVhdC5jCkBAIC0y
MTUsMTggKzIxNSwyNiBAQCBpbnQgaW50ZWxfZW5naW5lX3B1bHNlKHN0cnVjdCBpbnRlbF9lbmdp
bmVfY3MgKmVuZ2luZSkKIGludCBpbnRlbF9lbmdpbmVfZmx1c2hfYmFycmllcnMoc3RydWN0IGlu
dGVsX2VuZ2luZV9jcyAqZW5naW5lKQogewogCXN0cnVjdCBpOTE1X3JlcXVlc3QgKnJxOworCWlu
dCBlcnIgPSAwOwogCiAJaWYgKGxsaXN0X2VtcHR5KCZlbmdpbmUtPmJhcnJpZXJfdGFza3MpKQog
CQlyZXR1cm4gMDsKIAorCWlmICghaW50ZWxfZW5naW5lX3BtX2dldF9pZl9hd2FrZShlbmdpbmUp
KQorCQlyZXR1cm4gMDsKKwogCXJxID0gaTkxNV9yZXF1ZXN0X2NyZWF0ZShlbmdpbmUtPmtlcm5l
bF9jb250ZXh0KTsKLQlpZiAoSVNfRVJSKHJxKSkKLQkJcmV0dXJuIFBUUl9FUlIocnEpOworCWlm
IChJU19FUlIocnEpKSB7CisJCWVyciA9IFBUUl9FUlIocnEpOworCQlnb3RvIG91dF9ycG07CisJ
fQogCiAJaWRsZV9wdWxzZShlbmdpbmUsIHJxKTsKIAlpOTE1X3JlcXVlc3RfYWRkKHJxKTsKIAot
CXJldHVybiAwOworb3V0X3JwbToKKwlpbnRlbF9lbmdpbmVfcG1fcHV0KGVuZ2luZSk7CisJcmV0
dXJuIGVycjsKIH0KIAogI2lmIElTX0VOQUJMRUQoQ09ORklHX0RSTV9JOTE1X1NFTEZURVNUKQpk
aWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfZW5naW5lX3BtLmggYi9k
cml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9lbmdpbmVfcG0uaAppbmRleCAyNGUyMDM0NGRj
MjIuLmU1MmMyYjBjYjI0NSAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50
ZWxfZW5naW5lX3BtLmgKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfZW5naW5l
X3BtLmgKQEAgLTcsNiArNyw3IEBACiAjaWZuZGVmIElOVEVMX0VOR0lORV9QTV9ICiAjZGVmaW5l
IElOVEVMX0VOR0lORV9QTV9ICiAKKyNpbmNsdWRlICJpOTE1X3JlcXVlc3QuaCIKICNpbmNsdWRl
ICJpbnRlbF9lbmdpbmVfdHlwZXMuaCIKICNpbmNsdWRlICJpbnRlbF93YWtlcmVmLmgiCiAKQEAg
LTQxLDYgKzQyLDI2IEBAIHN0YXRpYyBpbmxpbmUgdm9pZCBpbnRlbF9lbmdpbmVfcG1fZmx1c2go
c3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lKQogCWludGVsX3dha2VyZWZfdW5sb2NrX3dh
aXQoJmVuZ2luZS0+d2FrZXJlZik7CiB9CiAKK3N0YXRpYyBpbmxpbmUgc3RydWN0IGk5MTVfcmVx
dWVzdCAqCitpbnRlbF9lbmdpbmVfY3JlYXRlX2tlcm5lbF9yZXF1ZXN0KHN0cnVjdCBpbnRlbF9l
bmdpbmVfY3MgKmVuZ2luZSkKK3sKKwlzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpycTsKKworCS8qCisJ
ICogVGhlIGVuZ2luZS0+a2VybmVsX2NvbnRleHQgaXMgc3BlY2lhbCBhcyBpdCBpcyB1c2VkIGlu
c2lkZQorCSAqIHRoZSBlbmdpbmUtcG0gYmFycmllciAoc2VlIF9fZW5naW5lX3BhcmsoKSksIGNp
cmN1bXZlbnRpbmcKKwkgKiB0aGUgdXN1YWwgbXV0ZXhlcyBhbmQgcmVseWluZyBvbiB0aGUgZW5n
aW5lLXBtIGJhcnJpZXIKKwkgKiBpbnN0ZWFkLiBTbyB3aGVuZXZlciB3ZSB1c2UgdGhlIGVuZ2lu
ZS0+a2VybmVsX2NvbnRleHQKKwkgKiBvdXRzaWRlIG9mIHRoZSBiYXJyaWVyLCB3ZSBtdXN0IG1h
bnVhbGx5IGhhbmRsZSB0aGUKKwkgKiBlbmdpbmUgd2FrZXJlZiB0byBzZXJpYWxpc2Ugd2l0aCB0
aGUgdXNlIGluc2lkZS4KKwkgKi8KKwlpbnRlbF9lbmdpbmVfcG1fZ2V0KGVuZ2luZSk7CisJcnEg
PSBpOTE1X3JlcXVlc3RfY3JlYXRlKGVuZ2luZS0+a2VybmVsX2NvbnRleHQpOworCWludGVsX2Vu
Z2luZV9wbV9wdXQoZW5naW5lKTsKKworCXJldHVybiBycTsKK30KKwogdm9pZCBpbnRlbF9lbmdp
bmVfaW5pdF9fcG0oc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lKTsKIAogI2VuZGlmIC8q
IElOVEVMX0VOR0lORV9QTV9IICovCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9n
dC9pbnRlbF93b3JrYXJvdW5kcy5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfd29y
a2Fyb3VuZHMuYwppbmRleCAyMjZiZDRjY2NiNDguLjBjNmQzOTg5ODBiYSAxMDA2NDQKLS0tIGEv
ZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfd29ya2Fyb3VuZHMuYworKysgYi9kcml2ZXJz
L2dwdS9kcm0vaTkxNS9ndC9pbnRlbF93b3JrYXJvdW5kcy5jCkBAIC02LDYgKzYsNyBAQAogCiAj
aW5jbHVkZSAiaTkxNV9kcnYuaCIKICNpbmNsdWRlICJpbnRlbF9jb250ZXh0LmgiCisjaW5jbHVk
ZSAiaW50ZWxfZW5naW5lX3BtLmgiCiAjaW5jbHVkZSAiaW50ZWxfZ3QuaCIKICNpbmNsdWRlICJp
bnRlbF9yaW5nLmgiCiAjaW5jbHVkZSAiaW50ZWxfd29ya2Fyb3VuZHMuaCIKQEAgLTE1ODIsNyAr
MTU4Myw5IEBAIHN0YXRpYyBpbnQgZW5naW5lX3dhX2xpc3RfdmVyaWZ5KHN0cnVjdCBpbnRlbF9j
b250ZXh0ICpjZSwKIAlpZiAoSVNfRVJSKHZtYSkpCiAJCXJldHVybiBQVFJfRVJSKHZtYSk7CiAK
KwlpbnRlbF9lbmdpbmVfcG1fZ2V0KGNlLT5lbmdpbmUpOwogCXJxID0gaW50ZWxfY29udGV4dF9j
cmVhdGVfcmVxdWVzdChjZSk7CisJaW50ZWxfZW5naW5lX3BtX3B1dChjZS0+ZW5naW5lKTsKIAlp
ZiAoSVNfRVJSKHJxKSkgewogCQllcnIgPSBQVFJfRVJSKHJxKTsKIAkJZ290byBlcnJfdm1hOwpk
aWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qvc2VsZnRlc3RfY29udGV4dC5jIGIv
ZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qvc2VsZnRlc3RfY29udGV4dC5jCmluZGV4IDViYzEyNDU3
NDE3MC4uYWYzNTRjY2RiZjQwIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9z
ZWxmdGVzdF9jb250ZXh0LmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qvc2VsZnRlc3Rf
Y29udGV4dC5jCkBAIC0xMjEsNyArMTIxLDcgQEAgc3RhdGljIGludCBfX2xpdmVfY29udGV4dF9z
aXplKHN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZSwKIAkJZ290byBlcnJfdW5waW47CiAK
IAkvKiBGb3JjZSB0aGUgY29udGV4dCBzd2l0Y2ggKi8KLQlycSA9IGk5MTVfcmVxdWVzdF9jcmVh
dGUoZW5naW5lLT5rZXJuZWxfY29udGV4dCk7CisJcnEgPSBpbnRlbF9lbmdpbmVfY3JlYXRlX2tl
cm5lbF9yZXF1ZXN0KGVuZ2luZSk7CiAJaWYgKElTX0VSUihycSkpIHsKIAkJZXJyID0gUFRSX0VS
UihycSk7CiAJCWdvdG8gZXJyX3VucGluOwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5
MTUvZ3Qvc2VsZnRlc3RfZW5naW5lX2NzLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9zZWxm
dGVzdF9lbmdpbmVfY3MuYwppbmRleCA1OTgxYTdiNzFlYzkuLjc2MWQ4MWY0YmQ2OCAxMDA2NDQK
LS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qvc2VsZnRlc3RfZW5naW5lX2NzLmMKKysrIGIv
ZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qvc2VsZnRlc3RfZW5naW5lX2NzLmMKQEAgLTEzMiwxNCAr
MTMyLDE4IEBAIHN0YXRpYyBpbnQgcGVyZl9taV9iYl9zdGFydCh2b2lkICphcmcpCiAJCXUzMiBj
eWNsZXNbQ09VTlRdOwogCQlpbnQgaTsKIAorCQlpbnRlbF9lbmdpbmVfcG1fZ2V0KGVuZ2luZSk7
CisKIAkJYmF0Y2ggPSBjcmVhdGVfZW1wdHlfYmF0Y2goY2UpOwogCQlpZiAoSVNfRVJSKGJhdGNo
KSkgewogCQkJZXJyID0gUFRSX0VSUihiYXRjaCk7CisJCQlpbnRlbF9lbmdpbmVfcG1fcHV0KGVu
Z2luZSk7CiAJCQlicmVhazsKIAkJfQogCiAJCWVyciA9IGk5MTVfdm1hX3N5bmMoYmF0Y2gpOwog
CQlpZiAoZXJyKSB7CisJCQlpbnRlbF9lbmdpbmVfcG1fcHV0KGVuZ2luZSk7CiAJCQlpOTE1X3Zt
YV9wdXQoYmF0Y2gpOwogCQkJYnJlYWs7CiAJCX0KQEAgLTE4MCw2ICsxODQsNyBAQCBzdGF0aWMg
aW50IHBlcmZfbWlfYmJfc3RhcnQodm9pZCAqYXJnKQogCQkJY3ljbGVzW2ldID0gcnEtPmh3c3Bf
c2Vxbm9bM10gLSBycS0+aHdzcF9zZXFub1syXTsKIAkJfQogCQlpOTE1X3ZtYV9wdXQoYmF0Y2gp
OworCQlpbnRlbF9lbmdpbmVfcG1fcHV0KGVuZ2luZSk7CiAJCWlmIChlcnIpCiAJCQlicmVhazsK
IApAQCAtMjUxLDE1ICsyNTYsMTkgQEAgc3RhdGljIGludCBwZXJmX21pX25vb3Aodm9pZCAqYXJn
KQogCQl1MzIgY3ljbGVzW0NPVU5UXTsKIAkJaW50IGk7CiAKKwkJaW50ZWxfZW5naW5lX3BtX2dl
dChlbmdpbmUpOworCiAJCWJhc2UgPSBjcmVhdGVfZW1wdHlfYmF0Y2goY2UpOwogCQlpZiAoSVNf
RVJSKGJhc2UpKSB7CiAJCQllcnIgPSBQVFJfRVJSKGJhc2UpOworCQkJaW50ZWxfZW5naW5lX3Bt
X3B1dChlbmdpbmUpOwogCQkJYnJlYWs7CiAJCX0KIAogCQllcnIgPSBpOTE1X3ZtYV9zeW5jKGJh
c2UpOwogCQlpZiAoZXJyKSB7CiAJCQlpOTE1X3ZtYV9wdXQoYmFzZSk7CisJCQlpbnRlbF9lbmdp
bmVfcG1fcHV0KGVuZ2luZSk7CiAJCQlicmVhazsKIAkJfQogCkBAIC0yNjcsNiArMjc2LDcgQEAg
c3RhdGljIGludCBwZXJmX21pX25vb3Aodm9pZCAqYXJnKQogCQlpZiAoSVNfRVJSKG5vcCkpIHsK
IAkJCWVyciA9IFBUUl9FUlIobm9wKTsKIAkJCWk5MTVfdm1hX3B1dChiYXNlKTsKKwkJCWludGVs
X2VuZ2luZV9wbV9wdXQoZW5naW5lKTsKIAkJCWJyZWFrOwogCQl9CiAKQEAgLTI3NCw2ICsyODQs
NyBAQCBzdGF0aWMgaW50IHBlcmZfbWlfbm9vcCh2b2lkICphcmcpCiAJCWlmIChlcnIpIHsKIAkJ
CWk5MTVfdm1hX3B1dChub3ApOwogCQkJaTkxNV92bWFfcHV0KGJhc2UpOworCQkJaW50ZWxfZW5n
aW5lX3BtX3B1dChlbmdpbmUpOwogCQkJYnJlYWs7CiAJCX0KIApAQCAtMzI3LDYgKzMzOCw3IEBA
IHN0YXRpYyBpbnQgcGVyZl9taV9ub29wKHZvaWQgKmFyZykKIAkJfQogCQlpOTE1X3ZtYV9wdXQo
bm9wKTsKIAkJaTkxNV92bWFfcHV0KGJhc2UpOworCQlpbnRlbF9lbmdpbmVfcG1fcHV0KGVuZ2lu
ZSk7CiAJCWlmIChlcnIpCiAJCQlicmVhazsKIApkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJt
L2k5MTUvZ3Qvc2VsZnRlc3RfbHJjLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9zZWxmdGVz
dF9scmMuYwppbmRleCBmYzE0MmRkNjFkZDEuLmFjOGI5MTE2ZDMwNyAxMDA2NDQKLS0tIGEvZHJp
dmVycy9ncHUvZHJtL2k5MTUvZ3Qvc2VsZnRlc3RfbHJjLmMKKysrIGIvZHJpdmVycy9ncHUvZHJt
L2k5MTUvZ3Qvc2VsZnRlc3RfbHJjLmMKQEAgLTM0OCw3ICszNDgsNyBAQCByZWxlYXNlX3F1ZXVl
KHN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZSwKIAlzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpy
cTsKIAl1MzIgKmNzOwogCi0JcnEgPSBpOTE1X3JlcXVlc3RfY3JlYXRlKGVuZ2luZS0+a2VybmVs
X2NvbnRleHQpOworCXJxID0gaW50ZWxfZW5naW5lX2NyZWF0ZV9rZXJuZWxfcmVxdWVzdChlbmdp
bmUpOwogCWlmIChJU19FUlIocnEpKQogCQlyZXR1cm4gUFRSX0VSUihycSk7CiAKQEAgLTQ5Nyw3
ICs0OTcsNyBAQCBzdGF0aWMgc3RydWN0IGk5MTVfcmVxdWVzdCAqbm9wX3JlcXVlc3Qoc3RydWN0
IGludGVsX2VuZ2luZV9jcyAqZW5naW5lKQogewogCXN0cnVjdCBpOTE1X3JlcXVlc3QgKnJxOwog
Ci0JcnEgPSBpOTE1X3JlcXVlc3RfY3JlYXRlKGVuZ2luZS0+a2VybmVsX2NvbnRleHQpOworCXJx
ID0gaW50ZWxfZW5naW5lX2NyZWF0ZV9rZXJuZWxfcmVxdWVzdChlbmdpbmUpOwogCWlmIChJU19F
UlIocnEpKQogCQlyZXR1cm4gcnE7CiAKQEAgLTM2OTgsNyArMzY5OCw3IEBAIHN0YXRpYyBpbnQg
Z3ByX21ha2VfZGlydHkoc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lKQogCXUzMiAqY3M7
CiAJaW50IG47CiAKLQlycSA9IGk5MTVfcmVxdWVzdF9jcmVhdGUoZW5naW5lLT5rZXJuZWxfY29u
dGV4dCk7CisJcnEgPSBpbnRlbF9lbmdpbmVfY3JlYXRlX2tlcm5lbF9yZXF1ZXN0KGVuZ2luZSk7
CiAJaWYgKElTX0VSUihycSkpCiAJCXJldHVybiBQVFJfRVJSKHJxKTsKIApkaWZmIC0tZ2l0IGEv
ZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qvc2VsZnRlc3RfbW9jcy5jIGIvZHJpdmVycy9ncHUvZHJt
L2k5MTUvZ3Qvc2VsZnRlc3RfbW9jcy5jCmluZGV4IGEzNGQ0ZmI1MmZhMS4uZGUwMTBmNTI3NzU3
IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9zZWxmdGVzdF9tb2NzLmMKKysr
IGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qvc2VsZnRlc3RfbW9jcy5jCkBAIC0yNjEsNyArMjYx
LDkgQEAgc3RhdGljIGludCBsaXZlX21vY3Nfa2VybmVsKHZvaWQgKmFyZykKIAkJcmV0dXJuIGVy
cjsKIAogCWZvcl9lYWNoX2VuZ2luZShlbmdpbmUsIGd0LCBpZCkgeworCQlpbnRlbF9lbmdpbmVf
cG1fZ2V0KGVuZ2luZSk7CiAJCWVyciA9IGNoZWNrX21vY3NfZW5naW5lKCZtb2NzLCBlbmdpbmUt
Pmtlcm5lbF9jb250ZXh0KTsKKwkJaW50ZWxfZW5naW5lX3BtX3B1dChlbmdpbmUpOwogCQlpZiAo
ZXJyKQogCQkJYnJlYWs7CiAJfQpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qv
c2VsZnRlc3RfdGltZWxpbmUuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L3NlbGZ0ZXN0X3Rp
bWVsaW5lLmMKaW5kZXggZjA0YTU5ZmU1ZDJjLi5lMmQ3OGNjMjJmYjQgMTAwNjQ0Ci0tLSBhL2Ry
aXZlcnMvZ3B1L2RybS9pOTE1L2d0L3NlbGZ0ZXN0X3RpbWVsaW5lLmMKKysrIGIvZHJpdmVycy9n
cHUvZHJtL2k5MTUvZ3Qvc2VsZnRlc3RfdGltZWxpbmUuYwpAQCAtNDU4LDcgKzQ1OCw3IEBAIHRs
X3dyaXRlKHN0cnVjdCBpbnRlbF90aW1lbGluZSAqdGwsIHN0cnVjdCBpbnRlbF9lbmdpbmVfY3Mg
KmVuZ2luZSwgdTMyIHZhbHVlKQogCQlnb3RvIG91dDsKIAl9CiAKLQlycSA9IGk5MTVfcmVxdWVz
dF9jcmVhdGUoZW5naW5lLT5rZXJuZWxfY29udGV4dCk7CisJcnEgPSBpbnRlbF9lbmdpbmVfY3Jl
YXRlX2tlcm5lbF9yZXF1ZXN0KGVuZ2luZSk7CiAJaWYgKElTX0VSUihycSkpCiAJCWdvdG8gb3V0
X3VucGluOwogCkBAIC02NzUsOSArNjc1LDcgQEAgc3RhdGljIGludCBsaXZlX2h3c3Bfd3JhcCh2
b2lkICphcmcpCiAJCWlmICghaW50ZWxfZW5naW5lX2Nhbl9zdG9yZV9kd29yZChlbmdpbmUpKQog
CQkJY29udGludWU7CiAKLQkJaW50ZWxfZW5naW5lX3BtX2dldChlbmdpbmUpOwotCQlycSA9IGk5
MTVfcmVxdWVzdF9jcmVhdGUoZW5naW5lLT5rZXJuZWxfY29udGV4dCk7Ci0JCWludGVsX2VuZ2lu
ZV9wbV9wdXQoZW5naW5lKTsKKwkJcnEgPSBpbnRlbF9lbmdpbmVfY3JlYXRlX2tlcm5lbF9yZXF1
ZXN0KGVuZ2luZSk7CiAJCWlmIChJU19FUlIocnEpKSB7CiAJCQllcnIgPSBQVFJfRVJSKHJxKTsK
IAkJCWdvdG8gb3V0OwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9wZXJm
LmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3BlcmYuYwppbmRleCA2MDhlNmMzZjNjMWEu
LmI0NjcxNWI1NzU3NiAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9wZXJm
LmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9wZXJmLmMKQEAgLTE5NjgsNyArMTk2
OCw5IEBAIHN0YXRpYyBpbnQgZW1pdF9vYV9jb25maWcoc3RydWN0IGk5MTVfcGVyZl9zdHJlYW0g
KnN0cmVhbSwKIAlpZiAoZXJyKQogCQlnb3RvIGVycl92bWFfcHV0OwogCisJaW50ZWxfZW5naW5l
X3BtX2dldChjZS0+ZW5naW5lKTsKIAlycSA9IGk5MTVfcmVxdWVzdF9jcmVhdGUoY2UpOworCWlu
dGVsX2VuZ2luZV9wbV9wdXQoY2UtPmVuZ2luZSk7CiAJaWYgKElTX0VSUihycSkpIHsKIAkJZXJy
ID0gUFRSX0VSUihycSk7CiAJCWdvdG8gZXJyX3ZtYV91bnBpbjsKQEAgLTIxNjUsNyArMjE2Nyw3
IEBAIHN0YXRpYyBpbnQgZ2VuOF9tb2RpZnlfY29udGV4dChzdHJ1Y3QgaW50ZWxfY29udGV4dCAq
Y2UsCiAKIAlsb2NrZGVwX2Fzc2VydF9oZWxkKCZjZS0+cGluX211dGV4KTsKIAotCXJxID0gaTkx
NV9yZXF1ZXN0X2NyZWF0ZShjZS0+ZW5naW5lLT5rZXJuZWxfY29udGV4dCk7CisJcnEgPSBpbnRl
bF9lbmdpbmVfY3JlYXRlX2tlcm5lbF9yZXF1ZXN0KGNlLT5lbmdpbmUpOwogCWlmIChJU19FUlIo
cnEpKQogCQlyZXR1cm4gUFRSX0VSUihycSk7CiAKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2Ry
bS9pOTE1L3NlbGZ0ZXN0cy9pOTE1X2FjdGl2ZS5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvc2Vs
ZnRlc3RzL2k5MTVfYWN0aXZlLmMKaW5kZXggNjAyOTBmNzg3NTBkLi42YzFkYjNkZWQ0NDYgMTAw
NjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L3NlbGZ0ZXN0cy9pOTE1X2FjdGl2ZS5jCisr
KyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L3NlbGZ0ZXN0cy9pOTE1X2FjdGl2ZS5jCkBAIC05OSw3
ICs5OSw3IEBAIF9fbGl2ZV9hY3RpdmVfc2V0dXAoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5
MTUpCiAJZm9yX2VhY2hfdWFiaV9lbmdpbmUoZW5naW5lLCBpOTE1KSB7CiAJCXN0cnVjdCBpOTE1
X3JlcXVlc3QgKnJxOwogCi0JCXJxID0gaTkxNV9yZXF1ZXN0X2NyZWF0ZShlbmdpbmUtPmtlcm5l
bF9jb250ZXh0KTsKKwkJcnEgPSBpbnRlbF9lbmdpbmVfY3JlYXRlX2tlcm5lbF9yZXF1ZXN0KGVu
Z2luZSk7CiAJCWlmIChJU19FUlIocnEpKSB7CiAJCQllcnIgPSBQVFJfRVJSKHJxKTsKIAkJCWJy
ZWFrOwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvc2VsZnRlc3RzL2k5MTVfcGVy
Zi5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvc2VsZnRlc3RzL2k5MTVfcGVyZi5jCmluZGV4IGFh
YmQwN2Y2N2U0OS4uZDFhMTU2OGM0N2JhIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkx
NS9zZWxmdGVzdHMvaTkxNV9wZXJmLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvc2VsZnRl
c3RzL2k5MTVfcGVyZi5jCkBAIC0xMzIsNyArMTMyLDcgQEAgc3RhdGljIGludCBsaXZlX25vYV9k
ZWxheSh2b2lkICphcmcpCiAJZm9yIChpID0gMDsgaSA8IDQ7IGkrKykKIAkJaW50ZWxfd3JpdGVf
c3RhdHVzX3BhZ2Uoc3RyZWFtLT5lbmdpbmUsIDB4MTAwICsgaSwgMCk7CiAKLQlycSA9IGk5MTVf
cmVxdWVzdF9jcmVhdGUoc3RyZWFtLT5lbmdpbmUtPmtlcm5lbF9jb250ZXh0KTsKKwlycSA9IGlu
dGVsX2VuZ2luZV9jcmVhdGVfa2VybmVsX3JlcXVlc3Qoc3RyZWFtLT5lbmdpbmUpOwogCWlmIChJ
U19FUlIocnEpKSB7CiAJCWVyciA9IFBUUl9FUlIocnEpOwogCQlnb3RvIG91dDsKZGlmZiAtLWdp
dCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L3NlbGZ0ZXN0cy9pOTE1X3JlcXVlc3QuYyBiL2RyaXZl
cnMvZ3B1L2RybS9pOTE1L3NlbGZ0ZXN0cy9pOTE1X3JlcXVlc3QuYwppbmRleCBjMTZkMWVmZDJh
ZDQuLjk5Yzk0YjRmNjlmYiAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvc2VsZnRl
c3RzL2k5MTVfcmVxdWVzdC5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L3NlbGZ0ZXN0cy9p
OTE1X3JlcXVlc3QuYwpAQCAtMjcsNiArMjcsNyBAQAogI2luY2x1ZGUgImdlbS9pOTE1X2dlbV9w
bS5oIgogI2luY2x1ZGUgImdlbS9zZWxmdGVzdHMvbW9ja19jb250ZXh0LmgiCiAKKyNpbmNsdWRl
ICJndC9pbnRlbF9lbmdpbmVfcG0uaCIKICNpbmNsdWRlICJndC9pbnRlbF9ndC5oIgogCiAjaW5j
bHVkZSAiaTkxNV9yYW5kb20uaCIKQEAgLTU0MSw2ICs1NDIsNyBAQCBzdGF0aWMgaW50IGxpdmVf
bm9wX3JlcXVlc3Qodm9pZCAqYXJnKQogCQlpZiAoZXJyKQogCQkJcmV0dXJuIGVycjsKIAorCQlp
bnRlbF9lbmdpbmVfcG1fZ2V0KGVuZ2luZSk7CiAJCWZvcl9lYWNoX3ByaW1lX251bWJlcl9mcm9t
KHByaW1lLCAxLCA4MTkyKSB7CiAJCQlzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpyZXF1ZXN0ID0gTlVM
TDsKIApAQCAtNTc5LDYgKzU4MSw3IEBAIHN0YXRpYyBpbnQgbGl2ZV9ub3BfcmVxdWVzdCh2b2lk
ICphcmcpCiAJCQlpZiAoX19pZ3RfdGltZW91dChlbmRfdGltZSwgTlVMTCkpCiAJCQkJYnJlYWs7
CiAJCX0KKwkJaW50ZWxfZW5naW5lX3BtX3B1dChlbmdpbmUpOwogCiAJCWVyciA9IGlndF9saXZl
X3Rlc3RfZW5kKCZ0KTsKIAkJaWYgKGVycikKQEAgLTY5MywxMCArNjk2LDEzIEBAIHN0YXRpYyBp
bnQgbGl2ZV9lbXB0eV9yZXF1ZXN0KHZvaWQgKmFyZykKIAkJaWYgKGVycikKIAkJCWdvdG8gb3V0
X2JhdGNoOwogCisJCWludGVsX2VuZ2luZV9wbV9nZXQoZW5naW5lKTsKKwogCQkvKiBXYXJtdXAg
LyBwcmVsb2FkICovCiAJCXJlcXVlc3QgPSBlbXB0eV9yZXF1ZXN0KGVuZ2luZSwgYmF0Y2gpOwog
CQlpZiAoSVNfRVJSKHJlcXVlc3QpKSB7CiAJCQllcnIgPSBQVFJfRVJSKHJlcXVlc3QpOworCQkJ
aW50ZWxfZW5naW5lX3BtX3B1dChlbmdpbmUpOwogCQkJZ290byBvdXRfYmF0Y2g7CiAJCX0KIAkJ
aTkxNV9yZXF1ZXN0X3dhaXQocmVxdWVzdCwgMCwgTUFYX1NDSEVEVUxFX1RJTUVPVVQpOwpAQCAt
NzA5LDYgKzcxNSw3IEBAIHN0YXRpYyBpbnQgbGl2ZV9lbXB0eV9yZXF1ZXN0KHZvaWQgKmFyZykK
IAkJCQlyZXF1ZXN0ID0gZW1wdHlfcmVxdWVzdChlbmdpbmUsIGJhdGNoKTsKIAkJCQlpZiAoSVNf
RVJSKHJlcXVlc3QpKSB7CiAJCQkJCWVyciA9IFBUUl9FUlIocmVxdWVzdCk7CisJCQkJCWludGVs
X2VuZ2luZV9wbV9wdXQoZW5naW5lKTsKIAkJCQkJZ290byBvdXRfYmF0Y2g7CiAJCQkJfQogCQkJ
fQpAQCAtNzIyLDYgKzcyOSw3IEBAIHN0YXRpYyBpbnQgbGl2ZV9lbXB0eV9yZXF1ZXN0KHZvaWQg
KmFyZykKIAkJCQlicmVhazsKIAkJfQogCQlpOTE1X3JlcXVlc3RfcHV0KHJlcXVlc3QpOworCQlp
bnRlbF9lbmdpbmVfcG1fcHV0KGVuZ2luZSk7CiAKIAkJZXJyID0gaWd0X2xpdmVfdGVzdF9lbmQo
JnQpOwogCQlpZiAoZXJyKQpAQCAtODQ2LDcgKzg1NCw3IEBAIHN0YXRpYyBpbnQgbGl2ZV9hbGxf
ZW5naW5lcyh2b2lkICphcmcpCiAKIAlpZHggPSAwOwogCWZvcl9lYWNoX3VhYmlfZW5naW5lKGVu
Z2luZSwgaTkxNSkgewotCQlyZXF1ZXN0W2lkeF0gPSBpOTE1X3JlcXVlc3RfY3JlYXRlKGVuZ2lu
ZS0+a2VybmVsX2NvbnRleHQpOworCQlyZXF1ZXN0W2lkeF0gPSBpbnRlbF9lbmdpbmVfY3JlYXRl
X2tlcm5lbF9yZXF1ZXN0KGVuZ2luZSk7CiAJCWlmIChJU19FUlIocmVxdWVzdFtpZHhdKSkgewog
CQkJZXJyID0gUFRSX0VSUihyZXF1ZXN0W2lkeF0pOwogCQkJcHJfZXJyKCIlczogUmVxdWVzdCBh
bGxvY2F0aW9uIGZhaWxlZCB3aXRoIGVycj0lZFxuIiwKQEAgLTk2Myw3ICs5NzEsNyBAQCBzdGF0
aWMgaW50IGxpdmVfc2VxdWVudGlhbF9lbmdpbmVzKHZvaWQgKmFyZykKIAkJCWdvdG8gb3V0X2Zy
ZWU7CiAJCX0KIAotCQlyZXF1ZXN0W2lkeF0gPSBpOTE1X3JlcXVlc3RfY3JlYXRlKGVuZ2luZS0+
a2VybmVsX2NvbnRleHQpOworCQlyZXF1ZXN0W2lkeF0gPSBpbnRlbF9lbmdpbmVfY3JlYXRlX2tl
cm5lbF9yZXF1ZXN0KGVuZ2luZSk7CiAJCWlmIChJU19FUlIocmVxdWVzdFtpZHhdKSkgewogCQkJ
ZXJyID0gUFRSX0VSUihyZXF1ZXN0W2lkeF0pOwogCQkJcHJfZXJyKCIlczogUmVxdWVzdCBhbGxv
Y2F0aW9uIGZhaWxlZCBmb3IgJXMgd2l0aCBlcnI9JWRcbiIsCkBAIC0xMDY4LDE1ICsxMDc2LDE5
IEBAIHN0YXRpYyBpbnQgX19saXZlX3BhcmFsbGVsX2VuZ2luZTEodm9pZCAqYXJnKQogCXN0cnVj
dCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZSA9IGFyZzsKIAlJR1RfVElNRU9VVChlbmRfdGltZSk7
CiAJdW5zaWduZWQgbG9uZyBjb3VudDsKKwlpbnQgZXJyID0gMDsKIAogCWNvdW50ID0gMDsKKwlp
bnRlbF9lbmdpbmVfcG1fZ2V0KGVuZ2luZSk7CiAJZG8gewogCQlzdHJ1Y3QgaTkxNV9yZXF1ZXN0
ICpycTsKLQkJaW50IGVycjsKIAogCQlycSA9IGk5MTVfcmVxdWVzdF9jcmVhdGUoZW5naW5lLT5r
ZXJuZWxfY29udGV4dCk7Ci0JCWlmIChJU19FUlIocnEpKQotCQkJcmV0dXJuIFBUUl9FUlIocnEp
OworCQlpZiAoSVNfRVJSKHJxKSkgeworCQkJZXJyID0gUFRSX0VSUihycSk7CisJCQlpZiAoZXJy
KQorCQkJCWJyZWFrOworCQl9CiAKIAkJaTkxNV9yZXF1ZXN0X2dldChycSk7CiAJCWk5MTVfcmVx
dWVzdF9hZGQocnEpOwpAQCAtMTA4NiwxMyArMTA5OCwxNCBAQCBzdGF0aWMgaW50IF9fbGl2ZV9w
YXJhbGxlbF9lbmdpbmUxKHZvaWQgKmFyZykKIAkJCWVyciA9IC1FVElNRTsKIAkJaTkxNV9yZXF1
ZXN0X3B1dChycSk7CiAJCWlmIChlcnIpCi0JCQlyZXR1cm4gZXJyOworCQkJYnJlYWs7CiAKIAkJ
Y291bnQrKzsKIAl9IHdoaWxlICghX19pZ3RfdGltZW91dChlbmRfdGltZSwgTlVMTCkpOworCWlu
dGVsX2VuZ2luZV9wbV9wdXQoZW5naW5lKTsKIAogCXByX2luZm8oIiVzOiAlbHUgcmVxdWVzdCAr
IHN5bmNcbiIsIGVuZ2luZS0+bmFtZSwgY291bnQpOwotCXJldHVybiAwOworCXJldHVybiBlcnI7
CiB9CiAKIHN0YXRpYyBpbnQgX19saXZlX3BhcmFsbGVsX2VuZ2luZU4odm9pZCAqYXJnKQpAQCAt
MTEwMCwyMSArMTExMywyNiBAQCBzdGF0aWMgaW50IF9fbGl2ZV9wYXJhbGxlbF9lbmdpbmVOKHZv
aWQgKmFyZykKIAlzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmUgPSBhcmc7CiAJSUdUX1RJ
TUVPVVQoZW5kX3RpbWUpOwogCXVuc2lnbmVkIGxvbmcgY291bnQ7CisJaW50IGVyciA9IDA7CiAK
IAljb3VudCA9IDA7CisJaW50ZWxfZW5naW5lX3BtX2dldChlbmdpbmUpOwogCWRvIHsKIAkJc3Ry
dWN0IGk5MTVfcmVxdWVzdCAqcnE7CiAKIAkJcnEgPSBpOTE1X3JlcXVlc3RfY3JlYXRlKGVuZ2lu
ZS0+a2VybmVsX2NvbnRleHQpOwotCQlpZiAoSVNfRVJSKHJxKSkKLQkJCXJldHVybiBQVFJfRVJS
KHJxKTsKKwkJaWYgKElTX0VSUihycSkpIHsKKwkJCWVyciA9IFBUUl9FUlIocnEpOworCQkJYnJl
YWs7CisJCX0KIAogCQlpOTE1X3JlcXVlc3RfYWRkKHJxKTsKIAkJY291bnQrKzsKIAl9IHdoaWxl
ICghX19pZ3RfdGltZW91dChlbmRfdGltZSwgTlVMTCkpOworCWludGVsX2VuZ2luZV9wbV9wdXQo
ZW5naW5lKTsKIAogCXByX2luZm8oIiVzOiAlbHUgcmVxdWVzdHNcbiIsIGVuZ2luZS0+bmFtZSwg
Y291bnQpOwotCXJldHVybiAwOworCXJldHVybiBlcnI7CiB9CiAKIHN0YXRpYyBib29sIHdha2Vf
YWxsKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KQpAQCAtMTE1OCw5ICsxMTc2LDExIEBA
IHN0YXRpYyBpbnQgX19saXZlX3BhcmFsbGVsX3NwaW4odm9pZCAqYXJnKQogCQlyZXR1cm4gLUVO
T01FTTsKIAl9CiAKKwlpbnRlbF9lbmdpbmVfcG1fZ2V0KGVuZ2luZSk7CiAJcnEgPSBpZ3Rfc3Bp
bm5lcl9jcmVhdGVfcmVxdWVzdCgmc3BpbiwKIAkJCQkJZW5naW5lLT5rZXJuZWxfY29udGV4dCwK
IAkJCQkJTUlfTk9PUCk7IC8qIG5vIHByZWVtcHRpb24gKi8KKwlpbnRlbF9lbmdpbmVfcG1fcHV0
KGVuZ2luZSk7CiAJaWYgKElTX0VSUihycSkpIHsKIAkJZXJyID0gUFRSX0VSUihycSk7CiAJCWlm
IChlcnIgPT0gLUVOT0RFVikKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L3NlbGZ0
ZXN0cy9pbnRlbF9tZW1vcnlfcmVnaW9uLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9zZWxmdGVz
dHMvaW50ZWxfbWVtb3J5X3JlZ2lvbi5jCmluZGV4IGI2MDkxNjU2MTQ2Mi4uMDRkMGFhN2IzNDll
IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMvaW50ZWxfbWVtb3J5
X3JlZ2lvbi5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L3NlbGZ0ZXN0cy9pbnRlbF9tZW1v
cnlfcmVnaW9uLmMKQEAgLTUwNiw3ICs1MDYsOSBAQCBzdGF0aWMgaW50IGlndF9sbWVtX3dyaXRl
X2NwdSh2b2lkICphcmcpCiAJfQogCiAJLyogUHV0IHRoZSBwYWdlcyBpbnRvIGEga25vd24gc3Rh
dGUgLS0gZnJvbSB0aGUgZ3B1IGZvciBhZGRlZCBmdW4gKi8KKwlpbnRlbF9lbmdpbmVfcG1fZ2V0
KGVuZ2luZSk7CiAJZXJyID0gaTkxNV9nZW1fb2JqZWN0X2ZpbGxfYmx0KG9iaiwgZW5naW5lLT5r
ZXJuZWxfY29udGV4dCwgMHhkZWFkYmVhZik7CisJaW50ZWxfZW5naW5lX3BtX3B1dChlbmdpbmUp
OwogCWlmIChlcnIpCiAJCWdvdG8gb3V0X3VucGluOwogCi0tIAoyLjI0LjAKCl9fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fCkludGVsLWdmeCBtYWlsaW5nIGxp
c3QKSW50ZWwtZ2Z4QGxpc3RzLmZyZWVkZXNrdG9wLm9yZwpodHRwczovL2xpc3RzLmZyZWVkZXNr
dG9wLm9yZy9tYWlsbWFuL2xpc3RpbmZvL2ludGVsLWdmeA==

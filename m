Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id D5232F3A7E
	for <lists+intel-gfx@lfdr.de>; Thu,  7 Nov 2019 22:25:22 +0100 (CET)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 9C6E86F7CE;
	Thu,  7 Nov 2019 21:25:20 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from mga07.intel.com (mga07.intel.com [134.134.136.100])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 90CCD6F7CE
 for <intel-gfx@lists.freedesktop.org>; Thu,  7 Nov 2019 21:25:19 +0000 (UTC)
X-Amp-Result: SKIPPED(no attachment in message)
X-Amp-File-Uploaded: False
Received: from fmsmga007.fm.intel.com ([10.253.24.52])
 by orsmga105.jf.intel.com with ESMTP/TLS/DHE-RSA-AES256-GCM-SHA384;
 07 Nov 2019 13:25:18 -0800
X-ExtLoop1: 1
X-IronPort-AV: E=Sophos;i="5.68,279,1569308400"; d="scan'208";a="201512256"
Received: from slisovsk-lenovo-ideapad-720s-13ikb.fi.intel.com ([10.237.72.89])
 by fmsmga007.fm.intel.com with ESMTP; 07 Nov 2019 13:25:15 -0800
From: Stanislav Lisovskiy <stanislav.lisovskiy@intel.com>
To: intel-gfx@lists.freedesktop.org
Date: Thu,  7 Nov 2019 23:22:34 +0200
Message-Id: <20191107212234.21815-1-stanislav.lisovskiy@intel.com>
X-Mailer: git-send-email 2.17.1
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH v5] drm/i915: Enable second dbuf slice for ICL
 and TGL
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

QWxzbyBpbXBsZW1lbnRlZCBhbGdvcml0aG0gZm9yIGNob29zaW5nIERCdWYgc2xpY2UgY29uZmln
dXJhdGlvbgpiYXNlZCBvbiBhY3RpdmUgcGlwZXMsIHBpcGUgcmF0aW8gYXMgc3RhdGVkIGluIEJT
cGVjIDEyNzE2LgoKTm93IHBpcGUgYWxsb2NhdGlvbiBzdGlsbCBzdGF5cyBwcm9wb3J0aW9uYWwg
dG8gcGlwZSB3aWR0aCBhcyBiZWZvcmUsCmhvd2V2ZXIgd2l0aGluIGFsbG93ZWQgREJ1ZiBzbGlj
ZSBmb3IgdGhpcyBwYXJ0aWN1bGFyIGNvbmZpZ3VyYXRpb24uCgp2MjogUmVtb3ZlIHVubmVlZGVk
IGNoZWNrIGZyb20gY29tbWl0IGFzIGRkYiBlbmFibGVkIHNsaWNlcyBtaWdodAogICAgbm93IGRp
ZmZlciBmcm9tIGh3IHN0YXRlLgoKdjM6IC0gQWRkZWQgbmV3IGZpZWxkICJzdXBwb3J0ZWRfc2xp
Y2VzIiB0byBkZGIgdG8gc2VwYXJhdGUgbWF4CiAgICAgIHN1cHBvcnRlZCBzbGljZXMgdnMgY3Vy
cmVudGx5IGVuYWJsZWQsIHRvIGF2b2lkIGNvbmZ1c2lvbi4KICAgIC0gUmVtb3ZlZCBvYnNvbGV0
ZSBjb21tZW50cyBhbmQgY29kZSByZWxhdGVkIHRvIERCdWYoTWF0dGhldyBSb3BlcikuCiAgICAt
IFNvbWUgY29kZSBzdHlsZSBhbmQgbG9uZyBsaW5lIHJlbW92YWwoTWF0dGhldyBSb3BlcikuCiAg
ICAtIEFkZGVkIFdBUk5fT04gdG8gbmV3IGRkYiByYW5nZSBvZmZzZXQgY2FsYyBmdW5jdGlvbihN
YXR0aGV3IFJvcGVyKS4KICAgIC0gUmVtb3ZlZCBwbGF0Zm9ybSBzcGVjaWZpYyBjYWxsIHRvIGNh
bGMgcGlwZSByYXRpbyBmcm9tIGRkYgogICAgICBhbGxvY2F0aW9uIGZ1bmN0aW9uIGFuZCBmaXhl
ZCB0aGUgcmV0dXJuIHZhbHVlKE1hdHRoZXcgUm9wZXIpCiAgICAtIFJlZmFjdG9yZWQgREJVRiBz
bGljZSBhbGxvY2F0aW9uIHRhYmxlIHRvIGltcHJvdmUgcmVhZGFiaWxpdHkKICAgIC0gQWRkZWQg
REJVRiBzbGljZSBhbGxvY2F0aW9uIGZvciBUR0wgYXMgd2VsbC4KICAgIC0gSUNMKGhvd2V2ZXIg
bm90IFRHTCkgc2VlbXMgdG8gdm9sdW50YXJpbHkgZW5hYmxlIHNlY29uZCBEQnVmIHNsaWNlCiAg
ICAgIGFmdGVyIHBtIHN1c3BlbmQvcmVzdW1lIGNhdXNpbmcgYSBtaXNtYXRjaCBmYWlsdXJlLCBi
ZWNhdXNlIHdlCiAgICAgIHVwZGF0ZSBEQnVmIHNsaWNlcyBvbmx5IGlmIHdlIGRvIGEgbW9kZXNl
dCwgaG93ZXZlciB0aGlzIGNoZWNrCiAgICAgIGlzIGRvbmUgYWx3YXlzLiBGaXhlZCBpdCB0byBi
ZSBkb25lIG9ubHkgd2hlbiBtb2Rlc2V0IGZvciBJQ0wuCgp2NDogLSBOb3cgZW5hYmxlZCBzbGlj
ZXMgaXMgbm90IGFjdHVhbGx5IGEgbnVtYmVyLCBidXQgYSBiaXRtYXNrLAogICAgICBiZWNhdXNl
IHdlIG1pZ2h0IG5lZWQgdG8gZW5hYmxlIHNlY29uZCBzbGljZSBvbmx5IGFuZCBudW1iZXIKICAg
ICAgb2Ygc2xpY2VzIHdvdWxkIHN0aWxsIDEgYW5kIHRoYXQgY3VycmVudCBjb2RlIGRvZXNuJ3Qg
YWxsb3cuCiAgICAtIFJlbW92ZSByZWR1bmRhbnQgZHVwbGljYXRlIGNvZGUgdG8gaGF2ZSBzb21l
IHVuaWZpZWQgd2F5IG9mCiAgICAgIGVuYWJsaW5nIGRidWYgc2xpY2VzIGluc3RlYWQgb2YgaGFy
ZGNvZGluZy4KCnY1OiAtIEZpeCBmYWlsaW5nIGdlbjlfYXNzZXJ0X2RidWZfZW5hYmxlZCBhcyBp
dCB3YXMgbmFpdmVseSB0aGlua2luZwogICAgICB0aGF0IHdlIGhhdmUgb25seSBvbmUgREJVRl9D
VEwgc2xpY2UuIE5vdyBhbm90aGVyIHZlcnNpb24gZm9yCiAgICAgIGdlbjExIHdpbGwgY2hlY2sg
Ym90aCBzbGljZXMgYXMgb25seSBzZWNvbmQgb25lIGNhbiBiZSBlbmFibGVkLAogICAgICB0byBr
ZWVwIENJIGhhcHB5LgoKU2lnbmVkLW9mZi1ieTogU3RhbmlzbGF2IExpc292c2tpeSA8c3Rhbmlz
bGF2Lmxpc292c2tpeUBpbnRlbC5jb20+CkNjOiBNYXR0aGV3IFJvcGVyIDxtYXR0aGV3LmQucm9w
ZXJAaW50ZWwuY29tPgpDYzogVmlsbGUgU3lyasOkbMOkIDx2aWxsZS5zeXJqYWxhQGludGVsLmNv
bT4KQ2M6IEphbWVzIEF1c211cyA8amFtZXMuYXVzbXVzQGludGVsLmNvbT4KLS0tCiBkcml2ZXJz
L2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2Rpc3BsYXkuYyAgfCAgMjIgKy0KIC4uLi9kcm0v
aTkxNS9kaXNwbGF5L2ludGVsX2Rpc3BsYXlfcG93ZXIuYyAgICB8IDEwMyArKystLQogLi4uL2Ry
bS9pOTE1L2Rpc3BsYXkvaW50ZWxfZGlzcGxheV9wb3dlci5oICAgIHwgICAyICsKIGRyaXZlcnMv
Z3B1L2RybS9pOTE1L2k5MTVfZHJ2LmMgICAgICAgICAgICAgICB8ICAgNSArCiBkcml2ZXJzL2dw
dS9kcm0vaTkxNS9pOTE1X2Rydi5oICAgICAgICAgICAgICAgfCAgIDMgKy0KIGRyaXZlcnMvZ3B1
L2RybS9pOTE1L2k5MTVfcmVnLmggICAgICAgICAgICAgICB8ICAgMiArCiBkcml2ZXJzL2dwdS9k
cm0vaTkxNS9pbnRlbF9wbS5jICAgICAgICAgICAgICAgfCAzOTEgKysrKysrKysrKysrKysrKy0t
CiA3IGZpbGVzIGNoYW5nZWQsIDQ0MSBpbnNlcnRpb25zKCspLCA4NyBkZWxldGlvbnMoLSkKCmRp
ZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2Rpc3BsYXkuYyBi
L2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZGlzcGxheS5jCmluZGV4IDg3NmZj
MjU5NjhiZi4uZWU2M2RhMTg3NzJhIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9k
aXNwbGF5L2ludGVsX2Rpc3BsYXkuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5
L2ludGVsX2Rpc3BsYXkuYwpAQCAtMTMzODYsOCArMTMzODYsOSBAQCBzdGF0aWMgdm9pZCB2ZXJp
Znlfd21fc3RhdGUoc3RydWN0IGludGVsX2NydGMgKmNydGMsCiAJc3dfZGRiID0gJmRldl9wcml2
LT53bS5za2xfaHcuZGRiOwogCiAJaWYgKElOVEVMX0dFTihkZXZfcHJpdikgPj0gMTEgJiYKLQkg
ICAgaHctPmRkYi5lbmFibGVkX3NsaWNlcyAhPSBzd19kZGItPmVuYWJsZWRfc2xpY2VzKQotCQlE
Uk1fRVJST1IoIm1pc21hdGNoIGluIERCVUYgU2xpY2VzIChleHBlY3RlZCAldSwgZ290ICV1KVxu
IiwKKwkgICAgaHctPmRkYi5lbmFibGVkX3NsaWNlcyAhPSBzd19kZGItPmVuYWJsZWRfc2xpY2Vz
ICYmCisJICAgIG5lZWRzX21vZGVzZXQobmV3X2NydGNfc3RhdGUpKQorCQlEUk1fRVJST1IoIm1p
c21hdGNoIGluIERCVUYgU2xpY2VzIChleHBlY3RlZCAleCwgZ290ICV4KVxuIiwKIAkJCSAgc3df
ZGRiLT5lbmFibGVkX3NsaWNlcywKIAkJCSAgaHctPmRkYi5lbmFibGVkX3NsaWNlcyk7CiAKQEAg
LTE0NjEzLDE2ICsxNDYxNCwyMSBAQCBzdGF0aWMgdm9pZCBza2xfY29tbWl0X21vZGVzZXRfZW5h
YmxlcyhzdHJ1Y3QgaW50ZWxfYXRvbWljX3N0YXRlICpzdGF0ZSkKIAlpbnQgaTsKIAl1OCBod19l
bmFibGVkX3NsaWNlcyA9IGRldl9wcml2LT53bS5za2xfaHcuZGRiLmVuYWJsZWRfc2xpY2VzOwog
CXU4IHJlcXVpcmVkX3NsaWNlcyA9IHN0YXRlLT53bV9yZXN1bHRzLmRkYi5lbmFibGVkX3NsaWNl
czsKLQlzdHJ1Y3Qgc2tsX2RkYl9lbnRyeSBlbnRyaWVzW0k5MTVfTUFYX1BJUEVTXSA9IHt9Owor
CXU4IHNsaWNlc191bmlvbiA9IGh3X2VuYWJsZWRfc2xpY2VzIHwgcmVxdWlyZWRfc2xpY2VzOwor
CXU4IHNsaWNlc19pbnRlcnNlY3Rpb24gPSBzbGljZXNfdW5pb24gJiByZXF1aXJlZF9zbGljZXM7
CiAKKwlzdHJ1Y3Qgc2tsX2RkYl9lbnRyeSBlbnRyaWVzW0k5MTVfTUFYX1BJUEVTXSA9IHt9Owog
CWZvcl9lYWNoX29sZG5ld19pbnRlbF9jcnRjX2luX3N0YXRlKHN0YXRlLCBjcnRjLCBvbGRfY3J0
Y19zdGF0ZSwgbmV3X2NydGNfc3RhdGUsIGkpCiAJCS8qIGlnbm9yZSBhbGxvY2F0aW9ucyBmb3Ig
Y3J0YydzIHRoYXQgaGF2ZSBiZWVuIHR1cm5lZCBvZmYuICovCiAJCWlmIChuZXdfY3J0Y19zdGF0
ZS0+aHcuYWN0aXZlKQogCQkJZW50cmllc1tpXSA9IG9sZF9jcnRjX3N0YXRlLT53bS5za2wuZGRi
OwogCi0JLyogSWYgMm5kIERCdWYgc2xpY2UgcmVxdWlyZWQsIGVuYWJsZSBpdCBoZXJlICovCi0J
aWYgKElOVEVMX0dFTihkZXZfcHJpdikgPj0gMTEgJiYgcmVxdWlyZWRfc2xpY2VzID4gaHdfZW5h
YmxlZF9zbGljZXMpCi0JCWljbF9kYnVmX3NsaWNlc191cGRhdGUoZGV2X3ByaXYsIHJlcXVpcmVk
X3NsaWNlcyk7CisJRFJNX0RFQlVHX0tNUygiREJ1ZiByZXEgc2xpY2VzICVkIGh3IHNsaWNlcyAl
ZFxuIiwKKwkJICAgICAgcmVxdWlyZWRfc2xpY2VzLCBod19lbmFibGVkX3NsaWNlcyk7CisKKwkv
KiBJZiBzb21lIG90aGVyIERCdWYgc2xpY2UgcmVxdWlyZWQsIGVuYWJsZSBpdCBoZXJlICovCisJ
aWYgKElOVEVMX0dFTihkZXZfcHJpdikgPj0gMTEgJiYgcmVxdWlyZWRfc2xpY2VzICE9IGh3X2Vu
YWJsZWRfc2xpY2VzKQorCQlpY2xfZGJ1Zl9zbGljZXNfdXBkYXRlKGRldl9wcml2LCBzbGljZXNf
dW5pb24pOwogCiAJLyoKIAkgKiBXaGVuZXZlciB0aGUgbnVtYmVyIG9mIGFjdGl2ZSBwaXBlcyBj
aGFuZ2VzLCB3ZSBuZWVkIHRvIG1ha2Ugc3VyZSB3ZQpAQCAtMTQ2ODIsOCArMTQ2ODgsOCBAQCBz
dGF0aWMgdm9pZCBza2xfY29tbWl0X21vZGVzZXRfZW5hYmxlcyhzdHJ1Y3QgaW50ZWxfYXRvbWlj
X3N0YXRlICpzdGF0ZSkKIAl9IHdoaWxlIChwcm9ncmVzcyk7CiAKIAkvKiBJZiAybmQgREJ1ZiBz
bGljZSBpcyBubyBtb3JlIHJlcXVpcmVkIGRpc2FibGUgaXQgKi8KLQlpZiAoSU5URUxfR0VOKGRl
dl9wcml2KSA+PSAxMSAmJiByZXF1aXJlZF9zbGljZXMgPCBod19lbmFibGVkX3NsaWNlcykKLQkJ
aWNsX2RidWZfc2xpY2VzX3VwZGF0ZShkZXZfcHJpdiwgcmVxdWlyZWRfc2xpY2VzKTsKKwlpZiAo
SU5URUxfR0VOKGRldl9wcml2KSA+PSAxMSAmJiByZXF1aXJlZF9zbGljZXMgIT0gaHdfZW5hYmxl
ZF9zbGljZXMpCisJCWljbF9kYnVmX3NsaWNlc191cGRhdGUoZGV2X3ByaXYsIHNsaWNlc19pbnRl
cnNlY3Rpb24pOwogfQogCiBzdGF0aWMgdm9pZCBpbnRlbF9hdG9taWNfaGVscGVyX2ZyZWVfc3Rh
dGUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQpkaWZmIC0tZ2l0IGEvZHJpdmVy
cy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kaXNwbGF5X3Bvd2VyLmMgYi9kcml2ZXJzL2dw
dS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2Rpc3BsYXlfcG93ZXIuYwppbmRleCBjZTFiNjRmNGRk
NDQuLmMwNGViYjE5YmI0ZiAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxh
eS9pbnRlbF9kaXNwbGF5X3Bvd2VyLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxh
eS9pbnRlbF9kaXNwbGF5X3Bvd2VyLmMKQEAgLTEwNDAsNiArMTA0MCwyMSBAQCBzdGF0aWMgdm9p
ZCBnZW45X2Fzc2VydF9kYnVmX2VuYWJsZWQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9w
cml2KQogCSAgICAgIlVuZXhwZWN0ZWQgREJ1ZiBwb3dlciBwb3dlciBzdGF0ZSAoMHglMDh4KVxu
IiwgdG1wKTsKIH0KIAorc3RhdGljIHZvaWQgZ2VuMTFfYXNzZXJ0X2RidWZfZW5hYmxlZChzdHJ1
Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCit7CisJdTMyIHRtcCA9IEk5MTVfUkVBRChE
QlVGX0NUTF9TMSk7CisJdTMyIHRtcDIgPSBJOTE1X1JFQUQoREJVRl9DVExfUzIpOworCWJvb2wg
czFfZW5hYmxlZCA9ICh0bXAgJiAoREJVRl9QT1dFUl9TVEFURSB8IERCVUZfUE9XRVJfUkVRVUVT
VCkpID09CisJCQkgIChEQlVGX1BPV0VSX1NUQVRFIHwgREJVRl9QT1dFUl9SRVFVRVNUKTsKKwor
CWJvb2wgczJfZW5hYmxlZCA9ICh0bXAyICYgKERCVUZfUE9XRVJfU1RBVEUgfCBEQlVGX1BPV0VS
X1JFUVVFU1QpKSA9PQorCQkJICAoREJVRl9QT1dFUl9TVEFURSB8IERCVUZfUE9XRVJfUkVRVUVT
VCk7CisKKwlXQVJOKCFzMV9lbmFibGVkICYmICFzMl9lbmFibGVkLAorCSAgICAgIlVuZXhwZWN0
ZWQgREJ1ZiBwb3dlciBwb3dlciBzdGF0ZSAoMHglMDh4LCAweCUwOHgpXG4iLCB0bXAsCisJCQkJ
CQkJCSAgICAgdG1wMik7Cit9CisKIHN0YXRpYyB2b2lkIGdlbjlfZGlzYWJsZV9kY19zdGF0ZXMo
c3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQogewogCXN0cnVjdCBpbnRlbF9jZGNs
a19zdGF0ZSBjZGNsa19zdGF0ZSA9IHt9OwpAQCAtMTA1NSw3ICsxMDcwLDEwIEBAIHN0YXRpYyB2
b2lkIGdlbjlfZGlzYWJsZV9kY19zdGF0ZXMoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9w
cml2KQogCS8qIENhbid0IHJlYWQgb3V0IHZvbHRhZ2VfbGV2ZWwgc28gY2FuJ3QgdXNlIGludGVs
X2NkY2xrX2NoYW5nZWQoKSAqLwogCVdBUk5fT04oaW50ZWxfY2RjbGtfbmVlZHNfbW9kZXNldCgm
ZGV2X3ByaXYtPmNkY2xrLmh3LCAmY2RjbGtfc3RhdGUpKTsKIAotCWdlbjlfYXNzZXJ0X2RidWZf
ZW5hYmxlZChkZXZfcHJpdik7CisJaWYgKElOVEVMX0dFTihkZXZfcHJpdikgPj0gMTEpCisJCWdl
bjExX2Fzc2VydF9kYnVmX2VuYWJsZWQoZGV2X3ByaXYpOworCWVsc2UKKwkJZ2VuOV9hc3NlcnRf
ZGJ1Zl9lbmFibGVkKGRldl9wcml2KTsKIAogCWlmIChJU19HRU45X0xQKGRldl9wcml2KSkKIAkJ
Ynh0X3ZlcmlmeV9kZGlfcGh5X3Bvd2VyX3dlbGxzKGRldl9wcml2KTsKQEAgLTQyNTQsMzEgKzQy
NzIsNTMgQEAgc3RhdGljIHZvaWQgZ2VuOV9kYnVmX2Rpc2FibGUoc3RydWN0IGRybV9pOTE1X3By
aXZhdGUgKmRldl9wcml2KQogCWludGVsX2RidWZfc2xpY2Vfc2V0KGRldl9wcml2LCBEQlVGX0NU
TCwgZmFsc2UpOwogfQogCi1zdGF0aWMgdTggaW50ZWxfZGJ1Zl9tYXhfc2xpY2VzKHN0cnVjdCBk
cm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikKK3U4IGludGVsX2RidWZfbWF4X3NsaWNlcyhzdHJ1
Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCiB7CiAJaWYgKElOVEVMX0dFTihkZXZfcHJp
dikgPCAxMSkKIAkJcmV0dXJuIDE7CiAJcmV0dXJuIDI7CiB9CiAKK3ZvaWQgaWNsX2RidWZfc2xp
Y2VzX3Jlc3RvcmUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQoreworCWNvbnN0
IHU4IGh3X2VuYWJsZWRfc2xpY2VzID0gZGV2X3ByaXYtPndtLnNrbF9ody5kZGIuZW5hYmxlZF9z
bGljZXM7CisKKwlpY2xfZGJ1Zl9zbGljZXNfdXBkYXRlKGRldl9wcml2LCBod19lbmFibGVkX3Ns
aWNlcyk7Cit9CisKIHZvaWQgaWNsX2RidWZfc2xpY2VzX3VwZGF0ZShzdHJ1Y3QgZHJtX2k5MTVf
cHJpdmF0ZSAqZGV2X3ByaXYsCiAJCQkgICAgdTggcmVxX3NsaWNlcykKIHsKLQljb25zdCB1OCBo
d19lbmFibGVkX3NsaWNlcyA9IGRldl9wcml2LT53bS5za2xfaHcuZGRiLmVuYWJsZWRfc2xpY2Vz
OwotCWJvb2wgcmV0OworCWJvb2wgcmV0ID0gdHJ1ZTsKKwlpbnQgaTsKKwlpbnQgbWF4X3NsaWNl
cyA9IGludGVsX2RidWZfbWF4X3NsaWNlcyhkZXZfcHJpdik7CiAKLQlpZiAocmVxX3NsaWNlcyA+
IGludGVsX2RidWZfbWF4X3NsaWNlcyhkZXZfcHJpdikpIHsKKwlpZiAoaHdlaWdodDgocmVxX3Ns
aWNlcykgPiBpbnRlbF9kYnVmX21heF9zbGljZXMoZGV2X3ByaXYpKSB7CiAJCURSTV9FUlJPUigi
SW52YWxpZCBudW1iZXIgb2YgZGJ1ZiBzbGljZXMgcmVxdWVzdGVkXG4iKTsKIAkJcmV0dXJuOwog
CX0KIAotCWlmIChyZXFfc2xpY2VzID09IGh3X2VuYWJsZWRfc2xpY2VzIHx8IHJlcV9zbGljZXMg
PT0gMCkKLQkJcmV0dXJuOworCURSTV9ERUJVR19LTVMoIlVwZGF0aW5nIGRidWYgc2xpY2VzIHRv
ICV4XG4iLCByZXFfc2xpY2VzKTsKIAotCWlmIChyZXFfc2xpY2VzID4gaHdfZW5hYmxlZF9zbGlj
ZXMpCi0JCXJldCA9IGludGVsX2RidWZfc2xpY2Vfc2V0KGRldl9wcml2LCBEQlVGX0NUTF9TMiwg
dHJ1ZSk7Ci0JZWxzZQotCQlyZXQgPSBpbnRlbF9kYnVmX3NsaWNlX3NldChkZXZfcHJpdiwgREJV
Rl9DVExfUzIsIGZhbHNlKTsKKwlmb3IgKGkgPSAwOyBpIDwgbWF4X3NsaWNlczsgaSsrKSB7CisJ
CWludCBzbGljZV9iaXQgPSAxIDw8IGk7CisJCWJvb2wgc2xpY2Vfc2V0ID0gKChzbGljZV9iaXQp
ICYgcmVxX3NsaWNlcykgIT0gMDsKKworCQlzd2l0Y2ggKHNsaWNlX2JpdCkgeworCQljYXNlIERC
VUZfUzFfQklUOgorCQkJcmV0ID0gcmV0ICYmIGludGVsX2RidWZfc2xpY2Vfc2V0KGRldl9wcml2
LAorCQkJCQkJCSAgREJVRl9DVExfUzEsCisJCQkJCQkJICBzbGljZV9zZXQpOworCQkJYnJlYWs7
CisJCWNhc2UgREJVRl9TMl9CSVQ6CisJCQlyZXQgPSByZXQgJiYgaW50ZWxfZGJ1Zl9zbGljZV9z
ZXQoZGV2X3ByaXYsCisJCQkJCQkJICBEQlVGX0NUTF9TMiwKKwkJCQkJCQkgIHNsaWNlX3NldCk7
CisJCQlicmVhazsKKwkJZGVmYXVsdDoKKwkJCVdBUk4oMSwgIlVuc3VwcG9ydGVkIERCVUYgc2xp
Y2UiKTsKKwkJfQorCX0KIAogCWlmIChyZXQpCiAJCWRldl9wcml2LT53bS5za2xfaHcuZGRiLmVu
YWJsZWRfc2xpY2VzID0gcmVxX3NsaWNlczsKQEAgLTQyODYsNDAgKzQzMjYsMjEgQEAgdm9pZCBp
Y2xfZGJ1Zl9zbGljZXNfdXBkYXRlKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwK
IAogc3RhdGljIHZvaWQgaWNsX2RidWZfZW5hYmxlKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpk
ZXZfcHJpdikKIHsKLQlJOTE1X1dSSVRFKERCVUZfQ1RMX1MxLCBJOTE1X1JFQUQoREJVRl9DVExf
UzEpIHwgREJVRl9QT1dFUl9SRVFVRVNUKTsKLQlJOTE1X1dSSVRFKERCVUZfQ1RMX1MyLCBJOTE1
X1JFQUQoREJVRl9DVExfUzIpIHwgREJVRl9QT1dFUl9SRVFVRVNUKTsKLQlQT1NUSU5HX1JFQUQo
REJVRl9DVExfUzIpOwotCi0JdWRlbGF5KDEwKTsKLQotCWlmICghKEk5MTVfUkVBRChEQlVGX0NU
TF9TMSkgJiBEQlVGX1BPV0VSX1NUQVRFKSB8fAotCSAgICAhKEk5MTVfUkVBRChEQlVGX0NUTF9T
MikgJiBEQlVGX1BPV0VSX1NUQVRFKSkKLQkJRFJNX0VSUk9SKCJEQnVmIHBvd2VyIGVuYWJsZSB0
aW1lb3V0XG4iKTsKLQllbHNlCi0JCS8qCi0JCSAqIEZJWE1FOiBmb3Igbm93IHByZXRlbmQgdGhh
dCB3ZSBvbmx5IGhhdmUgMSBzbGljZSwgc2VlCi0JCSAqIGludGVsX2VuYWJsZWRfZGJ1Zl9zbGlj
ZXNfbnVtKCkuCi0JCSAqLwotCQlkZXZfcHJpdi0+d20uc2tsX2h3LmRkYi5lbmFibGVkX3NsaWNl
cyA9IDE7CisJLyoKKwkgKiBGb3Igbm93IHByZXRlbmQgdGhhdCB3ZSBvbmx5IGhhdmUgMSBzbGlj
ZSwgd2Ugd2lsbAorCSAqIGZpZ3VyZSBvdXQgbGF0ZXIgd2hpY2ggc2xpY2VzIHdlIGhhdmUgYW5k
IHdoYXQgd2UgbmVlZC4KKwkgKi8KKwlkZXZfcHJpdi0+d20uc2tsX2h3LmRkYi5lbmFibGVkX3Ns
aWNlcyA9IDE7CisJaWNsX2RidWZfc2xpY2VzX3Jlc3RvcmUoZGV2X3ByaXYpOwogfQogCiBzdGF0
aWMgdm9pZCBpY2xfZGJ1Zl9kaXNhYmxlKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJp
dikKIHsKLQlJOTE1X1dSSVRFKERCVUZfQ1RMX1MxLCBJOTE1X1JFQUQoREJVRl9DVExfUzEpICYg
fkRCVUZfUE9XRVJfUkVRVUVTVCk7Ci0JSTkxNV9XUklURShEQlVGX0NUTF9TMiwgSTkxNV9SRUFE
KERCVUZfQ1RMX1MyKSAmIH5EQlVGX1BPV0VSX1JFUVVFU1QpOwotCVBPU1RJTkdfUkVBRChEQlVG
X0NUTF9TMik7Ci0KLQl1ZGVsYXkoMTApOwotCi0JaWYgKChJOTE1X1JFQUQoREJVRl9DVExfUzEp
ICYgREJVRl9QT1dFUl9TVEFURSkgfHwKLQkgICAgKEk5MTVfUkVBRChEQlVGX0NUTF9TMikgJiBE
QlVGX1BPV0VSX1NUQVRFKSkKLQkJRFJNX0VSUk9SKCJEQnVmIHBvd2VyIGRpc2FibGUgdGltZW91
dCFcbiIpOwotCWVsc2UKLQkJLyoKLQkJICogRklYTUU6IGZvciBub3cgcHJldGVuZCB0aGF0IHRo
ZSBmaXJzdCBzbGljZSBpcyBhbHdheXMKLQkJICogZW5hYmxlZCwgc2VlIGludGVsX2VuYWJsZWRf
ZGJ1Zl9zbGljZXNfbnVtKCkuCi0JCSAqLwotCQlkZXZfcHJpdi0+d20uc2tsX2h3LmRkYi5lbmFi
bGVkX3NsaWNlcyA9IDE7CisJLyoKKwkgKiBEaXNhYmxlIGFsbCBzbGljZXMKKwkgKi8KKwlkZXZf
cHJpdi0+d20uc2tsX2h3LmRkYi5lbmFibGVkX3NsaWNlcyA9IDA7CisJaWNsX2RidWZfc2xpY2Vz
X3Jlc3RvcmUoZGV2X3ByaXYpOwogfQogCiBzdGF0aWMgdm9pZCBpY2xfbWJ1c19pbml0KHN0cnVj
dCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2Ry
bS9pOTE1L2Rpc3BsYXkvaW50ZWxfZGlzcGxheV9wb3dlci5oIGIvZHJpdmVycy9ncHUvZHJtL2k5
MTUvZGlzcGxheS9pbnRlbF9kaXNwbGF5X3Bvd2VyLmgKaW5kZXggMWRhMDRmM2UwZmIzLi40ZDVi
YjBhY2NlZjcgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxf
ZGlzcGxheV9wb3dlci5oCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxf
ZGlzcGxheV9wb3dlci5oCkBAIC0zMTEsOCArMzExLDEwIEBAIGludGVsX2Rpc3BsYXlfcG93ZXJf
cHV0X2FzeW5jKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LAogCWZvciAoKHdmKSA9IGlu
dGVsX2Rpc3BsYXlfcG93ZXJfZ2V0KChpOTE1KSwgKGRvbWFpbikpOyAod2YpOyBcCiAJICAgICBp
bnRlbF9kaXNwbGF5X3Bvd2VyX3B1dF9hc3luYygoaTkxNSksIChkb21haW4pLCAod2YpKSwgKHdm
KSA9IDApCiAKK3U4IGludGVsX2RidWZfbWF4X3NsaWNlcyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0
ZSAqZGV2X3ByaXYpOwogdm9pZCBpY2xfZGJ1Zl9zbGljZXNfdXBkYXRlKHN0cnVjdCBkcm1faTkx
NV9wcml2YXRlICpkZXZfcHJpdiwKIAkJCSAgICB1OCByZXFfc2xpY2VzKTsKK3ZvaWQgaWNsX2Ri
dWZfc2xpY2VzX3Jlc3RvcmUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KTsKIAog
dm9pZCBjaHZfcGh5X3Bvd2VyZ2F0ZV9sYW5lcyhzdHJ1Y3QgaW50ZWxfZW5jb2RlciAqZW5jb2Rl
ciwKIAkJCSAgICAgYm9vbCBvdmVycmlkZSwgdW5zaWduZWQgaW50IG1hc2spOwpkaWZmIC0tZ2l0
IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9kcnYuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1
L2k5MTVfZHJ2LmMKaW5kZXggODJlNGU2YmYwOGMzLi4wMzA3YWVjMmM5MjggMTAwNjQ0Ci0tLSBh
L2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZHJ2LmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5
MTUvaTkxNV9kcnYuYwpAQCAtNTEsNiArNTEsNyBAQAogI2luY2x1ZGUgImRpc3BsYXkvaW50ZWxf
YncuaCIKICNpbmNsdWRlICJkaXNwbGF5L2ludGVsX2NkY2xrLmgiCiAjaW5jbHVkZSAiZGlzcGxh
eS9pbnRlbF9kaXNwbGF5X3R5cGVzLmgiCisjaW5jbHVkZSAiZGlzcGxheS9pbnRlbF9kaXNwbGF5
X3Bvd2VyLmgiCiAjaW5jbHVkZSAiZGlzcGxheS9pbnRlbF9kcC5oIgogI2luY2x1ZGUgImRpc3Bs
YXkvaW50ZWxfZmJkZXYuaCIKICNpbmNsdWRlICJkaXNwbGF5L2ludGVsX2hvdHBsdWcuaCIKQEAg
LTI1ODgsNiArMjU4OSwxMCBAQCBzdGF0aWMgaW50IGludGVsX3J1bnRpbWVfcmVzdW1lKHN0cnVj
dCBkZXZpY2UgKmtkZXYpCiAJaWYgKElTX1ZBTExFWVZJRVcoZGV2X3ByaXYpIHx8IElTX0NIRVJS
WVZJRVcoZGV2X3ByaXYpKQogCQlyZXQgPSB2bHZfcmVzdW1lX3ByZXBhcmUoZGV2X3ByaXYsIHRy
dWUpOwogCisJLyogV2VpcmQgaGFjayB0byBmaXggSUNMIGhhcmR3YXJlIGJ1ZywgYXMgaXQgcmVz
ZXRzIERCVUYgc2xpY2VzIHJlZyAqLworCWlmIChJTlRFTF9HRU4oZGV2X3ByaXYpID09IDExKQor
CQlpY2xfZGJ1Zl9zbGljZXNfcmVzdG9yZShkZXZfcHJpdik7CisKIAlpbnRlbF91bmNvcmVfcnVu
dGltZV9yZXN1bWUoJmRldl9wcml2LT51bmNvcmUpOwogCiAJaW50ZWxfcnVudGltZV9wbV9lbmFi
bGVfaW50ZXJydXB0cyhkZXZfcHJpdik7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkx
NS9pOTE1X2Rydi5oIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9kcnYuaAppbmRleCA3ZTBm
NjdiYWJlMjAuLjc4YmQwMTBjYjU5YSAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUv
aTkxNV9kcnYuaAorKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2Rydi5oCkBAIC04MDQs
NyArODA0LDggQEAgc3RhdGljIGlubGluZSBib29sIHNrbF9kZGJfZW50cnlfZXF1YWwoY29uc3Qg
c3RydWN0IHNrbF9kZGJfZW50cnkgKmUxLAogfQogCiBzdHJ1Y3Qgc2tsX2RkYl9hbGxvY2F0aW9u
IHsKLQl1OCBlbmFibGVkX3NsaWNlczsgLyogR0VOMTEgaGFzIGNvbmZpZ3VyYWJsZSAyIHNsaWNl
cyAqLworCXU4IGVuYWJsZWRfc2xpY2VzOyAgIC8qIEJpdG1hc2sgb2YgY3VycmVudGx5IGVuYWJs
ZWQgREJ1ZiBzbGljZXMgKi8KKwl1OCBzdXBwb3J0ZWRfc2xpY2VzOyAvKiBHRU4gMTEgc3VwcG9y
dHMgMiBzbGljZXMgKi8KIH07CiAKIHN0cnVjdCBza2xfZGRiX3ZhbHVlcyB7CmRpZmYgLS1naXQg
YS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3JlZy5oIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUv
aTkxNV9yZWcuaAppbmRleCBhNjA3ZWE1MjA4MjkuLjdlY2EyYWRiYjI4MSAxMDA2NDQKLS0tIGEv
ZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9yZWcuaAorKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkx
NS9pOTE1X3JlZy5oCkBAIC03NzM0LDYgKzc3MzQsOCBAQCBlbnVtIHsKICNkZWZpbmUgRElTUF9B
UkJfQ1RMMglfTU1JTygweDQ1MDA0KQogI2RlZmluZSAgRElTUF9EQVRBX1BBUlRJVElPTl81XzYJ
KDEgPDwgNikKICNkZWZpbmUgIERJU1BfSVBDX0VOQUJMRQkJKDEgPDwgMykKKyNkZWZpbmUgREJV
Rl9TMV9CSVQJCQkxCisjZGVmaW5lIERCVUZfUzJfQklUCQkJMgogI2RlZmluZSBEQlVGX0NUTAlf
TU1JTygweDQ1MDA4KQogI2RlZmluZSBEQlVGX0NUTF9TMQlfTU1JTygweDQ1MDA4KQogI2RlZmlu
ZSBEQlVGX0NUTF9TMglfTU1JTygweDQ0RkU4KQpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJt
L2k5MTUvaW50ZWxfcG0uYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2ludGVsX3BtLmMKaW5kZXgg
MmQzODllNDM3ZTg3Li5lYmU1MzdhNDc4NzkgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9p
OTE1L2ludGVsX3BtLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50ZWxfcG0uYwpAQCAt
MzU4NiwyNCArMzU4NiwyMCBAQCBib29sIGlsa19kaXNhYmxlX2xwX3dtKHN0cnVjdCBkcm1fZGV2
aWNlICpkZXYpCiAJcmV0dXJuIF9pbGtfZGlzYWJsZV9scF93bShkZXZfcHJpdiwgV01fRElSVFlf
TFBfQUxMKTsKIH0KIAotc3RhdGljIHU4IGludGVsX2VuYWJsZWRfZGJ1Zl9zbGljZXNfbnVtKHN0
cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikKK3N0YXRpYyB1OCBpbnRlbF9lbmFibGVk
X2RidWZfc2xpY2VzKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikKIHsKLQl1OCBl
bmFibGVkX3NsaWNlczsKLQotCS8qIFNsaWNlIDEgd2lsbCBhbHdheXMgYmUgZW5hYmxlZCAqLwot
CWVuYWJsZWRfc2xpY2VzID0gMTsKKwl1OCBlbmFibGVkX3NsaWNlcyA9IDA7CiAKIAkvKiBHZW4g
cHJpb3IgdG8gR0VOMTEgaGF2ZSBvbmx5IG9uZSBEQnVmIHNsaWNlICovCiAJaWYgKElOVEVMX0dF
TihkZXZfcHJpdikgPCAxMSkKLQkJcmV0dXJuIGVuYWJsZWRfc2xpY2VzOworCQlyZXR1cm4gMTsK
IAotCS8qCi0JICogRklYTUU6IGZvciBub3cgd2UnbGwgb25seSBldmVyIHVzZSAxIHNsaWNlOyBw
cmV0ZW5kIHRoYXQgd2UgaGF2ZQotCSAqIG9ubHkgdGhhdCAxIHNsaWNlIGVuYWJsZWQgdW50aWwg
d2UgaGF2ZSBhIHByb3BlciB3YXkgZm9yIG9uLWRlbWFuZAotCSAqIHRvZ2dsaW5nIG9mIHRoZSBz
ZWNvbmQgc2xpY2UuCi0JICovCi0JaWYgKDAgJiYgSTkxNV9SRUFEKERCVUZfQ1RMX1MyKSAmIERC
VUZfUE9XRVJfU1RBVEUpCi0JCWVuYWJsZWRfc2xpY2VzKys7CisJLyogQ2hlY2sgaWYgc2Vjb25k
IERCdWYgc2xpY2UgaXMgZW5hYmxlZCAqLworCWlmIChJOTE1X1JFQUQoREJVRl9DVExfUzEpICYg
REJVRl9QT1dFUl9TVEFURSkKKwkJZW5hYmxlZF9zbGljZXMgfD0gMTsKKworCWlmIChJOTE1X1JF
QUQoREJVRl9DVExfUzIpICYgREJVRl9QT1dFUl9TVEFURSkKKwkJZW5hYmxlZF9zbGljZXMgfD0g
MjsKIAogCXJldHVybiBlbmFibGVkX3NsaWNlczsKIH0KQEAgLTM4MTIsMzYgKzM4MDgsNDQgQEAg
c3RhdGljIHUxNiBpbnRlbF9nZXRfZGRiX3NpemUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRl
dl9wcml2LAogCQkJICAgICAgY29uc3QgaW50IG51bV9hY3RpdmUsCiAJCQkgICAgICBzdHJ1Y3Qg
c2tsX2RkYl9hbGxvY2F0aW9uICpkZGIpCiB7Ci0JY29uc3Qgc3RydWN0IGRybV9kaXNwbGF5X21v
ZGUgKmFkanVzdGVkX21vZGU7Ci0JdTY0IHRvdGFsX2RhdGFfYnc7CiAJdTE2IGRkYl9zaXplID0g
SU5URUxfSU5GTyhkZXZfcHJpdiktPmRkYl9zaXplOwogCiAJV0FSTl9PTihkZGJfc2l6ZSA9PSAw
KTsKKwlkZGItPnN1cHBvcnRlZF9zbGljZXMgPSBpbnRlbF9kYnVmX21heF9zbGljZXMoZGV2X3By
aXYpOwogCiAJaWYgKElOVEVMX0dFTihkZXZfcHJpdikgPCAxMSkKIAkJcmV0dXJuIGRkYl9zaXpl
IC0gNDsgLyogNCBibG9ja3MgZm9yIGJ5cGFzcyBwYXRoIGFsbG9jYXRpb24gKi8KIAotCWFkanVz
dGVkX21vZGUgPSAmY3J0Y19zdGF0ZS0+aHcuYWRqdXN0ZWRfbW9kZTsKLQl0b3RhbF9kYXRhX2J3
ID0gdG90YWxfZGF0YV9yYXRlICogZHJtX21vZGVfdnJlZnJlc2goYWRqdXN0ZWRfbW9kZSk7CisJ
cmV0dXJuIGRkYl9zaXplOworfQogCi0JLyoKLQkgKiAxMkdCL3MgaXMgbWF4aW11bSBCVyBzdXBw
b3J0ZWQgYnkgc2luZ2xlIERCdWYgc2xpY2UuCi0JICoKLQkgKiBGSVhNRSBkYnVmIHNsaWNlIGNv
ZGUgaXMgYnJva2VuOgotCSAqIC0gbXVzdCB3YWl0IGZvciBwbGFuZXMgdG8gc3RvcCB1c2luZyB0
aGUgc2xpY2UgYmVmb3JlIHBvd2VyaW5nIGl0IG9mZgotCSAqIC0gcGxhbmUgc3RyYWRkbGluZyBi
b3RoIHNsaWNlcyBpcyBpbGxlZ2FsIGluIG11bHRpLXBpcGUgc2NlbmFyaW9zCi0JICogLSBzaG91
bGQgdmFsaWRhdGUgd2Ugc3RheSB3aXRoaW4gdGhlIGh3IGJhbmR3aWR0aCBsaW1pdHMKLQkgKi8K
LQlpZiAoMCAmJiAobnVtX2FjdGl2ZSA+IDEgfHwgdG90YWxfZGF0YV9idyA+PSBHQnBzKDEyKSkp
IHsKLQkJZGRiLT5lbmFibGVkX3NsaWNlcyA9IDI7Ci0JfSBlbHNlIHsKLQkJZGRiLT5lbmFibGVk
X3NsaWNlcyA9IDE7Ci0JCWRkYl9zaXplIC89IDI7Ci0JfQorLyoKKyAqIENhbGN1bGF0ZSBpbml0
aWFsIERCdWYgc2xpY2Ugb2Zmc2V0LCBiYXNlZCBvbiBzbGljZSBzaXplCisgKiBhbmQgbWFzayhp
LmUgaWYgc2xpY2Ugc2l6ZSBpcyAxMDI0IGFuZCBzZWNvbmQgc2xpY2UgaXMgZW5hYmxlZAorICog
b2Zmc2V0IHdvdWxkIGJlIDEwMjQpCisgKi8KK3N0YXRpYyB1MzIgc2tsX2dldF9maXJzdF9kYnVm
X3NsaWNlX29mZnNldCh1MzIgZGJ1Zl9zbGljZV9tYXNrLAorCQkJCQkgICB1MzIgc2xpY2Vfc2l6
ZSwgdTMyIGRkYl9zaXplKQoreworCXUzMiBvZmZzZXQgPSAwOwogCi0JcmV0dXJuIGRkYl9zaXpl
OworCWlmICghZGJ1Zl9zbGljZV9tYXNrKQorCQlyZXR1cm4gMDsKKworCXdoaWxlICghKGRidWZf
c2xpY2VfbWFzayAmIDEpKSB7CisJCWRidWZfc2xpY2VfbWFzayA+Pj0gMTsKKwkJb2Zmc2V0ICs9
IHNsaWNlX3NpemU7CisJCWlmIChvZmZzZXQgPj0gZGRiX3NpemUpCisJCQlicmVhazsKKwl9CisJ
V0FSTl9PTihvZmZzZXQgPj0gZGRiX3NpemUpOworCXJldHVybiBvZmZzZXQ7CiB9CiAKK3N0YXRp
YyB1MzIgaTkxNV9nZXRfYWxsb3dlZF9kYnVmX21hc2soc3RydWN0IGRybV9pOTE1X3ByaXZhdGUg
KmRldl9wcml2LAorCQkJCSAgICAgIGludCBwaXBlLCB1MzIgYWN0aXZlX3BpcGVzLAorCQkJCSAg
ICAgIGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlKTsKKwogc3RhdGlj
IHZvaWQKIHNrbF9kZGJfZ2V0X3BpcGVfYWxsb2NhdGlvbl9saW1pdHMoc3RydWN0IGRybV9pOTE1
X3ByaXZhdGUgKmRldl9wcml2LAogCQkJCSAgIGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRl
ICpjcnRjX3N0YXRlLApAQCAtMzg1Nyw3ICszODYxLDE0IEBAIHNrbF9kZGJfZ2V0X3BpcGVfYWxs
b2NhdGlvbl9saW1pdHMoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAogCXUzMiBw
aXBlX3dpZHRoID0gMCwgdG90YWxfd2lkdGggPSAwLCB3aWR0aF9iZWZvcmVfcGlwZSA9IDA7CiAJ
ZW51bSBwaXBlIGZvcl9waXBlID0gdG9faW50ZWxfY3J0Yyhmb3JfY3J0YyktPnBpcGU7CiAJdTE2
IGRkYl9zaXplOworCXUzMiBkZGJfcmFuZ2Vfc2l6ZTsKIAl1MzIgaTsKKwl1MzIgZGJ1Zl9zbGlj
ZV9tYXNrOworCXUzMiBhY3RpdmVfcGlwZXM7CisJdTMyIG9mZnNldDsKKwl1MzIgc2xpY2Vfc2l6
ZTsKKwl1MzIgdG90YWxfc2xpY2VfbWFzazsKKwl1MzIgc3RhcnQsIGVuZDsKIAogCWlmIChXQVJO
X09OKCFzdGF0ZSkgfHwgIWNydGNfc3RhdGUtPmh3LmFjdGl2ZSkgewogCQlhbGxvYy0+c3RhcnQg
PSAwOwpAQCAtMzg2NiwxNCArMzg3NywyMyBAQCBza2xfZGRiX2dldF9waXBlX2FsbG9jYXRpb25f
bGltaXRzKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKIAkJcmV0dXJuOwogCX0K
IAotCWlmIChpbnRlbF9zdGF0ZS0+YWN0aXZlX3BpcGVfY2hhbmdlcykKKwlpZiAoaW50ZWxfc3Rh
dGUtPmFjdGl2ZV9waXBlX2NoYW5nZXMpIHsKIAkJKm51bV9hY3RpdmUgPSBod2VpZ2h0OChpbnRl
bF9zdGF0ZS0+YWN0aXZlX3BpcGVzKTsKLQllbHNlCisJCWFjdGl2ZV9waXBlcyA9IGludGVsX3N0
YXRlLT5hY3RpdmVfcGlwZXM7CisJfSBlbHNlIHsKIAkJKm51bV9hY3RpdmUgPSBod2VpZ2h0OChk
ZXZfcHJpdi0+YWN0aXZlX3BpcGVzKTsKKwkJYWN0aXZlX3BpcGVzID0gZGV2X3ByaXYtPmFjdGl2
ZV9waXBlczsKKwl9CiAKIAlkZGJfc2l6ZSA9IGludGVsX2dldF9kZGJfc2l6ZShkZXZfcHJpdiwg
Y3J0Y19zdGF0ZSwgdG90YWxfZGF0YV9yYXRlLAogCQkJCSAgICAgICpudW1fYWN0aXZlLCBkZGIp
OwogCisJRFJNX0RFQlVHX0tNUygiR290IHRvdGFsIGRkYiBzaXplICVkXG4iLCBkZGJfc2l6ZSk7
CisKKwlzbGljZV9zaXplID0gZGRiX3NpemUgLyBkZGItPnN1cHBvcnRlZF9zbGljZXM7CisKKwlE
Uk1fREVCVUdfS01TKCJHb3QgREJ1ZiBzbGljZSBzaXplICVkXG4iLCBzbGljZV9zaXplKTsKKwog
CS8qCiAJICogSWYgdGhlIHN0YXRlIGRvZXNuJ3QgY2hhbmdlIHRoZSBhY3RpdmUgQ1JUQydzIG9y
IHRoZXJlIGlzIG5vCiAJICogbW9kZXNldCByZXF1ZXN0LCB0aGVuIHRoZXJlJ3Mgbm8gbmVlZCB0
byByZWNhbGN1bGF0ZTsKQEAgLTM4OTEsMjAgKzM5MTEsNzMgQEAgc2tsX2RkYl9nZXRfcGlwZV9h
bGxvY2F0aW9uX2xpbWl0cyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCiAJCXJl
dHVybjsKIAl9CiAKKwkvKgorCSAqIEdldCBhbGxvd2VkIERCdWYgc2xpY2VzIGZvciBjb3JyZXNw
b25kZW50IHBpcGUgYW5kIHBsYXRmb3JtLgorCSAqLworCWRidWZfc2xpY2VfbWFzayA9IGk5MTVf
Z2V0X2FsbG93ZWRfZGJ1Zl9tYXNrKGRldl9wcml2LCBmb3JfcGlwZSwKKwkJCQkJCSAgICAgYWN0
aXZlX3BpcGVzLCBjcnRjX3N0YXRlKTsKKworCURSTV9ERUJVR19LTVMoIkRCdWYgc2xpY2UgbWFz
ayAleCBwaXBlICVkIGFjdGl2ZSBwaXBlcyAleFxuIiwKKwkJICAgICAgZGJ1Zl9zbGljZV9tYXNr
LAorCQkgICAgICBmb3JfcGlwZSwgYWN0aXZlX3BpcGVzKTsKKworCS8qCisJICogRmlndXJlIG91
dCBhdCB3aGljaCBEQnVmIHNsaWNlIHdlIHN0YXJ0LCBpLmUgaWYgd2Ugc3RhcnQgYXQgRGJ1ZiBT
MgorCSAqIGFuZCBzbGljZSBzaXplIGlzIDEwMjQsIHRoZSBvZmZzZXQgd291bGQgYmUgMTAyNAor
CSAqLworCW9mZnNldCA9IHNrbF9nZXRfZmlyc3RfZGJ1Zl9zbGljZV9vZmZzZXQoZGJ1Zl9zbGlj
ZV9tYXNrLAorCQkJCQkJIHNsaWNlX3NpemUsIGRkYl9zaXplKTsKKworCS8qCisJICogRmlndXJl
IG91dCB0b3RhbCBzaXplIG9mIGFsbG93ZWQgREJ1ZiBzbGljZXMsIHdoaWNoIGlzIGJhc2ljYWxs
eQorCSAqIGEgbnVtYmVyIG9mIGFsbG93ZWQgc2xpY2VzIGZvciB0aGF0IHBpcGUgbXVsdGlwbGll
ZCBieSBzbGljZSBzaXplLgorCSAqIFdlIG1pZ2h0IHN0aWxsIGhhdmUgc29tZSBkYnVmIHNsaWNl
cyBkaXNhYmxlZCBpbiBjYXNlIGlmIHRob3NlCisJICogYXJlIG5vdCBuZWVkZWQgYmFzZWQgb24g
YmFuZHdpZHRoIHJlcXVpcmVtZW50cyBhbmQgbnVtX2FjdGl2ZSBwaXBlcywKKwkgKiBzbyBzdGlj
ayB0byByZWFsIGRkYiBzaXplIGlmIGl0IGhhcHBlbnMgdG8gYmUgbGVzcy4gSW5zaWRlIG9mIHRo
aXMKKwkgKiByYW5nZSBkZGIgZW50cmllcyBhcmUgc3RpbGwgYWxsb2NhdGVkIGluIHByb3BvcnRp
b24gdG8gZGlzcGxheSB3aWR0aC4KKwkgKi8KKwlkZGJfcmFuZ2Vfc2l6ZSA9IG1pbihod2VpZ2h0
OChkYnVmX3NsaWNlX21hc2spICogc2xpY2Vfc2l6ZSwKKwkJCSAgICAgKHVuc2lnbmVkIGludClk
ZGJfc2l6ZSk7CisKIAkvKgogCSAqIFdhdGVybWFyay9kZGIgcmVxdWlyZW1lbnQgaGlnaGx5IGRl
cGVuZHMgdXBvbiB3aWR0aCBvZiB0aGUKIAkgKiBmcmFtZWJ1ZmZlciwgU28gaW5zdGVhZCBvZiBh
bGxvY2F0aW5nIEREQiBlcXVhbGx5IGFtb25nIHBpcGVzCiAJICogZGlzdHJpYnV0ZSBEREIgYmFz
ZWQgb24gcmVzb2x1dGlvbi93aWR0aCBvZiB0aGUgZGlzcGxheS4KIAkgKi8KKwl0b3RhbF9zbGlj
ZV9tYXNrID0gZGJ1Zl9zbGljZV9tYXNrOwogCWZvcl9lYWNoX25ld19pbnRlbF9jcnRjX2luX3N0
YXRlKGludGVsX3N0YXRlLCBjcnRjLCBjcnRjX3N0YXRlLCBpKSB7CiAJCWNvbnN0IHN0cnVjdCBk
cm1fZGlzcGxheV9tb2RlICphZGp1c3RlZF9tb2RlID0KIAkJCSZjcnRjX3N0YXRlLT5ody5hZGp1
c3RlZF9tb2RlOwogCQllbnVtIHBpcGUgcGlwZSA9IGNydGMtPnBpcGU7CiAJCWludCBoZGlzcGxh
eSwgdmRpc3BsYXk7CisJCXUzMiBwaXBlX2RidWZfc2xpY2VfbWFzayA9IFwKKwkJCWk5MTVfZ2V0
X2FsbG93ZWRfZGJ1Zl9tYXNrKGRldl9wcml2LAorCQkJCQkJcGlwZSwKKwkJCQkJCWFjdGl2ZV9w
aXBlcywKKwkJCQkJCWNydGNfc3RhdGUpOwogCiAJCWlmICghY3J0Y19zdGF0ZS0+aHcuZW5hYmxl
KQogCQkJY29udGludWU7CiAKKwkJLyoKKwkJICogQWNjb3JkaW5nIHRvIEJTcGVjIHBpcGUgY2Fu
IHNoYXJlIG9uZSBkYnVmIHNsaWNlIHdpdGggYW5vdGhlcgorCQkgKiBwaXBlcyBvciBwaXBlIGNh
biB1c2UgbXVsdGlwbGUgZGJ1ZnMsIGluIGJvdGggY2FzZXMgd2UKKwkJICogYWNjb3VudCBmb3Ig
b3RoZXIgcGlwZXMgb25seSBpZiB0aGV5IGhhdmUgZXhhY3RseSBzYW1lIG1hc2suCisJCSAqIEhv
d2V2ZXIgd2UgbmVlZCB0byBhY2NvdW50IGhvdyBtYW55IHNsaWNlcyB3ZSBzaG91bGQgZW5hYmxl
CisJCSAqIGluIHRvdGFsLgorCQkgKi8KKwkJdG90YWxfc2xpY2VfbWFzayB8PSBwaXBlX2RidWZf
c2xpY2VfbWFzazsKKworCQkvKgorCQkgKiBEbyBub3QgYWNjb3VudCBwaXBlcyB1c2luZyBvdGhl
ciBzbGljZSBzZXRzCisJCSAqIGx1Y2tpbHkgYXMgb2YgY3VycmVudCBCU3BlYyBzbGljZSBzZXRz
IGRvIG5vdCBwYXJ0aWFsbHkKKwkJICogaW50ZXJzZWN0KHBpcGVzIHNoYXJlIGVpdGhlciBzYW1l
IG9uZSBzbGljZSBvciBzYW1lIHNsaWNlIHNldAorCQkgKiBpLmUgbm8gcGFydGlhbCBpbnRlcnNl
Y3Rpb24pLCBzbyBpdCBpcyBlbm91Z2ggdG8gY2hlY2sgZm9yCisJCSAqIGVxdWFsaXR5IGZvciBu
b3cuCisJCSAqLworCQlpZiAoZGJ1Zl9zbGljZV9tYXNrICE9IHBpcGVfZGJ1Zl9zbGljZV9tYXNr
KQorCQkJY29udGludWU7CisKIAkJZHJtX21vZGVfZ2V0X2h2X3RpbWluZyhhZGp1c3RlZF9tb2Rl
LCAmaGRpc3BsYXksICZ2ZGlzcGxheSk7CiAJCXRvdGFsX3dpZHRoICs9IGhkaXNwbGF5OwogCkBA
IC0zOTE0LDggKzM5ODcsMTkgQEAgc2tsX2RkYl9nZXRfcGlwZV9hbGxvY2F0aW9uX2xpbWl0cyhz
dHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCiAJCQlwaXBlX3dpZHRoID0gaGRpc3Bs
YXk7CiAJfQogCi0JYWxsb2MtPnN0YXJ0ID0gZGRiX3NpemUgKiB3aWR0aF9iZWZvcmVfcGlwZSAv
IHRvdGFsX3dpZHRoOwotCWFsbG9jLT5lbmQgPSBkZGJfc2l6ZSAqICh3aWR0aF9iZWZvcmVfcGlw
ZSArIHBpcGVfd2lkdGgpIC8gdG90YWxfd2lkdGg7CisJZGRiLT5lbmFibGVkX3NsaWNlcyA9IHRv
dGFsX3NsaWNlX21hc2s7CisKKwlzdGFydCA9IGRkYl9yYW5nZV9zaXplICogd2lkdGhfYmVmb3Jl
X3BpcGUgLyB0b3RhbF93aWR0aDsKKwllbmQgPSBkZGJfcmFuZ2Vfc2l6ZSAqICh3aWR0aF9iZWZv
cmVfcGlwZSArIHBpcGVfd2lkdGgpIC8gdG90YWxfd2lkdGg7CisKKwlhbGxvYy0+c3RhcnQgPSBv
ZmZzZXQgKyBzdGFydDsKKwlhbGxvYy0+ZW5kID0gb2Zmc2V0ICsgZW5kOworCisJRFJNX0RFQlVH
X0tNUygiUGlwZSAlZCBkZGIgJWQtJWRcbiIsIGZvcl9waXBlLAorCQkgICAgICBhbGxvYy0+c3Rh
cnQsIGFsbG9jLT5lbmQpOworCURSTV9ERUJVR19LTVMoIkVuYWJsZWQgZGRiIHNsaWNlcyBtYXNr
ICV4IG51bSBzdXBwb3J0ZWQgJWRcbiIsCisJCSAgICAgIGRkYi0+ZW5hYmxlZF9zbGljZXMsCisJ
CSAgICAgIGRkYi0+c3VwcG9ydGVkX3NsaWNlcyk7CiB9CiAKIHN0YXRpYyBpbnQgc2tsX2NvbXB1
dGVfd21fcGFyYW1zKGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlLApA
QCAtNDAzNiw3ICs0MTIwLDggQEAgdm9pZCBza2xfcGlwZV9kZGJfZ2V0X2h3X3N0YXRlKHN0cnVj
dCBpbnRlbF9jcnRjICpjcnRjLAogdm9pZCBza2xfZGRiX2dldF9od19zdGF0ZShzdHJ1Y3QgZHJt
X2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCiAJCQkgIHN0cnVjdCBza2xfZGRiX2FsbG9jYXRpb24g
KmRkYiAvKiBvdXQgKi8pCiB7Ci0JZGRiLT5lbmFibGVkX3NsaWNlcyA9IGludGVsX2VuYWJsZWRf
ZGJ1Zl9zbGljZXNfbnVtKGRldl9wcml2KTsKKwlkZGItPmVuYWJsZWRfc2xpY2VzID0gaW50ZWxf
ZW5hYmxlZF9kYnVmX3NsaWNlcyhkZXZfcHJpdik7CisJRFJNX0RFQlVHX0tNUygiR290IGh3IGRi
dWYgc2xpY2VzIG1hc2sgJXhcbiIsIGRkYi0+ZW5hYmxlZF9zbGljZXMpOwogfQogCiAvKgpAQCAt
NDE2NCw2ICs0MjQ5LDIzOCBAQCBza2xfZ2V0X3RvdGFsX3JlbGF0aXZlX2RhdGFfcmF0ZShzdHJ1
Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSwKIAlyZXR1cm4gdG90YWxfZGF0YV9yYXRl
OwogfQogCit1aW50X2ZpeGVkXzE2XzE2X3QKK3NrbF9waXBlX2Rvd25zY2FsZV9hbW91bnQoY29u
c3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUpCit7CisJdTMyIHNyY193LCBz
cmNfaCwgZHN0X3csIGRzdF9oOworCXVpbnRfZml4ZWRfMTZfMTZfdCBmcF93X3JhdGlvLCBmcF9o
X3JhdGlvOworCXVpbnRfZml4ZWRfMTZfMTZfdCBkb3duc2NhbGVfaCwgZG93bnNjYWxlX3c7CisJ
Y29uc3Qgc3RydWN0IGRybV9kaXNwbGF5X21vZGUgKmFkanVzdGVkX21vZGUgPSAmY3J0Y19zdGF0
ZS0+aHcuYWRqdXN0ZWRfbW9kZTsKKworCXNyY193ID0gY3J0Y19zdGF0ZS0+cGlwZV9zcmNfdzsK
KwlzcmNfaCA9IGNydGNfc3RhdGUtPnBpcGVfc3JjX2g7CisJZHN0X3cgPSBhZGp1c3RlZF9tb2Rl
LT5jcnRjX2hkaXNwbGF5OworCWRzdF9oID0gYWRqdXN0ZWRfbW9kZS0+Y3J0Y192ZGlzcGxheTsK
KworCWZwX3dfcmF0aW8gPSBkaXZfZml4ZWQxNihzcmNfdywgZHN0X3cpOworCWZwX2hfcmF0aW8g
PSBkaXZfZml4ZWQxNihzcmNfaCwgZHN0X2gpOworCWRvd25zY2FsZV93ID0gbWF4X2ZpeGVkMTYo
ZnBfd19yYXRpbywgdTMyX3RvX2ZpeGVkMTYoMSkpOworCWRvd25zY2FsZV9oID0gbWF4X2ZpeGVk
MTYoZnBfaF9yYXRpbywgdTMyX3RvX2ZpeGVkMTYoMSkpOworCisJcmV0dXJuIG11bF9maXhlZDE2
KGRvd25zY2FsZV93LCBkb3duc2NhbGVfaCk7Cit9CisKK3VpbnRfZml4ZWRfMTZfMTZfdAoraWNs
X2dldF9waXBlX3JhdGlvKGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRl
KQoreworCXN0cnVjdCBkcm1fcGxhbmUgKnBsYW5lOworCWNvbnN0IHN0cnVjdCBkcm1fcGxhbmVf
c3RhdGUgKmRybV9wbGFuZV9zdGF0ZTsKKwl1aW50X2ZpeGVkXzE2XzE2X3QgcGlwZV9kb3duc2Nh
bGUsIHBpcGVfcmF0aW87CisJdWludF9maXhlZF8xNl8xNl90IG1heF9kb3duc2NhbGUgPSB1MzJf
dG9fZml4ZWQxNigxKTsKKwlzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YyA9IHRvX2ludGVsX2NydGMo
Y3J0Y19zdGF0ZS0+dWFwaS5jcnRjKTsKKworCWlmICghY3J0Y19zdGF0ZS0+dWFwaS5lbmFibGUp
CisJCXJldHVybiBtYXhfZG93bnNjYWxlOworCisJZHJtX2F0b21pY19jcnRjX3N0YXRlX2Zvcl9l
YWNoX3BsYW5lX3N0YXRlKHBsYW5lLCBkcm1fcGxhbmVfc3RhdGUsICZjcnRjX3N0YXRlLT51YXBp
KSB7CisJCXVpbnRfZml4ZWRfMTZfMTZfdCBwbGFuZV9kb3duc2NhbGU7CisJCWNvbnN0IHN0cnVj
dCBpbnRlbF9wbGFuZV9zdGF0ZSAqcGxhbmVfc3RhdGUgPQorCQkJdG9faW50ZWxfcGxhbmVfc3Rh
dGUoZHJtX3BsYW5lX3N0YXRlKTsKKworCQlpZiAoIWludGVsX3dtX3BsYW5lX3Zpc2libGUoY3J0
Y19zdGF0ZSwgcGxhbmVfc3RhdGUpKQorCQkJY29udGludWU7CisKKwkJcGxhbmVfZG93bnNjYWxl
ID0gc2tsX3BsYW5lX2Rvd25zY2FsZV9hbW91bnQoY3J0Y19zdGF0ZSwgcGxhbmVfc3RhdGUpOwor
CisJCURSTV9ERUJVR19LTVMoIlBsYW5lICVkIGRvd25zY2FsZSBhbW91bnQgJWQuJWRcbiIsCisJ
CQkgICAgICB0b19pbnRlbF9wbGFuZShwbGFuZSktPmlkLAorCQkJICAgICAgcGxhbmVfZG93bnNj
YWxlLnZhbCA+PiAxNiwKKwkJCSAgICAgIHBsYW5lX2Rvd25zY2FsZS52YWwgJiAweGZmZmYpOwor
CisJCW1heF9kb3duc2NhbGUgPSBtYXhfZml4ZWQxNihwbGFuZV9kb3duc2NhbGUsIG1heF9kb3du
c2NhbGUpOworCX0KKworCisJcGlwZV9kb3duc2NhbGUgPSBza2xfcGlwZV9kb3duc2NhbGVfYW1v
dW50KGNydGNfc3RhdGUpOworCisJRFJNX0RFQlVHX0tNUygiUGlwZSAlZCBkb3duc2NhbGUgYW1v
dW50ICVkLiVkXG4iLAorCQkgICAgICAgY3J0Yy0+cGlwZSwgcGlwZV9kb3duc2NhbGUudmFsID4+
IDE2LAorCQkgICAgICAgcGlwZV9kb3duc2NhbGUudmFsICYgMHhmZmZmKTsKKworCXBpcGVfZG93
bnNjYWxlID0gbXVsX2ZpeGVkMTYocGlwZV9kb3duc2NhbGUsIG1heF9kb3duc2NhbGUpOworCisJ
LyogQ29udmVydCByZXN1bHQgdG8gcGVyY2VudGFnZSAqLworCXBpcGVfcmF0aW8gPSB1MzJfdG9f
Zml4ZWQxNigxMDAgKiBkaXZfcm91bmRfdXBfdTMyX2ZpeGVkMTYoMSwgcGlwZV9kb3duc2NhbGUp
KTsKKworCURSTV9ERUJVR19LTVMoIlBpcGUgJWQgcmF0aW8gJWQuJWRcbiIsIGNydGMtPnBpcGUs
CisJCSAgICAgIHBpcGVfcmF0aW8udmFsID4+IDE2LCBwaXBlX3JhdGlvLnZhbCAmIDB4ZmZmZik7
CisKKwlyZXR1cm4gcGlwZV9yYXRpbzsKK30KKworc3RydWN0IGRidWZfc2xpY2VfY29uZl9lbnRy
eSB7CisJdTMyIGRidWZfbWFza1tJOTE1X01BWF9QSVBFU107CisJdTMyIGFjdGl2ZV9waXBlczsK
K307CisKKworI2RlZmluZSBJQ0xfUElQRV9BX0RCVUZfU0xJQ0VTKERCdWYxKSAgXAorCXsgeyBE
QnVmMSwgMCwgMCwgMCB9LCBCSVQoUElQRV9BKSB9CisjZGVmaW5lIElDTF9QSVBFX0JfREJVRl9T
TElDRVMoREJ1ZjEpICBcCisJeyB7IDAsIERCdWYxLCAwLCAwIH0sIEJJVChQSVBFX0IpIH0KKyNk
ZWZpbmUgSUNMX1BJUEVfQ19EQlVGX1NMSUNFUyhEQnVmMSkgIFwKKwl7IHsgMCwgMCwgREJ1ZjEs
IDAgfSwgQklUKFBJUEVfQykgfQorI2RlZmluZSBJQ0xfUElQRV9EX0RCVUZfU0xJQ0VTKERCdWYx
KSAgXAorCXsgeyAwLCAwLCAwLCBEQnVmMSB9LCBCSVQoUElQRV9EKSB9CisjZGVmaW5lIElDTF9Q
SVBFX0FCX0RCVUZfU0xJQ0VTKERCdWYxLCBEQnVmMikgICBcCisJeyB7IERCdWYxLCBEQnVmMiwg
MCwgMCB9LCBCSVQoUElQRV9BKSB8IEJJVChQSVBFX0IpIH0KKyNkZWZpbmUgSUNMX1BJUEVfQkNf
REJVRl9TTElDRVMoREJ1ZjEsIERCdWYyKSAgIFwKKwl7IHsgMCwgREJ1ZjEsIERCdWYyLCAwIH0s
IEJJVChQSVBFX0IpIHwgQklUKFBJUEVfQykgfQorI2RlZmluZSBJQ0xfUElQRV9CRF9EQlVGX1NM
SUNFUyhEQnVmMSwgREJ1ZjIpICAgXAorCXsgeyAwLCBEQnVmMSwgMCwgREJ1ZjIgfSwgQklUKFBJ
UEVfQikgfCBCSVQoUElQRV9EKSB9CisjZGVmaW5lIElDTF9QSVBFX0FDX0RCVUZfU0xJQ0VTKERC
dWYxLCBEQnVmMikgICBcCisJeyB7IERCdWYxLCAwLCBEQnVmMiwgMCB9LCBCSVQoUElQRV9BKSB8
IEJJVChQSVBFX0MpIH0KKyNkZWZpbmUgSUNMX1BJUEVfQURfREJVRl9TTElDRVMoREJ1ZjEsIERC
dWYyKSAgIFwKKwl7IHsgREJ1ZjEsIDAsIDAsIERCdWYyIH0sIEJJVChQSVBFX0EpIHwgQklUKFBJ
UEVfRCkgfQorI2RlZmluZSBJQ0xfUElQRV9DRF9EQlVGX1NMSUNFUyhEQnVmMSwgREJ1ZjIpICAg
XAorCXsgeyAwLCAwLCBEQnVmMSwgREJ1ZjIgfSwgQklUKFBJUEVfQykgfCBCSVQoUElQRV9EKSB9
CisjZGVmaW5lIElDTF9QSVBFX0FCQ19EQlVGX1NMSUNFUyhEQnVmMSwgREJ1ZjIsIERCdWYzKSAg
XAorCXsgeyBEQnVmMSwgREJ1ZjIsIERCdWYzLCAwIH0sIEJJVChQSVBFX0EpIHwgQklUKFBJUEVf
QikgfCBCSVQoUElQRV9DKSB9CisjZGVmaW5lIElDTF9QSVBFX0FDRF9EQlVGX1NMSUNFUyhEQnVm
MSwgREJ1ZjIsIERCdWYzKSAgXAorCXsgeyBEQnVmMSwgMCwgREJ1ZjIsIERCdWYzIH0sIEJJVChQ
SVBFX0EpIHwgQklUKFBJUEVfQykgfCBCSVQoUElQRV9EKSB9CisjZGVmaW5lIElDTF9QSVBFX0JD
RF9EQlVGX1NMSUNFUyhEQnVmMSwgREJ1ZjIsIERCdWYzKSAgXAorCXsgeyAwLCBEQnVmMSwgREJ1
ZjIsIERCdWYzIH0sIEJJVChQSVBFX0IpIHwgQklUKFBJUEVfQykgfCBCSVQoUElQRV9EKSB9Cisj
ZGVmaW5lIElDTF9QSVBFX0FCRF9EQlVGX1NMSUNFUyhEQnVmMSwgREJ1ZjIsIERCdWYzKSAgXAor
CXsgeyBEQnVmMSwgREJ1ZjIsIDAsIERCdWYzIH0sIEJJVChQSVBFX0EpIHwgQklUKFBJUEVfQikg
fCBCSVQoUElQRV9EKSB9CisjZGVmaW5lIElDTF9QSVBFX0FCQ19EQlVGX1NMSUNFUyhEQnVmMSwg
REJ1ZjIsIERCdWYzKSAgXAorCXsgeyBEQnVmMSwgREJ1ZjIsIERCdWYzLCAwIH0sIEJJVChQSVBF
X0EpIHwgQklUKFBJUEVfQikgfCBCSVQoUElQRV9DKSB9CisjZGVmaW5lIElDTF9QSVBFX0FCQ0Rf
REJVRl9TTElDRVMoREJ1ZjEsIERCdWYyLCBEQnVmMywgREJ1ZjQpICBcCisJeyB7IERCdWYxLCBE
QnVmMiwgREJ1ZjMsIERCdWY0IH0sIEJJVChQSVBFX0EpIHwgQklUKFBJUEVfQikgfCBcCisJCQkJ
CSAgQklUKFBJUEVfQykgfCBCSVQoUElQRV9EKSB9CisKKy8qCisgKiBUYWJsZSB0YWtlbiBmcm9t
IEJzcGVjIDEyNzE2CisgKiBQaXBlcyBkbyBoYXZlIHNvbWUgcHJlZmVycmVkIERCdWYgc2xpY2Ug
YWZmaW5pdHksCisgKiBwbHVzIHRoZXJlIGFyZSBzb21lIGhhcmRjb2RlZCByZXF1aXJlbWVudHMg
b24gaG93CisgKiB0aG9zZSBzaG91bGQgYmUgZGlzdHJpYnV0ZWQgZm9yIG11bHRpcGlwZSBzY2Vu
YXJpb3MuCisgKiBGb3IgbW9yZSBEQnVmIHNsaWNlcyBhbGdvcml0aG0gY2FuIGdldCBldmVuIG1v
cmUgbWVzc3kKKyAqIGFuZCBsZXNzIHJlYWRhYmxlLCBzbyBkZWNpZGVkIHRvIHVzZSBhIHRhYmxl
IGFsbW9zdAorICogYXMgaXMgZnJvbSBCU3BlYyBpdHNlbGYgLSB0aGF0IHdheSBpdCBpcyBhdCBs
ZWFzdCBlYXNpZXIKKyAqIHRvIGNvbXBhcmUsIGNoYW5nZSBhbmQgY2hlY2suCisgKi8KK3N0cnVj
dCBkYnVmX3NsaWNlX2NvbmZfZW50cnkgaWNsX2FsbG93ZWRfZGJ1ZnNbXSA9IHsKK3sgeyAwLCAw
LCAwLCAwIH0sIDAgfSwKK0lDTF9QSVBFX0FfREJVRl9TTElDRVMoREJVRl9TMV9CSVQgfCBEQlVG
X1MyX0JJVCksICAvKiBwaXBlIHJhdGlvIDwgODguOCAqLworSUNMX1BJUEVfQV9EQlVGX1NMSUNF
UyhEQlVGX1MxX0JJVCksICAgICAgICAgICAgICAgIC8qIGZvciBwaXBlIHJhdGlvID49IDg4Ljgg
Ki8KK0lDTF9QSVBFX0JfREJVRl9TTElDRVMoREJVRl9TMV9CSVQgfCBEQlVGX1MyX0JJVCksICAv
KiBwaXBlIHJhdGlvIDwgODguOCAqLworSUNMX1BJUEVfQl9EQlVGX1NMSUNFUyhEQlVGX1MxX0JJ
VCksICAgICAgICAgICAgICAgIC8qIGZvciBwaXBlIHJhdGlvID49IDg4LjggKi8KK0lDTF9QSVBF
X0NfREJVRl9TTElDRVMoREJVRl9TMV9CSVQgfCBEQlVGX1MyX0JJVCksICAvKiBwaXBlIHJhdGlv
IDwgODguOCAqLworSUNMX1BJUEVfQ19EQlVGX1NMSUNFUyhEQlVGX1MyX0JJVCksICAgICAgICAg
ICAgICAgIC8qIGZvciBwaXBlIHJhdGlvID49IDg4LjggKi8KK0lDTF9QSVBFX0FCX0RCVUZfU0xJ
Q0VTKERCVUZfUzFfQklULCBEQlVGX1MyX0JJVCksCitJQ0xfUElQRV9BQ19EQlVGX1NMSUNFUyhE
QlVGX1MxX0JJVCwgREJVRl9TMl9CSVQpLAorSUNMX1BJUEVfQkNfREJVRl9TTElDRVMoREJVRl9T
MV9CSVQsIERCVUZfUzJfQklUKSwKK0lDTF9QSVBFX0FCQ19EQlVGX1NMSUNFUyhEQlVGX1MxX0JJ
VCwgREJVRl9TMV9CSVQsIERCVUZfUzJfQklUKSwKK307CisKKy8qCisgKiBUYWJsZSB0YWtlbiBm
cm9tIEJzcGVjIDQ5MjU1CisgKiBQaXBlcyBkbyBoYXZlIHNvbWUgcHJlZmVycmVkIERCdWYgc2xp
Y2UgYWZmaW5pdHksCisgKiBwbHVzIHRoZXJlIGFyZSBzb21lIGhhcmRjb2RlZCByZXF1aXJlbWVu
dHMgb24gaG93CisgKiB0aG9zZSBzaG91bGQgYmUgZGlzdHJpYnV0ZWQgZm9yIG11bHRpcGlwZSBz
Y2VuYXJpb3MuCisgKiBGb3IgbW9yZSBEQnVmIHNsaWNlcyBhbGdvcml0aG0gY2FuIGdldCBldmVu
IG1vcmUgbWVzc3kKKyAqIGFuZCBsZXNzIHJlYWRhYmxlLCBzbyBkZWNpZGVkIHRvIHVzZSBhIHRh
YmxlIGFsbW9zdAorICogYXMgaXMgZnJvbSBCU3BlYyBpdHNlbGYgLSB0aGF0IHdheSBpdCBpcyBh
dCBsZWFzdCBlYXNpZXIKKyAqIHRvIGNvbXBhcmUsIGNoYW5nZSBhbmQgY2hlY2suCisgKi8KK3N0
cnVjdCBkYnVmX3NsaWNlX2NvbmZfZW50cnkgdGdsX2FsbG93ZWRfZGJ1ZnNbXSA9IHsKK3sgeyAw
LCAwLCAwLCAwIH0sIDAgfSwKK0lDTF9QSVBFX0FfREJVRl9TTElDRVMoREJVRl9TMV9CSVQgfCBE
QlVGX1MyX0JJVCksCitJQ0xfUElQRV9CX0RCVUZfU0xJQ0VTKERCVUZfUzFfQklUIHwgREJVRl9T
Ml9CSVQpLAorSUNMX1BJUEVfQ19EQlVGX1NMSUNFUyhEQlVGX1MxX0JJVCB8IERCVUZfUzJfQklU
KSwKK0lDTF9QSVBFX0RfREJVRl9TTElDRVMoREJVRl9TMV9CSVQgfCBEQlVGX1MyX0JJVCksCitJ
Q0xfUElQRV9BQl9EQlVGX1NMSUNFUyhEQlVGX1MxX0JJVCwgREJVRl9TMl9CSVQpLAorSUNMX1BJ
UEVfQUNfREJVRl9TTElDRVMoREJVRl9TMV9CSVQsIERCVUZfUzJfQklUKSwKK0lDTF9QSVBFX0JD
X0RCVUZfU0xJQ0VTKERCVUZfUzFfQklULCBEQlVGX1MyX0JJVCksCitJQ0xfUElQRV9BRF9EQlVG
X1NMSUNFUyhEQlVGX1MxX0JJVCwgREJVRl9TMl9CSVQpLAorSUNMX1BJUEVfQkRfREJVRl9TTElD
RVMoREJVRl9TMV9CSVQsIERCVUZfUzJfQklUKSwKK0lDTF9QSVBFX0NEX0RCVUZfU0xJQ0VTKERC
VUZfUzFfQklULCBEQlVGX1MyX0JJVCksCitJQ0xfUElQRV9BQkRfREJVRl9TTElDRVMoREJVRl9T
MV9CSVQsIERCVUZfUzFfQklULCBEQlVGX1MyX0JJVCksCitJQ0xfUElQRV9BQkNfREJVRl9TTElD
RVMoREJVRl9TMV9CSVQsIERCVUZfUzFfQklULCBEQlVGX1MyX0JJVCksCitJQ0xfUElQRV9BQ0Rf
REJVRl9TTElDRVMoREJVRl9TMV9CSVQsIERCVUZfUzJfQklULCBEQlVGX1MyX0JJVCksCitJQ0xf
UElQRV9CQ0RfREJVRl9TTElDRVMoREJVRl9TMV9CSVQsIERCVUZfUzJfQklULCBEQlVGX1MyX0JJ
VCksCitJQ0xfUElQRV9BQkNEX0RCVUZfU0xJQ0VTKERCVUZfUzFfQklULCBEQlVGX1MxX0JJVCwg
REJVRl9TMl9CSVQsIERCVUZfUzJfQklUKSwKK307CisKKy8qCisgKiBUaGlzIGZ1bmN0aW9uIGZp
bmRzIGFuIGVudHJ5IHdpdGggc2FtZSBlbmFibGVkIHBpcGUgY29uZmlndXJhdGlvbiBhbmQKKyAq
IHJldHVybnMgY29ycmVzcG9uZGVudCBEQnVmIHNsaWNlIG1hc2sgYXMgc3RhdGVkIGluIEJTcGVj
IGZvciBwYXJ0aWN1bGFyCisgKiBwbGF0Zm9ybS4KKyAqLworc3RhdGljIHUzMiBpY2xfZ2V0X2Fs
bG93ZWRfZGJ1Zl9tYXNrKGludCBwaXBlLAorCQkJCSAgICAgdTMyIGFjdGl2ZV9waXBlcywKKwkJ
CQkgICAgIGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlKQoreworCWlu
dCBpOworCXVpbnRfZml4ZWRfMTZfMTZfdCBwaXBlX3JhdGlvOworCisJLyoKKwkgKiBDYWxjdWxh
dGUgcGlwZSByYXRpbyBhcyBzdGF0ZWQgaW4gQlNwZWMgMjg2OTIKKwkgKi8KKwlwaXBlX3JhdGlv
ID0gaWNsX2dldF9waXBlX3JhdGlvKGNydGNfc3RhdGUpOworCisJZm9yIChpID0gMDsgaSA8IEFS
UkFZX1NJWkUoaWNsX2FsbG93ZWRfZGJ1ZnMpOyBpKyspIHsKKwkJaWYgKGljbF9hbGxvd2VkX2Ri
dWZzW2ldLmFjdGl2ZV9waXBlcyA9PSBhY3RpdmVfcGlwZXMpIHsKKwkJCWlmIChod2VpZ2h0MzIo
YWN0aXZlX3BpcGVzKSA9PSAxKSB7CisJCQkJLyoKKwkJCQkgKiBBY2NvcmRpbmcgdG8gQlNwZWMg
MTI3MTY6IGlmIHJhdGlvID49IDg4LjgKKwkJCQkgKiBhbHdheXMgdXNlIHNpbmdsZSBkYnVmIHNs
aWNlLgorCQkJCSAqLworCQkJCWlmIChwaXBlX3JhdGlvLnZhbCA+PSBkaXZfZml4ZWQxNig4ODgs
IDEwKS52YWwpCisJCQkJCSsraTsKKwkJCX0KKwkJCXJldHVybiBpY2xfYWxsb3dlZF9kYnVmc1tp
XS5kYnVmX21hc2tbcGlwZV07CisJCX0KKwl9CisJcmV0dXJuIDA7Cit9CisKKy8qCisgKiBUaGlz
IGZ1bmN0aW9uIGZpbmRzIGFuIGVudHJ5IHdpdGggc2FtZSBlbmFibGVkIHBpcGUgY29uZmlndXJh
dGlvbiBhbmQKKyAqIHJldHVybnMgY29ycmVzcG9uZGVudCBEQnVmIHNsaWNlIG1hc2sgYXMgc3Rh
dGVkIGluIEJTcGVjIGZvciBwYXJ0aWN1bGFyCisgKiBwbGF0Zm9ybS4KKyAqLworc3RhdGljIHUz
MiB0Z2xfZ2V0X2FsbG93ZWRfZGJ1Zl9tYXNrKGludCBwaXBlLAorCQkJCSAgICAgdTMyIGFjdGl2
ZV9waXBlcywKKwkJCQkgICAgIGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0
YXRlKQoreworCWludCBpOworCisJZm9yIChpID0gMDsgaSA8IEFSUkFZX1NJWkUodGdsX2FsbG93
ZWRfZGJ1ZnMpOyBpKyspIHsKKwkJaWYgKHRnbF9hbGxvd2VkX2RidWZzW2ldLmFjdGl2ZV9waXBl
cyA9PSBhY3RpdmVfcGlwZXMpCisJCQlyZXR1cm4gdGdsX2FsbG93ZWRfZGJ1ZnNbaV0uZGJ1Zl9t
YXNrW3BpcGVdOworCX0KKwlyZXR1cm4gMDsKK30KKwordTMyIGk5MTVfZ2V0X2FsbG93ZWRfZGJ1
Zl9tYXNrKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKKwkJCQkgICAgICBpbnQg
cGlwZSwgdTMyIGFjdGl2ZV9waXBlcywKKwkJCQkgICAgICBjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0
Y19zdGF0ZSAqY3J0Y19zdGF0ZSkKK3sKKwlpZiAoSVNfR0VOKGRldl9wcml2LCAxMSkpCisJCXJl
dHVybiBpY2xfZ2V0X2FsbG93ZWRfZGJ1Zl9tYXNrKHBpcGUsCisJCQkJCQkgYWN0aXZlX3BpcGVz
LAorCQkJCQkJIGNydGNfc3RhdGUpOworCWVsc2UgaWYgKElTX0dFTihkZXZfcHJpdiwgMTIpKQor
CQlyZXR1cm4gdGdsX2dldF9hbGxvd2VkX2RidWZfbWFzayhwaXBlLAorCQkJCQkJIGFjdGl2ZV9w
aXBlcywKKwkJCQkJCSBjcnRjX3N0YXRlKTsKKwkvKgorCSAqIEZvciBhbnl0aGluZyBlbHNlIGp1
c3QgcmV0dXJuIG9uZSBzbGljZSB5ZXQuCisJICogU2hvdWxkIGJlIGV4dGVuZGVkIGZvciBvdGhl
ciBwbGF0Zm9ybXMuCisJICovCisJcmV0dXJuIERCVUZfUzFfQklUOworfQorCiBzdGF0aWMgdTY0
CiBpY2xfZ2V0X3RvdGFsX3JlbGF0aXZlX2RhdGFfcmF0ZShzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0
ZSAqY3J0Y19zdGF0ZSwKIAkJCQkgdTY0ICpwbGFuZV9kYXRhX3JhdGUpCi0tIAoyLjE3LjEKCl9f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fCkludGVsLWdmeCBt
YWlsaW5nIGxpc3QKSW50ZWwtZ2Z4QGxpc3RzLmZyZWVkZXNrdG9wLm9yZwpodHRwczovL2xpc3Rz
LmZyZWVkZXNrdG9wLm9yZy9tYWlsbWFuL2xpc3RpbmZvL2ludGVsLWdmeA==

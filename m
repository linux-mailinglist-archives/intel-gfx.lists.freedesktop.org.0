Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 5214E98BE8
	for <lists+intel-gfx@lfdr.de>; Thu, 22 Aug 2019 08:59:31 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id A6DB46EA64;
	Thu, 22 Aug 2019 06:59:29 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from fireflyinternet.com (mail.fireflyinternet.com [109.228.58.192])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 42FAC6EA64
 for <intel-gfx@lists.freedesktop.org>; Thu, 22 Aug 2019 06:59:28 +0000 (UTC)
X-Default-Received-SPF: pass (skip=forwardok (res=PASS))
 x-ip-name=78.156.65.138; 
Received: from haswell.alporthouse.com (unverified [78.156.65.138]) 
 by fireflyinternet.com (Firefly Internet (M1)) with ESMTP id 18222008-1500050 
 for multiple; Thu, 22 Aug 2019 07:59:19 +0100
From: Chris Wilson <chris@chris-wilson.co.uk>
To: intel-gfx@lists.freedesktop.org
Date: Thu, 22 Aug 2019 07:59:17 +0100
Message-Id: <20190822065917.18988-1-chris@chris-wilson.co.uk>
X-Mailer: git-send-email 2.23.0
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH] drm/i915: Kill the undead i915_gem_batch_pool.c
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

WW91IGhhdmUgdG8gY3V0IGl0IG9mZiBhdCB0aGUgbmVjaywgb3RoZXJ3aXNlIGl0IGp1c3QgcmVh
cHBlYXJzIGluIHRoZQpuZXh0IG1lcmdlLCBsaWtlIGNvbW1pdCAzZjg2NjAyNmYwY2UgKCJNZXJn
ZSBkcm0vZHJtLW5leHQKaW50byBkcm0taW50ZWwtbmV4dC1xdWV1ZWQiKQoKUmVmZXJlbmNlczog
M2Y4NjYwMjZmMGNlICgiTWVyZ2UgZHJtL2RybS1uZXh0IGludG8gZHJtLWludGVsLW5leHQtcXVl
dWVkIikKU2lnbmVkLW9mZi1ieTogQ2hyaXMgV2lsc29uIDxjaHJpc0BjaHJpcy13aWxzb24uY28u
dWs+CkNjOiBSb2RyaWdvIFZpdmkgPHJvZHJpZ28udml2aUBpbnRlbC5jb20+Ci0tLQogZHJpdmVy
cy9ncHUvZHJtL2k5MTUvaTkxNV9nZW1fYmF0Y2hfcG9vbC5jIHwgMTMyIC0tLS0tLS0tLS0tLS0t
LS0tLS0tLQogMSBmaWxlIGNoYW5nZWQsIDEzMiBkZWxldGlvbnMoLSkKIGRlbGV0ZSBtb2RlIDEw
MDY0NCBkcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2dlbV9iYXRjaF9wb29sLmMKCmRpZmYgLS1n
aXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2dlbV9iYXRjaF9wb29sLmMgYi9kcml2ZXJz
L2dwdS9kcm0vaTkxNS9pOTE1X2dlbV9iYXRjaF9wb29sLmMKZGVsZXRlZCBmaWxlIG1vZGUgMTAw
NjQ0CmluZGV4IDg2NzVhNjA4YTZmZS4uMDAwMDAwMDAwMDAwCi0tLSBhL2RyaXZlcnMvZ3B1L2Ry
bS9pOTE1L2k5MTVfZ2VtX2JhdGNoX3Bvb2wuYworKysgL2Rldi9udWxsCkBAIC0xLDEzMiArMCww
IEBACi0vKgotICogU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IE1JVAotICoKLSAqIENvcHlyaWdo
dCDCqSAyMDE0LTIwMTggSW50ZWwgQ29ycG9yYXRpb24KLSAqLwotCi0jaW5jbHVkZSAiaTkxNV9n
ZW1fYmF0Y2hfcG9vbC5oIgotI2luY2x1ZGUgImk5MTVfZHJ2LmgiCi0KLS8qKgotICogRE9DOiBi
YXRjaCBwb29sCi0gKgotICogSW4gb3JkZXIgdG8gc3VibWl0IGJhdGNoIGJ1ZmZlcnMgYXMgJ3Nl
Y3VyZScsIHRoZSBzb2Z0d2FyZSBjb21tYW5kIHBhcnNlcgotICogbXVzdCBlbnN1cmUgdGhhdCBh
IGJhdGNoIGJ1ZmZlciBjYW5ub3QgYmUgbW9kaWZpZWQgYWZ0ZXIgcGFyc2luZy4gSXQgZG9lcwot
ICogdGhpcyBieSBjb3B5aW5nIHRoZSB1c2VyIHByb3ZpZGVkIGJhdGNoIGJ1ZmZlciBjb250ZW50
cyB0byBhIGtlcm5lbCBvd25lZAotICogYnVmZmVyIGZyb20gd2hpY2ggdGhlIGhhcmR3YXJlIHdp
bGwgYWN0dWFsbHkgZXhlY3V0ZSwgYW5kIGJ5IGNhcmVmdWxseQotICogbWFuYWdpbmcgdGhlIGFk
ZHJlc3Mgc3BhY2UgYmluZGluZ3MgZm9yIHN1Y2ggYnVmZmVycy4KLSAqCi0gKiBUaGUgYmF0Y2gg
cG9vbCBmcmFtZXdvcmsgcHJvdmlkZXMgYSBtZWNoYW5pc20gZm9yIHRoZSBkcml2ZXIgdG8gbWFu
YWdlIGEKLSAqIHNldCBvZiBzY3JhdGNoIGJ1ZmZlcnMgdG8gdXNlIGZvciB0aGlzIHB1cnBvc2Uu
IFRoZSBmcmFtZXdvcmsgY2FuIGJlCi0gKiBleHRlbmRlZCB0byBzdXBwb3J0IG90aGVyIHVzZXMg
Y2FzZXMgc2hvdWxkIHRoZXkgYXJpc2UuCi0gKi8KLQotLyoqCi0gKiBpOTE1X2dlbV9iYXRjaF9w
b29sX2luaXQoKSAtIGluaXRpYWxpemUgYSBiYXRjaCBidWZmZXIgcG9vbAotICogQHBvb2w6IHRo
ZSBiYXRjaCBidWZmZXIgcG9vbAotICogQGVuZ2luZTogdGhlIGFzc29jaWF0ZWQgcmVxdWVzdCBz
dWJtaXNzaW9uIGVuZ2luZQotICovCi12b2lkIGk5MTVfZ2VtX2JhdGNoX3Bvb2xfaW5pdChzdHJ1
Y3QgaTkxNV9nZW1fYmF0Y2hfcG9vbCAqcG9vbCwKLQkJCSAgICAgIHN0cnVjdCBpbnRlbF9lbmdp
bmVfY3MgKmVuZ2luZSkKLXsKLQlpbnQgbjsKLQotCXBvb2wtPmVuZ2luZSA9IGVuZ2luZTsKLQot
CWZvciAobiA9IDA7IG4gPCBBUlJBWV9TSVpFKHBvb2wtPmNhY2hlX2xpc3QpOyBuKyspCi0JCUlO
SVRfTElTVF9IRUFEKCZwb29sLT5jYWNoZV9saXN0W25dKTsKLX0KLQotLyoqCi0gKiBpOTE1X2dl
bV9iYXRjaF9wb29sX2ZpbmkoKSAtIGNsZWFuIHVwIGEgYmF0Y2ggYnVmZmVyIHBvb2wKLSAqIEBw
b29sOiB0aGUgcG9vbCB0byBjbGVhbiB1cAotICoKLSAqIE5vdGU6IENhbGxlcnMgbXVzdCBob2xk
IHRoZSBzdHJ1Y3RfbXV0ZXguCi0gKi8KLXZvaWQgaTkxNV9nZW1fYmF0Y2hfcG9vbF9maW5pKHN0
cnVjdCBpOTE1X2dlbV9iYXRjaF9wb29sICpwb29sKQotewotCWludCBuOwotCi0JbG9ja2RlcF9h
c3NlcnRfaGVsZCgmcG9vbC0+ZW5naW5lLT5pOTE1LT5kcm0uc3RydWN0X211dGV4KTsKLQotCWZv
ciAobiA9IDA7IG4gPCBBUlJBWV9TSVpFKHBvb2wtPmNhY2hlX2xpc3QpOyBuKyspIHsKLQkJc3Ry
dWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iaiwgKm5leHQ7Ci0KLQkJbGlzdF9mb3JfZWFjaF9l
bnRyeV9zYWZlKG9iaiwgbmV4dCwKLQkJCQkJICZwb29sLT5jYWNoZV9saXN0W25dLAotCQkJCQkg
YmF0Y2hfcG9vbF9saW5rKQotCQkJaTkxNV9nZW1fb2JqZWN0X3B1dChvYmopOwotCi0JCUlOSVRf
TElTVF9IRUFEKCZwb29sLT5jYWNoZV9saXN0W25dKTsKLQl9Ci19Ci0KLS8qKgotICogaTkxNV9n
ZW1fYmF0Y2hfcG9vbF9nZXQoKSAtIGFsbG9jYXRlIGEgYnVmZmVyIGZyb20gdGhlIHBvb2wKLSAq
IEBwb29sOiB0aGUgYmF0Y2ggYnVmZmVyIHBvb2wKLSAqIEBzaXplOiB0aGUgbWluaW11bSBkZXNp
cmVkIHNpemUgb2YgdGhlIHJldHVybmVkIGJ1ZmZlcgotICoKLSAqIFJldHVybnMgYW4gaW5hY3Rp
dmUgYnVmZmVyIGZyb20gQHBvb2wgd2l0aCBhdCBsZWFzdCBAc2l6ZSBieXRlcywKLSAqIHdpdGgg
dGhlIHBhZ2VzIHBpbm5lZC4gVGhlIGNhbGxlciBtdXN0IGk5MTVfZ2VtX29iamVjdF91bnBpbl9w
YWdlcygpCi0gKiBvbiB0aGUgcmV0dXJuZWQgb2JqZWN0LgotICoKLSAqIE5vdGU6IENhbGxlcnMg
bXVzdCBob2xkIHRoZSBzdHJ1Y3RfbXV0ZXgKLSAqCi0gKiBSZXR1cm46IHRoZSBidWZmZXIgb2Jq
ZWN0IG9yIGFuIGVycm9yIHBvaW50ZXIKLSAqLwotc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3Qg
KgotaTkxNV9nZW1fYmF0Y2hfcG9vbF9nZXQoc3RydWN0IGk5MTVfZ2VtX2JhdGNoX3Bvb2wgKnBv
b2wsCi0JCQlzaXplX3Qgc2l6ZSkKLXsKLQlzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2Jq
OwotCXN0cnVjdCBsaXN0X2hlYWQgKmxpc3Q7Ci0JaW50IG4sIHJldDsKLQotCWxvY2tkZXBfYXNz
ZXJ0X2hlbGQoJnBvb2wtPmVuZ2luZS0+aTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7Ci0KLQkvKiBD
b21wdXRlIGEgcG93ZXItb2YtdHdvIGJ1Y2tldCwgYnV0IHRocm93IGV2ZXJ5dGhpbmcgZ3JlYXRl
ciB0aGFuCi0JICogMTZLaUIgaW50byB0aGUgc2FtZSBidWNrZXQ6IGkuZS4gdGhlIHRoZSBidWNr
ZXRzIGhvbGQgb2JqZWN0cyBvZgotCSAqICgxIHBhZ2UsIDIgcGFnZXMsIDQgcGFnZXMsIDgrIHBh
Z2VzKS4KLQkgKi8KLQluID0gZmxzKHNpemUgPj4gUEFHRV9TSElGVCkgLSAxOwotCWlmIChuID49
IEFSUkFZX1NJWkUocG9vbC0+Y2FjaGVfbGlzdCkpCi0JCW4gPSBBUlJBWV9TSVpFKHBvb2wtPmNh
Y2hlX2xpc3QpIC0gMTsKLQlsaXN0ID0gJnBvb2wtPmNhY2hlX2xpc3Rbbl07Ci0KLQlsaXN0X2Zv
cl9lYWNoX2VudHJ5KG9iaiwgbGlzdCwgYmF0Y2hfcG9vbF9saW5rKSB7Ci0JCXN0cnVjdCBkbWFf
cmVzdiAqcmVzdiA9IG9iai0+YmFzZS5yZXN2OwotCi0JCS8qIFRoZSBiYXRjaGVzIGFyZSBzdHJp
Y3RseSBMUlUgb3JkZXJlZCAqLwotCQlpZiAoIWRtYV9yZXN2X3Rlc3Rfc2lnbmFsZWRfcmN1KHJl
c3YsIHRydWUpKQotCQkJYnJlYWs7Ci0KLQkJLyoKLQkJICogVGhlIG9iamVjdCBpcyBub3cgaWRs
ZSwgY2xlYXIgdGhlIGFycmF5IG9mIHNoYXJlZAotCQkgKiBmZW5jZXMgYmVmb3JlIHdlIGFkZCBh
IG5ldyByZXF1ZXN0LiBBbHRob3VnaCwgd2UKLQkJICogcmVtYWluIG9uIHRoZSBzYW1lIGVuZ2lu
ZSwgd2UgbWF5IGJlIG9uIGEgZGlmZmVyZW50Ci0JCSAqIHRpbWVsaW5lIGFuZCBzbyBtYXkgY29u
dGludWFsbHkgZ3JvdyB0aGUgYXJyYXksCi0JCSAqIHRyYXBwaW5nIGEgcmVmZXJlbmNlIHRvIGFs
bCB0aGUgb2xkIGZlbmNlcywgcmF0aGVyCi0JCSAqIHRoYW4gcmVwbGFjZSB0aGUgZXhpc3Rpbmcg
ZmVuY2UuCi0JCSAqLwotCQlpZiAocmN1X2FjY2Vzc19wb2ludGVyKHJlc3YtPmZlbmNlKSkgewot
CQkJZG1hX3Jlc3ZfbG9jayhyZXN2LCBOVUxMKTsKLQkJCWRtYV9yZXN2X2FkZF9leGNsX2ZlbmNl
KHJlc3YsIE5VTEwpOwotCQkJZG1hX3Jlc3ZfdW5sb2NrKHJlc3YpOwotCQl9Ci0KLQkJaWYgKG9i
ai0+YmFzZS5zaXplID49IHNpemUpCi0JCQlnb3RvIGZvdW5kOwotCX0KLQotCW9iaiA9IGk5MTVf
Z2VtX29iamVjdF9jcmVhdGVfaW50ZXJuYWwocG9vbC0+ZW5naW5lLT5pOTE1LCBzaXplKTsKLQlp
ZiAoSVNfRVJSKG9iaikpCi0JCXJldHVybiBvYmo7Ci0KLWZvdW5kOgotCXJldCA9IGk5MTVfZ2Vt
X29iamVjdF9waW5fcGFnZXMob2JqKTsKLQlpZiAocmV0KQotCQlyZXR1cm4gRVJSX1BUUihyZXQp
OwotCi0JbGlzdF9tb3ZlX3RhaWwoJm9iai0+YmF0Y2hfcG9vbF9saW5rLCBsaXN0KTsKLQlyZXR1
cm4gb2JqOwotfQotLSAKMi4yMy4wCgpfX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fXwpJbnRlbC1nZnggbWFpbGluZyBsaXN0CkludGVsLWdmeEBsaXN0cy5mcmVl
ZGVza3RvcC5vcmcKaHR0cHM6Ly9saXN0cy5mcmVlZGVza3RvcC5vcmcvbWFpbG1hbi9saXN0aW5m
by9pbnRlbC1nZng=

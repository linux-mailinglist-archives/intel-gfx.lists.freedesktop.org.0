Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id A7201113002
	for <lists+intel-gfx@lfdr.de>; Wed,  4 Dec 2019 17:28:51 +0100 (CET)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id EBEC26E926;
	Wed,  4 Dec 2019 16:28:49 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from fireflyinternet.com (mail.fireflyinternet.com [109.228.58.192])
 by gabe.freedesktop.org (Postfix) with ESMTPS id B6F106E926;
 Wed,  4 Dec 2019 16:28:47 +0000 (UTC)
X-Default-Received-SPF: pass (skip=forwardok (res=PASS))
 x-ip-name=78.156.65.138; 
Received: from haswell.alporthouse.com (unverified [78.156.65.138]) 
 by fireflyinternet.com (Firefly Internet (M1)) with ESMTP id 19459404-1500050 
 for multiple; Wed, 04 Dec 2019 16:28:34 +0000
From: Chris Wilson <chris@chris-wilson.co.uk>
To: intel-gfx@lists.freedesktop.org
Date: Wed,  4 Dec 2019 16:28:35 +0000
Message-Id: <20191204162835.3842813-2-chris@chris-wilson.co.uk>
X-Mailer: git-send-email 2.24.0
In-Reply-To: <20191204162835.3842813-1-chris@chris-wilson.co.uk>
References: <20191204162835.3842813-1-chris@chris-wilson.co.uk>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH i-g-t 2/2] tests/i915/gem_mmap_offset: Add new
 API test for gem_mmap_offset
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Cc: igt-dev@lists.freedesktop.org
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

RnJvbTogTHVrYXN6IEthbGFtYXJ6IDxsdWthc3oua2FsYW1hcnpAaW50ZWwuY29tPgoKRmV3IHNp
bXBsZSB0ZXN0cyB3aGljaCB0cmllcyB0byBjcmVhdGUgLyBtbWFwIGJ1ZmZlciBvYmplY3RzCnVz
aW5nIEdFTV9NTUFQX09GRlNFVCB1QVBJLgoKdjI6IGNoYW5nZSBmcm9tIFdDIC0+IFdCIChhY2Nv
cmRpbmcgdG8gQ2hyaXMgcmV2aWV3IGNvbW1lbnQpCnYzOiBhZGQgbW1hcC1vZmZzZXQtY2xvc2Ut
cmFjZSB0ZXN0CgpTaWduZWQtb2ZmLWJ5OiBMdWthc3ogS2FsYW1hcnogPGx1a2Fzei5rYWxhbWFy
ekBpbnRlbC5jb20+ClNpZ25lZC1vZmYtYnk6IFpiaWduaWV3IEtlbXBjennFhHNraSA8emJpZ25p
ZXcua2VtcGN6eW5za2lAaW50ZWwuY29tPgpDYzogQ2hyaXMgV2lsc29uIDxjaHJpc0BjaHJpcy13
aWxzb24uY28udWs+CkNjOiBWYW5zaGlkaGFyIEtvbmRhIDx2YW5zaGlkaGFyLnIua29uZGFAaW50
ZWwuY29tPgotLS0KUmVxdWlyZWQgKGxvb2sgdG8gZ2VtX21tYXBfKGd0dCx3YyxjcHUpIGZvciBp
ZGVhcyk6CiBzaXplIC0gY2hlY2sgd2UgY2FuIGhhbmRsZSBvYmplY3RzIGJleW9uZCBhIHJlYXNv
bmFibGUgbGltaXQgKG5vdGUgdGhlCmtlcm5lbCBmYWlscyBhdCBiZXlvbmQgUkFNKQogZm9ya2Vk
IC0gaW50ZXJhY3Rpb25zIHdpdGggcGFnZWZhdWx0ICsgbmV3IG1tYXBfb2Zmc2V0cyBhY3Jvc3MK
ICAgICAgICAgIHRocmVhZHMvcHJvY2Vzc2VzCiBzdXNwZW5kIC0gY2hlY2sgc3BlZWQgaXMgY29u
c2lzdGVudCBiZWZvcmUvYWZ0ZXIgc3VzcGVuZAogY29oZXJlbmN5IC0gY29tYmluYXRvcmlhbCBj
aGVja2VyIGJldHdlZW4gYWxsIHBvaW50ZXIgdHlwZXMsIHBydyBhbmQgZ3B1Ci0tLQogdGVzdHMv
TWFrZWZpbGUuc291cmNlcyAgICAgICB8ICAgMyArCiB0ZXN0cy9pOTE1L2dlbV9tbWFwX29mZnNl
dC5jIHwgNDgzICsrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrCiB0ZXN0cy9tZXNv
bi5idWlsZCAgICAgICAgICAgIHwgICAxICsKIDMgZmlsZXMgY2hhbmdlZCwgNDg3IGluc2VydGlv
bnMoKykKIGNyZWF0ZSBtb2RlIDEwMDY0NCB0ZXN0cy9pOTE1L2dlbV9tbWFwX29mZnNldC5jCgpk
aWZmIC0tZ2l0IGEvdGVzdHMvTWFrZWZpbGUuc291cmNlcyBiL3Rlc3RzL01ha2VmaWxlLnNvdXJj
ZXMKaW5kZXggMTc5ODBlZDYwLi4wZGU5MDhkZTIgMTAwNjQ0Ci0tLSBhL3Rlc3RzL01ha2VmaWxl
LnNvdXJjZXMKKysrIGIvdGVzdHMvTWFrZWZpbGUuc291cmNlcwpAQCAtMzE4LDYgKzMxOCw5IEBA
IGdlbV9tbWFwX1NPVVJDRVMgPSBpOTE1L2dlbV9tbWFwLmMKIFRFU1RTX3Byb2dzICs9IGdlbV9t
bWFwX2d0dAogZ2VtX21tYXBfZ3R0X1NPVVJDRVMgPSBpOTE1L2dlbV9tbWFwX2d0dC5jCiAKK1RF
U1RTX3Byb2dzICs9IGdlbV9tbWFwX29mZnNldAorZ2VtX21tYXBfb2Zmc2V0X1NPVVJDRVMgPSBp
OTE1L2dlbV9tbWFwX29mZnNldC5jCisKIFRFU1RTX3Byb2dzICs9IGdlbV9tbWFwX29mZnNldF9l
eGhhdXN0aW9uCiBnZW1fbW1hcF9vZmZzZXRfZXhoYXVzdGlvbl9TT1VSQ0VTID0gaTkxNS9nZW1f
bW1hcF9vZmZzZXRfZXhoYXVzdGlvbi5jCiAKZGlmZiAtLWdpdCBhL3Rlc3RzL2k5MTUvZ2VtX21t
YXBfb2Zmc2V0LmMgYi90ZXN0cy9pOTE1L2dlbV9tbWFwX29mZnNldC5jCm5ldyBmaWxlIG1vZGUg
MTAwNjQ0CmluZGV4IDAwMDAwMDAwMC4uN2M0MDg4Y2RmCi0tLSAvZGV2L251bGwKKysrIGIvdGVz
dHMvaTkxNS9nZW1fbW1hcF9vZmZzZXQuYwpAQCAtMCwwICsxLDQ4MyBAQAorLyoKKyAqIENvcHly
aWdodCDCqSAyMDE5IEludGVsIENvcnBvcmF0aW9uCisgKgorICogUGVybWlzc2lvbiBpcyBoZXJl
YnkgZ3JhbnRlZCwgZnJlZSBvZiBjaGFyZ2UsIHRvIGFueSBwZXJzb24gb2J0YWluaW5nIGEKKyAq
IGNvcHkgb2YgdGhpcyBzb2Z0d2FyZSBhbmQgYXNzb2NpYXRlZCBkb2N1bWVudGF0aW9uIGZpbGVz
ICh0aGUgIlNvZnR3YXJlIiksCisgKiB0byBkZWFsIGluIHRoZSBTb2Z0d2FyZSB3aXRob3V0IHJl
c3RyaWN0aW9uLCBpbmNsdWRpbmcgd2l0aG91dCBsaW1pdGF0aW9uCisgKiB0aGUgcmlnaHRzIHRv
IHVzZSwgY29weSwgbW9kaWZ5LCBtZXJnZSwgcHVibGlzaCwgZGlzdHJpYnV0ZSwgc3VibGljZW5z
ZSwKKyAqIGFuZC9vciBzZWxsIGNvcGllcyBvZiB0aGUgU29mdHdhcmUsIGFuZCB0byBwZXJtaXQg
cGVyc29ucyB0byB3aG9tIHRoZQorICogU29mdHdhcmUgaXMgZnVybmlzaGVkIHRvIGRvIHNvLCBz
dWJqZWN0IHRvIHRoZSBmb2xsb3dpbmcgY29uZGl0aW9uczoKKyAqCisgKiBUaGUgYWJvdmUgY29w
eXJpZ2h0IG5vdGljZSBhbmQgdGhpcyBwZXJtaXNzaW9uIG5vdGljZSAoaW5jbHVkaW5nIHRoZSBu
ZXh0CisgKiBwYXJhZ3JhcGgpIHNoYWxsIGJlIGluY2x1ZGVkIGluIGFsbCBjb3BpZXMgb3Igc3Vi
c3RhbnRpYWwgcG9ydGlvbnMgb2YgdGhlCisgKiBTb2Z0d2FyZS4KKyAqCisgKiBUSEUgU09GVFdB
UkUgSVMgUFJPVklERUQgIkFTIElTIiwgV0lUSE9VVCBXQVJSQU5UWSBPRiBBTlkgS0lORCwgRVhQ
UkVTUyBPUgorICogSU1QTElFRCwgSU5DTFVESU5HIEJVVCBOT1QgTElNSVRFRCBUTyBUSEUgV0FS
UkFOVElFUyBPRiBNRVJDSEFOVEFCSUxJVFksCisgKiBGSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIg
UFVSUE9TRSBBTkQgTk9OSU5GUklOR0VNRU5ULiAgSU4gTk8gRVZFTlQgU0hBTEwKKyAqIFRIRSBB
VVRIT1JTIE9SIENPUFlSSUdIVCBIT0xERVJTIEJFIExJQUJMRSBGT1IgQU5ZIENMQUlNLCBEQU1B
R0VTIE9SIE9USEVSCisgKiBMSUFCSUxJVFksIFdIRVRIRVIgSU4gQU4gQUNUSU9OIE9GIENPTlRS
QUNULCBUT1JUIE9SIE9USEVSV0lTRSwgQVJJU0lORworICogRlJPTSwgT1VUIE9GIE9SIElOIENP
Tk5FQ1RJT04gV0lUSCBUSEUgU09GVFdBUkUgT1IgVEhFIFVTRSBPUiBPVEhFUiBERUFMSU5HUwor
ICogSU4gVEhFIFNPRlRXQVJFLgorICovCisKKyNpbmNsdWRlIDxlcnJuby5oPgorI2luY2x1ZGUg
PHB0aHJlYWQuaD4KKyNpbmNsdWRlIDxzdGRhdG9taWMuaD4KKyNpbmNsdWRlIDxzeXMvc3RhdC5o
PgorI2luY2x1ZGUgPHN5cy9pb2N0bC5oPgorI2luY2x1ZGUgImRybS5oIgorCisjaW5jbHVkZSAi
aWd0LmgiCisjaW5jbHVkZSAiaWd0X3g4Ni5oIgorCitJR1RfVEVTVF9ERVNDUklQVElPTigiQmFz
aWMgTU1BUF9PRkZTRVQgSU9DVEwgdGVzdHMgZm9yIG1lbSByZWdpb25zXG4iKTsKKworc3RhdGlj
IGNvbnN0IHN0cnVjdCBtbWFwX29mZnNldCB7CisJY29uc3QgY2hhciAqbmFtZTsKKwl1bnNpZ25l
ZCBpbnQgdHlwZTsKKwl1bnNpZ25lZCBpbnQgZG9tYWluOworfSBtbWFwX29mZnNldF90eXBlc1td
ID0geworCXsgImd0dCIsIEk5MTVfTU1BUF9PRkZTRVRfR1RULCBJOTE1X0dFTV9ET01BSU5fR1RU
IH0sCisJeyAid2IiLCBJOTE1X01NQVBfT0ZGU0VUX1dCLCBJOTE1X0dFTV9ET01BSU5fQ1BVIH0s
CisJeyAid2MiLCBJOTE1X01NQVBfT0ZGU0VUX1dDLCBJOTE1X0dFTV9ET01BSU5fV0MgfSwKKwl7
ICJ1YyIsIEk5MTVfTU1BUF9PRkZTRVRfVUMsIEk5MTVfR0VNX0RPTUFJTl9XQyB9LAorCXt9LAor
fTsKKworI2RlZmluZSBmb3JfZWFjaF9tbWFwX29mZnNldF90eXBlKF9fdCkgXAorCWZvciAoY29u
c3Qgc3RydWN0IG1tYXBfb2Zmc2V0ICpfX3QgPSBtbWFwX29mZnNldF90eXBlczsgXAorCSAgICAg
KF9fdCktPm5hbWU7IFwKKwkgICAgIChfX3QpKyspCisKK3N0YXRpYyBpbnQgbW1hcF9vZmZzZXRf
aW9jdGwoaW50IGk5MTUsIHN0cnVjdCBkcm1faTkxNV9nZW1fbW1hcF9vZmZzZXQgKmFyZykKK3sK
KwlpbnQgZXJyID0gMDsKKworCWlmIChpZ3RfaW9jdGwoaTkxNSwgRFJNX0lPQ1RMX0k5MTVfR0VN
X01NQVBfT0ZGU0VULCBhcmcpKSB7CisJCWVyciA9IC1lcnJubzsKKwkJaWd0X2Fzc3VtZShlcnIp
OworCX0KKworCWVycm5vID0gMDsKKwlyZXR1cm4gZXJyOworfQorCitzdGF0aWMgdm9pZCAqCitf
X21tYXBfb2Zmc2V0KGludCBpOTE1LCB1aW50MzJfdCBoYW5kbGUsIHVpbnQ2NF90IG9mZnNldCwg
dWludDY0X3Qgc2l6ZSwKKwkgICAgICB1bnNpZ25lZCBpbnQgcHJvdCwgdWludDY0X3QgZmxhZ3Mp
Cit7CisJc3RydWN0IGRybV9pOTE1X2dlbV9tbWFwX29mZnNldCBhcmcgPSB7CisJCS5oYW5kbGUg
PSBoYW5kbGUsCisJCS5mbGFncyA9IGZsYWdzLAorCX07CisJdm9pZCAqcHRyOworCisJaWYgKG1t
YXBfb2Zmc2V0X2lvY3RsKGk5MTUsICZhcmcpKQorCQlyZXR1cm4gTlVMTDsKKworCXB0ciA9IG1t
YXA2NCgwLCBzaXplLCBwcm90LCBNQVBfU0hBUkVELCBpOTE1LCBhcmcub2Zmc2V0ICsgb2Zmc2V0
KTsKKwlpZiAocHRyID09IE1BUF9GQUlMRUQpCisJCXB0ciA9IE5VTEw7CisJZWxzZQorCQllcnJu
byA9IDA7CisKKwlyZXR1cm4gcHRyOworfQorCitzdGF0aWMgdm9pZCBiYWRfb2JqZWN0KGludCBp
OTE1KQoreworCXVpbnQzMl90IHJlYWxfaGFuZGxlOworCXVpbnQzMl90IGhhbmRsZXNbMjBdOwor
CWludCBpID0gMDsKKworCXJlYWxfaGFuZGxlID0gZ2VtX2NyZWF0ZShpOTE1LCA0MDk2KTsKKwor
CWhhbmRsZXNbaSsrXSA9IDB4ZGVhZGJlZWY7CisJZm9yIChpbnQgYml0ID0gMDsgYml0IDwgMTY7
IGJpdCsrKQorCQloYW5kbGVzW2krK10gPSByZWFsX2hhbmRsZSB8ICgxIDw8IChiaXQgKyAxNikp
OworCWhhbmRsZXNbaV0gPSByZWFsX2hhbmRsZSArIDE7CisKKwlmb3IgKDsgaSA+PSAwOyBpLS0p
IHsKKwkJc3RydWN0IGRybV9pOTE1X2dlbV9tbWFwX29mZnNldCBhcmcgPSB7CisJCQkuaGFuZGxl
ID0gaGFuZGxlc1tpXSwKKwkJCS5mbGFncyA9IEk5MTVfTU1BUF9PRkZTRVRfV0IsCisJCX07CisK
KwkJaWd0X2RlYnVnKCJUcnlpbmcgTU1BUCBJT0NUTCB3aXRoIGhhbmRsZSAleFxuIiwKKwkJCSAg
aGFuZGxlc1tpXSk7CisJCWlndF9hc3NlcnRfZXEobW1hcF9vZmZzZXRfaW9jdGwoaTkxNSwgJmFy
ZyksCisJCQkgICAgICAtRU5PRU5UKTsKKwl9CisKKwlnZW1fY2xvc2UoaTkxNSwgcmVhbF9oYW5k
bGUpOworfQorCitzdGF0aWMgdm9pZCBiYWRfZmxhZ3MoaW50IGk5MTUpCit7CisJc3RydWN0IGRy
bV9pOTE1X2dlbV9tbWFwX29mZnNldCBhcmcgPSB7CisJCS5oYW5kbGUgPSBnZW1fY3JlYXRlKGk5
MTUsIDQwOTYpLAorCQkuZmxhZ3MgPSAtMXVsbCwKKwl9OworCisJaWd0X2Fzc2VydF9lcShtbWFw
X29mZnNldF9pb2N0bChpOTE1LCAmYXJnKSwgLUVJTlZBTCk7CisJZ2VtX2Nsb3NlKGk5MTUsIGFy
Zy5oYW5kbGUpOworfQorCitzdGF0aWMgdm9pZCBiYWRfZXh0ZW5zaW9ucyhpbnQgaTkxNSkKK3sK
KwlzdHJ1Y3QgaTkxNV91c2VyX2V4dGVuc2lvbiBleHQ7CisJc3RydWN0IGRybV9pOTE1X2dlbV9t
bWFwX29mZnNldCBhcmcgPSB7CisJCS5oYW5kbGUgPSBnZW1fY3JlYXRlKGk5MTUsIDQwOTYpLAor
CQkuZXh0ZW5zaW9ucyA9IC0xdWxsLAorCX07CisKKwlpZ3RfYXNzZXJ0X2VxKG1tYXBfb2Zmc2V0
X2lvY3RsKGk5MTUsICZhcmcpLCAtRUZBVUxUKTsKKwlhcmcuZXh0ZW5zaW9ucyA9IHRvX3VzZXJf
cG9pbnRlcigmZXh0KTsKKworCWV4dC5uYW1lID0gLTE7CisJaWd0X2Fzc2VydF9lcShtbWFwX29m
ZnNldF9pb2N0bChpOTE1LCAmYXJnKSwgLUVJTlZBTCk7CisKKwlnZW1fY2xvc2UoaTkxNSwgYXJn
LmhhbmRsZSk7Cit9CisKK3N0YXRpYyB2b2lkIGJhc2ljX3VhZihpbnQgaTkxNSkKK3sKKwljb25z
dCB1aW50MzJfdCBvYmpfc2l6ZSA9IDQwOTY7CisKKwlmb3JfZWFjaF9tbWFwX29mZnNldF90eXBl
KHQpIHsKKwkJdWludDMyX3QgaGFuZGxlID0gZ2VtX2NyZWF0ZShpOTE1LCBvYmpfc2l6ZSk7CisJ
CXVpbnQ4X3QgKmV4cGVjdGVkLCAqYnVmLCAqYWRkcjsKKworCQlhZGRyID0gX19tbWFwX29mZnNl
dChpOTE1LCBoYW5kbGUsIDAsIG9ial9zaXplLAorCQkJCSAgICAgUFJPVF9SRUFEIHwgUFJPVF9X
UklURSwKKwkJCQkgICAgIHQtPnR5cGUpOworCQlpZiAoIWFkZHIpIHsKKwkJCWdlbV9jbG9zZShp
OTE1LCBoYW5kbGUpOworCQkJY29udGludWU7CisJCX0KKworCQlleHBlY3RlZCA9IGNhbGxvYyhv
Ympfc2l6ZSwgc2l6ZW9mKCpleHBlY3RlZCkpOworCQlnZW1fc2V0X2RvbWFpbihpOTE1LCBoYW5k
bGUsIHQtPmRvbWFpbiwgMCk7CisJCWlndF9hc3NlcnRfZihtZW1jbXAoYWRkciwgZXhwZWN0ZWQs
IG9ial9zaXplKSA9PSAwLAorCQkJICAgICAibW1hcCglcykgbm90IGNsZWFyIG9uIGdlbV9jcmVh
dGUoKVxuIiwKKwkJCSAgICAgdC0+bmFtZSk7CisJCWZyZWUoZXhwZWN0ZWQpOworCisJCWJ1ZiA9
IGNhbGxvYyhvYmpfc2l6ZSwgc2l6ZW9mKCpidWYpKTsKKwkJbWVtc2V0KGJ1ZiArIDEwMjQsIDB4
MDEsIDEwMjQpOworCQlnZW1fd3JpdGUoaTkxNSwgaGFuZGxlLCAwLCBidWYsIG9ial9zaXplKTsK
KwkJZ2VtX3NldF9kb21haW4oaTkxNSwgaGFuZGxlLCB0LT5kb21haW4sIDApOworCQlpZ3RfYXNz
ZXJ0X2YobWVtY21wKGJ1ZiwgYWRkciwgb2JqX3NpemUpID09IDAsCisJCQkgICAgICJtbWFwKCVz
KSBub3QgY29oZXJlbnQgd2l0aCBnZW1fd3JpdGUoKVxuIiwKKwkJCSAgICAgdC0+bmFtZSk7CisK
KwkJZ2VtX3NldF9kb21haW4oaTkxNSwgaGFuZGxlLCB0LT5kb21haW4sIHQtPmRvbWFpbik7CisJ
CW1lbXNldChhZGRyICsgMjA0OCwgMHhmZiwgMTAyNCk7CisJCWdlbV9yZWFkKGk5MTUsIGhhbmRs
ZSwgMCwgYnVmLCBvYmpfc2l6ZSk7CisJCWdlbV9zZXRfZG9tYWluKGk5MTUsIGhhbmRsZSwgdC0+
ZG9tYWluLCAwKTsKKwkJaWd0X2Fzc2VydF9mKG1lbWNtcChidWYsIGFkZHIsIG9ial9zaXplKSA9
PSAwLAorCQkJICAgICAibW1hcCglcykgbm90IGNvaGVyZW50IHdpdGggZ2VtX3JlYWQoKVxuIiwK
KwkJCSAgICAgdC0+bmFtZSk7CisKKwkJZ2VtX2Nsb3NlKGk5MTUsIGhhbmRsZSk7CisJCWlndF9h
c3NlcnRfZihtZW1jbXAoYnVmLCBhZGRyLCBvYmpfc2l6ZSkgPT0gMCwKKwkJCSAgICAgIm1tYXAo
JXMpIG5vdCByZXNpZGVudCBhZnRlciBnZW1fY2xvc2UoKVxuIiwKKwkJCSAgICAgdC0+bmFtZSk7
CisJCWZyZWUoYnVmKTsKKworCQlpZ3RfZGVidWcoIlRlc3RpbmcgdW5tYXBwaW5nXG4iKTsKKwkJ
bXVubWFwKGFkZHIsIG9ial9zaXplKTsKKwl9Cit9CisKK3N0YXRpYyB2b2lkIGlzb2xhdGlvbihp
bnQgaTkxNSkKK3sKKwlmb3JfZWFjaF9tbWFwX29mZnNldF90eXBlKHQpIHsKKwkJc3RydWN0IGRy
bV9pOTE1X2dlbV9tbWFwX29mZnNldCBtbWFwX2FyZyA9IHsKKwkJCS5mbGFncyA9IHQtPnR5cGUK
KwkJfTsKKwkJaW50IEEgPSBnZW1fcmVvcGVuX2RyaXZlcihpOTE1KTsKKwkJaW50IEIgPSBnZW1f
cmVvcGVuX2RyaXZlcihpOTE1KTsKKwkJdWludDY0X3Qgb2Zmc2V0X2EsIG9mZnNldF9iOworCQl1
aW50MzJfdCBhLCBiOworCQl2b2lkICpwdHI7CisKKwkJYSA9IGdlbV9jcmVhdGUoQSwgNDA5Nik7
CisJCWIgPSBnZW1fb3BlbihCLCBnZW1fZmxpbmsoQSwgYSkpOworCisJCW1tYXBfYXJnLmhhbmRs
ZSA9IGE7CisJCWlmIChtbWFwX29mZnNldF9pb2N0bChpOTE1LCAmbW1hcF9hcmcpKSB7CisJCQlj
bG9zZShBKTsKKwkJCWNsb3NlKEIpOworCQkJY29udGludWU7CisJCX0KKwkJb2Zmc2V0X2EgPSBt
bWFwX2FyZy5vZmZzZXQ7CisKKwkJbW1hcF9hcmcuaGFuZGxlID0gYjsKKwkJaWd0X2Fzc2VydF9l
cShtbWFwX29mZnNldF9pb2N0bChpOTE1LCAmbW1hcF9hcmcpLCAwKTsKKwkJb2Zmc2V0X2IgPSBt
bWFwX2FyZy5vZmZzZXQ7CisKKwkJaWd0X2luZm8oIkFbJXNdOiB7ZmQ6JWQsIGhhbmRsZTolZCwg
b2Zmc2V0OiUiUFJJeDY0In1cbiIsCisJCQkgdC0+bmFtZSwgQSwgYSwgb2Zmc2V0X2EpOworCQlp
Z3RfaW5mbygiQlslc106IHtmZDolZCwgaGFuZGxlOiVkLCBvZmZzZXQ6JSJQUkl4NjQifVxuIiwK
KwkJCSB0LT5uYW1lLCBCLCBiLCBvZmZzZXRfYik7CisKKwkJcHRyID0gbW1hcDY0KDAsIDQwOTYs
IFBST1RfUkVBRCwgTUFQX1NIQVJFRCwgQiwgb2Zmc2V0X2EpOworCQlpZ3RfYXNzZXJ0KHB0ciA9
PSBNQVBfRkFJTEVEKTsKKworCQlwdHIgPSBtbWFwNjQoMCwgNDA5NiwgUFJPVF9SRUFELCBNQVBf
U0hBUkVELCBBLCBvZmZzZXRfYik7CisJCWlndF9hc3NlcnQocHRyID09IE1BUF9GQUlMRUQpOwor
CisJCWNsb3NlKEIpOworCisJCXB0ciA9IG1tYXA2NCgwLCA0MDk2LCBQUk9UX1JFQUQsIE1BUF9T
SEFSRUQsIEEsIG9mZnNldF9hKTsKKwkJaWd0X2Fzc2VydChwdHIgIT0gTUFQX0ZBSUxFRCk7CisJ
CW11bm1hcChwdHIsIDQwOTYpOworCisJCWNsb3NlKEEpOworCisJCXB0ciA9IG1tYXA2NCgwLCA0
MDk2LCBQUk9UX1JFQUQsIE1BUF9TSEFSRUQsIEEsIG9mZnNldF9hKTsKKwkJaWd0X2Fzc2VydChw
dHIgPT0gTUFQX0ZBSUxFRCk7CisJfQorfQorCitzdGF0aWMgdm9pZCBwZl9ub25ibG9jayhpbnQg
aTkxNSkKK3sKKwlpZ3Rfc3Bpbl90ICpzcGluID0gaWd0X3NwaW5fbmV3KGk5MTUpOworCisJZm9y
X2VhY2hfbW1hcF9vZmZzZXRfdHlwZSh0KSB7CisJCXVpbnQzMl90ICpwdHI7CisKKwkJcHRyID0g
X19tbWFwX29mZnNldChpOTE1LCBzcGluLT5oYW5kbGUsIDAsIDQwOTYsCisJCQkJICAgIFBST1Rf
UkVBRCB8IFBST1RfV1JJVEUsCisJCQkJICAgIHQtPnR5cGUpOworCQlpZiAoIXB0cikKKwkJCWNv
bnRpbnVlOworCisJCWlndF9zZXRfdGltZW91dCgxLCB0LT5uYW1lKTsKKwkJLyogbm8gc2V0LWRv
bWFpbiBhcyB3ZSB3YW50IHRvIHZlcmlmeSB0aGUgcGFnZWZhdWx0IGlzIGFzeW5jICovCisJCXB0
clsyNTZdID0gMDsKKwkJaWd0X3Jlc2V0X3RpbWVvdXQoKTsKKworCQltdW5tYXAocHRyLCA0MDk2
KTsKKwl9CisKKwlpZ3Rfc3Bpbl9mcmVlKGk5MTUsIHNwaW4pOworfQorCitzdGF0aWMgdm9pZCBj
bG9zZV9yYWNlKGludCBpOTE1LCBpbnQgdGltZW91dCkKK3sKKwljb25zdCBpbnQgbmNwdXMgPSBz
eXNjb25mKF9TQ19OUFJPQ0VTU09SU19PTkxOKTsKKwlfQXRvbWljIHVpbnQzMl90ICpoYW5kbGVz
OworCXNpemVfdCBsZW4gPSBBTElHTigobmNwdXMgKyAxKSAqIHNpemVvZih1aW50MzJfdCksIDQw
OTYpOworCisJaGFuZGxlcyA9IG1tYXA2NCgwLCBsZW4sIFBST1RfV1JJVEUsIE1BUF9TSEFSRUQg
fCBNQVBfQU5PTiwgLTEsIDApOworCWlndF9hc3NlcnQoaGFuZGxlcyAhPSBNQVBfRkFJTEVEKTsK
KworCWlndF9mb3JrKGNoaWxkLCBuY3B1cyArIDEpIHsKKwkJZG8geworCQkJc3RydWN0IGRybV9p
OTE1X2dlbV9tbWFwX29mZnNldCBtbWFwX2FyZyA9IHt9OworCQkJY29uc3QgaW50IGkgPSAxICsg
cmFuZG9tKCkgJSBuY3B1czsKKwkJCXVpbnQzMl90IG9sZDsKKworCQkJbW1hcF9hcmcuaGFuZGxl
ID0gZ2VtX2NyZWF0ZShpOTE1LCA0MDk2KTsKKwkJCW1tYXBfYXJnLmZsYWdzID0gSTkxNV9NTUFQ
X09GRlNFVF9XQjsKKwkJCW9sZCA9IGF0b21pY19leGNoYW5nZSgmaGFuZGxlc1tpXSwgbW1hcF9h
cmcuaGFuZGxlKTsKKwkJCWlvY3RsKGk5MTUsIERSTV9JT0NUTF9HRU1fQ0xPU0UsICZvbGQpOwor
CisJCQlpZiAoaW9jdGwoaTkxNSwKKwkJCQkgIERSTV9JT0NUTF9JOTE1X0dFTV9NTUFQX09GRlNF
VCwKKwkJCQkgICZtbWFwX2FyZykgIT0gLTEpIHsKKwkJCQl2b2lkICpwdHI7CisKKwkJCQlwdHIg
PSBtbWFwNjQoMCwgNDA5NiwKKwkJCQkJICAgICBQUk9UX1dSSVRFLCBNQVBfU0hBUkVELCBpOTE1
LAorCQkJCQkgICAgIG1tYXBfYXJnLm9mZnNldCk7CisJCQkJaWYgKHB0ciAhPSBNQVBfRkFJTEVE
KSB7CisJCQkJCSoodm9sYXRpbGUgdWludDMyX3QgKilwdHIgPSAwOworCQkJCQltdW5tYXAocHRy
LCA0MDk2KTsKKwkJCQl9CisJCQl9CisKKwkJfSB3aGlsZSAoIVJFQURfT05DRShoYW5kbGVzWzBd
KSk7CisJfQorCisJc2xlZXAodGltZW91dCk7CisJaGFuZGxlc1swXSA9IDE7CisJaWd0X3dhaXRj
aGlsZHJlbigpOworCisJZm9yIChpbnQgaSA9IDE7IGkgPD0gbmNwdXM7IGkrKykKKwkJaW9jdGwo
aTkxNSwgRFJNX0lPQ1RMX0dFTV9DTE9TRSwgaGFuZGxlc1tpXSk7CisJbXVubWFwKGhhbmRsZXMs
IGxlbik7Cit9CisKK3N0YXRpYyB1aW50NjRfdCBhdG9taWNfY29tcGFyZV9zd2FwX3U2NChfQXRv
bWljKHVpbnQ2NF90KSAqcHRyLAorCQkJCQl1aW50NjRfdCBvbGR2YWwsIHVpbnQ2NF90IG5ld3Zh
bCkKK3sKKwlhdG9taWNfY29tcGFyZV9leGNoYW5nZV9zdHJvbmcocHRyLCAmb2xkdmFsLCBuZXd2
YWwpOworCXJldHVybiBvbGR2YWw7Cit9CisKK3N0YXRpYyB1aW50NjRfdCBnZXRfbnBhZ2VzKF9B
dG9taWModWludDY0X3QpICpnbG9iYWwsIHVpbnQ2NF90IG5wYWdlcykKK3sKKwl1aW50NjRfdCB0
cnksIG9sZCwgbWF4OworCisJbWF4ID0gKmdsb2JhbDsKKwlkbyB7CisJCW9sZCA9IG1heDsKKwkJ
dHJ5ID0gMSArIG5wYWdlcyAlIChtYXggLyAyKTsKKwkJbWF4IC09IHRyeTsKKwl9IHdoaWxlICgo
bWF4ID0gYXRvbWljX2NvbXBhcmVfc3dhcF91NjQoZ2xvYmFsLCBvbGQsIG1heCkpICE9IG9sZCk7
CisKKwlyZXR1cm4gdHJ5OworfQorCitzdHJ1Y3QgdGhyZWFkX2NsZWFyIHsKKwlfQXRvbWljKHVp
bnQ2NF90KSBtYXg7CisJaW50IHRpbWVvdXQ7CisJaW50IGk5MTU7Cit9OworCitzdGF0aWMgaW50
IGNyZWF0ZV9pb2N0bChpbnQgaTkxNSwgc3RydWN0IGRybV9pOTE1X2dlbV9jcmVhdGUgKmNyZWF0
ZSkKK3sKKwlpbnQgZXJyID0gMDsKKworCWlmIChpZ3RfaW9jdGwoaTkxNSwgRFJNX0lPQ1RMX0k5
MTVfR0VNX0NSRUFURSwgY3JlYXRlKSkgeworCQllcnIgPSAtZXJybm87CisJCWlndF9hc3N1bWUo
ZXJyICE9IDApOworCX0KKworCWVycm5vID0gMDsKKwlyZXR1cm4gZXJyOworfQorCitzdGF0aWMg
dm9pZCAqdGhyZWFkX2NsZWFyKHZvaWQgKmRhdGEpCit7CisJc3RydWN0IHRocmVhZF9jbGVhciAq
YXJnID0gZGF0YTsKKwljb25zdCBzdHJ1Y3QgbW1hcF9vZmZzZXQgKnQ7CisJdW5zaWduZWQgbG9u
ZyBjaGVja2VkID0gMDsKKwlpbnQgaTkxNSA9IGFyZy0+aTkxNTsKKworCXQgPSBtbWFwX29mZnNl
dF90eXBlczsKKwlpZ3RfdW50aWxfdGltZW91dChhcmctPnRpbWVvdXQpIHsKKwkJc3RydWN0IGRy
bV9pOTE1X2dlbV9jcmVhdGUgY3JlYXRlID0ge307CisJCXVpbnQ2NF90IG5wYWdlczsKKwkJdm9p
ZCAqcHRyOworCisJCW5wYWdlcyA9IHJhbmRvbSgpOworCQlucGFnZXMgPDw9IDMyOworCQlucGFn
ZXMgfD0gcmFuZG9tKCk7CisJCW5wYWdlcyA9IGdldF9ucGFnZXMoJmFyZy0+bWF4LCBucGFnZXMp
OworCQljcmVhdGUuc2l6ZSA9IG5wYWdlcyA8PCAxMjsKKworCQljcmVhdGVfaW9jdGwoaTkxNSwg
JmNyZWF0ZSk7CisJCXB0ciA9IF9fbW1hcF9vZmZzZXQoaTkxNSwgY3JlYXRlLmhhbmRsZSwgMCwg
Y3JlYXRlLnNpemUsCisJCQkJICAgIFBST1RfUkVBRCB8IFBST1RfV1JJVEUsCisJCQkJICAgIHQt
PnR5cGUpOworCQkvKiBObyBzZXQtZG9tYWlucyBhcyB3ZSBhcmUgYmVpbmcgYXMgbmF1Z2h0eSBh
cyBwb3NzaWJsZSAqLworCQlmb3IgKHVpbnQ2NF90IHBhZ2UgPSAwOyBwdHIgJiYgcGFnZSA8IG5w
YWdlczsgcGFnZSsrKSB7CisJCQl1aW50NjRfdCB4WzhdID0geworCQkJCXBhZ2UgKiA0MDk2ICsK
KwkJCQkJc2l6ZW9mKHgpICogKChwYWdlICUgKDQwOTYgLSBzaXplb2YoeCkpIC8gc2l6ZW9mKHgp
KSkKKwkJCX07CisKKwkJCWlmIChwYWdlICYgMSkKKwkJCQlpZ3RfbWVtY3B5X2Zyb21fd2MoeCwg
cHRyICsgeFswXSwgc2l6ZW9mKHgpKTsKKwkJCWVsc2UKKwkJCQltZW1jcHkoeCwgcHRyICsgeFsw
XSwgc2l6ZW9mKHgpKTsKKworCQkJZm9yIChpbnQgaSA9IDA7IGkgPCBBUlJBWV9TSVpFKHgpOyBp
KyspCisJCQkJaWd0X2Fzc2VydF9lcV91NjQoeFtpXSwgMCk7CisJCX0KKwkJaWYgKHB0cikKKwkJ
CW11bm1hcChwdHIsIGNyZWF0ZS5zaXplKTsKKwkJZ2VtX2Nsb3NlKGk5MTUsIGNyZWF0ZS5oYW5k
bGUpOworCQljaGVja2VkICs9IG5wYWdlczsKKworCQlhdG9taWNfZmV0Y2hfYWRkKCZhcmctPm1h
eCwgbnBhZ2VzKTsKKworCQlpZiAoISgrK3QpLT5uYW1lKQorCQkJdCA9IG1tYXBfb2Zmc2V0X3R5
cGVzOworCX0KKworCXJldHVybiAodm9pZCAqKSh1aW50cHRyX3QpY2hlY2tlZDsKK30KKworc3Rh
dGljIHZvaWQgYWx3YXlzX2NsZWFyKGludCBpOTE1LCBpbnQgdGltZW91dCkKK3sKKwlzdHJ1Y3Qg
dGhyZWFkX2NsZWFyIGFyZyA9IHsKKwkJLmk5MTUgPSBpOTE1LAorCQkudGltZW91dCA9IHRpbWVv
dXQsCisJCS5tYXggPSBpbnRlbF9nZXRfYXZhaWxfcmFtX21iKCkgPDwgKDIwIC0gMTIpLCAvKiBp
biBwYWdlcyAqLworCX07CisJY29uc3QgaW50IG5jcHVzID0gc3lzY29uZihfU0NfTlBST0NFU1NP
UlNfT05MTik7CisJdW5zaWduZWQgbG9uZyBjaGVja2VkOworCXB0aHJlYWRfdCB0aHJlYWRbbmNw
dXNdOworCXZvaWQgKnJlc3VsdDsKKworCWZvciAoaW50IGkgPSAwOyBpIDwgbmNwdXM7IGkrKykK
KwkJcHRocmVhZF9jcmVhdGUoJnRocmVhZFtpXSwgTlVMTCwgdGhyZWFkX2NsZWFyLCAmYXJnKTsK
KworCWNoZWNrZWQgPSAwOworCWZvciAoaW50IGkgPSAwOyBpIDwgbmNwdXM7IGkrKykgeworCQlw
dGhyZWFkX2pvaW4odGhyZWFkW2ldLCAmcmVzdWx0KTsKKwkJY2hlY2tlZCArPSAodWludHB0cl90
KXJlc3VsdDsKKwl9CisJaWd0X2luZm8oIkNoZWNrZWQgJSdsdSBwYWdlIGFsbG9jYXRpb25zXG4i
LCBjaGVja2VkKTsKK30KKworc3RhdGljIGludCBtbWFwX2d0dF92ZXJzaW9uKGludCBpOTE1KQor
eworCWludCBndHRfdmVyc2lvbiA9IC0xOworCXN0cnVjdCBkcm1faTkxNV9nZXRwYXJhbSBncCA9
IHsKKwkJLnBhcmFtID0gSTkxNV9QQVJBTV9NTUFQX0dUVF9WRVJTSU9OLAorCQkudmFsdWUgPSAm
Z3R0X3ZlcnNpb24sCisJfTsKKwlpb2N0bChpOTE1LCBEUk1fSU9DVExfSTkxNV9HRVRQQVJBTSwg
JmdwKTsKKworCXJldHVybiBndHRfdmVyc2lvbjsKK30KKworc3RhdGljIGJvb2wgaGFzX21tYXBf
b2Zmc2V0KGludCBpOTE1KQoreworCXJldHVybiBtbWFwX2d0dF92ZXJzaW9uKGk5MTUpID49IDQ7
Cit9CisKK2lndF9tYWluCit7CisJaW50IGk5MTU7CisKKwlpZ3RfZml4dHVyZSB7CisJCWk5MTUg
PSBkcm1fb3Blbl9kcml2ZXIoRFJJVkVSX0lOVEVMKTsKKwkJaWd0X3JlcXVpcmUoaGFzX21tYXBf
b2Zmc2V0KGk5MTUpKTsKKwl9CisKKwlpZ3RfZGVzY3JpYmUoIlZlcmlmeSBtYXBwaW5nIHRvIGlu
dmFsaWQgZ2VtIG9iamVjdHMgd29uJ3QgYmUgY3JlYXRlZCIpOworCWlndF9zdWJ0ZXN0X2YoImJh
ZC1vYmplY3QiKQorCQliYWRfb2JqZWN0KGk5MTUpOworCWlndF9zdWJ0ZXN0X2YoImJhZC1mbGFn
cyIpCisJCWJhZF9mbGFncyhpOTE1KTsKKwlpZ3Rfc3VidGVzdF9mKCJiYWQtZXh0ZW5zaW9ucyIp
CisJCWJhZF9leHRlbnNpb25zKGk5MTUpOworCisJaWd0X2Rlc2NyaWJlKCJDaGVjayBidWZmZXIg
b2JqZWN0IG1hcHBpbmcgcGVyc2lzdHMgYWZ0ZXIgZ2VtX2Nsb3NlIik7CisJaWd0X3N1YnRlc3Rf
ZigiYmFzaWMtdWFmIikKKwkJYmFzaWNfdWFmKGk5MTUpOworCisJaWd0X3N1YnRlc3RfZigiaXNv
bGF0aW9uIikKKwkJaXNvbGF0aW9uKGk5MTUpOworCWlndF9zdWJ0ZXN0X2YoInBmLW5vbmJsb2Nr
IikKKwkJcGZfbm9uYmxvY2soaTkxNSk7CisKKwlpZ3RfZGVzY3JpYmUoIkNoZWNrIHJhY2UgYmV0
d2VlbiBjbG9zZSBhbmQgbW1hcCBvZmZzZXQgYmV0d2VlbiB0aHJlYWRzIik7CisJaWd0X3N1YnRl
c3RfZigiY2xvc2UtcmFjZSIpCisJCWNsb3NlX3JhY2UoaTkxNSwgMjApOworCisJaWd0X3N1YnRl
c3RfZigiY2xlYXIiKQorCQlhbHdheXNfY2xlYXIoaTkxNSwgMjApOworCisJaWd0X2ZpeHR1cmUg
eworCQljbG9zZShpOTE1KTsKKwl9Cit9CmRpZmYgLS1naXQgYS90ZXN0cy9tZXNvbi5idWlsZCBi
L3Rlc3RzL21lc29uLmJ1aWxkCmluZGV4IDBiMTU2MDljMi4uN2M4YTk4OGY2IDEwMDY0NAotLS0g
YS90ZXN0cy9tZXNvbi5idWlsZAorKysgYi90ZXN0cy9tZXNvbi5idWlsZApAQCAtMTcyLDYgKzE3
Miw3IEBAIGk5MTVfcHJvZ3MgPSBbCiAJJ2dlbV9tZWRpYV92bWUnLAogCSdnZW1fbW1hcCcsCiAJ
J2dlbV9tbWFwX2d0dCcsCisJJ2dlbV9tbWFwX29mZnNldCcsCiAJJ2dlbV9tbWFwX29mZnNldF9l
eGhhdXN0aW9uJywKIAknZ2VtX21tYXBfd2MnLAogCSdnZW1fcGFydGlhbF9wd3JpdGVfcHJlYWQn
LAotLSAKMi4yNC4wCgpfX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fXwpJbnRlbC1nZnggbWFpbGluZyBsaXN0CkludGVsLWdmeEBsaXN0cy5mcmVlZGVza3RvcC5v
cmcKaHR0cHM6Ly9saXN0cy5mcmVlZGVza3RvcC5vcmcvbWFpbG1hbi9saXN0aW5mby9pbnRlbC1n
Zng=

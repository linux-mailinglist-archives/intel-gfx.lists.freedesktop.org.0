Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id B634F115A99
	for <lists+intel-gfx@lfdr.de>; Sat,  7 Dec 2019 02:18:42 +0100 (CET)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id EA7656FACB;
	Sat,  7 Dec 2019 01:18:40 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from mga07.intel.com (mga07.intel.com [134.134.136.100])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 83D646FACB
 for <intel-gfx@lists.freedesktop.org>; Sat,  7 Dec 2019 01:18:39 +0000 (UTC)
X-Amp-Result: SKIPPED(no attachment in message)
X-Amp-File-Uploaded: False
Received: from orsmga007.jf.intel.com ([10.7.209.58])
 by orsmga105.jf.intel.com with ESMTP/TLS/DHE-RSA-AES256-GCM-SHA384;
 06 Dec 2019 17:18:38 -0800
X-ExtLoop1: 1
X-IronPort-AV: E=Sophos;i="5.69,286,1571727600"; d="scan'208";a="202276985"
Received: from josouza-mobl.jf.intel.com (HELO josouza-MOBL.intel.com)
 ([10.24.8.230])
 by orsmga007.jf.intel.com with ESMTP; 06 Dec 2019 17:18:38 -0800
From: =?UTF-8?q?Jos=C3=A9=20Roberto=20de=20Souza?= <jose.souza@intel.com>
To: intel-gfx@lists.freedesktop.org
Date: Fri,  6 Dec 2019 17:18:29 -0800
Message-Id: <20191207011832.422566-1-jose.souza@intel.com>
X-Mailer: git-send-email 2.24.0
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH 1/4] drm/i915/tgl: Select master transcoder for
 MST stream
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Cc: Lucas De Marchi <lucas.demarchi@intel.com>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

T24gVEdMIHRoZSBibGVuZGluZyBvZiBhbGwgdGhlIHN0cmVhbXMgaGF2ZSBtb3ZlZCBmcm9tIERE
SSB0bwp0cmFuc2NvZGVyLCBzbyBub3cgZXZlcnkgdHJhbnNjb2RlciB3b3JraW5nIG92ZXIgdGhl
IHNhbWUgTVNUIHBvcnQgbXVzdApzZW5kIGl0cyBzdHJlYW0gdG8gYSBtYXN0ZXIgdHJhbnNjb2Rl
ciBhbmQgbWFzdGVyIHdpbGwgc2VuZCB0byBEREkKcmVzcGVjdGluZyB0aGUgdGltZSBzbG90cy4K
ClNvIGhlcmUgYWRkaW5nIGFsbCB0aGUgQ1JUQ3MgdGhhdCBzaGFyZXMgdGhlIHNhbWUgTVNUIHN0
cmVhbSBpZgpuZWVkZWQgYW5kIGNvbXB1dGluZyB0aGVpciBzdGF0ZSBhZ2FpbiwgaXQgd2lsbCBw
aWNrIHRoZSBmaXJzdAp0cmFuc2NvZGVyIGFtb25nIHRoZSBvbmVzIGluIHRoZSBzYW1lIHN0cmVh
bSB0byBiZSBtYXN0ZXIuCgpNb3N0IG9mIHRoZSB0aW1lIHNrbF9jb21taXRfbW9kZXNldF9lbmFi
bGVzKCkgZW5hYmxlcyBwaXBlcyBpbiBhCmNyZXNjZW50IG9yZGVyIGJ1dCBkdWUgRERCIG92ZXJs
YXBwaW5nIGl0IG1pZ2h0IG5vdCBoYXBwZW4sIHRoaXMKc2NlbmFyaW8gd2lsbCBiZSBoYW5kbGVk
IGluIHRoZSBuZXh0IHBhdGNoLgoKQlNwZWM6IDUwNDkzCkJTcGVjOiA0OTE5MApDYzogVmlsbGUg
U3lyasOkbMOkIDx2aWxsZS5zeXJqYWxhQGxpbnV4LmludGVsLmNvbT4KQ2M6IEx1Y2FzIERlIE1h
cmNoaSA8bHVjYXMuZGVtYXJjaGlAaW50ZWwuY29tPgpTaWduZWQtb2ZmLWJ5OiBKb3PDqSBSb2Jl
cnRvIGRlIFNvdXphIDxqb3NlLnNvdXphQGludGVsLmNvbT4KLS0tCiBkcml2ZXJzL2dwdS9kcm0v
aTkxNS9kaXNwbGF5L2ludGVsX2RkaS5jICAgICAgfCAgMTQgKy0KIGRyaXZlcnMvZ3B1L2RybS9p
OTE1L2Rpc3BsYXkvaW50ZWxfZGlzcGxheS5jICB8ICAxNSArLQogLi4uL2RybS9pOTE1L2Rpc3Bs
YXkvaW50ZWxfZGlzcGxheV90eXBlcy5oICAgIHwgICAzICsKIGRyaXZlcnMvZ3B1L2RybS9pOTE1
L2Rpc3BsYXkvaW50ZWxfZHBfbXN0LmMgICB8IDE2MyArKysrKysrKysrKysrKysrKysKIGRyaXZl
cnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZHBfbXN0LmggICB8ICAgNSArCiA1IGZpbGVz
IGNoYW5nZWQsIDE5NiBpbnNlcnRpb25zKCspLCA0IGRlbGV0aW9ucygtKQoKZGlmZiAtLWdpdCBh
L2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZGRpLmMgYi9kcml2ZXJzL2dwdS9k
cm0vaTkxNS9kaXNwbGF5L2ludGVsX2RkaS5jCmluZGV4IDNjYWNiMWUyNzljMS4uYmU1YmM1MDZk
NGQzIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2RkaS5j
CisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZGRpLmMKQEAgLTE5MDMs
OCArMTkwMywxMyBAQCBpbnRlbF9kZGlfdHJhbnNjb2Rlcl9mdW5jX3JlZ192YWxfZ2V0KGNvbnN0
IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlKQogCQl0ZW1wIHw9IFRSQU5TX0RE
SV9NT0RFX1NFTEVDVF9EUF9NU1Q7CiAJCXRlbXAgfD0gRERJX1BPUlRfV0lEVEgoY3J0Y19zdGF0
ZS0+bGFuZV9jb3VudCk7CiAKLQkJaWYgKElOVEVMX0dFTihkZXZfcHJpdikgPj0gMTIpCi0JCQl0
ZW1wIHw9IFRSQU5TX0RESV9NU1RfVFJBTlNQT1JUX1NFTEVDVChjcnRjX3N0YXRlLT5jcHVfdHJh
bnNjb2Rlcik7CisJCWlmIChJTlRFTF9HRU4oZGV2X3ByaXYpID49IDEyKSB7CisJCQllbnVtIHRy
YW5zY29kZXIgbWFzdGVyOworCisJCQltYXN0ZXIgPSBjcnRjX3N0YXRlLT5tc3RfbWFzdGVyX3Ry
YW5zY29kZXI7CisJCQlXQVJOX09OKG1hc3RlciA9PSBJTlZBTElEX1RSQU5TQ09ERVIpOworCQkJ
dGVtcCB8PSBUUkFOU19ERElfTVNUX1RSQU5TUE9SVF9TRUxFQ1QobWFzdGVyKTsKKwkJfQogCX0g
ZWxzZSB7CiAJCXRlbXAgfD0gVFJBTlNfRERJX01PREVfU0VMRUNUX0RQX1NTVDsKIAkJdGVtcCB8
PSBERElfUE9SVF9XSURUSChjcnRjX3N0YXRlLT5sYW5lX2NvdW50KTsKQEAgLTQzNzIsNiArNDM3
NywxMSBAQCB2b2lkIGludGVsX2RkaV9nZXRfY29uZmlnKHN0cnVjdCBpbnRlbF9lbmNvZGVyICpl
bmNvZGVyLAogCQlwaXBlX2NvbmZpZy0+b3V0cHV0X3R5cGVzIHw9IEJJVChJTlRFTF9PVVRQVVRf
RFBfTVNUKTsKIAkJcGlwZV9jb25maWctPmxhbmVfY291bnQgPQogCQkJKCh0ZW1wICYgRERJX1BP
UlRfV0lEVEhfTUFTSykgPj4gRERJX1BPUlRfV0lEVEhfU0hJRlQpICsgMTsKKworCQlpZiAoSU5U
RUxfR0VOKGRldl9wcml2KSA+PSAxMikKKwkJCXBpcGVfY29uZmlnLT5tc3RfbWFzdGVyX3RyYW5z
Y29kZXIgPQorCQkJCQlSRUdfRklFTERfR0VUKFRSQU5TX0RESV9NU1RfVFJBTlNQT1JUX1NFTEVD
VF9NQVNLLCB0ZW1wKTsKKwogCQlpbnRlbF9kcF9nZXRfbV9uKGludGVsX2NydGMsIHBpcGVfY29u
ZmlnKTsKIAkJYnJlYWs7CiAJZGVmYXVsdDoKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9p
OTE1L2Rpc3BsYXkvaW50ZWxfZGlzcGxheS5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxh
eS9pbnRlbF9kaXNwbGF5LmMKaW5kZXggODIxYmE4MDUzZjlkLi5mODk0OTRjODQ5Y2UgMTAwNjQ0
Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZGlzcGxheS5jCisrKyBi
L2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZGlzcGxheS5jCkBAIC00Niw2ICs0
Niw3IEBACiAjaW5jbHVkZSAiZGlzcGxheS9pbnRlbF9jcnQuaCIKICNpbmNsdWRlICJkaXNwbGF5
L2ludGVsX2RkaS5oIgogI2luY2x1ZGUgImRpc3BsYXkvaW50ZWxfZHAuaCIKKyNpbmNsdWRlICJk
aXNwbGF5L2ludGVsX2RwX21zdC5oIgogI2luY2x1ZGUgImRpc3BsYXkvaW50ZWxfZHNpLmgiCiAj
aW5jbHVkZSAiZGlzcGxheS9pbnRlbF9kdm8uaCIKICNpbmNsdWRlICJkaXNwbGF5L2ludGVsX2dt
YnVzLmgiCkBAIC0xMjU0Miw2ICsxMjU0MywxMSBAQCBzdGF0aWMgdm9pZCBpbnRlbF9kdW1wX3Bp
cGVfY29uZmlnKGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpwaXBlX2NvbmZpZywKIAkJ
CSAgICAgIHBpcGVfY29uZmlnLT5jc2NfbW9kZSwgcGlwZV9jb25maWctPmdhbW1hX21vZGUsCiAJ
CQkgICAgICBwaXBlX2NvbmZpZy0+Z2FtbWFfZW5hYmxlLCBwaXBlX2NvbmZpZy0+Y3NjX2VuYWJs
ZSk7CiAKKwlpZiAoSU5URUxfR0VOKGRldl9wcml2KSA+PSAxMiAmJgorCSAgICBpbnRlbF9jcnRj
X2hhc190eXBlKHBpcGVfY29uZmlnLCBJTlRFTF9PVVRQVVRfRFBfTVNUKSkKKwkJRFJNX0RFQlVH
X0tNUygiTVNUIG1hc3RlciB0cmFuc2NvZGVyOiAlc1xuIiwKKwkJCSAgICAgIHRyYW5zY29kZXJf
bmFtZShwaXBlX2NvbmZpZy0+bXN0X21hc3Rlcl90cmFuc2NvZGVyKSk7CisKIGR1bXBfcGxhbmVz
OgogCWlmICghc3RhdGUpCiAJCXJldHVybjsKQEAgLTEzMzE4LDYgKzEzMzI0LDEwIEBAIGludGVs
X3BpcGVfY29uZmlnX2NvbXBhcmUoY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmN1cnJl
bnRfY29uZmlnLAogCVBJUEVfQ09ORl9DSEVDS19JKHN5bmNfbW9kZV9zbGF2ZXNfbWFzayk7CiAJ
UElQRV9DT05GX0NIRUNLX0kobWFzdGVyX3RyYW5zY29kZXIpOwogCisJaWYgKElOVEVMX0dFTihk
ZXZfcHJpdikgPj0gMTIgJiYKKwkgICAgaW50ZWxfY3J0Y19oYXNfdHlwZShwaXBlX2NvbmZpZywg
SU5URUxfT1VUUFVUX0RQX01TVCkpCisJCVBJUEVfQ09ORl9DSEVDS19JKG1zdF9tYXN0ZXJfdHJh
bnNjb2Rlcik7CisKICN1bmRlZiBQSVBFX0NPTkZfQ0hFQ0tfWAogI3VuZGVmIFBJUEVfQ09ORl9D
SEVDS19JCiAjdW5kZWYgUElQRV9DT05GX0NIRUNLX0JPT0wKQEAgLTE0NDA2LDcgKzE0NDE2LDcg
QEAgc3RhdGljIHZvaWQgaW50ZWxfY29tbWl0X21vZGVzZXRfZGlzYWJsZXMoc3RydWN0IGludGVs
X2F0b21pY19zdGF0ZSAqc3RhdGUpCiAJdTMyIGhhbmRsZWQgPSAwOwogCWludCBpOwogCi0JLyog
T25seSBkaXNhYmxlIHBvcnQgc3luYyBzbGF2ZXMgKi8KKwkvKiBPbmx5IGRpc2FibGUgcG9ydCBz
eW5jIGFuZCBNU1Qgc2xhdmVzICovCiAJZm9yX2VhY2hfb2xkbmV3X2ludGVsX2NydGNfaW5fc3Rh
dGUoc3RhdGUsIGNydGMsIG9sZF9jcnRjX3N0YXRlLAogCQkJCQkgICAgbmV3X2NydGNfc3RhdGUs
IGkpIHsKIAkJaWYgKCFuZWVkc19tb2Rlc2V0KG5ld19jcnRjX3N0YXRlKSkKQEAgLTE0NDIwLDcg
KzE0NDMwLDggQEAgc3RhdGljIHZvaWQgaW50ZWxfY29tbWl0X21vZGVzZXRfZGlzYWJsZXMoc3Ry
dWN0IGludGVsX2F0b21pY19zdGF0ZSAqc3RhdGUpCiAJCSAqIHNsYXZlIENSVENzIGFyZSBkaXNh
YmxlZCBmaXJzdCBhbmQgdGhlbiBtYXN0ZXIgQ1JUQyBzaW5jZQogCQkgKiBTbGF2ZSB2Ymxhbmtz
IGFyZSBtYXNrZWQgdGlsbCBNYXN0ZXIgVmJsYW5rcy4KIAkJICovCi0JCWlmICghaXNfdHJhbnNf
cG9ydF9zeW5jX3NsYXZlKG9sZF9jcnRjX3N0YXRlKSkKKwkJaWYgKCFpc190cmFuc19wb3J0X3N5
bmNfc2xhdmUob2xkX2NydGNfc3RhdGUpICYmCisJCSAgICAhaW50ZWxfZHBfbXN0X2lzX3NsYXZl
X3RyYW5zKG9sZF9jcnRjX3N0YXRlKSkKIAkJCWNvbnRpbnVlOwogCiAJCWludGVsX3ByZV9wbGFu
ZV91cGRhdGUoc3RhdGUsIGNydGMpOwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUv
ZGlzcGxheS9pbnRlbF9kaXNwbGF5X3R5cGVzLmggYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNw
bGF5L2ludGVsX2Rpc3BsYXlfdHlwZXMuaAppbmRleCA4M2VhMDQxNDliNzcuLjYzMGE5NDg5MmI3
YiAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kaXNwbGF5
X3R5cGVzLmgKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kaXNwbGF5
X3R5cGVzLmgKQEAgLTEwNTQsNiArMTA1NCw5IEBAIHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlIHsK
IAogCS8qIEJpdG1hc2sgdG8gaW5kaWNhdGUgc2xhdmVzIGF0dGFjaGVkICovCiAJdTggc3luY19t
b2RlX3NsYXZlc19tYXNrOworCisJLyogT25seSB2YWxpZCBvbiBUR0wrICovCisJZW51bSB0cmFu
c2NvZGVyIG1zdF9tYXN0ZXJfdHJhbnNjb2RlcjsKIH07CiAKIHN0cnVjdCBpbnRlbF9jcnRjIHsK
ZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZHBfbXN0LmMg
Yi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2RwX21zdC5jCmluZGV4IDkyNmU0
OWY0NDlhNi4uNDlmMTUxOGUzYWI5IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9k
aXNwbGF5L2ludGVsX2RwX21zdC5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkv
aW50ZWxfZHBfbXN0LmMKQEAgLTg3LDYgKzg3LDQ5IEBAIHN0YXRpYyBpbnQgaW50ZWxfZHBfbXN0
X2NvbXB1dGVfbGlua19jb25maWcoc3RydWN0IGludGVsX2VuY29kZXIgKmVuY29kZXIsCiAJcmV0
dXJuIDA7CiB9CiAKKy8qCisgKiBJdGVyYXRlIG92ZXIgYWxsIHRoZSBDUlRDcyBhbmQgc2V0IG1z
dF9tYXN0ZXJfdHJhbnNjb2RlciB0byB0aGUgZmlyc3QgYWN0aXZlCisgKiB0cmFuc2NvZGVyIHRo
YXQgc2hhcmVzIHRoZSBzYW1lIE1TVCBjb25uZWN0b3IuCisgKgorICogVE9ETzogbWF5YmUgdGhp
cyBjb3VsZCBiZSBvcHRpbWl6ZWQgdG8ga2VlcCB0aGUgb2xkIG1hc3RlciB0cmFuc2NvZGVyCisg
Ki8KK3N0YXRpYyBpbnQKK2ludGVsX2RwX21zdF9tYXN0ZXJfdHJhbnNfY29tcHV0ZShzdHJ1Y3Qg
aW50ZWxfZW5jb2RlciAqZW5jb2RlciwKKwkJCQkgIHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpw
aXBlX2NvbmZpZywKKwkJCQkgIHN0cnVjdCBkcm1fY29ubmVjdG9yX3N0YXRlICpjb25uX3N0YXRl
KQoreworCXN0cnVjdCBpbnRlbF9hdG9taWNfc3RhdGUgKnN0YXRlID0gdG9faW50ZWxfYXRvbWlj
X3N0YXRlKHBpcGVfY29uZmlnLT51YXBpLnN0YXRlKTsKKwlzdHJ1Y3QgaW50ZWxfY29ubmVjdG9y
ICpjb25uID0gdG9faW50ZWxfY29ubmVjdG9yKGNvbm5fc3RhdGUtPmNvbm5lY3Rvcik7CisJc3Ry
dWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShlbmNvZGVyLT5iYXNlLmRl
dik7CisJc3RydWN0IGludGVsX2RpZ2l0YWxfY29ubmVjdG9yX3N0YXRlICppdGVyX2Nvbm5fc3Rh
dGU7CisJc3RydWN0IGludGVsX2Nvbm5lY3RvciAqaXRlcl9jb25uOworCWludCBpOworCisJaWYg
KElOVEVMX0dFTihkZXZfcHJpdikgPCAxMikKKwkJcmV0dXJuIDA7CisKKwlmb3JfZWFjaF9uZXdf
aW50ZWxfY29ubmVjdG9yX2luX3N0YXRlKHN0YXRlLCBpdGVyX2Nvbm4sCisJCQkJCSAgICAgIGl0
ZXJfY29ubl9zdGF0ZSwgaSkgeworCQlzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqaXRlcl9jcnRj
X3N0YXRlOworCQlzdHJ1Y3QgaW50ZWxfY3J0YyAqaXRlcl9jcnRjOworCisJCWlmIChjb25uLT5t
c3RfcG9ydCAhPSBpdGVyX2Nvbm4tPm1zdF9wb3J0IHx8CisJCSAgICAhaXRlcl9jb25uX3N0YXRl
LT5iYXNlLmNydGMpCisJCQljb250aW51ZTsKKworCQlpdGVyX2NydGMgPSB0b19pbnRlbF9jcnRj
KGl0ZXJfY29ubl9zdGF0ZS0+YmFzZS5jcnRjKTsKKwkJaXRlcl9jcnRjX3N0YXRlID0gaW50ZWxf
YXRvbWljX2dldF9uZXdfY3J0Y19zdGF0ZShzdGF0ZSwKKwkJCQkJCQkJICBpdGVyX2NydGMpOwor
CQlpZiAoIWl0ZXJfY3J0Y19zdGF0ZS0+dWFwaS5hY3RpdmUpCisJCQljb250aW51ZTsKKworCQlw
aXBlX2NvbmZpZy0+bXN0X21hc3Rlcl90cmFuc2NvZGVyID0gaXRlcl9jcnRjX3N0YXRlLT5jcHVf
dHJhbnNjb2RlcjsKKwkJYnJlYWs7CisJfQorCisJcmV0dXJuIDA7Cit9CisKIHN0YXRpYyBpbnQg
aW50ZWxfZHBfbXN0X2NvbXB1dGVfY29uZmlnKHN0cnVjdCBpbnRlbF9lbmNvZGVyICplbmNvZGVy
LAogCQkJCSAgICAgICBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqcGlwZV9jb25maWcsCiAJCQkJ
ICAgICAgIHN0cnVjdCBkcm1fY29ubmVjdG9yX3N0YXRlICpjb25uX3N0YXRlKQpAQCAtMTU0LDYg
KzE5Nyw5OCBAQCBzdGF0aWMgaW50IGludGVsX2RwX21zdF9jb21wdXRlX2NvbmZpZyhzdHJ1Y3Qg
aW50ZWxfZW5jb2RlciAqZW5jb2RlciwKIAogCWludGVsX2RkaV9jb21wdXRlX21pbl92b2x0YWdl
X2xldmVsKGRldl9wcml2LCBwaXBlX2NvbmZpZyk7CiAKKwlyZXQgPSBpbnRlbF9kcF9tc3RfbWFz
dGVyX3RyYW5zX2NvbXB1dGUoZW5jb2RlciwgcGlwZV9jb25maWcsCisJCQkJCQljb25uX3N0YXRl
KTsKKwlpZiAocmV0KQorCQlyZXR1cm4gcmV0OworCisJcmV0dXJuIDA7Cit9CisKK3N0YXRpYyBp
bnQKK2ludGVsX2RwX21zdF9hdG9taWNfbWFzdGVyX3RyYW5zX2NoZWNrKHN0cnVjdCBkcm1fY29u
bmVjdG9yICpjb25uZWN0b3IsCisJCQkJICAgICAgIHN0cnVjdCBkcm1fYXRvbWljX3N0YXRlICpz
dGF0ZSkKK3sKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGNv
bm5lY3Rvci0+ZGV2KTsKKwlzdHJ1Y3QgZHJtX2Nvbm5lY3Rvcl9zdGF0ZSAqbmV3X2Nvbm5fc3Rh
dGUsICpvbGRfY29ubl9zdGF0ZTsKKwlzdHJ1Y3QgZHJtX2Nvbm5lY3Rvcl9saXN0X2l0ZXIgY29u
bl9saXN0X2l0ZXI7CisJc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmludGVsX2NydGNfc3RhdGU7
CisJc3RydWN0IGludGVsX2Nvbm5lY3RvciAqaW50ZWxfY29ubjsKKwlzdHJ1Y3QgZHJtX2NydGNf
c3RhdGUgKmNydGNfc3RhdGU7CisJc3RydWN0IGRybV9jb25uZWN0b3IgKmNvbm5faXRlcjsKKwor
CWlmIChJTlRFTF9HRU4oZGV2X3ByaXYpIDwgMTIpCisJCXJldHVybiAgMDsKKworCWludGVsX2Nv
bm4gPSB0b19pbnRlbF9jb25uZWN0b3IoY29ubmVjdG9yKTsKKwluZXdfY29ubl9zdGF0ZSA9IGRy
bV9hdG9taWNfZ2V0X25ld19jb25uZWN0b3Jfc3RhdGUoc3RhdGUsIGNvbm5lY3Rvcik7CisJb2xk
X2Nvbm5fc3RhdGUgPSBkcm1fYXRvbWljX2dldF9vbGRfY29ubmVjdG9yX3N0YXRlKHN0YXRlLCBj
b25uZWN0b3IpOworCisJaWYgKCFvbGRfY29ubl9zdGF0ZS0+Y3J0YyAmJiAhbmV3X2Nvbm5fc3Rh
dGUtPmNydGMpCisJCXJldHVybiAwOworCisJLyoKKwkgKiAzIGNhc2VzIHRoYXQgbmVlZHMgYmUg
aGFuZGxlZCBoZXJlOgorCSAqIC0gY29ubmVjdG9yIGdvaW5nIGZyb20gZGlzYWJsZWQgdG8gZW5h
YmxlZDoKKwkgKiBub3RoaW5nIGVsc2UgbmVlZCB0byBiZSBkb25lLCBkcm0gaGVscGVycyBhbHJl
YWR5IHNldCBtb2RlX2NoYW5nZWQgaW4KKwkgKiB0aGUgQ1JUQ3MgbmVlZGVkCisJICogLSBjb25u
ZWN0b3IgZ29pbmcgZnJvbSBlbmFibGVkIHRvIGRpc2FibGVkOgorCSAqIGlmIHRoaXMgdHJhbnNj
b2RlciB3YXMgdGhlIG1hc3RlciwgYWxsIHNsYXZlcyBuZWVkcyBhIG1vZGVzZXQKKwkgKiAtIGNv
bm5lY3RvciBnb2luZyBmcm9tIGVuYWJsZWQgdG8gZW5hYmxlZCBidXQgaXQgbmVlZHMgYSBtb2Rl
c2V0OgorCSAqIGlmIHRoaXMgdHJhbnNjb2RlciB3YXMgdGhlIG1hc3RlciwgYWxsIHNsYXZlcyBh
bHNvIG5lZWRzIGEgbW9kZXNldAorCSAqLworCisJLyogZGlzYWJsZWQgLT4gZW5hYmxlZCAqLwor
CWlmICghb2xkX2Nvbm5fc3RhdGUtPmNydGMgJiYgbmV3X2Nvbm5fc3RhdGUtPmNydGMpCisJCXJl
dHVybiAwOworCisJLyogZW5hYmxlZCAtPiBlbmFibGVkKG1vZGVzZXQpPyAqLworCWlmIChuZXdf
Y29ubl9zdGF0ZS0+Y3J0YykgeworCQljcnRjX3N0YXRlID0gZHJtX2F0b21pY19nZXRfbmV3X2Ny
dGNfc3RhdGUoc3RhdGUsCisJCQkJCQkJICAgbmV3X2Nvbm5fc3RhdGUtPmNydGMpOworCQlpZiAo
IWRybV9hdG9taWNfY3J0Y19uZWVkc19tb2Rlc2V0KGNydGNfc3RhdGUpKQorCQkJcmV0dXJuIDA7
CisJfQorCisJLyogaGFuZGxpbmcgZW5hYmxlZCAtPiBlbmFibGVkKG1vZGVzZXQpIGFuZCBlbmFi
bGVkIC0+IGRpc2FibGVkICovCisJY3J0Y19zdGF0ZSA9IGRybV9hdG9taWNfZ2V0X29sZF9jcnRj
X3N0YXRlKHN0YXRlLCBvbGRfY29ubl9zdGF0ZS0+Y3J0Yyk7CisJaW50ZWxfY3J0Y19zdGF0ZSA9
IHRvX2ludGVsX2NydGNfc3RhdGUoY3J0Y19zdGF0ZSk7CisKKwkvKiBJZiBub3QgbWFzdGVyLCBu
b3RoaW5nIGVsc2UgbmVlZHMgdG8gYmUgaGFuZGxlZCAqLworCWlmICghaW50ZWxfZHBfbXN0X2lz
X21hc3Rlcl90cmFucyhpbnRlbF9jcnRjX3N0YXRlKSkKKwkJcmV0dXJuIDA7CisKKwkvKiBJdCBp
cyBtYXN0ZXIsIGFkZCBhbmQgbWFyayBhbGwgb3RoZXIgQ1JUQ3MgaW4gdGhlIHN0cmVhbSBhcyBj
aGFuZ2VkICovCisJZHJtX2Nvbm5lY3Rvcl9saXN0X2l0ZXJfYmVnaW4oc3RhdGUtPmRldiwgJmNv
bm5fbGlzdF9pdGVyKTsKKwlkcm1fZm9yX2VhY2hfY29ubmVjdG9yX2l0ZXIoY29ubl9pdGVyLCAm
Y29ubl9saXN0X2l0ZXIpIHsKKwkJc3RydWN0IGRybV9jb25uZWN0b3Jfc3RhdGUgKmNvbm5faXRl
cl9zdGF0ZTsKKwkJc3RydWN0IGludGVsX2Nvbm5lY3RvciAqaW50ZWxfY29ubl9pdGVyOworCisJ
CWludGVsX2Nvbm5faXRlciA9IHRvX2ludGVsX2Nvbm5lY3Rvcihjb25uX2l0ZXIpOworCQlpZiAo
aW50ZWxfY29ubl9pdGVyLT5tc3RfcG9ydCAhPSBpbnRlbF9jb25uLT5tc3RfcG9ydCkKKwkJCWNv
bnRpbnVlOworCisJCWNvbm5faXRlcl9zdGF0ZSA9IGRybV9hdG9taWNfZ2V0X2Nvbm5lY3Rvcl9z
dGF0ZShzdGF0ZSwKKwkJCQkJCQkJIGNvbm5faXRlcik7CisJCWlmIChJU19FUlIoY29ubl9pdGVy
X3N0YXRlKSkgeworCQkJZHJtX2Nvbm5lY3Rvcl9saXN0X2l0ZXJfZW5kKCZjb25uX2xpc3RfaXRl
cik7CisJCQlyZXR1cm4gUFRSX0VSUihjb25uX2l0ZXJfc3RhdGUpOworCQl9CisKKwkJaWYgKCFj
b25uX2l0ZXJfc3RhdGUtPmNydGMpCisJCQljb250aW51ZTsKKworCQljcnRjX3N0YXRlID0gZHJt
X2F0b21pY19nZXRfY3J0Y19zdGF0ZShzdGF0ZSwKKwkJCQkJCSAgICAgICBjb25uX2l0ZXJfc3Rh
dGUtPmNydGMpOworCQlpZiAoSVNfRVJSKGNydGNfc3RhdGUpKSB7CisJCQlkcm1fY29ubmVjdG9y
X2xpc3RfaXRlcl9lbmQoJmNvbm5fbGlzdF9pdGVyKTsKKwkJCXJldHVybiBQVFJfRVJSKGNvbm5f
aXRlcl9zdGF0ZSk7CisJCX0KKworCQljcnRjX3N0YXRlLT5tb2RlX2NoYW5nZWQgPSB0cnVlOwor
CX0KKwlkcm1fY29ubmVjdG9yX2xpc3RfaXRlcl9lbmQoJmNvbm5fbGlzdF9pdGVyKTsKKwogCXJl
dHVybiAwOwogfQogCkBAIC0xNzUsNiArMzEwLDEwIEBAIGludGVsX2RwX21zdF9hdG9taWNfY2hl
Y2soc3RydWN0IGRybV9jb25uZWN0b3IgKmNvbm5lY3RvciwKIAlpZiAocmV0KQogCQlyZXR1cm4g
cmV0OwogCisJcmV0ID0gaW50ZWxfZHBfbXN0X2F0b21pY19tYXN0ZXJfdHJhbnNfY2hlY2soY29u
bmVjdG9yLCBzdGF0ZSk7CisJaWYgKHJldCkKKwkJcmV0dXJuIHJldDsKKwogCWlmICghb2xkX2Nv
bm5fc3RhdGUtPmNydGMpCiAJCXJldHVybiAwOwogCkBAIC0yNDEsNiArMzgwLDkgQEAgc3RhdGlj
IHZvaWQgaW50ZWxfbXN0X3Bvc3RfZGlzYWJsZV9kcChzdHJ1Y3QgaW50ZWxfZW5jb2RlciAqZW5j
b2RlciwKIAlpbnRlbF9kcC0+YWN0aXZlX21zdF9saW5rcy0tOwogCWxhc3RfbXN0X3N0cmVhbSA9
IGludGVsX2RwLT5hY3RpdmVfbXN0X2xpbmtzID09IDA7CiAKKwlXQVJOX09OKElOVEVMX0dFTihk
ZXZfcHJpdikgPj0gMTIgJiYgbGFzdF9tc3Rfc3RyZWFtICYmCisJCSFpbnRlbF9kcF9tc3RfaXNf
bWFzdGVyX3RyYW5zKG9sZF9jcnRjX3N0YXRlKSk7CisKIAkvKgogCSAqIEZyb20gVEdMIHNwZWM6
ICJJZiBtdWx0aS1zdHJlYW0gc2xhdmUgdHJhbnNjb2RlcjogQ29uZmlndXJlCiAJICogVHJhbnNj
b2RlciBDbG9jayBTZWxlY3QgdG8gZGlyZWN0IG5vIGNsb2NrIHRvIHRoZSB0cmFuc2NvZGVyIgpA
QCAtMzIxLDYgKzQ2Myw5IEBAIHN0YXRpYyB2b2lkIGludGVsX21zdF9wcmVfZW5hYmxlX2RwKHN0
cnVjdCBpbnRlbF9lbmNvZGVyICplbmNvZGVyLAogCWludGVsX21zdC0+Y29ubmVjdG9yID0gY29u
bmVjdG9yOwogCWZpcnN0X21zdF9zdHJlYW0gPSBpbnRlbF9kcC0+YWN0aXZlX21zdF9saW5rcyA9
PSAwOwogCisJV0FSTl9PTihJTlRFTF9HRU4oZGV2X3ByaXYpID49IDEyICYmIGZpcnN0X21zdF9z
dHJlYW0gJiYKKwkJIWludGVsX2RwX21zdF9pc19tYXN0ZXJfdHJhbnMocGlwZV9jb25maWcpKTsK
KwogCURSTV9ERUJVR19LTVMoImFjdGl2ZSBsaW5rcyAlZFxuIiwgaW50ZWxfZHAtPmFjdGl2ZV9t
c3RfbGlua3MpOwogCiAJaWYgKGZpcnN0X21zdF9zdHJlYW0pCkBAIC03MjYsMyArODcxLDIxIEBA
IGludGVsX2RwX21zdF9lbmNvZGVyX2NsZWFudXAoc3RydWN0IGludGVsX2RpZ2l0YWxfcG9ydCAq
aW50ZWxfZGlnX3BvcnQpCiAJZHJtX2RwX21zdF90b3BvbG9neV9tZ3JfZGVzdHJveSgmaW50ZWxf
ZHAtPm1zdF9tZ3IpOwogCS8qIGVuY29kZXJzIHdpbGwgZ2V0IGtpbGxlZCBieSBub3JtYWwgY2xl
YW51cCAqLwogfQorCitib29sIGludGVsX2RwX21zdF9pc19tYXN0ZXJfdHJhbnMoY29uc3Qgc3Ry
dWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUpCit7CisJc3RydWN0IGRybV9pOTE1X3By
aXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShjcnRjX3N0YXRlLT51YXBpLmNydGMtPmRldik7CisK
KwlyZXR1cm4gSU5URUxfR0VOKGRldl9wcml2KSA+PSAxMiAmJgorCSAgICAgICBpbnRlbF9jcnRj
X2hhc190eXBlKGNydGNfc3RhdGUsIElOVEVMX09VVFBVVF9EUF9NU1QpICYmCisJICAgICAgIGNy
dGNfc3RhdGUtPm1zdF9tYXN0ZXJfdHJhbnNjb2RlciA9PSBjcnRjX3N0YXRlLT5jcHVfdHJhbnNj
b2RlcjsKK30KKworYm9vbCBpbnRlbF9kcF9tc3RfaXNfc2xhdmVfdHJhbnMoY29uc3Qgc3RydWN0
IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUpCit7CisJc3RydWN0IGRybV9pOTE1X3ByaXZh
dGUgKmRldl9wcml2ID0gdG9faTkxNShjcnRjX3N0YXRlLT51YXBpLmNydGMtPmRldik7CisKKwly
ZXR1cm4gSU5URUxfR0VOKGRldl9wcml2KSA+PSAxMiAmJgorCSAgICAgICBpbnRlbF9jcnRjX2hh
c190eXBlKGNydGNfc3RhdGUsIElOVEVMX09VVFBVVF9EUF9NU1QpICYmCisJICAgICAgIGNydGNf
c3RhdGUtPm1zdF9tYXN0ZXJfdHJhbnNjb2RlciAhPSBjcnRjX3N0YXRlLT5jcHVfdHJhbnNjb2Rl
cjsKK30KZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZHBf
bXN0LmggYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2RwX21zdC5oCmluZGV4
IGY2NjBhZDgwZGIwNC4uZTQwNzY3Zjc4MzQzIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0v
aTkxNS9kaXNwbGF5L2ludGVsX2RwX21zdC5oCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rp
c3BsYXkvaW50ZWxfZHBfbXN0LmgKQEAgLTYsMTAgKzYsMTUgQEAKICNpZm5kZWYgX19JTlRFTF9E
UF9NU1RfSF9fCiAjZGVmaW5lIF9fSU5URUxfRFBfTVNUX0hfXwogCisjaW5jbHVkZSA8c3RkYm9v
bC5oPgorCiBzdHJ1Y3QgaW50ZWxfZGlnaXRhbF9wb3J0Oworc3RydWN0IGludGVsX2NydGNfc3Rh
dGU7CiAKIGludCBpbnRlbF9kcF9tc3RfZW5jb2Rlcl9pbml0KHN0cnVjdCBpbnRlbF9kaWdpdGFs
X3BvcnQgKmludGVsX2RpZ19wb3J0LCBpbnQgY29ubl9pZCk7CiB2b2lkIGludGVsX2RwX21zdF9l
bmNvZGVyX2NsZWFudXAoc3RydWN0IGludGVsX2RpZ2l0YWxfcG9ydCAqaW50ZWxfZGlnX3BvcnQp
OwogaW50IGludGVsX2RwX21zdF9lbmNvZGVyX2FjdGl2ZV9saW5rcyhzdHJ1Y3QgaW50ZWxfZGln
aXRhbF9wb3J0ICppbnRlbF9kaWdfcG9ydCk7Citib29sIGludGVsX2RwX21zdF9pc19tYXN0ZXJf
dHJhbnMoY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUpOworYm9vbCBp
bnRlbF9kcF9tc3RfaXNfc2xhdmVfdHJhbnMoY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUg
KmNydGNfc3RhdGUpOwogCiAjZW5kaWYgLyogX19JTlRFTF9EUF9NU1RfSF9fICovCi0tIAoyLjI0
LjAKCl9fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fCkludGVs
LWdmeCBtYWlsaW5nIGxpc3QKSW50ZWwtZ2Z4QGxpc3RzLmZyZWVkZXNrdG9wLm9yZwpodHRwczov
L2xpc3RzLmZyZWVkZXNrdG9wLm9yZy9tYWlsbWFuL2xpc3RpbmZvL2ludGVsLWdmeA==

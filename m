Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id AC771E8233
	for <lists+intel-gfx@lfdr.de>; Tue, 29 Oct 2019 08:22:44 +0100 (CET)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id BFC9B6E0EE;
	Tue, 29 Oct 2019 07:22:42 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from mblankhorst.nl (mblankhorst.nl [141.105.120.124])
 by gabe.freedesktop.org (Postfix) with ESMTPS id D6E6C6E0D3
 for <intel-gfx@lists.freedesktop.org>; Tue, 29 Oct 2019 07:22:35 +0000 (UTC)
From: Maarten Lankhorst <maarten.lankhorst@linux.intel.com>
To: intel-gfx@lists.freedesktop.org
Date: Tue, 29 Oct 2019 08:22:22 +0100
Message-Id: <20191029072229.27092-5-maarten.lankhorst@linux.intel.com>
X-Mailer: git-send-email 2.23.0
In-Reply-To: <20191029072229.27092-1-maarten.lankhorst@linux.intel.com>
References: <20191029072229.27092-1-maarten.lankhorst@linux.intel.com>
MIME-Version: 1.0
Subject: [Intel-gfx] [CI 05/12] drm/i915: Perform automated conversions for
 crtc uapi/hw split, base -> hw.
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

U3BsaXQgdXAgY3J0Y19zdGF0ZS0+YmFzZSB0byBodyB3aGVyZSBhcHByb3ByaWF0ZS4gVGhpcyBp
cyBkb25lIHVzaW5nIHRoZSBmb2xsb3dpbmcgcGF0Y2g6CgpAQApzdHJ1Y3QgaW50ZWxfY3J0Y19z
dGF0ZSAqVDsKaWRlbnRpZmllciB4ID1+ICJeKGFjdGl2ZXxlbmFibGV8ZGVnYW1tYV9sdXR8Z2Ft
bWFfbHV0fGN0bXxtb2RlfGFkanVzdGVkX21vZGUpJCI7CkBACi1ULT5iYXNlLngKK1QtPmh3LngK
CkBACnN0cnVjdCBkcm1fY3J0Y19zdGF0ZSAqVDsKaWRlbnRpZmllciB4ID1+ICJeKGFjdGl2ZXxl
bmFibGV8ZGVnYW1tYV9sdXR8Z2FtbWFfbHV0fGN0bXxtb2RlfGFkanVzdGVkX21vZGUpJCI7CkBA
Ci10b19pbnRlbF9jcnRjX3N0YXRlKFQpLT5iYXNlLngKK3RvX2ludGVsX2NydGNfc3RhdGUoVCkt
Pmh3LngKClNpZ25lZC1vZmYtYnk6IE1hYXJ0ZW4gTGFua2hvcnN0IDxtYWFydGVuLmxhbmtob3Jz
dEBsaW51eC5pbnRlbC5jb20+ClJldmlld2VkLWJ5OiBWaWxsZSBTeXJqw6Rsw6QgPHZpbGxlLnN5
cmphbGFAbGludXguaW50ZWwuY29tPgotLS0KIGRyaXZlcnMvZ3B1L2RybS9kcm1fZHBfbXN0X3Rv
cG9sb2d5LmMgICAgICAgICB8ICAgMSArCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2lj
bF9kc2kuYyAgICAgICAgfCAgMTIgKy0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50
ZWxfYXVkaW8uYyAgICB8ICAgNCArLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRl
bF9jZGNsay5jICAgIHwgICA4ICstCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVs
X2NvbG9yLmMgICAgfCAxMDggKysrKy0tLS0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkv
aW50ZWxfY3J0LmMgICAgICB8ICAxOCArLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9p
bnRlbF9kZGkuYyAgICAgIHwgIDE4ICstCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2lu
dGVsX2Rpc3BsYXkuYyAgfCAyNjAgKysrKysrKysrLS0tLS0tLS0tCiBkcml2ZXJzL2dwdS9kcm0v
aTkxNS9kaXNwbGF5L2ludGVsX2RwLmMgICAgICAgfCAgMjIgKy0KIGRyaXZlcnMvZ3B1L2RybS9p
OTE1L2Rpc3BsYXkvaW50ZWxfZHBfbXN0LmMgICB8ICAgNiArLQogZHJpdmVycy9ncHUvZHJtL2k5
MTUvZGlzcGxheS9pbnRlbF9kdm8uYyAgICAgIHwgIDEyICstCiBkcml2ZXJzL2dwdS9kcm0vaTkx
NS9kaXNwbGF5L2ludGVsX2ZiYy5jICAgICAgfCAgIDIgKy0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1
L2Rpc3BsYXkvaW50ZWxfaGRtaS5jICAgICB8ICAyMCArLQogZHJpdmVycy9ncHUvZHJtL2k5MTUv
ZGlzcGxheS9pbnRlbF9sc3Bjb24uYyAgIHwgICA0ICstCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9k
aXNwbGF5L2ludGVsX2x2ZHMuYyAgICAgfCAgIDggKy0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2Rp
c3BsYXkvaW50ZWxfcGFuZWwuYyAgICB8ICAgOCArLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlz
cGxheS9pbnRlbF9waXBlX2NyYy5jIHwgICAyICstCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNw
bGF5L2ludGVsX3Bzci5jICAgICAgfCAgMTIgKy0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3Bs
YXkvaW50ZWxfc2R2by5jICAgICB8ICAxNiArLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxh
eS9pbnRlbF9zcHJpdGUuYyAgIHwgICA4ICstCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5
L2ludGVsX3R2LmMgICAgICAgfCAgIDQgKy0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkv
aW50ZWxfdmRzYy5jICAgICB8ICAgNCArLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS92
bHZfZHNpLmMgICAgICAgIHwgIDEwICstCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2RlYnVn
ZnMuYyAgICAgICAgICAgfCAgIDggKy0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2ludGVsX3BtLmMg
ICAgICAgICAgICAgICB8ICA1NiArKy0tCiAyNSBmaWxlcyBjaGFuZ2VkLCAzMTggaW5zZXJ0aW9u
cygrKSwgMzEzIGRlbGV0aW9ucygtKQoKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9kcm1f
ZHBfbXN0X3RvcG9sb2d5LmMgYi9kcml2ZXJzL2dwdS9kcm0vZHJtX2RwX21zdF90b3BvbG9neS5j
CmluZGV4IDg1YmVmNzNhNjc2My4uZmRkZWE3YWNmN2Q4IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dw
dS9kcm0vZHJtX2RwX21zdF90b3BvbG9neS5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9kcm1fZHBf
bXN0X3RvcG9sb2d5LmMKQEAgLTMzLDYgKzMzLDcgQEAKICNpbmNsdWRlIDxsaW51eC9zb3J0Lmg+
CiAjaW5jbHVkZSA8bGludXgvdGltZWtlZXBpbmcuaD4KICNpbmNsdWRlIDxsaW51eC9tYXRoNjQu
aD4KKyNpbmNsdWRlIDxsaW51eC9zdGFja3RyYWNlLmg+CiAjZW5kaWYKIAogI2luY2x1ZGUgPGRy
bS9kcm1fYXRvbWljLmg+CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5
L2ljbF9kc2kuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaWNsX2RzaS5jCmluZGV4
IDZlMzk4YzMzYTUyNC4uNGVjNDkzZTQ3NTViIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0v
aTkxNS9kaXNwbGF5L2ljbF9kc2kuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5
L2ljbF9kc2kuYwpAQCAtMjc2LDcgKzI3Niw3IEBAIHN0YXRpYyB2b2lkIGNvbmZpZ3VyZV9kdWFs
X2xpbmtfbW9kZShzdHJ1Y3QgaW50ZWxfZW5jb2RlciAqZW5jb2RlciwKIAogCWlmIChpbnRlbF9k
c2ktPmR1YWxfbGluayA9PSBEU0lfRFVBTF9MSU5LX0ZST05UX0JBQ0spIHsKIAkJY29uc3Qgc3Ry
dWN0IGRybV9kaXNwbGF5X21vZGUgKmFkanVzdGVkX21vZGUgPQotCQkJCQkmcGlwZV9jb25maWct
PmJhc2UuYWRqdXN0ZWRfbW9kZTsKKwkJCQkJJnBpcGVfY29uZmlnLT5ody5hZGp1c3RlZF9tb2Rl
OwogCQl1MzIgZHNzX2N0bDI7CiAJCXUxNiBoYWN0aXZlID0gYWRqdXN0ZWRfbW9kZS0+Y3J0Y19o
ZGlzcGxheTsKIAkJdTE2IGRsX2J1ZmZlcl9kZXB0aDsKQEAgLTc2OCw3ICs3NjgsNyBAQCBnZW4x
MV9kc2lfc2V0X3RyYW5zY29kZXJfdGltaW5ncyhzdHJ1Y3QgaW50ZWxfZW5jb2RlciAqZW5jb2Rl
ciwKIAlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGVuY29kZXIt
PmJhc2UuZGV2KTsKIAlzdHJ1Y3QgaW50ZWxfZHNpICppbnRlbF9kc2kgPSBlbmNfdG9faW50ZWxf
ZHNpKCZlbmNvZGVyLT5iYXNlKTsKIAljb25zdCBzdHJ1Y3QgZHJtX2Rpc3BsYXlfbW9kZSAqYWRq
dXN0ZWRfbW9kZSA9Ci0JCQkJCSZwaXBlX2NvbmZpZy0+YmFzZS5hZGp1c3RlZF9tb2RlOworCQkJ
CQkmcGlwZV9jb25maWctPmh3LmFkanVzdGVkX21vZGU7CiAJZW51bSBwb3J0IHBvcnQ7CiAJZW51
bSB0cmFuc2NvZGVyIGRzaV90cmFuczsKIAkvKiBob3Jpem9udGFsIHRpbWluZ3MgKi8KQEAgLTEy
MTYsNyArMTIxNiw3IEBAIHN0YXRpYyB2b2lkIGdlbjExX2RzaV9nZXRfdGltaW5ncyhzdHJ1Y3Qg
aW50ZWxfZW5jb2RlciAqZW5jb2RlciwKIHsKIAlzdHJ1Y3QgaW50ZWxfZHNpICppbnRlbF9kc2kg
PSBlbmNfdG9faW50ZWxfZHNpKCZlbmNvZGVyLT5iYXNlKTsKIAlzdHJ1Y3QgZHJtX2Rpc3BsYXlf
bW9kZSAqYWRqdXN0ZWRfbW9kZSA9Ci0JCQkJCSZwaXBlX2NvbmZpZy0+YmFzZS5hZGp1c3RlZF9t
b2RlOworCQkJCQkmcGlwZV9jb25maWctPmh3LmFkanVzdGVkX21vZGU7CiAKIAlpZiAoaW50ZWxf
ZHNpLT5kdWFsX2xpbmspIHsKIAkJYWRqdXN0ZWRfbW9kZS0+Y3J0Y19oZGlzcGxheSAqPSAyOwpA
QCAtMTI0OSw5ICsxMjQ5LDkgQEAgc3RhdGljIHZvaWQgZ2VuMTFfZHNpX2dldF9jb25maWcoc3Ry
dWN0IGludGVsX2VuY29kZXIgKmVuY29kZXIsCiAJcGlwZV9jb25maWctPnBvcnRfY2xvY2sgPQog
CQljbmxfY2FsY193cnBsbF9saW5rKGRldl9wcml2LCAmcGlwZV9jb25maWctPmRwbGxfaHdfc3Rh
dGUpOwogCi0JcGlwZV9jb25maWctPmJhc2UuYWRqdXN0ZWRfbW9kZS5jcnRjX2Nsb2NrID0gaW50
ZWxfZHNpLT5wY2xrOworCXBpcGVfY29uZmlnLT5ody5hZGp1c3RlZF9tb2RlLmNydGNfY2xvY2sg
PSBpbnRlbF9kc2ktPnBjbGs7CiAJaWYgKGludGVsX2RzaS0+ZHVhbF9saW5rKQotCQlwaXBlX2Nv
bmZpZy0+YmFzZS5hZGp1c3RlZF9tb2RlLmNydGNfY2xvY2sgKj0gMjsKKwkJcGlwZV9jb25maWct
Pmh3LmFkanVzdGVkX21vZGUuY3J0Y19jbG9jayAqPSAyOwogCiAJZ2VuMTFfZHNpX2dldF90aW1p
bmdzKGVuY29kZXIsIHBpcGVfY29uZmlnKTsKIAlwaXBlX2NvbmZpZy0+b3V0cHV0X3R5cGVzIHw9
IEJJVChJTlRFTF9PVVRQVVRfRFNJKTsKQEAgLTEyNjksNyArMTI2OSw3IEBAIHN0YXRpYyBpbnQg
Z2VuMTFfZHNpX2NvbXB1dGVfY29uZmlnKHN0cnVjdCBpbnRlbF9lbmNvZGVyICplbmNvZGVyLAog
CWNvbnN0IHN0cnVjdCBkcm1fZGlzcGxheV9tb2RlICpmaXhlZF9tb2RlID0KIAkJCQkJaW50ZWxf
Y29ubmVjdG9yLT5wYW5lbC5maXhlZF9tb2RlOwogCXN0cnVjdCBkcm1fZGlzcGxheV9tb2RlICph
ZGp1c3RlZF9tb2RlID0KLQkJCQkJJnBpcGVfY29uZmlnLT5iYXNlLmFkanVzdGVkX21vZGU7CisJ
CQkJCSZwaXBlX2NvbmZpZy0+aHcuYWRqdXN0ZWRfbW9kZTsKIAogCXBpcGVfY29uZmlnLT5vdXRw
dXRfZm9ybWF0ID0gSU5URUxfT1VUUFVUX0ZPUk1BVF9SR0I7CiAJaW50ZWxfZml4ZWRfcGFuZWxf
bW9kZShmaXhlZF9tb2RlLCBhZGp1c3RlZF9tb2RlKTsKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1
L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfYXVkaW8uYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rp
c3BsYXkvaW50ZWxfYXVkaW8uYwppbmRleCA4NWU2YjJiYmIzNGYuLjY3NDAxOTFkMzU1NyAxMDA2
NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9hdWRpby5jCisrKyBi
L2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfYXVkaW8uYwpAQCAtMjM0LDcgKzIz
NCw3IEBAIHN0YXRpYyBjb25zdCBzdHJ1Y3QgaGRtaV9hdWRfbmN0cyBoZG1pX2F1ZF9uY3RzXzM2
YnBwW10gPSB7CiBzdGF0aWMgdTMyIGF1ZGlvX2NvbmZpZ19oZG1pX3BpeGVsX2Nsb2NrKGNvbnN0
IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlKQogewogCWNvbnN0IHN0cnVjdCBk
cm1fZGlzcGxheV9tb2RlICphZGp1c3RlZF9tb2RlID0KLQkJJmNydGNfc3RhdGUtPmJhc2UuYWRq
dXN0ZWRfbW9kZTsKKwkJJmNydGNfc3RhdGUtPmh3LmFkanVzdGVkX21vZGU7CiAJaW50IGk7CiAK
IAlmb3IgKGkgPSAwOyBpIDwgQVJSQVlfU0laRShoZG1pX2F1ZGlvX2Nsb2NrKTsgaSsrKSB7CkBA
IC02OTUsNyArNjk1LDcgQEAgdm9pZCBpbnRlbF9hdWRpb19jb2RlY19lbmFibGUoc3RydWN0IGlu
dGVsX2VuY29kZXIgKmVuY29kZXIsCiAJc3RydWN0IGludGVsX2NydGMgKmNydGMgPSB0b19pbnRl
bF9jcnRjKGNydGNfc3RhdGUtPmJhc2UuY3J0Yyk7CiAJc3RydWN0IGRybV9jb25uZWN0b3IgKmNv
bm5lY3RvciA9IGNvbm5fc3RhdGUtPmNvbm5lY3RvcjsKIAljb25zdCBzdHJ1Y3QgZHJtX2Rpc3Bs
YXlfbW9kZSAqYWRqdXN0ZWRfbW9kZSA9Ci0JCSZjcnRjX3N0YXRlLT5iYXNlLmFkanVzdGVkX21v
ZGU7CisJCSZjcnRjX3N0YXRlLT5ody5hZGp1c3RlZF9tb2RlOwogCWVudW0gcG9ydCBwb3J0ID0g
ZW5jb2Rlci0+cG9ydDsKIAllbnVtIHBpcGUgcGlwZSA9IGNydGMtPnBpcGU7CiAKZGlmZiAtLWdp
dCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfY2RjbGsuYyBiL2RyaXZlcnMv
Z3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfY2RjbGsuYwppbmRleCBhOWU5NTEwZDJkMDcuLjgy
NDE1ZTk4OTM1NyAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRl
bF9jZGNsay5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfY2RjbGsu
YwpAQCAtMTkzNyw3ICsxOTM3LDcgQEAgaW50IGludGVsX2NydGNfY29tcHV0ZV9taW5fY2RjbGso
Y29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUpCiAJCXRvX2k5MTUoY3J0
Y19zdGF0ZS0+YmFzZS5jcnRjLT5kZXYpOwogCWludCBtaW5fY2RjbGs7CiAKLQlpZiAoIWNydGNf
c3RhdGUtPmJhc2UuZW5hYmxlKQorCWlmICghY3J0Y19zdGF0ZS0+aHcuZW5hYmxlKQogCQlyZXR1
cm4gMDsKIAogCW1pbl9jZGNsayA9IGludGVsX3BpeGVsX3JhdGVfdG9fY2RjbGsoY3J0Y19zdGF0
ZSk7CkBAIC0yMDc0LDcgKzIwNzQsNyBAQCBzdGF0aWMgaW50IGJ4dF9jb21wdXRlX21pbl92b2x0
YWdlX2xldmVsKHN0cnVjdCBpbnRlbF9hdG9taWNfc3RhdGUgKnN0YXRlKQogCWZvcl9lYWNoX25l
d19pbnRlbF9jcnRjX2luX3N0YXRlKHN0YXRlLCBjcnRjLCBjcnRjX3N0YXRlLCBpKSB7CiAJCWlu
dCByZXQ7CiAKLQkJaWYgKGNydGNfc3RhdGUtPmJhc2UuZW5hYmxlKQorCQlpZiAoY3J0Y19zdGF0
ZS0+aHcuZW5hYmxlKQogCQkJbWluX3ZvbHRhZ2VfbGV2ZWwgPSBjcnRjX3N0YXRlLT5taW5fdm9s
dGFnZV9sZXZlbDsKIAkJZWxzZQogCQkJbWluX3ZvbHRhZ2VfbGV2ZWwgPSAwOwpAQCAtMjE2OCw3
ICsyMTY4LDcgQEAgc3RhdGljIGludCBza2xfZHBsbDBfdmNvKHN0cnVjdCBpbnRlbF9hdG9taWNf
c3RhdGUgKnN0YXRlKQogCQl2Y28gPSBkZXZfcHJpdi0+c2tsX3ByZWZlcnJlZF92Y29fZnJlcTsK
IAogCWZvcl9lYWNoX25ld19pbnRlbF9jcnRjX2luX3N0YXRlKHN0YXRlLCBjcnRjLCBjcnRjX3N0
YXRlLCBpKSB7Ci0JCWlmICghY3J0Y19zdGF0ZS0+YmFzZS5lbmFibGUpCisJCWlmICghY3J0Y19z
dGF0ZS0+aHcuZW5hYmxlKQogCQkJY29udGludWU7CiAKIAkJaWYgKCFpbnRlbF9jcnRjX2hhc190
eXBlKGNydGNfc3RhdGUsIElOVEVMX09VVFBVVF9FRFApKQpAQCAtMjI4Miw3ICsyMjgyLDcgQEAg
c3RhdGljIGludCBpbnRlbF9tb2Rlc2V0X2FsbF9waXBlcyhzdHJ1Y3QgaW50ZWxfYXRvbWljX3N0
YXRlICpzdGF0ZSkKIAkJaWYgKElTX0VSUihjcnRjX3N0YXRlKSkKIAkJCXJldHVybiBQVFJfRVJS
KGNydGNfc3RhdGUpOwogCi0JCWlmICghY3J0Y19zdGF0ZS0+YmFzZS5hY3RpdmUgfHwKKwkJaWYg
KCFjcnRjX3N0YXRlLT5ody5hY3RpdmUgfHwKIAkJICAgIGRybV9hdG9taWNfY3J0Y19uZWVkc19t
b2Rlc2V0KCZjcnRjX3N0YXRlLT5iYXNlKSkKIAkJCWNvbnRpbnVlOwogCmRpZmYgLS1naXQgYS9k
cml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2NvbG9yLmMgYi9kcml2ZXJzL2dwdS9k
cm0vaTkxNS9kaXNwbGF5L2ludGVsX2NvbG9yLmMKaW5kZXggOTU1ODZhNTg4MjM0Li42NWUxYjE4
YmQ3ZTMgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfY29s
b3IuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2NvbG9yLmMKQEAg
LTExNywxMCArMTE3LDEwIEBAIHN0YXRpYyBib29sIGx1dF9pc19sZWdhY3koY29uc3Qgc3RydWN0
IGRybV9wcm9wZXJ0eV9ibG9iICpsdXQpCiAKIHN0YXRpYyBib29sIGNydGNfc3RhdGVfaXNfbGVn
YWN5X2dhbW1hKGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlKQogewot
CXJldHVybiAhY3J0Y19zdGF0ZS0+YmFzZS5kZWdhbW1hX2x1dCAmJgotCQkhY3J0Y19zdGF0ZS0+
YmFzZS5jdG0gJiYKLQkJY3J0Y19zdGF0ZS0+YmFzZS5nYW1tYV9sdXQgJiYKLQkJbHV0X2lzX2xl
Z2FjeShjcnRjX3N0YXRlLT5iYXNlLmdhbW1hX2x1dCk7CisJcmV0dXJuICFjcnRjX3N0YXRlLT5o
dy5kZWdhbW1hX2x1dCAmJgorCQkhY3J0Y19zdGF0ZS0+aHcuY3RtICYmCisJCWNydGNfc3RhdGUt
Pmh3LmdhbW1hX2x1dCAmJgorCQlsdXRfaXNfbGVnYWN5KGNydGNfc3RhdGUtPmh3LmdhbW1hX2x1
dCk7CiB9CiAKIC8qCkBAIC0yMTksNyArMjE5LDcgQEAgc3RhdGljIGJvb2wgaWxrX2NzY19saW1p
dGVkX3JhbmdlKGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlKQogc3Rh
dGljIHZvaWQgaWxrX2NzY19jb252ZXJ0X2N0bShjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0
ZSAqY3J0Y19zdGF0ZSwKIAkJCQl1MTYgY29lZmZzWzldKQogewotCWNvbnN0IHN0cnVjdCBkcm1f
Y29sb3JfY3RtICpjdG0gPSBjcnRjX3N0YXRlLT5iYXNlLmN0bS0+ZGF0YTsKKwljb25zdCBzdHJ1
Y3QgZHJtX2NvbG9yX2N0bSAqY3RtID0gY3J0Y19zdGF0ZS0+aHcuY3RtLT5kYXRhOwogCWNvbnN0
IHU2NCAqaW5wdXQ7CiAJdTY0IHRlbXBbOV07CiAJaW50IGk7CkBAIC0yNzQsNyArMjc0LDcgQEAg
c3RhdGljIHZvaWQgaWxrX2xvYWRfY3NjX21hdHJpeChjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19z
dGF0ZSAqY3J0Y19zdGF0ZSkKIAlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0
b19pOTE1KGNydGMtPmJhc2UuZGV2KTsKIAlib29sIGxpbWl0ZWRfY29sb3JfcmFuZ2UgPSBpbGtf
Y3NjX2xpbWl0ZWRfcmFuZ2UoY3J0Y19zdGF0ZSk7CiAKLQlpZiAoY3J0Y19zdGF0ZS0+YmFzZS5j
dG0pIHsKKwlpZiAoY3J0Y19zdGF0ZS0+aHcuY3RtKSB7CiAJCXUxNiBjb2VmZls5XTsKIAogCQlp
bGtfY3NjX2NvbnZlcnRfY3RtKGNydGNfc3RhdGUsIGNvZWZmKTsKQEAgLTMxMiw3ICszMTIsNyBA
QCBzdGF0aWMgdm9pZCBpY2xfbG9hZF9jc2NfbWF0cml4KGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRj
X3N0YXRlICpjcnRjX3N0YXRlKQogCXN0cnVjdCBpbnRlbF9jcnRjICpjcnRjID0gdG9faW50ZWxf
Y3J0YyhjcnRjX3N0YXRlLT5iYXNlLmNydGMpOwogCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpk
ZXZfcHJpdiA9IHRvX2k5MTUoY3J0Yy0+YmFzZS5kZXYpOwogCi0JaWYgKGNydGNfc3RhdGUtPmJh
c2UuY3RtKSB7CisJaWYgKGNydGNfc3RhdGUtPmh3LmN0bSkgewogCQl1MTYgY29lZmZbOV07CiAK
IAkJaWxrX2NzY19jb252ZXJ0X2N0bShjcnRjX3N0YXRlLCBjb2VmZik7CkBAIC0zNDIsOCArMzQy
LDggQEAgc3RhdGljIHZvaWQgY2hlcnJ5dmlld19sb2FkX2NzY19tYXRyaXgoY29uc3Qgc3RydWN0
IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUKIAlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAq
ZGV2X3ByaXYgPSB0b19pOTE1KGNydGMtPmJhc2UuZGV2KTsKIAllbnVtIHBpcGUgcGlwZSA9IGNy
dGMtPnBpcGU7CiAKLQlpZiAoY3J0Y19zdGF0ZS0+YmFzZS5jdG0pIHsKLQkJY29uc3Qgc3RydWN0
IGRybV9jb2xvcl9jdG0gKmN0bSA9IGNydGNfc3RhdGUtPmJhc2UuY3RtLT5kYXRhOworCWlmIChj
cnRjX3N0YXRlLT5ody5jdG0pIHsKKwkJY29uc3Qgc3RydWN0IGRybV9jb2xvcl9jdG0gKmN0bSA9
IGNydGNfc3RhdGUtPmh3LmN0bS0+ZGF0YTsKIAkJdTE2IGNvZWZmc1s5XSA9IHt9OwogCQlpbnQg
aTsKIApAQCAtNDM1LDcgKzQzNSw3IEBAIHN0YXRpYyB2b2lkIGk5eHhfbG9hZF9sdXRzX2ludGVy
bmFsKGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlLAogCiBzdGF0aWMg
dm9pZCBpOXh4X2xvYWRfbHV0cyhjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19z
dGF0ZSkKIHsKLQlpOXh4X2xvYWRfbHV0c19pbnRlcm5hbChjcnRjX3N0YXRlLCBjcnRjX3N0YXRl
LT5iYXNlLmdhbW1hX2x1dCk7CisJaTl4eF9sb2FkX2x1dHNfaW50ZXJuYWwoY3J0Y19zdGF0ZSwg
Y3J0Y19zdGF0ZS0+aHcuZ2FtbWFfbHV0KTsKIH0KIAogc3RhdGljIHZvaWQgaTl4eF9jb2xvcl9j
b21taXQoY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUpCkBAIC01MjUs
NyArNTI1LDcgQEAgc3RhdGljIHZvaWQgaTk2NV9sb2FkX2x1dF8xMHA2KHN0cnVjdCBpbnRlbF9j
cnRjICpjcnRjLAogc3RhdGljIHZvaWQgaTk2NV9sb2FkX2x1dHMoY29uc3Qgc3RydWN0IGludGVs
X2NydGNfc3RhdGUgKmNydGNfc3RhdGUpCiB7CiAJc3RydWN0IGludGVsX2NydGMgKmNydGMgPSB0
b19pbnRlbF9jcnRjKGNydGNfc3RhdGUtPmJhc2UuY3J0Yyk7Ci0JY29uc3Qgc3RydWN0IGRybV9w
cm9wZXJ0eV9ibG9iICpnYW1tYV9sdXQgPSBjcnRjX3N0YXRlLT5iYXNlLmdhbW1hX2x1dDsKKwlj
b25zdCBzdHJ1Y3QgZHJtX3Byb3BlcnR5X2Jsb2IgKmdhbW1hX2x1dCA9IGNydGNfc3RhdGUtPmh3
LmdhbW1hX2x1dDsKIAogCWlmIChjcnRjX3N0YXRlLT5nYW1tYV9tb2RlID09IEdBTU1BX01PREVf
TU9ERV84QklUKQogCQlpOXh4X2xvYWRfbHV0cyhjcnRjX3N0YXRlKTsKQEAgLTU0OCw3ICs1NDgs
NyBAQCBzdGF0aWMgdm9pZCBpbGtfbG9hZF9sdXRfMTAoc3RydWN0IGludGVsX2NydGMgKmNydGMs
CiBzdGF0aWMgdm9pZCBpbGtfbG9hZF9sdXRzKGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRl
ICpjcnRjX3N0YXRlKQogewogCXN0cnVjdCBpbnRlbF9jcnRjICpjcnRjID0gdG9faW50ZWxfY3J0
YyhjcnRjX3N0YXRlLT5iYXNlLmNydGMpOwotCWNvbnN0IHN0cnVjdCBkcm1fcHJvcGVydHlfYmxv
YiAqZ2FtbWFfbHV0ID0gY3J0Y19zdGF0ZS0+YmFzZS5nYW1tYV9sdXQ7CisJY29uc3Qgc3RydWN0
IGRybV9wcm9wZXJ0eV9ibG9iICpnYW1tYV9sdXQgPSBjcnRjX3N0YXRlLT5ody5nYW1tYV9sdXQ7
CiAKIAlpZiAoY3J0Y19zdGF0ZS0+Z2FtbWFfbW9kZSA9PSBHQU1NQV9NT0RFX01PREVfOEJJVCkK
IAkJaTl4eF9sb2FkX2x1dHMoY3J0Y19zdGF0ZSk7CkBAIC02NTUsOCArNjU1LDggQEAgc3RhdGlj
IHZvaWQgaXZiX2xvYWRfbHV0X2V4dF9tYXgoc3RydWN0IGludGVsX2NydGMgKmNydGMpCiBzdGF0
aWMgdm9pZCBpdmJfbG9hZF9sdXRzKGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRj
X3N0YXRlKQogewogCXN0cnVjdCBpbnRlbF9jcnRjICpjcnRjID0gdG9faW50ZWxfY3J0YyhjcnRj
X3N0YXRlLT5iYXNlLmNydGMpOwotCWNvbnN0IHN0cnVjdCBkcm1fcHJvcGVydHlfYmxvYiAqZ2Ft
bWFfbHV0ID0gY3J0Y19zdGF0ZS0+YmFzZS5nYW1tYV9sdXQ7Ci0JY29uc3Qgc3RydWN0IGRybV9w
cm9wZXJ0eV9ibG9iICpkZWdhbW1hX2x1dCA9IGNydGNfc3RhdGUtPmJhc2UuZGVnYW1tYV9sdXQ7
CisJY29uc3Qgc3RydWN0IGRybV9wcm9wZXJ0eV9ibG9iICpnYW1tYV9sdXQgPSBjcnRjX3N0YXRl
LT5ody5nYW1tYV9sdXQ7CisJY29uc3Qgc3RydWN0IGRybV9wcm9wZXJ0eV9ibG9iICpkZWdhbW1h
X2x1dCA9IGNydGNfc3RhdGUtPmh3LmRlZ2FtbWFfbHV0OwogCiAJaWYgKGNydGNfc3RhdGUtPmdh
bW1hX21vZGUgPT0gR0FNTUFfTU9ERV9NT0RFXzhCSVQpIHsKIAkJaTl4eF9sb2FkX2x1dHMoY3J0
Y19zdGF0ZSk7CkBAIC02NzgsOCArNjc4LDggQEAgc3RhdGljIHZvaWQgaXZiX2xvYWRfbHV0cyhj
b25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSkKIHN0YXRpYyB2b2lkIGJk
d19sb2FkX2x1dHMoY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUpCiB7
CiAJc3RydWN0IGludGVsX2NydGMgKmNydGMgPSB0b19pbnRlbF9jcnRjKGNydGNfc3RhdGUtPmJh
c2UuY3J0Yyk7Ci0JY29uc3Qgc3RydWN0IGRybV9wcm9wZXJ0eV9ibG9iICpnYW1tYV9sdXQgPSBj
cnRjX3N0YXRlLT5iYXNlLmdhbW1hX2x1dDsKLQljb25zdCBzdHJ1Y3QgZHJtX3Byb3BlcnR5X2Js
b2IgKmRlZ2FtbWFfbHV0ID0gY3J0Y19zdGF0ZS0+YmFzZS5kZWdhbW1hX2x1dDsKKwljb25zdCBz
dHJ1Y3QgZHJtX3Byb3BlcnR5X2Jsb2IgKmdhbW1hX2x1dCA9IGNydGNfc3RhdGUtPmh3LmdhbW1h
X2x1dDsKKwljb25zdCBzdHJ1Y3QgZHJtX3Byb3BlcnR5X2Jsb2IgKmRlZ2FtbWFfbHV0ID0gY3J0
Y19zdGF0ZS0+aHcuZGVnYW1tYV9sdXQ7CiAKIAlpZiAoY3J0Y19zdGF0ZS0+Z2FtbWFfbW9kZSA9
PSBHQU1NQV9NT0RFX01PREVfOEJJVCkgewogCQlpOXh4X2xvYWRfbHV0cyhjcnRjX3N0YXRlKTsK
QEAgLTcwNCw3ICs3MDQsNyBAQCBzdGF0aWMgdm9pZCBnbGtfbG9hZF9kZWdhbW1hX2x1dChjb25z
dCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSkKIAlzdHJ1Y3QgZHJtX2k5MTVf
cHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGNydGMtPmJhc2UuZGV2KTsKIAllbnVtIHBpcGUg
cGlwZSA9IGNydGMtPnBpcGU7CiAJY29uc3QgdTMyIGx1dF9zaXplID0gSU5URUxfSU5GTyhkZXZf
cHJpdiktPmNvbG9yLmRlZ2FtbWFfbHV0X3NpemU7Ci0JY29uc3Qgc3RydWN0IGRybV9jb2xvcl9s
dXQgKmx1dCA9IGNydGNfc3RhdGUtPmJhc2UuZGVnYW1tYV9sdXQtPmRhdGE7CisJY29uc3Qgc3Ry
dWN0IGRybV9jb2xvcl9sdXQgKmx1dCA9IGNydGNfc3RhdGUtPmh3LmRlZ2FtbWFfbHV0LT5kYXRh
OwogCXUzMiBpOwogCiAJLyoKQEAgLTc2Niw3ICs3NjYsNyBAQCBzdGF0aWMgdm9pZCBnbGtfbG9h
ZF9kZWdhbW1hX2x1dF9saW5lYXIoY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNf
c3RhdAogCiBzdGF0aWMgdm9pZCBnbGtfbG9hZF9sdXRzKGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRj
X3N0YXRlICpjcnRjX3N0YXRlKQogewotCWNvbnN0IHN0cnVjdCBkcm1fcHJvcGVydHlfYmxvYiAq
Z2FtbWFfbHV0ID0gY3J0Y19zdGF0ZS0+YmFzZS5nYW1tYV9sdXQ7CisJY29uc3Qgc3RydWN0IGRy
bV9wcm9wZXJ0eV9ibG9iICpnYW1tYV9sdXQgPSBjcnRjX3N0YXRlLT5ody5nYW1tYV9sdXQ7CiAJ
c3RydWN0IGludGVsX2NydGMgKmNydGMgPSB0b19pbnRlbF9jcnRjKGNydGNfc3RhdGUtPmJhc2Uu
Y3J0Yyk7CiAKIAkvKgpAQCAtNzc3LDcgKzc3Nyw3IEBAIHN0YXRpYyB2b2lkIGdsa19sb2FkX2x1
dHMoY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUpCiAJICogdGhlIGRl
Z2FtYSBMVVQgc28gdGhhdCB3ZSBkb24ndCBoYXZlIHRvIHJlbG9hZAogCSAqIGl0IGV2ZXJ5IHRp
bWUgdGhlIHBpcGUgQ1NDIGlzIGJlaW5nIGVuYWJsZWQuCiAJICovCi0JaWYgKGNydGNfc3RhdGUt
PmJhc2UuZGVnYW1tYV9sdXQpCisJaWYgKGNydGNfc3RhdGUtPmh3LmRlZ2FtbWFfbHV0KQogCQln
bGtfbG9hZF9kZWdhbW1hX2x1dChjcnRjX3N0YXRlKTsKIAllbHNlCiAJCWdsa19sb2FkX2RlZ2Ft
bWFfbHV0X2xpbmVhcihjcnRjX3N0YXRlKTsKQEAgLTgyMyw3ICs4MjMsNyBAQCBzdGF0aWMgdm9p
ZAogaWNsX3Byb2dyYW1fZ2FtbWFfc3VwZXJmaW5lX3NlZ21lbnQoY29uc3Qgc3RydWN0IGludGVs
X2NydGNfc3RhdGUgKmNydGNfc3RhdGUpCiB7CiAJc3RydWN0IGludGVsX2NydGMgKmNydGMgPSB0
b19pbnRlbF9jcnRjKGNydGNfc3RhdGUtPmJhc2UuY3J0Yyk7Ci0JY29uc3Qgc3RydWN0IGRybV9w
cm9wZXJ0eV9ibG9iICpibG9iID0gY3J0Y19zdGF0ZS0+YmFzZS5nYW1tYV9sdXQ7CisJY29uc3Qg
c3RydWN0IGRybV9wcm9wZXJ0eV9ibG9iICpibG9iID0gY3J0Y19zdGF0ZS0+aHcuZ2FtbWFfbHV0
OwogCWNvbnN0IHN0cnVjdCBkcm1fY29sb3JfbHV0ICpsdXQgPSBibG9iLT5kYXRhOwogCXN0cnVj
dCBpbnRlbF9kc2IgKmRzYiA9IGludGVsX2RzYl9nZXQoY3J0Yyk7CiAJZW51bSBwaXBlIHBpcGUg
PSBjcnRjLT5waXBlOwpAQCAtODU1LDcgKzg1NSw3IEBAIHN0YXRpYyB2b2lkCiBpY2xfcHJvZ3Jh
bV9nYW1tYV9tdWx0aV9zZWdtZW50KGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRj
X3N0YXRlKQogewogCXN0cnVjdCBpbnRlbF9jcnRjICpjcnRjID0gdG9faW50ZWxfY3J0YyhjcnRj
X3N0YXRlLT5iYXNlLmNydGMpOwotCWNvbnN0IHN0cnVjdCBkcm1fcHJvcGVydHlfYmxvYiAqYmxv
YiA9IGNydGNfc3RhdGUtPmJhc2UuZ2FtbWFfbHV0OworCWNvbnN0IHN0cnVjdCBkcm1fcHJvcGVy
dHlfYmxvYiAqYmxvYiA9IGNydGNfc3RhdGUtPmh3LmdhbW1hX2x1dDsKIAljb25zdCBzdHJ1Y3Qg
ZHJtX2NvbG9yX2x1dCAqbHV0ID0gYmxvYi0+ZGF0YTsKIAljb25zdCBzdHJ1Y3QgZHJtX2NvbG9y
X2x1dCAqZW50cnk7CiAJc3RydWN0IGludGVsX2RzYiAqZHNiID0gaW50ZWxfZHNiX2dldChjcnRj
KTsKQEAgLTkxMCwxMSArOTEwLDExIEBAIGljbF9wcm9ncmFtX2dhbW1hX211bHRpX3NlZ21lbnQo
Y29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUpCiAKIHN0YXRpYyB2b2lk
IGljbF9sb2FkX2x1dHMoY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUp
CiB7Ci0JY29uc3Qgc3RydWN0IGRybV9wcm9wZXJ0eV9ibG9iICpnYW1tYV9sdXQgPSBjcnRjX3N0
YXRlLT5iYXNlLmdhbW1hX2x1dDsKKwljb25zdCBzdHJ1Y3QgZHJtX3Byb3BlcnR5X2Jsb2IgKmdh
bW1hX2x1dCA9IGNydGNfc3RhdGUtPmh3LmdhbW1hX2x1dDsKIAlzdHJ1Y3QgaW50ZWxfY3J0YyAq
Y3J0YyA9IHRvX2ludGVsX2NydGMoY3J0Y19zdGF0ZS0+YmFzZS5jcnRjKTsKIAlzdHJ1Y3QgaW50
ZWxfZHNiICpkc2IgPSBpbnRlbF9kc2JfZ2V0KGNydGMpOwogCi0JaWYgKGNydGNfc3RhdGUtPmJh
c2UuZGVnYW1tYV9sdXQpCisJaWYgKGNydGNfc3RhdGUtPmh3LmRlZ2FtbWFfbHV0KQogCQlnbGtf
bG9hZF9kZWdhbW1hX2x1dChjcnRjX3N0YXRlKTsKIAogCXN3aXRjaCAoY3J0Y19zdGF0ZS0+Z2Ft
bWFfbW9kZSAmIEdBTU1BX01PREVfTU9ERV9NQVNLKSB7CkBAIC05OTEsOCArOTkxLDggQEAgc3Rh
dGljIHZvaWQgY2h2X2xvYWRfY2dtX2dhbW1hKHN0cnVjdCBpbnRlbF9jcnRjICpjcnRjLAogc3Rh
dGljIHZvaWQgY2h2X2xvYWRfbHV0cyhjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0
Y19zdGF0ZSkKIHsKIAlzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YyA9IHRvX2ludGVsX2NydGMoY3J0
Y19zdGF0ZS0+YmFzZS5jcnRjKTsKLQljb25zdCBzdHJ1Y3QgZHJtX3Byb3BlcnR5X2Jsb2IgKmdh
bW1hX2x1dCA9IGNydGNfc3RhdGUtPmJhc2UuZ2FtbWFfbHV0OwotCWNvbnN0IHN0cnVjdCBkcm1f
cHJvcGVydHlfYmxvYiAqZGVnYW1tYV9sdXQgPSBjcnRjX3N0YXRlLT5iYXNlLmRlZ2FtbWFfbHV0
OworCWNvbnN0IHN0cnVjdCBkcm1fcHJvcGVydHlfYmxvYiAqZ2FtbWFfbHV0ID0gY3J0Y19zdGF0
ZS0+aHcuZ2FtbWFfbHV0OworCWNvbnN0IHN0cnVjdCBkcm1fcHJvcGVydHlfYmxvYiAqZGVnYW1t
YV9sdXQgPSBjcnRjX3N0YXRlLT5ody5kZWdhbW1hX2x1dDsKIAogCWNoZXJyeXZpZXdfbG9hZF9j
c2NfbWF0cml4KGNydGNfc3RhdGUpOwogCkBAIC0xMDYzLDcgKzEwNjMsNyBAQCBpbnRlbF9jb2xv
cl9hZGRfYWZmZWN0ZWRfcGxhbmVzKHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpuZXdfY3J0Y19z
dGF0ZSkKIAkJaW50ZWxfYXRvbWljX2dldF9vbGRfY3J0Y19zdGF0ZShzdGF0ZSwgY3J0Yyk7CiAJ
c3RydWN0IGludGVsX3BsYW5lICpwbGFuZTsKIAotCWlmICghbmV3X2NydGNfc3RhdGUtPmJhc2Uu
YWN0aXZlIHx8CisJaWYgKCFuZXdfY3J0Y19zdGF0ZS0+aHcuYWN0aXZlIHx8CiAJICAgIGRybV9h
dG9taWNfY3J0Y19uZWVkc19tb2Rlc2V0KCZuZXdfY3J0Y19zdGF0ZS0+YmFzZSkpCiAJCXJldHVy
biAwOwogCkBAIC0xMTA4LDggKzExMDgsOCBAQCBzdGF0aWMgaW50IGNoZWNrX2x1dF9zaXplKGNv
bnN0IHN0cnVjdCBkcm1fcHJvcGVydHlfYmxvYiAqbHV0LCBpbnQgZXhwZWN0ZWQpCiBzdGF0aWMg
aW50IGNoZWNrX2x1dHMoY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUp
CiB7CiAJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShjcnRjX3N0
YXRlLT5iYXNlLmNydGMtPmRldik7Ci0JY29uc3Qgc3RydWN0IGRybV9wcm9wZXJ0eV9ibG9iICpn
YW1tYV9sdXQgPSBjcnRjX3N0YXRlLT5iYXNlLmdhbW1hX2x1dDsKLQljb25zdCBzdHJ1Y3QgZHJt
X3Byb3BlcnR5X2Jsb2IgKmRlZ2FtbWFfbHV0ID0gY3J0Y19zdGF0ZS0+YmFzZS5kZWdhbW1hX2x1
dDsKKwljb25zdCBzdHJ1Y3QgZHJtX3Byb3BlcnR5X2Jsb2IgKmdhbW1hX2x1dCA9IGNydGNfc3Rh
dGUtPmh3LmdhbW1hX2x1dDsKKwljb25zdCBzdHJ1Y3QgZHJtX3Byb3BlcnR5X2Jsb2IgKmRlZ2Ft
bWFfbHV0ID0gY3J0Y19zdGF0ZS0+aHcuZGVnYW1tYV9sdXQ7CiAJaW50IGdhbW1hX2xlbmd0aCwg
ZGVnYW1tYV9sZW5ndGg7CiAJdTMyIGdhbW1hX3Rlc3RzLCBkZWdhbW1hX3Rlc3RzOwogCkBAIC0x
MTU3LDcgKzExNTcsNyBAQCBzdGF0aWMgaW50IGk5eHhfY29sb3JfY2hlY2soc3RydWN0IGludGVs
X2NydGNfc3RhdGUgKmNydGNfc3RhdGUpCiAJCXJldHVybiByZXQ7CiAKIAljcnRjX3N0YXRlLT5n
YW1tYV9lbmFibGUgPQotCQljcnRjX3N0YXRlLT5iYXNlLmdhbW1hX2x1dCAmJgorCQljcnRjX3N0
YXRlLT5ody5nYW1tYV9sdXQgJiYKIAkJIWNydGNfc3RhdGUtPmM4X3BsYW5lczsKIAogCWNydGNf
c3RhdGUtPmdhbW1hX21vZGUgPSBpOXh4X2dhbW1hX21vZGUoY3J0Y19zdGF0ZSk7CkBAIC0xMTc2
LDExICsxMTc2LDExIEBAIHN0YXRpYyB1MzIgY2h2X2NnbV9tb2RlKGNvbnN0IHN0cnVjdCBpbnRl
bF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlKQogCWlmIChjcnRjX3N0YXRlX2lzX2xlZ2FjeV9nYW1t
YShjcnRjX3N0YXRlKSkKIAkJcmV0dXJuIDA7CiAKLQlpZiAoY3J0Y19zdGF0ZS0+YmFzZS5kZWdh
bW1hX2x1dCkKKwlpZiAoY3J0Y19zdGF0ZS0+aHcuZGVnYW1tYV9sdXQpCiAJCWNnbV9tb2RlIHw9
IENHTV9QSVBFX01PREVfREVHQU1NQTsKLQlpZiAoY3J0Y19zdGF0ZS0+YmFzZS5jdG0pCisJaWYg
KGNydGNfc3RhdGUtPmh3LmN0bSkKIAkJY2dtX21vZGUgfD0gQ0dNX1BJUEVfTU9ERV9DU0M7Ci0J
aWYgKGNydGNfc3RhdGUtPmJhc2UuZ2FtbWFfbHV0KQorCWlmIChjcnRjX3N0YXRlLT5ody5nYW1t
YV9sdXQpCiAJCWNnbV9tb2RlIHw9IENHTV9QSVBFX01PREVfR0FNTUE7CiAKIAlyZXR1cm4gY2dt
X21vZGU7CkBAIC0xMjU0LDcgKzEyNTQsNyBAQCBzdGF0aWMgaW50IGlsa19jb2xvcl9jaGVjayhz
dHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSkKIAkJcmV0dXJuIHJldDsKIAogCWNy
dGNfc3RhdGUtPmdhbW1hX2VuYWJsZSA9Ci0JCWNydGNfc3RhdGUtPmJhc2UuZ2FtbWFfbHV0ICYm
CisJCWNydGNfc3RhdGUtPmh3LmdhbW1hX2x1dCAmJgogCQkhY3J0Y19zdGF0ZS0+YzhfcGxhbmVz
OwogCiAJLyoKQEAgLTEyODAsOCArMTI4MCw4IEBAIHN0YXRpYyB1MzIgaXZiX2dhbW1hX21vZGUo
Y29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUpCiAJaWYgKCFjcnRjX3N0
YXRlLT5nYW1tYV9lbmFibGUgfHwKIAkgICAgY3J0Y19zdGF0ZV9pc19sZWdhY3lfZ2FtbWEoY3J0
Y19zdGF0ZSkpCiAJCXJldHVybiBHQU1NQV9NT0RFX01PREVfOEJJVDsKLQllbHNlIGlmIChjcnRj
X3N0YXRlLT5iYXNlLmdhbW1hX2x1dCAmJgotCQkgY3J0Y19zdGF0ZS0+YmFzZS5kZWdhbW1hX2x1
dCkKKwllbHNlIGlmIChjcnRjX3N0YXRlLT5ody5nYW1tYV9sdXQgJiYKKwkJIGNydGNfc3RhdGUt
Pmh3LmRlZ2FtbWFfbHV0KQogCQlyZXR1cm4gR0FNTUFfTU9ERV9NT0RFX1NQTElUOwogCWVsc2UK
IAkJcmV0dXJuIEdBTU1BX01PREVfTU9ERV8xMEJJVDsKQEAgLTEyOTUsNyArMTI5NSw3IEBAIHN0
YXRpYyB1MzIgaXZiX2NzY19tb2RlKGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRj
X3N0YXRlKQogCSAqIENTQyBjb21lcyBhZnRlciB0aGUgTFVUIGluIGRlZ2FtbWEsIFJHQi0+WUNi
Q3IsCiAJICogYW5kIFJHQiBmdWxsLT5saW1pdGVkIHJhbmdlIG1vZGUuCiAJICovCi0JaWYgKGNy
dGNfc3RhdGUtPmJhc2UuZGVnYW1tYV9sdXQgfHwKKwlpZiAoY3J0Y19zdGF0ZS0+aHcuZGVnYW1t
YV9sdXQgfHwKIAkgICAgY3J0Y19zdGF0ZS0+b3V0cHV0X2Zvcm1hdCAhPSBJTlRFTF9PVVRQVVRf
Rk9STUFUX1JHQiB8fAogCSAgICBsaW1pdGVkX2NvbG9yX3JhbmdlKQogCQlyZXR1cm4gMDsKQEAg
LTEzMTMsMTMgKzEzMTMsMTMgQEAgc3RhdGljIGludCBpdmJfY29sb3JfY2hlY2soc3RydWN0IGlu
dGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUpCiAJCXJldHVybiByZXQ7CiAKIAljcnRjX3N0YXRl
LT5nYW1tYV9lbmFibGUgPQotCQkoY3J0Y19zdGF0ZS0+YmFzZS5nYW1tYV9sdXQgfHwKLQkJIGNy
dGNfc3RhdGUtPmJhc2UuZGVnYW1tYV9sdXQpICYmCisJCShjcnRjX3N0YXRlLT5ody5nYW1tYV9s
dXQgfHwKKwkJIGNydGNfc3RhdGUtPmh3LmRlZ2FtbWFfbHV0KSAmJgogCQkhY3J0Y19zdGF0ZS0+
YzhfcGxhbmVzOwogCiAJY3J0Y19zdGF0ZS0+Y3NjX2VuYWJsZSA9CiAJCWNydGNfc3RhdGUtPm91
dHB1dF9mb3JtYXQgIT0gSU5URUxfT1VUUFVUX0ZPUk1BVF9SR0IgfHwKLQkJY3J0Y19zdGF0ZS0+
YmFzZS5jdG0gfHwgbGltaXRlZF9jb2xvcl9yYW5nZTsKKwkJY3J0Y19zdGF0ZS0+aHcuY3RtIHx8
IGxpbWl0ZWRfY29sb3JfcmFuZ2U7CiAKIAljcnRjX3N0YXRlLT5nYW1tYV9tb2RlID0gaXZiX2dh
bW1hX21vZGUoY3J0Y19zdGF0ZSk7CiAKQEAgLTEzNTAsMTQgKzEzNTAsMTQgQEAgc3RhdGljIGlu
dCBnbGtfY29sb3JfY2hlY2soc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUpCiAJ
CXJldHVybiByZXQ7CiAKIAljcnRjX3N0YXRlLT5nYW1tYV9lbmFibGUgPQotCQljcnRjX3N0YXRl
LT5iYXNlLmdhbW1hX2x1dCAmJgorCQljcnRjX3N0YXRlLT5ody5nYW1tYV9sdXQgJiYKIAkJIWNy
dGNfc3RhdGUtPmM4X3BsYW5lczsKIAogCS8qIE9uIEdMSysgZGVnYW1tYSBMVVQgaXMgY29udHJv
bGxlZCBieSBjc2NfZW5hYmxlICovCiAJY3J0Y19zdGF0ZS0+Y3NjX2VuYWJsZSA9Ci0JCWNydGNf
c3RhdGUtPmJhc2UuZGVnYW1tYV9sdXQgfHwKKwkJY3J0Y19zdGF0ZS0+aHcuZGVnYW1tYV9sdXQg
fHwKIAkJY3J0Y19zdGF0ZS0+b3V0cHV0X2Zvcm1hdCAhPSBJTlRFTF9PVVRQVVRfRk9STUFUX1JH
QiB8fAotCQljcnRjX3N0YXRlLT5iYXNlLmN0bSB8fCBjcnRjX3N0YXRlLT5saW1pdGVkX2NvbG9y
X3JhbmdlOworCQljcnRjX3N0YXRlLT5ody5jdG0gfHwgY3J0Y19zdGF0ZS0+bGltaXRlZF9jb2xv
cl9yYW5nZTsKIAogCWNydGNfc3RhdGUtPmdhbW1hX21vZGUgPSBnbGtfZ2FtbWFfbW9kZShjcnRj
X3N0YXRlKTsKIApAQCAtMTM3NCwxNCArMTM3NCwxNCBAQCBzdGF0aWMgdTMyIGljbF9nYW1tYV9t
b2RlKGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlKQogewogCXUzMiBn
YW1tYV9tb2RlID0gMDsKIAotCWlmIChjcnRjX3N0YXRlLT5iYXNlLmRlZ2FtbWFfbHV0KQorCWlm
IChjcnRjX3N0YXRlLT5ody5kZWdhbW1hX2x1dCkKIAkJZ2FtbWFfbW9kZSB8PSBQUkVfQ1NDX0dB
TU1BX0VOQUJMRTsKIAotCWlmIChjcnRjX3N0YXRlLT5iYXNlLmdhbW1hX2x1dCAmJgorCWlmIChj
cnRjX3N0YXRlLT5ody5nYW1tYV9sdXQgJiYKIAkgICAgIWNydGNfc3RhdGUtPmM4X3BsYW5lcykK
IAkJZ2FtbWFfbW9kZSB8PSBQT1NUX0NTQ19HQU1NQV9FTkFCTEU7CiAKLQlpZiAoIWNydGNfc3Rh
dGUtPmJhc2UuZ2FtbWFfbHV0IHx8CisJaWYgKCFjcnRjX3N0YXRlLT5ody5nYW1tYV9sdXQgfHwK
IAkgICAgY3J0Y19zdGF0ZV9pc19sZWdhY3lfZ2FtbWEoY3J0Y19zdGF0ZSkpCiAJCWdhbW1hX21v
ZGUgfD0gR0FNTUFfTU9ERV9NT0RFXzhCSVQ7CiAJZWxzZQpAQCAtMTM5NCw3ICsxMzk0LDcgQEAg
c3RhdGljIHUzMiBpY2xfY3NjX21vZGUoY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNy
dGNfc3RhdGUpCiB7CiAJdTMyIGNzY19tb2RlID0gMDsKIAotCWlmIChjcnRjX3N0YXRlLT5iYXNl
LmN0bSkKKwlpZiAoY3J0Y19zdGF0ZS0+aHcuY3RtKQogCQljc2NfbW9kZSB8PSBJQ0xfQ1NDX0VO
QUJMRTsKIAogCWlmIChjcnRjX3N0YXRlLT5vdXRwdXRfZm9ybWF0ICE9IElOVEVMX09VVFBVVF9G
T1JNQVRfUkdCIHx8CkBAIC0xNjIzLDcgKzE2MjMsNyBAQCBzdGF0aWMgdm9pZCBpOXh4X3JlYWRf
bHV0cyhzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSkKIAlpZiAoIWNydGNfc3Rh
dGUtPmdhbW1hX2VuYWJsZSkKIAkJcmV0dXJuOwogCi0JY3J0Y19zdGF0ZS0+YmFzZS5nYW1tYV9s
dXQgPSBpOXh4X3JlYWRfbHV0XzgoY3J0Y19zdGF0ZSk7CisJY3J0Y19zdGF0ZS0+aHcuZ2FtbWFf
bHV0ID0gaTl4eF9yZWFkX2x1dF84KGNydGNfc3RhdGUpOwogfQogCiBzdGF0aWMgc3RydWN0IGRy
bV9wcm9wZXJ0eV9ibG9iICoKQEAgLTE2NzMsOSArMTY3Myw5IEBAIHN0YXRpYyB2b2lkIGk5NjVf
cmVhZF9sdXRzKHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlKQogCQlyZXR1cm47
CiAKIAlpZiAoY3J0Y19zdGF0ZS0+Z2FtbWFfbW9kZSA9PSBHQU1NQV9NT0RFX01PREVfOEJJVCkK
LQkJY3J0Y19zdGF0ZS0+YmFzZS5nYW1tYV9sdXQgPSBpOXh4X3JlYWRfbHV0XzgoY3J0Y19zdGF0
ZSk7CisJCWNydGNfc3RhdGUtPmh3LmdhbW1hX2x1dCA9IGk5eHhfcmVhZF9sdXRfOChjcnRjX3N0
YXRlKTsKIAllbHNlCi0JCWNydGNfc3RhdGUtPmJhc2UuZ2FtbWFfbHV0ID0gaTk2NV9yZWFkX2x1
dF8xMHA2KGNydGNfc3RhdGUpOworCQljcnRjX3N0YXRlLT5ody5nYW1tYV9sdXQgPSBpOTY1X3Jl
YWRfbHV0XzEwcDYoY3J0Y19zdGF0ZSk7CiB9CiAKIHN0YXRpYyBzdHJ1Y3QgZHJtX3Byb3BlcnR5
X2Jsb2IgKgpAQCAtMTcxNSw3ICsxNzE1LDcgQEAgY2h2X3JlYWRfY2dtX2x1dChjb25zdCBzdHJ1
Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSkKIHN0YXRpYyB2b2lkIGNodl9yZWFkX2x1
dHMoc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUpCiB7CiAJaWYgKGNydGNfc3Rh
dGUtPmNnbV9tb2RlICYgQ0dNX1BJUEVfTU9ERV9HQU1NQSkKLQkJY3J0Y19zdGF0ZS0+YmFzZS5n
YW1tYV9sdXQgPSBjaHZfcmVhZF9jZ21fbHV0KGNydGNfc3RhdGUpOworCQljcnRjX3N0YXRlLT5o
dy5nYW1tYV9sdXQgPSBjaHZfcmVhZF9jZ21fbHV0KGNydGNfc3RhdGUpOwogCWVsc2UKIAkJaTk2
NV9yZWFkX2x1dHMoY3J0Y19zdGF0ZSk7CiB9CkBAIC0xNzYyLDkgKzE3NjIsOSBAQCBzdGF0aWMg
dm9pZCBpbGtfcmVhZF9sdXRzKHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlKQog
CQlyZXR1cm47CiAKIAlpZiAoY3J0Y19zdGF0ZS0+Z2FtbWFfbW9kZSA9PSBHQU1NQV9NT0RFX01P
REVfOEJJVCkKLQkJY3J0Y19zdGF0ZS0+YmFzZS5nYW1tYV9sdXQgPSBpOXh4X3JlYWRfbHV0Xzgo
Y3J0Y19zdGF0ZSk7CisJCWNydGNfc3RhdGUtPmh3LmdhbW1hX2x1dCA9IGk5eHhfcmVhZF9sdXRf
OChjcnRjX3N0YXRlKTsKIAllbHNlCi0JCWNydGNfc3RhdGUtPmJhc2UuZ2FtbWFfbHV0ID0gaWxr
X3JlYWRfbHV0XzEwKGNydGNfc3RhdGUpOworCQljcnRjX3N0YXRlLT5ody5nYW1tYV9sdXQgPSBp
bGtfcmVhZF9sdXRfMTAoY3J0Y19zdGF0ZSk7CiB9CiAKIHN0YXRpYyBzdHJ1Y3QgZHJtX3Byb3Bl
cnR5X2Jsb2IgKgpAQCAtMTgxMSw5ICsxODExLDkgQEAgc3RhdGljIHZvaWQgZ2xrX3JlYWRfbHV0
cyhzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSkKIAkJcmV0dXJuOwogCiAJaWYg
KGNydGNfc3RhdGUtPmdhbW1hX21vZGUgPT0gR0FNTUFfTU9ERV9NT0RFXzhCSVQpCi0JCWNydGNf
c3RhdGUtPmJhc2UuZ2FtbWFfbHV0ID0gaTl4eF9yZWFkX2x1dF84KGNydGNfc3RhdGUpOworCQlj
cnRjX3N0YXRlLT5ody5nYW1tYV9sdXQgPSBpOXh4X3JlYWRfbHV0XzgoY3J0Y19zdGF0ZSk7CiAJ
ZWxzZQotCQljcnRjX3N0YXRlLT5iYXNlLmdhbW1hX2x1dCA9IGdsa19yZWFkX2x1dF8xMChjcnRj
X3N0YXRlLCBQQUxfUFJFQ19JTkRFWF9WQUxVRSgwKSk7CisJCWNydGNfc3RhdGUtPmh3LmdhbW1h
X2x1dCA9IGdsa19yZWFkX2x1dF8xMChjcnRjX3N0YXRlLCBQQUxfUFJFQ19JTkRFWF9WQUxVRSgw
KSk7CiB9CiAKIHZvaWQgaW50ZWxfY29sb3JfaW5pdChzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YykK
ZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfY3J0LmMgYi9k
cml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2NydC5jCmluZGV4IGZmNjEyNmVhNzkz
Yy4uMzk5YWJjM2Q1MjFlIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5
L2ludGVsX2NydC5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfY3J0
LmMKQEAgLTEzMiw5ICsxMzIsOSBAQCBzdGF0aWMgdm9pZCBpbnRlbF9jcnRfZ2V0X2NvbmZpZyhz
dHJ1Y3QgaW50ZWxfZW5jb2RlciAqZW5jb2RlciwKIHsKIAlwaXBlX2NvbmZpZy0+b3V0cHV0X3R5
cGVzIHw9IEJJVChJTlRFTF9PVVRQVVRfQU5BTE9HKTsKIAotCXBpcGVfY29uZmlnLT5iYXNlLmFk
anVzdGVkX21vZGUuZmxhZ3MgfD0gaW50ZWxfY3J0X2dldF9mbGFncyhlbmNvZGVyKTsKKwlwaXBl
X2NvbmZpZy0+aHcuYWRqdXN0ZWRfbW9kZS5mbGFncyB8PSBpbnRlbF9jcnRfZ2V0X2ZsYWdzKGVu
Y29kZXIpOwogCi0JcGlwZV9jb25maWctPmJhc2UuYWRqdXN0ZWRfbW9kZS5jcnRjX2Nsb2NrID0g
cGlwZV9jb25maWctPnBvcnRfY2xvY2s7CisJcGlwZV9jb25maWctPmh3LmFkanVzdGVkX21vZGUu
Y3J0Y19jbG9jayA9IHBpcGVfY29uZmlnLT5wb3J0X2Nsb2NrOwogfQogCiBzdGF0aWMgdm9pZCBo
c3dfY3J0X2dldF9jb25maWcoc3RydWN0IGludGVsX2VuY29kZXIgKmVuY29kZXIsCkBAIC0xNDQs
MTMgKzE0NCwxMyBAQCBzdGF0aWMgdm9pZCBoc3dfY3J0X2dldF9jb25maWcoc3RydWN0IGludGVs
X2VuY29kZXIgKmVuY29kZXIsCiAKIAlpbnRlbF9kZGlfZ2V0X2NvbmZpZyhlbmNvZGVyLCBwaXBl
X2NvbmZpZyk7CiAKLQlwaXBlX2NvbmZpZy0+YmFzZS5hZGp1c3RlZF9tb2RlLmZsYWdzICY9IH4o
RFJNX01PREVfRkxBR19QSFNZTkMgfAorCXBpcGVfY29uZmlnLT5ody5hZGp1c3RlZF9tb2RlLmZs
YWdzICY9IH4oRFJNX01PREVfRkxBR19QSFNZTkMgfAogCQkJCQkgICAgICBEUk1fTU9ERV9GTEFH
X05IU1lOQyB8CiAJCQkJCSAgICAgIERSTV9NT0RFX0ZMQUdfUFZTWU5DIHwKIAkJCQkJICAgICAg
RFJNX01PREVfRkxBR19OVlNZTkMpOwotCXBpcGVfY29uZmlnLT5iYXNlLmFkanVzdGVkX21vZGUu
ZmxhZ3MgfD0gaW50ZWxfY3J0X2dldF9mbGFncyhlbmNvZGVyKTsKKwlwaXBlX2NvbmZpZy0+aHcu
YWRqdXN0ZWRfbW9kZS5mbGFncyB8PSBpbnRlbF9jcnRfZ2V0X2ZsYWdzKGVuY29kZXIpOwogCi0J
cGlwZV9jb25maWctPmJhc2UuYWRqdXN0ZWRfbW9kZS5jcnRjX2Nsb2NrID0gbHB0X2dldF9pY2xr
aXAoZGV2X3ByaXYpOworCXBpcGVfY29uZmlnLT5ody5hZGp1c3RlZF9tb2RlLmNydGNfY2xvY2sg
PSBscHRfZ2V0X2ljbGtpcChkZXZfcHJpdik7CiB9CiAKIC8qIE5vdGU6IFRoZSBjYWxsZXIgaXMg
cmVxdWlyZWQgdG8gZmlsdGVyIG91dCBkcG1zIG1vZGVzIG5vdCBzdXBwb3J0ZWQgYnkgdGhlCkBA
IC0xNjIsNyArMTYyLDcgQEAgc3RhdGljIHZvaWQgaW50ZWxfY3J0X3NldF9kcG1zKHN0cnVjdCBp
bnRlbF9lbmNvZGVyICplbmNvZGVyLAogCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJp
diA9IHRvX2k5MTUoZW5jb2Rlci0+YmFzZS5kZXYpOwogCXN0cnVjdCBpbnRlbF9jcnQgKmNydCA9
IGludGVsX2VuY29kZXJfdG9fY3J0KGVuY29kZXIpOwogCXN0cnVjdCBpbnRlbF9jcnRjICpjcnRj
ID0gdG9faW50ZWxfY3J0YyhjcnRjX3N0YXRlLT5iYXNlLmNydGMpOwotCWNvbnN0IHN0cnVjdCBk
cm1fZGlzcGxheV9tb2RlICphZGp1c3RlZF9tb2RlID0gJmNydGNfc3RhdGUtPmJhc2UuYWRqdXN0
ZWRfbW9kZTsKKwljb25zdCBzdHJ1Y3QgZHJtX2Rpc3BsYXlfbW9kZSAqYWRqdXN0ZWRfbW9kZSA9
ICZjcnRjX3N0YXRlLT5ody5hZGp1c3RlZF9tb2RlOwogCXUzMiBhZHBhOwogCiAJaWYgKElOVEVM
X0dFTihkZXZfcHJpdikgPj0gNSkKQEAgLTM1OCw3ICszNTgsNyBAQCBzdGF0aWMgaW50IGludGVs
X2NydF9jb21wdXRlX2NvbmZpZyhzdHJ1Y3QgaW50ZWxfZW5jb2RlciAqZW5jb2RlciwKIAkJCQkg
ICAgc3RydWN0IGRybV9jb25uZWN0b3Jfc3RhdGUgKmNvbm5fc3RhdGUpCiB7CiAJc3RydWN0IGRy
bV9kaXNwbGF5X21vZGUgKmFkanVzdGVkX21vZGUgPQotCQkmcGlwZV9jb25maWctPmJhc2UuYWRq
dXN0ZWRfbW9kZTsKKwkJJnBpcGVfY29uZmlnLT5ody5hZGp1c3RlZF9tb2RlOwogCiAJaWYgKGFk
anVzdGVkX21vZGUtPmZsYWdzICYgRFJNX01PREVfRkxBR19EQkxTQ0FOKQogCQlyZXR1cm4gLUVJ
TlZBTDsKQEAgLTM3Myw3ICszNzMsNyBAQCBzdGF0aWMgaW50IHBjaF9jcnRfY29tcHV0ZV9jb25m
aWcoc3RydWN0IGludGVsX2VuY29kZXIgKmVuY29kZXIsCiAJCQkJICBzdHJ1Y3QgZHJtX2Nvbm5l
Y3Rvcl9zdGF0ZSAqY29ubl9zdGF0ZSkKIHsKIAlzdHJ1Y3QgZHJtX2Rpc3BsYXlfbW9kZSAqYWRq
dXN0ZWRfbW9kZSA9Ci0JCSZwaXBlX2NvbmZpZy0+YmFzZS5hZGp1c3RlZF9tb2RlOworCQkmcGlw
ZV9jb25maWctPmh3LmFkanVzdGVkX21vZGU7CiAKIAlpZiAoYWRqdXN0ZWRfbW9kZS0+ZmxhZ3Mg
JiBEUk1fTU9ERV9GTEFHX0RCTFNDQU4pCiAJCXJldHVybiAtRUlOVkFMOwpAQCAtMzkwLDcgKzM5
MCw3IEBAIHN0YXRpYyBpbnQgaHN3X2NydF9jb21wdXRlX2NvbmZpZyhzdHJ1Y3QgaW50ZWxfZW5j
b2RlciAqZW5jb2RlciwKIHsKIAlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0
b19pOTE1KGVuY29kZXItPmJhc2UuZGV2KTsKIAlzdHJ1Y3QgZHJtX2Rpc3BsYXlfbW9kZSAqYWRq
dXN0ZWRfbW9kZSA9Ci0JCSZwaXBlX2NvbmZpZy0+YmFzZS5hZGp1c3RlZF9tb2RlOworCQkmcGlw
ZV9jb25maWctPmh3LmFkanVzdGVkX21vZGU7CiAKIAlpZiAoYWRqdXN0ZWRfbW9kZS0+ZmxhZ3Mg
JiBEUk1fTU9ERV9GTEFHX0RCTFNDQU4pCiAJCXJldHVybiAtRUlOVkFMOwpkaWZmIC0tZ2l0IGEv
ZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kZGkuYyBiL2RyaXZlcnMvZ3B1L2Ry
bS9pOTE1L2Rpc3BsYXkvaW50ZWxfZGRpLmMKaW5kZXggMjgxNTk0YmNiZmFlLi43Y2U0OTYyZjEz
YTMgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZGRpLmMK
KysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kZGkuYwpAQCAtMTUyOCw3
ICsxNTI4LDcgQEAgc3RhdGljIHZvaWQgZGRpX2RvdGNsb2NrX2dldChzdHJ1Y3QgaW50ZWxfY3J0
Y19zdGF0ZSAqcGlwZV9jb25maWcpCiAJaWYgKHBpcGVfY29uZmlnLT5waXhlbF9tdWx0aXBsaWVy
KQogCQlkb3RjbG9jayAvPSBwaXBlX2NvbmZpZy0+cGl4ZWxfbXVsdGlwbGllcjsKIAotCXBpcGVf
Y29uZmlnLT5iYXNlLmFkanVzdGVkX21vZGUuY3J0Y19jbG9jayA9IGRvdGNsb2NrOworCXBpcGVf
Y29uZmlnLT5ody5hZGp1c3RlZF9tb2RlLmNydGNfY2xvY2sgPSBkb3RjbG9jazsKIH0KIAogc3Rh
dGljIHZvaWQgaWNsX2RkaV9jbG9ja19nZXQoc3RydWN0IGludGVsX2VuY29kZXIgKmVuY29kZXIs
CkBAIC0xODYwLDkgKzE4NjAsOSBAQCBpbnRlbF9kZGlfdHJhbnNjb2Rlcl9mdW5jX3JlZ192YWxf
Z2V0KGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlKQogCQlCVUcoKTsK
IAl9CiAKLQlpZiAoY3J0Y19zdGF0ZS0+YmFzZS5hZGp1c3RlZF9tb2RlLmZsYWdzICYgRFJNX01P
REVfRkxBR19QVlNZTkMpCisJaWYgKGNydGNfc3RhdGUtPmh3LmFkanVzdGVkX21vZGUuZmxhZ3Mg
JiBEUk1fTU9ERV9GTEFHX1BWU1lOQykKIAkJdGVtcCB8PSBUUkFOU19ERElfUFZTWU5DOwotCWlm
IChjcnRjX3N0YXRlLT5iYXNlLmFkanVzdGVkX21vZGUuZmxhZ3MgJiBEUk1fTU9ERV9GTEFHX1BI
U1lOQykKKwlpZiAoY3J0Y19zdGF0ZS0+aHcuYWRqdXN0ZWRfbW9kZS5mbGFncyAmIERSTV9NT0RF
X0ZMQUdfUEhTWU5DKQogCQl0ZW1wIHw9IFRSQU5TX0RESV9QSFNZTkM7CiAKIAlpZiAoY3B1X3Ry
YW5zY29kZXIgPT0gVFJBTlNDT0RFUl9FRFApIHsKQEAgLTMzNzMsNyArMzM3Myw3IEBAIHN0YXRp
YyB2b2lkIHRnbF9kYzNjb19leGl0bGluZV9jb21wdXRlX2NvbmZpZyhzdHJ1Y3QgaW50ZWxfZW5j
b2RlciAqZW5jb2RlciwKIHsKIAl1MzIgZXhpdF9zY2FubGluZXM7CiAJc3RydWN0IGRybV9pOTE1
X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShjc3RhdGUtPmJhc2UuY3J0Yy0+ZGV2KTsKLQl1
MzIgY3J0Y192ZGlzcGxheSA9IGNzdGF0ZS0+YmFzZS5hZGp1c3RlZF9tb2RlLmNydGNfdmRpc3Bs
YXk7CisJdTMyIGNydGNfdmRpc3BsYXkgPSBjc3RhdGUtPmh3LmFkanVzdGVkX21vZGUuY3J0Y192
ZGlzcGxheTsKIAogCWNzdGF0ZS0+ZGMzY29fZXhpdGxpbmUgPSAwOwogCkBAIC0zMzg1LDcgKzMz
ODUsNyBAQCBzdGF0aWMgdm9pZCB0Z2xfZGMzY29fZXhpdGxpbmVfY29tcHV0ZV9jb25maWcoc3Ry
dWN0IGludGVsX2VuY29kZXIgKmVuY29kZXIsCiAJICAgIGVuY29kZXItPnBvcnQgIT0gUE9SVF9B
KQogCQlyZXR1cm47CiAKLQlpZiAoIWNzdGF0ZS0+aGFzX3BzcjIgfHwgIWNzdGF0ZS0+YmFzZS5h
Y3RpdmUpCisJaWYgKCFjc3RhdGUtPmhhc19wc3IyIHx8ICFjc3RhdGUtPmh3LmFjdGl2ZSkKIAkJ
cmV0dXJuOwogCiAJLyoKQEAgLTMzOTMsNyArMzM5Myw3IEBAIHN0YXRpYyB2b2lkIHRnbF9kYzNj
b19leGl0bGluZV9jb21wdXRlX2NvbmZpZyhzdHJ1Y3QgaW50ZWxfZW5jb2RlciAqZW5jb2RlciwK
IAkgKiBQU1IyIHRyYW5zY29kZXIgRWFybHkgRXhpdCBzY2FubGluZXMgPSBST1VORFVQKDIwMCAv
IGxpbmUgdGltZSkgKyAxCiAJICovCiAJZXhpdF9zY2FubGluZXMgPQotCQlpbnRlbF91c2Vjc190
b19zY2FubGluZXMoJmNzdGF0ZS0+YmFzZS5hZGp1c3RlZF9tb2RlLCAyMDApICsgMTsKKwkJaW50
ZWxfdXNlY3NfdG9fc2NhbmxpbmVzKCZjc3RhdGUtPmh3LmFkanVzdGVkX21vZGUsIDIwMCkgKyAx
OwogCiAJaWYgKFdBUk5fT04oZXhpdF9zY2FubGluZXMgPiBjcnRjX3ZkaXNwbGF5KSkKIAkJcmV0
dXJuOwpAQCAtNDA4MCw3ICs0MDgwLDcgQEAgaW50ZWxfZGRpX3VwZGF0ZV9wcmVwYXJlKHN0cnVj
dCBpbnRlbF9hdG9taWNfc3RhdGUgKnN0YXRlLAogCVdBUk5fT04oY3J0YyAmJiBjcnRjLT5hY3Rp
dmUpOwogCiAJaW50ZWxfdGNfcG9ydF9nZXRfbGluayhlbmNfdG9fZGlnX3BvcnQoJmVuY29kZXIt
PmJhc2UpLCByZXF1aXJlZF9sYW5lcyk7Ci0JaWYgKGNydGNfc3RhdGUgJiYgY3J0Y19zdGF0ZS0+
YmFzZS5hY3RpdmUpCisJaWYgKGNydGNfc3RhdGUgJiYgY3J0Y19zdGF0ZS0+aHcuYWN0aXZlKQog
CQlpbnRlbF91cGRhdGVfYWN0aXZlX2RwbGwoc3RhdGUsIGNydGMsIGVuY29kZXIpOwogfQogCkBA
IC00MjI4LDcgKzQyMjgsNyBAQCB2b2lkIGludGVsX2RkaV9nZXRfY29uZmlnKHN0cnVjdCBpbnRl
bF9lbmNvZGVyICplbmNvZGVyLAogCWVsc2UKIAkJZmxhZ3MgfD0gRFJNX01PREVfRkxBR19OVlNZ
TkM7CiAKLQlwaXBlX2NvbmZpZy0+YmFzZS5hZGp1c3RlZF9tb2RlLmZsYWdzIHw9IGZsYWdzOwor
CXBpcGVfY29uZmlnLT5ody5hZGp1c3RlZF9tb2RlLmZsYWdzIHw9IGZsYWdzOwogCiAJc3dpdGNo
ICh0ZW1wICYgVFJBTlNfRERJX0JQQ19NQVNLKSB7CiAJY2FzZSBUUkFOU19ERElfQlBDXzY6CkBA
IC00NTExLDcgKzQ1MTEsNyBAQCBzdGF0aWMgaW50IGludGVsX2hkbWlfcmVzZXRfbGluayhzdHJ1
Y3QgaW50ZWxfZW5jb2RlciAqZW5jb2RlciwKIAogCVdBUk5fT04oIWludGVsX2NydGNfaGFzX3R5
cGUoY3J0Y19zdGF0ZSwgSU5URUxfT1VUUFVUX0hETUkpKTsKIAotCWlmICghY3J0Y19zdGF0ZS0+
YmFzZS5hY3RpdmUpCisJaWYgKCFjcnRjX3N0YXRlLT5ody5hY3RpdmUpCiAJCXJldHVybiAwOwog
CiAJaWYgKCFjcnRjX3N0YXRlLT5oZG1pX2hpZ2hfdG1kc19jbG9ja19yYXRpbyAmJgpkaWZmIC0t
Z2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kaXNwbGF5LmMgYi9kcml2
ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2Rpc3BsYXkuYwppbmRleCA0YmFhMDIyNmFi
ZmYuLjExMTg2MGFkYjJlYSAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxh
eS9pbnRlbF9kaXNwbGF5LmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRl
bF9kaXNwbGF5LmMKQEAgLTEwNDAsNyArMTA0MCw3IEBAIGJvb2wgaW50ZWxfY3J0Y19hY3RpdmUo
c3RydWN0IGludGVsX2NydGMgKmNydGMpCiAJICogZm9yIGF0b21pYy4KIAkgKi8KIAlyZXR1cm4g
Y3J0Yy0+YWN0aXZlICYmIGNydGMtPmJhc2UucHJpbWFyeS0+c3RhdGUtPmZiICYmCi0JCWNydGMt
PmNvbmZpZy0+YmFzZS5hZGp1c3RlZF9tb2RlLmNydGNfY2xvY2s7CisJCWNydGMtPmNvbmZpZy0+
aHcuYWRqdXN0ZWRfbW9kZS5jcnRjX2Nsb2NrOwogfQogCiBlbnVtIHRyYW5zY29kZXIgaW50ZWxf
cGlwZV90b19jcHVfdHJhbnNjb2RlcihzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYs
CkBAIC01MDg2LDcgKzUwODYsNyBAQCBzdGF0aWMgdm9pZCBscHRfcHJvZ3JhbV9pY2xraXAoY29u
c3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUpCiB7CiAJc3RydWN0IGludGVs
X2NydGMgKmNydGMgPSB0b19pbnRlbF9jcnRjKGNydGNfc3RhdGUtPmJhc2UuY3J0Yyk7CiAJc3Ry
dWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShjcnRjLT5iYXNlLmRldik7
Ci0JaW50IGNsb2NrID0gY3J0Y19zdGF0ZS0+YmFzZS5hZGp1c3RlZF9tb2RlLmNydGNfY2xvY2s7
CisJaW50IGNsb2NrID0gY3J0Y19zdGF0ZS0+aHcuYWRqdXN0ZWRfbW9kZS5jcnRjX2Nsb2NrOwog
CXUzMiBkaXZzZWwsIHBoYXNlaW5jLCBhdXhkaXYsIHBoYXNlZGlyID0gMDsKIAl1MzIgdGVtcDsK
IApAQCAtNTM1OSw3ICs1MzU5LDcgQEAgc3RhdGljIHZvaWQgaXJvbmxha2VfcGNoX2VuYWJsZShj
b25zdCBzdHJ1Y3QgaW50ZWxfYXRvbWljX3N0YXRlICpzdGF0ZSwKIAlpZiAoSEFTX1BDSF9DUFQo
ZGV2X3ByaXYpICYmCiAJICAgIGludGVsX2NydGNfaGFzX2RwX2VuY29kZXIoY3J0Y19zdGF0ZSkp
IHsKIAkJY29uc3Qgc3RydWN0IGRybV9kaXNwbGF5X21vZGUgKmFkanVzdGVkX21vZGUgPQotCQkJ
JmNydGNfc3RhdGUtPmJhc2UuYWRqdXN0ZWRfbW9kZTsKKwkJCSZjcnRjX3N0YXRlLT5ody5hZGp1
c3RlZF9tb2RlOwogCQl1MzIgYnBjID0gKEk5MTVfUkVBRChQSVBFQ09ORihwaXBlKSkgJiBQSVBF
Q09ORl9CUENfTUFTSykgPj4gNTsKIAkJaTkxNV9yZWdfdCByZWcgPSBUUkFOU19EUF9DVEwocGlw
ZSk7CiAJCWVudW0gcG9ydCBwb3J0OwpAQCAtNTUwOSw3ICs1NTA5LDcgQEAgc2tsX3VwZGF0ZV9z
Y2FsZXIoc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUsIGJvb2wgZm9yY2VfZGV0
YWNoLAogCQl0b19pbnRlbF9jcnRjKGNydGNfc3RhdGUtPmJhc2UuY3J0Yyk7CiAJc3RydWN0IGRy
bV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShpbnRlbF9jcnRjLT5iYXNlLmRldik7
CiAJY29uc3Qgc3RydWN0IGRybV9kaXNwbGF5X21vZGUgKmFkanVzdGVkX21vZGUgPQotCQkmY3J0
Y19zdGF0ZS0+YmFzZS5hZGp1c3RlZF9tb2RlOworCQkmY3J0Y19zdGF0ZS0+aHcuYWRqdXN0ZWRf
bW9kZTsKIAogCS8qCiAJICogU3JjIGNvb3JkaW5hdGVzIGFyZSBhbHJlYWR5IHJvdGF0ZWQgYnkg
MjcwIGRlZ3JlZXMgZm9yCkBAIC01NTI1LDcgKzU1MjUsNyBAQCBza2xfdXBkYXRlX3NjYWxlcihz
dHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSwgYm9vbCBmb3JjZV9kZXRhY2gsCiAJ
ICogT25jZSBOVjEyIGlzIGVuYWJsZWQsIGhhbmRsZSBpdCBoZXJlIHdoaWxlIGFsbG9jYXRpbmcg
c2NhbGVyCiAJICogZm9yIE5WMTIuCiAJICovCi0JaWYgKElOVEVMX0dFTihkZXZfcHJpdikgPj0g
OSAmJiBjcnRjX3N0YXRlLT5iYXNlLmVuYWJsZSAmJgorCWlmIChJTlRFTF9HRU4oZGV2X3ByaXYp
ID49IDkgJiYgY3J0Y19zdGF0ZS0+aHcuZW5hYmxlICYmCiAJICAgIG5lZWRfc2NhbGVyICYmIGFk
anVzdGVkX21vZGUtPmZsYWdzICYgRFJNX01PREVfRkxBR19JTlRFUkxBQ0UpIHsKIAkJRFJNX0RF
QlVHX0tNUygiUGlwZS9QbGFuZSBzY2FsaW5nIG5vdCBzdXBwb3J0ZWQgd2l0aCBJRi1JRCBtb2Rl
XG4iKTsKIAkJcmV0dXJuIC1FSU5WQUw7CkBAIC01NTk3LDEzICs1NTk3LDEzIEBAIHNrbF91cGRh
dGVfc2NhbGVyKHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlLCBib29sIGZvcmNl
X2RldGFjaCwKICAqLwogaW50IHNrbF91cGRhdGVfc2NhbGVyX2NydGMoc3RydWN0IGludGVsX2Ny
dGNfc3RhdGUgKnN0YXRlKQogewotCWNvbnN0IHN0cnVjdCBkcm1fZGlzcGxheV9tb2RlICphZGp1
c3RlZF9tb2RlID0gJnN0YXRlLT5iYXNlLmFkanVzdGVkX21vZGU7CisJY29uc3Qgc3RydWN0IGRy
bV9kaXNwbGF5X21vZGUgKmFkanVzdGVkX21vZGUgPSAmc3RhdGUtPmh3LmFkanVzdGVkX21vZGU7
CiAJYm9vbCBuZWVkX3NjYWxlciA9IGZhbHNlOwogCiAJaWYgKHN0YXRlLT5vdXRwdXRfZm9ybWF0
ID09IElOVEVMX09VVFBVVF9GT1JNQVRfWUNCQ1I0MjApCiAJCW5lZWRfc2NhbGVyID0gdHJ1ZTsK
IAotCXJldHVybiBza2xfdXBkYXRlX3NjYWxlcihzdGF0ZSwgIXN0YXRlLT5iYXNlLmFjdGl2ZSwg
U0tMX0NSVENfSU5ERVgsCisJcmV0dXJuIHNrbF91cGRhdGVfc2NhbGVyKHN0YXRlLCAhc3RhdGUt
Pmh3LmFjdGl2ZSwgU0tMX0NSVENfSU5ERVgsCiAJCQkJICZzdGF0ZS0+c2NhbGVyX3N0YXRlLnNj
YWxlcl9pZCwKIAkJCQkgc3RhdGUtPnBpcGVfc3JjX3csIHN0YXRlLT5waXBlX3NyY19oLAogCQkJ
CSBhZGp1c3RlZF9tb2RlLT5jcnRjX2hkaXNwbGF5LApAQCAtNTk1OCw3ICs1OTU4LDcgQEAgc3Rh
dGljIGJvb2wgaHN3X3Bvc3RfdXBkYXRlX2VuYWJsZV9pcHMoY29uc3Qgc3RydWN0IGludGVsX2Ny
dGNfc3RhdGUgKm9sZF9jcnRjX3MKIAkgKiBmb3JjaWJseSBlbmFibGUgSVBTIG9uIHRoZSBmaXJz
dCBmYXN0c2V0LgogCSAqLwogCWlmIChuZXdfY3J0Y19zdGF0ZS0+dXBkYXRlX3BpcGUgJiYKLQkg
ICAgb2xkX2NydGNfc3RhdGUtPmJhc2UuYWRqdXN0ZWRfbW9kZS5wcml2YXRlX2ZsYWdzICYgSTkx
NV9NT0RFX0ZMQUdfSU5IRVJJVEVEKQorCSAgICBvbGRfY3J0Y19zdGF0ZS0+aHcuYWRqdXN0ZWRf
bW9kZS5wcml2YXRlX2ZsYWdzICYgSTkxNV9NT0RFX0ZMQUdfSU5IRVJJVEVEKQogCQlyZXR1cm4g
dHJ1ZTsKIAogCXJldHVybiAhb2xkX2NydGNfc3RhdGUtPmlwc19lbmFibGVkOwpAQCAtNjAwMiw3
ICs2MDAyLDcgQEAgc3RhdGljIHZvaWQgaW50ZWxfcG9zdF9wbGFuZV91cGRhdGUoc3RydWN0IGlu
dGVsX2NydGNfc3RhdGUgKm9sZF9jcnRjX3N0YXRlKQogCiAJaW50ZWxfZnJvbnRidWZmZXJfZmxp
cCh0b19pOTE1KGNydGMtPmJhc2UuZGV2KSwgcGlwZV9jb25maWctPmZiX2JpdHMpOwogCi0JaWYg
KHBpcGVfY29uZmlnLT51cGRhdGVfd21fcG9zdCAmJiBwaXBlX2NvbmZpZy0+YmFzZS5hY3RpdmUp
CisJaWYgKHBpcGVfY29uZmlnLT51cGRhdGVfd21fcG9zdCAmJiBwaXBlX2NvbmZpZy0+aHcuYWN0
aXZlKQogCQlpbnRlbF91cGRhdGVfd2F0ZXJtYXJrcyhjcnRjKTsKIAogCWlmIChoc3dfcG9zdF91
cGRhdGVfZW5hYmxlX2lwcyhvbGRfY3J0Y19zdGF0ZSwgcGlwZV9jb25maWcpKQpAQCAtNjA4MCw3
ICs2MDgwLDcgQEAgc3RhdGljIHZvaWQgaW50ZWxfcHJlX3BsYW5lX3VwZGF0ZShzdHJ1Y3QgaW50
ZWxfY3J0Y19zdGF0ZSAqb2xkX2NydGNfc3RhdGUsCiAJICogZXZlbnQgd2hpY2ggaXMgYWZ0ZXIg
dGhlIHZibGFuayBzdGFydCBldmVudCwgc28gd2UgbmVlZCB0byBoYXZlIGEKIAkgKiB3YWl0LWZv
ci12YmxhbmsgYmV0d2VlbiBkaXNhYmxpbmcgdGhlIHBsYW5lIGFuZCB0aGUgcGlwZS4KIAkgKi8K
LQlpZiAoSEFTX0dNQ0goZGV2X3ByaXYpICYmIG9sZF9jcnRjX3N0YXRlLT5iYXNlLmFjdGl2ZSAm
JgorCWlmIChIQVNfR01DSChkZXZfcHJpdikgJiYgb2xkX2NydGNfc3RhdGUtPmh3LmFjdGl2ZSAm
JgogCSAgICBwaXBlX2NvbmZpZy0+ZGlzYWJsZV9jeHNyICYmIGludGVsX3NldF9tZW1vcnlfY3hz
cihkZXZfcHJpdiwgZmFsc2UpKQogCQlpbnRlbF93YWl0X2Zvcl92YmxhbmsoZGV2X3ByaXYsIGNy
dGMtPnBpcGUpOwogCkBAIC02MDkyLDcgKzYwOTIsNyBAQCBzdGF0aWMgdm9pZCBpbnRlbF9wcmVf
cGxhbmVfdXBkYXRlKHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpvbGRfY3J0Y19zdGF0ZSwKIAkg
KiBXYUN4U1JEaXNhYmxlZEZvclNwcml0ZVNjYWxpbmc6aXZiCiAJICovCiAJaWYgKHBpcGVfY29u
ZmlnLT5kaXNhYmxlX2xwX3dtICYmIGlsa19kaXNhYmxlX2xwX3dtKGRldikgJiYKLQkgICAgb2xk
X2NydGNfc3RhdGUtPmJhc2UuYWN0aXZlKQorCSAgICBvbGRfY3J0Y19zdGF0ZS0+aHcuYWN0aXZl
KQogCQlpbnRlbF93YWl0X2Zvcl92YmxhbmsoZGV2X3ByaXYsIGNydGMtPnBpcGUpOwogCiAJLyoK
QEAgLTY4OTYsNyArNjg5Niw3IEBAIHN0YXRpYyB1NjQgZ2V0X2NydGNfcG93ZXJfZG9tYWlucyhz
dHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSkKIAl1NjQgbWFzazsKIAllbnVtIHRy
YW5zY29kZXIgdHJhbnNjb2RlciA9IGNydGNfc3RhdGUtPmNwdV90cmFuc2NvZGVyOwogCi0JaWYg
KCFjcnRjX3N0YXRlLT5iYXNlLmFjdGl2ZSkKKwlpZiAoIWNydGNfc3RhdGUtPmh3LmFjdGl2ZSkK
IAkJcmV0dXJuIDA7CiAKIAltYXNrID0gQklUX1VMTChQT1dFUl9ET01BSU5fUElQRShwaXBlKSk7
CkBAIC03MjUzLDggKzcyNTMsOCBAQCBzdGF0aWMgdm9pZCBpbnRlbF9jb25uZWN0b3JfdmVyaWZ5
X3N0YXRlKHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlLAogCQlpZiAoIWNydGNf
c3RhdGUpCiAJCQlyZXR1cm47CiAKLQkJSTkxNV9TVEFURV9XQVJOKCFjcnRjX3N0YXRlLT5iYXNl
LmFjdGl2ZSwKLQkJICAgICAgImNvbm5lY3RvciBpcyBhY3RpdmUsIGJ1dCBhdHRhY2hlZCBjcnRj
IGlzbid0XG4iKTsKKwkJSTkxNV9TVEFURV9XQVJOKCFjcnRjX3N0YXRlLT5ody5hY3RpdmUsCisJ
CQkJImNvbm5lY3RvciBpcyBhY3RpdmUsIGJ1dCBhdHRhY2hlZCBjcnRjIGlzbid0XG4iKTsKIAog
CQlpZiAoIWVuY29kZXIgfHwgZW5jb2Rlci0+dHlwZSA9PSBJTlRFTF9PVVRQVVRfRFBfTVNUKQog
CQkJcmV0dXJuOwpAQCAtNzI2NSw4ICs3MjY1LDggQEAgc3RhdGljIHZvaWQgaW50ZWxfY29ubmVj
dG9yX3ZlcmlmeV9zdGF0ZShzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSwKIAkJ
STkxNV9TVEFURV9XQVJOKGNvbm5fc3RhdGUtPmNydGMgIT0gZW5jb2Rlci0+YmFzZS5jcnRjLAog
CQkJImF0dGFjaGVkIGVuY29kZXIgY3J0YyBkaWZmZXJzIGZyb20gY29ubmVjdG9yIGNydGNcbiIp
OwogCX0gZWxzZSB7Ci0JCUk5MTVfU1RBVEVfV0FSTihjcnRjX3N0YXRlICYmIGNydGNfc3RhdGUt
PmJhc2UuYWN0aXZlLAotCQkJImF0dGFjaGVkIGNydGMgaXMgYWN0aXZlLCBidXQgY29ubmVjdG9y
IGlzbid0XG4iKTsKKwkJSTkxNV9TVEFURV9XQVJOKGNydGNfc3RhdGUgJiYgY3J0Y19zdGF0ZS0+
aHcuYWN0aXZlLAorCQkJCSJhdHRhY2hlZCBjcnRjIGlzIGFjdGl2ZSwgYnV0IGNvbm5lY3RvciBp
c24ndFxuIik7CiAJCUk5MTVfU1RBVEVfV0FSTighY3J0Y19zdGF0ZSAmJiBjb25uX3N0YXRlLT5i
ZXN0X2VuY29kZXIsCiAJCQkiYmVzdCBlbmNvZGVyIHNldCB3aXRob3V0IGNydGMhXG4iKTsKIAl9
CkBAIC03Mjc0LDcgKzcyNzQsNyBAQCBzdGF0aWMgdm9pZCBpbnRlbF9jb25uZWN0b3JfdmVyaWZ5
X3N0YXRlKHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlLAogCiBzdGF0aWMgaW50
IHBpcGVfcmVxdWlyZWRfZmRpX2xhbmVzKHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0
YXRlKQogewotCWlmIChjcnRjX3N0YXRlLT5iYXNlLmVuYWJsZSAmJiBjcnRjX3N0YXRlLT5oYXNf
cGNoX2VuY29kZXIpCisJaWYgKGNydGNfc3RhdGUtPmh3LmVuYWJsZSAmJiBjcnRjX3N0YXRlLT5o
YXNfcGNoX2VuY29kZXIpCiAJCXJldHVybiBjcnRjX3N0YXRlLT5mZGlfbGFuZXM7CiAKIAlyZXR1
cm4gMDsKQEAgLTczNTcsNyArNzM1Nyw3IEBAIHN0YXRpYyBpbnQgaXJvbmxha2VfZmRpX2NvbXB1
dGVfY29uZmlnKHN0cnVjdCBpbnRlbF9jcnRjICppbnRlbF9jcnRjLAogCQkJCSAgICAgICBzdHJ1
Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqcGlwZV9jb25maWcpCiB7CiAJc3RydWN0IGRybV9kZXZpY2Ug
KmRldiA9IGludGVsX2NydGMtPmJhc2UuZGV2OwotCWNvbnN0IHN0cnVjdCBkcm1fZGlzcGxheV9t
b2RlICphZGp1c3RlZF9tb2RlID0gJnBpcGVfY29uZmlnLT5iYXNlLmFkanVzdGVkX21vZGU7CisJ
Y29uc3Qgc3RydWN0IGRybV9kaXNwbGF5X21vZGUgKmFkanVzdGVkX21vZGUgPSAmcGlwZV9jb25m
aWctPmh3LmFkanVzdGVkX21vZGU7CiAJaW50IGxhbmUsIGxpbmtfYncsIGZkaV9kb3RjbG9jaywg
cmV0OwogCWJvb2wgbmVlZHNfcmVjb21wdXRlID0gZmFsc2U7CiAKQEAgLTc0NzQsNyArNzQ3NCw3
IEBAIHN0YXRpYyB1MzIgaWxrX3BpcGVfcGl4ZWxfcmF0ZShjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0
Y19zdGF0ZSAqcGlwZV9jb25maWcpCiB7CiAJdTMyIHBpeGVsX3JhdGU7CiAKLQlwaXhlbF9yYXRl
ID0gcGlwZV9jb25maWctPmJhc2UuYWRqdXN0ZWRfbW9kZS5jcnRjX2Nsb2NrOworCXBpeGVsX3Jh
dGUgPSBwaXBlX2NvbmZpZy0+aHcuYWRqdXN0ZWRfbW9kZS5jcnRjX2Nsb2NrOwogCiAJLyoKIAkg
KiBXZSBvbmx5IHVzZSBJRi1JRCBpbnRlcmxhY2luZy4gSWYgd2UgZXZlciB1c2UKQEAgLTc1MTIs
NyArNzUxMiw3IEBAIHN0YXRpYyB2b2lkIGludGVsX2NydGNfY29tcHV0ZV9waXhlbF9yYXRlKHN0
cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlKQogCWlmIChIQVNfR01DSChkZXZfcHJp
dikpCiAJCS8qIEZJWE1FIGNhbGN1bGF0ZSBwcm9wZXIgcGlwZSBwaXhlbCByYXRlIGZvciBHTUNI
IHBmaXQgKi8KIAkJY3J0Y19zdGF0ZS0+cGl4ZWxfcmF0ZSA9Ci0JCQljcnRjX3N0YXRlLT5iYXNl
LmFkanVzdGVkX21vZGUuY3J0Y19jbG9jazsKKwkJCWNydGNfc3RhdGUtPmh3LmFkanVzdGVkX21v
ZGUuY3J0Y19jbG9jazsKIAllbHNlCiAJCWNydGNfc3RhdGUtPnBpeGVsX3JhdGUgPQogCQkJaWxr
X3BpcGVfcGl4ZWxfcmF0ZShjcnRjX3N0YXRlKTsKQEAgLTc1MjIsNyArNzUyMiw3IEBAIHN0YXRp
YyBpbnQgaW50ZWxfY3J0Y19jb21wdXRlX2NvbmZpZyhzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YywK
IAkJCQkgICAgIHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpwaXBlX2NvbmZpZykKIHsKIAlzdHJ1
Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGNydGMtPmJhc2UuZGV2KTsK
LQljb25zdCBzdHJ1Y3QgZHJtX2Rpc3BsYXlfbW9kZSAqYWRqdXN0ZWRfbW9kZSA9ICZwaXBlX2Nv
bmZpZy0+YmFzZS5hZGp1c3RlZF9tb2RlOworCWNvbnN0IHN0cnVjdCBkcm1fZGlzcGxheV9tb2Rl
ICphZGp1c3RlZF9tb2RlID0gJnBpcGVfY29uZmlnLT5ody5hZGp1c3RlZF9tb2RlOwogCWludCBj
bG9ja19saW1pdCA9IGRldl9wcml2LT5tYXhfZG90Y2xrX2ZyZXE7CiAKIAlpZiAoSU5URUxfR0VO
KGRldl9wcml2KSA8IDQpIHsKQEAgLTc1NDgsNyArNzU0OCw3IEBAIHN0YXRpYyBpbnQgaW50ZWxf
Y3J0Y19jb21wdXRlX2NvbmZpZyhzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YywKIAogCWlmICgocGlw
ZV9jb25maWctPm91dHB1dF9mb3JtYXQgPT0gSU5URUxfT1VUUFVUX0ZPUk1BVF9ZQ0JDUjQyMCB8
fAogCSAgICAgcGlwZV9jb25maWctPm91dHB1dF9mb3JtYXQgPT0gSU5URUxfT1VUUFVUX0ZPUk1B
VF9ZQ0JDUjQ0NCkgJiYKLQkgICAgIHBpcGVfY29uZmlnLT5iYXNlLmN0bSkgeworCSAgICAgcGlw
ZV9jb25maWctPmh3LmN0bSkgewogCQkvKgogCQkgKiBUaGVyZSBpcyBvbmx5IG9uZSBwaXBlIENT
QyB1bml0IHBlciBwaXBlLCBhbmQgd2UgbmVlZCB0aGF0CiAJCSAqIGZvciBvdXRwdXQgY29udmVy
c2lvbiBmcm9tIFJHQi0+WUNCQ1IuIFNvIGlmIENUTSBpcyBhbHJlYWR5CkBAIC04MjQ2LDcgKzgy
NDYsNyBAQCBzdGF0aWMgdm9pZCBpbnRlbF9zZXRfcGlwZV90aW1pbmdzKGNvbnN0IHN0cnVjdCBp
bnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlKQogCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpk
ZXZfcHJpdiA9IHRvX2k5MTUoY3J0Yy0+YmFzZS5kZXYpOwogCWVudW0gcGlwZSBwaXBlID0gY3J0
Yy0+cGlwZTsKIAllbnVtIHRyYW5zY29kZXIgY3B1X3RyYW5zY29kZXIgPSBjcnRjX3N0YXRlLT5j
cHVfdHJhbnNjb2RlcjsKLQljb25zdCBzdHJ1Y3QgZHJtX2Rpc3BsYXlfbW9kZSAqYWRqdXN0ZWRf
bW9kZSA9ICZjcnRjX3N0YXRlLT5iYXNlLmFkanVzdGVkX21vZGU7CisJY29uc3Qgc3RydWN0IGRy
bV9kaXNwbGF5X21vZGUgKmFkanVzdGVkX21vZGUgPSAmY3J0Y19zdGF0ZS0+aHcuYWRqdXN0ZWRf
bW9kZTsKIAl1MzIgY3J0Y192dG90YWwsIGNydGNfdmJsYW5rX2VuZDsKIAlpbnQgdnN5bmNzaGlm
dCA9IDA7CiAKQEAgLTgzNDAsMzkgKzgzNDAsMzkgQEAgc3RhdGljIHZvaWQgaW50ZWxfZ2V0X3Bp
cGVfdGltaW5ncyhzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YywKIAl1MzIgdG1wOwogCiAJdG1wID0g
STkxNV9SRUFEKEhUT1RBTChjcHVfdHJhbnNjb2RlcikpOwotCXBpcGVfY29uZmlnLT5iYXNlLmFk
anVzdGVkX21vZGUuY3J0Y19oZGlzcGxheSA9ICh0bXAgJiAweGZmZmYpICsgMTsKLQlwaXBlX2Nv
bmZpZy0+YmFzZS5hZGp1c3RlZF9tb2RlLmNydGNfaHRvdGFsID0gKCh0bXAgPj4gMTYpICYgMHhm
ZmZmKSArIDE7CisJcGlwZV9jb25maWctPmh3LmFkanVzdGVkX21vZGUuY3J0Y19oZGlzcGxheSA9
ICh0bXAgJiAweGZmZmYpICsgMTsKKwlwaXBlX2NvbmZpZy0+aHcuYWRqdXN0ZWRfbW9kZS5jcnRj
X2h0b3RhbCA9ICgodG1wID4+IDE2KSAmIDB4ZmZmZikgKyAxOwogCiAJaWYgKCF0cmFuc2NvZGVy
X2lzX2RzaShjcHVfdHJhbnNjb2RlcikpIHsKIAkJdG1wID0gSTkxNV9SRUFEKEhCTEFOSyhjcHVf
dHJhbnNjb2RlcikpOwotCQlwaXBlX2NvbmZpZy0+YmFzZS5hZGp1c3RlZF9tb2RlLmNydGNfaGJs
YW5rX3N0YXJ0ID0KKwkJcGlwZV9jb25maWctPmh3LmFkanVzdGVkX21vZGUuY3J0Y19oYmxhbmtf
c3RhcnQgPQogCQkJCQkJCSh0bXAgJiAweGZmZmYpICsgMTsKLQkJcGlwZV9jb25maWctPmJhc2Uu
YWRqdXN0ZWRfbW9kZS5jcnRjX2hibGFua19lbmQgPQorCQlwaXBlX2NvbmZpZy0+aHcuYWRqdXN0
ZWRfbW9kZS5jcnRjX2hibGFua19lbmQgPQogCQkJCQkJKCh0bXAgPj4gMTYpICYgMHhmZmZmKSAr
IDE7CiAJfQogCXRtcCA9IEk5MTVfUkVBRChIU1lOQyhjcHVfdHJhbnNjb2RlcikpOwotCXBpcGVf
Y29uZmlnLT5iYXNlLmFkanVzdGVkX21vZGUuY3J0Y19oc3luY19zdGFydCA9ICh0bXAgJiAweGZm
ZmYpICsgMTsKLQlwaXBlX2NvbmZpZy0+YmFzZS5hZGp1c3RlZF9tb2RlLmNydGNfaHN5bmNfZW5k
ID0gKCh0bXAgPj4gMTYpICYgMHhmZmZmKSArIDE7CisJcGlwZV9jb25maWctPmh3LmFkanVzdGVk
X21vZGUuY3J0Y19oc3luY19zdGFydCA9ICh0bXAgJiAweGZmZmYpICsgMTsKKwlwaXBlX2NvbmZp
Zy0+aHcuYWRqdXN0ZWRfbW9kZS5jcnRjX2hzeW5jX2VuZCA9ICgodG1wID4+IDE2KSAmIDB4ZmZm
ZikgKyAxOwogCiAJdG1wID0gSTkxNV9SRUFEKFZUT1RBTChjcHVfdHJhbnNjb2RlcikpOwotCXBp
cGVfY29uZmlnLT5iYXNlLmFkanVzdGVkX21vZGUuY3J0Y192ZGlzcGxheSA9ICh0bXAgJiAweGZm
ZmYpICsgMTsKLQlwaXBlX2NvbmZpZy0+YmFzZS5hZGp1c3RlZF9tb2RlLmNydGNfdnRvdGFsID0g
KCh0bXAgPj4gMTYpICYgMHhmZmZmKSArIDE7CisJcGlwZV9jb25maWctPmh3LmFkanVzdGVkX21v
ZGUuY3J0Y192ZGlzcGxheSA9ICh0bXAgJiAweGZmZmYpICsgMTsKKwlwaXBlX2NvbmZpZy0+aHcu
YWRqdXN0ZWRfbW9kZS5jcnRjX3Z0b3RhbCA9ICgodG1wID4+IDE2KSAmIDB4ZmZmZikgKyAxOwog
CiAJaWYgKCF0cmFuc2NvZGVyX2lzX2RzaShjcHVfdHJhbnNjb2RlcikpIHsKIAkJdG1wID0gSTkx
NV9SRUFEKFZCTEFOSyhjcHVfdHJhbnNjb2RlcikpOwotCQlwaXBlX2NvbmZpZy0+YmFzZS5hZGp1
c3RlZF9tb2RlLmNydGNfdmJsYW5rX3N0YXJ0ID0KKwkJcGlwZV9jb25maWctPmh3LmFkanVzdGVk
X21vZGUuY3J0Y192Ymxhbmtfc3RhcnQgPQogCQkJCQkJCSh0bXAgJiAweGZmZmYpICsgMTsKLQkJ
cGlwZV9jb25maWctPmJhc2UuYWRqdXN0ZWRfbW9kZS5jcnRjX3ZibGFua19lbmQgPQorCQlwaXBl
X2NvbmZpZy0+aHcuYWRqdXN0ZWRfbW9kZS5jcnRjX3ZibGFua19lbmQgPQogCQkJCQkJKCh0bXAg
Pj4gMTYpICYgMHhmZmZmKSArIDE7CiAJfQogCXRtcCA9IEk5MTVfUkVBRChWU1lOQyhjcHVfdHJh
bnNjb2RlcikpOwotCXBpcGVfY29uZmlnLT5iYXNlLmFkanVzdGVkX21vZGUuY3J0Y192c3luY19z
dGFydCA9ICh0bXAgJiAweGZmZmYpICsgMTsKLQlwaXBlX2NvbmZpZy0+YmFzZS5hZGp1c3RlZF9t
b2RlLmNydGNfdnN5bmNfZW5kID0gKCh0bXAgPj4gMTYpICYgMHhmZmZmKSArIDE7CisJcGlwZV9j
b25maWctPmh3LmFkanVzdGVkX21vZGUuY3J0Y192c3luY19zdGFydCA9ICh0bXAgJiAweGZmZmYp
ICsgMTsKKwlwaXBlX2NvbmZpZy0+aHcuYWRqdXN0ZWRfbW9kZS5jcnRjX3ZzeW5jX2VuZCA9ICgo
dG1wID4+IDE2KSAmIDB4ZmZmZikgKyAxOwogCiAJaWYgKGludGVsX3BpcGVfaXNfaW50ZXJsYWNl
ZChwaXBlX2NvbmZpZykpIHsKLQkJcGlwZV9jb25maWctPmJhc2UuYWRqdXN0ZWRfbW9kZS5mbGFn
cyB8PSBEUk1fTU9ERV9GTEFHX0lOVEVSTEFDRTsKLQkJcGlwZV9jb25maWctPmJhc2UuYWRqdXN0
ZWRfbW9kZS5jcnRjX3Z0b3RhbCArPSAxOwotCQlwaXBlX2NvbmZpZy0+YmFzZS5hZGp1c3RlZF9t
b2RlLmNydGNfdmJsYW5rX2VuZCArPSAxOworCQlwaXBlX2NvbmZpZy0+aHcuYWRqdXN0ZWRfbW9k
ZS5mbGFncyB8PSBEUk1fTU9ERV9GTEFHX0lOVEVSTEFDRTsKKwkJcGlwZV9jb25maWctPmh3LmFk
anVzdGVkX21vZGUuY3J0Y192dG90YWwgKz0gMTsKKwkJcGlwZV9jb25maWctPmh3LmFkanVzdGVk
X21vZGUuY3J0Y192YmxhbmtfZW5kICs9IDE7CiAJfQogfQogCkBAIC04Mzg3LDI3ICs4Mzg3LDI3
IEBAIHN0YXRpYyB2b2lkIGludGVsX2dldF9waXBlX3NyY19zaXplKHN0cnVjdCBpbnRlbF9jcnRj
ICpjcnRjLAogCXBpcGVfY29uZmlnLT5waXBlX3NyY19oID0gKHRtcCAmIDB4ZmZmZikgKyAxOwog
CXBpcGVfY29uZmlnLT5waXBlX3NyY193ID0gKCh0bXAgPj4gMTYpICYgMHhmZmZmKSArIDE7CiAK
LQlwaXBlX2NvbmZpZy0+YmFzZS5tb2RlLnZkaXNwbGF5ID0gcGlwZV9jb25maWctPnBpcGVfc3Jj
X2g7Ci0JcGlwZV9jb25maWctPmJhc2UubW9kZS5oZGlzcGxheSA9IHBpcGVfY29uZmlnLT5waXBl
X3NyY193OworCXBpcGVfY29uZmlnLT5ody5tb2RlLnZkaXNwbGF5ID0gcGlwZV9jb25maWctPnBp
cGVfc3JjX2g7CisJcGlwZV9jb25maWctPmh3Lm1vZGUuaGRpc3BsYXkgPSBwaXBlX2NvbmZpZy0+
cGlwZV9zcmNfdzsKIH0KIAogdm9pZCBpbnRlbF9tb2RlX2Zyb21fcGlwZV9jb25maWcoc3RydWN0
IGRybV9kaXNwbGF5X21vZGUgKm1vZGUsCiAJCQkJIHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpw
aXBlX2NvbmZpZykKIHsKLQltb2RlLT5oZGlzcGxheSA9IHBpcGVfY29uZmlnLT5iYXNlLmFkanVz
dGVkX21vZGUuY3J0Y19oZGlzcGxheTsKLQltb2RlLT5odG90YWwgPSBwaXBlX2NvbmZpZy0+YmFz
ZS5hZGp1c3RlZF9tb2RlLmNydGNfaHRvdGFsOwotCW1vZGUtPmhzeW5jX3N0YXJ0ID0gcGlwZV9j
b25maWctPmJhc2UuYWRqdXN0ZWRfbW9kZS5jcnRjX2hzeW5jX3N0YXJ0OwotCW1vZGUtPmhzeW5j
X2VuZCA9IHBpcGVfY29uZmlnLT5iYXNlLmFkanVzdGVkX21vZGUuY3J0Y19oc3luY19lbmQ7CisJ
bW9kZS0+aGRpc3BsYXkgPSBwaXBlX2NvbmZpZy0+aHcuYWRqdXN0ZWRfbW9kZS5jcnRjX2hkaXNw
bGF5OworCW1vZGUtPmh0b3RhbCA9IHBpcGVfY29uZmlnLT5ody5hZGp1c3RlZF9tb2RlLmNydGNf
aHRvdGFsOworCW1vZGUtPmhzeW5jX3N0YXJ0ID0gcGlwZV9jb25maWctPmh3LmFkanVzdGVkX21v
ZGUuY3J0Y19oc3luY19zdGFydDsKKwltb2RlLT5oc3luY19lbmQgPSBwaXBlX2NvbmZpZy0+aHcu
YWRqdXN0ZWRfbW9kZS5jcnRjX2hzeW5jX2VuZDsKIAotCW1vZGUtPnZkaXNwbGF5ID0gcGlwZV9j
b25maWctPmJhc2UuYWRqdXN0ZWRfbW9kZS5jcnRjX3ZkaXNwbGF5OwotCW1vZGUtPnZ0b3RhbCA9
IHBpcGVfY29uZmlnLT5iYXNlLmFkanVzdGVkX21vZGUuY3J0Y192dG90YWw7Ci0JbW9kZS0+dnN5
bmNfc3RhcnQgPSBwaXBlX2NvbmZpZy0+YmFzZS5hZGp1c3RlZF9tb2RlLmNydGNfdnN5bmNfc3Rh
cnQ7Ci0JbW9kZS0+dnN5bmNfZW5kID0gcGlwZV9jb25maWctPmJhc2UuYWRqdXN0ZWRfbW9kZS5j
cnRjX3ZzeW5jX2VuZDsKKwltb2RlLT52ZGlzcGxheSA9IHBpcGVfY29uZmlnLT5ody5hZGp1c3Rl
ZF9tb2RlLmNydGNfdmRpc3BsYXk7CisJbW9kZS0+dnRvdGFsID0gcGlwZV9jb25maWctPmh3LmFk
anVzdGVkX21vZGUuY3J0Y192dG90YWw7CisJbW9kZS0+dnN5bmNfc3RhcnQgPSBwaXBlX2NvbmZp
Zy0+aHcuYWRqdXN0ZWRfbW9kZS5jcnRjX3ZzeW5jX3N0YXJ0OworCW1vZGUtPnZzeW5jX2VuZCA9
IHBpcGVfY29uZmlnLT5ody5hZGp1c3RlZF9tb2RlLmNydGNfdnN5bmNfZW5kOwogCi0JbW9kZS0+
ZmxhZ3MgPSBwaXBlX2NvbmZpZy0+YmFzZS5hZGp1c3RlZF9tb2RlLmZsYWdzOworCW1vZGUtPmZs
YWdzID0gcGlwZV9jb25maWctPmh3LmFkanVzdGVkX21vZGUuZmxhZ3M7CiAJbW9kZS0+dHlwZSA9
IERSTV9NT0RFX1RZUEVfRFJJVkVSOwogCi0JbW9kZS0+Y2xvY2sgPSBwaXBlX2NvbmZpZy0+YmFz
ZS5hZGp1c3RlZF9tb2RlLmNydGNfY2xvY2s7CisJbW9kZS0+Y2xvY2sgPSBwaXBlX2NvbmZpZy0+
aHcuYWRqdXN0ZWRfbW9kZS5jcnRjX2Nsb2NrOwogCiAJbW9kZS0+aHN5bmMgPSBkcm1fbW9kZV9o
c3luYyhtb2RlKTsKIAltb2RlLT52cmVmcmVzaCA9IGRybV9tb2RlX3ZyZWZyZXNoKG1vZGUpOwpA
QCAtODQ1Myw3ICs4NDUzLDcgQEAgc3RhdGljIHZvaWQgaTl4eF9zZXRfcGlwZWNvbmYoY29uc3Qg
c3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUpCiAJCX0KIAl9CiAKLQlpZiAoY3J0
Y19zdGF0ZS0+YmFzZS5hZGp1c3RlZF9tb2RlLmZsYWdzICYgRFJNX01PREVfRkxBR19JTlRFUkxB
Q0UpIHsKKwlpZiAoY3J0Y19zdGF0ZS0+aHcuYWRqdXN0ZWRfbW9kZS5mbGFncyAmIERSTV9NT0RF
X0ZMQUdfSU5URVJMQUNFKSB7CiAJCWlmIChJTlRFTF9HRU4oZGV2X3ByaXYpIDwgNCB8fAogCQkg
ICAgaW50ZWxfY3J0Y19oYXNfdHlwZShjcnRjX3N0YXRlLCBJTlRFTF9PVVRQVVRfU0RWTykpCiAJ
CQlwaXBlY29uZiB8PSBQSVBFQ09ORl9JTlRFUkxBQ0VfV19GSUVMRF9JTkRJQ0FUSU9OOwpAQCAt
ODk4Niw3ICs4OTg2LDcgQEAgc3RhdGljIGJvb2wgaTl4eF9nZXRfcGlwZV9jb25maWcoc3RydWN0
IGludGVsX2NydGMgKmNydGMsCiAJICogYnV0IGluIGNhc2UgdGhlIHBpcGUgaXMgZW5hYmxlZCB3
L28gYW55IHBvcnRzIHdlIG5lZWQgYSBzYW5lCiAJICogZGVmYXVsdC4KIAkgKi8KLQlwaXBlX2Nv
bmZpZy0+YmFzZS5hZGp1c3RlZF9tb2RlLmNydGNfY2xvY2sgPQorCXBpcGVfY29uZmlnLT5ody5h
ZGp1c3RlZF9tb2RlLmNydGNfY2xvY2sgPQogCQlwaXBlX2NvbmZpZy0+cG9ydF9jbG9jayAvIHBp
cGVfY29uZmlnLT5waXhlbF9tdWx0aXBsaWVyOwogCiAJcmV0ID0gdHJ1ZTsKQEAgLTk1MzAsNyAr
OTUzMCw3IEBAIHN0YXRpYyB2b2lkIGlyb25sYWtlX3NldF9waXBlY29uZihjb25zdCBzdHJ1Y3Qg
aW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSkKIAlpZiAoY3J0Y19zdGF0ZS0+ZGl0aGVyKQog
CQl2YWwgfD0gKFBJUEVDT05GX0RJVEhFUl9FTiB8IFBJUEVDT05GX0RJVEhFUl9UWVBFX1NQKTsK
IAotCWlmIChjcnRjX3N0YXRlLT5iYXNlLmFkanVzdGVkX21vZGUuZmxhZ3MgJiBEUk1fTU9ERV9G
TEFHX0lOVEVSTEFDRSkKKwlpZiAoY3J0Y19zdGF0ZS0+aHcuYWRqdXN0ZWRfbW9kZS5mbGFncyAm
IERSTV9NT0RFX0ZMQUdfSU5URVJMQUNFKQogCQl2YWwgfD0gUElQRUNPTkZfSU5URVJMQUNFRF9J
TEs7CiAJZWxzZQogCQl2YWwgfD0gUElQRUNPTkZfUFJPR1JFU1NJVkU7CkBAIC05NTY0LDcgKzk1
NjQsNyBAQCBzdGF0aWMgdm9pZCBoYXN3ZWxsX3NldF9waXBlY29uZihjb25zdCBzdHJ1Y3QgaW50
ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSkKIAlpZiAoSVNfSEFTV0VMTChkZXZfcHJpdikgJiYg
Y3J0Y19zdGF0ZS0+ZGl0aGVyKQogCQl2YWwgfD0gKFBJUEVDT05GX0RJVEhFUl9FTiB8IFBJUEVD
T05GX0RJVEhFUl9UWVBFX1NQKTsKIAotCWlmIChjcnRjX3N0YXRlLT5iYXNlLmFkanVzdGVkX21v
ZGUuZmxhZ3MgJiBEUk1fTU9ERV9GTEFHX0lOVEVSTEFDRSkKKwlpZiAoY3J0Y19zdGF0ZS0+aHcu
YWRqdXN0ZWRfbW9kZS5mbGFncyAmIERSTV9NT0RFX0ZMQUdfSU5URVJMQUNFKQogCQl2YWwgfD0g
UElQRUNPTkZfSU5URVJMQUNFRF9JTEs7CiAJZWxzZQogCQl2YWwgfD0gUElQRUNPTkZfUFJPR1JF
U1NJVkU7CkBAIC0xMTY0Niw3ICsxMTY0Niw3IEBAIHN0YXRpYyB2b2lkIGlyb25sYWtlX3BjaF9j
bG9ja19nZXQoc3RydWN0IGludGVsX2NydGMgKmNydGMsCiAJICogd2UgbWF5IG5lZWQgc29tZSBp
ZGVhIGZvciB0aGUgZG90Y2xvY2sgYW55d2F5LgogCSAqIENhbGN1bGF0ZSBvbmUgYmFzZWQgb24g
dGhlIEZESSBjb25maWd1cmF0aW9uLgogCSAqLwotCXBpcGVfY29uZmlnLT5iYXNlLmFkanVzdGVk
X21vZGUuY3J0Y19jbG9jayA9CisJcGlwZV9jb25maWctPmh3LmFkanVzdGVkX21vZGUuY3J0Y19j
bG9jayA9CiAJCWludGVsX2RvdGNsb2NrX2NhbGN1bGF0ZShpbnRlbF9mZGlfbGlua19mcmVxKGRl
dl9wcml2LCBwaXBlX2NvbmZpZyksCiAJCQkJCSAmcGlwZV9jb25maWctPmZkaV9tX24pOwogfQpA
QCAtMTE3NTEsOCArMTE3NTEsOCBAQCBpbnQgaW50ZWxfcGxhbmVfYXRvbWljX2NhbGNfY2hhbmdl
cyhjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqb2xkX2NydGNfc3RhdAogCXN0cnVjdCBp
bnRlbF9wbGFuZSAqcGxhbmUgPSB0b19pbnRlbF9wbGFuZShwbGFuZV9zdGF0ZS0+YmFzZS5wbGFu
ZSk7CiAJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShjcnRjLT5i
YXNlLmRldik7CiAJYm9vbCBtb2RlX2NoYW5nZWQgPSBuZWVkc19tb2Rlc2V0KGNydGNfc3RhdGUp
OwotCWJvb2wgd2FzX2NydGNfZW5hYmxlZCA9IG9sZF9jcnRjX3N0YXRlLT5iYXNlLmFjdGl2ZTsK
LQlib29sIGlzX2NydGNfZW5hYmxlZCA9IGNydGNfc3RhdGUtPmJhc2UuYWN0aXZlOworCWJvb2wg
d2FzX2NydGNfZW5hYmxlZCA9IG9sZF9jcnRjX3N0YXRlLT5ody5hY3RpdmU7CisJYm9vbCBpc19j
cnRjX2VuYWJsZWQgPSBjcnRjX3N0YXRlLT5ody5hY3RpdmU7CiAJYm9vbCB0dXJuX29mZiwgdHVy
bl9vbiwgdmlzaWJsZSwgd2FzX3Zpc2libGU7CiAJaW50IHJldDsKIApAQCAtMTIwMjksOCArMTIw
MjksOCBAQCBzdGF0aWMgaW50IGljbF9hZGRfc3luY19tb2RlX2NydGNzKHN0cnVjdCBpbnRlbF9j
cnRjX3N0YXRlICpjcnRjX3N0YXRlKQogCQkJY29udGludWU7CiAJCWlmICghY29ubmVjdG9yLT5o
YXNfdGlsZSkKIAkJCWNvbnRpbnVlOwotCQlpZiAoY3J0Y19zdGF0ZS0+YmFzZS5tb2RlLmhkaXNw
bGF5ICE9IGNvbm5lY3Rvci0+dGlsZV9oX3NpemUgfHwKLQkJICAgIGNydGNfc3RhdGUtPmJhc2Uu
bW9kZS52ZGlzcGxheSAhPSBjb25uZWN0b3ItPnRpbGVfdl9zaXplKQorCQlpZiAoY3J0Y19zdGF0
ZS0+aHcubW9kZS5oZGlzcGxheSAhPSBjb25uZWN0b3ItPnRpbGVfaF9zaXplIHx8CisJCSAgICBj
cnRjX3N0YXRlLT5ody5tb2RlLnZkaXNwbGF5ICE9IGNvbm5lY3Rvci0+dGlsZV92X3NpemUpCiAJ
CQlyZXR1cm4gMDsKIAkJaWYgKGNvbm5lY3Rvci0+dGlsZV9oX2xvYyA9PSBjb25uZWN0b3ItPm51
bV9oX3RpbGUgLSAxICYmCiAJCSAgICBjb25uZWN0b3ItPnRpbGVfdl9sb2MgPT0gY29ubmVjdG9y
LT5udW1fdl90aWxlIC0gMSkKQEAgLTEyMDk2LDEwICsxMjA5NiwxMCBAQCBzdGF0aWMgaW50IGlu
dGVsX2NydGNfYXRvbWljX2NoZWNrKHN0cnVjdCBpbnRlbF9hdG9taWNfc3RhdGUgKnN0YXRlLAog
CWludCByZXQ7CiAKIAlpZiAoSU5URUxfR0VOKGRldl9wcml2KSA8IDUgJiYgIUlTX0c0WChkZXZf
cHJpdikgJiYKLQkgICAgbW9kZV9jaGFuZ2VkICYmICFjcnRjX3N0YXRlLT5iYXNlLmFjdGl2ZSkK
KwkgICAgbW9kZV9jaGFuZ2VkICYmICFjcnRjX3N0YXRlLT5ody5hY3RpdmUpCiAJCWNydGNfc3Rh
dGUtPnVwZGF0ZV93bV9wb3N0ID0gdHJ1ZTsKIAotCWlmIChtb2RlX2NoYW5nZWQgJiYgY3J0Y19z
dGF0ZS0+YmFzZS5lbmFibGUgJiYKKwlpZiAobW9kZV9jaGFuZ2VkICYmIGNydGNfc3RhdGUtPmh3
LmVuYWJsZSAmJgogCSAgICBkZXZfcHJpdi0+ZGlzcGxheS5jcnRjX2NvbXB1dGVfY2xvY2sgJiYK
IAkgICAgIVdBUk5fT04oY3J0Y19zdGF0ZS0+c2hhcmVkX2RwbGwpKSB7CiAJCXJldCA9IGRldl9w
cml2LT5kaXNwbGF5LmNydGNfY29tcHV0ZV9jbG9jayhjcnRjLCBjcnRjX3N0YXRlKTsKQEAgLTEy
MzkwLDE0ICsxMjM5MCwxNCBAQCBzdGF0aWMgdm9pZCBpbnRlbF9kdW1wX3BpcGVfY29uZmlnKGNv
bnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpwaXBlX2NvbmZpZywKIAogCURSTV9ERUJVR19L
TVMoIltDUlRDOiVkOiVzXSBlbmFibGU6ICVzICVzXG4iLAogCQkgICAgICBjcnRjLT5iYXNlLmJh
c2UuaWQsIGNydGMtPmJhc2UubmFtZSwKLQkJICAgICAgeWVzbm8ocGlwZV9jb25maWctPmJhc2Uu
ZW5hYmxlKSwgY29udGV4dCk7CisJCSAgICAgIHllc25vKHBpcGVfY29uZmlnLT5ody5lbmFibGUp
LCBjb250ZXh0KTsKIAotCWlmICghcGlwZV9jb25maWctPmJhc2UuZW5hYmxlKQorCWlmICghcGlw
ZV9jb25maWctPmh3LmVuYWJsZSkKIAkJZ290byBkdW1wX3BsYW5lczsKIAogCXNucHJpbnRmX291
dHB1dF90eXBlcyhidWYsIHNpemVvZihidWYpLCBwaXBlX2NvbmZpZy0+b3V0cHV0X3R5cGVzKTsK
IAlEUk1fREVCVUdfS01TKCJhY3RpdmU6ICVzLCBvdXRwdXRfdHlwZXM6ICVzICgweCV4KSwgb3V0
cHV0IGZvcm1hdDogJXNcbiIsCi0JCSAgICAgIHllc25vKHBpcGVfY29uZmlnLT5iYXNlLmFjdGl2
ZSksCisJCSAgICAgIHllc25vKHBpcGVfY29uZmlnLT5ody5hY3RpdmUpLAogCQkgICAgICBidWYs
IHBpcGVfY29uZmlnLT5vdXRwdXRfdHlwZXMsCiAJCSAgICAgIG91dHB1dF9mb3JtYXRzKHBpcGVf
Y29uZmlnLT5vdXRwdXRfZm9ybWF0KSk7CiAKQEAgLTEyNDM3LDEwICsxMjQzNywxMCBAQCBzdGF0
aWMgdm9pZCBpbnRlbF9kdW1wX3BpcGVfY29uZmlnKGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0
YXRlICpwaXBlX2NvbmZpZywKIAkJaW50ZWxfZHVtcF9pbmZvZnJhbWUoZGV2X3ByaXYsICZwaXBl
X2NvbmZpZy0+aW5mb2ZyYW1lcy5oZG1pKTsKIAogCURSTV9ERUJVR19LTVMoInJlcXVlc3RlZCBt
b2RlOlxuIik7Ci0JZHJtX21vZGVfZGVidWdfcHJpbnRtb2RlbGluZSgmcGlwZV9jb25maWctPmJh
c2UubW9kZSk7CisJZHJtX21vZGVfZGVidWdfcHJpbnRtb2RlbGluZSgmcGlwZV9jb25maWctPmh3
Lm1vZGUpOwogCURSTV9ERUJVR19LTVMoImFkanVzdGVkIG1vZGU6XG4iKTsKLQlkcm1fbW9kZV9k
ZWJ1Z19wcmludG1vZGVsaW5lKCZwaXBlX2NvbmZpZy0+YmFzZS5hZGp1c3RlZF9tb2RlKTsKLQlp
bnRlbF9kdW1wX2NydGNfdGltaW5ncygmcGlwZV9jb25maWctPmJhc2UuYWRqdXN0ZWRfbW9kZSk7
CisJZHJtX21vZGVfZGVidWdfcHJpbnRtb2RlbGluZSgmcGlwZV9jb25maWctPmh3LmFkanVzdGVk
X21vZGUpOworCWludGVsX2R1bXBfY3J0Y190aW1pbmdzKCZwaXBlX2NvbmZpZy0+aHcuYWRqdXN0
ZWRfbW9kZSk7CiAJRFJNX0RFQlVHX0tNUygicG9ydCBjbG9jazogJWQsIHBpcGUgc3JjIHNpemU6
ICVkeCVkLCBwaXhlbCByYXRlICVkXG4iLAogCQkgICAgICBwaXBlX2NvbmZpZy0+cG9ydF9jbG9j
aywKIAkJICAgICAgcGlwZV9jb25maWctPnBpcGVfc3JjX3csIHBpcGVfY29uZmlnLT5waXBlX3Ny
Y19oLApAQCAtMTI2MjgsMTMgKzEyNjI4LDEzIEBAIGludGVsX21vZGVzZXRfcGlwZV9jb25maWco
c3RydWN0IGludGVsX2NydGNfc3RhdGUgKnBpcGVfY29uZmlnKQogCSAqIHBvc2l0aXZlIG9yIG5l
Z2F0aXZlIHBvbGFyaXR5IGlzIHJlcXVlc3RlZCwgdHJlYXQgdGhpcyBhcyBtZWFuaW5nCiAJICog
bmVnYXRpdmUgcG9sYXJpdHkuCiAJICovCi0JaWYgKCEocGlwZV9jb25maWctPmJhc2UuYWRqdXN0
ZWRfbW9kZS5mbGFncyAmCisJaWYgKCEocGlwZV9jb25maWctPmh3LmFkanVzdGVkX21vZGUuZmxh
Z3MgJgogCSAgICAgIChEUk1fTU9ERV9GTEFHX1BIU1lOQyB8IERSTV9NT0RFX0ZMQUdfTkhTWU5D
KSkpCi0JCXBpcGVfY29uZmlnLT5iYXNlLmFkanVzdGVkX21vZGUuZmxhZ3MgfD0gRFJNX01PREVf
RkxBR19OSFNZTkM7CisJCXBpcGVfY29uZmlnLT5ody5hZGp1c3RlZF9tb2RlLmZsYWdzIHw9IERS
TV9NT0RFX0ZMQUdfTkhTWU5DOwogCi0JaWYgKCEocGlwZV9jb25maWctPmJhc2UuYWRqdXN0ZWRf
bW9kZS5mbGFncyAmCisJaWYgKCEocGlwZV9jb25maWctPmh3LmFkanVzdGVkX21vZGUuZmxhZ3Mg
JgogCSAgICAgIChEUk1fTU9ERV9GTEFHX1BWU1lOQyB8IERSTV9NT0RFX0ZMQUdfTlZTWU5DKSkp
Ci0JCXBpcGVfY29uZmlnLT5iYXNlLmFkanVzdGVkX21vZGUuZmxhZ3MgfD0gRFJNX01PREVfRkxB
R19OVlNZTkM7CisJCXBpcGVfY29uZmlnLT5ody5hZGp1c3RlZF9tb2RlLmZsYWdzIHw9IERSTV9N
T0RFX0ZMQUdfTlZTWU5DOwogCiAJcmV0ID0gY29tcHV0ZV9iYXNlbGluZV9waXBlX2JwcCh0b19p
bnRlbF9jcnRjKGNydGMpLAogCQkJCQlwaXBlX2NvbmZpZyk7CkBAIC0xMjY1MSw3ICsxMjY1MSw3
IEBAIGludGVsX21vZGVzZXRfcGlwZV9jb25maWcoc3RydWN0IGludGVsX2NydGNfc3RhdGUgKnBp
cGVfY29uZmlnKQogCSAqIGNvbXB1dGF0aW9uIHRvIGNsZWFybHkgZGlzdGluZ3Vpc2ggaXQgZnJv
bSB0aGUgYWRqdXN0ZWQgbW9kZSwgd2hpY2gKIAkgKiBjYW4gYmUgY2hhbmdlZCBieSB0aGUgY29u
bmVjdG9ycyBpbiB0aGUgYmVsb3cgcmV0cnkgbG9vcC4KIAkgKi8KLQlkcm1fbW9kZV9nZXRfaHZf
dGltaW5nKCZwaXBlX2NvbmZpZy0+YmFzZS5tb2RlLAorCWRybV9tb2RlX2dldF9odl90aW1pbmco
JnBpcGVfY29uZmlnLT5ody5tb2RlLAogCQkJICAgICAgICZwaXBlX2NvbmZpZy0+cGlwZV9zcmNf
dywKIAkJCSAgICAgICAmcGlwZV9jb25maWctPnBpcGVfc3JjX2gpOwogCkBAIC0xMjY4NCw3ICsx
MjY4NCw3IEBAIGludGVsX21vZGVzZXRfcGlwZV9jb25maWcoc3RydWN0IGludGVsX2NydGNfc3Rh
dGUgKnBpcGVfY29uZmlnKQogCXBpcGVfY29uZmlnLT5waXhlbF9tdWx0aXBsaWVyID0gMTsKIAog
CS8qIEZpbGwgaW4gZGVmYXVsdCBjcnRjIHRpbWluZ3MsIGFsbG93IGVuY29kZXJzIHRvIG92ZXJ3
cml0ZSB0aGVtLiAqLwotCWRybV9tb2RlX3NldF9jcnRjaW5mbygmcGlwZV9jb25maWctPmJhc2Uu
YWRqdXN0ZWRfbW9kZSwKKwlkcm1fbW9kZV9zZXRfY3J0Y2luZm8oJnBpcGVfY29uZmlnLT5ody5h
ZGp1c3RlZF9tb2RlLAogCQkJICAgICAgQ1JUQ19TVEVSRU9fRE9VQkxFKTsKIAogCS8qIFNldCB0
aGUgY3J0Y19zdGF0ZSBkZWZhdWx0cyBmb3IgdHJhbnNfcG9ydF9zeW5jICovCkBAIC0xMjcxOCw3
ICsxMjcxOCw3IEBAIGludGVsX21vZGVzZXRfcGlwZV9jb25maWcoc3RydWN0IGludGVsX2NydGNf
c3RhdGUgKnBpcGVfY29uZmlnKQogCS8qIFNldCBkZWZhdWx0IHBvcnQgY2xvY2sgaWYgbm90IG92
ZXJ3cml0dGVuIGJ5IHRoZSBlbmNvZGVyLiBOZWVkcyB0byBiZQogCSAqIGRvbmUgYWZ0ZXJ3YXJk
cyBpbiBjYXNlIHRoZSBlbmNvZGVyIGFkanVzdHMgdGhlIG1vZGUuICovCiAJaWYgKCFwaXBlX2Nv
bmZpZy0+cG9ydF9jbG9jaykKLQkJcGlwZV9jb25maWctPnBvcnRfY2xvY2sgPSBwaXBlX2NvbmZp
Zy0+YmFzZS5hZGp1c3RlZF9tb2RlLmNydGNfY2xvY2sKKwkJcGlwZV9jb25maWctPnBvcnRfY2xv
Y2sgPSBwaXBlX2NvbmZpZy0+aHcuYWRqdXN0ZWRfbW9kZS5jcnRjX2Nsb2NrCiAJCQkqIHBpcGVf
Y29uZmlnLT5waXhlbF9tdWx0aXBsaWVyOwogCiAJcmV0ID0gaW50ZWxfY3J0Y19jb21wdXRlX2Nv
bmZpZyh0b19pbnRlbF9jcnRjKGNydGMpLCBwaXBlX2NvbmZpZyk7CkBAIC0xMjg5MCw4ICsxMjg5
MCw4IEBAIGludGVsX3BpcGVfY29uZmlnX2NvbXBhcmUoY29uc3Qgc3RydWN0IGludGVsX2NydGNf
c3RhdGUgKmN1cnJlbnRfY29uZmlnLAogCWJvb2wgcmV0ID0gdHJ1ZTsKIAl1MzIgYnBfZ2FtbWEg
PSAwOwogCWJvb2wgZml4dXBfaW5oZXJpdGVkID0gZmFzdHNldCAmJgotCQkoY3VycmVudF9jb25m
aWctPmJhc2UubW9kZS5wcml2YXRlX2ZsYWdzICYgSTkxNV9NT0RFX0ZMQUdfSU5IRVJJVEVEKSAm
JgotCQkhKHBpcGVfY29uZmlnLT5iYXNlLm1vZGUucHJpdmF0ZV9mbGFncyAmIEk5MTVfTU9ERV9G
TEFHX0lOSEVSSVRFRCk7CisJCShjdXJyZW50X2NvbmZpZy0+aHcubW9kZS5wcml2YXRlX2ZsYWdz
ICYgSTkxNV9NT0RFX0ZMQUdfSU5IRVJJVEVEKSAmJgorCQkhKHBpcGVfY29uZmlnLT5ody5tb2Rl
LnByaXZhdGVfZmxhZ3MgJiBJOTE1X01PREVfRkxBR19JTkhFUklURUQpOwogCiAJaWYgKGZpeHVw
X2luaGVyaXRlZCAmJiAhZmFzdGJvb3RfZW5hYmxlZChkZXZfcHJpdikpIHsKIAkJRFJNX0RFQlVH
X0tNUygiaW5pdGlhbCBtb2Rlc2V0IGFuZCBmYXN0Ym9vdCBub3Qgc2V0XG4iKTsKQEAgLTEzMjM3
LDcgKzEzMjM3LDcgQEAgc3RhdGljIHZvaWQgaW50ZWxfcGlwZV9jb25maWdfc2FuaXR5X2NoZWNr
KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKIAlpZiAocGlwZV9jb25maWctPmhh
c19wY2hfZW5jb2RlcikgewogCQlpbnQgZmRpX2RvdGNsb2NrID0gaW50ZWxfZG90Y2xvY2tfY2Fs
Y3VsYXRlKGludGVsX2ZkaV9saW5rX2ZyZXEoZGV2X3ByaXYsIHBpcGVfY29uZmlnKSwKIAkJCQkJ
CQkgICAgJnBpcGVfY29uZmlnLT5mZGlfbV9uKTsKLQkJaW50IGRvdGNsb2NrID0gcGlwZV9jb25m
aWctPmJhc2UuYWRqdXN0ZWRfbW9kZS5jcnRjX2Nsb2NrOworCQlpbnQgZG90Y2xvY2sgPSBwaXBl
X2NvbmZpZy0+aHcuYWRqdXN0ZWRfbW9kZS5jcnRjX2Nsb2NrOwogCiAJCS8qCiAJCSAqIEZESSBh
bHJlYWR5IHByb3ZpZGVkIG9uZSBpZGVhIGZvciB0aGUgZG90Y2xvY2suCkBAIC0xMzI2NSw3ICsx
MzI2NSw3IEBAIHN0YXRpYyB2b2lkIHZlcmlmeV93bV9zdGF0ZShzdHJ1Y3QgaW50ZWxfY3J0YyAq
Y3J0YywKIAljb25zdCBlbnVtIHBpcGUgcGlwZSA9IGNydGMtPnBpcGU7CiAJaW50IHBsYW5lLCBs
ZXZlbCwgbWF4X2xldmVsID0gaWxrX3dtX21heF9sZXZlbChkZXZfcHJpdik7CiAKLQlpZiAoSU5U
RUxfR0VOKGRldl9wcml2KSA8IDkgfHwgIW5ld19jcnRjX3N0YXRlLT5iYXNlLmFjdGl2ZSkKKwlp
ZiAoSU5URUxfR0VOKGRldl9wcml2KSA8IDkgfHwgIW5ld19jcnRjX3N0YXRlLT5ody5hY3RpdmUp
CiAJCXJldHVybjsKIAogCWh3ID0ga3phbGxvYyhzaXplb2YoKmh3KSwgR0ZQX0tFUk5FTCk7CkBA
IC0xMzQ4NywyMyArMTM0ODcsMjYgQEAgdmVyaWZ5X2NydGNfc3RhdGUoc3RydWN0IGludGVsX2Ny
dGMgKmNydGMsCiAKIAkvKiB3ZSBrZWVwIGJvdGggcGlwZXMgZW5hYmxlZCBvbiA4MzAgKi8KIAlp
ZiAoSVNfSTgzMChkZXZfcHJpdikpCi0JCWFjdGl2ZSA9IG5ld19jcnRjX3N0YXRlLT5iYXNlLmFj
dGl2ZTsKKwkJYWN0aXZlID0gbmV3X2NydGNfc3RhdGUtPmh3LmFjdGl2ZTsKIAotCUk5MTVfU1RB
VEVfV0FSTihuZXdfY3J0Y19zdGF0ZS0+YmFzZS5hY3RpdmUgIT0gYWN0aXZlLAotCSAgICAgImNy
dGMgYWN0aXZlIHN0YXRlIGRvZXNuJ3QgbWF0Y2ggd2l0aCBodyBzdGF0ZSAiCi0JICAgICAiKGV4
cGVjdGVkICVpLCBmb3VuZCAlaSlcbiIsIG5ld19jcnRjX3N0YXRlLT5iYXNlLmFjdGl2ZSwgYWN0
aXZlKTsKKwlJOTE1X1NUQVRFX1dBUk4obmV3X2NydGNfc3RhdGUtPmh3LmFjdGl2ZSAhPSBhY3Rp
dmUsCisJCQkiY3J0YyBhY3RpdmUgc3RhdGUgZG9lc24ndCBtYXRjaCB3aXRoIGh3IHN0YXRlICIK
KwkJCSIoZXhwZWN0ZWQgJWksIGZvdW5kICVpKVxuIiwKKwkJCW5ld19jcnRjX3N0YXRlLT5ody5h
Y3RpdmUsIGFjdGl2ZSk7CiAKLQlJOTE1X1NUQVRFX1dBUk4oY3J0Yy0+YWN0aXZlICE9IG5ld19j
cnRjX3N0YXRlLT5iYXNlLmFjdGl2ZSwKLQkgICAgICJ0cmFuc2l0aW9uYWwgYWN0aXZlIHN0YXRl
IGRvZXMgbm90IG1hdGNoIGF0b21pYyBodyBzdGF0ZSAiCi0JICAgICAiKGV4cGVjdGVkICVpLCBm
b3VuZCAlaSlcbiIsIG5ld19jcnRjX3N0YXRlLT5iYXNlLmFjdGl2ZSwgY3J0Yy0+YWN0aXZlKTsK
KwlJOTE1X1NUQVRFX1dBUk4oY3J0Yy0+YWN0aXZlICE9IG5ld19jcnRjX3N0YXRlLT5ody5hY3Rp
dmUsCisJCQkidHJhbnNpdGlvbmFsIGFjdGl2ZSBzdGF0ZSBkb2VzIG5vdCBtYXRjaCBhdG9taWMg
aHcgc3RhdGUgIgorCQkJIihleHBlY3RlZCAlaSwgZm91bmQgJWkpXG4iLAorCQkJbmV3X2NydGNf
c3RhdGUtPmh3LmFjdGl2ZSwgY3J0Yy0+YWN0aXZlKTsKIAogCWZvcl9lYWNoX2VuY29kZXJfb25f
Y3J0YyhkZXYsICZjcnRjLT5iYXNlLCBlbmNvZGVyKSB7CiAJCWVudW0gcGlwZSBwaXBlOwogCiAJ
CWFjdGl2ZSA9IGVuY29kZXItPmdldF9od19zdGF0ZShlbmNvZGVyLCAmcGlwZSk7Ci0JCUk5MTVf
U1RBVEVfV0FSTihhY3RpdmUgIT0gbmV3X2NydGNfc3RhdGUtPmJhc2UuYWN0aXZlLAotCQkJIltF
TkNPREVSOiVpXSBhY3RpdmUgJWkgd2l0aCBjcnRjIGFjdGl2ZSAlaVxuIiwKLQkJCWVuY29kZXIt
PmJhc2UuYmFzZS5pZCwgYWN0aXZlLCBuZXdfY3J0Y19zdGF0ZS0+YmFzZS5hY3RpdmUpOworCQlJ
OTE1X1NUQVRFX1dBUk4oYWN0aXZlICE9IG5ld19jcnRjX3N0YXRlLT5ody5hY3RpdmUsCisJCQkJ
IltFTkNPREVSOiVpXSBhY3RpdmUgJWkgd2l0aCBjcnRjIGFjdGl2ZSAlaVxuIiwKKwkJCQllbmNv
ZGVyLT5iYXNlLmJhc2UuaWQsIGFjdGl2ZSwKKwkJCQluZXdfY3J0Y19zdGF0ZS0+aHcuYWN0aXZl
KTsKIAogCQlJOTE1X1NUQVRFX1dBUk4oYWN0aXZlICYmIGNydGMtPnBpcGUgIT0gcGlwZSwKIAkJ
CQkiRW5jb2RlciBjb25uZWN0ZWQgdG8gd3JvbmcgcGlwZSAlY1xuIiwKQEAgLTEzNTE1LDcgKzEz
NTE4LDcgQEAgdmVyaWZ5X2NydGNfc3RhdGUoc3RydWN0IGludGVsX2NydGMgKmNydGMsCiAKIAlp
bnRlbF9jcnRjX2NvbXB1dGVfcGl4ZWxfcmF0ZShwaXBlX2NvbmZpZyk7CiAKLQlpZiAoIW5ld19j
cnRjX3N0YXRlLT5iYXNlLmFjdGl2ZSkKKwlpZiAoIW5ld19jcnRjX3N0YXRlLT5ody5hY3RpdmUp
CiAJCXJldHVybjsKIAogCWludGVsX3BpcGVfY29uZmlnX3Nhbml0eV9jaGVjayhkZXZfcHJpdiwg
cGlwZV9jb25maWcpOwpAQCAtMTM1NzcsNyArMTM1ODAsNyBAQCB2ZXJpZnlfc2luZ2xlX2RwbGxf
c3RhdGUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAogCiAJY3J0Y19tYXNrID0g
ZHJtX2NydGNfbWFzaygmY3J0Yy0+YmFzZSk7CiAKLQlpZiAobmV3X2NydGNfc3RhdGUtPmJhc2Uu
YWN0aXZlKQorCWlmIChuZXdfY3J0Y19zdGF0ZS0+aHcuYWN0aXZlKQogCQlJOTE1X1NUQVRFX1dB
Uk4oIShwbGwtPmFjdGl2ZV9tYXNrICYgY3J0Y19tYXNrKSwKIAkJCQkicGxsIGFjdGl2ZSBtaXNt
YXRjaCAoZXhwZWN0ZWQgcGlwZSAlYyBpbiBhY3RpdmUgbWFzayAweCUwMngpXG4iLAogCQkJCXBp
cGVfbmFtZShkcm1fY3J0Y19pbmRleCgmY3J0Yy0+YmFzZSkpLCBwbGwtPmFjdGl2ZV9tYXNrKTsK
QEAgLTEzNjU5LDcgKzEzNjYyLDcgQEAgaW50ZWxfY3J0Y191cGRhdGVfYWN0aXZlX3RpbWluZ3Mo
Y29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUpCiAJc3RydWN0IGludGVs
X2NydGMgKmNydGMgPSB0b19pbnRlbF9jcnRjKGNydGNfc3RhdGUtPmJhc2UuY3J0Yyk7CiAJc3Ry
dWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShjcnRjLT5iYXNlLmRldik7
CiAJY29uc3Qgc3RydWN0IGRybV9kaXNwbGF5X21vZGUgKmFkanVzdGVkX21vZGUgPQotCQkmY3J0
Y19zdGF0ZS0+YmFzZS5hZGp1c3RlZF9tb2RlOworCQkmY3J0Y19zdGF0ZS0+aHcuYWRqdXN0ZWRf
bW9kZTsKIAogCWRybV9jYWxjX3RpbWVzdGFtcGluZ19jb25zdGFudHMoJmNydGMtPmJhc2UsIGFk
anVzdGVkX21vZGUpOwogCkBAIC0xMzc0MSw3ICsxMzc0NCw3IEBAIHN0YXRpYyBpbnQgaGFzd2Vs
bF9tb2RlX3NldF9wbGFuZXNfd29ya2Fyb3VuZChzdHJ1Y3QgaW50ZWxfYXRvbWljX3N0YXRlICpz
dGF0ZSkKIAogCS8qIGxvb2sgYXQgYWxsIGNydGMncyB0aGF0IGFyZSBnb2luZyB0byBiZSBlbmFi
bGVkIGluIGR1cmluZyBtb2Rlc2V0ICovCiAJZm9yX2VhY2hfbmV3X2ludGVsX2NydGNfaW5fc3Rh
dGUoc3RhdGUsIGNydGMsIGNydGNfc3RhdGUsIGkpIHsKLQkJaWYgKCFjcnRjX3N0YXRlLT5iYXNl
LmFjdGl2ZSB8fAorCQlpZiAoIWNydGNfc3RhdGUtPmh3LmFjdGl2ZSB8fAogCQkgICAgIW5lZWRz
X21vZGVzZXQoY3J0Y19zdGF0ZSkpCiAJCQljb250aW51ZTsKIApAQCAtMTM3NjYsNyArMTM3Njks
NyBAQCBzdGF0aWMgaW50IGhhc3dlbGxfbW9kZV9zZXRfcGxhbmVzX3dvcmthcm91bmQoc3RydWN0
IGludGVsX2F0b21pY19zdGF0ZSAqc3RhdGUpCiAKIAkJY3J0Y19zdGF0ZS0+aHN3X3dvcmthcm91
bmRfcGlwZSA9IElOVkFMSURfUElQRTsKIAotCQlpZiAoIWNydGNfc3RhdGUtPmJhc2UuYWN0aXZl
IHx8CisJCWlmICghY3J0Y19zdGF0ZS0+aHcuYWN0aXZlIHx8CiAJCSAgICBuZWVkc19tb2Rlc2V0
KGNydGNfc3RhdGUpKQogCQkJY29udGludWU7CiAKQEAgLTEzODAzLDEyICsxMzgwNiwxMiBAQCBz
dGF0aWMgaW50IGludGVsX21vZGVzZXRfY2hlY2tzKHN0cnVjdCBpbnRlbF9hdG9taWNfc3RhdGUg
KnN0YXRlKQogCiAJZm9yX2VhY2hfb2xkbmV3X2ludGVsX2NydGNfaW5fc3RhdGUoc3RhdGUsIGNy
dGMsIG9sZF9jcnRjX3N0YXRlLAogCQkJCQkgICAgbmV3X2NydGNfc3RhdGUsIGkpIHsKLQkJaWYg
KG5ld19jcnRjX3N0YXRlLT5iYXNlLmFjdGl2ZSkKKwkJaWYgKG5ld19jcnRjX3N0YXRlLT5ody5h
Y3RpdmUpCiAJCQlzdGF0ZS0+YWN0aXZlX3BpcGVzIHw9IEJJVChjcnRjLT5waXBlKTsKIAkJZWxz
ZQogCQkJc3RhdGUtPmFjdGl2ZV9waXBlcyAmPSB+QklUKGNydGMtPnBpcGUpOwogCi0JCWlmIChv
bGRfY3J0Y19zdGF0ZS0+YmFzZS5hY3RpdmUgIT0gbmV3X2NydGNfc3RhdGUtPmJhc2UuYWN0aXZl
KQorCQlpZiAob2xkX2NydGNfc3RhdGUtPmh3LmFjdGl2ZSAhPSBuZXdfY3J0Y19zdGF0ZS0+aHcu
YWN0aXZlKQogCQkJc3RhdGUtPmFjdGl2ZV9waXBlX2NoYW5nZXMgfD0gQklUKGNydGMtPnBpcGUp
OwogCX0KIApAQCAtMTM5OTYsOCArMTM5OTksOCBAQCBzdGF0aWMgaW50IGludGVsX2F0b21pY19j
aGVjayhzdHJ1Y3QgZHJtX2RldmljZSAqZGV2LAogCS8qIENhdGNoIEk5MTVfTU9ERV9GTEFHX0lO
SEVSSVRFRCAqLwogCWZvcl9lYWNoX29sZG5ld19pbnRlbF9jcnRjX2luX3N0YXRlKHN0YXRlLCBj
cnRjLCBvbGRfY3J0Y19zdGF0ZSwKIAkJCQkJICAgIG5ld19jcnRjX3N0YXRlLCBpKSB7Ci0JCWlm
IChuZXdfY3J0Y19zdGF0ZS0+YmFzZS5tb2RlLnByaXZhdGVfZmxhZ3MgIT0KLQkJICAgIG9sZF9j
cnRjX3N0YXRlLT5iYXNlLm1vZGUucHJpdmF0ZV9mbGFncykKKwkJaWYgKG5ld19jcnRjX3N0YXRl
LT5ody5tb2RlLnByaXZhdGVfZmxhZ3MgIT0KKwkJICAgIG9sZF9jcnRjX3N0YXRlLT5ody5tb2Rl
LnByaXZhdGVfZmxhZ3MpCiAJCQluZXdfY3J0Y19zdGF0ZS0+YmFzZS5tb2RlX2NoYW5nZWQgPSB0
cnVlOwogCX0KIApAQCAtMTQxMzAsNyArMTQxMzMsNyBAQCBzdGF0aWMgdm9pZCBpbnRlbF9waXBl
X2Zhc3RzZXQoY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKm9sZF9jcnRjX3N0YXRlLAog
CXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoY3J0Yy0+YmFzZS5k
ZXYpOwogCiAJLyogZHJtX2F0b21pY19oZWxwZXJfdXBkYXRlX2xlZ2FjeV9tb2Rlc2V0X3N0YXRl
IG1pZ2h0IG5vdCBiZSBjYWxsZWQuICovCi0JY3J0Yy0+YmFzZS5tb2RlID0gbmV3X2NydGNfc3Rh
dGUtPmJhc2UubW9kZTsKKwljcnRjLT5iYXNlLm1vZGUgPSBuZXdfY3J0Y19zdGF0ZS0+aHcubW9k
ZTsKIAogCS8qCiAJICogVXBkYXRlIHBpcGUgc2l6ZSBhbmQgYWRqdXN0IGZpdHRlciBpZiBuZWVk
ZWQ6IHRoZSByZWFzb24gZm9yIHRoaXMgaXMKQEAgLTE0MjM5LDcgKzE0MjQyLDcgQEAgc3RhdGlj
IHZvaWQgaW50ZWxfdXBkYXRlX2NydGMoc3RydWN0IGludGVsX2NydGMgKmNydGMsCiAJICogb2Yg
ZW5hYmxpbmcgdGhlbSBvbiB0aGUgQ1JUQydzIGZpcnN0IGZhc3RzZXQuCiAJICovCiAJaWYgKG5l
d19jcnRjX3N0YXRlLT51cGRhdGVfcGlwZSAmJiAhbW9kZXNldCAmJgotCSAgICBvbGRfY3J0Y19z
dGF0ZS0+YmFzZS5tb2RlLnByaXZhdGVfZmxhZ3MgJiBJOTE1X01PREVfRkxBR19JTkhFUklURUQp
CisJICAgIG9sZF9jcnRjX3N0YXRlLT5ody5tb2RlLnByaXZhdGVfZmxhZ3MgJiBJOTE1X01PREVf
RkxBR19JTkhFUklURUQpCiAJCWludGVsX2NydGNfYXJtX2ZpZm9fdW5kZXJydW4oY3J0YywgbmV3
X2NydGNfc3RhdGUpOwogfQogCkBAIC0xNDI4Myw3ICsxNDI4Niw3IEBAIHN0YXRpYyB2b2lkIGlu
dGVsX29sZF9jcnRjX3N0YXRlX2Rpc2FibGVzKHN0cnVjdCBpbnRlbF9hdG9taWNfc3RhdGUgKnN0
YXRlLAogCWludGVsX2NoZWNrX3BjaF9maWZvX3VuZGVycnVucyhkZXZfcHJpdik7CiAKIAkvKiBG
SVhNRSB1bmlmeSB0aGlzIGZvciBhbGwgcGxhdGZvcm1zICovCi0JaWYgKCFuZXdfY3J0Y19zdGF0
ZS0+YmFzZS5hY3RpdmUgJiYKKwlpZiAoIW5ld19jcnRjX3N0YXRlLT5ody5hY3RpdmUgJiYKIAkg
ICAgIUhBU19HTUNIKGRldl9wcml2KSAmJgogCSAgICBkZXZfcHJpdi0+ZGlzcGxheS5pbml0aWFs
X3dhdGVybWFya3MpCiAJCWRldl9wcml2LT5kaXNwbGF5LmluaXRpYWxfd2F0ZXJtYXJrcyhzdGF0
ZSwKQEAgLTE0MzA2LDcgKzE0MzA5LDcgQEAgc3RhdGljIHZvaWQgaW50ZWxfdHJhbnNfcG9ydF9z
eW5jX21vZGVzZXRfZGlzYWJsZXMoc3RydWN0IGludGVsX2F0b21pY19zdGF0ZSAqc3QKIAogCS8q
IERpc2FibGUgU2xhdmUgZmlyc3QgKi8KIAlpbnRlbF9wcmVfcGxhbmVfdXBkYXRlKG9sZF9zbGF2
ZV9jcnRjX3N0YXRlLCBuZXdfc2xhdmVfY3J0Y19zdGF0ZSk7Ci0JaWYgKG9sZF9zbGF2ZV9jcnRj
X3N0YXRlLT5iYXNlLmFjdGl2ZSkKKwlpZiAob2xkX3NsYXZlX2NydGNfc3RhdGUtPmh3LmFjdGl2
ZSkKIAkJaW50ZWxfb2xkX2NydGNfc3RhdGVfZGlzYWJsZXMoc3RhdGUsCiAJCQkJCSAgICAgIG9s
ZF9zbGF2ZV9jcnRjX3N0YXRlLAogCQkJCQkgICAgICBuZXdfc2xhdmVfY3J0Y19zdGF0ZSwKQEAg
LTE0MzE0LDcgKzE0MzE3LDcgQEAgc3RhdGljIHZvaWQgaW50ZWxfdHJhbnNfcG9ydF9zeW5jX21v
ZGVzZXRfZGlzYWJsZXMoc3RydWN0IGludGVsX2F0b21pY19zdGF0ZSAqc3QKIAogCS8qIERpc2Fi
bGUgTWFzdGVyICovCiAJaW50ZWxfcHJlX3BsYW5lX3VwZGF0ZShvbGRfY3J0Y19zdGF0ZSwgbmV3
X2NydGNfc3RhdGUpOwotCWlmIChvbGRfY3J0Y19zdGF0ZS0+YmFzZS5hY3RpdmUpCisJaWYgKG9s
ZF9jcnRjX3N0YXRlLT5ody5hY3RpdmUpCiAJCWludGVsX29sZF9jcnRjX3N0YXRlX2Rpc2FibGVz
KHN0YXRlLAogCQkJCQkgICAgICBvbGRfY3J0Y19zdGF0ZSwKIAkJCQkJICAgICAgbmV3X2NydGNf
c3RhdGUsCkBAIC0xNDM1NSw3ICsxNDM1OCw3IEBAIHN0YXRpYyB2b2lkIGludGVsX2NvbW1pdF9t
b2Rlc2V0X2Rpc2FibGVzKHN0cnVjdCBpbnRlbF9hdG9taWNfc3RhdGUgKnN0YXRlKQogCQl9IGVs
c2UgewogCQkJaW50ZWxfcHJlX3BsYW5lX3VwZGF0ZShvbGRfY3J0Y19zdGF0ZSwgbmV3X2NydGNf
c3RhdGUpOwogCi0JCQlpZiAob2xkX2NydGNfc3RhdGUtPmJhc2UuYWN0aXZlKQorCQkJaWYgKG9s
ZF9jcnRjX3N0YXRlLT5ody5hY3RpdmUpCiAJCQkJaW50ZWxfb2xkX2NydGNfc3RhdGVfZGlzYWJs
ZXMoc3RhdGUsCiAJCQkJCQkJICAgICAgb2xkX2NydGNfc3RhdGUsCiAJCQkJCQkJICAgICAgbmV3
X2NydGNfc3RhdGUsCkBAIC0xNDM3MSw3ICsxNDM3NCw3IEBAIHN0YXRpYyB2b2lkIGludGVsX2Nv
bW1pdF9tb2Rlc2V0X2VuYWJsZXMoc3RydWN0IGludGVsX2F0b21pY19zdGF0ZSAqc3RhdGUpCiAJ
aW50IGk7CiAKIAlmb3JfZWFjaF9vbGRuZXdfaW50ZWxfY3J0Y19pbl9zdGF0ZShzdGF0ZSwgY3J0
Yywgb2xkX2NydGNfc3RhdGUsIG5ld19jcnRjX3N0YXRlLCBpKSB7Ci0JCWlmICghbmV3X2NydGNf
c3RhdGUtPmJhc2UuYWN0aXZlKQorCQlpZiAoIW5ld19jcnRjX3N0YXRlLT5ody5hY3RpdmUpCiAJ
CQljb250aW51ZTsKIAogCQlpbnRlbF91cGRhdGVfY3J0YyhjcnRjLCBzdGF0ZSwgb2xkX2NydGNf
c3RhdGUsCkBAIC0xNDQzNiw3ICsxNDQzOSw3IEBAIHN0YXRpYyB2b2lkIGludGVsX3Bvc3RfY3J0
Y19lbmFibGVfdXBkYXRlcyhzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YywKIAkgKiBvZiBlbmFibGlu
ZyB0aGVtIG9uIHRoZSBDUlRDJ3MgZmlyc3QgZmFzdHNldC4KIAkgKi8KIAlpZiAobmV3X2NydGNf
c3RhdGUtPnVwZGF0ZV9waXBlICYmICFtb2Rlc2V0ICYmCi0JICAgIG9sZF9jcnRjX3N0YXRlLT5i
YXNlLm1vZGUucHJpdmF0ZV9mbGFncyAmIEk5MTVfTU9ERV9GTEFHX0lOSEVSSVRFRCkKKwkgICAg
b2xkX2NydGNfc3RhdGUtPmh3Lm1vZGUucHJpdmF0ZV9mbGFncyAmIEk5MTVfTU9ERV9GTEFHX0lO
SEVSSVRFRCkKIAkJaW50ZWxfY3J0Y19hcm1fZmlmb191bmRlcnJ1bihjcnRjLCBuZXdfY3J0Y19z
dGF0ZSk7CiB9CiAKQEAgLTE0NTAwLDcgKzE0NTAzLDcgQEAgc3RhdGljIHZvaWQgc2tsX2NvbW1p
dF9tb2Rlc2V0X2VuYWJsZXMoc3RydWN0IGludGVsX2F0b21pY19zdGF0ZSAqc3RhdGUpCiAKIAlm
b3JfZWFjaF9vbGRuZXdfaW50ZWxfY3J0Y19pbl9zdGF0ZShzdGF0ZSwgY3J0Yywgb2xkX2NydGNf
c3RhdGUsIG5ld19jcnRjX3N0YXRlLCBpKQogCQkvKiBpZ25vcmUgYWxsb2NhdGlvbnMgZm9yIGNy
dGMncyB0aGF0IGhhdmUgYmVlbiB0dXJuZWQgb2ZmLiAqLwotCQlpZiAobmV3X2NydGNfc3RhdGUt
PmJhc2UuYWN0aXZlKQorCQlpZiAobmV3X2NydGNfc3RhdGUtPmh3LmFjdGl2ZSkKIAkJCWVudHJp
ZXNbaV0gPSBvbGRfY3J0Y19zdGF0ZS0+d20uc2tsLmRkYjsKIAogCS8qIElmIDJuZCBEQnVmIHNs
aWNlIHJlcXVpcmVkLCBlbmFibGUgaXQgaGVyZSAqLwpAQCAtMTQ1MjEsNyArMTQ1MjQsNyBAQCBz
dGF0aWMgdm9pZCBza2xfY29tbWl0X21vZGVzZXRfZW5hYmxlcyhzdHJ1Y3QgaW50ZWxfYXRvbWlj
X3N0YXRlICpzdGF0ZSkKIAkJCWJvb2wgdmJsX3dhaXQgPSBmYWxzZTsKIAkJCWJvb2wgbW9kZXNl
dCA9IG5lZWRzX21vZGVzZXQobmV3X2NydGNfc3RhdGUpOwogCi0JCQlpZiAodXBkYXRlZCAmIEJJ
VChjcnRjLT5waXBlKSB8fCAhbmV3X2NydGNfc3RhdGUtPmJhc2UuYWN0aXZlKQorCQkJaWYgKHVw
ZGF0ZWQgJiBCSVQoY3J0Yy0+cGlwZSkgfHwgIW5ld19jcnRjX3N0YXRlLT5ody5hY3RpdmUpCiAJ
CQkJY29udGludWU7CiAKIAkJCWlmIChza2xfZGRiX2FsbG9jYXRpb25fb3ZlcmxhcHMoJm5ld19j
cnRjX3N0YXRlLT53bS5za2wuZGRiLApAQCAtMTQ2ODMsNyArMTQ2ODYsNyBAQCBzdGF0aWMgdm9p
ZCBpbnRlbF9hdG9taWNfY29tbWl0X3RhaWwoc3RydWN0IGludGVsX2F0b21pY19zdGF0ZSAqc3Rh
dGUpCiAJCWJvb2wgbW9kZXNldCA9IG5lZWRzX21vZGVzZXQobmV3X2NydGNfc3RhdGUpOwogCiAJ
CS8qIENvbXBsZXRlIGV2ZW50cyBmb3Igbm93IGRpc2FibGUgcGlwZXMgaGVyZS4gKi8KLQkJaWYg
KG1vZGVzZXQgJiYgIW5ld19jcnRjX3N0YXRlLT5iYXNlLmFjdGl2ZSAmJiBuZXdfY3J0Y19zdGF0
ZS0+YmFzZS5ldmVudCkgeworCQlpZiAobW9kZXNldCAmJiAhbmV3X2NydGNfc3RhdGUtPmh3LmFj
dGl2ZSAmJiBuZXdfY3J0Y19zdGF0ZS0+YmFzZS5ldmVudCkgewogCQkJc3Bpbl9sb2NrX2lycSgm
ZGV2LT5ldmVudF9sb2NrKTsKIAkJCWRybV9jcnRjX3NlbmRfdmJsYW5rX2V2ZW50KCZjcnRjLT5i
YXNlLCBuZXdfY3J0Y19zdGF0ZS0+YmFzZS5ldmVudCk7CiAJCQlzcGluX3VubG9ja19pcnEoJmRl
di0+ZXZlbnRfbG9jayk7CkBAIC0xNDcxOSw3ICsxNDcyMiw3IEBAIHN0YXRpYyB2b2lkIGludGVs
X2F0b21pY19jb21taXRfdGFpbChzdHJ1Y3QgaW50ZWxfYXRvbWljX3N0YXRlICpzdGF0ZSkKIAlk
cm1fYXRvbWljX2hlbHBlcl93YWl0X2Zvcl9mbGlwX2RvbmUoZGV2LCAmc3RhdGUtPmJhc2UpOwog
CiAJZm9yX2VhY2hfbmV3X2ludGVsX2NydGNfaW5fc3RhdGUoc3RhdGUsIGNydGMsIG5ld19jcnRj
X3N0YXRlLCBpKSB7Ci0JCWlmIChuZXdfY3J0Y19zdGF0ZS0+YmFzZS5hY3RpdmUgJiYKKwkJaWYg
KG5ld19jcnRjX3N0YXRlLT5ody5hY3RpdmUgJiYKIAkJICAgICFuZWVkc19tb2Rlc2V0KG5ld19j
cnRjX3N0YXRlKSAmJgogCQkgICAgKG5ld19jcnRjX3N0YXRlLT5iYXNlLmNvbG9yX21nbXRfY2hh
bmdlZCB8fAogCQkgICAgIG5ld19jcnRjX3N0YXRlLT51cGRhdGVfcGlwZSkpCkBAIC0xNTI4Niw3
ICsxNTI4OSw3IEBAIGludGVsX2xlZ2FjeV9jdXJzb3JfdXBkYXRlKHN0cnVjdCBkcm1fcGxhbmUg
Kl9wbGFuZSwKIAkgKiBXaGVuIGNydGMgaXMgaW5hY3RpdmUgb3IgdGhlcmUgaXMgYSBtb2Rlc2V0
IHBlbmRpbmcsCiAJICogd2FpdCBmb3IgaXQgdG8gY29tcGxldGUgaW4gdGhlIHNsb3dwYXRoCiAJ
ICovCi0JaWYgKCFjcnRjX3N0YXRlLT5iYXNlLmFjdGl2ZSB8fCBuZWVkc19tb2Rlc2V0KGNydGNf
c3RhdGUpIHx8CisJaWYgKCFjcnRjX3N0YXRlLT5ody5hY3RpdmUgfHwgbmVlZHNfbW9kZXNldChj
cnRjX3N0YXRlKSB8fAogCSAgICBjcnRjX3N0YXRlLT51cGRhdGVfcGlwZSkKIAkJZ290byBzbG93
OwogCkBAIC0xNjc0Myw3ICsxNjc0Niw3IEBAIHN0YXRpYyBpbnQgaW50ZWxfaW5pdGlhbF9jb21t
aXQoc3RydWN0IGRybV9kZXZpY2UgKmRldikKIAkJCWdvdG8gb3V0OwogCQl9CiAKLQkJaWYgKGNy
dGNfc3RhdGUtPmJhc2UuYWN0aXZlKSB7CisJCWlmIChjcnRjX3N0YXRlLT5ody5hY3RpdmUpIHsK
IAkJCXJldCA9IGRybV9hdG9taWNfYWRkX2FmZmVjdGVkX3BsYW5lcyhzdGF0ZSwgJmNydGMtPmJh
c2UpOwogCQkJaWYgKHJldCkKIAkJCQlnb3RvIG91dDsKQEAgLTE3MDkzLDcgKzE3MDk2LDcgQEAg
c3RhdGljIHZvaWQgaW50ZWxfc2FuaXRpemVfY3J0YyhzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YywK
IAkJCSAgIEk5MTVfUkVBRChyZWcpICYgflBJUEVDT05GX0ZSQU1FX1NUQVJUX0RFTEFZX01BU0sp
OwogCX0KIAotCWlmIChjcnRjX3N0YXRlLT5iYXNlLmFjdGl2ZSkgeworCWlmIChjcnRjX3N0YXRl
LT5ody5hY3RpdmUpIHsKIAkJc3RydWN0IGludGVsX3BsYW5lICpwbGFuZTsKIAogCQkvKiBEaXNh
YmxlIGV2ZXJ5dGhpbmcgYnV0IHRoZSBwcmltYXJ5IHBsYW5lICovCkBAIC0xNzExOCwxMCArMTcx
MjEsMTAgQEAgc3RhdGljIHZvaWQgaW50ZWxfc2FuaXRpemVfY3J0YyhzdHJ1Y3QgaW50ZWxfY3J0
YyAqY3J0YywKIAogCS8qIEFkanVzdCB0aGUgc3RhdGUgb2YgdGhlIG91dHB1dCBwaXBlIGFjY29y
ZGluZyB0byB3aGV0aGVyIHdlCiAJICogaGF2ZSBhY3RpdmUgY29ubmVjdG9ycy9lbmNvZGVycy4g
Ki8KLQlpZiAoY3J0Y19zdGF0ZS0+YmFzZS5hY3RpdmUgJiYgIWludGVsX2NydGNfaGFzX2VuY29k
ZXJzKGNydGMpKQorCWlmIChjcnRjX3N0YXRlLT5ody5hY3RpdmUgJiYgIWludGVsX2NydGNfaGFz
X2VuY29kZXJzKGNydGMpKQogCQlpbnRlbF9jcnRjX2Rpc2FibGVfbm9hdG9taWMoJmNydGMtPmJh
c2UsIGN0eCk7CiAKLQlpZiAoY3J0Y19zdGF0ZS0+YmFzZS5hY3RpdmUgfHwgSEFTX0dNQ0goZGV2
X3ByaXYpKSB7CisJaWYgKGNydGNfc3RhdGUtPmh3LmFjdGl2ZSB8fCBIQVNfR01DSChkZXZfcHJp
dikpIHsKIAkJLyoKIAkJICogV2Ugc3RhcnQgb3V0IHdpdGggdW5kZXJydW4gcmVwb3J0aW5nIGRp
c2FibGVkIHRvIGF2b2lkIHJhY2VzLgogCQkgKiBGb3IgY29ycmVjdCBib29ra2VlcGluZyBtYXJr
IHRoaXMgb24gYWN0aXZlIGNydGNzLgpAQCAtMTcxNjUsNyArMTcxNjgsNyBAQCBzdGF0aWMgYm9v
bCBoYXNfYm9ndXNfZHBsbF9jb25maWcoY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNy
dGNfc3RhdGUpCiAJICogcm9hZC4KIAkgKi8KIAlyZXR1cm4gSVNfR0VOKGRldl9wcml2LCA2KSAm
JgotCQljcnRjX3N0YXRlLT5iYXNlLmFjdGl2ZSAmJgorCQljcnRjX3N0YXRlLT5ody5hY3RpdmUg
JiYKIAkJY3J0Y19zdGF0ZS0+c2hhcmVkX2RwbGwgJiYKIAkJY3J0Y19zdGF0ZS0+cG9ydF9jbG9j
ayA9PSAwOwogfQpAQCAtMTcxODIsNyArMTcxODUsNyBAQCBzdGF0aWMgdm9pZCBpbnRlbF9zYW5p
dGl6ZV9lbmNvZGVyKHN0cnVjdCBpbnRlbF9lbmNvZGVyICplbmNvZGVyKQogCSAqIGVuY29kZXIg
aXMgYWN0aXZlIGFuZCB0cnlpbmcgdG8gcmVhZCBmcm9tIGEgcGlwZSkgYW5kIHRoZQogCSAqIHBp
cGUgaXRzZWxmIGJlaW5nIGFjdGl2ZS4gKi8KIAlib29sIGhhc19hY3RpdmVfY3J0YyA9IGNydGNf
c3RhdGUgJiYKLQkJY3J0Y19zdGF0ZS0+YmFzZS5hY3RpdmU7CisJCWNydGNfc3RhdGUtPmh3LmFj
dGl2ZTsKIAogCWlmIChjcnRjX3N0YXRlICYmIGhhc19ib2d1c19kcGxsX2NvbmZpZyhjcnRjX3N0
YXRlKSkgewogCQlEUk1fREVCVUdfS01TKCJCSU9TIGhhcyBtaXNwcm9ncmFtbWVkIHRoZSBoYXJk
d2FyZS4gRGlzYWJsaW5nIHBpcGUgJWNcbiIsCkBAIC0xNzI5MCwxOCArMTcyOTMsMTggQEAgc3Rh
dGljIHZvaWQgaW50ZWxfbW9kZXNldF9yZWFkb3V0X2h3X3N0YXRlKHN0cnVjdCBkcm1fZGV2aWNl
ICpkZXYpCiAJCW1lbXNldChjcnRjX3N0YXRlLCAwLCBzaXplb2YoKmNydGNfc3RhdGUpKTsKIAkJ
X19kcm1fYXRvbWljX2hlbHBlcl9jcnRjX3Jlc2V0KCZjcnRjLT5iYXNlLCAmY3J0Y19zdGF0ZS0+
YmFzZSk7CiAKLQkJY3J0Y19zdGF0ZS0+YmFzZS5hY3RpdmUgPSBjcnRjX3N0YXRlLT5iYXNlLmVu
YWJsZSA9CisJCWNydGNfc3RhdGUtPmh3LmFjdGl2ZSA9IGNydGNfc3RhdGUtPmh3LmVuYWJsZSA9
CiAJCQlkZXZfcHJpdi0+ZGlzcGxheS5nZXRfcGlwZV9jb25maWcoY3J0YywgY3J0Y19zdGF0ZSk7
CiAKLQkJY3J0Yy0+YmFzZS5lbmFibGVkID0gY3J0Y19zdGF0ZS0+YmFzZS5lbmFibGU7Ci0JCWNy
dGMtPmFjdGl2ZSA9IGNydGNfc3RhdGUtPmJhc2UuYWN0aXZlOworCQljcnRjLT5iYXNlLmVuYWJs
ZWQgPSBjcnRjX3N0YXRlLT5ody5lbmFibGU7CisJCWNydGMtPmFjdGl2ZSA9IGNydGNfc3RhdGUt
Pmh3LmFjdGl2ZTsKIAotCQlpZiAoY3J0Y19zdGF0ZS0+YmFzZS5hY3RpdmUpCisJCWlmIChjcnRj
X3N0YXRlLT5ody5hY3RpdmUpCiAJCQlkZXZfcHJpdi0+YWN0aXZlX3BpcGVzIHw9IEJJVChjcnRj
LT5waXBlKTsKIAogCQlEUk1fREVCVUdfS01TKCJbQ1JUQzolZDolc10gaHcgc3RhdGUgcmVhZG91
dDogJXNcbiIsCiAJCQkgICAgICBjcnRjLT5iYXNlLmJhc2UuaWQsIGNydGMtPmJhc2UubmFtZSwK
LQkJCSAgICAgIGVuYWJsZWRkaXNhYmxlZChjcnRjX3N0YXRlLT5iYXNlLmFjdGl2ZSkpOworCQkJ
ICAgICAgZW5hYmxlZGRpc2FibGVkKGNydGNfc3RhdGUtPmh3LmFjdGl2ZSkpOwogCX0KIAogCXJl
YWRvdXRfcGxhbmVfc3RhdGUoZGV2X3ByaXYpOwpAQCAtMTczMjMsNyArMTczMjYsNyBAQCBzdGF0
aWMgdm9pZCBpbnRlbF9tb2Rlc2V0X3JlYWRvdXRfaHdfc3RhdGUoc3RydWN0IGRybV9kZXZpY2Ug
KmRldikKIAkJCXN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlID0KIAkJCQl0b19p
bnRlbF9jcnRjX3N0YXRlKGNydGMtPmJhc2Uuc3RhdGUpOwogCi0JCQlpZiAoY3J0Y19zdGF0ZS0+
YmFzZS5hY3RpdmUgJiYKKwkJCWlmIChjcnRjX3N0YXRlLT5ody5hY3RpdmUgJiYKIAkJCSAgICBj
cnRjX3N0YXRlLT5zaGFyZWRfZHBsbCA9PSBwbGwpCiAJCQkJcGxsLT5zdGF0ZS5jcnRjX21hc2sg
fD0gMSA8PCBjcnRjLT5waXBlOwogCQl9CkBAIC0xNzM2OCw3ICsxNzM3MSw3IEBAIHN0YXRpYyB2
b2lkIGludGVsX21vZGVzZXRfcmVhZG91dF9od19zdGF0ZShzdHJ1Y3QgZHJtX2RldmljZSAqZGV2
KQogCQkJY3J0YyA9IHRvX2ludGVsX2NydGMoZW5jb2Rlci0+YmFzZS5jcnRjKTsKIAkJCWNydGNf
c3RhdGUgPSBjcnRjID8gdG9faW50ZWxfY3J0Y19zdGF0ZShjcnRjLT5iYXNlLnN0YXRlKSA6IE5V
TEw7CiAKLQkJCWlmIChjcnRjX3N0YXRlICYmIGNydGNfc3RhdGUtPmJhc2UuYWN0aXZlKSB7CisJ
CQlpZiAoY3J0Y19zdGF0ZSAmJiBjcnRjX3N0YXRlLT5ody5hY3RpdmUpIHsKIAkJCQkvKgogCQkJ
CSAqIFRoaXMgaGFzIHRvIGJlIGRvbmUgZHVyaW5nIGhhcmR3YXJlIHJlYWRvdXQKIAkJCQkgKiBi
ZWNhdXNlIGFueXRoaW5nIGNhbGxpbmcgLmNydGNfZGlzYWJsZSBtYXkKQEAgLTE3Mzk4LDExICsx
NzQwMSwxMiBAQCBzdGF0aWMgdm9pZCBpbnRlbF9tb2Rlc2V0X3JlYWRvdXRfaHdfc3RhdGUoc3Ry
dWN0IGRybV9kZXZpY2UgKmRldikKIAkJaW50IG1pbl9jZGNsayA9IDA7CiAKIAkJbWVtc2V0KCZj
cnRjLT5iYXNlLm1vZGUsIDAsIHNpemVvZihjcnRjLT5iYXNlLm1vZGUpKTsKLQkJaWYgKGNydGNf
c3RhdGUtPmJhc2UuYWN0aXZlKSB7CisJCWlmIChjcnRjX3N0YXRlLT5ody5hY3RpdmUpIHsKIAkJ
CWludGVsX21vZGVfZnJvbV9waXBlX2NvbmZpZygmY3J0Yy0+YmFzZS5tb2RlLCBjcnRjX3N0YXRl
KTsKIAkJCWNydGMtPmJhc2UubW9kZS5oZGlzcGxheSA9IGNydGNfc3RhdGUtPnBpcGVfc3JjX3c7
CiAJCQljcnRjLT5iYXNlLm1vZGUudmRpc3BsYXkgPSBjcnRjX3N0YXRlLT5waXBlX3NyY19oOwot
CQkJaW50ZWxfbW9kZV9mcm9tX3BpcGVfY29uZmlnKCZjcnRjX3N0YXRlLT5iYXNlLmFkanVzdGVk
X21vZGUsIGNydGNfc3RhdGUpOworCQkJaW50ZWxfbW9kZV9mcm9tX3BpcGVfY29uZmlnKCZjcnRj
X3N0YXRlLT5ody5hZGp1c3RlZF9tb2RlLAorCQkJCQkJICAgIGNydGNfc3RhdGUpOwogCQkJV0FS
Tl9PTihkcm1fYXRvbWljX3NldF9tb2RlX2Zvcl9jcnRjKCZjcnRjX3N0YXRlLT5iYXNlLCAmY3J0
Yy0+YmFzZS5tb2RlKSk7CiAKIAkJCS8qCkBAIC0xNzQxNCw3ICsxNzQxOCw3IEBAIHN0YXRpYyB2
b2lkIGludGVsX21vZGVzZXRfcmVhZG91dF9od19zdGF0ZShzdHJ1Y3QgZHJtX2RldmljZSAqZGV2
KQogCQkJICogc2V0IGEgZmxhZyB0byBpbmRpY2F0ZSB0aGF0IGEgZnVsbCByZWNhbGN1bGF0aW9u
IGlzCiAJCQkgKiBuZWVkZWQgb24gdGhlIG5leHQgY29tbWl0LgogCQkJICovCi0JCQljcnRjX3N0
YXRlLT5iYXNlLm1vZGUucHJpdmF0ZV9mbGFncyA9IEk5MTVfTU9ERV9GTEFHX0lOSEVSSVRFRDsK
KwkJCWNydGNfc3RhdGUtPmh3Lm1vZGUucHJpdmF0ZV9mbGFncyA9IEk5MTVfTU9ERV9GTEFHX0lO
SEVSSVRFRDsKIAogCQkJaW50ZWxfY3J0Y19jb21wdXRlX3BpeGVsX3JhdGUoY3J0Y19zdGF0ZSk7
CiAKQEAgLTE3NDUwLDcgKzE3NDU0LDcgQEAgc3RhdGljIHZvaWQgaW50ZWxfbW9kZXNldF9yZWFk
b3V0X2h3X3N0YXRlKHN0cnVjdCBkcm1fZGV2aWNlICpkZXYpCiAJCQkJICAgICAgY3J0Y19zdGF0
ZS0+bWluX2NkY2xrW3BsYW5lLT5pZF0pOwogCQl9CiAKLQkJaWYgKGNydGNfc3RhdGUtPmJhc2Uu
YWN0aXZlKSB7CisJCWlmIChjcnRjX3N0YXRlLT5ody5hY3RpdmUpIHsKIAkJCW1pbl9jZGNsayA9
IGludGVsX2NydGNfY29tcHV0ZV9taW5fY2RjbGsoY3J0Y19zdGF0ZSk7CiAJCQlpZiAoV0FSTl9P
TihtaW5fY2RjbGsgPCAwKSkKIAkJCQltaW5fY2RjbGsgPSAwOwpAQCAtMTc2MTAsNyArMTc2MTQs
NyBAQCBpbnRlbF9tb2Rlc2V0X3NldHVwX2h3X3N0YXRlKHN0cnVjdCBkcm1fZGV2aWNlICpkZXYs
CiAKIAkJZHJtX2NydGNfdmJsYW5rX3Jlc2V0KCZjcnRjLT5iYXNlKTsKIAotCQlpZiAoY3J0Y19z
dGF0ZS0+YmFzZS5hY3RpdmUpCisJCWlmIChjcnRjX3N0YXRlLT5ody5hY3RpdmUpCiAJCQlpbnRl
bF9jcnRjX3ZibGFua19vbihjcnRjX3N0YXRlKTsKIAl9CiAKZGlmZiAtLWdpdCBhL2RyaXZlcnMv
Z3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZHAuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rp
c3BsYXkvaW50ZWxfZHAuYwppbmRleCA4Njk4OWVjMjViYzYuLjJkNDU2NTJhYWRiOCAxMDA2NDQK
LS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kcC5jCisrKyBiL2RyaXZl
cnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZHAuYwpAQCAtMTk5MCw3ICsxOTkwLDcgQEAg
aW50ZWxfZHBfY29tcHV0ZV9saW5rX2NvbmZpZ193aWRlKHN0cnVjdCBpbnRlbF9kcCAqaW50ZWxf
ZHAsCiAJCQkJICBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqcGlwZV9jb25maWcsCiAJCQkJICBj
b25zdCBzdHJ1Y3QgbGlua19jb25maWdfbGltaXRzICpsaW1pdHMpCiB7Ci0Jc3RydWN0IGRybV9k
aXNwbGF5X21vZGUgKmFkanVzdGVkX21vZGUgPSAmcGlwZV9jb25maWctPmJhc2UuYWRqdXN0ZWRf
bW9kZTsKKwlzdHJ1Y3QgZHJtX2Rpc3BsYXlfbW9kZSAqYWRqdXN0ZWRfbW9kZSA9ICZwaXBlX2Nv
bmZpZy0+aHcuYWRqdXN0ZWRfbW9kZTsKIAlpbnQgYnBwLCBjbG9jaywgbGFuZV9jb3VudDsKIAlp
bnQgbW9kZV9yYXRlLCBsaW5rX2Nsb2NrLCBsaW5rX2F2YWlsOwogCkBAIC0yMDQ0LDcgKzIwNDQs
NyBAQCBzdGF0aWMgaW50IGludGVsX2RwX2RzY19jb21wdXRlX2NvbmZpZyhzdHJ1Y3QgaW50ZWxf
ZHAgKmludGVsX2RwLAogewogCXN0cnVjdCBpbnRlbF9kaWdpdGFsX3BvcnQgKmRpZ19wb3J0ID0g
ZHBfdG9fZGlnX3BvcnQoaW50ZWxfZHApOwogCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZf
cHJpdiA9IHRvX2k5MTUoZGlnX3BvcnQtPmJhc2UuYmFzZS5kZXYpOwotCXN0cnVjdCBkcm1fZGlz
cGxheV9tb2RlICphZGp1c3RlZF9tb2RlID0gJnBpcGVfY29uZmlnLT5iYXNlLmFkanVzdGVkX21v
ZGU7CisJc3RydWN0IGRybV9kaXNwbGF5X21vZGUgKmFkanVzdGVkX21vZGUgPSAmcGlwZV9jb25m
aWctPmh3LmFkanVzdGVkX21vZGU7CiAJdTggZHNjX21heF9icGM7CiAJaW50IHBpcGVfYnBwOwog
CWludCByZXQ7CkBAIC0yMTU1LDcgKzIxNTUsNyBAQCBpbnRlbF9kcF9jb21wdXRlX2xpbmtfY29u
ZmlnKHN0cnVjdCBpbnRlbF9lbmNvZGVyICplbmNvZGVyLAogCQkJICAgICBzdHJ1Y3QgaW50ZWxf
Y3J0Y19zdGF0ZSAqcGlwZV9jb25maWcsCiAJCQkgICAgIHN0cnVjdCBkcm1fY29ubmVjdG9yX3N0
YXRlICpjb25uX3N0YXRlKQogewotCXN0cnVjdCBkcm1fZGlzcGxheV9tb2RlICphZGp1c3RlZF9t
b2RlID0gJnBpcGVfY29uZmlnLT5iYXNlLmFkanVzdGVkX21vZGU7CisJc3RydWN0IGRybV9kaXNw
bGF5X21vZGUgKmFkanVzdGVkX21vZGUgPSAmcGlwZV9jb25maWctPmh3LmFkanVzdGVkX21vZGU7
CiAJc3RydWN0IGludGVsX2RwICppbnRlbF9kcCA9IGVuY190b19pbnRlbF9kcCgmZW5jb2Rlci0+
YmFzZSk7CiAJc3RydWN0IGxpbmtfY29uZmlnX2xpbWl0cyBsaW1pdHM7CiAJaW50IGNvbW1vbl9s
ZW47CkBAIC0yMjQzLDcgKzIyNDMsNyBAQCBpbnRlbF9kcF95Y2JjcjQyMF9jb25maWcoc3RydWN0
IGludGVsX2RwICppbnRlbF9kcCwKIHsKIAljb25zdCBzdHJ1Y3QgZHJtX2Rpc3BsYXlfaW5mbyAq
aW5mbyA9ICZjb25uZWN0b3ItPmRpc3BsYXlfaW5mbzsKIAljb25zdCBzdHJ1Y3QgZHJtX2Rpc3Bs
YXlfbW9kZSAqYWRqdXN0ZWRfbW9kZSA9Ci0JCSZjcnRjX3N0YXRlLT5iYXNlLmFkanVzdGVkX21v
ZGU7CisJCSZjcnRjX3N0YXRlLT5ody5hZGp1c3RlZF9tb2RlOwogCXN0cnVjdCBpbnRlbF9jcnRj
ICpjcnRjID0gdG9faW50ZWxfY3J0YyhjcnRjX3N0YXRlLT5iYXNlLmNydGMpOwogCWludCByZXQ7
CiAKQEAgLTIyNzIsNyArMjI3Miw3IEBAIGJvb2wgaW50ZWxfZHBfbGltaXRlZF9jb2xvcl9yYW5n
ZShjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSwKIAljb25zdCBzdHJ1
Y3QgaW50ZWxfZGlnaXRhbF9jb25uZWN0b3Jfc3RhdGUgKmludGVsX2Nvbm5fc3RhdGUgPQogCQl0
b19pbnRlbF9kaWdpdGFsX2Nvbm5lY3Rvcl9zdGF0ZShjb25uX3N0YXRlKTsKIAljb25zdCBzdHJ1
Y3QgZHJtX2Rpc3BsYXlfbW9kZSAqYWRqdXN0ZWRfbW9kZSA9Ci0JCSZjcnRjX3N0YXRlLT5iYXNl
LmFkanVzdGVkX21vZGU7CisJCSZjcnRjX3N0YXRlLT5ody5hZGp1c3RlZF9tb2RlOwogCiAJLyoK
IAkgKiBPdXIgWUNiQ3Igb3V0cHV0IGlzIGFsd2F5cyBsaW1pdGVkIHJhbmdlLgpAQCAtMjMwNSw3
ICsyMzA1LDcgQEAgaW50ZWxfZHBfY29tcHV0ZV9jb25maWcoc3RydWN0IGludGVsX2VuY29kZXIg
KmVuY29kZXIsCiAJCQlzdHJ1Y3QgZHJtX2Nvbm5lY3Rvcl9zdGF0ZSAqY29ubl9zdGF0ZSkKIHsK
IAlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGVuY29kZXItPmJh
c2UuZGV2KTsKLQlzdHJ1Y3QgZHJtX2Rpc3BsYXlfbW9kZSAqYWRqdXN0ZWRfbW9kZSA9ICZwaXBl
X2NvbmZpZy0+YmFzZS5hZGp1c3RlZF9tb2RlOworCXN0cnVjdCBkcm1fZGlzcGxheV9tb2RlICph
ZGp1c3RlZF9tb2RlID0gJnBpcGVfY29uZmlnLT5ody5hZGp1c3RlZF9tb2RlOwogCXN0cnVjdCBp
bnRlbF9kcCAqaW50ZWxfZHAgPSBlbmNfdG9faW50ZWxfZHAoJmVuY29kZXItPmJhc2UpOwogCXN0
cnVjdCBpbnRlbF9sc3Bjb24gKmxzcGNvbiA9IGVuY190b19pbnRlbF9sc3Bjb24oJmVuY29kZXIt
PmJhc2UpOwogCWVudW0gcG9ydCBwb3J0ID0gZW5jb2Rlci0+cG9ydDsKQEAgLTI0MjgsNyArMjQy
OCw3IEBAIHN0YXRpYyB2b2lkIGludGVsX2RwX3ByZXBhcmUoc3RydWN0IGludGVsX2VuY29kZXIg
KmVuY29kZXIsCiAJc3RydWN0IGludGVsX2RwICppbnRlbF9kcCA9IGVuY190b19pbnRlbF9kcCgm
ZW5jb2Rlci0+YmFzZSk7CiAJZW51bSBwb3J0IHBvcnQgPSBlbmNvZGVyLT5wb3J0OwogCXN0cnVj
dCBpbnRlbF9jcnRjICpjcnRjID0gdG9faW50ZWxfY3J0YyhwaXBlX2NvbmZpZy0+YmFzZS5jcnRj
KTsKLQljb25zdCBzdHJ1Y3QgZHJtX2Rpc3BsYXlfbW9kZSAqYWRqdXN0ZWRfbW9kZSA9ICZwaXBl
X2NvbmZpZy0+YmFzZS5hZGp1c3RlZF9tb2RlOworCWNvbnN0IHN0cnVjdCBkcm1fZGlzcGxheV9t
b2RlICphZGp1c3RlZF9tb2RlID0gJnBpcGVfY29uZmlnLT5ody5hZGp1c3RlZF9tb2RlOwogCiAJ
aW50ZWxfZHBfc2V0X2xpbmtfcGFyYW1zKGludGVsX2RwLCBwaXBlX2NvbmZpZy0+cG9ydF9jbG9j
aywKIAkJCQkgcGlwZV9jb25maWctPmxhbmVfY291bnQsCkBAIC0zMjYwLDcgKzMyNjAsNyBAQCBz
dGF0aWMgdm9pZCBpbnRlbF9kcF9nZXRfY29uZmlnKHN0cnVjdCBpbnRlbF9lbmNvZGVyICplbmNv
ZGVyLAogCQkJZmxhZ3MgfD0gRFJNX01PREVfRkxBR19OVlNZTkM7CiAJfQogCi0JcGlwZV9jb25m
aWctPmJhc2UuYWRqdXN0ZWRfbW9kZS5mbGFncyB8PSBmbGFnczsKKwlwaXBlX2NvbmZpZy0+aHcu
YWRqdXN0ZWRfbW9kZS5mbGFncyB8PSBmbGFnczsKIAogCWlmIChJU19HNFgoZGV2X3ByaXYpICYm
IHRtcCAmIERQX0NPTE9SX1JBTkdFXzE2XzIzNSkKIAkJcGlwZV9jb25maWctPmxpbWl0ZWRfY29s
b3JfcmFuZ2UgPSB0cnVlOwpAQCAtMzI3Nyw3ICszMjc3LDcgQEAgc3RhdGljIHZvaWQgaW50ZWxf
ZHBfZ2V0X2NvbmZpZyhzdHJ1Y3QgaW50ZWxfZW5jb2RlciAqZW5jb2RlciwKIAkJCXBpcGVfY29u
ZmlnLT5wb3J0X2Nsb2NrID0gMjcwMDAwOwogCX0KIAotCXBpcGVfY29uZmlnLT5iYXNlLmFkanVz
dGVkX21vZGUuY3J0Y19jbG9jayA9CisJcGlwZV9jb25maWctPmh3LmFkanVzdGVkX21vZGUuY3J0
Y19jbG9jayA9CiAJCWludGVsX2RvdGNsb2NrX2NhbGN1bGF0ZShwaXBlX2NvbmZpZy0+cG9ydF9j
bG9jaywKIAkJCQkJICZwaXBlX2NvbmZpZy0+ZHBfbV9uKTsKIApAQCAtNTA3MCw3ICs1MDcwLDcg
QEAgaW50IGludGVsX2RwX3JldHJhaW5fbGluayhzdHJ1Y3QgaW50ZWxfZW5jb2RlciAqZW5jb2Rl
ciwKIAogCVdBUk5fT04oIWludGVsX2NydGNfaGFzX2RwX2VuY29kZXIoY3J0Y19zdGF0ZSkpOwog
Ci0JaWYgKCFjcnRjX3N0YXRlLT5iYXNlLmFjdGl2ZSkKKwlpZiAoIWNydGNfc3RhdGUtPmh3LmFj
dGl2ZSkKIAkJcmV0dXJuIDA7CiAKIAlpZiAoY29ubl9zdGF0ZS0+Y29tbWl0ICYmCkBAIC02OTMy
LDcgKzY5MzIsNyBAQCBzdGF0aWMgdm9pZCBpbnRlbF9kcF9zZXRfZHJyc19zdGF0ZShzdHJ1Y3Qg
ZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCiAJCXJldHVybjsKIAl9CiAKLQlpZiAoIWNydGNf
c3RhdGUtPmJhc2UuYWN0aXZlKSB7CisJaWYgKCFjcnRjX3N0YXRlLT5ody5hY3RpdmUpIHsKIAkJ
RFJNX0RFQlVHX0tNUygiZURQIGVuY29kZXIgZGlzYWJsZWQuIENSVEMgbm90IEFjdGl2ZVxuIik7
CiAJCXJldHVybjsKIAl9CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5
L2ludGVsX2RwX21zdC5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kcF9t
c3QuYwppbmRleCA0MmQyNjIxNGZiMjMuLjMwNzAyOTIwODc1ZiAxMDA2NDQKLS0tIGEvZHJpdmVy
cy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kcF9tc3QuYworKysgYi9kcml2ZXJzL2dwdS9k
cm0vaTkxNS9kaXNwbGF5L2ludGVsX2RwX21zdC5jCkBAIC00OCw3ICs0OCw3IEBAIHN0YXRpYyBp
bnQgaW50ZWxfZHBfbXN0X2NvbXB1dGVfbGlua19jb25maWcoc3RydWN0IGludGVsX2VuY29kZXIg
KmVuY29kZXIsCiAJc3RydWN0IGludGVsX2Nvbm5lY3RvciAqY29ubmVjdG9yID0KIAkJdG9faW50
ZWxfY29ubmVjdG9yKGNvbm5fc3RhdGUtPmNvbm5lY3Rvcik7CiAJY29uc3Qgc3RydWN0IGRybV9k
aXNwbGF5X21vZGUgKmFkanVzdGVkX21vZGUgPQotCQkmY3J0Y19zdGF0ZS0+YmFzZS5hZGp1c3Rl
ZF9tb2RlOworCQkmY3J0Y19zdGF0ZS0+aHcuYWRqdXN0ZWRfbW9kZTsKIAl2b2lkICpwb3J0ID0g
Y29ubmVjdG9yLT5wb3J0OwogCWJvb2wgY29uc3RhbnRfbiA9IGRybV9kcF9oYXNfcXVpcmsoJmlu
dGVsX2RwLT5kZXNjLAogCQkJCQkgICBEUF9EUENEX1FVSVJLX0NPTlNUQU5UX04pOwpAQCAtOTks
NyArOTksNyBAQCBzdGF0aWMgaW50IGludGVsX2RwX21zdF9jb21wdXRlX2NvbmZpZyhzdHJ1Y3Qg
aW50ZWxfZW5jb2RlciAqZW5jb2RlciwKIAlzdHJ1Y3QgaW50ZWxfZGlnaXRhbF9jb25uZWN0b3Jf
c3RhdGUgKmludGVsX2Nvbm5fc3RhdGUgPQogCQl0b19pbnRlbF9kaWdpdGFsX2Nvbm5lY3Rvcl9z
dGF0ZShjb25uX3N0YXRlKTsKIAljb25zdCBzdHJ1Y3QgZHJtX2Rpc3BsYXlfbW9kZSAqYWRqdXN0
ZWRfbW9kZSA9Ci0JCSZwaXBlX2NvbmZpZy0+YmFzZS5hZGp1c3RlZF9tb2RlOworCQkmcGlwZV9j
b25maWctPmh3LmFkanVzdGVkX21vZGU7CiAJdm9pZCAqcG9ydCA9IGNvbm5lY3Rvci0+cG9ydDsK
IAlzdHJ1Y3QgbGlua19jb25maWdfbGltaXRzIGxpbWl0czsKIAlpbnQgcmV0OwpAQCAtMTkxLDcg
KzE5MSw3IEBAIGludGVsX2RwX21zdF9hdG9taWNfY2hlY2soc3RydWN0IGRybV9jb25uZWN0b3Ig
KmNvbm5lY3RvciwKIAogCQlpZiAoIWNydGNfc3RhdGUgfHwKIAkJICAgICFkcm1fYXRvbWljX2Ny
dGNfbmVlZHNfbW9kZXNldCgmY3J0Y19zdGF0ZS0+YmFzZSkgfHwKLQkJICAgIGNydGNfc3RhdGUt
PmJhc2UuZW5hYmxlKQorCQkgICAgY3J0Y19zdGF0ZS0+aHcuZW5hYmxlKQogCQkJcmV0dXJuIDA7
CiAJfQogCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2R2
by5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kdm8uYwppbmRleCA5ODI3
Zjk5NDkxZDEuLmE2OGU1YzViOTFiNCAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUv
ZGlzcGxheS9pbnRlbF9kdm8uYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2lu
dGVsX2R2by5jCkBAIC0xNzgsOSArMTc4LDkgQEAgc3RhdGljIHZvaWQgaW50ZWxfZHZvX2dldF9j
b25maWcoc3RydWN0IGludGVsX2VuY29kZXIgKmVuY29kZXIsCiAJZWxzZQogCQlmbGFncyB8PSBE
Uk1fTU9ERV9GTEFHX05WU1lOQzsKIAotCXBpcGVfY29uZmlnLT5iYXNlLmFkanVzdGVkX21vZGUu
ZmxhZ3MgfD0gZmxhZ3M7CisJcGlwZV9jb25maWctPmh3LmFkanVzdGVkX21vZGUuZmxhZ3MgfD0g
ZmxhZ3M7CiAKLQlwaXBlX2NvbmZpZy0+YmFzZS5hZGp1c3RlZF9tb2RlLmNydGNfY2xvY2sgPSBw
aXBlX2NvbmZpZy0+cG9ydF9jbG9jazsKKwlwaXBlX2NvbmZpZy0+aHcuYWRqdXN0ZWRfbW9kZS5j
cnRjX2Nsb2NrID0gcGlwZV9jb25maWctPnBvcnRfY2xvY2s7CiB9CiAKIHN0YXRpYyB2b2lkIGlu
dGVsX2Rpc2FibGVfZHZvKHN0cnVjdCBpbnRlbF9lbmNvZGVyICplbmNvZGVyLApAQCAtMjA3LDgg
KzIwNyw4IEBAIHN0YXRpYyB2b2lkIGludGVsX2VuYWJsZV9kdm8oc3RydWN0IGludGVsX2VuY29k
ZXIgKmVuY29kZXIsCiAJdTMyIHRlbXAgPSBJOTE1X1JFQUQoZHZvX3JlZyk7CiAKIAlpbnRlbF9k
dm8tPmRldi5kZXZfb3BzLT5tb2RlX3NldCgmaW50ZWxfZHZvLT5kZXYsCi0JCQkJCSAmcGlwZV9j
b25maWctPmJhc2UubW9kZSwKLQkJCQkJICZwaXBlX2NvbmZpZy0+YmFzZS5hZGp1c3RlZF9tb2Rl
KTsKKwkJCQkJICZwaXBlX2NvbmZpZy0+aHcubW9kZSwKKwkJCQkJICZwaXBlX2NvbmZpZy0+aHcu
YWRqdXN0ZWRfbW9kZSk7CiAKIAlJOTE1X1dSSVRFKGR2b19yZWcsIHRlbXAgfCBEVk9fRU5BQkxF
KTsKIAlJOTE1X1JFQUQoZHZvX3JlZyk7CkBAIC0yNTMsNyArMjUzLDcgQEAgc3RhdGljIGludCBp
bnRlbF9kdm9fY29tcHV0ZV9jb25maWcoc3RydWN0IGludGVsX2VuY29kZXIgKmVuY29kZXIsCiAJ
c3RydWN0IGludGVsX2R2byAqaW50ZWxfZHZvID0gZW5jX3RvX2R2byhlbmNvZGVyKTsKIAljb25z
dCBzdHJ1Y3QgZHJtX2Rpc3BsYXlfbW9kZSAqZml4ZWRfbW9kZSA9CiAJCWludGVsX2R2by0+YXR0
YWNoZWRfY29ubmVjdG9yLT5wYW5lbC5maXhlZF9tb2RlOwotCXN0cnVjdCBkcm1fZGlzcGxheV9t
b2RlICphZGp1c3RlZF9tb2RlID0gJnBpcGVfY29uZmlnLT5iYXNlLmFkanVzdGVkX21vZGU7CisJ
c3RydWN0IGRybV9kaXNwbGF5X21vZGUgKmFkanVzdGVkX21vZGUgPSAmcGlwZV9jb25maWctPmh3
LmFkanVzdGVkX21vZGU7CiAKIAkvKgogCSAqIElmIHdlIGhhdmUgdGltaW5ncyBmcm9tIHRoZSBC
SU9TIGZvciB0aGUgcGFuZWwsIHB1dCB0aGVtIGluCkBAIC0yNzgsNyArMjc4LDcgQEAgc3RhdGlj
IHZvaWQgaW50ZWxfZHZvX3ByZV9lbmFibGUoc3RydWN0IGludGVsX2VuY29kZXIgKmVuY29kZXIs
CiB7CiAJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShlbmNvZGVy
LT5iYXNlLmRldik7CiAJc3RydWN0IGludGVsX2NydGMgKmNydGMgPSB0b19pbnRlbF9jcnRjKHBp
cGVfY29uZmlnLT5iYXNlLmNydGMpOwotCWNvbnN0IHN0cnVjdCBkcm1fZGlzcGxheV9tb2RlICph
ZGp1c3RlZF9tb2RlID0gJnBpcGVfY29uZmlnLT5iYXNlLmFkanVzdGVkX21vZGU7CisJY29uc3Qg
c3RydWN0IGRybV9kaXNwbGF5X21vZGUgKmFkanVzdGVkX21vZGUgPSAmcGlwZV9jb25maWctPmh3
LmFkanVzdGVkX21vZGU7CiAJc3RydWN0IGludGVsX2R2byAqaW50ZWxfZHZvID0gZW5jX3RvX2R2
byhlbmNvZGVyKTsKIAllbnVtIHBpcGUgcGlwZSA9IGNydGMtPnBpcGU7CiAJdTMyIGR2b192YWw7
CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2ZiYy5jIGIv
ZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9mYmMuYwppbmRleCAzMTExZWNhZWFi
ZDAuLmM2Y2MzNzc1ZjNiOCAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxh
eS9pbnRlbF9mYmMuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2Zi
Yy5jCkBAIC02NjcsNyArNjY3LDcgQEAgc3RhdGljIHZvaWQgaW50ZWxfZmJjX3VwZGF0ZV9zdGF0
ZV9jYWNoZShzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YywKIAljYWNoZS0+dm1hID0gTlVMTDsKIAlj
YWNoZS0+ZmxhZ3MgPSAwOwogCi0JY2FjaGUtPmNydGMubW9kZV9mbGFncyA9IGNydGNfc3RhdGUt
PmJhc2UuYWRqdXN0ZWRfbW9kZS5mbGFnczsKKwljYWNoZS0+Y3J0Yy5tb2RlX2ZsYWdzID0gY3J0
Y19zdGF0ZS0+aHcuYWRqdXN0ZWRfbW9kZS5mbGFnczsKIAlpZiAoSVNfSEFTV0VMTChkZXZfcHJp
dikgfHwgSVNfQlJPQURXRUxMKGRldl9wcml2KSkKIAkJY2FjaGUtPmNydGMuaHN3X2Jkd19waXhl
bF9yYXRlID0gY3J0Y19zdGF0ZS0+cGl4ZWxfcmF0ZTsKIApkaWZmIC0tZ2l0IGEvZHJpdmVycy9n
cHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9oZG1pLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9k
aXNwbGF5L2ludGVsX2hkbWkuYwppbmRleCBiNTRjY2JiNWFhZDUuLjI1YjQ0NTZiZmQ2MCAxMDA2
NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9oZG1pLmMKKysrIGIv
ZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9oZG1pLmMKQEAgLTcwOCw3ICs3MDgs
NyBAQCBpbnRlbF9oZG1pX2NvbXB1dGVfYXZpX2luZm9mcmFtZShzdHJ1Y3QgaW50ZWxfZW5jb2Rl
ciAqZW5jb2RlciwKIHsKIAlzdHJ1Y3QgaGRtaV9hdmlfaW5mb2ZyYW1lICpmcmFtZSA9ICZjcnRj
X3N0YXRlLT5pbmZvZnJhbWVzLmF2aS5hdmk7CiAJY29uc3Qgc3RydWN0IGRybV9kaXNwbGF5X21v
ZGUgKmFkanVzdGVkX21vZGUgPQotCQkmY3J0Y19zdGF0ZS0+YmFzZS5hZGp1c3RlZF9tb2RlOwor
CQkmY3J0Y19zdGF0ZS0+aHcuYWRqdXN0ZWRfbW9kZTsKIAlzdHJ1Y3QgZHJtX2Nvbm5lY3RvciAq
Y29ubmVjdG9yID0gY29ubl9zdGF0ZS0+Y29ubmVjdG9yOwogCWludCByZXQ7CiAKQEAgLTgwNCw3
ICs4MDQsNyBAQCBpbnRlbF9oZG1pX2NvbXB1dGVfaGRtaV9pbmZvZnJhbWUoc3RydWN0IGludGVs
X2VuY29kZXIgKmVuY29kZXIsCiAKIAlyZXQgPSBkcm1faGRtaV92ZW5kb3JfaW5mb2ZyYW1lX2Zy
b21fZGlzcGxheV9tb2RlKGZyYW1lLAogCQkJCQkJCSAgY29ubl9zdGF0ZS0+Y29ubmVjdG9yLAot
CQkJCQkJCSAgJmNydGNfc3RhdGUtPmJhc2UuYWRqdXN0ZWRfbW9kZSk7CisJCQkJCQkJICAmY3J0
Y19zdGF0ZS0+aHcuYWRqdXN0ZWRfbW9kZSk7CiAJaWYgKFdBUk5fT04ocmV0KSkKIAkJcmV0dXJu
IGZhbHNlOwogCkBAIC0xMDI3LDcgKzEwMjcsNyBAQCBzdGF0aWMgdm9pZCBpbnRlbF9oZG1pX2Nv
bXB1dGVfZ2NwX2luZm9mcmFtZShzdHJ1Y3QgaW50ZWxfZW5jb2RlciAqZW5jb2RlciwKIAogCS8q
IEVuYWJsZSBkZWZhdWx0X3BoYXNlIHdoZW5ldmVyIHRoZSBkaXNwbGF5IG1vZGUgaXMgc3VpdGFi
bHkgYWxpZ25lZCAqLwogCWlmIChnY3BfZGVmYXVsdF9waGFzZV9wb3NzaWJsZShjcnRjX3N0YXRl
LT5waXBlX2JwcCwKLQkJCQkgICAgICAgJmNydGNfc3RhdGUtPmJhc2UuYWRqdXN0ZWRfbW9kZSkp
CisJCQkJICAgICAgICZjcnRjX3N0YXRlLT5ody5hZGp1c3RlZF9tb2RlKSkKIAkJY3J0Y19zdGF0
ZS0+aW5mb2ZyYW1lcy5nY3AgfD0gR0NQX0RFRkFVTFRfUEhBU0VfRU5BQkxFOwogfQogCkBAIC0x
NzM4LDcgKzE3MzgsNyBAQCBzdGF0aWMgdm9pZCBpbnRlbF9oZG1pX3ByZXBhcmUoc3RydWN0IGlu
dGVsX2VuY29kZXIgKmVuY29kZXIsCiAJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2
ID0gdG9faTkxNShkZXYpOwogCXN0cnVjdCBpbnRlbF9jcnRjICpjcnRjID0gdG9faW50ZWxfY3J0
YyhjcnRjX3N0YXRlLT5iYXNlLmNydGMpOwogCXN0cnVjdCBpbnRlbF9oZG1pICppbnRlbF9oZG1p
ID0gZW5jX3RvX2ludGVsX2hkbWkoJmVuY29kZXItPmJhc2UpOwotCWNvbnN0IHN0cnVjdCBkcm1f
ZGlzcGxheV9tb2RlICphZGp1c3RlZF9tb2RlID0gJmNydGNfc3RhdGUtPmJhc2UuYWRqdXN0ZWRf
bW9kZTsKKwljb25zdCBzdHJ1Y3QgZHJtX2Rpc3BsYXlfbW9kZSAqYWRqdXN0ZWRfbW9kZSA9ICZj
cnRjX3N0YXRlLT5ody5hZGp1c3RlZF9tb2RlOwogCXUzMiBoZG1pX3ZhbDsKIAogCWludGVsX2Rw
X2R1YWxfbW9kZV9zZXRfdG1kc19vdXRwdXQoaW50ZWxfaGRtaSwgdHJ1ZSk7CkBAIC0xODI5LDcg
KzE4MjksNyBAQCBzdGF0aWMgdm9pZCBpbnRlbF9oZG1pX2dldF9jb25maWcoc3RydWN0IGludGVs
X2VuY29kZXIgKmVuY29kZXIsCiAJICAgIHRtcCAmIEhETUlfQ09MT1JfUkFOR0VfMTZfMjM1KQog
CQlwaXBlX2NvbmZpZy0+bGltaXRlZF9jb2xvcl9yYW5nZSA9IHRydWU7CiAKLQlwaXBlX2NvbmZp
Zy0+YmFzZS5hZGp1c3RlZF9tb2RlLmZsYWdzIHw9IGZsYWdzOworCXBpcGVfY29uZmlnLT5ody5h
ZGp1c3RlZF9tb2RlLmZsYWdzIHw9IGZsYWdzOwogCiAJaWYgKCh0bXAgJiBTRFZPX0NPTE9SX0ZP
Uk1BVF9NQVNLKSA9PSBIRE1JX0NPTE9SX0ZPUk1BVF8xMmJwYykKIAkJZG90Y2xvY2sgPSBwaXBl
X2NvbmZpZy0+cG9ydF9jbG9jayAqIDIgLyAzOwpAQCAtMTgzOSw3ICsxODM5LDcgQEAgc3RhdGlj
IHZvaWQgaW50ZWxfaGRtaV9nZXRfY29uZmlnKHN0cnVjdCBpbnRlbF9lbmNvZGVyICplbmNvZGVy
LAogCWlmIChwaXBlX2NvbmZpZy0+cGl4ZWxfbXVsdGlwbGllcikKIAkJZG90Y2xvY2sgLz0gcGlw
ZV9jb25maWctPnBpeGVsX211bHRpcGxpZXI7CiAKLQlwaXBlX2NvbmZpZy0+YmFzZS5hZGp1c3Rl
ZF9tb2RlLmNydGNfY2xvY2sgPSBkb3RjbG9jazsKKwlwaXBlX2NvbmZpZy0+aHcuYWRqdXN0ZWRf
bW9kZS5jcnRjX2Nsb2NrID0gZG90Y2xvY2s7CiAKIAlwaXBlX2NvbmZpZy0+bGFuZV9jb3VudCA9
IDQ7CiAKQEAgLTIyMTUsNyArMjIxNSw3IEBAIHN0YXRpYyBib29sIGhkbWlfZGVlcF9jb2xvcl9w
b3NzaWJsZShjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSwKIAlzdHJ1
Y3QgZHJtX2Nvbm5lY3Rvcl9zdGF0ZSAqY29ubmVjdG9yX3N0YXRlOwogCXN0cnVjdCBkcm1fY29u
bmVjdG9yICpjb25uZWN0b3I7CiAJY29uc3Qgc3RydWN0IGRybV9kaXNwbGF5X21vZGUgKmFkanVz
dGVkX21vZGUgPQotCQkmY3J0Y19zdGF0ZS0+YmFzZS5hZGp1c3RlZF9tb2RlOworCQkmY3J0Y19z
dGF0ZS0+aHcuYWRqdXN0ZWRfbW9kZTsKIAlpbnQgaTsKIAogCWlmIChIQVNfR01DSChkZXZfcHJp
dikpCkBAIC0yMzM2LDcgKzIzMzYsNyBAQCBzdGF0aWMgaW50IGludGVsX2hkbWlfY29tcHV0ZV9j
bG9jayhzdHJ1Y3QgaW50ZWxfZW5jb2RlciAqZW5jb2RlciwKIHsKIAlzdHJ1Y3QgaW50ZWxfaGRt
aSAqaW50ZWxfaGRtaSA9IGVuY190b19pbnRlbF9oZG1pKCZlbmNvZGVyLT5iYXNlKTsKIAljb25z
dCBzdHJ1Y3QgZHJtX2Rpc3BsYXlfbW9kZSAqYWRqdXN0ZWRfbW9kZSA9Ci0JCSZjcnRjX3N0YXRl
LT5iYXNlLmFkanVzdGVkX21vZGU7CisJCSZjcnRjX3N0YXRlLT5ody5hZGp1c3RlZF9tb2RlOwog
CWludCBicGMsIGNsb2NrID0gYWRqdXN0ZWRfbW9kZS0+Y3J0Y19jbG9jazsKIAogCWlmIChhZGp1
c3RlZF9tb2RlLT5mbGFncyAmIERSTV9NT0RFX0ZMQUdfREJMQ0xLKQpAQCAtMjM3OCw3ICsyMzc4
LDcgQEAgc3RhdGljIGJvb2wgaW50ZWxfaGRtaV9saW1pdGVkX2NvbG9yX3JhbmdlKGNvbnN0IHN0
cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3MKIAljb25zdCBzdHJ1Y3QgaW50ZWxfZGlnaXRh
bF9jb25uZWN0b3Jfc3RhdGUgKmludGVsX2Nvbm5fc3RhdGUgPQogCQl0b19pbnRlbF9kaWdpdGFs
X2Nvbm5lY3Rvcl9zdGF0ZShjb25uX3N0YXRlKTsKIAljb25zdCBzdHJ1Y3QgZHJtX2Rpc3BsYXlf
bW9kZSAqYWRqdXN0ZWRfbW9kZSA9Ci0JCSZjcnRjX3N0YXRlLT5iYXNlLmFkanVzdGVkX21vZGU7
CisJCSZjcnRjX3N0YXRlLT5ody5hZGp1c3RlZF9tb2RlOwogCiAJLyoKIAkgKiBPdXIgWUNiQ3Ig
b3V0cHV0IGlzIGFsd2F5cyBsaW1pdGVkIHJhbmdlLgpAQCAtMjQwNiw3ICsyNDA2LDcgQEAgaW50
IGludGVsX2hkbWlfY29tcHV0ZV9jb25maWcoc3RydWN0IGludGVsX2VuY29kZXIgKmVuY29kZXIs
CiB7CiAJc3RydWN0IGludGVsX2hkbWkgKmludGVsX2hkbWkgPSBlbmNfdG9faW50ZWxfaGRtaSgm
ZW5jb2Rlci0+YmFzZSk7CiAJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9f
aTkxNShlbmNvZGVyLT5iYXNlLmRldik7Ci0Jc3RydWN0IGRybV9kaXNwbGF5X21vZGUgKmFkanVz
dGVkX21vZGUgPSAmcGlwZV9jb25maWctPmJhc2UuYWRqdXN0ZWRfbW9kZTsKKwlzdHJ1Y3QgZHJt
X2Rpc3BsYXlfbW9kZSAqYWRqdXN0ZWRfbW9kZSA9ICZwaXBlX2NvbmZpZy0+aHcuYWRqdXN0ZWRf
bW9kZTsKIAlzdHJ1Y3QgZHJtX2Nvbm5lY3RvciAqY29ubmVjdG9yID0gY29ubl9zdGF0ZS0+Y29u
bmVjdG9yOwogCXN0cnVjdCBkcm1fc2NkYyAqc2NkYyA9ICZjb25uZWN0b3ItPmRpc3BsYXlfaW5m
by5oZG1pLnNjZGM7CiAJc3RydWN0IGludGVsX2RpZ2l0YWxfY29ubmVjdG9yX3N0YXRlICppbnRl
bF9jb25uX3N0YXRlID0KZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkv
aW50ZWxfbHNwY29uLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2xzcGNv
bi5jCmluZGV4IGY4ZjEzMDg2NDNhOS4uNTE0NWZmOGI5NjJiIDEwMDY0NAotLS0gYS9kcml2ZXJz
L2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2xzcGNvbi5jCisrKyBiL2RyaXZlcnMvZ3B1L2Ry
bS9pOTE1L2Rpc3BsYXkvaW50ZWxfbHNwY29uLmMKQEAgLTE4OSw3ICsxODksNyBAQCB2b2lkIGxz
cGNvbl95Y2JjcjQyMF9jb25maWcoc3RydWN0IGRybV9jb25uZWN0b3IgKmNvbm5lY3RvciwKIHsK
IAljb25zdCBzdHJ1Y3QgZHJtX2Rpc3BsYXlfaW5mbyAqaW5mbyA9ICZjb25uZWN0b3ItPmRpc3Bs
YXlfaW5mbzsKIAljb25zdCBzdHJ1Y3QgZHJtX2Rpc3BsYXlfbW9kZSAqYWRqdXN0ZWRfbW9kZSA9
Ci0JCQkJCSZjcnRjX3N0YXRlLT5iYXNlLmFkanVzdGVkX21vZGU7CisJCQkJCSZjcnRjX3N0YXRl
LT5ody5hZGp1c3RlZF9tb2RlOwogCiAJaWYgKGRybV9tb2RlX2lzXzQyMF9vbmx5KGluZm8sIGFk
anVzdGVkX21vZGUpICYmCiAJICAgIGNvbm5lY3Rvci0+eWNiY3JfNDIwX2FsbG93ZWQpIHsKQEAg
LTQ3NSw3ICs0NzUsNyBAQCB2b2lkIGxzcGNvbl9zZXRfaW5mb2ZyYW1lcyhzdHJ1Y3QgaW50ZWxf
ZW5jb2RlciAqZW5jb2RlciwKIAlzdHJ1Y3QgaW50ZWxfZGlnaXRhbF9wb3J0ICpkaWdfcG9ydCA9
IGVuY190b19kaWdfcG9ydCgmZW5jb2Rlci0+YmFzZSk7CiAJc3RydWN0IGludGVsX2xzcGNvbiAq
bHNwY29uID0gJmRpZ19wb3J0LT5sc3Bjb247CiAJY29uc3Qgc3RydWN0IGRybV9kaXNwbGF5X21v
ZGUgKmFkanVzdGVkX21vZGUgPQotCQkmY3J0Y19zdGF0ZS0+YmFzZS5hZGp1c3RlZF9tb2RlOwor
CQkmY3J0Y19zdGF0ZS0+aHcuYWRqdXN0ZWRfbW9kZTsKIAogCWlmICghbHNwY29uLT5hY3RpdmUp
IHsKIAkJRFJNX0VSUk9SKCJXcml0aW5nIGluZm9mcmFtZXMgd2hpbGUgTFNQQ09OIGRpc2FibGVk
ID9cbiIpOwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9s
dmRzLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2x2ZHMuYwppbmRleCAx
Mzg0MWQ3YzQ1NWIuLmYxN2Q2ZTAyNDYwZiAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5
MTUvZGlzcGxheS9pbnRlbF9sdmRzLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxh
eS9pbnRlbF9sdmRzLmMKQEAgLTEzNSw3ICsxMzUsNyBAQCBzdGF0aWMgdm9pZCBpbnRlbF9sdmRz
X2dldF9jb25maWcoc3RydWN0IGludGVsX2VuY29kZXIgKmVuY29kZXIsCiAJZWxzZQogCQlmbGFn
cyB8PSBEUk1fTU9ERV9GTEFHX1BWU1lOQzsKIAotCXBpcGVfY29uZmlnLT5iYXNlLmFkanVzdGVk
X21vZGUuZmxhZ3MgfD0gZmxhZ3M7CisJcGlwZV9jb25maWctPmh3LmFkanVzdGVkX21vZGUuZmxh
Z3MgfD0gZmxhZ3M7CiAKIAlpZiAoSU5URUxfR0VOKGRldl9wcml2KSA8IDUpCiAJCXBpcGVfY29u
ZmlnLT5nbWNoX3BmaXQubHZkc19ib3JkZXJfYml0cyA9CkBAIC0xNDgsNyArMTQ4LDcgQEAgc3Rh
dGljIHZvaWQgaW50ZWxfbHZkc19nZXRfY29uZmlnKHN0cnVjdCBpbnRlbF9lbmNvZGVyICplbmNv
ZGVyLAogCQlwaXBlX2NvbmZpZy0+Z21jaF9wZml0LmNvbnRyb2wgfD0gdG1wICYgUEFORUxfOFRP
Nl9ESVRIRVJfRU5BQkxFOwogCX0KIAotCXBpcGVfY29uZmlnLT5iYXNlLmFkanVzdGVkX21vZGUu
Y3J0Y19jbG9jayA9IHBpcGVfY29uZmlnLT5wb3J0X2Nsb2NrOworCXBpcGVfY29uZmlnLT5ody5h
ZGp1c3RlZF9tb2RlLmNydGNfY2xvY2sgPSBwaXBlX2NvbmZpZy0+cG9ydF9jbG9jazsKIH0KIAog
c3RhdGljIHZvaWQgaW50ZWxfbHZkc19wcHNfZ2V0X2h3X3N0YXRlKHN0cnVjdCBkcm1faTkxNV9w
cml2YXRlICpkZXZfcHJpdiwKQEAgLTIzMSw3ICsyMzEsNyBAQCBzdGF0aWMgdm9pZCBpbnRlbF9w
cmVfZW5hYmxlX2x2ZHMoc3RydWN0IGludGVsX2VuY29kZXIgKmVuY29kZXIsCiAJc3RydWN0IGlu
dGVsX2x2ZHNfZW5jb2RlciAqbHZkc19lbmNvZGVyID0gdG9fbHZkc19lbmNvZGVyKCZlbmNvZGVy
LT5iYXNlKTsKIAlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGVu
Y29kZXItPmJhc2UuZGV2KTsKIAlzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YyA9IHRvX2ludGVsX2Ny
dGMocGlwZV9jb25maWctPmJhc2UuY3J0Yyk7Ci0JY29uc3Qgc3RydWN0IGRybV9kaXNwbGF5X21v
ZGUgKmFkanVzdGVkX21vZGUgPSAmcGlwZV9jb25maWctPmJhc2UuYWRqdXN0ZWRfbW9kZTsKKwlj
b25zdCBzdHJ1Y3QgZHJtX2Rpc3BsYXlfbW9kZSAqYWRqdXN0ZWRfbW9kZSA9ICZwaXBlX2NvbmZp
Zy0+aHcuYWRqdXN0ZWRfbW9kZTsKIAllbnVtIHBpcGUgcGlwZSA9IGNydGMtPnBpcGU7CiAJdTMy
IHRlbXA7CiAKQEAgLTM5Miw3ICszOTIsNyBAQCBzdGF0aWMgaW50IGludGVsX2x2ZHNfY29tcHV0
ZV9jb25maWcoc3RydWN0IGludGVsX2VuY29kZXIgKmludGVsX2VuY29kZXIsCiAJCXRvX2x2ZHNf
ZW5jb2RlcigmaW50ZWxfZW5jb2Rlci0+YmFzZSk7CiAJc3RydWN0IGludGVsX2Nvbm5lY3RvciAq
aW50ZWxfY29ubmVjdG9yID0KIAkJbHZkc19lbmNvZGVyLT5hdHRhY2hlZF9jb25uZWN0b3I7Ci0J
c3RydWN0IGRybV9kaXNwbGF5X21vZGUgKmFkanVzdGVkX21vZGUgPSAmcGlwZV9jb25maWctPmJh
c2UuYWRqdXN0ZWRfbW9kZTsKKwlzdHJ1Y3QgZHJtX2Rpc3BsYXlfbW9kZSAqYWRqdXN0ZWRfbW9k
ZSA9ICZwaXBlX2NvbmZpZy0+aHcuYWRqdXN0ZWRfbW9kZTsKIAlzdHJ1Y3QgaW50ZWxfY3J0YyAq
aW50ZWxfY3J0YyA9IHRvX2ludGVsX2NydGMocGlwZV9jb25maWctPmJhc2UuY3J0Yyk7CiAJdW5z
aWduZWQgaW50IGx2ZHNfYnBwOwogCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9k
aXNwbGF5L2ludGVsX3BhbmVsLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVs
X3BhbmVsLmMKaW5kZXggYmMxNGU5YzAyODVhLi41ZTNmZDM3ZDk0NzEgMTAwNjQ0Ci0tLSBhL2Ry
aXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfcGFuZWwuYworKysgYi9kcml2ZXJzL2dw
dS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX3BhbmVsLmMKQEAgLTE3OCw3ICsxNzgsNyBAQCBpbnRl
bF9wY2hfcGFuZWxfZml0dGluZyhzdHJ1Y3QgaW50ZWxfY3J0YyAqaW50ZWxfY3J0YywKIAkJCXN0
cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpwaXBlX2NvbmZpZywKIAkJCWludCBmaXR0aW5nX21vZGUp
CiB7Ci0JY29uc3Qgc3RydWN0IGRybV9kaXNwbGF5X21vZGUgKmFkanVzdGVkX21vZGUgPSAmcGlw
ZV9jb25maWctPmJhc2UuYWRqdXN0ZWRfbW9kZTsKKwljb25zdCBzdHJ1Y3QgZHJtX2Rpc3BsYXlf
bW9kZSAqYWRqdXN0ZWRfbW9kZSA9ICZwaXBlX2NvbmZpZy0+aHcuYWRqdXN0ZWRfbW9kZTsKIAlp
bnQgeCA9IDAsIHkgPSAwLCB3aWR0aCA9IDAsIGhlaWdodCA9IDA7CiAKIAkvKiBOYXRpdmUgbW9k
ZXMgZG9uJ3QgbmVlZCBmaXR0aW5nICovCkBAIC0zMDAsNyArMzAwLDcgQEAgc3RhdGljIGlubGlu
ZSB1MzIgcGFuZWxfZml0dGVyX3NjYWxpbmcodTMyIHNvdXJjZSwgdTMyIHRhcmdldCkKIHN0YXRp
YyB2b2lkIGk5NjVfc2NhbGVfYXNwZWN0KHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpwaXBlX2Nv
bmZpZywKIAkJCSAgICAgIHUzMiAqcGZpdF9jb250cm9sKQogewotCWNvbnN0IHN0cnVjdCBkcm1f
ZGlzcGxheV9tb2RlICphZGp1c3RlZF9tb2RlID0gJnBpcGVfY29uZmlnLT5iYXNlLmFkanVzdGVk
X21vZGU7CisJY29uc3Qgc3RydWN0IGRybV9kaXNwbGF5X21vZGUgKmFkanVzdGVkX21vZGUgPSAm
cGlwZV9jb25maWctPmh3LmFkanVzdGVkX21vZGU7CiAJdTMyIHNjYWxlZF93aWR0aCA9IGFkanVz
dGVkX21vZGUtPmNydGNfaGRpc3BsYXkgKgogCQlwaXBlX2NvbmZpZy0+cGlwZV9zcmNfaDsKIAl1
MzIgc2NhbGVkX2hlaWdodCA9IHBpcGVfY29uZmlnLT5waXBlX3NyY193ICoKQEAgLTMyMSw3ICsz
MjEsNyBAQCBzdGF0aWMgdm9pZCBpOXh4X3NjYWxlX2FzcGVjdChzdHJ1Y3QgaW50ZWxfY3J0Y19z
dGF0ZSAqcGlwZV9jb25maWcsCiAJCQkgICAgICB1MzIgKnBmaXRfY29udHJvbCwgdTMyICpwZml0
X3BnbV9yYXRpb3MsCiAJCQkgICAgICB1MzIgKmJvcmRlcikKIHsKLQlzdHJ1Y3QgZHJtX2Rpc3Bs
YXlfbW9kZSAqYWRqdXN0ZWRfbW9kZSA9ICZwaXBlX2NvbmZpZy0+YmFzZS5hZGp1c3RlZF9tb2Rl
OworCXN0cnVjdCBkcm1fZGlzcGxheV9tb2RlICphZGp1c3RlZF9tb2RlID0gJnBpcGVfY29uZmln
LT5ody5hZGp1c3RlZF9tb2RlOwogCXUzMiBzY2FsZWRfd2lkdGggPSBhZGp1c3RlZF9tb2RlLT5j
cnRjX2hkaXNwbGF5ICoKIAkJcGlwZV9jb25maWctPnBpcGVfc3JjX2g7CiAJdTMyIHNjYWxlZF9o
ZWlnaHQgPSBwaXBlX2NvbmZpZy0+cGlwZV9zcmNfdyAqCkBAIC0zODAsNyArMzgwLDcgQEAgdm9p
ZCBpbnRlbF9nbWNoX3BhbmVsX2ZpdHRpbmcoc3RydWN0IGludGVsX2NydGMgKmludGVsX2NydGMs
CiB7CiAJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShpbnRlbF9j
cnRjLT5iYXNlLmRldik7CiAJdTMyIHBmaXRfY29udHJvbCA9IDAsIHBmaXRfcGdtX3JhdGlvcyA9
IDAsIGJvcmRlciA9IDA7Ci0Jc3RydWN0IGRybV9kaXNwbGF5X21vZGUgKmFkanVzdGVkX21vZGUg
PSAmcGlwZV9jb25maWctPmJhc2UuYWRqdXN0ZWRfbW9kZTsKKwlzdHJ1Y3QgZHJtX2Rpc3BsYXlf
bW9kZSAqYWRqdXN0ZWRfbW9kZSA9ICZwaXBlX2NvbmZpZy0+aHcuYWRqdXN0ZWRfbW9kZTsKIAog
CS8qIE5hdGl2ZSBtb2RlcyBkb24ndCBuZWVkIGZpdHRpbmcgKi8KIAlpZiAoYWRqdXN0ZWRfbW9k
ZS0+Y3J0Y19oZGlzcGxheSA9PSBwaXBlX2NvbmZpZy0+cGlwZV9zcmNfdyAmJgpkaWZmIC0tZ2l0
IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9waXBlX2NyYy5jIGIvZHJpdmVy
cy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9waXBlX2NyYy5jCmluZGV4IDYyNjBhMjA4Mjcx
OS4uZmM2MDI1MzNhNjAyIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5
L2ludGVsX3BpcGVfY3JjLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRl
bF9waXBlX2NyYy5jCkBAIC0zMTMsNyArMzEzLDcgQEAgaW50ZWxfY3J0Y19jcmNfc2V0dXBfd29y
a2Fyb3VuZHMoc3RydWN0IGludGVsX2NydGMgKmNydGMsIGJvb2wgZW5hYmxlKQogCXBpcGVfY29u
ZmlnLT5jcmNfZW5hYmxlZCA9IGVuYWJsZTsKIAogCWlmIChJU19IQVNXRUxMKGRldl9wcml2KSAm
JgotCSAgICBwaXBlX2NvbmZpZy0+YmFzZS5hY3RpdmUgJiYgY3J0Yy0+cGlwZSA9PSBQSVBFX0Eg
JiYKKwkgICAgcGlwZV9jb25maWctPmh3LmFjdGl2ZSAmJiBjcnRjLT5waXBlID09IFBJUEVfQSAm
JgogCSAgICBwaXBlX2NvbmZpZy0+Y3B1X3RyYW5zY29kZXIgPT0gVFJBTlNDT0RFUl9FRFApCiAJ
CXBpcGVfY29uZmlnLT5iYXNlLm1vZGVfY2hhbmdlZCA9IHRydWU7CiAKZGlmZiAtLWdpdCBhL2Ry
aXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfcHNyLmMgYi9kcml2ZXJzL2dwdS9kcm0v
aTkxNS9kaXNwbGF5L2ludGVsX3Bzci5jCmluZGV4IDM1OWE2MDc2MmI0OS4uZjc1Zjc1OWFkNmVl
IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX3Bzci5jCisr
KyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfcHNyLmMKQEAgLTUzNywxMSAr
NTM3LDExIEBAIHRyYW5zY29kZXJfaGFzX3BzcjIoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRl
dl9wcml2LCBlbnVtIHRyYW5zY29kZXIgdHJhbnMpCiAKIHN0YXRpYyB1MzIgaW50ZWxfZ2V0X2Zy
YW1lX3RpbWVfdXMoY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNzdGF0ZSkKIHsKLQlp
ZiAoIWNzdGF0ZSB8fCAhY3N0YXRlLT5iYXNlLmFjdGl2ZSkKKwlpZiAoIWNzdGF0ZSB8fCAhY3N0
YXRlLT5ody5hY3RpdmUpCiAJCXJldHVybiAwOwogCiAJcmV0dXJuIERJVl9ST1VORF9VUCgxMDAw
ICogMTAwMCwKLQkJCSAgICBkcm1fbW9kZV92cmVmcmVzaCgmY3N0YXRlLT5iYXNlLmFkanVzdGVk
X21vZGUpKTsKKwkJCSAgICBkcm1fbW9kZV92cmVmcmVzaCgmY3N0YXRlLT5ody5hZGp1c3RlZF9t
b2RlKSk7CiB9CiAKIHN0YXRpYyB2b2lkIHBzcjJfcHJvZ3JhbV9pZGxlX2ZyYW1lcyhzdHJ1Y3Qg
ZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCkBAIC02MDYsOCArNjA2LDggQEAgc3RhdGljIGJv
b2wgaW50ZWxfcHNyMl9jb25maWdfdmFsaWQoc3RydWN0IGludGVsX2RwICppbnRlbF9kcCwKIAkJ
CQkgICAgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUpCiB7CiAJc3RydWN0IGRy
bV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gZHBfdG9faTkxNShpbnRlbF9kcCk7Ci0JaW50IGNy
dGNfaGRpc3BsYXkgPSBjcnRjX3N0YXRlLT5iYXNlLmFkanVzdGVkX21vZGUuY3J0Y19oZGlzcGxh
eTsKLQlpbnQgY3J0Y192ZGlzcGxheSA9IGNydGNfc3RhdGUtPmJhc2UuYWRqdXN0ZWRfbW9kZS5j
cnRjX3ZkaXNwbGF5OworCWludCBjcnRjX2hkaXNwbGF5ID0gY3J0Y19zdGF0ZS0+aHcuYWRqdXN0
ZWRfbW9kZS5jcnRjX2hkaXNwbGF5OworCWludCBjcnRjX3ZkaXNwbGF5ID0gY3J0Y19zdGF0ZS0+
aHcuYWRqdXN0ZWRfbW9kZS5jcnRjX3ZkaXNwbGF5OwogCWludCBwc3JfbWF4X2ggPSAwLCBwc3Jf
bWF4X3YgPSAwOwogCiAJaWYgKCFkZXZfcHJpdi0+cHNyLnNpbmtfcHNyMl9zdXBwb3J0KQpAQCAt
NjczLDcgKzY3Myw3IEBAIHZvaWQgaW50ZWxfcHNyX2NvbXB1dGVfY29uZmlnKHN0cnVjdCBpbnRl
bF9kcCAqaW50ZWxfZHAsCiAJc3RydWN0IGludGVsX2RpZ2l0YWxfcG9ydCAqZGlnX3BvcnQgPSBk
cF90b19kaWdfcG9ydChpbnRlbF9kcCk7CiAJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9w
cml2ID0gZHBfdG9faTkxNShpbnRlbF9kcCk7CiAJY29uc3Qgc3RydWN0IGRybV9kaXNwbGF5X21v
ZGUgKmFkanVzdGVkX21vZGUgPQotCQkmY3J0Y19zdGF0ZS0+YmFzZS5hZGp1c3RlZF9tb2RlOwor
CQkmY3J0Y19zdGF0ZS0+aHcuYWRqdXN0ZWRfbW9kZTsKIAlpbnQgcHNyX3NldHVwX3RpbWU7CiAK
IAlpZiAoIUNBTl9QU1IoZGV2X3ByaXYpKQpAQCAtMTExNyw3ICsxMTE3LDcgQEAgc3RhdGljIGlu
dCBpbnRlbF9wc3JfZmFzdHNldF9mb3JjZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3By
aXYpCiAJCQlnb3RvIGVycm9yOwogCQl9CiAKLQkJaWYgKGNydGNfc3RhdGUtPmJhc2UuYWN0aXZl
ICYmIGNydGNfc3RhdGUtPmhhc19wc3IpIHsKKwkJaWYgKGNydGNfc3RhdGUtPmh3LmFjdGl2ZSAm
JiBjcnRjX3N0YXRlLT5oYXNfcHNyKSB7CiAJCQkvKiBNYXJrIG1vZGUgYXMgY2hhbmdlZCB0byB0
cmlnZ2VyIGEgcGlwZS0+dXBkYXRlKCkgKi8KIAkJCWNydGNfc3RhdGUtPmJhc2UubW9kZV9jaGFu
Z2VkID0gdHJ1ZTsKIAkJCWJyZWFrOwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUv
ZGlzcGxheS9pbnRlbF9zZHZvLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVs
X3Nkdm8uYwppbmRleCA0N2Y1ZDg3YTkzOGEuLjk3YWU4Y2MxMzE0ZSAxMDA2NDQKLS0tIGEvZHJp
dmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9zZHZvLmMKKysrIGIvZHJpdmVycy9ncHUv
ZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9zZHZvLmMKQEAgLTEwODcsNyArMTA4Nyw3IEBAIHN0YXRp
YyBib29sIGludGVsX3Nkdm9fY29tcHV0ZV9hdmlfaW5mb2ZyYW1lKHN0cnVjdCBpbnRlbF9zZHZv
ICppbnRlbF9zZHZvLAogewogCXN0cnVjdCBoZG1pX2F2aV9pbmZvZnJhbWUgKmZyYW1lID0gJmNy
dGNfc3RhdGUtPmluZm9mcmFtZXMuYXZpLmF2aTsKIAljb25zdCBzdHJ1Y3QgZHJtX2Rpc3BsYXlf
bW9kZSAqYWRqdXN0ZWRfbW9kZSA9Ci0JCSZjcnRjX3N0YXRlLT5iYXNlLmFkanVzdGVkX21vZGU7
CisJCSZjcnRjX3N0YXRlLT5ody5hZGp1c3RlZF9tb2RlOwogCWludCByZXQ7CiAKIAlpZiAoIWNy
dGNfc3RhdGUtPmhhc19oZG1pX3NpbmspCkBAIC0xMjc2LDggKzEyNzYsOCBAQCBzdGF0aWMgaW50
IGludGVsX3Nkdm9fY29tcHV0ZV9jb25maWcoc3RydWN0IGludGVsX2VuY29kZXIgKmVuY29kZXIs
CiAJCXRvX2ludGVsX3Nkdm9fY29ubmVjdG9yX3N0YXRlKGNvbm5fc3RhdGUpOwogCXN0cnVjdCBp
bnRlbF9zZHZvX2Nvbm5lY3RvciAqaW50ZWxfc2R2b19jb25uZWN0b3IgPQogCQl0b19pbnRlbF9z
ZHZvX2Nvbm5lY3Rvcihjb25uX3N0YXRlLT5jb25uZWN0b3IpOwotCXN0cnVjdCBkcm1fZGlzcGxh
eV9tb2RlICphZGp1c3RlZF9tb2RlID0gJnBpcGVfY29uZmlnLT5iYXNlLmFkanVzdGVkX21vZGU7
Ci0Jc3RydWN0IGRybV9kaXNwbGF5X21vZGUgKm1vZGUgPSAmcGlwZV9jb25maWctPmJhc2UubW9k
ZTsKKwlzdHJ1Y3QgZHJtX2Rpc3BsYXlfbW9kZSAqYWRqdXN0ZWRfbW9kZSA9ICZwaXBlX2NvbmZp
Zy0+aHcuYWRqdXN0ZWRfbW9kZTsKKwlzdHJ1Y3QgZHJtX2Rpc3BsYXlfbW9kZSAqbW9kZSA9ICZw
aXBlX2NvbmZpZy0+aHcubW9kZTsKIAogCURSTV9ERUJVR19LTVMoImZvcmNpbmcgYnBjIHRvIDgg
Zm9yIFNEVk9cbiIpOwogCXBpcGVfY29uZmlnLT5waXBlX2JwcCA9IDgqMzsKQEAgLTE0MzAsMTIg
KzE0MzAsMTIgQEAgc3RhdGljIHZvaWQgaW50ZWxfc2R2b19wcmVfZW5hYmxlKHN0cnVjdCBpbnRl
bF9lbmNvZGVyICppbnRlbF9lbmNvZGVyLAogewogCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpk
ZXZfcHJpdiA9IHRvX2k5MTUoaW50ZWxfZW5jb2Rlci0+YmFzZS5kZXYpOwogCXN0cnVjdCBpbnRl
bF9jcnRjICpjcnRjID0gdG9faW50ZWxfY3J0YyhjcnRjX3N0YXRlLT5iYXNlLmNydGMpOwotCWNv
bnN0IHN0cnVjdCBkcm1fZGlzcGxheV9tb2RlICphZGp1c3RlZF9tb2RlID0gJmNydGNfc3RhdGUt
PmJhc2UuYWRqdXN0ZWRfbW9kZTsKKwljb25zdCBzdHJ1Y3QgZHJtX2Rpc3BsYXlfbW9kZSAqYWRq
dXN0ZWRfbW9kZSA9ICZjcnRjX3N0YXRlLT5ody5hZGp1c3RlZF9tb2RlOwogCWNvbnN0IHN0cnVj
dCBpbnRlbF9zZHZvX2Nvbm5lY3Rvcl9zdGF0ZSAqc2R2b19zdGF0ZSA9CiAJCXRvX2ludGVsX3Nk
dm9fY29ubmVjdG9yX3N0YXRlKGNvbm5fc3RhdGUpOwogCWNvbnN0IHN0cnVjdCBpbnRlbF9zZHZv
X2Nvbm5lY3RvciAqaW50ZWxfc2R2b19jb25uZWN0b3IgPQogCQl0b19pbnRlbF9zZHZvX2Nvbm5l
Y3Rvcihjb25uX3N0YXRlLT5jb25uZWN0b3IpOwotCWNvbnN0IHN0cnVjdCBkcm1fZGlzcGxheV9t
b2RlICptb2RlID0gJmNydGNfc3RhdGUtPmJhc2UubW9kZTsKKwljb25zdCBzdHJ1Y3QgZHJtX2Rp
c3BsYXlfbW9kZSAqbW9kZSA9ICZjcnRjX3N0YXRlLT5ody5tb2RlOwogCXN0cnVjdCBpbnRlbF9z
ZHZvICppbnRlbF9zZHZvID0gdG9fc2R2byhpbnRlbF9lbmNvZGVyKTsKIAl1MzIgc2R2b3g7CiAJ
c3RydWN0IGludGVsX3Nkdm9faW5fb3V0X21hcCBpbl9vdXQ7CkBAIC0xNjI5LDcgKzE2MjksNyBA
QCBzdGF0aWMgdm9pZCBpbnRlbF9zZHZvX2dldF9jb25maWcoc3RydWN0IGludGVsX2VuY29kZXIg
KmVuY29kZXIsCiAJCQlmbGFncyB8PSBEUk1fTU9ERV9GTEFHX05WU1lOQzsKIAl9CiAKLQlwaXBl
X2NvbmZpZy0+YmFzZS5hZGp1c3RlZF9tb2RlLmZsYWdzIHw9IGZsYWdzOworCXBpcGVfY29uZmln
LT5ody5hZGp1c3RlZF9tb2RlLmZsYWdzIHw9IGZsYWdzOwogCiAJLyoKIAkgKiBwaXhlbCBtdWx0
aXBsaWVyIHJlYWRvdXQgaXMgdHJpY2t5OiBPbmx5IG9uIGk5MTVnL2dtIGl0IGlzIHN0b3JlZCBp
bgpAQCAtMTY0OSw3ICsxNjQ5LDcgQEAgc3RhdGljIHZvaWQgaW50ZWxfc2R2b19nZXRfY29uZmln
KHN0cnVjdCBpbnRlbF9lbmNvZGVyICplbmNvZGVyLAogCWlmIChwaXBlX2NvbmZpZy0+cGl4ZWxf
bXVsdGlwbGllcikKIAkJZG90Y2xvY2sgLz0gcGlwZV9jb25maWctPnBpeGVsX211bHRpcGxpZXI7
CiAKLQlwaXBlX2NvbmZpZy0+YmFzZS5hZGp1c3RlZF9tb2RlLmNydGNfY2xvY2sgPSBkb3RjbG9j
azsKKwlwaXBlX2NvbmZpZy0+aHcuYWRqdXN0ZWRfbW9kZS5jcnRjX2Nsb2NrID0gZG90Y2xvY2s7
CiAKIAkvKiBDcm9zcyBjaGVjayB0aGUgcG9ydCBwaXhlbCBtdWx0aXBsaWVyIHdpdGggdGhlIHNk
dm8gZW5jb2RlciBzdGF0ZS4gKi8KIAlpZiAoaW50ZWxfc2R2b19nZXRfdmFsdWUoaW50ZWxfc2R2
bywgU0RWT19DTURfR0VUX0NMT0NLX1JBVEVfTVVMVCwKQEAgLTE3MDEsNyArMTcwMSw3IEBAIHN0
YXRpYyB2b2lkIGludGVsX3Nkdm9fZW5hYmxlX2F1ZGlvKHN0cnVjdCBpbnRlbF9zZHZvICppbnRl
bF9zZHZvLAogCQkJCSAgICBjb25zdCBzdHJ1Y3QgZHJtX2Nvbm5lY3Rvcl9zdGF0ZSAqY29ubl9z
dGF0ZSkKIHsKIAljb25zdCBzdHJ1Y3QgZHJtX2Rpc3BsYXlfbW9kZSAqYWRqdXN0ZWRfbW9kZSA9
Ci0JCSZjcnRjX3N0YXRlLT5iYXNlLmFkanVzdGVkX21vZGU7CisJCSZjcnRjX3N0YXRlLT5ody5h
ZGp1c3RlZF9tb2RlOwogCXN0cnVjdCBkcm1fY29ubmVjdG9yICpjb25uZWN0b3IgPSBjb25uX3N0
YXRlLT5jb25uZWN0b3I7CiAJdTggKmVsZCA9IGNvbm5lY3Rvci0+ZWxkOwogCmRpZmYgLS1naXQg
YS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX3Nwcml0ZS5jIGIvZHJpdmVycy9n
cHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9zcHJpdGUuYwppbmRleCBlZGM0MWZjNDA3MjYuLmZj
ZDczNTVlYWEzNCAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRl
bF9zcHJpdGUuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX3Nwcml0
ZS5jCkBAIC04Myw3ICs4Myw3IEBAIHZvaWQgaW50ZWxfcGlwZV91cGRhdGVfc3RhcnQoY29uc3Qg
c3RydWN0IGludGVsX2NydGNfc3RhdGUgKm5ld19jcnRjX3N0YXRlKQogewogCXN0cnVjdCBpbnRl
bF9jcnRjICpjcnRjID0gdG9faW50ZWxfY3J0YyhuZXdfY3J0Y19zdGF0ZS0+YmFzZS5jcnRjKTsK
IAlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGNydGMtPmJhc2Uu
ZGV2KTsKLQljb25zdCBzdHJ1Y3QgZHJtX2Rpc3BsYXlfbW9kZSAqYWRqdXN0ZWRfbW9kZSA9ICZu
ZXdfY3J0Y19zdGF0ZS0+YmFzZS5hZGp1c3RlZF9tb2RlOworCWNvbnN0IHN0cnVjdCBkcm1fZGlz
cGxheV9tb2RlICphZGp1c3RlZF9tb2RlID0gJm5ld19jcnRjX3N0YXRlLT5ody5hZGp1c3RlZF9t
b2RlOwogCWxvbmcgdGltZW91dCA9IG1zZWNzX3RvX2ppZmZpZXNfdGltZW91dCgxKTsKIAlpbnQg
c2NhbmxpbmUsIG1pbiwgbWF4LCB2Ymxhbmtfc3RhcnQ7CiAJd2FpdF9xdWV1ZV9oZWFkX3QgKndx
ID0gZHJtX2NydGNfdmJsYW5rX3dhaXRxdWV1ZSgmY3J0Yy0+YmFzZSk7CkBAIC0xODkxLDcgKzE4
OTEsNyBAQCBnNHhfc3ByaXRlX2NoZWNrX3NjYWxpbmcoc3RydWN0IGludGVsX2NydGNfc3RhdGUg
KmNydGNfc3RhdGUsCiAJY29uc3Qgc3RydWN0IGRybV9yZWN0ICpkc3QgPSAmcGxhbmVfc3RhdGUt
PmJhc2UuZHN0OwogCWludCBzcmNfeCwgc3JjX3csIHNyY19oLCBjcnRjX3csIGNydGNfaDsKIAlj
b25zdCBzdHJ1Y3QgZHJtX2Rpc3BsYXlfbW9kZSAqYWRqdXN0ZWRfbW9kZSA9Ci0JCSZjcnRjX3N0
YXRlLT5iYXNlLmFkanVzdGVkX21vZGU7CisJCSZjcnRjX3N0YXRlLT5ody5hZGp1c3RlZF9tb2Rl
OwogCXVuc2lnbmVkIGludCBzdHJpZGUgPSBwbGFuZV9zdGF0ZS0+Y29sb3JfcGxhbmVbMF0uc3Ry
aWRlOwogCXVuc2lnbmVkIGludCBjcHAgPSBmYi0+Zm9ybWF0LT5jcHBbMF07CiAJdW5zaWduZWQg
aW50IHdpZHRoX2J5dGVzOwpAQCAtMjEwNSw4ICsyMTA1LDggQEAgc3RhdGljIGludCBza2xfcGxh
bmVfY2hlY2tfZmIoY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUsCiAJ
fQogCiAJLyogWS10aWxpbmcgaXMgbm90IHN1cHBvcnRlZCBpbiBJRi1JRCBJbnRlcmxhY2UgbW9k
ZSAqLwotCWlmIChjcnRjX3N0YXRlLT5iYXNlLmVuYWJsZSAmJgotCSAgICBjcnRjX3N0YXRlLT5i
YXNlLmFkanVzdGVkX21vZGUuZmxhZ3MgJiBEUk1fTU9ERV9GTEFHX0lOVEVSTEFDRSAmJgorCWlm
IChjcnRjX3N0YXRlLT5ody5lbmFibGUgJiYKKwkgICAgY3J0Y19zdGF0ZS0+aHcuYWRqdXN0ZWRf
bW9kZS5mbGFncyAmIERSTV9NT0RFX0ZMQUdfSU5URVJMQUNFICYmCiAJICAgIChmYi0+bW9kaWZp
ZXIgPT0gSTkxNV9GT1JNQVRfTU9EX1lfVElMRUQgfHwKIAkgICAgIGZiLT5tb2RpZmllciA9PSBJ
OTE1X0ZPUk1BVF9NT0RfWWZfVElMRUQgfHwKIAkgICAgIGZiLT5tb2RpZmllciA9PSBJOTE1X0ZP
Uk1BVF9NT0RfWV9USUxFRF9DQ1MgfHwKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1
L2Rpc3BsYXkvaW50ZWxfdHYuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxf
dHYuYwppbmRleCA3MDcyNmI0ODEyNDQuLmU4MDBkNDViODEzZCAxMDA2NDQKLS0tIGEvZHJpdmVy
cy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF90di5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9p
OTE1L2Rpc3BsYXkvaW50ZWxfdHYuYwpAQCAtMTA4NSw3ICsxMDg1LDcgQEAgaW50ZWxfdHZfZ2V0
X2NvbmZpZyhzdHJ1Y3QgaW50ZWxfZW5jb2RlciAqZW5jb2RlciwKIHsKIAlzdHJ1Y3QgZHJtX2k5
MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGVuY29kZXItPmJhc2UuZGV2KTsKIAlzdHJ1
Y3QgZHJtX2Rpc3BsYXlfbW9kZSAqYWRqdXN0ZWRfbW9kZSA9Ci0JCSZwaXBlX2NvbmZpZy0+YmFz
ZS5hZGp1c3RlZF9tb2RlOworCQkmcGlwZV9jb25maWctPmh3LmFkanVzdGVkX21vZGU7CiAJc3Ry
dWN0IGRybV9kaXNwbGF5X21vZGUgbW9kZSA9IHt9OwogCXUzMiB0dl9jdGwsIGhjdGwxLCBoY3Rs
MywgdmN0bDEsIHZjdGwyLCB0bXA7CiAJc3RydWN0IHR2X21vZGUgdHZfbW9kZSA9IHt9OwpAQCAt
MTE4OCw3ICsxMTg4LDcgQEAgaW50ZWxfdHZfY29tcHV0ZV9jb25maWcoc3RydWN0IGludGVsX2Vu
Y29kZXIgKmVuY29kZXIsCiAJCXRvX2ludGVsX3R2X2Nvbm5lY3Rvcl9zdGF0ZShjb25uX3N0YXRl
KTsKIAljb25zdCBzdHJ1Y3QgdHZfbW9kZSAqdHZfbW9kZSA9IGludGVsX3R2X21vZGVfZmluZChj
b25uX3N0YXRlKTsKIAlzdHJ1Y3QgZHJtX2Rpc3BsYXlfbW9kZSAqYWRqdXN0ZWRfbW9kZSA9Ci0J
CSZwaXBlX2NvbmZpZy0+YmFzZS5hZGp1c3RlZF9tb2RlOworCQkmcGlwZV9jb25maWctPmh3LmFk
anVzdGVkX21vZGU7CiAJaW50IGhkaXNwbGF5ID0gYWRqdXN0ZWRfbW9kZS0+Y3J0Y19oZGlzcGxh
eTsKIAlpbnQgdmRpc3BsYXkgPSBhZGp1c3RlZF9tb2RlLT5jcnRjX3ZkaXNwbGF5OwogCmRpZmYg
LS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX3Zkc2MuYyBiL2RyaXZl
cnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfdmRzYy5jCmluZGV4IDg5NmIwYzMzNGY1ZS4u
NzU3YjI3NmViM2ZjIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2lu
dGVsX3Zkc2MuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX3Zkc2Mu
YwpAQCAtMzI5LDggKzMyOSw4IEBAIGludCBpbnRlbF9kcF9jb21wdXRlX2RzY19wYXJhbXMoc3Ry
dWN0IGludGVsX2RwICppbnRlbF9kcCwKIAlpbnQgY29sdW1uX2luZGV4ID0gMDsKIAl1OCBsaW5l
X2J1Zl9kZXB0aCA9IDA7CiAKLQl2ZHNjX2NmZy0+cGljX3dpZHRoID0gcGlwZV9jb25maWctPmJh
c2UuYWRqdXN0ZWRfbW9kZS5jcnRjX2hkaXNwbGF5OwotCXZkc2NfY2ZnLT5waWNfaGVpZ2h0ID0g
cGlwZV9jb25maWctPmJhc2UuYWRqdXN0ZWRfbW9kZS5jcnRjX3ZkaXNwbGF5OworCXZkc2NfY2Zn
LT5waWNfd2lkdGggPSBwaXBlX2NvbmZpZy0+aHcuYWRqdXN0ZWRfbW9kZS5jcnRjX2hkaXNwbGF5
OworCXZkc2NfY2ZnLT5waWNfaGVpZ2h0ID0gcGlwZV9jb25maWctPmh3LmFkanVzdGVkX21vZGUu
Y3J0Y192ZGlzcGxheTsKIAl2ZHNjX2NmZy0+c2xpY2Vfd2lkdGggPSBESVZfUk9VTkRfVVAodmRz
Y19jZmctPnBpY193aWR0aCwKIAkJCQkJICAgICBwaXBlX2NvbmZpZy0+ZHNjLnNsaWNlX2NvdW50
KTsKIAkvKgpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS92bHZfZHNp
LmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L3Zsdl9kc2kuYwppbmRleCA1MDA2NGNk
ZTA3MjQuLjNiZjgzODI3OWZjMiAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlz
cGxheS92bHZfZHNpLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS92bHZfZHNp
LmMKQEAgLTI2Myw3ICsyNjMsNyBAQCBzdGF0aWMgaW50IGludGVsX2RzaV9jb21wdXRlX2NvbmZp
ZyhzdHJ1Y3QgaW50ZWxfZW5jb2RlciAqZW5jb2RlciwKIAlzdHJ1Y3QgaW50ZWxfY29ubmVjdG9y
ICppbnRlbF9jb25uZWN0b3IgPSBpbnRlbF9kc2ktPmF0dGFjaGVkX2Nvbm5lY3RvcjsKIAlzdHJ1
Y3QgaW50ZWxfY3J0YyAqY3J0YyA9IHRvX2ludGVsX2NydGMocGlwZV9jb25maWctPmJhc2UuY3J0
Yyk7CiAJY29uc3Qgc3RydWN0IGRybV9kaXNwbGF5X21vZGUgKmZpeGVkX21vZGUgPSBpbnRlbF9j
b25uZWN0b3ItPnBhbmVsLmZpeGVkX21vZGU7Ci0Jc3RydWN0IGRybV9kaXNwbGF5X21vZGUgKmFk
anVzdGVkX21vZGUgPSAmcGlwZV9jb25maWctPmJhc2UuYWRqdXN0ZWRfbW9kZTsKKwlzdHJ1Y3Qg
ZHJtX2Rpc3BsYXlfbW9kZSAqYWRqdXN0ZWRfbW9kZSA9ICZwaXBlX2NvbmZpZy0+aHcuYWRqdXN0
ZWRfbW9kZTsKIAlpbnQgcmV0OwogCiAJRFJNX0RFQlVHX0tNUygiXG4iKTsKQEAgLTEwMzIsNyAr
MTAzMiw3IEBAIHN0YXRpYyB2b2lkIGJ4dF9kc2lfZ2V0X3BpcGVfY29uZmlnKHN0cnVjdCBpbnRl
bF9lbmNvZGVyICplbmNvZGVyLAogCXN0cnVjdCBkcm1fZGV2aWNlICpkZXYgPSBlbmNvZGVyLT5i
YXNlLmRldjsKIAlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGRl
dik7CiAJc3RydWN0IGRybV9kaXNwbGF5X21vZGUgKmFkanVzdGVkX21vZGUgPQotCQkJCQkmcGlw
ZV9jb25maWctPmJhc2UuYWRqdXN0ZWRfbW9kZTsKKwkJCQkJJnBpcGVfY29uZmlnLT5ody5hZGp1
c3RlZF9tb2RlOwogCXN0cnVjdCBkcm1fZGlzcGxheV9tb2RlICphZGp1c3RlZF9tb2RlX3N3Owog
CXN0cnVjdCBpbnRlbF9jcnRjICpjcnRjID0gdG9faW50ZWxfY3J0YyhwaXBlX2NvbmZpZy0+YmFz
ZS5jcnRjKTsKIAlzdHJ1Y3QgaW50ZWxfZHNpICppbnRlbF9kc2kgPSBlbmNfdG9faW50ZWxfZHNp
KCZlbmNvZGVyLT5iYXNlKTsKQEAgLTEwNDUsNyArMTA0NSw3IEBAIHN0YXRpYyB2b2lkIGJ4dF9k
c2lfZ2V0X3BpcGVfY29uZmlnKHN0cnVjdCBpbnRlbF9lbmNvZGVyICplbmNvZGVyLAogCQkJCWNy
dGNfaGJsYW5rX3N0YXJ0X3N3LCBjcnRjX2hibGFua19lbmRfc3c7CiAKIAkvKiBGSVhNRTogaHcg
cmVhZG91dCBzaG91bGQgbm90IGRlcGVuZCBvbiBTVyBzdGF0ZSAqLwotCWFkanVzdGVkX21vZGVf
c3cgPSAmY3J0Yy0+Y29uZmlnLT5iYXNlLmFkanVzdGVkX21vZGU7CisJYWRqdXN0ZWRfbW9kZV9z
dyA9ICZjcnRjLT5jb25maWctPmh3LmFkanVzdGVkX21vZGU7CiAKIAkvKgogCSAqIEF0bGVhc3Qg
b25lIHBvcnQgaXMgYWN0aXZlIGFzIGVuY29kZXItPmdldF9jb25maWcgY2FsbGVkIG9ubHkgaWYK
QEAgLTEyMDQsNyArMTIwNCw3IEBAIHN0YXRpYyB2b2lkIGludGVsX2RzaV9nZXRfY29uZmlnKHN0
cnVjdCBpbnRlbF9lbmNvZGVyICplbmNvZGVyLAogCX0KIAogCWlmIChwY2xrKSB7Ci0JCXBpcGVf
Y29uZmlnLT5iYXNlLmFkanVzdGVkX21vZGUuY3J0Y19jbG9jayA9IHBjbGs7CisJCXBpcGVfY29u
ZmlnLT5ody5hZGp1c3RlZF9tb2RlLmNydGNfY2xvY2sgPSBwY2xrOwogCQlwaXBlX2NvbmZpZy0+
cG9ydF9jbG9jayA9IHBjbGs7CiAJfQogfQpAQCAtMTMxNyw3ICsxMzE3LDcgQEAgc3RhdGljIHZv
aWQgaW50ZWxfZHNpX3ByZXBhcmUoc3RydWN0IGludGVsX2VuY29kZXIgKmludGVsX2VuY29kZXIs
CiAJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShkZXYpOwogCXN0
cnVjdCBpbnRlbF9jcnRjICppbnRlbF9jcnRjID0gdG9faW50ZWxfY3J0YyhwaXBlX2NvbmZpZy0+
YmFzZS5jcnRjKTsKIAlzdHJ1Y3QgaW50ZWxfZHNpICppbnRlbF9kc2kgPSBlbmNfdG9faW50ZWxf
ZHNpKGVuY29kZXIpOwotCWNvbnN0IHN0cnVjdCBkcm1fZGlzcGxheV9tb2RlICphZGp1c3RlZF9t
b2RlID0gJnBpcGVfY29uZmlnLT5iYXNlLmFkanVzdGVkX21vZGU7CisJY29uc3Qgc3RydWN0IGRy
bV9kaXNwbGF5X21vZGUgKmFkanVzdGVkX21vZGUgPSAmcGlwZV9jb25maWctPmh3LmFkanVzdGVk
X21vZGU7CiAJZW51bSBwb3J0IHBvcnQ7CiAJdW5zaWduZWQgaW50IGJwcCA9IG1pcGlfZHNpX3Bp
eGVsX2Zvcm1hdF90b19icHAoaW50ZWxfZHNpLT5waXhlbF9mb3JtYXQpOwogCXUzMiB2YWwsIHRt
cDsKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZGVidWdmcy5jIGIvZHJp
dmVycy9ncHUvZHJtL2k5MTUvaTkxNV9kZWJ1Z2ZzLmMKaW5kZXggODAxNjQ4NGViY2QzLi43Mzgw
OGZkMjY2MjUgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZGVidWdmcy5j
CisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZGVidWdmcy5jCkBAIC0yNjg0LDExICsy
Njg0LDExIEBAIHN0YXRpYyBpbnQgaTkxNV9kaXNwbGF5X2luZm8oc3RydWN0IHNlcV9maWxlICpt
LCB2b2lkICp1bnVzZWQpCiAKIAkJc2VxX3ByaW50ZihtLCAiQ1JUQyAlZDogcGlwZTogJWMsIGFj
dGl2ZT0lcywgKHNpemU9JWR4JWQpLCBkaXRoZXI9JXMsIGJwcD0lZFxuIiwKIAkJCSAgIGNydGMt
PmJhc2UuYmFzZS5pZCwgcGlwZV9uYW1lKGNydGMtPnBpcGUpLAotCQkJICAgeWVzbm8ocGlwZV9j
b25maWctPmJhc2UuYWN0aXZlKSwKKwkJCSAgIHllc25vKHBpcGVfY29uZmlnLT5ody5hY3RpdmUp
LAogCQkJICAgcGlwZV9jb25maWctPnBpcGVfc3JjX3csIHBpcGVfY29uZmlnLT5waXBlX3NyY19o
LAogCQkJICAgeWVzbm8ocGlwZV9jb25maWctPmRpdGhlciksIHBpcGVfY29uZmlnLT5waXBlX2Jw
cCk7CiAKLQkJaWYgKHBpcGVfY29uZmlnLT5iYXNlLmFjdGl2ZSkgeworCQlpZiAocGlwZV9jb25m
aWctPmh3LmFjdGl2ZSkgewogCQkJc3RydWN0IGludGVsX3BsYW5lICpjdXJzb3IgPQogCQkJCXRv
X2ludGVsX3BsYW5lKGNydGMtPmJhc2UuY3Vyc29yKTsKIApAQCAtNDE2MSw3ICs0MTYxLDcgQEAg
c3RhdGljIGludCBpOTE1X2RycnNfY3RsX3NldCh2b2lkICpkYXRhLCB1NjQgdmFsKQogCiAJCWNy
dGNfc3RhdGUgPSB0b19pbnRlbF9jcnRjX3N0YXRlKGNydGMtPmJhc2Uuc3RhdGUpOwogCi0JCWlm
ICghY3J0Y19zdGF0ZS0+YmFzZS5hY3RpdmUgfHwKKwkJaWYgKCFjcnRjX3N0YXRlLT5ody5hY3Rp
dmUgfHwKIAkJICAgICFjcnRjX3N0YXRlLT5oYXNfZHJycykKIAkJCWdvdG8gb3V0OwogCkBAIC00
MjQzLDcgKzQyNDMsNyBAQCBpOTE1X2ZpZm9fdW5kZXJydW5fcmVzZXRfd3JpdGUoc3RydWN0IGZp
bGUgKmZpbHAsCiAJCQkJcmV0ID0gd2FpdF9mb3JfY29tcGxldGlvbl9pbnRlcnJ1cHRpYmxlKCZj
b21taXQtPmZsaXBfZG9uZSk7CiAJCX0KIAotCQlpZiAoIXJldCAmJiBjcnRjX3N0YXRlLT5iYXNl
LmFjdGl2ZSkgeworCQlpZiAoIXJldCAmJiBjcnRjX3N0YXRlLT5ody5hY3RpdmUpIHsKIAkJCURS
TV9ERUJVR19LTVMoIlJlLWFybWluZyBGSUZPIHVuZGVycnVucyBvbiBwaXBlICVjXG4iLAogCQkJ
CSAgICAgIHBpcGVfbmFtZShpbnRlbF9jcnRjLT5waXBlKSk7CiAKZGlmZiAtLWdpdCBhL2RyaXZl
cnMvZ3B1L2RybS9pOTE1L2ludGVsX3BtLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pbnRlbF9w
bS5jCmluZGV4IDhiYTFmM2FjZWFlZC4uYzJlOGI4YWJlNzA5IDEwMDY0NAotLS0gYS9kcml2ZXJz
L2dwdS9kcm0vaTkxNS9pbnRlbF9wbS5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2ludGVs
X3BtLmMKQEAgLTc4OSw3ICs3ODksNyBAQCBzdGF0aWMgYm9vbCBpbnRlbF93bV9wbGFuZV92aXNp
YmxlKGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlLAogCXN0cnVjdCBp
bnRlbF9wbGFuZSAqcGxhbmUgPSB0b19pbnRlbF9wbGFuZShwbGFuZV9zdGF0ZS0+YmFzZS5wbGFu
ZSk7CiAKIAkvKiBGSVhNRSBjaGVjayB0aGUgJ2VuYWJsZScgaW5zdGVhZCAqLwotCWlmICghY3J0
Y19zdGF0ZS0+YmFzZS5hY3RpdmUpCisJaWYgKCFjcnRjX3N0YXRlLT5ody5hY3RpdmUpCiAJCXJl
dHVybiBmYWxzZTsKIAogCS8qCkBAIC04NDIsNyArODQyLDcgQEAgc3RhdGljIHZvaWQgcGluZXZp
ZXdfdXBkYXRlX3dtKHN0cnVjdCBpbnRlbF9jcnRjICp1bnVzZWRfY3J0YykKIAljcnRjID0gc2lu
Z2xlX2VuYWJsZWRfY3J0YyhkZXZfcHJpdik7CiAJaWYgKGNydGMpIHsKIAkJY29uc3Qgc3RydWN0
IGRybV9kaXNwbGF5X21vZGUgKmFkanVzdGVkX21vZGUgPQotCQkJJmNydGMtPmNvbmZpZy0+YmFz
ZS5hZGp1c3RlZF9tb2RlOworCQkJJmNydGMtPmNvbmZpZy0+aHcuYWRqdXN0ZWRfbW9kZTsKIAkJ
Y29uc3Qgc3RydWN0IGRybV9mcmFtZWJ1ZmZlciAqZmIgPQogCQkJY3J0Yy0+YmFzZS5wcmltYXJ5
LT5zdGF0ZS0+ZmI7CiAJCWludCBjcHAgPSBmYi0+Zm9ybWF0LT5jcHBbMF07CkBAIC0xMDc4LDcg
KzEwNzgsNyBAQCBzdGF0aWMgdTE2IGc0eF9jb21wdXRlX3dtKGNvbnN0IHN0cnVjdCBpbnRlbF9j
cnRjX3N0YXRlICpjcnRjX3N0YXRlLAogCXN0cnVjdCBpbnRlbF9wbGFuZSAqcGxhbmUgPSB0b19p
bnRlbF9wbGFuZShwbGFuZV9zdGF0ZS0+YmFzZS5wbGFuZSk7CiAJc3RydWN0IGRybV9pOTE1X3By
aXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShwbGFuZS0+YmFzZS5kZXYpOwogCWNvbnN0IHN0cnVj
dCBkcm1fZGlzcGxheV9tb2RlICphZGp1c3RlZF9tb2RlID0KLQkJJmNydGNfc3RhdGUtPmJhc2Uu
YWRqdXN0ZWRfbW9kZTsKKwkJJmNydGNfc3RhdGUtPmh3LmFkanVzdGVkX21vZGU7CiAJdW5zaWdu
ZWQgaW50IGxhdGVuY3kgPSBkZXZfcHJpdi0+d20ucHJpX2xhdGVuY3lbbGV2ZWxdICogMTA7CiAJ
dW5zaWduZWQgaW50IGNsb2NrLCBodG90YWwsIGNwcCwgd2lkdGgsIHdtOwogCkBAIC0xMzkwLDcg
KzEzOTAsNyBAQCBzdGF0aWMgaW50IGc0eF9jb21wdXRlX2ludGVybWVkaWF0ZV93bShzdHJ1Y3Qg
aW50ZWxfY3J0Y19zdGF0ZSAqbmV3X2NydGNfc3RhdGUpCiAJY29uc3Qgc3RydWN0IGc0eF93bV9z
dGF0ZSAqYWN0aXZlID0gJm9sZF9jcnRjX3N0YXRlLT53bS5nNHgub3B0aW1hbDsKIAllbnVtIHBs
YW5lX2lkIHBsYW5lX2lkOwogCi0JaWYgKCFuZXdfY3J0Y19zdGF0ZS0+YmFzZS5hY3RpdmUgfHwg
ZHJtX2F0b21pY19jcnRjX25lZWRzX21vZGVzZXQoJm5ld19jcnRjX3N0YXRlLT5iYXNlKSkgewor
CWlmICghbmV3X2NydGNfc3RhdGUtPmh3LmFjdGl2ZSB8fCBkcm1fYXRvbWljX2NydGNfbmVlZHNf
bW9kZXNldCgmbmV3X2NydGNfc3RhdGUtPmJhc2UpKSB7CiAJCSppbnRlcm1lZGlhdGUgPSAqb3B0
aW1hbDsKIAogCQlpbnRlcm1lZGlhdGUtPmN4c3IgPSBmYWxzZTsKQEAgLTE1ODQsNyArMTU4NCw3
IEBAIHN0YXRpYyB1MTYgdmx2X2NvbXB1dGVfd21fbGV2ZWwoY29uc3Qgc3RydWN0IGludGVsX2Ny
dGNfc3RhdGUgKmNydGNfc3RhdGUsCiAJc3RydWN0IGludGVsX3BsYW5lICpwbGFuZSA9IHRvX2lu
dGVsX3BsYW5lKHBsYW5lX3N0YXRlLT5iYXNlLnBsYW5lKTsKIAlzdHJ1Y3QgZHJtX2k5MTVfcHJp
dmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KHBsYW5lLT5iYXNlLmRldik7CiAJY29uc3Qgc3RydWN0
IGRybV9kaXNwbGF5X21vZGUgKmFkanVzdGVkX21vZGUgPQotCQkmY3J0Y19zdGF0ZS0+YmFzZS5h
ZGp1c3RlZF9tb2RlOworCQkmY3J0Y19zdGF0ZS0+aHcuYWRqdXN0ZWRfbW9kZTsKIAl1bnNpZ25l
ZCBpbnQgY2xvY2ssIGh0b3RhbCwgY3BwLCB3aWR0aCwgd207CiAKIAlpZiAoZGV2X3ByaXYtPndt
LnByaV9sYXRlbmN5W2xldmVsXSA9PSAwKQpAQCAtMjAyMyw3ICsyMDIzLDcgQEAgc3RhdGljIGlu
dCB2bHZfY29tcHV0ZV9pbnRlcm1lZGlhdGVfd20oc3RydWN0IGludGVsX2NydGNfc3RhdGUgKm5l
d19jcnRjX3N0YXRlKQogCWNvbnN0IHN0cnVjdCB2bHZfd21fc3RhdGUgKmFjdGl2ZSA9ICZvbGRf
Y3J0Y19zdGF0ZS0+d20udmx2Lm9wdGltYWw7CiAJaW50IGxldmVsOwogCi0JaWYgKCFuZXdfY3J0
Y19zdGF0ZS0+YmFzZS5hY3RpdmUgfHwgZHJtX2F0b21pY19jcnRjX25lZWRzX21vZGVzZXQoJm5l
d19jcnRjX3N0YXRlLT5iYXNlKSkgeworCWlmICghbmV3X2NydGNfc3RhdGUtPmh3LmFjdGl2ZSB8
fCBkcm1fYXRvbWljX2NydGNfbmVlZHNfbW9kZXNldCgmbmV3X2NydGNfc3RhdGUtPmJhc2UpKSB7
CiAJCSppbnRlcm1lZGlhdGUgPSAqb3B0aW1hbDsKIAogCQlpbnRlcm1lZGlhdGUtPmN4c3IgPSBm
YWxzZTsKQEAgLTIxNzksNyArMjE3OSw3IEBAIHN0YXRpYyB2b2lkIGk5NjVfdXBkYXRlX3dtKHN0
cnVjdCBpbnRlbF9jcnRjICp1bnVzZWRfY3J0YykKIAkJLyogc2VsZi1yZWZyZXNoIGhhcyBtdWNo
IGhpZ2hlciBsYXRlbmN5ICovCiAJCXN0YXRpYyBjb25zdCBpbnQgc3JfbGF0ZW5jeV9ucyA9IDEy
MDAwOwogCQljb25zdCBzdHJ1Y3QgZHJtX2Rpc3BsYXlfbW9kZSAqYWRqdXN0ZWRfbW9kZSA9Ci0J
CQkmY3J0Yy0+Y29uZmlnLT5iYXNlLmFkanVzdGVkX21vZGU7CisJCQkmY3J0Yy0+Y29uZmlnLT5o
dy5hZGp1c3RlZF9tb2RlOwogCQljb25zdCBzdHJ1Y3QgZHJtX2ZyYW1lYnVmZmVyICpmYiA9CiAJ
CQljcnRjLT5iYXNlLnByaW1hcnktPnN0YXRlLT5mYjsKIAkJaW50IGNsb2NrID0gYWRqdXN0ZWRf
bW9kZS0+Y3J0Y19jbG9jazsKQEAgLTIyNjAsNyArMjI2MCw3IEBAIHN0YXRpYyB2b2lkIGk5eHhf
dXBkYXRlX3dtKHN0cnVjdCBpbnRlbF9jcnRjICp1bnVzZWRfY3J0YykKIAljcnRjID0gaW50ZWxf
Z2V0X2NydGNfZm9yX3BsYW5lKGRldl9wcml2LCBQTEFORV9BKTsKIAlpZiAoaW50ZWxfY3J0Y19h
Y3RpdmUoY3J0YykpIHsKIAkJY29uc3Qgc3RydWN0IGRybV9kaXNwbGF5X21vZGUgKmFkanVzdGVk
X21vZGUgPQotCQkJJmNydGMtPmNvbmZpZy0+YmFzZS5hZGp1c3RlZF9tb2RlOworCQkJJmNydGMt
PmNvbmZpZy0+aHcuYWRqdXN0ZWRfbW9kZTsKIAkJY29uc3Qgc3RydWN0IGRybV9mcmFtZWJ1ZmZl
ciAqZmIgPQogCQkJY3J0Yy0+YmFzZS5wcmltYXJ5LT5zdGF0ZS0+ZmI7CiAJCWludCBjcHA7CkBA
IC0yMjg3LDcgKzIyODcsNyBAQCBzdGF0aWMgdm9pZCBpOXh4X3VwZGF0ZV93bShzdHJ1Y3QgaW50
ZWxfY3J0YyAqdW51c2VkX2NydGMpCiAJY3J0YyA9IGludGVsX2dldF9jcnRjX2Zvcl9wbGFuZShk
ZXZfcHJpdiwgUExBTkVfQik7CiAJaWYgKGludGVsX2NydGNfYWN0aXZlKGNydGMpKSB7CiAJCWNv
bnN0IHN0cnVjdCBkcm1fZGlzcGxheV9tb2RlICphZGp1c3RlZF9tb2RlID0KLQkJCSZjcnRjLT5j
b25maWctPmJhc2UuYWRqdXN0ZWRfbW9kZTsKKwkJCSZjcnRjLT5jb25maWctPmh3LmFkanVzdGVk
X21vZGU7CiAJCWNvbnN0IHN0cnVjdCBkcm1fZnJhbWVidWZmZXIgKmZiID0KIAkJCWNydGMtPmJh
c2UucHJpbWFyeS0+c3RhdGUtPmZiOwogCQlpbnQgY3BwOwpAQCAtMjMzNSw3ICsyMzM1LDcgQEAg
c3RhdGljIHZvaWQgaTl4eF91cGRhdGVfd20oc3RydWN0IGludGVsX2NydGMgKnVudXNlZF9jcnRj
KQogCQkvKiBzZWxmLXJlZnJlc2ggaGFzIG11Y2ggaGlnaGVyIGxhdGVuY3kgKi8KIAkJc3RhdGlj
IGNvbnN0IGludCBzcl9sYXRlbmN5X25zID0gNjAwMDsKIAkJY29uc3Qgc3RydWN0IGRybV9kaXNw
bGF5X21vZGUgKmFkanVzdGVkX21vZGUgPQotCQkJJmVuYWJsZWQtPmNvbmZpZy0+YmFzZS5hZGp1
c3RlZF9tb2RlOworCQkJJmVuYWJsZWQtPmNvbmZpZy0+aHcuYWRqdXN0ZWRfbW9kZTsKIAkJY29u
c3Qgc3RydWN0IGRybV9mcmFtZWJ1ZmZlciAqZmIgPQogCQkJZW5hYmxlZC0+YmFzZS5wcmltYXJ5
LT5zdGF0ZS0+ZmI7CiAJCWludCBjbG9jayA9IGFkanVzdGVkX21vZGUtPmNydGNfY2xvY2s7CkBA
IC0yMzkzLDcgKzIzOTMsNyBAQCBzdGF0aWMgdm9pZCBpODQ1X3VwZGF0ZV93bShzdHJ1Y3QgaW50
ZWxfY3J0YyAqdW51c2VkX2NydGMpCiAJaWYgKGNydGMgPT0gTlVMTCkKIAkJcmV0dXJuOwogCi0J
YWRqdXN0ZWRfbW9kZSA9ICZjcnRjLT5jb25maWctPmJhc2UuYWRqdXN0ZWRfbW9kZTsKKwlhZGp1
c3RlZF9tb2RlID0gJmNydGMtPmNvbmZpZy0+aHcuYWRqdXN0ZWRfbW9kZTsKIAlwbGFuZWFfd20g
PSBpbnRlbF9jYWxjdWxhdGVfd20oYWRqdXN0ZWRfbW9kZS0+Y3J0Y19jbG9jaywKIAkJCQkgICAg
ICAgJmk4NDVfd21faW5mbywKIAkJCQkgICAgICAgZGV2X3ByaXYtPmRpc3BsYXkuZ2V0X2ZpZm9f
c2l6ZShkZXZfcHJpdiwgUExBTkVfQSksCkBAIC0yNDgzLDcgKzI0ODMsNyBAQCBzdGF0aWMgdTMy
IGlsa19jb21wdXRlX3ByaV93bShjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19z
dGF0ZSwKIAkJcmV0dXJuIG1ldGhvZDE7CiAKIAltZXRob2QyID0gaWxrX3dtX21ldGhvZDIoY3J0
Y19zdGF0ZS0+cGl4ZWxfcmF0ZSwKLQkJCQkgY3J0Y19zdGF0ZS0+YmFzZS5hZGp1c3RlZF9tb2Rl
LmNydGNfaHRvdGFsLAorCQkJCSBjcnRjX3N0YXRlLT5ody5hZGp1c3RlZF9tb2RlLmNydGNfaHRv
dGFsLAogCQkJCSBkcm1fcmVjdF93aWR0aCgmcGxhbmVfc3RhdGUtPmJhc2UuZHN0KSwKIAkJCQkg
Y3BwLCBtZW1fdmFsdWUpOwogCkBAIC0yNTExLDcgKzI1MTEsNyBAQCBzdGF0aWMgdTMyIGlsa19j
b21wdXRlX3Nwcl93bShjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSwK
IAogCW1ldGhvZDEgPSBpbGtfd21fbWV0aG9kMShjcnRjX3N0YXRlLT5waXhlbF9yYXRlLCBjcHAs
IG1lbV92YWx1ZSk7CiAJbWV0aG9kMiA9IGlsa193bV9tZXRob2QyKGNydGNfc3RhdGUtPnBpeGVs
X3JhdGUsCi0JCQkJIGNydGNfc3RhdGUtPmJhc2UuYWRqdXN0ZWRfbW9kZS5jcnRjX2h0b3RhbCwK
KwkJCQkgY3J0Y19zdGF0ZS0+aHcuYWRqdXN0ZWRfbW9kZS5jcnRjX2h0b3RhbCwKIAkJCQkgZHJt
X3JlY3Rfd2lkdGgoJnBsYW5lX3N0YXRlLT5iYXNlLmRzdCksCiAJCQkJIGNwcCwgbWVtX3ZhbHVl
KTsKIAlyZXR1cm4gbWluKG1ldGhvZDEsIG1ldGhvZDIpOwpAQCAtMjUzNiw3ICsyNTM2LDcgQEAg
c3RhdGljIHUzMiBpbGtfY29tcHV0ZV9jdXJfd20oY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3Rh
dGUgKmNydGNfc3RhdGUsCiAJY3BwID0gcGxhbmVfc3RhdGUtPmJhc2UuZmItPmZvcm1hdC0+Y3Bw
WzBdOwogCiAJcmV0dXJuIGlsa193bV9tZXRob2QyKGNydGNfc3RhdGUtPnBpeGVsX3JhdGUsCi0J
CQkgICAgICBjcnRjX3N0YXRlLT5iYXNlLmFkanVzdGVkX21vZGUuY3J0Y19odG90YWwsCisJCQkg
ICAgICBjcnRjX3N0YXRlLT5ody5hZGp1c3RlZF9tb2RlLmNydGNfaHRvdGFsLAogCQkJICAgICAg
ZHJtX3JlY3Rfd2lkdGgoJnBsYW5lX3N0YXRlLT5iYXNlLmRzdCksCiAJCQkgICAgICBjcHAsIG1l
bV92YWx1ZSk7CiB9CkBAIC0yNzYwLDEwICsyNzYwLDEwIEBAIGhzd19jb21wdXRlX2xpbmV0aW1l
X3dtKGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlKQogCWNvbnN0IHN0
cnVjdCBpbnRlbF9hdG9taWNfc3RhdGUgKmludGVsX3N0YXRlID0KIAkJdG9faW50ZWxfYXRvbWlj
X3N0YXRlKGNydGNfc3RhdGUtPmJhc2Uuc3RhdGUpOwogCWNvbnN0IHN0cnVjdCBkcm1fZGlzcGxh
eV9tb2RlICphZGp1c3RlZF9tb2RlID0KLQkJJmNydGNfc3RhdGUtPmJhc2UuYWRqdXN0ZWRfbW9k
ZTsKKwkJJmNydGNfc3RhdGUtPmh3LmFkanVzdGVkX21vZGU7CiAJdTMyIGxpbmV0aW1lLCBpcHNf
bGluZXRpbWU7CiAKLQlpZiAoIWNydGNfc3RhdGUtPmJhc2UuYWN0aXZlKQorCWlmICghY3J0Y19z
dGF0ZS0+aHcuYWN0aXZlKQogCQlyZXR1cm4gMDsKIAlpZiAoV0FSTl9PTihhZGp1c3RlZF9tb2Rl
LT5jcnRjX2Nsb2NrID09IDApKQogCQlyZXR1cm4gMDsKQEAgLTMwOTUsNyArMzA5NSw3IEBAIHN0
YXRpYyBpbnQgaWxrX2NvbXB1dGVfcGlwZV93bShzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0
Y19zdGF0ZSkKIAkJCWN1cnN0YXRlID0gcGxhbmVfc3RhdGU7CiAJfQogCi0JcGlwZV93bS0+cGlw
ZV9lbmFibGVkID0gY3J0Y19zdGF0ZS0+YmFzZS5hY3RpdmU7CisJcGlwZV93bS0+cGlwZV9lbmFi
bGVkID0gY3J0Y19zdGF0ZS0+aHcuYWN0aXZlOwogCWlmIChzcHJzdGF0ZSkgewogCQlwaXBlX3dt
LT5zcHJpdGVzX2VuYWJsZWQgPSBzcHJzdGF0ZS0+YmFzZS52aXNpYmxlOwogCQlwaXBlX3dtLT5z
cHJpdGVzX3NjYWxlZCA9IHNwcnN0YXRlLT5iYXNlLnZpc2libGUgJiYKQEAgLTMxNjgsNyArMzE2
OCw3IEBAIHN0YXRpYyBpbnQgaWxrX2NvbXB1dGVfaW50ZXJtZWRpYXRlX3dtKHN0cnVjdCBpbnRl
bF9jcnRjX3N0YXRlICpuZXdzdGF0ZSkKIAkgKiBhbmQgYWZ0ZXIgdGhlIHZibGFuay4KIAkgKi8K
IAkqYSA9IG5ld3N0YXRlLT53bS5pbGsub3B0aW1hbDsKLQlpZiAoIW5ld3N0YXRlLT5iYXNlLmFj
dGl2ZSB8fCBkcm1fYXRvbWljX2NydGNfbmVlZHNfbW9kZXNldCgmbmV3c3RhdGUtPmJhc2UpIHx8
CisJaWYgKCFuZXdzdGF0ZS0+aHcuYWN0aXZlIHx8IGRybV9hdG9taWNfY3J0Y19uZWVkc19tb2Rl
c2V0KCZuZXdzdGF0ZS0+YmFzZSkgfHwKIAkgICAgaW50ZWxfc3RhdGUtPnNraXBfaW50ZXJtZWRp
YXRlX3dtKQogCQlyZXR1cm4gMDsKIApAQCAtMzc3MCw3ICszNzcwLDcgQEAgYm9vbCBpbnRlbF9j
YW5fZW5hYmxlX3NhZ3Yoc3RydWN0IGludGVsX2F0b21pY19zdGF0ZSAqc3RhdGUpCiAJY3J0YyA9
IGludGVsX2dldF9jcnRjX2Zvcl9waXBlKGRldl9wcml2LCBwaXBlKTsKIAljcnRjX3N0YXRlID0g
dG9faW50ZWxfY3J0Y19zdGF0ZShjcnRjLT5iYXNlLnN0YXRlKTsKIAotCWlmIChjcnRjX3N0YXRl
LT5iYXNlLmFkanVzdGVkX21vZGUuZmxhZ3MgJiBEUk1fTU9ERV9GTEFHX0lOVEVSTEFDRSkKKwlp
ZiAoY3J0Y19zdGF0ZS0+aHcuYWRqdXN0ZWRfbW9kZS5mbGFncyAmIERSTV9NT0RFX0ZMQUdfSU5U
RVJMQUNFKQogCQlyZXR1cm4gZmFsc2U7CiAKIAlmb3JfZWFjaF9pbnRlbF9wbGFuZV9vbl9jcnRj
KGRldiwgY3J0YywgcGxhbmUpIHsKQEAgLTM4MjAsNyArMzgyMCw3IEBAIHN0YXRpYyB1MTYgaW50
ZWxfZ2V0X2RkYl9zaXplKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKIAlpZiAo
SU5URUxfR0VOKGRldl9wcml2KSA8IDExKQogCQlyZXR1cm4gZGRiX3NpemUgLSA0OyAvKiA0IGJs
b2NrcyBmb3IgYnlwYXNzIHBhdGggYWxsb2NhdGlvbiAqLwogCi0JYWRqdXN0ZWRfbW9kZSA9ICZj
cnRjX3N0YXRlLT5iYXNlLmFkanVzdGVkX21vZGU7CisJYWRqdXN0ZWRfbW9kZSA9ICZjcnRjX3N0
YXRlLT5ody5hZGp1c3RlZF9tb2RlOwogCXRvdGFsX2RhdGFfYncgPSB0b3RhbF9kYXRhX3JhdGUg
KiBkcm1fbW9kZV92cmVmcmVzaChhZGp1c3RlZF9tb2RlKTsKIAogCS8qCkBAIC0zODU4LDcgKzM4
NTgsNyBAQCBza2xfZGRiX2dldF9waXBlX2FsbG9jYXRpb25fbGltaXRzKHN0cnVjdCBkcm1faTkx
NV9wcml2YXRlICpkZXZfcHJpdiwKIAl1MTYgZGRiX3NpemU7CiAJdTMyIGk7CiAKLQlpZiAoV0FS
Tl9PTighc3RhdGUpIHx8ICFjcnRjX3N0YXRlLT5iYXNlLmFjdGl2ZSkgeworCWlmIChXQVJOX09O
KCFzdGF0ZSkgfHwgIWNydGNfc3RhdGUtPmh3LmFjdGl2ZSkgewogCQlhbGxvYy0+c3RhcnQgPSAw
OwogCQlhbGxvYy0+ZW5kID0gMDsKIAkJKm51bV9hY3RpdmUgPSBod2VpZ2h0OChkZXZfcHJpdi0+
YWN0aXZlX3BpcGVzKTsKQEAgLTM4OTcsMTEgKzM4OTcsMTEgQEAgc2tsX2RkYl9nZXRfcGlwZV9h
bGxvY2F0aW9uX2xpbWl0cyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCiAJICov
CiAJZm9yX2VhY2hfbmV3X2ludGVsX2NydGNfaW5fc3RhdGUoaW50ZWxfc3RhdGUsIGNydGMsIGNy
dGNfc3RhdGUsIGkpIHsKIAkJY29uc3Qgc3RydWN0IGRybV9kaXNwbGF5X21vZGUgKmFkanVzdGVk
X21vZGUgPQotCQkJJmNydGNfc3RhdGUtPmJhc2UuYWRqdXN0ZWRfbW9kZTsKKwkJCSZjcnRjX3N0
YXRlLT5ody5hZGp1c3RlZF9tb2RlOwogCQllbnVtIHBpcGUgcGlwZSA9IGNydGMtPnBpcGU7CiAJ
CWludCBoZGlzcGxheSwgdmRpc3BsYXk7CiAKLQkJaWYgKCFjcnRjX3N0YXRlLT5iYXNlLmVuYWJs
ZSkKKwkJaWYgKCFjcnRjX3N0YXRlLT5ody5lbmFibGUpCiAJCQljb250aW51ZTsKIAogCQlkcm1f
bW9kZV9nZXRfaHZfdGltaW5nKGFkanVzdGVkX21vZGUsICZoZGlzcGxheSwgJnZkaXNwbGF5KTsK
QEAgLTQyMzgsNyArNDIzOCw3IEBAIHNrbF9hbGxvY2F0ZV9waXBlX2RkYihzdHJ1Y3QgaW50ZWxf
Y3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSwKIAlpZiAoV0FSTl9PTighc3RhdGUpKQogCQlyZXR1cm4g
MDsKIAotCWlmICghY3J0Y19zdGF0ZS0+YmFzZS5hY3RpdmUpIHsKKwlpZiAoIWNydGNfc3RhdGUt
Pmh3LmFjdGl2ZSkgewogCQlhbGxvYy0+c3RhcnQgPSBhbGxvYy0+ZW5kID0gMDsKIAkJcmV0dXJu
IDA7CiAJfQpAQCAtNDQ4MCw3ICs0NDgwLDcgQEAgaW50ZWxfZ2V0X2xpbmV0aW1lX3VzKGNvbnN0
IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlKQogCXUzMiBjcnRjX2h0b3RhbDsK
IAl1aW50X2ZpeGVkXzE2XzE2X3QgbGluZXRpbWVfdXM7CiAKLQlpZiAoIWNydGNfc3RhdGUtPmJh
c2UuYWN0aXZlKQorCWlmICghY3J0Y19zdGF0ZS0+aHcuYWN0aXZlKQogCQlyZXR1cm4gdTMyX3Rv
X2ZpeGVkMTYoMCk7CiAKIAlwaXhlbF9yYXRlID0gY3J0Y19zdGF0ZS0+cGl4ZWxfcmF0ZTsKQEAg
LTQ0ODgsNyArNDQ4OCw3IEBAIGludGVsX2dldF9saW5ldGltZV91cyhjb25zdCBzdHJ1Y3QgaW50
ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSkKIAlpZiAoV0FSTl9PTihwaXhlbF9yYXRlID09IDAp
KQogCQlyZXR1cm4gdTMyX3RvX2ZpeGVkMTYoMCk7CiAKLQljcnRjX2h0b3RhbCA9IGNydGNfc3Rh
dGUtPmJhc2UuYWRqdXN0ZWRfbW9kZS5jcnRjX2h0b3RhbDsKKwljcnRjX2h0b3RhbCA9IGNydGNf
c3RhdGUtPmh3LmFkanVzdGVkX21vZGUuY3J0Y19odG90YWw7CiAJbGluZXRpbWVfdXMgPSBkaXZf
Zml4ZWQxNihjcnRjX2h0b3RhbCAqIDEwMDAsIHBpeGVsX3JhdGUpOwogCiAJcmV0dXJuIGxpbmV0
aW1lX3VzOwpAQCAtNDY3MCwxNCArNDY3MCwxNCBAQCBzdGF0aWMgdm9pZCBza2xfY29tcHV0ZV9w
bGFuZV93bShjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSwKIAltZXRo
b2QxID0gc2tsX3dtX21ldGhvZDEoZGV2X3ByaXYsIHdwLT5wbGFuZV9waXhlbF9yYXRlLAogCQkJ
CSB3cC0+Y3BwLCBsYXRlbmN5LCB3cC0+ZGJ1Zl9ibG9ja19zaXplKTsKIAltZXRob2QyID0gc2ts
X3dtX21ldGhvZDIod3AtPnBsYW5lX3BpeGVsX3JhdGUsCi0JCQkJIGNydGNfc3RhdGUtPmJhc2Uu
YWRqdXN0ZWRfbW9kZS5jcnRjX2h0b3RhbCwKKwkJCQkgY3J0Y19zdGF0ZS0+aHcuYWRqdXN0ZWRf
bW9kZS5jcnRjX2h0b3RhbCwKIAkJCQkgbGF0ZW5jeSwKIAkJCQkgd3AtPnBsYW5lX2Jsb2Nrc19w
ZXJfbGluZSk7CiAKIAlpZiAod3AtPnlfdGlsZWQpIHsKIAkJc2VsZWN0ZWRfcmVzdWx0ID0gbWF4
X2ZpeGVkMTYobWV0aG9kMiwgd3AtPnlfdGlsZV9taW5pbXVtKTsKIAl9IGVsc2UgewotCQlpZiAo
KHdwLT5jcHAgKiBjcnRjX3N0YXRlLT5iYXNlLmFkanVzdGVkX21vZGUuY3J0Y19odG90YWwgLwor
CQlpZiAoKHdwLT5jcHAgKiBjcnRjX3N0YXRlLT5ody5hZGp1c3RlZF9tb2RlLmNydGNfaHRvdGFs
IC8KIAkJICAgICB3cC0+ZGJ1Zl9ibG9ja19zaXplIDwgMSkgJiYKIAkJICAgICAod3AtPnBsYW5l
X2J5dGVzX3Blcl9saW5lIC8gd3AtPmRidWZfYmxvY2tfc2l6ZSA8IDEpKSB7CiAJCQlzZWxlY3Rl
ZF9yZXN1bHQgPSBtZXRob2QyOwotLSAKMi4yMy4wCgpfX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fXwpJbnRlbC1nZnggbWFpbGluZyBsaXN0CkludGVsLWdmeEBs
aXN0cy5mcmVlZGVza3RvcC5vcmcKaHR0cHM6Ly9saXN0cy5mcmVlZGVza3RvcC5vcmcvbWFpbG1h
bi9saXN0aW5mby9pbnRlbC1nZng=

Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 9D669280259
	for <lists+intel-gfx@lfdr.de>; Thu,  1 Oct 2020 17:17:15 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id E588A6E8B8;
	Thu,  1 Oct 2020 15:17:13 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from mga12.intel.com (mga12.intel.com [192.55.52.136])
 by gabe.freedesktop.org (Postfix) with ESMTPS id BA83A6E8B8
 for <intel-gfx@lists.freedesktop.org>; Thu,  1 Oct 2020 15:17:12 +0000 (UTC)
IronPort-SDR: PgOLM1EvpGZORKm1TcjAbjbAEqJI1VImw785UMpV8MRDnjxoPKJcSMhBtUYZzAH+k12mMNLdsn
 j6rPPcKajlSQ==
X-IronPort-AV: E=McAfee;i="6000,8403,9761"; a="142151334"
X-IronPort-AV: E=Sophos;i="5.77,323,1596524400"; d="scan'208";a="142151334"
X-Amp-Result: SKIPPED(no attachment in message)
X-Amp-File-Uploaded: False
Received: from fmsmga008.fm.intel.com ([10.253.24.58])
 by fmsmga106.fm.intel.com with ESMTP/TLS/ECDHE-RSA-AES256-GCM-SHA384;
 01 Oct 2020 08:16:51 -0700
IronPort-SDR: 2K0HcJz/GzLb5yOJq/ZLSMCgRywpD+ZS9F9z6PxJOZZfg7qqeGpa4KCa1kGFsjjHqT+Vff9OoN
 atqbNpFzkyXA==
X-ExtLoop1: 1
X-IronPort-AV: E=Sophos;i="5.77,323,1596524400"; d="scan'208";a="295012206"
Received: from stinkbox.fi.intel.com (HELO stinkbox) ([10.237.72.174])
 by fmsmga008.fm.intel.com with SMTP; 01 Oct 2020 08:16:46 -0700
Received: by stinkbox (sSMTP sendmail emulation);
 Thu, 01 Oct 2020 18:16:46 +0300
From: Ville Syrjala <ville.syrjala@linux.intel.com>
To: intel-gfx@lists.freedesktop.org
Date: Thu,  1 Oct 2020 18:16:37 +0300
Message-Id: <20201001151640.14590-3-ville.syrjala@linux.intel.com>
X-Mailer: git-send-email 2.26.2
In-Reply-To: <20201001151640.14590-1-ville.syrjala@linux.intel.com>
References: <20201001151640.14590-1-ville.syrjala@linux.intel.com>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH v2 3/6] drm/i915: Replace the VLV/CHV eDP reboot
 notifier with the .shutdown() hook
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.29
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

RnJvbTogVmlsbGUgU3lyasOkbMOkIDx2aWxsZS5zeXJqYWxhQGxpbnV4LmludGVsLmNvbT4KCkN1
cnJlbnRseSBWTFYvQ0hWIHVzZSBhIHJlYm9vdCBub3RpZmllciB0byBtYWtlIHN1cmUgdGhlIHBh
bmVsCnBvd2VyIGN5Y2xlIGRlbGF5IGlzbid0IHZpb2xhdGVkIGFjcm9zcyBhIHN5c3RlbSByZWJv
b3QuIFJlcGxhY2UKdGhhdCB3aXRoIHRoZSBuZXcgZW5jb2RlciAuc2h1dGRvd24oKSBob29rLgoK
QW5kIGxldCdzIGFsc28gc3RvcCBvdmVycmlkaW5nIHRoZSBwb3dlciBjeWNsZSBkZWxheSB3aXRo
IHRoZQptYXggdmFsdWUuIE5vIGlkZWEgd2h5IHRoZSBjdXJyZW50IGNvZGUgZG9lcyB0aGF0LiBU
aGUgYWxyZWFkeQpwcm9ncmFtbWVkIGRlbGF5IHNob3VsZCBiZSBjb3JyZWN0LgoKU2lnbmVkLW9m
Zi1ieTogVmlsbGUgU3lyasOkbMOkIDx2aWxsZS5zeXJqYWxhQGxpbnV4LmludGVsLmNvbT4KLS0t
CiAuLi4vZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kaXNwbGF5X3R5cGVzLmggICAgfCAgMiAtCiBk
cml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2RwLmMgICAgICAgfCA1OCArKysrKy0t
LS0tLS0tLS0tLS0tCiAyIGZpbGVzIGNoYW5nZWQsIDE0IGluc2VydGlvbnMoKyksIDQ2IGRlbGV0
aW9ucygtKQoKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxf
ZGlzcGxheV90eXBlcy5oIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kaXNw
bGF5X3R5cGVzLmgKaW5kZXggNmYzZTNkNzU2MzgzLi45YjllZDFhMmY0MTIgMTAwNjQ0Ci0tLSBh
L2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZGlzcGxheV90eXBlcy5oCisrKyBi
L2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZGlzcGxheV90eXBlcy5oCkBAIC0x
MzE5LDggKzEzMTksNiBAQCBzdHJ1Y3QgaW50ZWxfZHAgewogCXVuc2lnbmVkIGxvbmcgbGFzdF9i
YWNrbGlnaHRfb2ZmOwogCWt0aW1lX3QgcGFuZWxfcG93ZXJfb2ZmX3RpbWU7CiAKLQlzdHJ1Y3Qg
bm90aWZpZXJfYmxvY2sgZWRwX25vdGlmaWVyOwotCiAJLyoKIAkgKiBQaXBlIHdob3NlIHBvd2Vy
IHNlcXVlbmNlciBpcyBjdXJyZW50bHkgbG9ja2VkIGludG8KIAkgKiB0aGlzIHBvcnQuIE9ubHkg
cmVsZXZhbnQgb24gVkxWL0NIVi4KZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rp
c3BsYXkvaW50ZWxfZHAuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZHAu
YwppbmRleCA3MGUwYjg1NDQyZjkuLmUwZjJlOTIzNjc4NSAxMDA2NDQKLS0tIGEvZHJpdmVycy9n
cHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kcC5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1
L2Rpc3BsYXkvaW50ZWxfZHAuYwpAQCAtMjgsNyArMjgsNiBAQAogI2luY2x1ZGUgPGxpbnV4L2V4
cG9ydC5oPgogI2luY2x1ZGUgPGxpbnV4L2kyYy5oPgogI2luY2x1ZGUgPGxpbnV4L25vdGlmaWVy
Lmg+Ci0jaW5jbHVkZSA8bGludXgvcmVib290Lmg+CiAjaW5jbHVkZSA8bGludXgvc2xhYi5oPgog
I2luY2x1ZGUgPGxpbnV4L3R5cGVzLmg+CiAKQEAgLTExOTEsNDEgKzExOTAsNiBAQCBfcHBfc3Rh
dF9yZWcoc3RydWN0IGludGVsX2RwICppbnRlbF9kcCkKIAlyZXR1cm4gcmVncy5wcF9zdGF0Owog
fQogCi0vKiBSZWJvb3Qgbm90aWZpZXIgaGFuZGxlciB0byBzaHV0ZG93biBwYW5lbCBwb3dlciB0
byBndWFyYW50ZWUgVDEyIHRpbWluZwotICAgVGhpcyBmdW5jdGlvbiBvbmx5IGFwcGxpY2FibGUg
d2hlbiBwYW5lbCBQTSBzdGF0ZSBpcyBub3QgdG8gYmUgdHJhY2tlZCAqLwotc3RhdGljIGludCBl
ZHBfbm90aWZ5X2hhbmRsZXIoc3RydWN0IG5vdGlmaWVyX2Jsb2NrICp0aGlzLCB1bnNpZ25lZCBs
b25nIGNvZGUsCi0JCQkgICAgICB2b2lkICp1bnVzZWQpCi17Ci0Jc3RydWN0IGludGVsX2RwICpp
bnRlbF9kcCA9IGNvbnRhaW5lcl9vZih0aGlzLCB0eXBlb2YoKiBpbnRlbF9kcCksCi0JCQkJCQkg
ZWRwX25vdGlmaWVyKTsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSBkcF90
b19pOTE1KGludGVsX2RwKTsKLQlpbnRlbF93YWtlcmVmX3Qgd2FrZXJlZjsKLQotCWlmICghaW50
ZWxfZHBfaXNfZWRwKGludGVsX2RwKSB8fCBjb2RlICE9IFNZU19SRVNUQVJUKQotCQlyZXR1cm4g
MDsKLQotCXdpdGhfcHBzX2xvY2soaW50ZWxfZHAsIHdha2VyZWYpIHsKLQkJaWYgKElTX1ZBTExF
WVZJRVcoZGV2X3ByaXYpIHx8IElTX0NIRVJSWVZJRVcoZGV2X3ByaXYpKSB7Ci0JCQllbnVtIHBp
cGUgcGlwZSA9IHZsdl9wb3dlcl9zZXF1ZW5jZXJfcGlwZShpbnRlbF9kcCk7Ci0JCQlpOTE1X3Jl
Z190IHBwX2N0cmxfcmVnLCBwcF9kaXZfcmVnOwotCQkJdTMyIHBwX2RpdjsKLQotCQkJcHBfY3Ry
bF9yZWcgPSBQUF9DT05UUk9MKHBpcGUpOwotCQkJcHBfZGl2X3JlZyAgPSBQUF9ESVZJU09SKHBp
cGUpOwotCQkJcHBfZGl2ID0gaW50ZWxfZGVfcmVhZChkZXZfcHJpdiwgcHBfZGl2X3JlZyk7Ci0J
CQlwcF9kaXYgJj0gUFBfUkVGRVJFTkNFX0RJVklERVJfTUFTSzsKLQotCQkJLyogMHgxRiB3cml0
ZSB0byBQUF9ESVZfUkVHIHNldHMgbWF4IGN5Y2xlIGRlbGF5ICovCi0JCQlpbnRlbF9kZV93cml0
ZShkZXZfcHJpdiwgcHBfZGl2X3JlZywgcHBfZGl2IHwgMHgxRik7Ci0JCQlpbnRlbF9kZV93cml0
ZShkZXZfcHJpdiwgcHBfY3RybF9yZWcsCi0JCQkJICAgICAgIFBBTkVMX1VOTE9DS19SRUdTKTsK
LQkJCW1zbGVlcChpbnRlbF9kcC0+cGFuZWxfcG93ZXJfY3ljbGVfZGVsYXkpOwotCQl9Ci0JfQot
Ci0JcmV0dXJuIDA7Ci19Ci0KIHN0YXRpYyBib29sIGVkcF9oYXZlX3BhbmVsX3Bvd2VyKHN0cnVj
dCBpbnRlbF9kcCAqaW50ZWxfZHApCiB7CiAJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9w
cml2ID0gZHBfdG9faTkxNShpbnRlbF9kcCk7CkBAIC02NjkwLDExICs2NjU0LDYgQEAgdm9pZCBp
bnRlbF9kcF9lbmNvZGVyX2ZsdXNoX3dvcmsoc3RydWN0IGRybV9lbmNvZGVyICplbmNvZGVyKQog
CQkgKi8KIAkJd2l0aF9wcHNfbG9jayhpbnRlbF9kcCwgd2FrZXJlZikKIAkJCWVkcF9wYW5lbF92
ZGRfb2ZmX3N5bmMoaW50ZWxfZHApOwotCi0JCWlmIChpbnRlbF9kcC0+ZWRwX25vdGlmaWVyLm5v
dGlmaWVyX2NhbGwpIHsKLQkJCXVucmVnaXN0ZXJfcmVib290X25vdGlmaWVyKCZpbnRlbF9kcC0+
ZWRwX25vdGlmaWVyKTsKLQkJCWludGVsX2RwLT5lZHBfbm90aWZpZXIubm90aWZpZXJfY2FsbCA9
IE5VTEw7Ci0JCX0KIAl9CiAKIAlpbnRlbF9kcF9hdXhfZmluaShpbnRlbF9kcCk7CkBAIC02NzI1
LDYgKzY2ODQsMTggQEAgdm9pZCBpbnRlbF9kcF9lbmNvZGVyX3N1c3BlbmQoc3RydWN0IGludGVs
X2VuY29kZXIgKmludGVsX2VuY29kZXIpCiAJCWVkcF9wYW5lbF92ZGRfb2ZmX3N5bmMoaW50ZWxf
ZHApOwogfQogCitzdGF0aWMgdm9pZCBpbnRlbF9kcF9lbmNvZGVyX3NodXRkb3duKHN0cnVjdCBp
bnRlbF9lbmNvZGVyICppbnRlbF9lbmNvZGVyKQoreworCXN0cnVjdCBpbnRlbF9kcCAqaW50ZWxf
ZHAgPSBlbmNfdG9faW50ZWxfZHAoaW50ZWxfZW5jb2Rlcik7CisJaW50ZWxfd2FrZXJlZl90IHdh
a2VyZWY7CisKKwlpZiAoIWludGVsX2RwX2lzX2VkcChpbnRlbF9kcCkpCisJCXJldHVybjsKKwor
CXdpdGhfcHBzX2xvY2soaW50ZWxfZHAsIHdha2VyZWYpCisJCXdhaXRfcGFuZWxfcG93ZXJfY3lj
bGUoaW50ZWxfZHApOworfQorCiBzdGF0aWMgdm9pZCBpbnRlbF9lZHBfcGFuZWxfdmRkX3Nhbml0
aXplKHN0cnVjdCBpbnRlbF9kcCAqaW50ZWxfZHApCiB7CiAJc3RydWN0IGRybV9pOTE1X3ByaXZh
dGUgKmRldl9wcml2ID0gZHBfdG9faTkxNShpbnRlbF9kcCk7CkBAIC03ODM4LDkgKzc4MDksNiBA
QCBzdGF0aWMgYm9vbCBpbnRlbF9lZHBfaW5pdF9jb25uZWN0b3Ioc3RydWN0IGludGVsX2RwICpp
bnRlbF9kcCwKIAltdXRleF91bmxvY2soJmRldi0+bW9kZV9jb25maWcubXV0ZXgpOwogCiAJaWYg
KElTX1ZBTExFWVZJRVcoZGV2X3ByaXYpIHx8IElTX0NIRVJSWVZJRVcoZGV2X3ByaXYpKSB7Ci0J
CWludGVsX2RwLT5lZHBfbm90aWZpZXIubm90aWZpZXJfY2FsbCA9IGVkcF9ub3RpZnlfaGFuZGxl
cjsKLQkJcmVnaXN0ZXJfcmVib290X25vdGlmaWVyKCZpbnRlbF9kcC0+ZWRwX25vdGlmaWVyKTsK
LQogCQkvKgogCQkgKiBGaWd1cmUgb3V0IHRoZSBjdXJyZW50IHBpcGUgZm9yIHRoZSBpbml0aWFs
IGJhY2tsaWdodCBzZXR1cC4KIAkJICogSWYgdGhlIGN1cnJlbnQgcGlwZSBpc24ndCB2YWxpZCwg
dHJ5IHRoZSBQUFMgcGlwZSwgYW5kIGlmIHRoYXQKQEAgLTgwNjEsNiArODAyOSw4IEBAIGJvb2wg
aW50ZWxfZHBfaW5pdChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCiAJaW50ZWxf
ZW5jb2Rlci0+Z2V0X2NvbmZpZyA9IGludGVsX2RwX2dldF9jb25maWc7CiAJaW50ZWxfZW5jb2Rl
ci0+dXBkYXRlX3BpcGUgPSBpbnRlbF9wYW5lbF91cGRhdGVfYmFja2xpZ2h0OwogCWludGVsX2Vu
Y29kZXItPnN1c3BlbmQgPSBpbnRlbF9kcF9lbmNvZGVyX3N1c3BlbmQ7CisJaWYgKElTX1ZBTExF
WVZJRVcoZGV2X3ByaXYpIHx8IElTX0NIRVJSWVZJRVcoZGV2X3ByaXYpKQorCQlpbnRlbF9lbmNv
ZGVyLT5zaHV0ZG93biA9IGludGVsX2RwX2VuY29kZXJfc2h1dGRvd247CiAJaWYgKElTX0NIRVJS
WVZJRVcoZGV2X3ByaXYpKSB7CiAJCWludGVsX2VuY29kZXItPnByZV9wbGxfZW5hYmxlID0gY2h2
X2RwX3ByZV9wbGxfZW5hYmxlOwogCQlpbnRlbF9lbmNvZGVyLT5wcmVfZW5hYmxlID0gY2h2X3By
ZV9lbmFibGVfZHA7Ci0tIAoyLjI2LjIKCl9fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fCkludGVsLWdmeCBtYWlsaW5nIGxpc3QKSW50ZWwtZ2Z4QGxpc3RzLmZy
ZWVkZXNrdG9wLm9yZwpodHRwczovL2xpc3RzLmZyZWVkZXNrdG9wLm9yZy9tYWlsbWFuL2xpc3Rp
bmZvL2ludGVsLWdmeAo=

Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id CB582E823D
	for <lists+intel-gfx@lfdr.de>; Tue, 29 Oct 2019 08:22:47 +0100 (CET)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 13FF36E0F2;
	Tue, 29 Oct 2019 07:22:43 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from mblankhorst.nl (mblankhorst.nl
 [IPv6:2a02:2308::216:3eff:fe92:dfa3])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 42C3E6E0D3
 for <intel-gfx@lists.freedesktop.org>; Tue, 29 Oct 2019 07:22:37 +0000 (UTC)
From: Maarten Lankhorst <maarten.lankhorst@linux.intel.com>
To: intel-gfx@lists.freedesktop.org
Date: Tue, 29 Oct 2019 08:22:28 +0100
Message-Id: <20191029072229.27092-11-maarten.lankhorst@linux.intel.com>
X-Mailer: git-send-email 2.23.0
In-Reply-To: <20191029072229.27092-1-maarten.lankhorst@linux.intel.com>
References: <20191029072229.27092-1-maarten.lankhorst@linux.intel.com>
MIME-Version: 1.0
Subject: [Intel-gfx] [CI 11/12] drm/i915: Perform automated conversions for
 plane uapi/hw split, base -> uapi.
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

U3BsaXQgdXAgcGxhbmVfc3RhdGUtPmJhc2UgdG8gdWFwaS4gVGhpcyBpcyBkb25lIHVzaW5nIHRo
ZSBmb2xsb3dpbmcgcGF0Y2gsCnJhbiBhZnRlciB0aGUgcHJldmlvdXMgY29tbWl0IHRoYXQgc3Bs
aXRzIG91dCBhbnkgaHcgcmVmZXJlbmNlczoKCkBACnN0cnVjdCBpbnRlbF9wbGFuZV9zdGF0ZSAq
VDsKaWRlbnRpZmllciB4OwpAQAotVC0+YmFzZS54CitULT51YXBpLngKCkBACnN0cnVjdCBpbnRl
bF9wbGFuZV9zdGF0ZSAqVDsKQEAKLVQtPmJhc2UKK1QtPnVhcGkKClNpZ25lZC1vZmYtYnk6IE1h
YXJ0ZW4gTGFua2hvcnN0IDxtYWFydGVuLmxhbmtob3JzdEBsaW51eC5pbnRlbC5jb20+Ci0tLQog
ZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9hdG9taWMuYyAgIHwgICAyICstCiAu
Li4vZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfYXRvbWljX3BsYW5lLmMgfCAgMzIgKy0KIGRy
aXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZGlzcGxheS5jICB8IDI5OCArKysrKysr
KystLS0tLS0tLS0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZmJjLmMgICAg
ICB8ICAxMiArLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9vdmVybGF5LmMg
IHwgICAyICstCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX3Nwcml0ZS5jICAg
fCAxMzYgKysrKy0tLS0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2ludGVsX3BtLmMgICAgICAgICAg
ICAgICB8ICA1NyArKy0tCiA3IGZpbGVzIGNoYW5nZWQsIDI3MSBpbnNlcnRpb25zKCspLCAyNjgg
ZGVsZXRpb25zKC0pCgpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9p
bnRlbF9hdG9taWMuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfYXRvbWlj
LmMKaW5kZXggZmI0MTI2ZGU5OTRkLi5jYjVjOTE0ZjYyN2YgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMv
Z3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfYXRvbWljLmMKKysrIGIvZHJpdmVycy9ncHUvZHJt
L2k5MTUvZGlzcGxheS9pbnRlbF9hdG9taWMuYwpAQCAtMjk5LDcgKzI5OSw3IEBAIHN0YXRpYyB2
b2lkIGludGVsX2F0b21pY19zZXR1cF9zY2FsZXIoc3RydWN0IGludGVsX2NydGNfc2NhbGVyX3N0
YXRlICpzY2FsZXJfc3RhCiAJaWYgKHBsYW5lX3N0YXRlICYmIHBsYW5lX3N0YXRlLT5ody5mYiAm
JgogCSAgICBwbGFuZV9zdGF0ZS0+aHcuZmItPmZvcm1hdC0+aXNfeXV2ICYmCiAJICAgIHBsYW5l
X3N0YXRlLT5ody5mYi0+Zm9ybWF0LT5udW1fcGxhbmVzID4gMSkgewotCQlzdHJ1Y3QgaW50ZWxf
cGxhbmUgKnBsYW5lID0gdG9faW50ZWxfcGxhbmUocGxhbmVfc3RhdGUtPmJhc2UucGxhbmUpOwor
CQlzdHJ1Y3QgaW50ZWxfcGxhbmUgKnBsYW5lID0gdG9faW50ZWxfcGxhbmUocGxhbmVfc3RhdGUt
PnVhcGkucGxhbmUpOwogCQlpZiAoSVNfR0VOKGRldl9wcml2LCA5KSAmJgogCQkgICAgIUlTX0dF
TUlOSUxBS0UoZGV2X3ByaXYpKSB7CiAJCQltb2RlID0gU0tMX1BTX1NDQUxFUl9NT0RFX05WMTI7
CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2F0b21pY19w
bGFuZS5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9hdG9taWNfcGxhbmUu
YwppbmRleCBjYWMxZDZhZTY3ZjYuLmJhN2Q1NDIxZjc5MSAxMDA2NDQKLS0tIGEvZHJpdmVycy9n
cHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9hdG9taWNfcGxhbmUuYworKysgYi9kcml2ZXJzL2dw
dS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2F0b21pY19wbGFuZS5jCkBAIC01Niw3ICs1Niw3IEBA
IHN0cnVjdCBpbnRlbF9wbGFuZSAqaW50ZWxfcGxhbmVfYWxsb2Modm9pZCkKIAkJcmV0dXJuIEVS
Ul9QVFIoLUVOT01FTSk7CiAJfQogCi0JX19kcm1fYXRvbWljX2hlbHBlcl9wbGFuZV9yZXNldCgm
cGxhbmUtPmJhc2UsICZwbGFuZV9zdGF0ZS0+YmFzZSk7CisJX19kcm1fYXRvbWljX2hlbHBlcl9w
bGFuZV9yZXNldCgmcGxhbmUtPmJhc2UsICZwbGFuZV9zdGF0ZS0+dWFwaSk7CiAJcGxhbmVfc3Rh
dGUtPnNjYWxlcl9pZCA9IC0xOwogCiAJcmV0dXJuIHBsYW5lOwpAQCAtODgsMTIgKzg4LDEyIEBA
IGludGVsX3BsYW5lX2R1cGxpY2F0ZV9zdGF0ZShzdHJ1Y3QgZHJtX3BsYW5lICpwbGFuZSkKIAlp
ZiAoIWludGVsX3N0YXRlKQogCQlyZXR1cm4gTlVMTDsKIAotCV9fZHJtX2F0b21pY19oZWxwZXJf
cGxhbmVfZHVwbGljYXRlX3N0YXRlKHBsYW5lLCAmaW50ZWxfc3RhdGUtPmJhc2UpOworCV9fZHJt
X2F0b21pY19oZWxwZXJfcGxhbmVfZHVwbGljYXRlX3N0YXRlKHBsYW5lLCAmaW50ZWxfc3RhdGUt
PnVhcGkpOwogCiAJaW50ZWxfc3RhdGUtPnZtYSA9IE5VTEw7CiAJaW50ZWxfc3RhdGUtPmZsYWdz
ID0gMDsKIAotCXJldHVybiAmaW50ZWxfc3RhdGUtPmJhc2U7CisJcmV0dXJuICZpbnRlbF9zdGF0
ZS0+dWFwaTsKIH0KIAogLyoqCkBAIC0xMTEsNyArMTExLDcgQEAgaW50ZWxfcGxhbmVfZGVzdHJv
eV9zdGF0ZShzdHJ1Y3QgZHJtX3BsYW5lICpwbGFuZSwKIAlzdHJ1Y3QgaW50ZWxfcGxhbmVfc3Rh
dGUgKnBsYW5lX3N0YXRlID0gdG9faW50ZWxfcGxhbmVfc3RhdGUoc3RhdGUpOwogCVdBUk5fT04o
cGxhbmVfc3RhdGUtPnZtYSk7CiAKLQlfX2RybV9hdG9taWNfaGVscGVyX3BsYW5lX2Rlc3Ryb3lf
c3RhdGUoJnBsYW5lX3N0YXRlLT5iYXNlKTsKKwlfX2RybV9hdG9taWNfaGVscGVyX3BsYW5lX2Rl
c3Ryb3lfc3RhdGUoJnBsYW5lX3N0YXRlLT51YXBpKTsKIAlrZnJlZShwbGFuZV9zdGF0ZSk7CiB9
CiAKQEAgLTEyMSw3ICsxMjEsNyBAQCB1bnNpZ25lZCBpbnQgaW50ZWxfcGxhbmVfZGF0YV9yYXRl
KGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlLAogCWNvbnN0IHN0cnVj
dCBkcm1fZnJhbWVidWZmZXIgKmZiID0gcGxhbmVfc3RhdGUtPmh3LmZiOwogCXVuc2lnbmVkIGlu
dCBjcHA7CiAKLQlpZiAoIXBsYW5lX3N0YXRlLT5iYXNlLnZpc2libGUpCisJaWYgKCFwbGFuZV9z
dGF0ZS0+dWFwaS52aXNpYmxlKQogCQlyZXR1cm4gMDsKIAogCWNwcCA9IGZiLT5mb3JtYXQtPmNw
cFswXTsKQEAgLTE0NCwxMCArMTQ0LDEwIEBAIGJvb2wgaW50ZWxfcGxhbmVfY2FsY19taW5fY2Rj
bGsoc3RydWN0IGludGVsX2F0b21pY19zdGF0ZSAqc3RhdGUsCiAJc3RydWN0IGRybV9pOTE1X3By
aXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShwbGFuZS0+YmFzZS5kZXYpOwogCWNvbnN0IHN0cnVj
dCBpbnRlbF9wbGFuZV9zdGF0ZSAqcGxhbmVfc3RhdGUgPQogCQlpbnRlbF9hdG9taWNfZ2V0X25l
d19wbGFuZV9zdGF0ZShzdGF0ZSwgcGxhbmUpOwotCXN0cnVjdCBpbnRlbF9jcnRjICpjcnRjID0g
dG9faW50ZWxfY3J0YyhwbGFuZV9zdGF0ZS0+YmFzZS5jcnRjKTsKKwlzdHJ1Y3QgaW50ZWxfY3J0
YyAqY3J0YyA9IHRvX2ludGVsX2NydGMocGxhbmVfc3RhdGUtPnVhcGkuY3J0Yyk7CiAJc3RydWN0
IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGU7CiAKLQlpZiAoIXBsYW5lX3N0YXRlLT5iYXNl
LnZpc2libGUgfHwgIXBsYW5lLT5taW5fY2RjbGspCisJaWYgKCFwbGFuZV9zdGF0ZS0+dWFwaS52
aXNpYmxlIHx8ICFwbGFuZS0+bWluX2NkY2xrKQogCQlyZXR1cm4gZmFsc2U7CiAKIAljcnRjX3N0
YXRlID0gaW50ZWxfYXRvbWljX2dldF9uZXdfY3J0Y19zdGF0ZShzdGF0ZSwgY3J0Yyk7CkBAIC0x
ODEsNyArMTgxLDcgQEAgaW50IGludGVsX3BsYW5lX2F0b21pY19jaGVja193aXRoX3N0YXRlKGNv
bnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpvbGRfY3J0Y18KIAkJCQkJY29uc3Qgc3RydWN0
IGludGVsX3BsYW5lX3N0YXRlICpvbGRfcGxhbmVfc3RhdGUsCiAJCQkJCXN0cnVjdCBpbnRlbF9w
bGFuZV9zdGF0ZSAqbmV3X3BsYW5lX3N0YXRlKQogewotCXN0cnVjdCBpbnRlbF9wbGFuZSAqcGxh
bmUgPSB0b19pbnRlbF9wbGFuZShuZXdfcGxhbmVfc3RhdGUtPmJhc2UucGxhbmUpOworCXN0cnVj
dCBpbnRlbF9wbGFuZSAqcGxhbmUgPSB0b19pbnRlbF9wbGFuZShuZXdfcGxhbmVfc3RhdGUtPnVh
cGkucGxhbmUpOwogCWNvbnN0IHN0cnVjdCBkcm1fZnJhbWVidWZmZXIgKmZiID0gbmV3X3BsYW5l
X3N0YXRlLT5ody5mYjsKIAlpbnQgcmV0OwogCkBAIC0xOTAsNyArMTkwLDcgQEAgaW50IGludGVs
X3BsYW5lX2F0b21pY19jaGVja193aXRoX3N0YXRlKGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0
YXRlICpvbGRfY3J0Y18KIAluZXdfY3J0Y19zdGF0ZS0+YzhfcGxhbmVzICY9IH5CSVQocGxhbmUt
PmlkKTsKIAluZXdfY3J0Y19zdGF0ZS0+ZGF0YV9yYXRlW3BsYW5lLT5pZF0gPSAwOwogCW5ld19j
cnRjX3N0YXRlLT5taW5fY2RjbGtbcGxhbmUtPmlkXSA9IDA7Ci0JbmV3X3BsYW5lX3N0YXRlLT5i
YXNlLnZpc2libGUgPSBmYWxzZTsKKwluZXdfcGxhbmVfc3RhdGUtPnVhcGkudmlzaWJsZSA9IGZh
bHNlOwogCiAJaWYgKCFuZXdfcGxhbmVfc3RhdGUtPmh3LmNydGMgJiYgIW9sZF9wbGFuZV9zdGF0
ZS0+aHcuY3J0YykKIAkJcmV0dXJuIDA7CkBAIC0yMDAsMTggKzIwMCwxOCBAQCBpbnQgaW50ZWxf
cGxhbmVfYXRvbWljX2NoZWNrX3dpdGhfc3RhdGUoY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3Rh
dGUgKm9sZF9jcnRjXwogCQlyZXR1cm4gcmV0OwogCiAJLyogRklYTUUgcHJlLWc0eCBkb24ndCB3
b3JrIGxpa2UgdGhpcyAqLwotCWlmIChuZXdfcGxhbmVfc3RhdGUtPmJhc2UudmlzaWJsZSkKKwlp
ZiAobmV3X3BsYW5lX3N0YXRlLT51YXBpLnZpc2libGUpCiAJCW5ld19jcnRjX3N0YXRlLT5hY3Rp
dmVfcGxhbmVzIHw9IEJJVChwbGFuZS0+aWQpOwogCi0JaWYgKG5ld19wbGFuZV9zdGF0ZS0+YmFz
ZS52aXNpYmxlICYmCisJaWYgKG5ld19wbGFuZV9zdGF0ZS0+dWFwaS52aXNpYmxlICYmCiAJICAg
IGRybV9mb3JtYXRfaW5mb19pc195dXZfc2VtaXBsYW5hcihmYi0+Zm9ybWF0KSkKIAkJbmV3X2Ny
dGNfc3RhdGUtPm52MTJfcGxhbmVzIHw9IEJJVChwbGFuZS0+aWQpOwogCi0JaWYgKG5ld19wbGFu
ZV9zdGF0ZS0+YmFzZS52aXNpYmxlICYmCisJaWYgKG5ld19wbGFuZV9zdGF0ZS0+dWFwaS52aXNp
YmxlICYmCiAJICAgIGZiLT5mb3JtYXQtPmZvcm1hdCA9PSBEUk1fRk9STUFUX0M4KQogCQluZXdf
Y3J0Y19zdGF0ZS0+YzhfcGxhbmVzIHw9IEJJVChwbGFuZS0+aWQpOwogCi0JaWYgKG5ld19wbGFu
ZV9zdGF0ZS0+YmFzZS52aXNpYmxlIHx8IG9sZF9wbGFuZV9zdGF0ZS0+YmFzZS52aXNpYmxlKQor
CWlmIChuZXdfcGxhbmVfc3RhdGUtPnVhcGkudmlzaWJsZSB8fCBvbGRfcGxhbmVfc3RhdGUtPnVh
cGkudmlzaWJsZSkKIAkJbmV3X2NydGNfc3RhdGUtPnVwZGF0ZV9wbGFuZXMgfD0gQklUKHBsYW5l
LT5pZCk7CiAKIAluZXdfY3J0Y19zdGF0ZS0+ZGF0YV9yYXRlW3BsYW5lLT5pZF0gPQpAQCAtMjQ2
LDcgKzI0Niw3IEBAIGludCBpbnRlbF9wbGFuZV9hdG9taWNfY2hlY2soc3RydWN0IGludGVsX2F0
b21pY19zdGF0ZSAqc3RhdGUsCiAJY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKm9sZF9j
cnRjX3N0YXRlOwogCXN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpuZXdfY3J0Y19zdGF0ZTsKIAot
CW5ld19wbGFuZV9zdGF0ZS0+YmFzZS52aXNpYmxlID0gZmFsc2U7CisJbmV3X3BsYW5lX3N0YXRl
LT51YXBpLnZpc2libGUgPSBmYWxzZTsKIAlpZiAoIWNydGMpCiAJCXJldHVybiAwOwogCkBAIC0z
NTUsNyArMzU1LDcgQEAgdm9pZCBza2xfdXBkYXRlX3BsYW5lc19vbl9jcnRjKHN0cnVjdCBpbnRl
bF9hdG9taWNfc3RhdGUgKnN0YXRlLAogCQlzdHJ1Y3QgaW50ZWxfcGxhbmVfc3RhdGUgKm5ld19w
bGFuZV9zdGF0ZSA9CiAJCQlpbnRlbF9hdG9taWNfZ2V0X25ld19wbGFuZV9zdGF0ZShzdGF0ZSwg
cGxhbmUpOwogCi0JCWlmIChuZXdfcGxhbmVfc3RhdGUtPmJhc2UudmlzaWJsZSkgeworCQlpZiAo
bmV3X3BsYW5lX3N0YXRlLT51YXBpLnZpc2libGUpIHsKIAkJCWludGVsX3VwZGF0ZV9wbGFuZShw
bGFuZSwgbmV3X2NydGNfc3RhdGUsIG5ld19wbGFuZV9zdGF0ZSk7CiAJCX0gZWxzZSBpZiAobmV3
X3BsYW5lX3N0YXRlLT5wbGFuYXJfc2xhdmUpIHsKIAkJCXN0cnVjdCBpbnRlbF9wbGFuZSAqbWFz
dGVyID0KQEAgLTM5NSw3ICszOTUsNyBAQCB2b2lkIGk5eHhfdXBkYXRlX3BsYW5lc19vbl9jcnRj
KHN0cnVjdCBpbnRlbF9hdG9taWNfc3RhdGUgKnN0YXRlLAogCQkgICAgISh1cGRhdGVfbWFzayAm
IEJJVChwbGFuZS0+aWQpKSkKIAkJCWNvbnRpbnVlOwogCi0JCWlmIChuZXdfcGxhbmVfc3RhdGUt
PmJhc2UudmlzaWJsZSkKKwkJaWYgKG5ld19wbGFuZV9zdGF0ZS0+dWFwaS52aXNpYmxlKQogCQkJ
aW50ZWxfdXBkYXRlX3BsYW5lKHBsYW5lLCBuZXdfY3J0Y19zdGF0ZSwgbmV3X3BsYW5lX3N0YXRl
KTsKIAkJZWxzZQogCQkJaW50ZWxfZGlzYWJsZV9wbGFuZShwbGFuZSwgbmV3X2NydGNfc3RhdGUp
OwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kaXNwbGF5
LmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2Rpc3BsYXkuYwppbmRleCBm
YmJlNmY3NTI3MTYuLjkxYTA1OWU1ZmRjYiAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5
MTUvZGlzcGxheS9pbnRlbF9kaXNwbGF5LmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlz
cGxheS9pbnRlbF9kaXNwbGF5LmMKQEAgLTIwODIsNyArMjA4Miw3IEBAIHN0YXRpYyB1bnNpZ25l
ZCBpbnQgaW50ZWxfc3VyZl9hbGlnbm1lbnQoY29uc3Qgc3RydWN0IGRybV9mcmFtZWJ1ZmZlciAq
ZmIsCiAKIHN0YXRpYyBib29sIGludGVsX3BsYW5lX3VzZXNfZmVuY2UoY29uc3Qgc3RydWN0IGlu
dGVsX3BsYW5lX3N0YXRlICpwbGFuZV9zdGF0ZSkKIHsKLQlzdHJ1Y3QgaW50ZWxfcGxhbmUgKnBs
YW5lID0gdG9faW50ZWxfcGxhbmUocGxhbmVfc3RhdGUtPmJhc2UucGxhbmUpOworCXN0cnVjdCBp
bnRlbF9wbGFuZSAqcGxhbmUgPSB0b19pbnRlbF9wbGFuZShwbGFuZV9zdGF0ZS0+dWFwaS5wbGFu
ZSk7CiAJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShwbGFuZS0+
YmFzZS5kZXYpOwogCiAJcmV0dXJuIElOVEVMX0dFTihkZXZfcHJpdikgPCA0IHx8CkBAIC0yMzkx
LDcgKzIzOTEsNyBAQCBzdGF0aWMgdTMyIGludGVsX3BsYW5lX2NvbXB1dGVfYWxpZ25lZF9vZmZz
ZXQoaW50ICp4LCBpbnQgKnksCiAJCQkJCSAgICAgIGNvbnN0IHN0cnVjdCBpbnRlbF9wbGFuZV9z
dGF0ZSAqc3RhdGUsCiAJCQkJCSAgICAgIGludCBjb2xvcl9wbGFuZSkKIHsKLQlzdHJ1Y3QgaW50
ZWxfcGxhbmUgKmludGVsX3BsYW5lID0gdG9faW50ZWxfcGxhbmUoc3RhdGUtPmJhc2UucGxhbmUp
OworCXN0cnVjdCBpbnRlbF9wbGFuZSAqaW50ZWxfcGxhbmUgPSB0b19pbnRlbF9wbGFuZShzdGF0
ZS0+dWFwaS5wbGFuZSk7CiAJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9f
aTkxNShpbnRlbF9wbGFuZS0+YmFzZS5kZXYpOwogCWNvbnN0IHN0cnVjdCBkcm1fZnJhbWVidWZm
ZXIgKmZiID0gc3RhdGUtPmh3LmZiOwogCXVuc2lnbmVkIGludCByb3RhdGlvbiA9IHN0YXRlLT5o
dy5yb3RhdGlvbjsKQEAgLTI1NzksNyArMjU3OSw3IEBAIGludGVsX2ZiX3N0cmlkZV9hbGlnbm1l
bnQoY29uc3Qgc3RydWN0IGRybV9mcmFtZWJ1ZmZlciAqZmIsIGludCBjb2xvcl9wbGFuZSkKIAog
Ym9vbCBpbnRlbF9wbGFuZV9jYW5fcmVtYXAoY29uc3Qgc3RydWN0IGludGVsX3BsYW5lX3N0YXRl
ICpwbGFuZV9zdGF0ZSkKIHsKLQlzdHJ1Y3QgaW50ZWxfcGxhbmUgKnBsYW5lID0gdG9faW50ZWxf
cGxhbmUocGxhbmVfc3RhdGUtPmJhc2UucGxhbmUpOworCXN0cnVjdCBpbnRlbF9wbGFuZSAqcGxh
bmUgPSB0b19pbnRlbF9wbGFuZShwbGFuZV9zdGF0ZS0+dWFwaS5wbGFuZSk7CiAJc3RydWN0IGRy
bV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShwbGFuZS0+YmFzZS5kZXYpOwogCWNv
bnN0IHN0cnVjdCBkcm1fZnJhbWVidWZmZXIgKmZiID0gcGxhbmVfc3RhdGUtPmh3LmZiOwogCWlu
dCBpOwpAQCAtMjYxOSw3ICsyNjE5LDcgQEAgYm9vbCBpbnRlbF9wbGFuZV9jYW5fcmVtYXAoY29u
c3Qgc3RydWN0IGludGVsX3BsYW5lX3N0YXRlICpwbGFuZV9zdGF0ZSkKIAogc3RhdGljIGJvb2wg
aW50ZWxfcGxhbmVfbmVlZHNfcmVtYXAoY29uc3Qgc3RydWN0IGludGVsX3BsYW5lX3N0YXRlICpw
bGFuZV9zdGF0ZSkKIHsKLQlzdHJ1Y3QgaW50ZWxfcGxhbmUgKnBsYW5lID0gdG9faW50ZWxfcGxh
bmUocGxhbmVfc3RhdGUtPmJhc2UucGxhbmUpOworCXN0cnVjdCBpbnRlbF9wbGFuZSAqcGxhbmUg
PSB0b19pbnRlbF9wbGFuZShwbGFuZV9zdGF0ZS0+dWFwaS5wbGFuZSk7CiAJY29uc3Qgc3RydWN0
IGRybV9mcmFtZWJ1ZmZlciAqZmIgPSBwbGFuZV9zdGF0ZS0+aHcuZmI7CiAJdW5zaWduZWQgaW50
IHJvdGF0aW9uID0gcGxhbmVfc3RhdGUtPmh3LnJvdGF0aW9uOwogCXUzMiBzdHJpZGUsIG1heF9z
dHJpZGU7CkBAIC0yNjI4LDcgKzI2MjgsNyBAQCBzdGF0aWMgYm9vbCBpbnRlbF9wbGFuZV9uZWVk
c19yZW1hcChjb25zdCBzdHJ1Y3QgaW50ZWxfcGxhbmVfc3RhdGUgKnBsYW5lX3N0YXRlKQogCSAq
IE5vIHJlbWFwcGluZyBmb3IgaW52aXNpYmxlIHBsYW5lcyBzaW5jZSB3ZSBkb24ndCBoYXZlCiAJ
ICogYW4gYWN0dWFsIHNvdXJjZSB2aWV3cG9ydCB0byByZW1hcC4KIAkgKi8KLQlpZiAoIXBsYW5l
X3N0YXRlLT5iYXNlLnZpc2libGUpCisJaWYgKCFwbGFuZV9zdGF0ZS0+dWFwaS52aXNpYmxlKQog
CQlyZXR1cm4gZmFsc2U7CiAKIAlpZiAoIWludGVsX3BsYW5lX2Nhbl9yZW1hcChwbGFuZV9zdGF0
ZSkpCkBAIC0yODExLDcgKzI4MTEsNyBAQCBzdGF0aWMgdm9pZAogaW50ZWxfcGxhbmVfcmVtYXBf
Z3R0KHN0cnVjdCBpbnRlbF9wbGFuZV9zdGF0ZSAqcGxhbmVfc3RhdGUpCiB7CiAJc3RydWN0IGRy
bV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0KLQkJdG9faTkxNShwbGFuZV9zdGF0ZS0+YmFzZS5w
bGFuZS0+ZGV2KTsKKwkJdG9faTkxNShwbGFuZV9zdGF0ZS0+dWFwaS5wbGFuZS0+ZGV2KTsKIAlz
dHJ1Y3QgZHJtX2ZyYW1lYnVmZmVyICpmYiA9IHBsYW5lX3N0YXRlLT5ody5mYjsKIAlzdHJ1Y3Qg
aW50ZWxfZnJhbWVidWZmZXIgKmludGVsX2ZiID0gdG9faW50ZWxfZnJhbWVidWZmZXIoZmIpOwog
CXN0cnVjdCBpbnRlbF9yb3RhdGlvbl9pbmZvICppbmZvID0gJnBsYW5lX3N0YXRlLT52aWV3LnJv
dGF0ZWQ7CkBAIC0yODI2LDIwICsyODI2LDIwIEBAIGludGVsX3BsYW5lX3JlbWFwX2d0dChzdHJ1
Y3QgaW50ZWxfcGxhbmVfc3RhdGUgKnBsYW5lX3N0YXRlKQogCXBsYW5lX3N0YXRlLT52aWV3LnR5
cGUgPSBkcm1fcm90YXRpb25fOTBfb3JfMjcwKHJvdGF0aW9uKSA/CiAJCUk5MTVfR0dUVF9WSUVX
X1JPVEFURUQgOiBJOTE1X0dHVFRfVklFV19SRU1BUFBFRDsKIAotCXNyY194ID0gcGxhbmVfc3Rh
dGUtPmJhc2Uuc3JjLngxID4+IDE2OwotCXNyY195ID0gcGxhbmVfc3RhdGUtPmJhc2Uuc3JjLnkx
ID4+IDE2OwotCXNyY193ID0gZHJtX3JlY3Rfd2lkdGgoJnBsYW5lX3N0YXRlLT5iYXNlLnNyYykg
Pj4gMTY7Ci0Jc3JjX2ggPSBkcm1fcmVjdF9oZWlnaHQoJnBsYW5lX3N0YXRlLT5iYXNlLnNyYykg
Pj4gMTY7CisJc3JjX3ggPSBwbGFuZV9zdGF0ZS0+dWFwaS5zcmMueDEgPj4gMTY7CisJc3JjX3kg
PSBwbGFuZV9zdGF0ZS0+dWFwaS5zcmMueTEgPj4gMTY7CisJc3JjX3cgPSBkcm1fcmVjdF93aWR0
aCgmcGxhbmVfc3RhdGUtPnVhcGkuc3JjKSA+PiAxNjsKKwlzcmNfaCA9IGRybV9yZWN0X2hlaWdo
dCgmcGxhbmVfc3RhdGUtPnVhcGkuc3JjKSA+PiAxNjsKIAogCVdBUk5fT04oaXNfY2NzX21vZGlm
aWVyKGZiLT5tb2RpZmllcikpOwogCiAJLyogTWFrZSBzcmMgY29vcmRpbmF0ZXMgcmVsYXRpdmUg
dG8gdGhlIHZpZXdwb3J0ICovCi0JZHJtX3JlY3RfdHJhbnNsYXRlKCZwbGFuZV9zdGF0ZS0+YmFz
ZS5zcmMsCisJZHJtX3JlY3RfdHJhbnNsYXRlKCZwbGFuZV9zdGF0ZS0+dWFwaS5zcmMsCiAJCQkg
ICAtKHNyY194IDw8IDE2KSwgLShzcmNfeSA8PCAxNikpOwogCiAJLyogUm90YXRlIHNyYyBjb29y
ZGluYXRlcyB0byBtYXRjaCByb3RhdGVkIEdUVCB2aWV3ICovCiAJaWYgKGRybV9yb3RhdGlvbl85
MF9vcl8yNzAocm90YXRpb24pKQotCQlkcm1fcmVjdF9yb3RhdGUoJnBsYW5lX3N0YXRlLT5iYXNl
LnNyYywKKwkJZHJtX3JlY3Rfcm90YXRlKCZwbGFuZV9zdGF0ZS0+dWFwaS5zcmMsCiAJCQkJc3Jj
X3cgPDwgMTYsIHNyY19oIDw8IDE2LAogCQkJCURSTV9NT0RFX1JPVEFURV8yNzApOwogCkBAIC0y
OTU5LDcgKzI5NTksNyBAQCBpbnRlbF9wbGFuZV9jb21wdXRlX2d0dChzdHJ1Y3QgaW50ZWxfcGxh
bmVfc3RhdGUgKnBsYW5lX3N0YXRlKQogCiAJLyogUm90YXRlIHNyYyBjb29yZGluYXRlcyB0byBt
YXRjaCByb3RhdGVkIEdUVCB2aWV3ICovCiAJaWYgKGRybV9yb3RhdGlvbl85MF9vcl8yNzAocm90
YXRpb24pKQotCQlkcm1fcmVjdF9yb3RhdGUoJnBsYW5lX3N0YXRlLT5iYXNlLnNyYywKKwkJZHJt
X3JlY3Rfcm90YXRlKCZwbGFuZV9zdGF0ZS0+dWFwaS5zcmMsCiAJCQkJZmItPmJhc2Uud2lkdGgg
PDwgMTYsIGZiLT5iYXNlLmhlaWdodCA8PCAxNiwKIAkJCQlEUk1fTU9ERV9ST1RBVEVfMjcwKTsK
IApAQCAtMzEyNyw5ICszMTI3LDkgQEAgaW50ZWxfc2V0X3BsYW5lX3Zpc2libGUoc3RydWN0IGlu
dGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUsCiAJCQlzdHJ1Y3QgaW50ZWxfcGxhbmVfc3RhdGUg
KnBsYW5lX3N0YXRlLAogCQkJYm9vbCB2aXNpYmxlKQogewotCXN0cnVjdCBpbnRlbF9wbGFuZSAq
cGxhbmUgPSB0b19pbnRlbF9wbGFuZShwbGFuZV9zdGF0ZS0+YmFzZS5wbGFuZSk7CisJc3RydWN0
IGludGVsX3BsYW5lICpwbGFuZSA9IHRvX2ludGVsX3BsYW5lKHBsYW5lX3N0YXRlLT51YXBpLnBs
YW5lKTsKIAotCXBsYW5lX3N0YXRlLT5iYXNlLnZpc2libGUgPSB2aXNpYmxlOworCXBsYW5lX3N0
YXRlLT51YXBpLnZpc2libGUgPSB2aXNpYmxlOwogCiAJaWYgKHZpc2libGUpCiAJCWNydGNfc3Rh
dGUtPnVhcGkucGxhbmVfbWFzayB8PSBkcm1fcGxhbmVfbWFzaygmcGxhbmUtPmJhc2UpOwpAQCAt
MzI3NSw4ICszMjc1LDggQEAgaW50ZWxfZmluZF9pbml0aWFsX3BsYW5lX29iaihzdHJ1Y3QgaW50
ZWxfY3J0YyAqaW50ZWxfY3J0YywKIAlwbGFuZV9zdGF0ZS0+Y3J0Y193ID0gZmItPndpZHRoOwog
CXBsYW5lX3N0YXRlLT5jcnRjX2ggPSBmYi0+aGVpZ2h0OwogCi0JaW50ZWxfc3RhdGUtPmJhc2Uu
c3JjID0gZHJtX3BsYW5lX3N0YXRlX3NyYyhwbGFuZV9zdGF0ZSk7Ci0JaW50ZWxfc3RhdGUtPmJh
c2UuZHN0ID0gZHJtX3BsYW5lX3N0YXRlX2Rlc3QocGxhbmVfc3RhdGUpOworCWludGVsX3N0YXRl
LT51YXBpLnNyYyA9IGRybV9wbGFuZV9zdGF0ZV9zcmMocGxhbmVfc3RhdGUpOworCWludGVsX3N0
YXRlLT51YXBpLmRzdCA9IGRybV9wbGFuZV9zdGF0ZV9kZXN0KHBsYW5lX3N0YXRlKTsKIAogCWlm
IChwbGFuZV9jb25maWctPnRpbGluZykKIAkJZGV2X3ByaXYtPnByZXNlcnZlX2Jpb3Nfc3dpenps
ZSA9IHRydWU7CkBAIC0zNDExLDEzICszNDExLDEzIEBAIHN0YXRpYyBib29sIHNrbF9jaGVja19t
YWluX2Njc19jb29yZGluYXRlcyhzdHJ1Y3QgaW50ZWxfcGxhbmVfc3RhdGUgKnBsYW5lX3N0YXRl
CiAKIHN0YXRpYyBpbnQgc2tsX2NoZWNrX21haW5fc3VyZmFjZShzdHJ1Y3QgaW50ZWxfcGxhbmVf
c3RhdGUgKnBsYW5lX3N0YXRlKQogewotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJp
diA9IHRvX2k5MTUocGxhbmVfc3RhdGUtPmJhc2UucGxhbmUtPmRldik7CisJc3RydWN0IGRybV9p
OTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShwbGFuZV9zdGF0ZS0+dWFwaS5wbGFuZS0+
ZGV2KTsKIAljb25zdCBzdHJ1Y3QgZHJtX2ZyYW1lYnVmZmVyICpmYiA9IHBsYW5lX3N0YXRlLT5o
dy5mYjsKIAl1bnNpZ25lZCBpbnQgcm90YXRpb24gPSBwbGFuZV9zdGF0ZS0+aHcucm90YXRpb247
Ci0JaW50IHggPSBwbGFuZV9zdGF0ZS0+YmFzZS5zcmMueDEgPj4gMTY7Ci0JaW50IHkgPSBwbGFu
ZV9zdGF0ZS0+YmFzZS5zcmMueTEgPj4gMTY7Ci0JaW50IHcgPSBkcm1fcmVjdF93aWR0aCgmcGxh
bmVfc3RhdGUtPmJhc2Uuc3JjKSA+PiAxNjsKLQlpbnQgaCA9IGRybV9yZWN0X2hlaWdodCgmcGxh
bmVfc3RhdGUtPmJhc2Uuc3JjKSA+PiAxNjsKKwlpbnQgeCA9IHBsYW5lX3N0YXRlLT51YXBpLnNy
Yy54MSA+PiAxNjsKKwlpbnQgeSA9IHBsYW5lX3N0YXRlLT51YXBpLnNyYy55MSA+PiAxNjsKKwlp
bnQgdyA9IGRybV9yZWN0X3dpZHRoKCZwbGFuZV9zdGF0ZS0+dWFwaS5zcmMpID4+IDE2OworCWlu
dCBoID0gZHJtX3JlY3RfaGVpZ2h0KCZwbGFuZV9zdGF0ZS0+dWFwaS5zcmMpID4+IDE2OwogCWlu
dCBtYXhfd2lkdGg7CiAJaW50IG1heF9oZWlnaHQ7CiAJdTMyIGFsaWdubWVudCwgb2Zmc2V0LCBh
dXhfb2Zmc2V0ID0gcGxhbmVfc3RhdGUtPmNvbG9yX3BsYW5lWzFdLm9mZnNldDsKQEAgLTM1MDAs
NyArMzUwMCw3IEBAIHN0YXRpYyBpbnQgc2tsX2NoZWNrX21haW5fc3VyZmFjZShzdHJ1Y3QgaW50
ZWxfcGxhbmVfc3RhdGUgKnBsYW5lX3N0YXRlKQogCSAqIFB1dCB0aGUgZmluYWwgY29vcmRpbmF0
ZXMgYmFjayBzbyB0aGF0IHRoZSBzcmMKIAkgKiBjb29yZGluYXRlIGNoZWNrcyB3aWxsIHNlZSB0
aGUgcmlnaHQgdmFsdWVzLgogCSAqLwotCWRybV9yZWN0X3RyYW5zbGF0ZV90bygmcGxhbmVfc3Rh
dGUtPmJhc2Uuc3JjLAorCWRybV9yZWN0X3RyYW5zbGF0ZV90bygmcGxhbmVfc3RhdGUtPnVhcGku
c3JjLAogCQkJICAgICAgeCA8PCAxNiwgeSA8PCAxNik7CiAKIAlyZXR1cm4gMDsKQEAgLTM1MTIs
MTAgKzM1MTIsMTAgQEAgc3RhdGljIGludCBza2xfY2hlY2tfbnYxMl9hdXhfc3VyZmFjZShzdHJ1
Y3QgaW50ZWxfcGxhbmVfc3RhdGUgKnBsYW5lX3N0YXRlKQogCXVuc2lnbmVkIGludCByb3RhdGlv
biA9IHBsYW5lX3N0YXRlLT5ody5yb3RhdGlvbjsKIAlpbnQgbWF4X3dpZHRoID0gc2tsX21heF9w
bGFuZV93aWR0aChmYiwgMSwgcm90YXRpb24pOwogCWludCBtYXhfaGVpZ2h0ID0gNDA5NjsKLQlp
bnQgeCA9IHBsYW5lX3N0YXRlLT5iYXNlLnNyYy54MSA+PiAxNzsKLQlpbnQgeSA9IHBsYW5lX3N0
YXRlLT5iYXNlLnNyYy55MSA+PiAxNzsKLQlpbnQgdyA9IGRybV9yZWN0X3dpZHRoKCZwbGFuZV9z
dGF0ZS0+YmFzZS5zcmMpID4+IDE3OwotCWludCBoID0gZHJtX3JlY3RfaGVpZ2h0KCZwbGFuZV9z
dGF0ZS0+YmFzZS5zcmMpID4+IDE3OworCWludCB4ID0gcGxhbmVfc3RhdGUtPnVhcGkuc3JjLngx
ID4+IDE3OworCWludCB5ID0gcGxhbmVfc3RhdGUtPnVhcGkuc3JjLnkxID4+IDE3OworCWludCB3
ID0gZHJtX3JlY3Rfd2lkdGgoJnBsYW5lX3N0YXRlLT51YXBpLnNyYykgPj4gMTc7CisJaW50IGgg
PSBkcm1fcmVjdF9oZWlnaHQoJnBsYW5lX3N0YXRlLT51YXBpLnNyYykgPj4gMTc7CiAJdTMyIG9m
ZnNldDsKIAogCWludGVsX2FkZF9mYl9vZmZzZXRzKCZ4LCAmeSwgcGxhbmVfc3RhdGUsIDEpOwpA
QCAtMzUzOCw4ICszNTM4LDggQEAgc3RhdGljIGludCBza2xfY2hlY2tfbnYxMl9hdXhfc3VyZmFj
ZShzdHJ1Y3QgaW50ZWxfcGxhbmVfc3RhdGUgKnBsYW5lX3N0YXRlKQogc3RhdGljIGludCBza2xf
Y2hlY2tfY2NzX2F1eF9zdXJmYWNlKHN0cnVjdCBpbnRlbF9wbGFuZV9zdGF0ZSAqcGxhbmVfc3Rh
dGUpCiB7CiAJY29uc3Qgc3RydWN0IGRybV9mcmFtZWJ1ZmZlciAqZmIgPSBwbGFuZV9zdGF0ZS0+
aHcuZmI7Ci0JaW50IHNyY194ID0gcGxhbmVfc3RhdGUtPmJhc2Uuc3JjLngxID4+IDE2OwotCWlu
dCBzcmNfeSA9IHBsYW5lX3N0YXRlLT5iYXNlLnNyYy55MSA+PiAxNjsKKwlpbnQgc3JjX3ggPSBw
bGFuZV9zdGF0ZS0+dWFwaS5zcmMueDEgPj4gMTY7CisJaW50IHNyY195ID0gcGxhbmVfc3RhdGUt
PnVhcGkuc3JjLnkxID4+IDE2OwogCWludCBoc3ViID0gZmItPmZvcm1hdC0+aHN1YjsKIAlpbnQg
dnN1YiA9IGZiLT5mb3JtYXQtPnZzdWI7CiAJaW50IHggPSBzcmNfeCAvIGhzdWI7CkBAIC0zNTY1
LDcgKzM1NjUsNyBAQCBpbnQgc2tsX2NoZWNrX3BsYW5lX3N1cmZhY2Uoc3RydWN0IGludGVsX3Bs
YW5lX3N0YXRlICpwbGFuZV9zdGF0ZSkKIAlpZiAocmV0KQogCQlyZXR1cm4gcmV0OwogCi0JaWYg
KCFwbGFuZV9zdGF0ZS0+YmFzZS52aXNpYmxlKQorCWlmICghcGxhbmVfc3RhdGUtPnVhcGkudmlz
aWJsZSkKIAkJcmV0dXJuIDA7CiAKIAkvKgpAQCAtMzY4OSw3ICszNjg5LDcgQEAgc3RhdGljIHUz
MiBpOXh4X3BsYW5lX2N0bChjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0
ZSwKIAkJCSAgY29uc3Qgc3RydWN0IGludGVsX3BsYW5lX3N0YXRlICpwbGFuZV9zdGF0ZSkKIHsK
IAlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPQotCQl0b19pOTE1KHBsYW5lX3N0
YXRlLT5iYXNlLnBsYW5lLT5kZXYpOworCQl0b19pOTE1KHBsYW5lX3N0YXRlLT51YXBpLnBsYW5l
LT5kZXYpOwogCWNvbnN0IHN0cnVjdCBkcm1fZnJhbWVidWZmZXIgKmZiID0gcGxhbmVfc3RhdGUt
Pmh3LmZiOwogCXVuc2lnbmVkIGludCByb3RhdGlvbiA9IHBsYW5lX3N0YXRlLT5ody5yb3RhdGlv
bjsKIAl1MzIgZHNwY250cjsKQEAgLTM3NDYsNyArMzc0Niw3IEBAIHN0YXRpYyB1MzIgaTl4eF9w
bGFuZV9jdGwoY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUsCiBpbnQg
aTl4eF9jaGVja19wbGFuZV9zdXJmYWNlKHN0cnVjdCBpbnRlbF9wbGFuZV9zdGF0ZSAqcGxhbmVf
c3RhdGUpCiB7CiAJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0KLQkJdG9faTkx
NShwbGFuZV9zdGF0ZS0+YmFzZS5wbGFuZS0+ZGV2KTsKKwkJdG9faTkxNShwbGFuZV9zdGF0ZS0+
dWFwaS5wbGFuZS0+ZGV2KTsKIAljb25zdCBzdHJ1Y3QgZHJtX2ZyYW1lYnVmZmVyICpmYiA9IHBs
YW5lX3N0YXRlLT5ody5mYjsKIAlpbnQgc3JjX3gsIHNyY195LCBzcmNfdzsKIAl1MzIgb2Zmc2V0
OwpAQCAtMzc1NiwxMiArMzc1NiwxMiBAQCBpbnQgaTl4eF9jaGVja19wbGFuZV9zdXJmYWNlKHN0
cnVjdCBpbnRlbF9wbGFuZV9zdGF0ZSAqcGxhbmVfc3RhdGUpCiAJaWYgKHJldCkKIAkJcmV0dXJu
IHJldDsKIAotCWlmICghcGxhbmVfc3RhdGUtPmJhc2UudmlzaWJsZSkKKwlpZiAoIXBsYW5lX3N0
YXRlLT51YXBpLnZpc2libGUpCiAJCXJldHVybiAwOwogCi0Jc3JjX3cgPSBkcm1fcmVjdF93aWR0
aCgmcGxhbmVfc3RhdGUtPmJhc2Uuc3JjKSA+PiAxNjsKLQlzcmNfeCA9IHBsYW5lX3N0YXRlLT5i
YXNlLnNyYy54MSA+PiAxNjsKLQlzcmNfeSA9IHBsYW5lX3N0YXRlLT5iYXNlLnNyYy55MSA+PiAx
NjsKKwlzcmNfdyA9IGRybV9yZWN0X3dpZHRoKCZwbGFuZV9zdGF0ZS0+dWFwaS5zcmMpID4+IDE2
OworCXNyY194ID0gcGxhbmVfc3RhdGUtPnVhcGkuc3JjLngxID4+IDE2OworCXNyY195ID0gcGxh
bmVfc3RhdGUtPnVhcGkuc3JjLnkxID4+IDE2OwogCiAJLyogVW5kb2N1bWVudGVkIGhhcmR3YXJl
IGxpbWl0IG9uIGk5NjUvZzR4L3Zsdi9jaHYgKi8KIAlpZiAoSEFTX0dNQ0goZGV2X3ByaXYpICYm
IGZiLT5mb3JtYXQtPmNwcFswXSA9PSA4ICYmIHNyY193ID4gMjA0OCkKQEAgLTM3NzksMTQgKzM3
NzksMTQgQEAgaW50IGk5eHhfY2hlY2tfcGxhbmVfc3VyZmFjZShzdHJ1Y3QgaW50ZWxfcGxhbmVf
c3RhdGUgKnBsYW5lX3N0YXRlKQogCSAqIFB1dCB0aGUgZmluYWwgY29vcmRpbmF0ZXMgYmFjayBz
byB0aGF0IHRoZSBzcmMKIAkgKiBjb29yZGluYXRlIGNoZWNrcyB3aWxsIHNlZSB0aGUgcmlnaHQg
dmFsdWVzLgogCSAqLwotCWRybV9yZWN0X3RyYW5zbGF0ZV90bygmcGxhbmVfc3RhdGUtPmJhc2Uu
c3JjLAorCWRybV9yZWN0X3RyYW5zbGF0ZV90bygmcGxhbmVfc3RhdGUtPnVhcGkuc3JjLAogCQkJ
ICAgICAgc3JjX3ggPDwgMTYsIHNyY195IDw8IDE2KTsKIAogCS8qIEhTVy9CRFcgZG8gdGhpcyBh
dXRvbWFnaWNhbGx5IGluIGhhcmR3YXJlICovCiAJaWYgKCFJU19IQVNXRUxMKGRldl9wcml2KSAm
JiAhSVNfQlJPQURXRUxMKGRldl9wcml2KSkgewogCQl1bnNpZ25lZCBpbnQgcm90YXRpb24gPSBw
bGFuZV9zdGF0ZS0+aHcucm90YXRpb247Ci0JCWludCBzcmNfdyA9IGRybV9yZWN0X3dpZHRoKCZw
bGFuZV9zdGF0ZS0+YmFzZS5zcmMpID4+IDE2OwotCQlpbnQgc3JjX2ggPSBkcm1fcmVjdF9oZWln
aHQoJnBsYW5lX3N0YXRlLT5iYXNlLnNyYykgPj4gMTY7CisJCWludCBzcmNfdyA9IGRybV9yZWN0
X3dpZHRoKCZwbGFuZV9zdGF0ZS0+dWFwaS5zcmMpID4+IDE2OworCQlpbnQgc3JjX2ggPSBkcm1f
cmVjdF9oZWlnaHQoJnBsYW5lX3N0YXRlLT51YXBpLnNyYykgPj4gMTY7CiAKIAkJaWYgKHJvdGF0
aW9uICYgRFJNX01PREVfUk9UQVRFXzE4MCkgewogCQkJc3JjX3ggKz0gc3JjX3cgLSAxOwpAQCAt
MzgyMywxNCArMzgyMywxNCBAQCBzdGF0aWMgaW50CiBpOXh4X3BsYW5lX2NoZWNrKHN0cnVjdCBp
bnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlLAogCQkgc3RydWN0IGludGVsX3BsYW5lX3N0YXRl
ICpwbGFuZV9zdGF0ZSkKIHsKLQlzdHJ1Y3QgaW50ZWxfcGxhbmUgKnBsYW5lID0gdG9faW50ZWxf
cGxhbmUocGxhbmVfc3RhdGUtPmJhc2UucGxhbmUpOworCXN0cnVjdCBpbnRlbF9wbGFuZSAqcGxh
bmUgPSB0b19pbnRlbF9wbGFuZShwbGFuZV9zdGF0ZS0+dWFwaS5wbGFuZSk7CiAJaW50IHJldDsK
IAogCXJldCA9IGNodl9wbGFuZV9jaGVja19yb3RhdGlvbihwbGFuZV9zdGF0ZSk7CiAJaWYgKHJl
dCkKIAkJcmV0dXJuIHJldDsKIAotCXJldCA9IGRybV9hdG9taWNfaGVscGVyX2NoZWNrX3BsYW5l
X3N0YXRlKCZwbGFuZV9zdGF0ZS0+YmFzZSwKKwlyZXQgPSBkcm1fYXRvbWljX2hlbHBlcl9jaGVj
a19wbGFuZV9zdGF0ZSgmcGxhbmVfc3RhdGUtPnVhcGksCiAJCQkJCQkgICZjcnRjX3N0YXRlLT51
YXBpLAogCQkJCQkJICBEUk1fUExBTkVfSEVMUEVSX05PX1NDQUxJTkcsCiAJCQkJCQkgIERSTV9Q
TEFORV9IRUxQRVJfTk9fU0NBTElORywKQEAgLTM4NDMsNyArMzg0Myw3IEBAIGk5eHhfcGxhbmVf
Y2hlY2soc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUsCiAJaWYgKHJldCkKIAkJ
cmV0dXJuIHJldDsKIAotCWlmICghcGxhbmVfc3RhdGUtPmJhc2UudmlzaWJsZSkKKwlpZiAoIXBs
YW5lX3N0YXRlLT51YXBpLnZpc2libGUpCiAJCXJldHVybiAwOwogCiAJcmV0ID0gaW50ZWxfcGxh
bmVfY2hlY2tfc3JjX2Nvb3JkaW5hdGVzKHBsYW5lX3N0YXRlKTsKQEAgLTM4NjQsMTAgKzM4NjQs
MTAgQEAgc3RhdGljIHZvaWQgaTl4eF91cGRhdGVfcGxhbmUoc3RydWN0IGludGVsX3BsYW5lICpw
bGFuZSwKIAl1MzIgbGluZWFyX29mZnNldDsKIAlpbnQgeCA9IHBsYW5lX3N0YXRlLT5jb2xvcl9w
bGFuZVswXS54OwogCWludCB5ID0gcGxhbmVfc3RhdGUtPmNvbG9yX3BsYW5lWzBdLnk7Ci0JaW50
IGNydGNfeCA9IHBsYW5lX3N0YXRlLT5iYXNlLmRzdC54MTsKLQlpbnQgY3J0Y195ID0gcGxhbmVf
c3RhdGUtPmJhc2UuZHN0LnkxOwotCWludCBjcnRjX3cgPSBkcm1fcmVjdF93aWR0aCgmcGxhbmVf
c3RhdGUtPmJhc2UuZHN0KTsKLQlpbnQgY3J0Y19oID0gZHJtX3JlY3RfaGVpZ2h0KCZwbGFuZV9z
dGF0ZS0+YmFzZS5kc3QpOworCWludCBjcnRjX3ggPSBwbGFuZV9zdGF0ZS0+dWFwaS5kc3QueDE7
CisJaW50IGNydGNfeSA9IHBsYW5lX3N0YXRlLT51YXBpLmRzdC55MTsKKwlpbnQgY3J0Y193ID0g
ZHJtX3JlY3Rfd2lkdGgoJnBsYW5lX3N0YXRlLT51YXBpLmRzdCk7CisJaW50IGNydGNfaCA9IGRy
bV9yZWN0X2hlaWdodCgmcGxhbmVfc3RhdGUtPnVhcGkuZHN0KTsKIAl1bnNpZ25lZCBsb25nIGly
cWZsYWdzOwogCXUzMiBkc3BhZGRyX29mZnNldDsKIAl1MzIgZHNwY250cjsKQEAgLTQyMjEsNyAr
NDIyMSw3IEBAIHUzMiBza2xfcGxhbmVfY3RsKGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRl
ICpjcnRjX3N0YXRlLAogCQkgIGNvbnN0IHN0cnVjdCBpbnRlbF9wbGFuZV9zdGF0ZSAqcGxhbmVf
c3RhdGUpCiB7CiAJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0KLQkJdG9faTkx
NShwbGFuZV9zdGF0ZS0+YmFzZS5wbGFuZS0+ZGV2KTsKKwkJdG9faTkxNShwbGFuZV9zdGF0ZS0+
dWFwaS5wbGFuZS0+ZGV2KTsKIAljb25zdCBzdHJ1Y3QgZHJtX2ZyYW1lYnVmZmVyICpmYiA9IHBs
YW5lX3N0YXRlLT5ody5mYjsKIAl1bnNpZ25lZCBpbnQgcm90YXRpb24gPSBwbGFuZV9zdGF0ZS0+
aHcucm90YXRpb247CiAJY29uc3Qgc3RydWN0IGRybV9pbnRlbF9zcHJpdGVfY29sb3JrZXkgKmtl
eSA9ICZwbGFuZV9zdGF0ZS0+Y2tleTsKQEAgLTQyNzcsOSArNDI3Nyw5IEBAIHUzMiBnbGtfcGxh
bmVfY29sb3JfY3RsKGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlLAog
CQkJY29uc3Qgc3RydWN0IGludGVsX3BsYW5lX3N0YXRlICpwbGFuZV9zdGF0ZSkKIHsKIAlzdHJ1
Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPQotCQl0b19pOTE1KHBsYW5lX3N0YXRlLT5i
YXNlLnBsYW5lLT5kZXYpOworCQl0b19pOTE1KHBsYW5lX3N0YXRlLT51YXBpLnBsYW5lLT5kZXYp
OwogCWNvbnN0IHN0cnVjdCBkcm1fZnJhbWVidWZmZXIgKmZiID0gcGxhbmVfc3RhdGUtPmh3LmZi
OwotCXN0cnVjdCBpbnRlbF9wbGFuZSAqcGxhbmUgPSB0b19pbnRlbF9wbGFuZShwbGFuZV9zdGF0
ZS0+YmFzZS5wbGFuZSk7CisJc3RydWN0IGludGVsX3BsYW5lICpwbGFuZSA9IHRvX2ludGVsX3Bs
YW5lKHBsYW5lX3N0YXRlLT51YXBpLnBsYW5lKTsKIAl1MzIgcGxhbmVfY29sb3JfY3RsID0gMDsK
IAogCXBsYW5lX2NvbG9yX2N0bCB8PSBQTEFORV9DT0xPUl9QTEFORV9HQU1NQV9ESVNBQkxFOwpA
QCAtNTYyMywxMSArNTYyMywxMSBAQCBzdGF0aWMgaW50IHNrbF91cGRhdGVfc2NhbGVyX3BsYW5l
KHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlLAogCQkJCSAgIHN0cnVjdCBpbnRl
bF9wbGFuZV9zdGF0ZSAqcGxhbmVfc3RhdGUpCiB7CiAJc3RydWN0IGludGVsX3BsYW5lICppbnRl
bF9wbGFuZSA9Ci0JCXRvX2ludGVsX3BsYW5lKHBsYW5lX3N0YXRlLT5iYXNlLnBsYW5lKTsKKwkJ
dG9faW50ZWxfcGxhbmUocGxhbmVfc3RhdGUtPnVhcGkucGxhbmUpOwogCXN0cnVjdCBkcm1faTkx
NV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoaW50ZWxfcGxhbmUtPmJhc2UuZGV2KTsKIAlz
dHJ1Y3QgZHJtX2ZyYW1lYnVmZmVyICpmYiA9IHBsYW5lX3N0YXRlLT5ody5mYjsKIAlpbnQgcmV0
OwotCWJvb2wgZm9yY2VfZGV0YWNoID0gIWZiIHx8ICFwbGFuZV9zdGF0ZS0+YmFzZS52aXNpYmxl
OworCWJvb2wgZm9yY2VfZGV0YWNoID0gIWZiIHx8ICFwbGFuZV9zdGF0ZS0+dWFwaS52aXNpYmxl
OwogCWJvb2wgbmVlZF9zY2FsZXIgPSBmYWxzZTsKIAogCS8qIFByZS1nZW4xMSBhbmQgU0RSIHBs
YW5lcyBhbHdheXMgbmVlZCBhIHNjYWxlciBmb3IgcGxhbmFyIGZvcm1hdHMuICovCkBAIC01NjM4
LDEwICs1NjM4LDEwIEBAIHN0YXRpYyBpbnQgc2tsX3VwZGF0ZV9zY2FsZXJfcGxhbmUoc3RydWN0
IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUsCiAJcmV0ID0gc2tsX3VwZGF0ZV9zY2FsZXIo
Y3J0Y19zdGF0ZSwgZm9yY2VfZGV0YWNoLAogCQkJCWRybV9wbGFuZV9pbmRleCgmaW50ZWxfcGxh
bmUtPmJhc2UpLAogCQkJCSZwbGFuZV9zdGF0ZS0+c2NhbGVyX2lkLAotCQkJCWRybV9yZWN0X3dp
ZHRoKCZwbGFuZV9zdGF0ZS0+YmFzZS5zcmMpID4+IDE2LAotCQkJCWRybV9yZWN0X2hlaWdodCgm
cGxhbmVfc3RhdGUtPmJhc2Uuc3JjKSA+PiAxNiwKLQkJCQlkcm1fcmVjdF93aWR0aCgmcGxhbmVf
c3RhdGUtPmJhc2UuZHN0KSwKLQkJCQlkcm1fcmVjdF9oZWlnaHQoJnBsYW5lX3N0YXRlLT5iYXNl
LmRzdCksCisJCQkJZHJtX3JlY3Rfd2lkdGgoJnBsYW5lX3N0YXRlLT51YXBpLnNyYykgPj4gMTYs
CisJCQkJZHJtX3JlY3RfaGVpZ2h0KCZwbGFuZV9zdGF0ZS0+dWFwaS5zcmMpID4+IDE2LAorCQkJ
CWRybV9yZWN0X3dpZHRoKCZwbGFuZV9zdGF0ZS0+dWFwaS5kc3QpLAorCQkJCWRybV9yZWN0X2hl
aWdodCgmcGxhbmVfc3RhdGUtPnVhcGkuZHN0KSwKIAkJCQlmYiA/IGZiLT5mb3JtYXQgOiBOVUxM
LCBuZWVkX3NjYWxlcik7CiAKIAlpZiAocmV0IHx8IHBsYW5lX3N0YXRlLT5zY2FsZXJfaWQgPCAw
KQpAQCAtNjA1Nyw3ICs2MDU3LDcgQEAgc3RhdGljIHZvaWQgaW50ZWxfcHJlX3BsYW5lX3VwZGF0
ZShzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqb2xkX2NydGNfc3RhdGUsCiAJCSAqIFNvIGRpc2Fi
bGUgdW5kZXJydW4gcmVwb3J0aW5nIGJlZm9yZSBhbGwgdGhlIHBsYW5lcyBnZXQgZGlzYWJsZWQu
CiAJCSAqLwogCQlpZiAoSVNfR0VOKGRldl9wcml2LCAyKSAmJiBvbGRfcHJpbWFyeV9zdGF0ZS0+
dmlzaWJsZSAmJgotCQkgICAgKG1vZGVzZXQgfHwgIW5ld19wcmltYXJ5X3N0YXRlLT5iYXNlLnZp
c2libGUpKQorCQkgICAgKG1vZGVzZXQgfHwgIW5ld19wcmltYXJ5X3N0YXRlLT51YXBpLnZpc2li
bGUpKQogCQkJaW50ZWxfc2V0X2NwdV9maWZvX3VuZGVycnVuX3JlcG9ydGluZyhkZXZfcHJpdiwg
Y3J0Yy0+cGlwZSwgZmFsc2UpOwogCX0KIApAQCAtNjE0NCw3ICs2MTQ0LDcgQEAgc3RhdGljIHZv
aWQgaW50ZWxfY3J0Y19kaXNhYmxlX3BsYW5lcyhzdHJ1Y3QgaW50ZWxfYXRvbWljX3N0YXRlICpz
dGF0ZSwKIAogCQlpbnRlbF9kaXNhYmxlX3BsYW5lKHBsYW5lLCBuZXdfY3J0Y19zdGF0ZSk7CiAK
LQkJaWYgKG9sZF9wbGFuZV9zdGF0ZS0+YmFzZS52aXNpYmxlKQorCQlpZiAob2xkX3BsYW5lX3N0
YXRlLT51YXBpLnZpc2libGUpCiAJCQlmYl9iaXRzIHw9IHBsYW5lLT5mcm9udGJ1ZmZlcl9iaXQ7
CiAJfQogCkBAIC03MTUzLDcgKzcxNTMsNyBAQCBzdGF0aWMgdm9pZCBpbnRlbF9jcnRjX2Rpc2Fi
bGVfbm9hdG9taWMoc3RydWN0IGRybV9jcnRjICpjcnRjLAogCQljb25zdCBzdHJ1Y3QgaW50ZWxf
cGxhbmVfc3RhdGUgKnBsYW5lX3N0YXRlID0KIAkJCXRvX2ludGVsX3BsYW5lX3N0YXRlKHBsYW5l
LT5iYXNlLnN0YXRlKTsKIAotCQlpZiAocGxhbmVfc3RhdGUtPmJhc2UudmlzaWJsZSkKKwkJaWYg
KHBsYW5lX3N0YXRlLT51YXBpLnZpc2libGUpCiAJCQlpbnRlbF9wbGFuZV9kaXNhYmxlX25vYXRv
bWljKGludGVsX2NydGMsIHBsYW5lKTsKIAl9CiAKQEAgLTEwNzI4LDcgKzEwNzI4LDcgQEAgc3Rh
dGljIGJvb2wgaGFzd2VsbF9nZXRfcGlwZV9jb25maWcoc3RydWN0IGludGVsX2NydGMgKmNydGMs
CiBzdGF0aWMgdTMyIGludGVsX2N1cnNvcl9iYXNlKGNvbnN0IHN0cnVjdCBpbnRlbF9wbGFuZV9z
dGF0ZSAqcGxhbmVfc3RhdGUpCiB7CiAJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2
ID0KLQkJdG9faTkxNShwbGFuZV9zdGF0ZS0+YmFzZS5wbGFuZS0+ZGV2KTsKKwkJdG9faTkxNShw
bGFuZV9zdGF0ZS0+dWFwaS5wbGFuZS0+ZGV2KTsKIAljb25zdCBzdHJ1Y3QgZHJtX2ZyYW1lYnVm
ZmVyICpmYiA9IHBsYW5lX3N0YXRlLT5ody5mYjsKIAljb25zdCBzdHJ1Y3QgZHJtX2k5MTVfZ2Vt
X29iamVjdCAqb2JqID0gaW50ZWxfZmJfb2JqKGZiKTsKIAl1MzIgYmFzZTsKQEAgLTEwNzQzLDgg
KzEwNzQzLDggQEAgc3RhdGljIHUzMiBpbnRlbF9jdXJzb3JfYmFzZShjb25zdCBzdHJ1Y3QgaW50
ZWxfcGxhbmVfc3RhdGUgKnBsYW5lX3N0YXRlKQogCiBzdGF0aWMgdTMyIGludGVsX2N1cnNvcl9w
b3NpdGlvbihjb25zdCBzdHJ1Y3QgaW50ZWxfcGxhbmVfc3RhdGUgKnBsYW5lX3N0YXRlKQogewot
CWludCB4ID0gcGxhbmVfc3RhdGUtPmJhc2UuZHN0LngxOwotCWludCB5ID0gcGxhbmVfc3RhdGUt
PmJhc2UuZHN0LnkxOworCWludCB4ID0gcGxhbmVfc3RhdGUtPnVhcGkuZHN0LngxOworCWludCB5
ID0gcGxhbmVfc3RhdGUtPnVhcGkuZHN0LnkxOwogCXUzMiBwb3MgPSAwOwogCiAJaWYgKHggPCAw
KSB7CkBAIC0xMDc2NSw5ICsxMDc2NSw5IEBAIHN0YXRpYyB1MzIgaW50ZWxfY3Vyc29yX3Bvc2l0
aW9uKGNvbnN0IHN0cnVjdCBpbnRlbF9wbGFuZV9zdGF0ZSAqcGxhbmVfc3RhdGUpCiBzdGF0aWMg
Ym9vbCBpbnRlbF9jdXJzb3Jfc2l6ZV9vayhjb25zdCBzdHJ1Y3QgaW50ZWxfcGxhbmVfc3RhdGUg
KnBsYW5lX3N0YXRlKQogewogCWNvbnN0IHN0cnVjdCBkcm1fbW9kZV9jb25maWcgKmNvbmZpZyA9
Ci0JCSZwbGFuZV9zdGF0ZS0+YmFzZS5wbGFuZS0+ZGV2LT5tb2RlX2NvbmZpZzsKLQlpbnQgd2lk
dGggPSBkcm1fcmVjdF93aWR0aCgmcGxhbmVfc3RhdGUtPmJhc2UuZHN0KTsKLQlpbnQgaGVpZ2h0
ID0gZHJtX3JlY3RfaGVpZ2h0KCZwbGFuZV9zdGF0ZS0+YmFzZS5kc3QpOworCQkmcGxhbmVfc3Rh
dGUtPnVhcGkucGxhbmUtPmRldi0+bW9kZV9jb25maWc7CisJaW50IHdpZHRoID0gZHJtX3JlY3Rf
d2lkdGgoJnBsYW5lX3N0YXRlLT51YXBpLmRzdCk7CisJaW50IGhlaWdodCA9IGRybV9yZWN0X2hl
aWdodCgmcGxhbmVfc3RhdGUtPnVhcGkuZHN0KTsKIAogCXJldHVybiB3aWR0aCA+IDAgJiYgd2lk
dGggPD0gY29uZmlnLT5jdXJzb3Jfd2lkdGggJiYKIAkJaGVpZ2h0ID4gMCAmJiBoZWlnaHQgPD0g
Y29uZmlnLT5jdXJzb3JfaGVpZ2h0OwpAQCAtMTA3NzYsNyArMTA3NzYsNyBAQCBzdGF0aWMgYm9v
bCBpbnRlbF9jdXJzb3Jfc2l6ZV9vayhjb25zdCBzdHJ1Y3QgaW50ZWxfcGxhbmVfc3RhdGUgKnBs
YW5lX3N0YXRlKQogc3RhdGljIGludCBpbnRlbF9jdXJzb3JfY2hlY2tfc3VyZmFjZShzdHJ1Y3Qg
aW50ZWxfcGxhbmVfc3RhdGUgKnBsYW5lX3N0YXRlKQogewogCXN0cnVjdCBkcm1faTkxNV9wcml2
YXRlICpkZXZfcHJpdiA9Ci0JCXRvX2k5MTUocGxhbmVfc3RhdGUtPmJhc2UucGxhbmUtPmRldik7
CisJCXRvX2k5MTUocGxhbmVfc3RhdGUtPnVhcGkucGxhbmUtPmRldik7CiAJdW5zaWduZWQgaW50
IHJvdGF0aW9uID0gcGxhbmVfc3RhdGUtPmh3LnJvdGF0aW9uOwogCWludCBzcmNfeCwgc3JjX3k7
CiAJdTMyIG9mZnNldDsKQEAgLTEwNzg2LDExICsxMDc4NiwxMSBAQCBzdGF0aWMgaW50IGludGVs
X2N1cnNvcl9jaGVja19zdXJmYWNlKHN0cnVjdCBpbnRlbF9wbGFuZV9zdGF0ZSAqcGxhbmVfc3Rh
dGUpCiAJaWYgKHJldCkKIAkJcmV0dXJuIHJldDsKIAotCWlmICghcGxhbmVfc3RhdGUtPmJhc2Uu
dmlzaWJsZSkKKwlpZiAoIXBsYW5lX3N0YXRlLT51YXBpLnZpc2libGUpCiAJCXJldHVybiAwOwog
Ci0Jc3JjX3ggPSBwbGFuZV9zdGF0ZS0+YmFzZS5zcmMueDEgPj4gMTY7Ci0Jc3JjX3kgPSBwbGFu
ZV9zdGF0ZS0+YmFzZS5zcmMueTEgPj4gMTY7CisJc3JjX3ggPSBwbGFuZV9zdGF0ZS0+dWFwaS5z
cmMueDEgPj4gMTY7CisJc3JjX3kgPSBwbGFuZV9zdGF0ZS0+dWFwaS5zcmMueTEgPj4gMTY7CiAK
IAlpbnRlbF9hZGRfZmJfb2Zmc2V0cygmc3JjX3gsICZzcmNfeSwgcGxhbmVfc3RhdGUsIDApOwog
CW9mZnNldCA9IGludGVsX3BsYW5lX2NvbXB1dGVfYWxpZ25lZF9vZmZzZXQoJnNyY194LCAmc3Jj
X3ksCkBAIC0xMDgwNSwxNCArMTA4MDUsMTQgQEAgc3RhdGljIGludCBpbnRlbF9jdXJzb3JfY2hl
Y2tfc3VyZmFjZShzdHJ1Y3QgaW50ZWxfcGxhbmVfc3RhdGUgKnBsYW5lX3N0YXRlKQogCSAqIFB1
dCB0aGUgZmluYWwgY29vcmRpbmF0ZXMgYmFjayBzbyB0aGF0IHRoZSBzcmMKIAkgKiBjb29yZGlu
YXRlIGNoZWNrcyB3aWxsIHNlZSB0aGUgcmlnaHQgdmFsdWVzLgogCSAqLwotCWRybV9yZWN0X3Ry
YW5zbGF0ZV90bygmcGxhbmVfc3RhdGUtPmJhc2Uuc3JjLAorCWRybV9yZWN0X3RyYW5zbGF0ZV90
bygmcGxhbmVfc3RhdGUtPnVhcGkuc3JjLAogCQkJICAgICAgc3JjX3ggPDwgMTYsIHNyY195IDw8
IDE2KTsKIAogCS8qIElMSysgZG8gdGhpcyBhdXRvbWFnaWNhbGx5IGluIGhhcmR3YXJlICovCiAJ
aWYgKEhBU19HTUNIKGRldl9wcml2KSAmJiByb3RhdGlvbiAmIERSTV9NT0RFX1JPVEFURV8xODAp
IHsKIAkJY29uc3Qgc3RydWN0IGRybV9mcmFtZWJ1ZmZlciAqZmIgPSBwbGFuZV9zdGF0ZS0+aHcu
ZmI7Ci0JCWludCBzcmNfdyA9IGRybV9yZWN0X3dpZHRoKCZwbGFuZV9zdGF0ZS0+YmFzZS5zcmMp
ID4+IDE2OwotCQlpbnQgc3JjX2ggPSBkcm1fcmVjdF9oZWlnaHQoJnBsYW5lX3N0YXRlLT5iYXNl
LnNyYykgPj4gMTY7CisJCWludCBzcmNfdyA9IGRybV9yZWN0X3dpZHRoKCZwbGFuZV9zdGF0ZS0+
dWFwaS5zcmMpID4+IDE2OworCQlpbnQgc3JjX2ggPSBkcm1fcmVjdF9oZWlnaHQoJnBsYW5lX3N0
YXRlLT51YXBpLnNyYykgPj4gMTY7CiAKIAkJb2Zmc2V0ICs9IChzcmNfaCAqIHNyY193IC0gMSkg
KiBmYi0+Zm9ybWF0LT5jcHBbMF07CiAJfQpAQCAtMTA4MzUsNyArMTA4MzUsNyBAQCBzdGF0aWMg
aW50IGludGVsX2NoZWNrX2N1cnNvcihzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0
ZSwKIAkJcmV0dXJuIC1FSU5WQUw7CiAJfQogCi0JcmV0ID0gZHJtX2F0b21pY19oZWxwZXJfY2hl
Y2tfcGxhbmVfc3RhdGUoJnBsYW5lX3N0YXRlLT5iYXNlLAorCXJldCA9IGRybV9hdG9taWNfaGVs
cGVyX2NoZWNrX3BsYW5lX3N0YXRlKCZwbGFuZV9zdGF0ZS0+dWFwaSwKIAkJCQkJCSAgJmNydGNf
c3RhdGUtPnVhcGksCiAJCQkJCQkgIERSTV9QTEFORV9IRUxQRVJfTk9fU0NBTElORywKIAkJCQkJ
CSAgRFJNX1BMQU5FX0hFTFBFUl9OT19TQ0FMSU5HLApAQCAtMTA4NDQsMTQgKzEwODQ0LDE0IEBA
IHN0YXRpYyBpbnQgaW50ZWxfY2hlY2tfY3Vyc29yKHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpj
cnRjX3N0YXRlLAogCQlyZXR1cm4gcmV0OwogCiAJLyogVXNlIHRoZSB1bmNsaXBwZWQgc3JjL2Rz
dCByZWN0YW5nbGVzLCB3aGljaCB3ZSBwcm9ncmFtIHRvIGh3ICovCi0JcGxhbmVfc3RhdGUtPmJh
c2Uuc3JjID0gZHJtX3BsYW5lX3N0YXRlX3NyYygmcGxhbmVfc3RhdGUtPmJhc2UpOwotCXBsYW5l
X3N0YXRlLT5iYXNlLmRzdCA9IGRybV9wbGFuZV9zdGF0ZV9kZXN0KCZwbGFuZV9zdGF0ZS0+YmFz
ZSk7CisJcGxhbmVfc3RhdGUtPnVhcGkuc3JjID0gZHJtX3BsYW5lX3N0YXRlX3NyYygmcGxhbmVf
c3RhdGUtPnVhcGkpOworCXBsYW5lX3N0YXRlLT51YXBpLmRzdCA9IGRybV9wbGFuZV9zdGF0ZV9k
ZXN0KCZwbGFuZV9zdGF0ZS0+dWFwaSk7CiAKIAlyZXQgPSBpbnRlbF9jdXJzb3JfY2hlY2tfc3Vy
ZmFjZShwbGFuZV9zdGF0ZSk7CiAJaWYgKHJldCkKIAkJcmV0dXJuIHJldDsKIAotCWlmICghcGxh
bmVfc3RhdGUtPmJhc2UudmlzaWJsZSkKKwlpZiAoIXBsYW5lX3N0YXRlLT51YXBpLnZpc2libGUp
CiAJCXJldHVybiAwOwogCiAJcmV0ID0gaW50ZWxfcGxhbmVfY2hlY2tfc3JjX2Nvb3JkaW5hdGVz
KHBsYW5lX3N0YXRlKTsKQEAgLTEwODg5LDcgKzEwODg5LDcgQEAgc3RhdGljIHUzMiBpODQ1X2N1
cnNvcl9jdGwoY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUsCiAKIHN0
YXRpYyBib29sIGk4NDVfY3Vyc29yX3NpemVfb2soY29uc3Qgc3RydWN0IGludGVsX3BsYW5lX3N0
YXRlICpwbGFuZV9zdGF0ZSkKIHsKLQlpbnQgd2lkdGggPSBkcm1fcmVjdF93aWR0aCgmcGxhbmVf
c3RhdGUtPmJhc2UuZHN0KTsKKwlpbnQgd2lkdGggPSBkcm1fcmVjdF93aWR0aCgmcGxhbmVfc3Rh
dGUtPnVhcGkuZHN0KTsKIAogCS8qCiAJICogODQ1Zy84NjVnIGFyZSBvbmx5IGxpbWl0ZWQgYnkg
dGhlIHdpZHRoIG9mIHRoZWlyIGN1cnNvcnMsCkBAIC0xMDkxNSwxMiArMTA5MTUsMTIgQEAgc3Rh
dGljIGludCBpODQ1X2NoZWNrX2N1cnNvcihzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19z
dGF0ZSwKIAkvKiBDaGVjayBmb3Igd2hpY2ggY3Vyc29yIHR5cGVzIHdlIHN1cHBvcnQgKi8KIAlp
ZiAoIWk4NDVfY3Vyc29yX3NpemVfb2socGxhbmVfc3RhdGUpKSB7CiAJCURSTV9ERUJVRygiQ3Vy
c29yIGRpbWVuc2lvbiAlZHglZCBub3Qgc3VwcG9ydGVkXG4iLAotCQkJICBkcm1fcmVjdF93aWR0
aCgmcGxhbmVfc3RhdGUtPmJhc2UuZHN0KSwKLQkJCSAgZHJtX3JlY3RfaGVpZ2h0KCZwbGFuZV9z
dGF0ZS0+YmFzZS5kc3QpKTsKKwkJCSAgZHJtX3JlY3Rfd2lkdGgoJnBsYW5lX3N0YXRlLT51YXBp
LmRzdCksCisJCQkgIGRybV9yZWN0X2hlaWdodCgmcGxhbmVfc3RhdGUtPnVhcGkuZHN0KSk7CiAJ
CXJldHVybiAtRUlOVkFMOwogCX0KIAotCVdBUk5fT04ocGxhbmVfc3RhdGUtPmJhc2UudmlzaWJs
ZSAmJgorCVdBUk5fT04ocGxhbmVfc3RhdGUtPnVhcGkudmlzaWJsZSAmJgogCQlwbGFuZV9zdGF0
ZS0+Y29sb3JfcGxhbmVbMF0uc3RyaWRlICE9IGZiLT5waXRjaGVzWzBdKTsKIAogCXN3aXRjaCAo
ZmItPnBpdGNoZXNbMF0pIHsKQEAgLTEwOTQ4LDkgKzEwOTQ4LDkgQEAgc3RhdGljIHZvaWQgaTg0
NV91cGRhdGVfY3Vyc29yKHN0cnVjdCBpbnRlbF9wbGFuZSAqcGxhbmUsCiAJdTMyIGNudGwgPSAw
LCBiYXNlID0gMCwgcG9zID0gMCwgc2l6ZSA9IDA7CiAJdW5zaWduZWQgbG9uZyBpcnFmbGFnczsK
IAotCWlmIChwbGFuZV9zdGF0ZSAmJiBwbGFuZV9zdGF0ZS0+YmFzZS52aXNpYmxlKSB7Ci0JCXVu
c2lnbmVkIGludCB3aWR0aCA9IGRybV9yZWN0X3dpZHRoKCZwbGFuZV9zdGF0ZS0+YmFzZS5zcmMp
OwotCQl1bnNpZ25lZCBpbnQgaGVpZ2h0ID0gZHJtX3JlY3RfaGVpZ2h0KCZwbGFuZV9zdGF0ZS0+
YmFzZS5kc3QpOworCWlmIChwbGFuZV9zdGF0ZSAmJiBwbGFuZV9zdGF0ZS0+dWFwaS52aXNpYmxl
KSB7CisJCXVuc2lnbmVkIGludCB3aWR0aCA9IGRybV9yZWN0X3dpZHRoKCZwbGFuZV9zdGF0ZS0+
dWFwaS5zcmMpOworCQl1bnNpZ25lZCBpbnQgaGVpZ2h0ID0gZHJtX3JlY3RfaGVpZ2h0KCZwbGFu
ZV9zdGF0ZS0+dWFwaS5kc3QpOwogCiAJCWNudGwgPSBwbGFuZV9zdGF0ZS0+Y3RsIHwKIAkJCWk4
NDVfY3Vyc29yX2N0bF9jcnRjKGNydGNfc3RhdGUpOwpAQCAtMTEwNDYsMTMgKzExMDQ2LDEzIEBA
IHN0YXRpYyB1MzIgaTl4eF9jdXJzb3JfY3RsKGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRl
ICpjcnRjX3N0YXRlLAogCQkJICAgY29uc3Qgc3RydWN0IGludGVsX3BsYW5lX3N0YXRlICpwbGFu
ZV9zdGF0ZSkKIHsKIAlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPQotCQl0b19p
OTE1KHBsYW5lX3N0YXRlLT5iYXNlLnBsYW5lLT5kZXYpOworCQl0b19pOTE1KHBsYW5lX3N0YXRl
LT51YXBpLnBsYW5lLT5kZXYpOwogCXUzMiBjbnRsID0gMDsKIAogCWlmIChJU19HRU4oZGV2X3By
aXYsIDYpIHx8IElTX0lWWUJSSURHRShkZXZfcHJpdikpCiAJCWNudGwgfD0gTUNVUlNPUl9UUklD
S0xFX0ZFRURfRElTQUJMRTsKIAotCXN3aXRjaCAoZHJtX3JlY3Rfd2lkdGgoJnBsYW5lX3N0YXRl
LT5iYXNlLmRzdCkpIHsKKwlzd2l0Y2ggKGRybV9yZWN0X3dpZHRoKCZwbGFuZV9zdGF0ZS0+dWFw
aS5kc3QpKSB7CiAJY2FzZSA2NDoKIAkJY250bCB8PSBNQ1VSU09SX01PREVfNjRfQVJHQl9BWDsK
IAkJYnJlYWs7CkBAIC0xMTA2Myw3ICsxMTA2Myw3IEBAIHN0YXRpYyB1MzIgaTl4eF9jdXJzb3Jf
Y3RsKGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlLAogCQljbnRsIHw9
IE1DVVJTT1JfTU9ERV8yNTZfQVJHQl9BWDsKIAkJYnJlYWs7CiAJZGVmYXVsdDoKLQkJTUlTU0lO
R19DQVNFKGRybV9yZWN0X3dpZHRoKCZwbGFuZV9zdGF0ZS0+YmFzZS5kc3QpKTsKKwkJTUlTU0lO
R19DQVNFKGRybV9yZWN0X3dpZHRoKCZwbGFuZV9zdGF0ZS0+dWFwaS5kc3QpKTsKIAkJcmV0dXJu
IDA7CiAJfQogCkBAIC0xMTA3Niw5ICsxMTA3Niw5IEBAIHN0YXRpYyB1MzIgaTl4eF9jdXJzb3Jf
Y3RsKGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlLAogc3RhdGljIGJv
b2wgaTl4eF9jdXJzb3Jfc2l6ZV9vayhjb25zdCBzdHJ1Y3QgaW50ZWxfcGxhbmVfc3RhdGUgKnBs
YW5lX3N0YXRlKQogewogCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9Ci0JCXRv
X2k5MTUocGxhbmVfc3RhdGUtPmJhc2UucGxhbmUtPmRldik7Ci0JaW50IHdpZHRoID0gZHJtX3Jl
Y3Rfd2lkdGgoJnBsYW5lX3N0YXRlLT5iYXNlLmRzdCk7Ci0JaW50IGhlaWdodCA9IGRybV9yZWN0
X2hlaWdodCgmcGxhbmVfc3RhdGUtPmJhc2UuZHN0KTsKKwkJdG9faTkxNShwbGFuZV9zdGF0ZS0+
dWFwaS5wbGFuZS0+ZGV2KTsKKwlpbnQgd2lkdGggPSBkcm1fcmVjdF93aWR0aCgmcGxhbmVfc3Rh
dGUtPnVhcGkuZHN0KTsKKwlpbnQgaGVpZ2h0ID0gZHJtX3JlY3RfaGVpZ2h0KCZwbGFuZV9zdGF0
ZS0+dWFwaS5kc3QpOwogCiAJaWYgKCFpbnRlbF9jdXJzb3Jfc2l6ZV9vayhwbGFuZV9zdGF0ZSkp
CiAJCXJldHVybiBmYWxzZTsKQEAgLTExMTE0LDcgKzExMTE0LDcgQEAgc3RhdGljIGJvb2wgaTl4
eF9jdXJzb3Jfc2l6ZV9vayhjb25zdCBzdHJ1Y3QgaW50ZWxfcGxhbmVfc3RhdGUgKnBsYW5lX3N0
YXRlKQogc3RhdGljIGludCBpOXh4X2NoZWNrX2N1cnNvcihzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0
ZSAqY3J0Y19zdGF0ZSwKIAkJCSAgICAgc3RydWN0IGludGVsX3BsYW5lX3N0YXRlICpwbGFuZV9z
dGF0ZSkKIHsKLQlzdHJ1Y3QgaW50ZWxfcGxhbmUgKnBsYW5lID0gdG9faW50ZWxfcGxhbmUocGxh
bmVfc3RhdGUtPmJhc2UucGxhbmUpOworCXN0cnVjdCBpbnRlbF9wbGFuZSAqcGxhbmUgPSB0b19p
bnRlbF9wbGFuZShwbGFuZV9zdGF0ZS0+dWFwaS5wbGFuZSk7CiAJc3RydWN0IGRybV9pOTE1X3By
aXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShwbGFuZS0+YmFzZS5kZXYpOwogCWNvbnN0IHN0cnVj
dCBkcm1fZnJhbWVidWZmZXIgKmZiID0gcGxhbmVfc3RhdGUtPmh3LmZiOwogCWVudW0gcGlwZSBw
aXBlID0gcGxhbmUtPnBpcGU7CkBAIC0xMTEzMSwxOSArMTExMzEsMTkgQEAgc3RhdGljIGludCBp
OXh4X2NoZWNrX2N1cnNvcihzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSwKIAkv
KiBDaGVjayBmb3Igd2hpY2ggY3Vyc29yIHR5cGVzIHdlIHN1cHBvcnQgKi8KIAlpZiAoIWk5eHhf
Y3Vyc29yX3NpemVfb2socGxhbmVfc3RhdGUpKSB7CiAJCURSTV9ERUJVRygiQ3Vyc29yIGRpbWVu
c2lvbiAlZHglZCBub3Qgc3VwcG9ydGVkXG4iLAotCQkJICBkcm1fcmVjdF93aWR0aCgmcGxhbmVf
c3RhdGUtPmJhc2UuZHN0KSwKLQkJCSAgZHJtX3JlY3RfaGVpZ2h0KCZwbGFuZV9zdGF0ZS0+YmFz
ZS5kc3QpKTsKKwkJCSAgZHJtX3JlY3Rfd2lkdGgoJnBsYW5lX3N0YXRlLT51YXBpLmRzdCksCisJ
CQkgIGRybV9yZWN0X2hlaWdodCgmcGxhbmVfc3RhdGUtPnVhcGkuZHN0KSk7CiAJCXJldHVybiAt
RUlOVkFMOwogCX0KIAotCVdBUk5fT04ocGxhbmVfc3RhdGUtPmJhc2UudmlzaWJsZSAmJgorCVdB
Uk5fT04ocGxhbmVfc3RhdGUtPnVhcGkudmlzaWJsZSAmJgogCQlwbGFuZV9zdGF0ZS0+Y29sb3Jf
cGxhbmVbMF0uc3RyaWRlICE9IGZiLT5waXRjaGVzWzBdKTsKIAogCWlmIChmYi0+cGl0Y2hlc1sw
XSAhPQotCSAgICBkcm1fcmVjdF93aWR0aCgmcGxhbmVfc3RhdGUtPmJhc2UuZHN0KSAqIGZiLT5m
b3JtYXQtPmNwcFswXSkgeworCSAgICBkcm1fcmVjdF93aWR0aCgmcGxhbmVfc3RhdGUtPnVhcGku
ZHN0KSAqIGZiLT5mb3JtYXQtPmNwcFswXSkgewogCQlEUk1fREVCVUdfS01TKCJJbnZhbGlkIGN1
cnNvciBzdHJpZGUgKCV1KSAoY3Vyc29yIHdpZHRoICVkKVxuIiwKIAkJCSAgICAgIGZiLT5waXRj
aGVzWzBdLAotCQkJICAgICAgZHJtX3JlY3Rfd2lkdGgoJnBsYW5lX3N0YXRlLT5iYXNlLmRzdCkp
OworCQkJICAgICAgZHJtX3JlY3Rfd2lkdGgoJnBsYW5lX3N0YXRlLT51YXBpLmRzdCkpOwogCQly
ZXR1cm4gLUVJTlZBTDsKIAl9CiAKQEAgLTExMTU4LDcgKzExMTU4LDcgQEAgc3RhdGljIGludCBp
OXh4X2NoZWNrX2N1cnNvcihzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSwKIAkg
KiBSZWZ1c2UgdGhlIHB1dCB0aGUgY3Vyc29yIGludG8gdGhhdCBjb21wcm9taXNlZCBwb3NpdGlv
bi4KIAkgKi8KIAlpZiAoSVNfQ0hFUlJZVklFVyhkZXZfcHJpdikgJiYgcGlwZSA9PSBQSVBFX0Mg
JiYKLQkgICAgcGxhbmVfc3RhdGUtPmJhc2UudmlzaWJsZSAmJiBwbGFuZV9zdGF0ZS0+YmFzZS5k
c3QueDEgPCAwKSB7CisJICAgIHBsYW5lX3N0YXRlLT51YXBpLnZpc2libGUgJiYgcGxhbmVfc3Rh
dGUtPnVhcGkuZHN0LngxIDwgMCkgewogCQlEUk1fREVCVUdfS01TKCJDSFYgY3Vyc29yIEMgbm90
IGFsbG93ZWQgdG8gc3RyYWRkbGUgdGhlIGxlZnQgc2NyZWVuIGVkZ2VcbiIpOwogCQlyZXR1cm4g
LUVJTlZBTDsKIAl9CkBAIC0xMTE3Nyw5ICsxMTE3Nyw5IEBAIHN0YXRpYyB2b2lkIGk5eHhfdXBk
YXRlX2N1cnNvcihzdHJ1Y3QgaW50ZWxfcGxhbmUgKnBsYW5lLAogCXUzMiBjbnRsID0gMCwgYmFz
ZSA9IDAsIHBvcyA9IDAsIGZiY19jdGwgPSAwOwogCXVuc2lnbmVkIGxvbmcgaXJxZmxhZ3M7CiAK
LQlpZiAocGxhbmVfc3RhdGUgJiYgcGxhbmVfc3RhdGUtPmJhc2UudmlzaWJsZSkgewotCQl1bnNp
Z25lZCB3aWR0aCA9IGRybV9yZWN0X3dpZHRoKCZwbGFuZV9zdGF0ZS0+YmFzZS5kc3QpOwotCQl1
bnNpZ25lZCBoZWlnaHQgPSBkcm1fcmVjdF9oZWlnaHQoJnBsYW5lX3N0YXRlLT5iYXNlLmRzdCk7
CisJaWYgKHBsYW5lX3N0YXRlICYmIHBsYW5lX3N0YXRlLT51YXBpLnZpc2libGUpIHsKKwkJdW5z
aWduZWQgd2lkdGggPSBkcm1fcmVjdF93aWR0aCgmcGxhbmVfc3RhdGUtPnVhcGkuZHN0KTsKKwkJ
dW5zaWduZWQgaGVpZ2h0ID0gZHJtX3JlY3RfaGVpZ2h0KCZwbGFuZV9zdGF0ZS0+dWFwaS5kc3Qp
OwogCiAJCWNudGwgPSBwbGFuZV9zdGF0ZS0+Y3RsIHwKIAkJCWk5eHhfY3Vyc29yX2N0bF9jcnRj
KGNydGNfc3RhdGUpOwpAQCAtMTE3MTcsNyArMTE3MTcsNyBAQCBzdGF0aWMgYm9vbCBpbnRlbF93
bV9uZWVkX3VwZGF0ZShjb25zdCBzdHJ1Y3QgaW50ZWxfcGxhbmVfc3RhdGUgKmN1ciwKIAkJCQkg
c3RydWN0IGludGVsX3BsYW5lX3N0YXRlICpuZXcpCiB7CiAJLyogVXBkYXRlIHdhdGVybWFya3Mg
b24gdGlsaW5nIG9yIHNpemUgY2hhbmdlcy4gKi8KLQlpZiAobmV3LT5iYXNlLnZpc2libGUgIT0g
Y3VyLT5iYXNlLnZpc2libGUpCisJaWYgKG5ldy0+dWFwaS52aXNpYmxlICE9IGN1ci0+dWFwaS52
aXNpYmxlKQogCQlyZXR1cm4gdHJ1ZTsKIAogCWlmICghY3VyLT5ody5mYiB8fCAhbmV3LT5ody5m
YikKQEAgLTExNzI1LDEwICsxMTcyNSwxMCBAQCBzdGF0aWMgYm9vbCBpbnRlbF93bV9uZWVkX3Vw
ZGF0ZShjb25zdCBzdHJ1Y3QgaW50ZWxfcGxhbmVfc3RhdGUgKmN1ciwKIAogCWlmIChjdXItPmh3
LmZiLT5tb2RpZmllciAhPSBuZXctPmh3LmZiLT5tb2RpZmllciB8fAogCSAgICBjdXItPmh3LnJv
dGF0aW9uICE9IG5ldy0+aHcucm90YXRpb24gfHwKLQkgICAgZHJtX3JlY3Rfd2lkdGgoJm5ldy0+
YmFzZS5zcmMpICE9IGRybV9yZWN0X3dpZHRoKCZjdXItPmJhc2Uuc3JjKSB8fAotCSAgICBkcm1f
cmVjdF9oZWlnaHQoJm5ldy0+YmFzZS5zcmMpICE9IGRybV9yZWN0X2hlaWdodCgmY3VyLT5iYXNl
LnNyYykgfHwKLQkgICAgZHJtX3JlY3Rfd2lkdGgoJm5ldy0+YmFzZS5kc3QpICE9IGRybV9yZWN0
X3dpZHRoKCZjdXItPmJhc2UuZHN0KSB8fAotCSAgICBkcm1fcmVjdF9oZWlnaHQoJm5ldy0+YmFz
ZS5kc3QpICE9IGRybV9yZWN0X2hlaWdodCgmY3VyLT5iYXNlLmRzdCkpCisJICAgIGRybV9yZWN0
X3dpZHRoKCZuZXctPnVhcGkuc3JjKSAhPSBkcm1fcmVjdF93aWR0aCgmY3VyLT51YXBpLnNyYykg
fHwKKwkgICAgZHJtX3JlY3RfaGVpZ2h0KCZuZXctPnVhcGkuc3JjKSAhPSBkcm1fcmVjdF9oZWln
aHQoJmN1ci0+dWFwaS5zcmMpIHx8CisJICAgIGRybV9yZWN0X3dpZHRoKCZuZXctPnVhcGkuZHN0
KSAhPSBkcm1fcmVjdF93aWR0aCgmY3VyLT51YXBpLmRzdCkgfHwKKwkgICAgZHJtX3JlY3RfaGVp
Z2h0KCZuZXctPnVhcGkuZHN0KSAhPSBkcm1fcmVjdF9oZWlnaHQoJmN1ci0+dWFwaS5kc3QpKQog
CQlyZXR1cm4gdHJ1ZTsKIAogCXJldHVybiBmYWxzZTsKQEAgLTExNzM2LDEwICsxMTczNiwxMCBA
QCBzdGF0aWMgYm9vbCBpbnRlbF93bV9uZWVkX3VwZGF0ZShjb25zdCBzdHJ1Y3QgaW50ZWxfcGxh
bmVfc3RhdGUgKmN1ciwKIAogc3RhdGljIGJvb2wgbmVlZHNfc2NhbGluZyhjb25zdCBzdHJ1Y3Qg
aW50ZWxfcGxhbmVfc3RhdGUgKnN0YXRlKQogewotCWludCBzcmNfdyA9IGRybV9yZWN0X3dpZHRo
KCZzdGF0ZS0+YmFzZS5zcmMpID4+IDE2OwotCWludCBzcmNfaCA9IGRybV9yZWN0X2hlaWdodCgm
c3RhdGUtPmJhc2Uuc3JjKSA+PiAxNjsKLQlpbnQgZHN0X3cgPSBkcm1fcmVjdF93aWR0aCgmc3Rh
dGUtPmJhc2UuZHN0KTsKLQlpbnQgZHN0X2ggPSBkcm1fcmVjdF9oZWlnaHQoJnN0YXRlLT5iYXNl
LmRzdCk7CisJaW50IHNyY193ID0gZHJtX3JlY3Rfd2lkdGgoJnN0YXRlLT51YXBpLnNyYykgPj4g
MTY7CisJaW50IHNyY19oID0gZHJtX3JlY3RfaGVpZ2h0KCZzdGF0ZS0+dWFwaS5zcmMpID4+IDE2
OworCWludCBkc3RfdyA9IGRybV9yZWN0X3dpZHRoKCZzdGF0ZS0+dWFwaS5kc3QpOworCWludCBk
c3RfaCA9IGRybV9yZWN0X2hlaWdodCgmc3RhdGUtPnVhcGkuZHN0KTsKIAogCXJldHVybiAoc3Jj
X3cgIT0gZHN0X3cgfHwgc3JjX2ggIT0gZHN0X2gpOwogfQpAQCAtMTE3NTAsNyArMTE3NTAsNyBA
QCBpbnQgaW50ZWxfcGxhbmVfYXRvbWljX2NhbGNfY2hhbmdlcyhjb25zdCBzdHJ1Y3QgaW50ZWxf
Y3J0Y19zdGF0ZSAqb2xkX2NydGNfc3RhdAogCQkJCSAgICBzdHJ1Y3QgaW50ZWxfcGxhbmVfc3Rh
dGUgKnBsYW5lX3N0YXRlKQogewogCXN0cnVjdCBpbnRlbF9jcnRjICpjcnRjID0gdG9faW50ZWxf
Y3J0YyhjcnRjX3N0YXRlLT51YXBpLmNydGMpOwotCXN0cnVjdCBpbnRlbF9wbGFuZSAqcGxhbmUg
PSB0b19pbnRlbF9wbGFuZShwbGFuZV9zdGF0ZS0+YmFzZS5wbGFuZSk7CisJc3RydWN0IGludGVs
X3BsYW5lICpwbGFuZSA9IHRvX2ludGVsX3BsYW5lKHBsYW5lX3N0YXRlLT51YXBpLnBsYW5lKTsK
IAlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGNydGMtPmJhc2Uu
ZGV2KTsKIAlib29sIG1vZGVfY2hhbmdlZCA9IG5lZWRzX21vZGVzZXQoY3J0Y19zdGF0ZSk7CiAJ
Ym9vbCB3YXNfY3J0Y19lbmFibGVkID0gb2xkX2NydGNfc3RhdGUtPmh3LmFjdGl2ZTsKQEAgLTEx
NzY0LDggKzExNzY0LDggQEAgaW50IGludGVsX3BsYW5lX2F0b21pY19jYWxjX2NoYW5nZXMoY29u
c3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKm9sZF9jcnRjX3N0YXQKIAkJCXJldHVybiByZXQ7
CiAJfQogCi0Jd2FzX3Zpc2libGUgPSBvbGRfcGxhbmVfc3RhdGUtPmJhc2UudmlzaWJsZTsKLQl2
aXNpYmxlID0gcGxhbmVfc3RhdGUtPmJhc2UudmlzaWJsZTsKKwl3YXNfdmlzaWJsZSA9IG9sZF9w
bGFuZV9zdGF0ZS0+dWFwaS52aXNpYmxlOworCXZpc2libGUgPSBwbGFuZV9zdGF0ZS0+dWFwaS52
aXNpYmxlOwogCiAJaWYgKCF3YXNfY3J0Y19lbmFibGVkICYmIFdBUk5fT04od2FzX3Zpc2libGUp
KQogCQl3YXNfdmlzaWJsZSA9IGZhbHNlOwpAQCAtMTE3ODEsNyArMTE3ODEsNyBAQCBpbnQgaW50
ZWxfcGxhbmVfYXRvbWljX2NhbGNfY2hhbmdlcyhjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0
ZSAqb2xkX2NydGNfc3RhdAogCSAqIG9ubHkgY29tYmluZSB0aGUgcmVzdWx0cyBmcm9tIGFsbCBw
bGFuZXMgaW4gdGhlIGN1cnJlbnQgcGxhY2U/CiAJICovCiAJaWYgKCFpc19jcnRjX2VuYWJsZWQp
IHsKLQkJcGxhbmVfc3RhdGUtPmJhc2UudmlzaWJsZSA9IHZpc2libGUgPSBmYWxzZTsKKwkJcGxh
bmVfc3RhdGUtPnVhcGkudmlzaWJsZSA9IHZpc2libGUgPSBmYWxzZTsKIAkJY3J0Y19zdGF0ZS0+
YWN0aXZlX3BsYW5lcyAmPSB+QklUKHBsYW5lLT5pZCk7CiAJCWNydGNfc3RhdGUtPmRhdGFfcmF0
ZVtwbGFuZS0+aWRdID0gMDsKIAkJY3J0Y19zdGF0ZS0+bWluX2NkY2xrW3BsYW5lLT5pZF0gPSAw
OwpAQCAtMTE5NDEsNyArMTE5NDEsNyBAQCBzdGF0aWMgaW50IGljbF9jaGVja19udjEyX3BsYW5l
cyhzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSkKIAkJCWNvbnRpbnVlOwogCiAJ
CXBsYW5lX3N0YXRlLT5wbGFuYXJfbGlua2VkX3BsYW5lID0gTlVMTDsKLQkJaWYgKHBsYW5lX3N0
YXRlLT5wbGFuYXJfc2xhdmUgJiYgIXBsYW5lX3N0YXRlLT5iYXNlLnZpc2libGUpIHsKKwkJaWYg
KHBsYW5lX3N0YXRlLT5wbGFuYXJfc2xhdmUgJiYgIXBsYW5lX3N0YXRlLT51YXBpLnZpc2libGUp
IHsKIAkJCWNydGNfc3RhdGUtPmFjdGl2ZV9wbGFuZXMgJj0gfkJJVChwbGFuZS0+aWQpOwogCQkJ
Y3J0Y19zdGF0ZS0+dXBkYXRlX3BsYW5lcyB8PSBCSVQocGxhbmUtPmlkKTsKIAkJfQpAQCAtMTIz
NTUsMTQgKzEyMzU1LDE0IEBAIHN0YXRpYyBjb25zdCBjaGFyICpvdXRwdXRfZm9ybWF0cyhlbnVt
IGludGVsX291dHB1dF9mb3JtYXQgZm9ybWF0KQogCiBzdGF0aWMgdm9pZCBpbnRlbF9kdW1wX3Bs
YW5lX3N0YXRlKGNvbnN0IHN0cnVjdCBpbnRlbF9wbGFuZV9zdGF0ZSAqcGxhbmVfc3RhdGUpCiB7
Ci0Jc3RydWN0IGludGVsX3BsYW5lICpwbGFuZSA9IHRvX2ludGVsX3BsYW5lKHBsYW5lX3N0YXRl
LT5iYXNlLnBsYW5lKTsKKwlzdHJ1Y3QgaW50ZWxfcGxhbmUgKnBsYW5lID0gdG9faW50ZWxfcGxh
bmUocGxhbmVfc3RhdGUtPnVhcGkucGxhbmUpOwogCWNvbnN0IHN0cnVjdCBkcm1fZnJhbWVidWZm
ZXIgKmZiID0gcGxhbmVfc3RhdGUtPmh3LmZiOwogCXN0cnVjdCBkcm1fZm9ybWF0X25hbWVfYnVm
IGZvcm1hdF9uYW1lOwogCiAJaWYgKCFmYikgewogCQlEUk1fREVCVUdfS01TKCJbUExBTkU6JWQ6
JXNdIGZiOiBbTk9GQl0sIHZpc2libGU6ICVzXG4iLAogCQkJICAgICAgcGxhbmUtPmJhc2UuYmFz
ZS5pZCwgcGxhbmUtPmJhc2UubmFtZSwKLQkJCSAgICAgIHllc25vKHBsYW5lX3N0YXRlLT5iYXNl
LnZpc2libGUpKTsKKwkJCSAgICAgIHllc25vKHBsYW5lX3N0YXRlLT51YXBpLnZpc2libGUpKTsK
IAkJcmV0dXJuOwogCX0KIApAQCAtMTIzNzAsMTMgKzEyMzcwLDEzIEBAIHN0YXRpYyB2b2lkIGlu
dGVsX2R1bXBfcGxhbmVfc3RhdGUoY29uc3Qgc3RydWN0IGludGVsX3BsYW5lX3N0YXRlICpwbGFu
ZV9zdGF0ZSkKIAkJICAgICAgcGxhbmUtPmJhc2UuYmFzZS5pZCwgcGxhbmUtPmJhc2UubmFtZSwK
IAkJICAgICAgZmItPmJhc2UuaWQsIGZiLT53aWR0aCwgZmItPmhlaWdodCwKIAkJICAgICAgZHJt
X2dldF9mb3JtYXRfbmFtZShmYi0+Zm9ybWF0LT5mb3JtYXQsICZmb3JtYXRfbmFtZSksCi0JCSAg
ICAgIHllc25vKHBsYW5lX3N0YXRlLT5iYXNlLnZpc2libGUpKTsKKwkJICAgICAgeWVzbm8ocGxh
bmVfc3RhdGUtPnVhcGkudmlzaWJsZSkpOwogCURSTV9ERUJVR19LTVMoIlx0cm90YXRpb246IDB4
JXgsIHNjYWxlcjogJWRcbiIsCiAJCSAgICAgIHBsYW5lX3N0YXRlLT5ody5yb3RhdGlvbiwgcGxh
bmVfc3RhdGUtPnNjYWxlcl9pZCk7Ci0JaWYgKHBsYW5lX3N0YXRlLT5iYXNlLnZpc2libGUpCisJ
aWYgKHBsYW5lX3N0YXRlLT51YXBpLnZpc2libGUpCiAJCURSTV9ERUJVR19LTVMoIlx0c3JjOiAi
IERSTV9SRUNUX0ZQX0ZNVCAiIGRzdDogIiBEUk1fUkVDVF9GTVQgIlxuIiwKLQkJCSAgICAgIERS
TV9SRUNUX0ZQX0FSRygmcGxhbmVfc3RhdGUtPmJhc2Uuc3JjKSwKLQkJCSAgICAgIERSTV9SRUNU
X0FSRygmcGxhbmVfc3RhdGUtPmJhc2UuZHN0KSk7CisJCQkgICAgICBEUk1fUkVDVF9GUF9BUkco
JnBsYW5lX3N0YXRlLT51YXBpLnNyYyksCisJCQkgICAgICBEUk1fUkVDVF9BUkcoJnBsYW5lX3N0
YXRlLT51YXBpLmRzdCkpOwogfQogCiBzdGF0aWMgdm9pZCBpbnRlbF9kdW1wX3BpcGVfY29uZmln
KGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpwaXBlX2NvbmZpZywKQEAgLTEzNTgyLDcg
KzEzNTgyLDcgQEAgaW50ZWxfdmVyaWZ5X3BsYW5lcyhzdHJ1Y3QgaW50ZWxfYXRvbWljX3N0YXRl
ICpzdGF0ZSkKIAlmb3JfZWFjaF9uZXdfaW50ZWxfcGxhbmVfaW5fc3RhdGUoc3RhdGUsIHBsYW5l
LAogCQkJCQkgIHBsYW5lX3N0YXRlLCBpKQogCQlhc3NlcnRfcGxhbmUocGxhbmUsIHBsYW5lX3N0
YXRlLT5wbGFuYXJfc2xhdmUgfHwKLQkJCSAgICAgcGxhbmVfc3RhdGUtPmJhc2UudmlzaWJsZSk7
CisJCQkgICAgIHBsYW5lX3N0YXRlLT51YXBpLnZpc2libGUpOwogfQogCiBzdGF0aWMgdm9pZApA
QCAtMTUwNDQsNyArMTUwNDQsNyBAQCBzdGF0aWMgdm9pZCBhZGRfcnBzX2Jvb3N0X2FmdGVyX3Zi
bGFuayhzdHJ1Y3QgZHJtX2NydGMgKmNydGMsCiAKIHN0YXRpYyBpbnQgaW50ZWxfcGxhbmVfcGlu
X2ZiKHN0cnVjdCBpbnRlbF9wbGFuZV9zdGF0ZSAqcGxhbmVfc3RhdGUpCiB7Ci0Jc3RydWN0IGlu
dGVsX3BsYW5lICpwbGFuZSA9IHRvX2ludGVsX3BsYW5lKHBsYW5lX3N0YXRlLT5iYXNlLnBsYW5l
KTsKKwlzdHJ1Y3QgaW50ZWxfcGxhbmUgKnBsYW5lID0gdG9faW50ZWxfcGxhbmUocGxhbmVfc3Rh
dGUtPnVhcGkucGxhbmUpOwogCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRv
X2k5MTUocGxhbmUtPmJhc2UuZGV2KTsKIAlzdHJ1Y3QgZHJtX2ZyYW1lYnVmZmVyICpmYiA9IHBs
YW5lX3N0YXRlLT5ody5mYjsKIAlzdHJ1Y3QgaTkxNV92bWEgKnZtYTsKQEAgLTE1MTA5LDcgKzE1
MTA5LDcgQEAgaW50ZWxfcHJlcGFyZV9wbGFuZV9mYihzdHJ1Y3QgZHJtX3BsYW5lICpwbGFuZSwK
IAlzdHJ1Y3QgaW50ZWxfcGxhbmVfc3RhdGUgKm5ld19wbGFuZV9zdGF0ZSA9CiAJCXRvX2ludGVs
X3BsYW5lX3N0YXRlKF9uZXdfcGxhbmVfc3RhdGUpOwogCXN0cnVjdCBpbnRlbF9hdG9taWNfc3Rh
dGUgKmludGVsX3N0YXRlID0KLQkJdG9faW50ZWxfYXRvbWljX3N0YXRlKG5ld19wbGFuZV9zdGF0
ZS0+YmFzZS5zdGF0ZSk7CisJCXRvX2ludGVsX2F0b21pY19zdGF0ZShuZXdfcGxhbmVfc3RhdGUt
PnVhcGkuc3RhdGUpOwogCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5
MTUocGxhbmUtPmRldik7CiAJc3RydWN0IGRybV9mcmFtZWJ1ZmZlciAqZmIgPSBuZXdfcGxhbmVf
c3RhdGUtPmh3LmZiOwogCXN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmogPSBpbnRlbF9m
Yl9vYmooZmIpOwpAQCAtMTUxNDIsOSArMTUxNDIsOSBAQCBpbnRlbF9wcmVwYXJlX3BsYW5lX2Zi
KHN0cnVjdCBkcm1fcGxhbmUgKnBsYW5lLAogCQl9CiAJfQogCi0JaWYgKG5ld19wbGFuZV9zdGF0
ZS0+YmFzZS5mZW5jZSkgeyAvKiBleHBsaWNpdCBmZW5jaW5nICovCisJaWYgKG5ld19wbGFuZV9z
dGF0ZS0+dWFwaS5mZW5jZSkgeyAvKiBleHBsaWNpdCBmZW5jaW5nICovCiAJCXJldCA9IGk5MTVf
c3dfZmVuY2VfYXdhaXRfZG1hX2ZlbmNlKCZpbnRlbF9zdGF0ZS0+Y29tbWl0X3JlYWR5LAotCQkJ
CQkJICAgIG5ld19wbGFuZV9zdGF0ZS0+YmFzZS5mZW5jZSwKKwkJCQkJCSAgICBuZXdfcGxhbmVf
c3RhdGUtPnVhcGkuZmVuY2UsCiAJCQkJCQkgICAgSTkxNV9GRU5DRV9USU1FT1VULAogCQkJCQkJ
ICAgIEdGUF9LRVJORUwpOwogCQlpZiAocmV0IDwgMCkKQEAgLTE1MTY3LDcgKzE1MTY3LDcgQEAg
aW50ZWxfcHJlcGFyZV9wbGFuZV9mYihzdHJ1Y3QgZHJtX3BsYW5lICpwbGFuZSwKIAlmYl9vYmpf
YnVtcF9yZW5kZXJfcHJpb3JpdHkob2JqKTsKIAlpbnRlbF9mcm9udGJ1ZmZlcl9mbHVzaChvYmot
PmZyb250YnVmZmVyLCBPUklHSU5fRElSVFlGQik7CiAKLQlpZiAoIW5ld19wbGFuZV9zdGF0ZS0+
YmFzZS5mZW5jZSkgeyAvKiBpbXBsaWNpdCBmZW5jaW5nICovCisJaWYgKCFuZXdfcGxhbmVfc3Rh
dGUtPnVhcGkuZmVuY2UpIHsgLyogaW1wbGljaXQgZmVuY2luZyAqLwogCQlzdHJ1Y3QgZG1hX2Zl
bmNlICpmZW5jZTsKIAogCQlyZXQgPSBpOTE1X3N3X2ZlbmNlX2F3YWl0X3Jlc2VydmF0aW9uKCZp
bnRlbF9zdGF0ZS0+Y29tbWl0X3JlYWR5LApAQCAtMTUxODUsNyArMTUxODUsNyBAQCBpbnRlbF9w
cmVwYXJlX3BsYW5lX2ZiKHN0cnVjdCBkcm1fcGxhbmUgKnBsYW5lLAogCQl9CiAJfSBlbHNlIHsK
IAkJYWRkX3Jwc19ib29zdF9hZnRlcl92YmxhbmsobmV3X3BsYW5lX3N0YXRlLT5ody5jcnRjLAot
CQkJCQkgICBuZXdfcGxhbmVfc3RhdGUtPmJhc2UuZmVuY2UpOworCQkJCQkgICBuZXdfcGxhbmVf
c3RhdGUtPnVhcGkuZmVuY2UpOwogCX0KIAogCS8qCkBAIC0xNTIxOCw3ICsxNTIxOCw3IEBAIGlu
dGVsX2NsZWFudXBfcGxhbmVfZmIoc3RydWN0IGRybV9wbGFuZSAqcGxhbmUsCiAJc3RydWN0IGlu
dGVsX3BsYW5lX3N0YXRlICpvbGRfcGxhbmVfc3RhdGUgPQogCQl0b19pbnRlbF9wbGFuZV9zdGF0
ZShfb2xkX3BsYW5lX3N0YXRlKTsKIAlzdHJ1Y3QgaW50ZWxfYXRvbWljX3N0YXRlICppbnRlbF9z
dGF0ZSA9Ci0JCXRvX2ludGVsX2F0b21pY19zdGF0ZShvbGRfcGxhbmVfc3RhdGUtPmJhc2Uuc3Rh
dGUpOworCQl0b19pbnRlbF9hdG9taWNfc3RhdGUob2xkX3BsYW5lX3N0YXRlLT51YXBpLnN0YXRl
KTsKIAlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KHBsYW5lLT5k
ZXYpOwogCiAJaWYgKGludGVsX3N0YXRlLT5ycHNfaW50ZXJhY3RpdmUpIHsKQEAgLTE1MzUwLDgg
KzE1MzUwLDggQEAgaW50ZWxfbGVnYWN5X2N1cnNvcl91cGRhdGUoc3RydWN0IGRybV9wbGFuZSAq
X3BsYW5lLAogCSAqIHRoZSBwbGFuZS4gIFRoaXMgcHJldmVudHMgb3VyIGFzeW5jIHVwZGF0ZSdz
IGNoYW5nZXMgZnJvbSBnZXR0aW5nCiAJICogb3ZlcnJpZGRlbiBieSBhIHByZXZpb3VzIHN5bmNo
cm9ub3VzIHVwZGF0ZSdzIHN0YXRlLgogCSAqLwotCWlmIChvbGRfcGxhbmVfc3RhdGUtPmJhc2Uu
Y29tbWl0ICYmCi0JICAgICF0cnlfd2FpdF9mb3JfY29tcGxldGlvbigmb2xkX3BsYW5lX3N0YXRl
LT5iYXNlLmNvbW1pdC0+aHdfZG9uZSkpCisJaWYgKG9sZF9wbGFuZV9zdGF0ZS0+dWFwaS5jb21t
aXQgJiYKKwkgICAgIXRyeV93YWl0X2Zvcl9jb21wbGV0aW9uKCZvbGRfcGxhbmVfc3RhdGUtPnVh
cGkuY29tbWl0LT5od19kb25lKSkKIAkJZ290byBzbG93OwogCiAJLyoKQEAgLTE1MzYwLDEwICsx
NTM2MCwxMCBAQCBpbnRlbF9sZWdhY3lfY3Vyc29yX3VwZGF0ZShzdHJ1Y3QgZHJtX3BsYW5lICpf
cGxhbmUsCiAJICogaW4gdGhlIGZhc3RwYXRoLgogCSAqLwogCWlmIChvbGRfcGxhbmVfc3RhdGUt
PnVhcGkuY3J0YyAhPSAmY3J0Yy0+YmFzZSB8fAotCSAgICBvbGRfcGxhbmVfc3RhdGUtPmJhc2Uu
c3JjX3cgIT0gc3JjX3cgfHwKLQkgICAgb2xkX3BsYW5lX3N0YXRlLT5iYXNlLnNyY19oICE9IHNy
Y19oIHx8Ci0JICAgIG9sZF9wbGFuZV9zdGF0ZS0+YmFzZS5jcnRjX3cgIT0gY3J0Y193IHx8Ci0J
ICAgIG9sZF9wbGFuZV9zdGF0ZS0+YmFzZS5jcnRjX2ggIT0gY3J0Y19oIHx8CisJICAgIG9sZF9w
bGFuZV9zdGF0ZS0+dWFwaS5zcmNfdyAhPSBzcmNfdyB8fAorCSAgICBvbGRfcGxhbmVfc3RhdGUt
PnVhcGkuc3JjX2ggIT0gc3JjX2ggfHwKKwkgICAgb2xkX3BsYW5lX3N0YXRlLT51YXBpLmNydGNf
dyAhPSBjcnRjX3cgfHwKKwkgICAgb2xkX3BsYW5lX3N0YXRlLT51YXBpLmNydGNfaCAhPSBjcnRj
X2ggfHwKIAkgICAgIW9sZF9wbGFuZV9zdGF0ZS0+dWFwaS5mYiAhPSAhZmIpCiAJCWdvdG8gc2xv
dzsKIApAQCAtMTUzNzcsMTYgKzE1Mzc3LDE2IEBAIGludGVsX2xlZ2FjeV9jdXJzb3JfdXBkYXRl
KHN0cnVjdCBkcm1fcGxhbmUgKl9wbGFuZSwKIAkJZ290byBvdXRfZnJlZTsKIAl9CiAKLQlkcm1f
YXRvbWljX3NldF9mYl9mb3JfcGxhbmUoJm5ld19wbGFuZV9zdGF0ZS0+YmFzZSwgZmIpOworCWRy
bV9hdG9taWNfc2V0X2ZiX2Zvcl9wbGFuZSgmbmV3X3BsYW5lX3N0YXRlLT51YXBpLCBmYik7CiAK
LQluZXdfcGxhbmVfc3RhdGUtPmJhc2Uuc3JjX3ggPSBzcmNfeDsKLQluZXdfcGxhbmVfc3RhdGUt
PmJhc2Uuc3JjX3kgPSBzcmNfeTsKLQluZXdfcGxhbmVfc3RhdGUtPmJhc2Uuc3JjX3cgPSBzcmNf
dzsKLQluZXdfcGxhbmVfc3RhdGUtPmJhc2Uuc3JjX2ggPSBzcmNfaDsKLQluZXdfcGxhbmVfc3Rh
dGUtPmJhc2UuY3J0Y194ID0gY3J0Y194OwotCW5ld19wbGFuZV9zdGF0ZS0+YmFzZS5jcnRjX3kg
PSBjcnRjX3k7Ci0JbmV3X3BsYW5lX3N0YXRlLT5iYXNlLmNydGNfdyA9IGNydGNfdzsKLQluZXdf
cGxhbmVfc3RhdGUtPmJhc2UuY3J0Y19oID0gY3J0Y19oOworCW5ld19wbGFuZV9zdGF0ZS0+dWFw
aS5zcmNfeCA9IHNyY194OworCW5ld19wbGFuZV9zdGF0ZS0+dWFwaS5zcmNfeSA9IHNyY195Owor
CW5ld19wbGFuZV9zdGF0ZS0+dWFwaS5zcmNfdyA9IHNyY193OworCW5ld19wbGFuZV9zdGF0ZS0+
dWFwaS5zcmNfaCA9IHNyY19oOworCW5ld19wbGFuZV9zdGF0ZS0+dWFwaS5jcnRjX3ggPSBjcnRj
X3g7CisJbmV3X3BsYW5lX3N0YXRlLT51YXBpLmNydGNfeSA9IGNydGNfeTsKKwluZXdfcGxhbmVf
c3RhdGUtPnVhcGkuY3J0Y193ID0gY3J0Y193OworCW5ld19wbGFuZV9zdGF0ZS0+dWFwaS5jcnRj
X2ggPSBjcnRjX2g7CiAKIAlyZXQgPSBpbnRlbF9wbGFuZV9hdG9taWNfY2hlY2tfd2l0aF9zdGF0
ZShjcnRjX3N0YXRlLCBuZXdfY3J0Y19zdGF0ZSwKIAkJCQkJCSAgb2xkX3BsYW5lX3N0YXRlLCBu
ZXdfcGxhbmVfc3RhdGUpOwpAQCAtMTU0MDQsNyArMTU0MDQsNyBAQCBpbnRlbF9sZWdhY3lfY3Vy
c29yX3VwZGF0ZShzdHJ1Y3QgZHJtX3BsYW5lICpfcGxhbmUsCiAJCQkJcGxhbmUtPmZyb250YnVm
ZmVyX2JpdCk7CiAKIAkvKiBTd2FwIHBsYW5lIHN0YXRlICovCi0JcGxhbmUtPmJhc2Uuc3RhdGUg
PSAmbmV3X3BsYW5lX3N0YXRlLT5iYXNlOworCXBsYW5lLT5iYXNlLnN0YXRlID0gJm5ld19wbGFu
ZV9zdGF0ZS0+dWFwaTsKIAogCS8qCiAJICogV2UgY2Fubm90IHN3YXAgY3J0Y19zdGF0ZSBhcyBp
dCBtYXkgYmUgaW4gdXNlIGJ5IGFuIGF0b21pYyBjb21taXQgb3IKQEAgLTE1NDE4LDcgKzE1NDE4
LDcgQEAgaW50ZWxfbGVnYWN5X2N1cnNvcl91cGRhdGUoc3RydWN0IGRybV9wbGFuZSAqX3BsYW5l
LAogCSAqLwogCWNydGNfc3RhdGUtPmFjdGl2ZV9wbGFuZXMgPSBuZXdfY3J0Y19zdGF0ZS0+YWN0
aXZlX3BsYW5lczsKIAotCWlmIChuZXdfcGxhbmVfc3RhdGUtPmJhc2UudmlzaWJsZSkKKwlpZiAo
bmV3X3BsYW5lX3N0YXRlLT51YXBpLnZpc2libGUpCiAJCWludGVsX3VwZGF0ZV9wbGFuZShwbGFu
ZSwgY3J0Y19zdGF0ZSwgbmV3X3BsYW5lX3N0YXRlKTsKIAllbHNlCiAJCWludGVsX2Rpc2FibGVf
cGxhbmUocGxhbmUsIGNydGNfc3RhdGUpOwpAQCAtMTU0MjksOSArMTU0MjksMTEgQEAgaW50ZWxf
bGVnYWN5X2N1cnNvcl91cGRhdGUoc3RydWN0IGRybV9wbGFuZSAqX3BsYW5lLAogCWlmIChuZXdf
Y3J0Y19zdGF0ZSkKIAkJaW50ZWxfY3J0Y19kZXN0cm95X3N0YXRlKCZjcnRjLT5iYXNlLCAmbmV3
X2NydGNfc3RhdGUtPnVhcGkpOwogCWlmIChyZXQpCi0JCWludGVsX3BsYW5lX2Rlc3Ryb3lfc3Rh
dGUoJnBsYW5lLT5iYXNlLCAmbmV3X3BsYW5lX3N0YXRlLT5iYXNlKTsKKwkJaW50ZWxfcGxhbmVf
ZGVzdHJveV9zdGF0ZSgmcGxhbmUtPmJhc2UsCisJCQkJCSAgJm5ld19wbGFuZV9zdGF0ZS0+dWFw
aSk7CiAJZWxzZQotCQlpbnRlbF9wbGFuZV9kZXN0cm95X3N0YXRlKCZwbGFuZS0+YmFzZSwgJm9s
ZF9wbGFuZV9zdGF0ZS0+YmFzZSk7CisJCWludGVsX3BsYW5lX2Rlc3Ryb3lfc3RhdGUoJnBsYW5l
LT5iYXNlLAorCQkJCQkgICZvbGRfcGxhbmVfc3RhdGUtPnVhcGkpOwogCXJldHVybiByZXQ7CiAK
IHNsb3c6CkBAIC0xNzE1Nyw3ICsxNzE1OSw3IEBAIHN0YXRpYyB2b2lkIGludGVsX3Nhbml0aXpl
X2NydGMoc3RydWN0IGludGVsX2NydGMgKmNydGMsCiAJCQljb25zdCBzdHJ1Y3QgaW50ZWxfcGxh
bmVfc3RhdGUgKnBsYW5lX3N0YXRlID0KIAkJCQl0b19pbnRlbF9wbGFuZV9zdGF0ZShwbGFuZS0+
YmFzZS5zdGF0ZSk7CiAKLQkJCWlmIChwbGFuZV9zdGF0ZS0+YmFzZS52aXNpYmxlICYmCisJCQlp
ZiAocGxhbmVfc3RhdGUtPnVhcGkudmlzaWJsZSAmJgogCQkJICAgIHBsYW5lLT5iYXNlLnR5cGUg
IT0gRFJNX1BMQU5FX1RZUEVfUFJJTUFSWSkKIAkJCQlpbnRlbF9wbGFuZV9kaXNhYmxlX25vYXRv
bWljKGNydGMsIHBsYW5lKTsKIAkJfQpAQCAtMTc0ODgsMTQgKzE3NDkwLDE0IEBAIHN0YXRpYyB2
b2lkIGludGVsX21vZGVzZXRfcmVhZG91dF9od19zdGF0ZShzdHJ1Y3QgZHJtX2RldmljZSAqZGV2
KQogCQkJICogRklYTUUgZG9uJ3QgaGF2ZSB0aGUgZmIgeWV0LCBzbyBjYW4ndAogCQkJICogdXNl
IGludGVsX3BsYW5lX2RhdGFfcmF0ZSgpIDooCiAJCQkgKi8KLQkJCWlmIChwbGFuZV9zdGF0ZS0+
YmFzZS52aXNpYmxlKQorCQkJaWYgKHBsYW5lX3N0YXRlLT51YXBpLnZpc2libGUpCiAJCQkJY3J0
Y19zdGF0ZS0+ZGF0YV9yYXRlW3BsYW5lLT5pZF0gPQogCQkJCQk0ICogY3J0Y19zdGF0ZS0+cGl4
ZWxfcmF0ZTsKIAkJCS8qCiAJCQkgKiBGSVhNRSBkb24ndCBoYXZlIHRoZSBmYiB5ZXQsIHNvIGNh
bid0CiAJCQkgKiB1c2UgcGxhbmUtPm1pbl9jZGNsaygpIDooCiAJCQkgKi8KLQkJCWlmIChwbGFu
ZV9zdGF0ZS0+YmFzZS52aXNpYmxlICYmIHBsYW5lLT5taW5fY2RjbGspIHsKKwkJCWlmIChwbGFu
ZV9zdGF0ZS0+dWFwaS52aXNpYmxlICYmIHBsYW5lLT5taW5fY2RjbGspIHsKIAkJCQlpZiAoY3J0
Y19zdGF0ZS0+ZG91YmxlX3dpZGUgfHwKIAkJCQkgICAgSU5URUxfR0VOKGRldl9wcml2KSA+PSAx
MCB8fCBJU19HRU1JTklMQUtFKGRldl9wcml2KSkKIAkJCQkJY3J0Y19zdGF0ZS0+bWluX2NkY2xr
W3BsYW5lLT5pZF0gPQpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9p
bnRlbF9mYmMuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZmJjLmMKaW5k
ZXggM2VhOGQwMTBkYjZjLi45MmM3ZWIyNDM1NTkgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2Ry
bS9pOTE1L2Rpc3BsYXkvaW50ZWxfZmJjLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlz
cGxheS9pbnRlbF9mYmMuYwpAQCAtNDMwLDcgKzQzMCw3IEBAIHN0YXRpYyBib29sIG11bHRpcGxl
X3BpcGVzX29rKHN0cnVjdCBpbnRlbF9jcnRjICpjcnRjLAogCWlmICghbm9fZmJjX29uX211bHRp
cGxlX3BpcGVzKGRldl9wcml2KSkKIAkJcmV0dXJuIHRydWU7CiAKLQlpZiAocGxhbmVfc3RhdGUt
PmJhc2UudmlzaWJsZSkKKwlpZiAocGxhbmVfc3RhdGUtPnVhcGkudmlzaWJsZSkKIAkJZmJjLT52
aXNpYmxlX3BpcGVzX21hc2sgfD0gKDEgPDwgcGlwZSk7CiAJZWxzZQogCQlmYmMtPnZpc2libGVf
cGlwZXNfbWFzayAmPSB+KDEgPDwgcGlwZSk7CkBAIC02NzcsMTIgKzY3NywxMiBAQCBzdGF0aWMg
dm9pZCBpbnRlbF9mYmNfdXBkYXRlX3N0YXRlX2NhY2hlKHN0cnVjdCBpbnRlbF9jcnRjICpjcnRj
LAogCSAqIHRoZSA5MC8yNzAgZGVncmVlIHBsYW5lIHJvdGF0aW9uIGNhc2VzICh0byBtYXRjaCB0
aGUKIAkgKiBHVFQgbWFwcGluZyksIGhlbmNlIG5vIG5lZWQgdG8gYWNjb3VudCBmb3Igcm90YXRp
b24gaGVyZS4KIAkgKi8KLQljYWNoZS0+cGxhbmUuc3JjX3cgPSBkcm1fcmVjdF93aWR0aCgmcGxh
bmVfc3RhdGUtPmJhc2Uuc3JjKSA+PiAxNjsKLQljYWNoZS0+cGxhbmUuc3JjX2ggPSBkcm1fcmVj
dF9oZWlnaHQoJnBsYW5lX3N0YXRlLT5iYXNlLnNyYykgPj4gMTY7Ci0JY2FjaGUtPnBsYW5lLnZp
c2libGUgPSBwbGFuZV9zdGF0ZS0+YmFzZS52aXNpYmxlOworCWNhY2hlLT5wbGFuZS5zcmNfdyA9
IGRybV9yZWN0X3dpZHRoKCZwbGFuZV9zdGF0ZS0+dWFwaS5zcmMpID4+IDE2OworCWNhY2hlLT5w
bGFuZS5zcmNfaCA9IGRybV9yZWN0X2hlaWdodCgmcGxhbmVfc3RhdGUtPnVhcGkuc3JjKSA+PiAx
NjsKKwljYWNoZS0+cGxhbmUudmlzaWJsZSA9IHBsYW5lX3N0YXRlLT51YXBpLnZpc2libGU7CiAJ
Y2FjaGUtPnBsYW5lLmFkanVzdGVkX3ggPSBwbGFuZV9zdGF0ZS0+Y29sb3JfcGxhbmVbMF0ueDsK
IAljYWNoZS0+cGxhbmUuYWRqdXN0ZWRfeSA9IHBsYW5lX3N0YXRlLT5jb2xvcl9wbGFuZVswXS55
OwotCWNhY2hlLT5wbGFuZS55ID0gcGxhbmVfc3RhdGUtPmJhc2Uuc3JjLnkxID4+IDE2OworCWNh
Y2hlLT5wbGFuZS55ID0gcGxhbmVfc3RhdGUtPnVhcGkuc3JjLnkxID4+IDE2OwogCiAJY2FjaGUt
PnBsYW5lLnBpeGVsX2JsZW5kX21vZGUgPSBwbGFuZV9zdGF0ZS0+aHcucGl4ZWxfYmxlbmRfbW9k
ZTsKIApAQCAtMTA1Miw3ICsxMDUyLDcgQEAgdm9pZCBpbnRlbF9mYmNfY2hvb3NlX2NydGMoc3Ry
dWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAogCQlpZiAoIXBsYW5lLT5oYXNfZmJjKQog
CQkJY29udGludWU7CiAKLQkJaWYgKCFwbGFuZV9zdGF0ZS0+YmFzZS52aXNpYmxlKQorCQlpZiAo
IXBsYW5lX3N0YXRlLT51YXBpLnZpc2libGUpCiAJCQljb250aW51ZTsKIAogCQljcnRjX3N0YXRl
ID0gaW50ZWxfYXRvbWljX2dldF9uZXdfY3J0Y19zdGF0ZShzdGF0ZSwgY3J0Yyk7CmRpZmYgLS1n
aXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX292ZXJsYXkuYyBiL2RyaXZl
cnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfb3ZlcmxheS5jCmluZGV4IDQ2ZTNkNmNmNTk3
Ni4uOGNmYjc4NWU3NjFjIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5
L2ludGVsX292ZXJsYXkuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVs
X292ZXJsYXkuYwpAQCAtNjY4LDcgKzY2OCw3IEBAIHN0YXRpYyB2b2lkIHVwZGF0ZV9jb2xvcmtl
eShzdHJ1Y3QgaW50ZWxfb3ZlcmxheSAqb3ZlcmxheSwKIAlpZiAob3ZlcmxheS0+Y29sb3Jfa2V5
X2VuYWJsZWQpCiAJCWZsYWdzIHw9IERTVF9LRVlfRU5BQkxFOwogCi0JaWYgKHN0YXRlLT5iYXNl
LnZpc2libGUpCisJaWYgKHN0YXRlLT51YXBpLnZpc2libGUpCiAJCWZvcm1hdCA9IHN0YXRlLT5o
dy5mYi0+Zm9ybWF0LT5mb3JtYXQ7CiAKIAlzd2l0Y2ggKGZvcm1hdCkgewpkaWZmIC0tZ2l0IGEv
ZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9zcHJpdGUuYyBiL2RyaXZlcnMvZ3B1
L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfc3ByaXRlLmMKaW5kZXggYjIxMTZkMTIzNTQ4Li5lZjc0
MDlmNjk1ZjkgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxf
c3ByaXRlLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9zcHJpdGUu
YwpAQCAtMjQwLDcgKzI0MCw3IEBAIHZvaWQgaW50ZWxfcGlwZV91cGRhdGVfZW5kKHN0cnVjdCBp
bnRlbF9jcnRjX3N0YXRlICpuZXdfY3J0Y19zdGF0ZSkKIAogaW50IGludGVsX3BsYW5lX2NoZWNr
X3N0cmlkZShjb25zdCBzdHJ1Y3QgaW50ZWxfcGxhbmVfc3RhdGUgKnBsYW5lX3N0YXRlKQogewot
CXN0cnVjdCBpbnRlbF9wbGFuZSAqcGxhbmUgPSB0b19pbnRlbF9wbGFuZShwbGFuZV9zdGF0ZS0+
YmFzZS5wbGFuZSk7CisJc3RydWN0IGludGVsX3BsYW5lICpwbGFuZSA9IHRvX2ludGVsX3BsYW5l
KHBsYW5lX3N0YXRlLT51YXBpLnBsYW5lKTsKIAljb25zdCBzdHJ1Y3QgZHJtX2ZyYW1lYnVmZmVy
ICpmYiA9IHBsYW5lX3N0YXRlLT5ody5mYjsKIAl1bnNpZ25lZCBpbnQgcm90YXRpb24gPSBwbGFu
ZV9zdGF0ZS0+aHcucm90YXRpb247CiAJdTMyIHN0cmlkZSwgbWF4X3N0cmlkZTsKQEAgLTI1Miw3
ICsyNTIsNyBAQCBpbnQgaW50ZWxfcGxhbmVfY2hlY2tfc3RyaWRlKGNvbnN0IHN0cnVjdCBpbnRl
bF9wbGFuZV9zdGF0ZSAqcGxhbmVfc3RhdGUpCiAJICoga2ljayBpbiBkdWUgdGhlIHBsYW5lIGJl
aW5nIGludmlzaWJsZS4KIAkgKi8KIAlpZiAoaW50ZWxfcGxhbmVfY2FuX3JlbWFwKHBsYW5lX3N0
YXRlKSAmJgotCSAgICAhcGxhbmVfc3RhdGUtPmJhc2UudmlzaWJsZSkKKwkgICAgIXBsYW5lX3N0
YXRlLT51YXBpLnZpc2libGUpCiAJCXJldHVybiAwOwogCiAJLyogRklYTUUgb3RoZXIgY29sb3Ig
cGxhbmVzPyAqLwpAQCAtMjczLDcgKzI3Myw3IEBAIGludCBpbnRlbF9wbGFuZV9jaGVja19zdHJp
ZGUoY29uc3Qgc3RydWN0IGludGVsX3BsYW5lX3N0YXRlICpwbGFuZV9zdGF0ZSkKIGludCBpbnRl
bF9wbGFuZV9jaGVja19zcmNfY29vcmRpbmF0ZXMoc3RydWN0IGludGVsX3BsYW5lX3N0YXRlICpw
bGFuZV9zdGF0ZSkKIHsKIAljb25zdCBzdHJ1Y3QgZHJtX2ZyYW1lYnVmZmVyICpmYiA9IHBsYW5l
X3N0YXRlLT5ody5mYjsKLQlzdHJ1Y3QgZHJtX3JlY3QgKnNyYyA9ICZwbGFuZV9zdGF0ZS0+YmFz
ZS5zcmM7CisJc3RydWN0IGRybV9yZWN0ICpzcmMgPSAmcGxhbmVfc3RhdGUtPnVhcGkuc3JjOwog
CXUzMiBzcmNfeCwgc3JjX3ksIHNyY193LCBzcmNfaCwgaHN1YiwgdnN1YjsKIAlib29sIHJvdGF0
ZWQgPSBkcm1fcm90YXRpb25fOTBfb3JfMjcwKHBsYW5lX3N0YXRlLT5ody5yb3RhdGlvbik7CiAK
QEAgLTMyOCw3ICszMjgsNyBAQCBza2xfcGxhbmVfcmF0aW8oY29uc3Qgc3RydWN0IGludGVsX2Ny
dGNfc3RhdGUgKmNydGNfc3RhdGUsCiAJCWNvbnN0IHN0cnVjdCBpbnRlbF9wbGFuZV9zdGF0ZSAq
cGxhbmVfc3RhdGUsCiAJCXVuc2lnbmVkIGludCAqbnVtLCB1bnNpZ25lZCBpbnQgKmRlbikKIHsK
LQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KHBsYW5lX3N0YXRl
LT5iYXNlLnBsYW5lLT5kZXYpOworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9
IHRvX2k5MTUocGxhbmVfc3RhdGUtPnVhcGkucGxhbmUtPmRldik7CiAJY29uc3Qgc3RydWN0IGRy
bV9mcmFtZWJ1ZmZlciAqZmIgPSBwbGFuZV9zdGF0ZS0+aHcuZmI7CiAKIAlpZiAoZmItPmZvcm1h
dC0+Y3BwWzBdID09IDgpIHsKQEAgLTM0OCw3ICszNDgsNyBAQCBza2xfcGxhbmVfcmF0aW8oY29u
c3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUsCiBzdGF0aWMgaW50IHNrbF9w
bGFuZV9taW5fY2RjbGsoY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUs
CiAJCQkgICAgICAgY29uc3Qgc3RydWN0IGludGVsX3BsYW5lX3N0YXRlICpwbGFuZV9zdGF0ZSkK
IHsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KHBsYW5lX3N0
YXRlLT5iYXNlLnBsYW5lLT5kZXYpOworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJp
diA9IHRvX2k5MTUocGxhbmVfc3RhdGUtPnVhcGkucGxhbmUtPmRldik7CiAJdW5zaWduZWQgaW50
IHBpeGVsX3JhdGUgPSBjcnRjX3N0YXRlLT5waXhlbF9yYXRlOwogCXVuc2lnbmVkIGludCBzcmNf
dywgc3JjX2gsIGRzdF93LCBkc3RfaDsKIAl1bnNpZ25lZCBpbnQgbnVtLCBkZW47CkBAIC0zNTks
MTAgKzM1OSwxMCBAQCBzdGF0aWMgaW50IHNrbF9wbGFuZV9taW5fY2RjbGsoY29uc3Qgc3RydWN0
IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUsCiAJaWYgKElOVEVMX0dFTihkZXZfcHJpdikg
Pj0gMTAgfHwgSVNfR0VNSU5JTEFLRShkZXZfcHJpdikpCiAJCWRlbiAqPSAyOwogCi0Jc3JjX3cg
PSBkcm1fcmVjdF93aWR0aCgmcGxhbmVfc3RhdGUtPmJhc2Uuc3JjKSA+PiAxNjsKLQlzcmNfaCA9
IGRybV9yZWN0X2hlaWdodCgmcGxhbmVfc3RhdGUtPmJhc2Uuc3JjKSA+PiAxNjsKLQlkc3RfdyA9
IGRybV9yZWN0X3dpZHRoKCZwbGFuZV9zdGF0ZS0+YmFzZS5kc3QpOwotCWRzdF9oID0gZHJtX3Jl
Y3RfaGVpZ2h0KCZwbGFuZV9zdGF0ZS0+YmFzZS5kc3QpOworCXNyY193ID0gZHJtX3JlY3Rfd2lk
dGgoJnBsYW5lX3N0YXRlLT51YXBpLnNyYykgPj4gMTY7CisJc3JjX2ggPSBkcm1fcmVjdF9oZWln
aHQoJnBsYW5lX3N0YXRlLT51YXBpLnNyYykgPj4gMTY7CisJZHN0X3cgPSBkcm1fcmVjdF93aWR0
aCgmcGxhbmVfc3RhdGUtPnVhcGkuZHN0KTsKKwlkc3RfaCA9IGRybV9yZWN0X2hlaWdodCgmcGxh
bmVfc3RhdGUtPnVhcGkuZHN0KTsKIAogCS8qIERvd25zY2FsaW5nIGxpbWl0cyB0aGUgbWF4aW11
bSBwaXhlbCByYXRlICovCiAJZHN0X3cgPSBtaW4oc3JjX3csIGRzdF93KTsKQEAgLTQwMSwxOSAr
NDAxLDE5IEBAIHNrbF9wcm9ncmFtX3NjYWxlcihzdHJ1Y3QgaW50ZWxfcGxhbmUgKnBsYW5lLAog
CWludCBzY2FsZXJfaWQgPSBwbGFuZV9zdGF0ZS0+c2NhbGVyX2lkOwogCWNvbnN0IHN0cnVjdCBp
bnRlbF9zY2FsZXIgKnNjYWxlciA9CiAJCSZjcnRjX3N0YXRlLT5zY2FsZXJfc3RhdGUuc2NhbGVy
c1tzY2FsZXJfaWRdOwotCWludCBjcnRjX3ggPSBwbGFuZV9zdGF0ZS0+YmFzZS5kc3QueDE7Ci0J
aW50IGNydGNfeSA9IHBsYW5lX3N0YXRlLT5iYXNlLmRzdC55MTsKLQl1MzIgY3J0Y193ID0gZHJt
X3JlY3Rfd2lkdGgoJnBsYW5lX3N0YXRlLT5iYXNlLmRzdCk7Ci0JdTMyIGNydGNfaCA9IGRybV9y
ZWN0X2hlaWdodCgmcGxhbmVfc3RhdGUtPmJhc2UuZHN0KTsKKwlpbnQgY3J0Y194ID0gcGxhbmVf
c3RhdGUtPnVhcGkuZHN0LngxOworCWludCBjcnRjX3kgPSBwbGFuZV9zdGF0ZS0+dWFwaS5kc3Qu
eTE7CisJdTMyIGNydGNfdyA9IGRybV9yZWN0X3dpZHRoKCZwbGFuZV9zdGF0ZS0+dWFwaS5kc3Qp
OworCXUzMiBjcnRjX2ggPSBkcm1fcmVjdF9oZWlnaHQoJnBsYW5lX3N0YXRlLT51YXBpLmRzdCk7
CiAJdTE2IHlfaHBoYXNlLCB1dl9yZ2JfaHBoYXNlOwogCXUxNiB5X3ZwaGFzZSwgdXZfcmdiX3Zw
aGFzZTsKIAlpbnQgaHNjYWxlLCB2c2NhbGU7CiAKLQloc2NhbGUgPSBkcm1fcmVjdF9jYWxjX2hz
Y2FsZSgmcGxhbmVfc3RhdGUtPmJhc2Uuc3JjLAotCQkJCSAgICAgICZwbGFuZV9zdGF0ZS0+YmFz
ZS5kc3QsCisJaHNjYWxlID0gZHJtX3JlY3RfY2FsY19oc2NhbGUoJnBsYW5lX3N0YXRlLT51YXBp
LnNyYywKKwkJCQkgICAgICAmcGxhbmVfc3RhdGUtPnVhcGkuZHN0LAogCQkJCSAgICAgIDAsIElO
VF9NQVgpOwotCXZzY2FsZSA9IGRybV9yZWN0X2NhbGNfdnNjYWxlKCZwbGFuZV9zdGF0ZS0+YmFz
ZS5zcmMsCi0JCQkJICAgICAgJnBsYW5lX3N0YXRlLT5iYXNlLmRzdCwKKwl2c2NhbGUgPSBkcm1f
cmVjdF9jYWxjX3ZzY2FsZSgmcGxhbmVfc3RhdGUtPnVhcGkuc3JjLAorCQkJCSAgICAgICZwbGFu
ZV9zdGF0ZS0+dWFwaS5kc3QsCiAJCQkJICAgICAgMCwgSU5UX01BWCk7CiAKIAkvKiBUT0RPOiBo
YW5kbGUgc3ViLXBpeGVsIGNvb3JkaW5hdGVzICovCkBAIC01ODQsMTIgKzU4NCwxMiBAQCBza2xf
cHJvZ3JhbV9wbGFuZShzdHJ1Y3QgaW50ZWxfcGxhbmUgKnBsYW5lLAogCXUzMiBzdXJmX2FkZHIg
PSBwbGFuZV9zdGF0ZS0+Y29sb3JfcGxhbmVbY29sb3JfcGxhbmVdLm9mZnNldDsKIAl1MzIgc3Ry
aWRlID0gc2tsX3BsYW5lX3N0cmlkZShwbGFuZV9zdGF0ZSwgY29sb3JfcGxhbmUpOwogCXUzMiBh
dXhfc3RyaWRlID0gc2tsX3BsYW5lX3N0cmlkZShwbGFuZV9zdGF0ZSwgMSk7Ci0JaW50IGNydGNf
eCA9IHBsYW5lX3N0YXRlLT5iYXNlLmRzdC54MTsKLQlpbnQgY3J0Y195ID0gcGxhbmVfc3RhdGUt
PmJhc2UuZHN0LnkxOworCWludCBjcnRjX3ggPSBwbGFuZV9zdGF0ZS0+dWFwaS5kc3QueDE7CisJ
aW50IGNydGNfeSA9IHBsYW5lX3N0YXRlLT51YXBpLmRzdC55MTsKIAl1MzIgeCA9IHBsYW5lX3N0
YXRlLT5jb2xvcl9wbGFuZVtjb2xvcl9wbGFuZV0ueDsKIAl1MzIgeSA9IHBsYW5lX3N0YXRlLT5j
b2xvcl9wbGFuZVtjb2xvcl9wbGFuZV0ueTsKLQl1MzIgc3JjX3cgPSBkcm1fcmVjdF93aWR0aCgm
cGxhbmVfc3RhdGUtPmJhc2Uuc3JjKSA+PiAxNjsKLQl1MzIgc3JjX2ggPSBkcm1fcmVjdF9oZWln
aHQoJnBsYW5lX3N0YXRlLT5iYXNlLnNyYykgPj4gMTY7CisJdTMyIHNyY193ID0gZHJtX3JlY3Rf
d2lkdGgoJnBsYW5lX3N0YXRlLT51YXBpLnNyYykgPj4gMTY7CisJdTMyIHNyY19oID0gZHJtX3Jl
Y3RfaGVpZ2h0KCZwbGFuZV9zdGF0ZS0+dWFwaS5zcmMpID4+IDE2OwogCXN0cnVjdCBpbnRlbF9w
bGFuZSAqbGlua2VkID0gcGxhbmVfc3RhdGUtPnBsYW5hcl9saW5rZWRfcGxhbmU7CiAJY29uc3Qg
c3RydWN0IGRybV9mcmFtZWJ1ZmZlciAqZmIgPSBwbGFuZV9zdGF0ZS0+aHcuZmI7CiAJdTggYWxw
aGEgPSBwbGFuZV9zdGF0ZS0+aHcuYWxwaGEgPj4gODsKQEAgLTc2Niw3ICs3NjYsNyBAQCBzdGF0
aWMgdm9pZCBpOXh4X3BsYW5lX2xpbmVhcl9nYW1tYSh1MTYgZ2FtbWFbOF0pCiBzdGF0aWMgdm9p
ZAogY2h2X3VwZGF0ZV9jc2MoY29uc3Qgc3RydWN0IGludGVsX3BsYW5lX3N0YXRlICpwbGFuZV9z
dGF0ZSkKIHsKLQlzdHJ1Y3QgaW50ZWxfcGxhbmUgKnBsYW5lID0gdG9faW50ZWxfcGxhbmUocGxh
bmVfc3RhdGUtPmJhc2UucGxhbmUpOworCXN0cnVjdCBpbnRlbF9wbGFuZSAqcGxhbmUgPSB0b19p
bnRlbF9wbGFuZShwbGFuZV9zdGF0ZS0+dWFwaS5wbGFuZSk7CiAJc3RydWN0IGRybV9pOTE1X3By
aXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShwbGFuZS0+YmFzZS5kZXYpOwogCWNvbnN0IHN0cnVj
dCBkcm1fZnJhbWVidWZmZXIgKmZiID0gcGxhbmVfc3RhdGUtPmh3LmZiOwogCWVudW0gcGxhbmVf
aWQgcGxhbmVfaWQgPSBwbGFuZS0+aWQ7CkBAIC04MjUsNyArODI1LDcgQEAgY2h2X3VwZGF0ZV9j
c2MoY29uc3Qgc3RydWN0IGludGVsX3BsYW5lX3N0YXRlICpwbGFuZV9zdGF0ZSkKIHN0YXRpYyB2
b2lkCiB2bHZfdXBkYXRlX2NscmMoY29uc3Qgc3RydWN0IGludGVsX3BsYW5lX3N0YXRlICpwbGFu
ZV9zdGF0ZSkKIHsKLQlzdHJ1Y3QgaW50ZWxfcGxhbmUgKnBsYW5lID0gdG9faW50ZWxfcGxhbmUo
cGxhbmVfc3RhdGUtPmJhc2UucGxhbmUpOworCXN0cnVjdCBpbnRlbF9wbGFuZSAqcGxhbmUgPSB0
b19pbnRlbF9wbGFuZShwbGFuZV9zdGF0ZS0+dWFwaS5wbGFuZSk7CiAJc3RydWN0IGRybV9pOTE1
X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShwbGFuZS0+YmFzZS5kZXYpOwogCWNvbnN0IHN0
cnVjdCBkcm1fZnJhbWVidWZmZXIgKmZiID0gcGxhbmVfc3RhdGUtPmh3LmZiOwogCWVudW0gcGlw
ZSBwaXBlID0gcGxhbmUtPnBpcGU7CkBAIC0xMDE5LDcgKzEwMTksNyBAQCBzdGF0aWMgdTMyIHZs
dl9zcHJpdGVfY3RsKGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlLAog
CiBzdGF0aWMgdm9pZCB2bHZfdXBkYXRlX2dhbW1hKGNvbnN0IHN0cnVjdCBpbnRlbF9wbGFuZV9z
dGF0ZSAqcGxhbmVfc3RhdGUpCiB7Ci0Jc3RydWN0IGludGVsX3BsYW5lICpwbGFuZSA9IHRvX2lu
dGVsX3BsYW5lKHBsYW5lX3N0YXRlLT5iYXNlLnBsYW5lKTsKKwlzdHJ1Y3QgaW50ZWxfcGxhbmUg
KnBsYW5lID0gdG9faW50ZWxfcGxhbmUocGxhbmVfc3RhdGUtPnVhcGkucGxhbmUpOwogCXN0cnVj
dCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUocGxhbmUtPmJhc2UuZGV2KTsK
IAljb25zdCBzdHJ1Y3QgZHJtX2ZyYW1lYnVmZmVyICpmYiA9IHBsYW5lX3N0YXRlLT5ody5mYjsK
IAllbnVtIHBpcGUgcGlwZSA9IHBsYW5lLT5waXBlOwpAQCAtMTA1MywxMCArMTA1MywxMCBAQCB2
bHZfdXBkYXRlX3BsYW5lKHN0cnVjdCBpbnRlbF9wbGFuZSAqcGxhbmUsCiAJdTMyIHNwcnN1cmZf
b2Zmc2V0ID0gcGxhbmVfc3RhdGUtPmNvbG9yX3BsYW5lWzBdLm9mZnNldDsKIAl1MzIgbGluZWFy
X29mZnNldDsKIAljb25zdCBzdHJ1Y3QgZHJtX2ludGVsX3Nwcml0ZV9jb2xvcmtleSAqa2V5ID0g
JnBsYW5lX3N0YXRlLT5ja2V5OwotCWludCBjcnRjX3ggPSBwbGFuZV9zdGF0ZS0+YmFzZS5kc3Qu
eDE7Ci0JaW50IGNydGNfeSA9IHBsYW5lX3N0YXRlLT5iYXNlLmRzdC55MTsKLQl1MzIgY3J0Y193
ID0gZHJtX3JlY3Rfd2lkdGgoJnBsYW5lX3N0YXRlLT5iYXNlLmRzdCk7Ci0JdTMyIGNydGNfaCA9
IGRybV9yZWN0X2hlaWdodCgmcGxhbmVfc3RhdGUtPmJhc2UuZHN0KTsKKwlpbnQgY3J0Y194ID0g
cGxhbmVfc3RhdGUtPnVhcGkuZHN0LngxOworCWludCBjcnRjX3kgPSBwbGFuZV9zdGF0ZS0+dWFw
aS5kc3QueTE7CisJdTMyIGNydGNfdyA9IGRybV9yZWN0X3dpZHRoKCZwbGFuZV9zdGF0ZS0+dWFw
aS5kc3QpOworCXUzMiBjcnRjX2ggPSBkcm1fcmVjdF9oZWlnaHQoJnBsYW5lX3N0YXRlLT51YXBp
LmRzdCk7CiAJdTMyIHggPSBwbGFuZV9zdGF0ZS0+Y29sb3JfcGxhbmVbMF0ueDsKIAl1MzIgeSA9
IHBsYW5lX3N0YXRlLT5jb2xvcl9wbGFuZVswXS55OwogCXVuc2lnbmVkIGxvbmcgaXJxZmxhZ3M7
CkBAIC0xMjQ1LDggKzEyNDUsOCBAQCBzdGF0aWMgaW50IGl2Yl9zcHJpdGVfbWluX2NkY2xrKGNv
bnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlLAogCSAqLwogCXBpeGVsX3Jh
dGUgPSBjcnRjX3N0YXRlLT5waXhlbF9yYXRlOwogCi0Jc3JjX3cgPSBkcm1fcmVjdF93aWR0aCgm
cGxhbmVfc3RhdGUtPmJhc2Uuc3JjKSA+PiAxNjsKLQlkc3RfdyA9IGRybV9yZWN0X3dpZHRoKCZw
bGFuZV9zdGF0ZS0+YmFzZS5kc3QpOworCXNyY193ID0gZHJtX3JlY3Rfd2lkdGgoJnBsYW5lX3N0
YXRlLT51YXBpLnNyYykgPj4gMTY7CisJZHN0X3cgPSBkcm1fcmVjdF93aWR0aCgmcGxhbmVfc3Rh
dGUtPnVhcGkuZHN0KTsKIAogCWlmIChzcmNfdyAhPSBkc3RfdykKIAkJaXZiX3BsYW5lX3JhdGlv
X3NjYWxpbmcoY3J0Y19zdGF0ZSwgcGxhbmVfc3RhdGUsICZudW0sICZkZW4pOwpAQCAtMTMyMCw3
ICsxMzIwLDcgQEAgc3RhdGljIHUzMiBpdmJfc3ByaXRlX2N0bF9jcnRjKGNvbnN0IHN0cnVjdCBp
bnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlKQogc3RhdGljIGJvb2wgaXZiX25lZWRfc3ByaXRl
X2dhbW1hKGNvbnN0IHN0cnVjdCBpbnRlbF9wbGFuZV9zdGF0ZSAqcGxhbmVfc3RhdGUpCiB7CiAJ
c3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0KLQkJdG9faTkxNShwbGFuZV9zdGF0
ZS0+YmFzZS5wbGFuZS0+ZGV2KTsKKwkJdG9faTkxNShwbGFuZV9zdGF0ZS0+dWFwaS5wbGFuZS0+
ZGV2KTsKIAljb25zdCBzdHJ1Y3QgZHJtX2ZyYW1lYnVmZmVyICpmYiA9IHBsYW5lX3N0YXRlLT5o
dy5mYjsKIAogCXJldHVybiBmYi0+Zm9ybWF0LT5jcHBbMF0gPT0gOCAmJgpAQCAtMTMzMSw3ICsx
MzMxLDcgQEAgc3RhdGljIHUzMiBpdmJfc3ByaXRlX2N0bChjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0
Y19zdGF0ZSAqY3J0Y19zdGF0ZSwKIAkJCSAgY29uc3Qgc3RydWN0IGludGVsX3BsYW5lX3N0YXRl
ICpwbGFuZV9zdGF0ZSkKIHsKIAlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPQot
CQl0b19pOTE1KHBsYW5lX3N0YXRlLT5iYXNlLnBsYW5lLT5kZXYpOworCQl0b19pOTE1KHBsYW5l
X3N0YXRlLT51YXBpLnBsYW5lLT5kZXYpOwogCWNvbnN0IHN0cnVjdCBkcm1fZnJhbWVidWZmZXIg
KmZiID0gcGxhbmVfc3RhdGUtPmh3LmZiOwogCXVuc2lnbmVkIGludCByb3RhdGlvbiA9IHBsYW5l
X3N0YXRlLT5ody5yb3RhdGlvbjsKIAljb25zdCBzdHJ1Y3QgZHJtX2ludGVsX3Nwcml0ZV9jb2xv
cmtleSAqa2V5ID0gJnBsYW5lX3N0YXRlLT5ja2V5OwpAQCAtMTQyMiw3ICsxNDIyLDcgQEAgc3Rh
dGljIHZvaWQgaXZiX3Nwcml0ZV9saW5lYXJfZ2FtbWEoY29uc3Qgc3RydWN0IGludGVsX3BsYW5l
X3N0YXRlICpwbGFuZV9zdGF0ZSwKIAogc3RhdGljIHZvaWQgaXZiX3VwZGF0ZV9nYW1tYShjb25z
dCBzdHJ1Y3QgaW50ZWxfcGxhbmVfc3RhdGUgKnBsYW5lX3N0YXRlKQogewotCXN0cnVjdCBpbnRl
bF9wbGFuZSAqcGxhbmUgPSB0b19pbnRlbF9wbGFuZShwbGFuZV9zdGF0ZS0+YmFzZS5wbGFuZSk7
CisJc3RydWN0IGludGVsX3BsYW5lICpwbGFuZSA9IHRvX2ludGVsX3BsYW5lKHBsYW5lX3N0YXRl
LT51YXBpLnBsYW5lKTsKIAlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19p
OTE1KHBsYW5lLT5iYXNlLmRldik7CiAJZW51bSBwaXBlIHBpcGUgPSBwbGFuZS0+cGlwZTsKIAl1
MTYgZ2FtbWFbMThdOwpAQCAtMTQ2MSwxNCArMTQ2MSwxNCBAQCBpdmJfdXBkYXRlX3BsYW5lKHN0
cnVjdCBpbnRlbF9wbGFuZSAqcGxhbmUsCiAJdTMyIHNwcnN1cmZfb2Zmc2V0ID0gcGxhbmVfc3Rh
dGUtPmNvbG9yX3BsYW5lWzBdLm9mZnNldDsKIAl1MzIgbGluZWFyX29mZnNldDsKIAljb25zdCBz
dHJ1Y3QgZHJtX2ludGVsX3Nwcml0ZV9jb2xvcmtleSAqa2V5ID0gJnBsYW5lX3N0YXRlLT5ja2V5
OwotCWludCBjcnRjX3ggPSBwbGFuZV9zdGF0ZS0+YmFzZS5kc3QueDE7Ci0JaW50IGNydGNfeSA9
IHBsYW5lX3N0YXRlLT5iYXNlLmRzdC55MTsKLQl1MzIgY3J0Y193ID0gZHJtX3JlY3Rfd2lkdGgo
JnBsYW5lX3N0YXRlLT5iYXNlLmRzdCk7Ci0JdTMyIGNydGNfaCA9IGRybV9yZWN0X2hlaWdodCgm
cGxhbmVfc3RhdGUtPmJhc2UuZHN0KTsKKwlpbnQgY3J0Y194ID0gcGxhbmVfc3RhdGUtPnVhcGku
ZHN0LngxOworCWludCBjcnRjX3kgPSBwbGFuZV9zdGF0ZS0+dWFwaS5kc3QueTE7CisJdTMyIGNy
dGNfdyA9IGRybV9yZWN0X3dpZHRoKCZwbGFuZV9zdGF0ZS0+dWFwaS5kc3QpOworCXUzMiBjcnRj
X2ggPSBkcm1fcmVjdF9oZWlnaHQoJnBsYW5lX3N0YXRlLT51YXBpLmRzdCk7CiAJdTMyIHggPSBw
bGFuZV9zdGF0ZS0+Y29sb3JfcGxhbmVbMF0ueDsKIAl1MzIgeSA9IHBsYW5lX3N0YXRlLT5jb2xv
cl9wbGFuZVswXS55OwotCXUzMiBzcmNfdyA9IGRybV9yZWN0X3dpZHRoKCZwbGFuZV9zdGF0ZS0+
YmFzZS5zcmMpID4+IDE2OwotCXUzMiBzcmNfaCA9IGRybV9yZWN0X2hlaWdodCgmcGxhbmVfc3Rh
dGUtPmJhc2Uuc3JjKSA+PiAxNjsKKwl1MzIgc3JjX3cgPSBkcm1fcmVjdF93aWR0aCgmcGxhbmVf
c3RhdGUtPnVhcGkuc3JjKSA+PiAxNjsKKwl1MzIgc3JjX2ggPSBkcm1fcmVjdF9oZWlnaHQoJnBs
YW5lX3N0YXRlLT51YXBpLnNyYykgPj4gMTY7CiAJdTMyIHNwcmN0bCwgc3Byc2NhbGUgPSAwOwog
CXVuc2lnbmVkIGxvbmcgaXJxZmxhZ3M7CiAKQEAgLTE1ODEsOCArMTU4MSw4IEBAIHN0YXRpYyBp
bnQgZzR4X3Nwcml0ZV9taW5fY2RjbGsoY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNy
dGNfc3RhdGUsCiAJcGl4ZWxfcmF0ZSA9IGNydGNfc3RhdGUtPnBpeGVsX3JhdGU7CiAKIAkvKiBI
b3Jpem9udGFsIGRvd25zY2FsaW5nIGxpbWl0cyB0aGUgbWF4aW11bSBwaXhlbCByYXRlICovCi0J
aHNjYWxlID0gZHJtX3JlY3RfY2FsY19oc2NhbGUoJnBsYW5lX3N0YXRlLT5iYXNlLnNyYywKLQkJ
CQkgICAgICAmcGxhbmVfc3RhdGUtPmJhc2UuZHN0LAorCWhzY2FsZSA9IGRybV9yZWN0X2NhbGNf
aHNjYWxlKCZwbGFuZV9zdGF0ZS0+dWFwaS5zcmMsCisJCQkJICAgICAgJnBsYW5lX3N0YXRlLT51
YXBpLmRzdCwKIAkJCQkgICAgICAwLCBJTlRfTUFYKTsKIAlpZiAoaHNjYWxlIDwgMHgxMDAwMCkK
IAkJcmV0dXJuIHBpeGVsX3JhdGU7CkBAIC0xNjM2LDcgKzE2MzYsNyBAQCBzdGF0aWMgdTMyIGc0
eF9zcHJpdGVfY3RsKGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlLAog
CQkJICBjb25zdCBzdHJ1Y3QgaW50ZWxfcGxhbmVfc3RhdGUgKnBsYW5lX3N0YXRlKQogewogCXN0
cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9Ci0JCXRvX2k5MTUocGxhbmVfc3RhdGUt
PmJhc2UucGxhbmUtPmRldik7CisJCXRvX2k5MTUocGxhbmVfc3RhdGUtPnVhcGkucGxhbmUtPmRl
dik7CiAJY29uc3Qgc3RydWN0IGRybV9mcmFtZWJ1ZmZlciAqZmIgPSBwbGFuZV9zdGF0ZS0+aHcu
ZmI7CiAJdW5zaWduZWQgaW50IHJvdGF0aW9uID0gcGxhbmVfc3RhdGUtPmh3LnJvdGF0aW9uOwog
CWNvbnN0IHN0cnVjdCBkcm1faW50ZWxfc3ByaXRlX2NvbG9ya2V5ICprZXkgPSAmcGxhbmVfc3Rh
dGUtPmNrZXk7CkBAIC0xNjk5LDcgKzE2OTksNyBAQCBzdGF0aWMgdTMyIGc0eF9zcHJpdGVfY3Rs
KGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlLAogCiBzdGF0aWMgdm9p
ZCBnNHhfdXBkYXRlX2dhbW1hKGNvbnN0IHN0cnVjdCBpbnRlbF9wbGFuZV9zdGF0ZSAqcGxhbmVf
c3RhdGUpCiB7Ci0Jc3RydWN0IGludGVsX3BsYW5lICpwbGFuZSA9IHRvX2ludGVsX3BsYW5lKHBs
YW5lX3N0YXRlLT5iYXNlLnBsYW5lKTsKKwlzdHJ1Y3QgaW50ZWxfcGxhbmUgKnBsYW5lID0gdG9f
aW50ZWxfcGxhbmUocGxhbmVfc3RhdGUtPnVhcGkucGxhbmUpOwogCXN0cnVjdCBkcm1faTkxNV9w
cml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUocGxhbmUtPmJhc2UuZGV2KTsKIAljb25zdCBzdHJ1
Y3QgZHJtX2ZyYW1lYnVmZmVyICpmYiA9IHBsYW5lX3N0YXRlLT5ody5mYjsKIAllbnVtIHBpcGUg
cGlwZSA9IHBsYW5lLT5waXBlOwpAQCAtMTczMSw3ICsxNzMxLDcgQEAgc3RhdGljIHZvaWQgaWxr
X3Nwcml0ZV9saW5lYXJfZ2FtbWEodTE2IGdhbW1hWzE3XSkKIAogc3RhdGljIHZvaWQgaWxrX3Vw
ZGF0ZV9nYW1tYShjb25zdCBzdHJ1Y3QgaW50ZWxfcGxhbmVfc3RhdGUgKnBsYW5lX3N0YXRlKQog
ewotCXN0cnVjdCBpbnRlbF9wbGFuZSAqcGxhbmUgPSB0b19pbnRlbF9wbGFuZShwbGFuZV9zdGF0
ZS0+YmFzZS5wbGFuZSk7CisJc3RydWN0IGludGVsX3BsYW5lICpwbGFuZSA9IHRvX2ludGVsX3Bs
YW5lKHBsYW5lX3N0YXRlLT51YXBpLnBsYW5lKTsKIAlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAq
ZGV2X3ByaXYgPSB0b19pOTE1KHBsYW5lLT5iYXNlLmRldik7CiAJY29uc3Qgc3RydWN0IGRybV9m
cmFtZWJ1ZmZlciAqZmIgPSBwbGFuZV9zdGF0ZS0+aHcuZmI7CiAJZW51bSBwaXBlIHBpcGUgPSBw
bGFuZS0+cGlwZTsKQEAgLTE3NjcsMTQgKzE3NjcsMTQgQEAgZzR4X3VwZGF0ZV9wbGFuZShzdHJ1
Y3QgaW50ZWxfcGxhbmUgKnBsYW5lLAogCXUzMiBkdnNzdXJmX29mZnNldCA9IHBsYW5lX3N0YXRl
LT5jb2xvcl9wbGFuZVswXS5vZmZzZXQ7CiAJdTMyIGxpbmVhcl9vZmZzZXQ7CiAJY29uc3Qgc3Ry
dWN0IGRybV9pbnRlbF9zcHJpdGVfY29sb3JrZXkgKmtleSA9ICZwbGFuZV9zdGF0ZS0+Y2tleTsK
LQlpbnQgY3J0Y194ID0gcGxhbmVfc3RhdGUtPmJhc2UuZHN0LngxOwotCWludCBjcnRjX3kgPSBw
bGFuZV9zdGF0ZS0+YmFzZS5kc3QueTE7Ci0JdTMyIGNydGNfdyA9IGRybV9yZWN0X3dpZHRoKCZw
bGFuZV9zdGF0ZS0+YmFzZS5kc3QpOwotCXUzMiBjcnRjX2ggPSBkcm1fcmVjdF9oZWlnaHQoJnBs
YW5lX3N0YXRlLT5iYXNlLmRzdCk7CisJaW50IGNydGNfeCA9IHBsYW5lX3N0YXRlLT51YXBpLmRz
dC54MTsKKwlpbnQgY3J0Y195ID0gcGxhbmVfc3RhdGUtPnVhcGkuZHN0LnkxOworCXUzMiBjcnRj
X3cgPSBkcm1fcmVjdF93aWR0aCgmcGxhbmVfc3RhdGUtPnVhcGkuZHN0KTsKKwl1MzIgY3J0Y19o
ID0gZHJtX3JlY3RfaGVpZ2h0KCZwbGFuZV9zdGF0ZS0+dWFwaS5kc3QpOwogCXUzMiB4ID0gcGxh
bmVfc3RhdGUtPmNvbG9yX3BsYW5lWzBdLng7CiAJdTMyIHkgPSBwbGFuZV9zdGF0ZS0+Y29sb3Jf
cGxhbmVbMF0ueTsKLQl1MzIgc3JjX3cgPSBkcm1fcmVjdF93aWR0aCgmcGxhbmVfc3RhdGUtPmJh
c2Uuc3JjKSA+PiAxNjsKLQl1MzIgc3JjX2ggPSBkcm1fcmVjdF9oZWlnaHQoJnBsYW5lX3N0YXRl
LT5iYXNlLnNyYykgPj4gMTY7CisJdTMyIHNyY193ID0gZHJtX3JlY3Rfd2lkdGgoJnBsYW5lX3N0
YXRlLT51YXBpLnNyYykgPj4gMTY7CisJdTMyIHNyY19oID0gZHJtX3JlY3RfaGVpZ2h0KCZwbGFu
ZV9zdGF0ZS0+dWFwaS5zcmMpID4+IDE2OwogCXUzMiBkdnNjbnRyLCBkdnNzY2FsZSA9IDA7CiAJ
dW5zaWduZWQgbG9uZyBpcnFmbGFnczsKIApAQCAtMTg4OCw4ICsxODg4LDggQEAgZzR4X3Nwcml0
ZV9jaGVja19zY2FsaW5nKHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlLAogCQkJ
IHN0cnVjdCBpbnRlbF9wbGFuZV9zdGF0ZSAqcGxhbmVfc3RhdGUpCiB7CiAJY29uc3Qgc3RydWN0
IGRybV9mcmFtZWJ1ZmZlciAqZmIgPSBwbGFuZV9zdGF0ZS0+aHcuZmI7Ci0JY29uc3Qgc3RydWN0
IGRybV9yZWN0ICpzcmMgPSAmcGxhbmVfc3RhdGUtPmJhc2Uuc3JjOwotCWNvbnN0IHN0cnVjdCBk
cm1fcmVjdCAqZHN0ID0gJnBsYW5lX3N0YXRlLT5iYXNlLmRzdDsKKwljb25zdCBzdHJ1Y3QgZHJt
X3JlY3QgKnNyYyA9ICZwbGFuZV9zdGF0ZS0+dWFwaS5zcmM7CisJY29uc3Qgc3RydWN0IGRybV9y
ZWN0ICpkc3QgPSAmcGxhbmVfc3RhdGUtPnVhcGkuZHN0OwogCWludCBzcmNfeCwgc3JjX3csIHNy
Y19oLCBjcnRjX3csIGNydGNfaDsKIAljb25zdCBzdHJ1Y3QgZHJtX2Rpc3BsYXlfbW9kZSAqYWRq
dXN0ZWRfbW9kZSA9CiAJCSZjcnRjX3N0YXRlLT5ody5hZGp1c3RlZF9tb2RlOwpAQCAtMTk0OCw3
ICsxOTQ4LDcgQEAgc3RhdGljIGludAogZzR4X3Nwcml0ZV9jaGVjayhzdHJ1Y3QgaW50ZWxfY3J0
Y19zdGF0ZSAqY3J0Y19zdGF0ZSwKIAkJIHN0cnVjdCBpbnRlbF9wbGFuZV9zdGF0ZSAqcGxhbmVf
c3RhdGUpCiB7Ci0Jc3RydWN0IGludGVsX3BsYW5lICpwbGFuZSA9IHRvX2ludGVsX3BsYW5lKHBs
YW5lX3N0YXRlLT5iYXNlLnBsYW5lKTsKKwlzdHJ1Y3QgaW50ZWxfcGxhbmUgKnBsYW5lID0gdG9f
aW50ZWxfcGxhbmUocGxhbmVfc3RhdGUtPnVhcGkucGxhbmUpOwogCXN0cnVjdCBkcm1faTkxNV9w
cml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUocGxhbmUtPmJhc2UuZGV2KTsKIAlpbnQgbWluX3Nj
YWxlID0gRFJNX1BMQU5FX0hFTFBFUl9OT19TQ0FMSU5HOwogCWludCBtYXhfc2NhbGUgPSBEUk1f
UExBTkVfSEVMUEVSX05PX1NDQUxJTkc7CkBAIC0xOTY0LDcgKzE5NjQsNyBAQCBnNHhfc3ByaXRl
X2NoZWNrKHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlLAogCQl9CiAJfQogCi0J
cmV0ID0gZHJtX2F0b21pY19oZWxwZXJfY2hlY2tfcGxhbmVfc3RhdGUoJnBsYW5lX3N0YXRlLT5i
YXNlLAorCXJldCA9IGRybV9hdG9taWNfaGVscGVyX2NoZWNrX3BsYW5lX3N0YXRlKCZwbGFuZV9z
dGF0ZS0+dWFwaSwKIAkJCQkJCSAgJmNydGNfc3RhdGUtPnVhcGksCiAJCQkJCQkgIG1pbl9zY2Fs
ZSwgbWF4X3NjYWxlLAogCQkJCQkJICB0cnVlLCB0cnVlKTsKQEAgLTE5NzUsNyArMTk3NSw3IEBA
IGc0eF9zcHJpdGVfY2hlY2soc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUsCiAJ
aWYgKHJldCkKIAkJcmV0dXJuIHJldDsKIAotCWlmICghcGxhbmVfc3RhdGUtPmJhc2UudmlzaWJs
ZSkKKwlpZiAoIXBsYW5lX3N0YXRlLT51YXBpLnZpc2libGUpCiAJCXJldHVybiAwOwogCiAJcmV0
ID0gaW50ZWxfcGxhbmVfY2hlY2tfc3JjX2Nvb3JkaW5hdGVzKHBsYW5lX3N0YXRlKTsKQEAgLTE5
OTYsNyArMTk5Niw3IEBAIGc0eF9zcHJpdGVfY2hlY2soc3RydWN0IGludGVsX2NydGNfc3RhdGUg
KmNydGNfc3RhdGUsCiAKIGludCBjaHZfcGxhbmVfY2hlY2tfcm90YXRpb24oY29uc3Qgc3RydWN0
IGludGVsX3BsYW5lX3N0YXRlICpwbGFuZV9zdGF0ZSkKIHsKLQlzdHJ1Y3QgaW50ZWxfcGxhbmUg
KnBsYW5lID0gdG9faW50ZWxfcGxhbmUocGxhbmVfc3RhdGUtPmJhc2UucGxhbmUpOworCXN0cnVj
dCBpbnRlbF9wbGFuZSAqcGxhbmUgPSB0b19pbnRlbF9wbGFuZShwbGFuZV9zdGF0ZS0+dWFwaS5w
bGFuZSk7CiAJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShwbGFu
ZS0+YmFzZS5kZXYpOwogCXVuc2lnbmVkIGludCByb3RhdGlvbiA9IHBsYW5lX3N0YXRlLT5ody5y
b3RhdGlvbjsKIApAQCAtMjAyMSw3ICsyMDIxLDcgQEAgdmx2X3Nwcml0ZV9jaGVjayhzdHJ1Y3Qg
aW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSwKIAlpZiAocmV0KQogCQlyZXR1cm4gcmV0Owog
Ci0JcmV0ID0gZHJtX2F0b21pY19oZWxwZXJfY2hlY2tfcGxhbmVfc3RhdGUoJnBsYW5lX3N0YXRl
LT5iYXNlLAorCXJldCA9IGRybV9hdG9taWNfaGVscGVyX2NoZWNrX3BsYW5lX3N0YXRlKCZwbGFu
ZV9zdGF0ZS0+dWFwaSwKIAkJCQkJCSAgJmNydGNfc3RhdGUtPnVhcGksCiAJCQkJCQkgIERSTV9Q
TEFORV9IRUxQRVJfTk9fU0NBTElORywKIAkJCQkJCSAgRFJNX1BMQU5FX0hFTFBFUl9OT19TQ0FM
SU5HLApAQCAtMjAzMyw3ICsyMDMzLDcgQEAgdmx2X3Nwcml0ZV9jaGVjayhzdHJ1Y3QgaW50ZWxf
Y3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSwKIAlpZiAocmV0KQogCQlyZXR1cm4gcmV0OwogCi0JaWYg
KCFwbGFuZV9zdGF0ZS0+YmFzZS52aXNpYmxlKQorCWlmICghcGxhbmVfc3RhdGUtPnVhcGkudmlz
aWJsZSkKIAkJcmV0dXJuIDA7CiAKIAlyZXQgPSBpbnRlbF9wbGFuZV9jaGVja19zcmNfY29vcmRp
bmF0ZXMocGxhbmVfc3RhdGUpOwpAQCAtMjA0OCw3ICsyMDQ4LDcgQEAgdmx2X3Nwcml0ZV9jaGVj
ayhzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSwKIHN0YXRpYyBpbnQgc2tsX3Bs
YW5lX2NoZWNrX2ZiKGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlLAog
CQkJICAgICAgY29uc3Qgc3RydWN0IGludGVsX3BsYW5lX3N0YXRlICpwbGFuZV9zdGF0ZSkKIHsK
LQlzdHJ1Y3QgaW50ZWxfcGxhbmUgKnBsYW5lID0gdG9faW50ZWxfcGxhbmUocGxhbmVfc3RhdGUt
PmJhc2UucGxhbmUpOworCXN0cnVjdCBpbnRlbF9wbGFuZSAqcGxhbmUgPSB0b19pbnRlbF9wbGFu
ZShwbGFuZV9zdGF0ZS0+dWFwaS5wbGFuZSk7CiAJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRl
dl9wcml2ID0gdG9faTkxNShwbGFuZS0+YmFzZS5kZXYpOwogCWNvbnN0IHN0cnVjdCBkcm1fZnJh
bWVidWZmZXIgKmZiID0gcGxhbmVfc3RhdGUtPmh3LmZiOwogCXVuc2lnbmVkIGludCByb3RhdGlv
biA9IHBsYW5lX3N0YXRlLT5ody5yb3RhdGlvbjsKQEAgLTIxMjMsOSArMjEyMyw5IEBAIHN0YXRp
YyBpbnQgc2tsX3BsYW5lX2NoZWNrX2RzdF9jb29yZGluYXRlcyhjb25zdCBzdHJ1Y3QgaW50ZWxf
Y3J0Y19zdGF0ZSAqY3J0Y19zCiAJCQkJCSAgIGNvbnN0IHN0cnVjdCBpbnRlbF9wbGFuZV9zdGF0
ZSAqcGxhbmVfc3RhdGUpCiB7CiAJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0K
LQkJdG9faTkxNShwbGFuZV9zdGF0ZS0+YmFzZS5wbGFuZS0+ZGV2KTsKLQlpbnQgY3J0Y194ID0g
cGxhbmVfc3RhdGUtPmJhc2UuZHN0LngxOwotCWludCBjcnRjX3cgPSBkcm1fcmVjdF93aWR0aCgm
cGxhbmVfc3RhdGUtPmJhc2UuZHN0KTsKKwkJdG9faTkxNShwbGFuZV9zdGF0ZS0+dWFwaS5wbGFu
ZS0+ZGV2KTsKKwlpbnQgY3J0Y194ID0gcGxhbmVfc3RhdGUtPnVhcGkuZHN0LngxOworCWludCBj
cnRjX3cgPSBkcm1fcmVjdF93aWR0aCgmcGxhbmVfc3RhdGUtPnVhcGkuZHN0KTsKIAlpbnQgcGlw
ZV9zcmNfdyA9IGNydGNfc3RhdGUtPnBpcGVfc3JjX3c7CiAKIAkvKgpAQCAtMjE1Myw3ICsyMTUz
LDcgQEAgc3RhdGljIGludCBza2xfcGxhbmVfY2hlY2tfbnYxMl9yb3RhdGlvbihjb25zdCBzdHJ1
Y3QgaW50ZWxfcGxhbmVfc3RhdGUgKnBsYW5lX3MKIHsKIAljb25zdCBzdHJ1Y3QgZHJtX2ZyYW1l
YnVmZmVyICpmYiA9IHBsYW5lX3N0YXRlLT5ody5mYjsKIAl1bnNpZ25lZCBpbnQgcm90YXRpb24g
PSBwbGFuZV9zdGF0ZS0+aHcucm90YXRpb247Ci0JaW50IHNyY193ID0gZHJtX3JlY3Rfd2lkdGgo
JnBsYW5lX3N0YXRlLT5iYXNlLnNyYykgPj4gMTY7CisJaW50IHNyY193ID0gZHJtX3JlY3Rfd2lk
dGgoJnBsYW5lX3N0YXRlLT51YXBpLnNyYykgPj4gMTY7CiAKIAkvKiBEaXNwbGF5IFdBICMxMTA2
ICovCiAJaWYgKGRybV9mb3JtYXRfaW5mb19pc195dXZfc2VtaXBsYW5hcihmYi0+Zm9ybWF0KSAm
JiBzcmNfdyAmIDMgJiYKQEAgLTIxODUsNyArMjE4NSw3IEBAIHN0YXRpYyBpbnQgc2tsX3BsYW5l
X21heF9zY2FsZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCiBzdGF0aWMgaW50
IHNrbF9wbGFuZV9jaGVjayhzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSwKIAkJ
CSAgIHN0cnVjdCBpbnRlbF9wbGFuZV9zdGF0ZSAqcGxhbmVfc3RhdGUpCiB7Ci0Jc3RydWN0IGlu
dGVsX3BsYW5lICpwbGFuZSA9IHRvX2ludGVsX3BsYW5lKHBsYW5lX3N0YXRlLT5iYXNlLnBsYW5l
KTsKKwlzdHJ1Y3QgaW50ZWxfcGxhbmUgKnBsYW5lID0gdG9faW50ZWxfcGxhbmUocGxhbmVfc3Rh
dGUtPnVhcGkucGxhbmUpOwogCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRv
X2k5MTUocGxhbmUtPmJhc2UuZGV2KTsKIAljb25zdCBzdHJ1Y3QgZHJtX2ZyYW1lYnVmZmVyICpm
YiA9IHBsYW5lX3N0YXRlLT5ody5mYjsKIAlpbnQgbWluX3NjYWxlID0gRFJNX1BMQU5FX0hFTFBF
Ul9OT19TQ0FMSU5HOwpAQCAtMjIwMiw3ICsyMjAyLDcgQEAgc3RhdGljIGludCBza2xfcGxhbmVf
Y2hlY2soc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUsCiAJCW1heF9zY2FsZSA9
IHNrbF9wbGFuZV9tYXhfc2NhbGUoZGV2X3ByaXYsIGZiKTsKIAl9CiAKLQlyZXQgPSBkcm1fYXRv
bWljX2hlbHBlcl9jaGVja19wbGFuZV9zdGF0ZSgmcGxhbmVfc3RhdGUtPmJhc2UsCisJcmV0ID0g
ZHJtX2F0b21pY19oZWxwZXJfY2hlY2tfcGxhbmVfc3RhdGUoJnBsYW5lX3N0YXRlLT51YXBpLAog
CQkJCQkJICAmY3J0Y19zdGF0ZS0+dWFwaSwKIAkJCQkJCSAgbWluX3NjYWxlLCBtYXhfc2NhbGUs
CiAJCQkJCQkgIHRydWUsIHRydWUpOwpAQCAtMjIxMyw3ICsyMjEzLDcgQEAgc3RhdGljIGludCBz
a2xfcGxhbmVfY2hlY2soc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUsCiAJaWYg
KHJldCkKIAkJcmV0dXJuIHJldDsKIAotCWlmICghcGxhbmVfc3RhdGUtPmJhc2UudmlzaWJsZSkK
KwlpZiAoIXBsYW5lX3N0YXRlLT51YXBpLnZpc2libGUpCiAJCXJldHVybiAwOwogCiAJcmV0ID0g
c2tsX3BsYW5lX2NoZWNrX2RzdF9jb29yZGluYXRlcyhjcnRjX3N0YXRlLCBwbGFuZV9zdGF0ZSk7
CkBAIC0yMjMwLDcgKzIyMzAsNyBAQCBzdGF0aWMgaW50IHNrbF9wbGFuZV9jaGVjayhzdHJ1Y3Qg
aW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSwKIAogCS8qIEhXIG9ubHkgaGFzIDggYml0cyBw
aXhlbCBwcmVjaXNpb24sIGRpc2FibGUgcGxhbmUgaWYgaW52aXNpYmxlICovCiAJaWYgKCEocGxh
bmVfc3RhdGUtPmh3LmFscGhhID4+IDgpKQotCQlwbGFuZV9zdGF0ZS0+YmFzZS52aXNpYmxlID0g
ZmFsc2U7CisJCXBsYW5lX3N0YXRlLT51YXBpLnZpc2libGUgPSBmYWxzZTsKIAogCXBsYW5lX3N0
YXRlLT5jdGwgPSBza2xfcGxhbmVfY3RsKGNydGNfc3RhdGUsIHBsYW5lX3N0YXRlKTsKIApAQCAt
MjI0OSw3ICsyMjQ5LDcgQEAgc3RhdGljIGJvb2wgaGFzX2RzdF9rZXlfaW5fcHJpbWFyeV9wbGFu
ZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCiBzdGF0aWMgdm9pZCBpbnRlbF9w
bGFuZV9zZXRfY2tleShzdHJ1Y3QgaW50ZWxfcGxhbmVfc3RhdGUgKnBsYW5lX3N0YXRlLAogCQkJ
CSBjb25zdCBzdHJ1Y3QgZHJtX2ludGVsX3Nwcml0ZV9jb2xvcmtleSAqc2V0KQogewotCXN0cnVj
dCBpbnRlbF9wbGFuZSAqcGxhbmUgPSB0b19pbnRlbF9wbGFuZShwbGFuZV9zdGF0ZS0+YmFzZS5w
bGFuZSk7CisJc3RydWN0IGludGVsX3BsYW5lICpwbGFuZSA9IHRvX2ludGVsX3BsYW5lKHBsYW5l
X3N0YXRlLT51YXBpLnBsYW5lKTsKIAlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYg
PSB0b19pOTE1KHBsYW5lLT5iYXNlLmRldik7CiAJc3RydWN0IGRybV9pbnRlbF9zcHJpdGVfY29s
b3JrZXkgKmtleSA9ICZwbGFuZV9zdGF0ZS0+Y2tleTsKIApkaWZmIC0tZ2l0IGEvZHJpdmVycy9n
cHUvZHJtL2k5MTUvaW50ZWxfcG0uYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2ludGVsX3BtLmMK
aW5kZXggMjVhOGUyMGQyMTEyLi5lN2RhNGI1MTM0YjIgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1
L2RybS9pOTE1L2ludGVsX3BtLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50ZWxfcG0u
YwpAQCAtNzg2LDcgKzc4Niw3IEBAIHN0YXRpYyBpbnQgaW50ZWxfd21fbnVtX2xldmVscyhzdHJ1
Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCiBzdGF0aWMgYm9vbCBpbnRlbF93bV9wbGFu
ZV92aXNpYmxlKGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlLAogCQkJ
CSAgIGNvbnN0IHN0cnVjdCBpbnRlbF9wbGFuZV9zdGF0ZSAqcGxhbmVfc3RhdGUpCiB7Ci0Jc3Ry
dWN0IGludGVsX3BsYW5lICpwbGFuZSA9IHRvX2ludGVsX3BsYW5lKHBsYW5lX3N0YXRlLT5iYXNl
LnBsYW5lKTsKKwlzdHJ1Y3QgaW50ZWxfcGxhbmUgKnBsYW5lID0gdG9faW50ZWxfcGxhbmUocGxh
bmVfc3RhdGUtPnVhcGkucGxhbmUpOwogCiAJLyogRklYTUUgY2hlY2sgdGhlICdlbmFibGUnIGlu
c3RlYWQgKi8KIAlpZiAoIWNydGNfc3RhdGUtPmh3LmFjdGl2ZSkKQEAgLTgwMyw3ICs4MDMsNyBA
QCBzdGF0aWMgYm9vbCBpbnRlbF93bV9wbGFuZV92aXNpYmxlKGNvbnN0IHN0cnVjdCBpbnRlbF9j
cnRjX3N0YXRlICpjcnRjX3N0YXRlLAogCWlmIChwbGFuZS0+aWQgPT0gUExBTkVfQ1VSU09SKQog
CQlyZXR1cm4gcGxhbmVfc3RhdGUtPmh3LmZiICE9IE5VTEw7CiAJZWxzZQotCQlyZXR1cm4gcGxh
bmVfc3RhdGUtPmJhc2UudmlzaWJsZTsKKwkJcmV0dXJuIHBsYW5lX3N0YXRlLT51YXBpLnZpc2li
bGU7CiB9CiAKIHN0YXRpYyBzdHJ1Y3QgaW50ZWxfY3J0YyAqc2luZ2xlX2VuYWJsZWRfY3J0Yyhz
dHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCkBAIC0xMDc1LDcgKzEwNzUsNyBAQCBz
dGF0aWMgdTE2IGc0eF9jb21wdXRlX3dtKGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpj
cnRjX3N0YXRlLAogCQkJICBjb25zdCBzdHJ1Y3QgaW50ZWxfcGxhbmVfc3RhdGUgKnBsYW5lX3N0
YXRlLAogCQkJICBpbnQgbGV2ZWwpCiB7Ci0Jc3RydWN0IGludGVsX3BsYW5lICpwbGFuZSA9IHRv
X2ludGVsX3BsYW5lKHBsYW5lX3N0YXRlLT5iYXNlLnBsYW5lKTsKKwlzdHJ1Y3QgaW50ZWxfcGxh
bmUgKnBsYW5lID0gdG9faW50ZWxfcGxhbmUocGxhbmVfc3RhdGUtPnVhcGkucGxhbmUpOwogCXN0
cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUocGxhbmUtPmJhc2UuZGV2
KTsKIAljb25zdCBzdHJ1Y3QgZHJtX2Rpc3BsYXlfbW9kZSAqYWRqdXN0ZWRfbW9kZSA9CiAJCSZj
cnRjX3N0YXRlLT5ody5hZGp1c3RlZF9tb2RlOwpAQCAtMTEwOCw3ICsxMTA4LDcgQEAgc3RhdGlj
IHUxNiBnNHhfY29tcHV0ZV93bShjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19z
dGF0ZSwKIAljbG9jayA9IGFkanVzdGVkX21vZGUtPmNydGNfY2xvY2s7CiAJaHRvdGFsID0gYWRq
dXN0ZWRfbW9kZS0+Y3J0Y19odG90YWw7CiAKLQl3aWR0aCA9IGRybV9yZWN0X3dpZHRoKCZwbGFu
ZV9zdGF0ZS0+YmFzZS5kc3QpOworCXdpZHRoID0gZHJtX3JlY3Rfd2lkdGgoJnBsYW5lX3N0YXRl
LT51YXBpLmRzdCk7CiAKIAlpZiAocGxhbmUtPmlkID09IFBMQU5FX0NVUlNPUikgewogCQl3bSA9
IGludGVsX3dtX21ldGhvZDIoY2xvY2ssIGh0b3RhbCwgd2lkdGgsIGNwcCwgbGF0ZW5jeSk7CkBA
IC0xMTc0LDcgKzExNzQsNyBAQCBzdGF0aWMgdTMyIGlsa19jb21wdXRlX2ZiY193bShjb25zdCBz
dHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSwKIHN0YXRpYyBib29sIGc0eF9yYXdf
cGxhbmVfd21fY29tcHV0ZShzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSwKIAkJ
CQkgICAgIGNvbnN0IHN0cnVjdCBpbnRlbF9wbGFuZV9zdGF0ZSAqcGxhbmVfc3RhdGUpCiB7Ci0J
c3RydWN0IGludGVsX3BsYW5lICpwbGFuZSA9IHRvX2ludGVsX3BsYW5lKHBsYW5lX3N0YXRlLT5i
YXNlLnBsYW5lKTsKKwlzdHJ1Y3QgaW50ZWxfcGxhbmUgKnBsYW5lID0gdG9faW50ZWxfcGxhbmUo
cGxhbmVfc3RhdGUtPnVhcGkucGxhbmUpOwogCWludCBudW1fbGV2ZWxzID0gaW50ZWxfd21fbnVt
X2xldmVscyh0b19pOTE1KHBsYW5lLT5iYXNlLmRldikpOwogCWVudW0gcGxhbmVfaWQgcGxhbmVf
aWQgPSBwbGFuZS0+aWQ7CiAJYm9vbCBkaXJ0eSA9IGZhbHNlOwpAQCAtMTU4MSw3ICsxNTgxLDcg
QEAgc3RhdGljIHUxNiB2bHZfY29tcHV0ZV93bV9sZXZlbChjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0
Y19zdGF0ZSAqY3J0Y19zdGF0ZSwKIAkJCQljb25zdCBzdHJ1Y3QgaW50ZWxfcGxhbmVfc3RhdGUg
KnBsYW5lX3N0YXRlLAogCQkJCWludCBsZXZlbCkKIHsKLQlzdHJ1Y3QgaW50ZWxfcGxhbmUgKnBs
YW5lID0gdG9faW50ZWxfcGxhbmUocGxhbmVfc3RhdGUtPmJhc2UucGxhbmUpOworCXN0cnVjdCBp
bnRlbF9wbGFuZSAqcGxhbmUgPSB0b19pbnRlbF9wbGFuZShwbGFuZV9zdGF0ZS0+dWFwaS5wbGFu
ZSk7CiAJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShwbGFuZS0+
YmFzZS5kZXYpOwogCWNvbnN0IHN0cnVjdCBkcm1fZGlzcGxheV9tb2RlICphZGp1c3RlZF9tb2Rl
ID0KIAkJJmNydGNfc3RhdGUtPmh3LmFkanVzdGVkX21vZGU7CkBAIC0xNzUxLDcgKzE3NTEsNyBA
QCBzdGF0aWMgYm9vbCB2bHZfcmF3X3BsYW5lX3dtX3NldChzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0
ZSAqY3J0Y19zdGF0ZSwKIHN0YXRpYyBib29sIHZsdl9yYXdfcGxhbmVfd21fY29tcHV0ZShzdHJ1
Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSwKIAkJCQkgICAgIGNvbnN0IHN0cnVjdCBp
bnRlbF9wbGFuZV9zdGF0ZSAqcGxhbmVfc3RhdGUpCiB7Ci0Jc3RydWN0IGludGVsX3BsYW5lICpw
bGFuZSA9IHRvX2ludGVsX3BsYW5lKHBsYW5lX3N0YXRlLT5iYXNlLnBsYW5lKTsKKwlzdHJ1Y3Qg
aW50ZWxfcGxhbmUgKnBsYW5lID0gdG9faW50ZWxfcGxhbmUocGxhbmVfc3RhdGUtPnVhcGkucGxh
bmUpOwogCWVudW0gcGxhbmVfaWQgcGxhbmVfaWQgPSBwbGFuZS0+aWQ7CiAJaW50IG51bV9sZXZl
bHMgPSBpbnRlbF93bV9udW1fbGV2ZWxzKHRvX2k5MTUocGxhbmUtPmJhc2UuZGV2KSk7CiAJaW50
IGxldmVsOwpAQCAtMjQ4NCw3ICsyNDg0LDcgQEAgc3RhdGljIHUzMiBpbGtfY29tcHV0ZV9wcmlf
d20oY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUsCiAKIAltZXRob2Qy
ID0gaWxrX3dtX21ldGhvZDIoY3J0Y19zdGF0ZS0+cGl4ZWxfcmF0ZSwKIAkJCQkgY3J0Y19zdGF0
ZS0+aHcuYWRqdXN0ZWRfbW9kZS5jcnRjX2h0b3RhbCwKLQkJCQkgZHJtX3JlY3Rfd2lkdGgoJnBs
YW5lX3N0YXRlLT5iYXNlLmRzdCksCisJCQkJIGRybV9yZWN0X3dpZHRoKCZwbGFuZV9zdGF0ZS0+
dWFwaS5kc3QpLAogCQkJCSBjcHAsIG1lbV92YWx1ZSk7CiAKIAlyZXR1cm4gbWluKG1ldGhvZDEs
IG1ldGhvZDIpOwpAQCAtMjUxMiw3ICsyNTEyLDcgQEAgc3RhdGljIHUzMiBpbGtfY29tcHV0ZV9z
cHJfd20oY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUsCiAJbWV0aG9k
MSA9IGlsa193bV9tZXRob2QxKGNydGNfc3RhdGUtPnBpeGVsX3JhdGUsIGNwcCwgbWVtX3ZhbHVl
KTsKIAltZXRob2QyID0gaWxrX3dtX21ldGhvZDIoY3J0Y19zdGF0ZS0+cGl4ZWxfcmF0ZSwKIAkJ
CQkgY3J0Y19zdGF0ZS0+aHcuYWRqdXN0ZWRfbW9kZS5jcnRjX2h0b3RhbCwKLQkJCQkgZHJtX3Jl
Y3Rfd2lkdGgoJnBsYW5lX3N0YXRlLT5iYXNlLmRzdCksCisJCQkJIGRybV9yZWN0X3dpZHRoKCZw
bGFuZV9zdGF0ZS0+dWFwaS5kc3QpLAogCQkJCSBjcHAsIG1lbV92YWx1ZSk7CiAJcmV0dXJuIG1p
bihtZXRob2QxLCBtZXRob2QyKTsKIH0KQEAgLTI1MzcsNyArMjUzNyw3IEBAIHN0YXRpYyB1MzIg
aWxrX2NvbXB1dGVfY3VyX3dtKGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0
YXRlLAogCiAJcmV0dXJuIGlsa193bV9tZXRob2QyKGNydGNfc3RhdGUtPnBpeGVsX3JhdGUsCiAJ
CQkgICAgICBjcnRjX3N0YXRlLT5ody5hZGp1c3RlZF9tb2RlLmNydGNfaHRvdGFsLAotCQkJICAg
ICAgZHJtX3JlY3Rfd2lkdGgoJnBsYW5lX3N0YXRlLT5iYXNlLmRzdCksCisJCQkgICAgICBkcm1f
cmVjdF93aWR0aCgmcGxhbmVfc3RhdGUtPnVhcGkuZHN0KSwKIAkJCSAgICAgIGNwcCwgbWVtX3Zh
bHVlKTsKIH0KIApAQCAtMjU1Myw3ICsyNTUzLDggQEAgc3RhdGljIHUzMiBpbGtfY29tcHV0ZV9m
YmNfd20oY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUsCiAKIAljcHAg
PSBwbGFuZV9zdGF0ZS0+aHcuZmItPmZvcm1hdC0+Y3BwWzBdOwogCi0JcmV0dXJuIGlsa193bV9m
YmMocHJpX3ZhbCwgZHJtX3JlY3Rfd2lkdGgoJnBsYW5lX3N0YXRlLT5iYXNlLmRzdCksIGNwcCk7
CisJcmV0dXJuIGlsa193bV9mYmMocHJpX3ZhbCwgZHJtX3JlY3Rfd2lkdGgoJnBsYW5lX3N0YXRl
LT51YXBpLmRzdCksCisJCQkgIGNwcCk7CiB9CiAKIHN0YXRpYyB1bnNpZ25lZCBpbnQKQEAgLTMw
OTcsMTAgKzMwOTgsMTAgQEAgc3RhdGljIGludCBpbGtfY29tcHV0ZV9waXBlX3dtKHN0cnVjdCBp
bnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlKQogCiAJcGlwZV93bS0+cGlwZV9lbmFibGVkID0g
Y3J0Y19zdGF0ZS0+aHcuYWN0aXZlOwogCWlmIChzcHJzdGF0ZSkgewotCQlwaXBlX3dtLT5zcHJp
dGVzX2VuYWJsZWQgPSBzcHJzdGF0ZS0+YmFzZS52aXNpYmxlOwotCQlwaXBlX3dtLT5zcHJpdGVz
X3NjYWxlZCA9IHNwcnN0YXRlLT5iYXNlLnZpc2libGUgJiYKLQkJCShkcm1fcmVjdF93aWR0aCgm
c3Byc3RhdGUtPmJhc2UuZHN0KSAhPSBkcm1fcmVjdF93aWR0aCgmc3Byc3RhdGUtPmJhc2Uuc3Jj
KSA+PiAxNiB8fAotCQkJIGRybV9yZWN0X2hlaWdodCgmc3Byc3RhdGUtPmJhc2UuZHN0KSAhPSBk
cm1fcmVjdF9oZWlnaHQoJnNwcnN0YXRlLT5iYXNlLnNyYykgPj4gMTYpOworCQlwaXBlX3dtLT5z
cHJpdGVzX2VuYWJsZWQgPSBzcHJzdGF0ZS0+dWFwaS52aXNpYmxlOworCQlwaXBlX3dtLT5zcHJp
dGVzX3NjYWxlZCA9IHNwcnN0YXRlLT51YXBpLnZpc2libGUgJiYKKwkJCShkcm1fcmVjdF93aWR0
aCgmc3Byc3RhdGUtPnVhcGkuZHN0KSAhPSBkcm1fcmVjdF93aWR0aCgmc3Byc3RhdGUtPnVhcGku
c3JjKSA+PiAxNiB8fAorCQkJIGRybV9yZWN0X2hlaWdodCgmc3Byc3RhdGUtPnVhcGkuZHN0KSAh
PSBkcm1fcmVjdF9oZWlnaHQoJnNwcnN0YXRlLT51YXBpLnNyYykgPj4gMTYpOwogCX0KIAogCXVz
YWJsZV9sZXZlbCA9IG1heF9sZXZlbDsKQEAgLTQwNzIsMTAgKzQwNzMsMTAgQEAgc2tsX3BsYW5l
X2Rvd25zY2FsZV9hbW91bnQoY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3Rh
dGUsCiAJICoKIAkgKiBuLmIuLCBzcmMgaXMgMTYuMTYgZml4ZWQgcG9pbnQsIGRzdCBpcyB3aG9s
ZSBpbnRlZ2VyLgogCSAqLwotCXNyY193ID0gZHJtX3JlY3Rfd2lkdGgoJnBsYW5lX3N0YXRlLT5i
YXNlLnNyYykgPj4gMTY7Ci0Jc3JjX2ggPSBkcm1fcmVjdF9oZWlnaHQoJnBsYW5lX3N0YXRlLT5i
YXNlLnNyYykgPj4gMTY7Ci0JZHN0X3cgPSBkcm1fcmVjdF93aWR0aCgmcGxhbmVfc3RhdGUtPmJh
c2UuZHN0KTsKLQlkc3RfaCA9IGRybV9yZWN0X2hlaWdodCgmcGxhbmVfc3RhdGUtPmJhc2UuZHN0
KTsKKwlzcmNfdyA9IGRybV9yZWN0X3dpZHRoKCZwbGFuZV9zdGF0ZS0+dWFwaS5zcmMpID4+IDE2
OworCXNyY19oID0gZHJtX3JlY3RfaGVpZ2h0KCZwbGFuZV9zdGF0ZS0+dWFwaS5zcmMpID4+IDE2
OworCWRzdF93ID0gZHJtX3JlY3Rfd2lkdGgoJnBsYW5lX3N0YXRlLT51YXBpLmRzdCk7CisJZHN0
X2ggPSBkcm1fcmVjdF9oZWlnaHQoJnBsYW5lX3N0YXRlLT51YXBpLmRzdCk7CiAKIAlmcF93X3Jh
dGlvID0gZGl2X2ZpeGVkMTYoc3JjX3csIGRzdF93KTsKIAlmcF9oX3JhdGlvID0gZGl2X2ZpeGVk
MTYoc3JjX2gsIGRzdF9oKTsKQEAgLTQwOTAsMTQgKzQwOTEsMTQgQEAgc2tsX3BsYW5lX3JlbGF0
aXZlX2RhdGFfcmF0ZShjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSwK
IAkJCSAgICAgY29uc3Qgc3RydWN0IGludGVsX3BsYW5lX3N0YXRlICpwbGFuZV9zdGF0ZSwKIAkJ
CSAgICAgaW50IGNvbG9yX3BsYW5lKQogewotCXN0cnVjdCBpbnRlbF9wbGFuZSAqcGxhbmUgPSB0
b19pbnRlbF9wbGFuZShwbGFuZV9zdGF0ZS0+YmFzZS5wbGFuZSk7CisJc3RydWN0IGludGVsX3Bs
YW5lICpwbGFuZSA9IHRvX2ludGVsX3BsYW5lKHBsYW5lX3N0YXRlLT51YXBpLnBsYW5lKTsKIAlj
b25zdCBzdHJ1Y3QgZHJtX2ZyYW1lYnVmZmVyICpmYiA9IHBsYW5lX3N0YXRlLT5ody5mYjsKIAl1
MzIgZGF0YV9yYXRlOwogCXUzMiB3aWR0aCA9IDAsIGhlaWdodCA9IDA7CiAJdWludF9maXhlZF8x
Nl8xNl90IGRvd25fc2NhbGVfYW1vdW50OwogCXU2NCByYXRlOwogCi0JaWYgKCFwbGFuZV9zdGF0
ZS0+YmFzZS52aXNpYmxlKQorCWlmICghcGxhbmVfc3RhdGUtPnVhcGkudmlzaWJsZSkKIAkJcmV0
dXJuIDA7CiAKIAlpZiAocGxhbmUtPmlkID09IFBMQU5FX0NVUlNPUikKQEAgLTQxMTIsOCArNDEx
Myw4IEBAIHNrbF9wbGFuZV9yZWxhdGl2ZV9kYXRhX3JhdGUoY29uc3Qgc3RydWN0IGludGVsX2Ny
dGNfc3RhdGUgKmNydGNfc3RhdGUsCiAJICogdGhlIDkwLzI3MCBkZWdyZWUgcGxhbmUgcm90YXRp
b24gY2FzZXMgKHRvIG1hdGNoIHRoZQogCSAqIEdUVCBtYXBwaW5nKSwgaGVuY2Ugbm8gbmVlZCB0
byBhY2NvdW50IGZvciByb3RhdGlvbiBoZXJlLgogCSAqLwotCXdpZHRoID0gZHJtX3JlY3Rfd2lk
dGgoJnBsYW5lX3N0YXRlLT5iYXNlLnNyYykgPj4gMTY7Ci0JaGVpZ2h0ID0gZHJtX3JlY3RfaGVp
Z2h0KCZwbGFuZV9zdGF0ZS0+YmFzZS5zcmMpID4+IDE2OworCXdpZHRoID0gZHJtX3JlY3Rfd2lk
dGgoJnBsYW5lX3N0YXRlLT51YXBpLnNyYykgPj4gMTY7CisJaGVpZ2h0ID0gZHJtX3JlY3RfaGVp
Z2h0KCZwbGFuZV9zdGF0ZS0+dWFwaS5zcmMpID4+IDE2OwogCiAJLyogVVYgcGxhbmUgZG9lcyAx
LzIgcGl4ZWwgc3ViLXNhbXBsaW5nICovCiAJaWYgKGNvbG9yX3BsYW5lID09IDEpIHsKQEAgLTQ2
MjAsNyArNDYyMSw3IEBAIHNrbF9jb21wdXRlX3BsYW5lX3dtX3BhcmFtcyhjb25zdCBzdHJ1Y3Qg
aW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSwKIAkgKiB0aGUgOTAvMjcwIGRlZ3JlZSBwbGFu
ZSByb3RhdGlvbiBjYXNlcyAodG8gbWF0Y2ggdGhlCiAJICogR1RUIG1hcHBpbmcpLCBoZW5jZSBu
byBuZWVkIHRvIGFjY291bnQgZm9yIHJvdGF0aW9uIGhlcmUuCiAJICovCi0Jd2lkdGggPSBkcm1f
cmVjdF93aWR0aCgmcGxhbmVfc3RhdGUtPmJhc2Uuc3JjKSA+PiAxNjsKKwl3aWR0aCA9IGRybV9y
ZWN0X3dpZHRoKCZwbGFuZV9zdGF0ZS0+dWFwaS5zcmMpID4+IDE2OwogCiAJcmV0dXJuIHNrbF9j
b21wdXRlX3dtX3BhcmFtcyhjcnRjX3N0YXRlLCB3aWR0aCwKIAkJCQkgICAgIGZiLT5mb3JtYXQs
IGZiLT5tb2RpZmllciwKQEAgLTQ5MDIsNyArNDkwMyw3IEBAIHN0YXRpYyBpbnQgc2tsX2J1aWxk
X3BsYW5lX3dtX3V2KHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlLAogc3RhdGlj
IGludCBza2xfYnVpbGRfcGxhbmVfd20oc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3Rh
dGUsCiAJCQkgICAgICBjb25zdCBzdHJ1Y3QgaW50ZWxfcGxhbmVfc3RhdGUgKnBsYW5lX3N0YXRl
KQogewotCXN0cnVjdCBpbnRlbF9wbGFuZSAqcGxhbmUgPSB0b19pbnRlbF9wbGFuZShwbGFuZV9z
dGF0ZS0+YmFzZS5wbGFuZSk7CisJc3RydWN0IGludGVsX3BsYW5lICpwbGFuZSA9IHRvX2ludGVs
X3BsYW5lKHBsYW5lX3N0YXRlLT51YXBpLnBsYW5lKTsKIAljb25zdCBzdHJ1Y3QgZHJtX2ZyYW1l
YnVmZmVyICpmYiA9IHBsYW5lX3N0YXRlLT5ody5mYjsKIAllbnVtIHBsYW5lX2lkIHBsYW5lX2lk
ID0gcGxhbmUtPmlkOwogCWludCByZXQ7CkBAIC00OTI4LDcgKzQ5MjksNyBAQCBzdGF0aWMgaW50
IHNrbF9idWlsZF9wbGFuZV93bShzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSwK
IHN0YXRpYyBpbnQgaWNsX2J1aWxkX3BsYW5lX3dtKHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpj
cnRjX3N0YXRlLAogCQkJICAgICAgY29uc3Qgc3RydWN0IGludGVsX3BsYW5lX3N0YXRlICpwbGFu
ZV9zdGF0ZSkKIHsKLQllbnVtIHBsYW5lX2lkIHBsYW5lX2lkID0gdG9faW50ZWxfcGxhbmUocGxh
bmVfc3RhdGUtPmJhc2UucGxhbmUpLT5pZDsKKwllbnVtIHBsYW5lX2lkIHBsYW5lX2lkID0gdG9f
aW50ZWxfcGxhbmUocGxhbmVfc3RhdGUtPnVhcGkucGxhbmUpLT5pZDsKIAlpbnQgcmV0OwogCiAJ
LyogV2F0ZXJtYXJrcyBjYWxjdWxhdGVkIGluIG1hc3RlciAqLwpAQCAtNTkzMCw3ICs1OTMxLDcg
QEAgdm9pZCBnNHhfd21fc2FuaXRpemUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2
KQogCQllbnVtIHBsYW5lX2lkIHBsYW5lX2lkID0gcGxhbmUtPmlkOwogCQlpbnQgbGV2ZWw7CiAK
LQkJaWYgKHBsYW5lX3N0YXRlLT5iYXNlLnZpc2libGUpCisJCWlmIChwbGFuZV9zdGF0ZS0+dWFw
aS52aXNpYmxlKQogCQkJY29udGludWU7CiAKIAkJZm9yIChsZXZlbCA9IDA7IGxldmVsIDwgMzsg
bGV2ZWwrKykgewpAQCAtNjA4NSw3ICs2MDg2LDcgQEAgdm9pZCB2bHZfd21fc2FuaXRpemUoc3Ry
dWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQogCQllbnVtIHBsYW5lX2lkIHBsYW5lX2lk
ID0gcGxhbmUtPmlkOwogCQlpbnQgbGV2ZWw7CiAKLQkJaWYgKHBsYW5lX3N0YXRlLT5iYXNlLnZp
c2libGUpCisJCWlmIChwbGFuZV9zdGF0ZS0+dWFwaS52aXNpYmxlKQogCQkJY29udGludWU7CiAK
IAkJZm9yIChsZXZlbCA9IDA7IGxldmVsIDwgd21fc3RhdGUtPm51bV9sZXZlbHM7IGxldmVsKysp
IHsKLS0gCjIuMjMuMAoKX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX18KSW50ZWwtZ2Z4IG1haWxpbmcgbGlzdApJbnRlbC1nZnhAbGlzdHMuZnJlZWRlc2t0b3Au
b3JnCmh0dHBzOi8vbGlzdHMuZnJlZWRlc2t0b3Aub3JnL21haWxtYW4vbGlzdGluZm8vaW50ZWwt
Z2Z4

Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id F032DCFD0D
	for <lists+intel-gfx@lfdr.de>; Tue,  8 Oct 2019 17:03:06 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 0E3416E823;
	Tue,  8 Oct 2019 15:03:05 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from fireflyinternet.com (mail.fireflyinternet.com [109.228.58.192])
 by gabe.freedesktop.org (Postfix) with ESMTPS id B89776E823
 for <intel-gfx@lists.freedesktop.org>; Tue,  8 Oct 2019 15:03:03 +0000 (UTC)
X-Default-Received-SPF: pass (skip=forwardok (res=PASS))
 x-ip-name=78.156.65.138; 
Received: from localhost (unverified [78.156.65.138]) 
 by fireflyinternet.com (Firefly Internet (M1)) with ESMTP (TLS) id
 18766345-1500050 for multiple; Tue, 08 Oct 2019 16:02:59 +0100
MIME-Version: 1.0
From: Chris Wilson <chris@chris-wilson.co.uk>
User-Agent: alot/0.6
To: "Summers, Stuart" <stuart.summers@intel.com>,
 "intel-gfx@lists.freedesktop.org" <intel-gfx@lists.freedesktop.org>
References: <20191008105655.13256-1-chris@chris-wilson.co.uk>
 <9ceb719d99e836defc5671ed6b2e1f6cd3d516bc.camel@intel.com>
In-Reply-To: <9ceb719d99e836defc5671ed6b2e1f6cd3d516bc.camel@intel.com>
Message-ID: <157054697790.13327.8709671556101488856@skylake-alporthouse-com>
Date: Tue, 08 Oct 2019 16:02:57 +0100
Subject: Re: [Intel-gfx] [PATCH] drm/i915/gt: Flush submission tasklet
 before waiting/retiring
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

UXVvdGluZyBTdW1tZXJzLCBTdHVhcnQgKDIwMTktMTAtMDggMTU6NTI6MTUpCj4gT24gVHVlLCAy
MDE5LTEwLTA4IGF0IDExOjU2ICswMTAwLCBDaHJpcyBXaWxzb24gd3JvdGU6Cj4gPiBBIGNvbW1v
biBiYW5lIG9mIG91cnMgaXMgYXJiaXRyYXJ5IGRlbGF5cyBpbiBrc29mdGlycWQgcHJvY2Vzc2lu
ZyBvdXIKPiA+IHN1Ym1pc3Npb24gdGFza2xldC4gR2l2ZSB0aGUgc3VibWlzc2lvbiB0YXNrbGV0
IGEga2ljayBiZWZvcmUgd2Ugd2FpdAo+ID4gdG8KPiA+IGF2b2lkIHRob3NlIGRlbGF5cyBlYXRp
bmcgaW50byBhIHRpZ2h0IHRpbWVvdXQuCj4gPiAKPiA+IFNpZ25lZC1vZmYtYnk6IENocmlzIFdp
bHNvbiA8Y2hyaXNAY2hyaXMtd2lsc29uLmNvLnVrPgo+ID4gLS0tCj4gPiAgZHJpdmVycy9ncHUv
ZHJtL2k5MTUvZ3QvaW50ZWxfZW5naW5lLmggICAgICB8ICAzICstCj4gPiAgZHJpdmVycy9ncHUv
ZHJtL2k5MTUvZ3QvaW50ZWxfZW5naW5lX2NzLmMgICB8IDMzICsrKysrKysrKysrKystLS0tCj4g
PiAtLS0tCj4gPiAgZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfZ3RfcmVxdWVzdHMuYyB8
IDEyICsrKysrKysrCj4gPiAgMyBmaWxlcyBjaGFuZ2VkLCAzNCBpbnNlcnRpb25zKCspLCAxNCBk
ZWxldGlvbnMoLSkKPiA+IAo+ID4gZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0
L2ludGVsX2VuZ2luZS5oCj4gPiBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2VuZ2lu
ZS5oCj4gPiBpbmRleCBjOWU4YzhjY2JkNDcuLmQ2MjQ3NTJmMmE5MiAxMDA2NDQKPiA+IC0tLSBh
L2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2VuZ2luZS5oCj4gPiArKysgYi9kcml2ZXJz
L2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9lbmdpbmUuaAo+ID4gQEAgLTQwNyw4ICs0MDcsOSBAQCBz
dGF0aWMgaW5saW5lIHZvaWQgX19pbnRlbF9lbmdpbmVfcmVzZXQoc3RydWN0Cj4gPiBpbnRlbF9l
bmdpbmVfY3MgKmVuZ2luZSwKPiA+ICAgICAgIGVuZ2luZS0+c2VyaWFsKys7IC8qIGNvbnRleHRz
IGxvc3QgKi8KPiA+ICB9Cj4gPiAgCj4gPiAtYm9vbCBpbnRlbF9lbmdpbmVfaXNfaWRsZShzdHJ1
Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmUpOwo+ID4gIGJvb2wgaW50ZWxfZW5naW5lc19hcmVf
aWRsZShzdHJ1Y3QgaW50ZWxfZ3QgKmd0KTsKPiA+ICtib29sIGludGVsX2VuZ2luZV9pc19pZGxl
KHN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZSk7Cj4gPiArdm9pZCBpbnRlbF9lbmdpbmVf
Zmx1c2hfc3VibWlzc2lvbihzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmUpOwo+ID4gIAo+
ID4gIHZvaWQgaW50ZWxfZW5naW5lc19yZXNldF9kZWZhdWx0X3N1Ym1pc3Npb24oc3RydWN0IGlu
dGVsX2d0ICpndCk7Cj4gPiAgCj4gPiBkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUv
Z3QvaW50ZWxfZW5naW5lX2NzLmMKPiA+IGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxf
ZW5naW5lX2NzLmMKPiA+IGluZGV4IDYyMjBiNzE1MWJiOS4uN2UyYWE3YTZiZWYwIDEwMDY0NAo+
ID4gLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfZW5naW5lX2NzLmMKPiA+ICsr
KyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2VuZ2luZV9jcy5jCj4gPiBAQCAtMTA0
MCw2ICsxMDQwLDI1IEBAIHN0YXRpYyBib29sIHJpbmdfaXNfaWRsZShzdHJ1Y3QKPiA+IGludGVs
X2VuZ2luZV9jcyAqZW5naW5lKQo+ID4gICAgICAgcmV0dXJuIGlkbGU7Cj4gPiAgfQo+ID4gIAo+
ID4gK3ZvaWQgaW50ZWxfZW5naW5lX2ZsdXNoX3N1Ym1pc3Npb24oc3RydWN0IGludGVsX2VuZ2lu
ZV9jcyAqZW5naW5lKQo+ID4gK3sKPiA+ICsgICAgIHN0cnVjdCB0YXNrbGV0X3N0cnVjdCAqdCA9
ICZlbmdpbmUtPmV4ZWNsaXN0cy50YXNrbGV0Owo+ID4gKwo+ID4gKyAgICAgaWYgKF9fdGFza2xl
dF9pc19zY2hlZHVsZWQodCkpIHsKPiA+ICsgICAgICAgICAgICAgbG9jYWxfYmhfZGlzYWJsZSgp
Owo+ID4gKyAgICAgICAgICAgICBpZiAodGFza2xldF90cnlsb2NrKHQpKSB7Cj4gPiArICAgICAg
ICAgICAgICAgICAgICAgLyogTXVzdCB3YWl0IGZvciBhbnkgR1BVIHJlc2V0IGluIHByb2dyZXNz
LiAqLwo+ID4gKyAgICAgICAgICAgICAgICAgICAgIGlmIChfX3Rhc2tsZXRfaXNfZW5hYmxlZCh0
KSkKPiA+ICsgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHQtPmZ1bmModC0+ZGF0YSk7Cj4g
PiArICAgICAgICAgICAgICAgICAgICAgdGFza2xldF91bmxvY2sodCk7Cj4gPiArICAgICAgICAg
ICAgIH0KPiA+ICsgICAgICAgICAgICAgbG9jYWxfYmhfZW5hYmxlKCk7Cj4gPiArICAgICB9Cj4g
PiArCj4gPiArICAgICAvKiBPdGhlcndpc2UgZmx1c2ggdGhlIHRhc2tsZXQgaWYgaXQgd2FzIHJ1
bm5pbmcgb24gYW5vdGhlciBjcHUKPiA+ICovCj4gPiArICAgICB0YXNrbGV0X3VubG9ja193YWl0
KHQpOwo+ID4gK30KPiA+ICsKPiA+ICAvKioKPiA+ICAgKiBpbnRlbF9lbmdpbmVfaXNfaWRsZSgp
IC0gUmVwb3J0IGlmIHRoZSBlbmdpbmUgaGFzIGZpbmlzaGVkCj4gPiBwcm9jZXNzIGFsbCB3b3Jr
Cj4gPiAgICogQGVuZ2luZTogdGhlIGludGVsX2VuZ2luZV9jcwo+ID4gQEAgLTEwNTgsMjEgKzEw
NzcsOSBAQCBib29sIGludGVsX2VuZ2luZV9pc19pZGxlKHN0cnVjdAo+ID4gaW50ZWxfZW5naW5l
X2NzICplbmdpbmUpCj4gPiAgCj4gPiAgICAgICAvKiBXYWl0aW5nIHRvIGRyYWluIEVMU1A/ICov
Cj4gPiAgICAgICBpZiAoZXhlY2xpc3RzX2FjdGl2ZSgmZW5naW5lLT5leGVjbGlzdHMpKSB7Cj4g
PiAtICAgICAgICAgICAgIHN0cnVjdCB0YXNrbGV0X3N0cnVjdCAqdCA9ICZlbmdpbmUtPmV4ZWNs
aXN0cy50YXNrbGV0Owo+ID4gLQo+ID4gICAgICAgICAgICAgICBzeW5jaHJvbml6ZV9oYXJkaXJx
KGVuZ2luZS0+aTkxNS0+ZHJtLnBkZXYtPmlycSk7Cj4gPiAgCj4gPiAtICAgICAgICAgICAgIGxv
Y2FsX2JoX2Rpc2FibGUoKTsKPiA+IC0gICAgICAgICAgICAgaWYgKHRhc2tsZXRfdHJ5bG9jayh0
KSkgewo+ID4gLSAgICAgICAgICAgICAgICAgICAgIC8qIE11c3Qgd2FpdCBmb3IgYW55IEdQVSBy
ZXNldCBpbiBwcm9ncmVzcy4gKi8KPiA+IC0gICAgICAgICAgICAgICAgICAgICBpZiAoX190YXNr
bGV0X2lzX2VuYWJsZWQodCkpCj4gPiAtICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0LT5m
dW5jKHQtPmRhdGEpOwo+ID4gLSAgICAgICAgICAgICAgICAgICAgIHRhc2tsZXRfdW5sb2NrKHQp
Owo+ID4gLSAgICAgICAgICAgICB9Cj4gPiAtICAgICAgICAgICAgIGxvY2FsX2JoX2VuYWJsZSgp
Owo+ID4gLQo+ID4gLSAgICAgICAgICAgICAvKiBPdGhlcndpc2UgZmx1c2ggdGhlIHRhc2tsZXQg
aWYgaXQgd2FzIG9uIGFub3RoZXIgY3B1Cj4gPiAqLwo+ID4gLSAgICAgICAgICAgICB0YXNrbGV0
X3VubG9ja193YWl0KHQpOwo+ID4gKyAgICAgICAgICAgICBpbnRlbF9lbmdpbmVfZmx1c2hfc3Vi
bWlzc2lvbihlbmdpbmUpOwo+ID4gIAo+ID4gICAgICAgICAgICAgICBpZiAoZXhlY2xpc3RzX2Fj
dGl2ZSgmZW5naW5lLT5leGVjbGlzdHMpKQo+ID4gICAgICAgICAgICAgICAgICAgICAgIHJldHVy
biBmYWxzZTsKPiA+IGRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9n
dF9yZXF1ZXN0cy5jCj4gPiBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2d0X3JlcXVl
c3RzLmMKPiA+IGluZGV4IGNhNjA2Yjc5ZmQ1ZS4uY2JiNDA2OWIxMWUxIDEwMDY0NAo+ID4gLS0t
IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfZ3RfcmVxdWVzdHMuYwo+ID4gKysrIGIv
ZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfZ3RfcmVxdWVzdHMuYwo+ID4gQEAgLTQsNiAr
NCw3IEBACj4gPiAgICogQ29weXJpZ2h0IMKpIDIwMTkgSW50ZWwgQ29ycG9yYXRpb24KPiA+ICAg
Ki8KPiA+ICAKPiA+ICsjaW5jbHVkZSAiaTkxNV9kcnYuaCIgLyogZm9yX2VhY2hfZW5naW5lKCkg
Ki8KPiA+ICAjaW5jbHVkZSAiaTkxNV9yZXF1ZXN0LmgiCj4gPiAgI2luY2x1ZGUgImludGVsX2d0
LmgiCj4gPiAgI2luY2x1ZGUgImludGVsX2d0X3BtLmgiCj4gPiBAQCAtMTksNiArMjAsMTUgQEAg
c3RhdGljIHZvaWQgcmV0aXJlX3JlcXVlc3RzKHN0cnVjdCBpbnRlbF90aW1lbGluZQo+ID4gKnRs
KQo+ID4gICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwo+ID4gIH0KPiA+ICAKPiA+ICtzdGF0
aWMgdm9pZCBmbHVzaF9zdWJtaXNzaW9uKHN0cnVjdCBpbnRlbF9ndCAqZ3QpCj4gPiArewo+ID4g
KyAgICAgc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lOwo+ID4gKyAgICAgZW51bSBpbnRl
bF9lbmdpbmVfaWQgaWQ7Cj4gPiArCj4gPiArICAgICBmb3JfZWFjaF9lbmdpbmUoZW5naW5lLCBn
dC0+aTkxNSwgaWQpCj4gPiArICAgICAgICAgICAgIGludGVsX2VuZ2luZV9mbHVzaF9zdWJtaXNz
aW9uKGVuZ2luZSk7Cj4gPiArfQo+ID4gKwo+ID4gIGxvbmcgaW50ZWxfZ3RfcmV0aXJlX3JlcXVl
c3RzX3RpbWVvdXQoc3RydWN0IGludGVsX2d0ICpndCwgbG9uZwo+ID4gdGltZW91dCkKPiA+ICB7
Cj4gPiAgICAgICBzdHJ1Y3QgaW50ZWxfZ3RfdGltZWxpbmVzICp0aW1lbGluZXMgPSAmZ3QtPnRp
bWVsaW5lczsKPiA+IEBAIC0zMiw2ICs0Miw4IEBAIGxvbmcgaW50ZWxfZ3RfcmV0aXJlX3JlcXVl
c3RzX3RpbWVvdXQoc3RydWN0Cj4gPiBpbnRlbF9ndCAqZ3QsIGxvbmcgdGltZW91dCkKPiA+ICAg
ICAgIGlmICh1bmxpa2VseSh0aW1lb3V0IDwgMCkpCj4gPiAgICAgICAgICAgICAgIHRpbWVvdXQg
PSAtdGltZW91dCwgaW50ZXJydXB0aWJsZSA9IGZhbHNlOwo+ID4gIAo+ID4gKyAgICAgZmx1c2hf
c3VibWlzc2lvbihndCk7IC8qIGtpY2sgdGhlIGtzb2Z0aXJxZCB0YXNrbGV0cyAqLwo+IAo+IFdv
bid0IHRoaXMgYWRkIGEgcGVyZm9ybWFuY2UgaGl0IGlmIHdlIGFyZSBkb2luZyB0aGlzIGFjcm9z
cyBhbGwKPiBlbmdpbmVzPyBJcyB0aGVyZSBhIHdheSB3ZSBjYW4gaXNvbGF0ZSB0aGlzIGEgYml0
IG1vcmU/CgpPbmUgb2YgbXkgZWFybGllciB0aG91Z2h0cyB3YXMgdG8gdXNlIHJlcXVlc3QtPmVu
Z2luZSBqdXN0IGJlZm9yZSB0aGUKd2FpdCwgYnV0IHRoYXQgZGVwZW5kcyBvbiBhY3R1YWxseSBo
aXR0aW5nIHRoZSB3YWl0IGFuZCBzbyBpcyBhIGJpdAp3ZWFrZXIgdGhhbiBhbHdheXMgZmx1c2hp
bmcuCi1DaHJpcwpfX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
XwpJbnRlbC1nZnggbWFpbGluZyBsaXN0CkludGVsLWdmeEBsaXN0cy5mcmVlZGVza3RvcC5vcmcK
aHR0cHM6Ly9saXN0cy5mcmVlZGVza3RvcC5vcmcvbWFpbG1hbi9saXN0aW5mby9pbnRlbC1nZng=

Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 732BF85C5F
	for <lists+intel-gfx@lfdr.de>; Thu,  8 Aug 2019 10:03:19 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 081086E7E3;
	Thu,  8 Aug 2019 08:03:16 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from fireflyinternet.com (mail.fireflyinternet.com [109.228.58.192])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 320116E7DF
 for <intel-gfx@lists.freedesktop.org>; Thu,  8 Aug 2019 08:03:14 +0000 (UTC)
X-Default-Received-SPF: pass (skip=forwardok (res=PASS))
 x-ip-name=78.156.65.138; 
Received: from haswell.alporthouse.com (unverified [78.156.65.138]) 
 by fireflyinternet.com (Firefly Internet (M1)) with ESMTP id 17926047-1500050 
 for multiple; Thu, 08 Aug 2019 08:42:10 +0100
From: Chris Wilson <chris@chris-wilson.co.uk>
To: intel-gfx@lists.freedesktop.org
Date: Thu,  8 Aug 2019 08:41:53 +0100
Message-Id: <20190808074207.18274-5-chris@chris-wilson.co.uk>
X-Mailer: git-send-email 2.23.0.rc1
In-Reply-To: <20190808074207.18274-1-chris@chris-wilson.co.uk>
References: <20190808074207.18274-1-chris@chris-wilson.co.uk>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH 05/19] drm/i915/selftests: Pass intel_context to
 mock_request
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

TW9kZXJuaXNlIHRoZSBtb2NrX3JlcXVlc3QgZmFjdG9yeSB0byB0YWtlIGludGVsX2NvbnRleHQg
bm90IGEgKEdFTQpjb250ZXh0LCBpbnRlbF9lbmdpbmVfY3MpIHR1cGxlLgoKU2lnbmVkLW9mZi1i
eTogQ2hyaXMgV2lsc29uIDxjaHJpc0BjaHJpcy13aWxzb24uY28udWs+Ci0tLQogZHJpdmVycy9n
cHUvZHJtL2k5MTUvc2VsZnRlc3RzL2k5MTVfcmVxdWVzdC5jIHwgMzggKysrKysrKysrKystLS0t
LS0tLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvc2VsZnRlc3RzL21vY2tfcmVxdWVzdC5jIHwgIDYg
Ky0tCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMvbW9ja19yZXF1ZXN0LmggfCAgNCAr
LQogMyBmaWxlcyBjaGFuZ2VkLCAyNSBpbnNlcnRpb25zKCspLCAyMyBkZWxldGlvbnMoLSkKCmRp
ZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMvaTkxNV9yZXF1ZXN0LmMg
Yi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMvaTkxNV9yZXF1ZXN0LmMKaW5kZXggODZj
Mjk5NjYzOTM0Li4yZTBmZDcwMWJjYTcgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1
L3NlbGZ0ZXN0cy9pOTE1X3JlcXVlc3QuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9zZWxm
dGVzdHMvaTkxNV9yZXF1ZXN0LmMKQEAgLTQ2LDkgKzQ2LDcgQEAgc3RhdGljIGludCBpZ3RfYWRk
X3JlcXVlc3Qodm9pZCAqYXJnKQogCS8qIEJhc2ljIHByZWxpbWluYXJ5IHRlc3QgdG8gY3JlYXRl
IGEgcmVxdWVzdCBhbmQgbGV0IGl0IGxvb3NlISAqLwogCiAJbXV0ZXhfbG9jaygmaTkxNS0+ZHJt
LnN0cnVjdF9tdXRleCk7Ci0JcmVxdWVzdCA9IG1vY2tfcmVxdWVzdChpOTE1LT5lbmdpbmVbUkNT
MF0sCi0JCQkgICAgICAgaTkxNS0+a2VybmVsX2NvbnRleHQsCi0JCQkgICAgICAgSFogLyAxMCk7
CisJcmVxdWVzdCA9IG1vY2tfcmVxdWVzdChpOTE1LT5lbmdpbmVbUkNTMF0tPmtlcm5lbF9jb250
ZXh0LCBIWiAvIDEwKTsKIAlpZiAoIXJlcXVlc3QpCiAJCWdvdG8gb3V0X3VubG9jazsKIApAQCAt
NzAsNyArNjgsNyBAQCBzdGF0aWMgaW50IGlndF93YWl0X3JlcXVlc3Qodm9pZCAqYXJnKQogCS8q
IFN1Ym1pdCBhIHJlcXVlc3QsIHRoZW4gd2FpdCB1cG9uIGl0ICovCiAKIAltdXRleF9sb2NrKCZp
OTE1LT5kcm0uc3RydWN0X211dGV4KTsKLQlyZXF1ZXN0ID0gbW9ja19yZXF1ZXN0KGk5MTUtPmVu
Z2luZVtSQ1MwXSwgaTkxNS0+a2VybmVsX2NvbnRleHQsIFQpOworCXJlcXVlc3QgPSBtb2NrX3Jl
cXVlc3QoaTkxNS0+ZW5naW5lW1JDUzBdLT5rZXJuZWxfY29udGV4dCwgVCk7CiAJaWYgKCFyZXF1
ZXN0KSB7CiAJCWVyciA9IC1FTk9NRU07CiAJCWdvdG8gb3V0X3VubG9jazsKQEAgLTE0Myw3ICsx
NDEsNyBAQCBzdGF0aWMgaW50IGlndF9mZW5jZV93YWl0KHZvaWQgKmFyZykKIAkvKiBTdWJtaXQg
YSByZXF1ZXN0LCB0cmVhdCBpdCBhcyBhIGZlbmNlIGFuZCB3YWl0IHVwb24gaXQgKi8KIAogCW11
dGV4X2xvY2soJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwotCXJlcXVlc3QgPSBtb2NrX3JlcXVl
c3QoaTkxNS0+ZW5naW5lW1JDUzBdLCBpOTE1LT5rZXJuZWxfY29udGV4dCwgVCk7CisJcmVxdWVz
dCA9IG1vY2tfcmVxdWVzdChpOTE1LT5lbmdpbmVbUkNTMF0tPmtlcm5lbF9jb250ZXh0LCBUKTsK
IAlpZiAoIXJlcXVlc3QpIHsKIAkJZXJyID0gLUVOT01FTTsKIAkJZ290byBvdXRfbG9ja2VkOwpA
QCAtMTk2LDExICsxOTQsMTUgQEAgc3RhdGljIGludCBpZ3RfcmVxdWVzdF9yZXdpbmQodm9pZCAq
YXJnKQogCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0gYXJnOwogCXN0cnVjdCBpOTE1
X3JlcXVlc3QgKnJlcXVlc3QsICp2aXA7CiAJc3RydWN0IGk5MTVfZ2VtX2NvbnRleHQgKmN0eFsy
XTsKKwlzdHJ1Y3QgaW50ZWxfY29udGV4dCAqY2U7CiAJaW50IGVyciA9IC1FSU5WQUw7CiAKIAlt
dXRleF9sb2NrKCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsKIAljdHhbMF0gPSBtb2NrX2NvbnRl
eHQoaTkxNSwgIkEiKTsKLQlyZXF1ZXN0ID0gbW9ja19yZXF1ZXN0KGk5MTUtPmVuZ2luZVtSQ1Mw
XSwgY3R4WzBdLCAyICogSFopOworCWNlID0gaTkxNV9nZW1fY29udGV4dF9nZXRfZW5naW5lKGN0
eFswXSwgUkNTMCk7CisJR0VNX0JVR19PTihJU19FUlIoY2UpKTsKKwlyZXF1ZXN0ID0gbW9ja19y
ZXF1ZXN0KGNlLCAyICogSFopOworCWludGVsX2NvbnRleHRfcHV0KGNlKTsKIAlpZiAoIXJlcXVl
c3QpIHsKIAkJZXJyID0gLUVOT01FTTsKIAkJZ290byBlcnJfY29udGV4dF8wOwpAQCAtMjEwLDcg
KzIxMiwxMCBAQCBzdGF0aWMgaW50IGlndF9yZXF1ZXN0X3Jld2luZCh2b2lkICphcmcpCiAJaTkx
NV9yZXF1ZXN0X2FkZChyZXF1ZXN0KTsKIAogCWN0eFsxXSA9IG1vY2tfY29udGV4dChpOTE1LCAi
QiIpOwotCXZpcCA9IG1vY2tfcmVxdWVzdChpOTE1LT5lbmdpbmVbUkNTMF0sIGN0eFsxXSwgMCk7
CisJY2UgPSBpOTE1X2dlbV9jb250ZXh0X2dldF9lbmdpbmUoY3R4WzFdLCBSQ1MwKTsKKwlHRU1f
QlVHX09OKElTX0VSUihjZSkpOworCXZpcCA9IG1vY2tfcmVxdWVzdChjZSwgMCk7CisJaW50ZWxf
Y29udGV4dF9wdXQoY2UpOwogCWlmICghdmlwKSB7CiAJCWVyciA9IC1FTk9NRU07CiAJCWdvdG8g
ZXJyX2NvbnRleHRfMTsKQEAgLTI1OSwyMiArMjY0LDE5IEBAIHN0cnVjdCBzbW9rZXRlc3Qgewog
CXN0cnVjdCBpOTE1X2dlbV9jb250ZXh0ICoqY29udGV4dHM7CiAJYXRvbWljX2xvbmdfdCBudW1f
d2FpdHMsIG51bV9mZW5jZXM7CiAJaW50IG5jb250ZXh0cywgbWF4X2JhdGNoOwotCXN0cnVjdCBp
OTE1X3JlcXVlc3QgKigqcmVxdWVzdF9hbGxvYykoc3RydWN0IGk5MTVfZ2VtX2NvbnRleHQgKiwK
LQkJCQkJICAgICAgc3RydWN0IGludGVsX2VuZ2luZV9jcyAqKTsKKwlzdHJ1Y3QgaTkxNV9yZXF1
ZXN0ICooKnJlcXVlc3RfYWxsb2MpKHN0cnVjdCBpbnRlbF9jb250ZXh0ICpjZSk7CiB9OwogCiBz
dGF0aWMgc3RydWN0IGk5MTVfcmVxdWVzdCAqCi1fX21vY2tfcmVxdWVzdF9hbGxvYyhzdHJ1Y3Qg
aTkxNV9nZW1fY29udGV4dCAqY3R4LAotCQkgICAgIHN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVu
Z2luZSkKK19fbW9ja19yZXF1ZXN0X2FsbG9jKHN0cnVjdCBpbnRlbF9jb250ZXh0ICpjZSkKIHsK
LQlyZXR1cm4gbW9ja19yZXF1ZXN0KGVuZ2luZSwgY3R4LCAwKTsKKwlyZXR1cm4gbW9ja19yZXF1
ZXN0KGNlLCAwKTsKIH0KIAogc3RhdGljIHN0cnVjdCBpOTE1X3JlcXVlc3QgKgotX19saXZlX3Jl
cXVlc3RfYWxsb2Moc3RydWN0IGk5MTVfZ2VtX2NvbnRleHQgKmN0eCwKLQkJICAgICBzdHJ1Y3Qg
aW50ZWxfZW5naW5lX2NzICplbmdpbmUpCitfX2xpdmVfcmVxdWVzdF9hbGxvYyhzdHJ1Y3QgaW50
ZWxfY29udGV4dCAqY2UpCiB7Ci0JcmV0dXJuIGlndF9yZXF1ZXN0X2FsbG9jKGN0eCwgZW5naW5l
KTsKKwlyZXR1cm4gaW50ZWxfY29udGV4dF9jcmVhdGVfcmVxdWVzdChjZSk7CiB9CiAKIHN0YXRp
YyBpbnQgX19pZ3RfYnJlYWRjcnVtYnNfc21va2V0ZXN0KHZvaWQgKmFyZykKQEAgLTMzMywxMCAr
MzM1LDE0IEBAIHN0YXRpYyBpbnQgX19pZ3RfYnJlYWRjcnVtYnNfc21va2V0ZXN0KHZvaWQgKmFy
ZykKIAkJCXN0cnVjdCBpOTE1X2dlbV9jb250ZXh0ICpjdHggPQogCQkJCXQtPmNvbnRleHRzW29y
ZGVyW25dICUgdC0+bmNvbnRleHRzXTsKIAkJCXN0cnVjdCBpOTE1X3JlcXVlc3QgKnJxOworCQkJ
c3RydWN0IGludGVsX2NvbnRleHQgKmNlOwogCiAJCQltdXRleF9sb2NrKEJLTCk7CiAKLQkJCXJx
ID0gdC0+cmVxdWVzdF9hbGxvYyhjdHgsIHQtPmVuZ2luZSk7CisJCQljZSA9IGk5MTVfZ2VtX2Nv
bnRleHRfZ2V0X2VuZ2luZShjdHgsIHQtPmVuZ2luZS0+aWQpOworCQkJR0VNX0JVR19PTihJU19F
UlIoY2UpKTsKKwkJCXJxID0gdC0+cmVxdWVzdF9hbGxvYyhjZSk7CisJCQlpbnRlbF9jb250ZXh0
X3B1dChjZSk7CiAJCQlpZiAoSVNfRVJSKHJxKSkgewogCQkJCW11dGV4X3VubG9jayhCS0wpOwog
CQkJCWVyciA9IFBUUl9FUlIocnEpOwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUv
c2VsZnRlc3RzL21vY2tfcmVxdWVzdC5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvc2VsZnRlc3Rz
L21vY2tfcmVxdWVzdC5jCmluZGV4IDkzOTBmYzA5OTg0Yi4uMDlmNzQ3MjI4ZGZmIDEwMDY0NAot
LS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMvbW9ja19yZXF1ZXN0LmMKKysrIGIv
ZHJpdmVycy9ncHUvZHJtL2k5MTUvc2VsZnRlc3RzL21vY2tfcmVxdWVzdC5jCkBAIC0yOCwxNCAr
MjgsMTIgQEAKICNpbmNsdWRlICJtb2NrX3JlcXVlc3QuaCIKIAogc3RydWN0IGk5MTVfcmVxdWVz
dCAqCi1tb2NrX3JlcXVlc3Qoc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lLAotCSAgICAg
c3RydWN0IGk5MTVfZ2VtX2NvbnRleHQgKmNvbnRleHQsCi0JICAgICB1bnNpZ25lZCBsb25nIGRl
bGF5KQorbW9ja19yZXF1ZXN0KHN0cnVjdCBpbnRlbF9jb250ZXh0ICpjZSwgdW5zaWduZWQgbG9u
ZyBkZWxheSkKIHsKIAlzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpyZXF1ZXN0OwogCiAJLyogTkIgdGhl
IGk5MTUtPnJlcXVlc3RzIHNsYWIgY2FjaGUgaXMgZW5sYXJnZWQgdG8gZml0IG1vY2tfcmVxdWVz
dCAqLwotCXJlcXVlc3QgPSBpZ3RfcmVxdWVzdF9hbGxvYyhjb250ZXh0LCBlbmdpbmUpOworCXJl
cXVlc3QgPSBpbnRlbF9jb250ZXh0X2NyZWF0ZV9yZXF1ZXN0KGNlKTsKIAlpZiAoSVNfRVJSKHJl
cXVlc3QpKQogCQlyZXR1cm4gTlVMTDsKIApkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5
MTUvc2VsZnRlc3RzL21vY2tfcmVxdWVzdC5oIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvc2VsZnRl
c3RzL21vY2tfcmVxdWVzdC5oCmluZGV4IDRhY2YwMjExZGYyMC4uODkwN2I2MGMyOTBkIDEwMDY0
NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMvbW9ja19yZXF1ZXN0LmgKKysr
IGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvc2VsZnRlc3RzL21vY2tfcmVxdWVzdC5oCkBAIC0zMCw5
ICszMCw3IEBACiAjaW5jbHVkZSAiLi4vaTkxNV9yZXF1ZXN0LmgiCiAKIHN0cnVjdCBpOTE1X3Jl
cXVlc3QgKgotbW9ja19yZXF1ZXN0KHN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZSwKLQkg
ICAgIHN0cnVjdCBpOTE1X2dlbV9jb250ZXh0ICpjb250ZXh0LAotCSAgICAgdW5zaWduZWQgbG9u
ZyBkZWxheSk7Cittb2NrX3JlcXVlc3Qoc3RydWN0IGludGVsX2NvbnRleHQgKmNlLCB1bnNpZ25l
ZCBsb25nIGRlbGF5KTsKIAogYm9vbCBtb2NrX2NhbmNlbF9yZXF1ZXN0KHN0cnVjdCBpOTE1X3Jl
cXVlc3QgKnJlcXVlc3QpOwogCi0tIAoyLjIzLjAucmMxCgpfX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fXwpJbnRlbC1nZnggbWFpbGluZyBsaXN0CkludGVsLWdm
eEBsaXN0cy5mcmVlZGVza3RvcC5vcmcKaHR0cHM6Ly9saXN0cy5mcmVlZGVza3RvcC5vcmcvbWFp
bG1hbi9saXN0aW5mby9pbnRlbC1nZng=

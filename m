Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 233D8A4E20
	for <lists+intel-gfx@lfdr.de>; Mon,  2 Sep 2019 06:03:40 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 26B7E89AD2;
	Mon,  2 Sep 2019 04:03:28 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from fireflyinternet.com (mail.fireflyinternet.com [109.228.58.192])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 2DA4889AB9
 for <intel-gfx@lists.freedesktop.org>; Mon,  2 Sep 2019 04:03:25 +0000 (UTC)
X-Default-Received-SPF: pass (skip=forwardok (res=PASS))
 x-ip-name=78.156.65.138; 
Received: from haswell.alporthouse.com (unverified [78.156.65.138]) 
 by fireflyinternet.com (Firefly Internet (M1)) with ESMTP id 18339018-1500050 
 for multiple; Mon, 02 Sep 2019 05:03:07 +0100
From: Chris Wilson <chris@chris-wilson.co.uk>
To: intel-gfx@lists.freedesktop.org
Date: Mon,  2 Sep 2019 05:02:55 +0100
Message-Id: <20190902040303.14195-13-chris@chris-wilson.co.uk>
X-Mailer: git-send-email 2.23.0
In-Reply-To: <20190902040303.14195-1-chris@chris-wilson.co.uk>
References: <20190902040303.14195-1-chris@chris-wilson.co.uk>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH 13/21] drm/i915: Pull i915_vma_pin under the
 vm->mutex
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

UmVwbGFjZSB0aGUgc3RydWN0X211dGV4IHJlcXVpcmVtZW50IGZvciBwaW5uaW5nIHRoZSBpOTE1
X3ZtYSB3aXRoIHRoZQpsb2NhbCB2bS0+bXV0ZXggaW5zdGVhZC4gTm90ZSB0aGF0IHRoZSB2bS0+
bXV0ZXggaXMgdGFpbnRlZCBieSB0aGUKc2hyaW5rZXIgKHdlIHJlcXVpcmUgdW5iaW5kaW5nIGZy
b20gaW5zaWRlIGZzLXJlY2xhaW0pIGFuZCBzbyB3ZSBjYW5ub3QKYWxsb2NhdGUgd2hpbGUgaG9s
ZGluZyB0aGF0IG11dGV4LiBJbnN0ZWFkIHdlIGhhdmUgdG8gcHJlYWxsb2NhdGUKd29ya2VycyB0
byBkbyBhbGxvY2F0ZSBhbmQgYXBwbHkgdGhlIFBURSB1cGRhdGVzIGFmdGVyIHdlIGhhdmUgd2UK
cmVzZXJ2ZWQgdGhlaXIgc2xvdCBpbiB0aGUgZHJtX21tICh1c2luZyBmZW5jZXMgdG8gb3JkZXIg
dGhlIFBURSB3cml0ZXMKd2l0aCB0aGUgR1BVIHdvcmsgYW5kIHdpdGggbGF0ZXIgdW5iaW5kKS4K
ClNpZ25lZC1vZmYtYnk6IENocmlzIFdpbHNvbiA8Y2hyaXNAY2hyaXMtd2lsc29uLmNvLnVrPgot
LS0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZGlzcGxheS5jICB8ICAyOSAr
LQogZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9mYmRldi5jICAgIHwgICA4ICst
CiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX292ZXJsYXkuYyAgfCAgMTEgKy0K
IC4uLi9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX2NsaWVudF9ibHQuYyAgICB8ICAxMyArLQog
ZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX2NvbnRleHQuYyAgIHwgIDIwICstCiBk
cml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fZG9tYWluLmMgICAgfCAgMTkgKy0KIC4u
Li9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX2V4ZWNidWZmZXIuYyAgICB8ICA0OCArLQogZHJp
dmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX21tYW4uYyAgICAgIHwgIDI0ICstCiBkcml2
ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fb2JqZWN0LmMgICAgfCAgMzMgKy0KIGRyaXZl
cnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9vYmplY3QuaCAgICB8ICAgNSArCiBkcml2ZXJz
L2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fc2hyaW5rZXIuYyAgfCAgNzEgKy0tCiBkcml2ZXJz
L2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fc3RvbGVuLmMgICAgfCAgIDggKy0KIGRyaXZlcnMv
Z3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV90aWxpbmcuYyAgICB8ICAxNSArLQogZHJpdmVycy9n
cHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX3VzZXJwdHIuYyAgIHwgIDI3ICstCiAuLi4vZ3B1L2Ry
bS9pOTE1L2dlbS9zZWxmdGVzdHMvaHVnZV9wYWdlcy5jICAgfCAgMjMgKy0KIC4uLi9kcm0vaTkx
NS9nZW0vc2VsZnRlc3RzL2k5MTVfZ2VtX2NvbnRleHQuYyB8ICAxMiArLQogLi4uL2RybS9pOTE1
L2dlbS9zZWxmdGVzdHMvaTkxNV9nZW1fbW1hbi5jICAgIHwgICAyIC0KIC4uLi9kcm0vaTkxNS9n
ZW0vc2VsZnRlc3RzL2lndF9nZW1fdXRpbHMuYyAgICB8ICAgNyArLQogZHJpdmVycy9ncHUvZHJt
L2k5MTUvZ3QvaW50ZWxfZ3QuYyAgICAgICAgICAgIHwgICA1ICstCiBkcml2ZXJzL2dwdS9kcm0v
aTkxNS9ndC9pbnRlbF9yaW5nYnVmZmVyLmMgICAgfCAgIDQgKy0KIGRyaXZlcnMvZ3B1L2RybS9p
OTE1L2d0L3NlbGZ0ZXN0X2hhbmdjaGVjay5jICB8ICAxOSArLQogZHJpdmVycy9ncHUvZHJtL2k5
MTUvZ3Z0L2FwZXJ0dXJlX2dtLmMgICAgICAgIHwgIDEyICstCiBkcml2ZXJzL2dwdS9kcm0vaTkx
NS9pOTE1X2FjdGl2ZS5jICAgICAgICAgICAgfCAgOTQgKysrLQogZHJpdmVycy9ncHUvZHJtL2k5
MTUvaTkxNV9hY3RpdmUuaCAgICAgICAgICAgIHwgICA3ICsKIGRyaXZlcnMvZ3B1L2RybS9pOTE1
L2k5MTVfYWN0aXZlX3R5cGVzLmggICAgICB8ICAgNSArCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9p
OTE1X2dlbS5jICAgICAgICAgICAgICAgfCAgOTQgKystLQogZHJpdmVycy9ncHUvZHJtL2k5MTUv
aTkxNV9nZW1fZXZpY3QuYyAgICAgICAgIHwgIDIwICstCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9p
OTE1X2dlbV9mZW5jZV9yZWcuYyAgICAgfCAgIDUgKy0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2k5
MTVfZ2VtX2d0dC5jICAgICAgICAgICB8IDEwNCArKy0tCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9p
OTE1X2dlbV9ndHQuaCAgICAgICAgICAgfCAgMzggKy0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2k5
MTVfcGVyZi5jICAgICAgICAgICAgICB8ICAzMiArLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkx
NV92bWEuYyAgICAgICAgICAgICAgIHwgNDc2ICsrKysrKysrKysrKy0tLS0tLQogZHJpdmVycy9n
cHUvZHJtL2k5MTUvaTkxNV92bWEuaCAgICAgICAgICAgICAgIHwgIDc1ICsrLQogLi4uL2dwdS9k
cm0vaTkxNS9zZWxmdGVzdHMvaTkxNV9nZW1fZXZpY3QuYyAgIHwgIDM2ICstCiBkcml2ZXJzL2dw
dS9kcm0vaTkxNS9zZWxmdGVzdHMvaTkxNV9nZW1fZ3R0LmMgfCAgOTEgKystLQogZHJpdmVycy9n
cHUvZHJtL2k5MTUvc2VsZnRlc3RzL2k5MTVfdm1hLmMgICAgIHwgICA4ICstCiAzNiBmaWxlcyBj
aGFuZ2VkLCA4MTggaW5zZXJ0aW9ucygrKSwgNjgyIGRlbGV0aW9ucygtKQoKZGlmZiAtLWdpdCBh
L2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZGlzcGxheS5jIGIvZHJpdmVycy9n
cHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kaXNwbGF5LmMKaW5kZXggNWUzYjIyZTNmNjFkLi44
MWMwZDdhMzVjNGMgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50
ZWxfZGlzcGxheS5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZGlz
cGxheS5jCkBAIC0yMDc5LDcgKzIwNzksNiBAQCBpbnRlbF9waW5fYW5kX2ZlbmNlX2ZiX29iaihz
dHJ1Y3QgZHJtX2ZyYW1lYnVmZmVyICpmYiwKIAl1bnNpZ25lZCBpbnQgcGluY3RsOwogCXUzMiBh
bGlnbm1lbnQ7CiAKLQlXQVJOX09OKCFtdXRleF9pc19sb2NrZWQoJmRldi0+c3RydWN0X211dGV4
KSk7CiAJaWYgKFdBUk5fT04oIWk5MTVfZ2VtX29iamVjdF9pc19mcmFtZWJ1ZmZlcihvYmopKSkK
IAkJcmV0dXJuIEVSUl9QVFIoLUVJTlZBTCk7CiAKQEAgLTIxNjMsOCArMjE2Miw2IEBAIGludGVs
X3Bpbl9hbmRfZmVuY2VfZmJfb2JqKHN0cnVjdCBkcm1fZnJhbWVidWZmZXIgKmZiLAogCiB2b2lk
IGludGVsX3VucGluX2ZiX3ZtYShzdHJ1Y3QgaTkxNV92bWEgKnZtYSwgdW5zaWduZWQgbG9uZyBm
bGFncykKIHsKLQlsb2NrZGVwX2Fzc2VydF9oZWxkKCZ2bWEtPnZtLT5pOTE1LT5kcm0uc3RydWN0
X211dGV4KTsKLQogCWk5MTVfZ2VtX29iamVjdF9sb2NrKHZtYS0+b2JqKTsKIAlpZiAoZmxhZ3Mg
JiBQTEFORV9IQVNfRkVOQ0UpCiAJCWk5MTVfdm1hX3VucGluX2ZlbmNlKHZtYSk7CkBAIC0zMDY1
LDEyICszMDYyLDEwIEBAIGludGVsX2FsbG9jX2luaXRpYWxfcGxhbmVfb2JqKHN0cnVjdCBpbnRl
bF9jcnRjICpjcnRjLAogCQlyZXR1cm4gZmFsc2U7CiAJfQogCi0JbXV0ZXhfbG9jaygmZGV2LT5z
dHJ1Y3RfbXV0ZXgpOwogCW9iaiA9IGk5MTVfZ2VtX29iamVjdF9jcmVhdGVfc3RvbGVuX2Zvcl9w
cmVhbGxvY2F0ZWQoZGV2X3ByaXYsCiAJCQkJCQkJICAgICBiYXNlX2FsaWduZWQsCiAJCQkJCQkJ
ICAgICBiYXNlX2FsaWduZWQsCiAJCQkJCQkJICAgICBzaXplX2FsaWduZWQpOwotCW11dGV4X3Vu
bG9jaygmZGV2LT5zdHJ1Y3RfbXV0ZXgpOwogCWlmICghb2JqKQogCQlyZXR1cm4gZmFsc2U7CiAK
QEAgLTMyMzIsMTMgKzMyMjcsMTEgQEAgaW50ZWxfZmluZF9pbml0aWFsX3BsYW5lX29iaihzdHJ1
Y3QgaW50ZWxfY3J0YyAqaW50ZWxfY3J0YywKIAlpbnRlbF9zdGF0ZS0+Y29sb3JfcGxhbmVbMF0u
c3RyaWRlID0KIAkJaW50ZWxfZmJfcGl0Y2goZmIsIDAsIGludGVsX3N0YXRlLT5iYXNlLnJvdGF0
aW9uKTsKIAotCW11dGV4X2xvY2soJmRldi0+c3RydWN0X211dGV4KTsKIAlpbnRlbF9zdGF0ZS0+
dm1hID0KIAkJaW50ZWxfcGluX2FuZF9mZW5jZV9mYl9vYmooZmIsCiAJCQkJCSAgICZpbnRlbF9z
dGF0ZS0+dmlldywKIAkJCQkJICAgaW50ZWxfcGxhbmVfdXNlc19mZW5jZShpbnRlbF9zdGF0ZSks
CiAJCQkJCSAgICZpbnRlbF9zdGF0ZS0+ZmxhZ3MpOwotCW11dGV4X3VubG9jaygmZGV2LT5zdHJ1
Y3RfbXV0ZXgpOwogCWlmIChJU19FUlIoaW50ZWxfc3RhdGUtPnZtYSkpIHsKIAkJRFJNX0VSUk9S
KCJmYWlsZWQgdG8gcGluIGJvb3QgZmIgb24gcGlwZSAlZDogJWxpXG4iLAogCQkJICBpbnRlbF9j
cnRjLT5waXBlLCBQVFJfRVJSKGludGVsX3N0YXRlLT52bWEpKTsKQEAgLTE0MzY0LDggKzE0MzU3
LDYgQEAgc3RhdGljIHZvaWQgZmJfb2JqX2J1bXBfcmVuZGVyX3ByaW9yaXR5KHN0cnVjdCBkcm1f
aTkxNV9nZW1fb2JqZWN0ICpvYmopCiAgKiBiaXRzLiAgU29tZSBvbGRlciBwbGF0Zm9ybXMgbmVl
ZCBzcGVjaWFsIHBoeXNpY2FsIGFkZHJlc3MgaGFuZGxpbmcgZm9yCiAgKiBjdXJzb3IgcGxhbmVz
LgogICoKLSAqIE11c3QgYmUgY2FsbGVkIHdpdGggc3RydWN0X211dGV4IGhlbGQuCi0gKgogICog
UmV0dXJucyAwIG9uIHN1Y2Nlc3MsIG5lZ2F0aXZlIGVycm9yIGNvZGUgb24gZmFpbHVyZS4KICAq
LwogaW50CkBAIC0xNDQyMiwxNSArMTQ0MTMsOCBAQCBpbnRlbF9wcmVwYXJlX3BsYW5lX2ZiKHN0
cnVjdCBkcm1fcGxhbmUgKnBsYW5lLAogCWlmIChyZXQpCiAJCXJldHVybiByZXQ7CiAKLQlyZXQg
PSBtdXRleF9sb2NrX2ludGVycnVwdGlibGUoJmRldl9wcml2LT5kcm0uc3RydWN0X211dGV4KTsK
LQlpZiAocmV0KSB7Ci0JCWk5MTVfZ2VtX29iamVjdF91bnBpbl9wYWdlcyhvYmopOwotCQlyZXR1
cm4gcmV0OwotCX0KLQogCXJldCA9IGludGVsX3BsYW5lX3Bpbl9mYih0b19pbnRlbF9wbGFuZV9z
dGF0ZShuZXdfc3RhdGUpKTsKIAotCW11dGV4X3VubG9jaygmZGV2X3ByaXYtPmRybS5zdHJ1Y3Rf
bXV0ZXgpOwogCWk5MTVfZ2VtX29iamVjdF91bnBpbl9wYWdlcyhvYmopOwogCWlmIChyZXQpCiAJ
CXJldHVybiByZXQ7CkBAIC0xNDQ3OSw4ICsxNDQ2Myw2IEBAIGludGVsX3ByZXBhcmVfcGxhbmVf
ZmIoc3RydWN0IGRybV9wbGFuZSAqcGxhbmUsCiAgKiBAb2xkX3N0YXRlOiB0aGUgc3RhdGUgZnJv
bSB0aGUgcHJldmlvdXMgbW9kZXNldAogICoKICAqIENsZWFucyB1cCBhIGZyYW1lYnVmZmVyIHRo
YXQgaGFzIGp1c3QgYmVlbiByZW1vdmVkIGZyb20gYSBwbGFuZS4KLSAqCi0gKiBNdXN0IGJlIGNh
bGxlZCB3aXRoIHN0cnVjdF9tdXRleCBoZWxkLgogICovCiB2b2lkCiBpbnRlbF9jbGVhbnVwX3Bs
YW5lX2ZiKHN0cnVjdCBkcm1fcGxhbmUgKnBsYW5lLApAQCAtMTQ0OTYsOSArMTQ0NzgsNyBAQCBp
bnRlbF9jbGVhbnVwX3BsYW5lX2ZiKHN0cnVjdCBkcm1fcGxhbmUgKnBsYW5lLAogCX0KIAogCS8q
IFNob3VsZCBvbmx5IGJlIGNhbGxlZCBhZnRlciBhIHN1Y2Nlc3NmdWwgaW50ZWxfcHJlcGFyZV9w
bGFuZV9mYigpISAqLwotCW11dGV4X2xvY2soJmRldl9wcml2LT5kcm0uc3RydWN0X211dGV4KTsK
IAlpbnRlbF9wbGFuZV91bnBpbl9mYih0b19pbnRlbF9wbGFuZV9zdGF0ZShvbGRfc3RhdGUpKTsK
LQltdXRleF91bmxvY2soJmRldl9wcml2LT5kcm0uc3RydWN0X211dGV4KTsKIH0KIAogaW50CkBA
IC0xNDY5OCw3ICsxNDY3OCw2IEBAIGludGVsX2xlZ2FjeV9jdXJzb3JfdXBkYXRlKHN0cnVjdCBk
cm1fcGxhbmUgKnBsYW5lLAogCQkJICAgdTMyIHNyY193LCB1MzIgc3JjX2gsCiAJCQkgICBzdHJ1
Y3QgZHJtX21vZGVzZXRfYWNxdWlyZV9jdHggKmN0eCkKIHsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJp
dmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGNydGMtPmRldik7CiAJc3RydWN0IGRybV9wbGFuZV9z
dGF0ZSAqb2xkX3BsYW5lX3N0YXRlLCAqbmV3X3BsYW5lX3N0YXRlOwogCXN0cnVjdCBpbnRlbF9w
bGFuZSAqaW50ZWxfcGxhbmUgPSB0b19pbnRlbF9wbGFuZShwbGFuZSk7CiAJc3RydWN0IGludGVs
X2NydGNfc3RhdGUgKmNydGNfc3RhdGUgPQpAQCAtMTQ3NjQsMTMgKzE0NzQzLDkgQEAgaW50ZWxf
bGVnYWN5X2N1cnNvcl91cGRhdGUoc3RydWN0IGRybV9wbGFuZSAqcGxhbmUsCiAJaWYgKHJldCkK
IAkJZ290byBvdXRfZnJlZTsKIAotCXJldCA9IG11dGV4X2xvY2tfaW50ZXJydXB0aWJsZSgmZGV2
X3ByaXYtPmRybS5zdHJ1Y3RfbXV0ZXgpOwotCWlmIChyZXQpCi0JCWdvdG8gb3V0X2ZyZWU7Ci0K
IAlyZXQgPSBpbnRlbF9wbGFuZV9waW5fZmIodG9faW50ZWxfcGxhbmVfc3RhdGUobmV3X3BsYW5l
X3N0YXRlKSk7CiAJaWYgKHJldCkKLQkJZ290byBvdXRfdW5sb2NrOworCQlnb3RvIG91dF9mcmVl
OwogCiAJaW50ZWxfZnJvbnRidWZmZXJfZmx1c2godG9faW50ZWxfZnJvbnRidWZmZXIoZmIpLCBP
UklHSU5fRkxJUCk7CiAJaW50ZWxfZnJvbnRidWZmZXJfdHJhY2sodG9faW50ZWxfZnJvbnRidWZm
ZXIob2xkX3BsYW5lX3N0YXRlLT5mYiksCkBAIC0xNDgwMCw4ICsxNDc3NSw2IEBAIGludGVsX2xl
Z2FjeV9jdXJzb3JfdXBkYXRlKHN0cnVjdCBkcm1fcGxhbmUgKnBsYW5lLAogCiAJaW50ZWxfcGxh
bmVfdW5waW5fZmIodG9faW50ZWxfcGxhbmVfc3RhdGUob2xkX3BsYW5lX3N0YXRlKSk7CiAKLW91
dF91bmxvY2s6Ci0JbXV0ZXhfdW5sb2NrKCZkZXZfcHJpdi0+ZHJtLnN0cnVjdF9tdXRleCk7CiBv
dXRfZnJlZToKIAlpZiAobmV3X2NydGNfc3RhdGUpCiAJCWludGVsX2NydGNfZGVzdHJveV9zdGF0
ZShjcnRjLCAmbmV3X2NydGNfc3RhdGUtPmJhc2UpOwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUv
ZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9mYmRldi5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlz
cGxheS9pbnRlbF9mYmRldi5jCmluZGV4IGQ1OWVlZTVjNWQ5Yy4uYTNkZWEzZjJkYWNkIDEwMDY0
NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2ZiZGV2LmMKKysrIGIv
ZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9mYmRldi5jCkBAIC0yMDQsNyArMjA0
LDYgQEAgc3RhdGljIGludCBpbnRlbGZiX2NyZWF0ZShzdHJ1Y3QgZHJtX2ZiX2hlbHBlciAqaGVs
cGVyLAogCQlzaXplcy0+ZmJfaGVpZ2h0ID0gaW50ZWxfZmItPmJhc2UuaGVpZ2h0OwogCX0KIAot
CW11dGV4X2xvY2soJmRldi0+c3RydWN0X211dGV4KTsKIAl3YWtlcmVmID0gaW50ZWxfcnVudGlt
ZV9wbV9nZXQoJmRldl9wcml2LT5ydW50aW1lX3BtKTsKIAogCS8qIFBpbiB0aGUgR0dUVCB2bWEg
Zm9yIG91ciBhY2Nlc3MgdmlhIGluZm8tPnNjcmVlbl9iYXNlLgpAQCAtMjY2LDcgKzI2NSw2IEBA
IHN0YXRpYyBpbnQgaW50ZWxmYl9jcmVhdGUoc3RydWN0IGRybV9mYl9oZWxwZXIgKmhlbHBlciwK
IAlpZmJkZXYtPnZtYV9mbGFncyA9IGZsYWdzOwogCiAJaW50ZWxfcnVudGltZV9wbV9wdXQoJmRl
dl9wcml2LT5ydW50aW1lX3BtLCB3YWtlcmVmKTsKLQltdXRleF91bmxvY2soJmRldi0+c3RydWN0
X211dGV4KTsKIAl2Z2Ffc3dpdGNoZXJvb19jbGllbnRfZmJfc2V0KHBkZXYsIGluZm8pOwogCXJl
dHVybiAwOwogCkBAIC0yNzQsNyArMjcyLDYgQEAgc3RhdGljIGludCBpbnRlbGZiX2NyZWF0ZShz
dHJ1Y3QgZHJtX2ZiX2hlbHBlciAqaGVscGVyLAogCWludGVsX3VucGluX2ZiX3ZtYSh2bWEsIGZs
YWdzKTsKIG91dF91bmxvY2s6CiAJaW50ZWxfcnVudGltZV9wbV9wdXQoJmRldl9wcml2LT5ydW50
aW1lX3BtLCB3YWtlcmVmKTsKLQltdXRleF91bmxvY2soJmRldi0+c3RydWN0X211dGV4KTsKIAly
ZXR1cm4gcmV0OwogfQogCkBAIC0yOTEsMTEgKzI4OCw4IEBAIHN0YXRpYyB2b2lkIGludGVsX2Zi
ZGV2X2Rlc3Ryb3koc3RydWN0IGludGVsX2ZiZGV2ICppZmJkZXYpCiAKIAlkcm1fZmJfaGVscGVy
X2ZpbmkoJmlmYmRldi0+aGVscGVyKTsKIAotCWlmIChpZmJkZXYtPnZtYSkgewotCQltdXRleF9s
b2NrKCZpZmJkZXYtPmhlbHBlci5kZXYtPnN0cnVjdF9tdXRleCk7CisJaWYgKGlmYmRldi0+dm1h
KQogCQlpbnRlbF91bnBpbl9mYl92bWEoaWZiZGV2LT52bWEsIGlmYmRldi0+dm1hX2ZsYWdzKTsK
LQkJbXV0ZXhfdW5sb2NrKCZpZmJkZXYtPmhlbHBlci5kZXYtPnN0cnVjdF9tdXRleCk7Ci0JfQog
CiAJaWYgKGlmYmRldi0+ZmIpCiAJCWRybV9mcmFtZWJ1ZmZlcl9yZW1vdmUoJmlmYmRldi0+ZmIt
PmJhc2UpOwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9v
dmVybGF5LmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX292ZXJsYXkuYwpp
bmRleCAyOWVkZmMzNDM3MTYuLjRmMzY1NTdiM2YzYiAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUv
ZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9vdmVybGF5LmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5
MTUvZGlzcGxheS9pbnRlbF9vdmVybGF5LmMKQEAgLTEzMDMsMTUgKzEzMDMsMTEgQEAgc3RhdGlj
IGludCBnZXRfcmVnaXN0ZXJzKHN0cnVjdCBpbnRlbF9vdmVybGF5ICpvdmVybGF5LCBib29sIHVz
ZV9waHlzKQogCXN0cnVjdCBpOTE1X3ZtYSAqdm1hOwogCWludCBlcnI7CiAKLQltdXRleF9sb2Nr
KCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsKLQogCW9iaiA9IGk5MTVfZ2VtX29iamVjdF9jcmVh
dGVfc3RvbGVuKGk5MTUsIFBBR0VfU0laRSk7CiAJaWYgKG9iaiA9PSBOVUxMKQogCQlvYmogPSBp
OTE1X2dlbV9vYmplY3RfY3JlYXRlX2ludGVybmFsKGk5MTUsIFBBR0VfU0laRSk7Ci0JaWYgKElT
X0VSUihvYmopKSB7Ci0JCWVyciA9IFBUUl9FUlIob2JqKTsKLQkJZ290byBlcnJfdW5sb2NrOwot
CX0KKwlpZiAoSVNfRVJSKG9iaikpCisJCXJldHVybiBQVFJfRVJSKG9iaik7CiAKIAl2bWEgPSBp
OTE1X2dlbV9vYmplY3RfZ2d0dF9waW4ob2JqLCBOVUxMLCAwLCAwLCBQSU5fTUFQUEFCTEUpOwog
CWlmIChJU19FUlIodm1hKSkgewpAQCAtMTMzMiwxMyArMTMyOCwxMCBAQCBzdGF0aWMgaW50IGdl
dF9yZWdpc3RlcnMoc3RydWN0IGludGVsX292ZXJsYXkgKm92ZXJsYXksIGJvb2wgdXNlX3BoeXMp
CiAJfQogCiAJb3ZlcmxheS0+cmVnX2JvID0gb2JqOwotCW11dGV4X3VubG9jaygmaTkxNS0+ZHJt
LnN0cnVjdF9tdXRleCk7CiAJcmV0dXJuIDA7CiAKIGVycl9wdXRfYm86CiAJaTkxNV9nZW1fb2Jq
ZWN0X3B1dChvYmopOwotZXJyX3VubG9jazoKLQltdXRleF91bmxvY2soJmk5MTUtPmRybS5zdHJ1
Y3RfbXV0ZXgpOwogCXJldHVybiBlcnI7CiB9CiAKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2Ry
bS9pOTE1L2dlbS9pOTE1X2dlbV9jbGllbnRfYmx0LmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9n
ZW0vaTkxNV9nZW1fY2xpZW50X2JsdC5jCmluZGV4IGY5OTkyMDY1Mjc1MS4uOWU3MmI0MmE4NmY1
IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fY2xpZW50X2Js
dC5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9jbGllbnRfYmx0LmMK
QEAgLTE1Miw2ICsxNTIsMTcgQEAgc3RhdGljIHZvaWQgY2xlYXJfcGFnZXNfZG1hX2ZlbmNlX2Ni
KHN0cnVjdCBkbWFfZmVuY2UgKmZlbmNlLAogCWlycV93b3JrX3F1ZXVlKCZ3LT5pcnFfd29yayk7
CiB9CiAKK3N0YXRpYyBpbnQgbW92ZV90b19hY3RpdmUoc3RydWN0IGk5MTVfdm1hICp2bWEsIHN0
cnVjdCBpOTE1X3JlcXVlc3QgKnJxKQoreworCWludCBlcnI7CisKKwllcnIgPSBpOTE1X3JlcXVl
c3RfYXdhaXRfYWN0aXZlKHJxLCAmdm1hLT5hY3RpdmUpOworCWlmIChlcnIpCisJCXJldHVybiBl
cnI7CisKKwlyZXR1cm4gaTkxNV9hY3RpdmVfcmVmKCZ2bWEtPmFjdGl2ZSwgcnEtPnRpbWVsaW5l
LCBycSk7Cit9CisKIHN0YXRpYyB2b2lkIGNsZWFyX3BhZ2VzX3dvcmtlcihzdHJ1Y3Qgd29ya19z
dHJ1Y3QgKndvcmspCiB7CiAJc3RydWN0IGNsZWFyX3BhZ2VzX3dvcmsgKncgPSBjb250YWluZXJf
b2Yod29yaywgdHlwZW9mKCp3KSwgd29yayk7CkBAIC0yMTEsNyArMjIyLDcgQEAgc3RhdGljIHZv
aWQgY2xlYXJfcGFnZXNfd29ya2VyKHN0cnVjdCB3b3JrX3N0cnVjdCAqd29yaykKIAkgKiBrZWVw
IHRyYWNrIG9mIHRoZSBHUFUgYWN0aXZpdHkgd2l0aGluIHRoaXMgdm1hL3JlcXVlc3QsIGFuZAog
CSAqIHByb3BhZ2F0ZSB0aGUgc2lnbmFsIGZyb20gdGhlIHJlcXVlc3QgdG8gdy0+ZG1hLgogCSAq
LwotCWVyciA9IGk5MTVfYWN0aXZlX3JlZigmdm1hLT5hY3RpdmUsIHJxLT50aW1lbGluZSwgcnEp
OworCWVyciA9IG1vdmVfdG9fYWN0aXZlKHZtYSwgcnEpOwogCWlmIChlcnIpCiAJCWdvdG8gb3V0
X3JlcXVlc3Q7CiAKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dl
bV9jb250ZXh0LmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fY29udGV4dC5j
CmluZGV4IGYxYzBlNWQ5NThmMy4uNjUzZjcyNzUzMDZhIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dw
dS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fY29udGV4dC5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9p
OTE1L2dlbS9pOTE1X2dlbV9jb250ZXh0LmMKQEAgLTMxMyw4ICszMTMsNiBAQCBzdGF0aWMgdm9p
ZCBpOTE1X2dlbV9jb250ZXh0X2ZyZWUoc3RydWN0IGk5MTVfZ2VtX2NvbnRleHQgKmN0eCkKIAlH
RU1fQlVHX09OKCFpOTE1X2dlbV9jb250ZXh0X2lzX2Nsb3NlZChjdHgpKTsKIAogCXJlbGVhc2Vf
aHdfaWQoY3R4KTsKLQlpZiAoY3R4LT52bSkKLQkJaTkxNV92bV9wdXQoY3R4LT52bSk7CiAKIAlm
cmVlX2VuZ2luZXMocmN1X2FjY2Vzc19wb2ludGVyKGN0eC0+ZW5naW5lcykpOwogCW11dGV4X2Rl
c3Ryb3koJmN0eC0+ZW5naW5lc19tdXRleCk7CkBAIC0zNzksOSArMzc3LDEzIEBAIHZvaWQgaTkx
NV9nZW1fY29udGV4dF9yZWxlYXNlKHN0cnVjdCBrcmVmICpyZWYpCiAKIHN0YXRpYyB2b2lkIGNv
bnRleHRfY2xvc2Uoc3RydWN0IGk5MTVfZ2VtX2NvbnRleHQgKmN0eCkKIHsKKwlpOTE1X2dlbV9j
b250ZXh0X3NldF9jbG9zZWQoY3R4KTsKKworCWlmIChjdHgtPnZtKQorCQlpOTE1X3ZtX2Nsb3Nl
KGN0eC0+dm0pOworCiAJbXV0ZXhfbG9jaygmY3R4LT5tdXRleCk7CiAKLQlpOTE1X2dlbV9jb250
ZXh0X3NldF9jbG9zZWQoY3R4KTsKIAljdHgtPmZpbGVfcHJpdiA9IEVSUl9QVFIoLUVCQURGKTsK
IAogCS8qCkBAIC00NzQsNyArNDc2LDcgQEAgX19zZXRfcHBndHQoc3RydWN0IGk5MTVfZ2VtX2Nv
bnRleHQgKmN0eCwgc3RydWN0IGk5MTVfYWRkcmVzc19zcGFjZSAqdm0pCiAKIAlHRU1fQlVHX09O
KG9sZCAmJiBpOTE1X3ZtX2lzXzRsdmwodm0pICE9IGk5MTVfdm1faXNfNGx2bChvbGQpKTsKIAot
CWN0eC0+dm0gPSBpOTE1X3ZtX2dldCh2bSk7CisJY3R4LT52bSA9IGk5MTVfdm1fb3Blbih2bSk7
CiAJY29udGV4dF9hcHBseV9hbGwoY3R4LCBfX2FwcGx5X3BwZ3R0LCB2bSk7CiAKIAlyZXR1cm4g
b2xkOwpAQCAtNDg4LDcgKzQ5MCw3IEBAIHN0YXRpYyB2b2lkIF9fYXNzaWduX3BwZ3R0KHN0cnVj
dCBpOTE1X2dlbV9jb250ZXh0ICpjdHgsCiAKIAl2bSA9IF9fc2V0X3BwZ3R0KGN0eCwgdm0pOwog
CWlmICh2bSkKLQkJaTkxNV92bV9wdXQodm0pOworCQlpOTE1X3ZtX2Nsb3NlKHZtKTsKIH0KIAog
c3RhdGljIHZvaWQgX19zZXRfdGltZWxpbmUoc3RydWN0IGludGVsX3RpbWVsaW5lICoqZHN0LApA
QCAtOTUzLDcgKzk1NSw3IEBAIHN0YXRpYyBpbnQgZ2V0X3BwZ3R0KHN0cnVjdCBkcm1faTkxNV9m
aWxlX3ByaXZhdGUgKmZpbGVfcHJpdiwKIAlpZiAocmV0IDwgMCkKIAkJZ290byBlcnJfdW5sb2Nr
OwogCi0JaTkxNV92bV9nZXQodm0pOworCWk5MTVfdm1fb3Blbih2bSk7CiAKIAlhcmdzLT5zaXpl
ID0gMDsKIAlhcmdzLT52YWx1ZSA9IHJldDsKQEAgLTk3Myw3ICs5NzUsNyBAQCBzdGF0aWMgdm9p
ZCBzZXRfcHBndHRfYmFycmllcih2b2lkICpkYXRhKQogCWlmIChJTlRFTF9HRU4ob2xkLT5pOTE1
KSA8IDgpCiAJCWdlbjZfcHBndHRfdW5waW5fYWxsKGk5MTVfdm1fdG9fcHBndHQob2xkKSk7CiAK
LQlpOTE1X3ZtX3B1dChvbGQpOworCWk5MTVfdm1fY2xvc2Uob2xkKTsKIH0KIAogc3RhdGljIGlu
dCBlbWl0X3BwZ3R0X3VwZGF0ZShzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpycSwgdm9pZCAqZGF0YSkK
QEAgLTEwOTAsOCArMTA5Miw4IEBAIHN0YXRpYyBpbnQgc2V0X3BwZ3R0KHN0cnVjdCBkcm1faTkx
NV9maWxlX3ByaXZhdGUgKmZpbGVfcHJpdiwKIAkJCQkgICBzZXRfcHBndHRfYmFycmllciwKIAkJ
CQkgICBvbGQpOwogCWlmIChlcnIpIHsKLQkJaTkxNV92bV9wdXQoX19zZXRfcHBndHQoY3R4LCBv
bGQpKTsKLQkJaTkxNV92bV9wdXQob2xkKTsKKwkJaTkxNV92bV9jbG9zZShfX3NldF9wcGd0dChj
dHgsIG9sZCkpOworCQlpOTE1X3ZtX2Nsb3NlKG9sZCk7CiAJfQogCiB1bmxvY2s6CmRpZmYgLS1n
aXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fZG9tYWluLmMgYi9kcml2ZXJz
L2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fZG9tYWluLmMKaW5kZXggZjBjNDM3YjZlOTk1Li40
NmEyMzQwOWUxYzAgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dl
bV9kb21haW4uYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fZG9tYWlu
LmMKQEAgLTIwMiw3ICsyMDIsMTEgQEAgaW50IGk5MTVfZ2VtX29iamVjdF9zZXRfY2FjaGVfbGV2
ZWwoc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iaiwKIAkJICAgIGk5MTVfZ2VtX3ZhbGlk
X2d0dF9zcGFjZSh2bWEsIGNhY2hlX2xldmVsKSkKIAkJCWNvbnRpbnVlOwogCi0JCXJldCA9IGk5
MTVfdm1hX3VuYmluZCh2bWEpOworCQlyZXQgPSBtdXRleF9sb2NrX2ludGVycnVwdGlibGUoJnZt
YS0+dm0tPm11dGV4KTsKKwkJaWYgKCFyZXQpIHsKKwkJCXJldCA9IGk5MTVfdm1hX3VuYmluZCh2
bWEpOworCQkJbXV0ZXhfdW5sb2NrKCZ2bWEtPnZtLT5tdXRleCk7CisJCX0KIAkJaWYgKHJldCkK
IAkJCXJldHVybiByZXQ7CiAKQEAgLTI4OCw3ICsyOTIsMTIgQEAgaW50IGk5MTVfZ2VtX29iamVj
dF9zZXRfY2FjaGVfbGV2ZWwoc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iaiwKIAkJCWlm
ICghZHJtX21tX25vZGVfYWxsb2NhdGVkKCZ2bWEtPm5vZGUpKQogCQkJCWNvbnRpbnVlOwogCi0J
CQlyZXQgPSBpOTE1X3ZtYV9iaW5kKHZtYSwgY2FjaGVfbGV2ZWwsIFBJTl9VUERBVEUpOworCQkJ
LyogV2FpdCBmb3IgYW4gZWFybGllciBhc3luYyBiaW5kICovCisJCQlyZXQgPSBpOTE1X2FjdGl2
ZV93YWl0KCZ2bWEtPmFjdGl2ZSk7CisJCQlpZiAocmV0KQorCQkJCXJldHVybiByZXQ7CisKKwkJ
CXJldCA9IGk5MTVfdm1hX2JpbmQodm1hLCBjYWNoZV9sZXZlbCwgUElOX1VQREFURSwgTlVMTCk7
CiAJCQlpZiAocmV0KQogCQkJCXJldHVybiByZXQ7CiAJCX0KQEAgLTM4OSwxNiArMzk4LDExIEBA
IGludCBpOTE1X2dlbV9zZXRfY2FjaGluZ19pb2N0bChzdHJ1Y3QgZHJtX2RldmljZSAqZGV2LCB2
b2lkICpkYXRhLAogCWlmIChyZXQpCiAJCWdvdG8gb3V0OwogCi0JcmV0ID0gbXV0ZXhfbG9ja19p
bnRlcnJ1cHRpYmxlKCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsKLQlpZiAocmV0KQotCQlnb3Rv
IG91dDsKLQogCXJldCA9IGk5MTVfZ2VtX29iamVjdF9sb2NrX2ludGVycnVwdGlibGUob2JqKTsK
IAlpZiAocmV0ID09IDApIHsKIAkJcmV0ID0gaTkxNV9nZW1fb2JqZWN0X3NldF9jYWNoZV9sZXZl
bChvYmosIGxldmVsKTsKIAkJaTkxNV9nZW1fb2JqZWN0X3VubG9jayhvYmopOwogCX0KLQltdXRl
eF91bmxvY2soJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwogCiBvdXQ6CiAJaTkxNV9nZW1fb2Jq
ZWN0X3B1dChvYmopOwpAQCAtNDgzLDYgKzQ4Nyw3IEBAIHN0YXRpYyB2b2lkIGk5MTVfZ2VtX29i
amVjdF9idW1wX2luYWN0aXZlX2dndHQoc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iaikK
IAkJaWYgKCFkcm1fbW1fbm9kZV9hbGxvY2F0ZWQoJnZtYS0+bm9kZSkpCiAJCQljb250aW51ZTsK
IAorCQlHRU1fQlVHX09OKHZtYS0+dm0gIT0gJmk5MTUtPmdndHQudm0pOwogCQlsaXN0X21vdmVf
dGFpbCgmdm1hLT52bV9saW5rLCAmdm1hLT52bS0+Ym91bmRfbGlzdCk7CiAJfQogCW11dGV4X3Vu
bG9jaygmaTkxNS0+Z2d0dC52bS5tdXRleCk7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0v
aTkxNS9nZW0vaTkxNV9nZW1fZXhlY2J1ZmZlci5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2Vt
L2k5MTVfZ2VtX2V4ZWNidWZmZXIuYwppbmRleCBjMDQ5MTk5YTFkZjUuLmMzZGQ4Y2U3ZTJiNyAx
MDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX2V4ZWNidWZmZXIu
YworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fZXhlY2J1ZmZlci5jCkBA
IC01NTAsOCArNTUwLDExIEBAIGViX2FkZF92bWEoc3RydWN0IGk5MTVfZXhlY2J1ZmZlciAqZWIs
CiAJCWViX3VucmVzZXJ2ZV92bWEodm1hLCB2bWEtPmV4ZWNfZmxhZ3MpOwogCiAJCWxpc3RfYWRk
X3RhaWwoJnZtYS0+ZXhlY19saW5rLCAmZWItPnVuYm91bmQpOwotCQlpZiAoZHJtX21tX25vZGVf
YWxsb2NhdGVkKCZ2bWEtPm5vZGUpKQorCQlpZiAoZHJtX21tX25vZGVfYWxsb2NhdGVkKCZ2bWEt
Pm5vZGUpKSB7CisJCQltdXRleF9sb2NrKCZ2bWEtPnZtLT5tdXRleCk7CiAJCQllcnIgPSBpOTE1
X3ZtYV91bmJpbmQodm1hKTsKKwkJCW11dGV4X3VubG9jaygmdm1hLT52bS0+bXV0ZXgpOworCQl9
CiAJCWlmICh1bmxpa2VseShlcnIpKQogCQkJdm1hLT5leGVjX2ZsYWdzID0gTlVMTDsKIAl9CkBA
IC02OTgsNyArNzAxLDkgQEAgc3RhdGljIGludCBlYl9yZXNlcnZlKHN0cnVjdCBpOTE1X2V4ZWNi
dWZmZXIgKmViKQogCiAJCWNhc2UgMToKIAkJCS8qIFRvbyBmcmFnbWVudGVkLCB1bmJpbmQgZXZl
cnl0aGluZyBhbmQgcmV0cnkgKi8KKwkJCW11dGV4X2xvY2soJmViLT5jb250ZXh0LT52bS0+bXV0
ZXgpOwogCQkJZXJyID0gaTkxNV9nZW1fZXZpY3Rfdm0oZWItPmNvbnRleHQtPnZtKTsKKwkJCW11
dGV4X3VubG9jaygmZWItPmNvbnRleHQtPnZtLT5tdXRleCk7CiAJCQlpZiAoZXJyKQogCQkJCXJl
dHVybiBlcnI7CiAJCQlicmVhazsKQEAgLTk3Miw3ICs5NzcsOSBAQCBzdGF0aWMgdm9pZCByZWxv
Y19jYWNoZV9yZXNldChzdHJ1Y3QgcmVsb2NfY2FjaGUgKmNhY2hlKQogCQkJZ2d0dC0+dm0uY2xl
YXJfcmFuZ2UoJmdndHQtPnZtLAogCQkJCQkgICAgIGNhY2hlLT5ub2RlLnN0YXJ0LAogCQkJCQkg
ICAgIGNhY2hlLT5ub2RlLnNpemUpOworCQkJbXV0ZXhfbG9jaygmZ2d0dC0+dm0ubXV0ZXgpOwog
CQkJZHJtX21tX3JlbW92ZV9ub2RlKCZjYWNoZS0+bm9kZSk7CisJCQltdXRleF91bmxvY2soJmdn
dHQtPnZtLm11dGV4KTsKIAkJfSBlbHNlIHsKIAkJCWk5MTVfdm1hX3VucGluKChzdHJ1Y3QgaTkx
NV92bWEgKiljYWNoZS0+bm9kZS5tbSk7CiAJCX0KQEAgLTEwNDcsMTEgKzEwNTQsMTMgQEAgc3Rh
dGljIHZvaWQgKnJlbG9jX2lvbWFwKHN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmosCiAJ
CQkJCSAgICAgICBQSU5fTk9FVklDVCk7CiAJCWlmIChJU19FUlIodm1hKSkgewogCQkJbWVtc2V0
KCZjYWNoZS0+bm9kZSwgMCwgc2l6ZW9mKGNhY2hlLT5ub2RlKSk7CisJCQltdXRleF9sb2NrKCZn
Z3R0LT52bS5tdXRleCk7CiAJCQllcnIgPSBkcm1fbW1faW5zZXJ0X25vZGVfaW5fcmFuZ2UKIAkJ
CQkoJmdndHQtPnZtLm1tLCAmY2FjaGUtPm5vZGUsCiAJCQkJIFBBR0VfU0laRSwgMCwgSTkxNV9D
T0xPUl9VTkVWSUNUQUJMRSwKIAkJCQkgMCwgZ2d0dC0+bWFwcGFibGVfZW5kLAogCQkJCSBEUk1f
TU1fSU5TRVJUX0xPVyk7CisJCQltdXRleF91bmxvY2soJmdndHQtPnZtLm11dGV4KTsKIAkJCWlm
IChlcnIpIC8qIG5vIGluYWN0aXZlIGFwZXJ0dXJlIHNwYWNlLCB1c2UgY3B1IHJlbG9jICovCiAJ
CQkJcmV0dXJuIE5VTEw7CiAJCX0gZWxzZSB7CkBAIC0xNDE2LDcgKzE0MjUsNyBAQCBlYl9yZWxv
Y2F0ZV9lbnRyeShzdHJ1Y3QgaTkxNV9leGVjYnVmZmVyICplYiwKIAkJaWYgKHJlbG9jLT53cml0
ZV9kb21haW4gPT0gSTkxNV9HRU1fRE9NQUlOX0lOU1RSVUNUSU9OICYmCiAJCSAgICBJU19HRU4o
ZWItPmk5MTUsIDYpKSB7CiAJCQllcnIgPSBpOTE1X3ZtYV9iaW5kKHRhcmdldCwgdGFyZ2V0LT5v
YmotPmNhY2hlX2xldmVsLAotCQkJCQkgICAgUElOX0dMT0JBTCk7CisJCQkJCSAgICBQSU5fR0xP
QkFMLCBOVUxMKTsKIAkJCWlmIChXQVJOX09OQ0UoZXJyLAogCQkJCSAgICAgICJVbmV4cGVjdGVk
IGZhaWx1cmUgdG8gYmluZCB0YXJnZXQgVk1BISIpKQogCQkJCXJldHVybiBlcnI7CkBAIC0yMTQw
LDM1ICsyMTQ5LDYgQEAgc3RhdGljIHN0cnVjdCBpOTE1X3JlcXVlc3QgKmViX3Rocm90dGxlKHN0
cnVjdCBpbnRlbF9jb250ZXh0ICpjZSkKIAlyZXR1cm4gaTkxNV9yZXF1ZXN0X2dldChycSk7CiB9
CiAKLXN0YXRpYyBpbnQKLV9fZWJfcGluX2NvbnRleHQoc3RydWN0IGk5MTVfZXhlY2J1ZmZlciAq
ZWIsIHN0cnVjdCBpbnRlbF9jb250ZXh0ICpjZSkKLXsKLQlpbnQgZXJyOwotCi0JaWYgKGxpa2Vs
eShhdG9taWNfaW5jX25vdF96ZXJvKCZjZS0+cGluX2NvdW50KSkpCi0JCXJldHVybiAwOwotCi0J
ZXJyID0gbXV0ZXhfbG9ja19pbnRlcnJ1cHRpYmxlKCZlYi0+aTkxNS0+ZHJtLnN0cnVjdF9tdXRl
eCk7Ci0JaWYgKGVycikKLQkJcmV0dXJuIGVycjsKLQotCWVyciA9IF9faW50ZWxfY29udGV4dF9k
b19waW4oY2UpOwotCW11dGV4X3VubG9jaygmZWItPmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwot
Ci0JcmV0dXJuIGVycjsKLX0KLQotc3RhdGljIHZvaWQKLV9fZWJfdW5waW5fY29udGV4dChzdHJ1
Y3QgaTkxNV9leGVjYnVmZmVyICplYiwgc3RydWN0IGludGVsX2NvbnRleHQgKmNlKQotewotCWlm
IChsaWtlbHkoYXRvbWljX2FkZF91bmxlc3MoJmNlLT5waW5fY291bnQsIC0xLCAxKSkpCi0JCXJl
dHVybjsKLQotCW11dGV4X2xvY2soJmViLT5pOTE1LT5kcm0uc3RydWN0X211dGV4KTsKLQlpbnRl
bF9jb250ZXh0X3VucGluKGNlKTsKLQltdXRleF91bmxvY2soJmViLT5pOTE1LT5kcm0uc3RydWN0
X211dGV4KTsKLX0KLQogc3RhdGljIGludCBfX2ViX3Bpbl9lbmdpbmUoc3RydWN0IGk5MTVfZXhl
Y2J1ZmZlciAqZWIsIHN0cnVjdCBpbnRlbF9jb250ZXh0ICpjZSkKIHsKIAlzdHJ1Y3QgaW50ZWxf
dGltZWxpbmUgKnRsOwpAQCAtMjE4OCw3ICsyMTY4LDcgQEAgc3RhdGljIGludCBfX2ViX3Bpbl9l
bmdpbmUoc3RydWN0IGk5MTVfZXhlY2J1ZmZlciAqZWIsIHN0cnVjdCBpbnRlbF9jb250ZXh0ICpj
ZSkKIAkgKiBHR1RUIHNwYWNlLCBzbyBkbyB0aGlzIGZpcnN0IGJlZm9yZSB3ZSByZXNlcnZlIGEg
c2Vxbm8gZm9yCiAJICogb3Vyc2VsdmVzLgogCSAqLwotCWVyciA9IF9fZWJfcGluX2NvbnRleHQo
ZWIsIGNlKTsKKwllcnIgPSBpbnRlbF9jb250ZXh0X3BpbihjZSk7CiAJaWYgKGVycikKIAkJcmV0
dXJuIGVycjsKIApAQCAtMjIzMiw3ICsyMjEyLDcgQEAgc3RhdGljIGludCBfX2ViX3Bpbl9lbmdp
bmUoc3RydWN0IGk5MTVfZXhlY2J1ZmZlciAqZWIsIHN0cnVjdCBpbnRlbF9jb250ZXh0ICpjZSkK
IAlpbnRlbF9jb250ZXh0X2V4aXQoY2UpOwogCWludGVsX2NvbnRleHRfdGltZWxpbmVfdW5sb2Nr
KHRsKTsKIGVycl91bnBpbjoKLQlfX2ViX3VucGluX2NvbnRleHQoZWIsIGNlKTsKKwlpbnRlbF9j
b250ZXh0X3VucGluKGNlKTsKIAlyZXR1cm4gZXJyOwogfQogCkBAIC0yMjQ1LDcgKzIyMjUsNyBA
QCBzdGF0aWMgdm9pZCBlYl91bnBpbl9lbmdpbmUoc3RydWN0IGk5MTVfZXhlY2J1ZmZlciAqZWIp
CiAJaW50ZWxfY29udGV4dF9leGl0KGNlKTsKIAltdXRleF91bmxvY2soJnRsLT5tdXRleCk7CiAK
LQlfX2ViX3VucGluX2NvbnRleHQoZWIsIGNlKTsKKwlpbnRlbF9jb250ZXh0X3VucGluKGNlKTsK
IH0KIAogc3RhdGljIHVuc2lnbmVkIGludApkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5
MTUvZ2VtL2k5MTVfZ2VtX21tYW4uYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dl
bV9tbWFuLmMKaW5kZXggODJkYjJiNzgzMTIzLi45YThjMzA3YzVhZWIgMTAwNjQ0Ci0tLSBhL2Ry
aXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9tbWFuLmMKKysrIGIvZHJpdmVycy9ncHUv
ZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX21tYW4uYwpAQCAtMjUxLDE2ICsyNTEsNiBAQCB2bV9mYXVs
dF90IGk5MTVfZ2VtX2ZhdWx0KHN0cnVjdCB2bV9mYXVsdCAqdm1mKQogCQlnb3RvIGVycl9ycG07
CiAJfQogCi0JcmV0ID0gaTkxNV9tdXRleF9sb2NrX2ludGVycnVwdGlibGUoZGV2KTsKLQlpZiAo
cmV0KQotCQlnb3RvIGVycl9yZXNldDsKLQotCS8qIEFjY2VzcyB0byBzbm9vcGFibGUgcGFnZXMg
dGhyb3VnaCB0aGUgR1RUIGlzIGluY29oZXJlbnQuICovCi0JaWYgKG9iai0+Y2FjaGVfbGV2ZWwg
IT0gSTkxNV9DQUNIRV9OT05FICYmICFIQVNfTExDKGk5MTUpKSB7Ci0JCXJldCA9IC1FRkFVTFQ7
Ci0JCWdvdG8gZXJyX3VubG9jazsKLQl9Ci0KIAkvKiBOb3cgcGluIGl0IGludG8gdGhlIEdUVCBh
cyBuZWVkZWQgKi8KIAl2bWEgPSBpOTE1X2dlbV9vYmplY3RfZ2d0dF9waW4ob2JqLCBOVUxMLCAw
LCAwLAogCQkJCSAgICAgICBQSU5fTUFQUEFCTEUgfApAQCAtMjkzLDcgKzI4MywxMyBAQCB2bV9m
YXVsdF90IGk5MTVfZ2VtX2ZhdWx0KHN0cnVjdCB2bV9mYXVsdCAqdm1mKQogCX0KIAlpZiAoSVNf
RVJSKHZtYSkpIHsKIAkJcmV0ID0gUFRSX0VSUih2bWEpOwotCQlnb3RvIGVycl91bmxvY2s7CisJ
CWdvdG8gZXJyX3Jlc2V0OworCX0KKworCS8qIEFjY2VzcyB0byBzbm9vcGFibGUgcGFnZXMgdGhy
b3VnaCB0aGUgR1RUIGlzIGluY29oZXJlbnQuICovCisJaWYgKG9iai0+Y2FjaGVfbGV2ZWwgIT0g
STkxNV9DQUNIRV9OT05FICYmICFIQVNfTExDKGk5MTUpKSB7CisJCXJldCA9IC1FRkFVTFQ7CisJ
CWdvdG8gZXJyX3VucGluOwogCX0KIAogCXJldCA9IGk5MTVfdm1hX3Bpbl9mZW5jZSh2bWEpOwpA
QCAtMzIxLDE0ICszMTcsMTIgQEAgdm1fZmF1bHRfdCBpOTE1X2dlbV9mYXVsdChzdHJ1Y3Qgdm1f
ZmF1bHQgKnZtZikKIAkJaW50ZWxfd2FrZXJlZl9hdXRvKCZpOTE1LT5nZ3R0LnVzZXJmYXVsdF93
YWtlcmVmLAogCQkJCSAgIG1zZWNzX3RvX2ppZmZpZXNfdGltZW91dChDT05GSUdfRFJNX0k5MTVf
VVNFUkZBVUxUX0FVVE9TVVNQRU5EKSk7CiAKLQlpOTE1X3ZtYV9zZXRfZ2d0dF93cml0ZSh2bWEp
OwotCisJaWYgKHdyaXRlKQorCQlpOTE1X3ZtYV9zZXRfZ2d0dF93cml0ZSh2bWEpOwogZXJyX2Zl
bmNlOgogCWk5MTVfdm1hX3VucGluX2ZlbmNlKHZtYSk7CiBlcnJfdW5waW46CiAJX19pOTE1X3Zt
YV91bnBpbih2bWEpOwotZXJyX3VubG9jazoKLQltdXRleF91bmxvY2soJmRldi0+c3RydWN0X211
dGV4KTsKIGVycl9yZXNldDoKIAlpbnRlbF9ndF9yZXNldF91bmxvY2soZ2d0dC0+dm0uZ3QsIHNy
Y3UpOwogZXJyX3JwbToKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1
X2dlbV9vYmplY3QuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9vYmplY3Qu
YwppbmRleCAwZWY2MGRhZTIzYTcuLmRiZjliZTlhNzlmNCAxMDA2NDQKLS0tIGEvZHJpdmVycy9n
cHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX29iamVjdC5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9p
OTE1L2dlbS9pOTE1X2dlbV9vYmplY3QuYwpAQCAtMTU1LDIxICsxNTUsMzAgQEAgc3RhdGljIHZv
aWQgX19pOTE1X2dlbV9mcmVlX29iamVjdHMoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUs
CiAKIAl3YWtlcmVmID0gaW50ZWxfcnVudGltZV9wbV9nZXQoJmk5MTUtPnJ1bnRpbWVfcG0pOwog
CWxsaXN0X2Zvcl9lYWNoX2VudHJ5X3NhZmUob2JqLCBvbiwgZnJlZWQsIGZyZWVkKSB7Ci0JCXN0
cnVjdCBpOTE1X3ZtYSAqdm1hLCAqdm47Ci0KIAkJdHJhY2VfaTkxNV9nZW1fb2JqZWN0X2Rlc3Ry
b3kob2JqKTsKIAotCQltdXRleF9sb2NrKCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsKLQotCQls
aXN0X2Zvcl9lYWNoX2VudHJ5X3NhZmUodm1hLCB2biwgJm9iai0+dm1hLmxpc3QsIG9ial9saW5r
KSB7Ci0JCQlHRU1fQlVHX09OKGk5MTVfdm1hX2lzX2FjdGl2ZSh2bWEpKTsKLQkJCWF0b21pY19h
bmQofkk5MTVfVk1BX1BJTl9NQVNLLCAmdm1hLT5mbGFncyk7Ci0JCQlpOTE1X3ZtYV9kZXN0cm95
KHZtYSk7CisJCWlmICghbGlzdF9lbXB0eSgmb2JqLT52bWEubGlzdCkpIHsKKwkJCXN0cnVjdCBp
OTE1X3ZtYSAqdm1hOworCisJCQkvKgorCQkJICogTm90ZSB0aGF0IHRoZSB2bWEga2VlcHMgYW4g
b2JqZWN0IHJlZmVyZW5jZSB3aGlsZQorCQkJICogaXQgaXMgYWN0aXZlLCBzbyBpdCAqc2hvdWxk
KiBub3Qgc2xlZXAgd2hpbGUgd2UKKwkJCSAqIGRlc3Ryb3kgaXQuIE91ciBkZWJ1ZyBjb2RlIGVy
cnMgaW5zaXRzIGl0ICptaWdodCouCisJCQkgKiBGb3IgdGhlIG1vbWVudCwgcGxheSBhbG9uZy4K
KwkJCSAqLworCQkJc3Bpbl9sb2NrKCZvYmotPnZtYS5sb2NrKTsKKwkJCXdoaWxlICgodm1hID0g
bGlzdF9maXJzdF9lbnRyeV9vcl9udWxsKCZvYmotPnZtYS5saXN0LAorCQkJCQkJCSAgICAgICBz
dHJ1Y3QgaTkxNV92bWEsCisJCQkJCQkJICAgICAgIG9ial9saW5rKSkpIHsKKwkJCQlHRU1fQlVH
X09OKHZtYS0+b2JqICE9IG9iaik7CisJCQkJc3Bpbl91bmxvY2soJm9iai0+dm1hLmxvY2spOwor
CisJCQkJaTkxNV92bWFfZGVzdHJveSh2bWEpOworCisJCQkJc3Bpbl9sb2NrKCZvYmotPnZtYS5s
b2NrKTsKKwkJCX0KKwkJCXNwaW5fdW5sb2NrKCZvYmotPnZtYS5sb2NrKTsKIAkJfQotCQlHRU1f
QlVHX09OKCFsaXN0X2VtcHR5KCZvYmotPnZtYS5saXN0KSk7Ci0JCUdFTV9CVUdfT04oIVJCX0VN
UFRZX1JPT1QoJm9iai0+dm1hLnRyZWUpKTsKLQotCQltdXRleF91bmxvY2soJmk5MTUtPmRybS5z
dHJ1Y3RfbXV0ZXgpOwogCiAJCUdFTV9CVUdfT04oYXRvbWljX3JlYWQoJm9iai0+YmluZF9jb3Vu
dCkpOwogCQlHRU1fQlVHX09OKG9iai0+dXNlcmZhdWx0X2NvdW50KTsKZGlmZiAtLWdpdCBhL2Ry
aXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9vYmplY3QuaCBiL2RyaXZlcnMvZ3B1L2Ry
bS9pOTE1L2dlbS9pOTE1X2dlbV9vYmplY3QuaAppbmRleCAyOWI5ZWRkYzRjN2YuLmE3OGFmMjVk
Y2UzNiAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX29iamVj
dC5oCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9vYmplY3QuaApAQCAt
MTA2LDYgKzEwNiwxMSBAQCBzdGF0aWMgaW5saW5lIHZvaWQgaTkxNV9nZW1fb2JqZWN0X2xvY2so
c3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iaikKIAlkbWFfcmVzdl9sb2NrKG9iai0+YmFz
ZS5yZXN2LCBOVUxMKTsKIH0KIAorc3RhdGljIGlubGluZSBib29sIGk5MTVfZ2VtX29iamVjdF90
cnlsb2NrKHN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmopCit7CisJcmV0dXJuIGRtYV9y
ZXN2X3RyeWxvY2sob2JqLT5iYXNlLnJlc3YpOworfQorCiBzdGF0aWMgaW5saW5lIGludAogaTkx
NV9nZW1fb2JqZWN0X2xvY2tfaW50ZXJydXB0aWJsZShzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVj
dCAqb2JqKQogewpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2Vt
X3Nocmlua2VyLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fc2hyaW5rZXIu
YwppbmRleCBkMmMwNWQ3NTI5MDkuLmZkNjA0ZWExMmY3ZiAxMDA2NDQKLS0tIGEvZHJpdmVycy9n
cHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX3Nocmlua2VyLmMKKysrIGIvZHJpdmVycy9ncHUvZHJt
L2k5MTUvZ2VtL2k5MTVfZ2VtX3Nocmlua2VyLmMKQEAgLTE2LDQwICsxNiw2IEBACiAKICNpbmNs
dWRlICJpOTE1X3RyYWNlLmgiCiAKLXN0YXRpYyBib29sIHNocmlua2VyX2xvY2soc3RydWN0IGRy
bV9pOTE1X3ByaXZhdGUgKmk5MTUsCi0JCQkgIHVuc2lnbmVkIGludCBmbGFncywKLQkJCSAgYm9v
bCAqdW5sb2NrKQotewotCXN0cnVjdCBtdXRleCAqbSA9ICZpOTE1LT5kcm0uc3RydWN0X211dGV4
OwotCi0Jc3dpdGNoIChtdXRleF90cnlsb2NrX3JlY3Vyc2l2ZShtKSkgewotCWNhc2UgTVVURVhf
VFJZTE9DS19SRUNVUlNJVkU6Ci0JCSp1bmxvY2sgPSBmYWxzZTsKLQkJcmV0dXJuIHRydWU7Ci0K
LQljYXNlIE1VVEVYX1RSWUxPQ0tfRkFJTEVEOgotCQkqdW5sb2NrID0gZmFsc2U7Ci0JCWlmIChm
bGFncyAmIEk5MTVfU0hSSU5LX0FDVElWRSAmJgotCQkgICAgbXV0ZXhfbG9ja19raWxsYWJsZV9u
ZXN0ZWQobSwgSTkxNV9NTV9TSFJJTktFUikgPT0gMCkKLQkJCSp1bmxvY2sgPSB0cnVlOwotCQly
ZXR1cm4gKnVubG9jazsKLQotCWNhc2UgTVVURVhfVFJZTE9DS19TVUNDRVNTOgotCQkqdW5sb2Nr
ID0gdHJ1ZTsKLQkJcmV0dXJuIHRydWU7Ci0JfQotCi0JQlVHKCk7Ci19Ci0KLXN0YXRpYyB2b2lk
IHNocmlua2VyX3VubG9jayhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwgYm9vbCB1bmxv
Y2spCi17Ci0JaWYgKCF1bmxvY2spCi0JCXJldHVybjsKLQotCW11dGV4X3VubG9jaygmaTkxNS0+
ZHJtLnN0cnVjdF9tdXRleCk7Ci19Ci0KIHN0YXRpYyBib29sIHN3YXBfYXZhaWxhYmxlKHZvaWQp
CiB7CiAJcmV0dXJuIGdldF9ucl9zd2FwX3BhZ2VzKCkgPiAwOwpAQCAtMTU1LDEwICsxMjEsNiBA
QCBpOTE1X2dlbV9zaHJpbmsoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUsCiAJaW50ZWxf
d2FrZXJlZl90IHdha2VyZWYgPSAwOwogCXVuc2lnbmVkIGxvbmcgY291bnQgPSAwOwogCXVuc2ln
bmVkIGxvbmcgc2Nhbm5lZCA9IDA7Ci0JYm9vbCB1bmxvY2s7Ci0KLQlpZiAoIXNocmlua2VyX2xv
Y2soaTkxNSwgc2hyaW5rLCAmdW5sb2NrKSkKLQkJcmV0dXJuIDA7CiAKIAkvKgogCSAqIFdoZW4g
c2hyaW5raW5nIHRoZSBhY3RpdmUgbGlzdCwgd2Ugc2hvdWxkIGFsc28gY29uc2lkZXIgYWN0aXZl
CkBAIC0yNjgsOCArMjMwLDYgQEAgaTkxNV9nZW1fc2hyaW5rKHN0cnVjdCBkcm1faTkxNV9wcml2
YXRlICppOTE1LAogCWlmIChzaHJpbmsgJiBJOTE1X1NIUklOS19CT1VORCkKIAkJaW50ZWxfcnVu
dGltZV9wbV9wdXQoJmk5MTUtPnJ1bnRpbWVfcG0sIHdha2VyZWYpOwogCi0Jc2hyaW5rZXJfdW5s
b2NrKGk5MTUsIHVubG9jayk7Ci0KIAlpZiAobnJfc2Nhbm5lZCkKIAkJKm5yX3NjYW5uZWQgKz0g
c2Nhbm5lZDsKIAlyZXR1cm4gY291bnQ7CkBAIC0zMzksMTkgKzI5OSwxNCBAQCBpOTE1X2dlbV9z
aHJpbmtlcl9zY2FuKHN0cnVjdCBzaHJpbmtlciAqc2hyaW5rZXIsIHN0cnVjdCBzaHJpbmtfY29u
dHJvbCAqc2MpCiAJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPQogCQljb250YWluZXJf
b2Yoc2hyaW5rZXIsIHN0cnVjdCBkcm1faTkxNV9wcml2YXRlLCBtbS5zaHJpbmtlcik7CiAJdW5z
aWduZWQgbG9uZyBmcmVlZDsKLQlib29sIHVubG9jazsKIAogCXNjLT5ucl9zY2FubmVkID0gMDsK
IAotCWlmICghc2hyaW5rZXJfbG9jayhpOTE1LCAwLCAmdW5sb2NrKSkKLQkJcmV0dXJuIFNIUklO
S19TVE9QOwotCiAJZnJlZWQgPSBpOTE1X2dlbV9zaHJpbmsoaTkxNSwKIAkJCQlzYy0+bnJfdG9f
c2NhbiwKIAkJCQkmc2MtPm5yX3NjYW5uZWQsCiAJCQkJSTkxNV9TSFJJTktfQk9VTkQgfAotCQkJ
CUk5MTVfU0hSSU5LX1VOQk9VTkQgfAotCQkJCUk5MTVfU0hSSU5LX1dSSVRFQkFDSyk7CisJCQkJ
STkxNV9TSFJJTktfVU5CT1VORCk7CiAJaWYgKHNjLT5ucl9zY2FubmVkIDwgc2MtPm5yX3RvX3Nj
YW4gJiYgY3VycmVudF9pc19rc3dhcGQoKSkgewogCQlpbnRlbF93YWtlcmVmX3Qgd2FrZXJlZjsK
IApAQCAtMzY2LDggKzMyMSw2IEBAIGk5MTVfZ2VtX3Nocmlua2VyX3NjYW4oc3RydWN0IHNocmlu
a2VyICpzaHJpbmtlciwgc3RydWN0IHNocmlua19jb250cm9sICpzYykKIAkJfQogCX0KIAotCXNo
cmlua2VyX3VubG9jayhpOTE1LCB1bmxvY2spOwotCiAJcmV0dXJuIHNjLT5ucl9zY2FubmVkID8g
ZnJlZWQgOiBTSFJJTktfU1RPUDsKIH0KIApAQCAtMzg0LDYgKzMzNyw3IEBAIGk5MTVfZ2VtX3No
cmlua2VyX29vbShzdHJ1Y3Qgbm90aWZpZXJfYmxvY2sgKm5iLCB1bnNpZ25lZCBsb25nIGV2ZW50
LCB2b2lkICpwdHIpCiAJZnJlZWRfcGFnZXMgPSAwOwogCXdpdGhfaW50ZWxfcnVudGltZV9wbSgm
aTkxNS0+cnVudGltZV9wbSwgd2FrZXJlZikKIAkJZnJlZWRfcGFnZXMgKz0gaTkxNV9nZW1fc2hy
aW5rKGk5MTUsIC0xVUwsIE5VTEwsCisJCQkJCSAgICAgICBJOTE1X1NIUklOS19BQ1RJVkUgfAog
CQkJCQkgICAgICAgSTkxNV9TSFJJTktfQk9VTkQgfAogCQkJCQkgICAgICAgSTkxNV9TSFJJTktf
VU5CT1VORCB8CiAJCQkJCSAgICAgICBJOTE1X1NIUklOS19XUklURUJBQ0spOwpAQCAtNDE5LDEw
ICszNzMsNiBAQCBpOTE1X2dlbV9zaHJpbmtlcl92bWFwKHN0cnVjdCBub3RpZmllcl9ibG9jayAq
bmIsIHVuc2lnbmVkIGxvbmcgZXZlbnQsIHZvaWQgKnB0cgogCXN0cnVjdCBpOTE1X3ZtYSAqdm1h
LCAqbmV4dDsKIAl1bnNpZ25lZCBsb25nIGZyZWVkX3BhZ2VzID0gMDsKIAlpbnRlbF93YWtlcmVm
X3Qgd2FrZXJlZjsKLQlib29sIHVubG9jazsKLQotCWlmICghc2hyaW5rZXJfbG9jayhpOTE1LCAw
LCAmdW5sb2NrKSkKLQkJcmV0dXJuIE5PVElGWV9ET05FOwogCiAJd2l0aF9pbnRlbF9ydW50aW1l
X3BtKCZpOTE1LT5ydW50aW1lX3BtLCB3YWtlcmVmKQogCQlmcmVlZF9wYWdlcyArPSBpOTE1X2dl
bV9zaHJpbmsoaTkxNSwgLTFVTCwgTlVMTCwKQEAgLTQzOSwxNSArMzg5LDExIEBAIGk5MTVfZ2Vt
X3Nocmlua2VyX3ZtYXAoc3RydWN0IG5vdGlmaWVyX2Jsb2NrICpuYiwgdW5zaWduZWQgbG9uZyBl
dmVudCwgdm9pZCAqcHRyCiAJCWlmICghdm1hLT5pb21hcCB8fCBpOTE1X3ZtYV9pc19hY3RpdmUo
dm1hKSkKIAkJCWNvbnRpbnVlOwogCi0JCW11dGV4X3VubG9jaygmaTkxNS0+Z2d0dC52bS5tdXRl
eCk7CiAJCWlmIChpOTE1X3ZtYV91bmJpbmQodm1hKSA9PSAwKQogCQkJZnJlZWRfcGFnZXMgKz0g
Y291bnQ7Ci0JCW11dGV4X2xvY2soJmk5MTUtPmdndHQudm0ubXV0ZXgpOwogCX0KIAltdXRleF91
bmxvY2soJmk5MTUtPmdndHQudm0ubXV0ZXgpOwogCi0Jc2hyaW5rZXJfdW5sb2NrKGk5MTUsIHVu
bG9jayk7Ci0KIAkqKHVuc2lnbmVkIGxvbmcgKilwdHIgKz0gZnJlZWRfcGFnZXM7CiAJcmV0dXJu
IE5PVElGWV9ET05FOwogfQpAQCAtNDkwLDIyICs0MzYsOSBAQCB2b2lkIGk5MTVfZ2VtX3Nocmlu
a2VyX3RhaW50c19tdXRleChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwKIAogCWZzX3Jl
Y2xhaW1fYWNxdWlyZShHRlBfS0VSTkVMKTsKIAotCS8qCi0JICogQXMgd2UgaW52YXJpYWJseSBy
ZWx5IG9uIHRoZSBzdHJ1Y3RfbXV0ZXggd2l0aGluIHRoZSBzaHJpbmtlciwKLQkgKiBidXQgaGF2
ZSBhIGNvbXBsaWNhdGVkIHJlY3Vyc2lvbiBkYW5jZSwgdGFpbnQgYWxsIHRoZSBtdXRleGVzIHVz
ZWQKLQkgKiB3aXRoaW4gdGhlIHNocmlua2VyIHdpdGggdGhlIHN0cnVjdF9tdXRleC4gRm9yIGNv
bXBsZXRlbmVzcywgd2UKLQkgKiB0YWludCB3aXRoIGFsbCBzdWJjbGFzcyBvZiBzdHJ1Y3RfbXV0
ZXgsIGV2ZW4gdGhvdWdoIHdlIHNob3VsZAotCSAqIG9ubHkgbmVlZCB0YWludGluZyBieSBJOTE1
X01NX05PUk1BTCB0byBjYXRjaCBwb3NzaWJsZSBBQkJBCi0JICogZGVhZGxvY2tzIGZyb20gdXNp
bmcgc3RydWN0X211dGV4IGluc2lkZSBAbXV0ZXguCi0JICovCi0JbXV0ZXhfYWNxdWlyZSgmaTkx
NS0+ZHJtLnN0cnVjdF9tdXRleC5kZXBfbWFwLAotCQkgICAgICBJOTE1X01NX1NIUklOS0VSLCAw
LCBfUkVUX0lQXyk7Ci0KIAltdXRleF9hY3F1aXJlKCZtdXRleC0+ZGVwX21hcCwgMCwgMCwgX1JF
VF9JUF8pOwogCW11dGV4X3JlbGVhc2UoJm11dGV4LT5kZXBfbWFwLCAwLCBfUkVUX0lQXyk7CiAK
LQltdXRleF9yZWxlYXNlKCZpOTE1LT5kcm0uc3RydWN0X211dGV4LmRlcF9tYXAsIDAsIF9SRVRf
SVBfKTsKLQogCWZzX3JlY2xhaW1fcmVsZWFzZShHRlBfS0VSTkVMKTsKIAogCWlmICh1bmxvY2sp
CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fc3RvbGVuLmMg
Yi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fc3RvbGVuLmMKaW5kZXggMGQ4MWRl
MTQ2MWI0Li5kMmFlZDcyOGFkOGQgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dl
bS9pOTE1X2dlbV9zdG9sZW4uYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9n
ZW1fc3RvbGVuLmMKQEAgLTYyMSw4ICs2MjEsNiBAQCBpOTE1X2dlbV9vYmplY3RfY3JlYXRlX3N0
b2xlbl9mb3JfcHJlYWxsb2NhdGVkKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdgog
CWlmICghZHJtX21tX2luaXRpYWxpemVkKCZkZXZfcHJpdi0+bW0uc3RvbGVuKSkKIAkJcmV0dXJu
IE5VTEw7CiAKLQlsb2NrZGVwX2Fzc2VydF9oZWxkKCZkZXZfcHJpdi0+ZHJtLnN0cnVjdF9tdXRl
eCk7Ci0KIAlEUk1fREVCVUdfRFJJVkVSKCJjcmVhdGluZyBwcmVhbGxvY2F0ZWQgc3RvbGVuIG9i
amVjdDogc3RvbGVuX29mZnNldD0lcGEsIGd0dF9vZmZzZXQ9JXBhLCBzaXplPSVwYVxuIiwKIAkJ
CSAmc3RvbGVuX29mZnNldCwgJmd0dF9vZmZzZXQsICZzaXplKTsKIApAQCAtNjc0LDIxICs2NzIs
MjUgQEAgaTkxNV9nZW1fb2JqZWN0X2NyZWF0ZV9zdG9sZW5fZm9yX3ByZWFsbG9jYXRlZChzdHJ1
Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYKIAkgKiBzZXR0aW5nIHVwIHRoZSBHVFQgc3Bh
Y2UuIFRoZSBhY3R1YWwgcmVzZXJ2YXRpb24gd2lsbCBvY2N1cgogCSAqIGxhdGVyLgogCSAqLwor
CW11dGV4X2xvY2soJmdndHQtPnZtLm11dGV4KTsKIAlyZXQgPSBpOTE1X2dlbV9ndHRfcmVzZXJ2
ZSgmZ2d0dC0+dm0sICZ2bWEtPm5vZGUsCiAJCQkJICAgc2l6ZSwgZ3R0X29mZnNldCwgb2JqLT5j
YWNoZV9sZXZlbCwKIAkJCQkgICAwKTsKIAlpZiAocmV0KSB7CiAJCURSTV9ERUJVR19EUklWRVIo
ImZhaWxlZCB0byBhbGxvY2F0ZSBzdG9sZW4gR1RUIHNwYWNlXG4iKTsKKwkJbXV0ZXhfdW5sb2Nr
KCZnZ3R0LT52bS5tdXRleCk7CiAJCWdvdG8gZXJyX3BhZ2VzOwogCX0KIAogCUdFTV9CVUdfT04o
IWRybV9tbV9ub2RlX2FsbG9jYXRlZCgmdm1hLT5ub2RlKSk7CiAKKwlHRU1fQlVHX09OKHZtYS0+
cGFnZXMpOwogCXZtYS0+cGFnZXMgPSBvYmotPm1tLnBhZ2VzOworCWF0b21pY19zZXQoJnZtYS0+
cGFnZXNfY291bnQsIEk5MTVfVk1BX1BBR0VTX0FDVElWRSk7CisKIAlzZXRfYml0KEk5MTVfVk1B
X0dMT0JBTF9CSU5EX0JJVCwgX19pOTE1X3ZtYV9mbGFncyh2bWEpKTsKIAlfX2k5MTVfdm1hX3Nl
dF9tYXBfYW5kX2ZlbmNlYWJsZSh2bWEpOwogCi0JbXV0ZXhfbG9jaygmZ2d0dC0+dm0ubXV0ZXgp
OwogCWxpc3RfYWRkX3RhaWwoJnZtYS0+dm1fbGluaywgJmdndHQtPnZtLmJvdW5kX2xpc3QpOwog
CW11dGV4X3VubG9jaygmZ2d0dC0+dm0ubXV0ZXgpOwogCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dw
dS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fdGlsaW5nLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9n
ZW0vaTkxNV9nZW1fdGlsaW5nLmMKaW5kZXggY2EwYzJmNDUxNzQyLi5iOWNmYWUwZTQ0MzUgMTAw
NjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV90aWxpbmcuYworKysg
Yi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fdGlsaW5nLmMKQEAgLTE4MSwyMiAr
MTgxLDI1IEBAIHN0YXRpYyBpbnQKIGk5MTVfZ2VtX29iamVjdF9mZW5jZV9wcmVwYXJlKHN0cnVj
dCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmosCiAJCQkgICAgICBpbnQgdGlsaW5nX21vZGUsIHVu
c2lnbmVkIGludCBzdHJpZGUpCiB7CisJc3RydWN0IGk5MTVfZ2d0dCAqZ2d0dCA9ICZ0b19pOTE1
KG9iai0+YmFzZS5kZXYpLT5nZ3R0OwogCXN0cnVjdCBpOTE1X3ZtYSAqdm1hOwotCWludCByZXQ7
CisJaW50IHJldCA9IDA7CiAKIAlpZiAodGlsaW5nX21vZGUgPT0gSTkxNV9USUxJTkdfTk9ORSkK
IAkJcmV0dXJuIDA7CiAKKwltdXRleF9sb2NrKCZnZ3R0LT52bS5tdXRleCk7CiAJZm9yX2VhY2hf
Z2d0dF92bWEodm1hLCBvYmopIHsKIAkJaWYgKGk5MTVfdm1hX2ZlbmNlX3ByZXBhcmUodm1hLCB0
aWxpbmdfbW9kZSwgc3RyaWRlKSkKIAkJCWNvbnRpbnVlOwogCiAJCXJldCA9IGk5MTVfdm1hX3Vu
YmluZCh2bWEpOwogCQlpZiAocmV0KQotCQkJcmV0dXJuIHJldDsKKwkJCWJyZWFrOwogCX0KKwlt
dXRleF91bmxvY2soJmdndHQtPnZtLm11dGV4KTsKIAotCXJldHVybiAwOworCXJldHVybiByZXQ7
CiB9CiAKIGludApAQCAtMjEyLDcgKzIxNSw2IEBAIGk5MTVfZ2VtX29iamVjdF9zZXRfdGlsaW5n
KHN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmosCiAKIAlHRU1fQlVHX09OKCFpOTE1X3Rp
bGluZ19vayhvYmosIHRpbGluZywgc3RyaWRlKSk7CiAJR0VNX0JVR19PTighc3RyaWRlIF4gKHRp
bGluZyA9PSBJOTE1X1RJTElOR19OT05FKSk7Ci0JbG9ja2RlcF9hc3NlcnRfaGVsZCgmaTkxNS0+
ZHJtLnN0cnVjdF9tdXRleCk7CiAKIAlpZiAoKHRpbGluZyB8IHN0cmlkZSkgPT0gb2JqLT50aWxp
bmdfYW5kX3N0cmlkZSkKIAkJcmV0dXJuIDA7CkBAIC0zNjQsMTIgKzM2Niw3IEBAIGk5MTVfZ2Vt
X3NldF90aWxpbmdfaW9jdGwoc3RydWN0IGRybV9kZXZpY2UgKmRldiwgdm9pZCAqZGF0YSwKIAkJ
fQogCX0KIAotCWVyciA9IG11dGV4X2xvY2tfaW50ZXJydXB0aWJsZSgmZGV2LT5zdHJ1Y3RfbXV0
ZXgpOwotCWlmIChlcnIpCi0JCWdvdG8gZXJyOwotCiAJZXJyID0gaTkxNV9nZW1fb2JqZWN0X3Nl
dF90aWxpbmcob2JqLCBhcmdzLT50aWxpbmdfbW9kZSwgYXJncy0+c3RyaWRlKTsKLQltdXRleF91
bmxvY2soJmRldi0+c3RydWN0X211dGV4KTsKIAogCS8qIFdlIGhhdmUgdG8gbWFpbnRhaW4gdGhp
cyBleGlzdGluZyBBQkkuLi4gKi8KIAlhcmdzLT5zdHJpZGUgPSBpOTE1X2dlbV9vYmplY3RfZ2V0
X3N0cmlkZShvYmopOwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVf
Z2VtX3VzZXJwdHIuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV91c2VycHRy
LmMKaW5kZXggNzRkYTM1NjExZDdjLi5jZDM2MjM2ZTNmYWYgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMv
Z3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV91c2VycHRyLmMKKysrIGIvZHJpdmVycy9ncHUvZHJt
L2k5MTUvZ2VtL2k5MTVfZ2VtX3VzZXJwdHIuYwpAQCAtOTIsNyArOTIsNiBAQCB1c2VycHRyX21u
X2ludmFsaWRhdGVfcmFuZ2Vfc3RhcnQoc3RydWN0IG1tdV9ub3RpZmllciAqX21uLAogCXN0cnVj
dCBpOTE1X21tdV9ub3RpZmllciAqbW4gPQogCQljb250YWluZXJfb2YoX21uLCBzdHJ1Y3QgaTkx
NV9tbXVfbm90aWZpZXIsIG1uKTsKIAlzdHJ1Y3QgaW50ZXJ2YWxfdHJlZV9ub2RlICppdDsKLQlz
dHJ1Y3QgbXV0ZXggKnVubG9jayA9IE5VTEw7CiAJdW5zaWduZWQgbG9uZyBlbmQ7CiAJaW50IHJl
dCA9IDA7CiAKQEAgLTEyOSwzMyArMTI4LDEzIEBAIHVzZXJwdHJfbW5faW52YWxpZGF0ZV9yYW5n
ZV9zdGFydChzdHJ1Y3QgbW11X25vdGlmaWVyICpfbW4sCiAJCX0KIAkJc3Bpbl91bmxvY2soJm1u
LT5sb2NrKTsKIAotCQlpZiAoIXVubG9jaykgewotCQkJdW5sb2NrID0gJm1uLT5tbS0+aTkxNS0+
ZHJtLnN0cnVjdF9tdXRleDsKLQotCQkJc3dpdGNoIChtdXRleF90cnlsb2NrX3JlY3Vyc2l2ZSh1
bmxvY2spKSB7Ci0JCQlkZWZhdWx0OgotCQkJY2FzZSBNVVRFWF9UUllMT0NLX0ZBSUxFRDoKLQkJ
CQlpZiAobXV0ZXhfbG9ja19raWxsYWJsZV9uZXN0ZWQodW5sb2NrLCBJOTE1X01NX1NIUklOS0VS
KSkgewotCQkJCQlpOTE1X2dlbV9vYmplY3RfcHV0KG9iaik7Ci0JCQkJCXJldHVybiAtRUlOVFI7
Ci0JCQkJfQotCQkJCS8qIGZhbGwgdGhyb3VnaCAqLwotCQkJY2FzZSBNVVRFWF9UUllMT0NLX1NV
Q0NFU1M6Ci0JCQkJYnJlYWs7Ci0KLQkJCWNhc2UgTVVURVhfVFJZTE9DS19SRUNVUlNJVkU6Ci0J
CQkJdW5sb2NrID0gRVJSX1BUUigtRUVYSVNUKTsKLQkJCQlicmVhazsKLQkJCX0KLQkJfQotCiAJ
CXJldCA9IGk5MTVfZ2VtX29iamVjdF91bmJpbmQob2JqLAogCQkJCQkgICAgIEk5MTVfR0VNX09C
SkVDVF9VTkJJTkRfQUNUSVZFKTsKIAkJaWYgKHJldCA9PSAwKQogCQkJcmV0ID0gX19pOTE1X2dl
bV9vYmplY3RfcHV0X3BhZ2VzKG9iaiwgSTkxNV9NTV9TSFJJTktFUik7CiAJCWk5MTVfZ2VtX29i
amVjdF9wdXQob2JqKTsKIAkJaWYgKHJldCkKLQkJCWdvdG8gdW5sb2NrOworCQkJcmV0dXJuIHJl
dDsKIAogCQlzcGluX2xvY2soJm1uLT5sb2NrKTsKIApAQCAtMTY4LDEwICsxNDcsNiBAQCB1c2Vy
cHRyX21uX2ludmFsaWRhdGVfcmFuZ2Vfc3RhcnQoc3RydWN0IG1tdV9ub3RpZmllciAqX21uLAog
CX0KIAlzcGluX3VubG9jaygmbW4tPmxvY2spOwogCi11bmxvY2s6Ci0JaWYgKCFJU19FUlJfT1Jf
TlVMTCh1bmxvY2spKQotCQltdXRleF91bmxvY2sodW5sb2NrKTsKLQogCXJldHVybiByZXQ7CiAK
IH0KZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9zZWxmdGVzdHMvaHVnZV9w
YWdlcy5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL3NlbGZ0ZXN0cy9odWdlX3BhZ2VzLmMK
aW5kZXggYzVjZWE0Mzc5MjE2Li5jZDc3MTE0N2I0MWYgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1
L2RybS9pOTE1L2dlbS9zZWxmdGVzdHMvaHVnZV9wYWdlcy5jCisrKyBiL2RyaXZlcnMvZ3B1L2Ry
bS9pOTE1L2dlbS9zZWxmdGVzdHMvaHVnZV9wYWdlcy5jCkBAIC0yNSw2ICsyNSwxNyBAQCBzdGF0
aWMgY29uc3QgdW5zaWduZWQgaW50IHBhZ2Vfc2l6ZXNbXSA9IHsKIAlJOTE1X0dUVF9QQUdFX1NJ
WkVfNEssCiB9OwogCitzdGF0aWMgaW50IHVubG9ja2VkX3ZtYV91bmJpbmQoc3RydWN0IGk5MTVf
dm1hICp2bWEpCit7CisJaW50IHJldDsKKworCW11dGV4X2xvY2soJnZtYS0+dm0tPm11dGV4KTsK
KwlyZXQgPSBpOTE1X3ZtYV91bmJpbmQodm1hKTsKKwltdXRleF91bmxvY2soJnZtYS0+dm0tPm11
dGV4KTsKKworCXJldHVybiByZXQ7Cit9CisKIHN0YXRpYyB1bnNpZ25lZCBpbnQgZ2V0X2xhcmdl
c3RfcGFnZV9zaXplKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LAogCQkJCQkgIHU2NCBy
ZW0pCiB7CkBAIC0zMzMsNyArMzQ0LDExIEBAIHN0YXRpYyBpbnQgaWd0X2NoZWNrX3BhZ2Vfc2l6
ZXMoc3RydWN0IGk5MTVfdm1hICp2bWEpCiAJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUg
PSB2bWEtPnZtLT5pOTE1OwogCXVuc2lnbmVkIGludCBzdXBwb3J0ZWQgPSBJTlRFTF9JTkZPKGk5
MTUpLT5wYWdlX3NpemVzOwogCXN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmogPSB2bWEt
Pm9iajsKLQlpbnQgZXJyID0gMDsKKwlpbnQgZXJyOworCisJZXJyID0gaTkxNV9hY3RpdmVfd2Fp
dCgmdm1hLT5hY3RpdmUpOworCWlmIChlcnIpCisJCXJldHVybiBlcnI7CiAKIAlpZiAoIUhBU19Q
QUdFX1NJWkVTKGk5MTUsIHZtYS0+cGFnZV9zaXplcy5zZykpIHsKIAkJcHJfZXJyKCJ1bnN1cHBv
cnRlZCBwYWdlX3NpemVzLnNnPSV1LCBzdXBwb3J0ZWQ9JXVcbiIsCkBAIC01MjYsNyArNTQxLDcg
QEAgc3RhdGljIGludCBpZ3RfbW9ja19wcGd0dF9taXNhbGlnbmVkX2RtYSh2b2lkICphcmcpCiAJ
CSAqIHBhZ2VzLgogCQkgKi8KIAkJZm9yIChvZmZzZXQgPSA0MDk2OyBvZmZzZXQgPCBwYWdlX3Np
emU7IG9mZnNldCArPSA0MDk2KSB7Ci0JCQllcnIgPSBpOTE1X3ZtYV91bmJpbmQodm1hKTsKKwkJ
CWVyciA9IHVubG9ja2VkX3ZtYV91bmJpbmQodm1hKTsKIAkJCWlmIChlcnIpIHsKIAkJCQlpOTE1
X3ZtYV9jbG9zZSh2bWEpOwogCQkJCWdvdG8gb3V0X3VucGluOwpAQCAtOTQxLDcgKzk1Niw3IEBA
IHN0YXRpYyBpbnQgX19pZ3Rfd3JpdGVfaHVnZShzdHJ1Y3QgaW50ZWxfY29udGV4dCAqY2UsCiAJ
aWYgKElTX0VSUih2bWEpKQogCQlyZXR1cm4gUFRSX0VSUih2bWEpOwogCi0JZXJyID0gaTkxNV92
bWFfdW5iaW5kKHZtYSk7CisJZXJyID0gdW5sb2NrZWRfdm1hX3VuYmluZCh2bWEpOwogCWlmIChl
cnIpCiAJCWdvdG8gb3V0X3ZtYV9jbG9zZTsKIApAQCAtMTM5MCw3ICsxNDA1LDcgQEAgc3RhdGlj
IGludCBpZ3RfcHBndHRfcGluX3VwZGF0ZSh2b2lkICphcmcpCiAJCQlnb3RvIG91dF91bnBpbjsK
IAkJfQogCi0JCWVyciA9IGk5MTVfdm1hX2JpbmQodm1hLCBJOTE1X0NBQ0hFX05PTkUsIFBJTl9V
UERBVEUpOworCQllcnIgPSBpOTE1X3ZtYV9iaW5kKHZtYSwgSTkxNV9DQUNIRV9OT05FLCBQSU5f
VVBEQVRFLCBOVUxMKTsKIAkJaWYgKGVycikKIAkJCWdvdG8gb3V0X3VucGluOwogCmRpZmYgLS1n
aXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vc2VsZnRlc3RzL2k5MTVfZ2VtX2NvbnRleHQu
YyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9zZWxmdGVzdHMvaTkxNV9nZW1fY29udGV4dC5j
CmluZGV4IGRhNTRhNzE4YzcxMi4uYWE2N2MwMmJhOThjIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dw
dS9kcm0vaTkxNS9nZW0vc2VsZnRlc3RzL2k5MTVfZ2VtX2NvbnRleHQuYworKysgYi9kcml2ZXJz
L2dwdS9kcm0vaTkxNS9nZW0vc2VsZnRlc3RzL2k5MTVfZ2VtX2NvbnRleHQuYwpAQCAtNzQ3LDEw
ICs3NDcsNyBAQCBlbWl0X3JwY3NfcXVlcnkoc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9i
aiwKIAlpZiAoZXJyKQogCQlnb3RvIHNraXBfcmVxdWVzdDsKIAotCWk5MTVfdm1hX3VucGluKGJh
dGNoKTsKLQlpOTE1X3ZtYV9jbG9zZShiYXRjaCk7Ci0JaTkxNV92bWFfcHV0KGJhdGNoKTsKLQor
CWk5MTVfdm1hX3VucGluX2FuZF9yZWxlYXNlKCZiYXRjaCwgMCk7CiAJaTkxNV92bWFfdW5waW4o
dm1hKTsKIAogCSpycV9vdXQgPSBpOTE1X3JlcXVlc3RfZ2V0KHJxKTsKQEAgLTc2NCw4ICs3NjEs
NyBAQCBlbWl0X3JwY3NfcXVlcnkoc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iaiwKIGVy
cl9yZXF1ZXN0OgogCWk5MTVfcmVxdWVzdF9hZGQocnEpOwogZXJyX2JhdGNoOgotCWk5MTVfdm1h
X3VucGluKGJhdGNoKTsKLQlpOTE1X3ZtYV9wdXQoYmF0Y2gpOworCWk5MTVfdm1hX3VucGluX2Fu
ZF9yZWxlYXNlKCZiYXRjaCwgMCk7CiBlcnJfdm1hOgogCWk5MTVfdm1hX3VucGluKHZtYSk7CiAK
QEAgLTEzMDksOSArMTMwNSw3IEBAIHN0YXRpYyBpbnQgd3JpdGVfdG9fc2NyYXRjaChzdHJ1Y3Qg
aTkxNV9nZW1fY29udGV4dCAqY3R4LAogCWlmIChlcnIpCiAJCWdvdG8gc2tpcF9yZXF1ZXN0Owog
Ci0JaTkxNV92bWFfdW5waW4odm1hKTsKLQlpOTE1X3ZtYV9jbG9zZSh2bWEpOwotCWk5MTVfdm1h
X3B1dCh2bWEpOworCWk5MTVfdm1hX3VucGluX2FuZF9yZWxlYXNlKCZ2bWEsIDApOwogCiAJaTkx
NV9yZXF1ZXN0X2FkZChycSk7CiAKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dl
bS9zZWxmdGVzdHMvaTkxNV9nZW1fbW1hbi5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL3Nl
bGZ0ZXN0cy9pOTE1X2dlbV9tbWFuLmMKaW5kZXggMWQyN2JhYmZmMGNlLi45YzIxN2RmZTk2YTkg
MTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9zZWxmdGVzdHMvaTkxNV9nZW1f
bW1hbi5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9zZWxmdGVzdHMvaTkxNV9nZW1f
bW1hbi5jCkBAIC0yMDUsNyArMjA1LDYgQEAgc3RhdGljIGludCBpZ3RfcGFydGlhbF90aWxpbmco
dm9pZCAqYXJnKQogCQlnb3RvIG91dDsKIAl9CiAKLQltdXRleF9sb2NrKCZpOTE1LT5kcm0uc3Ry
dWN0X211dGV4KTsKIAl3YWtlcmVmID0gaW50ZWxfcnVudGltZV9wbV9nZXQoJmk5MTUtPnJ1bnRp
bWVfcG0pOwogCiAJaWYgKDEpIHsKQEAgLTMxOCw3ICszMTcsNiBAQCBuZXh0X3RpbGluZzogOwog
CiBvdXRfdW5sb2NrOgogCWludGVsX3J1bnRpbWVfcG1fcHV0KCZpOTE1LT5ydW50aW1lX3BtLCB3
YWtlcmVmKTsKLQltdXRleF91bmxvY2soJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwogCWk5MTVf
Z2VtX29iamVjdF91bnBpbl9wYWdlcyhvYmopOwogb3V0OgogCWk5MTVfZ2VtX29iamVjdF9wdXQo
b2JqKTsKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9zZWxmdGVzdHMvaWd0
X2dlbV91dGlscy5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL3NlbGZ0ZXN0cy9pZ3RfZ2Vt
X3V0aWxzLmMKaW5kZXggZWU1ZGMxM2EzMGIzLi42NzE4ZGEyMGYzNWQgMTAwNjQ0Ci0tLSBhL2Ry
aXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9zZWxmdGVzdHMvaWd0X2dlbV91dGlscy5jCisrKyBiL2Ry
aXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9zZWxmdGVzdHMvaWd0X2dlbV91dGlscy5jCkBAIC0xNTQs
OSArMTU0LDcgQEAgaW50IGlndF9ncHVfZmlsbF9kdyhzdHJ1Y3QgaW50ZWxfY29udGV4dCAqY2Us
CiAKIAlpOTE1X3JlcXVlc3RfYWRkKHJxKTsKIAotCWk5MTVfdm1hX3VucGluKGJhdGNoKTsKLQlp
OTE1X3ZtYV9jbG9zZShiYXRjaCk7Ci0JaTkxNV92bWFfcHV0KGJhdGNoKTsKKwlpOTE1X3ZtYV91
bnBpbl9hbmRfcmVsZWFzZSgmYmF0Y2gsIDApOwogCiAJcmV0dXJuIDA7CiAKQEAgLTE2NSw3ICsx
NjMsNiBAQCBpbnQgaWd0X2dwdV9maWxsX2R3KHN0cnVjdCBpbnRlbF9jb250ZXh0ICpjZSwKIGVy
cl9yZXF1ZXN0OgogCWk5MTVfcmVxdWVzdF9hZGQocnEpOwogZXJyX2JhdGNoOgotCWk5MTVfdm1h
X3VucGluKGJhdGNoKTsKLQlpOTE1X3ZtYV9wdXQoYmF0Y2gpOworCWk5MTVfdm1hX3VucGluX2Fu
ZF9yZWxlYXNlKCZiYXRjaCwgMCk7CiAJcmV0dXJuIGVycjsKIH0KZGlmZiAtLWdpdCBhL2RyaXZl
cnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2d0LmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9p
bnRlbF9ndC5jCmluZGV4IGQ0OGVjOWE3NmVkMS4uYzJhZmZmYjk0NDc0IDEwMDY0NAotLS0gYS9k
cml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9ndC5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9p
OTE1L2d0L2ludGVsX2d0LmMKQEAgLTIwNywxMSArMjA3LDEyIEBAIHZvaWQgaW50ZWxfZ3RfZmx1
c2hfZ2d0dF93cml0ZXMoc3RydWN0IGludGVsX2d0ICpndCkKIAogCXdpdGhfaW50ZWxfcnVudGlt
ZV9wbSgmaTkxNS0+cnVudGltZV9wbSwgd2FrZXJlZikgewogCQlzdHJ1Y3QgaW50ZWxfdW5jb3Jl
ICp1bmNvcmUgPSBndC0+dW5jb3JlOworCQl1bnNpZ25lZCBsb25nIGZsYWdzOwogCi0JCXNwaW5f
bG9ja19pcnEoJnVuY29yZS0+bG9jayk7CisJCXNwaW5fbG9ja19pcnFzYXZlKCZ1bmNvcmUtPmxv
Y2ssIGZsYWdzKTsKIAkJaW50ZWxfdW5jb3JlX3Bvc3RpbmdfcmVhZF9mdyh1bmNvcmUsCiAJCQkJ
CSAgICAgUklOR19IRUFEKFJFTkRFUl9SSU5HX0JBU0UpKTsKLQkJc3Bpbl91bmxvY2tfaXJxKCZ1
bmNvcmUtPmxvY2spOworCQlzcGluX3VubG9ja19pcnFyZXN0b3JlKCZ1bmNvcmUtPmxvY2ssIGZs
YWdzKTsKIAl9CiB9CiAKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVs
X3JpbmdidWZmZXIuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX3JpbmdidWZmZXIu
YwppbmRleCBhYzU1YTBkMDU0YmQuLjg1NWU5N2NjYWY5ZiAxMDA2NDQKLS0tIGEvZHJpdmVycy9n
cHUvZHJtL2k5MTUvZ3QvaW50ZWxfcmluZ2J1ZmZlci5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9p
OTE1L2d0L2ludGVsX3JpbmdidWZmZXIuYwpAQCAtMTMzNiwxNSArMTMzNiwxMyBAQCB2b2lkIGlu
dGVsX3JpbmdfZnJlZShzdHJ1Y3Qga3JlZiAqcmVmKQogewogCXN0cnVjdCBpbnRlbF9yaW5nICpy
aW5nID0gY29udGFpbmVyX29mKHJlZiwgdHlwZW9mKCpyaW5nKSwgcmVmKTsKIAotCWk5MTVfdm1h
X2Nsb3NlKHJpbmctPnZtYSk7CiAJaTkxNV92bWFfcHV0KHJpbmctPnZtYSk7Ci0KIAlrZnJlZShy
aW5nKTsKIH0KIAogc3RhdGljIHZvaWQgX19yaW5nX2NvbnRleHRfZmluaShzdHJ1Y3QgaW50ZWxf
Y29udGV4dCAqY2UpCiB7Ci0JaTkxNV9nZW1fb2JqZWN0X3B1dChjZS0+c3RhdGUtPm9iaik7CisJ
aTkxNV92bWFfcHV0KGNlLT5zdGF0ZSk7CiB9CiAKIHN0YXRpYyB2b2lkIHJpbmdfY29udGV4dF9k
ZXN0cm95KHN0cnVjdCBrcmVmICpyZWYpCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkx
NS9ndC9zZWxmdGVzdF9oYW5nY2hlY2suYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L3NlbGZ0
ZXN0X2hhbmdjaGVjay5jCmluZGV4IGEwMDk4ZmMzNTkyMS4uZTUzZWVhMTA1MGY4IDEwMDY0NAot
LS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9zZWxmdGVzdF9oYW5nY2hlY2suYworKysgYi9k
cml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9zZWxmdGVzdF9oYW5nY2hlY2suYwpAQCAtMTEyNywxNSAr
MTEyNywxNCBAQCBzdGF0aWMgaW50IGV2aWN0X3ZtYSh2b2lkICpkYXRhKQogewogCXN0cnVjdCBl
dmljdF92bWEgKmFyZyA9IGRhdGE7CiAJc3RydWN0IGk5MTVfYWRkcmVzc19zcGFjZSAqdm0gPSBh
cmctPnZtYS0+dm07Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSB2bS0+aTkxNTsK
IAlzdHJ1Y3QgZHJtX21tX25vZGUgZXZpY3QgPSBhcmctPnZtYS0+bm9kZTsKIAlpbnQgZXJyOwog
CiAJY29tcGxldGUoJmFyZy0+Y29tcGxldGlvbik7CiAKLQltdXRleF9sb2NrKCZpOTE1LT5kcm0u
c3RydWN0X211dGV4KTsKKwltdXRleF9sb2NrKCZ2bS0+bXV0ZXgpOwogCWVyciA9IGk5MTVfZ2Vt
X2V2aWN0X2Zvcl9ub2RlKHZtLCAmZXZpY3QsIDApOwotCW11dGV4X3VubG9jaygmaTkxNS0+ZHJt
LnN0cnVjdF9tdXRleCk7CisJbXV0ZXhfdW5sb2NrKCZ2bS0+bXV0ZXgpOwogCiAJcmV0dXJuIGVy
cjsKIH0KQEAgLTExNDMsMzkgKzExNDIsMzMgQEAgc3RhdGljIGludCBldmljdF92bWEodm9pZCAq
ZGF0YSkKIHN0YXRpYyBpbnQgZXZpY3RfZmVuY2Uodm9pZCAqZGF0YSkKIHsKIAlzdHJ1Y3QgZXZp
Y3Rfdm1hICphcmcgPSBkYXRhOwotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0gYXJn
LT52bWEtPnZtLT5pOTE1OwogCWludCBlcnI7CiAKIAljb21wbGV0ZSgmYXJnLT5jb21wbGV0aW9u
KTsKIAotCW11dGV4X2xvY2soJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwotCiAJLyogTWFyayB0
aGUgZmVuY2UgcmVnaXN0ZXIgYXMgZGlydHkgdG8gZm9yY2UgdGhlIG1taW8gdXBkYXRlLiAqLwog
CWVyciA9IGk5MTVfZ2VtX29iamVjdF9zZXRfdGlsaW5nKGFyZy0+dm1hLT5vYmosIEk5MTVfVElM
SU5HX1ksIDUxMik7CiAJaWYgKGVycikgewogCQlwcl9lcnIoIkludmFsaWQgWS10aWxpbmcgc2V0
dGluZ3M7IGVycjolZFxuIiwgZXJyKTsKLQkJZ290byBvdXRfdW5sb2NrOworCQlyZXR1cm4gZXJy
OwogCX0KIAogCWVyciA9IGk5MTVfdm1hX3BpbihhcmctPnZtYSwgMCwgMCwgUElOX0dMT0JBTCB8
IFBJTl9NQVBQQUJMRSk7CiAJaWYgKGVycikgewogCQlwcl9lcnIoIlVuYWJsZSB0byBwaW4gdm1h
IGZvciBZLXRpbGVkIGZlbmNlOyBlcnI6JWRcbiIsIGVycik7Ci0JCWdvdG8gb3V0X3VubG9jazsK
KwkJcmV0dXJuIGVycjsKIAl9CiAKIAllcnIgPSBpOTE1X3ZtYV9waW5fZmVuY2UoYXJnLT52bWEp
OwogCWk5MTVfdm1hX3VucGluKGFyZy0+dm1hKTsKIAlpZiAoZXJyKSB7CiAJCXByX2VycigiVW5h
YmxlIHRvIHBpbiBZLXRpbGVkIGZlbmNlOyBlcnI6JWRcbiIsIGVycik7Ci0JCWdvdG8gb3V0X3Vu
bG9jazsKKwkJcmV0dXJuIGVycjsKIAl9CiAKIAlpOTE1X3ZtYV91bnBpbl9mZW5jZShhcmctPnZt
YSk7CiAKLW91dF91bmxvY2s6Ci0JbXV0ZXhfdW5sb2NrKCZpOTE1LT5kcm0uc3RydWN0X211dGV4
KTsKLQotCXJldHVybiBlcnI7CisJcmV0dXJuIDA7CiB9CiAKIHN0YXRpYyBpbnQgX19pZ3RfcmVz
ZXRfZXZpY3Rfdm1hKHN0cnVjdCBpbnRlbF9ndCAqZ3QsCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dw
dS9kcm0vaTkxNS9ndnQvYXBlcnR1cmVfZ20uYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d2dC9h
cGVydHVyZV9nbS5jCmluZGV4IDVmZjI0MzdiMjk5OC4uZDk5NmJiYzdlYTU5IDEwMDY0NAotLS0g
YS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndnQvYXBlcnR1cmVfZ20uYworKysgYi9kcml2ZXJzL2dw
dS9kcm0vaTkxNS9ndnQvYXBlcnR1cmVfZ20uYwpAQCAtNjEsMTQgKzYxLDE0IEBAIHN0YXRpYyBp
bnQgYWxsb2NfZ20oc3RydWN0IGludGVsX3ZncHUgKnZncHUsIGJvb2wgaGlnaF9nbSkKIAkJZmxh
Z3MgPSBQSU5fTUFQUEFCTEU7CiAJfQogCi0JbXV0ZXhfbG9jaygmZGV2X3ByaXYtPmRybS5zdHJ1
Y3RfbXV0ZXgpOworCW11dGV4X2xvY2soJmRldl9wcml2LT5nZ3R0LnZtLm11dGV4KTsKIAltbWlv
X2h3X2FjY2Vzc19wcmUoZGV2X3ByaXYpOwogCXJldCA9IGk5MTVfZ2VtX2d0dF9pbnNlcnQoJmRl
dl9wcml2LT5nZ3R0LnZtLCBub2RlLAogCQkJCSAgc2l6ZSwgSTkxNV9HVFRfUEFHRV9TSVpFLAog
CQkJCSAgSTkxNV9DT0xPUl9VTkVWSUNUQUJMRSwKIAkJCQkgIHN0YXJ0LCBlbmQsIGZsYWdzKTsK
IAltbWlvX2h3X2FjY2Vzc19wb3N0KGRldl9wcml2KTsKLQltdXRleF91bmxvY2soJmRldl9wcml2
LT5kcm0uc3RydWN0X211dGV4KTsKKwltdXRleF91bmxvY2soJmRldl9wcml2LT5nZ3R0LnZtLm11
dGV4KTsKIAlpZiAocmV0KQogCQlndnRfZXJyKCJmYWlsIHRvIGFsbG9jICVzIGdtIHNwYWNlIGZy
b20gaG9zdFxuIiwKIAkJCWhpZ2hfZ20gPyAiaGlnaCIgOiAibG93Iik7CkBAIC05OCw5ICs5OCw5
IEBAIHN0YXRpYyBpbnQgYWxsb2NfdmdwdV9nbShzdHJ1Y3QgaW50ZWxfdmdwdSAqdmdwdSkKIAog
CXJldHVybiAwOwogb3V0X2ZyZWVfYXBlcnR1cmU6Ci0JbXV0ZXhfbG9jaygmZGV2X3ByaXYtPmRy
bS5zdHJ1Y3RfbXV0ZXgpOworCW11dGV4X2xvY2soJmRldl9wcml2LT5nZ3R0LnZtLm11dGV4KTsK
IAlkcm1fbW1fcmVtb3ZlX25vZGUoJnZncHUtPmdtLmxvd19nbV9ub2RlKTsKLQltdXRleF91bmxv
Y2soJmRldl9wcml2LT5kcm0uc3RydWN0X211dGV4KTsKKwltdXRleF91bmxvY2soJmRldl9wcml2
LT5nZ3R0LnZtLm11dGV4KTsKIAlyZXR1cm4gcmV0OwogfQogCkBAIC0xMDgsMTAgKzEwOCwxMCBA
QCBzdGF0aWMgdm9pZCBmcmVlX3ZncHVfZ20oc3RydWN0IGludGVsX3ZncHUgKnZncHUpCiB7CiAJ
c3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdmdwdS0+Z3Z0LT5kZXZfcHJpdjsK
IAotCW11dGV4X2xvY2soJmRldl9wcml2LT5kcm0uc3RydWN0X211dGV4KTsKKwltdXRleF9sb2Nr
KCZkZXZfcHJpdi0+Z2d0dC52bS5tdXRleCk7CiAJZHJtX21tX3JlbW92ZV9ub2RlKCZ2Z3B1LT5n
bS5sb3dfZ21fbm9kZSk7CiAJZHJtX21tX3JlbW92ZV9ub2RlKCZ2Z3B1LT5nbS5oaWdoX2dtX25v
ZGUpOwotCW11dGV4X3VubG9jaygmZGV2X3ByaXYtPmRybS5zdHJ1Y3RfbXV0ZXgpOworCW11dGV4
X3VubG9jaygmZGV2X3ByaXYtPmdndHQudm0ubXV0ZXgpOwogfQogCiAvKioKZGlmZiAtLWdpdCBh
L2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfYWN0aXZlLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkx
NS9pOTE1X2FjdGl2ZS5jCmluZGV4IDZhNDQ3ZjFkMDExMC4uNmEzN2VkNTI5NTdhIDEwMDY0NAot
LS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2FjdGl2ZS5jCisrKyBiL2RyaXZlcnMvZ3B1
L2RybS9pOTE1L2k5MTVfYWN0aXZlLmMKQEAgLTE0Niw2ICsxNDYsNyBAQCBfX2FjdGl2ZV9yZXRp
cmUoc3RydWN0IGk5MTVfYWN0aXZlICpyZWYpCiAJaWYgKCFyZXRpcmUpCiAJCXJldHVybjsKIAor
CUdFTV9CVUdfT04ocmN1X2FjY2Vzc19wb2ludGVyKHJlZi0+ZXhjbCkpOwogCXJidHJlZV9wb3N0
b3JkZXJfZm9yX2VhY2hfZW50cnlfc2FmZShpdCwgbiwgJnJvb3QsIG5vZGUpIHsKIAkJR0VNX0JV
R19PTihpOTE1X2FjdGl2ZV9yZXF1ZXN0X2lzc2V0KCZpdC0+YmFzZSkpOwogCQlrbWVtX2NhY2hl
X2ZyZWUoZ2xvYmFsLnNsYWJfY2FjaGUsIGl0KTsKQEAgLTI0NSw2ICsyNDYsOCBAQCB2b2lkIF9f
aTkxNV9hY3RpdmVfaW5pdChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwKIAlyZWYtPmZs
YWdzID0gMDsKIAlyZWYtPmFjdGl2ZSA9IGFjdGl2ZTsKIAlyZWYtPnJldGlyZSA9IHJldGlyZTsK
KworCXJlZi0+ZXhjbCA9IE5VTEw7CiAJcmVmLT50cmVlID0gUkJfUk9PVDsKIAlyZWYtPmNhY2hl
ID0gTlVMTDsKIAlpbml0X2xsaXN0X2hlYWQoJnJlZi0+cHJlYWxsb2NhdGVkX2JhcnJpZXJzKTsK
QEAgLTM0MSw2ICszNDQsNDUgQEAgaW50IGk5MTVfYWN0aXZlX3JlZihzdHJ1Y3QgaTkxNV9hY3Rp
dmUgKnJlZiwKIAlyZXR1cm4gZXJyOwogfQogCitzdGF0aWMgdm9pZCBleGNsX2NiKHN0cnVjdCBk
bWFfZmVuY2UgKmYsIHN0cnVjdCBkbWFfZmVuY2VfY2IgKmNiKQoreworCXN0cnVjdCBpOTE1X2Fj
dGl2ZSAqcmVmID0gY29udGFpbmVyX29mKGNiLCB0eXBlb2YoKnJlZiksIGV4Y2xfY2IpOworCisJ
UkNVX0lOSVRfUE9JTlRFUihyZWYtPmV4Y2wsIE5VTEwpOworCWRtYV9mZW5jZV9wdXQoZik7CisK
KwlhY3RpdmVfcmV0aXJlKHJlZik7Cit9CisKK3ZvaWQgaTkxNV9hY3RpdmVfc2V0X2V4Y2x1c2l2
ZShzdHJ1Y3QgaTkxNV9hY3RpdmUgKnJlZiwgc3RydWN0IGRtYV9mZW5jZSAqZikKK3sKKwlHRU1f
QlVHX09OKGk5MTVfYWN0aXZlX2lzX2lkbGUocmVmKSk7CisKKwlkbWFfZmVuY2VfZ2V0KGYpOwor
CisJcmN1X3JlYWRfbG9jaygpOworCWlmIChyY3VfYWNjZXNzX3BvaW50ZXIocmVmLT5leGNsKSkg
eworCQlzdHJ1Y3QgZG1hX2ZlbmNlICpvbGQ7CisKKwkJb2xkID0gZG1hX2ZlbmNlX2dldF9yY3Vf
c2FmZSgmcmVmLT5leGNsKTsKKwkJaWYgKG9sZCkgeworCQkJaWYgKGRtYV9mZW5jZV9yZW1vdmVf
Y2FsbGJhY2sob2xkLCAmcmVmLT5leGNsX2NiKSkKKwkJCQlhdG9taWNfZGVjKCZyZWYtPmNvdW50
KTsKKwkJCWRtYV9mZW5jZV9wdXQob2xkKTsKKwkJfQorCX0KKwlyY3VfcmVhZF91bmxvY2soKTsK
KworCWF0b21pY19pbmMoJnJlZi0+Y291bnQpOworCXJjdV9hc3NpZ25fcG9pbnRlcihyZWYtPmV4
Y2wsIGYpOworCisJaWYgKGRtYV9mZW5jZV9hZGRfY2FsbGJhY2soZiwgJnJlZi0+ZXhjbF9jYiwg
ZXhjbF9jYikpIHsKKwkJUkNVX0lOSVRfUE9JTlRFUihyZWYtPmV4Y2wsIE5VTEwpOworCQlhdG9t
aWNfZGVjKCZyZWYtPmNvdW50KTsKKwkJZG1hX2ZlbmNlX3B1dChmKTsKKwl9Cit9CisKIGludCBp
OTE1X2FjdGl2ZV9hY3F1aXJlKHN0cnVjdCBpOTE1X2FjdGl2ZSAqcmVmKQogewogCWludCBlcnI7
CkBAIC0zOTksNiArNDQxLDI1IEBAIHZvaWQgaTkxNV9hY3RpdmVfdW5ncmFiKHN0cnVjdCBpOTE1
X2FjdGl2ZSAqcmVmKQogCV9fYWN0aXZlX3VuZ3JhYihyZWYpOwogfQogCitzdGF0aWMgaW50IGV4
Y2xfd2FpdChzdHJ1Y3QgaTkxNV9hY3RpdmUgKnJlZikKK3sKKwlzdHJ1Y3QgZG1hX2ZlbmNlICpv
bGQ7CisJaW50IGVyciA9IDA7CisKKwlpZiAoIXJjdV9hY2Nlc3NfcG9pbnRlcihyZWYtPmV4Y2wp
KQorCQlyZXR1cm4gMDsKKworCXJjdV9yZWFkX2xvY2soKTsKKwlvbGQgPSBkbWFfZmVuY2VfZ2V0
X3JjdV9zYWZlKCZyZWYtPmV4Y2wpOworCXJjdV9yZWFkX3VubG9jaygpOworCWlmIChvbGQpIHsK
KwkJZXJyID0gZG1hX2ZlbmNlX3dhaXQob2xkLCB0cnVlKTsKKwkJZG1hX2ZlbmNlX3B1dChvbGQp
OworCX0KKworCXJldHVybiBlcnI7Cit9CisKIGludCBpOTE1X2FjdGl2ZV93YWl0KHN0cnVjdCBp
OTE1X2FjdGl2ZSAqcmVmKQogewogCXN0cnVjdCBhY3RpdmVfbm9kZSAqaXQsICpuOwpAQCAtNDE5
LDYgKzQ4MCwxMCBAQCBpbnQgaTkxNV9hY3RpdmVfd2FpdChzdHJ1Y3QgaTkxNV9hY3RpdmUgKnJl
ZikKIAkJcmV0dXJuIDA7CiAJfQogCisJZXJyID0gZXhjbF93YWl0KHJlZik7CisJaWYgKGVycikK
KwkJZ290byBvdXQ7CisKIAlyYnRyZWVfcG9zdG9yZGVyX2Zvcl9lYWNoX2VudHJ5X3NhZmUoaXQs
IG4sICZyZWYtPnRyZWUsIG5vZGUpIHsKIAkJaWYgKGlzX2JhcnJpZXIoJml0LT5iYXNlKSkgeyAv
KiB1bmNvbm5lY3RlZCBpZGxlLWJhcnJpZXIgKi8KIAkJCWVyciA9IC1FQlVTWTsKQEAgLTQzMCw2
ICs0OTUsNyBAQCBpbnQgaTkxNV9hY3RpdmVfd2FpdChzdHJ1Y3QgaTkxNV9hY3RpdmUgKnJlZikK
IAkJCWJyZWFrOwogCX0KIAorb3V0OgogCV9fYWN0aXZlX3JldGlyZShyZWYpOwogCWlmIChlcnIp
CiAJCXJldHVybiBlcnI7CkBAIC00NTQsMjYgKzUyMCwyMiBAQCBpbnQgaTkxNV9yZXF1ZXN0X2F3
YWl0X2FjdGl2ZV9yZXF1ZXN0KHN0cnVjdCBpOTE1X3JlcXVlc3QgKnJxLAogCiBpbnQgaTkxNV9y
ZXF1ZXN0X2F3YWl0X2FjdGl2ZShzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpycSwgc3RydWN0IGk5MTVf
YWN0aXZlICpyZWYpCiB7Ci0Jc3RydWN0IGFjdGl2ZV9ub2RlICppdCwgKm47Ci0JaW50IGVycjsK
LQotCWlmIChSQl9FTVBUWV9ST09UKCZyZWYtPnRyZWUpKQotCQlyZXR1cm4gMDsKKwlpbnQgZXJy
ID0gMDsKIAotCS8qIGF3YWl0IGFsbG9jYXRlcyBhbmQgc28gd2UgbmVlZCB0byBhdm9pZCBoaXR0
aW5nIHRoZSBzaHJpbmtlciAqLwotCWVyciA9IGk5MTVfYWN0aXZlX2FjcXVpcmUocmVmKTsKLQlp
ZiAoZXJyKQotCQlyZXR1cm4gZXJyOworCWlmIChyY3VfYWNjZXNzX3BvaW50ZXIocmVmLT5leGNs
KSkgeworCQlzdHJ1Y3QgZG1hX2ZlbmNlICpmZW5jZTsKIAotCW11dGV4X2xvY2soJnJlZi0+bXV0
ZXgpOwotCXJidHJlZV9wb3N0b3JkZXJfZm9yX2VhY2hfZW50cnlfc2FmZShpdCwgbiwgJnJlZi0+
dHJlZSwgbm9kZSkgewotCQllcnIgPSBpOTE1X3JlcXVlc3RfYXdhaXRfYWN0aXZlX3JlcXVlc3Qo
cnEsICZpdC0+YmFzZSk7Ci0JCWlmIChlcnIpCi0JCQlicmVhazsKKwkJcmN1X3JlYWRfbG9jaygp
OworCQlmZW5jZSA9IGRtYV9mZW5jZV9nZXRfcmN1X3NhZmUoJnJlZi0+ZXhjbCk7CisJCXJjdV9y
ZWFkX3VubG9jaygpOworCQlpZiAoZmVuY2UpIHsKKwkJCWVyciA9IGk5MTVfcmVxdWVzdF9hd2Fp
dF9kbWFfZmVuY2UocnEsIGZlbmNlKTsKKwkJCWRtYV9mZW5jZV9wdXQoZmVuY2UpOworCQl9CiAJ
fQotCW11dGV4X3VubG9jaygmcmVmLT5tdXRleCk7CiAKLQlpOTE1X2FjdGl2ZV9yZWxlYXNlKHJl
Zik7CisJLyogSW4gdGhlIGZ1dHVyZSB3ZSBtYXkgY2hvb3NlIHRvIGF3YWl0IG9uIGFsbCBmZW5j
ZXMgKi8KKwogCXJldHVybiBlcnI7CiB9CiAKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9p
OTE1L2k5MTVfYWN0aXZlLmggYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2FjdGl2ZS5oCmlu
ZGV4IGY5NTA1OGY5OTA1Ny4uYWYzZDUzNmUyNmZkIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9k
cm0vaTkxNS9pOTE1X2FjdGl2ZS5oCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfYWN0
aXZlLmgKQEAgLTM3Myw2ICszNzMsMTMgQEAgaW50IGk5MTVfYWN0aXZlX3JlZihzdHJ1Y3QgaTkx
NV9hY3RpdmUgKnJlZiwKIAkJICAgIHN0cnVjdCBpbnRlbF90aW1lbGluZSAqdGwsCiAJCSAgICBz
dHJ1Y3QgaTkxNV9yZXF1ZXN0ICpycSk7CiAKK3ZvaWQgaTkxNV9hY3RpdmVfc2V0X2V4Y2x1c2l2
ZShzdHJ1Y3QgaTkxNV9hY3RpdmUgKnJlZiwgc3RydWN0IGRtYV9mZW5jZSAqZik7CisKK3N0YXRp
YyBpbmxpbmUgYm9vbCBpOTE1X2FjdGl2ZV9oYXNfZXhjbHVzaXZlKHN0cnVjdCBpOTE1X2FjdGl2
ZSAqcmVmKQoreworCXJldHVybiByY3VfYWNjZXNzX3BvaW50ZXIocmVmLT5leGNsKTsKK30KKwog
aW50IGk5MTVfYWN0aXZlX3dhaXQoc3RydWN0IGk5MTVfYWN0aXZlICpyZWYpOwogCiBpbnQgaTkx
NV9yZXF1ZXN0X2F3YWl0X2FjdGl2ZShzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpycSwKZGlmZiAtLWdp
dCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfYWN0aXZlX3R5cGVzLmggYi9kcml2ZXJzL2dw
dS9kcm0vaTkxNS9pOTE1X2FjdGl2ZV90eXBlcy5oCmluZGV4IDE4NTRlN2QxNjhjMS4uODZlN2Ey
MzJlYTNjIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2FjdGl2ZV90eXBl
cy5oCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfYWN0aXZlX3R5cGVzLmgKQEAgLTgs
NiArOCw3IEBACiAjZGVmaW5lIF9JOTE1X0FDVElWRV9UWVBFU19IXwogCiAjaW5jbHVkZSA8bGlu
dXgvYXRvbWljLmg+CisjaW5jbHVkZSA8bGludXgvZG1hLWZlbmNlLmg+CiAjaW5jbHVkZSA8bGlu
dXgvbGxpc3QuaD4KICNpbmNsdWRlIDxsaW51eC9tdXRleC5oPgogI2luY2x1ZGUgPGxpbnV4L3Ji
dHJlZS5oPgpAQCAtNTEsNiArNTIsMTAgQEAgc3RydWN0IGk5MTVfYWN0aXZlIHsKIAlzdHJ1Y3Qg
bXV0ZXggbXV0ZXg7CiAJYXRvbWljX3QgY291bnQ7CiAKKwkvKiBQcmVhbGxvY2F0ZWQgImV4Y2x1
c2l2ZSIgbm9kZSAqLworCXN0cnVjdCBkbWFfZmVuY2UgX19yY3UgKmV4Y2w7CisJc3RydWN0IGRt
YV9mZW5jZV9jYiBleGNsX2NiOworCiAJdW5zaWduZWQgbG9uZyBmbGFnczsKICNkZWZpbmUgSTkx
NV9BQ1RJVkVfR1JBQl9CSVQgMAogCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9p
OTE1X2dlbS5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9nZW0uYwppbmRleCA4MTRmNjJm
Y2E3MjcuLjNlZWQyZWZhOGQxMyAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkx
NV9nZW0uYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2dlbS5jCkBAIC02MiwyMCAr
NjIsMzEgQEAKICNpbmNsdWRlICJpbnRlbF9wbS5oIgogCiBzdGF0aWMgaW50Ci1pbnNlcnRfbWFw
cGFibGVfbm9kZShzdHJ1Y3QgaTkxNV9nZ3R0ICpnZ3R0LAotICAgICAgICAgICAgICAgICAgICAg
c3RydWN0IGRybV9tbV9ub2RlICpub2RlLCB1MzIgc2l6ZSkKK2luc2VydF9tYXBwYWJsZV9ub2Rl
KHN0cnVjdCBpOTE1X2dndHQgKmdndHQsIHN0cnVjdCBkcm1fbW1fbm9kZSAqbm9kZSwgdTMyIHNp
emUpCiB7CisJaW50IGVycjsKKworCWVyciA9IG11dGV4X2xvY2tfaW50ZXJydXB0aWJsZSgmZ2d0
dC0+dm0ubXV0ZXgpOworCWlmIChlcnIpCisJCXJldHVybiBlcnI7CisKIAltZW1zZXQobm9kZSwg
MCwgc2l6ZW9mKCpub2RlKSk7Ci0JcmV0dXJuIGRybV9tbV9pbnNlcnRfbm9kZV9pbl9yYW5nZSgm
Z2d0dC0+dm0ubW0sIG5vZGUsCi0JCQkJCSAgIHNpemUsIDAsIEk5MTVfQ09MT1JfVU5FVklDVEFC
TEUsCi0JCQkJCSAgIDAsIGdndHQtPm1hcHBhYmxlX2VuZCwKLQkJCQkJICAgRFJNX01NX0lOU0VS
VF9MT1cpOworCWVyciA9IGRybV9tbV9pbnNlcnRfbm9kZV9pbl9yYW5nZSgmZ2d0dC0+dm0ubW0s
IG5vZGUsCisJCQkJCSAgc2l6ZSwgMCwgSTkxNV9DT0xPUl9VTkVWSUNUQUJMRSwKKwkJCQkJICAw
LCBnZ3R0LT5tYXBwYWJsZV9lbmQsCisJCQkJCSAgRFJNX01NX0lOU0VSVF9MT1cpOworCisJbXV0
ZXhfdW5sb2NrKCZnZ3R0LT52bS5tdXRleCk7CisKKwlyZXR1cm4gZXJyOwogfQogCiBzdGF0aWMg
dm9pZAotcmVtb3ZlX21hcHBhYmxlX25vZGUoc3RydWN0IGRybV9tbV9ub2RlICpub2RlKQorcmVt
b3ZlX21hcHBhYmxlX25vZGUoc3RydWN0IGk5MTVfZ2d0dCAqZ2d0dCwgc3RydWN0IGRybV9tbV9u
b2RlICpub2RlKQogeworCW11dGV4X2xvY2soJmdndHQtPnZtLm11dGV4KTsKIAlkcm1fbW1fcmVt
b3ZlX25vZGUobm9kZSk7CisJbXV0ZXhfdW5sb2NrKCZnZ3R0LT52bS5tdXRleCk7CiB9CiAKIGlu
dApAQCAtODcsNyArOTgsOCBAQCBpOTE1X2dlbV9nZXRfYXBlcnR1cmVfaW9jdGwoc3RydWN0IGRy
bV9kZXZpY2UgKmRldiwgdm9pZCAqZGF0YSwKIAlzdHJ1Y3QgaTkxNV92bWEgKnZtYTsKIAl1NjQg
cGlubmVkOwogCi0JbXV0ZXhfbG9jaygmZ2d0dC0+dm0ubXV0ZXgpOworCWlmIChtdXRleF9sb2Nr
X2ludGVycnVwdGlibGUoJmdndHQtPnZtLm11dGV4KSkKKwkJcmV0dXJuIC1FSU5UUjsKIAogCXBp
bm5lZCA9IGdndHQtPnZtLnJlc2VydmVkOwogCWxpc3RfZm9yX2VhY2hfZW50cnkodm1hLCAmZ2d0
dC0+dm0uYm91bmRfbGlzdCwgdm1fbGluaykKQEAgLTEwOSwyMCArMTIxLDMxIEBAIGludCBpOTE1
X2dlbV9vYmplY3RfdW5iaW5kKHN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmosCiAJTElT
VF9IRUFEKHN0aWxsX2luX2xpc3QpOwogCWludCByZXQgPSAwOwogCi0JbG9ja2RlcF9hc3NlcnRf
aGVsZCgmb2JqLT5iYXNlLmRldi0+c3RydWN0X211dGV4KTsKLQogCXNwaW5fbG9jaygmb2JqLT52
bWEubG9jayk7CiAJd2hpbGUgKCFyZXQgJiYgKHZtYSA9IGxpc3RfZmlyc3RfZW50cnlfb3JfbnVs
bCgmb2JqLT52bWEubGlzdCwKIAkJCQkJCSAgICAgICBzdHJ1Y3QgaTkxNV92bWEsCiAJCQkJCQkg
ICAgICAgb2JqX2xpbmspKSkgeworCQlzdHJ1Y3QgaTkxNV9hZGRyZXNzX3NwYWNlICp2bSA9IHZt
YS0+dm07CisKKwkJcmV0ID0gLUVCVVNZOworCQlpZiAoIWk5MTVfdm1fdHJ5b3Blbih2bSkpCisJ
CQlicmVhazsKKwogCQlsaXN0X21vdmVfdGFpbCgmdm1hLT5vYmpfbGluaywgJnN0aWxsX2luX2xp
c3QpOwogCQlzcGluX3VubG9jaygmb2JqLT52bWEubG9jayk7CiAKLQkJcmV0ID0gLUVCVVNZOwog
CQlpZiAoZmxhZ3MgJiBJOTE1X0dFTV9PQkpFQ1RfVU5CSU5EX0FDVElWRSB8fAotCQkgICAgIWk5
MTVfdm1hX2lzX2FjdGl2ZSh2bWEpKQotCQkJcmV0ID0gaTkxNV92bWFfdW5iaW5kKHZtYSk7CisJ
CSAgICAhaTkxNV92bWFfaXNfYWN0aXZlKHZtYSkpIHsKKwkJCXN0cnVjdCBpOTE1X2FkZHJlc3Nf
c3BhY2UgKnZtID0gdm1hLT52bTsKKworCQkJcmV0ID0gbXV0ZXhfbG9ja19pbnRlcnJ1cHRpYmxl
KCZ2bS0+bXV0ZXgpOworCQkJaWYgKCFyZXQpIHsKKwkJCQlyZXQgPSBpOTE1X3ZtYV91bmJpbmQo
dm1hKTsKKwkJCQltdXRleF91bmxvY2soJnZtLT5tdXRleCk7CisJCQl9CisJCX0KIAorCQlpOTE1
X3ZtX2Nsb3NlKHZtKTsKIAkJc3Bpbl9sb2NrKCZvYmotPnZtYS5sb2NrKTsKIAl9CiAJbGlzdF9z
cGxpY2UoJnN0aWxsX2luX2xpc3QsICZvYmotPnZtYS5saXN0KTsKQEAgLTMzOCwxMCArMzYxLDYg
QEAgaTkxNV9nZW1fZ3R0X3ByZWFkKHN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmosCiAJ
dTY0IHJlbWFpbiwgb2Zmc2V0OwogCWludCByZXQ7CiAKLQlyZXQgPSBtdXRleF9sb2NrX2ludGVy
cnVwdGlibGUoJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwotCWlmIChyZXQpCi0JCXJldHVybiBy
ZXQ7Ci0KIAl3YWtlcmVmID0gaW50ZWxfcnVudGltZV9wbV9nZXQoJmk5MTUtPnJ1bnRpbWVfcG0p
OwogCXZtYSA9IEVSUl9QVFIoLUVOT0RFVik7CiAJaWYgKCFpOTE1X2dlbV9vYmplY3RfaXNfdGls
ZWQob2JqKSkKQEAgLTM1NSwxMiArMzc0LDEwIEBAIGk5MTVfZ2VtX2d0dF9wcmVhZChzdHJ1Y3Qg
ZHJtX2k5MTVfZ2VtX29iamVjdCAqb2JqLAogCX0gZWxzZSB7CiAJCXJldCA9IGluc2VydF9tYXBw
YWJsZV9ub2RlKGdndHQsICZub2RlLCBQQUdFX1NJWkUpOwogCQlpZiAocmV0KQotCQkJZ290byBv
dXRfdW5sb2NrOworCQkJZ290byBvdXRfcnBtOwogCQlHRU1fQlVHX09OKCFkcm1fbW1fbm9kZV9h
bGxvY2F0ZWQoJm5vZGUpKTsKIAl9CiAKLQltdXRleF91bmxvY2soJmk5MTUtPmRybS5zdHJ1Y3Rf
bXV0ZXgpOwotCiAJcmV0ID0gaTkxNV9nZW1fb2JqZWN0X2xvY2tfaW50ZXJydXB0aWJsZShvYmop
OwogCWlmIChyZXQpCiAJCWdvdG8gb3V0X3VucGluOwpAQCAtNDE0LDE3ICs0MzEsMTQgQEAgaTkx
NV9nZW1fZ3R0X3ByZWFkKHN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmosCiAKIAlpOTE1
X2dlbV9vYmplY3RfdW5sb2NrX2ZlbmNlKG9iaiwgZmVuY2UpOwogb3V0X3VucGluOgotCW11dGV4
X2xvY2soJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwogCWlmIChkcm1fbW1fbm9kZV9hbGxvY2F0
ZWQoJm5vZGUpKSB7CiAJCWdndHQtPnZtLmNsZWFyX3JhbmdlKCZnZ3R0LT52bSwgbm9kZS5zdGFy
dCwgbm9kZS5zaXplKTsKLQkJcmVtb3ZlX21hcHBhYmxlX25vZGUoJm5vZGUpOworCQlyZW1vdmVf
bWFwcGFibGVfbm9kZShnZ3R0LCAmbm9kZSk7CiAJfSBlbHNlIHsKIAkJaTkxNV92bWFfdW5waW4o
dm1hKTsKIAl9Ci1vdXRfdW5sb2NrOgorb3V0X3JwbToKIAlpbnRlbF9ydW50aW1lX3BtX3B1dCgm
aTkxNS0+cnVudGltZV9wbSwgd2FrZXJlZik7Ci0JbXV0ZXhfdW5sb2NrKCZpOTE1LT5kcm0uc3Ry
dWN0X211dGV4KTsKLQogCXJldHVybiByZXQ7CiB9CiAKQEAgLTUzMSwxMCArNTQ1LDYgQEAgaTkx
NV9nZW1fZ3R0X3B3cml0ZV9mYXN0KHN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmosCiAJ
dm9pZCBfX3VzZXIgKnVzZXJfZGF0YTsKIAlpbnQgcmV0OwogCi0JcmV0ID0gbXV0ZXhfbG9ja19p
bnRlcnJ1cHRpYmxlKCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsKLQlpZiAocmV0KQotCQlyZXR1
cm4gcmV0OwotCiAJaWYgKGk5MTVfZ2VtX29iamVjdF9oYXNfc3RydWN0X3BhZ2Uob2JqKSkgewog
CQkvKgogCQkgKiBBdm9pZCB3YWtpbmcgdGhlIGRldmljZSB1cCBpZiB3ZSBjYW4gZmFsbGJhY2ss
IGFzCkBAIC01NDQsMTAgKzU1NCw4IEBAIGk5MTVfZ2VtX2d0dF9wd3JpdGVfZmFzdChzdHJ1Y3Qg
ZHJtX2k5MTVfZ2VtX29iamVjdCAqb2JqLAogCQkgKiB1c2luZyB0aGUgY2FjaGUgYnlwYXNzIG9m
IGluZGlyZWN0IEdHVFQgYWNjZXNzLgogCQkgKi8KIAkJd2FrZXJlZiA9IGludGVsX3J1bnRpbWVf
cG1fZ2V0X2lmX2luX3VzZShycG0pOwotCQlpZiAoIXdha2VyZWYpIHsKLQkJCXJldCA9IC1FRkFV
TFQ7Ci0JCQlnb3RvIG91dF91bmxvY2s7Ci0JCX0KKwkJaWYgKCF3YWtlcmVmKQorCQkJcmV0dXJu
IC1FRkFVTFQ7CiAJfSBlbHNlIHsKIAkJLyogTm8gYmFja2luZyBwYWdlcywgbm8gZmFsbGJhY2ss
IHdlIG11c3QgZm9yY2UgR0dUVCBhY2Nlc3MgKi8KIAkJd2FrZXJlZiA9IGludGVsX3J1bnRpbWVf
cG1fZ2V0KHJwbSk7CkBAIC01NjksOCArNTc3LDYgQEAgaTkxNV9nZW1fZ3R0X3B3cml0ZV9mYXN0
KHN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmosCiAJCUdFTV9CVUdfT04oIWRybV9tbV9u
b2RlX2FsbG9jYXRlZCgmbm9kZSkpOwogCX0KIAotCW11dGV4X3VubG9jaygmaTkxNS0+ZHJtLnN0
cnVjdF9tdXRleCk7Ci0KIAlyZXQgPSBpOTE1X2dlbV9vYmplY3RfbG9ja19pbnRlcnJ1cHRpYmxl
KG9iaik7CiAJaWYgKHJldCkKIAkJZ290byBvdXRfdW5waW47CkBAIC02MzQsMTggKzY0MCwxNSBA
QCBpOTE1X2dlbV9ndHRfcHdyaXRlX2Zhc3Qoc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9i
aiwKIAogCWk5MTVfZ2VtX29iamVjdF91bmxvY2tfZmVuY2Uob2JqLCBmZW5jZSk7CiBvdXRfdW5w
aW46Ci0JbXV0ZXhfbG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CiAJaW50ZWxfZ3RfZmx1
c2hfZ2d0dF93cml0ZXMoZ2d0dC0+dm0uZ3QpOwogCWlmIChkcm1fbW1fbm9kZV9hbGxvY2F0ZWQo
Jm5vZGUpKSB7CiAJCWdndHQtPnZtLmNsZWFyX3JhbmdlKCZnZ3R0LT52bSwgbm9kZS5zdGFydCwg
bm9kZS5zaXplKTsKLQkJcmVtb3ZlX21hcHBhYmxlX25vZGUoJm5vZGUpOworCQlyZW1vdmVfbWFw
cGFibGVfbm9kZShnZ3R0LCAmbm9kZSk7CiAJfSBlbHNlIHsKIAkJaTkxNV92bWFfdW5waW4odm1h
KTsKIAl9CiBvdXRfcnBtOgogCWludGVsX3J1bnRpbWVfcG1fcHV0KHJwbSwgd2FrZXJlZik7Ci1v
dXRfdW5sb2NrOgotCW11dGV4X3VubG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CiAJcmV0
dXJuIHJldDsKIH0KIApAQCAtOTY3LDggKzk3MCw2IEBAIGk5MTVfZ2VtX29iamVjdF9nZ3R0X3Bp
bihzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2JqLAogCXN0cnVjdCBpOTE1X3ZtYSAqdm1h
OwogCWludCByZXQ7CiAKLQlsb2NrZGVwX2Fzc2VydF9oZWxkKCZvYmotPmJhc2UuZGV2LT5zdHJ1
Y3RfbXV0ZXgpOwotCiAJaWYgKGZsYWdzICYgUElOX01BUFBBQkxFICYmCiAJICAgICghdmlldyB8
fCB2aWV3LT50eXBlID09IEk5MTVfR0dUVF9WSUVXX05PUk1BTCkpIHsKIAkJLyogSWYgdGhlIHJl
cXVpcmVkIHNwYWNlIGlzIGxhcmdlciB0aGFuIHRoZSBhdmFpbGFibGUKQEAgLTEwMTUsMTQgKzEw
MTYsOSBAQCBpOTE1X2dlbV9vYmplY3RfZ2d0dF9waW4oc3RydWN0IGRybV9pOTE1X2dlbV9vYmpl
Y3QgKm9iaiwKIAkJCQlyZXR1cm4gRVJSX1BUUigtRU5PU1BDKTsKIAkJfQogCi0JCVdBUk4oaTkx
NV92bWFfaXNfcGlubmVkKHZtYSksCi0JCSAgICAgImJvIGlzIGFscmVhZHkgcGlubmVkIGluIGdn
dHQgd2l0aCBpbmNvcnJlY3QgYWxpZ25tZW50OiIKLQkJICAgICAiIG9mZnNldD0lMDh4LCByZXEu
YWxpZ25tZW50PSVsbHgsIgotCQkgICAgICIgcmVxLm1hcF9hbmRfZmVuY2VhYmxlPSVkLCB2bWEt
Pm1hcF9hbmRfZmVuY2VhYmxlPSVkXG4iLAotCQkgICAgIGk5MTVfZ2d0dF9vZmZzZXQodm1hKSwg
YWxpZ25tZW50LAotCQkgICAgICEhKGZsYWdzICYgUElOX01BUFBBQkxFKSwKLQkJICAgICBpOTE1
X3ZtYV9pc19tYXBfYW5kX2ZlbmNlYWJsZSh2bWEpKTsKKwkJbXV0ZXhfbG9jaygmdm1hLT52bS0+
bXV0ZXgpOwogCQlyZXQgPSBpOTE1X3ZtYV91bmJpbmQodm1hKTsKKwkJbXV0ZXhfdW5sb2NrKCZ2
bWEtPnZtLT5tdXRleCk7CiAJCWlmIChyZXQpCiAJCQlyZXR1cm4gRVJSX1BUUihyZXQpOwogCX0K
QEAgLTEzMjgsNyArMTMyNCw5IEBAIHN0YXRpYyBpbnQgX19pbnRlbF9lbmdpbmVzX3JlY29yZF9k
ZWZhdWx0cyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkKIAkJICogZnJvbSB0aGUgR1RU
IHRvIHByZXZlbnQgc3VjaCBhY2NpZGVudHMgYW5kIHJlY2xhaW0gdGhlCiAJCSAqIHNwYWNlLgog
CQkgKi8KKwkJbXV0ZXhfbG9jaygmc3RhdGUtPnZtLT5tdXRleCk7CiAJCWVyciA9IGk5MTVfdm1h
X3VuYmluZChzdGF0ZSk7CisJCW11dGV4X3VubG9jaygmc3RhdGUtPnZtLT5tdXRleCk7CiAJCWlm
IChlcnIpCiAJCQlnb3RvIG91dDsKIApkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUv
aTkxNV9nZW1fZXZpY3QuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZ2VtX2V2aWN0LmMK
aW5kZXggN2FiY2FjM2I1ZTJlLi40NGY1YjYzOGZhNDMgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1
L2RybS9pOTE1L2k5MTVfZ2VtX2V2aWN0LmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkx
NV9nZW1fZXZpY3QuYwpAQCAtNDcsOCArNDcsNyBAQCBzdGF0aWMgaW50IGdndHRfZmx1c2goc3Ry
dWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpCiAJICogYm91bmQgYnkgdGhlaXIgYWN0aXZlIHJl
ZmVyZW5jZS4KIAkgKi8KIAlyZXR1cm4gaTkxNV9nZW1fd2FpdF9mb3JfaWRsZShpOTE1LAotCQkJ
CSAgICAgIEk5MTVfV0FJVF9JTlRFUlJVUFRJQkxFIHwKLQkJCQkgICAgICBJOTE1X1dBSVRfTE9D
S0VELAorCQkJCSAgICAgIEk5MTVfV0FJVF9JTlRFUlJVUFRJQkxFLAogCQkJCSAgICAgIE1BWF9T
Q0hFRFVMRV9USU1FT1VUKTsKIH0KIApAQCAtMTA0LDcgKzEwMyw3IEBAIGk5MTVfZ2VtX2V2aWN0
X3NvbWV0aGluZyhzdHJ1Y3QgaTkxNV9hZGRyZXNzX3NwYWNlICp2bSwKIAlzdHJ1Y3QgaTkxNV92
bWEgKmFjdGl2ZTsKIAlpbnQgcmV0OwogCi0JbG9ja2RlcF9hc3NlcnRfaGVsZCgmdm0tPmk5MTUt
PmRybS5zdHJ1Y3RfbXV0ZXgpOworCWxvY2tkZXBfYXNzZXJ0X2hlbGQoJnZtLT5tdXRleCk7CiAJ
dHJhY2VfaTkxNV9nZW1fZXZpY3Qodm0sIG1pbl9zaXplLCBhbGlnbm1lbnQsIGZsYWdzKTsKIAog
CS8qCkBAIC0xMjcsMTUgKzEyNiw2IEBAIGk5MTVfZ2VtX2V2aWN0X3NvbWV0aGluZyhzdHJ1Y3Qg
aTkxNV9hZGRyZXNzX3NwYWNlICp2bSwKIAkJCQkgICAgbWluX3NpemUsIGFsaWdubWVudCwgY2Fj
aGVfbGV2ZWwsCiAJCQkJICAgIHN0YXJ0LCBlbmQsIG1vZGUpOwogCi0JLyoKLQkgKiBSZXRpcmUg
YmVmb3JlIHdlIHNlYXJjaCB0aGUgYWN0aXZlIGxpc3QuIEFsdGhvdWdoIHdlIGhhdmUKLQkgKiBy
ZWFzb25hYmxlIGFjY3VyYWN5IGluIG91ciByZXRpcmVtZW50IGxpc3RzLCB3ZSBtYXkgaGF2ZQot
CSAqIGEgc3RyYXkgcGluIChwcmV2ZW50aW5nIGV2aWN0aW9uKSB0aGF0IGNhbiBvbmx5IGJlIHJl
c29sdmVkIGJ5Ci0JICogcmV0aXJpbmcuCi0JICovCi0JaWYgKCEoZmxhZ3MgJiBQSU5fTk9OQkxP
Q0spKQotCQlpOTE1X3JldGlyZV9yZXF1ZXN0cyhkZXZfcHJpdik7Ci0KIHNlYXJjaF9hZ2FpbjoK
IAlhY3RpdmUgPSBOVUxMOwogCUlOSVRfTElTVF9IRUFEKCZldmljdGlvbl9saXN0KTsKQEAgLTI2
OSw3ICsyNTksNyBAQCBpbnQgaTkxNV9nZW1fZXZpY3RfZm9yX25vZGUoc3RydWN0IGk5MTVfYWRk
cmVzc19zcGFjZSAqdm0sCiAJYm9vbCBjaGVja19jb2xvcjsKIAlpbnQgcmV0ID0gMDsKIAotCWxv
Y2tkZXBfYXNzZXJ0X2hlbGQoJnZtLT5pOTE1LT5kcm0uc3RydWN0X211dGV4KTsKKwlsb2NrZGVw
X2Fzc2VydF9oZWxkKCZ2bS0+bXV0ZXgpOwogCUdFTV9CVUdfT04oIUlTX0FMSUdORUQoc3RhcnQs
IEk5MTVfR1RUX1BBR0VfU0laRSkpOwogCUdFTV9CVUdfT04oIUlTX0FMSUdORUQoZW5kLCBJOTE1
X0dUVF9QQUdFX1NJWkUpKTsKIApAQCAtMzc1LDcgKzM2NSw3IEBAIGludCBpOTE1X2dlbV9ldmlj
dF92bShzdHJ1Y3QgaTkxNV9hZGRyZXNzX3NwYWNlICp2bSkKIAlzdHJ1Y3QgaTkxNV92bWEgKnZt
YSwgKm5leHQ7CiAJaW50IHJldDsKIAotCWxvY2tkZXBfYXNzZXJ0X2hlbGQoJnZtLT5pOTE1LT5k
cm0uc3RydWN0X211dGV4KTsKKwlsb2NrZGVwX2Fzc2VydF9oZWxkKCZ2bS0+bXV0ZXgpOwogCXRy
YWNlX2k5MTVfZ2VtX2V2aWN0X3ZtKHZtKTsKIAogCS8qIFN3aXRjaCBiYWNrIHRvIHRoZSBkZWZh
dWx0IGNvbnRleHQgaW4gb3JkZXIgdG8gdW5waW4KQEAgLTM5MCw3ICszODAsNiBAQCBpbnQgaTkx
NV9nZW1fZXZpY3Rfdm0oc3RydWN0IGk5MTVfYWRkcmVzc19zcGFjZSAqdm0pCiAJfQogCiAJSU5J
VF9MSVNUX0hFQUQoJmV2aWN0aW9uX2xpc3QpOwotCW11dGV4X2xvY2soJnZtLT5tdXRleCk7CiAJ
bGlzdF9mb3JfZWFjaF9lbnRyeSh2bWEsICZ2bS0+Ym91bmRfbGlzdCwgdm1fbGluaykgewogCQlp
ZiAoaTkxNV92bWFfaXNfcGlubmVkKHZtYSkpCiAJCQljb250aW51ZTsKQEAgLTM5OCw3ICszODcs
NiBAQCBpbnQgaTkxNV9nZW1fZXZpY3Rfdm0oc3RydWN0IGk5MTVfYWRkcmVzc19zcGFjZSAqdm0p
CiAJCV9faTkxNV92bWFfcGluKHZtYSk7CiAJCWxpc3RfYWRkKCZ2bWEtPmV2aWN0X2xpbmssICZl
dmljdGlvbl9saXN0KTsKIAl9Ci0JbXV0ZXhfdW5sb2NrKCZ2bS0+bXV0ZXgpOwogCiAJcmV0ID0g
MDsKIAlsaXN0X2Zvcl9lYWNoX2VudHJ5X3NhZmUodm1hLCBuZXh0LCAmZXZpY3Rpb25fbGlzdCwg
ZXZpY3RfbGluaykgewpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9nZW1f
ZmVuY2VfcmVnLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2dlbV9mZW5jZV9yZWcuYwpp
bmRleCA2MTVhOWY0ZWYzMGMuLjQxNGQ4Mzk2NjhkNyAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUv
ZHJtL2k5MTUvaTkxNV9nZW1fZmVuY2VfcmVnLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUv
aTkxNV9nZW1fZmVuY2VfcmVnLmMKQEAgLTIzNyw2ICsyMzcsNyBAQCBzdGF0aWMgaW50IGZlbmNl
X3VwZGF0ZShzdHJ1Y3QgaTkxNV9mZW5jZV9yZWcgKmZlbmNlLAogCiAJb2xkID0geGNoZygmZmVu
Y2UtPnZtYSwgTlVMTCk7CiAJaWYgKG9sZCkgeworCQkvKiBYWFggSWRlYWxseSB3ZSB3b3VsZCBt
b3ZlIHRoZSB3YWl0aW5nIHRvIG91dHNpZGUgdGhlIG11dGV4ICovCiAJCXJldCA9IGk5MTVfYWN0
aXZlX3dhaXQoJm9sZC0+YWN0aXZlKTsKIAkJaWYgKHJldCkgewogCQkJZmVuY2UtPnZtYSA9IG9s
ZDsKQEAgLTMzMSwxMyArMzMyLDE1IEBAIHN0YXRpYyBzdHJ1Y3QgaTkxNV9mZW5jZV9yZWcgKmZl
bmNlX2ZpbmQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpCiAJcmV0dXJuIEVSUl9QVFIo
LUVERUFETEspOwogfQogCi1zdGF0aWMgaW50IF9faTkxNV92bWFfcGluX2ZlbmNlKHN0cnVjdCBp
OTE1X3ZtYSAqdm1hKQoraW50IF9faTkxNV92bWFfcGluX2ZlbmNlKHN0cnVjdCBpOTE1X3ZtYSAq
dm1hKQogewogCXN0cnVjdCBpOTE1X2dndHQgKmdndHQgPSBpOTE1X3ZtX3RvX2dndHQodm1hLT52
bSk7CiAJc3RydWN0IGk5MTVfZmVuY2VfcmVnICpmZW5jZTsKIAlzdHJ1Y3QgaTkxNV92bWEgKnNl
dCA9IGk5MTVfZ2VtX29iamVjdF9pc190aWxlZCh2bWEtPm9iaikgPyB2bWEgOiBOVUxMOwogCWlu
dCBlcnI7CiAKKwlsb2NrZGVwX2Fzc2VydF9oZWxkKCZ2bWEtPnZtLT5tdXRleCk7CisKIAkvKiBK
dXN0IHVwZGF0ZSBvdXIgcGxhY2UgaW4gdGhlIExSVSBpZiBvdXIgZmVuY2UgaXMgZ2V0dGluZyBy
ZXVzZWQuICovCiAJaWYgKHZtYS0+ZmVuY2UpIHsKIAkJZmVuY2UgPSB2bWEtPmZlbmNlOwpkaWZm
IC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9nZW1fZ3R0LmMgYi9kcml2ZXJzL2dw
dS9kcm0vaTkxNS9pOTE1X2dlbV9ndHQuYwppbmRleCA1NmQyN2NmMDlhM2QuLmIyZTQ4Mjc3ODhm
YyAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9nZW1fZ3R0LmMKKysrIGIv
ZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9nZW1fZ3R0LmMKQEAgLTE1MCwxNiArMTUwLDE4IEBA
IHN0YXRpYyB2b2lkIGdtY2hfZ2d0dF9pbnZhbGlkYXRlKHN0cnVjdCBpOTE1X2dndHQgKmdndHQp
CiAKIHN0YXRpYyBpbnQgcHBndHRfYmluZF92bWEoc3RydWN0IGk5MTVfdm1hICp2bWEsCiAJCQkg
IGVudW0gaTkxNV9jYWNoZV9sZXZlbCBjYWNoZV9sZXZlbCwKLQkJCSAgdTMyIHVudXNlZCkKKwkJ
CSAgdTMyIGZsYWdzKQogewogCXUzMiBwdGVfZmxhZ3M7CiAJaW50IGVycjsKIAotCWlmICghaTkx
NV92bWFfaXNfYm91bmQodm1hLCBJOTE1X1ZNQV9MT0NBTF9CSU5EKSkgeworCWlmIChmbGFncyAm
IEk5MTVfVk1BX0FMTE9DKSB7CiAJCWVyciA9IHZtYS0+dm0tPmFsbG9jYXRlX3ZhX3JhbmdlKHZt
YS0+dm0sCiAJCQkJCQkgdm1hLT5ub2RlLnN0YXJ0LCB2bWEtPnNpemUpOwogCQlpZiAoZXJyKQog
CQkJcmV0dXJuIGVycjsKKworCQlzZXRfYml0KEk5MTVfVk1BX0FMTE9DX0JJVCwgX19pOTE1X3Zt
YV9mbGFncyh2bWEpKTsKIAl9CiAKIAkvKiBBcHBsaWNhYmxlIHRvIFZMViwgYW5kIGdlbjgrICov
CkBAIC0xNjcsNiArMTY5LDcgQEAgc3RhdGljIGludCBwcGd0dF9iaW5kX3ZtYShzdHJ1Y3QgaTkx
NV92bWEgKnZtYSwKIAlpZiAoaTkxNV9nZW1fb2JqZWN0X2lzX3JlYWRvbmx5KHZtYS0+b2JqKSkK
IAkJcHRlX2ZsYWdzIHw9IFBURV9SRUFEX09OTFk7CiAKKwlHRU1fQlVHX09OKCF0ZXN0X2JpdChJ
OTE1X1ZNQV9BTExPQ19CSVQsIF9faTkxNV92bWFfZmxhZ3Modm1hKSkpOwogCXZtYS0+dm0tPmlu
c2VydF9lbnRyaWVzKHZtYS0+dm0sIHZtYSwgY2FjaGVfbGV2ZWwsIHB0ZV9mbGFncyk7CiAJd21i
KCk7CiAKQEAgLTE3NSw3ICsxNzgsOCBAQCBzdGF0aWMgaW50IHBwZ3R0X2JpbmRfdm1hKHN0cnVj
dCBpOTE1X3ZtYSAqdm1hLAogCiBzdGF0aWMgdm9pZCBwcGd0dF91bmJpbmRfdm1hKHN0cnVjdCBp
OTE1X3ZtYSAqdm1hKQogewotCXZtYS0+dm0tPmNsZWFyX3JhbmdlKHZtYS0+dm0sIHZtYS0+bm9k
ZS5zdGFydCwgdm1hLT5zaXplKTsKKwlpZiAodGVzdF9hbmRfY2xlYXJfYml0KEk5MTVfVk1BX0FM
TE9DX0JJVCwgX19pOTE1X3ZtYV9mbGFncyh2bWEpKSkKKwkJdm1hLT52bS0+Y2xlYXJfcmFuZ2Uo
dm1hLT52bSwgdm1hLT5ub2RlLnN0YXJ0LCB2bWEtPnNpemUpOwogfQogCiBzdGF0aWMgaW50IHBw
Z3R0X3NldF9wYWdlcyhzdHJ1Y3QgaTkxNV92bWEgKnZtYSkKQEAgLTUwMywxNSArNTA3LDI1IEBA
IHN0YXRpYyB2b2lkIGk5MTVfYWRkcmVzc19zcGFjZV9maW5pKHN0cnVjdCBpOTE1X2FkZHJlc3Nf
c3BhY2UgKnZtKQogCW11dGV4X2Rlc3Ryb3koJnZtLT5tdXRleCk7CiB9CiAKLXN0YXRpYyB2b2lk
IHBwZ3R0X2Rlc3Ryb3lfdm1hKHN0cnVjdCBpOTE1X2FkZHJlc3Nfc3BhY2UgKnZtKQordm9pZCBf
X2k5MTVfdm1fY2xvc2Uoc3RydWN0IGk5MTVfYWRkcmVzc19zcGFjZSAqdm0pCiB7CiAJc3RydWN0
IGk5MTVfdm1hICp2bWEsICp2bjsKIAotCW11dGV4X2xvY2soJnZtLT5pOTE1LT5kcm0uc3RydWN0
X211dGV4KTsKLQlsaXN0X2Zvcl9lYWNoX2VudHJ5X3NhZmUodm1hLCB2biwgJnZtLT5ib3VuZF9s
aXN0LCB2bV9saW5rKQorCW11dGV4X2xvY2soJnZtLT5tdXRleCk7CisJbGlzdF9mb3JfZWFjaF9l
bnRyeV9zYWZlKHZtYSwgdm4sICZ2bS0+Ym91bmRfbGlzdCwgdm1fbGluaykgeworCQlzdHJ1Y3Qg
ZHJtX2k5MTVfZ2VtX29iamVjdCAqb2JqID0gdm1hLT5vYmo7CisKKwkJaWYgKCFrcmVmX2dldF91
bmxlc3NfemVybygmb2JqLT5iYXNlLnJlZmNvdW50KSkKKwkJCWNvbnRpbnVlOworCisJCWF0b21p
Y19hbmQofkk5MTVfVk1BX1BJTl9NQVNLLCAmdm1hLT5mbGFncyk7CisJCVdBUk5fT04oaTkxNV92
bWFfdW5iaW5kKHZtYSkpOwogCQlpOTE1X3ZtYV9kZXN0cm95KHZtYSk7CisKKwkJaTkxNV9nZW1f
b2JqZWN0X3B1dChvYmopOworCX0KIAlHRU1fQlVHX09OKCFsaXN0X2VtcHR5KCZ2bS0+Ym91bmRf
bGlzdCkpOwotCW11dGV4X3VubG9jaygmdm0tPmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOworCW11
dGV4X3VubG9jaygmdm0tPm11dGV4KTsKIH0KIAogc3RhdGljIHZvaWQgX19pOTE1X3ZtX3JlbGVh
c2Uoc3RydWN0IHdvcmtfc3RydWN0ICp3b3JrKQpAQCAtNTE5LDggKzUzMyw2IEBAIHN0YXRpYyB2
b2lkIF9faTkxNV92bV9yZWxlYXNlKHN0cnVjdCB3b3JrX3N0cnVjdCAqd29yaykKIAlzdHJ1Y3Qg
aTkxNV9hZGRyZXNzX3NwYWNlICp2bSA9CiAJCWNvbnRhaW5lcl9vZih3b3JrLCBzdHJ1Y3QgaTkx
NV9hZGRyZXNzX3NwYWNlLCByY3Uud29yayk7CiAKLQlwcGd0dF9kZXN0cm95X3ZtYSh2bSk7Ci0K
IAl2bS0+Y2xlYW51cCh2bSk7CiAJaTkxNV9hZGRyZXNzX3NwYWNlX2Zpbmkodm0pOwogCkBAIC01
MzUsNyArNTQ3LDYgQEAgdm9pZCBpOTE1X3ZtX3JlbGVhc2Uoc3RydWN0IGtyZWYgKmtyZWYpCiAJ
R0VNX0JVR19PTihpOTE1X2lzX2dndHQodm0pKTsKIAl0cmFjZV9pOTE1X3BwZ3R0X3JlbGVhc2Uo
dm0pOwogCi0Jdm0tPmNsb3NlZCA9IHRydWU7CiAJcXVldWVfcmN1X3dvcmsodm0tPmk5MTUtPndx
LCAmdm0tPnJjdSk7CiB9CiAKQEAgLTU0Myw2ICs1NTQsNyBAQCBzdGF0aWMgdm9pZCBpOTE1X2Fk
ZHJlc3Nfc3BhY2VfaW5pdChzdHJ1Y3QgaTkxNV9hZGRyZXNzX3NwYWNlICp2bSwgaW50IHN1YmNs
YXNzKQogewogCWtyZWZfaW5pdCgmdm0tPnJlZik7CiAJSU5JVF9SQ1VfV09SSygmdm0tPnJjdSwg
X19pOTE1X3ZtX3JlbGVhc2UpOworCWF0b21pY19zZXQoJnZtLT5vcGVuLCAxKTsKIAogCS8qCiAJ
ICogVGhlIHZtLT5tdXRleCBtdXN0IGJlIHJlY2xhaW0gc2FmZSAoZm9yIHVzZSBpbiB0aGUgc2hy
aW5rZXIpLgpAQCAtMTc2OSwxMiArMTc4MSw4IEBAIHN0YXRpYyB2b2lkIGdlbjZfcHBndHRfZnJl
ZV9wZChzdHJ1Y3QgZ2VuNl9wcGd0dCAqcHBndHQpCiBzdGF0aWMgdm9pZCBnZW42X3BwZ3R0X2Ns
ZWFudXAoc3RydWN0IGk5MTVfYWRkcmVzc19zcGFjZSAqdm0pCiB7CiAJc3RydWN0IGdlbjZfcHBn
dHQgKnBwZ3R0ID0gdG9fZ2VuNl9wcGd0dChpOTE1X3ZtX3RvX3BwZ3R0KHZtKSk7Ci0Jc3RydWN0
IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSB2bS0+aTkxNTsKIAotCS8qIEZJWE1FIHJlbW92ZSB0
aGUgc3RydWN0X211dGV4IHRvIGJyaW5nIHRoZSBsb2NraW5nIHVuZGVyIGNvbnRyb2wgKi8KLQlt
dXRleF9sb2NrKCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsKIAlpOTE1X3ZtYV9kZXN0cm95KHBw
Z3R0LT52bWEpOwotCW11dGV4X3VubG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CiAKIAln
ZW42X3BwZ3R0X2ZyZWVfcGQocHBndHQpOwogCWZyZWVfc2NyYXRjaCh2bSk7CkBAIC0xODYzLDcg
KzE4NzEsOCBAQCBzdGF0aWMgc3RydWN0IGk5MTVfdm1hICpwZF92bWFfY3JlYXRlKHN0cnVjdCBn
ZW42X3BwZ3R0ICpwcGd0dCwgaW50IHNpemUpCiAKIAlpOTE1X2FjdGl2ZV9pbml0KGk5MTUsICZ2
bWEtPmFjdGl2ZSwgTlVMTCwgTlVMTCk7CiAKLQl2bWEtPnZtID0gJmdndHQtPnZtOworCW11dGV4
X2luaXQoJnZtYS0+cGFnZXNfbXV0ZXgpOworCXZtYS0+dm0gPSBpOTE1X3ZtX2dldCgmZ2d0dC0+
dm0pOwogCXZtYS0+b3BzID0gJnBkX3ZtYV9vcHM7CiAJdm1hLT5wcml2YXRlID0gcHBndHQ7CiAK
QEAgLTE4ODMsNyArMTg5Miw3IEBAIGludCBnZW42X3BwZ3R0X3BpbihzdHJ1Y3QgaTkxNV9wcGd0
dCAqYmFzZSkKIAlzdHJ1Y3QgZ2VuNl9wcGd0dCAqcHBndHQgPSB0b19nZW42X3BwZ3R0KGJhc2Up
OwogCWludCBlcnIgPSAwOwogCi0JR0VNX0JVR19PTihwcGd0dC0+YmFzZS52bS5jbG9zZWQpOwor
CUdFTV9CVUdfT04oIWF0b21pY19yZWFkKCZwcGd0dC0+YmFzZS52bS5vcGVuKSk7CiAKIAkvKgog
CSAqIFdvcmthcm91bmQgdGhlIGxpbWl0ZWQgbWF4aW11bSB2bWEtPnBpbl9jb3VudCBhbmQgdGhl
IGFsaWFzaW5nX3BwZ3R0CkBAIC0yNDYwLDE0ICsyNDY5LDE4IEBAIHN0YXRpYyBpbnQgYWxpYXNp
bmdfZ3R0X2JpbmRfdm1hKHN0cnVjdCBpOTE1X3ZtYSAqdm1hLAogCWlmIChmbGFncyAmIEk5MTVf
Vk1BX0xPQ0FMX0JJTkQpIHsKIAkJc3RydWN0IGk5MTVfcHBndHQgKmFsaWFzID0gaTkxNV92bV90
b19nZ3R0KHZtYS0+dm0pLT5hbGlhczsKIAotCQlpZiAoIWk5MTVfdm1hX2lzX2JvdW5kKHZtYSwg
STkxNV9WTUFfTE9DQUxfQklORCkpIHsKKwkJaWYgKGZsYWdzICYgSTkxNV9WTUFfQUxMT0MpIHsK
IAkJCXJldCA9IGFsaWFzLT52bS5hbGxvY2F0ZV92YV9yYW5nZSgmYWxpYXMtPnZtLAogCQkJCQkJ
CSAgdm1hLT5ub2RlLnN0YXJ0LAogCQkJCQkJCSAgdm1hLT5zaXplKTsKIAkJCWlmIChyZXQpCiAJ
CQkJcmV0dXJuIHJldDsKKworCQkJc2V0X2JpdChJOTE1X1ZNQV9BTExPQ19CSVQsIF9faTkxNV92
bWFfZmxhZ3Modm1hKSk7CiAJCX0KIAorCQlHRU1fQlVHX09OKCF0ZXN0X2JpdChJOTE1X1ZNQV9B
TExPQ19CSVQsCisJCQkJICAgICBfX2k5MTVfdm1hX2ZsYWdzKHZtYSkpKTsKIAkJYWxpYXMtPnZt
Lmluc2VydF9lbnRyaWVzKCZhbGlhcy0+dm0sIHZtYSwKIAkJCQkJIGNhY2hlX2xldmVsLCBwdGVf
ZmxhZ3MpOwogCX0KQEAgLTI0OTYsNyArMjUwOSw3IEBAIHN0YXRpYyB2b2lkIGFsaWFzaW5nX2d0
dF91bmJpbmRfdm1hKHN0cnVjdCBpOTE1X3ZtYSAqdm1hKQogCQkJdm0tPmNsZWFyX3JhbmdlKHZt
LCB2bWEtPm5vZGUuc3RhcnQsIHZtYS0+c2l6ZSk7CiAJfQogCi0JaWYgKGk5MTVfdm1hX2lzX2Jv
dW5kKHZtYSwgSTkxNV9WTUFfTE9DQUxfQklORCkpIHsKKwlpZiAodGVzdF9hbmRfY2xlYXJfYml0
KEk5MTVfVk1BX0FMTE9DX0JJVCwgX19pOTE1X3ZtYV9mbGFncyh2bWEpKSkgewogCQlzdHJ1Y3Qg
aTkxNV9hZGRyZXNzX3NwYWNlICp2bSA9CiAJCQkmaTkxNV92bV90b19nZ3R0KHZtYS0+dm0pLT5h
bGlhcy0+dm07CiAKQEAgLTI1OTksMjIgKzI2MTIsMTYgQEAgc3RhdGljIGludCBpbml0X2FsaWFz
aW5nX3BwZ3R0KHN0cnVjdCBpOTE1X2dndHQgKmdndHQpCiAKIHN0YXRpYyB2b2lkIGZpbmlfYWxp
YXNpbmdfcHBndHQoc3RydWN0IGk5MTVfZ2d0dCAqZ2d0dCkKIHsKLQlzdHJ1Y3QgZHJtX2k5MTVf
cHJpdmF0ZSAqaTkxNSA9IGdndHQtPnZtLmk5MTU7CiAJc3RydWN0IGk5MTVfcHBndHQgKnBwZ3R0
OwogCi0JbXV0ZXhfbG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7Ci0KIAlwcGd0dCA9IGZl
dGNoX2FuZF96ZXJvKCZnZ3R0LT5hbGlhcyk7CiAJaWYgKCFwcGd0dCkKLQkJZ290byBvdXQ7CisJ
CXJldHVybjsKIAogCWk5MTVfdm1fcHV0KCZwcGd0dC0+dm0pOwogCiAJZ2d0dC0+dm0udm1hX29w
cy5iaW5kX3ZtYSAgID0gZ2d0dF9iaW5kX3ZtYTsKIAlnZ3R0LT52bS52bWFfb3BzLnVuYmluZF92
bWEgPSBnZ3R0X3VuYmluZF92bWE7Ci0KLW91dDoKLQltdXRleF91bmxvY2soJmk5MTUtPmRybS5z
dHJ1Y3RfbXV0ZXgpOwogfQogCiBzdGF0aWMgaW50IGdndHRfcmVzZXJ2ZV9ndWNfdG9wKHN0cnVj
dCBpOTE1X2dndHQgKmdndHQpCkBAIC0yNzMxLDE1ICsyNzM4LDE0IEBAIGludCBpOTE1X2luaXRf
Z2d0dChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkKIAogc3RhdGljIHZvaWQgZ2d0dF9j
bGVhbnVwX2h3KHN0cnVjdCBpOTE1X2dndHQgKmdndHQpCiB7Ci0Jc3RydWN0IGRybV9pOTE1X3By
aXZhdGUgKmk5MTUgPSBnZ3R0LT52bS5pOTE1OwogCXN0cnVjdCBpOTE1X3ZtYSAqdm1hLCAqdm47
CiAKLQlnZ3R0LT52bS5jbG9zZWQgPSB0cnVlOworCWF0b21pY19zZXQoJmdndHQtPnZtLm9wZW4s
IDApOwogCiAJcmN1X2JhcnJpZXIoKTsgLyogZmx1c2ggdGhlIFJDVSdlZF9faTkxNV92bV9yZWxl
YXNlICovCi0JZmx1c2hfd29ya3F1ZXVlKGk5MTUtPndxKTsKKwlmbHVzaF93b3JrcXVldWUoZ2d0
dC0+dm0uaTkxNS0+d3EpOwogCi0JbXV0ZXhfbG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7
CisJbXV0ZXhfbG9jaygmZ2d0dC0+dm0ubXV0ZXgpOwogCiAJbGlzdF9mb3JfZWFjaF9lbnRyeV9z
YWZlKHZtYSwgdm4sICZnZ3R0LT52bS5ib3VuZF9saXN0LCB2bV9saW5rKQogCQlXQVJOX09OKGk5
MTVfdm1hX3VuYmluZCh2bWEpKTsKQEAgLTI3NDgsMTUgKzI3NTQsMTIgQEAgc3RhdGljIHZvaWQg
Z2d0dF9jbGVhbnVwX2h3KHN0cnVjdCBpOTE1X2dndHQgKmdndHQpCiAJCWRybV9tbV9yZW1vdmVf
bm9kZSgmZ2d0dC0+ZXJyb3JfY2FwdHVyZSk7CiAKIAlnZ3R0X3JlbGVhc2VfZ3VjX3RvcChnZ3R0
KTsKLQotCWlmIChkcm1fbW1faW5pdGlhbGl6ZWQoJmdndHQtPnZtLm1tKSkgewotCQlpbnRlbF92
Z3RfZGViYWxsb29uKGdndHQpOwotCQlpOTE1X2FkZHJlc3Nfc3BhY2VfZmluaSgmZ2d0dC0+dm0p
OwotCX0KKwlpbnRlbF92Z3RfZGViYWxsb29uKGdndHQpOwogCiAJZ2d0dC0+dm0uY2xlYW51cCgm
Z2d0dC0+dm0pOwogCi0JbXV0ZXhfdW5sb2NrKCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsKKwlt
dXRleF91bmxvY2soJmdndHQtPnZtLm11dGV4KTsKKwlpOTE1X2FkZHJlc3Nfc3BhY2VfZmluaSgm
Z2d0dC0+dm0pOwogCiAJYXJjaF9waHlzX3djX2RlbChnZ3R0LT5tdHJyKTsKIAlpb19tYXBwaW5n
X2ZpbmkoJmdndHQtPmlvbWFwKTsKQEAgLTMxODUsOSArMzE4OCw2IEBAIGludCBpOTE1X2dndHRf
cHJvYmVfaHcoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpCiBzdGF0aWMgaW50IGdndHRf
aW5pdF9odyhzdHJ1Y3QgaTkxNV9nZ3R0ICpnZ3R0KQogewogCXN0cnVjdCBkcm1faTkxNV9wcml2
YXRlICppOTE1ID0gZ2d0dC0+dm0uaTkxNTsKLQlpbnQgcmV0ID0gMDsKLQotCW11dGV4X2xvY2so
Jmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwogCiAJaTkxNV9hZGRyZXNzX3NwYWNlX2luaXQoJmdn
dHQtPnZtLCBWTV9DTEFTU19HR1RUKTsKIApAQCAtMzIwMywxOCArMzIwMywxNCBAQCBzdGF0aWMg
aW50IGdndHRfaW5pdF9odyhzdHJ1Y3QgaTkxNV9nZ3R0ICpnZ3R0KQogCQkJCWdndHQtPmdtYWRy
LnN0YXJ0LAogCQkJCWdndHQtPm1hcHBhYmxlX2VuZCkpIHsKIAkJZ2d0dC0+dm0uY2xlYW51cCgm
Z2d0dC0+dm0pOwotCQlyZXQgPSAtRUlPOwotCQlnb3RvIG91dDsKKwkJcmV0dXJuIC1FSU87CiAJ
fQogCiAJZ2d0dC0+bXRyciA9IGFyY2hfcGh5c193Y19hZGQoZ2d0dC0+Z21hZHIuc3RhcnQsIGdn
dHQtPm1hcHBhYmxlX2VuZCk7CiAKIAlpOTE1X2dndHRfaW5pdF9mZW5jZXMoZ2d0dCk7CiAKLW91
dDoKLQltdXRleF91bmxvY2soJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwotCi0JcmV0dXJuIHJl
dDsKKwlyZXR1cm4gMDsKIH0KIAogLyoqCkBAIC0zMjg2LDYgKzMyODIsNyBAQCBzdGF0aWMgdm9p
ZCBnZ3R0X3Jlc3RvcmVfbWFwcGluZ3Moc3RydWN0IGk5MTVfZ2d0dCAqZ2d0dCkKIHsKIAlzdHJ1
Y3QgaTkxNV92bWEgKnZtYSwgKnZuOwogCWJvb2wgZmx1c2ggPSBmYWxzZTsKKwlpbnQgb3BlbjsK
IAogCWludGVsX2d0X2NoZWNrX2FuZF9jbGVhcl9mYXVsdHMoZ2d0dC0+dm0uZ3QpOwogCkBAIC0z
MjkzLDcgKzMyOTAsOSBAQCBzdGF0aWMgdm9pZCBnZ3R0X3Jlc3RvcmVfbWFwcGluZ3Moc3RydWN0
IGk5MTVfZ2d0dCAqZ2d0dCkKIAogCS8qIEZpcnN0IGZpbGwgb3VyIHBvcnRpb24gb2YgdGhlIEdU
VCB3aXRoIHNjcmF0Y2ggcGFnZXMgKi8KIAlnZ3R0LT52bS5jbGVhcl9yYW5nZSgmZ2d0dC0+dm0s
IDAsIGdndHQtPnZtLnRvdGFsKTsKLQlnZ3R0LT52bS5jbG9zZWQgPSB0cnVlOyAvKiBza2lwIHJl
d3JpdGluZyBQVEUgb24gVk1BIHVuYmluZCAqLworCisJLyogU2tpcCByZXdyaXRpbmcgUFRFIG9u
IFZNQSB1bmJpbmQuICovCisJb3BlbiA9IGF0b21pY194Y2hnKCZnZ3R0LT52bS5vcGVuLCAwKTsK
IAogCS8qIGNsZmx1c2ggb2JqZWN0cyBib3VuZCBpbnRvIHRoZSBHR1RUIGFuZCByZWJpbmQgdGhl
bS4gKi8KIAlsaXN0X2Zvcl9lYWNoX2VudHJ5X3NhZmUodm1hLCB2biwgJmdndHQtPnZtLmJvdW5k
X2xpc3QsIHZtX2xpbmspIHsKQEAgLTMzMDIsMjQgKzMzMDEsMjAgQEAgc3RhdGljIHZvaWQgZ2d0
dF9yZXN0b3JlX21hcHBpbmdzKHN0cnVjdCBpOTE1X2dndHQgKmdndHQpCiAJCWlmICghaTkxNV92
bWFfaXNfYm91bmQodm1hLCBJOTE1X1ZNQV9HTE9CQUxfQklORCkpCiAJCQljb250aW51ZTsKIAot
CQltdXRleF91bmxvY2soJmdndHQtPnZtLm11dGV4KTsKLQogCQlpZiAoIWk5MTVfdm1hX3VuYmlu
ZCh2bWEpKQotCQkJZ290byBsb2NrOworCQkJY29udGludWU7CiAKKwkJY2xlYXJfYml0KEk5MTVf
Vk1BX0dMT0JBTF9CSU5EX0JJVCwgX19pOTE1X3ZtYV9mbGFncyh2bWEpKTsKIAkJV0FSTl9PTihp
OTE1X3ZtYV9iaW5kKHZtYSwKIAkJCQkgICAgICBvYmogPyBvYmotPmNhY2hlX2xldmVsIDogMCwK
LQkJCQkgICAgICBQSU5fVVBEQVRFKSk7CisJCQkJICAgICAgUElOX0dMT0JBTCwgTlVMTCkpOwog
CQlpZiAob2JqKSB7IC8qIG9ubHkgdXNlZCBkdXJpbmcgcmVzdW1lID0+IGV4Y2x1c2l2ZSBhY2Nl
c3MgKi8KIAkJCWZsdXNoIHw9IGZldGNoX2FuZF96ZXJvKCZvYmotPndyaXRlX2RvbWFpbik7CiAJ
CQlvYmotPnJlYWRfZG9tYWlucyB8PSBJOTE1X0dFTV9ET01BSU5fR1RUOwogCQl9Ci0KLWxvY2s6
Ci0JCW11dGV4X2xvY2soJmdndHQtPnZtLm11dGV4KTsKIAl9CiAKLQlnZ3R0LT52bS5jbG9zZWQg
PSBmYWxzZTsKKwlhdG9taWNfc2V0KCZnZ3R0LT52bS5vcGVuLCBvcGVuKTsKIAlnZ3R0LT5pbnZh
bGlkYXRlKGdndHQpOwogCiAJbXV0ZXhfdW5sb2NrKCZnZ3R0LT52bS5tdXRleCk7CkBAIC0zNzEx
LDcgKzM3MDYsOCBAQCBpbnQgaTkxNV9nZW1fZ3R0X2luc2VydChzdHJ1Y3QgaTkxNV9hZGRyZXNz
X3NwYWNlICp2bSwKIAl1NjQgb2Zmc2V0OwogCWludCBlcnI7CiAKLQlsb2NrZGVwX2Fzc2VydF9o
ZWxkKCZ2bS0+aTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CisJbG9ja2RlcF9hc3NlcnRfaGVsZCgm
dm0tPm11dGV4KTsKKwogCUdFTV9CVUdfT04oIXNpemUpOwogCUdFTV9CVUdfT04oIUlTX0FMSUdO
RUQoc2l6ZSwgSTkxNV9HVFRfUEFHRV9TSVpFKSk7CiAJR0VNX0JVR19PTihhbGlnbm1lbnQgJiYg
IWlzX3Bvd2VyX29mXzIoYWxpZ25tZW50KSk7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0v
aTkxNS9pOTE1X2dlbV9ndHQuaCBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZ2VtX2d0dC5o
CmluZGV4IDAwN2JkYWY0YmEwMC4uZTc5NGQxZjVlZWU4IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dw
dS9kcm0vaTkxNS9pOTE1X2dlbV9ndHQuaAorKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1
X2dlbV9ndHQuaApAQCAtMzA3LDcgKzMwNyw3IEBAIHN0cnVjdCBpOTE1X2FkZHJlc3Nfc3BhY2Ug
ewogCiAJdW5zaWduZWQgaW50IGJpbmRfYWxsb2M7CiAKLQlib29sIGNsb3NlZDsKKwlhdG9taWNf
dCBvcGVuOwogCiAJc3RydWN0IG11dGV4IG11dGV4OyAvKiBwcm90ZWN0cyB2bWEgYW5kIG91ciBs
aXN0cyAqLwogI2RlZmluZSBWTV9DTEFTU19HR1RUIDAKQEAgLTU3NSw2ICs1NzUsMzUgQEAgc3Rh
dGljIGlubGluZSB2b2lkIGk5MTVfdm1fcHV0KHN0cnVjdCBpOTE1X2FkZHJlc3Nfc3BhY2UgKnZt
KQogCWtyZWZfcHV0KCZ2bS0+cmVmLCBpOTE1X3ZtX3JlbGVhc2UpOwogfQogCitzdGF0aWMgaW5s
aW5lIHN0cnVjdCBpOTE1X2FkZHJlc3Nfc3BhY2UgKgoraTkxNV92bV9vcGVuKHN0cnVjdCBpOTE1
X2FkZHJlc3Nfc3BhY2UgKnZtKQoreworCUdFTV9CVUdfT04oIWF0b21pY19yZWFkKCZ2bS0+b3Bl
bikpOworCWF0b21pY19pbmMoJnZtLT5vcGVuKTsKKwlyZXR1cm4gaTkxNV92bV9nZXQodm0pOwor
fQorCitzdGF0aWMgaW5saW5lIGJvb2wKK2k5MTVfdm1fdHJ5b3BlbihzdHJ1Y3QgaTkxNV9hZGRy
ZXNzX3NwYWNlICp2bSkKK3sKKwlpZiAoYXRvbWljX2FkZF91bmxlc3MoJnZtLT5vcGVuLCAxLCAw
KSkKKwkJcmV0dXJuIGk5MTVfdm1fZ2V0KHZtKTsKKworCXJldHVybiBmYWxzZTsKK30KKwordm9p
ZCBfX2k5MTVfdm1fY2xvc2Uoc3RydWN0IGk5MTVfYWRkcmVzc19zcGFjZSAqdm0pOworCitzdGF0
aWMgaW5saW5lIHZvaWQKK2k5MTVfdm1fY2xvc2Uoc3RydWN0IGk5MTVfYWRkcmVzc19zcGFjZSAq
dm0pCit7CisJR0VNX0JVR19PTighYXRvbWljX3JlYWQoJnZtLT5vcGVuKSk7CisJaWYgKGF0b21p
Y19kZWNfYW5kX3Rlc3QoJnZtLT5vcGVuKSkKKwkJX19pOTE1X3ZtX2Nsb3NlKHZtKTsKKworCWk5
MTVfdm1fcHV0KHZtKTsKK30KKwogaW50IGdlbjZfcHBndHRfcGluKHN0cnVjdCBpOTE1X3BwZ3R0
ICpiYXNlKTsKIHZvaWQgZ2VuNl9wcGd0dF91bnBpbihzdHJ1Y3QgaTkxNV9wcGd0dCAqYmFzZSk7
CiB2b2lkIGdlbjZfcHBndHRfdW5waW5fYWxsKHN0cnVjdCBpOTE1X3BwZ3R0ICpiYXNlKTsKQEAg
LTYwNywxMCArNjM2LDkgQEAgaW50IGk5MTVfZ2VtX2d0dF9pbnNlcnQoc3RydWN0IGk5MTVfYWRk
cmVzc19zcGFjZSAqdm0sCiAjZGVmaW5lIFBJTl9PRkZTRVRfQklBUwkJQklUX1VMTCg2KQogI2Rl
ZmluZSBQSU5fT0ZGU0VUX0ZJWEVECUJJVF9VTEwoNykKIAotI2RlZmluZSBQSU5fTUJaCQkJQklU
X1VMTCg4KSAvKiBJOTE1X1ZNQV9QSU5fT1ZFUkZMT1cgKi8KLSNkZWZpbmUgUElOX0dMT0JBTAkJ
QklUX1VMTCg5KSAvKiBJOTE1X1ZNQV9HTE9CQUxfQklORCAqLwotI2RlZmluZSBQSU5fVVNFUgkJ
QklUX1VMTCgxMCkgLyogSTkxNV9WTUFfTE9DQUxfQklORCAqLwotI2RlZmluZSBQSU5fVVBEQVRF
CQlCSVRfVUxMKDExKQorI2RlZmluZSBQSU5fVVBEQVRFCQlCSVRfVUxMKDkpCisjZGVmaW5lIFBJ
Tl9HTE9CQUwJCUJJVF9VTEwoMTApIC8qIEk5MTVfVk1BX0dMT0JBTF9CSU5EICovCisjZGVmaW5l
IFBJTl9VU0VSCQlCSVRfVUxMKDExKSAvKiBJOTE1X1ZNQV9MT0NBTF9CSU5EICovCiAKICNkZWZp
bmUgUElOX09GRlNFVF9NQVNLCQkoLUk5MTVfR1RUX1BBR0VfU0laRSkKIApkaWZmIC0tZ2l0IGEv
ZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9wZXJmLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9p
OTE1X3BlcmYuYwppbmRleCBjMWI3NjQyMzM3NjEuLjA2NjMzYjRhZDI2MCAxMDA2NDQKLS0tIGEv
ZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9wZXJmLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5
MTUvaTkxNV9wZXJmLmMKQEAgLTEyMDQsMTUgKzEyMDQsMTAgQEAgc3RhdGljIGludCBpOTE1X29h
X3JlYWQoc3RydWN0IGk5MTVfcGVyZl9zdHJlYW0gKnN0cmVhbSwKIHN0YXRpYyBzdHJ1Y3QgaW50
ZWxfY29udGV4dCAqb2FfcGluX2NvbnRleHQoc3RydWN0IGk5MTVfcGVyZl9zdHJlYW0gKnN0cmVh
bSkKIHsKIAlzdHJ1Y3QgaTkxNV9nZW1fZW5naW5lc19pdGVyIGl0OwotCXN0cnVjdCBkcm1faTkx
NV9wcml2YXRlICppOTE1ID0gc3RyZWFtLT5kZXZfcHJpdjsKIAlzdHJ1Y3QgaTkxNV9nZW1fY29u
dGV4dCAqY3R4ID0gc3RyZWFtLT5jdHg7CiAJc3RydWN0IGludGVsX2NvbnRleHQgKmNlOwogCWlu
dCBlcnI7CiAKLQllcnIgPSBpOTE1X211dGV4X2xvY2tfaW50ZXJydXB0aWJsZSgmaTkxNS0+ZHJt
KTsKLQlpZiAoZXJyKQotCQlyZXR1cm4gRVJSX1BUUihlcnIpOwotCiAJZm9yX2VhY2hfZ2VtX2Vu
Z2luZShjZSwgaTkxNV9nZW1fY29udGV4dF9sb2NrX2VuZ2luZXMoY3R4KSwgaXQpIHsKIAkJaWYg
KGNlLT5lbmdpbmUtPmNsYXNzICE9IFJFTkRFUl9DTEFTUykKIAkJCWNvbnRpbnVlOwpAQCAtMTIy
OSwxMCArMTIyNCw2IEBAIHN0YXRpYyBzdHJ1Y3QgaW50ZWxfY29udGV4dCAqb2FfcGluX2NvbnRl
eHQoc3RydWN0IGk5MTVfcGVyZl9zdHJlYW0gKnN0cmVhbSkKIAl9CiAJaTkxNV9nZW1fY29udGV4
dF91bmxvY2tfZW5naW5lcyhjdHgpOwogCi0JbXV0ZXhfdW5sb2NrKCZpOTE1LT5kcm0uc3RydWN0
X211dGV4KTsKLQlpZiAoZXJyKQotCQlyZXR1cm4gRVJSX1BUUihlcnIpOwotCiAJcmV0dXJuIHN0
cmVhbS0+cGlubmVkX2N0eDsKIH0KIApAQCAtMTMzMSwzMiArMTMyMiwyMiBAQCBzdGF0aWMgaW50
IG9hX2dldF9yZW5kZXJfY3R4X2lkKHN0cnVjdCBpOTE1X3BlcmZfc3RyZWFtICpzdHJlYW0pCiAg
Ki8KIHN0YXRpYyB2b2lkIG9hX3B1dF9yZW5kZXJfY3R4X2lkKHN0cnVjdCBpOTE1X3BlcmZfc3Ry
ZWFtICpzdHJlYW0pCiB7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gc3Ry
ZWFtLT5kZXZfcHJpdjsKIAlzdHJ1Y3QgaW50ZWxfY29udGV4dCAqY2U7CiAKIAlzdHJlYW0tPnNw
ZWNpZmljX2N0eF9pZCA9IElOVkFMSURfQ1RYX0lEOwogCXN0cmVhbS0+c3BlY2lmaWNfY3R4X2lk
X21hc2sgPSAwOwogCiAJY2UgPSBmZXRjaF9hbmRfemVybygmc3RyZWFtLT5waW5uZWRfY3R4KTsK
LQlpZiAoY2UpIHsKLQkJbXV0ZXhfbG9jaygmZGV2X3ByaXYtPmRybS5zdHJ1Y3RfbXV0ZXgpOwor
CWlmIChjZSkKIAkJaW50ZWxfY29udGV4dF91bnBpbihjZSk7Ci0JCW11dGV4X3VubG9jaygmZGV2
X3ByaXYtPmRybS5zdHJ1Y3RfbXV0ZXgpOwotCX0KIH0KIAogc3RhdGljIHZvaWQKIGZyZWVfb2Ff
YnVmZmVyKHN0cnVjdCBpOTE1X3BlcmZfc3RyZWFtICpzdHJlYW0pCiB7Ci0Jc3RydWN0IGRybV9p
OTE1X3ByaXZhdGUgKmk5MTUgPSBzdHJlYW0tPmRldl9wcml2OwotCi0JbXV0ZXhfbG9jaygmaTkx
NS0+ZHJtLnN0cnVjdF9tdXRleCk7Ci0KIAlpOTE1X3ZtYV91bnBpbl9hbmRfcmVsZWFzZSgmc3Ry
ZWFtLT5vYV9idWZmZXIudm1hLAogCQkJCSAgIEk5MTVfVk1BX1JFTEVBU0VfTUFQKTsKIAotCW11
dGV4X3VubG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7Ci0KIAlzdHJlYW0tPm9hX2J1ZmZl
ci52YWRkciA9IE5VTEw7CiB9CiAKQEAgLTE1MTEsMTggKzE0OTIsMTMgQEAgc3RhdGljIGludCBh
bGxvY19vYV9idWZmZXIoc3RydWN0IGk5MTVfcGVyZl9zdHJlYW0gKnN0cmVhbSkKIAlpZiAoV0FS
Tl9PTihzdHJlYW0tPm9hX2J1ZmZlci52bWEpKQogCQlyZXR1cm4gLUVOT0RFVjsKIAotCXJldCA9
IGk5MTVfbXV0ZXhfbG9ja19pbnRlcnJ1cHRpYmxlKCZkZXZfcHJpdi0+ZHJtKTsKLQlpZiAocmV0
KQotCQlyZXR1cm4gcmV0OwotCiAJQlVJTERfQlVHX09OX05PVF9QT1dFUl9PRl8yKE9BX0JVRkZF
Ul9TSVpFKTsKIAlCVUlMRF9CVUdfT04oT0FfQlVGRkVSX1NJWkUgPCBTWl8xMjhLIHx8IE9BX0JV
RkZFUl9TSVpFID4gU1pfMTZNKTsKIAogCWJvID0gaTkxNV9nZW1fb2JqZWN0X2NyZWF0ZV9zaG1l
bShkZXZfcHJpdiwgT0FfQlVGRkVSX1NJWkUpOwogCWlmIChJU19FUlIoYm8pKSB7CiAJCURSTV9F
UlJPUigiRmFpbGVkIHRvIGFsbG9jYXRlIE9BIGJ1ZmZlclxuIik7Ci0JCXJldCA9IFBUUl9FUlIo
Ym8pOwotCQlnb3RvIHVubG9jazsKKwkJcmV0dXJuIFBUUl9FUlIoYm8pOwogCX0KIAogCWk5MTVf
Z2VtX29iamVjdF9zZXRfY2FjaGVfY29oZXJlbmN5KGJvLCBJOTE1X0NBQ0hFX0xMQyk7CkBAIC0x
NTQ2LDcgKzE1MjIsNyBAQCBzdGF0aWMgaW50IGFsbG9jX29hX2J1ZmZlcihzdHJ1Y3QgaTkxNV9w
ZXJmX3N0cmVhbSAqc3RyZWFtKQogCQkJIGk5MTVfZ2d0dF9vZmZzZXQoc3RyZWFtLT5vYV9idWZm
ZXIudm1hKSwKIAkJCSBzdHJlYW0tPm9hX2J1ZmZlci52YWRkcik7CiAKLQlnb3RvIHVubG9jazsK
KwlyZXR1cm4gMDsKIAogZXJyX3VucGluOgogCV9faTkxNV92bWFfdW5waW4odm1hKTsKQEAgLTE1
NTcsOCArMTUzMyw2IEBAIHN0YXRpYyBpbnQgYWxsb2Nfb2FfYnVmZmVyKHN0cnVjdCBpOTE1X3Bl
cmZfc3RyZWFtICpzdHJlYW0pCiAJc3RyZWFtLT5vYV9idWZmZXIudmFkZHIgPSBOVUxMOwogCXN0
cmVhbS0+b2FfYnVmZmVyLnZtYSA9IE5VTEw7CiAKLXVubG9jazoKLQltdXRleF91bmxvY2soJmRl
dl9wcml2LT5kcm0uc3RydWN0X211dGV4KTsKIAlyZXR1cm4gcmV0OwogfQogCmRpZmYgLS1naXQg
YS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3ZtYS5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUv
aTkxNV92bWEuYwppbmRleCA5YWRiODViYTZkYWEuLjI4ODY3OWQ4YTZhOSAxMDA2NDQKLS0tIGEv
ZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV92bWEuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkx
NS9pOTE1X3ZtYS5jCkBAIC0zMiw2ICszMiw3IEBACiAKICNpbmNsdWRlICJpOTE1X2Rydi5oIgog
I2luY2x1ZGUgImk5MTVfZ2xvYmFscy5oIgorI2luY2x1ZGUgImk5MTVfc3dfZmVuY2Vfd29yay5o
IgogI2luY2x1ZGUgImk5MTVfdHJhY2UuaCIKICNpbmNsdWRlICJpOTE1X3ZtYS5oIgogCkBAIC0x
MTAsNyArMTExLDggQEAgdm1hX2NyZWF0ZShzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2Jq
LAogCWlmICh2bWEgPT0gTlVMTCkKIAkJcmV0dXJuIEVSUl9QVFIoLUVOT01FTSk7CiAKLQl2bWEt
PnZtID0gdm07CisJbXV0ZXhfaW5pdCgmdm1hLT5wYWdlc19tdXRleCk7CisJdm1hLT52bSA9IGk5
MTVfdm1fZ2V0KHZtKTsKIAl2bWEtPm9wcyA9ICZ2bS0+dm1hX29wczsKIAl2bWEtPm9iaiA9IG9i
ajsKIAl2bWEtPnJlc3YgPSBvYmotPmJhc2UucmVzdjsKQEAgLTI2MSw4ICsyNjMsNiBAQCB2bWFf
bG9va3VwKHN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmosCiAgKiBPbmNlIGNyZWF0ZWQs
IHRoZSBWTUEgaXMga2VwdCB1bnRpbCBlaXRoZXIgdGhlIG9iamVjdCBpcyBmcmVlZCwgb3IgdGhl
CiAgKiBhZGRyZXNzIHNwYWNlIGlzIGNsb3NlZC4KICAqCi0gKiBNdXN0IGJlIGNhbGxlZCB3aXRo
IHN0cnVjdF9tdXRleCBoZWxkLgotICoKICAqIFJldHVybnMgdGhlIHZtYSwgb3IgYW4gZXJyb3Ig
cG9pbnRlci4KICAqLwogc3RydWN0IGk5MTVfdm1hICoKQEAgLTI3Myw3ICsyNzMsNyBAQCBpOTE1
X3ZtYV9pbnN0YW5jZShzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2JqLAogCXN0cnVjdCBp
OTE1X3ZtYSAqdm1hOwogCiAJR0VNX0JVR19PTih2aWV3ICYmICFpOTE1X2lzX2dndHQodm0pKTsK
LQlHRU1fQlVHX09OKHZtLT5jbG9zZWQpOworCUdFTV9CVUdfT04oIWF0b21pY19yZWFkKCZ2bS0+
b3BlbikpOwogCiAJc3Bpbl9sb2NrKCZvYmotPnZtYS5sb2NrKTsKIAl2bWEgPSB2bWFfbG9va3Vw
KG9iaiwgdm0sIHZpZXcpOwpAQCAtMjg3LDE4ICsyODcsNjMgQEAgaTkxNV92bWFfaW5zdGFuY2Uo
c3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iaiwKIAlyZXR1cm4gdm1hOwogfQogCitzdHJ1
Y3QgaTkxNV92bWFfd29yayB7CisJc3RydWN0IGRtYV9mZW5jZV93b3JrIGJhc2U7CisJc3RydWN0
IGk5MTVfdm1hICp2bWE7CisJZW51bSBpOTE1X2NhY2hlX2xldmVsIGNhY2hlX2xldmVsOworCXVu
c2lnbmVkIGludCBmbGFnczsKK307CisKK3N0YXRpYyBpbnQgX192bWFfYmluZChzdHJ1Y3QgZG1h
X2ZlbmNlX3dvcmsgKndvcmspCit7CisJc3RydWN0IGk5MTVfdm1hX3dvcmsgKnZ3ID0gY29udGFp
bmVyX29mKHdvcmssIHR5cGVvZigqdncpLCBiYXNlKTsKKwlzdHJ1Y3QgaTkxNV92bWEgKnZtYSA9
IHZ3LT52bWE7CisJaW50IGVycjsKKworCWVyciA9IHZtYS0+b3BzLT5iaW5kX3ZtYSh2bWEsIHZ3
LT5jYWNoZV9sZXZlbCwgdnctPmZsYWdzKTsKKwlpZiAoZXJyKQorCQlhdG9taWNfb3IoSTkxNV9W
TUFfRVJST1IsICZ2bWEtPmZsYWdzKTsKKworCWlmICh2bWEtPm9iaikKKwkJX19pOTE1X2dlbV9v
YmplY3RfdW5waW5fcGFnZXModm1hLT5vYmopOworCisJcmV0dXJuIGVycjsKK30KKworc3RhdGlj
IGNvbnN0IHN0cnVjdCBkbWFfZmVuY2Vfd29ya19vcHMgYmluZF9vcHMgPSB7CisJLm5hbWUgPSAi
YmluZCIsCisJLndvcmsgPSBfX3ZtYV9iaW5kLAorfTsKKworc3RydWN0IGk5MTVfdm1hX3dvcmsg
Kmk5MTVfdm1hX3dvcmsodm9pZCkKK3sKKwlzdHJ1Y3QgaTkxNV92bWFfd29yayAqdnc7CisKKwl2
dyA9IGt6YWxsb2Moc2l6ZW9mKCp2dyksIEdGUF9LRVJORUwpOworCWlmICghdncpCisJCXJldHVy
biBOVUxMOworCisJZG1hX2ZlbmNlX3dvcmtfaW5pdCgmdnctPmJhc2UsICZiaW5kX29wcyk7CisJ
dnctPmJhc2UuZG1hLmVycm9yID0gLUVBR0FJTjsgLyogZGlzYWJsZSB0aGUgd29ya2VyIGJ5IGRl
ZmF1bHQgKi8KKworCXJldHVybiB2dzsKK30KKwogLyoqCiAgKiBpOTE1X3ZtYV9iaW5kIC0gU2V0
cyB1cCBQVEVzIGZvciBhbiBWTUEgaW4gaXQncyBjb3JyZXNwb25kaW5nIGFkZHJlc3Mgc3BhY2Uu
CiAgKiBAdm1hOiBWTUEgdG8gbWFwCiAgKiBAY2FjaGVfbGV2ZWw6IG1hcHBpbmcgY2FjaGUgbGV2
ZWwKICAqIEBmbGFnczogZmxhZ3MgbGlrZSBnbG9iYWwgb3IgbG9jYWwgbWFwcGluZworICogQHdv
cms6IHByZWFsbG9jYXRlZCB3b3JrZXIgZm9yIGFsbG9jYXRpbmcgYW5kIGJpbmRpbmcgdGhlIFBU
RQogICoKICAqIERNQSBhZGRyZXNzZXMgYXJlIHRha2VuIGZyb20gdGhlIHNjYXR0ZXItZ2F0aGVy
IHRhYmxlIG9mIHRoaXMgb2JqZWN0IChvciBvZgogICogdGhpcyBWTUEgaW4gY2FzZSBvZiBub24t
ZGVmYXVsdCBHR1RUIHZpZXdzKSBhbmQgUFRFIGVudHJpZXMgc2V0IHVwLgogICogTm90ZSB0aGF0
IERNQSBhZGRyZXNzZXMgYXJlIGFsc28gdGhlIG9ubHkgcGFydCBvZiB0aGUgU0cgdGFibGUgd2Ug
Y2FyZSBhYm91dC4KICAqLwotaW50IGk5MTVfdm1hX2JpbmQoc3RydWN0IGk5MTVfdm1hICp2bWEs
IGVudW0gaTkxNV9jYWNoZV9sZXZlbCBjYWNoZV9sZXZlbCwKLQkJICB1MzIgZmxhZ3MpCitpbnQg
aTkxNV92bWFfYmluZChzdHJ1Y3QgaTkxNV92bWEgKnZtYSwKKwkJICBlbnVtIGk5MTVfY2FjaGVf
bGV2ZWwgY2FjaGVfbGV2ZWwsCisJCSAgdTMyIGZsYWdzLAorCQkgIHN0cnVjdCBpOTE1X3ZtYV93
b3JrICp3b3JrKQogewogCXUzMiBiaW5kX2ZsYWdzOwogCXUzMiB2bWFfZmxhZ3M7CkBAIC0zMTUs
MTEgKzM2MCw4IEBAIGludCBpOTE1X3ZtYV9iaW5kKHN0cnVjdCBpOTE1X3ZtYSAqdm1hLCBlbnVt
IGk5MTVfY2FjaGVfbGV2ZWwgY2FjaGVfbGV2ZWwsCiAJaWYgKEdFTV9ERUJVR19XQVJOX09OKCFm
bGFncykpCiAJCXJldHVybiAtRUlOVkFMOwogCi0JYmluZF9mbGFncyA9IDA7Ci0JaWYgKGZsYWdz
ICYgUElOX0dMT0JBTCkKLQkJYmluZF9mbGFncyB8PSBJOTE1X1ZNQV9HTE9CQUxfQklORDsKLQlp
ZiAoZmxhZ3MgJiBQSU5fVVNFUikKLQkJYmluZF9mbGFncyB8PSBJOTE1X1ZNQV9MT0NBTF9CSU5E
OworCWJpbmRfZmxhZ3MgPSBmbGFnczsKKwliaW5kX2ZsYWdzICY9IEk5MTVfVk1BX0dMT0JBTF9C
SU5EIHwgSTkxNV9WTUFfTE9DQUxfQklORDsKIAogCXZtYV9mbGFncyA9IGF0b21pY19yZWFkKCZ2
bWEtPmZsYWdzKTsKIAl2bWFfZmxhZ3MgJj0gSTkxNV9WTUFfR0xPQkFMX0JJTkQgfCBJOTE1X1ZN
QV9MT0NBTF9CSU5EOwpAQCAtMzMzLDkgKzM3NSwzMiBAQCBpbnQgaTkxNV92bWFfYmluZChzdHJ1
Y3QgaTkxNV92bWEgKnZtYSwgZW51bSBpOTE1X2NhY2hlX2xldmVsIGNhY2hlX2xldmVsLAogCUdF
TV9CVUdfT04oIXZtYS0+cGFnZXMpOwogCiAJdHJhY2VfaTkxNV92bWFfYmluZCh2bWEsIGJpbmRf
ZmxhZ3MpOwotCXJldCA9IHZtYS0+b3BzLT5iaW5kX3ZtYSh2bWEsIGNhY2hlX2xldmVsLCBiaW5k
X2ZsYWdzKTsKLQlpZiAocmV0KQotCQlyZXR1cm4gcmV0OworCWlmICh3b3JrICYmIChiaW5kX2Zs
YWdzICYgfnZtYV9mbGFncykgJiB2bWEtPnZtLT5iaW5kX2FsbG9jKSB7CisJCXdvcmstPnZtYSA9
IHZtYTsKKwkJd29yay0+Y2FjaGVfbGV2ZWwgPSBjYWNoZV9sZXZlbDsKKwkJd29yay0+ZmxhZ3Mg
PSBiaW5kX2ZsYWdzIHwgSTkxNV9WTUFfQUxMT0M7CisKKwkJLyoKKwkJICogTm90ZSB3ZSBvbmx5
IHdhbnQgdG8gY2hhaW4gdXAgdG8gdGhlIG1pZ3JhdGlvbiBmZW5jZSBvbgorCQkgKiB0aGUgcGFn
ZXMgKG5vdCB0aGUgb2JqZWN0IGl0c2VsZikuIEFzIHdlIGRvbid0IHRyYWNrIHRoYXQsCisJCSAq
IHlldCwgd2UgaGF2ZSB0byB1c2UgdGhlIGV4Y2x1c2l2ZSBmZW5jZSBpbnN0ZWFkLgorCQkgKgor
CQkgKiBBbHNvIG5vdGUgdGhhdCB3ZSBkbyBub3Qgd2FudCB0byB0cmFjayB0aGUgYXN5bmMgdm1h
IGFzCisJCSAqIHBhcnQgb2YgdGhlIG9iai0+cmVzdi0+ZXhjbF9mZW5jZSBhcyBpdCBvbmx5IGFm
ZmVjdHMKKwkJICogZXhlY3V0aW9uIGFuZCBub3QgY29udGVudCBvciBvYmplY3QncyBiYWNraW5n
IHN0b3JlIGxpZmV0aW1lLgorCQkgKi8KKwkJR0VNX0JVR19PTihpOTE1X2FjdGl2ZV9oYXNfZXhj
bHVzaXZlKCZ2bWEtPmFjdGl2ZSkpOworCQlpOTE1X2FjdGl2ZV9zZXRfZXhjbHVzaXZlKCZ2bWEt
PmFjdGl2ZSwgJndvcmstPmJhc2UuZG1hKTsKKwkJd29yay0+YmFzZS5kbWEuZXJyb3IgPSAwOyAv
KiBlbmFibGUgdGhlIHF1ZXVlX3dvcmsoKSAqLworCisJCWlmICh2bWEtPm9iaikKKwkJCV9faTkx
NV9nZW1fb2JqZWN0X3Bpbl9wYWdlcyh2bWEtPm9iaik7CisJfSBlbHNlIHsKKwkJR0VNX0JVR19P
TigoYmluZF9mbGFncyAmIH52bWFfZmxhZ3MpICYgdm1hLT52bS0+YmluZF9hbGxvYyk7CisJCXJl
dCA9IHZtYS0+b3BzLT5iaW5kX3ZtYSh2bWEsIGNhY2hlX2xldmVsLCBiaW5kX2ZsYWdzKTsKKwkJ
aWYgKHJldCkKKwkJCXJldHVybiByZXQ7CisJfQogCiAJYXRvbWljX29yKGJpbmRfZmxhZ3MsICZ2
bWEtPmZsYWdzKTsKIAlyZXR1cm4gMDsKQEAgLTM0OCw5ICs0MTMsNyBAQCB2b2lkIF9faW9tZW0g
Kmk5MTVfdm1hX3Bpbl9pb21hcChzdHJ1Y3QgaTkxNV92bWEgKnZtYSkKIAogCS8qIEFjY2VzcyB0
aHJvdWdoIHRoZSBHVFQgcmVxdWlyZXMgdGhlIGRldmljZSB0byBiZSBhd2FrZS4gKi8KIAlhc3Nl
cnRfcnBtX3dha2Vsb2NrX2hlbGQoJnZtYS0+dm0tPmk5MTUtPnJ1bnRpbWVfcG0pOwotCi0JbG9j
a2RlcF9hc3NlcnRfaGVsZCgmdm1hLT52bS0+aTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7Ci0JaWYg
KFdBUk5fT04oIWk5MTVfdm1hX2lzX21hcF9hbmRfZmVuY2VhYmxlKHZtYSkpKSB7CisJaWYgKEdF
TV9XQVJOX09OKCFpOTE1X3ZtYV9pc19tYXBfYW5kX2ZlbmNlYWJsZSh2bWEpKSkgewogCQllcnIg
PSAtRU5PREVWOwogCQlnb3RvIGVycjsKIAl9CkBAIC0zNjgsNyArNDMxLDggQEAgdm9pZCBfX2lv
bWVtICppOTE1X3ZtYV9waW5faW9tYXAoc3RydWN0IGk5MTVfdm1hICp2bWEpCiAJCQlnb3RvIGVy
cjsKIAkJfQogCi0JCXZtYS0+aW9tYXAgPSBwdHI7CisJCWlmICh1bmxpa2VseShjbXB4Y2hnKCZ2
bWEtPmlvbWFwLCBOVUxMLCBwdHIpKSkKKwkJCWlvX21hcHBpbmdfdW5tYXAocHRyKTsKIAl9CiAK
IAlfX2k5MTVfdm1hX3Bpbih2bWEpOwpAQCAtMzg4LDE4ICs0NTIsMTIgQEAgdm9pZCBfX2lvbWVt
ICppOTE1X3ZtYV9waW5faW9tYXAoc3RydWN0IGk5MTVfdm1hICp2bWEpCiAKIHZvaWQgaTkxNV92
bWFfZmx1c2hfd3JpdGVzKHN0cnVjdCBpOTE1X3ZtYSAqdm1hKQogewotCWlmICghaTkxNV92bWFf
aGFzX2dndHRfd3JpdGUodm1hKSkKLQkJcmV0dXJuOwotCi0JaW50ZWxfZ3RfZmx1c2hfZ2d0dF93
cml0ZXModm1hLT52bS0+Z3QpOwotCi0JaTkxNV92bWFfdW5zZXRfZ2d0dF93cml0ZSh2bWEpOwor
CWlmIChpOTE1X3ZtYV91bnNldF9nZ3R0X3dyaXRlKHZtYSkpCisJCWludGVsX2d0X2ZsdXNoX2dn
dHRfd3JpdGVzKHZtYS0+dm0tPmd0KTsKIH0KIAogdm9pZCBpOTE1X3ZtYV91bnBpbl9pb21hcChz
dHJ1Y3QgaTkxNV92bWEgKnZtYSkKIHsKLQlsb2NrZGVwX2Fzc2VydF9oZWxkKCZ2bWEtPnZtLT5p
OTE1LT5kcm0uc3RydWN0X211dGV4KTsKLQogCUdFTV9CVUdfT04odm1hLT5pb21hcCA9PSBOVUxM
KTsKIAogCWk5MTVfdm1hX2ZsdXNoX3dyaXRlcyh2bWEpOwpAQCAtNDM1LDYgKzQ5Myw5IEBAIGJv
b2wgaTkxNV92bWFfbWlzcGxhY2VkKGNvbnN0IHN0cnVjdCBpOTE1X3ZtYSAqdm1hLAogCWlmICgh
ZHJtX21tX25vZGVfYWxsb2NhdGVkKCZ2bWEtPm5vZGUpKQogCQlyZXR1cm4gZmFsc2U7CiAKKwlp
ZiAodGVzdF9iaXQoSTkxNV9WTUFfRVJST1JfQklULCBfX2k5MTVfdm1hX2ZsYWdzKHZtYSkpKQor
CQlyZXR1cm4gdHJ1ZTsKKwogCWlmICh2bWEtPm5vZGUuc2l6ZSA8IHNpemUpCiAJCXJldHVybiB0
cnVlOwogCkBAIC01MzgsNyArNTk5LDYgQEAgc3RhdGljIHZvaWQgYXNzZXJ0X2JpbmRfY291bnQo
Y29uc3Qgc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iaikKIHN0YXRpYyBpbnQKIGk5MTVf
dm1hX2luc2VydChzdHJ1Y3QgaTkxNV92bWEgKnZtYSwgdTY0IHNpemUsIHU2NCBhbGlnbm1lbnQs
IHU2NCBmbGFncykKIHsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB2bWEt
PnZtLT5pOTE1OwogCXVuc2lnbmVkIGludCBjYWNoZV9sZXZlbDsKIAl1NjQgc3RhcnQsIGVuZDsK
IAlpbnQgcmV0OwpAQCAtNTY0LDcgKzYyNCw3IEBAIGk5MTVfdm1hX2luc2VydChzdHJ1Y3QgaTkx
NV92bWEgKnZtYSwgdTY0IHNpemUsIHU2NCBhbGlnbm1lbnQsIHU2NCBmbGFncykKIAogCWVuZCA9
IHZtYS0+dm0tPnRvdGFsOwogCWlmIChmbGFncyAmIFBJTl9NQVBQQUJMRSkKLQkJZW5kID0gbWlu
X3QodTY0LCBlbmQsIGRldl9wcml2LT5nZ3R0Lm1hcHBhYmxlX2VuZCk7CisJCWVuZCA9IG1pbl90
KHU2NCwgZW5kLCBpOTE1X3ZtX3RvX2dndHQodm1hLT52bSktPm1hcHBhYmxlX2VuZCk7CiAJaWYg
KGZsYWdzICYgUElOX1pPTkVfNEcpCiAJCWVuZCA9IG1pbl90KHU2NCwgZW5kLCAoMVVMTCA8PCAz
MikgLSBJOTE1X0dUVF9QQUdFX1NJWkUpOwogCUdFTV9CVUdfT04oIUlTX0FMSUdORUQoZW5kLCBJ
OTE1X0dUVF9QQUdFX1NJWkUpKTsKQEAgLTU4MCwzNSArNjQwLDIxIEBAIGk5MTVfdm1hX2luc2Vy
dChzdHJ1Y3QgaTkxNV92bWEgKnZtYSwgdTY0IHNpemUsIHU2NCBhbGlnbm1lbnQsIHU2NCBmbGFn
cykKIAkJcmV0dXJuIC1FTk9TUEM7CiAJfQogCi0JaWYgKHZtYS0+b2JqKSB7Ci0JCXJldCA9IGk5
MTVfZ2VtX29iamVjdF9waW5fcGFnZXModm1hLT5vYmopOwotCQlpZiAocmV0KQotCQkJcmV0dXJu
IHJldDsKLQorCWNhY2hlX2xldmVsID0gMDsKKwlpZiAodm1hLT5vYmopCiAJCWNhY2hlX2xldmVs
ID0gdm1hLT5vYmotPmNhY2hlX2xldmVsOwotCX0gZWxzZSB7Ci0JCWNhY2hlX2xldmVsID0gMDsK
LQl9Ci0KLQlHRU1fQlVHX09OKHZtYS0+cGFnZXMpOwotCi0JcmV0ID0gdm1hLT5vcHMtPnNldF9w
YWdlcyh2bWEpOwotCWlmIChyZXQpCi0JCWdvdG8gZXJyX3VucGluOwogCiAJaWYgKGZsYWdzICYg
UElOX09GRlNFVF9GSVhFRCkgewogCQl1NjQgb2Zmc2V0ID0gZmxhZ3MgJiBQSU5fT0ZGU0VUX01B
U0s7CiAJCWlmICghSVNfQUxJR05FRChvZmZzZXQsIGFsaWdubWVudCkgfHwKLQkJICAgIHJhbmdl
X292ZXJmbG93cyhvZmZzZXQsIHNpemUsIGVuZCkpIHsKLQkJCXJldCA9IC1FSU5WQUw7Ci0JCQln
b3RvIGVycl9jbGVhcjsKLQkJfQorCQkgICAgcmFuZ2Vfb3ZlcmZsb3dzKG9mZnNldCwgc2l6ZSwg
ZW5kKSkKKwkJCXJldHVybiAtRUlOVkFMOwogCiAJCXJldCA9IGk5MTVfZ2VtX2d0dF9yZXNlcnZl
KHZtYS0+dm0sICZ2bWEtPm5vZGUsCiAJCQkJCSAgIHNpemUsIG9mZnNldCwgY2FjaGVfbGV2ZWws
CiAJCQkJCSAgIGZsYWdzKTsKIAkJaWYgKHJldCkKLQkJCWdvdG8gZXJyX2NsZWFyOworCQkJcmV0
dXJuIHJldDsKIAl9IGVsc2UgewogCQkvKgogCQkgKiBXZSBvbmx5IHN1cHBvcnQgaHVnZSBndHQg
cGFnZXMgdGhyb3VnaCB0aGUgNDhiIFBQR1RULApAQCAtNjQ3LDcgKzY5Myw3IEBAIGk5MTVfdm1h
X2luc2VydChzdHJ1Y3QgaTkxNV92bWEgKnZtYSwgdTY0IHNpemUsIHU2NCBhbGlnbm1lbnQsIHU2
NCBmbGFncykKIAkJCQkJICBzaXplLCBhbGlnbm1lbnQsIGNhY2hlX2xldmVsLAogCQkJCQkgIHN0
YXJ0LCBlbmQsIGZsYWdzKTsKIAkJaWYgKHJldCkKLQkJCWdvdG8gZXJyX2NsZWFyOworCQkJcmV0
dXJuIHJldDsKIAogCQlHRU1fQlVHX09OKHZtYS0+bm9kZS5zdGFydCA8IHN0YXJ0KTsKIAkJR0VN
X0JVR19PTih2bWEtPm5vZGUuc3RhcnQgKyB2bWEtPm5vZGUuc2l6ZSA+IGVuZCk7CkBAIC02NTUs
MjMgKzcwMSwxNSBAQCBpOTE1X3ZtYV9pbnNlcnQoc3RydWN0IGk5MTVfdm1hICp2bWEsIHU2NCBz
aXplLCB1NjQgYWxpZ25tZW50LCB1NjQgZmxhZ3MpCiAJR0VNX0JVR19PTighZHJtX21tX25vZGVf
YWxsb2NhdGVkKCZ2bWEtPm5vZGUpKTsKIAlHRU1fQlVHX09OKCFpOTE1X2dlbV92YWxpZF9ndHRf
c3BhY2Uodm1hLCBjYWNoZV9sZXZlbCkpOwogCi0JbXV0ZXhfbG9jaygmdm1hLT52bS0+bXV0ZXgp
OwogCWxpc3RfYWRkX3RhaWwoJnZtYS0+dm1fbGluaywgJnZtYS0+dm0tPmJvdW5kX2xpc3QpOwot
CW11dGV4X3VubG9jaygmdm1hLT52bS0+bXV0ZXgpOwogCiAJaWYgKHZtYS0+b2JqKSB7CisJCWF0
b21pY19pbmMoJnZtYS0+b2JqLT5tbS5wYWdlc19waW5fY291bnQpOwogCQlhdG9taWNfaW5jKCZ2
bWEtPm9iai0+YmluZF9jb3VudCk7CiAJCWFzc2VydF9iaW5kX2NvdW50KHZtYS0+b2JqKTsKIAl9
CiAKIAlyZXR1cm4gMDsKLQotZXJyX2NsZWFyOgotCXZtYS0+b3BzLT5jbGVhcl9wYWdlcyh2bWEp
OwotZXJyX3VucGluOgotCWlmICh2bWEtPm9iaikKLQkJaTkxNV9nZW1fb2JqZWN0X3VucGluX3Bh
Z2VzKHZtYS0+b2JqKTsKLQlyZXR1cm4gcmV0OwogfQogCiBzdGF0aWMgdm9pZApAQCAtNjgwLDEy
ICs3MTgsNyBAQCBpOTE1X3ZtYV9yZW1vdmUoc3RydWN0IGk5MTVfdm1hICp2bWEpCiAJR0VNX0JV
R19PTighZHJtX21tX25vZGVfYWxsb2NhdGVkKCZ2bWEtPm5vZGUpKTsKIAlHRU1fQlVHX09OKGk5
MTVfdm1hX2lzX2JvdW5kKHZtYSwgSTkxNV9WTUFfR0xPQkFMX0JJTkQgfCBJOTE1X1ZNQV9MT0NB
TF9CSU5EKSk7CiAKLQl2bWEtPm9wcy0+Y2xlYXJfcGFnZXModm1hKTsKLQotCW11dGV4X2xvY2so
JnZtYS0+dm0tPm11dGV4KTsKLQlkcm1fbW1fcmVtb3ZlX25vZGUoJnZtYS0+bm9kZSk7CiAJbGlz
dF9kZWwoJnZtYS0+dm1fbGluayk7Ci0JbXV0ZXhfdW5sb2NrKCZ2bWEtPnZtLT5tdXRleCk7CiAK
IAkvKgogCSAqIFNpbmNlIHRoZSB1bmJvdW5kIGxpc3QgaXMgZ2xvYmFsLCBvbmx5IG1vdmUgdG8g
dGhhdCBsaXN0IGlmCkBAIC03MDQsNTEgKzczNywyMDYgQEAgaTkxNV92bWFfcmVtb3ZlKHN0cnVj
dCBpOTE1X3ZtYSAqdm1hKQogCQlpOTE1X2dlbV9vYmplY3RfdW5waW5fcGFnZXMob2JqKTsKIAkJ
YXNzZXJ0X2JpbmRfY291bnQob2JqKTsKIAl9CisKKwlkcm1fbW1fcmVtb3ZlX25vZGUoJnZtYS0+
bm9kZSk7CiB9CiAKLWludCBfX2k5MTVfdm1hX2RvX3BpbihzdHJ1Y3QgaTkxNV92bWEgKnZtYSwK
LQkJICAgICAgdTY0IHNpemUsIHU2NCBhbGlnbm1lbnQsIHU2NCBmbGFncykKK3N0YXRpYyBib29s
IHRyeV9mYXN0X3BpbihzdHJ1Y3QgaTkxNV92bWEgKnZtYSwgdW5zaWduZWQgaW50IGZsYWdzKQog
ewotCWNvbnN0IHVuc2lnbmVkIGludCBib3VuZCA9IGF0b21pY19yZWFkKCZ2bWEtPmZsYWdzKTsK
LQlpbnQgcmV0OworCXVuc2lnbmVkIGludCBib3VuZDsKKwlib29sIHBpbm5lZCA9IHRydWU7CiAK
LQlsb2NrZGVwX2Fzc2VydF9oZWxkKCZ2bWEtPnZtLT5pOTE1LT5kcm0uc3RydWN0X211dGV4KTsK
LQlHRU1fQlVHX09OKChmbGFncyAmIChQSU5fR0xPQkFMIHwgUElOX1VTRVIpKSA9PSAwKTsKLQlH
RU1fQlVHX09OKChmbGFncyAmIFBJTl9HTE9CQUwpICYmICFpOTE1X3ZtYV9pc19nZ3R0KHZtYSkp
OworCWJvdW5kID0gYXRvbWljX3JlYWQoJnZtYS0+ZmxhZ3MpOworCWRvIHsKKwkJaWYgKHVubGlr
ZWx5KGZsYWdzICYgfmJvdW5kKSkKKwkJCXJldHVybiBmYWxzZTsKIAotCWlmIChXQVJOX09OKGJv
dW5kICYgSTkxNV9WTUFfUElOX09WRVJGTE9XKSkgewotCQlyZXQgPSAtRUJVU1k7Ci0JCWdvdG8g
ZXJyX3VucGluOworCQlpZiAodW5saWtlbHkoYm91bmQgJiAoSTkxNV9WTUFfT1ZFUkZMT1cgfCBJ
OTE1X1ZNQV9FUlJPUikpKQorCQkJcmV0dXJuIGZhbHNlOworCisJCWlmICghKGJvdW5kICYgSTkx
NV9WTUFfUElOX01BU0spKQorCQkJZ290byBzbG93OworCisJCUdFTV9CVUdfT04oKChib3VuZCAr
IDEpICYgSTkxNV9WTUFfUElOX01BU0spID09IDApOworCX0gd2hpbGUgKCFhdG9taWNfdHJ5X2Nt
cHhjaGcoJnZtYS0+ZmxhZ3MsICZib3VuZCwgYm91bmQgKyAxKSk7CisKKwlyZXR1cm4gdHJ1ZTsK
Kworc2xvdzoKKwkvKgorCSAqIElmIHBpbl9jb3VudD09MCwgYnV0IHdlIGFyZSBib3VuZCwgY2hl
Y2sgdW5kZXIgdGhlIGxvY2sgdG8gYXZvaWQKKwkgKiByYWNpbmcgd2l0aCBhIGNvbmN1cnJlbnQg
aTkxNV92bWFfdW5iaW5kKCkuCisJICovCisJbXV0ZXhfbG9jaygmdm1hLT52bS0+bXV0ZXgpOwor
CWRvIHsKKwkJaWYgKHVubGlrZWx5KGJvdW5kICYgKEk5MTVfVk1BX09WRVJGTE9XIHwgSTkxNV9W
TUFfRVJST1IpKSkgeworCQkJcGlubmVkID0gZmFsc2U7CisJCQlicmVhazsKKwkJfQorCisJCWlm
ICh1bmxpa2VseShmbGFncyAmIH5ib3VuZCkpIHsKKwkJCXBpbm5lZCA9IGZhbHNlOworCQkJYnJl
YWs7CisJCX0KKwl9IHdoaWxlICghYXRvbWljX3RyeV9jbXB4Y2hnKCZ2bWEtPmZsYWdzLCAmYm91
bmQsIGJvdW5kICsgMSkpOworCW11dGV4X3VubG9jaygmdm1hLT52bS0+bXV0ZXgpOworCisJcmV0
dXJuIHBpbm5lZDsKK30KKworc3RhdGljIGludCB2bWFfZ2V0X3BhZ2VzKHN0cnVjdCBpOTE1X3Zt
YSAqdm1hKQoreworCWludCBlcnIgPSAwOworCisJaWYgKGF0b21pY19hZGRfdW5sZXNzKCZ2bWEt
PnBhZ2VzX2NvdW50LCAxLCAwKSkKKwkJcmV0dXJuIDA7CisKKwlpZiAobXV0ZXhfbG9ja19pbnRl
cnJ1cHRpYmxlKCZ2bWEtPnBhZ2VzX211dGV4KSkKKwkJcmV0dXJuIC1FSU5UUjsKKworCWlmICgh
YXRvbWljX3JlYWQoJnZtYS0+cGFnZXNfY291bnQpKSB7CisJCWlmICh2bWEtPm9iaikgeworCQkJ
ZXJyID0gaTkxNV9nZW1fb2JqZWN0X3Bpbl9wYWdlcyh2bWEtPm9iaik7CisJCQlpZiAoZXJyKQor
CQkJCWdvdG8gdW5sb2NrOworCQl9CisKKwkJZXJyID0gdm1hLT5vcHMtPnNldF9wYWdlcyh2bWEp
OworCQlpZiAoZXJyKQorCQkJZ290byB1bmxvY2s7CiAJfQorCWF0b21pY19pbmMoJnZtYS0+cGFn
ZXNfY291bnQpOwogCi0JaWYgKChib3VuZCAmIEk5MTVfVk1BX0JJTkRfTUFTSykgPT0gMCkgewot
CQlyZXQgPSBpOTE1X3ZtYV9pbnNlcnQodm1hLCBzaXplLCBhbGlnbm1lbnQsIGZsYWdzKTsKLQkJ
aWYgKHJldCkKLQkJCWdvdG8gZXJyX3VucGluOwordW5sb2NrOgorCW11dGV4X3VubG9jaygmdm1h
LT5wYWdlc19tdXRleCk7CisKKwlyZXR1cm4gZXJyOworfQorCitzdGF0aWMgdm9pZCBfX3ZtYV9w
dXRfcGFnZXMoc3RydWN0IGk5MTVfdm1hICp2bWEsIHVuc2lnbmVkIGludCBjb3VudCkKK3sKKwlt
dXRleF9sb2NrX25lc3RlZCgmdm1hLT5wYWdlc19tdXRleCwgU0lOR0xFX0RFUFRIX05FU1RJTkcp
OworCUdFTV9CVUdfT04oYXRvbWljX3JlYWQoJnZtYS0+cGFnZXNfY291bnQpIDwgY291bnQpOwor
CWlmIChhdG9taWNfc3ViX3JldHVybihjb3VudCwgJnZtYS0+cGFnZXNfY291bnQpID09IDApIHsK
KwkJdm1hLT5vcHMtPmNsZWFyX3BhZ2VzKHZtYSk7CisJCUdFTV9CVUdfT04odm1hLT5wYWdlcyk7
CisJCWlmICh2bWEtPm9iaikKKwkJCWk5MTVfZ2VtX29iamVjdF91bnBpbl9wYWdlcyh2bWEtPm9i
aik7CiAJfQotCUdFTV9CVUdfT04oIWRybV9tbV9ub2RlX2FsbG9jYXRlZCgmdm1hLT5ub2RlKSk7
CisJbXV0ZXhfdW5sb2NrKCZ2bWEtPnBhZ2VzX211dGV4KTsKK30KIAotCXJldCA9IGk5MTVfdm1h
X2JpbmQodm1hLCB2bWEtPm9iaiA/IHZtYS0+b2JqLT5jYWNoZV9sZXZlbCA6IDAsIGZsYWdzKTsK
LQlpZiAocmV0KQotCQlnb3RvIGVycl9yZW1vdmU7CitzdGF0aWMgdm9pZCB2bWFfcHV0X3BhZ2Vz
KHN0cnVjdCBpOTE1X3ZtYSAqdm1hKQoreworCWlmIChhdG9taWNfYWRkX3VubGVzcygmdm1hLT5w
YWdlc19jb3VudCwgLTEsIDEpKQorCQlyZXR1cm47CiAKLQlHRU1fQlVHX09OKCFpOTE1X3ZtYV9p
c19ib3VuZCh2bWEsIEk5MTVfVk1BX0JJTkRfTUFTSykpOworCV9fdm1hX3B1dF9wYWdlcyh2bWEs
IDEpOworfQorCitzdGF0aWMgdm9pZCB2bWFfdW5iaW5kX3BhZ2VzKHN0cnVjdCBpOTE1X3ZtYSAq
dm1hKQoreworCXVuc2lnbmVkIGludCBjb3VudDsKKworCWxvY2tkZXBfYXNzZXJ0X2hlbGQoJnZt
YS0+dm0tPm11dGV4KTsKKworCWNvdW50ID0gYXRvbWljX3JlYWQoJnZtYS0+cGFnZXNfY291bnQp
OworCWNvdW50ID4+PSBJOTE1X1ZNQV9QQUdFU19CSUFTOworCUdFTV9CVUdfT04oIWNvdW50KTsK
KworCV9fdm1hX3B1dF9wYWdlcyh2bWEsIGNvdW50IHwgY291bnQgPDwgSTkxNV9WTUFfUEFHRVNf
QklBUyk7Cit9CisKK2ludCBpOTE1X3ZtYV9waW4oc3RydWN0IGk5MTVfdm1hICp2bWEsIHU2NCBz
aXplLCB1NjQgYWxpZ25tZW50LCB1NjQgZmxhZ3MpCit7CisJc3RydWN0IGk5MTVfdm1hX3dvcmsg
KndvcmsgPSBOVUxMOworCXVuc2lnbmVkIGludCBib3VuZDsKKwlpbnQgZXJyOworCisJQlVJTERf
QlVHX09OKFBJTl9HTE9CQUwgIT0gSTkxNV9WTUFfR0xPQkFMX0JJTkQpOworCUJVSUxEX0JVR19P
TihQSU5fVVNFUiAhPSBJOTE1X1ZNQV9MT0NBTF9CSU5EKTsKKworCUdFTV9CVUdfT04oZmxhZ3Mg
JiBQSU5fVVBEQVRFKTsKKwlHRU1fQlVHX09OKCEoZmxhZ3MgJiAoUElOX1VTRVIgfCBQSU5fR0xP
QkFMKSkpOwogCi0JaWYgKChib3VuZCBeIGF0b21pY19yZWFkKCZ2bWEtPmZsYWdzKSkgJiBJOTE1
X1ZNQV9HTE9CQUxfQklORCkKLQkJX19pOTE1X3ZtYV9zZXRfbWFwX2FuZF9mZW5jZWFibGUodm1h
KTsKKwlpZiAodHJ5X2Zhc3RfcGluKHZtYSwgZmxhZ3MgJiBJOTE1X1ZNQV9CSU5EX01BU0spKQor
CQlyZXR1cm4gMDsKKworCWVyciA9IHZtYV9nZXRfcGFnZXModm1hKTsKKwlpZiAoZXJyKQorCQly
ZXR1cm4gZXJyOworCisJaWYgKGZsYWdzICYgUElOX1VTRVIpIHsKKwkJd29yayA9IGk5MTVfdm1h
X3dvcmsoKTsKKwkJaWYgKCF3b3JrKSB7CisJCQllcnIgPSAtRU5PTUVNOworCQkJZ290byBlcnJf
cGFnZXM7CisJCX0KKwl9CisKKwllcnIgPSBtdXRleF9sb2NrX2ludGVycnVwdGlibGUoJnZtYS0+
dm0tPm11dGV4KTsKKwlpZiAoZXJyKQorCQlnb3RvIGVycl9mZW5jZTsKKworCWJvdW5kID0gYXRv
bWljX3JlYWQoJnZtYS0+ZmxhZ3MpOworCWlmICh1bmxpa2VseShib3VuZCAmIEk5MTVfVk1BX0VS
Uk9SKSkgeworCQllcnIgPSAtRU5PTUVNOworCQlnb3RvIGVycl91bmxvY2s7CisJfQogCisJaWYg
KHVubGlrZWx5KCEoKGJvdW5kICsgMSkgJiBJOTE1X1ZNQV9QSU5fTUFTSykpKSB7CisJCWVyciA9
IC1FQUdBSU47IC8qIHBpbnMgYXJlIG1lYW50IHRvIGJlIGZhaXJseSB0ZW1wb3JhcnkgKi8KKwkJ
Z290byBlcnJfdW5sb2NrOworCX0KKworCWlmICh1bmxpa2VseSghKGZsYWdzICYgfmJvdW5kICYg
STkxNV9WTUFfQklORF9NQVNLKSkpIHsKKwkJX19pOTE1X3ZtYV9waW4odm1hKTsKKwkJZ290byBl
cnJfdW5sb2NrOworCX0KKworCWVyciA9IGk5MTVfYWN0aXZlX2FjcXVpcmUoJnZtYS0+YWN0aXZl
KTsKKwlpZiAoZXJyKQorCQlnb3RvIGVycl91bmxvY2s7CisKKwlpZiAoIShib3VuZCAmIEk5MTVf
Vk1BX0JJTkRfTUFTSykpIHsKKwkJZXJyID0gaTkxNV92bWFfaW5zZXJ0KHZtYSwgc2l6ZSwgYWxp
Z25tZW50LCBmbGFncyk7CisJCWlmIChlcnIpCisJCQlnb3RvIGVycl9hY3RpdmU7CisKKwkJaWYg
KGk5MTVfaXNfZ2d0dCh2bWEtPnZtKSkKKwkJCV9faTkxNV92bWFfc2V0X21hcF9hbmRfZmVuY2Vh
YmxlKHZtYSk7CisJfQorCisJR0VNX0JVR19PTighdm1hLT5wYWdlcyk7CisJZXJyID0gaTkxNV92
bWFfYmluZCh2bWEsCisJCQkgICAgdm1hLT5vYmogPyB2bWEtPm9iai0+Y2FjaGVfbGV2ZWwgOiAw
LAorCQkJICAgIGZsYWdzLCB3b3JrKTsKKwlpZiAoZXJyKQorCQlnb3RvIGVycl9yZW1vdmU7CisK
KwkvKiBUaGVyZSBzaG91bGQgb25seSBiZSBhdCBtb3N0IDIgYWN0aXZlIGJpbmRpbmdzICh1c2Vy
LCBnbG9iYWwpICovCisJR0VNX0JVR19PTihib3VuZCArIEk5MTVfVk1BX1BBR0VTX0FDVElWRSA8
IGJvdW5kKTsKKwlhdG9taWNfYWRkKEk5MTVfVk1BX1BBR0VTX0FDVElWRSwgJnZtYS0+cGFnZXNf
Y291bnQpOworCWxpc3RfbW92ZV90YWlsKCZ2bWEtPnZtX2xpbmssICZ2bWEtPnZtLT5ib3VuZF9s
aXN0KTsKKworCV9faTkxNV92bWFfcGluKHZtYSk7CisJR0VNX0JVR19PTighaTkxNV92bWFfaXNf
cGlubmVkKHZtYSkpOworCUdFTV9CVUdfT04oIWk5MTVfdm1hX2lzX2JvdW5kKHZtYSwgZmxhZ3Mp
KTsKIAlHRU1fQlVHX09OKGk5MTVfdm1hX21pc3BsYWNlZCh2bWEsIHNpemUsIGFsaWdubWVudCwg
ZmxhZ3MpKTsKLQlyZXR1cm4gMDsKIAogZXJyX3JlbW92ZToKLQlpZiAoKGJvdW5kICYgSTkxNV9W
TUFfQklORF9NQVNLKSA9PSAwKSB7CisJaWYgKCFpOTE1X3ZtYV9pc19ib3VuZCh2bWEsIEk5MTVf
Vk1BX0JJTkRfTUFTSykpCiAJCWk5MTVfdm1hX3JlbW92ZSh2bWEpOwotCQlHRU1fQlVHX09OKHZt
YS0+cGFnZXMpOwotCQlHRU1fQlVHX09OKGF0b21pY19yZWFkKCZ2bWEtPmZsYWdzKSAmIEk5MTVf
Vk1BX0JJTkRfTUFTSyk7Ci0JfQotZXJyX3VucGluOgotCV9faTkxNV92bWFfdW5waW4odm1hKTsK
LQlyZXR1cm4gcmV0OworZXJyX2FjdGl2ZToKKwlpOTE1X2FjdGl2ZV9yZWxlYXNlKCZ2bWEtPmFj
dGl2ZSk7CitlcnJfdW5sb2NrOgorCW11dGV4X3VubG9jaygmdm1hLT52bS0+bXV0ZXgpOworZXJy
X2ZlbmNlOgorCWlmICh3b3JrKQorCQlkbWFfZmVuY2Vfd29ya19jb21taXQoJndvcmstPmJhc2Up
OworZXJyX3BhZ2VzOgorCXZtYV9wdXRfcGFnZXModm1hKTsKKwlyZXR1cm4gZXJyOwogfQogCiB2
b2lkIGk5MTVfdm1hX2Nsb3NlKHN0cnVjdCBpOTE1X3ZtYSAqdm1hKQpAQCAtNzc5LDkgKzk2Nyw2
IEBAIHN0YXRpYyB2b2lkIF9faTkxNV92bWFfcmVtb3ZlX2Nsb3NlZChzdHJ1Y3QgaTkxNV92bWEg
KnZtYSkKIHsKIAlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IHZtYS0+dm0tPmk5MTU7
CiAKLQlpZiAoIWk5MTVfdm1hX2lzX2Nsb3NlZCh2bWEpKQotCQlyZXR1cm47Ci0KIAlzcGluX2xv
Y2tfaXJxKCZpOTE1LT5ndC5jbG9zZWRfbG9jayk7CiAJbGlzdF9kZWxfaW5pdCgmdm1hLT5jbG9z
ZWRfbGluayk7CiAJc3Bpbl91bmxvY2tfaXJxKCZpOTE1LT5ndC5jbG9zZWRfbG9jayk7CkBAIC03
ODksNDAgKzk3NCwzNSBAQCBzdGF0aWMgdm9pZCBfX2k5MTVfdm1hX3JlbW92ZV9jbG9zZWQoc3Ry
dWN0IGk5MTVfdm1hICp2bWEpCiAKIHZvaWQgaTkxNV92bWFfcmVvcGVuKHN0cnVjdCBpOTE1X3Zt
YSAqdm1hKQogewotCV9faTkxNV92bWFfcmVtb3ZlX2Nsb3NlZCh2bWEpOworCWlmIChpOTE1X3Zt
YV9pc19jbG9zZWQodm1hKSkKKwkJX19pOTE1X3ZtYV9yZW1vdmVfY2xvc2VkKHZtYSk7CiB9CiAK
LXN0YXRpYyB2b2lkIF9faTkxNV92bWFfZGVzdHJveShzdHJ1Y3QgaTkxNV92bWEgKnZtYSkKK3Zv
aWQgaTkxNV92bWFfZGVzdHJveShzdHJ1Y3QgaTkxNV92bWEgKnZtYSkKIHsKLQlHRU1fQlVHX09O
KGRybV9tbV9ub2RlX2FsbG9jYXRlZCgmdm1hLT5ub2RlKSk7Ci0JR0VNX0JVR19PTih2bWEtPmZl
bmNlKTsKKwlpZiAoZHJtX21tX25vZGVfYWxsb2NhdGVkKCZ2bWEtPm5vZGUpKSB7CisJCW11dGV4
X2xvY2soJnZtYS0+dm0tPm11dGV4KTsKKwkJYXRvbWljX2FuZCh+STkxNV9WTUFfUElOX01BU0ss
ICZ2bWEtPmZsYWdzKTsKKwkJV0FSTl9PTihpOTE1X3ZtYV91bmJpbmQodm1hKSk7CisJCW11dGV4
X3VubG9jaygmdm1hLT52bS0+bXV0ZXgpOworCQlHRU1fQlVHX09OKGRybV9tbV9ub2RlX2FsbG9j
YXRlZCgmdm1hLT5ub2RlKSk7CisJfQorCUdFTV9CVUdfT04oaTkxNV92bWFfaXNfYWN0aXZlKHZt
YSkpOwogCiAJaWYgKHZtYS0+b2JqKSB7CiAJCXN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpv
YmogPSB2bWEtPm9iajsKIAogCQlzcGluX2xvY2soJm9iai0+dm1hLmxvY2spOwogCQlsaXN0X2Rl
bCgmdm1hLT5vYmpfbGluayk7Ci0JCXJiX2VyYXNlKCZ2bWEtPm9ial9ub2RlLCAmdm1hLT5vYmot
PnZtYS50cmVlKTsKKwkJcmJfZXJhc2UoJnZtYS0+b2JqX25vZGUsICZvYmotPnZtYS50cmVlKTsK
IAkJc3Bpbl91bmxvY2soJm9iai0+dm1hLmxvY2spOwogCX0KIAotCWk5MTVfYWN0aXZlX2Zpbmko
JnZtYS0+YWN0aXZlKTsKLQotCWk5MTVfdm1hX2ZyZWUodm1hKTsKLX0KLQotdm9pZCBpOTE1X3Zt
YV9kZXN0cm95KHN0cnVjdCBpOTE1X3ZtYSAqdm1hKQotewotCWxvY2tkZXBfYXNzZXJ0X2hlbGQo
JnZtYS0+dm0tPmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwotCi0JR0VNX0JVR19PTihpOTE1X3Zt
YV9pc19waW5uZWQodm1hKSk7Ci0KIAlfX2k5MTVfdm1hX3JlbW92ZV9jbG9zZWQodm1hKTsKKwlp
OTE1X3ZtX3B1dCh2bWEtPnZtKTsKIAotCVdBUk5fT04oaTkxNV92bWFfdW5iaW5kKHZtYSkpOwot
CUdFTV9CVUdfT04oaTkxNV92bWFfaXNfYWN0aXZlKHZtYSkpOwotCi0JX19pOTE1X3ZtYV9kZXN0
cm95KHZtYSk7CisJaTkxNV9hY3RpdmVfZmluaSgmdm1hLT5hY3RpdmUpOworCWk5MTVfdm1hX2Zy
ZWUodm1hKTsKIH0KIAogdm9pZCBpOTE1X3ZtYV9wYXJrZWQoc3RydWN0IGRybV9pOTE1X3ByaXZh
dGUgKmk5MTUpCkBAIC04MzEsMTIgKzEwMTEsMzIgQEAgdm9pZCBpOTE1X3ZtYV9wYXJrZWQoc3Ry
dWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpCiAKIAlzcGluX2xvY2tfaXJxKCZpOTE1LT5ndC5j
bG9zZWRfbG9jayk7CiAJbGlzdF9mb3JfZWFjaF9lbnRyeV9zYWZlKHZtYSwgbmV4dCwgJmk5MTUt
Pmd0LmNsb3NlZF92bWEsIGNsb3NlZF9saW5rKSB7Ci0JCWxpc3RfZGVsX2luaXQoJnZtYS0+Y2xv
c2VkX2xpbmspOworCQlzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2JqID0gdm1hLT5vYmo7
CisJCXN0cnVjdCBpOTE1X2FkZHJlc3Nfc3BhY2UgKnZtID0gdm1hLT52bTsKKworCQkvKiBYWFgg
QWxsIHRvIGF2b2lkIGtlZXBpbmcgYSByZWZlcmVuY2Ugb24gaTkxNV92bWEgaXRzZWxmICovCisK
KwkJaWYgKCFrcmVmX2dldF91bmxlc3NfemVybygmb2JqLT5iYXNlLnJlZmNvdW50KSkKKwkJCWNv
bnRpbnVlOworCisJCWlmICghaTkxNV92bV90cnlvcGVuKHZtKSkgeworCQkJaTkxNV9nZW1fb2Jq
ZWN0X3B1dChvYmopOworCQkJb2JqID0gTlVMTDsKKwkJfQorCiAJCXNwaW5fdW5sb2NrX2lycSgm
aTkxNS0+Z3QuY2xvc2VkX2xvY2spOwogCi0JCWk5MTVfdm1hX2Rlc3Ryb3kodm1hKTsKKwkJaWYg
KG9iaikgeworCQkJaTkxNV92bWFfZGVzdHJveSh2bWEpOworCQkJaTkxNV9nZW1fb2JqZWN0X3B1
dChvYmopOworCQl9CisKKwkJaTkxNV92bV9jbG9zZSh2bSk7CiAKKwkJLyogUmVzdGFydCBhZnRl
ciBkcm9wcGluZyBsb2NrICovCiAJCXNwaW5fbG9ja19pcnEoJmk5MTUtPmd0LmNsb3NlZF9sb2Nr
KTsKKwkJbmV4dCA9IGxpc3RfZmlyc3RfZW50cnkoJmk5MTUtPmd0LmNsb3NlZF92bWEsCisJCQkJ
CXR5cGVvZigqbmV4dCksIGNsb3NlZF9saW5rKTsKIAl9CiAJc3Bpbl91bmxvY2tfaXJxKCZpOTE1
LT5ndC5jbG9zZWRfbG9jayk7CiB9CkBAIC04ODcsNiArMTA4NywxMCBAQCBpbnQgaTkxNV92bWFf
bW92ZV90b19hY3RpdmUoc3RydWN0IGk5MTVfdm1hICp2bWEsCiAJYXNzZXJ0X29iamVjdF9oZWxk
KG9iaik7CiAJR0VNX0JVR19PTighZHJtX21tX25vZGVfYWxsb2NhdGVkKCZ2bWEtPm5vZGUpKTsK
IAorCWVyciA9IGk5MTVfcmVxdWVzdF9hd2FpdF9hY3RpdmUocnEsICZ2bWEtPmFjdGl2ZSk7CisJ
aWYgKGVycikKKwkJcmV0dXJuIGVycjsKKwogCS8qCiAJICogQWRkIGEgcmVmZXJlbmNlIGlmIHdl
J3JlIG5ld2x5IGVudGVyaW5nIHRoZSBhY3RpdmUgbGlzdC4KIAkgKiBUaGUgb3JkZXIgaW4gd2hp
Y2ggd2UgYWRkIG9wZXJhdGlvbnMgdG8gdGhlIHJldGlyZW1lbnQgcXVldWUgaXMKQEAgLTkyNywz
NCArMTEzMSwxOSBAQCBpbnQgaTkxNV92bWFfdW5iaW5kKHN0cnVjdCBpOTE1X3ZtYSAqdm1hKQog
ewogCWludCByZXQ7CiAKLQlsb2NrZGVwX2Fzc2VydF9oZWxkKCZ2bWEtPnZtLT5pOTE1LT5kcm0u
c3RydWN0X211dGV4KTsKKwlsb2NrZGVwX2Fzc2VydF9oZWxkKCZ2bWEtPnZtLT5tdXRleCk7CiAK
IAkvKgogCSAqIEZpcnN0IHdhaXQgdXBvbiBhbnkgYWN0aXZpdHkgYXMgcmV0aXJpbmcgdGhlIHJl
cXVlc3QgbWF5CiAJICogaGF2ZSBzaWRlLWVmZmVjdHMgc3VjaCBhcyB1bnBpbm5pbmcgb3IgZXZl
biB1bmJpbmRpbmcgdGhpcyB2bWEuCisJICoKKwkgKiBYWFggQWN0dWFsbHkgd2FpdGluZyB1bmRl
ciB0aGUgdm0tPm11dGV4IGlzIGEgaGluZGVyYW5jZSBhbmQKKwkgKiBzaG91bGQgYmUgcGlwZWxp
bmVkIHdoZXJldmVyIHBvc3NpYmxlLiBJbiBjYXNlcyB3aGVyZSB0aGF0IGlzCisJICogdW5hdm9p
ZGFibGUsIHdlIHNob3VsZCBsaWZ0IHRoZSB3YWl0IHRvIGJlZm9yZSB0aGUgbXV0ZXguCiAJICov
Ci0JbWlnaHRfc2xlZXAoKTsKLQlpZiAoaTkxNV92bWFfaXNfYWN0aXZlKHZtYSkpIHsKLQkJLyoK
LQkJICogV2hlbiBhIGNsb3NlZCBWTUEgaXMgcmV0aXJlZCwgaXQgaXMgdW5ib3VuZCAtIGVlay4K
LQkJICogSW4gb3JkZXIgdG8gcHJldmVudCBpdCBmcm9tIGJlaW5nIHJlY3Vyc2l2ZWx5IGNsb3Nl
ZCwKLQkJICogdGFrZSBhIHBpbiBvbiB0aGUgdm1hIHNvIHRoYXQgdGhlIHNlY29uZCB1bmJpbmQg
aXMKLQkJICogYWJvcnRlZC4KLQkJICoKLQkJICogRXZlbiBtb3JlIHNjYXJ5IGlzIHRoYXQgdGhl
IHJldGlyZSBjYWxsYmFjayBtYXkgZnJlZQotCQkgKiB0aGUgb2JqZWN0IChsYXN0IGFjdGl2ZSB2
bWEpLiBUbyBwcmV2ZW50IHRoZSBleHBsb3Npb24KLQkJICogd2UgZGVmZXIgdGhlIGFjdHVhbCBv
YmplY3QgZnJlZSB0byBhIHdvcmtlciB0aGF0IGNhbgotCQkgKiBvbmx5IHByb2NlZWQgb25jZSBp
dCBhY3F1aXJlcyB0aGUgc3RydWN0X211dGV4ICh3aGljaAotCQkgKiB3ZSBjdXJyZW50bHkgaG9s
ZCwgdGhlcmVmb3JlIGl0IGNhbm5vdCBmcmVlIHRoaXMgb2JqZWN0Ci0JCSAqIGJlZm9yZSB3ZSBh
cmUgZmluaXNoZWQpLgotCQkgKi8KLQkJX19pOTE1X3ZtYV9waW4odm1hKTsKLQkJcmV0ID0gaTkx
NV9hY3RpdmVfd2FpdCgmdm1hLT5hY3RpdmUpOwotCQlfX2k5MTVfdm1hX3VucGluKHZtYSk7Ci0J
CWlmIChyZXQpCi0JCQlyZXR1cm4gcmV0OwotCX0KLQlHRU1fQlVHX09OKGk5MTVfdm1hX2lzX2Fj
dGl2ZSh2bWEpKTsKKwlyZXQgPSBpOTE1X2FjdGl2ZV93YWl0KCZ2bWEtPmFjdGl2ZSk7CisJaWYg
KHJldCkKKwkJcmV0dXJuIHJldDsKIAogCWlmIChpOTE1X3ZtYV9pc19waW5uZWQodm1hKSkgewog
CQl2bWFfcHJpbnRfYWxsb2NhdG9yKHZtYSwgImlzIHBpbm5lZCIpOwpAQCAtOTc1LDE2ICsxMTY0
LDEyIEBAIGludCBpOTE1X3ZtYV91bmJpbmQoc3RydWN0IGk5MTVfdm1hICp2bWEpCiAJCUdFTV9C
VUdfT04oaTkxNV92bWFfaGFzX2dndHRfd3JpdGUodm1hKSk7CiAKIAkJLyogcmVsZWFzZSB0aGUg
ZmVuY2UgcmVnIF9hZnRlcl8gZmx1c2hpbmcgKi8KLQkJbXV0ZXhfbG9jaygmdm1hLT52bS0+bXV0
ZXgpOwogCQlyZXQgPSBpOTE1X3ZtYV9yZXZva2VfZmVuY2Uodm1hKTsKLQkJbXV0ZXhfdW5sb2Nr
KCZ2bWEtPnZtLT5tdXRleCk7CiAJCWlmIChyZXQpCiAJCQlyZXR1cm4gcmV0OwogCiAJCS8qIEZv
cmNlIGEgcGFnZWZhdWx0IGZvciBkb21haW4gdHJhY2tpbmcgb24gbmV4dCB1c2VyIGFjY2VzcyAq
LwotCQltdXRleF9sb2NrKCZ2bWEtPnZtLT5tdXRleCk7CiAJCWk5MTVfdm1hX3Jldm9rZV9tbWFw
KHZtYSk7Ci0JCW11dGV4X3VubG9jaygmdm1hLT52bS0+bXV0ZXgpOwogCiAJCV9faTkxNV92bWFf
aW91bm1hcCh2bWEpOwogCQljbGVhcl9iaXQoSTkxNV9WTUFfQ0FOX0ZFTkNFX0JJVCwgX19pOTE1
X3ZtYV9mbGFncyh2bWEpKTsKQEAgLTk5MiwxMiArMTE3NywxMyBAQCBpbnQgaTkxNV92bWFfdW5i
aW5kKHN0cnVjdCBpOTE1X3ZtYSAqdm1hKQogCUdFTV9CVUdfT04odm1hLT5mZW5jZSk7CiAJR0VN
X0JVR19PTihpOTE1X3ZtYV9oYXNfdXNlcmZhdWx0KHZtYSkpOwogCi0JaWYgKGxpa2VseSghdm1h
LT52bS0+Y2xvc2VkKSkgeworCWlmIChsaWtlbHkoYXRvbWljX3JlYWQoJnZtYS0+dm0tPm9wZW4p
KSkgewogCQl0cmFjZV9pOTE1X3ZtYV91bmJpbmQodm1hKTsKIAkJdm1hLT5vcHMtPnVuYmluZF92
bWEodm1hKTsKIAl9Ci0JYXRvbWljX2FuZCh+STkxNV9WTUFfQklORF9NQVNLLCAmdm1hLT5mbGFn
cyk7CisJYXRvbWljX2FuZCh+KEk5MTVfVk1BX0JJTkRfTUFTSyB8IEk5MTVfVk1BX0VSUk9SKSwg
JnZtYS0+ZmxhZ3MpOwogCisJdm1hX3VuYmluZF9wYWdlcyh2bWEpOwogCWk5MTVfdm1hX3JlbW92
ZSh2bWEpOwogCiAJcmV0dXJuIDA7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9p
OTE1X3ZtYS5oIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV92bWEuaAppbmRleCA2MDUzY2Ux
ZGM5NWMuLmE3ODRkYzg3OTE2OCAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkx
NV92bWEuaAorKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3ZtYS5oCkBAIC05NiwyNSAr
OTYsMjggQEAgc3RydWN0IGk5MTVfdm1hIHsKIAkgKiBleGNsdXNpdmUgY2FjaGVsaW5lcyBvZiBh
IHNpbmdsZSBwYWdlLCBzbyBhIG1heGltdW0gb2YgNjQgcG9zc2libGUKIAkgKiB1c2Vycy4KIAkg
Ki8KLSNkZWZpbmUgSTkxNV9WTUFfUElOX01BU0sgMHhmZgotI2RlZmluZSBJOTE1X1ZNQV9QSU5f
T1ZFUkZMT1dfQklUIDgKLSNkZWZpbmUgSTkxNV9WTUFfUElOX09WRVJGTE9XCSgoaW50KUJJVChJ
OTE1X1ZNQV9QSU5fT1ZFUkZMT1dfQklUKSkKKyNkZWZpbmUgSTkxNV9WTUFfUElOX01BU0sgMHgz
ZmYKKyNkZWZpbmUgSTkxNV9WTUFfT1ZFUkZMT1cgMHgyMDAKIAogCS8qKiBGbGFncyBhbmQgYWRk
cmVzcyBzcGFjZSB0aGlzIFZNQSBpcyBib3VuZCB0byAqLwotI2RlZmluZSBJOTE1X1ZNQV9HTE9C
QUxfQklORF9CSVQgOQotI2RlZmluZSBJOTE1X1ZNQV9MT0NBTF9CSU5EX0JJVCAxMAorI2RlZmlu
ZSBJOTE1X1ZNQV9HTE9CQUxfQklORF9CSVQgMTAKKyNkZWZpbmUgSTkxNV9WTUFfTE9DQUxfQklO
RF9CSVQgIDExCiAKICNkZWZpbmUgSTkxNV9WTUFfR0xPQkFMX0JJTkQJKChpbnQpQklUKEk5MTVf
Vk1BX0dMT0JBTF9CSU5EX0JJVCkpCiAjZGVmaW5lIEk5MTVfVk1BX0xPQ0FMX0JJTkQJKChpbnQp
QklUKEk5MTVfVk1BX0xPQ0FMX0JJTkRfQklUKSkKIAotI2RlZmluZSBJOTE1X1ZNQV9CSU5EX01B
U0sgKEk5MTVfVk1BX0dMT0JBTF9CSU5EIHwgXAotCQkJICAgIEk5MTVfVk1BX0xPQ0FMX0JJTkQg
fCBcCi0JCQkgICAgSTkxNV9WTUFfUElOX09WRVJGTE9XKQorI2RlZmluZSBJOTE1X1ZNQV9CSU5E
X01BU0sgKEk5MTVfVk1BX0dMT0JBTF9CSU5EIHwgSTkxNV9WTUFfTE9DQUxfQklORCkKIAotI2Rl
ZmluZSBJOTE1X1ZNQV9HR1RUX0JJVAkxMQotI2RlZmluZSBJOTE1X1ZNQV9DQU5fRkVOQ0VfQklU
CTEyCi0jZGVmaW5lIEk5MTVfVk1BX1VTRVJGQVVMVF9CSVQJMTMKLSNkZWZpbmUgSTkxNV9WTUFf
R0dUVF9XUklURV9CSVQJMTQKKyNkZWZpbmUgSTkxNV9WTUFfQUxMT0NfQklUCTEyCisjZGVmaW5l
IEk5MTVfVk1BX0FMTE9DCQkoKGludClCSVQoSTkxNV9WTUFfQUxMT0NfQklUKSkKKworI2RlZmlu
ZSBJOTE1X1ZNQV9FUlJPUl9CSVQJMTMKKyNkZWZpbmUgSTkxNV9WTUFfRVJST1IJCSgoaW50KUJJ
VChJOTE1X1ZNQV9FUlJPUl9CSVQpKQorCisjZGVmaW5lIEk5MTVfVk1BX0dHVFRfQklUCTE0Cisj
ZGVmaW5lIEk5MTVfVk1BX0NBTl9GRU5DRV9CSVQJMTUKKyNkZWZpbmUgSTkxNV9WTUFfVVNFUkZB
VUxUX0JJVAkxNgorI2RlZmluZSBJOTE1X1ZNQV9HR1RUX1dSSVRFX0JJVAkxNwogCiAjZGVmaW5l
IEk5MTVfVk1BX0dHVFQJCSgoaW50KUJJVChJOTE1X1ZNQV9HR1RUX0JJVCkpCiAjZGVmaW5lIEk5
MTVfVk1BX0NBTl9GRU5DRQkoKGludClCSVQoSTkxNV9WTUFfQ0FOX0ZFTkNFX0JJVCkpCkBAIC0x
MjMsNiArMTI2LDExIEBAIHN0cnVjdCBpOTE1X3ZtYSB7CiAKIAlzdHJ1Y3QgaTkxNV9hY3RpdmUg
YWN0aXZlOwogCisjZGVmaW5lIEk5MTVfVk1BX1BBR0VTX0JJQVMgMjQKKyNkZWZpbmUgSTkxNV9W
TUFfUEFHRVNfQUNUSVZFIChCSVQoMjQpIHwgMSkKKwlhdG9taWNfdCBwYWdlc19jb3VudDsgLyog
bnVtYmVyIG9mIGFjdGl2ZSBiaW5kcyB0byB0aGUgcGFnZXMgKi8KKwlzdHJ1Y3QgbXV0ZXggcGFn
ZXNfbXV0ZXg7IC8qIHByb3RlY3QgYWNxdWlyZS9yZWxlYXNlIG9mIGJhY2tpbmcgcGFnZXMgKi8K
KwogCS8qKgogCSAqIFN1cHBvcnQgZGlmZmVyZW50IEdHVFQgdmlld3MgaW50byB0aGUgc2FtZSBv
YmplY3QuCiAJICogVGhpcyBtZWFucyB0aGVyZSBjYW4gYmUgbXVsdGlwbGUgVk1BIG1hcHBpbmdz
IHBlciBvYmplY3QgYW5kIHBlciBWTS4KQEAgLTMwNyw4ICszMTUsMTIgQEAgaTkxNV92bWFfY29t
cGFyZShzdHJ1Y3QgaTkxNV92bWEgKnZtYSwKIAlyZXR1cm4gbWVtY21wKCZ2bWEtPmdndHRfdmll
dy5wYXJ0aWFsLCAmdmlldy0+cGFydGlhbCwgdmlldy0+dHlwZSk7CiB9CiAKLWludCBpOTE1X3Zt
YV9iaW5kKHN0cnVjdCBpOTE1X3ZtYSAqdm1hLCBlbnVtIGk5MTVfY2FjaGVfbGV2ZWwgY2FjaGVf
bGV2ZWwsCi0JCSAgdTMyIGZsYWdzKTsKK3N0cnVjdCBpOTE1X3ZtYV93b3JrICppOTE1X3ZtYV93
b3JrKHZvaWQpOworaW50IGk5MTVfdm1hX2JpbmQoc3RydWN0IGk5MTVfdm1hICp2bWEsCisJCSAg
ZW51bSBpOTE1X2NhY2hlX2xldmVsIGNhY2hlX2xldmVsLAorCQkgIHUzMiBmbGFncywKKwkJICBz
dHJ1Y3QgaTkxNV92bWFfd29yayAqd29yayk7CisKIGJvb2wgaTkxNV9nZW1fdmFsaWRfZ3R0X3Nw
YWNlKHN0cnVjdCBpOTE1X3ZtYSAqdm1hLCB1bnNpZ25lZCBsb25nIGNhY2hlX2xldmVsKTsKIGJv
b2wgaTkxNV92bWFfbWlzcGxhY2VkKGNvbnN0IHN0cnVjdCBpOTE1X3ZtYSAqdm1hLAogCQkJdTY0
IHNpemUsIHU2NCBhbGlnbm1lbnQsIHU2NCBmbGFncyk7CkBAIC0zMzIsMjYgKzM0NCw4IEBAIHN0
YXRpYyBpbmxpbmUgdm9pZCBpOTE1X3ZtYV91bmxvY2soc3RydWN0IGk5MTVfdm1hICp2bWEpCiAJ
ZG1hX3Jlc3ZfdW5sb2NrKHZtYS0+cmVzdik7CiB9CiAKLWludCBfX2k5MTVfdm1hX2RvX3Bpbihz
dHJ1Y3QgaTkxNV92bWEgKnZtYSwKLQkJICAgICAgdTY0IHNpemUsIHU2NCBhbGlnbm1lbnQsIHU2
NCBmbGFncyk7Ci1zdGF0aWMgaW5saW5lIGludCBfX211c3RfY2hlY2sKLWk5MTVfdm1hX3Bpbihz
dHJ1Y3QgaTkxNV92bWEgKnZtYSwgdTY0IHNpemUsIHU2NCBhbGlnbm1lbnQsIHU2NCBmbGFncykK
LXsKLQlCVUlMRF9CVUdfT04oUElOX01CWiAhPSBJOTE1X1ZNQV9QSU5fT1ZFUkZMT1cpOwotCUJV
SUxEX0JVR19PTihQSU5fR0xPQkFMICE9IEk5MTVfVk1BX0dMT0JBTF9CSU5EKTsKLQlCVUlMRF9C
VUdfT04oUElOX1VTRVIgIT0gSTkxNV9WTUFfTE9DQUxfQklORCk7Ci0KLQkvKiBQaW4gZWFybHkg
dG8gcHJldmVudCB0aGUgc2hyaW5rZXIvZXZpY3Rpb24gbG9naWMgZnJvbSBkZXN0cm95aW5nCi0J
ICogb3VyIHZtYSBhcyB3ZSBpbnNlcnQgYW5kIGJpbmQuCi0JICovCi0JaWYgKGxpa2VseSgoKGF0
b21pY19pbmNfcmV0dXJuKCZ2bWEtPmZsYWdzKSBeIGZsYWdzKSAmIEk5MTVfVk1BX0JJTkRfTUFT
SykgPT0gMCkpIHsKLQkJR0VNX0JVR19PTighZHJtX21tX25vZGVfYWxsb2NhdGVkKCZ2bWEtPm5v
ZGUpKTsKLQkJR0VNX0JVR19PTihpOTE1X3ZtYV9taXNwbGFjZWQodm1hLCBzaXplLCBhbGlnbm1l
bnQsIGZsYWdzKSk7Ci0JCXJldHVybiAwOwotCX0KLQotCXJldHVybiBfX2k5MTVfdm1hX2RvX3Bp
bih2bWEsIHNpemUsIGFsaWdubWVudCwgZmxhZ3MpOwotfQoraW50IF9fbXVzdF9jaGVjaworaTkx
NV92bWFfcGluKHN0cnVjdCBpOTE1X3ZtYSAqdm1hLCB1NjQgc2l6ZSwgdTY0IGFsaWdubWVudCwg
dTY0IGZsYWdzKTsKIAogc3RhdGljIGlubGluZSBpbnQgaTkxNV92bWFfcGluX2NvdW50KGNvbnN0
IHN0cnVjdCBpOTE1X3ZtYSAqdm1hKQogewpAQCAtMzY2LDE3ICszNjAsMTcgQEAgc3RhdGljIGlu
bGluZSBib29sIGk5MTVfdm1hX2lzX3Bpbm5lZChjb25zdCBzdHJ1Y3QgaTkxNV92bWEgKnZtYSkK
IHN0YXRpYyBpbmxpbmUgdm9pZCBfX2k5MTVfdm1hX3BpbihzdHJ1Y3QgaTkxNV92bWEgKnZtYSkK
IHsKIAlhdG9taWNfaW5jKCZ2bWEtPmZsYWdzKTsKLQlHRU1fQlVHX09OKGF0b21pY19yZWFkKCZ2
bWEtPmZsYWdzKSAmIEk5MTVfVk1BX1BJTl9PVkVSRkxPVyk7CisJR0VNX0JVR19PTighaTkxNV92
bWFfaXNfcGlubmVkKHZtYSkpOwogfQogCiBzdGF0aWMgaW5saW5lIHZvaWQgX19pOTE1X3ZtYV91
bnBpbihzdHJ1Y3QgaTkxNV92bWEgKnZtYSkKIHsKKwlHRU1fQlVHX09OKCFpOTE1X3ZtYV9pc19w
aW5uZWQodm1hKSk7CiAJYXRvbWljX2RlYygmdm1hLT5mbGFncyk7CiB9CiAKIHN0YXRpYyBpbmxp
bmUgdm9pZCBpOTE1X3ZtYV91bnBpbihzdHJ1Y3QgaTkxNV92bWEgKnZtYSkKIHsKLQlHRU1fQlVH
X09OKCFpOTE1X3ZtYV9pc19waW5uZWQodm1hKSk7CiAJR0VNX0JVR19PTighZHJtX21tX25vZGVf
YWxsb2NhdGVkKCZ2bWEtPm5vZGUpKTsKIAlfX2k5MTVfdm1hX3VucGluKHZtYSk7CiB9CkBAIC0z
OTYsOCArMzkwLDYgQEAgc3RhdGljIGlubGluZSBib29sIGk5MTVfdm1hX2lzX2JvdW5kKGNvbnN0
IHN0cnVjdCBpOTE1X3ZtYSAqdm1hLAogICogdGhlIGNhbGxlciBtdXN0IGNhbGwgaTkxNV92bWFf
dW5waW5faW9tYXAgdG8gcmVsaW5xdWlzaCB0aGUgcGlubmluZwogICogYWZ0ZXIgdGhlIGlvbWFw
cGluZyBpcyBubyBsb25nZXIgcmVxdWlyZWQuCiAgKgotICogQ2FsbGVycyBtdXN0IGhvbGQgdGhl
IHN0cnVjdF9tdXRleC4KLSAqCiAgKiBSZXR1cm5zIGEgdmFsaWQgaW9tYXBwZWQgcG9pbnRlciBv
ciBFUlJfUFRSLgogICovCiB2b2lkIF9faW9tZW0gKmk5MTVfdm1hX3Bpbl9pb21hcChzdHJ1Y3Qg
aTkxNV92bWEgKnZtYSk7CkBAIC00MDksOCArNDAxLDggQEAgdm9pZCBfX2lvbWVtICppOTE1X3Zt
YV9waW5faW9tYXAoc3RydWN0IGk5MTVfdm1hICp2bWEpOwogICoKICAqIFVucGlucyB0aGUgcHJl
dmlvdXNseSBpb21hcHBlZCBWTUEgZnJvbSBpOTE1X3ZtYV9waW5faW9tYXAoKS4KICAqCi0gKiBD
YWxsZXJzIG11c3QgaG9sZCB0aGUgc3RydWN0X211dGV4LiBUaGlzIGZ1bmN0aW9uIGlzIG9ubHkg
dmFsaWQgdG8gYmUKLSAqIGNhbGxlZCBvbiBhIFZNQSBwcmV2aW91c2x5IGlvbWFwcGVkIGJ5IHRo
ZSBjYWxsZXIgd2l0aCBpOTE1X3ZtYV9waW5faW9tYXAoKS4KKyAqIFRoaXMgZnVuY3Rpb24gaXMg
b25seSB2YWxpZCB0byBiZSBjYWxsZWQgb24gYSBWTUEgcHJldmlvdXNseQorICogaW9tYXBwZWQg
YnkgdGhlIGNhbGxlciB3aXRoIGk5MTVfdm1hX3Bpbl9pb21hcCgpLgogICovCiB2b2lkIGk5MTVf
dm1hX3VucGluX2lvbWFwKHN0cnVjdCBpOTE1X3ZtYSAqdm1hKTsKIApAQCAtNDM4LDYgKzQzMCw4
IEBAIHN0YXRpYyBpbmxpbmUgc3RydWN0IHBhZ2UgKmk5MTVfdm1hX2ZpcnN0X3BhZ2Uoc3RydWN0
IGk5MTVfdm1hICp2bWEpCiBpbnQgX19tdXN0X2NoZWNrIGk5MTVfdm1hX3Bpbl9mZW5jZShzdHJ1
Y3QgaTkxNV92bWEgKnZtYSk7CiBpbnQgX19tdXN0X2NoZWNrIGk5MTVfdm1hX3Jldm9rZV9mZW5j
ZShzdHJ1Y3QgaTkxNV92bWEgKnZtYSk7CiAKK2ludCBfX2k5MTVfdm1hX3Bpbl9mZW5jZShzdHJ1
Y3QgaTkxNV92bWEgKnZtYSk7CisKIHN0YXRpYyBpbmxpbmUgdm9pZCBfX2k5MTVfdm1hX3VucGlu
X2ZlbmNlKHN0cnVjdCBpOTE1X3ZtYSAqdm1hKQogewogCUdFTV9CVUdfT04oYXRvbWljX3JlYWQo
JnZtYS0+ZmVuY2UtPnBpbl9jb3VudCkgPD0gMCk7CkBAIC00NTUsNyArNDQ5LDYgQEAgc3RhdGlj
IGlubGluZSB2b2lkIF9faTkxNV92bWFfdW5waW5fZmVuY2Uoc3RydWN0IGk5MTVfdm1hICp2bWEp
CiBzdGF0aWMgaW5saW5lIHZvaWQKIGk5MTVfdm1hX3VucGluX2ZlbmNlKHN0cnVjdCBpOTE1X3Zt
YSAqdm1hKQogewotCS8qIGxvY2tkZXBfYXNzZXJ0X2hlbGQoJnZtYS0+dm0tPmk5MTUtPmRybS5z
dHJ1Y3RfbXV0ZXgpOyAqLwogCWlmICh2bWEtPmZlbmNlKQogCQlfX2k5MTVfdm1hX3VucGluX2Zl
bmNlKHZtYSk7CiB9CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMv
aTkxNV9nZW1fZXZpY3QuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L3NlbGZ0ZXN0cy9pOTE1X2dl
bV9ldmljdC5jCmluZGV4IGNiMzBjNjY5YjFiNy4uYmE2MDY0MTQ3MTczIDEwMDY0NAotLS0gYS9k
cml2ZXJzL2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMvaTkxNV9nZW1fZXZpY3QuYworKysgYi9kcml2
ZXJzL2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMvaTkxNV9nZW1fZXZpY3QuYwpAQCAtMTA2LDE0ICsx
MDYsMTEgQEAgc3RhdGljIGludCBwb3B1bGF0ZV9nZ3R0KHN0cnVjdCBkcm1faTkxNV9wcml2YXRl
ICppOTE1LAogCiBzdGF0aWMgdm9pZCB1bnBpbl9nZ3R0KHN0cnVjdCBkcm1faTkxNV9wcml2YXRl
ICppOTE1KQogewotCXN0cnVjdCBpOTE1X2dndHQgKmdndHQgPSAmaTkxNS0+Z2d0dDsKIAlzdHJ1
Y3QgaTkxNV92bWEgKnZtYTsKIAotCW11dGV4X2xvY2soJmdndHQtPnZtLm11dGV4KTsKIAlsaXN0
X2Zvcl9lYWNoX2VudHJ5KHZtYSwgJmk5MTUtPmdndHQudm0uYm91bmRfbGlzdCwgdm1fbGluaykK
IAkJaWYgKHZtYS0+b2JqLT5tbS5xdWlya2VkKQogCQkJaTkxNV92bWFfdW5waW4odm1hKTsKLQlt
dXRleF91bmxvY2soJmdndHQtPnZtLm11dGV4KTsKIH0KIAogc3RhdGljIHZvaWQgY2xlYW51cF9v
YmplY3RzKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LApAQCAtMTI3LDExICsxMjQsNyBA
QCBzdGF0aWMgdm9pZCBjbGVhbnVwX29iamVjdHMoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5
MTUsCiAJCWk5MTVfZ2VtX29iamVjdF9wdXQob2JqKTsKIAl9CiAKLQltdXRleF91bmxvY2soJmk5
MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwotCiAJaTkxNV9nZW1fZHJhaW5fZnJlZWRfb2JqZWN0cyhp
OTE1KTsKLQotCW11dGV4X2xvY2soJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwogfQogCiBzdGF0
aWMgaW50IGlndF9ldmljdF9zb21ldGhpbmcodm9pZCAqYXJnKQpAQCAtMTQ4LDEwICsxNDEsMTIg
QEAgc3RhdGljIGludCBpZ3RfZXZpY3Rfc29tZXRoaW5nKHZvaWQgKmFyZykKIAkJZ290byBjbGVh
bnVwOwogCiAJLyogRXZlcnl0aGluZyBpcyBwaW5uZWQsIG5vdGhpbmcgc2hvdWxkIGhhcHBlbiAq
LworCW11dGV4X2xvY2soJmdndHQtPnZtLm11dGV4KTsKIAllcnIgPSBpOTE1X2dlbV9ldmljdF9z
b21ldGhpbmcoJmdndHQtPnZtLAogCQkJCSAgICAgICBJOTE1X0dUVF9QQUdFX1NJWkUsIDAsIDAs
CiAJCQkJICAgICAgIDAsIFU2NF9NQVgsCiAJCQkJICAgICAgIDApOworCW11dGV4X3VubG9jaygm
Z2d0dC0+dm0ubXV0ZXgpOwogCWlmIChlcnIgIT0gLUVOT1NQQykgewogCQlwcl9lcnIoImk5MTVf
Z2VtX2V2aWN0X3NvbWV0aGluZyBmYWlsZWQgb24gYSBmdWxsIEdHVFQgd2l0aCBlcnI9JWRcbiIs
CiAJCSAgICAgICBlcnIpOwpAQCAtMTYxLDEwICsxNTYsMTIgQEAgc3RhdGljIGludCBpZ3RfZXZp
Y3Rfc29tZXRoaW5nKHZvaWQgKmFyZykKIAl1bnBpbl9nZ3R0KGk5MTUpOwogCiAJLyogRXZlcnl0
aGluZyBpcyB1bnBpbm5lZCwgd2Ugc2hvdWxkIGJlIGFibGUgdG8gZXZpY3Qgc29tZXRoaW5nICov
CisJbXV0ZXhfbG9jaygmZ2d0dC0+dm0ubXV0ZXgpOwogCWVyciA9IGk5MTVfZ2VtX2V2aWN0X3Nv
bWV0aGluZygmZ2d0dC0+dm0sCiAJCQkJICAgICAgIEk5MTVfR1RUX1BBR0VfU0laRSwgMCwgMCwK
IAkJCQkgICAgICAgMCwgVTY0X01BWCwKIAkJCQkgICAgICAgMCk7CisJbXV0ZXhfdW5sb2NrKCZn
Z3R0LT52bS5tdXRleCk7CiAJaWYgKGVycikgewogCQlwcl9lcnIoImk5MTVfZ2VtX2V2aWN0X3Nv
bWV0aGluZyBmYWlsZWQgb24gYSBmdWxsIEdHVFQgd2l0aCBlcnI9JWRcbiIsCiAJCSAgICAgICBl
cnIpOwpAQCAtMjMwLDcgKzIyNyw5IEBAIHN0YXRpYyBpbnQgaWd0X2V2aWN0X2Zvcl92bWEodm9p
ZCAqYXJnKQogCQlnb3RvIGNsZWFudXA7CiAKIAkvKiBFdmVyeXRoaW5nIGlzIHBpbm5lZCwgbm90
aGluZyBzaG91bGQgaGFwcGVuICovCisJbXV0ZXhfbG9jaygmZ2d0dC0+dm0ubXV0ZXgpOwogCWVy
ciA9IGk5MTVfZ2VtX2V2aWN0X2Zvcl9ub2RlKCZnZ3R0LT52bSwgJnRhcmdldCwgMCk7CisJbXV0
ZXhfdW5sb2NrKCZnZ3R0LT52bS5tdXRleCk7CiAJaWYgKGVyciAhPSAtRU5PU1BDKSB7CiAJCXBy
X2VycigiaTkxNV9nZW1fZXZpY3RfZm9yX25vZGUgb24gYSBmdWxsIEdHVFQgcmV0dXJuZWQgZXJy
PSVkXG4iLAogCQkgICAgICAgZXJyKTsKQEAgLTI0MCw3ICsyMzksOSBAQCBzdGF0aWMgaW50IGln
dF9ldmljdF9mb3Jfdm1hKHZvaWQgKmFyZykKIAl1bnBpbl9nZ3R0KGk5MTUpOwogCiAJLyogRXZl
cnl0aGluZyBpcyB1bnBpbm5lZCwgd2Ugc2hvdWxkIGJlIGFibGUgdG8gZXZpY3QgdGhlIG5vZGUg
Ki8KKwltdXRleF9sb2NrKCZnZ3R0LT52bS5tdXRleCk7CiAJZXJyID0gaTkxNV9nZW1fZXZpY3Rf
Zm9yX25vZGUoJmdndHQtPnZtLCAmdGFyZ2V0LCAwKTsKKwltdXRleF91bmxvY2soJmdndHQtPnZt
Lm11dGV4KTsKIAlpZiAoZXJyKSB7CiAJCXByX2VycigiaTkxNV9nZW1fZXZpY3RfZm9yX25vZGUg
cmV0dXJuZWQgZXJyPSVkXG4iLAogCQkgICAgICAgZXJyKTsKQEAgLTMxNyw3ICszMTgsOSBAQCBz
dGF0aWMgaW50IGlndF9ldmljdF9mb3JfY2FjaGVfY29sb3Iodm9pZCAqYXJnKQogCWk5MTVfdm1h
X3VucGluKHZtYSk7CiAKIAkvKiBSZW1vdmUganVzdCB0aGUgc2Vjb25kIHZtYSAqLworCW11dGV4
X2xvY2soJmdndHQtPnZtLm11dGV4KTsKIAllcnIgPSBpOTE1X2dlbV9ldmljdF9mb3Jfbm9kZSgm
Z2d0dC0+dm0sICZ0YXJnZXQsIDApOworCW11dGV4X3VubG9jaygmZ2d0dC0+dm0ubXV0ZXgpOwog
CWlmIChlcnIpIHsKIAkJcHJfZXJyKCJbMF1pOTE1X2dlbV9ldmljdF9mb3Jfbm9kZSByZXR1cm5l
ZCBlcnI9JWRcbiIsIGVycik7CiAJCWdvdG8gY2xlYW51cDsKQEAgLTMyOCw3ICszMzEsOSBAQCBz
dGF0aWMgaW50IGlndF9ldmljdF9mb3JfY2FjaGVfY29sb3Iodm9pZCAqYXJnKQogCSAqLwogCXRh
cmdldC5jb2xvciA9IEk5MTVfQ0FDSEVfTDNfTExDOwogCisJbXV0ZXhfbG9jaygmZ2d0dC0+dm0u
bXV0ZXgpOwogCWVyciA9IGk5MTVfZ2VtX2V2aWN0X2Zvcl9ub2RlKCZnZ3R0LT52bSwgJnRhcmdl
dCwgMCk7CisJbXV0ZXhfdW5sb2NrKCZnZ3R0LT52bS5tdXRleCk7CiAJaWYgKCFlcnIpIHsKIAkJ
cHJfZXJyKCJbMV1pOTE1X2dlbV9ldmljdF9mb3Jfbm9kZSByZXR1cm5lZCBlcnI9JWRcbiIsIGVy
cik7CiAJCWVyciA9IC1FSU5WQUw7CkBAIC0zNTgsNyArMzYzLDkgQEAgc3RhdGljIGludCBpZ3Rf
ZXZpY3Rfdm0odm9pZCAqYXJnKQogCQlnb3RvIGNsZWFudXA7CiAKIAkvKiBFdmVyeXRoaW5nIGlz
IHBpbm5lZCwgbm90aGluZyBzaG91bGQgaGFwcGVuICovCisJbXV0ZXhfbG9jaygmZ2d0dC0+dm0u
bXV0ZXgpOwogCWVyciA9IGk5MTVfZ2VtX2V2aWN0X3ZtKCZnZ3R0LT52bSk7CisJbXV0ZXhfdW5s
b2NrKCZnZ3R0LT52bS5tdXRleCk7CiAJaWYgKGVycikgewogCQlwcl9lcnIoImk5MTVfZ2VtX2V2
aWN0X3ZtIG9uIGEgZnVsbCBHR1RUIHJldHVybmVkIGVycj0lZF1cbiIsCiAJCSAgICAgICBlcnIp
OwpAQCAtMzY3LDcgKzM3NCw5IEBAIHN0YXRpYyBpbnQgaWd0X2V2aWN0X3ZtKHZvaWQgKmFyZykK
IAogCXVucGluX2dndHQoaTkxNSk7CiAKKwltdXRleF9sb2NrKCZnZ3R0LT52bS5tdXRleCk7CiAJ
ZXJyID0gaTkxNV9nZW1fZXZpY3Rfdm0oJmdndHQtPnZtKTsKKwltdXRleF91bmxvY2soJmdndHQt
PnZtLm11dGV4KTsKIAlpZiAoZXJyKSB7CiAJCXByX2VycigiaTkxNV9nZW1fZXZpY3Rfdm0gb24g
YSBmdWxsIEdHVFQgcmV0dXJuZWQgZXJyPSVkXVxuIiwKIAkJICAgICAgIGVycik7CkBAIC00MDgs
MTEgKzQxNywxMSBAQCBzdGF0aWMgaW50IGlndF9ldmljdF9jb250ZXh0cyh2b2lkICphcmcpCiAJ
aWYgKCFIQVNfRlVMTF9QUEdUVChpOTE1KSkKIAkJcmV0dXJuIDA7CiAKLQltdXRleF9sb2NrKCZp
OTE1LT5kcm0uc3RydWN0X211dGV4KTsKIAl3YWtlcmVmID0gaW50ZWxfcnVudGltZV9wbV9nZXQo
Jmk5MTUtPnJ1bnRpbWVfcG0pOwogCiAJLyogUmVzZXJ2ZSBhIGJsb2NrIHNvIHRoYXQgd2Uga25v
dyB3ZSBoYXZlIGVub3VnaCB0byBmaXQgYSBmZXcgcnEgKi8KIAltZW1zZXQoJmhvbGUsIDAsIHNp
emVvZihob2xlKSk7CisJbXV0ZXhfbG9jaygmaTkxNS0+Z2d0dC52bS5tdXRleCk7CiAJZXJyID0g
aTkxNV9nZW1fZ3R0X2luc2VydCgmaTkxNS0+Z2d0dC52bSwgJmhvbGUsCiAJCQkJICBQUkVURU5E
X0dHVFRfU0laRSwgMCwgSTkxNV9DT0xPUl9VTkVWSUNUQUJMRSwKIAkJCQkgIDAsIGk5MTUtPmdn
dHQudm0udG90YWwsCkBAIC00MjUsNyArNDM0LDkgQEAgc3RhdGljIGludCBpZ3RfZXZpY3RfY29u
dGV4dHModm9pZCAqYXJnKQogCWRvIHsKIAkJc3RydWN0IHJlc2VydmVkICpyOwogCisJCW11dGV4
X3VubG9jaygmaTkxNS0+Z2d0dC52bS5tdXRleCk7CiAJCXIgPSBrY2FsbG9jKDEsIHNpemVvZigq
ciksIEdGUF9LRVJORUwpOworCQltdXRleF9sb2NrKCZpOTE1LT5nZ3R0LnZtLm11dGV4KTsKIAkJ
aWYgKCFyKSB7CiAJCQllcnIgPSAtRU5PTUVNOwogCQkJZ290byBvdXRfbG9ja2VkOwpAQCAtNDQ1
LDcgKzQ1Niw3IEBAIHN0YXRpYyBpbnQgaWd0X2V2aWN0X2NvbnRleHRzKHZvaWQgKmFyZykKIAkJ
Y291bnQrKzsKIAl9IHdoaWxlICgxKTsKIAlkcm1fbW1fcmVtb3ZlX25vZGUoJmhvbGUpOwotCW11
dGV4X3VubG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CisJbXV0ZXhfdW5sb2NrKCZpOTE1
LT5nZ3R0LnZtLm11dGV4KTsKIAlwcl9pbmZvKCJGaWxsZWQgR0dUVCB3aXRoICVsdSAxTWlCIG5v
ZGVzXG4iLCBjb3VudCk7CiAKIAkvKiBPdmVyZmlsbCB0aGUgR0dUVCB3aXRoIGNvbnRleHQgb2Jq
ZWN0cyBhbmQgc28gdHJ5IHRvIGV2aWN0IG9uZS4gKi8KQEAgLTUwOCw3ICs1MTksNyBAQCBzdGF0
aWMgaW50IGlndF9ldmljdF9jb250ZXh0cyh2b2lkICphcmcpCiAJCQlicmVhazsKIAl9CiAKLQlt
dXRleF9sb2NrKCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsKKwltdXRleF9sb2NrKCZpOTE1LT5n
Z3R0LnZtLm11dGV4KTsKIG91dF9sb2NrZWQ6CiAJaWYgKGlndF9mbHVzaF90ZXN0KGk5MTUsIEk5
MTVfV0FJVF9MT0NLRUQpKQogCQllcnIgPSAtRUlPOwpAQCAtNTIyLDggKzUzMyw4IEBAIHN0YXRp
YyBpbnQgaWd0X2V2aWN0X2NvbnRleHRzKHZvaWQgKmFyZykKIAl9CiAJaWYgKGRybV9tbV9ub2Rl
X2FsbG9jYXRlZCgmaG9sZSkpCiAJCWRybV9tbV9yZW1vdmVfbm9kZSgmaG9sZSk7CisJbXV0ZXhf
dW5sb2NrKCZpOTE1LT5nZ3R0LnZtLm11dGV4KTsKIAlpbnRlbF9ydW50aW1lX3BtX3B1dCgmaTkx
NS0+cnVudGltZV9wbSwgd2FrZXJlZik7Ci0JbXV0ZXhfdW5sb2NrKCZpOTE1LT5kcm0uc3RydWN0
X211dGV4KTsKIAogCXJldHVybiBlcnI7CiB9CkBAIC01NDUsMTIgKzU1Niw5IEBAIGludCBpOTE1
X2dlbV9ldmljdF9tb2NrX3NlbGZ0ZXN0cyh2b2lkKQogCWlmICghaTkxNSkKIAkJcmV0dXJuIC1F
Tk9NRU07CiAKLQltdXRleF9sb2NrKCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsKIAl3aXRoX2lu
dGVsX3J1bnRpbWVfcG0oJmk5MTUtPnJ1bnRpbWVfcG0sIHdha2VyZWYpCiAJCWVyciA9IGk5MTVf
c3VidGVzdHModGVzdHMsIGk5MTUpOwogCi0JbXV0ZXhfdW5sb2NrKCZpOTE1LT5kcm0uc3RydWN0
X211dGV4KTsKLQogCWRybV9kZXZfcHV0KCZpOTE1LT5kcm0pOwogCXJldHVybiBlcnI7CiB9CmRp
ZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMvaTkxNV9nZW1fZ3R0LmMg
Yi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMvaTkxNV9nZW1fZ3R0LmMKaW5kZXggYTkw
YzliZTk1ZjhjLi40MjM1ZmE0MDE5NTYgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1
L3NlbGZ0ZXN0cy9pOTE1X2dlbV9ndHQuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9zZWxm
dGVzdHMvaTkxNV9nZW1fZ3R0LmMKQEAgLTM1LDE2ICszNSw3IEBACiAKIHN0YXRpYyB2b2lkIGNs
ZWFudXBfZnJlZWRfb2JqZWN0cyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkKIHsKLQkv
KgotCSAqIEFzIHdlIG1heSBob2xkIG9udG8gdGhlIHN0cnVjdF9tdXRleCBmb3IgaW5vcmRpbmF0
ZSBsZW5ndGhzIG9mCi0JICogdGltZSwgdGhlIE5NSSBraHVuZ3Rhc2tkIGRldGVjdG9yIG1heSBm
aXJlIGZvciB0aGUgZnJlZSBvYmplY3RzCi0JICogd29ya2VyLgotCSAqLwotCW11dGV4X3VubG9j
aygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7Ci0KIAlpOTE1X2dlbV9kcmFpbl9mcmVlZF9vYmpl
Y3RzKGk5MTUpOwotCi0JbXV0ZXhfbG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CiB9CiAK
IHN0YXRpYyB2b2lkIGZha2VfZnJlZV9wYWdlcyhzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAq
b2JqLApAQCAtMzE4LDYgKzMwOSwxNyBAQCBzdGF0aWMgaW50IGxvd2xldmVsX2hvbGUoc3RydWN0
IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUsCiAJcmV0dXJuIDA7CiB9CiAKK3N0YXRpYyBpbnQgdW5s
b2NrZWRfdm1hX3VuYmluZChzdHJ1Y3QgaTkxNV92bWEgKnZtYSkKK3sKKwlpbnQgcmV0OworCisJ
bXV0ZXhfbG9jaygmdm1hLT52bS0+bXV0ZXgpOworCXJldCA9IGk5MTVfdm1hX3VuYmluZCh2bWEp
OworCW11dGV4X3VubG9jaygmdm1hLT52bS0+bXV0ZXgpOworCisJcmV0dXJuIHJldDsKK30KKwog
c3RhdGljIHZvaWQgY2xvc2Vfb2JqZWN0X2xpc3Qoc3RydWN0IGxpc3RfaGVhZCAqb2JqZWN0cywK
IAkJCSAgICAgIHN0cnVjdCBpOTE1X2FkZHJlc3Nfc3BhY2UgKnZtKQogewpAQCAtMzI5LDcgKzMz
MSw3IEBAIHN0YXRpYyB2b2lkIGNsb3NlX29iamVjdF9saXN0KHN0cnVjdCBsaXN0X2hlYWQgKm9i
amVjdHMsCiAKIAkJdm1hID0gaTkxNV92bWFfaW5zdGFuY2Uob2JqLCB2bSwgTlVMTCk7CiAJCWlm
ICghSVNfRVJSKHZtYSkpCi0JCQlpZ25vcmVkID0gaTkxNV92bWFfdW5iaW5kKHZtYSk7CisJCQlp
Z25vcmVkID0gdW5sb2NrZWRfdm1hX3VuYmluZCh2bWEpOwogCQkvKiBPbmx5IHBwZ3R0IHZtYSBt
YXkgYmUgY2xvc2VkIGJlZm9yZSB0aGUgb2JqZWN0IGlzIGZyZWVkICovCiAJCWlmICghSVNfRVJS
KHZtYSkgJiYgIWk5MTVfdm1hX2lzX2dndHQodm1hKSkKIAkJCWk5MTVfdm1hX2Nsb3NlKHZtYSk7
CkBAIC00NDQsNyArNDQ2LDcgQEAgc3RhdGljIGludCBmaWxsX2hvbGUoc3RydWN0IGRybV9pOTE1
X3ByaXZhdGUgKmk5MTUsCiAJCQkJCQlnb3RvIGVycjsKIAkJCQkJfQogCi0JCQkJCWVyciA9IGk5
MTVfdm1hX3VuYmluZCh2bWEpOworCQkJCQllcnIgPSB1bmxvY2tlZF92bWFfdW5iaW5kKHZtYSk7
CiAJCQkJCWlmIChlcnIpIHsKIAkJCQkJCXByX2VycigiJXMoJXMpIChmb3J3YXJkKSB1bmJpbmQg
b2Ygdm1hLm5vZGU9JWxseCArICVsbHggZmFpbGVkIHdpdGggZXJyPSVkXG4iLAogCQkJCQkJICAg
ICAgIF9fZnVuY19fLCBwLT5uYW1lLCB2bWEtPm5vZGUuc3RhcnQsIHZtYS0+bm9kZS5zaXplLApA
QCAtNTE3LDcgKzUxOSw3IEBAIHN0YXRpYyBpbnQgZmlsbF9ob2xlKHN0cnVjdCBkcm1faTkxNV9w
cml2YXRlICppOTE1LAogCQkJCQkJZ290byBlcnI7CiAJCQkJCX0KIAotCQkJCQllcnIgPSBpOTE1
X3ZtYV91bmJpbmQodm1hKTsKKwkJCQkJZXJyID0gdW5sb2NrZWRfdm1hX3VuYmluZCh2bWEpOwog
CQkJCQlpZiAoZXJyKSB7CiAJCQkJCQlwcl9lcnIoIiVzKCVzKSAoYmFja3dhcmQpIHVuYmluZCBv
ZiB2bWEubm9kZT0lbGx4ICsgJWxseCBmYWlsZWQgd2l0aCBlcnI9JWRcbiIsCiAJCQkJCQkgICAg
ICAgX19mdW5jX18sIHAtPm5hbWUsIHZtYS0+bm9kZS5zdGFydCwgdm1hLT5ub2RlLnNpemUsCkBA
IC02MDQsNyArNjA2LDcgQEAgc3RhdGljIGludCB3YWxrX2hvbGUoc3RydWN0IGRybV9pOTE1X3By
aXZhdGUgKmk5MTUsCiAJCQkJZ290byBlcnJfY2xvc2U7CiAJCQl9CiAKLQkJCWVyciA9IGk5MTVf
dm1hX3VuYmluZCh2bWEpOworCQkJZXJyID0gdW5sb2NrZWRfdm1hX3VuYmluZCh2bWEpOwogCQkJ
aWYgKGVycikgewogCQkJCXByX2VycigiJXMgdW5iaW5kIGZhaWxlZCBhdCAlbGx4ICsgJWxseCAg
d2l0aCBlcnI9JWRcbiIsCiAJCQkJICAgICAgIF9fZnVuY19fLCBhZGRyLCB2bWEtPnNpemUsIGVy
cik7CkBAIC02ODUsMTMgKzY4NywxMyBAQCBzdGF0aWMgaW50IHBvdF9ob2xlKHN0cnVjdCBkcm1f
aTkxNV9wcml2YXRlICppOTE1LAogCQkJCXByX2VycigiJXMgaW5jb3JyZWN0IGF0ICVsbHggKyAl
bGx4XG4iLAogCQkJCSAgICAgICBfX2Z1bmNfXywgYWRkciwgdm1hLT5zaXplKTsKIAkJCQlpOTE1
X3ZtYV91bnBpbih2bWEpOwotCQkJCWVyciA9IGk5MTVfdm1hX3VuYmluZCh2bWEpOworCQkJCWVy
ciA9IHVubG9ja2VkX3ZtYV91bmJpbmQodm1hKTsKIAkJCQllcnIgPSAtRUlOVkFMOwogCQkJCWdv
dG8gZXJyOwogCQkJfQogCiAJCQlpOTE1X3ZtYV91bnBpbih2bWEpOwotCQkJZXJyID0gaTkxNV92
bWFfdW5iaW5kKHZtYSk7CisJCQllcnIgPSB1bmxvY2tlZF92bWFfdW5iaW5kKHZtYSk7CiAJCQlH
RU1fQlVHX09OKGVycik7CiAJCX0KIApAQCAtNzg5LDEzICs3OTEsMTMgQEAgc3RhdGljIGludCBk
cnVua19ob2xlKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LAogCQkJCXByX2VycigiJXMg
aW5jb3JyZWN0IGF0ICVsbHggKyAlbGx4XG4iLAogCQkJCSAgICAgICBfX2Z1bmNfXywgYWRkciwg
QklUX1VMTChzaXplKSk7CiAJCQkJaTkxNV92bWFfdW5waW4odm1hKTsKLQkJCQllcnIgPSBpOTE1
X3ZtYV91bmJpbmQodm1hKTsKKwkJCQllcnIgPSB1bmxvY2tlZF92bWFfdW5iaW5kKHZtYSk7CiAJ
CQkJZXJyID0gLUVJTlZBTDsKIAkJCQlnb3RvIGVycjsKIAkJCX0KIAogCQkJaTkxNV92bWFfdW5w
aW4odm1hKTsKLQkJCWVyciA9IGk5MTVfdm1hX3VuYmluZCh2bWEpOworCQkJZXJyID0gdW5sb2Nr
ZWRfdm1hX3VuYmluZCh2bWEpOwogCQkJR0VNX0JVR19PTihlcnIpOwogCiAJCQlpZiAoaWd0X3Rp
bWVvdXQoZW5kX3RpbWUsCkBAIC04NjcsNyArODY5LDcgQEAgc3RhdGljIGludCBfX3Nocmlua19o
b2xlKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LAogCQkJcHJfZXJyKCIlcyBpbmNvcnJl
Y3QgYXQgJWxseCArICVsbHhcbiIsCiAJCQkgICAgICAgX19mdW5jX18sIGFkZHIsIHNpemUpOwog
CQkJaTkxNV92bWFfdW5waW4odm1hKTsKLQkJCWVyciA9IGk5MTVfdm1hX3VuYmluZCh2bWEpOwor
CQkJZXJyID0gdW5sb2NrZWRfdm1hX3VuYmluZCh2bWEpOwogCQkJZXJyID0gLUVJTlZBTDsKIAkJ
CWJyZWFrOwogCQl9CkBAIC04NzUsNiArODc3LDE1IEBAIHN0YXRpYyBpbnQgX19zaHJpbmtfaG9s
ZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwKIAkJaTkxNV92bWFfdW5waW4odm1hKTsK
IAkJYWRkciArPSBzaXplOwogCisJCS8qCisJCSAqIFNpbmNlIHdlIGFyZSBpbmplY3RpbmcgYWxs
b2NhdGlvbiBmYXVsdHMgYXQgcmFuZG9tIGludGVydmFscywKKwkJICogd2FpdCBmb3IgdGhpcyBh
bGxvY2F0aW9uIHRvIGNvbXBsZXRlIGJlZm9yZSB3ZSBjaGFuZ2UgdGhlCisJCSAqIGZhdWx0aW5q
ZWN0aW9uLgorCQkgKi8KKwkJZXJyID0gaTkxNV9hY3RpdmVfd2FpdCgmdm1hLT5hY3RpdmUpOwor
CQlpZiAoZXJyKQorCQkJYnJlYWs7CisKIAkJaWYgKGlndF90aW1lb3V0KGVuZF90aW1lLAogCQkJ
CSIlcyB0aW1lZCBvdXQgYXQgb2ZzZXQgJWxseCBbJWxseCAtICVsbHhdXG4iLAogCQkJCV9fZnVu
Y19fLCBhZGRyLCBob2xlX3N0YXJ0LCBob2xlX2VuZCkpIHsKQEAgLTEwMDgsMjEgKzEwMTksMTkg
QEAgc3RhdGljIGludCBleGVyY2lzZV9wcGd0dChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2
X3ByaXYsCiAJaWYgKElTX0VSUihmaWxlKSkKIAkJcmV0dXJuIFBUUl9FUlIoZmlsZSk7CiAKLQlt
dXRleF9sb2NrKCZkZXZfcHJpdi0+ZHJtLnN0cnVjdF9tdXRleCk7CiAJcHBndHQgPSBpOTE1X3Bw
Z3R0X2NyZWF0ZShkZXZfcHJpdik7CiAJaWYgKElTX0VSUihwcGd0dCkpIHsKIAkJZXJyID0gUFRS
X0VSUihwcGd0dCk7Ci0JCWdvdG8gb3V0X3VubG9jazsKKwkJZ290byBvdXRfZnJlZTsKIAl9CiAJ
R0VNX0JVR19PTihvZmZzZXRfaW5fcGFnZShwcGd0dC0+dm0udG90YWwpKTsKLQlHRU1fQlVHX09O
KHBwZ3R0LT52bS5jbG9zZWQpOworCUdFTV9CVUdfT04oIWF0b21pY19yZWFkKCZwcGd0dC0+dm0u
b3BlbikpOwogCiAJZXJyID0gZnVuYyhkZXZfcHJpdiwgJnBwZ3R0LT52bSwgMCwgcHBndHQtPnZt
LnRvdGFsLCBlbmRfdGltZSk7CiAKIAlpOTE1X3ZtX3B1dCgmcHBndHQtPnZtKTsKLW91dF91bmxv
Y2s6Ci0JbXV0ZXhfdW5sb2NrKCZkZXZfcHJpdi0+ZHJtLnN0cnVjdF9tdXRleCk7CiAKK291dF9m
cmVlOgogCW1vY2tfZmlsZV9mcmVlKGRldl9wcml2LCBmaWxlKTsKIAlyZXR1cm4gZXJyOwogfQpA
QCAtMTA4NSw3ICsxMDk0LDYgQEAgc3RhdGljIGludCBleGVyY2lzZV9nZ3R0KHN0cnVjdCBkcm1f
aTkxNV9wcml2YXRlICppOTE1LAogCUlHVF9USU1FT1VUKGVuZF90aW1lKTsKIAlpbnQgZXJyID0g
MDsKIAotCW11dGV4X2xvY2soJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwogcmVzdGFydDoKIAls
aXN0X3NvcnQoTlVMTCwgJmdndHQtPnZtLm1tLmhvbGVfc3RhY2ssIHNvcnRfaG9sZXMpOwogCWRy
bV9tbV9mb3JfZWFjaF9ob2xlKG5vZGUsICZnZ3R0LT52bS5tbSwgaG9sZV9zdGFydCwgaG9sZV9l
bmQpIHsKQEAgLTExMDYsNyArMTExNCw2IEBAIHN0YXRpYyBpbnQgZXhlcmNpc2VfZ2d0dChzdHJ1
Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwKIAkJbGFzdCA9IGhvbGVfZW5kOwogCQlnb3RvIHJl
c3RhcnQ7CiAJfQotCW11dGV4X3VubG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CiAKIAly
ZXR1cm4gZXJyOwogfQpAQCAtMTE0OCwxMyArMTE1NSw5IEBAIHN0YXRpYyBpbnQgaWd0X2dndHRf
cGFnZSh2b2lkICphcmcpCiAJdW5zaWduZWQgaW50ICpvcmRlciwgbjsKIAlpbnQgZXJyOwogCi0J
bXV0ZXhfbG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7Ci0KIAlvYmogPSBpOTE1X2dlbV9v
YmplY3RfY3JlYXRlX2ludGVybmFsKGk5MTUsIFBBR0VfU0laRSk7Ci0JaWYgKElTX0VSUihvYmop
KSB7Ci0JCWVyciA9IFBUUl9FUlIob2JqKTsKLQkJZ290byBvdXRfdW5sb2NrOwotCX0KKwlpZiAo
SVNfRVJSKG9iaikpCisJCXJldHVybiBQVFJfRVJSKG9iaik7CiAKIAllcnIgPSBpOTE1X2dlbV9v
YmplY3RfcGluX3BhZ2VzKG9iaik7CiAJaWYgKGVycikKQEAgLTEyMjIsOCArMTIyNSw2IEBAIHN0
YXRpYyBpbnQgaWd0X2dndHRfcGFnZSh2b2lkICphcmcpCiAJaTkxNV9nZW1fb2JqZWN0X3VucGlu
X3BhZ2VzKG9iaik7CiBvdXRfZnJlZToKIAlpOTE1X2dlbV9vYmplY3RfcHV0KG9iaik7Ci1vdXRf
dW5sb2NrOgotCW11dGV4X3VubG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CiAJcmV0dXJu
IGVycjsKIH0KIApAQCAtMTIzNCw2ICsxMjM1LDkgQEAgc3RhdGljIHZvaWQgdHJhY2tfdm1hX2Jp
bmQoc3RydWN0IGk5MTVfdm1hICp2bWEpCiAJYXRvbWljX2luYygmb2JqLT5iaW5kX2NvdW50KTsg
LyogdHJhY2sgZm9yIGV2aWN0aW9uIGxhdGVyICovCiAJX19pOTE1X2dlbV9vYmplY3RfcGluX3Bh
Z2VzKG9iaik7CiAKKwlHRU1fQlVHX09OKHZtYS0+cGFnZXMpOworCWF0b21pY19zZXQoJnZtYS0+
cGFnZXNfY291bnQsIEk5MTVfVk1BX1BBR0VTX0FDVElWRSk7CisJX19pOTE1X2dlbV9vYmplY3Rf
cGluX3BhZ2VzKG9iaik7CiAJdm1hLT5wYWdlcyA9IG9iai0+bW0ucGFnZXM7CiAKIAltdXRleF9s
b2NrKCZ2bWEtPnZtLT5tdXRleCk7CkBAIC0xMzMwLDExICsxMzM0LDEzIEBAIHN0YXRpYyBpbnQg
aWd0X2d0dF9yZXNlcnZlKHZvaWQgKmFyZykKIAkJCWdvdG8gb3V0OwogCQl9CiAKKwkJbXV0ZXhf
bG9jaygmZ2d0dC0+dm0ubXV0ZXgpOwogCQllcnIgPSBpOTE1X2dlbV9ndHRfcmVzZXJ2ZSgmZ2d0
dC0+dm0sICZ2bWEtPm5vZGUsCiAJCQkJCSAgIG9iai0+YmFzZS5zaXplLAogCQkJCQkgICB0b3Rh
bCwKIAkJCQkJICAgb2JqLT5jYWNoZV9sZXZlbCwKIAkJCQkJICAgMCk7CisJCW11dGV4X3VubG9j
aygmZ2d0dC0+dm0ubXV0ZXgpOwogCQlpZiAoZXJyKSB7CiAJCQlwcl9lcnIoImk5MTVfZ2VtX2d0
dF9yZXNlcnZlIChwYXNzIDEpIGZhaWxlZCBhdCAlbGx1LyVsbHUgd2l0aCBlcnI9JWRcbiIsCiAJ
CQkgICAgICAgdG90YWwsIGdndHQtPnZtLnRvdGFsLCBlcnIpOwpAQCAtMTM4MCwxMSArMTM4Niwx
MyBAQCBzdGF0aWMgaW50IGlndF9ndHRfcmVzZXJ2ZSh2b2lkICphcmcpCiAJCQlnb3RvIG91dDsK
IAkJfQogCisJCW11dGV4X2xvY2soJmdndHQtPnZtLm11dGV4KTsKIAkJZXJyID0gaTkxNV9nZW1f
Z3R0X3Jlc2VydmUoJmdndHQtPnZtLCAmdm1hLT5ub2RlLAogCQkJCQkgICBvYmotPmJhc2Uuc2l6
ZSwKIAkJCQkJICAgdG90YWwsCiAJCQkJCSAgIG9iai0+Y2FjaGVfbGV2ZWwsCiAJCQkJCSAgIDAp
OworCQltdXRleF91bmxvY2soJmdndHQtPnZtLm11dGV4KTsKIAkJaWYgKGVycikgewogCQkJcHJf
ZXJyKCJpOTE1X2dlbV9ndHRfcmVzZXJ2ZSAocGFzcyAyKSBmYWlsZWQgYXQgJWxsdS8lbGx1IHdp
dGggZXJyPSVkXG4iLAogCQkJICAgICAgIHRvdGFsLCBnZ3R0LT52bS50b3RhbCwgZXJyKTsKQEAg
LTE0MTQsNyArMTQyMiw3IEBAIHN0YXRpYyBpbnQgaWd0X2d0dF9yZXNlcnZlKHZvaWQgKmFyZykK
IAkJCWdvdG8gb3V0OwogCQl9CiAKLQkJZXJyID0gaTkxNV92bWFfdW5iaW5kKHZtYSk7CisJCWVy
ciA9IHVubG9ja2VkX3ZtYV91bmJpbmQodm1hKTsKIAkJaWYgKGVycikgewogCQkJcHJfZXJyKCJp
OTE1X3ZtYV91bmJpbmQgZmFpbGVkIHdpdGggZXJyPSVkIVxuIiwgZXJyKTsKIAkJCWdvdG8gb3V0
OwpAQCAtMTQyNCwxMSArMTQzMiwxMyBAQCBzdGF0aWMgaW50IGlndF9ndHRfcmVzZXJ2ZSh2b2lk
ICphcmcpCiAJCQkJICAgICAgIDIqSTkxNV9HVFRfUEFHRV9TSVpFLAogCQkJCSAgICAgICBJOTE1
X0dUVF9NSU5fQUxJR05NRU5UKTsKIAorCQltdXRleF9sb2NrKCZnZ3R0LT52bS5tdXRleCk7CiAJ
CWVyciA9IGk5MTVfZ2VtX2d0dF9yZXNlcnZlKCZnZ3R0LT52bSwgJnZtYS0+bm9kZSwKIAkJCQkJ
ICAgb2JqLT5iYXNlLnNpemUsCiAJCQkJCSAgIG9mZnNldCwKIAkJCQkJICAgb2JqLT5jYWNoZV9s
ZXZlbCwKIAkJCQkJICAgMCk7CisJCW11dGV4X3VubG9jaygmZ2d0dC0+dm0ubXV0ZXgpOwogCQlp
ZiAoZXJyKSB7CiAJCQlwcl9lcnIoImk5MTVfZ2VtX2d0dF9yZXNlcnZlIChwYXNzIDMpIGZhaWxl
ZCBhdCAlbGx1LyVsbHUgd2l0aCBlcnI9JWRcbiIsCiAJCQkgICAgICAgdG90YWwsIGdndHQtPnZt
LnRvdGFsLCBlcnIpOwpAQCAtMTQ5NywxMSArMTUwNywxMyBAQCBzdGF0aWMgaW50IGlndF9ndHRf
aW5zZXJ0KHZvaWQgKmFyZykKIAogCS8qIENoZWNrIGEgY291cGxlIG9mIG9idmlvdXNseSBpbnZh
bGlkIHJlcXVlc3RzICovCiAJZm9yIChpaSA9IGludmFsaWRfaW5zZXJ0OyBpaS0+c2l6ZTsgaWkr
KykgeworCQltdXRleF9sb2NrKCZnZ3R0LT52bS5tdXRleCk7CiAJCWVyciA9IGk5MTVfZ2VtX2d0
dF9pbnNlcnQoJmdndHQtPnZtLCAmdG1wLAogCQkJCQkgIGlpLT5zaXplLCBpaS0+YWxpZ25tZW50
LAogCQkJCQkgIEk5MTVfQ09MT1JfVU5FVklDVEFCTEUsCiAJCQkJCSAgaWktPnN0YXJ0LCBpaS0+
ZW5kLAogCQkJCQkgIDApOworCQltdXRleF91bmxvY2soJmdndHQtPnZtLm11dGV4KTsKIAkJaWYg
KGVyciAhPSAtRU5PU1BDKSB7CiAJCQlwcl9lcnIoIkludmFsaWQgaTkxNV9nZW1fZ3R0X2luc2Vy
dCguc2l6ZT0lbGx4LCAuYWxpZ25tZW50PSVsbHgsIC5zdGFydD0lbGx4LCAuZW5kPSVsbHgpIHN1
Y2NlZWRlZCAoZXJyPSVkKVxuIiwKIAkJCSAgICAgICBpaS0+c2l6ZSwgaWktPmFsaWdubWVudCwg
aWktPnN0YXJ0LCBpaS0+ZW5kLApAQCAtMTUzNywxMCArMTU0OSwxMiBAQCBzdGF0aWMgaW50IGln
dF9ndHRfaW5zZXJ0KHZvaWQgKmFyZykKIAkJCWdvdG8gb3V0OwogCQl9CiAKKwkJbXV0ZXhfbG9j
aygmZ2d0dC0+dm0ubXV0ZXgpOwogCQllcnIgPSBpOTE1X2dlbV9ndHRfaW5zZXJ0KCZnZ3R0LT52
bSwgJnZtYS0+bm9kZSwKIAkJCQkJICBvYmotPmJhc2Uuc2l6ZSwgMCwgb2JqLT5jYWNoZV9sZXZl
bCwKIAkJCQkJICAwLCBnZ3R0LT52bS50b3RhbCwKIAkJCQkJICAwKTsKKwkJbXV0ZXhfdW5sb2Nr
KCZnZ3R0LT52bS5tdXRleCk7CiAJCWlmIChlcnIgPT0gLUVOT1NQQykgewogCQkJLyogbWF4ZWQg
b3V0IHRoZSBHR1RUIHNwYWNlICovCiAJCQlpOTE1X2dlbV9vYmplY3RfcHV0KG9iaik7CkBAIC0x
NTg5LDE2ICsxNjAzLDE4IEBAIHN0YXRpYyBpbnQgaWd0X2d0dF9pbnNlcnQodm9pZCAqYXJnKQog
CQlHRU1fQlVHX09OKCFkcm1fbW1fbm9kZV9hbGxvY2F0ZWQoJnZtYS0+bm9kZSkpOwogCQlvZmZz
ZXQgPSB2bWEtPm5vZGUuc3RhcnQ7CiAKLQkJZXJyID0gaTkxNV92bWFfdW5iaW5kKHZtYSk7CisJ
CWVyciA9IHVubG9ja2VkX3ZtYV91bmJpbmQodm1hKTsKIAkJaWYgKGVycikgewogCQkJcHJfZXJy
KCJpOTE1X3ZtYV91bmJpbmQgZmFpbGVkIHdpdGggZXJyPSVkIVxuIiwgZXJyKTsKIAkJCWdvdG8g
b3V0OwogCQl9CiAKKwkJbXV0ZXhfbG9jaygmZ2d0dC0+dm0ubXV0ZXgpOwogCQllcnIgPSBpOTE1
X2dlbV9ndHRfaW5zZXJ0KCZnZ3R0LT52bSwgJnZtYS0+bm9kZSwKIAkJCQkJICBvYmotPmJhc2Uu
c2l6ZSwgMCwgb2JqLT5jYWNoZV9sZXZlbCwKIAkJCQkJICAwLCBnZ3R0LT52bS50b3RhbCwKIAkJ
CQkJICAwKTsKKwkJbXV0ZXhfdW5sb2NrKCZnZ3R0LT52bS5tdXRleCk7CiAJCWlmIChlcnIpIHsK
IAkJCXByX2VycigiaTkxNV9nZW1fZ3R0X2luc2VydCAocGFzcyAyKSBmYWlsZWQgYXQgJWxsdS8l
bGx1IHdpdGggZXJyPSVkXG4iLAogCQkJICAgICAgIHRvdGFsLCBnZ3R0LT52bS50b3RhbCwgZXJy
KTsKQEAgLTE2NDIsMTAgKzE2NTgsMTIgQEAgc3RhdGljIGludCBpZ3RfZ3R0X2luc2VydCh2b2lk
ICphcmcpCiAJCQlnb3RvIG91dDsKIAkJfQogCisJCW11dGV4X2xvY2soJmdndHQtPnZtLm11dGV4
KTsKIAkJZXJyID0gaTkxNV9nZW1fZ3R0X2luc2VydCgmZ2d0dC0+dm0sICZ2bWEtPm5vZGUsCiAJ
CQkJCSAgb2JqLT5iYXNlLnNpemUsIDAsIG9iai0+Y2FjaGVfbGV2ZWwsCiAJCQkJCSAgMCwgZ2d0
dC0+dm0udG90YWwsCiAJCQkJCSAgMCk7CisJCW11dGV4X3VubG9jaygmZ2d0dC0+dm0ubXV0ZXgp
OwogCQlpZiAoZXJyKSB7CiAJCQlwcl9lcnIoImk5MTVfZ2VtX2d0dF9pbnNlcnQgKHBhc3MgMykg
ZmFpbGVkIGF0ICVsbHUvJWxsdSB3aXRoIGVycj0lZFxuIiwKIAkJCSAgICAgICB0b3RhbCwgZ2d0
dC0+dm0udG90YWwsIGVycik7CkBAIC0xNjg5LDggKzE3MDcsOSBAQCBpbnQgaTkxNV9nZW1fZ3R0
X21vY2tfc2VsZnRlc3RzKHZvaWQpCiAJfQogCW1vY2tfaW5pdF9nZ3R0KGk5MTUsIGdndHQpOwog
Ci0JbXV0ZXhfbG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CiAJZXJyID0gaTkxNV9zdWJ0
ZXN0cyh0ZXN0cywgZ2d0dCk7CisKKwltdXRleF9sb2NrKCZpOTE1LT5kcm0uc3RydWN0X211dGV4
KTsKIAltb2NrX2RldmljZV9mbHVzaChpOTE1KTsKIAltdXRleF91bmxvY2soJmk5MTUtPmRybS5z
dHJ1Y3RfbXV0ZXgpOwogCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9zZWxmdGVz
dHMvaTkxNV92bWEuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L3NlbGZ0ZXN0cy9pOTE1X3ZtYS5j
CmluZGV4IDk3NzUyZGVlY2NjYi4uZTBjYTEyYzE3YTdmIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dw
dS9kcm0vaTkxNS9zZWxmdGVzdHMvaTkxNV92bWEuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkx
NS9zZWxmdGVzdHMvaTkxNV92bWEuYwpAQCAtMzM3LDcgKzMzNyw5IEBAIHN0YXRpYyBpbnQgaWd0
X3ZtYV9waW4xKHZvaWQgKmFyZykKIAogCQlpZiAoIWVycikgewogCQkJaTkxNV92bWFfdW5waW4o
dm1hKTsKKwkJCW11dGV4X2xvY2soJmdndHQtPnZtLm11dGV4KTsKIAkJCWVyciA9IGk5MTVfdm1h
X3VuYmluZCh2bWEpOworCQkJbXV0ZXhfdW5sb2NrKCZnZ3R0LT52bS5tdXRleCk7CiAJCQlpZiAo
ZXJyKSB7CiAJCQkJcHJfZXJyKCJGYWlsZWQgdG8gdW5iaW5kIHNpbmdsZSBwYWdlIGZyb20gR0dU
VCwgZXJyPSVkXG4iLCBlcnIpOwogCQkJCWdvdG8gb3V0OwpAQCAtODMxLDggKzgzMyw5IEBAIGlu
dCBpOTE1X3ZtYV9tb2NrX3NlbGZ0ZXN0cyh2b2lkKQogCX0KIAltb2NrX2luaXRfZ2d0dChpOTE1
LCBnZ3R0KTsKIAotCW11dGV4X2xvY2soJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwogCWVyciA9
IGk5MTVfc3VidGVzdHModGVzdHMsIGdndHQpOworCisJbXV0ZXhfbG9jaygmaTkxNS0+ZHJtLnN0
cnVjdF9tdXRleCk7CiAJbW9ja19kZXZpY2VfZmx1c2goaTkxNSk7CiAJbXV0ZXhfdW5sb2NrKCZp
OTE1LT5kcm0uc3RydWN0X211dGV4KTsKIApAQCAtODc5LDggKzg4Miw2IEBAIHN0YXRpYyBpbnQg
aWd0X3ZtYV9yZW1hcHBlZF9ndHQodm9pZCAqYXJnKQogCWlmIChJU19FUlIob2JqKSkKIAkJcmV0
dXJuIFBUUl9FUlIob2JqKTsKIAotCW11dGV4X2xvY2soJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgp
OwotCiAJd2FrZXJlZiA9IGludGVsX3J1bnRpbWVfcG1fZ2V0KCZpOTE1LT5ydW50aW1lX3BtKTsK
IAogCWZvciAodCA9IHR5cGVzOyAqdDsgdCsrKSB7CkBAIC05NzYsNyArOTc3LDYgQEAgc3RhdGlj
IGludCBpZ3Rfdm1hX3JlbWFwcGVkX2d0dCh2b2lkICphcmcpCiAKIG91dDoKIAlpbnRlbF9ydW50
aW1lX3BtX3B1dCgmaTkxNS0+cnVudGltZV9wbSwgd2FrZXJlZik7Ci0JbXV0ZXhfdW5sb2NrKCZp
OTE1LT5kcm0uc3RydWN0X211dGV4KTsKIAlpOTE1X2dlbV9vYmplY3RfcHV0KG9iaik7CiAKIAly
ZXR1cm4gZXJyOwotLSAKMi4yMy4wCgpfX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fXwpJbnRlbC1nZnggbWFpbGluZyBsaXN0CkludGVsLWdmeEBsaXN0cy5mcmVl
ZGVza3RvcC5vcmcKaHR0cHM6Ly9saXN0cy5mcmVlZGVza3RvcC5vcmcvbWFpbG1hbi9saXN0aW5m
by9pbnRlbC1nZng=

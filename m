Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 3FDE3D2904
	for <lists+intel-gfx@lfdr.de>; Thu, 10 Oct 2019 14:09:52 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 128406E22D;
	Thu, 10 Oct 2019 12:09:50 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from fireflyinternet.com (mail.fireflyinternet.com [109.228.58.192])
 by gabe.freedesktop.org (Postfix) with ESMTPS id B2CC56E22D
 for <intel-gfx@lists.freedesktop.org>; Thu, 10 Oct 2019 12:09:47 +0000 (UTC)
X-Default-Received-SPF: pass (skip=forwardok (res=PASS))
 x-ip-name=78.156.65.138; 
Received: from haswell.alporthouse.com (unverified [78.156.65.138]) 
 by fireflyinternet.com (Firefly Internet (M1)) with ESMTP id 18790460-1500050 
 for multiple; Thu, 10 Oct 2019 13:08:56 +0100
From: Chris Wilson <chris@chris-wilson.co.uk>
To: intel-gfx@lists.freedesktop.org
Date: Thu, 10 Oct 2019 13:08:54 +0100
Message-Id: <20191010120854.28871-2-chris@chris-wilson.co.uk>
X-Mailer: git-send-email 2.23.0
In-Reply-To: <20191010120854.28871-1-chris@chris-wilson.co.uk>
References: <20191010120854.28871-1-chris@chris-wilson.co.uk>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH 2/2] drm/i915/selftests: Check known register
 values within the context
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

Q2hlY2sgdGhlIGxvZ2ljYWwgcmluZyBjb250ZXh0IGJ5IGFzc2VydGluZyB0aGF0IHRoZSByZWdp
c3RlcnMgaG9sZApleHBlY3RlZCBzdGFydCBkdXJpbmcgZXhlY3V0aW9uLiAoSXQncyBhIGJpdCBj
aGlja2VuLWFuZC1lZ2cgZm9yIGhvdwpjb3VsZCB3ZSBtYW5hZ2UgdG8gZXhlY3V0ZSBvdXIgcmVx
dWVzdCBpZiB0aGUgcmVnaXN0ZXJzIHdlcmUgbm90IGJlaW5nCnVwZGF0ZWQuIFN0aWxsLCBpdCdz
IG5pY2UgdG8gdmVyaWZ5IHRoYXQgdGhlIEhXIGlzIHdvcmtpbmcgYXMgZXhwZWN0ZWQuKQoKU2ln
bmVkLW9mZi1ieTogQ2hyaXMgV2lsc29uIDxjaHJpc0BjaHJpcy13aWxzb24uY28udWs+Ci0tLQog
ZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qvc2VsZnRlc3RfbHJjLmMgfCAxMzggKysrKysrKysrKysr
KysrKysrKysrKysrKwogMSBmaWxlIGNoYW5nZWQsIDEzOCBpbnNlcnRpb25zKCspCgpkaWZmIC0t
Z2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qvc2VsZnRlc3RfbHJjLmMgYi9kcml2ZXJzL2dw
dS9kcm0vaTkxNS9ndC9zZWxmdGVzdF9scmMuYwppbmRleCBhNjkxZTQyOWNhMDEuLmRlZjFlNjRh
YWYxYyAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qvc2VsZnRlc3RfbHJjLmMK
KysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qvc2VsZnRlc3RfbHJjLmMKQEAgLTI1OTksMTAg
KzI1OTksMTQ4IEBAIHN0YXRpYyBpbnQgbGl2ZV9scmNfbGF5b3V0KHZvaWQgKmFyZykKIAlyZXR1
cm4gZXJyOwogfQogCitzdGF0aWMgaW50IF9fbGl2ZV9scmNfc3RhdGUoc3RydWN0IGk5MTVfZ2Vt
X2NvbnRleHQgKmZpeG1lLAorCQkJICAgIHN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZSwK
KwkJCSAgICBzdHJ1Y3QgaTkxNV92bWEgKnNjcmF0Y2gpCit7CisJc3RydWN0IGludGVsX2NvbnRl
eHQgKmNlOworCXN0cnVjdCBpOTE1X3JlcXVlc3QgKnJxOworCWVudW0geworCQlSSU5HX1NUQVJU
X0lEWCA9IDAsCisJCVJJTkdfSEVBRF9JRFgsCisJCVJJTkdfVEFJTF9JRFgsCisJCU1BWF9JRFgK
Kwl9OworCXUzMiBleHBlY3RlZFtNQVhfSURYXTsKKwl1MzIgKmNzOworCWludCBlcnI7CisJaW50
IG47CisKKwljZSA9IGludGVsX2NvbnRleHRfY3JlYXRlKGZpeG1lLCBlbmdpbmUpOworCWlmIChJ
U19FUlIoY2UpKQorCQlyZXR1cm4gUFRSX0VSUihjZSk7CisKKwllcnIgPSBpbnRlbF9jb250ZXh0
X3BpbihjZSk7CisJaWYgKGVycikKKwkJZ290byBlcnJfcHV0OworCisJcnEgPSBpOTE1X3JlcXVl
c3RfY3JlYXRlKGNlKTsKKwlpZiAoSVNfRVJSKHJxKSkgeworCQllcnIgPSBQVFJfRVJSKHJxKTsK
KwkJZ290byBlcnJfdW5waW47CisJfQorCisJZXhwZWN0ZWRbUklOR19IRUFEX0lEWF0gPSBjZS0+
cmluZy0+ZW1pdDsKKworCWNzID0gaW50ZWxfcmluZ19iZWdpbihycSwgNCAqIE1BWF9JRFgpOwor
CWlmIChJU19FUlIoY3MpKSB7CisJCWVyciA9IFBUUl9FUlIoY3MpOworCQlpOTE1X3JlcXVlc3Rf
YWRkKHJxKTsKKwkJZ290byBlcnJfdW5waW47CisJfQorCisJKmNzKysgPSBNSV9TVE9SRV9SRUdJ
U1RFUl9NRU1fR0VOOCB8IE1JX1VTRV9HR1RUOworCSpjcysrID0gaTkxNV9tbWlvX3JlZ19vZmZz
ZXQoUklOR19TVEFSVChlbmdpbmUtPm1taW9fYmFzZSkpOworCSpjcysrID0gaTkxNV9nZ3R0X29m
ZnNldChzY3JhdGNoKSArIFJJTkdfU1RBUlRfSURYICogc2l6ZW9mKHUzMik7CisJKmNzKysgPSAw
OworCisJZXhwZWN0ZWRbUklOR19TVEFSVF9JRFhdID0gaTkxNV9nZ3R0X29mZnNldChjZS0+cmlu
Zy0+dm1hKTsKKworCSpjcysrID0gTUlfU1RPUkVfUkVHSVNURVJfTUVNX0dFTjggfCBNSV9VU0Vf
R0dUVDsKKwkqY3MrKyA9IGk5MTVfbW1pb19yZWdfb2Zmc2V0KFJJTkdfSEVBRChlbmdpbmUtPm1t
aW9fYmFzZSkpOworCSpjcysrID0gaTkxNV9nZ3R0X29mZnNldChzY3JhdGNoKSArIFJJTkdfSEVB
RF9JRFggKiBzaXplb2YodTMyKTsKKwkqY3MrKyA9IDA7CisKKwlleHBlY3RlZFtSSU5HX0hFQURf
SURYXSArPSA2ICogc2l6ZW9mKHUzMik7CisJaWYgKGVuZ2luZS0+Y2xhc3MgPT0gUkVOREVSX0NM
QVNTKQorCQlleHBlY3RlZFtSSU5HX0hFQURfSURYXSArPSAyICogc2l6ZW9mKHUzMik7CisKKwkq
Y3MrKyA9IE1JX1NUT1JFX1JFR0lTVEVSX01FTV9HRU44IHwgTUlfVVNFX0dHVFQ7CisJKmNzKysg
PSBpOTE1X21taW9fcmVnX29mZnNldChSSU5HX1RBSUwoZW5naW5lLT5tbWlvX2Jhc2UpKTsKKwkq
Y3MrKyA9IGk5MTVfZ2d0dF9vZmZzZXQoc2NyYXRjaCkgKyBSSU5HX1RBSUxfSURYICogc2l6ZW9m
KHUzMik7CisJKmNzKysgPSAwOworCisJaTkxNV9yZXF1ZXN0X2dldChycSk7CisJaTkxNV9yZXF1
ZXN0X2FkZChycSk7CisKKwlpbnRlbF9lbmdpbmVfZmx1c2hfc3VibWlzc2lvbihlbmdpbmUpOwor
CWV4cGVjdGVkW1JJTkdfVEFJTF9JRFhdID0gY2UtPnJpbmctPnRhaWw7CisKKwlpZiAoaTkxNV9y
ZXF1ZXN0X3dhaXQocnEsIDAsIEhaIC8gNSkgPCAwKSB7CisJCWVyciA9IC1FVElNRTsKKwkJZ290
byBlcnJfcnE7CisJfQorCisJY3MgPSBpOTE1X2dlbV9vYmplY3RfcGluX21hcChzY3JhdGNoLT5v
YmosIEk5MTVfTUFQX1dCKTsKKwlpZiAoSVNfRVJSKGNzKSkgeworCQllcnIgPSBQVFJfRVJSKGNz
KTsKKwkJZ290byBlcnJfcnE7CisJfQorCisJZm9yIChuID0gMDsgbiA8IE1BWF9JRFg7IG4rKykg
eworCQlpZiAoY3Nbbl0gIT0gZXhwZWN0ZWRbbl0pIHsKKwkJCXByX2VycigiJXM6IFN0b3JlZCBy
ZWdpc3RlclslZF0gdmFsdWVbMHgleF0gZGlkIG5vdCBtYXRjaCBleHBlY3RlZFsweCV4XVxuIiwK
KwkJCSAgICAgICBlbmdpbmUtPm5hbWUsIG4sIGNzW25dLCBleHBlY3RlZFtuXSk7CisJCQllcnIg
PSAtRUlOVkFMOworCQkJYnJlYWs7CisJCX0KKwl9CisKKwlpOTE1X2dlbV9vYmplY3RfdW5waW5f
bWFwKHNjcmF0Y2gtPm9iaik7CisKK2Vycl9ycToKKwlpOTE1X3JlcXVlc3RfcHV0KHJxKTsKK2Vy
cl91bnBpbjoKKwlpbnRlbF9jb250ZXh0X3VucGluKGNlKTsKK2Vycl9wdXQ6CisJaW50ZWxfY29u
dGV4dF9wdXQoY2UpOworCXJldHVybiBlcnI7Cit9CisKK3N0YXRpYyBpbnQgbGl2ZV9scmNfc3Rh
dGUodm9pZCAqYXJnKQoreworCXN0cnVjdCBpbnRlbF9ndCAqZ3QgPSBhcmc7CisJc3RydWN0IGlu
dGVsX2VuZ2luZV9jcyAqZW5naW5lOworCXN0cnVjdCBpOTE1X2dlbV9jb250ZXh0ICpmaXhtZTsK
KwlzdHJ1Y3QgaTkxNV92bWEgKnNjcmF0Y2g7CisJZW51bSBpbnRlbF9lbmdpbmVfaWQgaWQ7CisJ
aW50IGVyciA9IDA7CisKKwkvKgorCSAqIENoZWNrIHRoZSBsaXZlIHJlZ2lzdGVyIHN0YXRlIG1h
dGNoZXMgd2hhdCB3ZSBleHBlY3QgZm9yIHRoaXMKKwkgKiBpbnRlbF9jb250ZXh0LgorCSAqLwor
CisJZml4bWUgPSBrZXJuZWxfY29udGV4dChndC0+aTkxNSk7CisJaWYgKCFmaXhtZSkKKwkJcmV0
dXJuIC1FTk9NRU07CisKKwlzY3JhdGNoID0gY3JlYXRlX3NjcmF0Y2goZ3QpOworCWlmIChJU19F
UlIoc2NyYXRjaCkpIHsKKwkJZXJyID0gUFRSX0VSUihzY3JhdGNoKTsKKwkJZ290byBvdXRfY2xv
c2U7CisJfQorCisJZm9yX2VhY2hfZW5naW5lKGVuZ2luZSwgZ3QtPmk5MTUsIGlkKSB7CisJCWVy
ciA9IF9fbGl2ZV9scmNfc3RhdGUoZml4bWUsIGVuZ2luZSwgc2NyYXRjaCk7CisJCWlmIChlcnIp
CisJCQlicmVhazsKKwl9CisKKwlpZiAoaWd0X2ZsdXNoX3Rlc3QoZ3QtPmk5MTUpKQorCQllcnIg
PSAtRUlPOworCisJaTkxNV92bWFfdW5waW5fYW5kX3JlbGVhc2UoJnNjcmF0Y2gsIDApOworb3V0
X2Nsb3NlOgorCWtlcm5lbF9jb250ZXh0X2Nsb3NlKGZpeG1lKTsKKwlyZXR1cm4gZXJyOworfQor
CiBpbnQgaW50ZWxfbHJjX2xpdmVfc2VsZnRlc3RzKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpp
OTE1KQogewogCXN0YXRpYyBjb25zdCBzdHJ1Y3QgaTkxNV9zdWJ0ZXN0IHRlc3RzW10gPSB7CiAJ
CVNVQlRFU1QobGl2ZV9scmNfbGF5b3V0KSwKKwkJU1VCVEVTVChsaXZlX2xyY19zdGF0ZSksCiAJ
fTsKIAogCWlmICghSEFTX0xPR0lDQUxfUklOR19DT05URVhUUyhpOTE1KSkKLS0gCjIuMjMuMAoK
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX18KSW50ZWwtZ2Z4
IG1haWxpbmcgbGlzdApJbnRlbC1nZnhAbGlzdHMuZnJlZWRlc2t0b3Aub3JnCmh0dHBzOi8vbGlz
dHMuZnJlZWRlc2t0b3Aub3JnL21haWxtYW4vbGlzdGluZm8vaW50ZWwtZ2Z4

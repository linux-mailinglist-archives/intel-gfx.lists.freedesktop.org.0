Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 4387C1FCD55
	for <lists+intel-gfx@lfdr.de>; Wed, 17 Jun 2020 14:25:28 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 8ABC56E91A;
	Wed, 17 Jun 2020 12:25:26 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from fireflyinternet.com (mail.fireflyinternet.com [109.228.58.192])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 6E7036E0DF
 for <intel-gfx@lists.freedesktop.org>; Wed, 17 Jun 2020 12:25:24 +0000 (UTC)
X-Default-Received-SPF: pass (skip=forwardok (res=PASS))
 x-ip-name=78.156.65.138; 
Received: from build.alporthouse.com (unverified [78.156.65.138]) 
 by fireflyinternet.com (Firefly Internet (M1)) with ESMTP id 21524608-1500050 
 for <intel-gfx@lists.freedesktop.org>; Wed, 17 Jun 2020 13:25:19 +0100
From: Chris Wilson <chris@chris-wilson.co.uk>
To: intel-gfx@lists.freedesktop.org
Date: Wed, 17 Jun 2020 13:25:19 +0100
Message-Id: <20200617122519.32765-1-chris@chris-wilson.co.uk>
X-Mailer: git-send-email 2.20.1
MIME-Version: 1.0
Subject: [Intel-gfx] [CI] drm/i915/selftests: Enable selftesting of
 busy-stats
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.29
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

QSBjb3VwbGUgb2YgdmVyeSBzaW1wbGUgdGVzdHMgdG8gZW5zdXJlIHRoYXQgdGhlIGJhc2ljIHBy
b3BlcnRpZXMgb2YKcGVyLWVuZ2luZSBidXN5bmVzcyBhY2NvdW50aW5nIFswJSBhbmQgMTAwJSBi
dXN5XSBhcmUgZmFpdGhmdWwuCgpTaWduZWQtb2ZmLWJ5OiBDaHJpcyBXaWxzb24gPGNocmlzQGNo
cmlzLXdpbHNvbi5jby51az4KUmV2aWV3ZWQtYnk6IE1pa2EgS3VvcHBhbGEgPG1pa2Eua3VvcHBh
bGFAbGludXguaW50ZWwuY29tPgpDYzogVHZydGtvIFVyc3VsaW4gPHR2cnRrby51cnN1bGluQGlu
dGVsLmNvbT4KLS0tCiAuLi4vZHJtL2k5MTUvZ3Qvc2VsZnRlc3RfZW5naW5lX2hlYXJ0YmVhdC5j
ICAgfCAgNDcgKysrKy0tLS0KIC4uLi9kcm0vaTkxNS9ndC9zZWxmdGVzdF9lbmdpbmVfaGVhcnRi
ZWF0LmggICB8ICAxNSArKysKIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L3NlbGZ0ZXN0X2VuZ2lu
ZV9wbS5jICB8IDEwMyArKysrKysrKysrKysrKysrKysKIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2d0
L3NlbGZ0ZXN0X2hhbmdjaGVjay5jICB8ICAyOSArKy0tLQogZHJpdmVycy9ncHUvZHJtL2k5MTUv
Z3Qvc2VsZnRlc3RfbHJjLmMgICAgICAgIHwgIDc5ICsrKysrKy0tLS0tLS0tCiBkcml2ZXJzL2dw
dS9kcm0vaTkxNS9ndC9zZWxmdGVzdF9ycHMuYyAgICAgICAgfCAgNjggKysrKystLS0tLS0tCiBk
cml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9zZWxmdGVzdF90aW1lbGluZS5jICAgfCAgMjEgKy0tLQog
ZHJpdmVycy9ncHUvZHJtL2k5MTUvc2VsZnRlc3RzL2k5MTVfcmVxdWVzdC5jIHwgIDIxICstLS0K
IDggZmlsZXMgY2hhbmdlZCwgMjEzIGluc2VydGlvbnMoKyksIDE3MCBkZWxldGlvbnMoLSkKIGNy
ZWF0ZSBtb2RlIDEwMDY0NCBkcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9zZWxmdGVzdF9lbmdpbmVf
aGVhcnRiZWF0LmgKCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9zZWxmdGVz
dF9lbmdpbmVfaGVhcnRiZWF0LmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9zZWxmdGVzdF9l
bmdpbmVfaGVhcnRiZWF0LmMKaW5kZXggNjk3MTE0ZGQxZjQ3Li5mMzAzNGM2MTNiYzAgMTAwNjQ0
Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L3NlbGZ0ZXN0X2VuZ2luZV9oZWFydGJlYXQu
YworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9zZWxmdGVzdF9lbmdpbmVfaGVhcnRiZWF0
LmMKQEAgLTEwLDYgKzEwLDcgQEAKIAogI2luY2x1ZGUgImludGVsX2d0X3JlcXVlc3RzLmgiCiAj
aW5jbHVkZSAiaTkxNV9zZWxmdGVzdC5oIgorI2luY2x1ZGUgInNlbGZ0ZXN0X2VuZ2luZV9oZWFy
dGJlYXQuaCIKIAogc3RhdGljIGludCB0aW1lbGluZV9zeW5jKHN0cnVjdCBpbnRlbF90aW1lbGlu
ZSAqdGwpCiB7CkBAIC0xNDIsMjQgKzE0Myw2IEBAIHN0YXRpYyBpbnQgX19saXZlX2lkbGVfcHVs
c2Uoc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lLAogCXJldHVybiBlcnI7CiB9CiAKLXN0
YXRpYyB2b2lkIGVuZ2luZV9oZWFydGJlYXRfZGlzYWJsZShzdHJ1Y3QgaW50ZWxfZW5naW5lX2Nz
ICplbmdpbmUsCi0JCQkJICAgICB1bnNpZ25lZCBsb25nICpzYXZlZCkKLXsKLQkqc2F2ZWQgPSBl
bmdpbmUtPnByb3BzLmhlYXJ0YmVhdF9pbnRlcnZhbF9tczsKLQllbmdpbmUtPnByb3BzLmhlYXJ0
YmVhdF9pbnRlcnZhbF9tcyA9IDA7Ci0KLQlpbnRlbF9lbmdpbmVfcG1fZ2V0KGVuZ2luZSk7Ci0J
aW50ZWxfZW5naW5lX3BhcmtfaGVhcnRiZWF0KGVuZ2luZSk7Ci19Ci0KLXN0YXRpYyB2b2lkIGVu
Z2luZV9oZWFydGJlYXRfZW5hYmxlKHN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZSwKLQkJ
CQkgICAgdW5zaWduZWQgbG9uZyBzYXZlZCkKLXsKLQlpbnRlbF9lbmdpbmVfcG1fcHV0KGVuZ2lu
ZSk7Ci0KLQllbmdpbmUtPnByb3BzLmhlYXJ0YmVhdF9pbnRlcnZhbF9tcyA9IHNhdmVkOwotfQot
CiBzdGF0aWMgaW50IGxpdmVfaWRsZV9mbHVzaCh2b2lkICphcmcpCiB7CiAJc3RydWN0IGludGVs
X2d0ICpndCA9IGFyZzsKQEAgLTE3MCwxMSArMTUzLDkgQEAgc3RhdGljIGludCBsaXZlX2lkbGVf
Zmx1c2godm9pZCAqYXJnKQogCS8qIENoZWNrIHRoYXQgd2UgY2FuIGZsdXNoIHRoZSBpZGxlIGJh
cnJpZXJzICovCiAKIAlmb3JfZWFjaF9lbmdpbmUoZW5naW5lLCBndCwgaWQpIHsKLQkJdW5zaWdu
ZWQgbG9uZyBoZWFydGJlYXQ7Ci0KLQkJZW5naW5lX2hlYXJ0YmVhdF9kaXNhYmxlKGVuZ2luZSwg
JmhlYXJ0YmVhdCk7CisJCXN0X2VuZ2luZV9oZWFydGJlYXRfZGlzYWJsZShlbmdpbmUpOwogCQll
cnIgPSBfX2xpdmVfaWRsZV9wdWxzZShlbmdpbmUsIGludGVsX2VuZ2luZV9mbHVzaF9iYXJyaWVy
cyk7Ci0JCWVuZ2luZV9oZWFydGJlYXRfZW5hYmxlKGVuZ2luZSwgaGVhcnRiZWF0KTsKKwkJc3Rf
ZW5naW5lX2hlYXJ0YmVhdF9lbmFibGUoZW5naW5lKTsKIAkJaWYgKGVycikKIAkJCWJyZWFrOwog
CX0KQEAgLTE5MiwxMSArMTczLDkgQEAgc3RhdGljIGludCBsaXZlX2lkbGVfcHVsc2Uodm9pZCAq
YXJnKQogCS8qIENoZWNrIHRoYXQgaGVhcnRiZWF0IHB1bHNlcyBmbHVzaCB0aGUgaWRsZSBiYXJy
aWVycyAqLwogCiAJZm9yX2VhY2hfZW5naW5lKGVuZ2luZSwgZ3QsIGlkKSB7Ci0JCXVuc2lnbmVk
IGxvbmcgaGVhcnRiZWF0OwotCi0JCWVuZ2luZV9oZWFydGJlYXRfZGlzYWJsZShlbmdpbmUsICZo
ZWFydGJlYXQpOworCQlzdF9lbmdpbmVfaGVhcnRiZWF0X2Rpc2FibGUoZW5naW5lKTsKIAkJZXJy
ID0gX19saXZlX2lkbGVfcHVsc2UoZW5naW5lLCBpbnRlbF9lbmdpbmVfcHVsc2UpOwotCQllbmdp
bmVfaGVhcnRiZWF0X2VuYWJsZShlbmdpbmUsIGhlYXJ0YmVhdCk7CisJCXN0X2VuZ2luZV9oZWFy
dGJlYXRfZW5hYmxlKGVuZ2luZSk7CiAJCWlmIChlcnIgJiYgZXJyICE9IC1FTk9ERVYpCiAJCQli
cmVhazsKIApAQCAtMzk0LDMgKzM3MywxOSBAQCBpbnQgaW50ZWxfaGVhcnRiZWF0X2xpdmVfc2Vs
ZnRlc3RzKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KQogCWk5MTVfbW9kcGFyYW1zLmVu
YWJsZV9oYW5nY2hlY2sgPSBzYXZlZF9oYW5nY2hlY2s7CiAJcmV0dXJuIGVycjsKIH0KKwordm9p
ZCBzdF9lbmdpbmVfaGVhcnRiZWF0X2Rpc2FibGUoc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5n
aW5lKQoreworCWVuZ2luZS0+cHJvcHMuaGVhcnRiZWF0X2ludGVydmFsX21zID0gMDsKKworCWlu
dGVsX2VuZ2luZV9wbV9nZXQoZW5naW5lKTsKKwlpbnRlbF9lbmdpbmVfcGFya19oZWFydGJlYXQo
ZW5naW5lKTsKK30KKwordm9pZCBzdF9lbmdpbmVfaGVhcnRiZWF0X2VuYWJsZShzdHJ1Y3QgaW50
ZWxfZW5naW5lX2NzICplbmdpbmUpCit7CisJaW50ZWxfZW5naW5lX3BtX3B1dChlbmdpbmUpOwor
CisJZW5naW5lLT5wcm9wcy5oZWFydGJlYXRfaW50ZXJ2YWxfbXMgPQorCQllbmdpbmUtPmRlZmF1
bHRzLmhlYXJ0YmVhdF9pbnRlcnZhbF9tczsKK30KZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2Ry
bS9pOTE1L2d0L3NlbGZ0ZXN0X2VuZ2luZV9oZWFydGJlYXQuaCBiL2RyaXZlcnMvZ3B1L2RybS9p
OTE1L2d0L3NlbGZ0ZXN0X2VuZ2luZV9oZWFydGJlYXQuaApuZXcgZmlsZSBtb2RlIDEwMDY0NApp
bmRleCAwMDAwMDAwMDAwMDAuLmZiOTJkMmIwZjM2ZQotLS0gL2Rldi9udWxsCisrKyBiL2RyaXZl
cnMvZ3B1L2RybS9pOTE1L2d0L3NlbGZ0ZXN0X2VuZ2luZV9oZWFydGJlYXQuaApAQCAtMCwwICsx
LDE1IEBACisKKy8qIFNQRFgtTGljZW5zZS1JZGVudGlmaWVyOiBNSVQgKi8KKy8qCisgKiBDb3B5
cmlnaHQgwqkgMjAyMCBJbnRlbCBDb3Jwb3JhdGlvbgorICovCisKKyNpZm5kZWYgU0VMRlRFU1Rf
RU5HSU5FX0hFQVJUQkVBVF9ICisjZGVmaW5lIFNFTEZURVNUX0VOR0lORV9IRUFSVEJFQVRfSAor
CitzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzOworCit2b2lkIHN0X2VuZ2luZV9oZWFydGJlYXRfZGlz
YWJsZShzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmUpOwordm9pZCBzdF9lbmdpbmVfaGVh
cnRiZWF0X2VuYWJsZShzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmUpOworCisjZW5kaWYg
LyogU0VMRlRFU1RfRU5HSU5FX0hFQVJUQkVBVF9IICovCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dw
dS9kcm0vaTkxNS9ndC9zZWxmdGVzdF9lbmdpbmVfcG0uYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1
L2d0L3NlbGZ0ZXN0X2VuZ2luZV9wbS5jCmluZGV4IGNiZjZiMDczNTI3Mi4uZGQ1NGRjYjVjY2Ey
IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9zZWxmdGVzdF9lbmdpbmVfcG0u
YworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9zZWxmdGVzdF9lbmdpbmVfcG0uYwpAQCAt
Niw3ICs2LDEwOSBAQAogCiAjaW5jbHVkZSAiaTkxNV9zZWxmdGVzdC5oIgogI2luY2x1ZGUgInNl
bGZ0ZXN0X2VuZ2luZS5oIgorI2luY2x1ZGUgInNlbGZ0ZXN0X2VuZ2luZV9oZWFydGJlYXQuaCIK
ICNpbmNsdWRlICJzZWxmdGVzdHMvaWd0X2F0b21pYy5oIgorI2luY2x1ZGUgInNlbGZ0ZXN0cy9p
Z3RfZmx1c2hfdGVzdC5oIgorI2luY2x1ZGUgInNlbGZ0ZXN0cy9pZ3Rfc3Bpbm5lci5oIgorCitz
dGF0aWMgaW50IGxpdmVfZW5naW5lX2J1c3lfc3RhdHModm9pZCAqYXJnKQoreworCXN0cnVjdCBp
bnRlbF9ndCAqZ3QgPSBhcmc7CisJc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lOworCWVu
dW0gaW50ZWxfZW5naW5lX2lkIGlkOworCXN0cnVjdCBpZ3Rfc3Bpbm5lciBzcGluOworCWludCBl
cnIgPSAwOworCisJLyoKKwkgKiBDaGVjayB0aGF0IGlmIGFuIGVuZ2luZSBzdXBwb3J0cyBidXN5
LXN0YXRzLCB0aGV5IHRlbGwgdGhlIHRydXRoLgorCSAqLworCisJaWYgKGlndF9zcGlubmVyX2lu
aXQoJnNwaW4sIGd0KSkKKwkJcmV0dXJuIC1FTk9NRU07CisKKwlHRU1fQlVHX09OKGludGVsX2d0
X3BtX2lzX2F3YWtlKGd0KSk7CisJZm9yX2VhY2hfZW5naW5lKGVuZ2luZSwgZ3QsIGlkKSB7CisJ
CXN0cnVjdCBpOTE1X3JlcXVlc3QgKnJxOworCQlrdGltZV90IGRlOworCQl1NjQgZHQ7CisKKwkJ
aWYgKCFpbnRlbF9lbmdpbmVfc3VwcG9ydHNfc3RhdHMoZW5naW5lKSkKKwkJCWNvbnRpbnVlOwor
CisJCWlmICghaW50ZWxfZW5naW5lX2Nhbl9zdG9yZV9kd29yZChlbmdpbmUpKQorCQkJY29udGlu
dWU7CisKKwkJaWYgKGludGVsX2d0X3BtX3dhaXRfZm9yX2lkbGUoZ3QpKSB7CisJCQllcnIgPSAt
RUJVU1k7CisJCQlicmVhazsKKwkJfQorCisJCXN0X2VuZ2luZV9oZWFydGJlYXRfZGlzYWJsZShl
bmdpbmUpOworCisJCUVOR0lORV9UUkFDRShlbmdpbmUsICJtZWFzdXJpbmcgaWRsZSB0aW1lXG4i
KTsKKwkJcHJlZW1wdF9kaXNhYmxlKCk7CisJCWR0ID0ga3RpbWVfdG9fbnMoa3RpbWVfZ2V0KCkp
OworCQlkZSA9IGludGVsX2VuZ2luZV9nZXRfYnVzeV90aW1lKGVuZ2luZSk7CisJCXVkZWxheSgx
MDApOworCQlkZSA9IGt0aW1lX3N1YihpbnRlbF9lbmdpbmVfZ2V0X2J1c3lfdGltZShlbmdpbmUp
LCBkZSk7CisJCWR0ID0ga3RpbWVfdG9fbnMoa3RpbWVfZ2V0KCkpIC0gZHQ7CisJCXByZWVtcHRf
ZW5hYmxlKCk7CisJCWlmIChkZSA8IDAgfHwgZGUgPiAxMCkgeworCQkJcHJfZXJyKCIlczogcmVw
b3J0ZWQgJWxsZG5zIFslZCUlXSBidXN5bmVzcyB3aGlsZSBzbGVlcGluZyBbZm9yICVsbGRuc11c
biIsCisJCQkgICAgICAgZW5naW5lLT5uYW1lLAorCQkJICAgICAgIGRlLCAoaW50KWRpdjY0X3U2
NCgxMDAgKiBkZSwgZHQpLCBkdCk7CisJCQlHRU1fVFJBQ0VfRFVNUCgpOworCQkJZXJyID0gLUVJ
TlZBTDsKKwkJCWdvdG8gZW5kOworCQl9CisKKwkJLyogMTAwJSBidXN5ICovCisJCXJxID0gaWd0
X3NwaW5uZXJfY3JlYXRlX3JlcXVlc3QoJnNwaW4sCisJCQkJCQllbmdpbmUtPmtlcm5lbF9jb250
ZXh0LAorCQkJCQkJTUlfTk9PUCk7CisJCWlmIChJU19FUlIocnEpKSB7CisJCQllcnIgPSBQVFJf
RVJSKHJxKTsKKwkJCWdvdG8gZW5kOworCQl9CisJCWk5MTVfcmVxdWVzdF9hZGQocnEpOworCisJ
CWlmICghaWd0X3dhaXRfZm9yX3NwaW5uZXIoJnNwaW4sIHJxKSkgeworCQkJaW50ZWxfZ3Rfc2V0
X3dlZGdlZChlbmdpbmUtPmd0KTsKKwkJCWVyciA9IC1FVElNRTsKKwkJCWdvdG8gZW5kOworCQl9
CisKKwkJRU5HSU5FX1RSQUNFKGVuZ2luZSwgIm1lYXN1cmluZyBidXN5IHRpbWVcbiIpOworCQlw
cmVlbXB0X2Rpc2FibGUoKTsKKwkJZHQgPSBrdGltZV90b19ucyhrdGltZV9nZXQoKSk7CisJCWRl
ID0gaW50ZWxfZW5naW5lX2dldF9idXN5X3RpbWUoZW5naW5lKTsKKwkJdWRlbGF5KDEwMCk7CisJ
CWRlID0ga3RpbWVfc3ViKGludGVsX2VuZ2luZV9nZXRfYnVzeV90aW1lKGVuZ2luZSksIGRlKTsK
KwkJZHQgPSBrdGltZV90b19ucyhrdGltZV9nZXQoKSkgLSBkdDsKKwkJcHJlZW1wdF9lbmFibGUo
KTsKKwkJaWYgKDEwMCAqIGRlIDwgOTUgKiBkdCB8fCA5NSAqIGRlID4gMTAwICogZHQpIHsKKwkJ
CXByX2VycigiJXM6IHJlcG9ydGVkICVsbGRucyBbJWQlJV0gYnVzeW5lc3Mgd2hpbGUgc3Bpbm5p
bmcgW2ZvciAlbGxkbnNdXG4iLAorCQkJICAgICAgIGVuZ2luZS0+bmFtZSwKKwkJCSAgICAgICBk
ZSwgKGludClkaXY2NF91NjQoMTAwICogZGUsIGR0KSwgZHQpOworCQkJR0VNX1RSQUNFX0RVTVAo
KTsKKwkJCWVyciA9IC1FSU5WQUw7CisJCQlnb3RvIGVuZDsKKwkJfQorCitlbmQ6CisJCXN0X2Vu
Z2luZV9oZWFydGJlYXRfZW5hYmxlKGVuZ2luZSk7CisJCWlndF9zcGlubmVyX2VuZCgmc3Bpbik7
CisJCWlmIChpZ3RfZmx1c2hfdGVzdChndC0+aTkxNSkpCisJCQllcnIgPSAtRUlPOworCQlpZiAo
ZXJyKQorCQkJYnJlYWs7CisJfQorCisJaWd0X3NwaW5uZXJfZmluaSgmc3Bpbik7CisJaWYgKGln
dF9mbHVzaF90ZXN0KGd0LT5pOTE1KSkKKwkJZXJyID0gLUVJTzsKKwlyZXR1cm4gZXJyOworfQog
CiBzdGF0aWMgaW50IGxpdmVfZW5naW5lX3BtKHZvaWQgKmFyZykKIHsKQEAgLTc3LDYgKzE3OSw3
IEBAIHN0YXRpYyBpbnQgbGl2ZV9lbmdpbmVfcG0odm9pZCAqYXJnKQogaW50IGxpdmVfZW5naW5l
X3BtX3NlbGZ0ZXN0cyhzdHJ1Y3QgaW50ZWxfZ3QgKmd0KQogewogCXN0YXRpYyBjb25zdCBzdHJ1
Y3QgaTkxNV9zdWJ0ZXN0IHRlc3RzW10gPSB7CisJCVNVQlRFU1QobGl2ZV9lbmdpbmVfYnVzeV9z
dGF0cyksCiAJCVNVQlRFU1QobGl2ZV9lbmdpbmVfcG0pLAogCX07CiAKZGlmZiAtLWdpdCBhL2Ry
aXZlcnMvZ3B1L2RybS9pOTE1L2d0L3NlbGZ0ZXN0X2hhbmdjaGVjay5jIGIvZHJpdmVycy9ncHUv
ZHJtL2k5MTUvZ3Qvc2VsZnRlc3RfaGFuZ2NoZWNrLmMKaW5kZXggNzQ2MTkzNmQ1NDlkLi5mYjVl
YmY5MzBhYjIgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L3NlbGZ0ZXN0X2hh
bmdjaGVjay5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L3NlbGZ0ZXN0X2hhbmdjaGVj
ay5jCkBAIC0yOSw2ICsyOSw3IEBACiAjaW5jbHVkZSAiaW50ZWxfZ3QuaCIKICNpbmNsdWRlICJp
bnRlbF9lbmdpbmVfaGVhcnRiZWF0LmgiCiAjaW5jbHVkZSAiaW50ZWxfZW5naW5lX3BtLmgiCisj
aW5jbHVkZSAic2VsZnRlc3RfZW5naW5lX2hlYXJ0YmVhdC5oIgogCiAjaW5jbHVkZSAiaTkxNV9z
ZWxmdGVzdC5oIgogI2luY2x1ZGUgInNlbGZ0ZXN0cy9pOTE1X3JhbmRvbS5oIgpAQCAtMzEwLDIy
ICszMTEsNiBAQCBzdGF0aWMgYm9vbCB3YWl0X3VudGlsX3J1bm5pbmcoc3RydWN0IGhhbmcgKmgs
IHN0cnVjdCBpOTE1X3JlcXVlc3QgKnJxKQogCQkJICAxMDAwKSk7CiB9CiAKLXN0YXRpYyB2b2lk
IGVuZ2luZV9oZWFydGJlYXRfZGlzYWJsZShzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmUp
Ci17Ci0JZW5naW5lLT5wcm9wcy5oZWFydGJlYXRfaW50ZXJ2YWxfbXMgPSAwOwotCi0JaW50ZWxf
ZW5naW5lX3BtX2dldChlbmdpbmUpOwotCWludGVsX2VuZ2luZV9wYXJrX2hlYXJ0YmVhdChlbmdp
bmUpOwotfQotCi1zdGF0aWMgdm9pZCBlbmdpbmVfaGVhcnRiZWF0X2VuYWJsZShzdHJ1Y3QgaW50
ZWxfZW5naW5lX2NzICplbmdpbmUpCi17Ci0JaW50ZWxfZW5naW5lX3BtX3B1dChlbmdpbmUpOwot
Ci0JZW5naW5lLT5wcm9wcy5oZWFydGJlYXRfaW50ZXJ2YWxfbXMgPQotCQllbmdpbmUtPmRlZmF1
bHRzLmhlYXJ0YmVhdF9pbnRlcnZhbF9tczsKLX0KLQogc3RhdGljIGludCBpZ3RfaGFuZ19zYW5p
dHljaGVjayh2b2lkICphcmcpCiB7CiAJc3RydWN0IGludGVsX2d0ICpndCA9IGFyZzsKQEAgLTQ4
Miw3ICs0NjcsNyBAQCBzdGF0aWMgaW50IGlndF9yZXNldF9ub3BfZW5naW5lKHZvaWQgKmFyZykK
IAkJcmVzZXRfZW5naW5lX2NvdW50ID0gaTkxNV9yZXNldF9lbmdpbmVfY291bnQoZ2xvYmFsLCBl
bmdpbmUpOwogCQljb3VudCA9IDA7CiAKLQkJZW5naW5lX2hlYXJ0YmVhdF9kaXNhYmxlKGVuZ2lu
ZSk7CisJCXN0X2VuZ2luZV9oZWFydGJlYXRfZGlzYWJsZShlbmdpbmUpOwogCQlzZXRfYml0KEk5
MTVfUkVTRVRfRU5HSU5FICsgaWQsICZndC0+cmVzZXQuZmxhZ3MpOwogCQlkbyB7CiAJCQlpbnQg
aTsKQEAgLTU0MCw3ICs1MjUsNyBAQCBzdGF0aWMgaW50IGlndF9yZXNldF9ub3BfZW5naW5lKHZv
aWQgKmFyZykKIAkJCX0KIAkJfSB3aGlsZSAodGltZV9iZWZvcmUoamlmZmllcywgZW5kX3RpbWUp
KTsKIAkJY2xlYXJfYml0KEk5MTVfUkVTRVRfRU5HSU5FICsgaWQsICZndC0+cmVzZXQuZmxhZ3Mp
OwotCQllbmdpbmVfaGVhcnRiZWF0X2VuYWJsZShlbmdpbmUpOworCQlzdF9lbmdpbmVfaGVhcnRi
ZWF0X2VuYWJsZShlbmdpbmUpOwogCiAJCXByX2luZm8oIiVzKCVzKTogJWQgcmVzZXRzXG4iLCBf
X2Z1bmNfXywgZW5naW5lLT5uYW1lLCBjb3VudCk7CiAKQEAgLTU5MCw3ICs1NzUsNyBAQCBzdGF0
aWMgaW50IF9faWd0X3Jlc2V0X2VuZ2luZShzdHJ1Y3QgaW50ZWxfZ3QgKmd0LCBib29sIGFjdGl2
ZSkKIAkJcmVzZXRfY291bnQgPSBpOTE1X3Jlc2V0X2NvdW50KGdsb2JhbCk7CiAJCXJlc2V0X2Vu
Z2luZV9jb3VudCA9IGk5MTVfcmVzZXRfZW5naW5lX2NvdW50KGdsb2JhbCwgZW5naW5lKTsKIAot
CQllbmdpbmVfaGVhcnRiZWF0X2Rpc2FibGUoZW5naW5lKTsKKwkJc3RfZW5naW5lX2hlYXJ0YmVh
dF9kaXNhYmxlKGVuZ2luZSk7CiAJCXNldF9iaXQoSTkxNV9SRVNFVF9FTkdJTkUgKyBpZCwgJmd0
LT5yZXNldC5mbGFncyk7CiAJCWRvIHsKIAkJCWlmIChhY3RpdmUpIHsKQEAgLTY0Miw3ICs2Mjcs
NyBAQCBzdGF0aWMgaW50IF9faWd0X3Jlc2V0X2VuZ2luZShzdHJ1Y3QgaW50ZWxfZ3QgKmd0LCBi
b29sIGFjdGl2ZSkKIAkJCX0KIAkJfSB3aGlsZSAodGltZV9iZWZvcmUoamlmZmllcywgZW5kX3Rp
bWUpKTsKIAkJY2xlYXJfYml0KEk5MTVfUkVTRVRfRU5HSU5FICsgaWQsICZndC0+cmVzZXQuZmxh
Z3MpOwotCQllbmdpbmVfaGVhcnRiZWF0X2VuYWJsZShlbmdpbmUpOworCQlzdF9lbmdpbmVfaGVh
cnRiZWF0X2VuYWJsZShlbmdpbmUpOwogCiAJCWlmIChlcnIpCiAJCQlicmVhazsKQEAgLTg0MSw3
ICs4MjYsNyBAQCBzdGF0aWMgaW50IF9faWd0X3Jlc2V0X2VuZ2luZXMoc3RydWN0IGludGVsX2d0
ICpndCwKIAogCQl5aWVsZCgpOyAvKiBzdGFydCBhbGwgdGhyZWFkcyBiZWZvcmUgd2UgYmVnaW4g
Ki8KIAotCQllbmdpbmVfaGVhcnRiZWF0X2Rpc2FibGUoZW5naW5lKTsKKwkJc3RfZW5naW5lX2hl
YXJ0YmVhdF9kaXNhYmxlKGVuZ2luZSk7CiAJCXNldF9iaXQoSTkxNV9SRVNFVF9FTkdJTkUgKyBp
ZCwgJmd0LT5yZXNldC5mbGFncyk7CiAJCWRvIHsKIAkJCXN0cnVjdCBpOTE1X3JlcXVlc3QgKnJx
ID0gTlVMTDsKQEAgLTkzMSw3ICs5MTYsNyBAQCBzdGF0aWMgaW50IF9faWd0X3Jlc2V0X2VuZ2lu
ZXMoc3RydWN0IGludGVsX2d0ICpndCwKIAkJCX0KIAkJfSB3aGlsZSAodGltZV9iZWZvcmUoamlm
ZmllcywgZW5kX3RpbWUpKTsKIAkJY2xlYXJfYml0KEk5MTVfUkVTRVRfRU5HSU5FICsgaWQsICZn
dC0+cmVzZXQuZmxhZ3MpOwotCQllbmdpbmVfaGVhcnRiZWF0X2VuYWJsZShlbmdpbmUpOworCQlz
dF9lbmdpbmVfaGVhcnRiZWF0X2VuYWJsZShlbmdpbmUpOwogCiAJCXByX2luZm8oImk5MTVfcmVz
ZXRfZW5naW5lKCVzOiVzKTogJWx1IHJlc2V0c1xuIiwKIAkJCWVuZ2luZS0+bmFtZSwgdGVzdF9u
YW1lLCBjb3VudCk7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9zZWxmdGVz
dF9scmMuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L3NlbGZ0ZXN0X2xyYy5jCmluZGV4IDRm
Mzc1OGExY2JjZi4uN2YyNzA4OGRlZDU1IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkx
NS9ndC9zZWxmdGVzdF9scmMuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9zZWxmdGVz
dF9scmMuYwpAQCAtOSw2ICs5LDcgQEAKICNpbmNsdWRlICJnZW0vaTkxNV9nZW1fcG0uaCIKICNp
bmNsdWRlICJndC9pbnRlbF9lbmdpbmVfaGVhcnRiZWF0LmgiCiAjaW5jbHVkZSAiZ3QvaW50ZWxf
cmVzZXQuaCIKKyNpbmNsdWRlICJndC9zZWxmdGVzdF9lbmdpbmVfaGVhcnRiZWF0LmgiCiAKICNp
bmNsdWRlICJpOTE1X3NlbGZ0ZXN0LmgiCiAjaW5jbHVkZSAic2VsZnRlc3RzL2k5MTVfcmFuZG9t
LmgiCkBAIC01MSwyMiArNTIsNiBAQCBzdGF0aWMgc3RydWN0IGk5MTVfdm1hICpjcmVhdGVfc2Ny
YXRjaChzdHJ1Y3QgaW50ZWxfZ3QgKmd0KQogCXJldHVybiB2bWE7CiB9CiAKLXN0YXRpYyB2b2lk
IGVuZ2luZV9oZWFydGJlYXRfZGlzYWJsZShzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmUp
Ci17Ci0JZW5naW5lLT5wcm9wcy5oZWFydGJlYXRfaW50ZXJ2YWxfbXMgPSAwOwotCi0JaW50ZWxf
ZW5naW5lX3BtX2dldChlbmdpbmUpOwotCWludGVsX2VuZ2luZV9wYXJrX2hlYXJ0YmVhdChlbmdp
bmUpOwotfQotCi1zdGF0aWMgdm9pZCBlbmdpbmVfaGVhcnRiZWF0X2VuYWJsZShzdHJ1Y3QgaW50
ZWxfZW5naW5lX2NzICplbmdpbmUpCi17Ci0JaW50ZWxfZW5naW5lX3BtX3B1dChlbmdpbmUpOwot
Ci0JZW5naW5lLT5wcm9wcy5oZWFydGJlYXRfaW50ZXJ2YWxfbXMgPQotCQllbmdpbmUtPmRlZmF1
bHRzLmhlYXJ0YmVhdF9pbnRlcnZhbF9tczsKLX0KLQogc3RhdGljIGJvb2wgaXNfYWN0aXZlKHN0
cnVjdCBpOTE1X3JlcXVlc3QgKnJxKQogewogCWlmIChpOTE1X3JlcXVlc3RfaXNfYWN0aXZlKHJx
KSkKQEAgLTIzNCw3ICsyMTksNyBAQCBzdGF0aWMgaW50IGxpdmVfdW5saXRlX3Jlc3RvcmUoc3Ry
dWN0IGludGVsX2d0ICpndCwgaW50IHByaW8pCiAJCQllcnIgPSAtRUlPOwogCQkJYnJlYWs7CiAJ
CX0KLQkJZW5naW5lX2hlYXJ0YmVhdF9kaXNhYmxlKGVuZ2luZSk7CisJCXN0X2VuZ2luZV9oZWFy
dGJlYXRfZGlzYWJsZShlbmdpbmUpOwogCiAJCWZvciAobiA9IDA7IG4gPCBBUlJBWV9TSVpFKGNl
KTsgbisrKSB7CiAJCQlzdHJ1Y3QgaW50ZWxfY29udGV4dCAqdG1wOwpAQCAtMzQyLDcgKzMyNyw3
IEBAIHN0YXRpYyBpbnQgbGl2ZV91bmxpdGVfcmVzdG9yZShzdHJ1Y3QgaW50ZWxfZ3QgKmd0LCBp
bnQgcHJpbykKIAkJCWludGVsX2NvbnRleHRfcHV0KGNlW25dKTsKIAkJfQogCi0JCWVuZ2luZV9o
ZWFydGJlYXRfZW5hYmxlKGVuZ2luZSk7CisJCXN0X2VuZ2luZV9oZWFydGJlYXRfZW5hYmxlKGVu
Z2luZSk7CiAJCWlmIChpZ3RfbGl2ZV90ZXN0X2VuZCgmdCkpCiAJCQllcnIgPSAtRUlPOwogCQlp
ZiAoZXJyKQpAQCAtMzk2LDcgKzM4MSw3IEBAIHN0YXRpYyBpbnQgbGl2ZV91bmxpdGVfcmluZyh2
b2lkICphcmcpCiAJCQllcnIgPSAtRUlPOwogCQkJYnJlYWs7CiAJCX0KLQkJZW5naW5lX2hlYXJ0
YmVhdF9kaXNhYmxlKGVuZ2luZSk7CisJCXN0X2VuZ2luZV9oZWFydGJlYXRfZGlzYWJsZShlbmdp
bmUpOwogCiAJCWZvciAobiA9IDA7IG4gPCBBUlJBWV9TSVpFKGNlKTsgbisrKSB7CiAJCQlzdHJ1
Y3QgaW50ZWxfY29udGV4dCAqdG1wOwpAQCAtNTAyLDcgKzQ4Nyw3IEBAIHN0YXRpYyBpbnQgbGl2
ZV91bmxpdGVfcmluZyh2b2lkICphcmcpCiAJCQlpbnRlbF9jb250ZXh0X3VucGluKGNlW25dKTsK
IAkJCWludGVsX2NvbnRleHRfcHV0KGNlW25dKTsKIAkJfQotCQllbmdpbmVfaGVhcnRiZWF0X2Vu
YWJsZShlbmdpbmUpOworCQlzdF9lbmdpbmVfaGVhcnRiZWF0X2VuYWJsZShlbmdpbmUpOwogCQlp
ZiAoaWd0X2xpdmVfdGVzdF9lbmQoJnQpKQogCQkJZXJyID0gLUVJTzsKIAkJaWYgKGVycikKQEAg
LTYyMSw3ICs2MDYsNyBAQCBzdGF0aWMgaW50IGxpdmVfaG9sZF9yZXNldCh2b2lkICphcmcpCiAJ
CQlicmVhazsKIAkJfQogCi0JCWVuZ2luZV9oZWFydGJlYXRfZGlzYWJsZShlbmdpbmUpOworCQlz
dF9lbmdpbmVfaGVhcnRiZWF0X2Rpc2FibGUoZW5naW5lKTsKIAogCQlycSA9IGlndF9zcGlubmVy
X2NyZWF0ZV9yZXF1ZXN0KCZzcGluLCBjZSwgTUlfQVJCX0NIRUNLKTsKIAkJaWYgKElTX0VSUihy
cSkpIHsKQEAgLTY4MSw3ICs2NjYsNyBAQCBzdGF0aWMgaW50IGxpdmVfaG9sZF9yZXNldCh2b2lk
ICphcmcpCiAJCWk5MTVfcmVxdWVzdF9wdXQocnEpOwogCiBvdXQ6Ci0JCWVuZ2luZV9oZWFydGJl
YXRfZW5hYmxlKGVuZ2luZSk7CisJCXN0X2VuZ2luZV9oZWFydGJlYXRfZW5hYmxlKGVuZ2luZSk7
CiAJCWludGVsX2NvbnRleHRfcHV0KGNlKTsKIAkJaWYgKGVycikKIAkJCWJyZWFrOwpAQCAtNzI4
LDcgKzcxMyw3IEBAIHN0YXRpYyBpbnQgbGl2ZV9lcnJvcl9pbnRlcnJ1cHQodm9pZCAqYXJnKQog
CQljb25zdCBzdHJ1Y3QgZXJyb3JfcGhhc2UgKnA7CiAJCWludCBlcnIgPSAwOwogCi0JCWVuZ2lu
ZV9oZWFydGJlYXRfZGlzYWJsZShlbmdpbmUpOworCQlzdF9lbmdpbmVfaGVhcnRiZWF0X2Rpc2Fi
bGUoZW5naW5lKTsKIAogCQlmb3IgKHAgPSBwaGFzZXM7IHAtPmVycm9yWzBdICE9IEdPT0Q7IHAr
KykgewogCQkJc3RydWN0IGk5MTVfcmVxdWVzdCAqY2xpZW50W0FSUkFZX1NJWkUocGhhc2VzLT5l
cnJvcildOwpAQCAtODI3LDcgKzgxMiw3IEBAIHN0YXRpYyBpbnQgbGl2ZV9lcnJvcl9pbnRlcnJ1
cHQodm9pZCAqYXJnKQogCQkJfQogCQl9CiAKLQkJZW5naW5lX2hlYXJ0YmVhdF9lbmFibGUoZW5n
aW5lKTsKKwkJc3RfZW5naW5lX2hlYXJ0YmVhdF9lbmFibGUoZW5naW5lKTsKIAkJaWYgKGVycikg
ewogCQkJaW50ZWxfZ3Rfc2V0X3dlZGdlZChndCk7CiAJCQlyZXR1cm4gZXJyOwpAQCAtMTA0Miw5
ICsxMDI3LDkgQEAgc3RhdGljIGludCBsaXZlX3RpbWVzbGljZV9wcmVlbXB0KHZvaWQgKmFyZykK
IAogCQltZW1zZXQodmFkZHIsIDAsIFBBR0VfU0laRSk7CiAKLQkJZW5naW5lX2hlYXJ0YmVhdF9k
aXNhYmxlKGVuZ2luZSk7CisJCXN0X2VuZ2luZV9oZWFydGJlYXRfZGlzYWJsZShlbmdpbmUpOwog
CQllcnIgPSBzbGljZV9zZW1hcGhvcmVfcXVldWUoZW5naW5lLCB2bWEsIDUpOwotCQllbmdpbmVf
aGVhcnRiZWF0X2VuYWJsZShlbmdpbmUpOworCQlzdF9lbmdpbmVfaGVhcnRiZWF0X2VuYWJsZShl
bmdpbmUpOwogCQlpZiAoZXJyKQogCQkJZ290byBlcnJfcGluOwogCkBAIC0xMTY2LDcgKzExNTEs
NyBAQCBzdGF0aWMgaW50IGxpdmVfdGltZXNsaWNlX3Jld2luZCh2b2lkICphcmcpCiAJCSAqIEV4
cGVjdCBleGVjdXRpb24vZXZhbHVhdGlvbiBvcmRlciBYWlkKIAkJICovCiAKLQkJZW5naW5lX2hl
YXJ0YmVhdF9kaXNhYmxlKGVuZ2luZSk7CisJCXN0X2VuZ2luZV9oZWFydGJlYXRfZGlzYWJsZShl
bmdpbmUpOwogCQl0aW1lc2xpY2UgPSB4Y2hnKCZlbmdpbmUtPnByb3BzLnRpbWVzbGljZV9kdXJh
dGlvbl9tcywgMSk7CiAKIAkJc2xvdCA9IG1lbXNldDMyKGVuZ2luZS0+c3RhdHVzX3BhZ2UuYWRk
ciArIDEwMDAsIDAsIDQpOwpAQCAtMTI2MSw3ICsxMjQ2LDcgQEAgc3RhdGljIGludCBsaXZlX3Rp
bWVzbGljZV9yZXdpbmQodm9pZCAqYXJnKQogCQl3bWIoKTsKIAogCQllbmdpbmUtPnByb3BzLnRp
bWVzbGljZV9kdXJhdGlvbl9tcyA9IHRpbWVzbGljZTsKLQkJZW5naW5lX2hlYXJ0YmVhdF9lbmFi
bGUoZW5naW5lKTsKKwkJc3RfZW5naW5lX2hlYXJ0YmVhdF9lbmFibGUoZW5naW5lKTsKIAkJZm9y
IChpID0gMDsgaSA8IDM7IGkrKykKIAkJCWk5MTVfcmVxdWVzdF9wdXQocnFbaV0pOwogCQlpZiAo
aWd0X2ZsdXNoX3Rlc3QoZ3QtPmk5MTUpKQpAQCAtMTM1Myw3ICsxMzM4LDcgQEAgc3RhdGljIGlu
dCBsaXZlX3RpbWVzbGljZV9xdWV1ZSh2b2lkICphcmcpCiAJCWlmICghaW50ZWxfZW5naW5lX2hh
c19wcmVlbXB0aW9uKGVuZ2luZSkpCiAJCQljb250aW51ZTsKIAotCQllbmdpbmVfaGVhcnRiZWF0
X2Rpc2FibGUoZW5naW5lKTsKKwkJc3RfZW5naW5lX2hlYXJ0YmVhdF9kaXNhYmxlKGVuZ2luZSk7
CiAJCW1lbXNldCh2YWRkciwgMCwgUEFHRV9TSVpFKTsKIAogCQkvKiBFTFNQWzBdOiBzZW1hcGhv
cmUgd2FpdCAqLwpAQCAtMTQxNCw3ICsxMzk5LDcgQEAgc3RhdGljIGludCBsaXZlX3RpbWVzbGlj
ZV9xdWV1ZSh2b2lkICphcmcpCiBlcnJfcnE6CiAJCWk5MTVfcmVxdWVzdF9wdXQocnEpOwogZXJy
X2hlYXJ0YmVhdDoKLQkJZW5naW5lX2hlYXJ0YmVhdF9lbmFibGUoZW5naW5lKTsKKwkJc3RfZW5n
aW5lX2hlYXJ0YmVhdF9lbmFibGUoZW5naW5lKTsKIAkJaWYgKGVycikKIAkJCWJyZWFrOwogCX0K
QEAgLTE0NjAsNyArMTQ0NSw3IEBAIHN0YXRpYyBpbnQgbGl2ZV90aW1lc2xpY2Vfbm9wcmVlbXB0
KHZvaWQgKmFyZykKIAkJCWJyZWFrOwogCQl9CiAKLQkJZW5naW5lX2hlYXJ0YmVhdF9kaXNhYmxl
KGVuZ2luZSk7CisJCXN0X2VuZ2luZV9oZWFydGJlYXRfZGlzYWJsZShlbmdpbmUpOwogCQl0aW1l
c2xpY2UgPSB4Y2hnKCZlbmdpbmUtPnByb3BzLnRpbWVzbGljZV9kdXJhdGlvbl9tcywgMSk7CiAK
IAkJLyogQ3JlYXRlIGFuIHVucHJlZW1wdGlibGUgc3Bpbm5lciAqLwpAQCAtMTUyOSw3ICsxNTE0
LDcgQEAgc3RhdGljIGludCBsaXZlX3RpbWVzbGljZV9ub3ByZWVtcHQodm9pZCAqYXJnKQogCQlp
Z3Rfc3Bpbm5lcl9lbmQoJnNwaW4pOwogb3V0X2hlYXJ0YmVhdDoKIAkJeGNoZygmZW5naW5lLT5w
cm9wcy50aW1lc2xpY2VfZHVyYXRpb25fbXMsIHRpbWVzbGljZSk7Ci0JCWVuZ2luZV9oZWFydGJl
YXRfZW5hYmxlKGVuZ2luZSk7CisJCXN0X2VuZ2luZV9oZWFydGJlYXRfZW5hYmxlKGVuZ2luZSk7
CiAJCWlmIChlcnIpCiAJCQlicmVhazsKIApAQCAtMjQzMyw3ICsyNDE4LDcgQEAgc3RhdGljIGlu
dCBsaXZlX3N1cHByZXNzX3NlbGZfcHJlZW1wdCh2b2lkICphcmcpCiAJCWlmIChpZ3RfZmx1c2hf
dGVzdChndC0+aTkxNSkpCiAJCQlnb3RvIGVycl93ZWRnZWQ7CiAKLQkJZW5naW5lX2hlYXJ0YmVh
dF9kaXNhYmxlKGVuZ2luZSk7CisJCXN0X2VuZ2luZV9oZWFydGJlYXRfZGlzYWJsZShlbmdpbmUp
OwogCQllbmdpbmUtPmV4ZWNsaXN0cy5wcmVlbXB0X2hhbmcuY291bnQgPSAwOwogCiAJCXJxX2Eg
PSBzcGlubmVyX2NyZWF0ZV9yZXF1ZXN0KCZhLnNwaW4sCkBAIC0yNDQxLDE0ICsyNDI2LDE0IEBA
IHN0YXRpYyBpbnQgbGl2ZV9zdXBwcmVzc19zZWxmX3ByZWVtcHQodm9pZCAqYXJnKQogCQkJCQkg
ICAgICBNSV9OT09QKTsKIAkJaWYgKElTX0VSUihycV9hKSkgewogCQkJZXJyID0gUFRSX0VSUihy
cV9hKTsKLQkJCWVuZ2luZV9oZWFydGJlYXRfZW5hYmxlKGVuZ2luZSk7CisJCQlzdF9lbmdpbmVf
aGVhcnRiZWF0X2VuYWJsZShlbmdpbmUpOwogCQkJZ290byBlcnJfY2xpZW50X2I7CiAJCX0KIAog
CQlpOTE1X3JlcXVlc3RfYWRkKHJxX2EpOwogCQlpZiAoIWlndF93YWl0X2Zvcl9zcGlubmVyKCZh
LnNwaW4sIHJxX2EpKSB7CiAJCQlwcl9lcnIoIkZpcnN0IGNsaWVudCBmYWlsZWQgdG8gc3RhcnRc
biIpOwotCQkJZW5naW5lX2hlYXJ0YmVhdF9lbmFibGUoZW5naW5lKTsKKwkJCXN0X2VuZ2luZV9o
ZWFydGJlYXRfZW5hYmxlKGVuZ2luZSk7CiAJCQlnb3RvIGVycl93ZWRnZWQ7CiAJCX0KIApAQCAt
MjQ2MCw3ICsyNDQ1LDcgQEAgc3RhdGljIGludCBsaXZlX3N1cHByZXNzX3NlbGZfcHJlZW1wdCh2
b2lkICphcmcpCiAJCQkJCQkgICAgICBNSV9OT09QKTsKIAkJCWlmIChJU19FUlIocnFfYikpIHsK
IAkJCQllcnIgPSBQVFJfRVJSKHJxX2IpOwotCQkJCWVuZ2luZV9oZWFydGJlYXRfZW5hYmxlKGVu
Z2luZSk7CisJCQkJc3RfZW5naW5lX2hlYXJ0YmVhdF9lbmFibGUoZW5naW5lKTsKIAkJCQlnb3Rv
IGVycl9jbGllbnRfYjsKIAkJCX0KIAkJCWk5MTVfcmVxdWVzdF9hZGQocnFfYik7CkBAIC0yNDcx
LDcgKzI0NTYsNyBAQCBzdGF0aWMgaW50IGxpdmVfc3VwcHJlc3Nfc2VsZl9wcmVlbXB0KHZvaWQg
KmFyZykKIAogCQkJaWYgKCFpZ3Rfd2FpdF9mb3Jfc3Bpbm5lcigmYi5zcGluLCBycV9iKSkgewog
CQkJCXByX2VycigiU2Vjb25kIGNsaWVudCBmYWlsZWQgdG8gc3RhcnRcbiIpOwotCQkJCWVuZ2lu
ZV9oZWFydGJlYXRfZW5hYmxlKGVuZ2luZSk7CisJCQkJc3RfZW5naW5lX2hlYXJ0YmVhdF9lbmFi
bGUoZW5naW5lKTsKIAkJCQlnb3RvIGVycl93ZWRnZWQ7CiAJCQl9CiAKQEAgLTI0ODUsMTIgKzI0
NzAsMTIgQEAgc3RhdGljIGludCBsaXZlX3N1cHByZXNzX3NlbGZfcHJlZW1wdCh2b2lkICphcmcp
CiAJCQkgICAgICAgZW5naW5lLT5uYW1lLAogCQkJICAgICAgIGVuZ2luZS0+ZXhlY2xpc3RzLnBy
ZWVtcHRfaGFuZy5jb3VudCwKIAkJCSAgICAgICBkZXB0aCk7Ci0JCQllbmdpbmVfaGVhcnRiZWF0
X2VuYWJsZShlbmdpbmUpOworCQkJc3RfZW5naW5lX2hlYXJ0YmVhdF9lbmFibGUoZW5naW5lKTsK
IAkJCWVyciA9IC1FSU5WQUw7CiAJCQlnb3RvIGVycl9jbGllbnRfYjsKIAkJfQogCi0JCWVuZ2lu
ZV9oZWFydGJlYXRfZW5hYmxlKGVuZ2luZSk7CisJCXN0X2VuZ2luZV9oZWFydGJlYXRfZW5hYmxl
KGVuZ2luZSk7CiAJCWlmIChpZ3RfZmx1c2hfdGVzdChndC0+aTkxNSkpCiAJCQlnb3RvIGVycl93
ZWRnZWQ7CiAJfQpAQCAtMjkwMiw3ICsyODg3LDcgQEAgc3RhdGljIGludCBsaXZlX3ByZWVtcHRf
cmluZyh2b2lkICphcmcpCiAJCWlmICghaW50ZWxfZW5naW5lX2Nhbl9zdG9yZV9kd29yZChlbmdp
bmUpKQogCQkJY29udGludWU7CiAKLQkJZW5naW5lX2hlYXJ0YmVhdF9kaXNhYmxlKGVuZ2luZSk7
CisJCXN0X2VuZ2luZV9oZWFydGJlYXRfZGlzYWJsZShlbmdpbmUpOwogCiAJCWZvciAobiA9IDA7
IG4gPD0gMzsgbisrKSB7CiAJCQllcnIgPSBfX2xpdmVfcHJlZW1wdF9yaW5nKGVuZ2luZSwgJnNw
aW4sCkBAIC0yOTExLDcgKzI4OTYsNyBAQCBzdGF0aWMgaW50IGxpdmVfcHJlZW1wdF9yaW5nKHZv
aWQgKmFyZykKIAkJCQlicmVhazsKIAkJfQogCi0JCWVuZ2luZV9oZWFydGJlYXRfZW5hYmxlKGVu
Z2luZSk7CisJCXN0X2VuZ2luZV9oZWFydGJlYXRfZW5hYmxlKGVuZ2luZSk7CiAJCWlmIChlcnIp
CiAJCQlicmVhazsKIAl9CkBAIC00NTY4LDcgKzQ1NTMsNyBAQCBzdGF0aWMgaW50IHJlc2V0X3Zp
cnR1YWxfZW5naW5lKHN0cnVjdCBpbnRlbF9ndCAqZ3QsCiAJfQogCiAJZm9yIChuID0gMDsgbiA8
IG5zaWJsaW5nOyBuKyspCi0JCWVuZ2luZV9oZWFydGJlYXRfZGlzYWJsZShzaWJsaW5nc1tuXSk7
CisJCXN0X2VuZ2luZV9oZWFydGJlYXRfZGlzYWJsZShzaWJsaW5nc1tuXSk7CiAKIAlycSA9IGln
dF9zcGlubmVyX2NyZWF0ZV9yZXF1ZXN0KCZzcGluLCB2ZSwgTUlfQVJCX0NIRUNLKTsKIAlpZiAo
SVNfRVJSKHJxKSkgewpAQCAtNDYzOSw3ICs0NjI0LDcgQEAgc3RhdGljIGludCByZXNldF92aXJ0
dWFsX2VuZ2luZShzdHJ1Y3QgaW50ZWxfZ3QgKmd0LAogCWk5MTVfcmVxdWVzdF9wdXQocnEpOwog
b3V0X2hlYXJ0YmVhdDoKIAlmb3IgKG4gPSAwOyBuIDwgbnNpYmxpbmc7IG4rKykKLQkJZW5naW5l
X2hlYXJ0YmVhdF9lbmFibGUoc2libGluZ3Nbbl0pOworCQlzdF9lbmdpbmVfaGVhcnRiZWF0X2Vu
YWJsZShzaWJsaW5nc1tuXSk7CiAKIAlpbnRlbF9jb250ZXh0X3B1dCh2ZSk7CiBvdXRfc3BpbjoK
QEAgLTUzMTQsNyArNTI5OSw3IEBAIHN0YXRpYyBpbnQgbGl2ZV9scmNfZ3ByKHZvaWQgKmFyZykK
IAkJcmV0dXJuIFBUUl9FUlIoc2NyYXRjaCk7CiAKIAlmb3JfZWFjaF9lbmdpbmUoZW5naW5lLCBn
dCwgaWQpIHsKLQkJZW5naW5lX2hlYXJ0YmVhdF9kaXNhYmxlKGVuZ2luZSk7CisJCXN0X2VuZ2lu
ZV9oZWFydGJlYXRfZGlzYWJsZShlbmdpbmUpOwogCiAJCWVyciA9IF9fbGl2ZV9scmNfZ3ByKGVu
Z2luZSwgc2NyYXRjaCwgZmFsc2UpOwogCQlpZiAoZXJyKQpAQCAtNTMyNSw3ICs1MzEwLDcgQEAg
c3RhdGljIGludCBsaXZlX2xyY19ncHIodm9pZCAqYXJnKQogCQkJZ290byBlcnI7CiAKIGVycjoK
LQkJZW5naW5lX2hlYXJ0YmVhdF9lbmFibGUoZW5naW5lKTsKKwkJc3RfZW5naW5lX2hlYXJ0YmVh
dF9lbmFibGUoZW5naW5lKTsKIAkJaWYgKGlndF9mbHVzaF90ZXN0KGd0LT5pOTE1KSkKIAkJCWVy
ciA9IC1FSU87CiAJCWlmIChlcnIpCkBAIC01NDc0LDcgKzU0NTksNyBAQCBzdGF0aWMgaW50IGxp
dmVfbHJjX3RpbWVzdGFtcCh2b2lkICphcmcpCiAJZm9yX2VhY2hfZW5naW5lKGRhdGEuZW5naW5l
LCBndCwgaWQpIHsKIAkJaW50IGksIGVyciA9IDA7CiAKLQkJZW5naW5lX2hlYXJ0YmVhdF9kaXNh
YmxlKGRhdGEuZW5naW5lKTsKKwkJc3RfZW5naW5lX2hlYXJ0YmVhdF9kaXNhYmxlKGRhdGEuZW5n
aW5lKTsKIAogCQlmb3IgKGkgPSAwOyBpIDwgQVJSQVlfU0laRShkYXRhLmNlKTsgaSsrKSB7CiAJ
CQlzdHJ1Y3QgaW50ZWxfY29udGV4dCAqdG1wOwpAQCAtNTUwNyw3ICs1NDkyLDcgQEAgc3RhdGlj
IGludCBsaXZlX2xyY190aW1lc3RhbXAodm9pZCAqYXJnKQogCQl9CiAKIGVycjoKLQkJZW5naW5l
X2hlYXJ0YmVhdF9lbmFibGUoZGF0YS5lbmdpbmUpOworCQlzdF9lbmdpbmVfaGVhcnRiZWF0X2Vu
YWJsZShkYXRhLmVuZ2luZSk7CiAJCWZvciAoaSA9IDA7IGkgPCBBUlJBWV9TSVpFKGRhdGEuY2Up
OyBpKyspIHsKIAkJCWlmICghZGF0YS5jZVtpXSkKIAkJCQlicmVhazsKZGlmZiAtLWdpdCBhL2Ry
aXZlcnMvZ3B1L2RybS9pOTE1L2d0L3NlbGZ0ZXN0X3Jwcy5jIGIvZHJpdmVycy9ncHUvZHJtL2k5
MTUvZ3Qvc2VsZnRlc3RfcnBzLmMKaW5kZXggNTA0OWMzZGQwOGE2Li5iYjc1M2YwYzEyZWIgMTAw
NjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L3NlbGZ0ZXN0X3Jwcy5jCisrKyBiL2Ry
aXZlcnMvZ3B1L2RybS9pOTE1L2d0L3NlbGZ0ZXN0X3Jwcy5jCkBAIC0xMiw2ICsxMiw3IEBACiAj
aW5jbHVkZSAiaW50ZWxfZ3RfY2xvY2tfdXRpbHMuaCIKICNpbmNsdWRlICJpbnRlbF9ndF9wbS5o
IgogI2luY2x1ZGUgImludGVsX3JjNi5oIgorI2luY2x1ZGUgInNlbGZ0ZXN0X2VuZ2luZV9oZWFy
dGJlYXQuaCIKICNpbmNsdWRlICJzZWxmdGVzdF9ycHMuaCIKICNpbmNsdWRlICJzZWxmdGVzdHMv
aWd0X2ZsdXNoX3Rlc3QuaCIKICNpbmNsdWRlICJzZWxmdGVzdHMvaWd0X3NwaW5uZXIuaCIKQEAg
LTIwLDIyICsyMSw2IEBACiAvKiBUcnkgdG8gaXNvbGF0ZSB0aGUgaW1wYWN0IG9mIGNzdGF0ZXMg
ZnJvbSBkZXRlcm1pbmcgZnJlcXVlbmN5IHJlc3BvbnNlICovCiAjZGVmaW5lIENQVV9MQVRFTkNZ
IDAgLyogLTEgdG8gZGlzYWJsZSBwbV9xb3MsIDAgdG8gZGlzYWJsZSBjc3RhdGVzICovCiAKLXN0
YXRpYyB2b2lkIGVuZ2luZV9oZWFydGJlYXRfZGlzYWJsZShzdHJ1Y3QgaW50ZWxfZW5naW5lX2Nz
ICplbmdpbmUpCi17Ci0JZW5naW5lLT5wcm9wcy5oZWFydGJlYXRfaW50ZXJ2YWxfbXMgPSAwOwot
Ci0JaW50ZWxfZW5naW5lX3BtX2dldChlbmdpbmUpOwotCWludGVsX2VuZ2luZV9wYXJrX2hlYXJ0
YmVhdChlbmdpbmUpOwotfQotCi1zdGF0aWMgdm9pZCBlbmdpbmVfaGVhcnRiZWF0X2VuYWJsZShz
dHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmUpCi17Ci0JaW50ZWxfZW5naW5lX3BtX3B1dChl
bmdpbmUpOwotCi0JZW5naW5lLT5wcm9wcy5oZWFydGJlYXRfaW50ZXJ2YWxfbXMgPQotCQllbmdp
bmUtPmRlZmF1bHRzLmhlYXJ0YmVhdF9pbnRlcnZhbF9tczsKLX0KLQogc3RhdGljIHZvaWQgZHVt
bXlfcnBzX3dvcmsoc3RydWN0IHdvcmtfc3RydWN0ICp3cmspCiB7CiB9CkBAIC0yNDksMTMgKzIz
NCwxMyBAQCBpbnQgbGl2ZV9ycHNfY2xvY2tfaW50ZXJ2YWwodm9pZCAqYXJnKQogCQlpZiAoIWlu
dGVsX2VuZ2luZV9jYW5fc3RvcmVfZHdvcmQoZW5naW5lKSkKIAkJCWNvbnRpbnVlOwogCi0JCWVu
Z2luZV9oZWFydGJlYXRfZGlzYWJsZShlbmdpbmUpOworCQlzdF9lbmdpbmVfaGVhcnRiZWF0X2Rp
c2FibGUoZW5naW5lKTsKIAogCQlycSA9IGlndF9zcGlubmVyX2NyZWF0ZV9yZXF1ZXN0KCZzcGlu
LAogCQkJCQkJZW5naW5lLT5rZXJuZWxfY29udGV4dCwKIAkJCQkJCU1JX05PT1ApOwogCQlpZiAo
SVNfRVJSKHJxKSkgewotCQkJZW5naW5lX2hlYXJ0YmVhdF9lbmFibGUoZW5naW5lKTsKKwkJCXN0
X2VuZ2luZV9oZWFydGJlYXRfZW5hYmxlKGVuZ2luZSk7CiAJCQllcnIgPSBQVFJfRVJSKHJxKTsK
IAkJCWJyZWFrOwogCQl9CkBAIC0yNjYsNyArMjUxLDcgQEAgaW50IGxpdmVfcnBzX2Nsb2NrX2lu
dGVydmFsKHZvaWQgKmFyZykKIAkJCXByX2VycigiJXM6IFJQUyBzcGlubmVyIGRpZCBub3Qgc3Rh
cnRcbiIsCiAJCQkgICAgICAgZW5naW5lLT5uYW1lKTsKIAkJCWlndF9zcGlubmVyX2VuZCgmc3Bp
bik7Ci0JCQllbmdpbmVfaGVhcnRiZWF0X2VuYWJsZShlbmdpbmUpOworCQkJc3RfZW5naW5lX2hl
YXJ0YmVhdF9lbmFibGUoZW5naW5lKTsKIAkJCWludGVsX2d0X3NldF93ZWRnZWQoZW5naW5lLT5n
dCk7CiAJCQllcnIgPSAtRUlPOwogCQkJYnJlYWs7CkBAIC0zMjIsNyArMzA3LDcgQEAgaW50IGxp
dmVfcnBzX2Nsb2NrX2ludGVydmFsKHZvaWQgKmFyZykKIAkJaW50ZWxfdW5jb3JlX2ZvcmNld2Fr
ZV9wdXQoZ3QtPnVuY29yZSwgRk9SQ0VXQUtFX0FMTCk7CiAKIAkJaWd0X3NwaW5uZXJfZW5kKCZz
cGluKTsKLQkJZW5naW5lX2hlYXJ0YmVhdF9lbmFibGUoZW5naW5lKTsKKwkJc3RfZW5naW5lX2hl
YXJ0YmVhdF9lbmFibGUoZW5naW5lKTsKIAogCQlpZiAoZXJyID09IDApIHsKIAkJCXU2NCB0aW1l
ID0gaW50ZWxfZ3RfcG1faW50ZXJ2YWxfdG9fbnMoZ3QsIGN5Y2xlcyk7CkBAIC00MDgsNyArMzkz
LDcgQEAgaW50IGxpdmVfcnBzX2NvbnRyb2wodm9pZCAqYXJnKQogCQlpZiAoIWludGVsX2VuZ2lu
ZV9jYW5fc3RvcmVfZHdvcmQoZW5naW5lKSkKIAkJCWNvbnRpbnVlOwogCi0JCWVuZ2luZV9oZWFy
dGJlYXRfZGlzYWJsZShlbmdpbmUpOworCQlzdF9lbmdpbmVfaGVhcnRiZWF0X2Rpc2FibGUoZW5n
aW5lKTsKIAogCQlycSA9IGlndF9zcGlubmVyX2NyZWF0ZV9yZXF1ZXN0KCZzcGluLAogCQkJCQkJ
ZW5naW5lLT5rZXJuZWxfY29udGV4dCwKQEAgLTQyNCw3ICs0MDksNyBAQCBpbnQgbGl2ZV9ycHNf
Y29udHJvbCh2b2lkICphcmcpCiAJCQlwcl9lcnIoIiVzOiBSUFMgc3Bpbm5lciBkaWQgbm90IHN0
YXJ0XG4iLAogCQkJICAgICAgIGVuZ2luZS0+bmFtZSk7CiAJCQlpZ3Rfc3Bpbm5lcl9lbmQoJnNw
aW4pOwotCQkJZW5naW5lX2hlYXJ0YmVhdF9lbmFibGUoZW5naW5lKTsKKwkJCXN0X2VuZ2luZV9o
ZWFydGJlYXRfZW5hYmxlKGVuZ2luZSk7CiAJCQlpbnRlbF9ndF9zZXRfd2VkZ2VkKGVuZ2luZS0+
Z3QpOwogCQkJZXJyID0gLUVJTzsKIAkJCWJyZWFrOwpAQCAtNDM0LDcgKzQxOSw3IEBAIGludCBs
aXZlX3Jwc19jb250cm9sKHZvaWQgKmFyZykKIAkJCXByX2VycigiJXM6IGNvdWxkIG5vdCBzZXQg
bWluaW11bSBmcmVxdWVuY3kgWyV4XSwgb25seSAleCFcbiIsCiAJCQkgICAgICAgZW5naW5lLT5u
YW1lLCBycHMtPm1pbl9mcmVxLCByZWFkX2NhZ2YocnBzKSk7CiAJCQlpZ3Rfc3Bpbm5lcl9lbmQo
JnNwaW4pOwotCQkJZW5naW5lX2hlYXJ0YmVhdF9lbmFibGUoZW5naW5lKTsKKwkJCXN0X2VuZ2lu
ZV9oZWFydGJlYXRfZW5hYmxlKGVuZ2luZSk7CiAJCQlzaG93X3BzdGF0ZV9saW1pdHMocnBzKTsK
IAkJCWVyciA9IC1FSU5WQUw7CiAJCQlicmVhazsKQEAgLTQ1MSw3ICs0MzYsNyBAQCBpbnQgbGl2
ZV9ycHNfY29udHJvbCh2b2lkICphcmcpCiAJCQlwcl9lcnIoIiVzOiBjb3VsZCBub3QgcmVzdG9y
ZSBtaW5pbXVtIGZyZXF1ZW5jeSBbJXhdLCBvbmx5ICV4IVxuIiwKIAkJCSAgICAgICBlbmdpbmUt
Pm5hbWUsIHJwcy0+bWluX2ZyZXEsIHJlYWRfY2FnZihycHMpKTsKIAkJCWlndF9zcGlubmVyX2Vu
ZCgmc3Bpbik7Ci0JCQllbmdpbmVfaGVhcnRiZWF0X2VuYWJsZShlbmdpbmUpOworCQkJc3RfZW5n
aW5lX2hlYXJ0YmVhdF9lbmFibGUoZW5naW5lKTsKIAkJCXNob3dfcHN0YXRlX2xpbWl0cyhycHMp
OwogCQkJZXJyID0gLUVJTlZBTDsKIAkJCWJyZWFrOwpAQCAtNDY2LDcgKzQ1MSw3IEBAIGludCBs
aXZlX3Jwc19jb250cm9sKHZvaWQgKmFyZykKIAkJbWluX2R0ID0ga3RpbWVfc3ViKGt0aW1lX2dl
dCgpLCBtaW5fZHQpOwogCiAJCWlndF9zcGlubmVyX2VuZCgmc3Bpbik7Ci0JCWVuZ2luZV9oZWFy
dGJlYXRfZW5hYmxlKGVuZ2luZSk7CisJCXN0X2VuZ2luZV9oZWFydGJlYXRfZW5hYmxlKGVuZ2lu
ZSk7CiAKIAkJcHJfaW5mbygiJXM6IHJhbmdlOlsleDoldU1IeiwgJXg6JXVNSHpdIGxpbWl0Olsl
eDoldU1Iel0sICV4OiV4IHJlc3BvbnNlICVsbHVuczolbGx1bnNcbiIsCiAJCQllbmdpbmUtPm5h
bWUsCkBAIC02MzcsMTQgKzYyMiwxNCBAQCBpbnQgbGl2ZV9ycHNfZnJlcXVlbmN5X2NzKHZvaWQg
KmFyZykKIAkJCWludCBmcmVxOwogCQl9IG1pbiwgbWF4OwogCi0JCWVuZ2luZV9oZWFydGJlYXRf
ZGlzYWJsZShlbmdpbmUpOworCQlzdF9lbmdpbmVfaGVhcnRiZWF0X2Rpc2FibGUoZW5naW5lKTsK
IAogCQl2bWEgPSBjcmVhdGVfc3Bpbl9jb3VudGVyKGVuZ2luZSwKIAkJCQkJICBlbmdpbmUtPmtl
cm5lbF9jb250ZXh0LT52bSwgZmFsc2UsCiAJCQkJCSAgJmNhbmNlbCwgJmNudHIpOwogCQlpZiAo
SVNfRVJSKHZtYSkpIHsKIAkJCWVyciA9IFBUUl9FUlIodm1hKTsKLQkJCWVuZ2luZV9oZWFydGJl
YXRfZW5hYmxlKGVuZ2luZSk7CisJCQlzdF9lbmdpbmVfaGVhcnRiZWF0X2VuYWJsZShlbmdpbmUp
OwogCQkJYnJlYWs7CiAJCX0KIApAQCAtNzI1LDcgKzcxMCw3IEBAIGludCBsaXZlX3Jwc19mcmVx
dWVuY3lfY3Modm9pZCAqYXJnKQogCQlpOTE1X3ZtYV91bnBpbih2bWEpOwogCQlpOTE1X3ZtYV9w
dXQodm1hKTsKIAotCQllbmdpbmVfaGVhcnRiZWF0X2VuYWJsZShlbmdpbmUpOworCQlzdF9lbmdp
bmVfaGVhcnRiZWF0X2VuYWJsZShlbmdpbmUpOwogCQlpZiAoaWd0X2ZsdXNoX3Rlc3QoZ3QtPmk5
MTUpKQogCQkJZXJyID0gLUVJTzsKIAkJaWYgKGVycikKQEAgLTc3OSwxNCArNzY0LDE0IEBAIGlu
dCBsaXZlX3Jwc19mcmVxdWVuY3lfc3JtKHZvaWQgKmFyZykKIAkJCWludCBmcmVxOwogCQl9IG1p
biwgbWF4OwogCi0JCWVuZ2luZV9oZWFydGJlYXRfZGlzYWJsZShlbmdpbmUpOworCQlzdF9lbmdp
bmVfaGVhcnRiZWF0X2Rpc2FibGUoZW5naW5lKTsKIAogCQl2bWEgPSBjcmVhdGVfc3Bpbl9jb3Vu
dGVyKGVuZ2luZSwKIAkJCQkJICBlbmdpbmUtPmtlcm5lbF9jb250ZXh0LT52bSwgdHJ1ZSwKIAkJ
CQkJICAmY2FuY2VsLCAmY250cik7CiAJCWlmIChJU19FUlIodm1hKSkgewogCQkJZXJyID0gUFRS
X0VSUih2bWEpOwotCQkJZW5naW5lX2hlYXJ0YmVhdF9lbmFibGUoZW5naW5lKTsKKwkJCXN0X2Vu
Z2luZV9oZWFydGJlYXRfZW5hYmxlKGVuZ2luZSk7CiAJCQlicmVhazsKIAkJfQogCkBAIC04NjYs
NyArODUxLDcgQEAgaW50IGxpdmVfcnBzX2ZyZXF1ZW5jeV9zcm0odm9pZCAqYXJnKQogCQlpOTE1
X3ZtYV91bnBpbih2bWEpOwogCQlpOTE1X3ZtYV9wdXQodm1hKTsKIAotCQllbmdpbmVfaGVhcnRi
ZWF0X2VuYWJsZShlbmdpbmUpOworCQlzdF9lbmdpbmVfaGVhcnRiZWF0X2VuYWJsZShlbmdpbmUp
OwogCQlpZiAoaWd0X2ZsdXNoX3Rlc3QoZ3QtPmk5MTUpKQogCQkJZXJyID0gLUVJTzsKIAkJaWYg
KGVycikKQEAgLTEwNjEsMTEgKzEwNDYsMTEgQEAgaW50IGxpdmVfcnBzX2ludGVycnVwdCh2b2lk
ICphcmcpCiAJCQlpbnRlbF9ndF9wbV93YWl0X2Zvcl9pZGxlKGVuZ2luZS0+Z3QpOwogCQkJR0VN
X0JVR19PTihpbnRlbF9ycHNfaXNfYWN0aXZlKHJwcykpOwogCi0JCQllbmdpbmVfaGVhcnRiZWF0
X2Rpc2FibGUoZW5naW5lKTsKKwkJCXN0X2VuZ2luZV9oZWFydGJlYXRfZGlzYWJsZShlbmdpbmUp
OwogCiAJCQllcnIgPSBfX3Jwc191cF9pbnRlcnJ1cHQocnBzLCBlbmdpbmUsICZzcGluKTsKIAot
CQkJZW5naW5lX2hlYXJ0YmVhdF9lbmFibGUoZW5naW5lKTsKKwkJCXN0X2VuZ2luZV9oZWFydGJl
YXRfZW5hYmxlKGVuZ2luZSk7CiAJCQlpZiAoZXJyKQogCQkJCWdvdG8gb3V0OwogCkBAIC0xMDc0
LDEzICsxMDU5LDEzIEBAIGludCBsaXZlX3Jwc19pbnRlcnJ1cHQodm9pZCAqYXJnKQogCiAJCS8q
IEtlZXAgdGhlIGVuZ2luZSBhd2FrZSBidXQgaWRsZSBhbmQgY2hlY2sgZm9yIERPV04gKi8KIAkJ
aWYgKHBtX2V2ZW50cyAmIEdFTjZfUE1fUlBfRE9XTl9USFJFU0hPTEQpIHsKLQkJCWVuZ2luZV9o
ZWFydGJlYXRfZGlzYWJsZShlbmdpbmUpOworCQkJc3RfZW5naW5lX2hlYXJ0YmVhdF9kaXNhYmxl
KGVuZ2luZSk7CiAJCQlpbnRlbF9yYzZfZGlzYWJsZSgmZ3QtPnJjNik7CiAKIAkJCWVyciA9IF9f
cnBzX2Rvd25faW50ZXJydXB0KHJwcywgZW5naW5lKTsKIAogCQkJaW50ZWxfcmM2X2VuYWJsZSgm
Z3QtPnJjNik7Ci0JCQllbmdpbmVfaGVhcnRiZWF0X2VuYWJsZShlbmdpbmUpOworCQkJc3RfZW5n
aW5lX2hlYXJ0YmVhdF9lbmFibGUoZW5naW5lKTsKIAkJCWlmIChlcnIpCiAJCQkJZ290byBvdXQ7
CiAJCX0KQEAgLTExNjUsMTMgKzExNTAsMTMgQEAgaW50IGxpdmVfcnBzX3Bvd2VyKHZvaWQgKmFy
ZykKIAkJaWYgKCFpbnRlbF9lbmdpbmVfY2FuX3N0b3JlX2R3b3JkKGVuZ2luZSkpCiAJCQljb250
aW51ZTsKIAotCQllbmdpbmVfaGVhcnRiZWF0X2Rpc2FibGUoZW5naW5lKTsKKwkJc3RfZW5naW5l
X2hlYXJ0YmVhdF9kaXNhYmxlKGVuZ2luZSk7CiAKIAkJcnEgPSBpZ3Rfc3Bpbm5lcl9jcmVhdGVf
cmVxdWVzdCgmc3BpbiwKIAkJCQkJCWVuZ2luZS0+a2VybmVsX2NvbnRleHQsCiAJCQkJCQlNSV9O
T09QKTsKIAkJaWYgKElTX0VSUihycSkpIHsKLQkJCWVuZ2luZV9oZWFydGJlYXRfZW5hYmxlKGVu
Z2luZSk7CisJCQlzdF9lbmdpbmVfaGVhcnRiZWF0X2VuYWJsZShlbmdpbmUpOwogCQkJZXJyID0g
UFRSX0VSUihycSk7CiAJCQlicmVhazsKIAkJfQpAQCAtMTE4Miw3ICsxMTY3LDcgQEAgaW50IGxp
dmVfcnBzX3Bvd2VyKHZvaWQgKmFyZykKIAkJCXByX2VycigiJXM6IFJQUyBzcGlubmVyIGRpZCBu
b3Qgc3RhcnRcbiIsCiAJCQkgICAgICAgZW5naW5lLT5uYW1lKTsKIAkJCWlndF9zcGlubmVyX2Vu
ZCgmc3Bpbik7Ci0JCQllbmdpbmVfaGVhcnRiZWF0X2VuYWJsZShlbmdpbmUpOworCQkJc3RfZW5n
aW5lX2hlYXJ0YmVhdF9lbmFibGUoZW5naW5lKTsKIAkJCWludGVsX2d0X3NldF93ZWRnZWQoZW5n
aW5lLT5ndCk7CiAJCQllcnIgPSAtRUlPOwogCQkJYnJlYWs7CkBAIC0xMTk1LDcgKzExODAsNyBA
QCBpbnQgbGl2ZV9ycHNfcG93ZXIodm9pZCAqYXJnKQogCQltaW4ucG93ZXIgPSBtZWFzdXJlX3Bv
d2VyX2F0KHJwcywgJm1pbi5mcmVxKTsKIAogCQlpZ3Rfc3Bpbm5lcl9lbmQoJnNwaW4pOwotCQll
bmdpbmVfaGVhcnRiZWF0X2VuYWJsZShlbmdpbmUpOworCQlzdF9lbmdpbmVfaGVhcnRiZWF0X2Vu
YWJsZShlbmdpbmUpOwogCiAJCXByX2luZm8oIiVzOiBtaW46JWxsdW1XIEAgJXVNSHosIG1heDol
bGx1bVcgQCAldU1IelxuIiwKIAkJCWVuZ2luZS0+bmFtZSwKQEAgLTEyNTIsNiArMTIzNywxMSBA
QCBpbnQgbGl2ZV9ycHNfZHluYW1pYyh2b2lkICphcmcpCiAJaWYgKGlndF9zcGlubmVyX2luaXQo
JnNwaW4sIGd0KSkKIAkJcmV0dXJuIC1FTk9NRU07CiAKKwlpZiAoaW50ZWxfcnBzX2hhc19pbnRl
cnJ1cHRzKHJwcykpCisJCXByX2luZm8oIlJQUyBoYXMgaW50ZXJydXB0IHN1cHBvcnRcbiIpOwor
CWlmIChpbnRlbF9ycHNfdXNlc190aW1lcihycHMpKQorCQlwcl9pbmZvKCJSUFMgaGFzIHRpbWVy
IHN1cHBvcnRcbiIpOworCiAJZm9yX2VhY2hfZW5naW5lKGVuZ2luZSwgZ3QsIGlkKSB7CiAJCXN0
cnVjdCBpOTE1X3JlcXVlc3QgKnJxOwogCQlzdHJ1Y3QgewpkaWZmIC0tZ2l0IGEvZHJpdmVycy9n
cHUvZHJtL2k5MTUvZ3Qvc2VsZnRlc3RfdGltZWxpbmUuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1
L2d0L3NlbGZ0ZXN0X3RpbWVsaW5lLmMKaW5kZXggYjJhYWQ3ZWYwNDZhLi5mY2RlZTk1MTU3OWIg
MTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L3NlbGZ0ZXN0X3RpbWVsaW5lLmMK
KysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qvc2VsZnRlc3RfdGltZWxpbmUuYwpAQCAtMTIs
NiArMTIsNyBAQAogI2luY2x1ZGUgImludGVsX2d0LmgiCiAjaW5jbHVkZSAiaW50ZWxfZ3RfcmVx
dWVzdHMuaCIKICNpbmNsdWRlICJpbnRlbF9yaW5nLmgiCisjaW5jbHVkZSAic2VsZnRlc3RfZW5n
aW5lX2hlYXJ0YmVhdC5oIgogCiAjaW5jbHVkZSAiLi4vc2VsZnRlc3RzL2k5MTVfcmFuZG9tLmgi
CiAjaW5jbHVkZSAiLi4vaTkxNV9zZWxmdGVzdC5oIgpAQCAtNzUxLDIyICs3NTIsNiBAQCBzdGF0
aWMgaW50IGxpdmVfaHdzcF93cmFwKHZvaWQgKmFyZykKIAlyZXR1cm4gZXJyOwogfQogCi1zdGF0
aWMgdm9pZCBlbmdpbmVfaGVhcnRiZWF0X2Rpc2FibGUoc3RydWN0IGludGVsX2VuZ2luZV9jcyAq
ZW5naW5lKQotewotCWVuZ2luZS0+cHJvcHMuaGVhcnRiZWF0X2ludGVydmFsX21zID0gMDsKLQot
CWludGVsX2VuZ2luZV9wbV9nZXQoZW5naW5lKTsKLQlpbnRlbF9lbmdpbmVfcGFya19oZWFydGJl
YXQoZW5naW5lKTsKLX0KLQotc3RhdGljIHZvaWQgZW5naW5lX2hlYXJ0YmVhdF9lbmFibGUoc3Ry
dWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lKQotewotCWludGVsX2VuZ2luZV9wbV9wdXQoZW5n
aW5lKTsKLQotCWVuZ2luZS0+cHJvcHMuaGVhcnRiZWF0X2ludGVydmFsX21zID0KLQkJZW5naW5l
LT5kZWZhdWx0cy5oZWFydGJlYXRfaW50ZXJ2YWxfbXM7Ci19Ci0KIHN0YXRpYyBpbnQgbGl2ZV9o
d3NwX3JvbGxvdmVyX2tlcm5lbCh2b2lkICphcmcpCiB7CiAJc3RydWN0IGludGVsX2d0ICpndCA9
IGFyZzsKQEAgLTc4NSw3ICs3NzAsNyBAQCBzdGF0aWMgaW50IGxpdmVfaHdzcF9yb2xsb3Zlcl9r
ZXJuZWwodm9pZCAqYXJnKQogCQlzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpycVszXSA9IHt9OwogCQlp
bnQgaTsKIAotCQllbmdpbmVfaGVhcnRiZWF0X2Rpc2FibGUoZW5naW5lKTsKKwkJc3RfZW5naW5l
X2hlYXJ0YmVhdF9kaXNhYmxlKGVuZ2luZSk7CiAJCWlmIChpbnRlbF9ndF93YWl0X2Zvcl9pZGxl
KGd0LCBIWiAvIDIpKSB7CiAJCQllcnIgPSAtRUlPOwogCQkJZ290byBvdXQ7CkBAIC04MzYsNyAr
ODIxLDcgQEAgc3RhdGljIGludCBsaXZlX2h3c3Bfcm9sbG92ZXJfa2VybmVsKHZvaWQgKmFyZykK
IG91dDoKIAkJZm9yIChpID0gMDsgaSA8IEFSUkFZX1NJWkUocnEpOyBpKyspCiAJCQlpOTE1X3Jl
cXVlc3RfcHV0KHJxW2ldKTsKLQkJZW5naW5lX2hlYXJ0YmVhdF9lbmFibGUoZW5naW5lKTsKKwkJ
c3RfZW5naW5lX2hlYXJ0YmVhdF9lbmFibGUoZW5naW5lKTsKIAkJaWYgKGVycikKIAkJCWJyZWFr
OwogCX0KZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L3NlbGZ0ZXN0cy9pOTE1X3Jl
cXVlc3QuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L3NlbGZ0ZXN0cy9pOTE1X3JlcXVlc3QuYwpp
bmRleCA5MmM2MjhmMThjNjAuLjA2ZDE4YWFlMDcwYiAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUv
ZHJtL2k5MTUvc2VsZnRlc3RzL2k5MTVfcmVxdWVzdC5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9p
OTE1L3NlbGZ0ZXN0cy9pOTE1X3JlcXVlc3QuYwpAQCAtMzQsNiArMzQsNyBAQAogI2luY2x1ZGUg
Imd0L2ludGVsX2VuZ2luZV91c2VyLmgiCiAjaW5jbHVkZSAiZ3QvaW50ZWxfZ3QuaCIKICNpbmNs
dWRlICJndC9pbnRlbF9ndF9yZXF1ZXN0cy5oIgorI2luY2x1ZGUgImd0L3NlbGZ0ZXN0X2VuZ2lu
ZV9oZWFydGJlYXQuaCIKIAogI2luY2x1ZGUgImk5MTVfcmFuZG9tLmgiCiAjaW5jbHVkZSAiaTkx
NV9zZWxmdGVzdC5oIgpAQCAtMjI3MCwyMiArMjI3MSw2IEBAIHN0YXRpYyB2b2lkIHJwc191bnBp
bihzdHJ1Y3QgaW50ZWxfZ3QgKmd0KQogCWF0b21pY19kZWMoJmd0LT5ycHMubnVtX3dhaXRlcnMp
OwogfQogCi1zdGF0aWMgdm9pZCBlbmdpbmVfaGVhcnRiZWF0X2Rpc2FibGUoc3RydWN0IGludGVs
X2VuZ2luZV9jcyAqZW5naW5lKQotewotCWVuZ2luZS0+cHJvcHMuaGVhcnRiZWF0X2ludGVydmFs
X21zID0gMDsKLQotCWludGVsX2VuZ2luZV9wbV9nZXQoZW5naW5lKTsKLQlpbnRlbF9lbmdpbmVf
cGFya19oZWFydGJlYXQoZW5naW5lKTsKLX0KLQotc3RhdGljIHZvaWQgZW5naW5lX2hlYXJ0YmVh
dF9lbmFibGUoc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lKQotewotCWludGVsX2VuZ2lu
ZV9wbV9wdXQoZW5naW5lKTsKLQotCWVuZ2luZS0+cHJvcHMuaGVhcnRiZWF0X2ludGVydmFsX21z
ID0KLQkJZW5naW5lLT5kZWZhdWx0cy5oZWFydGJlYXRfaW50ZXJ2YWxfbXM7Ci19Ci0KIHN0YXRp
YyBpbnQgcGVyZl9yZXF1ZXN0X2xhdGVuY3kodm9pZCAqYXJnKQogewogCXN0cnVjdCBkcm1faTkx
NV9wcml2YXRlICppOTE1ID0gYXJnOwpAQCAtMjMxMSw3ICsyMjk2LDcgQEAgc3RhdGljIGludCBw
ZXJmX3JlcXVlc3RfbGF0ZW5jeSh2b2lkICphcmcpCiAJCQlnb3RvIG91dDsKIAkJfQogCi0JCWVu
Z2luZV9oZWFydGJlYXRfZGlzYWJsZShlbmdpbmUpOworCQlzdF9lbmdpbmVfaGVhcnRiZWF0X2Rp
c2FibGUoZW5naW5lKTsKIAkJcnBzX3BpbihlbmdpbmUtPmd0KTsKIAogCQlpZiAoZXJyID09IDAp
CkBAIC0yMzMwLDcgKzIzMTUsNyBAQCBzdGF0aWMgaW50IHBlcmZfcmVxdWVzdF9sYXRlbmN5KHZv
aWQgKmFyZykKIAkJCWVyciA9IG1lYXN1cmVfY29tcGxldGlvbihjZSk7CiAKIAkJcnBzX3VucGlu
KGVuZ2luZS0+Z3QpOwotCQllbmdpbmVfaGVhcnRiZWF0X2VuYWJsZShlbmdpbmUpOworCQlzdF9l
bmdpbmVfaGVhcnRiZWF0X2VuYWJsZShlbmdpbmUpOwogCiAJCWludGVsX2NvbnRleHRfdW5waW4o
Y2UpOwogCQlpbnRlbF9jb250ZXh0X3B1dChjZSk7Ci0tIAoyLjIwLjEKCl9fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fCkludGVsLWdmeCBtYWlsaW5nIGxpc3QK
SW50ZWwtZ2Z4QGxpc3RzLmZyZWVkZXNrdG9wLm9yZwpodHRwczovL2xpc3RzLmZyZWVkZXNrdG9w
Lm9yZy9tYWlsbWFuL2xpc3RpbmZvL2ludGVsLWdmeAo=

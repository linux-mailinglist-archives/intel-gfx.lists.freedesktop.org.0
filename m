Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id A947730FD1A
	for <lists+intel-gfx@lfdr.de>; Thu,  4 Feb 2021 20:44:05 +0100 (CET)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id E1EB26EE4B;
	Thu,  4 Feb 2021 19:44:03 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from mga07.intel.com (mga07.intel.com [134.134.136.100])
 by gabe.freedesktop.org (Postfix) with ESMTPS id D2E9B6EE4B
 for <intel-gfx@lists.freedesktop.org>; Thu,  4 Feb 2021 19:44:01 +0000 (UTC)
IronPort-SDR: faXRLEAsLWNQ8w2JAKKSQDS1tO9dacHc+cGXl9iwVpAFwGz7E8+BgWxPFjPmoNc7Puvj/I+z7j
 nXkBpxvymjyw==
X-IronPort-AV: E=McAfee;i="6000,8403,9885"; a="245387729"
X-IronPort-AV: E=Sophos;i="5.81,153,1610438400"; d="scan'208";a="245387729"
Received: from fmsmga001.fm.intel.com ([10.253.24.23])
 by orsmga105.jf.intel.com with ESMTP/TLS/ECDHE-RSA-AES256-GCM-SHA384;
 04 Feb 2021 11:44:00 -0800
IronPort-SDR: iW7JTFxND+7cI1VqsFqt6L9y2l3+WURiFathRN5SSDcvJUhQsZrVeXsxG14PJ3TUIA67E338Yq
 2DNGZ5KF1rWw==
X-IronPort-AV: E=Sophos;i="5.81,153,1610438400"; d="scan'208";a="483684547"
Received: from dbmayer-mobl.ger.corp.intel.com (HELO localhost) ([10.252.53.1])
 by fmsmga001-auth.fm.intel.com with ESMTP/TLS/ECDHE-RSA-AES256-GCM-SHA384;
 04 Feb 2021 11:43:55 -0800
From: Jani Nikula <jani.nikula@intel.com>
To: intel-gfx@lists.freedesktop.org
Date: Thu,  4 Feb 2021 21:43:20 +0200
Message-Id: <b84e4d31c02dc9722522b003958ffbe12837e58b.1612467466.git.jani.nikula@intel.com>
X-Mailer: git-send-email 2.20.1
In-Reply-To: <cover.1612467466.git.jani.nikula@intel.com>
References: <cover.1612467466.git.jani.nikula@intel.com>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH v11 03/10] drm/i915: migrate skl planes code new
 file (v5)
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.29
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Cc: jani.nikula@intel.com, Dave Airlie <airlied@redhat.com>,
 Dan Carpenter <dan.carpenter@oracle.com>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

RnJvbTogRGF2ZSBBaXJsaWUgPGFpcmxpZWRAcmVkaGF0LmNvbT4KClJld29yayB0aGUgcGxhbmUg
aW5pdCBjYWxscyB0byBkbyB0aGUgZ2VuIHRlc3Qgb25lIGxldmVsIGhpZ2hlci4KClJld29yayBz
b21lIG9mIHRoZSBwbGFuZSBoZWxwZXJzIHNvIHRoZXkgY2FuIGxpdmUgaW4gbmV3IGZpbGUsCnRo
ZXJlIGlzIHN0aWxsIHNvbWUgc2NvcGUgdG8gY2xlYW4gdXAgdGhlIHBsYW5lL2ZiIGludGVyYWN0
aW9ucwpsYXRlci4KCnYyOiBkcm9wIGF0b21pYyBjb2RlIGJhY2ssIHJlbmFtZSBmaWxlIHRvIFZp
bGxlIHN1Z2dlc3Rpb25zLAphZGQgaGVhZGVyIGZpbGUuCnYzOiBtb3ZlIHNjYWxlciBiaXRzIGJh
Y2sKdjQ6IGRyb3Agd3JvbmcgbmV3IGluY2x1ZGVzIChWaWxsZSkKdjU6IGludGVncmF0ZSB0aGUg
Y2NzIGdlbjEyIGNoYW5nZXMKClNpZ25lZC1vZmYtYnk6IERhdmUgQWlybGllIDxhaXJsaWVkQHJl
ZGhhdC5jb20+CltKYW5pOiBmaXhlZCB1cCBzcGFyc2Ugd2FybmluZ3MuXQpTaWduZWQtb2ZmLWJ5
OiBKYW5pIE5pa3VsYSA8amFuaS5uaWt1bGFAaW50ZWwuY29tPgpSZXBvcnRlZC1ieToga2VybmVs
IHRlc3Qgcm9ib3QgPGxrcEBpbnRlbC5jb20+ClJlcG9ydGVkLWJ5OiBEYW4gQ2FycGVudGVyIDxk
YW4uY2FycGVudGVyQG9yYWNsZS5jb20+Ci0tLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvTWFrZWZp
bGUgICAgICAgICAgICAgICAgIHwgICAgMyArLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxh
eS9pOXh4X3BsYW5lLmMgICAgIHwgICAgNCAtCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5
L2ljbF9kc2kuYyAgICAgICAgfCAgICAxICsKIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkv
aW50ZWxfY3J0Yy5jICAgICB8ICAgMTMgKy0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkv
aW50ZWxfZGRpLmMgICAgICB8ICAgIDEgKwogZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9p
bnRlbF9kaXNwbGF5LmMgIHwgIDk3MCArLS0tLS0tCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNw
bGF5L2ludGVsX2Rpc3BsYXkuaCAgfCAgIDI3ICstCiAuLi4vZHJtL2k5MTUvZGlzcGxheS9pbnRl
bF9kaXNwbGF5X3R5cGVzLmggICAgfCAgIDI3ICsKIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3Bs
YXkvaW50ZWxfcHNyLmMgICAgICB8ICAgIDEgKwogZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxh
eS9pbnRlbF9zcHJpdGUuYyAgIHwgMTM0MyArLS0tLS0tLS0tCiBkcml2ZXJzL2dwdS9kcm0vaTkx
NS9kaXNwbGF5L2ludGVsX3Nwcml0ZS5oICAgfCAgICA2ICstCiAuLi4vZHJtL2k5MTUvZGlzcGxh
eS9za2xfdW5pdmVyc2FsX3BsYW5lLmMgICAgfCAyMjY1ICsrKysrKysrKysrKysrKysrCiAuLi4v
ZHJtL2k5MTUvZGlzcGxheS9za2xfdW5pdmVyc2FsX3BsYW5lLmggICAgfCAgIDMzICsKIGRyaXZl
cnMvZ3B1L2RybS9pOTE1L2ludGVsX3BtLmMgICAgICAgICAgICAgICB8ICAgIDEgKwogMTQgZmls
ZXMgY2hhbmdlZCwgMjM5MSBpbnNlcnRpb25zKCspLCAyMzA0IGRlbGV0aW9ucygtKQogY3JlYXRl
IG1vZGUgMTAwNjQ0IGRyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvc2tsX3VuaXZlcnNhbF9w
bGFuZS5jCiBjcmVhdGUgbW9kZSAxMDA2NDQgZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9z
a2xfdW5pdmVyc2FsX3BsYW5lLmgKCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9N
YWtlZmlsZSBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L01ha2VmaWxlCmluZGV4IGQ1NzFlODc0MTZk
Yy4uOTM4OGUwOTE4NGZlIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9NYWtlZmls
ZQorKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9NYWtlZmlsZQpAQCAtMjI1LDcgKzIyNSw4IEBA
IGk5MTUteSArPSBcCiAJZGlzcGxheS9pbnRlbF9zcHJpdGUubyBcCiAJZGlzcGxheS9pbnRlbF90
Yy5vIFwKIAlkaXNwbGF5L2ludGVsX3ZnYS5vIFwKLQlkaXNwbGF5L2k5eHhfcGxhbmUubworCWRp
c3BsYXkvaTl4eF9wbGFuZS5vIFwKKwlkaXNwbGF5L3NrbF91bml2ZXJzYWxfcGxhbmUubwogaTkx
NS0kKENPTkZJR19BQ1BJKSArPSBcCiAJZGlzcGxheS9pbnRlbF9hY3BpLm8gXAogCWRpc3BsYXkv
aW50ZWxfb3ByZWdpb24ubwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxh
eS9pOXh4X3BsYW5lLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2k5eHhfcGxhbmUu
YwppbmRleCBkMzAzNzRkZjY3ZjAuLmQxMTZkZWUyMDFhYSAxMDA2NDQKLS0tIGEvZHJpdmVycy9n
cHUvZHJtL2k5MTUvZGlzcGxheS9pOXh4X3BsYW5lLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5
MTUvZGlzcGxheS9pOXh4X3BsYW5lLmMKQEAgLTc0MywxMCArNzQzLDYgQEAgaW50ZWxfcHJpbWFy
eV9wbGFuZV9jcmVhdGUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LCBlbnVtIHBp
cGUgcGlwZSkKIAlpbnQgbnVtX2Zvcm1hdHM7CiAJaW50IHJldCwgenBvczsKIAotCWlmIChJTlRF
TF9HRU4oZGV2X3ByaXYpID49IDkpCi0JCXJldHVybiBza2xfdW5pdmVyc2FsX3BsYW5lX2NyZWF0
ZShkZXZfcHJpdiwgcGlwZSwKLQkJCQkJCSAgUExBTkVfUFJJTUFSWSk7Ci0KIAlwbGFuZSA9IGlu
dGVsX3BsYW5lX2FsbG9jKCk7CiAJaWYgKElTX0VSUihwbGFuZSkpCiAJCXJldHVybiBwbGFuZTsK
ZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaWNsX2RzaS5jIGIvZHJp
dmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pY2xfZHNpLmMKaW5kZXggOWQyNDVhNjg5MzIzLi45
ZWVlYzZmYWRlYzcgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaWNs
X2RzaS5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaWNsX2RzaS5jCkBAIC0z
NSw2ICszNSw3IEBACiAjaW5jbHVkZSAiaW50ZWxfZHNpLmgiCiAjaW5jbHVkZSAiaW50ZWxfcGFu
ZWwuaCIKICNpbmNsdWRlICJpbnRlbF92ZHNjLmgiCisjaW5jbHVkZSAic2tsX3VuaXZlcnNhbF9w
bGFuZS5oIgogCiBzdGF0aWMgaW50IGhlYWRlcl9jcmVkaXRzX2F2YWlsYWJsZShzdHJ1Y3QgZHJt
X2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCiAJCQkJICAgIGVudW0gdHJhbnNjb2RlciBkc2lfdHJh
bnMpCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2NydGMu
YyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfY3J0Yy5jCmluZGV4IDU3YjBh
M2ViZTkwOC4uZWI0Nzg3MTJjMzgxIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9k
aXNwbGF5L2ludGVsX2NydGMuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2lu
dGVsX2NydGMuYwpAQCAtMjAsNiArMjAsNyBAQAogI2luY2x1ZGUgImludGVsX3BpcGVfY3JjLmgi
CiAjaW5jbHVkZSAiaW50ZWxfc3ByaXRlLmgiCiAjaW5jbHVkZSAiaTl4eF9wbGFuZS5oIgorI2lu
Y2x1ZGUgInNrbF91bml2ZXJzYWxfcGxhbmUuaCIKIAogc3RhdGljIHZvaWQgYXNzZXJ0X3ZibGFu
a19kaXNhYmxlZChzdHJ1Y3QgZHJtX2NydGMgKmNydGMpCiB7CkBAIC0yNDMsNyArMjQ0LDExIEBA
IGludCBpbnRlbF9jcnRjX2luaXQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LCBl
bnVtIHBpcGUgcGlwZSkKIAljcnRjLT5waXBlID0gcGlwZTsKIAljcnRjLT5udW1fc2NhbGVycyA9
IFJVTlRJTUVfSU5GTyhkZXZfcHJpdiktPm51bV9zY2FsZXJzW3BpcGVdOwogCi0JcHJpbWFyeSA9
IGludGVsX3ByaW1hcnlfcGxhbmVfY3JlYXRlKGRldl9wcml2LCBwaXBlKTsKKwlpZiAoSU5URUxf
R0VOKGRldl9wcml2KSA+PSA5KQorCQlwcmltYXJ5ID0gc2tsX3VuaXZlcnNhbF9wbGFuZV9jcmVh
dGUoZGV2X3ByaXYsIHBpcGUsCisJCQkJCQkgICAgIFBMQU5FX1BSSU1BUlkpOworCWVsc2UKKwkJ
cHJpbWFyeSA9IGludGVsX3ByaW1hcnlfcGxhbmVfY3JlYXRlKGRldl9wcml2LCBwaXBlKTsKIAlp
ZiAoSVNfRVJSKHByaW1hcnkpKSB7CiAJCXJldCA9IFBUUl9FUlIocHJpbWFyeSk7CiAJCWdvdG8g
ZmFpbDsKQEAgLTI1Myw3ICsyNTgsMTEgQEAgaW50IGludGVsX2NydGNfaW5pdChzdHJ1Y3QgZHJt
X2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsIGVudW0gcGlwZSBwaXBlKQogCWZvcl9lYWNoX3Nwcml0
ZShkZXZfcHJpdiwgcGlwZSwgc3ByaXRlKSB7CiAJCXN0cnVjdCBpbnRlbF9wbGFuZSAqcGxhbmU7
CiAKLQkJcGxhbmUgPSBpbnRlbF9zcHJpdGVfcGxhbmVfY3JlYXRlKGRldl9wcml2LCBwaXBlLCBz
cHJpdGUpOworCQlpZiAoSU5URUxfR0VOKGRldl9wcml2KSA+PSA5KQorCQkJcGxhbmUgPSBza2xf
dW5pdmVyc2FsX3BsYW5lX2NyZWF0ZShkZXZfcHJpdiwgcGlwZSwKKwkJCQkJCQkgICBQTEFORV9T
UFJJVEUwICsgc3ByaXRlKTsKKwkJZWxzZQorCQkJcGxhbmUgPSBpbnRlbF9zcHJpdGVfcGxhbmVf
Y3JlYXRlKGRldl9wcml2LCBwaXBlLCBzcHJpdGUpOwogCQlpZiAoSVNfRVJSKHBsYW5lKSkgewog
CQkJcmV0ID0gUFRSX0VSUihwbGFuZSk7CiAJCQlnb3RvIGZhaWw7CmRpZmYgLS1naXQgYS9kcml2
ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2RkaS5jIGIvZHJpdmVycy9ncHUvZHJtL2k5
MTUvZGlzcGxheS9pbnRlbF9kZGkuYwppbmRleCAyODg3N2EzMWFkYzAuLmY0NzQ2YzFlZGFiZSAx
MDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kZGkuYworKysg
Yi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2RkaS5jCkBAIC01NCw2ICs1NCw3
IEBACiAjaW5jbHVkZSAiaW50ZWxfdGMuaCIKICNpbmNsdWRlICJpbnRlbF92ZHNjLmgiCiAjaW5j
bHVkZSAiaW50ZWxfdnJyLmgiCisjaW5jbHVkZSAic2tsX3VuaXZlcnNhbF9wbGFuZS5oIgogCiBz
dGF0aWMgY29uc3QgdTggaW5kZXhfdG9fZHBfc2lnbmFsX2xldmVsc1tdID0gewogCVswXSA9IERQ
X1RSQUlOX1ZPTFRBR0VfU1dJTkdfTEVWRUxfMCB8IERQX1RSQUlOX1BSRV9FTVBIX0xFVkVMXzAs
CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2Rpc3BsYXku
YyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZGlzcGxheS5jCmluZGV4IGFj
YTk2NGY3YmE3Mi4uODIxMWNiNDBiNWM2IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkx
NS9kaXNwbGF5L2ludGVsX2Rpc3BsYXkuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNw
bGF5L2ludGVsX2Rpc3BsYXkuYwpAQCAtOTQsNiArOTQsNyBAQAogI2luY2x1ZGUgImludGVsX3Rj
LmgiCiAjaW5jbHVkZSAiaW50ZWxfdmdhLmgiCiAjaW5jbHVkZSAiaTl4eF9wbGFuZS5oIgorI2lu
Y2x1ZGUgInNrbF91bml2ZXJzYWxfcGxhbmUuaCIKIAogc3RhdGljIHZvaWQgaTl4eF9jcnRjX2Ns
b2NrX2dldChzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YywKIAkJCQlzdHJ1Y3QgaW50ZWxfY3J0Y19z
dGF0ZSAqcGlwZV9jb25maWcpOwpAQCAtMTE2LDcgKzExNyw2IEBAIHN0YXRpYyB2b2lkIHZsdl9w
cmVwYXJlX3BsbChzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YywKIAkJCSAgICBjb25zdCBzdHJ1Y3Qg
aW50ZWxfY3J0Y19zdGF0ZSAqcGlwZV9jb25maWcpOwogc3RhdGljIHZvaWQgY2h2X3ByZXBhcmVf
cGxsKHN0cnVjdCBpbnRlbF9jcnRjICpjcnRjLAogCQkJICAgIGNvbnN0IHN0cnVjdCBpbnRlbF9j
cnRjX3N0YXRlICpwaXBlX2NvbmZpZyk7Ci1zdGF0aWMgdm9pZCBza2xfcGZpdF9lbmFibGUoY29u
c3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUpOwogc3RhdGljIHZvaWQgaWxr
X3BmaXRfZW5hYmxlKGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlKTsK
IHN0YXRpYyB2b2lkIGludGVsX21vZGVzZXRfc2V0dXBfaHdfc3RhdGUoc3RydWN0IGRybV9kZXZp
Y2UgKmRldiwKIAkJCQkJIHN0cnVjdCBkcm1fbW9kZXNldF9hY3F1aXJlX2N0eCAqY3R4KTsKQEAg
LTEwODIsMzIgKzEwODIsNiBAQCBzdGF0aWMgdW5zaWduZWQgaW50IGludGVsX3RpbGVfc2l6ZShj
b25zdCBzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCiAJcmV0dXJuIElTX0dFTihk
ZXZfcHJpdiwgMikgPyAyMDQ4IDogNDA5NjsKIH0KIAotc3RhdGljIGJvb2wgaXNfY2NzX3BsYW5l
KGNvbnN0IHN0cnVjdCBkcm1fZnJhbWVidWZmZXIgKmZiLCBpbnQgcGxhbmUpCi17Ci0JaWYgKCFp
c19jY3NfbW9kaWZpZXIoZmItPm1vZGlmaWVyKSkKLQkJcmV0dXJuIGZhbHNlOwotCi0JcmV0dXJu
IHBsYW5lID49IGZiLT5mb3JtYXQtPm51bV9wbGFuZXMgLyAyOwotfQotCi1zdGF0aWMgYm9vbCBp
c19nZW4xMl9jY3NfbW9kaWZpZXIodTY0IG1vZGlmaWVyKQotewotCXJldHVybiBtb2RpZmllciA9
PSBJOTE1X0ZPUk1BVF9NT0RfWV9USUxFRF9HRU4xMl9SQ19DQ1MgfHwKLQkgICAgICAgbW9kaWZp
ZXIgPT0gSTkxNV9GT1JNQVRfTU9EX1lfVElMRURfR0VOMTJfUkNfQ0NTX0NDIHx8Ci0JICAgICAg
IG1vZGlmaWVyID09IEk5MTVfRk9STUFUX01PRF9ZX1RJTEVEX0dFTjEyX01DX0NDUzsKLX0KLQot
c3RhdGljIGJvb2wgaXNfZ2VuMTJfY2NzX3BsYW5lKGNvbnN0IHN0cnVjdCBkcm1fZnJhbWVidWZm
ZXIgKmZiLCBpbnQgcGxhbmUpCi17Ci0JcmV0dXJuIGlzX2dlbjEyX2Njc19tb2RpZmllcihmYi0+
bW9kaWZpZXIpICYmIGlzX2Njc19wbGFuZShmYiwgcGxhbmUpOwotfQotCi1zdGF0aWMgYm9vbCBp
c19nZW4xMl9jY3NfY2NfcGxhbmUoY29uc3Qgc3RydWN0IGRybV9mcmFtZWJ1ZmZlciAqZmIsIGlu
dCBwbGFuZSkKLXsKLQlyZXR1cm4gZmItPm1vZGlmaWVyID09IEk5MTVfRk9STUFUX01PRF9ZX1RJ
TEVEX0dFTjEyX1JDX0NDU19DQyAmJgotCSAgICAgICBwbGFuZSA9PSAyOwotfQotCiBzdGF0aWMg
Ym9vbCBpc19hdXhfcGxhbmUoY29uc3Qgc3RydWN0IGRybV9mcmFtZWJ1ZmZlciAqZmIsIGludCBw
bGFuZSkKIHsKIAlpZiAoaXNfY2NzX21vZGlmaWVyKGZiLT5tb2RpZmllcikpCkBAIC0xMTE2LDM4
ICsxMDkwLDYgQEAgc3RhdGljIGJvb2wgaXNfYXV4X3BsYW5lKGNvbnN0IHN0cnVjdCBkcm1fZnJh
bWVidWZmZXIgKmZiLCBpbnQgcGxhbmUpCiAJcmV0dXJuIHBsYW5lID09IDE7CiB9CiAKLXN0YXRp
YyBpbnQgbWFpbl90b19jY3NfcGxhbmUoY29uc3Qgc3RydWN0IGRybV9mcmFtZWJ1ZmZlciAqZmIs
IGludCBtYWluX3BsYW5lKQotewotCWRybV9XQVJOX09OKGZiLT5kZXYsICFpc19jY3NfbW9kaWZp
ZXIoZmItPm1vZGlmaWVyKSB8fAotCQkgICAgKG1haW5fcGxhbmUgJiYgbWFpbl9wbGFuZSA+PSBm
Yi0+Zm9ybWF0LT5udW1fcGxhbmVzIC8gMikpOwotCi0JcmV0dXJuIGZiLT5mb3JtYXQtPm51bV9w
bGFuZXMgLyAyICsgbWFpbl9wbGFuZTsKLX0KLQotc3RhdGljIGludCBjY3NfdG9fbWFpbl9wbGFu
ZShjb25zdCBzdHJ1Y3QgZHJtX2ZyYW1lYnVmZmVyICpmYiwgaW50IGNjc19wbGFuZSkKLXsKLQlk
cm1fV0FSTl9PTihmYi0+ZGV2LCAhaXNfY2NzX21vZGlmaWVyKGZiLT5tb2RpZmllcikgfHwKLQkJ
ICAgIGNjc19wbGFuZSA8IGZiLT5mb3JtYXQtPm51bV9wbGFuZXMgLyAyKTsKLQotCWlmIChpc19n
ZW4xMl9jY3NfY2NfcGxhbmUoZmIsIGNjc19wbGFuZSkpCi0JCXJldHVybiAwOwotCi0JcmV0dXJu
IGNjc19wbGFuZSAtIGZiLT5mb3JtYXQtPm51bV9wbGFuZXMgLyAyOwotfQotCi1pbnQgaW50ZWxf
bWFpbl90b19hdXhfcGxhbmUoY29uc3Qgc3RydWN0IGRybV9mcmFtZWJ1ZmZlciAqZmIsIGludCBt
YWluX3BsYW5lKQotewotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0gdG9faTkxNShm
Yi0+ZGV2KTsKLQotCWlmIChpc19jY3NfbW9kaWZpZXIoZmItPm1vZGlmaWVyKSkKLQkJcmV0dXJu
IG1haW5fdG9fY2NzX3BsYW5lKGZiLCBtYWluX3BsYW5lKTsKLQllbHNlIGlmIChJTlRFTF9HRU4o
aTkxNSkgPCAxMSAmJgotCQkgaW50ZWxfZm9ybWF0X2luZm9faXNfeXV2X3NlbWlwbGFuYXIoZmIt
PmZvcm1hdCwgZmItPm1vZGlmaWVyKSkKLQkJcmV0dXJuIDE7Ci0JZWxzZQotCQlyZXR1cm4gMDsK
LX0KLQogYm9vbAogaW50ZWxfZm9ybWF0X2luZm9faXNfeXV2X3NlbWlwbGFuYXIoY29uc3Qgc3Ry
dWN0IGRybV9mb3JtYXRfaW5mbyAqaW5mbywKIAkJCQkgICAgdTY0IG1vZGlmaWVyKQpAQCAtMTE2
Myw3ICsxMTA1LDcgQEAgc3RhdGljIGJvb2wgaXNfc2VtaXBsYW5hcl91dl9wbGFuZShjb25zdCBz
dHJ1Y3QgZHJtX2ZyYW1lYnVmZmVyICpmYiwKIAkgICAgICAgY29sb3JfcGxhbmUgPT0gMTsKIH0K
IAotc3RhdGljIHVuc2lnbmVkIGludAordW5zaWduZWQgaW50CiBpbnRlbF90aWxlX3dpZHRoX2J5
dGVzKGNvbnN0IHN0cnVjdCBkcm1fZnJhbWVidWZmZXIgKmZiLCBpbnQgY29sb3JfcGxhbmUpCiB7
CiAJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShmYi0+ZGV2KTsK
QEAgLTEyMTcsNyArMTE1OSw3IEBAIGludGVsX3RpbGVfd2lkdGhfYnl0ZXMoY29uc3Qgc3RydWN0
IGRybV9mcmFtZWJ1ZmZlciAqZmIsIGludCBjb2xvcl9wbGFuZSkKIAl9CiB9CiAKLXN0YXRpYyB1
bnNpZ25lZCBpbnQKK3Vuc2lnbmVkIGludAogaW50ZWxfdGlsZV9oZWlnaHQoY29uc3Qgc3RydWN0
IGRybV9mcmFtZWJ1ZmZlciAqZmIsIGludCBjb2xvcl9wbGFuZSkKIHsKIAlpZiAoaXNfZ2VuMTJf
Y2NzX3BsYW5lKGZiLCBjb2xvcl9wbGFuZSkpCkBAIC0xMzIyLDggKzEyNjQsOCBAQCBzdGF0aWMg
Ym9vbCBoYXNfYXN5bmNfZmxpcHMoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpCiAJcmV0
dXJuIElOVEVMX0dFTihpOTE1KSA+PSA1OwogfQogCi1zdGF0aWMgdW5zaWduZWQgaW50IGludGVs
X3N1cmZfYWxpZ25tZW50KGNvbnN0IHN0cnVjdCBkcm1fZnJhbWVidWZmZXIgKmZiLAotCQkJCQkg
aW50IGNvbG9yX3BsYW5lKQordW5zaWduZWQgaW50IGludGVsX3N1cmZfYWxpZ25tZW50KGNvbnN0
IHN0cnVjdCBkcm1fZnJhbWVidWZmZXIgKmZiLAorCQkJCSAgaW50IGNvbG9yX3BsYW5lKQogewog
CXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoZmItPmRldik7CiAK
QEAgLTE1OTAsMTAgKzE1MzIsMTAgQEAgc3RhdGljIHUzMiBpbnRlbF9hZGp1c3RfYWxpZ25lZF9v
ZmZzZXQoaW50ICp4LCBpbnQgKnksCiAgKiBBZGp1c3QgdGhlIHRpbGUgb2Zmc2V0IGJ5IG1vdmlu
ZyB0aGUgZGlmZmVyZW5jZSBpbnRvCiAgKiB0aGUgeC95IG9mZnNldHMuCiAgKi8KLXN0YXRpYyB1
MzIgaW50ZWxfcGxhbmVfYWRqdXN0X2FsaWduZWRfb2Zmc2V0KGludCAqeCwgaW50ICp5LAotCQkJ
CQkgICAgIGNvbnN0IHN0cnVjdCBpbnRlbF9wbGFuZV9zdGF0ZSAqc3RhdGUsCi0JCQkJCSAgICAg
aW50IGNvbG9yX3BsYW5lLAotCQkJCQkgICAgIHUzMiBvbGRfb2Zmc2V0LCB1MzIgbmV3X29mZnNl
dCkKK3UzMiBpbnRlbF9wbGFuZV9hZGp1c3RfYWxpZ25lZF9vZmZzZXQoaW50ICp4LCBpbnQgKnks
CisJCQkJICAgICAgY29uc3Qgc3RydWN0IGludGVsX3BsYW5lX3N0YXRlICpzdGF0ZSwKKwkJCQkg
ICAgICBpbnQgY29sb3JfcGxhbmUsCisJCQkJICAgICAgdTMyIG9sZF9vZmZzZXQsIHUzMiBuZXdf
b2Zmc2V0KQogewogCXJldHVybiBpbnRlbF9hZGp1c3RfYWxpZ25lZF9vZmZzZXQoeCwgeSwgc3Rh
dGUtPmh3LmZiLCBjb2xvcl9wbGFuZSwKIAkJCQkJICAgc3RhdGUtPmh3LnJvdGF0aW9uLApAQCAt
MTg5Miw3ICsxODM0LDcgQEAgYm9vbCBpc19jY3NfbW9kaWZpZXIodTY0IG1vZGlmaWVyKQogCiBz
dGF0aWMgaW50IGdlbjEyX2Njc19hdXhfc3RyaWRlKHN0cnVjdCBkcm1fZnJhbWVidWZmZXIgKmZi
LCBpbnQgY2NzX3BsYW5lKQogewotCXJldHVybiBESVZfUk9VTkRfVVAoZmItPnBpdGNoZXNbY2Nz
X3RvX21haW5fcGxhbmUoZmIsIGNjc19wbGFuZSldLAorCXJldHVybiBESVZfUk9VTkRfVVAoZmIt
PnBpdGNoZXNbc2tsX2Njc190b19tYWluX3BsYW5lKGZiLCBjY3NfcGxhbmUpXSwKIAkJCSAgICA1
MTIpICogNjQ7CiB9CiAKQEAgLTIwNTAsNyArMTk5Miw3IEBAIHN0YXRpYyBib29sIGludGVsX3Bs
YW5lX25lZWRzX3JlbWFwKGNvbnN0IHN0cnVjdCBpbnRlbF9wbGFuZV9zdGF0ZSAqcGxhbmVfc3Rh
dGUpCiAJcmV0dXJuIHN0cmlkZSA+IG1heF9zdHJpZGU7CiB9CiAKLXN0YXRpYyB2b2lkCit2b2lk
CiBpbnRlbF9mYl9wbGFuZV9nZXRfc3Vic2FtcGxpbmcoaW50ICpoc3ViLCBpbnQgKnZzdWIsCiAJ
CQkgICAgICAgY29uc3Qgc3RydWN0IGRybV9mcmFtZWJ1ZmZlciAqZmIsCiAJCQkgICAgICAgaW50
IGNvbG9yX3BsYW5lKQpAQCAtMjA3NSw3ICsyMDE3LDcgQEAgaW50ZWxfZmJfcGxhbmVfZ2V0X3N1
YnNhbXBsaW5nKGludCAqaHN1YiwgaW50ICp2c3ViLAogCQlyZXR1cm47CiAJfQogCi0JbWFpbl9w
bGFuZSA9IGNjc190b19tYWluX3BsYW5lKGZiLCBjb2xvcl9wbGFuZSk7CisJbWFpbl9wbGFuZSA9
IHNrbF9jY3NfdG9fbWFpbl9wbGFuZShmYiwgY29sb3JfcGxhbmUpOwogCSpoc3ViID0gZHJtX2Zv
cm1hdF9pbmZvX2Jsb2NrX3dpZHRoKGZiLT5mb3JtYXQsIGNvbG9yX3BsYW5lKSAvCiAJCWRybV9m
b3JtYXRfaW5mb19ibG9ja193aWR0aChmYi0+Zm9ybWF0LCBtYWluX3BsYW5lKTsKIApAQCAtMjEx
NSw3ICsyMDU3LDcgQEAgaW50ZWxfZmJfY2hlY2tfY2NzX3h5KHN0cnVjdCBkcm1fZnJhbWVidWZm
ZXIgKmZiLCBpbnQgY2NzX3BsYW5lLCBpbnQgeCwgaW50IHkpCiAJY2NzX3ggPSAoeCAqIGhzdWIp
ICUgdGlsZV93aWR0aDsKIAljY3NfeSA9ICh5ICogdnN1YikgJSB0aWxlX2hlaWdodDsKIAotCW1h
aW5fcGxhbmUgPSBjY3NfdG9fbWFpbl9wbGFuZShmYiwgY2NzX3BsYW5lKTsKKwltYWluX3BsYW5l
ID0gc2tsX2Njc190b19tYWluX3BsYW5lKGZiLCBjY3NfcGxhbmUpOwogCW1haW5feCA9IGludGVs
X2ZiLT5ub3JtYWxbbWFpbl9wbGFuZV0ueCAlIHRpbGVfd2lkdGg7CiAJbWFpbl95ID0gaW50ZWxf
ZmItPm5vcm1hbFttYWluX3BsYW5lXS55ICUgdGlsZV9oZWlnaHQ7CiAKQEAgLTIxNDEsNyArMjA4
Myw3IEBAIHN0YXRpYyB2b2lkCiBpbnRlbF9mYl9wbGFuZV9kaW1zKGludCAqdywgaW50ICpoLCBz
dHJ1Y3QgZHJtX2ZyYW1lYnVmZmVyICpmYiwgaW50IGNvbG9yX3BsYW5lKQogewogCWludCBtYWlu
X3BsYW5lID0gaXNfY2NzX3BsYW5lKGZiLCBjb2xvcl9wbGFuZSkgPwotCQkJIGNjc190b19tYWlu
X3BsYW5lKGZiLCBjb2xvcl9wbGFuZSkgOiAwOworCQkJIHNrbF9jY3NfdG9fbWFpbl9wbGFuZShm
YiwgY29sb3JfcGxhbmUpIDogMDsKIAlpbnQgbWFpbl9oc3ViLCBtYWluX3ZzdWI7CiAJaW50IGhz
dWIsIHZzdWI7CiAKQEAgLTI1MjgsNzMgKzI0NzAsNiBAQCBzdGF0aWMgaW50IGk5eHhfZm9ybWF0
X3RvX2ZvdXJjYyhpbnQgZm9ybWF0KQogCX0KIH0KIAotaW50IHNrbF9mb3JtYXRfdG9fZm91cmNj
KGludCBmb3JtYXQsIGJvb2wgcmdiX29yZGVyLCBib29sIGFscGhhKQotewotCXN3aXRjaCAoZm9y
bWF0KSB7Ci0JY2FzZSBQTEFORV9DVExfRk9STUFUX1JHQl81NjU6Ci0JCXJldHVybiBEUk1fRk9S
TUFUX1JHQjU2NTsKLQljYXNlIFBMQU5FX0NUTF9GT1JNQVRfTlYxMjoKLQkJcmV0dXJuIERSTV9G
T1JNQVRfTlYxMjsKLQljYXNlIFBMQU5FX0NUTF9GT1JNQVRfWFlVVjoKLQkJcmV0dXJuIERSTV9G
T1JNQVRfWFlVVjg4ODg7Ci0JY2FzZSBQTEFORV9DVExfRk9STUFUX1AwMTA6Ci0JCXJldHVybiBE
Uk1fRk9STUFUX1AwMTA7Ci0JY2FzZSBQTEFORV9DVExfRk9STUFUX1AwMTI6Ci0JCXJldHVybiBE
Uk1fRk9STUFUX1AwMTI7Ci0JY2FzZSBQTEFORV9DVExfRk9STUFUX1AwMTY6Ci0JCXJldHVybiBE
Uk1fRk9STUFUX1AwMTY7Ci0JY2FzZSBQTEFORV9DVExfRk9STUFUX1kyMTA6Ci0JCXJldHVybiBE
Uk1fRk9STUFUX1kyMTA7Ci0JY2FzZSBQTEFORV9DVExfRk9STUFUX1kyMTI6Ci0JCXJldHVybiBE
Uk1fRk9STUFUX1kyMTI7Ci0JY2FzZSBQTEFORV9DVExfRk9STUFUX1kyMTY6Ci0JCXJldHVybiBE
Uk1fRk9STUFUX1kyMTY7Ci0JY2FzZSBQTEFORV9DVExfRk9STUFUX1k0MTA6Ci0JCXJldHVybiBE
Uk1fRk9STUFUX1hWWVUyMTAxMDEwOwotCWNhc2UgUExBTkVfQ1RMX0ZPUk1BVF9ZNDEyOgotCQly
ZXR1cm4gRFJNX0ZPUk1BVF9YVllVMTJfMTYxNjE2MTY7Ci0JY2FzZSBQTEFORV9DVExfRk9STUFU
X1k0MTY6Ci0JCXJldHVybiBEUk1fRk9STUFUX1hWWVUxNjE2MTYxNjsKLQlkZWZhdWx0OgotCWNh
c2UgUExBTkVfQ1RMX0ZPUk1BVF9YUkdCXzg4ODg6Ci0JCWlmIChyZ2Jfb3JkZXIpIHsKLQkJCWlm
IChhbHBoYSkKLQkJCQlyZXR1cm4gRFJNX0ZPUk1BVF9BQkdSODg4ODsKLQkJCWVsc2UKLQkJCQly
ZXR1cm4gRFJNX0ZPUk1BVF9YQkdSODg4ODsKLQkJfSBlbHNlIHsKLQkJCWlmIChhbHBoYSkKLQkJ
CQlyZXR1cm4gRFJNX0ZPUk1BVF9BUkdCODg4ODsKLQkJCWVsc2UKLQkJCQlyZXR1cm4gRFJNX0ZP
Uk1BVF9YUkdCODg4ODsKLQkJfQotCWNhc2UgUExBTkVfQ1RMX0ZPUk1BVF9YUkdCXzIxMDEwMTA6
Ci0JCWlmIChyZ2Jfb3JkZXIpIHsKLQkJCWlmIChhbHBoYSkKLQkJCQlyZXR1cm4gRFJNX0ZPUk1B
VF9BQkdSMjEwMTAxMDsKLQkJCWVsc2UKLQkJCQlyZXR1cm4gRFJNX0ZPUk1BVF9YQkdSMjEwMTAx
MDsKLQkJfSBlbHNlIHsKLQkJCWlmIChhbHBoYSkKLQkJCQlyZXR1cm4gRFJNX0ZPUk1BVF9BUkdC
MjEwMTAxMDsKLQkJCWVsc2UKLQkJCQlyZXR1cm4gRFJNX0ZPUk1BVF9YUkdCMjEwMTAxMDsKLQkJ
fQotCWNhc2UgUExBTkVfQ1RMX0ZPUk1BVF9YUkdCXzE2MTYxNjE2RjoKLQkJaWYgKHJnYl9vcmRl
cikgewotCQkJaWYgKGFscGhhKQotCQkJCXJldHVybiBEUk1fRk9STUFUX0FCR1IxNjE2MTYxNkY7
Ci0JCQllbHNlCi0JCQkJcmV0dXJuIERSTV9GT1JNQVRfWEJHUjE2MTYxNjE2RjsKLQkJfSBlbHNl
IHsKLQkJCWlmIChhbHBoYSkKLQkJCQlyZXR1cm4gRFJNX0ZPUk1BVF9BUkdCMTYxNjE2MTZGOwot
CQkJZWxzZQotCQkJCXJldHVybiBEUk1fRk9STUFUX1hSR0IxNjE2MTYxNkY7Ci0JCX0KLQl9Ci19
Ci0KIHN0YXRpYyBzdHJ1Y3QgaTkxNV92bWEgKgogaW5pdGlhbF9wbGFuZV92bWEoc3RydWN0IGRy
bV9pOTE1X3ByaXZhdGUgKmk5MTUsCiAJCSAgc3RydWN0IGludGVsX2luaXRpYWxfcGxhbmVfY29u
ZmlnICpwbGFuZV9jb25maWcpCkBAIC0yODk5LDM2NyArMjc3NCw2IEBAIGludGVsX2ZpbmRfaW5p
dGlhbF9wbGFuZV9vYmooc3RydWN0IGludGVsX2NydGMgKmludGVsX2NydGMsCiAJCSAgJnRvX2lu
dGVsX2Zyb250YnVmZmVyKGZiKS0+Yml0cyk7CiB9CiAKLQotc3RhdGljIGJvb2wKLXNrbF9jaGVj
a19tYWluX2Njc19jb29yZGluYXRlcyhzdHJ1Y3QgaW50ZWxfcGxhbmVfc3RhdGUgKnBsYW5lX3N0
YXRlLAotCQkJICAgICAgIGludCBtYWluX3gsIGludCBtYWluX3ksIHUzMiBtYWluX29mZnNldCwK
LQkJCSAgICAgICBpbnQgY2NzX3BsYW5lKQotewotCWNvbnN0IHN0cnVjdCBkcm1fZnJhbWVidWZm
ZXIgKmZiID0gcGxhbmVfc3RhdGUtPmh3LmZiOwotCWludCBhdXhfeCA9IHBsYW5lX3N0YXRlLT5j
b2xvcl9wbGFuZVtjY3NfcGxhbmVdLng7Ci0JaW50IGF1eF95ID0gcGxhbmVfc3RhdGUtPmNvbG9y
X3BsYW5lW2Njc19wbGFuZV0ueTsKLQl1MzIgYXV4X29mZnNldCA9IHBsYW5lX3N0YXRlLT5jb2xv
cl9wbGFuZVtjY3NfcGxhbmVdLm9mZnNldDsKLQl1MzIgYWxpZ25tZW50ID0gaW50ZWxfc3VyZl9h
bGlnbm1lbnQoZmIsIGNjc19wbGFuZSk7Ci0JaW50IGhzdWI7Ci0JaW50IHZzdWI7Ci0KLQlpbnRl
bF9mYl9wbGFuZV9nZXRfc3Vic2FtcGxpbmcoJmhzdWIsICZ2c3ViLCBmYiwgY2NzX3BsYW5lKTsK
LQl3aGlsZSAoYXV4X29mZnNldCA+PSBtYWluX29mZnNldCAmJiBhdXhfeSA8PSBtYWluX3kpIHsK
LQkJaW50IHgsIHk7Ci0KLQkJaWYgKGF1eF94ID09IG1haW5feCAmJiBhdXhfeSA9PSBtYWluX3kp
Ci0JCQlicmVhazsKLQotCQlpZiAoYXV4X29mZnNldCA9PSAwKQotCQkJYnJlYWs7Ci0KLQkJeCA9
IGF1eF94IC8gaHN1YjsKLQkJeSA9IGF1eF95IC8gdnN1YjsKLQkJYXV4X29mZnNldCA9IGludGVs
X3BsYW5lX2FkanVzdF9hbGlnbmVkX29mZnNldCgmeCwgJnksCi0JCQkJCQkJICAgICAgIHBsYW5l
X3N0YXRlLAotCQkJCQkJCSAgICAgICBjY3NfcGxhbmUsCi0JCQkJCQkJICAgICAgIGF1eF9vZmZz
ZXQsCi0JCQkJCQkJICAgICAgIGF1eF9vZmZzZXQgLQotCQkJCQkJCQlhbGlnbm1lbnQpOwotCQlh
dXhfeCA9IHggKiBoc3ViICsgYXV4X3ggJSBoc3ViOwotCQlhdXhfeSA9IHkgKiB2c3ViICsgYXV4
X3kgJSB2c3ViOwotCX0KLQotCWlmIChhdXhfeCAhPSBtYWluX3ggfHwgYXV4X3kgIT0gbWFpbl95
KQotCQlyZXR1cm4gZmFsc2U7Ci0KLQlwbGFuZV9zdGF0ZS0+Y29sb3JfcGxhbmVbY2NzX3BsYW5l
XS5vZmZzZXQgPSBhdXhfb2Zmc2V0OwotCXBsYW5lX3N0YXRlLT5jb2xvcl9wbGFuZVtjY3NfcGxh
bmVdLnggPSBhdXhfeDsKLQlwbGFuZV9zdGF0ZS0+Y29sb3JfcGxhbmVbY2NzX3BsYW5lXS55ID0g
YXV4X3k7Ci0KLQlyZXR1cm4gdHJ1ZTsKLX0KLQotdW5zaWduZWQgaW50Ci1pbnRlbF9wbGFuZV9m
ZW5jZV95X29mZnNldChjb25zdCBzdHJ1Y3QgaW50ZWxfcGxhbmVfc3RhdGUgKnBsYW5lX3N0YXRl
KQotewotCWludCB4ID0gMCwgeSA9IDA7Ci0KLQlpbnRlbF9wbGFuZV9hZGp1c3RfYWxpZ25lZF9v
ZmZzZXQoJngsICZ5LCBwbGFuZV9zdGF0ZSwgMCwKLQkJCQkJICBwbGFuZV9zdGF0ZS0+Y29sb3Jf
cGxhbmVbMF0ub2Zmc2V0LCAwKTsKLQotCXJldHVybiB5OwotfQotCi1zdGF0aWMgaW50IGludGVs
X3BsYW5lX21pbl93aWR0aChzdHJ1Y3QgaW50ZWxfcGxhbmUgKnBsYW5lLAotCQkJCSBjb25zdCBz
dHJ1Y3QgZHJtX2ZyYW1lYnVmZmVyICpmYiwKLQkJCQkgaW50IGNvbG9yX3BsYW5lLAotCQkJCSB1
bnNpZ25lZCBpbnQgcm90YXRpb24pCi17Ci0JaWYgKHBsYW5lLT5taW5fd2lkdGgpCi0JCXJldHVy
biBwbGFuZS0+bWluX3dpZHRoKGZiLCBjb2xvcl9wbGFuZSwgcm90YXRpb24pOwotCWVsc2UKLQkJ
cmV0dXJuIDE7Ci19Ci0KLXN0YXRpYyBpbnQgaW50ZWxfcGxhbmVfbWF4X3dpZHRoKHN0cnVjdCBp
bnRlbF9wbGFuZSAqcGxhbmUsCi0JCQkJIGNvbnN0IHN0cnVjdCBkcm1fZnJhbWVidWZmZXIgKmZi
LAotCQkJCSBpbnQgY29sb3JfcGxhbmUsCi0JCQkJIHVuc2lnbmVkIGludCByb3RhdGlvbikKLXsK
LQlpZiAocGxhbmUtPm1heF93aWR0aCkKLQkJcmV0dXJuIHBsYW5lLT5tYXhfd2lkdGgoZmIsIGNv
bG9yX3BsYW5lLCByb3RhdGlvbik7Ci0JZWxzZQotCQlyZXR1cm4gSU5UX01BWDsKLX0KLQotc3Rh
dGljIGludCBpbnRlbF9wbGFuZV9tYXhfaGVpZ2h0KHN0cnVjdCBpbnRlbF9wbGFuZSAqcGxhbmUs
Ci0JCQkJICBjb25zdCBzdHJ1Y3QgZHJtX2ZyYW1lYnVmZmVyICpmYiwKLQkJCQkgIGludCBjb2xv
cl9wbGFuZSwKLQkJCQkgIHVuc2lnbmVkIGludCByb3RhdGlvbikKLXsKLQlpZiAocGxhbmUtPm1h
eF9oZWlnaHQpCi0JCXJldHVybiBwbGFuZS0+bWF4X2hlaWdodChmYiwgY29sb3JfcGxhbmUsIHJv
dGF0aW9uKTsKLQllbHNlCi0JCXJldHVybiBJTlRfTUFYOwotfQotCi1pbnQgc2tsX2NhbGNfbWFp
bl9zdXJmYWNlX29mZnNldChjb25zdCBzdHJ1Y3QgaW50ZWxfcGxhbmVfc3RhdGUgKnBsYW5lX3N0
YXRlLAotCQkJCSBpbnQgKngsIGludCAqeSwgdTMyICpvZmZzZXQpCi17Ci0Jc3RydWN0IGludGVs
X3BsYW5lICpwbGFuZSA9IHRvX2ludGVsX3BsYW5lKHBsYW5lX3N0YXRlLT51YXBpLnBsYW5lKTsK
LQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KHBsYW5lLT5iYXNl
LmRldik7Ci0JY29uc3Qgc3RydWN0IGRybV9mcmFtZWJ1ZmZlciAqZmIgPSBwbGFuZV9zdGF0ZS0+
aHcuZmI7Ci0JY29uc3QgaW50IGF1eF9wbGFuZSA9IGludGVsX21haW5fdG9fYXV4X3BsYW5lKGZi
LCAwKTsKLQljb25zdCB1MzIgYXV4X29mZnNldCA9IHBsYW5lX3N0YXRlLT5jb2xvcl9wbGFuZVth
dXhfcGxhbmVdLm9mZnNldDsKLQljb25zdCB1MzIgYWxpZ25tZW50ID0gaW50ZWxfc3VyZl9hbGln
bm1lbnQoZmIsIDApOwotCWNvbnN0IGludCB3ID0gZHJtX3JlY3Rfd2lkdGgoJnBsYW5lX3N0YXRl
LT51YXBpLnNyYykgPj4gMTY7Ci0KLQlpbnRlbF9hZGRfZmJfb2Zmc2V0cyh4LCB5LCBwbGFuZV9z
dGF0ZSwgMCk7Ci0JKm9mZnNldCA9IGludGVsX3BsYW5lX2NvbXB1dGVfYWxpZ25lZF9vZmZzZXQo
eCwgeSwgcGxhbmVfc3RhdGUsIDApOwotCWlmIChkcm1fV0FSTl9PTigmZGV2X3ByaXYtPmRybSwg
YWxpZ25tZW50ICYmICFpc19wb3dlcl9vZl8yKGFsaWdubWVudCkpKQotCQlyZXR1cm4gLUVJTlZB
TDsKLQotCS8qCi0JICogQVVYIHN1cmZhY2Ugb2Zmc2V0IGlzIHNwZWNpZmllZCBhcyB0aGUgZGlz
dGFuY2UgZnJvbSB0aGUKLQkgKiBtYWluIHN1cmZhY2Ugb2Zmc2V0LCBhbmQgaXQgbXVzdCBiZSBu
b24tbmVnYXRpdmUuIE1ha2UKLQkgKiBzdXJlIHRoYXQgaXMgd2hhdCB3ZSB3aWxsIGdldC4KLQkg
Ki8KLQlpZiAoYXV4X3BsYW5lICYmICpvZmZzZXQgPiBhdXhfb2Zmc2V0KQotCQkqb2Zmc2V0ID0g
aW50ZWxfcGxhbmVfYWRqdXN0X2FsaWduZWRfb2Zmc2V0KHgsIHksIHBsYW5lX3N0YXRlLCAwLAot
CQkJCQkJCSAgICAqb2Zmc2V0LAotCQkJCQkJCSAgICBhdXhfb2Zmc2V0ICYgfihhbGlnbm1lbnQg
LSAxKSk7Ci0KLQkvKgotCSAqIFdoZW4gdXNpbmcgYW4gWC10aWxlZCBzdXJmYWNlLCB0aGUgcGxh
bmUgYmxvd3MgdXAKLQkgKiBpZiB0aGUgeCBvZmZzZXQgKyB3aWR0aCBleGNlZWQgdGhlIHN0cmlk
ZS4KLQkgKgotCSAqIFRPRE86IGxpbmVhciBhbmQgWS10aWxlZCBzZWVtIGZpbmUsIFlmIHVudGVz
dGVkLAotCSAqLwotCWlmIChmYi0+bW9kaWZpZXIgPT0gSTkxNV9GT1JNQVRfTU9EX1hfVElMRUQp
IHsKLQkJaW50IGNwcCA9IGZiLT5mb3JtYXQtPmNwcFswXTsKLQotCQl3aGlsZSAoKCp4ICsgdykg
KiBjcHAgPiBwbGFuZV9zdGF0ZS0+Y29sb3JfcGxhbmVbMF0uc3RyaWRlKSB7Ci0JCQlpZiAoKm9m
ZnNldCA9PSAwKSB7Ci0JCQkJZHJtX2RiZ19rbXMoJmRldl9wcml2LT5kcm0sCi0JCQkJCSAgICAi
VW5hYmxlIHRvIGZpbmQgc3VpdGFibGUgZGlzcGxheSBzdXJmYWNlIG9mZnNldCBkdWUgdG8gWC10
aWxpbmdcbiIpOwotCQkJCXJldHVybiAtRUlOVkFMOwotCQkJfQotCi0JCQkqb2Zmc2V0ID0gaW50
ZWxfcGxhbmVfYWRqdXN0X2FsaWduZWRfb2Zmc2V0KHgsIHksIHBsYW5lX3N0YXRlLCAwLAotCQkJ
CQkJCQkgICAgKm9mZnNldCwKLQkJCQkJCQkJICAgICpvZmZzZXQgLSBhbGlnbm1lbnQpOwotCQl9
Ci0JfQotCi0JcmV0dXJuIDA7Ci19Ci0KLXN0YXRpYyBpbnQgc2tsX2NoZWNrX21haW5fc3VyZmFj
ZShzdHJ1Y3QgaW50ZWxfcGxhbmVfc3RhdGUgKnBsYW5lX3N0YXRlKQotewotCXN0cnVjdCBpbnRl
bF9wbGFuZSAqcGxhbmUgPSB0b19pbnRlbF9wbGFuZShwbGFuZV9zdGF0ZS0+dWFwaS5wbGFuZSk7
Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShwbGFuZS0+YmFz
ZS5kZXYpOwotCWNvbnN0IHN0cnVjdCBkcm1fZnJhbWVidWZmZXIgKmZiID0gcGxhbmVfc3RhdGUt
Pmh3LmZiOwotCWNvbnN0IHVuc2lnbmVkIGludCByb3RhdGlvbiA9IHBsYW5lX3N0YXRlLT5ody5y
b3RhdGlvbjsKLQlpbnQgeCA9IHBsYW5lX3N0YXRlLT51YXBpLnNyYy54MSA+PiAxNjsKLQlpbnQg
eSA9IHBsYW5lX3N0YXRlLT51YXBpLnNyYy55MSA+PiAxNjsKLQljb25zdCBpbnQgdyA9IGRybV9y
ZWN0X3dpZHRoKCZwbGFuZV9zdGF0ZS0+dWFwaS5zcmMpID4+IDE2OwotCWNvbnN0IGludCBoID0g
ZHJtX3JlY3RfaGVpZ2h0KCZwbGFuZV9zdGF0ZS0+dWFwaS5zcmMpID4+IDE2OwotCWNvbnN0IGlu
dCBtaW5fd2lkdGggPSBpbnRlbF9wbGFuZV9taW5fd2lkdGgocGxhbmUsIGZiLCAwLCByb3RhdGlv
bik7Ci0JY29uc3QgaW50IG1heF93aWR0aCA9IGludGVsX3BsYW5lX21heF93aWR0aChwbGFuZSwg
ZmIsIDAsIHJvdGF0aW9uKTsKLQljb25zdCBpbnQgbWF4X2hlaWdodCA9IGludGVsX3BsYW5lX21h
eF9oZWlnaHQocGxhbmUsIGZiLCAwLCByb3RhdGlvbik7Ci0JY29uc3QgaW50IGF1eF9wbGFuZSA9
IGludGVsX21haW5fdG9fYXV4X3BsYW5lKGZiLCAwKTsKLQljb25zdCB1MzIgYWxpZ25tZW50ID0g
aW50ZWxfc3VyZl9hbGlnbm1lbnQoZmIsIDApOwotCXUzMiBvZmZzZXQ7Ci0JaW50IHJldDsKLQot
CWlmICh3ID4gbWF4X3dpZHRoIHx8IHcgPCBtaW5fd2lkdGggfHwgaCA+IG1heF9oZWlnaHQpIHsK
LQkJZHJtX2RiZ19rbXMoJmRldl9wcml2LT5kcm0sCi0JCQkgICAgInJlcXVlc3RlZCBZL1JHQiBz
b3VyY2Ugc2l6ZSAlZHglZCBvdXRzaWRlIGxpbWl0cyAobWluOiAlZHgxIG1heDogJWR4JWQpXG4i
LAotCQkJICAgIHcsIGgsIG1pbl93aWR0aCwgbWF4X3dpZHRoLCBtYXhfaGVpZ2h0KTsKLQkJcmV0
dXJuIC1FSU5WQUw7Ci0JfQotCi0JcmV0ID0gc2tsX2NhbGNfbWFpbl9zdXJmYWNlX29mZnNldChw
bGFuZV9zdGF0ZSwgJngsICZ5LCAmb2Zmc2V0KTsKLQlpZiAocmV0KQotCQlyZXR1cm4gcmV0Owot
Ci0JLyoKLQkgKiBDQ1MgQVVYIHN1cmZhY2UgZG9lc24ndCBoYXZlIGl0cyBvd24geC95IG9mZnNl
dHMsIHdlIG11c3QgbWFrZSBzdXJlCi0JICogdGhleSBtYXRjaCB3aXRoIHRoZSBtYWluIHN1cmZh
Y2UgeC95IG9mZnNldHMuCi0JICovCi0JaWYgKGlzX2Njc19tb2RpZmllcihmYi0+bW9kaWZpZXIp
KSB7Ci0JCXdoaWxlICghc2tsX2NoZWNrX21haW5fY2NzX2Nvb3JkaW5hdGVzKHBsYW5lX3N0YXRl
LCB4LCB5LAotCQkJCQkJICAgICAgIG9mZnNldCwgYXV4X3BsYW5lKSkgewotCQkJaWYgKG9mZnNl
dCA9PSAwKQotCQkJCWJyZWFrOwotCi0JCQlvZmZzZXQgPSBpbnRlbF9wbGFuZV9hZGp1c3RfYWxp
Z25lZF9vZmZzZXQoJngsICZ5LCBwbGFuZV9zdGF0ZSwgMCwKLQkJCQkJCQkJICAgb2Zmc2V0LCBv
ZmZzZXQgLSBhbGlnbm1lbnQpOwotCQl9Ci0KLQkJaWYgKHggIT0gcGxhbmVfc3RhdGUtPmNvbG9y
X3BsYW5lW2F1eF9wbGFuZV0ueCB8fAotCQkgICAgeSAhPSBwbGFuZV9zdGF0ZS0+Y29sb3JfcGxh
bmVbYXV4X3BsYW5lXS55KSB7Ci0JCQlkcm1fZGJnX2ttcygmZGV2X3ByaXYtPmRybSwKLQkJCQkg
ICAgIlVuYWJsZSB0byBmaW5kIHN1aXRhYmxlIGRpc3BsYXkgc3VyZmFjZSBvZmZzZXQgZHVlIHRv
IENDU1xuIik7Ci0JCQlyZXR1cm4gLUVJTlZBTDsKLQkJfQotCX0KLQotCWRybV9XQVJOX09OKCZk
ZXZfcHJpdi0+ZHJtLCB4ID4gODE5MSB8fCB5ID4gODE5MSk7Ci0KLQlwbGFuZV9zdGF0ZS0+Y29s
b3JfcGxhbmVbMF0ub2Zmc2V0ID0gb2Zmc2V0OwotCXBsYW5lX3N0YXRlLT5jb2xvcl9wbGFuZVsw
XS54ID0geDsKLQlwbGFuZV9zdGF0ZS0+Y29sb3JfcGxhbmVbMF0ueSA9IHk7Ci0KLQkvKgotCSAq
IFB1dCB0aGUgZmluYWwgY29vcmRpbmF0ZXMgYmFjayBzbyB0aGF0IHRoZSBzcmMKLQkgKiBjb29y
ZGluYXRlIGNoZWNrcyB3aWxsIHNlZSB0aGUgcmlnaHQgdmFsdWVzLgotCSAqLwotCWRybV9yZWN0
X3RyYW5zbGF0ZV90bygmcGxhbmVfc3RhdGUtPnVhcGkuc3JjLAotCQkJICAgICAgeCA8PCAxNiwg
eSA8PCAxNik7Ci0KLQlyZXR1cm4gMDsKLX0KLQotc3RhdGljIGludCBza2xfY2hlY2tfbnYxMl9h
dXhfc3VyZmFjZShzdHJ1Y3QgaW50ZWxfcGxhbmVfc3RhdGUgKnBsYW5lX3N0YXRlKQotewotCXN0
cnVjdCBpbnRlbF9wbGFuZSAqcGxhbmUgPSB0b19pbnRlbF9wbGFuZShwbGFuZV9zdGF0ZS0+dWFw
aS5wbGFuZSk7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSB0b19pOTE1KHBsYW5l
LT5iYXNlLmRldik7Ci0JY29uc3Qgc3RydWN0IGRybV9mcmFtZWJ1ZmZlciAqZmIgPSBwbGFuZV9z
dGF0ZS0+aHcuZmI7Ci0JdW5zaWduZWQgaW50IHJvdGF0aW9uID0gcGxhbmVfc3RhdGUtPmh3LnJv
dGF0aW9uOwotCWludCB1dl9wbGFuZSA9IDE7Ci0JaW50IG1heF93aWR0aCA9IGludGVsX3BsYW5l
X21heF93aWR0aChwbGFuZSwgZmIsIHV2X3BsYW5lLCByb3RhdGlvbik7Ci0JaW50IG1heF9oZWln
aHQgPSBpbnRlbF9wbGFuZV9tYXhfaGVpZ2h0KHBsYW5lLCBmYiwgdXZfcGxhbmUsIHJvdGF0aW9u
KTsKLQlpbnQgeCA9IHBsYW5lX3N0YXRlLT51YXBpLnNyYy54MSA+PiAxNzsKLQlpbnQgeSA9IHBs
YW5lX3N0YXRlLT51YXBpLnNyYy55MSA+PiAxNzsKLQlpbnQgdyA9IGRybV9yZWN0X3dpZHRoKCZw
bGFuZV9zdGF0ZS0+dWFwaS5zcmMpID4+IDE3OwotCWludCBoID0gZHJtX3JlY3RfaGVpZ2h0KCZw
bGFuZV9zdGF0ZS0+dWFwaS5zcmMpID4+IDE3OwotCXUzMiBvZmZzZXQ7Ci0KLQkvKiBGSVhNRSBu
b3QgcXVpdGUgc3VyZSBob3cvaWYgdGhlc2UgYXBwbHkgdG8gdGhlIGNocm9tYSBwbGFuZSAqLwot
CWlmICh3ID4gbWF4X3dpZHRoIHx8IGggPiBtYXhfaGVpZ2h0KSB7Ci0JCWRybV9kYmdfa21zKCZp
OTE1LT5kcm0sCi0JCQkgICAgIkNiQ3Igc291cmNlIHNpemUgJWR4JWQgdG9vIGJpZyAobGltaXQg
JWR4JWQpXG4iLAotCQkJICAgIHcsIGgsIG1heF93aWR0aCwgbWF4X2hlaWdodCk7Ci0JCXJldHVy
biAtRUlOVkFMOwotCX0KLQotCWludGVsX2FkZF9mYl9vZmZzZXRzKCZ4LCAmeSwgcGxhbmVfc3Rh
dGUsIHV2X3BsYW5lKTsKLQlvZmZzZXQgPSBpbnRlbF9wbGFuZV9jb21wdXRlX2FsaWduZWRfb2Zm
c2V0KCZ4LCAmeSwKLQkJCQkJCSAgICBwbGFuZV9zdGF0ZSwgdXZfcGxhbmUpOwotCi0JaWYgKGlz
X2Njc19tb2RpZmllcihmYi0+bW9kaWZpZXIpKSB7Ci0JCWludCBjY3NfcGxhbmUgPSBtYWluX3Rv
X2Njc19wbGFuZShmYiwgdXZfcGxhbmUpOwotCQl1MzIgYXV4X29mZnNldCA9IHBsYW5lX3N0YXRl
LT5jb2xvcl9wbGFuZVtjY3NfcGxhbmVdLm9mZnNldDsKLQkJdTMyIGFsaWdubWVudCA9IGludGVs
X3N1cmZfYWxpZ25tZW50KGZiLCB1dl9wbGFuZSk7Ci0KLQkJaWYgKG9mZnNldCA+IGF1eF9vZmZz
ZXQpCi0JCQlvZmZzZXQgPSBpbnRlbF9wbGFuZV9hZGp1c3RfYWxpZ25lZF9vZmZzZXQoJngsICZ5
LAotCQkJCQkJCQkgICBwbGFuZV9zdGF0ZSwKLQkJCQkJCQkJICAgdXZfcGxhbmUsCi0JCQkJCQkJ
CSAgIG9mZnNldCwKLQkJCQkJCQkJICAgYXV4X29mZnNldCAmIH4oYWxpZ25tZW50IC0gMSkpOwot
Ci0JCXdoaWxlICghc2tsX2NoZWNrX21haW5fY2NzX2Nvb3JkaW5hdGVzKHBsYW5lX3N0YXRlLCB4
LCB5LAotCQkJCQkJICAgICAgIG9mZnNldCwgY2NzX3BsYW5lKSkgewotCQkJaWYgKG9mZnNldCA9
PSAwKQotCQkJCWJyZWFrOwotCi0JCQlvZmZzZXQgPSBpbnRlbF9wbGFuZV9hZGp1c3RfYWxpZ25l
ZF9vZmZzZXQoJngsICZ5LAotCQkJCQkJCQkgICBwbGFuZV9zdGF0ZSwKLQkJCQkJCQkJICAgdXZf
cGxhbmUsCi0JCQkJCQkJCSAgIG9mZnNldCwgb2Zmc2V0IC0gYWxpZ25tZW50KTsKLQkJfQotCi0J
CWlmICh4ICE9IHBsYW5lX3N0YXRlLT5jb2xvcl9wbGFuZVtjY3NfcGxhbmVdLnggfHwKLQkJICAg
IHkgIT0gcGxhbmVfc3RhdGUtPmNvbG9yX3BsYW5lW2Njc19wbGFuZV0ueSkgewotCQkJZHJtX2Ri
Z19rbXMoJmk5MTUtPmRybSwKLQkJCQkgICAgIlVuYWJsZSB0byBmaW5kIHN1aXRhYmxlIGRpc3Bs
YXkgc3VyZmFjZSBvZmZzZXQgZHVlIHRvIENDU1xuIik7Ci0JCQlyZXR1cm4gLUVJTlZBTDsKLQkJ
fQotCX0KLQotCWRybV9XQVJOX09OKCZpOTE1LT5kcm0sIHggPiA4MTkxIHx8IHkgPiA4MTkxKTsK
LQotCXBsYW5lX3N0YXRlLT5jb2xvcl9wbGFuZVt1dl9wbGFuZV0ub2Zmc2V0ID0gb2Zmc2V0Owot
CXBsYW5lX3N0YXRlLT5jb2xvcl9wbGFuZVt1dl9wbGFuZV0ueCA9IHg7Ci0JcGxhbmVfc3RhdGUt
PmNvbG9yX3BsYW5lW3V2X3BsYW5lXS55ID0geTsKLQotCXJldHVybiAwOwotfQotCi1zdGF0aWMg
aW50IHNrbF9jaGVja19jY3NfYXV4X3N1cmZhY2Uoc3RydWN0IGludGVsX3BsYW5lX3N0YXRlICpw
bGFuZV9zdGF0ZSkKLXsKLQljb25zdCBzdHJ1Y3QgZHJtX2ZyYW1lYnVmZmVyICpmYiA9IHBsYW5l
X3N0YXRlLT5ody5mYjsKLQlpbnQgc3JjX3ggPSBwbGFuZV9zdGF0ZS0+dWFwaS5zcmMueDEgPj4g
MTY7Ci0JaW50IHNyY195ID0gcGxhbmVfc3RhdGUtPnVhcGkuc3JjLnkxID4+IDE2OwotCXUzMiBv
ZmZzZXQ7Ci0JaW50IGNjc19wbGFuZTsKLQotCWZvciAoY2NzX3BsYW5lID0gMDsgY2NzX3BsYW5l
IDwgZmItPmZvcm1hdC0+bnVtX3BsYW5lczsgY2NzX3BsYW5lKyspIHsKLQkJaW50IG1haW5faHN1
YiwgbWFpbl92c3ViOwotCQlpbnQgaHN1YiwgdnN1YjsKLQkJaW50IHgsIHk7Ci0KLQkJaWYgKCFp
c19jY3NfcGxhbmUoZmIsIGNjc19wbGFuZSkgfHwKLQkJICAgIGlzX2dlbjEyX2Njc19jY19wbGFu
ZShmYiwgY2NzX3BsYW5lKSkKLQkJCWNvbnRpbnVlOwotCi0JCWludGVsX2ZiX3BsYW5lX2dldF9z
dWJzYW1wbGluZygmbWFpbl9oc3ViLCAmbWFpbl92c3ViLCBmYiwKLQkJCQkJICAgICAgIGNjc190
b19tYWluX3BsYW5lKGZiLCBjY3NfcGxhbmUpKTsKLQkJaW50ZWxfZmJfcGxhbmVfZ2V0X3N1YnNh
bXBsaW5nKCZoc3ViLCAmdnN1YiwgZmIsIGNjc19wbGFuZSk7Ci0KLQkJaHN1YiAqPSBtYWluX2hz
dWI7Ci0JCXZzdWIgKj0gbWFpbl92c3ViOwotCQl4ID0gc3JjX3ggLyBoc3ViOwotCQl5ID0gc3Jj
X3kgLyB2c3ViOwotCi0JCWludGVsX2FkZF9mYl9vZmZzZXRzKCZ4LCAmeSwgcGxhbmVfc3RhdGUs
IGNjc19wbGFuZSk7Ci0KLQkJb2Zmc2V0ID0gaW50ZWxfcGxhbmVfY29tcHV0ZV9hbGlnbmVkX29m
ZnNldCgmeCwgJnksCi0JCQkJCQkJICAgIHBsYW5lX3N0YXRlLAotCQkJCQkJCSAgICBjY3NfcGxh
bmUpOwotCi0JCXBsYW5lX3N0YXRlLT5jb2xvcl9wbGFuZVtjY3NfcGxhbmVdLm9mZnNldCA9IG9m
ZnNldDsKLQkJcGxhbmVfc3RhdGUtPmNvbG9yX3BsYW5lW2Njc19wbGFuZV0ueCA9ICh4ICogaHN1
YiArCi0JCQkJCQkJIHNyY194ICUgaHN1YikgLwotCQkJCQkJCW1haW5faHN1YjsKLQkJcGxhbmVf
c3RhdGUtPmNvbG9yX3BsYW5lW2Njc19wbGFuZV0ueSA9ICh5ICogdnN1YiArCi0JCQkJCQkJIHNy
Y195ICUgdnN1YikgLwotCQkJCQkJCW1haW5fdnN1YjsKLQl9Ci0KLQlyZXR1cm4gMDsKLX0KLQot
aW50IHNrbF9jaGVja19wbGFuZV9zdXJmYWNlKHN0cnVjdCBpbnRlbF9wbGFuZV9zdGF0ZSAqcGxh
bmVfc3RhdGUpCi17Ci0JY29uc3Qgc3RydWN0IGRybV9mcmFtZWJ1ZmZlciAqZmIgPSBwbGFuZV9z
dGF0ZS0+aHcuZmI7Ci0JaW50IHJldCwgaTsKLQotCXJldCA9IGludGVsX3BsYW5lX2NvbXB1dGVf
Z3R0KHBsYW5lX3N0YXRlKTsKLQlpZiAocmV0KQotCQlyZXR1cm4gcmV0OwotCi0JaWYgKCFwbGFu
ZV9zdGF0ZS0+dWFwaS52aXNpYmxlKQotCQlyZXR1cm4gMDsKLQotCS8qCi0JICogSGFuZGxlIHRo
ZSBBVVggc3VyZmFjZSBmaXJzdCBzaW5jZSB0aGUgbWFpbiBzdXJmYWNlIHNldHVwIGRlcGVuZHMg
b24KLQkgKiBpdC4KLQkgKi8KLQlpZiAoaXNfY2NzX21vZGlmaWVyKGZiLT5tb2RpZmllcikpIHsK
LQkJcmV0ID0gc2tsX2NoZWNrX2Njc19hdXhfc3VyZmFjZShwbGFuZV9zdGF0ZSk7Ci0JCWlmIChy
ZXQpCi0JCQlyZXR1cm4gcmV0OwotCX0KLQotCWlmIChpbnRlbF9mb3JtYXRfaW5mb19pc195dXZf
c2VtaXBsYW5hcihmYi0+Zm9ybWF0LAotCQkJCQkJZmItPm1vZGlmaWVyKSkgewotCQlyZXQgPSBz
a2xfY2hlY2tfbnYxMl9hdXhfc3VyZmFjZShwbGFuZV9zdGF0ZSk7Ci0JCWlmIChyZXQpCi0JCQly
ZXR1cm4gcmV0OwotCX0KLQotCWZvciAoaSA9IGZiLT5mb3JtYXQtPm51bV9wbGFuZXM7IGkgPCBB
UlJBWV9TSVpFKHBsYW5lX3N0YXRlLT5jb2xvcl9wbGFuZSk7IGkrKykgewotCQlwbGFuZV9zdGF0
ZS0+Y29sb3JfcGxhbmVbaV0ub2Zmc2V0ID0gMDsKLQkJcGxhbmVfc3RhdGUtPmNvbG9yX3BsYW5l
W2ldLnggPSAwOwotCQlwbGFuZV9zdGF0ZS0+Y29sb3JfcGxhbmVbaV0ueSA9IDA7Ci0JfQotCi0J
cmV0ID0gc2tsX2NoZWNrX21haW5fc3VyZmFjZShwbGFuZV9zdGF0ZSk7Ci0JaWYgKHJldCkKLQkJ
cmV0dXJuIHJldDsKLQotCXJldHVybiAwOwotfQotCiBzdGF0aWMgdm9pZCBza2xfZGV0YWNoX3Nj
YWxlcihzdHJ1Y3QgaW50ZWxfY3J0YyAqaW50ZWxfY3J0YywgaW50IGlkKQogewogCXN0cnVjdCBk
cm1fZGV2aWNlICpkZXYgPSBpbnRlbF9jcnRjLT5iYXNlLmRldjsKQEAgLTMyOTIsMzA1ICsyODA2
LDI0IEBAIHN0YXRpYyB2b2lkIHNrbF9kZXRhY2hfc2NhbGVycyhjb25zdCBzdHJ1Y3QgaW50ZWxf
Y3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSkKIAl9CiB9CiAKLXN0YXRpYyB1bnNpZ25lZCBpbnQgc2ts
X3BsYW5lX3N0cmlkZV9tdWx0KGNvbnN0IHN0cnVjdCBkcm1fZnJhbWVidWZmZXIgKmZiLAotCQkJ
CQkgIGludCBjb2xvcl9wbGFuZSwgdW5zaWduZWQgaW50IHJvdGF0aW9uKQotewotCS8qCi0JICog
VGhlIHN0cmlkZSBpcyBlaXRoZXIgZXhwcmVzc2VkIGFzIGEgbXVsdGlwbGUgb2YgNjQgYnl0ZXMg
Y2h1bmtzIGZvcgotCSAqIGxpbmVhciBidWZmZXJzIG9yIGluIG51bWJlciBvZiB0aWxlcyBmb3Ig
dGlsZWQgYnVmZmVycy4KLQkgKi8KLQlpZiAoaXNfc3VyZmFjZV9saW5lYXIoZmIsIGNvbG9yX3Bs
YW5lKSkKLQkJcmV0dXJuIDY0OwotCWVsc2UgaWYgKGRybV9yb3RhdGlvbl85MF9vcl8yNzAocm90
YXRpb24pKQotCQlyZXR1cm4gaW50ZWxfdGlsZV9oZWlnaHQoZmIsIGNvbG9yX3BsYW5lKTsKLQll
bHNlCi0JCXJldHVybiBpbnRlbF90aWxlX3dpZHRoX2J5dGVzKGZiLCBjb2xvcl9wbGFuZSk7Ci19
Ci0KLXUzMiBza2xfcGxhbmVfc3RyaWRlKGNvbnN0IHN0cnVjdCBpbnRlbF9wbGFuZV9zdGF0ZSAq
cGxhbmVfc3RhdGUsCi0JCSAgICAgaW50IGNvbG9yX3BsYW5lKQotewotCWNvbnN0IHN0cnVjdCBk
cm1fZnJhbWVidWZmZXIgKmZiID0gcGxhbmVfc3RhdGUtPmh3LmZiOwotCXVuc2lnbmVkIGludCBy
b3RhdGlvbiA9IHBsYW5lX3N0YXRlLT5ody5yb3RhdGlvbjsKLQl1MzIgc3RyaWRlID0gcGxhbmVf
c3RhdGUtPmNvbG9yX3BsYW5lW2NvbG9yX3BsYW5lXS5zdHJpZGU7Ci0KLQlpZiAoY29sb3JfcGxh
bmUgPj0gZmItPmZvcm1hdC0+bnVtX3BsYW5lcykKLQkJcmV0dXJuIDA7Ci0KLQlyZXR1cm4gc3Ry
aWRlIC8gc2tsX3BsYW5lX3N0cmlkZV9tdWx0KGZiLCBjb2xvcl9wbGFuZSwgcm90YXRpb24pOwot
fQotCi1zdGF0aWMgdTMyIHNrbF9wbGFuZV9jdGxfZm9ybWF0KHUzMiBwaXhlbF9mb3JtYXQpCi17
Ci0Jc3dpdGNoIChwaXhlbF9mb3JtYXQpIHsKLQljYXNlIERSTV9GT1JNQVRfQzg6Ci0JCXJldHVy
biBQTEFORV9DVExfRk9STUFUX0lOREVYRUQ7Ci0JY2FzZSBEUk1fRk9STUFUX1JHQjU2NToKLQkJ
cmV0dXJuIFBMQU5FX0NUTF9GT1JNQVRfUkdCXzU2NTsKLQljYXNlIERSTV9GT1JNQVRfWEJHUjg4
ODg6Ci0JY2FzZSBEUk1fRk9STUFUX0FCR1I4ODg4OgotCQlyZXR1cm4gUExBTkVfQ1RMX0ZPUk1B
VF9YUkdCXzg4ODggfCBQTEFORV9DVExfT1JERVJfUkdCWDsKLQljYXNlIERSTV9GT1JNQVRfWFJH
Qjg4ODg6Ci0JY2FzZSBEUk1fRk9STUFUX0FSR0I4ODg4OgotCQlyZXR1cm4gUExBTkVfQ1RMX0ZP
Uk1BVF9YUkdCXzg4ODg7Ci0JY2FzZSBEUk1fRk9STUFUX1hCR1IyMTAxMDEwOgotCWNhc2UgRFJN
X0ZPUk1BVF9BQkdSMjEwMTAxMDoKLQkJcmV0dXJuIFBMQU5FX0NUTF9GT1JNQVRfWFJHQl8yMTAx
MDEwIHwgUExBTkVfQ1RMX09SREVSX1JHQlg7Ci0JY2FzZSBEUk1fRk9STUFUX1hSR0IyMTAxMDEw
OgotCWNhc2UgRFJNX0ZPUk1BVF9BUkdCMjEwMTAxMDoKLQkJcmV0dXJuIFBMQU5FX0NUTF9GT1JN
QVRfWFJHQl8yMTAxMDEwOwotCWNhc2UgRFJNX0ZPUk1BVF9YQkdSMTYxNjE2MTZGOgotCWNhc2Ug
RFJNX0ZPUk1BVF9BQkdSMTYxNjE2MTZGOgotCQlyZXR1cm4gUExBTkVfQ1RMX0ZPUk1BVF9YUkdC
XzE2MTYxNjE2RiB8IFBMQU5FX0NUTF9PUkRFUl9SR0JYOwotCWNhc2UgRFJNX0ZPUk1BVF9YUkdC
MTYxNjE2MTZGOgotCWNhc2UgRFJNX0ZPUk1BVF9BUkdCMTYxNjE2MTZGOgotCQlyZXR1cm4gUExB
TkVfQ1RMX0ZPUk1BVF9YUkdCXzE2MTYxNjE2RjsKLQljYXNlIERSTV9GT1JNQVRfWFlVVjg4ODg6
Ci0JCXJldHVybiBQTEFORV9DVExfRk9STUFUX1hZVVY7Ci0JY2FzZSBEUk1fRk9STUFUX1lVWVY6
Ci0JCXJldHVybiBQTEFORV9DVExfRk9STUFUX1lVVjQyMiB8IFBMQU5FX0NUTF9ZVVY0MjJfWVVZ
VjsKLQljYXNlIERSTV9GT1JNQVRfWVZZVToKLQkJcmV0dXJuIFBMQU5FX0NUTF9GT1JNQVRfWVVW
NDIyIHwgUExBTkVfQ1RMX1lVVjQyMl9ZVllVOwotCWNhc2UgRFJNX0ZPUk1BVF9VWVZZOgotCQly
ZXR1cm4gUExBTkVfQ1RMX0ZPUk1BVF9ZVVY0MjIgfCBQTEFORV9DVExfWVVWNDIyX1VZVlk7Ci0J
Y2FzZSBEUk1fRk9STUFUX1ZZVVk6Ci0JCXJldHVybiBQTEFORV9DVExfRk9STUFUX1lVVjQyMiB8
IFBMQU5FX0NUTF9ZVVY0MjJfVllVWTsKLQljYXNlIERSTV9GT1JNQVRfTlYxMjoKLQkJcmV0dXJu
IFBMQU5FX0NUTF9GT1JNQVRfTlYxMjsKLQljYXNlIERSTV9GT1JNQVRfUDAxMDoKLQkJcmV0dXJu
IFBMQU5FX0NUTF9GT1JNQVRfUDAxMDsKLQljYXNlIERSTV9GT1JNQVRfUDAxMjoKLQkJcmV0dXJu
IFBMQU5FX0NUTF9GT1JNQVRfUDAxMjsKLQljYXNlIERSTV9GT1JNQVRfUDAxNjoKLQkJcmV0dXJu
IFBMQU5FX0NUTF9GT1JNQVRfUDAxNjsKLQljYXNlIERSTV9GT1JNQVRfWTIxMDoKLQkJcmV0dXJu
IFBMQU5FX0NUTF9GT1JNQVRfWTIxMDsKLQljYXNlIERSTV9GT1JNQVRfWTIxMjoKLQkJcmV0dXJu
IFBMQU5FX0NUTF9GT1JNQVRfWTIxMjsKLQljYXNlIERSTV9GT1JNQVRfWTIxNjoKLQkJcmV0dXJu
IFBMQU5FX0NUTF9GT1JNQVRfWTIxNjsKLQljYXNlIERSTV9GT1JNQVRfWFZZVTIxMDEwMTA6Ci0J
CXJldHVybiBQTEFORV9DVExfRk9STUFUX1k0MTA7Ci0JY2FzZSBEUk1fRk9STUFUX1hWWVUxMl8x
NjE2MTYxNjoKLQkJcmV0dXJuIFBMQU5FX0NUTF9GT1JNQVRfWTQxMjsKLQljYXNlIERSTV9GT1JN
QVRfWFZZVTE2MTYxNjE2OgotCQlyZXR1cm4gUExBTkVfQ1RMX0ZPUk1BVF9ZNDE2OwotCWRlZmF1
bHQ6Ci0JCU1JU1NJTkdfQ0FTRShwaXhlbF9mb3JtYXQpOwotCX0KLQotCXJldHVybiAwOwotfQot
Ci1zdGF0aWMgdTMyIHNrbF9wbGFuZV9jdGxfYWxwaGEoY29uc3Qgc3RydWN0IGludGVsX3BsYW5l
X3N0YXRlICpwbGFuZV9zdGF0ZSkKLXsKLQlpZiAoIXBsYW5lX3N0YXRlLT5ody5mYi0+Zm9ybWF0
LT5oYXNfYWxwaGEpCi0JCXJldHVybiBQTEFORV9DVExfQUxQSEFfRElTQUJMRTsKLQotCXN3aXRj
aCAocGxhbmVfc3RhdGUtPmh3LnBpeGVsX2JsZW5kX21vZGUpIHsKLQljYXNlIERSTV9NT0RFX0JM
RU5EX1BJWEVMX05PTkU6Ci0JCXJldHVybiBQTEFORV9DVExfQUxQSEFfRElTQUJMRTsKLQljYXNl
IERSTV9NT0RFX0JMRU5EX1BSRU1VTFRJOgotCQlyZXR1cm4gUExBTkVfQ1RMX0FMUEhBX1NXX1BS
RU1VTFRJUExZOwotCWNhc2UgRFJNX01PREVfQkxFTkRfQ09WRVJBR0U6Ci0JCXJldHVybiBQTEFO
RV9DVExfQUxQSEFfSFdfUFJFTVVMVElQTFk7Ci0JZGVmYXVsdDoKLQkJTUlTU0lOR19DQVNFKHBs
YW5lX3N0YXRlLT5ody5waXhlbF9ibGVuZF9tb2RlKTsKLQkJcmV0dXJuIFBMQU5FX0NUTF9BTFBI
QV9ESVNBQkxFOwotCX0KLX0KLQotc3RhdGljIHUzMiBnbGtfcGxhbmVfY29sb3JfY3RsX2FscGhh
KGNvbnN0IHN0cnVjdCBpbnRlbF9wbGFuZV9zdGF0ZSAqcGxhbmVfc3RhdGUpCi17Ci0JaWYgKCFw
bGFuZV9zdGF0ZS0+aHcuZmItPmZvcm1hdC0+aGFzX2FscGhhKQotCQlyZXR1cm4gUExBTkVfQ09M
T1JfQUxQSEFfRElTQUJMRTsKLQotCXN3aXRjaCAocGxhbmVfc3RhdGUtPmh3LnBpeGVsX2JsZW5k
X21vZGUpIHsKLQljYXNlIERSTV9NT0RFX0JMRU5EX1BJWEVMX05PTkU6Ci0JCXJldHVybiBQTEFO
RV9DT0xPUl9BTFBIQV9ESVNBQkxFOwotCWNhc2UgRFJNX01PREVfQkxFTkRfUFJFTVVMVEk6Ci0J
CXJldHVybiBQTEFORV9DT0xPUl9BTFBIQV9TV19QUkVNVUxUSVBMWTsKLQljYXNlIERSTV9NT0RF
X0JMRU5EX0NPVkVSQUdFOgotCQlyZXR1cm4gUExBTkVfQ09MT1JfQUxQSEFfSFdfUFJFTVVMVElQ
TFk7Ci0JZGVmYXVsdDoKLQkJTUlTU0lOR19DQVNFKHBsYW5lX3N0YXRlLT5ody5waXhlbF9ibGVu
ZF9tb2RlKTsKLQkJcmV0dXJuIFBMQU5FX0NPTE9SX0FMUEhBX0RJU0FCTEU7Ci0JfQotfQotCi1z
dGF0aWMgdTMyIHNrbF9wbGFuZV9jdGxfdGlsaW5nKHU2NCBmYl9tb2RpZmllcikKLXsKLQlzd2l0
Y2ggKGZiX21vZGlmaWVyKSB7Ci0JY2FzZSBEUk1fRk9STUFUX01PRF9MSU5FQVI6Ci0JCWJyZWFr
OwotCWNhc2UgSTkxNV9GT1JNQVRfTU9EX1hfVElMRUQ6Ci0JCXJldHVybiBQTEFORV9DVExfVElM
RURfWDsKLQljYXNlIEk5MTVfRk9STUFUX01PRF9ZX1RJTEVEOgotCQlyZXR1cm4gUExBTkVfQ1RM
X1RJTEVEX1k7Ci0JY2FzZSBJOTE1X0ZPUk1BVF9NT0RfWV9USUxFRF9DQ1M6Ci0JY2FzZSBJOTE1
X0ZPUk1BVF9NT0RfWV9USUxFRF9HRU4xMl9SQ19DQ1NfQ0M6Ci0JCXJldHVybiBQTEFORV9DVExf
VElMRURfWSB8IFBMQU5FX0NUTF9SRU5ERVJfREVDT01QUkVTU0lPTl9FTkFCTEU7Ci0JY2FzZSBJ
OTE1X0ZPUk1BVF9NT0RfWV9USUxFRF9HRU4xMl9SQ19DQ1M6Ci0JCXJldHVybiBQTEFORV9DVExf
VElMRURfWSB8Ci0JCSAgICAgICBQTEFORV9DVExfUkVOREVSX0RFQ09NUFJFU1NJT05fRU5BQkxF
IHwKLQkJICAgICAgIFBMQU5FX0NUTF9DTEVBUl9DT0xPUl9ESVNBQkxFOwotCWNhc2UgSTkxNV9G
T1JNQVRfTU9EX1lfVElMRURfR0VOMTJfTUNfQ0NTOgotCQlyZXR1cm4gUExBTkVfQ1RMX1RJTEVE
X1kgfCBQTEFORV9DVExfTUVESUFfREVDT01QUkVTU0lPTl9FTkFCTEU7Ci0JY2FzZSBJOTE1X0ZP
Uk1BVF9NT0RfWWZfVElMRUQ6Ci0JCXJldHVybiBQTEFORV9DVExfVElMRURfWUY7Ci0JY2FzZSBJ
OTE1X0ZPUk1BVF9NT0RfWWZfVElMRURfQ0NTOgotCQlyZXR1cm4gUExBTkVfQ1RMX1RJTEVEX1lG
IHwgUExBTkVfQ1RMX1JFTkRFUl9ERUNPTVBSRVNTSU9OX0VOQUJMRTsKLQlkZWZhdWx0OgotCQlN
SVNTSU5HX0NBU0UoZmJfbW9kaWZpZXIpOwotCX0KLQotCXJldHVybiAwOwotfQotCi1zdGF0aWMg
dTMyIHNrbF9wbGFuZV9jdGxfcm90YXRlKHVuc2lnbmVkIGludCByb3RhdGUpCi17Ci0Jc3dpdGNo
IChyb3RhdGUpIHsKLQljYXNlIERSTV9NT0RFX1JPVEFURV8wOgotCQlicmVhazsKLQkvKgotCSAq
IERSTV9NT0RFX1JPVEFURV8gaXMgY291bnRlciBjbG9ja3dpc2UgdG8gc3RheSBjb21wYXRpYmxl
IHdpdGggWHJhbmRyCi0JICogd2hpbGUgaTkxNSBIVyByb3RhdGlvbiBpcyBjbG9ja3dpc2UsIHRo
YXRzIHdoeSB0aGlzIHN3YXBwaW5nLgotCSAqLwotCWNhc2UgRFJNX01PREVfUk9UQVRFXzkwOgot
CQlyZXR1cm4gUExBTkVfQ1RMX1JPVEFURV8yNzA7Ci0JY2FzZSBEUk1fTU9ERV9ST1RBVEVfMTgw
OgotCQlyZXR1cm4gUExBTkVfQ1RMX1JPVEFURV8xODA7Ci0JY2FzZSBEUk1fTU9ERV9ST1RBVEVf
MjcwOgotCQlyZXR1cm4gUExBTkVfQ1RMX1JPVEFURV85MDsKLQlkZWZhdWx0OgotCQlNSVNTSU5H
X0NBU0Uocm90YXRlKTsKLQl9Ci0KLQlyZXR1cm4gMDsKLX0KLQotc3RhdGljIHUzMiBjbmxfcGxh
bmVfY3RsX2ZsaXAodW5zaWduZWQgaW50IHJlZmxlY3QpCi17Ci0Jc3dpdGNoIChyZWZsZWN0KSB7
Ci0JY2FzZSAwOgotCQlicmVhazsKLQljYXNlIERSTV9NT0RFX1JFRkxFQ1RfWDoKLQkJcmV0dXJu
IFBMQU5FX0NUTF9GTElQX0hPUklaT05UQUw7Ci0JY2FzZSBEUk1fTU9ERV9SRUZMRUNUX1k6Ci0J
ZGVmYXVsdDoKLQkJTUlTU0lOR19DQVNFKHJlZmxlY3QpOwotCX0KLQotCXJldHVybiAwOwotfQot
Ci11MzIgc2tsX3BsYW5lX2N0bF9jcnRjKGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpj
cnRjX3N0YXRlKQotewotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5
MTUoY3J0Y19zdGF0ZS0+dWFwaS5jcnRjLT5kZXYpOwotCXUzMiBwbGFuZV9jdGwgPSAwOwotCi0J
aWYgKElOVEVMX0dFTihkZXZfcHJpdikgPj0gMTAgfHwgSVNfR0VNSU5JTEFLRShkZXZfcHJpdikp
Ci0JCXJldHVybiBwbGFuZV9jdGw7Ci0KLQlpZiAoY3J0Y19zdGF0ZS0+Z2FtbWFfZW5hYmxlKQot
CQlwbGFuZV9jdGwgfD0gUExBTkVfQ1RMX1BJUEVfR0FNTUFfRU5BQkxFOwotCi0JaWYgKGNydGNf
c3RhdGUtPmNzY19lbmFibGUpCi0JCXBsYW5lX2N0bCB8PSBQTEFORV9DVExfUElQRV9DU0NfRU5B
QkxFOwotCi0JcmV0dXJuIHBsYW5lX2N0bDsKLX0KLQotdTMyIHNrbF9wbGFuZV9jdGwoY29uc3Qg
c3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUsCi0JCSAgY29uc3Qgc3RydWN0IGlu
dGVsX3BsYW5lX3N0YXRlICpwbGFuZV9zdGF0ZSkKLXsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0
ZSAqZGV2X3ByaXYgPQotCQl0b19pOTE1KHBsYW5lX3N0YXRlLT51YXBpLnBsYW5lLT5kZXYpOwot
CWNvbnN0IHN0cnVjdCBkcm1fZnJhbWVidWZmZXIgKmZiID0gcGxhbmVfc3RhdGUtPmh3LmZiOwot
CXVuc2lnbmVkIGludCByb3RhdGlvbiA9IHBsYW5lX3N0YXRlLT5ody5yb3RhdGlvbjsKLQljb25z
dCBzdHJ1Y3QgZHJtX2ludGVsX3Nwcml0ZV9jb2xvcmtleSAqa2V5ID0gJnBsYW5lX3N0YXRlLT5j
a2V5OwotCXUzMiBwbGFuZV9jdGw7Ci0KLQlwbGFuZV9jdGwgPSBQTEFORV9DVExfRU5BQkxFOwot
Ci0JaWYgKElOVEVMX0dFTihkZXZfcHJpdikgPCAxMCAmJiAhSVNfR0VNSU5JTEFLRShkZXZfcHJp
dikpIHsKLQkJcGxhbmVfY3RsIHw9IHNrbF9wbGFuZV9jdGxfYWxwaGEocGxhbmVfc3RhdGUpOwot
CQlwbGFuZV9jdGwgfD0gUExBTkVfQ1RMX1BMQU5FX0dBTU1BX0RJU0FCTEU7Ci0KLQkJaWYgKHBs
YW5lX3N0YXRlLT5ody5jb2xvcl9lbmNvZGluZyA9PSBEUk1fQ09MT1JfWUNCQ1JfQlQ3MDkpCi0J
CQlwbGFuZV9jdGwgfD0gUExBTkVfQ1RMX1lVVl9UT19SR0JfQ1NDX0ZPUk1BVF9CVDcwOTsKLQot
CQlpZiAocGxhbmVfc3RhdGUtPmh3LmNvbG9yX3JhbmdlID09IERSTV9DT0xPUl9ZQ0JDUl9GVUxM
X1JBTkdFKQotCQkJcGxhbmVfY3RsIHw9IFBMQU5FX0NUTF9ZVVZfUkFOR0VfQ09SUkVDVElPTl9E
SVNBQkxFOwotCX0KLQotCXBsYW5lX2N0bCB8PSBza2xfcGxhbmVfY3RsX2Zvcm1hdChmYi0+Zm9y
bWF0LT5mb3JtYXQpOwotCXBsYW5lX2N0bCB8PSBza2xfcGxhbmVfY3RsX3RpbGluZyhmYi0+bW9k
aWZpZXIpOwotCXBsYW5lX2N0bCB8PSBza2xfcGxhbmVfY3RsX3JvdGF0ZShyb3RhdGlvbiAmIERS
TV9NT0RFX1JPVEFURV9NQVNLKTsKLQotCWlmIChJTlRFTF9HRU4oZGV2X3ByaXYpID49IDEwKQot
CQlwbGFuZV9jdGwgfD0gY25sX3BsYW5lX2N0bF9mbGlwKHJvdGF0aW9uICYKLQkJCQkJCURSTV9N
T0RFX1JFRkxFQ1RfTUFTSyk7Ci0KLQlpZiAoa2V5LT5mbGFncyAmIEk5MTVfU0VUX0NPTE9SS0VZ
X0RFU1RJTkFUSU9OKQotCQlwbGFuZV9jdGwgfD0gUExBTkVfQ1RMX0tFWV9FTkFCTEVfREVTVElO
QVRJT047Ci0JZWxzZSBpZiAoa2V5LT5mbGFncyAmIEk5MTVfU0VUX0NPTE9SS0VZX1NPVVJDRSkK
LQkJcGxhbmVfY3RsIHw9IFBMQU5FX0NUTF9LRVlfRU5BQkxFX1NPVVJDRTsKLQotCXJldHVybiBw
bGFuZV9jdGw7Ci19Ci0KLXUzMiBnbGtfcGxhbmVfY29sb3JfY3RsX2NydGMoY29uc3Qgc3RydWN0
IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUpCit2b2lkIHNrbF9zY2FsZXJfZGlzYWJsZShj
b25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqb2xkX2NydGNfc3RhdGUpCiB7Ci0Jc3RydWN0
IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShjcnRjX3N0YXRlLT51YXBpLmNy
dGMtPmRldik7Ci0JdTMyIHBsYW5lX2NvbG9yX2N0bCA9IDA7Ci0KLQlpZiAoSU5URUxfR0VOKGRl
dl9wcml2KSA+PSAxMSkKLQkJcmV0dXJuIHBsYW5lX2NvbG9yX2N0bDsKLQotCWlmIChjcnRjX3N0
YXRlLT5nYW1tYV9lbmFibGUpCi0JCXBsYW5lX2NvbG9yX2N0bCB8PSBQTEFORV9DT0xPUl9QSVBF
X0dBTU1BX0VOQUJMRTsKLQotCWlmIChjcnRjX3N0YXRlLT5jc2NfZW5hYmxlKQotCQlwbGFuZV9j
b2xvcl9jdGwgfD0gUExBTkVfQ09MT1JfUElQRV9DU0NfRU5BQkxFOworCXN0cnVjdCBpbnRlbF9j
cnRjICpjcnRjID0gdG9faW50ZWxfY3J0YyhvbGRfY3J0Y19zdGF0ZS0+dWFwaS5jcnRjKTsKKwlp
bnQgaTsKIAotCXJldHVybiBwbGFuZV9jb2xvcl9jdGw7CisJZm9yIChpID0gMDsgaSA8IGNydGMt
Pm51bV9zY2FsZXJzOyBpKyspCisJCXNrbF9kZXRhY2hfc2NhbGVyKGNydGMsIGkpOwogfQogCi11
MzIgZ2xrX3BsYW5lX2NvbG9yX2N0bChjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0
Y19zdGF0ZSwKLQkJCWNvbnN0IHN0cnVjdCBpbnRlbF9wbGFuZV9zdGF0ZSAqcGxhbmVfc3RhdGUp
Cit1bnNpZ25lZCBpbnQKK2ludGVsX3BsYW5lX2ZlbmNlX3lfb2Zmc2V0KGNvbnN0IHN0cnVjdCBp
bnRlbF9wbGFuZV9zdGF0ZSAqcGxhbmVfc3RhdGUpCiB7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZh
dGUgKmRldl9wcml2ID0KLQkJdG9faTkxNShwbGFuZV9zdGF0ZS0+dWFwaS5wbGFuZS0+ZGV2KTsK
LQljb25zdCBzdHJ1Y3QgZHJtX2ZyYW1lYnVmZmVyICpmYiA9IHBsYW5lX3N0YXRlLT5ody5mYjsK
LQlzdHJ1Y3QgaW50ZWxfcGxhbmUgKnBsYW5lID0gdG9faW50ZWxfcGxhbmUocGxhbmVfc3RhdGUt
PnVhcGkucGxhbmUpOwotCXUzMiBwbGFuZV9jb2xvcl9jdGwgPSAwOwotCi0JcGxhbmVfY29sb3Jf
Y3RsIHw9IFBMQU5FX0NPTE9SX1BMQU5FX0dBTU1BX0RJU0FCTEU7Ci0JcGxhbmVfY29sb3JfY3Rs
IHw9IGdsa19wbGFuZV9jb2xvcl9jdGxfYWxwaGEocGxhbmVfc3RhdGUpOworCWludCB4ID0gMCwg
eSA9IDA7CiAKLQlpZiAoZmItPmZvcm1hdC0+aXNfeXV2ICYmICFpY2xfaXNfaGRyX3BsYW5lKGRl
dl9wcml2LCBwbGFuZS0+aWQpKSB7Ci0JCXN3aXRjaCAocGxhbmVfc3RhdGUtPmh3LmNvbG9yX2Vu
Y29kaW5nKSB7Ci0JCWNhc2UgRFJNX0NPTE9SX1lDQkNSX0JUNzA5OgotCQkJcGxhbmVfY29sb3Jf
Y3RsIHw9IFBMQU5FX0NPTE9SX0NTQ19NT0RFX1lVVjcwOV9UT19SR0I3MDk7Ci0JCQlicmVhazsK
LQkJY2FzZSBEUk1fQ09MT1JfWUNCQ1JfQlQyMDIwOgotCQkJcGxhbmVfY29sb3JfY3RsIHw9Ci0J
CQkJUExBTkVfQ09MT1JfQ1NDX01PREVfWVVWMjAyMF9UT19SR0IyMDIwOwotCQkJYnJlYWs7Ci0J
CWRlZmF1bHQ6Ci0JCQlwbGFuZV9jb2xvcl9jdGwgfD0KLQkJCQlQTEFORV9DT0xPUl9DU0NfTU9E
RV9ZVVY2MDFfVE9fUkdCNjAxOwotCQl9Ci0JCWlmIChwbGFuZV9zdGF0ZS0+aHcuY29sb3JfcmFu
Z2UgPT0gRFJNX0NPTE9SX1lDQkNSX0ZVTExfUkFOR0UpCi0JCQlwbGFuZV9jb2xvcl9jdGwgfD0g
UExBTkVfQ09MT1JfWVVWX1JBTkdFX0NPUlJFQ1RJT05fRElTQUJMRTsKLQl9IGVsc2UgaWYgKGZi
LT5mb3JtYXQtPmlzX3l1dikgewotCQlwbGFuZV9jb2xvcl9jdGwgfD0gUExBTkVfQ09MT1JfSU5Q
VVRfQ1NDX0VOQUJMRTsKLQkJaWYgKHBsYW5lX3N0YXRlLT5ody5jb2xvcl9yYW5nZSA9PSBEUk1f
Q09MT1JfWUNCQ1JfRlVMTF9SQU5HRSkKLQkJCXBsYW5lX2NvbG9yX2N0bCB8PSBQTEFORV9DT0xP
Ul9ZVVZfUkFOR0VfQ09SUkVDVElPTl9ESVNBQkxFOwotCX0KKwlpbnRlbF9wbGFuZV9hZGp1c3Rf
YWxpZ25lZF9vZmZzZXQoJngsICZ5LCBwbGFuZV9zdGF0ZSwgMCwKKwkJCQkJICBwbGFuZV9zdGF0
ZS0+Y29sb3JfcGxhbmVbMF0ub2Zmc2V0LCAwKTsKIAotCXJldHVybiBwbGFuZV9jb2xvcl9jdGw7
CisJcmV0dXJuIHk7CiB9CiAKIHN0YXRpYyBpbnQKQEAgLTQ0NDUsMTUgKzM2NzgsNiBAQCBzdGF0
aWMgaW50IHNrbF91cGRhdGVfc2NhbGVyX3BsYW5lKHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpj
cnRjX3N0YXRlLAogCXJldHVybiAwOwogfQogCi12b2lkIHNrbF9zY2FsZXJfZGlzYWJsZShjb25z
dCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqb2xkX2NydGNfc3RhdGUpCi17Ci0Jc3RydWN0IGlu
dGVsX2NydGMgKmNydGMgPSB0b19pbnRlbF9jcnRjKG9sZF9jcnRjX3N0YXRlLT51YXBpLmNydGMp
OwotCWludCBpOwotCi0JZm9yIChpID0gMDsgaSA8IGNydGMtPm51bV9zY2FsZXJzOyBpKyspCi0J
CXNrbF9kZXRhY2hfc2NhbGVyKGNydGMsIGkpOwotfQotCiBzdGF0aWMgaW50IGNubF9jb2VmX3Rh
cChpbnQgaSkKIHsKIAlyZXR1cm4gaSAlIDc7CkBAIC04Mjc2LDE1MCArNzUwMCw2IEBAIHN0YXRp
YyB2b2lkIHNrbF9nZXRfcGZpdF9jb25maWcoc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNf
c3RhdGUpCiAJCXNjYWxlcl9zdGF0ZS0+c2NhbGVyX3VzZXJzICY9IH4oMSA8PCBTS0xfQ1JUQ19J
TkRFWCk7CiB9CiAKLXN0YXRpYyB2b2lkCi1za2xfZ2V0X2luaXRpYWxfcGxhbmVfY29uZmlnKHN0
cnVjdCBpbnRlbF9jcnRjICpjcnRjLAotCQkJICAgICBzdHJ1Y3QgaW50ZWxfaW5pdGlhbF9wbGFu
ZV9jb25maWcgKnBsYW5lX2NvbmZpZykKLXsKLQlzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0
Y19zdGF0ZSA9IHRvX2ludGVsX2NydGNfc3RhdGUoY3J0Yy0+YmFzZS5zdGF0ZSk7Ci0Jc3RydWN0
IGRybV9kZXZpY2UgKmRldiA9IGNydGMtPmJhc2UuZGV2OwotCXN0cnVjdCBkcm1faTkxNV9wcml2
YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoZGV2KTsKLQlzdHJ1Y3QgaW50ZWxfcGxhbmUgKnBsYW5l
ID0gdG9faW50ZWxfcGxhbmUoY3J0Yy0+YmFzZS5wcmltYXJ5KTsKLQllbnVtIHBsYW5lX2lkIHBs
YW5lX2lkID0gcGxhbmUtPmlkOwotCWVudW0gcGlwZSBwaXBlOwotCXUzMiB2YWwsIGJhc2UsIG9m
ZnNldCwgc3RyaWRlX211bHQsIHRpbGluZywgYWxwaGE7Ci0JaW50IGZvdXJjYywgcGl4ZWxfZm9y
bWF0OwotCXVuc2lnbmVkIGludCBhbGlnbmVkX2hlaWdodDsKLQlzdHJ1Y3QgZHJtX2ZyYW1lYnVm
ZmVyICpmYjsKLQlzdHJ1Y3QgaW50ZWxfZnJhbWVidWZmZXIgKmludGVsX2ZiOwotCi0JaWYgKCFw
bGFuZS0+Z2V0X2h3X3N0YXRlKHBsYW5lLCAmcGlwZSkpCi0JCXJldHVybjsKLQotCWRybV9XQVJO
X09OKGRldiwgcGlwZSAhPSBjcnRjLT5waXBlKTsKLQotCWlmIChjcnRjX3N0YXRlLT5iaWdqb2lu
ZXIpIHsKLQkJZHJtX2RiZ19rbXMoJmRldl9wcml2LT5kcm0sCi0JCQkgICAgIlVuc3VwcG9ydGVk
IGJpZ2pvaW5lciBjb25maWd1cmF0aW9uIGZvciBpbml0aWFsIEZCXG4iKTsKLQkJcmV0dXJuOwot
CX0KLQotCWludGVsX2ZiID0ga3phbGxvYyhzaXplb2YoKmludGVsX2ZiKSwgR0ZQX0tFUk5FTCk7
Ci0JaWYgKCFpbnRlbF9mYikgewotCQlkcm1fZGJnX2ttcygmZGV2X3ByaXYtPmRybSwgImZhaWxl
ZCB0byBhbGxvYyBmYlxuIik7Ci0JCXJldHVybjsKLQl9Ci0KLQlmYiA9ICZpbnRlbF9mYi0+YmFz
ZTsKLQotCWZiLT5kZXYgPSBkZXY7Ci0KLQl2YWwgPSBpbnRlbF9kZV9yZWFkKGRldl9wcml2LCBQ
TEFORV9DVEwocGlwZSwgcGxhbmVfaWQpKTsKLQotCWlmIChJTlRFTF9HRU4oZGV2X3ByaXYpID49
IDExKQotCQlwaXhlbF9mb3JtYXQgPSB2YWwgJiBJQ0xfUExBTkVfQ1RMX0ZPUk1BVF9NQVNLOwot
CWVsc2UKLQkJcGl4ZWxfZm9ybWF0ID0gdmFsICYgUExBTkVfQ1RMX0ZPUk1BVF9NQVNLOwotCi0J
aWYgKElOVEVMX0dFTihkZXZfcHJpdikgPj0gMTAgfHwgSVNfR0VNSU5JTEFLRShkZXZfcHJpdikp
IHsKLQkJYWxwaGEgPSBpbnRlbF9kZV9yZWFkKGRldl9wcml2LAotCQkJCSAgICAgIFBMQU5FX0NP
TE9SX0NUTChwaXBlLCBwbGFuZV9pZCkpOwotCQlhbHBoYSAmPSBQTEFORV9DT0xPUl9BTFBIQV9N
QVNLOwotCX0gZWxzZSB7Ci0JCWFscGhhID0gdmFsICYgUExBTkVfQ1RMX0FMUEhBX01BU0s7Ci0J
fQotCi0JZm91cmNjID0gc2tsX2Zvcm1hdF90b19mb3VyY2MocGl4ZWxfZm9ybWF0LAotCQkJCSAg
ICAgIHZhbCAmIFBMQU5FX0NUTF9PUkRFUl9SR0JYLCBhbHBoYSk7Ci0JZmItPmZvcm1hdCA9IGRy
bV9mb3JtYXRfaW5mbyhmb3VyY2MpOwotCi0JdGlsaW5nID0gdmFsICYgUExBTkVfQ1RMX1RJTEVE
X01BU0s7Ci0Jc3dpdGNoICh0aWxpbmcpIHsKLQljYXNlIFBMQU5FX0NUTF9USUxFRF9MSU5FQVI6
Ci0JCWZiLT5tb2RpZmllciA9IERSTV9GT1JNQVRfTU9EX0xJTkVBUjsKLQkJYnJlYWs7Ci0JY2Fz
ZSBQTEFORV9DVExfVElMRURfWDoKLQkJcGxhbmVfY29uZmlnLT50aWxpbmcgPSBJOTE1X1RJTElO
R19YOwotCQlmYi0+bW9kaWZpZXIgPSBJOTE1X0ZPUk1BVF9NT0RfWF9USUxFRDsKLQkJYnJlYWs7
Ci0JY2FzZSBQTEFORV9DVExfVElMRURfWToKLQkJcGxhbmVfY29uZmlnLT50aWxpbmcgPSBJOTE1
X1RJTElOR19ZOwotCQlpZiAodmFsICYgUExBTkVfQ1RMX1JFTkRFUl9ERUNPTVBSRVNTSU9OX0VO
QUJMRSkKLQkJCWZiLT5tb2RpZmllciA9IElOVEVMX0dFTihkZXZfcHJpdikgPj0gMTIgPwotCQkJ
CUk5MTVfRk9STUFUX01PRF9ZX1RJTEVEX0dFTjEyX1JDX0NDUyA6Ci0JCQkJSTkxNV9GT1JNQVRf
TU9EX1lfVElMRURfQ0NTOwotCQllbHNlIGlmICh2YWwgJiBQTEFORV9DVExfTUVESUFfREVDT01Q
UkVTU0lPTl9FTkFCTEUpCi0JCQlmYi0+bW9kaWZpZXIgPSBJOTE1X0ZPUk1BVF9NT0RfWV9USUxF
RF9HRU4xMl9NQ19DQ1M7Ci0JCWVsc2UKLQkJCWZiLT5tb2RpZmllciA9IEk5MTVfRk9STUFUX01P
RF9ZX1RJTEVEOwotCQlicmVhazsKLQljYXNlIFBMQU5FX0NUTF9USUxFRF9ZRjoKLQkJaWYgKHZh
bCAmIFBMQU5FX0NUTF9SRU5ERVJfREVDT01QUkVTU0lPTl9FTkFCTEUpCi0JCQlmYi0+bW9kaWZp
ZXIgPSBJOTE1X0ZPUk1BVF9NT0RfWWZfVElMRURfQ0NTOwotCQllbHNlCi0JCQlmYi0+bW9kaWZp
ZXIgPSBJOTE1X0ZPUk1BVF9NT0RfWWZfVElMRUQ7Ci0JCWJyZWFrOwotCWRlZmF1bHQ6Ci0JCU1J
U1NJTkdfQ0FTRSh0aWxpbmcpOwotCQlnb3RvIGVycm9yOwotCX0KLQotCS8qCi0JICogRFJNX01P
REVfUk9UQVRFXyBpcyBjb3VudGVyIGNsb2Nrd2lzZSB0byBzdGF5IGNvbXBhdGlibGUgd2l0aCBY
cmFuZHIKLQkgKiB3aGlsZSBpOTE1IEhXIHJvdGF0aW9uIGlzIGNsb2Nrd2lzZSwgdGhhdHMgd2h5
IHRoaXMgc3dhcHBpbmcuCi0JICovCi0Jc3dpdGNoICh2YWwgJiBQTEFORV9DVExfUk9UQVRFX01B
U0spIHsKLQljYXNlIFBMQU5FX0NUTF9ST1RBVEVfMDoKLQkJcGxhbmVfY29uZmlnLT5yb3RhdGlv
biA9IERSTV9NT0RFX1JPVEFURV8wOwotCQlicmVhazsKLQljYXNlIFBMQU5FX0NUTF9ST1RBVEVf
OTA6Ci0JCXBsYW5lX2NvbmZpZy0+cm90YXRpb24gPSBEUk1fTU9ERV9ST1RBVEVfMjcwOwotCQli
cmVhazsKLQljYXNlIFBMQU5FX0NUTF9ST1RBVEVfMTgwOgotCQlwbGFuZV9jb25maWctPnJvdGF0
aW9uID0gRFJNX01PREVfUk9UQVRFXzE4MDsKLQkJYnJlYWs7Ci0JY2FzZSBQTEFORV9DVExfUk9U
QVRFXzI3MDoKLQkJcGxhbmVfY29uZmlnLT5yb3RhdGlvbiA9IERSTV9NT0RFX1JPVEFURV85MDsK
LQkJYnJlYWs7Ci0JfQotCi0JaWYgKElOVEVMX0dFTihkZXZfcHJpdikgPj0gMTAgJiYKLQkgICAg
dmFsICYgUExBTkVfQ1RMX0ZMSVBfSE9SSVpPTlRBTCkKLQkJcGxhbmVfY29uZmlnLT5yb3RhdGlv
biB8PSBEUk1fTU9ERV9SRUZMRUNUX1g7Ci0KLQkvKiA5MC8yNzAgZGVncmVlIHJvdGF0aW9uIHdv
dWxkIHJlcXVpcmUgZXh0cmEgd29yayAqLwotCWlmIChkcm1fcm90YXRpb25fOTBfb3JfMjcwKHBs
YW5lX2NvbmZpZy0+cm90YXRpb24pKQotCQlnb3RvIGVycm9yOwotCi0JYmFzZSA9IGludGVsX2Rl
X3JlYWQoZGV2X3ByaXYsIFBMQU5FX1NVUkYocGlwZSwgcGxhbmVfaWQpKSAmIDB4ZmZmZmYwMDA7
Ci0JcGxhbmVfY29uZmlnLT5iYXNlID0gYmFzZTsKLQotCW9mZnNldCA9IGludGVsX2RlX3JlYWQo
ZGV2X3ByaXYsIFBMQU5FX09GRlNFVChwaXBlLCBwbGFuZV9pZCkpOwotCi0JdmFsID0gaW50ZWxf
ZGVfcmVhZChkZXZfcHJpdiwgUExBTkVfU0laRShwaXBlLCBwbGFuZV9pZCkpOwotCWZiLT5oZWln
aHQgPSAoKHZhbCA+PiAxNikgJiAweGZmZmYpICsgMTsKLQlmYi0+d2lkdGggPSAoKHZhbCA+PiAw
KSAmIDB4ZmZmZikgKyAxOwotCi0JdmFsID0gaW50ZWxfZGVfcmVhZChkZXZfcHJpdiwgUExBTkVf
U1RSSURFKHBpcGUsIHBsYW5lX2lkKSk7Ci0Jc3RyaWRlX211bHQgPSBza2xfcGxhbmVfc3RyaWRl
X211bHQoZmIsIDAsIERSTV9NT0RFX1JPVEFURV8wKTsKLQlmYi0+cGl0Y2hlc1swXSA9ICh2YWwg
JiAweDNmZikgKiBzdHJpZGVfbXVsdDsKLQotCWFsaWduZWRfaGVpZ2h0ID0gaW50ZWxfZmJfYWxp
Z25faGVpZ2h0KGZiLCAwLCBmYi0+aGVpZ2h0KTsKLQotCXBsYW5lX2NvbmZpZy0+c2l6ZSA9IGZi
LT5waXRjaGVzWzBdICogYWxpZ25lZF9oZWlnaHQ7Ci0KLQlkcm1fZGJnX2ttcygmZGV2X3ByaXYt
PmRybSwKLQkJICAgICIlcy8lcyB3aXRoIGZiOiBzaXplPSVkeCVkQCVkLCBvZmZzZXQ9JXgsIHBp
dGNoICVkLCBzaXplIDB4JXhcbiIsCi0JCSAgICBjcnRjLT5iYXNlLm5hbWUsIHBsYW5lLT5iYXNl
Lm5hbWUsIGZiLT53aWR0aCwgZmItPmhlaWdodCwKLQkJICAgIGZiLT5mb3JtYXQtPmNwcFswXSAq
IDgsIGJhc2UsIGZiLT5waXRjaGVzWzBdLAotCQkgICAgcGxhbmVfY29uZmlnLT5zaXplKTsKLQot
CXBsYW5lX2NvbmZpZy0+ZmIgPSBpbnRlbF9mYjsKLQlyZXR1cm47Ci0KLWVycm9yOgotCWtmcmVl
KGludGVsX2ZiKTsKLX0KLQogc3RhdGljIHZvaWQgaWxrX2dldF9wZml0X2NvbmZpZyhzdHJ1Y3Qg
aW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSkKIHsKIAlzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0
YyA9IHRvX2ludGVsX2NydGMoY3J0Y19zdGF0ZS0+dWFwaS5jcnRjKTsKZGlmZiAtLWdpdCBhL2Ry
aXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZGlzcGxheS5oIGIvZHJpdmVycy9ncHUv
ZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kaXNwbGF5LmgKaW5kZXggNjRmZmEzNDU0NGE3Li4yNTEz
OTgxMjgzNDkgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxf
ZGlzcGxheS5oCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZGlzcGxh
eS5oCkBAIC01Miw2ICs1Miw3IEBAIHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlOwogc3RydWN0IGlu
dGVsX2RpZ2l0YWxfcG9ydDsKIHN0cnVjdCBpbnRlbF9kcDsKIHN0cnVjdCBpbnRlbF9lbmNvZGVy
Oworc3RydWN0IGludGVsX2luaXRpYWxfcGxhbmVfY29uZmlnOwogc3RydWN0IGludGVsX2xvYWRf
ZGV0ZWN0X3BpcGU7CiBzdHJ1Y3QgaW50ZWxfcGxhbmU7CiBzdHJ1Y3QgaW50ZWxfcGxhbmVfc3Rh
dGU7CkBAIC01MDgsNyArNTA5LDYgQEAgdm9pZCBpbnRlbF9saW5rX2NvbXB1dGVfbV9uKHUxNiBi
cHAsIGludCBubGFuZXMsCiAJCQkgICAgc3RydWN0IGludGVsX2xpbmtfbV9uICptX24sCiAJCQkg
ICAgYm9vbCBjb25zdGFudF9uLCBib29sIGZlY19lbmFibGUpOwogYm9vbCBpc19jY3NfbW9kaWZp
ZXIodTY0IG1vZGlmaWVyKTsKLWludCBpbnRlbF9tYWluX3RvX2F1eF9wbGFuZShjb25zdCBzdHJ1
Y3QgZHJtX2ZyYW1lYnVmZmVyICpmYiwgaW50IG1haW5fcGxhbmUpOwogdm9pZCBscHRfZGlzYWJs
ZV9jbGtvdXRfZHAoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KTsKIHUzMiBpbnRl
bF9wbGFuZV9mYl9tYXhfc3RyaWRlKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwK
IAkJCSAgICAgIHUzMiBwaXhlbF9mb3JtYXQsIHU2NCBtb2RpZmllcik7CkBAIC02MjAsMTggKzYy
MCw3IEBAIHUzMiBza2xfc2NhbGVyX2dldF9maWx0ZXJfc2VsZWN0KGVudW0gZHJtX3NjYWxpbmdf
ZmlsdGVyIGZpbHRlciwgaW50IHNldCk7CiB2b2lkIHNrbF9zY2FsZXJfc2V0dXBfZmlsdGVyKHN0
cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwgZW51bSBwaXBlIHBpcGUsCiAJCQkgICAg
IGludCBpZCwgaW50IHNldCwgZW51bSBkcm1fc2NhbGluZ19maWx0ZXIgZmlsdGVyKTsKIHZvaWQg
aWxrX3BmaXRfZGlzYWJsZShjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqb2xkX2NydGNf
c3RhdGUpOwotdTMyIGdsa19wbGFuZV9jb2xvcl9jdGwoY29uc3Qgc3RydWN0IGludGVsX2NydGNf
c3RhdGUgKmNydGNfc3RhdGUsCi0JCQljb25zdCBzdHJ1Y3QgaW50ZWxfcGxhbmVfc3RhdGUgKnBs
YW5lX3N0YXRlKTsKLXUzMiBnbGtfcGxhbmVfY29sb3JfY3RsX2NydGMoY29uc3Qgc3RydWN0IGlu
dGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUpOwotdTMyIHNrbF9wbGFuZV9jdGwoY29uc3Qgc3Ry
dWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUsCi0JCSAgY29uc3Qgc3RydWN0IGludGVs
X3BsYW5lX3N0YXRlICpwbGFuZV9zdGF0ZSk7Ci11MzIgc2tsX3BsYW5lX2N0bF9jcnRjKGNvbnN0
IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlKTsKLXUzMiBza2xfcGxhbmVfc3Ry
aWRlKGNvbnN0IHN0cnVjdCBpbnRlbF9wbGFuZV9zdGF0ZSAqcGxhbmVfc3RhdGUsCi0JCSAgICAg
aW50IHBsYW5lKTsKLWludCBza2xfY2hlY2tfcGxhbmVfc3VyZmFjZShzdHJ1Y3QgaW50ZWxfcGxh
bmVfc3RhdGUgKnBsYW5lX3N0YXRlKTsKLWludCBza2xfY2FsY19tYWluX3N1cmZhY2Vfb2Zmc2V0
KGNvbnN0IHN0cnVjdCBpbnRlbF9wbGFuZV9zdGF0ZSAqcGxhbmVfc3RhdGUsCi0JCQkJIGludCAq
eCwgaW50ICp5LCB1MzIgKm9mZnNldCk7Ci1pbnQgc2tsX2Zvcm1hdF90b19mb3VyY2MoaW50IGZv
cm1hdCwgYm9vbCByZ2Jfb3JkZXIsIGJvb2wgYWxwaGEpOworCiBpbnQgYmR3X2dldF9waXBlbWlz
Y19icHAoc3RydWN0IGludGVsX2NydGMgKmNydGMpOwogdW5zaWduZWQgaW50IGludGVsX3BsYW5l
X2ZlbmNlX3lfb2Zmc2V0KGNvbnN0IHN0cnVjdCBpbnRlbF9wbGFuZV9zdGF0ZSAqcGxhbmVfc3Rh
dGUpOwogCkBAIC02NTQsNiArNjQzLDE4IEBAIHN0cnVjdCBpbnRlbF9lbmNvZGVyICoKIGludGVs
X2dldF9jcnRjX25ld19lbmNvZGVyKGNvbnN0IHN0cnVjdCBpbnRlbF9hdG9taWNfc3RhdGUgKnN0
YXRlLAogCQkJICAgY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUpOwog
Cit1bnNpZ25lZCBpbnQgaW50ZWxfc3VyZl9hbGlnbm1lbnQoY29uc3Qgc3RydWN0IGRybV9mcmFt
ZWJ1ZmZlciAqZmIsCisJCQkJICBpbnQgY29sb3JfcGxhbmUpOwordm9pZCBpbnRlbF9mYl9wbGFu
ZV9nZXRfc3Vic2FtcGxpbmcoaW50ICpoc3ViLCBpbnQgKnZzdWIsCisJCQkJICAgIGNvbnN0IHN0
cnVjdCBkcm1fZnJhbWVidWZmZXIgKmZiLAorCQkJCSAgICBpbnQgY29sb3JfcGxhbmUpOwordTMy
IGludGVsX3BsYW5lX2FkanVzdF9hbGlnbmVkX29mZnNldChpbnQgKngsIGludCAqeSwKKwkJCQkg
ICAgICBjb25zdCBzdHJ1Y3QgaW50ZWxfcGxhbmVfc3RhdGUgKnN0YXRlLAorCQkJCSAgICAgIGlu
dCBjb2xvcl9wbGFuZSwKKwkJCQkgICAgICB1MzIgb2xkX29mZnNldCwgdTMyIG5ld19vZmZzZXQp
OwordW5zaWduZWQgaW50IGludGVsX3RpbGVfd2lkdGhfYnl0ZXMoY29uc3Qgc3RydWN0IGRybV9m
cmFtZWJ1ZmZlciAqZmIsIGludCBjb2xvcl9wbGFuZSk7Cit1bnNpZ25lZCBpbnQgaW50ZWxfdGls
ZV9oZWlnaHQoY29uc3Qgc3RydWN0IGRybV9mcmFtZWJ1ZmZlciAqZmIsIGludCBjb2xvcl9wbGFu
ZSk7CisKIC8qIG1vZGVzZXR0aW5nICovCiB2b2lkIGludGVsX21vZGVzZXRfaW5pdF9odyhzdHJ1
Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSk7CiBpbnQgaW50ZWxfbW9kZXNldF9pbml0X25vaXJx
KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KTsKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1
L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZGlzcGxheV90eXBlcy5oIGIvZHJpdmVycy9ncHUvZHJt
L2k5MTUvZGlzcGxheS9pbnRlbF9kaXNwbGF5X3R5cGVzLmgKaW5kZXggMzkzOTc3NDhiNGIwLi4y
M2E3NDQ5NmMxNzIgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50
ZWxfZGlzcGxheV90eXBlcy5oCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50
ZWxfZGlzcGxheV90eXBlcy5oCkBAIC0zNyw2ICszNyw3IEBACiAjaW5jbHVkZSA8ZHJtL2RybV9k
cF9tc3RfaGVscGVyLmg+CiAjaW5jbHVkZSA8ZHJtL2RybV9lbmNvZGVyLmg+CiAjaW5jbHVkZSA8
ZHJtL2RybV9mYl9oZWxwZXIuaD4KKyNpbmNsdWRlIDxkcm0vZHJtX2ZvdXJjYy5oPgogI2luY2x1
ZGUgPGRybS9kcm1fcHJvYmVfaGVscGVyLmg+CiAjaW5jbHVkZSA8ZHJtL2RybV9yZWN0Lmg+CiAj
aW5jbHVkZSA8ZHJtL2RybV92YmxhbmsuaD4KQEAgLTE4OTQsNCArMTg5NSwzMCBAQCBzdGF0aWMg
aW5saW5lIHUzMiBpbnRlbF9mZGlfbGlua19mcmVxKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpk
ZXZfcHJpdiwKIAkJcmV0dXJuIGRldl9wcml2LT5mZGlfcGxsX2ZyZXE7CiB9CiAKK3N0YXRpYyBp
bmxpbmUgYm9vbCBpc19jY3NfcGxhbmUoY29uc3Qgc3RydWN0IGRybV9mcmFtZWJ1ZmZlciAqZmIs
IGludCBwbGFuZSkKK3sKKwlpZiAoIWlzX2Njc19tb2RpZmllcihmYi0+bW9kaWZpZXIpKQorCQly
ZXR1cm4gZmFsc2U7CisKKwlyZXR1cm4gcGxhbmUgPj0gZmItPmZvcm1hdC0+bnVtX3BsYW5lcyAv
IDI7Cit9CisKK3N0YXRpYyBpbmxpbmUgYm9vbCBpc19nZW4xMl9jY3NfbW9kaWZpZXIodTY0IG1v
ZGlmaWVyKQoreworCXJldHVybiBtb2RpZmllciA9PSBJOTE1X0ZPUk1BVF9NT0RfWV9USUxFRF9H
RU4xMl9SQ19DQ1MgfHwKKwkgICAgICAgbW9kaWZpZXIgPT0gSTkxNV9GT1JNQVRfTU9EX1lfVElM
RURfR0VOMTJfUkNfQ0NTX0NDIHx8CisJICAgICAgIG1vZGlmaWVyID09IEk5MTVfRk9STUFUX01P
RF9ZX1RJTEVEX0dFTjEyX01DX0NDUzsKK30KKworc3RhdGljIGlubGluZSBib29sIGlzX2dlbjEy
X2Njc19wbGFuZShjb25zdCBzdHJ1Y3QgZHJtX2ZyYW1lYnVmZmVyICpmYiwgaW50IHBsYW5lKQor
eworCXJldHVybiBpc19nZW4xMl9jY3NfbW9kaWZpZXIoZmItPm1vZGlmaWVyKSAmJiBpc19jY3Nf
cGxhbmUoZmIsIHBsYW5lKTsKK30KKworc3RhdGljIGlubGluZSBib29sIGlzX2dlbjEyX2Njc19j
Y19wbGFuZShjb25zdCBzdHJ1Y3QgZHJtX2ZyYW1lYnVmZmVyICpmYiwgaW50IHBsYW5lKQorewor
CXJldHVybiBmYi0+bW9kaWZpZXIgPT0gSTkxNV9GT1JNQVRfTU9EX1lfVElMRURfR0VOMTJfUkNf
Q0NTX0NDICYmCisJICAgICAgIHBsYW5lID09IDI7Cit9CisKICNlbmRpZiAvKiAgX19JTlRFTF9E
SVNQTEFZX1RZUEVTX0hfXyAqLwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlz
cGxheS9pbnRlbF9wc3IuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfcHNy
LmMKaW5kZXggMmMzNjViNzc4Zjc0Li4zZDE3NmVkZjM4OWIgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMv
Z3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfcHNyLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5
MTUvZGlzcGxheS9pbnRlbF9wc3IuYwpAQCAtMzIsNiArMzIsNyBAQAogI2luY2x1ZGUgImludGVs
X2hkbWkuaCIKICNpbmNsdWRlICJpbnRlbF9wc3IuaCIKICNpbmNsdWRlICJpbnRlbF9zcHJpdGUu
aCIKKyNpbmNsdWRlICJza2xfdW5pdmVyc2FsX3BsYW5lLmgiCiAKIC8qKgogICogRE9DOiBQYW5l
bCBTZWxmIFJlZnJlc2ggKFBTUi9TUkQpCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkx
NS9kaXNwbGF5L2ludGVsX3Nwcml0ZS5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9p
bnRlbF9zcHJpdGUuYwppbmRleCA0MDIwMzAyNTFjNjQuLmE1YjA1ZWMyZjIzMiAxMDA2NDQKLS0t
IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9zcHJpdGUuYworKysgYi9kcml2
ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX3Nwcml0ZS5jCkBAIC0zODAsMjEyICszODAs
NyBAQCBpbnQgaW50ZWxfcGxhbmVfY2hlY2tfc3JjX2Nvb3JkaW5hdGVzKHN0cnVjdCBpbnRlbF9w
bGFuZV9zdGF0ZSAqcGxhbmVfc3RhdGUpCiAJcmV0dXJuIDA7CiB9CiAKLXN0YXRpYyB1OCBpY2xf
bnYxMl95X3BsYW5lX21hc2soc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpCi17Ci0JaWYg
KEhBU19EMTJfUExBTkVfTUlOSU1JWkFUSU9OKGk5MTUpKQotCQlyZXR1cm4gQklUKFBMQU5FX1NQ
UklURTIpIHwgQklUKFBMQU5FX1NQUklURTMpOwotCWVsc2UKLQkJcmV0dXJuIEJJVChQTEFORV9T
UFJJVEU0KSB8IEJJVChQTEFORV9TUFJJVEU1KTsKLX0KLQotYm9vbCBpY2xfaXNfbnYxMl95X3Bs
YW5lKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKLQkJCSBlbnVtIHBsYW5lX2lk
IHBsYW5lX2lkKQotewotCXJldHVybiBJTlRFTF9HRU4oZGV2X3ByaXYpID49IDExICYmCi0JCWlj
bF9udjEyX3lfcGxhbmVfbWFzayhkZXZfcHJpdikgJiBCSVQocGxhbmVfaWQpOwotfQotCi1ib29s
IGljbF9pc19oZHJfcGxhbmUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LCBlbnVt
IHBsYW5lX2lkIHBsYW5lX2lkKQotewotCXJldHVybiBJTlRFTF9HRU4oZGV2X3ByaXYpID49IDEx
ICYmCi0JCWljbF9oZHJfcGxhbmVfbWFzaygpICYgQklUKHBsYW5lX2lkKTsKLX0KLQotc3RhdGlj
IHZvaWQKLXNrbF9wbGFuZV9yYXRpbyhjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0
Y19zdGF0ZSwKLQkJY29uc3Qgc3RydWN0IGludGVsX3BsYW5lX3N0YXRlICpwbGFuZV9zdGF0ZSwK
LQkJdW5zaWduZWQgaW50ICpudW0sIHVuc2lnbmVkIGludCAqZGVuKQotewotCXN0cnVjdCBkcm1f
aTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUocGxhbmVfc3RhdGUtPnVhcGkucGxhbmUt
PmRldik7Ci0JY29uc3Qgc3RydWN0IGRybV9mcmFtZWJ1ZmZlciAqZmIgPSBwbGFuZV9zdGF0ZS0+
aHcuZmI7Ci0KLQlpZiAoZmItPmZvcm1hdC0+Y3BwWzBdID09IDgpIHsKLQkJaWYgKElOVEVMX0dF
TihkZXZfcHJpdikgPj0gMTAgfHwgSVNfR0VNSU5JTEFLRShkZXZfcHJpdikpIHsKLQkJCSpudW0g
PSAxMDsKLQkJCSpkZW4gPSA4OwotCQl9IGVsc2UgewotCQkJKm51bSA9IDk7Ci0JCQkqZGVuID0g
ODsKLQkJfQotCX0gZWxzZSB7Ci0JCSpudW0gPSAxOwotCQkqZGVuID0gMTsKLQl9Ci19Ci0KLXN0
YXRpYyBpbnQgc2tsX3BsYW5lX21pbl9jZGNsayhjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0
ZSAqY3J0Y19zdGF0ZSwKLQkJCSAgICAgICBjb25zdCBzdHJ1Y3QgaW50ZWxfcGxhbmVfc3RhdGUg
KnBsYW5lX3N0YXRlKQotewotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRv
X2k5MTUocGxhbmVfc3RhdGUtPnVhcGkucGxhbmUtPmRldik7Ci0JdW5zaWduZWQgaW50IG51bSwg
ZGVuOwotCXVuc2lnbmVkIGludCBwaXhlbF9yYXRlID0gaW50ZWxfcGxhbmVfcGl4ZWxfcmF0ZShj
cnRjX3N0YXRlLCBwbGFuZV9zdGF0ZSk7Ci0KLQlza2xfcGxhbmVfcmF0aW8oY3J0Y19zdGF0ZSwg
cGxhbmVfc3RhdGUsICZudW0sICZkZW4pOwotCi0JLyogdHdvIHBpeGVscyBwZXIgY2xvY2sgb24g
Z2xrKyAqLwotCWlmIChJTlRFTF9HRU4oZGV2X3ByaXYpID49IDEwIHx8IElTX0dFTUlOSUxBS0Uo
ZGV2X3ByaXYpKQotCQlkZW4gKj0gMjsKLQotCXJldHVybiBESVZfUk9VTkRfVVAocGl4ZWxfcmF0
ZSAqIG51bSwgZGVuKTsKLX0KLQotc3RhdGljIGludCBza2xfcGxhbmVfbWF4X3dpZHRoKGNvbnN0
IHN0cnVjdCBkcm1fZnJhbWVidWZmZXIgKmZiLAotCQkJICAgICAgIGludCBjb2xvcl9wbGFuZSwK
LQkJCSAgICAgICB1bnNpZ25lZCBpbnQgcm90YXRpb24pCi17Ci0JaW50IGNwcCA9IGZiLT5mb3Jt
YXQtPmNwcFtjb2xvcl9wbGFuZV07Ci0KLQlzd2l0Y2ggKGZiLT5tb2RpZmllcikgewotCWNhc2Ug
RFJNX0ZPUk1BVF9NT0RfTElORUFSOgotCWNhc2UgSTkxNV9GT1JNQVRfTU9EX1hfVElMRUQ6Ci0J
CS8qCi0JCSAqIFZhbGlkYXRlZCBsaW1pdCBpcyA0aywgYnV0IGhhcyA1ayBzaG91bGQKLQkJICog
d29yayBhcGFydCBmcm9tIHRoZSBmb2xsb3dpbmcgZmVhdHVyZXM6Ci0JCSAqIC0gWXRpbGUgKGFs
cmVhZHkgbGltaXRlZCB0byA0aykKLQkJICogLSBGUDE2IChhbHJlYWR5IGxpbWl0ZWQgdG8gNGsp
Ci0JCSAqIC0gcmVuZGVyIGNvbXByZXNzaW9uIChhbHJlYWR5IGxpbWl0ZWQgdG8gNGspCi0JCSAq
IC0gS1ZNUiBzcHJpdGUgYW5kIGN1cnNvciAoZG9uJ3QgY2FyZSkKLQkJICogLSBob3Jpem9udGFs
IHBhbm5pbmcgKFRPRE8gdmVyaWZ5IHRoaXMpCi0JCSAqIC0gcGlwZSBhbmQgcGxhbmUgc2NhbGlu
ZyAoVE9ETyB2ZXJpZnkgdGhpcykKLQkJICovCi0JCWlmIChjcHAgPT0gOCkKLQkJCXJldHVybiA0
MDk2OwotCQllbHNlCi0JCQlyZXR1cm4gNTEyMDsKLQljYXNlIEk5MTVfRk9STUFUX01PRF9ZX1RJ
TEVEX0NDUzoKLQljYXNlIEk5MTVfRk9STUFUX01PRF9ZZl9USUxFRF9DQ1M6Ci0JY2FzZSBJOTE1
X0ZPUk1BVF9NT0RfWV9USUxFRF9HRU4xMl9NQ19DQ1M6Ci0JCS8qIEZJWE1FIEFVWCBwbGFuZT8g
Ki8KLQljYXNlIEk5MTVfRk9STUFUX01PRF9ZX1RJTEVEOgotCWNhc2UgSTkxNV9GT1JNQVRfTU9E
X1lmX1RJTEVEOgotCQlpZiAoY3BwID09IDgpCi0JCQlyZXR1cm4gMjA0ODsKLQkJZWxzZQotCQkJ
cmV0dXJuIDQwOTY7Ci0JZGVmYXVsdDoKLQkJTUlTU0lOR19DQVNFKGZiLT5tb2RpZmllcik7Ci0J
CXJldHVybiAyMDQ4OwotCX0KLX0KLQotc3RhdGljIGludCBnbGtfcGxhbmVfbWF4X3dpZHRoKGNv
bnN0IHN0cnVjdCBkcm1fZnJhbWVidWZmZXIgKmZiLAotCQkJICAgICAgIGludCBjb2xvcl9wbGFu
ZSwKLQkJCSAgICAgICB1bnNpZ25lZCBpbnQgcm90YXRpb24pCi17Ci0JaW50IGNwcCA9IGZiLT5m
b3JtYXQtPmNwcFtjb2xvcl9wbGFuZV07Ci0KLQlzd2l0Y2ggKGZiLT5tb2RpZmllcikgewotCWNh
c2UgRFJNX0ZPUk1BVF9NT0RfTElORUFSOgotCWNhc2UgSTkxNV9GT1JNQVRfTU9EX1hfVElMRUQ6
Ci0JCWlmIChjcHAgPT0gOCkKLQkJCXJldHVybiA0MDk2OwotCQllbHNlCi0JCQlyZXR1cm4gNTEy
MDsKLQljYXNlIEk5MTVfRk9STUFUX01PRF9ZX1RJTEVEX0NDUzoKLQljYXNlIEk5MTVfRk9STUFU
X01PRF9ZZl9USUxFRF9DQ1M6Ci0JCS8qIEZJWE1FIEFVWCBwbGFuZT8gKi8KLQljYXNlIEk5MTVf
Rk9STUFUX01PRF9ZX1RJTEVEOgotCWNhc2UgSTkxNV9GT1JNQVRfTU9EX1lmX1RJTEVEOgotCQlp
ZiAoY3BwID09IDgpCi0JCQlyZXR1cm4gMjA0ODsKLQkJZWxzZQotCQkJcmV0dXJuIDUxMjA7Ci0J
ZGVmYXVsdDoKLQkJTUlTU0lOR19DQVNFKGZiLT5tb2RpZmllcik7Ci0JCXJldHVybiAyMDQ4Owot
CX0KLX0KLQotc3RhdGljIGludCBpY2xfcGxhbmVfbWluX3dpZHRoKGNvbnN0IHN0cnVjdCBkcm1f
ZnJhbWVidWZmZXIgKmZiLAotCQkJICAgICAgIGludCBjb2xvcl9wbGFuZSwKLQkJCSAgICAgICB1
bnNpZ25lZCBpbnQgcm90YXRpb24pCi17Ci0JLyogV2FfMTQwMTEyNjQ2NTcsIFdhXzE0MDExMDUw
NTYzOiBnZW4xMSsgKi8KLQlzd2l0Y2ggKGZiLT5mb3JtYXQtPmZvcm1hdCkgewotCWNhc2UgRFJN
X0ZPUk1BVF9DODoKLQkJcmV0dXJuIDE4OwotCWNhc2UgRFJNX0ZPUk1BVF9SR0I1NjU6Ci0JCXJl
dHVybiAxMDsKLQljYXNlIERSTV9GT1JNQVRfWFJHQjg4ODg6Ci0JY2FzZSBEUk1fRk9STUFUX1hC
R1I4ODg4OgotCWNhc2UgRFJNX0ZPUk1BVF9BUkdCODg4ODoKLQljYXNlIERSTV9GT1JNQVRfQUJH
Ujg4ODg6Ci0JY2FzZSBEUk1fRk9STUFUX1hSR0IyMTAxMDEwOgotCWNhc2UgRFJNX0ZPUk1BVF9Y
QkdSMjEwMTAxMDoKLQljYXNlIERSTV9GT1JNQVRfQVJHQjIxMDEwMTA6Ci0JY2FzZSBEUk1fRk9S
TUFUX0FCR1IyMTAxMDEwOgotCWNhc2UgRFJNX0ZPUk1BVF9YVllVMjEwMTAxMDoKLQljYXNlIERS
TV9GT1JNQVRfWTIxMjoKLQljYXNlIERSTV9GT1JNQVRfWTIxNjoKLQkJcmV0dXJuIDY7Ci0JY2Fz
ZSBEUk1fRk9STUFUX05WMTI6Ci0JCXJldHVybiAyMDsKLQljYXNlIERSTV9GT1JNQVRfUDAxMDoK
LQljYXNlIERSTV9GT1JNQVRfUDAxMjoKLQljYXNlIERSTV9GT1JNQVRfUDAxNjoKLQkJcmV0dXJu
IDEyOwotCWNhc2UgRFJNX0ZPUk1BVF9YUkdCMTYxNjE2MTZGOgotCWNhc2UgRFJNX0ZPUk1BVF9Y
QkdSMTYxNjE2MTZGOgotCWNhc2UgRFJNX0ZPUk1BVF9BUkdCMTYxNjE2MTZGOgotCWNhc2UgRFJN
X0ZPUk1BVF9BQkdSMTYxNjE2MTZGOgotCWNhc2UgRFJNX0ZPUk1BVF9YVllVMTJfMTYxNjE2MTY6
Ci0JY2FzZSBEUk1fRk9STUFUX1hWWVUxNjE2MTYxNjoKLQkJcmV0dXJuIDQ7Ci0JZGVmYXVsdDoK
LQkJcmV0dXJuIDE7Ci0JfQotfQotCi1zdGF0aWMgaW50IGljbF9wbGFuZV9tYXhfd2lkdGgoY29u
c3Qgc3RydWN0IGRybV9mcmFtZWJ1ZmZlciAqZmIsCi0JCQkgICAgICAgaW50IGNvbG9yX3BsYW5l
LAotCQkJICAgICAgIHVuc2lnbmVkIGludCByb3RhdGlvbikKLXsKLQlyZXR1cm4gNTEyMDsKLX0K
LQotc3RhdGljIGludCBza2xfcGxhbmVfbWF4X2hlaWdodChjb25zdCBzdHJ1Y3QgZHJtX2ZyYW1l
YnVmZmVyICpmYiwKLQkJCQlpbnQgY29sb3JfcGxhbmUsCi0JCQkJdW5zaWduZWQgaW50IHJvdGF0
aW9uKQotewotCXJldHVybiA0MDk2OwotfQotCi1zdGF0aWMgaW50IGljbF9wbGFuZV9tYXhfaGVp
Z2h0KGNvbnN0IHN0cnVjdCBkcm1fZnJhbWVidWZmZXIgKmZiLAotCQkJCWludCBjb2xvcl9wbGFu
ZSwKLQkJCQl1bnNpZ25lZCBpbnQgcm90YXRpb24pCi17Ci0JcmV0dXJuIDQzMjA7Ci19Ci0KLXN0
YXRpYyB1bnNpZ25lZCBpbnQKLXNrbF9wbGFuZV9tYXhfc3RyaWRlKHN0cnVjdCBpbnRlbF9wbGFu
ZSAqcGxhbmUsCi0JCSAgICAgdTMyIHBpeGVsX2Zvcm1hdCwgdTY0IG1vZGlmaWVyLAotCQkgICAg
IHVuc2lnbmVkIGludCByb3RhdGlvbikKLXsKLQljb25zdCBzdHJ1Y3QgZHJtX2Zvcm1hdF9pbmZv
ICppbmZvID0gZHJtX2Zvcm1hdF9pbmZvKHBpeGVsX2Zvcm1hdCk7Ci0JaW50IGNwcCA9IGluZm8t
PmNwcFswXTsKLQotCS8qCi0JICogIlRoZSBzdHJpZGUgaW4gYnl0ZXMgbXVzdCBub3QgZXhjZWVk
IHRoZQotCSAqIG9mIHRoZSBzaXplIG9mIDhLIHBpeGVscyBhbmQgMzJLIGJ5dGVzLiIKLQkgKi8K
LQlpZiAoZHJtX3JvdGF0aW9uXzkwX29yXzI3MChyb3RhdGlvbikpCi0JCXJldHVybiBtaW4oODE5
MiwgMzI3NjggLyBjcHApOwotCWVsc2UKLQkJcmV0dXJuIG1pbig4MTkyICogY3BwLCAzMjc2OCk7
Ci19Ci0KLXN0YXRpYyB2b2lkCit2b2lkCiBza2xfcHJvZ3JhbV9zY2FsZXIoc3RydWN0IGludGVs
X3BsYW5lICpwbGFuZSwKIAkJICAgY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNf
c3RhdGUsCiAJCSAgIGNvbnN0IHN0cnVjdCBpbnRlbF9wbGFuZV9zdGF0ZSAqcGxhbmVfc3RhdGUp
CkBAIC02NDcsMzE3ICs0NDIsNiBAQCBza2xfcHJvZ3JhbV9zY2FsZXIoc3RydWN0IGludGVsX3Bs
YW5lICpwbGFuZSwKIAkJCSAgKGNydGNfdyA8PCAxNikgfCBjcnRjX2gpOwogfQogCi0vKiBQcmVv
ZmZzZXQgdmFsdWVzIGZvciBZVVYgdG8gUkdCIENvbnZlcnNpb24gKi8KLSNkZWZpbmUgUFJFT0ZG
X1lVVl9UT19SR0JfSEkJCTB4MTgwMAotI2RlZmluZSBQUkVPRkZfWVVWX1RPX1JHQl9NRQkJMHgw
MDAwCi0jZGVmaW5lIFBSRU9GRl9ZVVZfVE9fUkdCX0xPCQkweDE4MDAKLQotI2RlZmluZSAgUk9G
Rih4KSAgICAgICAgICAoKCh4KSAmIDB4ZmZmZikgPDwgMTYpCi0jZGVmaW5lICBHT0ZGKHgpICAg
ICAgICAgICgoKHgpICYgMHhmZmZmKSA8PCAwKQotI2RlZmluZSAgQk9GRih4KSAgICAgICAgICAo
KCh4KSAmIDB4ZmZmZikgPDwgMTYpCi0KLS8qCi0gKiBQcm9ncmFtcyB0aGUgaW5wdXQgY29sb3Ig
c3BhY2UgY29udmVyc2lvbiBzdGFnZSBmb3IgSUNMIEhEUiBwbGFuZXMuCi0gKiBOb3RlIHRoYXQg
aXQgaXMgYXNzdW1lZCB0aGF0IHRoaXMgc3RhZ2UgYWx3YXlzIGhhcHBlbnMgYWZ0ZXIgWVVWCi0g
KiByYW5nZSBjb3JyZWN0aW9uLiBUaHVzLCB0aGUgaW5wdXQgdG8gdGhpcyBzdGFnZSBpcyBhc3N1
bWVkIHRvIGJlCi0gKiBpbiBmdWxsLXJhbmdlIFlDYkNyLgotICovCi1zdGF0aWMgdm9pZAotaWNs
X3Byb2dyYW1faW5wdXRfY3NjKHN0cnVjdCBpbnRlbF9wbGFuZSAqcGxhbmUsCi0JCSAgICAgIGNv
bnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlLAotCQkgICAgICBjb25zdCBz
dHJ1Y3QgaW50ZWxfcGxhbmVfc3RhdGUgKnBsYW5lX3N0YXRlKQotewotCXN0cnVjdCBkcm1faTkx
NV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUocGxhbmUtPmJhc2UuZGV2KTsKLQllbnVtIHBp
cGUgcGlwZSA9IHBsYW5lLT5waXBlOwotCWVudW0gcGxhbmVfaWQgcGxhbmVfaWQgPSBwbGFuZS0+
aWQ7Ci0KLQlzdGF0aWMgY29uc3QgdTE2IGlucHV0X2NzY19tYXRyaXhbXVs5XSA9IHsKLQkJLyoK
LQkJICogQlQuNjAxIGZ1bGwgcmFuZ2UgWUNiQ3IgLT4gZnVsbCByYW5nZSBSR0IKLQkJICogVGhl
IG1hdHJpeCByZXF1aXJlZCBpcyA6Ci0JCSAqIFsxLjAwMCwgMC4wMDAsIDEuMzcxLAotCQkgKiAg
MS4wMDAsIC0wLjMzNiwgLTAuNjk4LAotCQkgKiAgMS4wMDAsIDEuNzMyLCAwLjAwMDBdCi0JCSAq
LwotCQlbRFJNX0NPTE9SX1lDQkNSX0JUNjAxXSA9IHsKLQkJCTB4N0FGOCwgMHg3ODAwLCAweDAs
Ci0JCQkweDhCMjgsIDB4NzgwMCwgMHg5QUMwLAotCQkJMHgwLCAweDc4MDAsIDB4N0REOCwKLQkJ
fSwKLQkJLyoKLQkJICogQlQuNzA5IGZ1bGwgcmFuZ2UgWUNiQ3IgLT4gZnVsbCByYW5nZSBSR0IK
LQkJICogVGhlIG1hdHJpeCByZXF1aXJlZCBpcyA6Ci0JCSAqIFsxLjAwMCwgMC4wMDAsIDEuNTc0
LAotCQkgKiAgMS4wMDAsIC0wLjE4NywgLTAuNDY4LAotCQkgKiAgMS4wMDAsIDEuODU1LCAwLjAw
MDBdCi0JCSAqLwotCQlbRFJNX0NPTE9SX1lDQkNSX0JUNzA5XSA9IHsKLQkJCTB4N0M5OCwgMHg3
ODAwLCAweDAsCi0JCQkweDlFRjgsIDB4NzgwMCwgMHhBQzAwLAotCQkJMHgwLCAweDc4MDAsICAw
eDdFRDgsCi0JCX0sCi0JCS8qCi0JCSAqIEJULjIwMjAgZnVsbCByYW5nZSBZQ2JDciAtPiBmdWxs
IHJhbmdlIFJHQgotCQkgKiBUaGUgbWF0cml4IHJlcXVpcmVkIGlzIDoKLQkJICogWzEuMDAwLCAw
LjAwMCwgMS40NzQsCi0JCSAqICAxLjAwMCwgLTAuMTY0NSwgLTAuNTcxMywKLQkJICogIDEuMDAw
LCAxLjg4MTQsIDAuMDAwMF0KLQkJICovCi0JCVtEUk1fQ09MT1JfWUNCQ1JfQlQyMDIwXSA9IHsK
LQkJCTB4N0JDOCwgMHg3ODAwLCAweDAsCi0JCQkweDg5MjgsIDB4NzgwMCwgMHhBQTg4LAotCQkJ
MHgwLCAweDc4MDAsIDB4N0YxMCwKLQkJfSwKLQl9OwotCWNvbnN0IHUxNiAqY3NjID0gaW5wdXRf
Y3NjX21hdHJpeFtwbGFuZV9zdGF0ZS0+aHcuY29sb3JfZW5jb2RpbmddOwotCi0JaW50ZWxfZGVf
d3JpdGVfZncoZGV2X3ByaXYsIFBMQU5FX0lOUFVUX0NTQ19DT0VGRihwaXBlLCBwbGFuZV9pZCwg
MCksCi0JCQkgIFJPRkYoY3NjWzBdKSB8IEdPRkYoY3NjWzFdKSk7Ci0JaW50ZWxfZGVfd3JpdGVf
ZncoZGV2X3ByaXYsIFBMQU5FX0lOUFVUX0NTQ19DT0VGRihwaXBlLCBwbGFuZV9pZCwgMSksCi0J
CQkgIEJPRkYoY3NjWzJdKSk7Ci0JaW50ZWxfZGVfd3JpdGVfZncoZGV2X3ByaXYsIFBMQU5FX0lO
UFVUX0NTQ19DT0VGRihwaXBlLCBwbGFuZV9pZCwgMiksCi0JCQkgIFJPRkYoY3NjWzNdKSB8IEdP
RkYoY3NjWzRdKSk7Ci0JaW50ZWxfZGVfd3JpdGVfZncoZGV2X3ByaXYsIFBMQU5FX0lOUFVUX0NT
Q19DT0VGRihwaXBlLCBwbGFuZV9pZCwgMyksCi0JCQkgIEJPRkYoY3NjWzVdKSk7Ci0JaW50ZWxf
ZGVfd3JpdGVfZncoZGV2X3ByaXYsIFBMQU5FX0lOUFVUX0NTQ19DT0VGRihwaXBlLCBwbGFuZV9p
ZCwgNCksCi0JCQkgIFJPRkYoY3NjWzZdKSB8IEdPRkYoY3NjWzddKSk7Ci0JaW50ZWxfZGVfd3Jp
dGVfZncoZGV2X3ByaXYsIFBMQU5FX0lOUFVUX0NTQ19DT0VGRihwaXBlLCBwbGFuZV9pZCwgNSks
Ci0JCQkgIEJPRkYoY3NjWzhdKSk7Ci0KLQlpbnRlbF9kZV93cml0ZV9mdyhkZXZfcHJpdiwgUExB
TkVfSU5QVVRfQ1NDX1BSRU9GRihwaXBlLCBwbGFuZV9pZCwgMCksCi0JCQkgIFBSRU9GRl9ZVVZf
VE9fUkdCX0hJKTsKLQlpbnRlbF9kZV93cml0ZV9mdyhkZXZfcHJpdiwgUExBTkVfSU5QVVRfQ1ND
X1BSRU9GRihwaXBlLCBwbGFuZV9pZCwgMSksCi0JCQkgIFBSRU9GRl9ZVVZfVE9fUkdCX01FKTsK
LQlpbnRlbF9kZV93cml0ZV9mdyhkZXZfcHJpdiwgUExBTkVfSU5QVVRfQ1NDX1BSRU9GRihwaXBl
LCBwbGFuZV9pZCwgMiksCi0JCQkgIFBSRU9GRl9ZVVZfVE9fUkdCX0xPKTsKLQlpbnRlbF9kZV93
cml0ZV9mdyhkZXZfcHJpdiwKLQkJCSAgUExBTkVfSU5QVVRfQ1NDX1BPU1RPRkYocGlwZSwgcGxh
bmVfaWQsIDApLCAweDApOwotCWludGVsX2RlX3dyaXRlX2Z3KGRldl9wcml2LAotCQkJICBQTEFO
RV9JTlBVVF9DU0NfUE9TVE9GRihwaXBlLCBwbGFuZV9pZCwgMSksIDB4MCk7Ci0JaW50ZWxfZGVf
d3JpdGVfZncoZGV2X3ByaXYsCi0JCQkgIFBMQU5FX0lOUFVUX0NTQ19QT1NUT0ZGKHBpcGUsIHBs
YW5lX2lkLCAyKSwgMHgwKTsKLX0KLQotc3RhdGljIHZvaWQKLXNrbF9wbGFuZV9hc3luY19mbGlw
KHN0cnVjdCBpbnRlbF9wbGFuZSAqcGxhbmUsCi0JCSAgICAgY29uc3Qgc3RydWN0IGludGVsX2Ny
dGNfc3RhdGUgKmNydGNfc3RhdGUsCi0JCSAgICAgY29uc3Qgc3RydWN0IGludGVsX3BsYW5lX3N0
YXRlICpwbGFuZV9zdGF0ZSwKLQkJICAgICBib29sIGFzeW5jX2ZsaXApCi17Ci0Jc3RydWN0IGRy
bV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShwbGFuZS0+YmFzZS5kZXYpOwotCXVu
c2lnbmVkIGxvbmcgaXJxZmxhZ3M7Ci0JZW51bSBwbGFuZV9pZCBwbGFuZV9pZCA9IHBsYW5lLT5p
ZDsKLQllbnVtIHBpcGUgcGlwZSA9IHBsYW5lLT5waXBlOwotCXUzMiBzdXJmX2FkZHIgPSBwbGFu
ZV9zdGF0ZS0+Y29sb3JfcGxhbmVbMF0ub2Zmc2V0OwotCXUzMiBwbGFuZV9jdGwgPSBwbGFuZV9z
dGF0ZS0+Y3RsOwotCi0JcGxhbmVfY3RsIHw9IHNrbF9wbGFuZV9jdGxfY3J0YyhjcnRjX3N0YXRl
KTsKLQotCWlmIChhc3luY19mbGlwKQotCQlwbGFuZV9jdGwgfD0gUExBTkVfQ1RMX0FTWU5DX0ZM
SVA7Ci0KLQlzcGluX2xvY2tfaXJxc2F2ZSgmZGV2X3ByaXYtPnVuY29yZS5sb2NrLCBpcnFmbGFn
cyk7Ci0KLQlpbnRlbF9kZV93cml0ZV9mdyhkZXZfcHJpdiwgUExBTkVfQ1RMKHBpcGUsIHBsYW5l
X2lkKSwgcGxhbmVfY3RsKTsKLQlpbnRlbF9kZV93cml0ZV9mdyhkZXZfcHJpdiwgUExBTkVfU1VS
RihwaXBlLCBwbGFuZV9pZCksCi0JCQkgIGludGVsX3BsYW5lX2dndHRfb2Zmc2V0KHBsYW5lX3N0
YXRlKSArIHN1cmZfYWRkcik7Ci0KLQlzcGluX3VubG9ja19pcnFyZXN0b3JlKCZkZXZfcHJpdi0+
dW5jb3JlLmxvY2ssIGlycWZsYWdzKTsKLX0KLQotc3RhdGljIHZvaWQKLXNrbF9wcm9ncmFtX3Bs
YW5lKHN0cnVjdCBpbnRlbF9wbGFuZSAqcGxhbmUsCi0JCSAgY29uc3Qgc3RydWN0IGludGVsX2Ny
dGNfc3RhdGUgKmNydGNfc3RhdGUsCi0JCSAgY29uc3Qgc3RydWN0IGludGVsX3BsYW5lX3N0YXRl
ICpwbGFuZV9zdGF0ZSwKLQkJICBpbnQgY29sb3JfcGxhbmUpCi17Ci0Jc3RydWN0IGRybV9pOTE1
X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShwbGFuZS0+YmFzZS5kZXYpOwotCWVudW0gcGxh
bmVfaWQgcGxhbmVfaWQgPSBwbGFuZS0+aWQ7Ci0JZW51bSBwaXBlIHBpcGUgPSBwbGFuZS0+cGlw
ZTsKLQljb25zdCBzdHJ1Y3QgZHJtX2ludGVsX3Nwcml0ZV9jb2xvcmtleSAqa2V5ID0gJnBsYW5l
X3N0YXRlLT5ja2V5OwotCXUzMiBzdXJmX2FkZHIgPSBwbGFuZV9zdGF0ZS0+Y29sb3JfcGxhbmVb
Y29sb3JfcGxhbmVdLm9mZnNldDsKLQl1MzIgc3RyaWRlID0gc2tsX3BsYW5lX3N0cmlkZShwbGFu
ZV9zdGF0ZSwgY29sb3JfcGxhbmUpOwotCWNvbnN0IHN0cnVjdCBkcm1fZnJhbWVidWZmZXIgKmZi
ID0gcGxhbmVfc3RhdGUtPmh3LmZiOwotCWludCBhdXhfcGxhbmUgPSBpbnRlbF9tYWluX3RvX2F1
eF9wbGFuZShmYiwgY29sb3JfcGxhbmUpOwotCWludCBjcnRjX3ggPSBwbGFuZV9zdGF0ZS0+dWFw
aS5kc3QueDE7Ci0JaW50IGNydGNfeSA9IHBsYW5lX3N0YXRlLT51YXBpLmRzdC55MTsKLQl1MzIg
eCA9IHBsYW5lX3N0YXRlLT5jb2xvcl9wbGFuZVtjb2xvcl9wbGFuZV0ueDsKLQl1MzIgeSA9IHBs
YW5lX3N0YXRlLT5jb2xvcl9wbGFuZVtjb2xvcl9wbGFuZV0ueTsKLQl1MzIgc3JjX3cgPSBkcm1f
cmVjdF93aWR0aCgmcGxhbmVfc3RhdGUtPnVhcGkuc3JjKSA+PiAxNjsKLQl1MzIgc3JjX2ggPSBk
cm1fcmVjdF9oZWlnaHQoJnBsYW5lX3N0YXRlLT51YXBpLnNyYykgPj4gMTY7Ci0JdTggYWxwaGEg
PSBwbGFuZV9zdGF0ZS0+aHcuYWxwaGEgPj4gODsKLQl1MzIgcGxhbmVfY29sb3JfY3RsID0gMCwg
YXV4X2Rpc3QgPSAwOwotCXVuc2lnbmVkIGxvbmcgaXJxZmxhZ3M7Ci0JdTMyIGtleW1zaywga2V5
bWF4OwotCXUzMiBwbGFuZV9jdGwgPSBwbGFuZV9zdGF0ZS0+Y3RsOwotCi0JcGxhbmVfY3RsIHw9
IHNrbF9wbGFuZV9jdGxfY3J0YyhjcnRjX3N0YXRlKTsKLQotCWlmIChJTlRFTF9HRU4oZGV2X3By
aXYpID49IDEwIHx8IElTX0dFTUlOSUxBS0UoZGV2X3ByaXYpKQotCQlwbGFuZV9jb2xvcl9jdGwg
PSBwbGFuZV9zdGF0ZS0+Y29sb3JfY3RsIHwKLQkJCWdsa19wbGFuZV9jb2xvcl9jdGxfY3J0Yyhj
cnRjX3N0YXRlKTsKLQotCS8qIFNpemVzIGFyZSAwIGJhc2VkICovCi0Jc3JjX3ctLTsKLQlzcmNf
aC0tOwotCi0Ja2V5bWF4ID0gKGtleS0+bWF4X3ZhbHVlICYgMHhmZmZmZmYpIHwgUExBTkVfS0VZ
TUFYX0FMUEhBKGFscGhhKTsKLQotCWtleW1zayA9IGtleS0+Y2hhbm5lbF9tYXNrICYgMHg3ZmZm
ZmZmOwotCWlmIChhbHBoYSA8IDB4ZmYpCi0JCWtleW1zayB8PSBQTEFORV9LRVlNU0tfQUxQSEFf
RU5BQkxFOwotCi0JLyogVGhlIHNjYWxlciB3aWxsIGhhbmRsZSB0aGUgb3V0cHV0IHBvc2l0aW9u
ICovCi0JaWYgKHBsYW5lX3N0YXRlLT5zY2FsZXJfaWQgPj0gMCkgewotCQljcnRjX3ggPSAwOwot
CQljcnRjX3kgPSAwOwotCX0KLQotCWlmIChhdXhfcGxhbmUpIHsKLQkJYXV4X2Rpc3QgPSBwbGFu
ZV9zdGF0ZS0+Y29sb3JfcGxhbmVbYXV4X3BsYW5lXS5vZmZzZXQgLSBzdXJmX2FkZHI7Ci0KLQkJ
aWYgKElOVEVMX0dFTihkZXZfcHJpdikgPCAxMikKLQkJCWF1eF9kaXN0IHw9IHNrbF9wbGFuZV9z
dHJpZGUocGxhbmVfc3RhdGUsIGF1eF9wbGFuZSk7Ci0JfQotCi0Jc3Bpbl9sb2NrX2lycXNhdmUo
JmRldl9wcml2LT51bmNvcmUubG9jaywgaXJxZmxhZ3MpOwotCi0JaW50ZWxfZGVfd3JpdGVfZnco
ZGV2X3ByaXYsIFBMQU5FX1NUUklERShwaXBlLCBwbGFuZV9pZCksIHN0cmlkZSk7Ci0JaW50ZWxf
ZGVfd3JpdGVfZncoZGV2X3ByaXYsIFBMQU5FX1BPUyhwaXBlLCBwbGFuZV9pZCksCi0JCQkgIChj
cnRjX3kgPDwgMTYpIHwgY3J0Y194KTsKLQlpbnRlbF9kZV93cml0ZV9mdyhkZXZfcHJpdiwgUExB
TkVfU0laRShwaXBlLCBwbGFuZV9pZCksCi0JCQkgIChzcmNfaCA8PCAxNikgfCBzcmNfdyk7Ci0K
LQlpbnRlbF9kZV93cml0ZV9mdyhkZXZfcHJpdiwgUExBTkVfQVVYX0RJU1QocGlwZSwgcGxhbmVf
aWQpLCBhdXhfZGlzdCk7Ci0KLQlpZiAoaWNsX2lzX2hkcl9wbGFuZShkZXZfcHJpdiwgcGxhbmVf
aWQpKQotCQlpbnRlbF9kZV93cml0ZV9mdyhkZXZfcHJpdiwgUExBTkVfQ1VTX0NUTChwaXBlLCBw
bGFuZV9pZCksCi0JCQkJICBwbGFuZV9zdGF0ZS0+Y3VzX2N0bCk7Ci0KLQlpZiAoSU5URUxfR0VO
KGRldl9wcml2KSA+PSAxMCB8fCBJU19HRU1JTklMQUtFKGRldl9wcml2KSkKLQkJaW50ZWxfZGVf
d3JpdGVfZncoZGV2X3ByaXYsIFBMQU5FX0NPTE9SX0NUTChwaXBlLCBwbGFuZV9pZCksCi0JCQkJ
ICBwbGFuZV9jb2xvcl9jdGwpOwotCi0JaWYgKGZiLT5mb3JtYXQtPmlzX3l1diAmJiBpY2xfaXNf
aGRyX3BsYW5lKGRldl9wcml2LCBwbGFuZV9pZCkpCi0JCWljbF9wcm9ncmFtX2lucHV0X2NzYyhw
bGFuZSwgY3J0Y19zdGF0ZSwgcGxhbmVfc3RhdGUpOwotCi0JaWYgKGZiLT5tb2RpZmllciA9PSBJ
OTE1X0ZPUk1BVF9NT0RfWV9USUxFRF9HRU4xMl9SQ19DQ1NfQ0MpCi0JCWludGVsX3VuY29yZV93
cml0ZTY0X2Z3KCZkZXZfcHJpdi0+dW5jb3JlLAotCQkJCQlQTEFORV9DQ19WQUwocGlwZSwgcGxh
bmVfaWQpLCBwbGFuZV9zdGF0ZS0+Y2N2YWwpOwotCi0Jc2tsX3dyaXRlX3BsYW5lX3dtKHBsYW5l
LCBjcnRjX3N0YXRlKTsKLQotCWludGVsX2RlX3dyaXRlX2Z3KGRldl9wcml2LCBQTEFORV9LRVlW
QUwocGlwZSwgcGxhbmVfaWQpLAotCQkJICBrZXktPm1pbl92YWx1ZSk7Ci0JaW50ZWxfZGVfd3Jp
dGVfZncoZGV2X3ByaXYsIFBMQU5FX0tFWU1TSyhwaXBlLCBwbGFuZV9pZCksIGtleW1zayk7Ci0J
aW50ZWxfZGVfd3JpdGVfZncoZGV2X3ByaXYsIFBMQU5FX0tFWU1BWChwaXBlLCBwbGFuZV9pZCks
IGtleW1heCk7Ci0KLQlpbnRlbF9kZV93cml0ZV9mdyhkZXZfcHJpdiwgUExBTkVfT0ZGU0VUKHBp
cGUsIHBsYW5lX2lkKSwKLQkJCSAgKHkgPDwgMTYpIHwgeCk7Ci0KLQlpZiAoSU5URUxfR0VOKGRl
dl9wcml2KSA8IDExKQotCQlpbnRlbF9kZV93cml0ZV9mdyhkZXZfcHJpdiwgUExBTkVfQVVYX09G
RlNFVChwaXBlLCBwbGFuZV9pZCksCi0JCQkJICAocGxhbmVfc3RhdGUtPmNvbG9yX3BsYW5lWzFd
LnkgPDwgMTYpIHwgcGxhbmVfc3RhdGUtPmNvbG9yX3BsYW5lWzFdLngpOwotCi0JaWYgKCFkcm1f
YXRvbWljX2NydGNfbmVlZHNfbW9kZXNldCgmY3J0Y19zdGF0ZS0+dWFwaSkpCi0JCWludGVsX3Bz
cjJfcHJvZ3JhbV9wbGFuZV9zZWxfZmV0Y2gocGxhbmUsIGNydGNfc3RhdGUsIHBsYW5lX3N0YXRl
LCBjb2xvcl9wbGFuZSk7Ci0KLQkvKgotCSAqIFRoZSBjb250cm9sIHJlZ2lzdGVyIHNlbGYtYXJt
cyBpZiB0aGUgcGxhbmUgd2FzIHByZXZpb3VzbHkKLQkgKiBkaXNhYmxlZC4gVHJ5IHRvIG1ha2Ug
dGhlIHBsYW5lIGVuYWJsZSBhdG9taWMgYnkgd3JpdGluZwotCSAqIHRoZSBjb250cm9sIHJlZ2lz
dGVyIGp1c3QgYmVmb3JlIHRoZSBzdXJmYWNlIHJlZ2lzdGVyLgotCSAqLwotCWludGVsX2RlX3dy
aXRlX2Z3KGRldl9wcml2LCBQTEFORV9DVEwocGlwZSwgcGxhbmVfaWQpLCBwbGFuZV9jdGwpOwot
CWludGVsX2RlX3dyaXRlX2Z3KGRldl9wcml2LCBQTEFORV9TVVJGKHBpcGUsIHBsYW5lX2lkKSwK
LQkJCSAgaW50ZWxfcGxhbmVfZ2d0dF9vZmZzZXQocGxhbmVfc3RhdGUpICsgc3VyZl9hZGRyKTsK
LQotCWlmIChwbGFuZV9zdGF0ZS0+c2NhbGVyX2lkID49IDApCi0JCXNrbF9wcm9ncmFtX3NjYWxl
cihwbGFuZSwgY3J0Y19zdGF0ZSwgcGxhbmVfc3RhdGUpOwotCi0Jc3Bpbl91bmxvY2tfaXJxcmVz
dG9yZSgmZGV2X3ByaXYtPnVuY29yZS5sb2NrLCBpcnFmbGFncyk7Ci19Ci0KLXN0YXRpYyB2b2lk
Ci1za2xfdXBkYXRlX3BsYW5lKHN0cnVjdCBpbnRlbF9wbGFuZSAqcGxhbmUsCi0JCSBjb25zdCBz
dHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSwKLQkJIGNvbnN0IHN0cnVjdCBpbnRl
bF9wbGFuZV9zdGF0ZSAqcGxhbmVfc3RhdGUpCi17Ci0JaW50IGNvbG9yX3BsYW5lID0gMDsKLQot
CWlmIChwbGFuZV9zdGF0ZS0+cGxhbmFyX2xpbmtlZF9wbGFuZSAmJiAhcGxhbmVfc3RhdGUtPnBs
YW5hcl9zbGF2ZSkKLQkJLyogUHJvZ3JhbSB0aGUgVVYgcGxhbmUgb24gcGxhbmFyIG1hc3RlciAq
LwotCQljb2xvcl9wbGFuZSA9IDE7Ci0KLQlza2xfcHJvZ3JhbV9wbGFuZShwbGFuZSwgY3J0Y19z
dGF0ZSwgcGxhbmVfc3RhdGUsIGNvbG9yX3BsYW5lKTsKLX0KLXN0YXRpYyB2b2lkCi1za2xfZGlz
YWJsZV9wbGFuZShzdHJ1Y3QgaW50ZWxfcGxhbmUgKnBsYW5lLAotCQkgIGNvbnN0IHN0cnVjdCBp
bnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlKQotewotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRl
ICpkZXZfcHJpdiA9IHRvX2k5MTUocGxhbmUtPmJhc2UuZGV2KTsKLQllbnVtIHBsYW5lX2lkIHBs
YW5lX2lkID0gcGxhbmUtPmlkOwotCWVudW0gcGlwZSBwaXBlID0gcGxhbmUtPnBpcGU7Ci0JdW5z
aWduZWQgbG9uZyBpcnFmbGFnczsKLQotCXNwaW5fbG9ja19pcnFzYXZlKCZkZXZfcHJpdi0+dW5j
b3JlLmxvY2ssIGlycWZsYWdzKTsKLQotCWlmIChpY2xfaXNfaGRyX3BsYW5lKGRldl9wcml2LCBw
bGFuZV9pZCkpCi0JCWludGVsX2RlX3dyaXRlX2Z3KGRldl9wcml2LCBQTEFORV9DVVNfQ1RMKHBp
cGUsIHBsYW5lX2lkKSwgMCk7Ci0KLQlza2xfd3JpdGVfcGxhbmVfd20ocGxhbmUsIGNydGNfc3Rh
dGUpOwotCi0JaW50ZWxfZGVfd3JpdGVfZncoZGV2X3ByaXYsIFBMQU5FX0NUTChwaXBlLCBwbGFu
ZV9pZCksIDApOwotCWludGVsX2RlX3dyaXRlX2Z3KGRldl9wcml2LCBQTEFORV9TVVJGKHBpcGUs
IHBsYW5lX2lkKSwgMCk7Ci0KLQlzcGluX3VubG9ja19pcnFyZXN0b3JlKCZkZXZfcHJpdi0+dW5j
b3JlLmxvY2ssIGlycWZsYWdzKTsKLX0KLQotc3RhdGljIGJvb2wKLXNrbF9wbGFuZV9nZXRfaHdf
c3RhdGUoc3RydWN0IGludGVsX3BsYW5lICpwbGFuZSwKLQkJICAgICAgIGVudW0gcGlwZSAqcGlw
ZSkKLXsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KHBsYW5l
LT5iYXNlLmRldik7Ci0JZW51bSBpbnRlbF9kaXNwbGF5X3Bvd2VyX2RvbWFpbiBwb3dlcl9kb21h
aW47Ci0JZW51bSBwbGFuZV9pZCBwbGFuZV9pZCA9IHBsYW5lLT5pZDsKLQlpbnRlbF93YWtlcmVm
X3Qgd2FrZXJlZjsKLQlib29sIHJldDsKLQotCXBvd2VyX2RvbWFpbiA9IFBPV0VSX0RPTUFJTl9Q
SVBFKHBsYW5lLT5waXBlKTsKLQl3YWtlcmVmID0gaW50ZWxfZGlzcGxheV9wb3dlcl9nZXRfaWZf
ZW5hYmxlZChkZXZfcHJpdiwgcG93ZXJfZG9tYWluKTsKLQlpZiAoIXdha2VyZWYpCi0JCXJldHVy
biBmYWxzZTsKLQotCXJldCA9IGludGVsX2RlX3JlYWQoZGV2X3ByaXYsIFBMQU5FX0NUTChwbGFu
ZS0+cGlwZSwgcGxhbmVfaWQpKSAmIFBMQU5FX0NUTF9FTkFCTEU7Ci0KLQkqcGlwZSA9IHBsYW5l
LT5waXBlOwotCi0JaW50ZWxfZGlzcGxheV9wb3dlcl9wdXQoZGV2X3ByaXYsIHBvd2VyX2RvbWFp
biwgd2FrZXJlZik7Ci0KLQlyZXR1cm4gcmV0OwotfQotCi1zdGF0aWMgdm9pZAotc2tsX3BsYW5l
X2VuYWJsZV9mbGlwX2RvbmUoc3RydWN0IGludGVsX3BsYW5lICpwbGFuZSkKLXsKLQlzdHJ1Y3Qg
ZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IHRvX2k5MTUocGxhbmUtPmJhc2UuZGV2KTsKLQllbnVt
IHBpcGUgcGlwZSA9IHBsYW5lLT5waXBlOwotCi0Jc3Bpbl9sb2NrX2lycSgmaTkxNS0+aXJxX2xv
Y2spOwotCWJkd19lbmFibGVfcGlwZV9pcnEoaTkxNSwgcGlwZSwgR0VOOV9QSVBFX1BMQU5FX0ZM
SVBfRE9ORShwbGFuZS0+aWQpKTsKLQlzcGluX3VubG9ja19pcnEoJmk5MTUtPmlycV9sb2NrKTsK
LX0KLQotc3RhdGljIHZvaWQKLXNrbF9wbGFuZV9kaXNhYmxlX2ZsaXBfZG9uZShzdHJ1Y3QgaW50
ZWxfcGxhbmUgKnBsYW5lKQotewotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0gdG9f
aTkxNShwbGFuZS0+YmFzZS5kZXYpOwotCWVudW0gcGlwZSBwaXBlID0gcGxhbmUtPnBpcGU7Ci0K
LQlzcGluX2xvY2tfaXJxKCZpOTE1LT5pcnFfbG9jayk7Ci0JYmR3X2Rpc2FibGVfcGlwZV9pcnEo
aTkxNSwgcGlwZSwgR0VOOV9QSVBFX1BMQU5FX0ZMSVBfRE9ORShwbGFuZS0+aWQpKTsKLQlzcGlu
X3VubG9ja19pcnEoJmk5MTUtPmlycV9sb2NrKTsKLX0KLQogc3RhdGljIHZvaWQgaTl4eF9wbGFu
ZV9saW5lYXJfZ2FtbWEodTE2IGdhbW1hWzhdKQogewogCS8qIFRoZSBwb2ludHMgYXJlIG5vdCBl
dmVubHkgc3BhY2VkLiAqLwpAQCAtMjMwMSwyNTMgKzE3ODUsMTkgQEAgdmx2X3Nwcml0ZV9jaGVj
ayhzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSwKIAlyZXR1cm4gMDsKIH0KIAot
c3RhdGljIGJvb2wgaW50ZWxfZm9ybWF0X2lzX3AwMXgodTMyIGZvcm1hdCkKK3N0YXRpYyBib29s
IGhhc19kc3Rfa2V5X2luX3ByaW1hcnlfcGxhbmUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRl
dl9wcml2KQogewotCXN3aXRjaCAoZm9ybWF0KSB7Ci0JY2FzZSBEUk1fRk9STUFUX1AwMTA6Ci0J
Y2FzZSBEUk1fRk9STUFUX1AwMTI6Ci0JY2FzZSBEUk1fRk9STUFUX1AwMTY6Ci0JCXJldHVybiB0
cnVlOwotCWRlZmF1bHQ6Ci0JCXJldHVybiBmYWxzZTsKLQl9CisJcmV0dXJuIElOVEVMX0dFTihk
ZXZfcHJpdikgPj0gOTsKIH0KIAotc3RhdGljIGludCBza2xfcGxhbmVfY2hlY2tfZmIoY29uc3Qg
c3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUsCi0JCQkgICAgICBjb25zdCBzdHJ1
Y3QgaW50ZWxfcGxhbmVfc3RhdGUgKnBsYW5lX3N0YXRlKQorc3RhdGljIHZvaWQgaW50ZWxfcGxh
bmVfc2V0X2NrZXkoc3RydWN0IGludGVsX3BsYW5lX3N0YXRlICpwbGFuZV9zdGF0ZSwKKwkJCQkg
Y29uc3Qgc3RydWN0IGRybV9pbnRlbF9zcHJpdGVfY29sb3JrZXkgKnNldCkKIHsKIAlzdHJ1Y3Qg
aW50ZWxfcGxhbmUgKnBsYW5lID0gdG9faW50ZWxfcGxhbmUocGxhbmVfc3RhdGUtPnVhcGkucGxh
bmUpOwogCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUocGxhbmUt
PmJhc2UuZGV2KTsKLQljb25zdCBzdHJ1Y3QgZHJtX2ZyYW1lYnVmZmVyICpmYiA9IHBsYW5lX3N0
YXRlLT5ody5mYjsKLQl1bnNpZ25lZCBpbnQgcm90YXRpb24gPSBwbGFuZV9zdGF0ZS0+aHcucm90
YXRpb247Ci0Jc3RydWN0IGRybV9mb3JtYXRfbmFtZV9idWYgZm9ybWF0X25hbWU7CisJc3RydWN0
IGRybV9pbnRlbF9zcHJpdGVfY29sb3JrZXkgKmtleSA9ICZwbGFuZV9zdGF0ZS0+Y2tleTsKIAot
CWlmICghZmIpCi0JCXJldHVybiAwOwotCi0JaWYgKHJvdGF0aW9uICYgfihEUk1fTU9ERV9ST1RB
VEVfMCB8IERSTV9NT0RFX1JPVEFURV8xODApICYmCi0JICAgIGlzX2Njc19tb2RpZmllcihmYi0+
bW9kaWZpZXIpKSB7Ci0JCWRybV9kYmdfa21zKCZkZXZfcHJpdi0+ZHJtLAotCQkJICAgICJSQyBz
dXBwb3J0IG9ubHkgd2l0aCAwLzE4MCBkZWdyZWUgcm90YXRpb24gKCV4KVxuIiwKLQkJCSAgICBy
b3RhdGlvbik7Ci0JCXJldHVybiAtRUlOVkFMOwotCX0KLQotCWlmIChyb3RhdGlvbiAmIERSTV9N
T0RFX1JFRkxFQ1RfWCAmJgotCSAgICBmYi0+bW9kaWZpZXIgPT0gRFJNX0ZPUk1BVF9NT0RfTElO
RUFSKSB7Ci0JCWRybV9kYmdfa21zKCZkZXZfcHJpdi0+ZHJtLAotCQkJICAgICJob3Jpem9udGFs
IGZsaXAgaXMgbm90IHN1cHBvcnRlZCB3aXRoIGxpbmVhciBzdXJmYWNlIGZvcm1hdHNcbiIpOwot
CQlyZXR1cm4gLUVJTlZBTDsKLQl9Ci0KLQlpZiAoZHJtX3JvdGF0aW9uXzkwX29yXzI3MChyb3Rh
dGlvbikpIHsKLQkJaWYgKGZiLT5tb2RpZmllciAhPSBJOTE1X0ZPUk1BVF9NT0RfWV9USUxFRCAm
JgotCQkgICAgZmItPm1vZGlmaWVyICE9IEk5MTVfRk9STUFUX01PRF9ZZl9USUxFRCkgewotCQkJ
ZHJtX2RiZ19rbXMoJmRldl9wcml2LT5kcm0sCi0JCQkJICAgICJZL1lmIHRpbGluZyByZXF1aXJl
ZCBmb3IgOTAvMjcwIVxuIik7Ci0JCQlyZXR1cm4gLUVJTlZBTDsKLQkJfQotCi0JCS8qCi0JCSAq
IDkwLzI3MCBpcyBub3QgYWxsb3dlZCB3aXRoIFJHQjY0IDE2OjE2OjE2OjE2IGFuZAotCQkgKiBJ
bmRleGVkIDgtYml0LiBSR0IgMTYtYml0IDU6Njo1IGlzIGFsbG93ZWQgZ2VuMTEgb253YXJkcy4K
LQkJICovCi0JCXN3aXRjaCAoZmItPmZvcm1hdC0+Zm9ybWF0KSB7Ci0JCWNhc2UgRFJNX0ZPUk1B
VF9SR0I1NjU6Ci0JCQlpZiAoSU5URUxfR0VOKGRldl9wcml2KSA+PSAxMSkKLQkJCQlicmVhazsK
LQkJCWZhbGx0aHJvdWdoOwotCQljYXNlIERSTV9GT1JNQVRfQzg6Ci0JCWNhc2UgRFJNX0ZPUk1B
VF9YUkdCMTYxNjE2MTZGOgotCQljYXNlIERSTV9GT1JNQVRfWEJHUjE2MTYxNjE2RjoKLQkJY2Fz
ZSBEUk1fRk9STUFUX0FSR0IxNjE2MTYxNkY6Ci0JCWNhc2UgRFJNX0ZPUk1BVF9BQkdSMTYxNjE2
MTZGOgotCQljYXNlIERSTV9GT1JNQVRfWTIxMDoKLQkJY2FzZSBEUk1fRk9STUFUX1kyMTI6Ci0J
CWNhc2UgRFJNX0ZPUk1BVF9ZMjE2OgotCQljYXNlIERSTV9GT1JNQVRfWFZZVTEyXzE2MTYxNjE2
OgotCQljYXNlIERSTV9GT1JNQVRfWFZZVTE2MTYxNjE2OgotCQkJZHJtX2RiZ19rbXMoJmRldl9w
cml2LT5kcm0sCi0JCQkJICAgICJVbnN1cHBvcnRlZCBwaXhlbCBmb3JtYXQgJXMgZm9yIDkwLzI3
MCFcbiIsCi0JCQkJICAgIGRybV9nZXRfZm9ybWF0X25hbWUoZmItPmZvcm1hdC0+Zm9ybWF0LAot
CQkJCQkJCSZmb3JtYXRfbmFtZSkpOwotCQkJcmV0dXJuIC1FSU5WQUw7Ci0JCWRlZmF1bHQ6Ci0J
CQlicmVhazsKLQkJfQotCX0KLQotCS8qIFktdGlsaW5nIGlzIG5vdCBzdXBwb3J0ZWQgaW4gSUYt
SUQgSW50ZXJsYWNlIG1vZGUgKi8KLQlpZiAoY3J0Y19zdGF0ZS0+aHcuZW5hYmxlICYmCi0JICAg
IGNydGNfc3RhdGUtPmh3LmFkanVzdGVkX21vZGUuZmxhZ3MgJiBEUk1fTU9ERV9GTEFHX0lOVEVS
TEFDRSAmJgotCSAgICAoZmItPm1vZGlmaWVyID09IEk5MTVfRk9STUFUX01PRF9ZX1RJTEVEIHx8
Ci0JICAgICBmYi0+bW9kaWZpZXIgPT0gSTkxNV9GT1JNQVRfTU9EX1lmX1RJTEVEIHx8Ci0JICAg
ICBmYi0+bW9kaWZpZXIgPT0gSTkxNV9GT1JNQVRfTU9EX1lfVElMRURfQ0NTIHx8Ci0JICAgICBm
Yi0+bW9kaWZpZXIgPT0gSTkxNV9GT1JNQVRfTU9EX1lmX1RJTEVEX0NDUyB8fAotCSAgICAgZmIt
Pm1vZGlmaWVyID09IEk5MTVfRk9STUFUX01PRF9ZX1RJTEVEX0dFTjEyX1JDX0NDUyB8fAotCSAg
ICAgZmItPm1vZGlmaWVyID09IEk5MTVfRk9STUFUX01PRF9ZX1RJTEVEX0dFTjEyX01DX0NDUyB8
fAotCSAgICAgZmItPm1vZGlmaWVyID09IEk5MTVfRk9STUFUX01PRF9ZX1RJTEVEX0dFTjEyX1JD
X0NDU19DQykpIHsKLQkJZHJtX2RiZ19rbXMoJmRldl9wcml2LT5kcm0sCi0JCQkgICAgIlkvWWYg
dGlsaW5nIG5vdCBzdXBwb3J0ZWQgaW4gSUYtSUQgbW9kZVxuIik7Ci0JCXJldHVybiAtRUlOVkFM
OwotCX0KLQotCS8qIFdhXzE2MDYwNTQxODg6dGdsLGFkbC1zICovCi0JaWYgKChJU19BTERFUkxB
S0VfUyhkZXZfcHJpdikgfHwgSVNfVElHRVJMQUtFKGRldl9wcml2KSkgJiYKLQkgICAgcGxhbmVf
c3RhdGUtPmNrZXkuZmxhZ3MgJiBJOTE1X1NFVF9DT0xPUktFWV9TT1VSQ0UgJiYKLQkgICAgaW50
ZWxfZm9ybWF0X2lzX3AwMXgoZmItPmZvcm1hdC0+Zm9ybWF0KSkgewotCQlkcm1fZGJnX2ttcygm
ZGV2X3ByaXYtPmRybSwKLQkJCSAgICAiU291cmNlIGNvbG9yIGtleWluZyBub3Qgc3VwcG9ydGVk
IHdpdGggUDAxeCBmb3JtYXRzXG4iKTsKLQkJcmV0dXJuIC1FSU5WQUw7Ci0JfQotCi0JcmV0dXJu
IDA7Ci19Ci0KLXN0YXRpYyBpbnQgc2tsX3BsYW5lX2NoZWNrX2RzdF9jb29yZGluYXRlcyhjb25z
dCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSwKLQkJCQkJICAgY29uc3Qgc3Ry
dWN0IGludGVsX3BsYW5lX3N0YXRlICpwbGFuZV9zdGF0ZSkKLXsKLQlzdHJ1Y3QgZHJtX2k5MTVf
cHJpdmF0ZSAqZGV2X3ByaXYgPQotCQl0b19pOTE1KHBsYW5lX3N0YXRlLT51YXBpLnBsYW5lLT5k
ZXYpOwotCWludCBjcnRjX3ggPSBwbGFuZV9zdGF0ZS0+dWFwaS5kc3QueDE7Ci0JaW50IGNydGNf
dyA9IGRybV9yZWN0X3dpZHRoKCZwbGFuZV9zdGF0ZS0+dWFwaS5kc3QpOwotCWludCBwaXBlX3Ny
Y193ID0gY3J0Y19zdGF0ZS0+cGlwZV9zcmNfdzsKLQotCS8qCi0JICogRGlzcGxheSBXQSAjMTE3
NTogY25sLGdsawotCSAqIFBsYW5lcyBvdGhlciB0aGFuIHRoZSBjdXJzb3IgbWF5IGNhdXNlIEZJ
Rk8gdW5kZXJmbG93IGFuZCBkaXNwbGF5Ci0JICogY29ycnVwdGlvbiBpZiBzdGFydGluZyBsZXNz
IHRoYW4gNCBwaXhlbHMgZnJvbSB0aGUgcmlnaHQgZWRnZSBvZgotCSAqIHRoZSBzY3JlZW4uCi0J
ICogQmVzaWRlcyB0aGUgYWJvdmUgV0EgZml4IHRoZSBzaW1pbGFyIHByb2JsZW0sIHdoZXJlIHBs
YW5lcyBvdGhlcgotCSAqIHRoYW4gdGhlIGN1cnNvciBlbmRpbmcgbGVzcyB0aGFuIDQgcGl4ZWxz
IGZyb20gdGhlIGxlZnQgZWRnZSBvZiB0aGUKLQkgKiBzY3JlZW4gbWF5IGNhdXNlIEZJRk8gdW5k
ZXJmbG93IGFuZCBkaXNwbGF5IGNvcnJ1cHRpb24uCi0JICovCi0JaWYgKChJU19HRU1JTklMQUtF
KGRldl9wcml2KSB8fCBJU19DQU5OT05MQUtFKGRldl9wcml2KSkgJiYKLQkgICAgKGNydGNfeCAr
IGNydGNfdyA8IDQgfHwgY3J0Y194ID4gcGlwZV9zcmNfdyAtIDQpKSB7Ci0JCWRybV9kYmdfa21z
KCZkZXZfcHJpdi0+ZHJtLAotCQkJICAgICJyZXF1ZXN0ZWQgcGxhbmUgWCAlcyBwb3NpdGlvbiAl
ZCBpbnZhbGlkICh2YWxpZCByYW5nZSAlZC0lZClcbiIsCi0JCQkgICAgY3J0Y194ICsgY3J0Y193
IDwgNCA/ICJlbmQiIDogInN0YXJ0IiwKLQkJCSAgICBjcnRjX3ggKyBjcnRjX3cgPCA0ID8gY3J0
Y194ICsgY3J0Y193IDogY3J0Y194LAotCQkJICAgIDQsIHBpcGVfc3JjX3cgLSA0KTsKLQkJcmV0
dXJuIC1FUkFOR0U7Ci0JfQotCi0JcmV0dXJuIDA7Ci19Ci0KLXN0YXRpYyBpbnQgc2tsX3BsYW5l
X2NoZWNrX252MTJfcm90YXRpb24oY29uc3Qgc3RydWN0IGludGVsX3BsYW5lX3N0YXRlICpwbGFu
ZV9zdGF0ZSkKLXsKLQljb25zdCBzdHJ1Y3QgZHJtX2ZyYW1lYnVmZmVyICpmYiA9IHBsYW5lX3N0
YXRlLT5ody5mYjsKLQl1bnNpZ25lZCBpbnQgcm90YXRpb24gPSBwbGFuZV9zdGF0ZS0+aHcucm90
YXRpb247Ci0JaW50IHNyY193ID0gZHJtX3JlY3Rfd2lkdGgoJnBsYW5lX3N0YXRlLT51YXBpLnNy
YykgPj4gMTY7Ci0KLQkvKiBEaXNwbGF5IFdBICMxMTA2ICovCi0JaWYgKGludGVsX2Zvcm1hdF9p
bmZvX2lzX3l1dl9zZW1pcGxhbmFyKGZiLT5mb3JtYXQsIGZiLT5tb2RpZmllcikgJiYKLQkgICAg
c3JjX3cgJiAzICYmCi0JICAgIChyb3RhdGlvbiA9PSBEUk1fTU9ERV9ST1RBVEVfMjcwIHx8Ci0J
ICAgICByb3RhdGlvbiA9PSAoRFJNX01PREVfUkVGTEVDVF9YIHwgRFJNX01PREVfUk9UQVRFXzkw
KSkpIHsKLQkJRFJNX0RFQlVHX0tNUygic3JjIHdpZHRoIG11c3QgYmUgbXVsdGlwbGUgb2YgNCBm
b3Igcm90YXRlZCBwbGFuYXIgWVVWXG4iKTsKLQkJcmV0dXJuIC1FSU5WQUw7Ci0JfQotCi0JcmV0
dXJuIDA7Ci19Ci0KLXN0YXRpYyBpbnQgc2tsX3BsYW5lX21heF9zY2FsZShzdHJ1Y3QgZHJtX2k5
MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCi0JCQkgICAgICAgY29uc3Qgc3RydWN0IGRybV9mcmFtZWJ1
ZmZlciAqZmIpCi17Ci0JLyoKLQkgKiBXZSBkb24ndCB5ZXQga25vdyB0aGUgZmluYWwgc291cmNl
IHdpZHRoIG5vcgotCSAqIHdoZXRoZXIgd2UgY2FuIHVzZSB0aGUgSFEgc2NhbGVyIG1vZGUuIEFz
c3VtZQotCSAqIHRoZSBiZXN0IGNhc2UuCi0JICogRklYTUUgbmVlZCB0byBwcm9wZXJseSBjaGVj
ayB0aGlzIGxhdGVyLgotCSAqLwotCWlmIChJTlRFTF9HRU4oZGV2X3ByaXYpID49IDEwIHx8IElT
X0dFTUlOSUxBS0UoZGV2X3ByaXYpIHx8Ci0JICAgICFpbnRlbF9mb3JtYXRfaW5mb19pc195dXZf
c2VtaXBsYW5hcihmYi0+Zm9ybWF0LCBmYi0+bW9kaWZpZXIpKQotCQlyZXR1cm4gMHgzMDAwMCAt
IDE7Ci0JZWxzZQotCQlyZXR1cm4gMHgyMDAwMCAtIDE7Ci19Ci0KLXN0YXRpYyBpbnQgc2tsX3Bs
YW5lX2NoZWNrKHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlLAotCQkJICAgc3Ry
dWN0IGludGVsX3BsYW5lX3N0YXRlICpwbGFuZV9zdGF0ZSkKLXsKLQlzdHJ1Y3QgaW50ZWxfcGxh
bmUgKnBsYW5lID0gdG9faW50ZWxfcGxhbmUocGxhbmVfc3RhdGUtPnVhcGkucGxhbmUpOwotCXN0
cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUocGxhbmUtPmJhc2UuZGV2
KTsKLQljb25zdCBzdHJ1Y3QgZHJtX2ZyYW1lYnVmZmVyICpmYiA9IHBsYW5lX3N0YXRlLT5ody5m
YjsKLQlpbnQgbWluX3NjYWxlID0gRFJNX1BMQU5FX0hFTFBFUl9OT19TQ0FMSU5HOwotCWludCBt
YXhfc2NhbGUgPSBEUk1fUExBTkVfSEVMUEVSX05PX1NDQUxJTkc7Ci0JaW50IHJldDsKLQotCXJl
dCA9IHNrbF9wbGFuZV9jaGVja19mYihjcnRjX3N0YXRlLCBwbGFuZV9zdGF0ZSk7Ci0JaWYgKHJl
dCkKLQkJcmV0dXJuIHJldDsKLQotCS8qIHVzZSBzY2FsZXIgd2hlbiBjb2xvcmtleSBpcyBub3Qg
cmVxdWlyZWQgKi8KLQlpZiAoIXBsYW5lX3N0YXRlLT5ja2V5LmZsYWdzICYmIGludGVsX2ZiX3Nj
YWxhYmxlKGZiKSkgewotCQltaW5fc2NhbGUgPSAxOwotCQltYXhfc2NhbGUgPSBza2xfcGxhbmVf
bWF4X3NjYWxlKGRldl9wcml2LCBmYik7Ci0JfQotCi0JcmV0ID0gaW50ZWxfYXRvbWljX3BsYW5l
X2NoZWNrX2NsaXBwaW5nKHBsYW5lX3N0YXRlLCBjcnRjX3N0YXRlLAotCQkJCQkJbWluX3NjYWxl
LCBtYXhfc2NhbGUsIHRydWUpOwotCWlmIChyZXQpCi0JCXJldHVybiByZXQ7Ci0KLQlyZXQgPSBz
a2xfY2hlY2tfcGxhbmVfc3VyZmFjZShwbGFuZV9zdGF0ZSk7Ci0JaWYgKHJldCkKLQkJcmV0dXJu
IHJldDsKLQotCWlmICghcGxhbmVfc3RhdGUtPnVhcGkudmlzaWJsZSkKLQkJcmV0dXJuIDA7Ci0K
LQlyZXQgPSBza2xfcGxhbmVfY2hlY2tfZHN0X2Nvb3JkaW5hdGVzKGNydGNfc3RhdGUsIHBsYW5l
X3N0YXRlKTsKLQlpZiAocmV0KQotCQlyZXR1cm4gcmV0OwotCi0JcmV0ID0gaW50ZWxfcGxhbmVf
Y2hlY2tfc3JjX2Nvb3JkaW5hdGVzKHBsYW5lX3N0YXRlKTsKLQlpZiAocmV0KQotCQlyZXR1cm4g
cmV0OwotCi0JcmV0ID0gc2tsX3BsYW5lX2NoZWNrX252MTJfcm90YXRpb24ocGxhbmVfc3RhdGUp
OwotCWlmIChyZXQpCi0JCXJldHVybiByZXQ7Ci0KLQkvKiBIVyBvbmx5IGhhcyA4IGJpdHMgcGl4
ZWwgcHJlY2lzaW9uLCBkaXNhYmxlIHBsYW5lIGlmIGludmlzaWJsZSAqLwotCWlmICghKHBsYW5l
X3N0YXRlLT5ody5hbHBoYSA+PiA4KSkKLQkJcGxhbmVfc3RhdGUtPnVhcGkudmlzaWJsZSA9IGZh
bHNlOwotCi0JcGxhbmVfc3RhdGUtPmN0bCA9IHNrbF9wbGFuZV9jdGwoY3J0Y19zdGF0ZSwgcGxh
bmVfc3RhdGUpOwotCi0JaWYgKElOVEVMX0dFTihkZXZfcHJpdikgPj0gMTAgfHwgSVNfR0VNSU5J
TEFLRShkZXZfcHJpdikpCi0JCXBsYW5lX3N0YXRlLT5jb2xvcl9jdGwgPSBnbGtfcGxhbmVfY29s
b3JfY3RsKGNydGNfc3RhdGUsCi0JCQkJCQkJICAgICBwbGFuZV9zdGF0ZSk7Ci0KLQlpZiAoaW50
ZWxfZm9ybWF0X2luZm9faXNfeXV2X3NlbWlwbGFuYXIoZmItPmZvcm1hdCwgZmItPm1vZGlmaWVy
KSAmJgotCSAgICBpY2xfaXNfaGRyX3BsYW5lKGRldl9wcml2LCBwbGFuZS0+aWQpKQotCQkvKiBF
bmFibGUgYW5kIHVzZSBNUEVHLTIgY2hyb21hIHNpdGluZyAqLwotCQlwbGFuZV9zdGF0ZS0+Y3Vz
X2N0bCA9IFBMQU5FX0NVU19FTkFCTEUgfAotCQkJUExBTkVfQ1VTX0hQSEFTRV8wIHwKLQkJCVBM
QU5FX0NVU19WUEhBU0VfU0lHTl9ORUdBVElWRSB8IFBMQU5FX0NVU19WUEhBU0VfMF8yNTsKLQll
bHNlCi0JCXBsYW5lX3N0YXRlLT5jdXNfY3RsID0gMDsKLQotCXJldHVybiAwOwotfQotCi1zdGF0
aWMgYm9vbCBoYXNfZHN0X2tleV9pbl9wcmltYXJ5X3BsYW5lKHN0cnVjdCBkcm1faTkxNV9wcml2
YXRlICpkZXZfcHJpdikKLXsKLQlyZXR1cm4gSU5URUxfR0VOKGRldl9wcml2KSA+PSA5OwotfQot
Ci1zdGF0aWMgdm9pZCBpbnRlbF9wbGFuZV9zZXRfY2tleShzdHJ1Y3QgaW50ZWxfcGxhbmVfc3Rh
dGUgKnBsYW5lX3N0YXRlLAotCQkJCSBjb25zdCBzdHJ1Y3QgZHJtX2ludGVsX3Nwcml0ZV9jb2xv
cmtleSAqc2V0KQotewotCXN0cnVjdCBpbnRlbF9wbGFuZSAqcGxhbmUgPSB0b19pbnRlbF9wbGFu
ZShwbGFuZV9zdGF0ZS0+dWFwaS5wbGFuZSk7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRl
dl9wcml2ID0gdG9faTkxNShwbGFuZS0+YmFzZS5kZXYpOwotCXN0cnVjdCBkcm1faW50ZWxfc3By
aXRlX2NvbG9ya2V5ICprZXkgPSAmcGxhbmVfc3RhdGUtPmNrZXk7Ci0KLQkqa2V5ID0gKnNldDsK
Kwkqa2V5ID0gKnNldDsKIAogCS8qCiAJICogV2Ugd2FudCBzcmMga2V5IGVuYWJsZWQgb24gdGhl
CkBAIC0yNzEyLDE4NiArMTk2Miw2IEBAIHN0YXRpYyBjb25zdCB1MzIgY2h2X3BpcGVfYl9zcHJp
dGVfZm9ybWF0c1tdID0gewogCURSTV9GT1JNQVRfVllVWSwKIH07CiAKLXN0YXRpYyBjb25zdCB1
MzIgc2tsX3BsYW5lX2Zvcm1hdHNbXSA9IHsKLQlEUk1fRk9STUFUX0M4LAotCURSTV9GT1JNQVRf
UkdCNTY1LAotCURSTV9GT1JNQVRfWFJHQjg4ODgsCi0JRFJNX0ZPUk1BVF9YQkdSODg4OCwKLQlE
Uk1fRk9STUFUX0FSR0I4ODg4LAotCURSTV9GT1JNQVRfQUJHUjg4ODgsCi0JRFJNX0ZPUk1BVF9Y
UkdCMjEwMTAxMCwKLQlEUk1fRk9STUFUX1hCR1IyMTAxMDEwLAotCURSTV9GT1JNQVRfWFJHQjE2
MTYxNjE2RiwKLQlEUk1fRk9STUFUX1hCR1IxNjE2MTYxNkYsCi0JRFJNX0ZPUk1BVF9ZVVlWLAot
CURSTV9GT1JNQVRfWVZZVSwKLQlEUk1fRk9STUFUX1VZVlksCi0JRFJNX0ZPUk1BVF9WWVVZLAot
CURSTV9GT1JNQVRfWFlVVjg4ODgsCi19OwotCi1zdGF0aWMgY29uc3QgdTMyIHNrbF9wbGFuYXJf
Zm9ybWF0c1tdID0gewotCURSTV9GT1JNQVRfQzgsCi0JRFJNX0ZPUk1BVF9SR0I1NjUsCi0JRFJN
X0ZPUk1BVF9YUkdCODg4OCwKLQlEUk1fRk9STUFUX1hCR1I4ODg4LAotCURSTV9GT1JNQVRfQVJH
Qjg4ODgsCi0JRFJNX0ZPUk1BVF9BQkdSODg4OCwKLQlEUk1fRk9STUFUX1hSR0IyMTAxMDEwLAot
CURSTV9GT1JNQVRfWEJHUjIxMDEwMTAsCi0JRFJNX0ZPUk1BVF9YUkdCMTYxNjE2MTZGLAotCURS
TV9GT1JNQVRfWEJHUjE2MTYxNjE2RiwKLQlEUk1fRk9STUFUX1lVWVYsCi0JRFJNX0ZPUk1BVF9Z
VllVLAotCURSTV9GT1JNQVRfVVlWWSwKLQlEUk1fRk9STUFUX1ZZVVksCi0JRFJNX0ZPUk1BVF9O
VjEyLAotCURSTV9GT1JNQVRfWFlVVjg4ODgsCi19OwotCi1zdGF0aWMgY29uc3QgdTMyIGdsa19w
bGFuYXJfZm9ybWF0c1tdID0gewotCURSTV9GT1JNQVRfQzgsCi0JRFJNX0ZPUk1BVF9SR0I1NjUs
Ci0JRFJNX0ZPUk1BVF9YUkdCODg4OCwKLQlEUk1fRk9STUFUX1hCR1I4ODg4LAotCURSTV9GT1JN
QVRfQVJHQjg4ODgsCi0JRFJNX0ZPUk1BVF9BQkdSODg4OCwKLQlEUk1fRk9STUFUX1hSR0IyMTAx
MDEwLAotCURSTV9GT1JNQVRfWEJHUjIxMDEwMTAsCi0JRFJNX0ZPUk1BVF9YUkdCMTYxNjE2MTZG
LAotCURSTV9GT1JNQVRfWEJHUjE2MTYxNjE2RiwKLQlEUk1fRk9STUFUX1lVWVYsCi0JRFJNX0ZP
Uk1BVF9ZVllVLAotCURSTV9GT1JNQVRfVVlWWSwKLQlEUk1fRk9STUFUX1ZZVVksCi0JRFJNX0ZP
Uk1BVF9OVjEyLAotCURSTV9GT1JNQVRfWFlVVjg4ODgsCi0JRFJNX0ZPUk1BVF9QMDEwLAotCURS
TV9GT1JNQVRfUDAxMiwKLQlEUk1fRk9STUFUX1AwMTYsCi19OwotCi1zdGF0aWMgY29uc3QgdTMy
IGljbF9zZHJfeV9wbGFuZV9mb3JtYXRzW10gPSB7Ci0JRFJNX0ZPUk1BVF9DOCwKLQlEUk1fRk9S
TUFUX1JHQjU2NSwKLQlEUk1fRk9STUFUX1hSR0I4ODg4LAotCURSTV9GT1JNQVRfWEJHUjg4ODgs
Ci0JRFJNX0ZPUk1BVF9BUkdCODg4OCwKLQlEUk1fRk9STUFUX0FCR1I4ODg4LAotCURSTV9GT1JN
QVRfWFJHQjIxMDEwMTAsCi0JRFJNX0ZPUk1BVF9YQkdSMjEwMTAxMCwKLQlEUk1fRk9STUFUX0FS
R0IyMTAxMDEwLAotCURSTV9GT1JNQVRfQUJHUjIxMDEwMTAsCi0JRFJNX0ZPUk1BVF9ZVVlWLAot
CURSTV9GT1JNQVRfWVZZVSwKLQlEUk1fRk9STUFUX1VZVlksCi0JRFJNX0ZPUk1BVF9WWVVZLAot
CURSTV9GT1JNQVRfWTIxMCwKLQlEUk1fRk9STUFUX1kyMTIsCi0JRFJNX0ZPUk1BVF9ZMjE2LAot
CURSTV9GT1JNQVRfWFlVVjg4ODgsCi0JRFJNX0ZPUk1BVF9YVllVMjEwMTAxMCwKLQlEUk1fRk9S
TUFUX1hWWVUxMl8xNjE2MTYxNiwKLQlEUk1fRk9STUFUX1hWWVUxNjE2MTYxNiwKLX07Ci0KLXN0
YXRpYyBjb25zdCB1MzIgaWNsX3Nkcl91dl9wbGFuZV9mb3JtYXRzW10gPSB7Ci0JRFJNX0ZPUk1B
VF9DOCwKLQlEUk1fRk9STUFUX1JHQjU2NSwKLQlEUk1fRk9STUFUX1hSR0I4ODg4LAotCURSTV9G
T1JNQVRfWEJHUjg4ODgsCi0JRFJNX0ZPUk1BVF9BUkdCODg4OCwKLQlEUk1fRk9STUFUX0FCR1I4
ODg4LAotCURSTV9GT1JNQVRfWFJHQjIxMDEwMTAsCi0JRFJNX0ZPUk1BVF9YQkdSMjEwMTAxMCwK
LQlEUk1fRk9STUFUX0FSR0IyMTAxMDEwLAotCURSTV9GT1JNQVRfQUJHUjIxMDEwMTAsCi0JRFJN
X0ZPUk1BVF9ZVVlWLAotCURSTV9GT1JNQVRfWVZZVSwKLQlEUk1fRk9STUFUX1VZVlksCi0JRFJN
X0ZPUk1BVF9WWVVZLAotCURSTV9GT1JNQVRfTlYxMiwKLQlEUk1fRk9STUFUX1AwMTAsCi0JRFJN
X0ZPUk1BVF9QMDEyLAotCURSTV9GT1JNQVRfUDAxNiwKLQlEUk1fRk9STUFUX1kyMTAsCi0JRFJN
X0ZPUk1BVF9ZMjEyLAotCURSTV9GT1JNQVRfWTIxNiwKLQlEUk1fRk9STUFUX1hZVVY4ODg4LAot
CURSTV9GT1JNQVRfWFZZVTIxMDEwMTAsCi0JRFJNX0ZPUk1BVF9YVllVMTJfMTYxNjE2MTYsCi0J
RFJNX0ZPUk1BVF9YVllVMTYxNjE2MTYsCi19OwotCi1zdGF0aWMgY29uc3QgdTMyIGljbF9oZHJf
cGxhbmVfZm9ybWF0c1tdID0gewotCURSTV9GT1JNQVRfQzgsCi0JRFJNX0ZPUk1BVF9SR0I1NjUs
Ci0JRFJNX0ZPUk1BVF9YUkdCODg4OCwKLQlEUk1fRk9STUFUX1hCR1I4ODg4LAotCURSTV9GT1JN
QVRfQVJHQjg4ODgsCi0JRFJNX0ZPUk1BVF9BQkdSODg4OCwKLQlEUk1fRk9STUFUX1hSR0IyMTAx
MDEwLAotCURSTV9GT1JNQVRfWEJHUjIxMDEwMTAsCi0JRFJNX0ZPUk1BVF9BUkdCMjEwMTAxMCwK
LQlEUk1fRk9STUFUX0FCR1IyMTAxMDEwLAotCURSTV9GT1JNQVRfWFJHQjE2MTYxNjE2RiwKLQlE
Uk1fRk9STUFUX1hCR1IxNjE2MTYxNkYsCi0JRFJNX0ZPUk1BVF9BUkdCMTYxNjE2MTZGLAotCURS
TV9GT1JNQVRfQUJHUjE2MTYxNjE2RiwKLQlEUk1fRk9STUFUX1lVWVYsCi0JRFJNX0ZPUk1BVF9Z
VllVLAotCURSTV9GT1JNQVRfVVlWWSwKLQlEUk1fRk9STUFUX1ZZVVksCi0JRFJNX0ZPUk1BVF9O
VjEyLAotCURSTV9GT1JNQVRfUDAxMCwKLQlEUk1fRk9STUFUX1AwMTIsCi0JRFJNX0ZPUk1BVF9Q
MDE2LAotCURSTV9GT1JNQVRfWTIxMCwKLQlEUk1fRk9STUFUX1kyMTIsCi0JRFJNX0ZPUk1BVF9Z
MjE2LAotCURSTV9GT1JNQVRfWFlVVjg4ODgsCi0JRFJNX0ZPUk1BVF9YVllVMjEwMTAxMCwKLQlE
Uk1fRk9STUFUX1hWWVUxMl8xNjE2MTYxNiwKLQlEUk1fRk9STUFUX1hWWVUxNjE2MTYxNiwKLX07
Ci0KLXN0YXRpYyBjb25zdCB1NjQgc2tsX3BsYW5lX2Zvcm1hdF9tb2RpZmllcnNfbm9jY3NbXSA9
IHsKLQlJOTE1X0ZPUk1BVF9NT0RfWWZfVElMRUQsCi0JSTkxNV9GT1JNQVRfTU9EX1lfVElMRUQs
Ci0JSTkxNV9GT1JNQVRfTU9EX1hfVElMRUQsCi0JRFJNX0ZPUk1BVF9NT0RfTElORUFSLAotCURS
TV9GT1JNQVRfTU9EX0lOVkFMSUQKLX07Ci0KLXN0YXRpYyBjb25zdCB1NjQgc2tsX3BsYW5lX2Zv
cm1hdF9tb2RpZmllcnNfY2NzW10gPSB7Ci0JSTkxNV9GT1JNQVRfTU9EX1lmX1RJTEVEX0NDUywK
LQlJOTE1X0ZPUk1BVF9NT0RfWV9USUxFRF9DQ1MsCi0JSTkxNV9GT1JNQVRfTU9EX1lmX1RJTEVE
LAotCUk5MTVfRk9STUFUX01PRF9ZX1RJTEVELAotCUk5MTVfRk9STUFUX01PRF9YX1RJTEVELAot
CURSTV9GT1JNQVRfTU9EX0xJTkVBUiwKLQlEUk1fRk9STUFUX01PRF9JTlZBTElECi19OwotCi1z
dGF0aWMgY29uc3QgdTY0IGdlbjEyX3BsYW5lX2Zvcm1hdF9tb2RpZmllcnNfbWNfY2NzW10gPSB7
Ci0JSTkxNV9GT1JNQVRfTU9EX1lfVElMRURfR0VOMTJfTUNfQ0NTLAotCUk5MTVfRk9STUFUX01P
RF9ZX1RJTEVEX0dFTjEyX1JDX0NDUywKLQlJOTE1X0ZPUk1BVF9NT0RfWV9USUxFRF9HRU4xMl9S
Q19DQ1NfQ0MsCi0JSTkxNV9GT1JNQVRfTU9EX1lfVElMRUQsCi0JSTkxNV9GT1JNQVRfTU9EX1hf
VElMRUQsCi0JRFJNX0ZPUk1BVF9NT0RfTElORUFSLAotCURSTV9GT1JNQVRfTU9EX0lOVkFMSUQK
LX07Ci0KLXN0YXRpYyBjb25zdCB1NjQgZ2VuMTJfcGxhbmVfZm9ybWF0X21vZGlmaWVyc19yY19j
Y3NbXSA9IHsKLQlJOTE1X0ZPUk1BVF9NT0RfWV9USUxFRF9HRU4xMl9SQ19DQ1MsCi0JSTkxNV9G
T1JNQVRfTU9EX1lfVElMRURfR0VOMTJfUkNfQ0NTX0NDLAotCUk5MTVfRk9STUFUX01PRF9ZX1RJ
TEVELAotCUk5MTVfRk9STUFUX01PRF9YX1RJTEVELAotCURSTV9GT1JNQVRfTU9EX0xJTkVBUiwK
LQlEUk1fRk9STUFUX01PRF9JTlZBTElECi19OwotCiBzdGF0aWMgYm9vbCBnNHhfc3ByaXRlX2Zv
cm1hdF9tb2Rfc3VwcG9ydGVkKHN0cnVjdCBkcm1fcGxhbmUgKl9wbGFuZSwKIAkJCQkJICAgIHUz
MiBmb3JtYXQsIHU2NCBtb2RpZmllcikKIHsKQEAgLTI5ODQsMTUwICsyMDU0LDYgQEAgc3RhdGlj
IGJvb2wgdmx2X3Nwcml0ZV9mb3JtYXRfbW9kX3N1cHBvcnRlZChzdHJ1Y3QgZHJtX3BsYW5lICpf
cGxhbmUsCiAJfQogfQogCi1zdGF0aWMgYm9vbCBza2xfcGxhbmVfZm9ybWF0X21vZF9zdXBwb3J0
ZWQoc3RydWN0IGRybV9wbGFuZSAqX3BsYW5lLAotCQkJCQkgICB1MzIgZm9ybWF0LCB1NjQgbW9k
aWZpZXIpCi17Ci0Jc3RydWN0IGludGVsX3BsYW5lICpwbGFuZSA9IHRvX2ludGVsX3BsYW5lKF9w
bGFuZSk7Ci0KLQlzd2l0Y2ggKG1vZGlmaWVyKSB7Ci0JY2FzZSBEUk1fRk9STUFUX01PRF9MSU5F
QVI6Ci0JY2FzZSBJOTE1X0ZPUk1BVF9NT0RfWF9USUxFRDoKLQljYXNlIEk5MTVfRk9STUFUX01P
RF9ZX1RJTEVEOgotCWNhc2UgSTkxNV9GT1JNQVRfTU9EX1lmX1RJTEVEOgotCQlicmVhazsKLQlj
YXNlIEk5MTVfRk9STUFUX01PRF9ZX1RJTEVEX0NDUzoKLQljYXNlIEk5MTVfRk9STUFUX01PRF9Z
Zl9USUxFRF9DQ1M6Ci0JCWlmICghcGxhbmUtPmhhc19jY3MpCi0JCQlyZXR1cm4gZmFsc2U7Ci0J
CWJyZWFrOwotCWRlZmF1bHQ6Ci0JCXJldHVybiBmYWxzZTsKLQl9Ci0KLQlzd2l0Y2ggKGZvcm1h
dCkgewotCWNhc2UgRFJNX0ZPUk1BVF9YUkdCODg4ODoKLQljYXNlIERSTV9GT1JNQVRfWEJHUjg4
ODg6Ci0JY2FzZSBEUk1fRk9STUFUX0FSR0I4ODg4OgotCWNhc2UgRFJNX0ZPUk1BVF9BQkdSODg4
ODoKLQkJaWYgKGlzX2Njc19tb2RpZmllcihtb2RpZmllcikpCi0JCQlyZXR1cm4gdHJ1ZTsKLQkJ
ZmFsbHRocm91Z2g7Ci0JY2FzZSBEUk1fRk9STUFUX1JHQjU2NToKLQljYXNlIERSTV9GT1JNQVRf
WFJHQjIxMDEwMTA6Ci0JY2FzZSBEUk1fRk9STUFUX1hCR1IyMTAxMDEwOgotCWNhc2UgRFJNX0ZP
Uk1BVF9BUkdCMjEwMTAxMDoKLQljYXNlIERSTV9GT1JNQVRfQUJHUjIxMDEwMTA6Ci0JY2FzZSBE
Uk1fRk9STUFUX1lVWVY6Ci0JY2FzZSBEUk1fRk9STUFUX1lWWVU6Ci0JY2FzZSBEUk1fRk9STUFU
X1VZVlk6Ci0JY2FzZSBEUk1fRk9STUFUX1ZZVVk6Ci0JY2FzZSBEUk1fRk9STUFUX05WMTI6Ci0J
Y2FzZSBEUk1fRk9STUFUX1hZVVY4ODg4OgotCWNhc2UgRFJNX0ZPUk1BVF9QMDEwOgotCWNhc2Ug
RFJNX0ZPUk1BVF9QMDEyOgotCWNhc2UgRFJNX0ZPUk1BVF9QMDE2OgotCWNhc2UgRFJNX0ZPUk1B
VF9YVllVMjEwMTAxMDoKLQkJaWYgKG1vZGlmaWVyID09IEk5MTVfRk9STUFUX01PRF9ZZl9USUxF
RCkKLQkJCXJldHVybiB0cnVlOwotCQlmYWxsdGhyb3VnaDsKLQljYXNlIERSTV9GT1JNQVRfQzg6
Ci0JY2FzZSBEUk1fRk9STUFUX1hCR1IxNjE2MTYxNkY6Ci0JY2FzZSBEUk1fRk9STUFUX0FCR1Ix
NjE2MTYxNkY6Ci0JY2FzZSBEUk1fRk9STUFUX1hSR0IxNjE2MTYxNkY6Ci0JY2FzZSBEUk1fRk9S
TUFUX0FSR0IxNjE2MTYxNkY6Ci0JY2FzZSBEUk1fRk9STUFUX1kyMTA6Ci0JY2FzZSBEUk1fRk9S
TUFUX1kyMTI6Ci0JY2FzZSBEUk1fRk9STUFUX1kyMTY6Ci0JY2FzZSBEUk1fRk9STUFUX1hWWVUx
Ml8xNjE2MTYxNjoKLQljYXNlIERSTV9GT1JNQVRfWFZZVTE2MTYxNjE2OgotCQlpZiAobW9kaWZp
ZXIgPT0gRFJNX0ZPUk1BVF9NT0RfTElORUFSIHx8Ci0JCSAgICBtb2RpZmllciA9PSBJOTE1X0ZP
Uk1BVF9NT0RfWF9USUxFRCB8fAotCQkgICAgbW9kaWZpZXIgPT0gSTkxNV9GT1JNQVRfTU9EX1lf
VElMRUQpCi0JCQlyZXR1cm4gdHJ1ZTsKLQkJZmFsbHRocm91Z2g7Ci0JZGVmYXVsdDoKLQkJcmV0
dXJuIGZhbHNlOwotCX0KLX0KLQotc3RhdGljIGJvb2wgZ2VuMTJfcGxhbmVfc3VwcG9ydHNfbWNf
Y2NzKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKLQkJCQkJZW51bSBwbGFuZV9p
ZCBwbGFuZV9pZCkKLXsKLQkvKiBXYV8xNDAxMDQ3NzAwODp0Z2xbYTAuLmMwXSxya2xbYWxsXSxk
ZzFbYWxsXSAqLwotCWlmIChJU19ERzEoZGV2X3ByaXYpIHx8IElTX1JPQ0tFVExBS0UoZGV2X3By
aXYpIHx8Ci0JICAgIElTX1RHTF9ESVNQX1NURVBQSU5HKGRldl9wcml2LCBTVEVQX0EwLCBTVEVQ
X0MwKSkKLQkJcmV0dXJuIGZhbHNlOwotCi0JcmV0dXJuIHBsYW5lX2lkIDwgUExBTkVfU1BSSVRF
NDsKLX0KLQotc3RhdGljIGJvb2wgZ2VuMTJfcGxhbmVfZm9ybWF0X21vZF9zdXBwb3J0ZWQoc3Ry
dWN0IGRybV9wbGFuZSAqX3BsYW5lLAotCQkJCQkgICAgIHUzMiBmb3JtYXQsIHU2NCBtb2RpZmll
cikKLXsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KF9wbGFu
ZS0+ZGV2KTsKLQlzdHJ1Y3QgaW50ZWxfcGxhbmUgKnBsYW5lID0gdG9faW50ZWxfcGxhbmUoX3Bs
YW5lKTsKLQotCXN3aXRjaCAobW9kaWZpZXIpIHsKLQljYXNlIEk5MTVfRk9STUFUX01PRF9ZX1RJ
TEVEX0dFTjEyX01DX0NDUzoKLQkJaWYgKCFnZW4xMl9wbGFuZV9zdXBwb3J0c19tY19jY3MoZGV2
X3ByaXYsIHBsYW5lLT5pZCkpCi0JCQlyZXR1cm4gZmFsc2U7Ci0JCWZhbGx0aHJvdWdoOwotCWNh
c2UgRFJNX0ZPUk1BVF9NT0RfTElORUFSOgotCWNhc2UgSTkxNV9GT1JNQVRfTU9EX1hfVElMRUQ6
Ci0JY2FzZSBJOTE1X0ZPUk1BVF9NT0RfWV9USUxFRDoKLQljYXNlIEk5MTVfRk9STUFUX01PRF9Z
X1RJTEVEX0dFTjEyX1JDX0NDUzoKLQljYXNlIEk5MTVfRk9STUFUX01PRF9ZX1RJTEVEX0dFTjEy
X1JDX0NDU19DQzoKLQkJYnJlYWs7Ci0JZGVmYXVsdDoKLQkJcmV0dXJuIGZhbHNlOwotCX0KLQot
CXN3aXRjaCAoZm9ybWF0KSB7Ci0JY2FzZSBEUk1fRk9STUFUX1hSR0I4ODg4OgotCWNhc2UgRFJN
X0ZPUk1BVF9YQkdSODg4ODoKLQljYXNlIERSTV9GT1JNQVRfQVJHQjg4ODg6Ci0JY2FzZSBEUk1f
Rk9STUFUX0FCR1I4ODg4OgotCQlpZiAoaXNfY2NzX21vZGlmaWVyKG1vZGlmaWVyKSkKLQkJCXJl
dHVybiB0cnVlOwotCQlmYWxsdGhyb3VnaDsKLQljYXNlIERSTV9GT1JNQVRfWVVZVjoKLQljYXNl
IERSTV9GT1JNQVRfWVZZVToKLQljYXNlIERSTV9GT1JNQVRfVVlWWToKLQljYXNlIERSTV9GT1JN
QVRfVllVWToKLQljYXNlIERSTV9GT1JNQVRfTlYxMjoKLQljYXNlIERSTV9GT1JNQVRfWFlVVjg4
ODg6Ci0JY2FzZSBEUk1fRk9STUFUX1AwMTA6Ci0JY2FzZSBEUk1fRk9STUFUX1AwMTI6Ci0JY2Fz
ZSBEUk1fRk9STUFUX1AwMTY6Ci0JCWlmIChtb2RpZmllciA9PSBJOTE1X0ZPUk1BVF9NT0RfWV9U
SUxFRF9HRU4xMl9NQ19DQ1MpCi0JCQlyZXR1cm4gdHJ1ZTsKLQkJZmFsbHRocm91Z2g7Ci0JY2Fz
ZSBEUk1fRk9STUFUX1JHQjU2NToKLQljYXNlIERSTV9GT1JNQVRfWFJHQjIxMDEwMTA6Ci0JY2Fz
ZSBEUk1fRk9STUFUX1hCR1IyMTAxMDEwOgotCWNhc2UgRFJNX0ZPUk1BVF9BUkdCMjEwMTAxMDoK
LQljYXNlIERSTV9GT1JNQVRfQUJHUjIxMDEwMTA6Ci0JY2FzZSBEUk1fRk9STUFUX1hWWVUyMTAx
MDEwOgotCWNhc2UgRFJNX0ZPUk1BVF9DODoKLQljYXNlIERSTV9GT1JNQVRfWEJHUjE2MTYxNjE2
RjoKLQljYXNlIERSTV9GT1JNQVRfQUJHUjE2MTYxNjE2RjoKLQljYXNlIERSTV9GT1JNQVRfWFJH
QjE2MTYxNjE2RjoKLQljYXNlIERSTV9GT1JNQVRfQVJHQjE2MTYxNjE2RjoKLQljYXNlIERSTV9G
T1JNQVRfWTIxMDoKLQljYXNlIERSTV9GT1JNQVRfWTIxMjoKLQljYXNlIERSTV9GT1JNQVRfWTIx
NjoKLQljYXNlIERSTV9GT1JNQVRfWFZZVTEyXzE2MTYxNjE2OgotCWNhc2UgRFJNX0ZPUk1BVF9Y
VllVMTYxNjE2MTY6Ci0JCWlmIChtb2RpZmllciA9PSBEUk1fRk9STUFUX01PRF9MSU5FQVIgfHwK
LQkJICAgIG1vZGlmaWVyID09IEk5MTVfRk9STUFUX01PRF9YX1RJTEVEIHx8Ci0JCSAgICBtb2Rp
ZmllciA9PSBJOTE1X0ZPUk1BVF9NT0RfWV9USUxFRCkKLQkJCXJldHVybiB0cnVlOwotCQlmYWxs
dGhyb3VnaDsKLQlkZWZhdWx0OgotCQlyZXR1cm4gZmFsc2U7Ci0JfQotfQotCiBzdGF0aWMgY29u
c3Qgc3RydWN0IGRybV9wbGFuZV9mdW5jcyBnNHhfc3ByaXRlX2Z1bmNzID0gewogCS51cGRhdGVf
cGxhbmUgPSBkcm1fYXRvbWljX2hlbHBlcl91cGRhdGVfcGxhbmUsCiAJLmRpc2FibGVfcGxhbmUg
PSBkcm1fYXRvbWljX2hlbHBlcl9kaXNhYmxlX3BsYW5lLApAQCAtMzE1NSwyNTcgKzIwODEsNiBA
QCBzdGF0aWMgY29uc3Qgc3RydWN0IGRybV9wbGFuZV9mdW5jcyB2bHZfc3ByaXRlX2Z1bmNzID0g
ewogCS5mb3JtYXRfbW9kX3N1cHBvcnRlZCA9IHZsdl9zcHJpdGVfZm9ybWF0X21vZF9zdXBwb3J0
ZWQsCiB9OwogCi1zdGF0aWMgY29uc3Qgc3RydWN0IGRybV9wbGFuZV9mdW5jcyBza2xfcGxhbmVf
ZnVuY3MgPSB7Ci0JLnVwZGF0ZV9wbGFuZSA9IGRybV9hdG9taWNfaGVscGVyX3VwZGF0ZV9wbGFu
ZSwKLQkuZGlzYWJsZV9wbGFuZSA9IGRybV9hdG9taWNfaGVscGVyX2Rpc2FibGVfcGxhbmUsCi0J
LmRlc3Ryb3kgPSBpbnRlbF9wbGFuZV9kZXN0cm95LAotCS5hdG9taWNfZHVwbGljYXRlX3N0YXRl
ID0gaW50ZWxfcGxhbmVfZHVwbGljYXRlX3N0YXRlLAotCS5hdG9taWNfZGVzdHJveV9zdGF0ZSA9
IGludGVsX3BsYW5lX2Rlc3Ryb3lfc3RhdGUsCi0JLmZvcm1hdF9tb2Rfc3VwcG9ydGVkID0gc2ts
X3BsYW5lX2Zvcm1hdF9tb2Rfc3VwcG9ydGVkLAotfTsKLQotc3RhdGljIGNvbnN0IHN0cnVjdCBk
cm1fcGxhbmVfZnVuY3MgZ2VuMTJfcGxhbmVfZnVuY3MgPSB7Ci0JLnVwZGF0ZV9wbGFuZSA9IGRy
bV9hdG9taWNfaGVscGVyX3VwZGF0ZV9wbGFuZSwKLQkuZGlzYWJsZV9wbGFuZSA9IGRybV9hdG9t
aWNfaGVscGVyX2Rpc2FibGVfcGxhbmUsCi0JLmRlc3Ryb3kgPSBpbnRlbF9wbGFuZV9kZXN0cm95
LAotCS5hdG9taWNfZHVwbGljYXRlX3N0YXRlID0gaW50ZWxfcGxhbmVfZHVwbGljYXRlX3N0YXRl
LAotCS5hdG9taWNfZGVzdHJveV9zdGF0ZSA9IGludGVsX3BsYW5lX2Rlc3Ryb3lfc3RhdGUsCi0J
LmZvcm1hdF9tb2Rfc3VwcG9ydGVkID0gZ2VuMTJfcGxhbmVfZm9ybWF0X21vZF9zdXBwb3J0ZWQs
Ci19OwotCi1zdGF0aWMgYm9vbCBza2xfcGxhbmVfaGFzX2ZiYyhzdHJ1Y3QgZHJtX2k5MTVfcHJp
dmF0ZSAqZGV2X3ByaXYsCi0JCQkgICAgICBlbnVtIHBpcGUgcGlwZSwgZW51bSBwbGFuZV9pZCBw
bGFuZV9pZCkKLXsKLQlpZiAoIUhBU19GQkMoZGV2X3ByaXYpKQotCQlyZXR1cm4gZmFsc2U7Ci0K
LQlyZXR1cm4gcGlwZSA9PSBQSVBFX0EgJiYgcGxhbmVfaWQgPT0gUExBTkVfUFJJTUFSWTsKLX0K
LQotc3RhdGljIGJvb2wgc2tsX3BsYW5lX2hhc19wbGFuYXIoc3RydWN0IGRybV9pOTE1X3ByaXZh
dGUgKmRldl9wcml2LAotCQkJCSBlbnVtIHBpcGUgcGlwZSwgZW51bSBwbGFuZV9pZCBwbGFuZV9p
ZCkKLXsKLQkvKiBEaXNwbGF5IFdBICMwODcwOiBza2wsIGJ4dCAqLwotCWlmIChJU19TS1lMQUtF
KGRldl9wcml2KSB8fCBJU19CUk9YVE9OKGRldl9wcml2KSkKLQkJcmV0dXJuIGZhbHNlOwotCi0J
aWYgKElTX0dFTihkZXZfcHJpdiwgOSkgJiYgIUlTX0dFTUlOSUxBS0UoZGV2X3ByaXYpICYmIHBp
cGUgPT0gUElQRV9DKQotCQlyZXR1cm4gZmFsc2U7Ci0KLQlpZiAocGxhbmVfaWQgIT0gUExBTkVf
UFJJTUFSWSAmJiBwbGFuZV9pZCAhPSBQTEFORV9TUFJJVEUwKQotCQlyZXR1cm4gZmFsc2U7Ci0K
LQlyZXR1cm4gdHJ1ZTsKLX0KLQotc3RhdGljIGNvbnN0IHUzMiAqc2tsX2dldF9wbGFuZV9mb3Jt
YXRzKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKLQkJCQkJZW51bSBwaXBlIHBp
cGUsIGVudW0gcGxhbmVfaWQgcGxhbmVfaWQsCi0JCQkJCWludCAqbnVtX2Zvcm1hdHMpCi17Ci0J
aWYgKHNrbF9wbGFuZV9oYXNfcGxhbmFyKGRldl9wcml2LCBwaXBlLCBwbGFuZV9pZCkpIHsKLQkJ
Km51bV9mb3JtYXRzID0gQVJSQVlfU0laRShza2xfcGxhbmFyX2Zvcm1hdHMpOwotCQlyZXR1cm4g
c2tsX3BsYW5hcl9mb3JtYXRzOwotCX0gZWxzZSB7Ci0JCSpudW1fZm9ybWF0cyA9IEFSUkFZX1NJ
WkUoc2tsX3BsYW5lX2Zvcm1hdHMpOwotCQlyZXR1cm4gc2tsX3BsYW5lX2Zvcm1hdHM7Ci0JfQot
fQotCi1zdGF0aWMgY29uc3QgdTMyICpnbGtfZ2V0X3BsYW5lX2Zvcm1hdHMoc3RydWN0IGRybV9p
OTE1X3ByaXZhdGUgKmRldl9wcml2LAotCQkJCQllbnVtIHBpcGUgcGlwZSwgZW51bSBwbGFuZV9p
ZCBwbGFuZV9pZCwKLQkJCQkJaW50ICpudW1fZm9ybWF0cykKLXsKLQlpZiAoc2tsX3BsYW5lX2hh
c19wbGFuYXIoZGV2X3ByaXYsIHBpcGUsIHBsYW5lX2lkKSkgewotCQkqbnVtX2Zvcm1hdHMgPSBB
UlJBWV9TSVpFKGdsa19wbGFuYXJfZm9ybWF0cyk7Ci0JCXJldHVybiBnbGtfcGxhbmFyX2Zvcm1h
dHM7Ci0JfSBlbHNlIHsKLQkJKm51bV9mb3JtYXRzID0gQVJSQVlfU0laRShza2xfcGxhbmVfZm9y
bWF0cyk7Ci0JCXJldHVybiBza2xfcGxhbmVfZm9ybWF0czsKLQl9Ci19Ci0KLXN0YXRpYyBjb25z
dCB1MzIgKmljbF9nZXRfcGxhbmVfZm9ybWF0cyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2
X3ByaXYsCi0JCQkJCWVudW0gcGlwZSBwaXBlLCBlbnVtIHBsYW5lX2lkIHBsYW5lX2lkLAotCQkJ
CQlpbnQgKm51bV9mb3JtYXRzKQotewotCWlmIChpY2xfaXNfaGRyX3BsYW5lKGRldl9wcml2LCBw
bGFuZV9pZCkpIHsKLQkJKm51bV9mb3JtYXRzID0gQVJSQVlfU0laRShpY2xfaGRyX3BsYW5lX2Zv
cm1hdHMpOwotCQlyZXR1cm4gaWNsX2hkcl9wbGFuZV9mb3JtYXRzOwotCX0gZWxzZSBpZiAoaWNs
X2lzX252MTJfeV9wbGFuZShkZXZfcHJpdiwgcGxhbmVfaWQpKSB7Ci0JCSpudW1fZm9ybWF0cyA9
IEFSUkFZX1NJWkUoaWNsX3Nkcl95X3BsYW5lX2Zvcm1hdHMpOwotCQlyZXR1cm4gaWNsX3Nkcl95
X3BsYW5lX2Zvcm1hdHM7Ci0JfSBlbHNlIHsKLQkJKm51bV9mb3JtYXRzID0gQVJSQVlfU0laRShp
Y2xfc2RyX3V2X3BsYW5lX2Zvcm1hdHMpOwotCQlyZXR1cm4gaWNsX3Nkcl91dl9wbGFuZV9mb3Jt
YXRzOwotCX0KLX0KLQotc3RhdGljIGNvbnN0IHU2NCAqZ2VuMTJfZ2V0X3BsYW5lX21vZGlmaWVy
cyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCi0JCQkJCSAgICBlbnVtIHBsYW5l
X2lkIHBsYW5lX2lkKQotewotCWlmIChnZW4xMl9wbGFuZV9zdXBwb3J0c19tY19jY3MoZGV2X3By
aXYsIHBsYW5lX2lkKSkKLQkJcmV0dXJuIGdlbjEyX3BsYW5lX2Zvcm1hdF9tb2RpZmllcnNfbWNf
Y2NzOwotCWVsc2UKLQkJcmV0dXJuIGdlbjEyX3BsYW5lX2Zvcm1hdF9tb2RpZmllcnNfcmNfY2Nz
OwotfQotCi1zdGF0aWMgYm9vbCBza2xfcGxhbmVfaGFzX2NjcyhzdHJ1Y3QgZHJtX2k5MTVfcHJp
dmF0ZSAqZGV2X3ByaXYsCi0JCQkgICAgICBlbnVtIHBpcGUgcGlwZSwgZW51bSBwbGFuZV9pZCBw
bGFuZV9pZCkKLXsKLQlpZiAocGxhbmVfaWQgPT0gUExBTkVfQ1VSU09SKQotCQlyZXR1cm4gZmFs
c2U7Ci0KLQlpZiAoSU5URUxfR0VOKGRldl9wcml2KSA+PSAxMCkKLQkJcmV0dXJuIHRydWU7Ci0K
LQlpZiAoSVNfR0VNSU5JTEFLRShkZXZfcHJpdikpCi0JCXJldHVybiBwaXBlICE9IFBJUEVfQzsK
LQotCXJldHVybiBwaXBlICE9IFBJUEVfQyAmJgotCQkocGxhbmVfaWQgPT0gUExBTkVfUFJJTUFS
WSB8fAotCQkgcGxhbmVfaWQgPT0gUExBTkVfU1BSSVRFMCk7Ci19Ci0KLXN0cnVjdCBpbnRlbF9w
bGFuZSAqCi1za2xfdW5pdmVyc2FsX3BsYW5lX2NyZWF0ZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0
ZSAqZGV2X3ByaXYsCi0JCQkgICBlbnVtIHBpcGUgcGlwZSwgZW51bSBwbGFuZV9pZCBwbGFuZV9p
ZCkKLXsKLQljb25zdCBzdHJ1Y3QgZHJtX3BsYW5lX2Z1bmNzICpwbGFuZV9mdW5jczsKLQlzdHJ1
Y3QgaW50ZWxfcGxhbmUgKnBsYW5lOwotCWVudW0gZHJtX3BsYW5lX3R5cGUgcGxhbmVfdHlwZTsK
LQl1bnNpZ25lZCBpbnQgc3VwcG9ydGVkX3JvdGF0aW9uczsKLQl1bnNpZ25lZCBpbnQgc3VwcG9y
dGVkX2NzYzsKLQljb25zdCB1NjQgKm1vZGlmaWVyczsKLQljb25zdCB1MzIgKmZvcm1hdHM7Ci0J
aW50IG51bV9mb3JtYXRzOwotCWludCByZXQ7Ci0KLQlwbGFuZSA9IGludGVsX3BsYW5lX2FsbG9j
KCk7Ci0JaWYgKElTX0VSUihwbGFuZSkpCi0JCXJldHVybiBwbGFuZTsKLQotCXBsYW5lLT5waXBl
ID0gcGlwZTsKLQlwbGFuZS0+aWQgPSBwbGFuZV9pZDsKLQlwbGFuZS0+ZnJvbnRidWZmZXJfYml0
ID0gSU5URUxfRlJPTlRCVUZGRVIocGlwZSwgcGxhbmVfaWQpOwotCi0JcGxhbmUtPmhhc19mYmMg
PSBza2xfcGxhbmVfaGFzX2ZiYyhkZXZfcHJpdiwgcGlwZSwgcGxhbmVfaWQpOwotCWlmIChwbGFu
ZS0+aGFzX2ZiYykgewotCQlzdHJ1Y3QgaW50ZWxfZmJjICpmYmMgPSAmZGV2X3ByaXYtPmZiYzsK
LQotCQlmYmMtPnBvc3NpYmxlX2ZyYW1lYnVmZmVyX2JpdHMgfD0gcGxhbmUtPmZyb250YnVmZmVy
X2JpdDsKLQl9Ci0KLQlpZiAoSU5URUxfR0VOKGRldl9wcml2KSA+PSAxMSkgewotCQlwbGFuZS0+
bWluX3dpZHRoID0gaWNsX3BsYW5lX21pbl93aWR0aDsKLQkJcGxhbmUtPm1heF93aWR0aCA9IGlj
bF9wbGFuZV9tYXhfd2lkdGg7Ci0JCXBsYW5lLT5tYXhfaGVpZ2h0ID0gaWNsX3BsYW5lX21heF9o
ZWlnaHQ7Ci0JfSBlbHNlIGlmIChJTlRFTF9HRU4oZGV2X3ByaXYpID49IDEwIHx8IElTX0dFTUlO
SUxBS0UoZGV2X3ByaXYpKSB7Ci0JCXBsYW5lLT5tYXhfd2lkdGggPSBnbGtfcGxhbmVfbWF4X3dp
ZHRoOwotCQlwbGFuZS0+bWF4X2hlaWdodCA9IHNrbF9wbGFuZV9tYXhfaGVpZ2h0OwotCX0gZWxz
ZSB7Ci0JCXBsYW5lLT5tYXhfd2lkdGggPSBza2xfcGxhbmVfbWF4X3dpZHRoOwotCQlwbGFuZS0+
bWF4X2hlaWdodCA9IHNrbF9wbGFuZV9tYXhfaGVpZ2h0OwotCX0KLQotCXBsYW5lLT5tYXhfc3Ry
aWRlID0gc2tsX3BsYW5lX21heF9zdHJpZGU7Ci0JcGxhbmUtPnVwZGF0ZV9wbGFuZSA9IHNrbF91
cGRhdGVfcGxhbmU7Ci0JcGxhbmUtPmRpc2FibGVfcGxhbmUgPSBza2xfZGlzYWJsZV9wbGFuZTsK
LQlwbGFuZS0+Z2V0X2h3X3N0YXRlID0gc2tsX3BsYW5lX2dldF9od19zdGF0ZTsKLQlwbGFuZS0+
Y2hlY2tfcGxhbmUgPSBza2xfcGxhbmVfY2hlY2s7Ci0JcGxhbmUtPm1pbl9jZGNsayA9IHNrbF9w
bGFuZV9taW5fY2RjbGs7Ci0KLQlpZiAocGxhbmVfaWQgPT0gUExBTkVfUFJJTUFSWSkgewotCQlw
bGFuZS0+bmVlZF9hc3luY19mbGlwX2Rpc2FibGVfd2EgPSBJU19HRU5fUkFOR0UoZGV2X3ByaXYs
IDksIDEwKTsKLQkJcGxhbmUtPmFzeW5jX2ZsaXAgPSBza2xfcGxhbmVfYXN5bmNfZmxpcDsKLQkJ
cGxhbmUtPmVuYWJsZV9mbGlwX2RvbmUgPSBza2xfcGxhbmVfZW5hYmxlX2ZsaXBfZG9uZTsKLQkJ
cGxhbmUtPmRpc2FibGVfZmxpcF9kb25lID0gc2tsX3BsYW5lX2Rpc2FibGVfZmxpcF9kb25lOwot
CX0KLQotCWlmIChJTlRFTF9HRU4oZGV2X3ByaXYpID49IDExKQotCQlmb3JtYXRzID0gaWNsX2dl
dF9wbGFuZV9mb3JtYXRzKGRldl9wcml2LCBwaXBlLAotCQkJCQkJcGxhbmVfaWQsICZudW1fZm9y
bWF0cyk7Ci0JZWxzZSBpZiAoSU5URUxfR0VOKGRldl9wcml2KSA+PSAxMCB8fCBJU19HRU1JTklM
QUtFKGRldl9wcml2KSkKLQkJZm9ybWF0cyA9IGdsa19nZXRfcGxhbmVfZm9ybWF0cyhkZXZfcHJp
diwgcGlwZSwKLQkJCQkJCXBsYW5lX2lkLCAmbnVtX2Zvcm1hdHMpOwotCWVsc2UKLQkJZm9ybWF0
cyA9IHNrbF9nZXRfcGxhbmVfZm9ybWF0cyhkZXZfcHJpdiwgcGlwZSwKLQkJCQkJCXBsYW5lX2lk
LCAmbnVtX2Zvcm1hdHMpOwotCi0JcGxhbmUtPmhhc19jY3MgPSBza2xfcGxhbmVfaGFzX2Njcyhk
ZXZfcHJpdiwgcGlwZSwgcGxhbmVfaWQpOwotCWlmIChJTlRFTF9HRU4oZGV2X3ByaXYpID49IDEy
KSB7Ci0JCW1vZGlmaWVycyA9IGdlbjEyX2dldF9wbGFuZV9tb2RpZmllcnMoZGV2X3ByaXYsIHBs
YW5lX2lkKTsKLQkJcGxhbmVfZnVuY3MgPSAmZ2VuMTJfcGxhbmVfZnVuY3M7Ci0JfSBlbHNlIHsK
LQkJaWYgKHBsYW5lLT5oYXNfY2NzKQotCQkJbW9kaWZpZXJzID0gc2tsX3BsYW5lX2Zvcm1hdF9t
b2RpZmllcnNfY2NzOwotCQllbHNlCi0JCQltb2RpZmllcnMgPSBza2xfcGxhbmVfZm9ybWF0X21v
ZGlmaWVyc19ub2NjczsKLQkJcGxhbmVfZnVuY3MgPSAmc2tsX3BsYW5lX2Z1bmNzOwotCX0KLQot
CWlmIChwbGFuZV9pZCA9PSBQTEFORV9QUklNQVJZKQotCQlwbGFuZV90eXBlID0gRFJNX1BMQU5F
X1RZUEVfUFJJTUFSWTsKLQllbHNlCi0JCXBsYW5lX3R5cGUgPSBEUk1fUExBTkVfVFlQRV9PVkVS
TEFZOwotCi0JcmV0ID0gZHJtX3VuaXZlcnNhbF9wbGFuZV9pbml0KCZkZXZfcHJpdi0+ZHJtLCAm
cGxhbmUtPmJhc2UsCi0JCQkJICAgICAgIDAsIHBsYW5lX2Z1bmNzLAotCQkJCSAgICAgICBmb3Jt
YXRzLCBudW1fZm9ybWF0cywgbW9kaWZpZXJzLAotCQkJCSAgICAgICBwbGFuZV90eXBlLAotCQkJ
CSAgICAgICAicGxhbmUgJWQlYyIsIHBsYW5lX2lkICsgMSwKLQkJCQkgICAgICAgcGlwZV9uYW1l
KHBpcGUpKTsKLQlpZiAocmV0KQotCQlnb3RvIGZhaWw7Ci0KLQlzdXBwb3J0ZWRfcm90YXRpb25z
ID0KLQkJRFJNX01PREVfUk9UQVRFXzAgfCBEUk1fTU9ERV9ST1RBVEVfOTAgfAotCQlEUk1fTU9E
RV9ST1RBVEVfMTgwIHwgRFJNX01PREVfUk9UQVRFXzI3MDsKLQotCWlmIChJTlRFTF9HRU4oZGV2
X3ByaXYpID49IDEwKQotCQlzdXBwb3J0ZWRfcm90YXRpb25zIHw9IERSTV9NT0RFX1JFRkxFQ1Rf
WDsKLQotCWRybV9wbGFuZV9jcmVhdGVfcm90YXRpb25fcHJvcGVydHkoJnBsYW5lLT5iYXNlLAot
CQkJCQkgICBEUk1fTU9ERV9ST1RBVEVfMCwKLQkJCQkJICAgc3VwcG9ydGVkX3JvdGF0aW9ucyk7
Ci0KLQlzdXBwb3J0ZWRfY3NjID0gQklUKERSTV9DT0xPUl9ZQ0JDUl9CVDYwMSkgfCBCSVQoRFJN
X0NPTE9SX1lDQkNSX0JUNzA5KTsKLQotCWlmIChJTlRFTF9HRU4oZGV2X3ByaXYpID49IDEwIHx8
IElTX0dFTUlOSUxBS0UoZGV2X3ByaXYpKQotCQlzdXBwb3J0ZWRfY3NjIHw9IEJJVChEUk1fQ09M
T1JfWUNCQ1JfQlQyMDIwKTsKLQotCWRybV9wbGFuZV9jcmVhdGVfY29sb3JfcHJvcGVydGllcygm
cGxhbmUtPmJhc2UsCi0JCQkJCSAgc3VwcG9ydGVkX2NzYywKLQkJCQkJICBCSVQoRFJNX0NPTE9S
X1lDQkNSX0xJTUlURURfUkFOR0UpIHwKLQkJCQkJICBCSVQoRFJNX0NPTE9SX1lDQkNSX0ZVTExf
UkFOR0UpLAotCQkJCQkgIERSTV9DT0xPUl9ZQ0JDUl9CVDcwOSwKLQkJCQkJICBEUk1fQ09MT1Jf
WUNCQ1JfTElNSVRFRF9SQU5HRSk7Ci0KLQlkcm1fcGxhbmVfY3JlYXRlX2FscGhhX3Byb3BlcnR5
KCZwbGFuZS0+YmFzZSk7Ci0JZHJtX3BsYW5lX2NyZWF0ZV9ibGVuZF9tb2RlX3Byb3BlcnR5KCZw
bGFuZS0+YmFzZSwKLQkJCQkJICAgICBCSVQoRFJNX01PREVfQkxFTkRfUElYRUxfTk9ORSkgfAot
CQkJCQkgICAgIEJJVChEUk1fTU9ERV9CTEVORF9QUkVNVUxUSSkgfAotCQkJCQkgICAgIEJJVChE
Uk1fTU9ERV9CTEVORF9DT1ZFUkFHRSkpOwotCi0JZHJtX3BsYW5lX2NyZWF0ZV96cG9zX2ltbXV0
YWJsZV9wcm9wZXJ0eSgmcGxhbmUtPmJhc2UsIHBsYW5lX2lkKTsKLQotCWlmIChJTlRFTF9HRU4o
ZGV2X3ByaXYpID49IDEyKQotCQlkcm1fcGxhbmVfZW5hYmxlX2ZiX2RhbWFnZV9jbGlwcygmcGxh
bmUtPmJhc2UpOwotCi0JaWYgKElOVEVMX0dFTihkZXZfcHJpdikgPj0gMTApCi0JCWRybV9wbGFu
ZV9jcmVhdGVfc2NhbGluZ19maWx0ZXJfcHJvcGVydHkoJnBsYW5lLT5iYXNlLAotCQkJCQkJQklU
KERSTV9TQ0FMSU5HX0ZJTFRFUl9ERUZBVUxUKSB8Ci0JCQkJCQlCSVQoRFJNX1NDQUxJTkdfRklM
VEVSX05FQVJFU1RfTkVJR0hCT1IpKTsKLQotCWRybV9wbGFuZV9oZWxwZXJfYWRkKCZwbGFuZS0+
YmFzZSwgJmludGVsX3BsYW5lX2hlbHBlcl9mdW5jcyk7Ci0KLQlyZXR1cm4gcGxhbmU7Ci0KLWZh
aWw6Ci0JaW50ZWxfcGxhbmVfZnJlZShwbGFuZSk7Ci0KLQlyZXR1cm4gRVJSX1BUUihyZXQpOwot
fQotCiBzdHJ1Y3QgaW50ZWxfcGxhbmUgKgogaW50ZWxfc3ByaXRlX3BsYW5lX2NyZWF0ZShzdHJ1
Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCiAJCQkgIGVudW0gcGlwZSBwaXBlLCBpbnQg
c3ByaXRlKQpAQCAtMzQxOCwxMCArMjA5Myw2IEBAIGludGVsX3Nwcml0ZV9wbGFuZV9jcmVhdGUo
c3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAogCWludCBudW1fZm9ybWF0czsKIAlp
bnQgcmV0LCB6cG9zOwogCi0JaWYgKElOVEVMX0dFTihkZXZfcHJpdikgPj0gOSkKLQkJcmV0dXJu
IHNrbF91bml2ZXJzYWxfcGxhbmVfY3JlYXRlKGRldl9wcml2LCBwaXBlLAotCQkJCQkJICBQTEFO
RV9TUFJJVEUwICsgc3ByaXRlKTsKLQogCXBsYW5lID0gaW50ZWxfcGxhbmVfYWxsb2MoKTsKIAlp
ZiAoSVNfRVJSKHBsYW5lKSkKIAkJcmV0dXJuIHBsYW5lOwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9n
cHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9zcHJpdGUuaCBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1
L2Rpc3BsYXkvaW50ZWxfc3ByaXRlLmgKaW5kZXggNzYxMjZkZDhkNTg0Li40MTg4OTdmOTUzZmMg
MTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfc3ByaXRlLmgK
KysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9zcHJpdGUuaApAQCAtMzgs
OSArMzgsNiBAQCB2b2lkIGludGVsX3BpcGVfdXBkYXRlX2VuZChzdHJ1Y3QgaW50ZWxfY3J0Y19z
dGF0ZSAqbmV3X2NydGNfc3RhdGUpOwogaW50IGludGVsX3BsYW5lX2NoZWNrX3N0cmlkZShjb25z
dCBzdHJ1Y3QgaW50ZWxfcGxhbmVfc3RhdGUgKnBsYW5lX3N0YXRlKTsKIGludCBpbnRlbF9wbGFu
ZV9jaGVja19zcmNfY29vcmRpbmF0ZXMoc3RydWN0IGludGVsX3BsYW5lX3N0YXRlICpwbGFuZV9z
dGF0ZSk7CiBpbnQgY2h2X3BsYW5lX2NoZWNrX3JvdGF0aW9uKGNvbnN0IHN0cnVjdCBpbnRlbF9w
bGFuZV9zdGF0ZSAqcGxhbmVfc3RhdGUpOwotc3RydWN0IGludGVsX3BsYW5lICoKLXNrbF91bml2
ZXJzYWxfcGxhbmVfY3JlYXRlKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKLQkJ
CSAgIGVudW0gcGlwZSBwaXBlLCBlbnVtIHBsYW5lX2lkIHBsYW5lX2lkKTsKIAogc3RhdGljIGlu
bGluZSB1OCBpY2xfaGRyX3BsYW5lX21hc2sodm9pZCkKIHsKQEAgLTU5LDQgKzU2LDcgQEAgaW50
IGhzd19wbGFuZV9taW5fY2RjbGsoY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNf
c3RhdGUsCiBpbnQgdmx2X3BsYW5lX21pbl9jZGNsayhjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19z
dGF0ZSAqY3J0Y19zdGF0ZSwKIAkJCWNvbnN0IHN0cnVjdCBpbnRlbF9wbGFuZV9zdGF0ZSAqcGxh
bmVfc3RhdGUpOwogCit2b2lkIHNrbF9wcm9ncmFtX3NjYWxlcihzdHJ1Y3QgaW50ZWxfcGxhbmUg
KnBsYW5lLAorCQkJY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUsCisJ
CQljb25zdCBzdHJ1Y3QgaW50ZWxfcGxhbmVfc3RhdGUgKnBsYW5lX3N0YXRlKTsKICNlbmRpZiAv
KiBfX0lOVEVMX1NQUklURV9IX18gKi8KZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1
L2Rpc3BsYXkvc2tsX3VuaXZlcnNhbF9wbGFuZS5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlz
cGxheS9za2xfdW5pdmVyc2FsX3BsYW5lLmMKbmV3IGZpbGUgbW9kZSAxMDA2NDQKaW5kZXggMDAw
MDAwMDAwMDAwLi4yOWMyZTM2OTNlOGIKLS0tIC9kZXYvbnVsbAorKysgYi9kcml2ZXJzL2dwdS9k
cm0vaTkxNS9kaXNwbGF5L3NrbF91bml2ZXJzYWxfcGxhbmUuYwpAQCAtMCwwICsxLDIyNjUgQEAK
Ky8vIFNQRFgtTGljZW5zZS1JZGVudGlmaWVyOiBNSVQKKy8qCisgKiBDb3B5cmlnaHQgwqkgMjAy
MCBJbnRlbCBDb3Jwb3JhdGlvbgorICovCisKKyNpbmNsdWRlIDxkcm0vZHJtX2F0b21pY19oZWxw
ZXIuaD4KKyNpbmNsdWRlIDxkcm0vZHJtX2RhbWFnZV9oZWxwZXIuaD4KKyNpbmNsdWRlIDxkcm0v
ZHJtX2ZvdXJjYy5oPgorI2luY2x1ZGUgPGRybS9kcm1fcGxhbmVfaGVscGVyLmg+CisKKyNpbmNs
dWRlICJpOTE1X2Rydi5oIgorI2luY2x1ZGUgImludGVsX2F0b21pY19wbGFuZS5oIgorI2luY2x1
ZGUgImludGVsX2Rpc3BsYXlfdHlwZXMuaCIKKyNpbmNsdWRlICJpbnRlbF9wbS5oIgorI2luY2x1
ZGUgImludGVsX3Bzci5oIgorI2luY2x1ZGUgImludGVsX3Nwcml0ZS5oIgorI2luY2x1ZGUgInNr
bF91bml2ZXJzYWxfcGxhbmUuaCIKKworc3RhdGljIGNvbnN0IHUzMiBza2xfcGxhbmVfZm9ybWF0
c1tdID0geworCURSTV9GT1JNQVRfQzgsCisJRFJNX0ZPUk1BVF9SR0I1NjUsCisJRFJNX0ZPUk1B
VF9YUkdCODg4OCwKKwlEUk1fRk9STUFUX1hCR1I4ODg4LAorCURSTV9GT1JNQVRfQVJHQjg4ODgs
CisJRFJNX0ZPUk1BVF9BQkdSODg4OCwKKwlEUk1fRk9STUFUX1hSR0IyMTAxMDEwLAorCURSTV9G
T1JNQVRfWEJHUjIxMDEwMTAsCisJRFJNX0ZPUk1BVF9YUkdCMTYxNjE2MTZGLAorCURSTV9GT1JN
QVRfWEJHUjE2MTYxNjE2RiwKKwlEUk1fRk9STUFUX1lVWVYsCisJRFJNX0ZPUk1BVF9ZVllVLAor
CURSTV9GT1JNQVRfVVlWWSwKKwlEUk1fRk9STUFUX1ZZVVksCisJRFJNX0ZPUk1BVF9YWVVWODg4
OCwKK307CisKK3N0YXRpYyBjb25zdCB1MzIgc2tsX3BsYW5hcl9mb3JtYXRzW10gPSB7CisJRFJN
X0ZPUk1BVF9DOCwKKwlEUk1fRk9STUFUX1JHQjU2NSwKKwlEUk1fRk9STUFUX1hSR0I4ODg4LAor
CURSTV9GT1JNQVRfWEJHUjg4ODgsCisJRFJNX0ZPUk1BVF9BUkdCODg4OCwKKwlEUk1fRk9STUFU
X0FCR1I4ODg4LAorCURSTV9GT1JNQVRfWFJHQjIxMDEwMTAsCisJRFJNX0ZPUk1BVF9YQkdSMjEw
MTAxMCwKKwlEUk1fRk9STUFUX1hSR0IxNjE2MTYxNkYsCisJRFJNX0ZPUk1BVF9YQkdSMTYxNjE2
MTZGLAorCURSTV9GT1JNQVRfWVVZViwKKwlEUk1fRk9STUFUX1lWWVUsCisJRFJNX0ZPUk1BVF9V
WVZZLAorCURSTV9GT1JNQVRfVllVWSwKKwlEUk1fRk9STUFUX05WMTIsCisJRFJNX0ZPUk1BVF9Y
WVVWODg4OCwKK307CisKK3N0YXRpYyBjb25zdCB1MzIgZ2xrX3BsYW5hcl9mb3JtYXRzW10gPSB7
CisJRFJNX0ZPUk1BVF9DOCwKKwlEUk1fRk9STUFUX1JHQjU2NSwKKwlEUk1fRk9STUFUX1hSR0I4
ODg4LAorCURSTV9GT1JNQVRfWEJHUjg4ODgsCisJRFJNX0ZPUk1BVF9BUkdCODg4OCwKKwlEUk1f
Rk9STUFUX0FCR1I4ODg4LAorCURSTV9GT1JNQVRfWFJHQjIxMDEwMTAsCisJRFJNX0ZPUk1BVF9Y
QkdSMjEwMTAxMCwKKwlEUk1fRk9STUFUX1hSR0IxNjE2MTYxNkYsCisJRFJNX0ZPUk1BVF9YQkdS
MTYxNjE2MTZGLAorCURSTV9GT1JNQVRfWVVZViwKKwlEUk1fRk9STUFUX1lWWVUsCisJRFJNX0ZP
Uk1BVF9VWVZZLAorCURSTV9GT1JNQVRfVllVWSwKKwlEUk1fRk9STUFUX05WMTIsCisJRFJNX0ZP
Uk1BVF9YWVVWODg4OCwKKwlEUk1fRk9STUFUX1AwMTAsCisJRFJNX0ZPUk1BVF9QMDEyLAorCURS
TV9GT1JNQVRfUDAxNiwKK307CisKK3N0YXRpYyBjb25zdCB1MzIgaWNsX3Nkcl95X3BsYW5lX2Zv
cm1hdHNbXSA9IHsKKwlEUk1fRk9STUFUX0M4LAorCURSTV9GT1JNQVRfUkdCNTY1LAorCURSTV9G
T1JNQVRfWFJHQjg4ODgsCisJRFJNX0ZPUk1BVF9YQkdSODg4OCwKKwlEUk1fRk9STUFUX0FSR0I4
ODg4LAorCURSTV9GT1JNQVRfQUJHUjg4ODgsCisJRFJNX0ZPUk1BVF9YUkdCMjEwMTAxMCwKKwlE
Uk1fRk9STUFUX1hCR1IyMTAxMDEwLAorCURSTV9GT1JNQVRfQVJHQjIxMDEwMTAsCisJRFJNX0ZP
Uk1BVF9BQkdSMjEwMTAxMCwKKwlEUk1fRk9STUFUX1lVWVYsCisJRFJNX0ZPUk1BVF9ZVllVLAor
CURSTV9GT1JNQVRfVVlWWSwKKwlEUk1fRk9STUFUX1ZZVVksCisJRFJNX0ZPUk1BVF9ZMjEwLAor
CURSTV9GT1JNQVRfWTIxMiwKKwlEUk1fRk9STUFUX1kyMTYsCisJRFJNX0ZPUk1BVF9YWVVWODg4
OCwKKwlEUk1fRk9STUFUX1hWWVUyMTAxMDEwLAorCURSTV9GT1JNQVRfWFZZVTEyXzE2MTYxNjE2
LAorCURSTV9GT1JNQVRfWFZZVTE2MTYxNjE2LAorfTsKKworc3RhdGljIGNvbnN0IHUzMiBpY2xf
c2RyX3V2X3BsYW5lX2Zvcm1hdHNbXSA9IHsKKwlEUk1fRk9STUFUX0M4LAorCURSTV9GT1JNQVRf
UkdCNTY1LAorCURSTV9GT1JNQVRfWFJHQjg4ODgsCisJRFJNX0ZPUk1BVF9YQkdSODg4OCwKKwlE
Uk1fRk9STUFUX0FSR0I4ODg4LAorCURSTV9GT1JNQVRfQUJHUjg4ODgsCisJRFJNX0ZPUk1BVF9Y
UkdCMjEwMTAxMCwKKwlEUk1fRk9STUFUX1hCR1IyMTAxMDEwLAorCURSTV9GT1JNQVRfQVJHQjIx
MDEwMTAsCisJRFJNX0ZPUk1BVF9BQkdSMjEwMTAxMCwKKwlEUk1fRk9STUFUX1lVWVYsCisJRFJN
X0ZPUk1BVF9ZVllVLAorCURSTV9GT1JNQVRfVVlWWSwKKwlEUk1fRk9STUFUX1ZZVVksCisJRFJN
X0ZPUk1BVF9OVjEyLAorCURSTV9GT1JNQVRfUDAxMCwKKwlEUk1fRk9STUFUX1AwMTIsCisJRFJN
X0ZPUk1BVF9QMDE2LAorCURSTV9GT1JNQVRfWTIxMCwKKwlEUk1fRk9STUFUX1kyMTIsCisJRFJN
X0ZPUk1BVF9ZMjE2LAorCURSTV9GT1JNQVRfWFlVVjg4ODgsCisJRFJNX0ZPUk1BVF9YVllVMjEw
MTAxMCwKKwlEUk1fRk9STUFUX1hWWVUxMl8xNjE2MTYxNiwKKwlEUk1fRk9STUFUX1hWWVUxNjE2
MTYxNiwKK307CisKK3N0YXRpYyBjb25zdCB1MzIgaWNsX2hkcl9wbGFuZV9mb3JtYXRzW10gPSB7
CisJRFJNX0ZPUk1BVF9DOCwKKwlEUk1fRk9STUFUX1JHQjU2NSwKKwlEUk1fRk9STUFUX1hSR0I4
ODg4LAorCURSTV9GT1JNQVRfWEJHUjg4ODgsCisJRFJNX0ZPUk1BVF9BUkdCODg4OCwKKwlEUk1f
Rk9STUFUX0FCR1I4ODg4LAorCURSTV9GT1JNQVRfWFJHQjIxMDEwMTAsCisJRFJNX0ZPUk1BVF9Y
QkdSMjEwMTAxMCwKKwlEUk1fRk9STUFUX0FSR0IyMTAxMDEwLAorCURSTV9GT1JNQVRfQUJHUjIx
MDEwMTAsCisJRFJNX0ZPUk1BVF9YUkdCMTYxNjE2MTZGLAorCURSTV9GT1JNQVRfWEJHUjE2MTYx
NjE2RiwKKwlEUk1fRk9STUFUX0FSR0IxNjE2MTYxNkYsCisJRFJNX0ZPUk1BVF9BQkdSMTYxNjE2
MTZGLAorCURSTV9GT1JNQVRfWVVZViwKKwlEUk1fRk9STUFUX1lWWVUsCisJRFJNX0ZPUk1BVF9V
WVZZLAorCURSTV9GT1JNQVRfVllVWSwKKwlEUk1fRk9STUFUX05WMTIsCisJRFJNX0ZPUk1BVF9Q
MDEwLAorCURSTV9GT1JNQVRfUDAxMiwKKwlEUk1fRk9STUFUX1AwMTYsCisJRFJNX0ZPUk1BVF9Z
MjEwLAorCURSTV9GT1JNQVRfWTIxMiwKKwlEUk1fRk9STUFUX1kyMTYsCisJRFJNX0ZPUk1BVF9Y
WVVWODg4OCwKKwlEUk1fRk9STUFUX1hWWVUyMTAxMDEwLAorCURSTV9GT1JNQVRfWFZZVTEyXzE2
MTYxNjE2LAorCURSTV9GT1JNQVRfWFZZVTE2MTYxNjE2LAorfTsKKworc3RhdGljIGNvbnN0IHU2
NCBza2xfcGxhbmVfZm9ybWF0X21vZGlmaWVyc19ub2Njc1tdID0geworCUk5MTVfRk9STUFUX01P
RF9ZZl9USUxFRCwKKwlJOTE1X0ZPUk1BVF9NT0RfWV9USUxFRCwKKwlJOTE1X0ZPUk1BVF9NT0Rf
WF9USUxFRCwKKwlEUk1fRk9STUFUX01PRF9MSU5FQVIsCisJRFJNX0ZPUk1BVF9NT0RfSU5WQUxJ
RAorfTsKKworc3RhdGljIGNvbnN0IHU2NCBza2xfcGxhbmVfZm9ybWF0X21vZGlmaWVyc19jY3Nb
XSA9IHsKKwlJOTE1X0ZPUk1BVF9NT0RfWWZfVElMRURfQ0NTLAorCUk5MTVfRk9STUFUX01PRF9Z
X1RJTEVEX0NDUywKKwlJOTE1X0ZPUk1BVF9NT0RfWWZfVElMRUQsCisJSTkxNV9GT1JNQVRfTU9E
X1lfVElMRUQsCisJSTkxNV9GT1JNQVRfTU9EX1hfVElMRUQsCisJRFJNX0ZPUk1BVF9NT0RfTElO
RUFSLAorCURSTV9GT1JNQVRfTU9EX0lOVkFMSUQKK307CisKK3N0YXRpYyBjb25zdCB1NjQgZ2Vu
MTJfcGxhbmVfZm9ybWF0X21vZGlmaWVyc19tY19jY3NbXSA9IHsKKwlJOTE1X0ZPUk1BVF9NT0Rf
WV9USUxFRF9HRU4xMl9NQ19DQ1MsCisJSTkxNV9GT1JNQVRfTU9EX1lfVElMRURfR0VOMTJfUkNf
Q0NTLAorCUk5MTVfRk9STUFUX01PRF9ZX1RJTEVEX0dFTjEyX1JDX0NDU19DQywKKwlJOTE1X0ZP
Uk1BVF9NT0RfWV9USUxFRCwKKwlJOTE1X0ZPUk1BVF9NT0RfWF9USUxFRCwKKwlEUk1fRk9STUFU
X01PRF9MSU5FQVIsCisJRFJNX0ZPUk1BVF9NT0RfSU5WQUxJRAorfTsKKworc3RhdGljIGNvbnN0
IHU2NCBnZW4xMl9wbGFuZV9mb3JtYXRfbW9kaWZpZXJzX3JjX2Njc1tdID0geworCUk5MTVfRk9S
TUFUX01PRF9ZX1RJTEVEX0dFTjEyX1JDX0NDUywKKwlJOTE1X0ZPUk1BVF9NT0RfWV9USUxFRF9H
RU4xMl9SQ19DQ1NfQ0MsCisJSTkxNV9GT1JNQVRfTU9EX1lfVElMRUQsCisJSTkxNV9GT1JNQVRf
TU9EX1hfVElMRUQsCisJRFJNX0ZPUk1BVF9NT0RfTElORUFSLAorCURSTV9GT1JNQVRfTU9EX0lO
VkFMSUQKK307CisKK2ludCBza2xfZm9ybWF0X3RvX2ZvdXJjYyhpbnQgZm9ybWF0LCBib29sIHJn
Yl9vcmRlciwgYm9vbCBhbHBoYSkKK3sKKwlzd2l0Y2ggKGZvcm1hdCkgeworCWNhc2UgUExBTkVf
Q1RMX0ZPUk1BVF9SR0JfNTY1OgorCQlyZXR1cm4gRFJNX0ZPUk1BVF9SR0I1NjU7CisJY2FzZSBQ
TEFORV9DVExfRk9STUFUX05WMTI6CisJCXJldHVybiBEUk1fRk9STUFUX05WMTI7CisJY2FzZSBQ
TEFORV9DVExfRk9STUFUX1hZVVY6CisJCXJldHVybiBEUk1fRk9STUFUX1hZVVY4ODg4OworCWNh
c2UgUExBTkVfQ1RMX0ZPUk1BVF9QMDEwOgorCQlyZXR1cm4gRFJNX0ZPUk1BVF9QMDEwOworCWNh
c2UgUExBTkVfQ1RMX0ZPUk1BVF9QMDEyOgorCQlyZXR1cm4gRFJNX0ZPUk1BVF9QMDEyOworCWNh
c2UgUExBTkVfQ1RMX0ZPUk1BVF9QMDE2OgorCQlyZXR1cm4gRFJNX0ZPUk1BVF9QMDE2OworCWNh
c2UgUExBTkVfQ1RMX0ZPUk1BVF9ZMjEwOgorCQlyZXR1cm4gRFJNX0ZPUk1BVF9ZMjEwOworCWNh
c2UgUExBTkVfQ1RMX0ZPUk1BVF9ZMjEyOgorCQlyZXR1cm4gRFJNX0ZPUk1BVF9ZMjEyOworCWNh
c2UgUExBTkVfQ1RMX0ZPUk1BVF9ZMjE2OgorCQlyZXR1cm4gRFJNX0ZPUk1BVF9ZMjE2OworCWNh
c2UgUExBTkVfQ1RMX0ZPUk1BVF9ZNDEwOgorCQlyZXR1cm4gRFJNX0ZPUk1BVF9YVllVMjEwMTAx
MDsKKwljYXNlIFBMQU5FX0NUTF9GT1JNQVRfWTQxMjoKKwkJcmV0dXJuIERSTV9GT1JNQVRfWFZZ
VTEyXzE2MTYxNjE2OworCWNhc2UgUExBTkVfQ1RMX0ZPUk1BVF9ZNDE2OgorCQlyZXR1cm4gRFJN
X0ZPUk1BVF9YVllVMTYxNjE2MTY7CisJZGVmYXVsdDoKKwljYXNlIFBMQU5FX0NUTF9GT1JNQVRf
WFJHQl84ODg4OgorCQlpZiAocmdiX29yZGVyKSB7CisJCQlpZiAoYWxwaGEpCisJCQkJcmV0dXJu
IERSTV9GT1JNQVRfQUJHUjg4ODg7CisJCQllbHNlCisJCQkJcmV0dXJuIERSTV9GT1JNQVRfWEJH
Ujg4ODg7CisJCX0gZWxzZSB7CisJCQlpZiAoYWxwaGEpCisJCQkJcmV0dXJuIERSTV9GT1JNQVRf
QVJHQjg4ODg7CisJCQllbHNlCisJCQkJcmV0dXJuIERSTV9GT1JNQVRfWFJHQjg4ODg7CisJCX0K
KwljYXNlIFBMQU5FX0NUTF9GT1JNQVRfWFJHQl8yMTAxMDEwOgorCQlpZiAocmdiX29yZGVyKSB7
CisJCQlpZiAoYWxwaGEpCisJCQkJcmV0dXJuIERSTV9GT1JNQVRfQUJHUjIxMDEwMTA7CisJCQll
bHNlCisJCQkJcmV0dXJuIERSTV9GT1JNQVRfWEJHUjIxMDEwMTA7CisJCX0gZWxzZSB7CisJCQlp
ZiAoYWxwaGEpCisJCQkJcmV0dXJuIERSTV9GT1JNQVRfQVJHQjIxMDEwMTA7CisJCQllbHNlCisJ
CQkJcmV0dXJuIERSTV9GT1JNQVRfWFJHQjIxMDEwMTA7CisJCX0KKwljYXNlIFBMQU5FX0NUTF9G
T1JNQVRfWFJHQl8xNjE2MTYxNkY6CisJCWlmIChyZ2Jfb3JkZXIpIHsKKwkJCWlmIChhbHBoYSkK
KwkJCQlyZXR1cm4gRFJNX0ZPUk1BVF9BQkdSMTYxNjE2MTZGOworCQkJZWxzZQorCQkJCXJldHVy
biBEUk1fRk9STUFUX1hCR1IxNjE2MTYxNkY7CisJCX0gZWxzZSB7CisJCQlpZiAoYWxwaGEpCisJ
CQkJcmV0dXJuIERSTV9GT1JNQVRfQVJHQjE2MTYxNjE2RjsKKwkJCWVsc2UKKwkJCQlyZXR1cm4g
RFJNX0ZPUk1BVF9YUkdCMTYxNjE2MTZGOworCQl9CisJfQorfQorCitzdGF0aWMgdTggaWNsX252
MTJfeV9wbGFuZV9tYXNrKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KQoreworCWlmIChI
QVNfRDEyX1BMQU5FX01JTklNSVpBVElPTihpOTE1KSkKKwkJcmV0dXJuIEJJVChQTEFORV9TUFJJ
VEUyKSB8IEJJVChQTEFORV9TUFJJVEUzKTsKKwllbHNlCisJCXJldHVybiBCSVQoUExBTkVfU1BS
SVRFNCkgfCBCSVQoUExBTkVfU1BSSVRFNSk7Cit9CisKK2Jvb2wgaWNsX2lzX252MTJfeV9wbGFu
ZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCisJCQkgZW51bSBwbGFuZV9pZCBw
bGFuZV9pZCkKK3sKKwlyZXR1cm4gSU5URUxfR0VOKGRldl9wcml2KSA+PSAxMSAmJgorCQlpY2xf
bnYxMl95X3BsYW5lX21hc2soZGV2X3ByaXYpICYgQklUKHBsYW5lX2lkKTsKK30KKworYm9vbCBp
Y2xfaXNfaGRyX3BsYW5lKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwgZW51bSBw
bGFuZV9pZCBwbGFuZV9pZCkKK3sKKwlyZXR1cm4gSU5URUxfR0VOKGRldl9wcml2KSA+PSAxMSAm
JgorCQlpY2xfaGRyX3BsYW5lX21hc2soKSAmIEJJVChwbGFuZV9pZCk7Cit9CisKK3N0YXRpYyB2
b2lkCitza2xfcGxhbmVfcmF0aW8oY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNf
c3RhdGUsCisJCWNvbnN0IHN0cnVjdCBpbnRlbF9wbGFuZV9zdGF0ZSAqcGxhbmVfc3RhdGUsCisJ
CXVuc2lnbmVkIGludCAqbnVtLCB1bnNpZ25lZCBpbnQgKmRlbikKK3sKKwlzdHJ1Y3QgZHJtX2k5
MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KHBsYW5lX3N0YXRlLT51YXBpLnBsYW5lLT5k
ZXYpOworCWNvbnN0IHN0cnVjdCBkcm1fZnJhbWVidWZmZXIgKmZiID0gcGxhbmVfc3RhdGUtPmh3
LmZiOworCisJaWYgKGZiLT5mb3JtYXQtPmNwcFswXSA9PSA4KSB7CisJCWlmIChJTlRFTF9HRU4o
ZGV2X3ByaXYpID49IDEwIHx8IElTX0dFTUlOSUxBS0UoZGV2X3ByaXYpKSB7CisJCQkqbnVtID0g
MTA7CisJCQkqZGVuID0gODsKKwkJfSBlbHNlIHsKKwkJCSpudW0gPSA5OworCQkJKmRlbiA9IDg7
CisJCX0KKwl9IGVsc2UgeworCQkqbnVtID0gMTsKKwkJKmRlbiA9IDE7CisJfQorfQorCitzdGF0
aWMgaW50IHNrbF9wbGFuZV9taW5fY2RjbGsoY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUg
KmNydGNfc3RhdGUsCisJCQkgICAgICAgY29uc3Qgc3RydWN0IGludGVsX3BsYW5lX3N0YXRlICpw
bGFuZV9zdGF0ZSkKK3sKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19p
OTE1KHBsYW5lX3N0YXRlLT51YXBpLnBsYW5lLT5kZXYpOworCXVuc2lnbmVkIGludCBudW0sIGRl
bjsKKwl1bnNpZ25lZCBpbnQgcGl4ZWxfcmF0ZSA9IGludGVsX3BsYW5lX3BpeGVsX3JhdGUoY3J0
Y19zdGF0ZSwgcGxhbmVfc3RhdGUpOworCisJc2tsX3BsYW5lX3JhdGlvKGNydGNfc3RhdGUsIHBs
YW5lX3N0YXRlLCAmbnVtLCAmZGVuKTsKKworCS8qIHR3byBwaXhlbHMgcGVyIGNsb2NrIG9uIGds
aysgKi8KKwlpZiAoSU5URUxfR0VOKGRldl9wcml2KSA+PSAxMCB8fCBJU19HRU1JTklMQUtFKGRl
dl9wcml2KSkKKwkJZGVuICo9IDI7CisKKwlyZXR1cm4gRElWX1JPVU5EX1VQKHBpeGVsX3JhdGUg
KiBudW0sIGRlbik7Cit9CisKK3N0YXRpYyBpbnQgc2tsX3BsYW5lX21heF93aWR0aChjb25zdCBz
dHJ1Y3QgZHJtX2ZyYW1lYnVmZmVyICpmYiwKKwkJCSAgICAgICBpbnQgY29sb3JfcGxhbmUsCisJ
CQkgICAgICAgdW5zaWduZWQgaW50IHJvdGF0aW9uKQoreworCWludCBjcHAgPSBmYi0+Zm9ybWF0
LT5jcHBbY29sb3JfcGxhbmVdOworCisJc3dpdGNoIChmYi0+bW9kaWZpZXIpIHsKKwljYXNlIERS
TV9GT1JNQVRfTU9EX0xJTkVBUjoKKwljYXNlIEk5MTVfRk9STUFUX01PRF9YX1RJTEVEOgorCQkv
KgorCQkgKiBWYWxpZGF0ZWQgbGltaXQgaXMgNGssIGJ1dCBoYXMgNWsgc2hvdWxkCisJCSAqIHdv
cmsgYXBhcnQgZnJvbSB0aGUgZm9sbG93aW5nIGZlYXR1cmVzOgorCQkgKiAtIFl0aWxlIChhbHJl
YWR5IGxpbWl0ZWQgdG8gNGspCisJCSAqIC0gRlAxNiAoYWxyZWFkeSBsaW1pdGVkIHRvIDRrKQor
CQkgKiAtIHJlbmRlciBjb21wcmVzc2lvbiAoYWxyZWFkeSBsaW1pdGVkIHRvIDRrKQorCQkgKiAt
IEtWTVIgc3ByaXRlIGFuZCBjdXJzb3IgKGRvbid0IGNhcmUpCisJCSAqIC0gaG9yaXpvbnRhbCBw
YW5uaW5nIChUT0RPIHZlcmlmeSB0aGlzKQorCQkgKiAtIHBpcGUgYW5kIHBsYW5lIHNjYWxpbmcg
KFRPRE8gdmVyaWZ5IHRoaXMpCisJCSAqLworCQlpZiAoY3BwID09IDgpCisJCQlyZXR1cm4gNDA5
NjsKKwkJZWxzZQorCQkJcmV0dXJuIDUxMjA7CisJY2FzZSBJOTE1X0ZPUk1BVF9NT0RfWV9USUxF
RF9DQ1M6CisJY2FzZSBJOTE1X0ZPUk1BVF9NT0RfWWZfVElMRURfQ0NTOgorCWNhc2UgSTkxNV9G
T1JNQVRfTU9EX1lfVElMRURfR0VOMTJfTUNfQ0NTOgorCQkvKiBGSVhNRSBBVVggcGxhbmU/ICov
CisJY2FzZSBJOTE1X0ZPUk1BVF9NT0RfWV9USUxFRDoKKwljYXNlIEk5MTVfRk9STUFUX01PRF9Z
Zl9USUxFRDoKKwkJaWYgKGNwcCA9PSA4KQorCQkJcmV0dXJuIDIwNDg7CisJCWVsc2UKKwkJCXJl
dHVybiA0MDk2OworCWRlZmF1bHQ6CisJCU1JU1NJTkdfQ0FTRShmYi0+bW9kaWZpZXIpOworCQly
ZXR1cm4gMjA0ODsKKwl9Cit9CisKK3N0YXRpYyBpbnQgZ2xrX3BsYW5lX21heF93aWR0aChjb25z
dCBzdHJ1Y3QgZHJtX2ZyYW1lYnVmZmVyICpmYiwKKwkJCSAgICAgICBpbnQgY29sb3JfcGxhbmUs
CisJCQkgICAgICAgdW5zaWduZWQgaW50IHJvdGF0aW9uKQoreworCWludCBjcHAgPSBmYi0+Zm9y
bWF0LT5jcHBbY29sb3JfcGxhbmVdOworCisJc3dpdGNoIChmYi0+bW9kaWZpZXIpIHsKKwljYXNl
IERSTV9GT1JNQVRfTU9EX0xJTkVBUjoKKwljYXNlIEk5MTVfRk9STUFUX01PRF9YX1RJTEVEOgor
CQlpZiAoY3BwID09IDgpCisJCQlyZXR1cm4gNDA5NjsKKwkJZWxzZQorCQkJcmV0dXJuIDUxMjA7
CisJY2FzZSBJOTE1X0ZPUk1BVF9NT0RfWV9USUxFRF9DQ1M6CisJY2FzZSBJOTE1X0ZPUk1BVF9N
T0RfWWZfVElMRURfQ0NTOgorCQkvKiBGSVhNRSBBVVggcGxhbmU/ICovCisJY2FzZSBJOTE1X0ZP
Uk1BVF9NT0RfWV9USUxFRDoKKwljYXNlIEk5MTVfRk9STUFUX01PRF9ZZl9USUxFRDoKKwkJaWYg
KGNwcCA9PSA4KQorCQkJcmV0dXJuIDIwNDg7CisJCWVsc2UKKwkJCXJldHVybiA1MTIwOworCWRl
ZmF1bHQ6CisJCU1JU1NJTkdfQ0FTRShmYi0+bW9kaWZpZXIpOworCQlyZXR1cm4gMjA0ODsKKwl9
Cit9CisKK3N0YXRpYyBpbnQgaWNsX3BsYW5lX21pbl93aWR0aChjb25zdCBzdHJ1Y3QgZHJtX2Zy
YW1lYnVmZmVyICpmYiwKKwkJCSAgICAgICBpbnQgY29sb3JfcGxhbmUsCisJCQkgICAgICAgdW5z
aWduZWQgaW50IHJvdGF0aW9uKQoreworCS8qIFdhXzE0MDExMjY0NjU3LCBXYV8xNDAxMTA1MDU2
MzogZ2VuMTErICovCisJc3dpdGNoIChmYi0+Zm9ybWF0LT5mb3JtYXQpIHsKKwljYXNlIERSTV9G
T1JNQVRfQzg6CisJCXJldHVybiAxODsKKwljYXNlIERSTV9GT1JNQVRfUkdCNTY1OgorCQlyZXR1
cm4gMTA7CisJY2FzZSBEUk1fRk9STUFUX1hSR0I4ODg4OgorCWNhc2UgRFJNX0ZPUk1BVF9YQkdS
ODg4ODoKKwljYXNlIERSTV9GT1JNQVRfQVJHQjg4ODg6CisJY2FzZSBEUk1fRk9STUFUX0FCR1I4
ODg4OgorCWNhc2UgRFJNX0ZPUk1BVF9YUkdCMjEwMTAxMDoKKwljYXNlIERSTV9GT1JNQVRfWEJH
UjIxMDEwMTA6CisJY2FzZSBEUk1fRk9STUFUX0FSR0IyMTAxMDEwOgorCWNhc2UgRFJNX0ZPUk1B
VF9BQkdSMjEwMTAxMDoKKwljYXNlIERSTV9GT1JNQVRfWFZZVTIxMDEwMTA6CisJY2FzZSBEUk1f
Rk9STUFUX1kyMTI6CisJY2FzZSBEUk1fRk9STUFUX1kyMTY6CisJCXJldHVybiA2OworCWNhc2Ug
RFJNX0ZPUk1BVF9OVjEyOgorCQlyZXR1cm4gMjA7CisJY2FzZSBEUk1fRk9STUFUX1AwMTA6CisJ
Y2FzZSBEUk1fRk9STUFUX1AwMTI6CisJY2FzZSBEUk1fRk9STUFUX1AwMTY6CisJCXJldHVybiAx
MjsKKwljYXNlIERSTV9GT1JNQVRfWFJHQjE2MTYxNjE2RjoKKwljYXNlIERSTV9GT1JNQVRfWEJH
UjE2MTYxNjE2RjoKKwljYXNlIERSTV9GT1JNQVRfQVJHQjE2MTYxNjE2RjoKKwljYXNlIERSTV9G
T1JNQVRfQUJHUjE2MTYxNjE2RjoKKwljYXNlIERSTV9GT1JNQVRfWFZZVTEyXzE2MTYxNjE2Ogor
CWNhc2UgRFJNX0ZPUk1BVF9YVllVMTYxNjE2MTY6CisJCXJldHVybiA0OworCWRlZmF1bHQ6CisJ
CXJldHVybiAxOworCX0KK30KKworc3RhdGljIGludCBpY2xfcGxhbmVfbWF4X3dpZHRoKGNvbnN0
IHN0cnVjdCBkcm1fZnJhbWVidWZmZXIgKmZiLAorCQkJICAgICAgIGludCBjb2xvcl9wbGFuZSwK
KwkJCSAgICAgICB1bnNpZ25lZCBpbnQgcm90YXRpb24pCit7CisJcmV0dXJuIDUxMjA7Cit9CisK
K3N0YXRpYyBpbnQgc2tsX3BsYW5lX21heF9oZWlnaHQoY29uc3Qgc3RydWN0IGRybV9mcmFtZWJ1
ZmZlciAqZmIsCisJCQkJaW50IGNvbG9yX3BsYW5lLAorCQkJCXVuc2lnbmVkIGludCByb3RhdGlv
bikKK3sKKwlyZXR1cm4gNDA5NjsKK30KKworc3RhdGljIGludCBpY2xfcGxhbmVfbWF4X2hlaWdo
dChjb25zdCBzdHJ1Y3QgZHJtX2ZyYW1lYnVmZmVyICpmYiwKKwkJCQlpbnQgY29sb3JfcGxhbmUs
CisJCQkJdW5zaWduZWQgaW50IHJvdGF0aW9uKQoreworCXJldHVybiA0MzIwOworfQorCitzdGF0
aWMgdW5zaWduZWQgaW50Citza2xfcGxhbmVfbWF4X3N0cmlkZShzdHJ1Y3QgaW50ZWxfcGxhbmUg
KnBsYW5lLAorCQkgICAgIHUzMiBwaXhlbF9mb3JtYXQsIHU2NCBtb2RpZmllciwKKwkJICAgICB1
bnNpZ25lZCBpbnQgcm90YXRpb24pCit7CisJY29uc3Qgc3RydWN0IGRybV9mb3JtYXRfaW5mbyAq
aW5mbyA9IGRybV9mb3JtYXRfaW5mbyhwaXhlbF9mb3JtYXQpOworCWludCBjcHAgPSBpbmZvLT5j
cHBbMF07CisKKwkvKgorCSAqICJUaGUgc3RyaWRlIGluIGJ5dGVzIG11c3Qgbm90IGV4Y2VlZCB0
aGUKKwkgKiBvZiB0aGUgc2l6ZSBvZiA4SyBwaXhlbHMgYW5kIDMySyBieXRlcy4iCisJICovCisJ
aWYgKGRybV9yb3RhdGlvbl85MF9vcl8yNzAocm90YXRpb24pKQorCQlyZXR1cm4gbWluKDgxOTIs
IDMyNzY4IC8gY3BwKTsKKwllbHNlCisJCXJldHVybiBtaW4oODE5MiAqIGNwcCwgMzI3NjgpOwor
fQorCisKKy8qIFByZW9mZnNldCB2YWx1ZXMgZm9yIFlVViB0byBSR0IgQ29udmVyc2lvbiAqLwor
I2RlZmluZSBQUkVPRkZfWVVWX1RPX1JHQl9ISQkJMHgxODAwCisjZGVmaW5lIFBSRU9GRl9ZVVZf
VE9fUkdCX01FCQkweDAwMDAKKyNkZWZpbmUgUFJFT0ZGX1lVVl9UT19SR0JfTE8JCTB4MTgwMAor
CisjZGVmaW5lICBST0ZGKHgpICAgICAgICAgICgoKHgpICYgMHhmZmZmKSA8PCAxNikKKyNkZWZp
bmUgIEdPRkYoeCkgICAgICAgICAgKCgoeCkgJiAweGZmZmYpIDw8IDApCisjZGVmaW5lICBCT0ZG
KHgpICAgICAgICAgICgoKHgpICYgMHhmZmZmKSA8PCAxNikKKworLyoKKyAqIFByb2dyYW1zIHRo
ZSBpbnB1dCBjb2xvciBzcGFjZSBjb252ZXJzaW9uIHN0YWdlIGZvciBJQ0wgSERSIHBsYW5lcy4K
KyAqIE5vdGUgdGhhdCBpdCBpcyBhc3N1bWVkIHRoYXQgdGhpcyBzdGFnZSBhbHdheXMgaGFwcGVu
cyBhZnRlciBZVVYKKyAqIHJhbmdlIGNvcnJlY3Rpb24uIFRodXMsIHRoZSBpbnB1dCB0byB0aGlz
IHN0YWdlIGlzIGFzc3VtZWQgdG8gYmUKKyAqIGluIGZ1bGwtcmFuZ2UgWUNiQ3IuCisgKi8KK3N0
YXRpYyB2b2lkCitpY2xfcHJvZ3JhbV9pbnB1dF9jc2Moc3RydWN0IGludGVsX3BsYW5lICpwbGFu
ZSwKKwkJICAgICAgY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUsCisJ
CSAgICAgIGNvbnN0IHN0cnVjdCBpbnRlbF9wbGFuZV9zdGF0ZSAqcGxhbmVfc3RhdGUpCit7CisJ
c3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShwbGFuZS0+YmFzZS5k
ZXYpOworCWVudW0gcGlwZSBwaXBlID0gcGxhbmUtPnBpcGU7CisJZW51bSBwbGFuZV9pZCBwbGFu
ZV9pZCA9IHBsYW5lLT5pZDsKKworCXN0YXRpYyBjb25zdCB1MTYgaW5wdXRfY3NjX21hdHJpeFtd
WzldID0geworCQkvKgorCQkgKiBCVC42MDEgZnVsbCByYW5nZSBZQ2JDciAtPiBmdWxsIHJhbmdl
IFJHQgorCQkgKiBUaGUgbWF0cml4IHJlcXVpcmVkIGlzIDoKKwkJICogWzEuMDAwLCAwLjAwMCwg
MS4zNzEsCisJCSAqICAxLjAwMCwgLTAuMzM2LCAtMC42OTgsCisJCSAqICAxLjAwMCwgMS43MzIs
IDAuMDAwMF0KKwkJICovCisJCVtEUk1fQ09MT1JfWUNCQ1JfQlQ2MDFdID0geworCQkJMHg3QUY4
LCAweDc4MDAsIDB4MCwKKwkJCTB4OEIyOCwgMHg3ODAwLCAweDlBQzAsCisJCQkweDAsIDB4Nzgw
MCwgMHg3REQ4LAorCQl9LAorCQkvKgorCQkgKiBCVC43MDkgZnVsbCByYW5nZSBZQ2JDciAtPiBm
dWxsIHJhbmdlIFJHQgorCQkgKiBUaGUgbWF0cml4IHJlcXVpcmVkIGlzIDoKKwkJICogWzEuMDAw
LCAwLjAwMCwgMS41NzQsCisJCSAqICAxLjAwMCwgLTAuMTg3LCAtMC40NjgsCisJCSAqICAxLjAw
MCwgMS44NTUsIDAuMDAwMF0KKwkJICovCisJCVtEUk1fQ09MT1JfWUNCQ1JfQlQ3MDldID0gewor
CQkJMHg3Qzk4LCAweDc4MDAsIDB4MCwKKwkJCTB4OUVGOCwgMHg3ODAwLCAweEFDMDAsCisJCQkw
eDAsIDB4NzgwMCwgIDB4N0VEOCwKKwkJfSwKKwkJLyoKKwkJICogQlQuMjAyMCBmdWxsIHJhbmdl
IFlDYkNyIC0+IGZ1bGwgcmFuZ2UgUkdCCisJCSAqIFRoZSBtYXRyaXggcmVxdWlyZWQgaXMgOgor
CQkgKiBbMS4wMDAsIDAuMDAwLCAxLjQ3NCwKKwkJICogIDEuMDAwLCAtMC4xNjQ1LCAtMC41NzEz
LAorCQkgKiAgMS4wMDAsIDEuODgxNCwgMC4wMDAwXQorCQkgKi8KKwkJW0RSTV9DT0xPUl9ZQ0JD
Ul9CVDIwMjBdID0geworCQkJMHg3QkM4LCAweDc4MDAsIDB4MCwKKwkJCTB4ODkyOCwgMHg3ODAw
LCAweEFBODgsCisJCQkweDAsIDB4NzgwMCwgMHg3RjEwLAorCQl9LAorCX07CisJY29uc3QgdTE2
ICpjc2MgPSBpbnB1dF9jc2NfbWF0cml4W3BsYW5lX3N0YXRlLT5ody5jb2xvcl9lbmNvZGluZ107
CisKKwlpbnRlbF9kZV93cml0ZV9mdyhkZXZfcHJpdiwgUExBTkVfSU5QVVRfQ1NDX0NPRUZGKHBp
cGUsIHBsYW5lX2lkLCAwKSwKKwkJCSAgUk9GRihjc2NbMF0pIHwgR09GRihjc2NbMV0pKTsKKwlp
bnRlbF9kZV93cml0ZV9mdyhkZXZfcHJpdiwgUExBTkVfSU5QVVRfQ1NDX0NPRUZGKHBpcGUsIHBs
YW5lX2lkLCAxKSwKKwkJCSAgQk9GRihjc2NbMl0pKTsKKwlpbnRlbF9kZV93cml0ZV9mdyhkZXZf
cHJpdiwgUExBTkVfSU5QVVRfQ1NDX0NPRUZGKHBpcGUsIHBsYW5lX2lkLCAyKSwKKwkJCSAgUk9G
Rihjc2NbM10pIHwgR09GRihjc2NbNF0pKTsKKwlpbnRlbF9kZV93cml0ZV9mdyhkZXZfcHJpdiwg
UExBTkVfSU5QVVRfQ1NDX0NPRUZGKHBpcGUsIHBsYW5lX2lkLCAzKSwKKwkJCSAgQk9GRihjc2Nb
NV0pKTsKKwlpbnRlbF9kZV93cml0ZV9mdyhkZXZfcHJpdiwgUExBTkVfSU5QVVRfQ1NDX0NPRUZG
KHBpcGUsIHBsYW5lX2lkLCA0KSwKKwkJCSAgUk9GRihjc2NbNl0pIHwgR09GRihjc2NbN10pKTsK
KwlpbnRlbF9kZV93cml0ZV9mdyhkZXZfcHJpdiwgUExBTkVfSU5QVVRfQ1NDX0NPRUZGKHBpcGUs
IHBsYW5lX2lkLCA1KSwKKwkJCSAgQk9GRihjc2NbOF0pKTsKKworCWludGVsX2RlX3dyaXRlX2Z3
KGRldl9wcml2LCBQTEFORV9JTlBVVF9DU0NfUFJFT0ZGKHBpcGUsIHBsYW5lX2lkLCAwKSwKKwkJ
CSAgUFJFT0ZGX1lVVl9UT19SR0JfSEkpOworCWludGVsX2RlX3dyaXRlX2Z3KGRldl9wcml2LCBQ
TEFORV9JTlBVVF9DU0NfUFJFT0ZGKHBpcGUsIHBsYW5lX2lkLCAxKSwKKwkJCSAgUFJFT0ZGX1lV
Vl9UT19SR0JfTUUpOworCWludGVsX2RlX3dyaXRlX2Z3KGRldl9wcml2LCBQTEFORV9JTlBVVF9D
U0NfUFJFT0ZGKHBpcGUsIHBsYW5lX2lkLCAyKSwKKwkJCSAgUFJFT0ZGX1lVVl9UT19SR0JfTE8p
OworCWludGVsX2RlX3dyaXRlX2Z3KGRldl9wcml2LAorCQkJICBQTEFORV9JTlBVVF9DU0NfUE9T
VE9GRihwaXBlLCBwbGFuZV9pZCwgMCksIDB4MCk7CisJaW50ZWxfZGVfd3JpdGVfZncoZGV2X3By
aXYsCisJCQkgIFBMQU5FX0lOUFVUX0NTQ19QT1NUT0ZGKHBpcGUsIHBsYW5lX2lkLCAxKSwgMHgw
KTsKKwlpbnRlbF9kZV93cml0ZV9mdyhkZXZfcHJpdiwKKwkJCSAgUExBTkVfSU5QVVRfQ1NDX1BP
U1RPRkYocGlwZSwgcGxhbmVfaWQsIDIpLCAweDApOworfQorCitzdGF0aWMgYm9vbCBpc19zdXJm
YWNlX2xpbmVhcihjb25zdCBzdHJ1Y3QgZHJtX2ZyYW1lYnVmZmVyICpmYiwgaW50IGNvbG9yX3Bs
YW5lKQoreworCXJldHVybiBmYi0+bW9kaWZpZXIgPT0gRFJNX0ZPUk1BVF9NT0RfTElORUFSIHx8
CisJICAgICAgIGlzX2dlbjEyX2Njc19wbGFuZShmYiwgY29sb3JfcGxhbmUpOworfQorCitzdGF0
aWMgdW5zaWduZWQgaW50IHNrbF9wbGFuZV9zdHJpZGVfbXVsdChjb25zdCBzdHJ1Y3QgZHJtX2Zy
YW1lYnVmZmVyICpmYiwKKwkJCQkJICBpbnQgY29sb3JfcGxhbmUsIHVuc2lnbmVkIGludCByb3Rh
dGlvbikKK3sKKwkvKgorCSAqIFRoZSBzdHJpZGUgaXMgZWl0aGVyIGV4cHJlc3NlZCBhcyBhIG11
bHRpcGxlIG9mIDY0IGJ5dGVzIGNodW5rcyBmb3IKKwkgKiBsaW5lYXIgYnVmZmVycyBvciBpbiBu
dW1iZXIgb2YgdGlsZXMgZm9yIHRpbGVkIGJ1ZmZlcnMuCisJICovCisJaWYgKGlzX3N1cmZhY2Vf
bGluZWFyKGZiLCBjb2xvcl9wbGFuZSkpCisJCXJldHVybiA2NDsKKwllbHNlIGlmIChkcm1fcm90
YXRpb25fOTBfb3JfMjcwKHJvdGF0aW9uKSkKKwkJcmV0dXJuIGludGVsX3RpbGVfaGVpZ2h0KGZi
LCBjb2xvcl9wbGFuZSk7CisJZWxzZQorCQlyZXR1cm4gaW50ZWxfdGlsZV93aWR0aF9ieXRlcyhm
YiwgY29sb3JfcGxhbmUpOworfQorCitzdGF0aWMgdTMyIHNrbF9wbGFuZV9zdHJpZGUoY29uc3Qg
c3RydWN0IGludGVsX3BsYW5lX3N0YXRlICpwbGFuZV9zdGF0ZSwKKwkJCSAgICBpbnQgY29sb3Jf
cGxhbmUpCit7CisJY29uc3Qgc3RydWN0IGRybV9mcmFtZWJ1ZmZlciAqZmIgPSBwbGFuZV9zdGF0
ZS0+aHcuZmI7CisJdW5zaWduZWQgaW50IHJvdGF0aW9uID0gcGxhbmVfc3RhdGUtPmh3LnJvdGF0
aW9uOworCXUzMiBzdHJpZGUgPSBwbGFuZV9zdGF0ZS0+Y29sb3JfcGxhbmVbY29sb3JfcGxhbmVd
LnN0cmlkZTsKKworCWlmIChjb2xvcl9wbGFuZSA+PSBmYi0+Zm9ybWF0LT5udW1fcGxhbmVzKQor
CQlyZXR1cm4gMDsKKworCXJldHVybiBzdHJpZGUgLyBza2xfcGxhbmVfc3RyaWRlX211bHQoZmIs
IGNvbG9yX3BsYW5lLCByb3RhdGlvbik7Cit9CisKK3N0YXRpYyB2b2lkCitza2xfZGlzYWJsZV9w
bGFuZShzdHJ1Y3QgaW50ZWxfcGxhbmUgKnBsYW5lLAorCQkgIGNvbnN0IHN0cnVjdCBpbnRlbF9j
cnRjX3N0YXRlICpjcnRjX3N0YXRlKQoreworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZf
cHJpdiA9IHRvX2k5MTUocGxhbmUtPmJhc2UuZGV2KTsKKwllbnVtIHBsYW5lX2lkIHBsYW5lX2lk
ID0gcGxhbmUtPmlkOworCWVudW0gcGlwZSBwaXBlID0gcGxhbmUtPnBpcGU7CisJdW5zaWduZWQg
bG9uZyBpcnFmbGFnczsKKworCXNwaW5fbG9ja19pcnFzYXZlKCZkZXZfcHJpdi0+dW5jb3JlLmxv
Y2ssIGlycWZsYWdzKTsKKworCWlmIChpY2xfaXNfaGRyX3BsYW5lKGRldl9wcml2LCBwbGFuZV9p
ZCkpCisJCWludGVsX2RlX3dyaXRlX2Z3KGRldl9wcml2LCBQTEFORV9DVVNfQ1RMKHBpcGUsIHBs
YW5lX2lkKSwgMCk7CisKKwlza2xfd3JpdGVfcGxhbmVfd20ocGxhbmUsIGNydGNfc3RhdGUpOwor
CisJaW50ZWxfZGVfd3JpdGVfZncoZGV2X3ByaXYsIFBMQU5FX0NUTChwaXBlLCBwbGFuZV9pZCks
IDApOworCWludGVsX2RlX3dyaXRlX2Z3KGRldl9wcml2LCBQTEFORV9TVVJGKHBpcGUsIHBsYW5l
X2lkKSwgMCk7CisKKwlzcGluX3VubG9ja19pcnFyZXN0b3JlKCZkZXZfcHJpdi0+dW5jb3JlLmxv
Y2ssIGlycWZsYWdzKTsKK30KKworc3RhdGljIGJvb2wKK3NrbF9wbGFuZV9nZXRfaHdfc3RhdGUo
c3RydWN0IGludGVsX3BsYW5lICpwbGFuZSwKKwkJICAgICAgIGVudW0gcGlwZSAqcGlwZSkKK3sK
KwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KHBsYW5lLT5iYXNl
LmRldik7CisJZW51bSBpbnRlbF9kaXNwbGF5X3Bvd2VyX2RvbWFpbiBwb3dlcl9kb21haW47CisJ
ZW51bSBwbGFuZV9pZCBwbGFuZV9pZCA9IHBsYW5lLT5pZDsKKwlpbnRlbF93YWtlcmVmX3Qgd2Fr
ZXJlZjsKKwlib29sIHJldDsKKworCXBvd2VyX2RvbWFpbiA9IFBPV0VSX0RPTUFJTl9QSVBFKHBs
YW5lLT5waXBlKTsKKwl3YWtlcmVmID0gaW50ZWxfZGlzcGxheV9wb3dlcl9nZXRfaWZfZW5hYmxl
ZChkZXZfcHJpdiwgcG93ZXJfZG9tYWluKTsKKwlpZiAoIXdha2VyZWYpCisJCXJldHVybiBmYWxz
ZTsKKworCXJldCA9IGludGVsX2RlX3JlYWQoZGV2X3ByaXYsIFBMQU5FX0NUTChwbGFuZS0+cGlw
ZSwgcGxhbmVfaWQpKSAmIFBMQU5FX0NUTF9FTkFCTEU7CisKKwkqcGlwZSA9IHBsYW5lLT5waXBl
OworCisJaW50ZWxfZGlzcGxheV9wb3dlcl9wdXQoZGV2X3ByaXYsIHBvd2VyX2RvbWFpbiwgd2Fr
ZXJlZik7CisKKwlyZXR1cm4gcmV0OworfQorCitzdGF0aWMgdTMyIHNrbF9wbGFuZV9jdGxfZm9y
bWF0KHUzMiBwaXhlbF9mb3JtYXQpCit7CisJc3dpdGNoIChwaXhlbF9mb3JtYXQpIHsKKwljYXNl
IERSTV9GT1JNQVRfQzg6CisJCXJldHVybiBQTEFORV9DVExfRk9STUFUX0lOREVYRUQ7CisJY2Fz
ZSBEUk1fRk9STUFUX1JHQjU2NToKKwkJcmV0dXJuIFBMQU5FX0NUTF9GT1JNQVRfUkdCXzU2NTsK
KwljYXNlIERSTV9GT1JNQVRfWEJHUjg4ODg6CisJY2FzZSBEUk1fRk9STUFUX0FCR1I4ODg4Ogor
CQlyZXR1cm4gUExBTkVfQ1RMX0ZPUk1BVF9YUkdCXzg4ODggfCBQTEFORV9DVExfT1JERVJfUkdC
WDsKKwljYXNlIERSTV9GT1JNQVRfWFJHQjg4ODg6CisJY2FzZSBEUk1fRk9STUFUX0FSR0I4ODg4
OgorCQlyZXR1cm4gUExBTkVfQ1RMX0ZPUk1BVF9YUkdCXzg4ODg7CisJY2FzZSBEUk1fRk9STUFU
X1hCR1IyMTAxMDEwOgorCWNhc2UgRFJNX0ZPUk1BVF9BQkdSMjEwMTAxMDoKKwkJcmV0dXJuIFBM
QU5FX0NUTF9GT1JNQVRfWFJHQl8yMTAxMDEwIHwgUExBTkVfQ1RMX09SREVSX1JHQlg7CisJY2Fz
ZSBEUk1fRk9STUFUX1hSR0IyMTAxMDEwOgorCWNhc2UgRFJNX0ZPUk1BVF9BUkdCMjEwMTAxMDoK
KwkJcmV0dXJuIFBMQU5FX0NUTF9GT1JNQVRfWFJHQl8yMTAxMDEwOworCWNhc2UgRFJNX0ZPUk1B
VF9YQkdSMTYxNjE2MTZGOgorCWNhc2UgRFJNX0ZPUk1BVF9BQkdSMTYxNjE2MTZGOgorCQlyZXR1
cm4gUExBTkVfQ1RMX0ZPUk1BVF9YUkdCXzE2MTYxNjE2RiB8IFBMQU5FX0NUTF9PUkRFUl9SR0JY
OworCWNhc2UgRFJNX0ZPUk1BVF9YUkdCMTYxNjE2MTZGOgorCWNhc2UgRFJNX0ZPUk1BVF9BUkdC
MTYxNjE2MTZGOgorCQlyZXR1cm4gUExBTkVfQ1RMX0ZPUk1BVF9YUkdCXzE2MTYxNjE2RjsKKwlj
YXNlIERSTV9GT1JNQVRfWFlVVjg4ODg6CisJCXJldHVybiBQTEFORV9DVExfRk9STUFUX1hZVVY7
CisJY2FzZSBEUk1fRk9STUFUX1lVWVY6CisJCXJldHVybiBQTEFORV9DVExfRk9STUFUX1lVVjQy
MiB8IFBMQU5FX0NUTF9ZVVY0MjJfWVVZVjsKKwljYXNlIERSTV9GT1JNQVRfWVZZVToKKwkJcmV0
dXJuIFBMQU5FX0NUTF9GT1JNQVRfWVVWNDIyIHwgUExBTkVfQ1RMX1lVVjQyMl9ZVllVOworCWNh
c2UgRFJNX0ZPUk1BVF9VWVZZOgorCQlyZXR1cm4gUExBTkVfQ1RMX0ZPUk1BVF9ZVVY0MjIgfCBQ
TEFORV9DVExfWVVWNDIyX1VZVlk7CisJY2FzZSBEUk1fRk9STUFUX1ZZVVk6CisJCXJldHVybiBQ
TEFORV9DVExfRk9STUFUX1lVVjQyMiB8IFBMQU5FX0NUTF9ZVVY0MjJfVllVWTsKKwljYXNlIERS
TV9GT1JNQVRfTlYxMjoKKwkJcmV0dXJuIFBMQU5FX0NUTF9GT1JNQVRfTlYxMjsKKwljYXNlIERS
TV9GT1JNQVRfUDAxMDoKKwkJcmV0dXJuIFBMQU5FX0NUTF9GT1JNQVRfUDAxMDsKKwljYXNlIERS
TV9GT1JNQVRfUDAxMjoKKwkJcmV0dXJuIFBMQU5FX0NUTF9GT1JNQVRfUDAxMjsKKwljYXNlIERS
TV9GT1JNQVRfUDAxNjoKKwkJcmV0dXJuIFBMQU5FX0NUTF9GT1JNQVRfUDAxNjsKKwljYXNlIERS
TV9GT1JNQVRfWTIxMDoKKwkJcmV0dXJuIFBMQU5FX0NUTF9GT1JNQVRfWTIxMDsKKwljYXNlIERS
TV9GT1JNQVRfWTIxMjoKKwkJcmV0dXJuIFBMQU5FX0NUTF9GT1JNQVRfWTIxMjsKKwljYXNlIERS
TV9GT1JNQVRfWTIxNjoKKwkJcmV0dXJuIFBMQU5FX0NUTF9GT1JNQVRfWTIxNjsKKwljYXNlIERS
TV9GT1JNQVRfWFZZVTIxMDEwMTA6CisJCXJldHVybiBQTEFORV9DVExfRk9STUFUX1k0MTA7CisJ
Y2FzZSBEUk1fRk9STUFUX1hWWVUxMl8xNjE2MTYxNjoKKwkJcmV0dXJuIFBMQU5FX0NUTF9GT1JN
QVRfWTQxMjsKKwljYXNlIERSTV9GT1JNQVRfWFZZVTE2MTYxNjE2OgorCQlyZXR1cm4gUExBTkVf
Q1RMX0ZPUk1BVF9ZNDE2OworCWRlZmF1bHQ6CisJCU1JU1NJTkdfQ0FTRShwaXhlbF9mb3JtYXQp
OworCX0KKworCXJldHVybiAwOworfQorCitzdGF0aWMgdTMyIHNrbF9wbGFuZV9jdGxfYWxwaGEo
Y29uc3Qgc3RydWN0IGludGVsX3BsYW5lX3N0YXRlICpwbGFuZV9zdGF0ZSkKK3sKKwlpZiAoIXBs
YW5lX3N0YXRlLT5ody5mYi0+Zm9ybWF0LT5oYXNfYWxwaGEpCisJCXJldHVybiBQTEFORV9DVExf
QUxQSEFfRElTQUJMRTsKKworCXN3aXRjaCAocGxhbmVfc3RhdGUtPmh3LnBpeGVsX2JsZW5kX21v
ZGUpIHsKKwljYXNlIERSTV9NT0RFX0JMRU5EX1BJWEVMX05PTkU6CisJCXJldHVybiBQTEFORV9D
VExfQUxQSEFfRElTQUJMRTsKKwljYXNlIERSTV9NT0RFX0JMRU5EX1BSRU1VTFRJOgorCQlyZXR1
cm4gUExBTkVfQ1RMX0FMUEhBX1NXX1BSRU1VTFRJUExZOworCWNhc2UgRFJNX01PREVfQkxFTkRf
Q09WRVJBR0U6CisJCXJldHVybiBQTEFORV9DVExfQUxQSEFfSFdfUFJFTVVMVElQTFk7CisJZGVm
YXVsdDoKKwkJTUlTU0lOR19DQVNFKHBsYW5lX3N0YXRlLT5ody5waXhlbF9ibGVuZF9tb2RlKTsK
KwkJcmV0dXJuIFBMQU5FX0NUTF9BTFBIQV9ESVNBQkxFOworCX0KK30KKworc3RhdGljIHUzMiBn
bGtfcGxhbmVfY29sb3JfY3RsX2FscGhhKGNvbnN0IHN0cnVjdCBpbnRlbF9wbGFuZV9zdGF0ZSAq
cGxhbmVfc3RhdGUpCit7CisJaWYgKCFwbGFuZV9zdGF0ZS0+aHcuZmItPmZvcm1hdC0+aGFzX2Fs
cGhhKQorCQlyZXR1cm4gUExBTkVfQ09MT1JfQUxQSEFfRElTQUJMRTsKKworCXN3aXRjaCAocGxh
bmVfc3RhdGUtPmh3LnBpeGVsX2JsZW5kX21vZGUpIHsKKwljYXNlIERSTV9NT0RFX0JMRU5EX1BJ
WEVMX05PTkU6CisJCXJldHVybiBQTEFORV9DT0xPUl9BTFBIQV9ESVNBQkxFOworCWNhc2UgRFJN
X01PREVfQkxFTkRfUFJFTVVMVEk6CisJCXJldHVybiBQTEFORV9DT0xPUl9BTFBIQV9TV19QUkVN
VUxUSVBMWTsKKwljYXNlIERSTV9NT0RFX0JMRU5EX0NPVkVSQUdFOgorCQlyZXR1cm4gUExBTkVf
Q09MT1JfQUxQSEFfSFdfUFJFTVVMVElQTFk7CisJZGVmYXVsdDoKKwkJTUlTU0lOR19DQVNFKHBs
YW5lX3N0YXRlLT5ody5waXhlbF9ibGVuZF9tb2RlKTsKKwkJcmV0dXJuIFBMQU5FX0NPTE9SX0FM
UEhBX0RJU0FCTEU7CisJfQorfQorCitzdGF0aWMgdTMyIHNrbF9wbGFuZV9jdGxfdGlsaW5nKHU2
NCBmYl9tb2RpZmllcikKK3sKKwlzd2l0Y2ggKGZiX21vZGlmaWVyKSB7CisJY2FzZSBEUk1fRk9S
TUFUX01PRF9MSU5FQVI6CisJCWJyZWFrOworCWNhc2UgSTkxNV9GT1JNQVRfTU9EX1hfVElMRUQ6
CisJCXJldHVybiBQTEFORV9DVExfVElMRURfWDsKKwljYXNlIEk5MTVfRk9STUFUX01PRF9ZX1RJ
TEVEOgorCQlyZXR1cm4gUExBTkVfQ1RMX1RJTEVEX1k7CisJY2FzZSBJOTE1X0ZPUk1BVF9NT0Rf
WV9USUxFRF9DQ1M6CisJY2FzZSBJOTE1X0ZPUk1BVF9NT0RfWV9USUxFRF9HRU4xMl9SQ19DQ1Nf
Q0M6CisJCXJldHVybiBQTEFORV9DVExfVElMRURfWSB8IFBMQU5FX0NUTF9SRU5ERVJfREVDT01Q
UkVTU0lPTl9FTkFCTEU7CisJY2FzZSBJOTE1X0ZPUk1BVF9NT0RfWV9USUxFRF9HRU4xMl9SQ19D
Q1M6CisJCXJldHVybiBQTEFORV9DVExfVElMRURfWSB8CisJCSAgICAgICBQTEFORV9DVExfUkVO
REVSX0RFQ09NUFJFU1NJT05fRU5BQkxFIHwKKwkJICAgICAgIFBMQU5FX0NUTF9DTEVBUl9DT0xP
Ul9ESVNBQkxFOworCWNhc2UgSTkxNV9GT1JNQVRfTU9EX1lfVElMRURfR0VOMTJfTUNfQ0NTOgor
CQlyZXR1cm4gUExBTkVfQ1RMX1RJTEVEX1kgfCBQTEFORV9DVExfTUVESUFfREVDT01QUkVTU0lP
Tl9FTkFCTEU7CisJY2FzZSBJOTE1X0ZPUk1BVF9NT0RfWWZfVElMRUQ6CisJCXJldHVybiBQTEFO
RV9DVExfVElMRURfWUY7CisJY2FzZSBJOTE1X0ZPUk1BVF9NT0RfWWZfVElMRURfQ0NTOgorCQly
ZXR1cm4gUExBTkVfQ1RMX1RJTEVEX1lGIHwgUExBTkVfQ1RMX1JFTkRFUl9ERUNPTVBSRVNTSU9O
X0VOQUJMRTsKKwlkZWZhdWx0OgorCQlNSVNTSU5HX0NBU0UoZmJfbW9kaWZpZXIpOworCX0KKwor
CXJldHVybiAwOworfQorCitzdGF0aWMgdTMyIHNrbF9wbGFuZV9jdGxfcm90YXRlKHVuc2lnbmVk
IGludCByb3RhdGUpCit7CisJc3dpdGNoIChyb3RhdGUpIHsKKwljYXNlIERSTV9NT0RFX1JPVEFU
RV8wOgorCQlicmVhazsKKwkvKgorCSAqIERSTV9NT0RFX1JPVEFURV8gaXMgY291bnRlciBjbG9j
a3dpc2UgdG8gc3RheSBjb21wYXRpYmxlIHdpdGggWHJhbmRyCisJICogd2hpbGUgaTkxNSBIVyBy
b3RhdGlvbiBpcyBjbG9ja3dpc2UsIHRoYXRzIHdoeSB0aGlzIHN3YXBwaW5nLgorCSAqLworCWNh
c2UgRFJNX01PREVfUk9UQVRFXzkwOgorCQlyZXR1cm4gUExBTkVfQ1RMX1JPVEFURV8yNzA7CisJ
Y2FzZSBEUk1fTU9ERV9ST1RBVEVfMTgwOgorCQlyZXR1cm4gUExBTkVfQ1RMX1JPVEFURV8xODA7
CisJY2FzZSBEUk1fTU9ERV9ST1RBVEVfMjcwOgorCQlyZXR1cm4gUExBTkVfQ1RMX1JPVEFURV85
MDsKKwlkZWZhdWx0OgorCQlNSVNTSU5HX0NBU0Uocm90YXRlKTsKKwl9CisKKwlyZXR1cm4gMDsK
K30KKworc3RhdGljIHUzMiBjbmxfcGxhbmVfY3RsX2ZsaXAodW5zaWduZWQgaW50IHJlZmxlY3Qp
Cit7CisJc3dpdGNoIChyZWZsZWN0KSB7CisJY2FzZSAwOgorCQlicmVhazsKKwljYXNlIERSTV9N
T0RFX1JFRkxFQ1RfWDoKKwkJcmV0dXJuIFBMQU5FX0NUTF9GTElQX0hPUklaT05UQUw7CisJY2Fz
ZSBEUk1fTU9ERV9SRUZMRUNUX1k6CisJZGVmYXVsdDoKKwkJTUlTU0lOR19DQVNFKHJlZmxlY3Qp
OworCX0KKworCXJldHVybiAwOworfQorCitzdGF0aWMgdTMyIHNrbF9wbGFuZV9jdGxfY3J0Yyhj
b25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSkKK3sKKwlzdHJ1Y3QgZHJt
X2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGNydGNfc3RhdGUtPnVhcGkuY3J0Yy0+
ZGV2KTsKKwl1MzIgcGxhbmVfY3RsID0gMDsKKworCWlmIChJTlRFTF9HRU4oZGV2X3ByaXYpID49
IDEwIHx8IElTX0dFTUlOSUxBS0UoZGV2X3ByaXYpKQorCQlyZXR1cm4gcGxhbmVfY3RsOworCisJ
aWYgKGNydGNfc3RhdGUtPmdhbW1hX2VuYWJsZSkKKwkJcGxhbmVfY3RsIHw9IFBMQU5FX0NUTF9Q
SVBFX0dBTU1BX0VOQUJMRTsKKworCWlmIChjcnRjX3N0YXRlLT5jc2NfZW5hYmxlKQorCQlwbGFu
ZV9jdGwgfD0gUExBTkVfQ1RMX1BJUEVfQ1NDX0VOQUJMRTsKKworCXJldHVybiBwbGFuZV9jdGw7
Cit9CisKK3N0YXRpYyB1MzIgc2tsX3BsYW5lX2N0bChjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19z
dGF0ZSAqY3J0Y19zdGF0ZSwKKwkJCSBjb25zdCBzdHJ1Y3QgaW50ZWxfcGxhbmVfc3RhdGUgKnBs
YW5lX3N0YXRlKQoreworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9CisJCXRv
X2k5MTUocGxhbmVfc3RhdGUtPnVhcGkucGxhbmUtPmRldik7CisJY29uc3Qgc3RydWN0IGRybV9m
cmFtZWJ1ZmZlciAqZmIgPSBwbGFuZV9zdGF0ZS0+aHcuZmI7CisJdW5zaWduZWQgaW50IHJvdGF0
aW9uID0gcGxhbmVfc3RhdGUtPmh3LnJvdGF0aW9uOworCWNvbnN0IHN0cnVjdCBkcm1faW50ZWxf
c3ByaXRlX2NvbG9ya2V5ICprZXkgPSAmcGxhbmVfc3RhdGUtPmNrZXk7CisJdTMyIHBsYW5lX2N0
bDsKKworCXBsYW5lX2N0bCA9IFBMQU5FX0NUTF9FTkFCTEU7CisKKwlpZiAoSU5URUxfR0VOKGRl
dl9wcml2KSA8IDEwICYmICFJU19HRU1JTklMQUtFKGRldl9wcml2KSkgeworCQlwbGFuZV9jdGwg
fD0gc2tsX3BsYW5lX2N0bF9hbHBoYShwbGFuZV9zdGF0ZSk7CisJCXBsYW5lX2N0bCB8PSBQTEFO
RV9DVExfUExBTkVfR0FNTUFfRElTQUJMRTsKKworCQlpZiAocGxhbmVfc3RhdGUtPmh3LmNvbG9y
X2VuY29kaW5nID09IERSTV9DT0xPUl9ZQ0JDUl9CVDcwOSkKKwkJCXBsYW5lX2N0bCB8PSBQTEFO
RV9DVExfWVVWX1RPX1JHQl9DU0NfRk9STUFUX0JUNzA5OworCisJCWlmIChwbGFuZV9zdGF0ZS0+
aHcuY29sb3JfcmFuZ2UgPT0gRFJNX0NPTE9SX1lDQkNSX0ZVTExfUkFOR0UpCisJCQlwbGFuZV9j
dGwgfD0gUExBTkVfQ1RMX1lVVl9SQU5HRV9DT1JSRUNUSU9OX0RJU0FCTEU7CisJfQorCisJcGxh
bmVfY3RsIHw9IHNrbF9wbGFuZV9jdGxfZm9ybWF0KGZiLT5mb3JtYXQtPmZvcm1hdCk7CisJcGxh
bmVfY3RsIHw9IHNrbF9wbGFuZV9jdGxfdGlsaW5nKGZiLT5tb2RpZmllcik7CisJcGxhbmVfY3Rs
IHw9IHNrbF9wbGFuZV9jdGxfcm90YXRlKHJvdGF0aW9uICYgRFJNX01PREVfUk9UQVRFX01BU0sp
OworCisJaWYgKElOVEVMX0dFTihkZXZfcHJpdikgPj0gMTApCisJCXBsYW5lX2N0bCB8PSBjbmxf
cGxhbmVfY3RsX2ZsaXAocm90YXRpb24gJgorCQkJCQkJRFJNX01PREVfUkVGTEVDVF9NQVNLKTsK
KworCWlmIChrZXktPmZsYWdzICYgSTkxNV9TRVRfQ09MT1JLRVlfREVTVElOQVRJT04pCisJCXBs
YW5lX2N0bCB8PSBQTEFORV9DVExfS0VZX0VOQUJMRV9ERVNUSU5BVElPTjsKKwllbHNlIGlmIChr
ZXktPmZsYWdzICYgSTkxNV9TRVRfQ09MT1JLRVlfU09VUkNFKQorCQlwbGFuZV9jdGwgfD0gUExB
TkVfQ1RMX0tFWV9FTkFCTEVfU09VUkNFOworCisJcmV0dXJuIHBsYW5lX2N0bDsKK30KKworc3Rh
dGljIHUzMiBnbGtfcGxhbmVfY29sb3JfY3RsX2NydGMoY29uc3Qgc3RydWN0IGludGVsX2NydGNf
c3RhdGUgKmNydGNfc3RhdGUpCit7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2
ID0gdG9faTkxNShjcnRjX3N0YXRlLT51YXBpLmNydGMtPmRldik7CisJdTMyIHBsYW5lX2NvbG9y
X2N0bCA9IDA7CisKKwlpZiAoSU5URUxfR0VOKGRldl9wcml2KSA+PSAxMSkKKwkJcmV0dXJuIHBs
YW5lX2NvbG9yX2N0bDsKKworCWlmIChjcnRjX3N0YXRlLT5nYW1tYV9lbmFibGUpCisJCXBsYW5l
X2NvbG9yX2N0bCB8PSBQTEFORV9DT0xPUl9QSVBFX0dBTU1BX0VOQUJMRTsKKworCWlmIChjcnRj
X3N0YXRlLT5jc2NfZW5hYmxlKQorCQlwbGFuZV9jb2xvcl9jdGwgfD0gUExBTkVfQ09MT1JfUElQ
RV9DU0NfRU5BQkxFOworCisJcmV0dXJuIHBsYW5lX2NvbG9yX2N0bDsKK30KKworc3RhdGljIHUz
MiBnbGtfcGxhbmVfY29sb3JfY3RsKGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRj
X3N0YXRlLAorCQkJICAgICAgIGNvbnN0IHN0cnVjdCBpbnRlbF9wbGFuZV9zdGF0ZSAqcGxhbmVf
c3RhdGUpCit7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0KKwkJdG9faTkx
NShwbGFuZV9zdGF0ZS0+dWFwaS5wbGFuZS0+ZGV2KTsKKwljb25zdCBzdHJ1Y3QgZHJtX2ZyYW1l
YnVmZmVyICpmYiA9IHBsYW5lX3N0YXRlLT5ody5mYjsKKwlzdHJ1Y3QgaW50ZWxfcGxhbmUgKnBs
YW5lID0gdG9faW50ZWxfcGxhbmUocGxhbmVfc3RhdGUtPnVhcGkucGxhbmUpOworCXUzMiBwbGFu
ZV9jb2xvcl9jdGwgPSAwOworCisJcGxhbmVfY29sb3JfY3RsIHw9IFBMQU5FX0NPTE9SX1BMQU5F
X0dBTU1BX0RJU0FCTEU7CisJcGxhbmVfY29sb3JfY3RsIHw9IGdsa19wbGFuZV9jb2xvcl9jdGxf
YWxwaGEocGxhbmVfc3RhdGUpOworCisJaWYgKGZiLT5mb3JtYXQtPmlzX3l1diAmJiAhaWNsX2lz
X2hkcl9wbGFuZShkZXZfcHJpdiwgcGxhbmUtPmlkKSkgeworCQlzd2l0Y2ggKHBsYW5lX3N0YXRl
LT5ody5jb2xvcl9lbmNvZGluZykgeworCQljYXNlIERSTV9DT0xPUl9ZQ0JDUl9CVDcwOToKKwkJ
CXBsYW5lX2NvbG9yX2N0bCB8PSBQTEFORV9DT0xPUl9DU0NfTU9ERV9ZVVY3MDlfVE9fUkdCNzA5
OworCQkJYnJlYWs7CisJCWNhc2UgRFJNX0NPTE9SX1lDQkNSX0JUMjAyMDoKKwkJCXBsYW5lX2Nv
bG9yX2N0bCB8PQorCQkJCVBMQU5FX0NPTE9SX0NTQ19NT0RFX1lVVjIwMjBfVE9fUkdCMjAyMDsK
KwkJCWJyZWFrOworCQlkZWZhdWx0OgorCQkJcGxhbmVfY29sb3JfY3RsIHw9CisJCQkJUExBTkVf
Q09MT1JfQ1NDX01PREVfWVVWNjAxX1RPX1JHQjYwMTsKKwkJfQorCQlpZiAocGxhbmVfc3RhdGUt
Pmh3LmNvbG9yX3JhbmdlID09IERSTV9DT0xPUl9ZQ0JDUl9GVUxMX1JBTkdFKQorCQkJcGxhbmVf
Y29sb3JfY3RsIHw9IFBMQU5FX0NPTE9SX1lVVl9SQU5HRV9DT1JSRUNUSU9OX0RJU0FCTEU7CisJ
fSBlbHNlIGlmIChmYi0+Zm9ybWF0LT5pc195dXYpIHsKKwkJcGxhbmVfY29sb3JfY3RsIHw9IFBM
QU5FX0NPTE9SX0lOUFVUX0NTQ19FTkFCTEU7CisJCWlmIChwbGFuZV9zdGF0ZS0+aHcuY29sb3Jf
cmFuZ2UgPT0gRFJNX0NPTE9SX1lDQkNSX0ZVTExfUkFOR0UpCisJCQlwbGFuZV9jb2xvcl9jdGwg
fD0gUExBTkVfQ09MT1JfWVVWX1JBTkdFX0NPUlJFQ1RJT05fRElTQUJMRTsKKwl9CisKKwlyZXR1
cm4gcGxhbmVfY29sb3JfY3RsOworfQorCitzdGF0aWMgaW50CittYWluX3RvX2Njc19wbGFuZShj
b25zdCBzdHJ1Y3QgZHJtX2ZyYW1lYnVmZmVyICpmYiwgaW50IG1haW5fcGxhbmUpCit7CisJZHJt
X1dBUk5fT04oZmItPmRldiwgIWlzX2Njc19tb2RpZmllcihmYi0+bW9kaWZpZXIpIHx8CisJCSAg
ICAobWFpbl9wbGFuZSAmJiBtYWluX3BsYW5lID49IGZiLT5mb3JtYXQtPm51bV9wbGFuZXMgLyAy
KSk7CisKKwlyZXR1cm4gZmItPmZvcm1hdC0+bnVtX3BsYW5lcyAvIDIgKyBtYWluX3BsYW5lOwor
fQorCitpbnQgc2tsX2Njc190b19tYWluX3BsYW5lKGNvbnN0IHN0cnVjdCBkcm1fZnJhbWVidWZm
ZXIgKmZiLCBpbnQgY2NzX3BsYW5lKQoreworCWRybV9XQVJOX09OKGZiLT5kZXYsICFpc19jY3Nf
bW9kaWZpZXIoZmItPm1vZGlmaWVyKSB8fAorCQkgICAgY2NzX3BsYW5lIDwgZmItPmZvcm1hdC0+
bnVtX3BsYW5lcyAvIDIpOworCisJaWYgKGlzX2dlbjEyX2Njc19jY19wbGFuZShmYiwgY2NzX3Bs
YW5lKSkKKwkJcmV0dXJuIDA7CisKKwlyZXR1cm4gY2NzX3BsYW5lIC0gZmItPmZvcm1hdC0+bnVt
X3BsYW5lcyAvIDI7Cit9CisKK3N0YXRpYyBpbnQKK3NrbF9tYWluX3RvX2F1eF9wbGFuZShjb25z
dCBzdHJ1Y3QgZHJtX2ZyYW1lYnVmZmVyICpmYiwgaW50IG1haW5fcGxhbmUpCit7CisJc3RydWN0
IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSB0b19pOTE1KGZiLT5kZXYpOworCisJaWYgKGlzX2Nj
c19tb2RpZmllcihmYi0+bW9kaWZpZXIpKQorCQlyZXR1cm4gbWFpbl90b19jY3NfcGxhbmUoZmIs
IG1haW5fcGxhbmUpOworCWVsc2UgaWYgKElOVEVMX0dFTihpOTE1KSA8IDExICYmCisJCSBpbnRl
bF9mb3JtYXRfaW5mb19pc195dXZfc2VtaXBsYW5hcihmYi0+Zm9ybWF0LCBmYi0+bW9kaWZpZXIp
KQorCQlyZXR1cm4gMTsKKwllbHNlCisJCXJldHVybiAwOworfQorCitzdGF0aWMgdm9pZAorc2ts
X3Byb2dyYW1fcGxhbmUoc3RydWN0IGludGVsX3BsYW5lICpwbGFuZSwKKwkJICBjb25zdCBzdHJ1
Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSwKKwkJICBjb25zdCBzdHJ1Y3QgaW50ZWxf
cGxhbmVfc3RhdGUgKnBsYW5lX3N0YXRlLAorCQkgIGludCBjb2xvcl9wbGFuZSkKK3sKKwlzdHJ1
Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KHBsYW5lLT5iYXNlLmRldik7
CisJZW51bSBwbGFuZV9pZCBwbGFuZV9pZCA9IHBsYW5lLT5pZDsKKwllbnVtIHBpcGUgcGlwZSA9
IHBsYW5lLT5waXBlOworCWNvbnN0IHN0cnVjdCBkcm1faW50ZWxfc3ByaXRlX2NvbG9ya2V5ICpr
ZXkgPSAmcGxhbmVfc3RhdGUtPmNrZXk7CisJdTMyIHN1cmZfYWRkciA9IHBsYW5lX3N0YXRlLT5j
b2xvcl9wbGFuZVtjb2xvcl9wbGFuZV0ub2Zmc2V0OworCXUzMiBzdHJpZGUgPSBza2xfcGxhbmVf
c3RyaWRlKHBsYW5lX3N0YXRlLCBjb2xvcl9wbGFuZSk7CisJY29uc3Qgc3RydWN0IGRybV9mcmFt
ZWJ1ZmZlciAqZmIgPSBwbGFuZV9zdGF0ZS0+aHcuZmI7CisJaW50IGF1eF9wbGFuZSA9IHNrbF9t
YWluX3RvX2F1eF9wbGFuZShmYiwgY29sb3JfcGxhbmUpOworCWludCBjcnRjX3ggPSBwbGFuZV9z
dGF0ZS0+dWFwaS5kc3QueDE7CisJaW50IGNydGNfeSA9IHBsYW5lX3N0YXRlLT51YXBpLmRzdC55
MTsKKwl1MzIgeCA9IHBsYW5lX3N0YXRlLT5jb2xvcl9wbGFuZVtjb2xvcl9wbGFuZV0ueDsKKwl1
MzIgeSA9IHBsYW5lX3N0YXRlLT5jb2xvcl9wbGFuZVtjb2xvcl9wbGFuZV0ueTsKKwl1MzIgc3Jj
X3cgPSBkcm1fcmVjdF93aWR0aCgmcGxhbmVfc3RhdGUtPnVhcGkuc3JjKSA+PiAxNjsKKwl1MzIg
c3JjX2ggPSBkcm1fcmVjdF9oZWlnaHQoJnBsYW5lX3N0YXRlLT51YXBpLnNyYykgPj4gMTY7CisJ
dTggYWxwaGEgPSBwbGFuZV9zdGF0ZS0+aHcuYWxwaGEgPj4gODsKKwl1MzIgcGxhbmVfY29sb3Jf
Y3RsID0gMCwgYXV4X2Rpc3QgPSAwOworCXVuc2lnbmVkIGxvbmcgaXJxZmxhZ3M7CisJdTMyIGtl
eW1zaywga2V5bWF4OworCXUzMiBwbGFuZV9jdGwgPSBwbGFuZV9zdGF0ZS0+Y3RsOworCisJcGxh
bmVfY3RsIHw9IHNrbF9wbGFuZV9jdGxfY3J0YyhjcnRjX3N0YXRlKTsKKworCWlmIChJTlRFTF9H
RU4oZGV2X3ByaXYpID49IDEwIHx8IElTX0dFTUlOSUxBS0UoZGV2X3ByaXYpKQorCQlwbGFuZV9j
b2xvcl9jdGwgPSBwbGFuZV9zdGF0ZS0+Y29sb3JfY3RsIHwKKwkJCWdsa19wbGFuZV9jb2xvcl9j
dGxfY3J0YyhjcnRjX3N0YXRlKTsKKworCS8qIFNpemVzIGFyZSAwIGJhc2VkICovCisJc3JjX3ct
LTsKKwlzcmNfaC0tOworCisJa2V5bWF4ID0gKGtleS0+bWF4X3ZhbHVlICYgMHhmZmZmZmYpIHwg
UExBTkVfS0VZTUFYX0FMUEhBKGFscGhhKTsKKworCWtleW1zayA9IGtleS0+Y2hhbm5lbF9tYXNr
ICYgMHg3ZmZmZmZmOworCWlmIChhbHBoYSA8IDB4ZmYpCisJCWtleW1zayB8PSBQTEFORV9LRVlN
U0tfQUxQSEFfRU5BQkxFOworCisJLyogVGhlIHNjYWxlciB3aWxsIGhhbmRsZSB0aGUgb3V0cHV0
IHBvc2l0aW9uICovCisJaWYgKHBsYW5lX3N0YXRlLT5zY2FsZXJfaWQgPj0gMCkgeworCQljcnRj
X3ggPSAwOworCQljcnRjX3kgPSAwOworCX0KKworCWlmIChhdXhfcGxhbmUpIHsKKwkJYXV4X2Rp
c3QgPSBwbGFuZV9zdGF0ZS0+Y29sb3JfcGxhbmVbYXV4X3BsYW5lXS5vZmZzZXQgLSBzdXJmX2Fk
ZHI7CisKKwkJaWYgKElOVEVMX0dFTihkZXZfcHJpdikgPCAxMikKKwkJCWF1eF9kaXN0IHw9IHNr
bF9wbGFuZV9zdHJpZGUocGxhbmVfc3RhdGUsIGF1eF9wbGFuZSk7CisJfQorCisJc3Bpbl9sb2Nr
X2lycXNhdmUoJmRldl9wcml2LT51bmNvcmUubG9jaywgaXJxZmxhZ3MpOworCisJaW50ZWxfZGVf
d3JpdGVfZncoZGV2X3ByaXYsIFBMQU5FX1NUUklERShwaXBlLCBwbGFuZV9pZCksIHN0cmlkZSk7
CisJaW50ZWxfZGVfd3JpdGVfZncoZGV2X3ByaXYsIFBMQU5FX1BPUyhwaXBlLCBwbGFuZV9pZCks
CisJCQkgIChjcnRjX3kgPDwgMTYpIHwgY3J0Y194KTsKKwlpbnRlbF9kZV93cml0ZV9mdyhkZXZf
cHJpdiwgUExBTkVfU0laRShwaXBlLCBwbGFuZV9pZCksCisJCQkgIChzcmNfaCA8PCAxNikgfCBz
cmNfdyk7CisKKwlpbnRlbF9kZV93cml0ZV9mdyhkZXZfcHJpdiwgUExBTkVfQVVYX0RJU1QocGlw
ZSwgcGxhbmVfaWQpLCBhdXhfZGlzdCk7CisKKwlpZiAoaWNsX2lzX2hkcl9wbGFuZShkZXZfcHJp
diwgcGxhbmVfaWQpKQorCQlpbnRlbF9kZV93cml0ZV9mdyhkZXZfcHJpdiwgUExBTkVfQ1VTX0NU
TChwaXBlLCBwbGFuZV9pZCksCisJCQkJICBwbGFuZV9zdGF0ZS0+Y3VzX2N0bCk7CisKKwlpZiAo
SU5URUxfR0VOKGRldl9wcml2KSA+PSAxMCB8fCBJU19HRU1JTklMQUtFKGRldl9wcml2KSkKKwkJ
aW50ZWxfZGVfd3JpdGVfZncoZGV2X3ByaXYsIFBMQU5FX0NPTE9SX0NUTChwaXBlLCBwbGFuZV9p
ZCksCisJCQkJICBwbGFuZV9jb2xvcl9jdGwpOworCisJaWYgKGZiLT5mb3JtYXQtPmlzX3l1diAm
JiBpY2xfaXNfaGRyX3BsYW5lKGRldl9wcml2LCBwbGFuZV9pZCkpCisJCWljbF9wcm9ncmFtX2lu
cHV0X2NzYyhwbGFuZSwgY3J0Y19zdGF0ZSwgcGxhbmVfc3RhdGUpOworCisJaWYgKGZiLT5tb2Rp
ZmllciA9PSBJOTE1X0ZPUk1BVF9NT0RfWV9USUxFRF9HRU4xMl9SQ19DQ1NfQ0MpCisJCWludGVs
X3VuY29yZV93cml0ZTY0X2Z3KCZkZXZfcHJpdi0+dW5jb3JlLAorCQkJCQlQTEFORV9DQ19WQUwo
cGlwZSwgcGxhbmVfaWQpLCBwbGFuZV9zdGF0ZS0+Y2N2YWwpOworCisJc2tsX3dyaXRlX3BsYW5l
X3dtKHBsYW5lLCBjcnRjX3N0YXRlKTsKKworCWludGVsX2RlX3dyaXRlX2Z3KGRldl9wcml2LCBQ
TEFORV9LRVlWQUwocGlwZSwgcGxhbmVfaWQpLAorCQkJICBrZXktPm1pbl92YWx1ZSk7CisJaW50
ZWxfZGVfd3JpdGVfZncoZGV2X3ByaXYsIFBMQU5FX0tFWU1TSyhwaXBlLCBwbGFuZV9pZCksIGtl
eW1zayk7CisJaW50ZWxfZGVfd3JpdGVfZncoZGV2X3ByaXYsIFBMQU5FX0tFWU1BWChwaXBlLCBw
bGFuZV9pZCksIGtleW1heCk7CisKKwlpbnRlbF9kZV93cml0ZV9mdyhkZXZfcHJpdiwgUExBTkVf
T0ZGU0VUKHBpcGUsIHBsYW5lX2lkKSwKKwkJCSAgKHkgPDwgMTYpIHwgeCk7CisKKwlpZiAoSU5U
RUxfR0VOKGRldl9wcml2KSA8IDExKQorCQlpbnRlbF9kZV93cml0ZV9mdyhkZXZfcHJpdiwgUExB
TkVfQVVYX09GRlNFVChwaXBlLCBwbGFuZV9pZCksCisJCQkJICAocGxhbmVfc3RhdGUtPmNvbG9y
X3BsYW5lWzFdLnkgPDwgMTYpIHwgcGxhbmVfc3RhdGUtPmNvbG9yX3BsYW5lWzFdLngpOworCisJ
aWYgKCFkcm1fYXRvbWljX2NydGNfbmVlZHNfbW9kZXNldCgmY3J0Y19zdGF0ZS0+dWFwaSkpCisJ
CWludGVsX3BzcjJfcHJvZ3JhbV9wbGFuZV9zZWxfZmV0Y2gocGxhbmUsIGNydGNfc3RhdGUsIHBs
YW5lX3N0YXRlLCBjb2xvcl9wbGFuZSk7CisKKwkvKgorCSAqIFRoZSBjb250cm9sIHJlZ2lzdGVy
IHNlbGYtYXJtcyBpZiB0aGUgcGxhbmUgd2FzIHByZXZpb3VzbHkKKwkgKiBkaXNhYmxlZC4gVHJ5
IHRvIG1ha2UgdGhlIHBsYW5lIGVuYWJsZSBhdG9taWMgYnkgd3JpdGluZworCSAqIHRoZSBjb250
cm9sIHJlZ2lzdGVyIGp1c3QgYmVmb3JlIHRoZSBzdXJmYWNlIHJlZ2lzdGVyLgorCSAqLworCWlu
dGVsX2RlX3dyaXRlX2Z3KGRldl9wcml2LCBQTEFORV9DVEwocGlwZSwgcGxhbmVfaWQpLCBwbGFu
ZV9jdGwpOworCWludGVsX2RlX3dyaXRlX2Z3KGRldl9wcml2LCBQTEFORV9TVVJGKHBpcGUsIHBs
YW5lX2lkKSwKKwkJCSAgaW50ZWxfcGxhbmVfZ2d0dF9vZmZzZXQocGxhbmVfc3RhdGUpICsgc3Vy
Zl9hZGRyKTsKKworCWlmIChwbGFuZV9zdGF0ZS0+c2NhbGVyX2lkID49IDApCisJCXNrbF9wcm9n
cmFtX3NjYWxlcihwbGFuZSwgY3J0Y19zdGF0ZSwgcGxhbmVfc3RhdGUpOworCisJc3Bpbl91bmxv
Y2tfaXJxcmVzdG9yZSgmZGV2X3ByaXYtPnVuY29yZS5sb2NrLCBpcnFmbGFncyk7Cit9CisKK3N0
YXRpYyB2b2lkCitza2xfcGxhbmVfYXN5bmNfZmxpcChzdHJ1Y3QgaW50ZWxfcGxhbmUgKnBsYW5l
LAorCQkgICAgIGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlLAorCQkg
ICAgIGNvbnN0IHN0cnVjdCBpbnRlbF9wbGFuZV9zdGF0ZSAqcGxhbmVfc3RhdGUsCisJCSAgICAg
Ym9vbCBhc3luY19mbGlwKQoreworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9
IHRvX2k5MTUocGxhbmUtPmJhc2UuZGV2KTsKKwl1bnNpZ25lZCBsb25nIGlycWZsYWdzOworCWVu
dW0gcGxhbmVfaWQgcGxhbmVfaWQgPSBwbGFuZS0+aWQ7CisJZW51bSBwaXBlIHBpcGUgPSBwbGFu
ZS0+cGlwZTsKKwl1MzIgc3VyZl9hZGRyID0gcGxhbmVfc3RhdGUtPmNvbG9yX3BsYW5lWzBdLm9m
ZnNldDsKKwl1MzIgcGxhbmVfY3RsID0gcGxhbmVfc3RhdGUtPmN0bDsKKworCXBsYW5lX2N0bCB8
PSBza2xfcGxhbmVfY3RsX2NydGMoY3J0Y19zdGF0ZSk7CisKKwlpZiAoYXN5bmNfZmxpcCkKKwkJ
cGxhbmVfY3RsIHw9IFBMQU5FX0NUTF9BU1lOQ19GTElQOworCisJc3Bpbl9sb2NrX2lycXNhdmUo
JmRldl9wcml2LT51bmNvcmUubG9jaywgaXJxZmxhZ3MpOworCisJaW50ZWxfZGVfd3JpdGVfZnco
ZGV2X3ByaXYsIFBMQU5FX0NUTChwaXBlLCBwbGFuZV9pZCksIHBsYW5lX2N0bCk7CisJaW50ZWxf
ZGVfd3JpdGVfZncoZGV2X3ByaXYsIFBMQU5FX1NVUkYocGlwZSwgcGxhbmVfaWQpLAorCQkJICBp
bnRlbF9wbGFuZV9nZ3R0X29mZnNldChwbGFuZV9zdGF0ZSkgKyBzdXJmX2FkZHIpOworCisJc3Bp
bl91bmxvY2tfaXJxcmVzdG9yZSgmZGV2X3ByaXYtPnVuY29yZS5sb2NrLCBpcnFmbGFncyk7Cit9
CisKK3N0YXRpYyB2b2lkCitza2xfdXBkYXRlX3BsYW5lKHN0cnVjdCBpbnRlbF9wbGFuZSAqcGxh
bmUsCisJCSBjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSwKKwkJIGNv
bnN0IHN0cnVjdCBpbnRlbF9wbGFuZV9zdGF0ZSAqcGxhbmVfc3RhdGUpCit7CisJaW50IGNvbG9y
X3BsYW5lID0gMDsKKworCWlmIChwbGFuZV9zdGF0ZS0+cGxhbmFyX2xpbmtlZF9wbGFuZSAmJiAh
cGxhbmVfc3RhdGUtPnBsYW5hcl9zbGF2ZSkKKwkJLyogUHJvZ3JhbSB0aGUgVVYgcGxhbmUgb24g
cGxhbmFyIG1hc3RlciAqLworCQljb2xvcl9wbGFuZSA9IDE7CisKKwlza2xfcHJvZ3JhbV9wbGFu
ZShwbGFuZSwgY3J0Y19zdGF0ZSwgcGxhbmVfc3RhdGUsIGNvbG9yX3BsYW5lKTsKK30KKworc3Rh
dGljIGJvb2wgaW50ZWxfZm9ybWF0X2lzX3AwMXgodTMyIGZvcm1hdCkKK3sKKwlzd2l0Y2ggKGZv
cm1hdCkgeworCWNhc2UgRFJNX0ZPUk1BVF9QMDEwOgorCWNhc2UgRFJNX0ZPUk1BVF9QMDEyOgor
CWNhc2UgRFJNX0ZPUk1BVF9QMDE2OgorCQlyZXR1cm4gdHJ1ZTsKKwlkZWZhdWx0OgorCQlyZXR1
cm4gZmFsc2U7CisJfQorfQorCitzdGF0aWMgaW50IHNrbF9wbGFuZV9jaGVja19mYihjb25zdCBz
dHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSwKKwkJCSAgICAgIGNvbnN0IHN0cnVj
dCBpbnRlbF9wbGFuZV9zdGF0ZSAqcGxhbmVfc3RhdGUpCit7CisJc3RydWN0IGludGVsX3BsYW5l
ICpwbGFuZSA9IHRvX2ludGVsX3BsYW5lKHBsYW5lX3N0YXRlLT51YXBpLnBsYW5lKTsKKwlzdHJ1
Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KHBsYW5lLT5iYXNlLmRldik7
CisJY29uc3Qgc3RydWN0IGRybV9mcmFtZWJ1ZmZlciAqZmIgPSBwbGFuZV9zdGF0ZS0+aHcuZmI7
CisJdW5zaWduZWQgaW50IHJvdGF0aW9uID0gcGxhbmVfc3RhdGUtPmh3LnJvdGF0aW9uOworCXN0
cnVjdCBkcm1fZm9ybWF0X25hbWVfYnVmIGZvcm1hdF9uYW1lOworCisJaWYgKCFmYikKKwkJcmV0
dXJuIDA7CisKKwlpZiAocm90YXRpb24gJiB+KERSTV9NT0RFX1JPVEFURV8wIHwgRFJNX01PREVf
Uk9UQVRFXzE4MCkgJiYKKwkgICAgaXNfY2NzX21vZGlmaWVyKGZiLT5tb2RpZmllcikpIHsKKwkJ
ZHJtX2RiZ19rbXMoJmRldl9wcml2LT5kcm0sCisJCQkgICAgIlJDIHN1cHBvcnQgb25seSB3aXRo
IDAvMTgwIGRlZ3JlZSByb3RhdGlvbiAoJXgpXG4iLAorCQkJICAgIHJvdGF0aW9uKTsKKwkJcmV0
dXJuIC1FSU5WQUw7CisJfQorCisJaWYgKHJvdGF0aW9uICYgRFJNX01PREVfUkVGTEVDVF9YICYm
CisJICAgIGZiLT5tb2RpZmllciA9PSBEUk1fRk9STUFUX01PRF9MSU5FQVIpIHsKKwkJZHJtX2Ri
Z19rbXMoJmRldl9wcml2LT5kcm0sCisJCQkgICAgImhvcml6b250YWwgZmxpcCBpcyBub3Qgc3Vw
cG9ydGVkIHdpdGggbGluZWFyIHN1cmZhY2UgZm9ybWF0c1xuIik7CisJCXJldHVybiAtRUlOVkFM
OworCX0KKworCWlmIChkcm1fcm90YXRpb25fOTBfb3JfMjcwKHJvdGF0aW9uKSkgeworCQlpZiAo
ZmItPm1vZGlmaWVyICE9IEk5MTVfRk9STUFUX01PRF9ZX1RJTEVEICYmCisJCSAgICBmYi0+bW9k
aWZpZXIgIT0gSTkxNV9GT1JNQVRfTU9EX1lmX1RJTEVEKSB7CisJCQlkcm1fZGJnX2ttcygmZGV2
X3ByaXYtPmRybSwKKwkJCQkgICAgIlkvWWYgdGlsaW5nIHJlcXVpcmVkIGZvciA5MC8yNzAhXG4i
KTsKKwkJCXJldHVybiAtRUlOVkFMOworCQl9CisKKwkJLyoKKwkJICogOTAvMjcwIGlzIG5vdCBh
bGxvd2VkIHdpdGggUkdCNjQgMTY6MTY6MTY6MTYgYW5kCisJCSAqIEluZGV4ZWQgOC1iaXQuIFJH
QiAxNi1iaXQgNTo2OjUgaXMgYWxsb3dlZCBnZW4xMSBvbndhcmRzLgorCQkgKi8KKwkJc3dpdGNo
IChmYi0+Zm9ybWF0LT5mb3JtYXQpIHsKKwkJY2FzZSBEUk1fRk9STUFUX1JHQjU2NToKKwkJCWlm
IChJTlRFTF9HRU4oZGV2X3ByaXYpID49IDExKQorCQkJCWJyZWFrOworCQkJZmFsbHRocm91Z2g7
CisJCWNhc2UgRFJNX0ZPUk1BVF9DODoKKwkJY2FzZSBEUk1fRk9STUFUX1hSR0IxNjE2MTYxNkY6
CisJCWNhc2UgRFJNX0ZPUk1BVF9YQkdSMTYxNjE2MTZGOgorCQljYXNlIERSTV9GT1JNQVRfQVJH
QjE2MTYxNjE2RjoKKwkJY2FzZSBEUk1fRk9STUFUX0FCR1IxNjE2MTYxNkY6CisJCWNhc2UgRFJN
X0ZPUk1BVF9ZMjEwOgorCQljYXNlIERSTV9GT1JNQVRfWTIxMjoKKwkJY2FzZSBEUk1fRk9STUFU
X1kyMTY6CisJCWNhc2UgRFJNX0ZPUk1BVF9YVllVMTJfMTYxNjE2MTY6CisJCWNhc2UgRFJNX0ZP
Uk1BVF9YVllVMTYxNjE2MTY6CisJCQlkcm1fZGJnX2ttcygmZGV2X3ByaXYtPmRybSwKKwkJCQkg
ICAgIlVuc3VwcG9ydGVkIHBpeGVsIGZvcm1hdCAlcyBmb3IgOTAvMjcwIVxuIiwKKwkJCQkgICAg
ZHJtX2dldF9mb3JtYXRfbmFtZShmYi0+Zm9ybWF0LT5mb3JtYXQsCisJCQkJCQkJJmZvcm1hdF9u
YW1lKSk7CisJCQlyZXR1cm4gLUVJTlZBTDsKKwkJZGVmYXVsdDoKKwkJCWJyZWFrOworCQl9CisJ
fQorCisJLyogWS10aWxpbmcgaXMgbm90IHN1cHBvcnRlZCBpbiBJRi1JRCBJbnRlcmxhY2UgbW9k
ZSAqLworCWlmIChjcnRjX3N0YXRlLT5ody5lbmFibGUgJiYKKwkgICAgY3J0Y19zdGF0ZS0+aHcu
YWRqdXN0ZWRfbW9kZS5mbGFncyAmIERSTV9NT0RFX0ZMQUdfSU5URVJMQUNFICYmCisJICAgIChm
Yi0+bW9kaWZpZXIgPT0gSTkxNV9GT1JNQVRfTU9EX1lfVElMRUQgfHwKKwkgICAgIGZiLT5tb2Rp
ZmllciA9PSBJOTE1X0ZPUk1BVF9NT0RfWWZfVElMRUQgfHwKKwkgICAgIGZiLT5tb2RpZmllciA9
PSBJOTE1X0ZPUk1BVF9NT0RfWV9USUxFRF9DQ1MgfHwKKwkgICAgIGZiLT5tb2RpZmllciA9PSBJ
OTE1X0ZPUk1BVF9NT0RfWWZfVElMRURfQ0NTIHx8CisJICAgICBmYi0+bW9kaWZpZXIgPT0gSTkx
NV9GT1JNQVRfTU9EX1lfVElMRURfR0VOMTJfUkNfQ0NTIHx8CisJICAgICBmYi0+bW9kaWZpZXIg
PT0gSTkxNV9GT1JNQVRfTU9EX1lfVElMRURfR0VOMTJfTUNfQ0NTIHx8CisJICAgICBmYi0+bW9k
aWZpZXIgPT0gSTkxNV9GT1JNQVRfTU9EX1lfVElMRURfR0VOMTJfUkNfQ0NTX0NDKSkgeworCQlk
cm1fZGJnX2ttcygmZGV2X3ByaXYtPmRybSwKKwkJCSAgICAiWS9ZZiB0aWxpbmcgbm90IHN1cHBv
cnRlZCBpbiBJRi1JRCBtb2RlXG4iKTsKKwkJcmV0dXJuIC1FSU5WQUw7CisJfQorCisJLyogV2Ff
MTYwNjA1NDE4ODp0Z2wsYWRsLXMgKi8KKwlpZiAoKElTX0FMREVSTEFLRV9TKGRldl9wcml2KSB8
fCBJU19USUdFUkxBS0UoZGV2X3ByaXYpKSAmJgorCSAgICBwbGFuZV9zdGF0ZS0+Y2tleS5mbGFn
cyAmIEk5MTVfU0VUX0NPTE9SS0VZX1NPVVJDRSAmJgorCSAgICBpbnRlbF9mb3JtYXRfaXNfcDAx
eChmYi0+Zm9ybWF0LT5mb3JtYXQpKSB7CisJCWRybV9kYmdfa21zKCZkZXZfcHJpdi0+ZHJtLAor
CQkJICAgICJTb3VyY2UgY29sb3Iga2V5aW5nIG5vdCBzdXBwb3J0ZWQgd2l0aCBQMDF4IGZvcm1h
dHNcbiIpOworCQlyZXR1cm4gLUVJTlZBTDsKKwl9CisKKwlyZXR1cm4gMDsKK30KKworc3RhdGlj
IGludCBza2xfcGxhbmVfY2hlY2tfZHN0X2Nvb3JkaW5hdGVzKGNvbnN0IHN0cnVjdCBpbnRlbF9j
cnRjX3N0YXRlICpjcnRjX3N0YXRlLAorCQkJCQkgICBjb25zdCBzdHJ1Y3QgaW50ZWxfcGxhbmVf
c3RhdGUgKnBsYW5lX3N0YXRlKQoreworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJp
diA9CisJCXRvX2k5MTUocGxhbmVfc3RhdGUtPnVhcGkucGxhbmUtPmRldik7CisJaW50IGNydGNf
eCA9IHBsYW5lX3N0YXRlLT51YXBpLmRzdC54MTsKKwlpbnQgY3J0Y193ID0gZHJtX3JlY3Rfd2lk
dGgoJnBsYW5lX3N0YXRlLT51YXBpLmRzdCk7CisJaW50IHBpcGVfc3JjX3cgPSBjcnRjX3N0YXRl
LT5waXBlX3NyY193OworCisJLyoKKwkgKiBEaXNwbGF5IFdBICMxMTc1OiBjbmwsZ2xrCisJICog
UGxhbmVzIG90aGVyIHRoYW4gdGhlIGN1cnNvciBtYXkgY2F1c2UgRklGTyB1bmRlcmZsb3cgYW5k
IGRpc3BsYXkKKwkgKiBjb3JydXB0aW9uIGlmIHN0YXJ0aW5nIGxlc3MgdGhhbiA0IHBpeGVscyBm
cm9tIHRoZSByaWdodCBlZGdlIG9mCisJICogdGhlIHNjcmVlbi4KKwkgKiBCZXNpZGVzIHRoZSBh
Ym92ZSBXQSBmaXggdGhlIHNpbWlsYXIgcHJvYmxlbSwgd2hlcmUgcGxhbmVzIG90aGVyCisJICog
dGhhbiB0aGUgY3Vyc29yIGVuZGluZyBsZXNzIHRoYW4gNCBwaXhlbHMgZnJvbSB0aGUgbGVmdCBl
ZGdlIG9mIHRoZQorCSAqIHNjcmVlbiBtYXkgY2F1c2UgRklGTyB1bmRlcmZsb3cgYW5kIGRpc3Bs
YXkgY29ycnVwdGlvbi4KKwkgKi8KKwlpZiAoKElTX0dFTUlOSUxBS0UoZGV2X3ByaXYpIHx8IElT
X0NBTk5PTkxBS0UoZGV2X3ByaXYpKSAmJgorCSAgICAoY3J0Y194ICsgY3J0Y193IDwgNCB8fCBj
cnRjX3ggPiBwaXBlX3NyY193IC0gNCkpIHsKKwkJZHJtX2RiZ19rbXMoJmRldl9wcml2LT5kcm0s
CisJCQkgICAgInJlcXVlc3RlZCBwbGFuZSBYICVzIHBvc2l0aW9uICVkIGludmFsaWQgKHZhbGlk
IHJhbmdlICVkLSVkKVxuIiwKKwkJCSAgICBjcnRjX3ggKyBjcnRjX3cgPCA0ID8gImVuZCIgOiAi
c3RhcnQiLAorCQkJICAgIGNydGNfeCArIGNydGNfdyA8IDQgPyBjcnRjX3ggKyBjcnRjX3cgOiBj
cnRjX3gsCisJCQkgICAgNCwgcGlwZV9zcmNfdyAtIDQpOworCQlyZXR1cm4gLUVSQU5HRTsKKwl9
CisKKwlyZXR1cm4gMDsKK30KKworc3RhdGljIGludCBza2xfcGxhbmVfY2hlY2tfbnYxMl9yb3Rh
dGlvbihjb25zdCBzdHJ1Y3QgaW50ZWxfcGxhbmVfc3RhdGUgKnBsYW5lX3N0YXRlKQoreworCWNv
bnN0IHN0cnVjdCBkcm1fZnJhbWVidWZmZXIgKmZiID0gcGxhbmVfc3RhdGUtPmh3LmZiOworCXVu
c2lnbmVkIGludCByb3RhdGlvbiA9IHBsYW5lX3N0YXRlLT5ody5yb3RhdGlvbjsKKwlpbnQgc3Jj
X3cgPSBkcm1fcmVjdF93aWR0aCgmcGxhbmVfc3RhdGUtPnVhcGkuc3JjKSA+PiAxNjsKKworCS8q
IERpc3BsYXkgV0EgIzExMDYgKi8KKwlpZiAoaW50ZWxfZm9ybWF0X2luZm9faXNfeXV2X3NlbWlw
bGFuYXIoZmItPmZvcm1hdCwgZmItPm1vZGlmaWVyKSAmJgorCSAgICBzcmNfdyAmIDMgJiYKKwkg
ICAgKHJvdGF0aW9uID09IERSTV9NT0RFX1JPVEFURV8yNzAgfHwKKwkgICAgIHJvdGF0aW9uID09
IChEUk1fTU9ERV9SRUZMRUNUX1ggfCBEUk1fTU9ERV9ST1RBVEVfOTApKSkgeworCQlEUk1fREVC
VUdfS01TKCJzcmMgd2lkdGggbXVzdCBiZSBtdWx0aXBsZSBvZiA0IGZvciByb3RhdGVkIHBsYW5h
ciBZVVZcbiIpOworCQlyZXR1cm4gLUVJTlZBTDsKKwl9CisKKwlyZXR1cm4gMDsKK30KKworc3Rh
dGljIGludCBza2xfcGxhbmVfbWF4X3NjYWxlKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZf
cHJpdiwKKwkJCSAgICAgICBjb25zdCBzdHJ1Y3QgZHJtX2ZyYW1lYnVmZmVyICpmYikKK3sKKwkv
KgorCSAqIFdlIGRvbid0IHlldCBrbm93IHRoZSBmaW5hbCBzb3VyY2Ugd2lkdGggbm9yCisJICog
d2hldGhlciB3ZSBjYW4gdXNlIHRoZSBIUSBzY2FsZXIgbW9kZS4gQXNzdW1lCisJICogdGhlIGJl
c3QgY2FzZS4KKwkgKiBGSVhNRSBuZWVkIHRvIHByb3Blcmx5IGNoZWNrIHRoaXMgbGF0ZXIuCisJ
ICovCisJaWYgKElOVEVMX0dFTihkZXZfcHJpdikgPj0gMTAgfHwgSVNfR0VNSU5JTEFLRShkZXZf
cHJpdikgfHwKKwkgICAgIWludGVsX2Zvcm1hdF9pbmZvX2lzX3l1dl9zZW1pcGxhbmFyKGZiLT5m
b3JtYXQsIGZiLT5tb2RpZmllcikpCisJCXJldHVybiAweDMwMDAwIC0gMTsKKwllbHNlCisJCXJl
dHVybiAweDIwMDAwIC0gMTsKK30KKworc3RhdGljIGludCBpbnRlbF9wbGFuZV9taW5fd2lkdGgo
c3RydWN0IGludGVsX3BsYW5lICpwbGFuZSwKKwkJCQkgY29uc3Qgc3RydWN0IGRybV9mcmFtZWJ1
ZmZlciAqZmIsCisJCQkJIGludCBjb2xvcl9wbGFuZSwKKwkJCQkgdW5zaWduZWQgaW50IHJvdGF0
aW9uKQoreworCWlmIChwbGFuZS0+bWluX3dpZHRoKQorCQlyZXR1cm4gcGxhbmUtPm1pbl93aWR0
aChmYiwgY29sb3JfcGxhbmUsIHJvdGF0aW9uKTsKKwllbHNlCisJCXJldHVybiAxOworfQorCitz
dGF0aWMgaW50IGludGVsX3BsYW5lX21heF93aWR0aChzdHJ1Y3QgaW50ZWxfcGxhbmUgKnBsYW5l
LAorCQkJCSBjb25zdCBzdHJ1Y3QgZHJtX2ZyYW1lYnVmZmVyICpmYiwKKwkJCQkgaW50IGNvbG9y
X3BsYW5lLAorCQkJCSB1bnNpZ25lZCBpbnQgcm90YXRpb24pCit7CisJaWYgKHBsYW5lLT5tYXhf
d2lkdGgpCisJCXJldHVybiBwbGFuZS0+bWF4X3dpZHRoKGZiLCBjb2xvcl9wbGFuZSwgcm90YXRp
b24pOworCWVsc2UKKwkJcmV0dXJuIElOVF9NQVg7Cit9CisKK3N0YXRpYyBpbnQgaW50ZWxfcGxh
bmVfbWF4X2hlaWdodChzdHJ1Y3QgaW50ZWxfcGxhbmUgKnBsYW5lLAorCQkJCSAgY29uc3Qgc3Ry
dWN0IGRybV9mcmFtZWJ1ZmZlciAqZmIsCisJCQkJICBpbnQgY29sb3JfcGxhbmUsCisJCQkJICB1
bnNpZ25lZCBpbnQgcm90YXRpb24pCit7CisJaWYgKHBsYW5lLT5tYXhfaGVpZ2h0KQorCQlyZXR1
cm4gcGxhbmUtPm1heF9oZWlnaHQoZmIsIGNvbG9yX3BsYW5lLCByb3RhdGlvbik7CisJZWxzZQor
CQlyZXR1cm4gSU5UX01BWDsKK30KKworc3RhdGljIGJvb2wKK3NrbF9jaGVja19tYWluX2Njc19j
b29yZGluYXRlcyhzdHJ1Y3QgaW50ZWxfcGxhbmVfc3RhdGUgKnBsYW5lX3N0YXRlLAorCQkJICAg
ICAgIGludCBtYWluX3gsIGludCBtYWluX3ksIHUzMiBtYWluX29mZnNldCwKKwkJCSAgICAgICBp
bnQgY2NzX3BsYW5lKQoreworCWNvbnN0IHN0cnVjdCBkcm1fZnJhbWVidWZmZXIgKmZiID0gcGxh
bmVfc3RhdGUtPmh3LmZiOworCWludCBhdXhfeCA9IHBsYW5lX3N0YXRlLT5jb2xvcl9wbGFuZVtj
Y3NfcGxhbmVdLng7CisJaW50IGF1eF95ID0gcGxhbmVfc3RhdGUtPmNvbG9yX3BsYW5lW2Njc19w
bGFuZV0ueTsKKwl1MzIgYXV4X29mZnNldCA9IHBsYW5lX3N0YXRlLT5jb2xvcl9wbGFuZVtjY3Nf
cGxhbmVdLm9mZnNldDsKKwl1MzIgYWxpZ25tZW50ID0gaW50ZWxfc3VyZl9hbGlnbm1lbnQoZmIs
IGNjc19wbGFuZSk7CisJaW50IGhzdWI7CisJaW50IHZzdWI7CisKKwlpbnRlbF9mYl9wbGFuZV9n
ZXRfc3Vic2FtcGxpbmcoJmhzdWIsICZ2c3ViLCBmYiwgY2NzX3BsYW5lKTsKKwl3aGlsZSAoYXV4
X29mZnNldCA+PSBtYWluX29mZnNldCAmJiBhdXhfeSA8PSBtYWluX3kpIHsKKwkJaW50IHgsIHk7
CisKKwkJaWYgKGF1eF94ID09IG1haW5feCAmJiBhdXhfeSA9PSBtYWluX3kpCisJCQlicmVhazsK
KworCQlpZiAoYXV4X29mZnNldCA9PSAwKQorCQkJYnJlYWs7CisKKwkJeCA9IGF1eF94IC8gaHN1
YjsKKwkJeSA9IGF1eF95IC8gdnN1YjsKKwkJYXV4X29mZnNldCA9IGludGVsX3BsYW5lX2FkanVz
dF9hbGlnbmVkX29mZnNldCgmeCwgJnksCisJCQkJCQkJICAgICAgIHBsYW5lX3N0YXRlLAorCQkJ
CQkJCSAgICAgICBjY3NfcGxhbmUsCisJCQkJCQkJICAgICAgIGF1eF9vZmZzZXQsCisJCQkJCQkJ
ICAgICAgIGF1eF9vZmZzZXQgLQorCQkJCQkJCQlhbGlnbm1lbnQpOworCQlhdXhfeCA9IHggKiBo
c3ViICsgYXV4X3ggJSBoc3ViOworCQlhdXhfeSA9IHkgKiB2c3ViICsgYXV4X3kgJSB2c3ViOwor
CX0KKworCWlmIChhdXhfeCAhPSBtYWluX3ggfHwgYXV4X3kgIT0gbWFpbl95KQorCQlyZXR1cm4g
ZmFsc2U7CisKKwlwbGFuZV9zdGF0ZS0+Y29sb3JfcGxhbmVbY2NzX3BsYW5lXS5vZmZzZXQgPSBh
dXhfb2Zmc2V0OworCXBsYW5lX3N0YXRlLT5jb2xvcl9wbGFuZVtjY3NfcGxhbmVdLnggPSBhdXhf
eDsKKwlwbGFuZV9zdGF0ZS0+Y29sb3JfcGxhbmVbY2NzX3BsYW5lXS55ID0gYXV4X3k7CisKKwly
ZXR1cm4gdHJ1ZTsKK30KKworCitpbnQgc2tsX2NhbGNfbWFpbl9zdXJmYWNlX29mZnNldChjb25z
dCBzdHJ1Y3QgaW50ZWxfcGxhbmVfc3RhdGUgKnBsYW5lX3N0YXRlLAorCQkJCSBpbnQgKngsIGlu
dCAqeSwgdTMyICpvZmZzZXQpCit7CisJc3RydWN0IGludGVsX3BsYW5lICpwbGFuZSA9IHRvX2lu
dGVsX3BsYW5lKHBsYW5lX3N0YXRlLT51YXBpLnBsYW5lKTsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJp
dmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KHBsYW5lLT5iYXNlLmRldik7CisJY29uc3Qgc3RydWN0
IGRybV9mcmFtZWJ1ZmZlciAqZmIgPSBwbGFuZV9zdGF0ZS0+aHcuZmI7CisJY29uc3QgaW50IGF1
eF9wbGFuZSA9IHNrbF9tYWluX3RvX2F1eF9wbGFuZShmYiwgMCk7CisJY29uc3QgdTMyIGF1eF9v
ZmZzZXQgPSBwbGFuZV9zdGF0ZS0+Y29sb3JfcGxhbmVbYXV4X3BsYW5lXS5vZmZzZXQ7CisJY29u
c3QgdTMyIGFsaWdubWVudCA9IGludGVsX3N1cmZfYWxpZ25tZW50KGZiLCAwKTsKKwljb25zdCBp
bnQgdyA9IGRybV9yZWN0X3dpZHRoKCZwbGFuZV9zdGF0ZS0+dWFwaS5zcmMpID4+IDE2OworCisJ
aW50ZWxfYWRkX2ZiX29mZnNldHMoeCwgeSwgcGxhbmVfc3RhdGUsIDApOworCSpvZmZzZXQgPSBp
bnRlbF9wbGFuZV9jb21wdXRlX2FsaWduZWRfb2Zmc2V0KHgsIHksIHBsYW5lX3N0YXRlLCAwKTsK
KwlpZiAoZHJtX1dBUk5fT04oJmRldl9wcml2LT5kcm0sIGFsaWdubWVudCAmJiAhaXNfcG93ZXJf
b2ZfMihhbGlnbm1lbnQpKSkKKwkJcmV0dXJuIC1FSU5WQUw7CisKKwkvKgorCSAqIEFVWCBzdXJm
YWNlIG9mZnNldCBpcyBzcGVjaWZpZWQgYXMgdGhlIGRpc3RhbmNlIGZyb20gdGhlCisJICogbWFp
biBzdXJmYWNlIG9mZnNldCwgYW5kIGl0IG11c3QgYmUgbm9uLW5lZ2F0aXZlLiBNYWtlCisJICog
c3VyZSB0aGF0IGlzIHdoYXQgd2Ugd2lsbCBnZXQuCisJICovCisJaWYgKGF1eF9wbGFuZSAmJiAq
b2Zmc2V0ID4gYXV4X29mZnNldCkKKwkJKm9mZnNldCA9IGludGVsX3BsYW5lX2FkanVzdF9hbGln
bmVkX29mZnNldCh4LCB5LCBwbGFuZV9zdGF0ZSwgMCwKKwkJCQkJCQkgICAgKm9mZnNldCwKKwkJ
CQkJCQkgICAgYXV4X29mZnNldCAmIH4oYWxpZ25tZW50IC0gMSkpOworCisJLyoKKwkgKiBXaGVu
IHVzaW5nIGFuIFgtdGlsZWQgc3VyZmFjZSwgdGhlIHBsYW5lIGJsb3dzIHVwCisJICogaWYgdGhl
IHggb2Zmc2V0ICsgd2lkdGggZXhjZWVkIHRoZSBzdHJpZGUuCisJICoKKwkgKiBUT0RPOiBsaW5l
YXIgYW5kIFktdGlsZWQgc2VlbSBmaW5lLCBZZiB1bnRlc3RlZCwKKwkgKi8KKwlpZiAoZmItPm1v
ZGlmaWVyID09IEk5MTVfRk9STUFUX01PRF9YX1RJTEVEKSB7CisJCWludCBjcHAgPSBmYi0+Zm9y
bWF0LT5jcHBbMF07CisKKwkJd2hpbGUgKCgqeCArIHcpICogY3BwID4gcGxhbmVfc3RhdGUtPmNv
bG9yX3BsYW5lWzBdLnN0cmlkZSkgeworCQkJaWYgKCpvZmZzZXQgPT0gMCkgeworCQkJCWRybV9k
Ymdfa21zKCZkZXZfcHJpdi0+ZHJtLAorCQkJCQkgICAgIlVuYWJsZSB0byBmaW5kIHN1aXRhYmxl
IGRpc3BsYXkgc3VyZmFjZSBvZmZzZXQgZHVlIHRvIFgtdGlsaW5nXG4iKTsKKwkJCQlyZXR1cm4g
LUVJTlZBTDsKKwkJCX0KKworCQkJKm9mZnNldCA9IGludGVsX3BsYW5lX2FkanVzdF9hbGlnbmVk
X29mZnNldCh4LCB5LCBwbGFuZV9zdGF0ZSwgMCwKKwkJCQkJCQkJICAgICpvZmZzZXQsCisJCQkJ
CQkJCSAgICAqb2Zmc2V0IC0gYWxpZ25tZW50KTsKKwkJfQorCX0KKworCXJldHVybiAwOworfQor
CitzdGF0aWMgaW50IHNrbF9jaGVja19tYWluX3N1cmZhY2Uoc3RydWN0IGludGVsX3BsYW5lX3N0
YXRlICpwbGFuZV9zdGF0ZSkKK3sKKwlzdHJ1Y3QgaW50ZWxfcGxhbmUgKnBsYW5lID0gdG9faW50
ZWxfcGxhbmUocGxhbmVfc3RhdGUtPnVhcGkucGxhbmUpOworCXN0cnVjdCBkcm1faTkxNV9wcml2
YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUocGxhbmUtPmJhc2UuZGV2KTsKKwljb25zdCBzdHJ1Y3Qg
ZHJtX2ZyYW1lYnVmZmVyICpmYiA9IHBsYW5lX3N0YXRlLT5ody5mYjsKKwljb25zdCB1bnNpZ25l
ZCBpbnQgcm90YXRpb24gPSBwbGFuZV9zdGF0ZS0+aHcucm90YXRpb247CisJaW50IHggPSBwbGFu
ZV9zdGF0ZS0+dWFwaS5zcmMueDEgPj4gMTY7CisJaW50IHkgPSBwbGFuZV9zdGF0ZS0+dWFwaS5z
cmMueTEgPj4gMTY7CisJY29uc3QgaW50IHcgPSBkcm1fcmVjdF93aWR0aCgmcGxhbmVfc3RhdGUt
PnVhcGkuc3JjKSA+PiAxNjsKKwljb25zdCBpbnQgaCA9IGRybV9yZWN0X2hlaWdodCgmcGxhbmVf
c3RhdGUtPnVhcGkuc3JjKSA+PiAxNjsKKwljb25zdCBpbnQgbWluX3dpZHRoID0gaW50ZWxfcGxh
bmVfbWluX3dpZHRoKHBsYW5lLCBmYiwgMCwgcm90YXRpb24pOworCWNvbnN0IGludCBtYXhfd2lk
dGggPSBpbnRlbF9wbGFuZV9tYXhfd2lkdGgocGxhbmUsIGZiLCAwLCByb3RhdGlvbik7CisJY29u
c3QgaW50IG1heF9oZWlnaHQgPSBpbnRlbF9wbGFuZV9tYXhfaGVpZ2h0KHBsYW5lLCBmYiwgMCwg
cm90YXRpb24pOworCWNvbnN0IGludCBhdXhfcGxhbmUgPSBza2xfbWFpbl90b19hdXhfcGxhbmUo
ZmIsIDApOworCWNvbnN0IHUzMiBhbGlnbm1lbnQgPSBpbnRlbF9zdXJmX2FsaWdubWVudChmYiwg
MCk7CisJdTMyIG9mZnNldDsKKwlpbnQgcmV0OworCisJaWYgKHcgPiBtYXhfd2lkdGggfHwgdyA8
IG1pbl93aWR0aCB8fCBoID4gbWF4X2hlaWdodCkgeworCQlkcm1fZGJnX2ttcygmZGV2X3ByaXYt
PmRybSwKKwkJCSAgICAicmVxdWVzdGVkIFkvUkdCIHNvdXJjZSBzaXplICVkeCVkIG91dHNpZGUg
bGltaXRzIChtaW46ICVkeDEgbWF4OiAlZHglZClcbiIsCisJCQkgICAgdywgaCwgbWluX3dpZHRo
LCBtYXhfd2lkdGgsIG1heF9oZWlnaHQpOworCQlyZXR1cm4gLUVJTlZBTDsKKwl9CisKKwlyZXQg
PSBza2xfY2FsY19tYWluX3N1cmZhY2Vfb2Zmc2V0KHBsYW5lX3N0YXRlLCAmeCwgJnksICZvZmZz
ZXQpOworCWlmIChyZXQpCisJCXJldHVybiByZXQ7CisKKwkvKgorCSAqIENDUyBBVVggc3VyZmFj
ZSBkb2Vzbid0IGhhdmUgaXRzIG93biB4L3kgb2Zmc2V0cywgd2UgbXVzdCBtYWtlIHN1cmUKKwkg
KiB0aGV5IG1hdGNoIHdpdGggdGhlIG1haW4gc3VyZmFjZSB4L3kgb2Zmc2V0cy4KKwkgKi8KKwlp
ZiAoaXNfY2NzX21vZGlmaWVyKGZiLT5tb2RpZmllcikpIHsKKwkJd2hpbGUgKCFza2xfY2hlY2tf
bWFpbl9jY3NfY29vcmRpbmF0ZXMocGxhbmVfc3RhdGUsIHgsIHksCisJCQkJCQkgICAgICAgb2Zm
c2V0LCBhdXhfcGxhbmUpKSB7CisJCQlpZiAob2Zmc2V0ID09IDApCisJCQkJYnJlYWs7CisKKwkJ
CW9mZnNldCA9IGludGVsX3BsYW5lX2FkanVzdF9hbGlnbmVkX29mZnNldCgmeCwgJnksIHBsYW5l
X3N0YXRlLCAwLAorCQkJCQkJCQkgICBvZmZzZXQsIG9mZnNldCAtIGFsaWdubWVudCk7CisJCX0K
KworCQlpZiAoeCAhPSBwbGFuZV9zdGF0ZS0+Y29sb3JfcGxhbmVbYXV4X3BsYW5lXS54IHx8CisJ
CSAgICB5ICE9IHBsYW5lX3N0YXRlLT5jb2xvcl9wbGFuZVthdXhfcGxhbmVdLnkpIHsKKwkJCWRy
bV9kYmdfa21zKCZkZXZfcHJpdi0+ZHJtLAorCQkJCSAgICAiVW5hYmxlIHRvIGZpbmQgc3VpdGFi
bGUgZGlzcGxheSBzdXJmYWNlIG9mZnNldCBkdWUgdG8gQ0NTXG4iKTsKKwkJCXJldHVybiAtRUlO
VkFMOworCQl9CisJfQorCisJZHJtX1dBUk5fT04oJmRldl9wcml2LT5kcm0sIHggPiA4MTkxIHx8
IHkgPiA4MTkxKTsKKworCXBsYW5lX3N0YXRlLT5jb2xvcl9wbGFuZVswXS5vZmZzZXQgPSBvZmZz
ZXQ7CisJcGxhbmVfc3RhdGUtPmNvbG9yX3BsYW5lWzBdLnggPSB4OworCXBsYW5lX3N0YXRlLT5j
b2xvcl9wbGFuZVswXS55ID0geTsKKworCS8qCisJICogUHV0IHRoZSBmaW5hbCBjb29yZGluYXRl
cyBiYWNrIHNvIHRoYXQgdGhlIHNyYworCSAqIGNvb3JkaW5hdGUgY2hlY2tzIHdpbGwgc2VlIHRo
ZSByaWdodCB2YWx1ZXMuCisJICovCisJZHJtX3JlY3RfdHJhbnNsYXRlX3RvKCZwbGFuZV9zdGF0
ZS0+dWFwaS5zcmMsCisJCQkgICAgICB4IDw8IDE2LCB5IDw8IDE2KTsKKworCXJldHVybiAwOwor
fQorCitzdGF0aWMgaW50IHNrbF9jaGVja19udjEyX2F1eF9zdXJmYWNlKHN0cnVjdCBpbnRlbF9w
bGFuZV9zdGF0ZSAqcGxhbmVfc3RhdGUpCit7CisJc3RydWN0IGludGVsX3BsYW5lICpwbGFuZSA9
IHRvX2ludGVsX3BsYW5lKHBsYW5lX3N0YXRlLT51YXBpLnBsYW5lKTsKKwlzdHJ1Y3QgZHJtX2k5
MTVfcHJpdmF0ZSAqaTkxNSA9IHRvX2k5MTUocGxhbmUtPmJhc2UuZGV2KTsKKwljb25zdCBzdHJ1
Y3QgZHJtX2ZyYW1lYnVmZmVyICpmYiA9IHBsYW5lX3N0YXRlLT5ody5mYjsKKwl1bnNpZ25lZCBp
bnQgcm90YXRpb24gPSBwbGFuZV9zdGF0ZS0+aHcucm90YXRpb247CisJaW50IHV2X3BsYW5lID0g
MTsKKwlpbnQgbWF4X3dpZHRoID0gaW50ZWxfcGxhbmVfbWF4X3dpZHRoKHBsYW5lLCBmYiwgdXZf
cGxhbmUsIHJvdGF0aW9uKTsKKwlpbnQgbWF4X2hlaWdodCA9IGludGVsX3BsYW5lX21heF9oZWln
aHQocGxhbmUsIGZiLCB1dl9wbGFuZSwgcm90YXRpb24pOworCWludCB4ID0gcGxhbmVfc3RhdGUt
PnVhcGkuc3JjLngxID4+IDE3OworCWludCB5ID0gcGxhbmVfc3RhdGUtPnVhcGkuc3JjLnkxID4+
IDE3OworCWludCB3ID0gZHJtX3JlY3Rfd2lkdGgoJnBsYW5lX3N0YXRlLT51YXBpLnNyYykgPj4g
MTc7CisJaW50IGggPSBkcm1fcmVjdF9oZWlnaHQoJnBsYW5lX3N0YXRlLT51YXBpLnNyYykgPj4g
MTc7CisJdTMyIG9mZnNldDsKKworCS8qIEZJWE1FIG5vdCBxdWl0ZSBzdXJlIGhvdy9pZiB0aGVz
ZSBhcHBseSB0byB0aGUgY2hyb21hIHBsYW5lICovCisJaWYgKHcgPiBtYXhfd2lkdGggfHwgaCA+
IG1heF9oZWlnaHQpIHsKKwkJZHJtX2RiZ19rbXMoJmk5MTUtPmRybSwKKwkJCSAgICAiQ2JDciBz
b3VyY2Ugc2l6ZSAlZHglZCB0b28gYmlnIChsaW1pdCAlZHglZClcbiIsCisJCQkgICAgdywgaCwg
bWF4X3dpZHRoLCBtYXhfaGVpZ2h0KTsKKwkJcmV0dXJuIC1FSU5WQUw7CisJfQorCisJaW50ZWxf
YWRkX2ZiX29mZnNldHMoJngsICZ5LCBwbGFuZV9zdGF0ZSwgdXZfcGxhbmUpOworCW9mZnNldCA9
IGludGVsX3BsYW5lX2NvbXB1dGVfYWxpZ25lZF9vZmZzZXQoJngsICZ5LAorCQkJCQkJICAgIHBs
YW5lX3N0YXRlLCB1dl9wbGFuZSk7CisKKwlpZiAoaXNfY2NzX21vZGlmaWVyKGZiLT5tb2RpZmll
cikpIHsKKwkJaW50IGNjc19wbGFuZSA9IG1haW5fdG9fY2NzX3BsYW5lKGZiLCB1dl9wbGFuZSk7
CisJCXUzMiBhdXhfb2Zmc2V0ID0gcGxhbmVfc3RhdGUtPmNvbG9yX3BsYW5lW2Njc19wbGFuZV0u
b2Zmc2V0OworCQl1MzIgYWxpZ25tZW50ID0gaW50ZWxfc3VyZl9hbGlnbm1lbnQoZmIsIHV2X3Bs
YW5lKTsKKworCQlpZiAob2Zmc2V0ID4gYXV4X29mZnNldCkKKwkJCW9mZnNldCA9IGludGVsX3Bs
YW5lX2FkanVzdF9hbGlnbmVkX29mZnNldCgmeCwgJnksCisJCQkJCQkJCSAgIHBsYW5lX3N0YXRl
LAorCQkJCQkJCQkgICB1dl9wbGFuZSwKKwkJCQkJCQkJICAgb2Zmc2V0LAorCQkJCQkJCQkgICBh
dXhfb2Zmc2V0ICYgfihhbGlnbm1lbnQgLSAxKSk7CisKKwkJd2hpbGUgKCFza2xfY2hlY2tfbWFp
bl9jY3NfY29vcmRpbmF0ZXMocGxhbmVfc3RhdGUsIHgsIHksCisJCQkJCQkgICAgICAgb2Zmc2V0
LCBjY3NfcGxhbmUpKSB7CisJCQlpZiAob2Zmc2V0ID09IDApCisJCQkJYnJlYWs7CisKKwkJCW9m
ZnNldCA9IGludGVsX3BsYW5lX2FkanVzdF9hbGlnbmVkX29mZnNldCgmeCwgJnksCisJCQkJCQkJ
CSAgIHBsYW5lX3N0YXRlLAorCQkJCQkJCQkgICB1dl9wbGFuZSwKKwkJCQkJCQkJICAgb2Zmc2V0
LCBvZmZzZXQgLSBhbGlnbm1lbnQpOworCQl9CisKKwkJaWYgKHggIT0gcGxhbmVfc3RhdGUtPmNv
bG9yX3BsYW5lW2Njc19wbGFuZV0ueCB8fAorCQkgICAgeSAhPSBwbGFuZV9zdGF0ZS0+Y29sb3Jf
cGxhbmVbY2NzX3BsYW5lXS55KSB7CisJCQlkcm1fZGJnX2ttcygmaTkxNS0+ZHJtLAorCQkJCSAg
ICAiVW5hYmxlIHRvIGZpbmQgc3VpdGFibGUgZGlzcGxheSBzdXJmYWNlIG9mZnNldCBkdWUgdG8g
Q0NTXG4iKTsKKwkJCXJldHVybiAtRUlOVkFMOworCQl9CisJfQorCisJZHJtX1dBUk5fT04oJmk5
MTUtPmRybSwgeCA+IDgxOTEgfHwgeSA+IDgxOTEpOworCisJcGxhbmVfc3RhdGUtPmNvbG9yX3Bs
YW5lW3V2X3BsYW5lXS5vZmZzZXQgPSBvZmZzZXQ7CisJcGxhbmVfc3RhdGUtPmNvbG9yX3BsYW5l
W3V2X3BsYW5lXS54ID0geDsKKwlwbGFuZV9zdGF0ZS0+Y29sb3JfcGxhbmVbdXZfcGxhbmVdLnkg
PSB5OworCisJcmV0dXJuIDA7Cit9CisKK3N0YXRpYyBpbnQgc2tsX2NoZWNrX2Njc19hdXhfc3Vy
ZmFjZShzdHJ1Y3QgaW50ZWxfcGxhbmVfc3RhdGUgKnBsYW5lX3N0YXRlKQoreworCWNvbnN0IHN0
cnVjdCBkcm1fZnJhbWVidWZmZXIgKmZiID0gcGxhbmVfc3RhdGUtPmh3LmZiOworCWludCBzcmNf
eCA9IHBsYW5lX3N0YXRlLT51YXBpLnNyYy54MSA+PiAxNjsKKwlpbnQgc3JjX3kgPSBwbGFuZV9z
dGF0ZS0+dWFwaS5zcmMueTEgPj4gMTY7CisJdTMyIG9mZnNldDsKKwlpbnQgY2NzX3BsYW5lOwor
CisJZm9yIChjY3NfcGxhbmUgPSAwOyBjY3NfcGxhbmUgPCBmYi0+Zm9ybWF0LT5udW1fcGxhbmVz
OyBjY3NfcGxhbmUrKykgeworCQlpbnQgbWFpbl9oc3ViLCBtYWluX3ZzdWI7CisJCWludCBoc3Vi
LCB2c3ViOworCQlpbnQgeCwgeTsKKworCQlpZiAoIWlzX2Njc19wbGFuZShmYiwgY2NzX3BsYW5l
KSB8fAorCQkgICAgaXNfZ2VuMTJfY2NzX2NjX3BsYW5lKGZiLCBjY3NfcGxhbmUpKQorCQkJY29u
dGludWU7CisKKwkJaW50ZWxfZmJfcGxhbmVfZ2V0X3N1YnNhbXBsaW5nKCZtYWluX2hzdWIsICZt
YWluX3ZzdWIsIGZiLAorCQkJCQkgICAgICAgc2tsX2Njc190b19tYWluX3BsYW5lKGZiLCBjY3Nf
cGxhbmUpKTsKKwkJaW50ZWxfZmJfcGxhbmVfZ2V0X3N1YnNhbXBsaW5nKCZoc3ViLCAmdnN1Yiwg
ZmIsIGNjc19wbGFuZSk7CisKKwkJaHN1YiAqPSBtYWluX2hzdWI7CisJCXZzdWIgKj0gbWFpbl92
c3ViOworCQl4ID0gc3JjX3ggLyBoc3ViOworCQl5ID0gc3JjX3kgLyB2c3ViOworCisJCWludGVs
X2FkZF9mYl9vZmZzZXRzKCZ4LCAmeSwgcGxhbmVfc3RhdGUsIGNjc19wbGFuZSk7CisKKwkJb2Zm
c2V0ID0gaW50ZWxfcGxhbmVfY29tcHV0ZV9hbGlnbmVkX29mZnNldCgmeCwgJnksCisJCQkJCQkJ
ICAgIHBsYW5lX3N0YXRlLAorCQkJCQkJCSAgICBjY3NfcGxhbmUpOworCisJCXBsYW5lX3N0YXRl
LT5jb2xvcl9wbGFuZVtjY3NfcGxhbmVdLm9mZnNldCA9IG9mZnNldDsKKwkJcGxhbmVfc3RhdGUt
PmNvbG9yX3BsYW5lW2Njc19wbGFuZV0ueCA9ICh4ICogaHN1YiArCisJCQkJCQkJIHNyY194ICUg
aHN1YikgLworCQkJCQkJCW1haW5faHN1YjsKKwkJcGxhbmVfc3RhdGUtPmNvbG9yX3BsYW5lW2Nj
c19wbGFuZV0ueSA9ICh5ICogdnN1YiArCisJCQkJCQkJIHNyY195ICUgdnN1YikgLworCQkJCQkJ
CW1haW5fdnN1YjsKKwl9CisKKwlyZXR1cm4gMDsKK30KKworc3RhdGljIGludCBza2xfY2hlY2tf
cGxhbmVfc3VyZmFjZShzdHJ1Y3QgaW50ZWxfcGxhbmVfc3RhdGUgKnBsYW5lX3N0YXRlKQorewor
CWNvbnN0IHN0cnVjdCBkcm1fZnJhbWVidWZmZXIgKmZiID0gcGxhbmVfc3RhdGUtPmh3LmZiOwor
CWludCByZXQsIGk7CisKKwlyZXQgPSBpbnRlbF9wbGFuZV9jb21wdXRlX2d0dChwbGFuZV9zdGF0
ZSk7CisJaWYgKHJldCkKKwkJcmV0dXJuIHJldDsKKworCWlmICghcGxhbmVfc3RhdGUtPnVhcGku
dmlzaWJsZSkKKwkJcmV0dXJuIDA7CisKKwkvKgorCSAqIEhhbmRsZSB0aGUgQVVYIHN1cmZhY2Ug
Zmlyc3Qgc2luY2UgdGhlIG1haW4gc3VyZmFjZSBzZXR1cCBkZXBlbmRzIG9uCisJICogaXQuCisJ
ICovCisJaWYgKGlzX2Njc19tb2RpZmllcihmYi0+bW9kaWZpZXIpKSB7CisJCXJldCA9IHNrbF9j
aGVja19jY3NfYXV4X3N1cmZhY2UocGxhbmVfc3RhdGUpOworCQlpZiAocmV0KQorCQkJcmV0dXJu
IHJldDsKKwl9CisKKwlpZiAoaW50ZWxfZm9ybWF0X2luZm9faXNfeXV2X3NlbWlwbGFuYXIoZmIt
PmZvcm1hdCwKKwkJCQkJCWZiLT5tb2RpZmllcikpIHsKKwkJcmV0ID0gc2tsX2NoZWNrX252MTJf
YXV4X3N1cmZhY2UocGxhbmVfc3RhdGUpOworCQlpZiAocmV0KQorCQkJcmV0dXJuIHJldDsKKwl9
CisKKwlmb3IgKGkgPSBmYi0+Zm9ybWF0LT5udW1fcGxhbmVzOyBpIDwgQVJSQVlfU0laRShwbGFu
ZV9zdGF0ZS0+Y29sb3JfcGxhbmUpOyBpKyspIHsKKwkJcGxhbmVfc3RhdGUtPmNvbG9yX3BsYW5l
W2ldLm9mZnNldCA9IDA7CisJCXBsYW5lX3N0YXRlLT5jb2xvcl9wbGFuZVtpXS54ID0gMDsKKwkJ
cGxhbmVfc3RhdGUtPmNvbG9yX3BsYW5lW2ldLnkgPSAwOworCX0KKworCXJldCA9IHNrbF9jaGVj
a19tYWluX3N1cmZhY2UocGxhbmVfc3RhdGUpOworCWlmIChyZXQpCisJCXJldHVybiByZXQ7CisK
KwlyZXR1cm4gMDsKK30KKworc3RhdGljIGJvb2wgaW50ZWxfZmJfc2NhbGFibGUoY29uc3Qgc3Ry
dWN0IGRybV9mcmFtZWJ1ZmZlciAqZmIpCit7CisJaWYgKCFmYikKKwkJcmV0dXJuIGZhbHNlOwor
CisJc3dpdGNoIChmYi0+Zm9ybWF0LT5mb3JtYXQpIHsKKwljYXNlIERSTV9GT1JNQVRfQzg6CisJ
CXJldHVybiBmYWxzZTsKKwljYXNlIERSTV9GT1JNQVRfWFJHQjE2MTYxNjE2RjoKKwljYXNlIERS
TV9GT1JNQVRfQVJHQjE2MTYxNjE2RjoKKwljYXNlIERSTV9GT1JNQVRfWEJHUjE2MTYxNjE2RjoK
KwljYXNlIERSTV9GT1JNQVRfQUJHUjE2MTYxNjE2RjoKKwkJcmV0dXJuIElOVEVMX0dFTih0b19p
OTE1KGZiLT5kZXYpKSA+PSAxMTsKKwlkZWZhdWx0OgorCQlyZXR1cm4gdHJ1ZTsKKwl9Cit9CisK
K3N0YXRpYyBpbnQgc2tsX3BsYW5lX2NoZWNrKHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRj
X3N0YXRlLAorCQkJICAgc3RydWN0IGludGVsX3BsYW5lX3N0YXRlICpwbGFuZV9zdGF0ZSkKK3sK
KwlzdHJ1Y3QgaW50ZWxfcGxhbmUgKnBsYW5lID0gdG9faW50ZWxfcGxhbmUocGxhbmVfc3RhdGUt
PnVhcGkucGxhbmUpOworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5
MTUocGxhbmUtPmJhc2UuZGV2KTsKKwljb25zdCBzdHJ1Y3QgZHJtX2ZyYW1lYnVmZmVyICpmYiA9
IHBsYW5lX3N0YXRlLT5ody5mYjsKKwlpbnQgbWluX3NjYWxlID0gRFJNX1BMQU5FX0hFTFBFUl9O
T19TQ0FMSU5HOworCWludCBtYXhfc2NhbGUgPSBEUk1fUExBTkVfSEVMUEVSX05PX1NDQUxJTkc7
CisJaW50IHJldDsKKworCXJldCA9IHNrbF9wbGFuZV9jaGVja19mYihjcnRjX3N0YXRlLCBwbGFu
ZV9zdGF0ZSk7CisJaWYgKHJldCkKKwkJcmV0dXJuIHJldDsKKworCS8qIHVzZSBzY2FsZXIgd2hl
biBjb2xvcmtleSBpcyBub3QgcmVxdWlyZWQgKi8KKwlpZiAoIXBsYW5lX3N0YXRlLT5ja2V5LmZs
YWdzICYmIGludGVsX2ZiX3NjYWxhYmxlKGZiKSkgeworCQltaW5fc2NhbGUgPSAxOworCQltYXhf
c2NhbGUgPSBza2xfcGxhbmVfbWF4X3NjYWxlKGRldl9wcml2LCBmYik7CisJfQorCisJcmV0ID0g
aW50ZWxfYXRvbWljX3BsYW5lX2NoZWNrX2NsaXBwaW5nKHBsYW5lX3N0YXRlLCBjcnRjX3N0YXRl
LAorCQkJCQkJbWluX3NjYWxlLCBtYXhfc2NhbGUsIHRydWUpOworCWlmIChyZXQpCisJCXJldHVy
biByZXQ7CisKKwlyZXQgPSBza2xfY2hlY2tfcGxhbmVfc3VyZmFjZShwbGFuZV9zdGF0ZSk7CisJ
aWYgKHJldCkKKwkJcmV0dXJuIHJldDsKKworCWlmICghcGxhbmVfc3RhdGUtPnVhcGkudmlzaWJs
ZSkKKwkJcmV0dXJuIDA7CisKKwlyZXQgPSBza2xfcGxhbmVfY2hlY2tfZHN0X2Nvb3JkaW5hdGVz
KGNydGNfc3RhdGUsIHBsYW5lX3N0YXRlKTsKKwlpZiAocmV0KQorCQlyZXR1cm4gcmV0OworCisJ
cmV0ID0gaW50ZWxfcGxhbmVfY2hlY2tfc3JjX2Nvb3JkaW5hdGVzKHBsYW5lX3N0YXRlKTsKKwlp
ZiAocmV0KQorCQlyZXR1cm4gcmV0OworCisJcmV0ID0gc2tsX3BsYW5lX2NoZWNrX252MTJfcm90
YXRpb24ocGxhbmVfc3RhdGUpOworCWlmIChyZXQpCisJCXJldHVybiByZXQ7CisKKwkvKiBIVyBv
bmx5IGhhcyA4IGJpdHMgcGl4ZWwgcHJlY2lzaW9uLCBkaXNhYmxlIHBsYW5lIGlmIGludmlzaWJs
ZSAqLworCWlmICghKHBsYW5lX3N0YXRlLT5ody5hbHBoYSA+PiA4KSkKKwkJcGxhbmVfc3RhdGUt
PnVhcGkudmlzaWJsZSA9IGZhbHNlOworCisJcGxhbmVfc3RhdGUtPmN0bCA9IHNrbF9wbGFuZV9j
dGwoY3J0Y19zdGF0ZSwgcGxhbmVfc3RhdGUpOworCisJaWYgKElOVEVMX0dFTihkZXZfcHJpdikg
Pj0gMTAgfHwgSVNfR0VNSU5JTEFLRShkZXZfcHJpdikpCisJCXBsYW5lX3N0YXRlLT5jb2xvcl9j
dGwgPSBnbGtfcGxhbmVfY29sb3JfY3RsKGNydGNfc3RhdGUsCisJCQkJCQkJICAgICBwbGFuZV9z
dGF0ZSk7CisKKwlpZiAoaW50ZWxfZm9ybWF0X2luZm9faXNfeXV2X3NlbWlwbGFuYXIoZmItPmZv
cm1hdCwgZmItPm1vZGlmaWVyKSAmJgorCSAgICBpY2xfaXNfaGRyX3BsYW5lKGRldl9wcml2LCBw
bGFuZS0+aWQpKQorCQkvKiBFbmFibGUgYW5kIHVzZSBNUEVHLTIgY2hyb21hIHNpdGluZyAqLwor
CQlwbGFuZV9zdGF0ZS0+Y3VzX2N0bCA9IFBMQU5FX0NVU19FTkFCTEUgfAorCQkJUExBTkVfQ1VT
X0hQSEFTRV8wIHwKKwkJCVBMQU5FX0NVU19WUEhBU0VfU0lHTl9ORUdBVElWRSB8IFBMQU5FX0NV
U19WUEhBU0VfMF8yNTsKKwllbHNlCisJCXBsYW5lX3N0YXRlLT5jdXNfY3RsID0gMDsKKworCXJl
dHVybiAwOworfQorCitzdGF0aWMgYm9vbCBza2xfcGxhbmVfaGFzX2ZiYyhzdHJ1Y3QgZHJtX2k5
MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCisJCQkgICAgICBlbnVtIHBpcGUgcGlwZSwgZW51bSBwbGFu
ZV9pZCBwbGFuZV9pZCkKK3sKKwlpZiAoIUhBU19GQkMoZGV2X3ByaXYpKQorCQlyZXR1cm4gZmFs
c2U7CisKKwlyZXR1cm4gcGlwZSA9PSBQSVBFX0EgJiYgcGxhbmVfaWQgPT0gUExBTkVfUFJJTUFS
WTsKK30KKworc3RhdGljIGJvb2wgc2tsX3BsYW5lX2hhc19wbGFuYXIoc3RydWN0IGRybV9pOTE1
X3ByaXZhdGUgKmRldl9wcml2LAorCQkJCSBlbnVtIHBpcGUgcGlwZSwgZW51bSBwbGFuZV9pZCBw
bGFuZV9pZCkKK3sKKwkvKiBEaXNwbGF5IFdBICMwODcwOiBza2wsIGJ4dCAqLworCWlmIChJU19T
S1lMQUtFKGRldl9wcml2KSB8fCBJU19CUk9YVE9OKGRldl9wcml2KSkKKwkJcmV0dXJuIGZhbHNl
OworCisJaWYgKElTX0dFTihkZXZfcHJpdiwgOSkgJiYgIUlTX0dFTUlOSUxBS0UoZGV2X3ByaXYp
ICYmIHBpcGUgPT0gUElQRV9DKQorCQlyZXR1cm4gZmFsc2U7CisKKwlpZiAocGxhbmVfaWQgIT0g
UExBTkVfUFJJTUFSWSAmJiBwbGFuZV9pZCAhPSBQTEFORV9TUFJJVEUwKQorCQlyZXR1cm4gZmFs
c2U7CisKKwlyZXR1cm4gdHJ1ZTsKK30KKworc3RhdGljIGNvbnN0IHUzMiAqc2tsX2dldF9wbGFu
ZV9mb3JtYXRzKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKKwkJCQkJZW51bSBw
aXBlIHBpcGUsIGVudW0gcGxhbmVfaWQgcGxhbmVfaWQsCisJCQkJCWludCAqbnVtX2Zvcm1hdHMp
Cit7CisJaWYgKHNrbF9wbGFuZV9oYXNfcGxhbmFyKGRldl9wcml2LCBwaXBlLCBwbGFuZV9pZCkp
IHsKKwkJKm51bV9mb3JtYXRzID0gQVJSQVlfU0laRShza2xfcGxhbmFyX2Zvcm1hdHMpOworCQly
ZXR1cm4gc2tsX3BsYW5hcl9mb3JtYXRzOworCX0gZWxzZSB7CisJCSpudW1fZm9ybWF0cyA9IEFS
UkFZX1NJWkUoc2tsX3BsYW5lX2Zvcm1hdHMpOworCQlyZXR1cm4gc2tsX3BsYW5lX2Zvcm1hdHM7
CisJfQorfQorCitzdGF0aWMgY29uc3QgdTMyICpnbGtfZ2V0X3BsYW5lX2Zvcm1hdHMoc3RydWN0
IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAorCQkJCQllbnVtIHBpcGUgcGlwZSwgZW51bSBw
bGFuZV9pZCBwbGFuZV9pZCwKKwkJCQkJaW50ICpudW1fZm9ybWF0cykKK3sKKwlpZiAoc2tsX3Bs
YW5lX2hhc19wbGFuYXIoZGV2X3ByaXYsIHBpcGUsIHBsYW5lX2lkKSkgeworCQkqbnVtX2Zvcm1h
dHMgPSBBUlJBWV9TSVpFKGdsa19wbGFuYXJfZm9ybWF0cyk7CisJCXJldHVybiBnbGtfcGxhbmFy
X2Zvcm1hdHM7CisJfSBlbHNlIHsKKwkJKm51bV9mb3JtYXRzID0gQVJSQVlfU0laRShza2xfcGxh
bmVfZm9ybWF0cyk7CisJCXJldHVybiBza2xfcGxhbmVfZm9ybWF0czsKKwl9Cit9CisKK3N0YXRp
YyBjb25zdCB1MzIgKmljbF9nZXRfcGxhbmVfZm9ybWF0cyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0
ZSAqZGV2X3ByaXYsCisJCQkJCWVudW0gcGlwZSBwaXBlLCBlbnVtIHBsYW5lX2lkIHBsYW5lX2lk
LAorCQkJCQlpbnQgKm51bV9mb3JtYXRzKQoreworCWlmIChpY2xfaXNfaGRyX3BsYW5lKGRldl9w
cml2LCBwbGFuZV9pZCkpIHsKKwkJKm51bV9mb3JtYXRzID0gQVJSQVlfU0laRShpY2xfaGRyX3Bs
YW5lX2Zvcm1hdHMpOworCQlyZXR1cm4gaWNsX2hkcl9wbGFuZV9mb3JtYXRzOworCX0gZWxzZSBp
ZiAoaWNsX2lzX252MTJfeV9wbGFuZShkZXZfcHJpdiwgcGxhbmVfaWQpKSB7CisJCSpudW1fZm9y
bWF0cyA9IEFSUkFZX1NJWkUoaWNsX3Nkcl95X3BsYW5lX2Zvcm1hdHMpOworCQlyZXR1cm4gaWNs
X3Nkcl95X3BsYW5lX2Zvcm1hdHM7CisJfSBlbHNlIHsKKwkJKm51bV9mb3JtYXRzID0gQVJSQVlf
U0laRShpY2xfc2RyX3V2X3BsYW5lX2Zvcm1hdHMpOworCQlyZXR1cm4gaWNsX3Nkcl91dl9wbGFu
ZV9mb3JtYXRzOworCX0KK30KKworc3RhdGljIGJvb2wgc2tsX3BsYW5lX2hhc19jY3Moc3RydWN0
IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAorCQkJICAgICAgZW51bSBwaXBlIHBpcGUsIGVu
dW0gcGxhbmVfaWQgcGxhbmVfaWQpCit7CisJaWYgKHBsYW5lX2lkID09IFBMQU5FX0NVUlNPUikK
KwkJcmV0dXJuIGZhbHNlOworCisJaWYgKElOVEVMX0dFTihkZXZfcHJpdikgPj0gMTApCisJCXJl
dHVybiB0cnVlOworCisJaWYgKElTX0dFTUlOSUxBS0UoZGV2X3ByaXYpKQorCQlyZXR1cm4gcGlw
ZSAhPSBQSVBFX0M7CisKKwlyZXR1cm4gcGlwZSAhPSBQSVBFX0MgJiYKKwkJKHBsYW5lX2lkID09
IFBMQU5FX1BSSU1BUlkgfHwKKwkJIHBsYW5lX2lkID09IFBMQU5FX1NQUklURTApOworfQorCitz
dGF0aWMgYm9vbCBza2xfcGxhbmVfZm9ybWF0X21vZF9zdXBwb3J0ZWQoc3RydWN0IGRybV9wbGFu
ZSAqX3BsYW5lLAorCQkJCQkgICB1MzIgZm9ybWF0LCB1NjQgbW9kaWZpZXIpCit7CisJc3RydWN0
IGludGVsX3BsYW5lICpwbGFuZSA9IHRvX2ludGVsX3BsYW5lKF9wbGFuZSk7CisKKwlzd2l0Y2gg
KG1vZGlmaWVyKSB7CisJY2FzZSBEUk1fRk9STUFUX01PRF9MSU5FQVI6CisJY2FzZSBJOTE1X0ZP
Uk1BVF9NT0RfWF9USUxFRDoKKwljYXNlIEk5MTVfRk9STUFUX01PRF9ZX1RJTEVEOgorCWNhc2Ug
STkxNV9GT1JNQVRfTU9EX1lmX1RJTEVEOgorCQlicmVhazsKKwljYXNlIEk5MTVfRk9STUFUX01P
RF9ZX1RJTEVEX0NDUzoKKwljYXNlIEk5MTVfRk9STUFUX01PRF9ZZl9USUxFRF9DQ1M6CisJCWlm
ICghcGxhbmUtPmhhc19jY3MpCisJCQlyZXR1cm4gZmFsc2U7CisJCWJyZWFrOworCWRlZmF1bHQ6
CisJCXJldHVybiBmYWxzZTsKKwl9CisKKwlzd2l0Y2ggKGZvcm1hdCkgeworCWNhc2UgRFJNX0ZP
Uk1BVF9YUkdCODg4ODoKKwljYXNlIERSTV9GT1JNQVRfWEJHUjg4ODg6CisJY2FzZSBEUk1fRk9S
TUFUX0FSR0I4ODg4OgorCWNhc2UgRFJNX0ZPUk1BVF9BQkdSODg4ODoKKwkJaWYgKGlzX2Njc19t
b2RpZmllcihtb2RpZmllcikpCisJCQlyZXR1cm4gdHJ1ZTsKKwkJZmFsbHRocm91Z2g7CisJY2Fz
ZSBEUk1fRk9STUFUX1JHQjU2NToKKwljYXNlIERSTV9GT1JNQVRfWFJHQjIxMDEwMTA6CisJY2Fz
ZSBEUk1fRk9STUFUX1hCR1IyMTAxMDEwOgorCWNhc2UgRFJNX0ZPUk1BVF9BUkdCMjEwMTAxMDoK
KwljYXNlIERSTV9GT1JNQVRfQUJHUjIxMDEwMTA6CisJY2FzZSBEUk1fRk9STUFUX1lVWVY6CisJ
Y2FzZSBEUk1fRk9STUFUX1lWWVU6CisJY2FzZSBEUk1fRk9STUFUX1VZVlk6CisJY2FzZSBEUk1f
Rk9STUFUX1ZZVVk6CisJY2FzZSBEUk1fRk9STUFUX05WMTI6CisJY2FzZSBEUk1fRk9STUFUX1hZ
VVY4ODg4OgorCWNhc2UgRFJNX0ZPUk1BVF9QMDEwOgorCWNhc2UgRFJNX0ZPUk1BVF9QMDEyOgor
CWNhc2UgRFJNX0ZPUk1BVF9QMDE2OgorCWNhc2UgRFJNX0ZPUk1BVF9YVllVMjEwMTAxMDoKKwkJ
aWYgKG1vZGlmaWVyID09IEk5MTVfRk9STUFUX01PRF9ZZl9USUxFRCkKKwkJCXJldHVybiB0cnVl
OworCQlmYWxsdGhyb3VnaDsKKwljYXNlIERSTV9GT1JNQVRfQzg6CisJY2FzZSBEUk1fRk9STUFU
X1hCR1IxNjE2MTYxNkY6CisJY2FzZSBEUk1fRk9STUFUX0FCR1IxNjE2MTYxNkY6CisJY2FzZSBE
Uk1fRk9STUFUX1hSR0IxNjE2MTYxNkY6CisJY2FzZSBEUk1fRk9STUFUX0FSR0IxNjE2MTYxNkY6
CisJY2FzZSBEUk1fRk9STUFUX1kyMTA6CisJY2FzZSBEUk1fRk9STUFUX1kyMTI6CisJY2FzZSBE
Uk1fRk9STUFUX1kyMTY6CisJY2FzZSBEUk1fRk9STUFUX1hWWVUxMl8xNjE2MTYxNjoKKwljYXNl
IERSTV9GT1JNQVRfWFZZVTE2MTYxNjE2OgorCQlpZiAobW9kaWZpZXIgPT0gRFJNX0ZPUk1BVF9N
T0RfTElORUFSIHx8CisJCSAgICBtb2RpZmllciA9PSBJOTE1X0ZPUk1BVF9NT0RfWF9USUxFRCB8
fAorCQkgICAgbW9kaWZpZXIgPT0gSTkxNV9GT1JNQVRfTU9EX1lfVElMRUQpCisJCQlyZXR1cm4g
dHJ1ZTsKKwkJZmFsbHRocm91Z2g7CisJZGVmYXVsdDoKKwkJcmV0dXJuIGZhbHNlOworCX0KK30K
Kworc3RhdGljIGJvb2wgZ2VuMTJfcGxhbmVfc3VwcG9ydHNfbWNfY2NzKHN0cnVjdCBkcm1faTkx
NV9wcml2YXRlICpkZXZfcHJpdiwKKwkJCQkJZW51bSBwbGFuZV9pZCBwbGFuZV9pZCkKK3sKKwkv
KiBXYV8xNDAxMDQ3NzAwODp0Z2xbYTAuLmMwXSxya2xbYWxsXSxkZzFbYWxsXSAqLworCWlmIChJ
U19ERzEoZGV2X3ByaXYpIHx8IElTX1JPQ0tFVExBS0UoZGV2X3ByaXYpIHx8CisJICAgIElTX1RH
TF9ESVNQX1NURVBQSU5HKGRldl9wcml2LCBTVEVQX0EwLCBTVEVQX0MwKSkKKwkJcmV0dXJuIGZh
bHNlOworCisJcmV0dXJuIHBsYW5lX2lkIDwgUExBTkVfU1BSSVRFNDsKK30KKworc3RhdGljIGJv
b2wgZ2VuMTJfcGxhbmVfZm9ybWF0X21vZF9zdXBwb3J0ZWQoc3RydWN0IGRybV9wbGFuZSAqX3Bs
YW5lLAorCQkJCQkgICAgIHUzMiBmb3JtYXQsIHU2NCBtb2RpZmllcikKK3sKKwlzdHJ1Y3QgZHJt
X2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KF9wbGFuZS0+ZGV2KTsKKwlzdHJ1Y3Qg
aW50ZWxfcGxhbmUgKnBsYW5lID0gdG9faW50ZWxfcGxhbmUoX3BsYW5lKTsKKworCXN3aXRjaCAo
bW9kaWZpZXIpIHsKKwljYXNlIEk5MTVfRk9STUFUX01PRF9ZX1RJTEVEX0dFTjEyX01DX0NDUzoK
KwkJaWYgKCFnZW4xMl9wbGFuZV9zdXBwb3J0c19tY19jY3MoZGV2X3ByaXYsIHBsYW5lLT5pZCkp
CisJCQlyZXR1cm4gZmFsc2U7CisJCWZhbGx0aHJvdWdoOworCWNhc2UgRFJNX0ZPUk1BVF9NT0Rf
TElORUFSOgorCWNhc2UgSTkxNV9GT1JNQVRfTU9EX1hfVElMRUQ6CisJY2FzZSBJOTE1X0ZPUk1B
VF9NT0RfWV9USUxFRDoKKwljYXNlIEk5MTVfRk9STUFUX01PRF9ZX1RJTEVEX0dFTjEyX1JDX0ND
UzoKKwljYXNlIEk5MTVfRk9STUFUX01PRF9ZX1RJTEVEX0dFTjEyX1JDX0NDU19DQzoKKwkJYnJl
YWs7CisJZGVmYXVsdDoKKwkJcmV0dXJuIGZhbHNlOworCX0KKworCXN3aXRjaCAoZm9ybWF0KSB7
CisJY2FzZSBEUk1fRk9STUFUX1hSR0I4ODg4OgorCWNhc2UgRFJNX0ZPUk1BVF9YQkdSODg4ODoK
KwljYXNlIERSTV9GT1JNQVRfQVJHQjg4ODg6CisJY2FzZSBEUk1fRk9STUFUX0FCR1I4ODg4Ogor
CQlpZiAoaXNfY2NzX21vZGlmaWVyKG1vZGlmaWVyKSkKKwkJCXJldHVybiB0cnVlOworCQlmYWxs
dGhyb3VnaDsKKwljYXNlIERSTV9GT1JNQVRfWVVZVjoKKwljYXNlIERSTV9GT1JNQVRfWVZZVToK
KwljYXNlIERSTV9GT1JNQVRfVVlWWToKKwljYXNlIERSTV9GT1JNQVRfVllVWToKKwljYXNlIERS
TV9GT1JNQVRfTlYxMjoKKwljYXNlIERSTV9GT1JNQVRfWFlVVjg4ODg6CisJY2FzZSBEUk1fRk9S
TUFUX1AwMTA6CisJY2FzZSBEUk1fRk9STUFUX1AwMTI6CisJY2FzZSBEUk1fRk9STUFUX1AwMTY6
CisJCWlmIChtb2RpZmllciA9PSBJOTE1X0ZPUk1BVF9NT0RfWV9USUxFRF9HRU4xMl9NQ19DQ1Mp
CisJCQlyZXR1cm4gdHJ1ZTsKKwkJZmFsbHRocm91Z2g7CisJY2FzZSBEUk1fRk9STUFUX1JHQjU2
NToKKwljYXNlIERSTV9GT1JNQVRfWFJHQjIxMDEwMTA6CisJY2FzZSBEUk1fRk9STUFUX1hCR1Iy
MTAxMDEwOgorCWNhc2UgRFJNX0ZPUk1BVF9BUkdCMjEwMTAxMDoKKwljYXNlIERSTV9GT1JNQVRf
QUJHUjIxMDEwMTA6CisJY2FzZSBEUk1fRk9STUFUX1hWWVUyMTAxMDEwOgorCWNhc2UgRFJNX0ZP
Uk1BVF9DODoKKwljYXNlIERSTV9GT1JNQVRfWEJHUjE2MTYxNjE2RjoKKwljYXNlIERSTV9GT1JN
QVRfQUJHUjE2MTYxNjE2RjoKKwljYXNlIERSTV9GT1JNQVRfWFJHQjE2MTYxNjE2RjoKKwljYXNl
IERSTV9GT1JNQVRfQVJHQjE2MTYxNjE2RjoKKwljYXNlIERSTV9GT1JNQVRfWTIxMDoKKwljYXNl
IERSTV9GT1JNQVRfWTIxMjoKKwljYXNlIERSTV9GT1JNQVRfWTIxNjoKKwljYXNlIERSTV9GT1JN
QVRfWFZZVTEyXzE2MTYxNjE2OgorCWNhc2UgRFJNX0ZPUk1BVF9YVllVMTYxNjE2MTY6CisJCWlm
IChtb2RpZmllciA9PSBEUk1fRk9STUFUX01PRF9MSU5FQVIgfHwKKwkJICAgIG1vZGlmaWVyID09
IEk5MTVfRk9STUFUX01PRF9YX1RJTEVEIHx8CisJCSAgICBtb2RpZmllciA9PSBJOTE1X0ZPUk1B
VF9NT0RfWV9USUxFRCkKKwkJCXJldHVybiB0cnVlOworCQlmYWxsdGhyb3VnaDsKKwlkZWZhdWx0
OgorCQlyZXR1cm4gZmFsc2U7CisJfQorfQorCitzdGF0aWMgY29uc3QgdTY0ICpnZW4xMl9nZXRf
cGxhbmVfbW9kaWZpZXJzKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKKwkJCQkJ
ICAgIGVudW0gcGxhbmVfaWQgcGxhbmVfaWQpCit7CisJaWYgKGdlbjEyX3BsYW5lX3N1cHBvcnRz
X21jX2NjcyhkZXZfcHJpdiwgcGxhbmVfaWQpKQorCQlyZXR1cm4gZ2VuMTJfcGxhbmVfZm9ybWF0
X21vZGlmaWVyc19tY19jY3M7CisJZWxzZQorCQlyZXR1cm4gZ2VuMTJfcGxhbmVfZm9ybWF0X21v
ZGlmaWVyc19yY19jY3M7Cit9CisKK3N0YXRpYyBjb25zdCBzdHJ1Y3QgZHJtX3BsYW5lX2Z1bmNz
IHNrbF9wbGFuZV9mdW5jcyA9IHsKKwkudXBkYXRlX3BsYW5lID0gZHJtX2F0b21pY19oZWxwZXJf
dXBkYXRlX3BsYW5lLAorCS5kaXNhYmxlX3BsYW5lID0gZHJtX2F0b21pY19oZWxwZXJfZGlzYWJs
ZV9wbGFuZSwKKwkuZGVzdHJveSA9IGludGVsX3BsYW5lX2Rlc3Ryb3ksCisJLmF0b21pY19kdXBs
aWNhdGVfc3RhdGUgPSBpbnRlbF9wbGFuZV9kdXBsaWNhdGVfc3RhdGUsCisJLmF0b21pY19kZXN0
cm95X3N0YXRlID0gaW50ZWxfcGxhbmVfZGVzdHJveV9zdGF0ZSwKKwkuZm9ybWF0X21vZF9zdXBw
b3J0ZWQgPSBza2xfcGxhbmVfZm9ybWF0X21vZF9zdXBwb3J0ZWQsCit9OworCitzdGF0aWMgY29u
c3Qgc3RydWN0IGRybV9wbGFuZV9mdW5jcyBnZW4xMl9wbGFuZV9mdW5jcyA9IHsKKwkudXBkYXRl
X3BsYW5lID0gZHJtX2F0b21pY19oZWxwZXJfdXBkYXRlX3BsYW5lLAorCS5kaXNhYmxlX3BsYW5l
ID0gZHJtX2F0b21pY19oZWxwZXJfZGlzYWJsZV9wbGFuZSwKKwkuZGVzdHJveSA9IGludGVsX3Bs
YW5lX2Rlc3Ryb3ksCisJLmF0b21pY19kdXBsaWNhdGVfc3RhdGUgPSBpbnRlbF9wbGFuZV9kdXBs
aWNhdGVfc3RhdGUsCisJLmF0b21pY19kZXN0cm95X3N0YXRlID0gaW50ZWxfcGxhbmVfZGVzdHJv
eV9zdGF0ZSwKKwkuZm9ybWF0X21vZF9zdXBwb3J0ZWQgPSBnZW4xMl9wbGFuZV9mb3JtYXRfbW9k
X3N1cHBvcnRlZCwKK307CisKK3N0YXRpYyB2b2lkCitza2xfcGxhbmVfZW5hYmxlX2ZsaXBfZG9u
ZShzdHJ1Y3QgaW50ZWxfcGxhbmUgKnBsYW5lKQoreworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRl
ICppOTE1ID0gdG9faTkxNShwbGFuZS0+YmFzZS5kZXYpOworCWVudW0gcGlwZSBwaXBlID0gcGxh
bmUtPnBpcGU7CisKKwlzcGluX2xvY2tfaXJxKCZpOTE1LT5pcnFfbG9jayk7CisJYmR3X2VuYWJs
ZV9waXBlX2lycShpOTE1LCBwaXBlLCBHRU45X1BJUEVfUExBTkVfRkxJUF9ET05FKHBsYW5lLT5p
ZCkpOworCXNwaW5fdW5sb2NrX2lycSgmaTkxNS0+aXJxX2xvY2spOworfQorCitzdGF0aWMgdm9p
ZAorc2tsX3BsYW5lX2Rpc2FibGVfZmxpcF9kb25lKHN0cnVjdCBpbnRlbF9wbGFuZSAqcGxhbmUp
Cit7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSB0b19pOTE1KHBsYW5lLT5iYXNl
LmRldik7CisJZW51bSBwaXBlIHBpcGUgPSBwbGFuZS0+cGlwZTsKKworCXNwaW5fbG9ja19pcnEo
Jmk5MTUtPmlycV9sb2NrKTsKKwliZHdfZGlzYWJsZV9waXBlX2lycShpOTE1LCBwaXBlLCBHRU45
X1BJUEVfUExBTkVfRkxJUF9ET05FKHBsYW5lLT5pZCkpOworCXNwaW5fdW5sb2NrX2lycSgmaTkx
NS0+aXJxX2xvY2spOworfQorCitzdHJ1Y3QgaW50ZWxfcGxhbmUgKgorc2tsX3VuaXZlcnNhbF9w
bGFuZV9jcmVhdGUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAorCQkJICAgZW51
bSBwaXBlIHBpcGUsIGVudW0gcGxhbmVfaWQgcGxhbmVfaWQpCit7CisJY29uc3Qgc3RydWN0IGRy
bV9wbGFuZV9mdW5jcyAqcGxhbmVfZnVuY3M7CisJc3RydWN0IGludGVsX3BsYW5lICpwbGFuZTsK
KwllbnVtIGRybV9wbGFuZV90eXBlIHBsYW5lX3R5cGU7CisJdW5zaWduZWQgaW50IHN1cHBvcnRl
ZF9yb3RhdGlvbnM7CisJdW5zaWduZWQgaW50IHN1cHBvcnRlZF9jc2M7CisJY29uc3QgdTY0ICpt
b2RpZmllcnM7CisJY29uc3QgdTMyICpmb3JtYXRzOworCWludCBudW1fZm9ybWF0czsKKwlpbnQg
cmV0OworCisJcGxhbmUgPSBpbnRlbF9wbGFuZV9hbGxvYygpOworCWlmIChJU19FUlIocGxhbmUp
KQorCQlyZXR1cm4gcGxhbmU7CisKKwlwbGFuZS0+cGlwZSA9IHBpcGU7CisJcGxhbmUtPmlkID0g
cGxhbmVfaWQ7CisJcGxhbmUtPmZyb250YnVmZmVyX2JpdCA9IElOVEVMX0ZST05UQlVGRkVSKHBp
cGUsIHBsYW5lX2lkKTsKKworCXBsYW5lLT5oYXNfZmJjID0gc2tsX3BsYW5lX2hhc19mYmMoZGV2
X3ByaXYsIHBpcGUsIHBsYW5lX2lkKTsKKwlpZiAocGxhbmUtPmhhc19mYmMpIHsKKwkJc3RydWN0
IGludGVsX2ZiYyAqZmJjID0gJmRldl9wcml2LT5mYmM7CisKKwkJZmJjLT5wb3NzaWJsZV9mcmFt
ZWJ1ZmZlcl9iaXRzIHw9IHBsYW5lLT5mcm9udGJ1ZmZlcl9iaXQ7CisJfQorCisJaWYgKElOVEVM
X0dFTihkZXZfcHJpdikgPj0gMTEpIHsKKwkJcGxhbmUtPm1pbl93aWR0aCA9IGljbF9wbGFuZV9t
aW5fd2lkdGg7CisJCXBsYW5lLT5tYXhfd2lkdGggPSBpY2xfcGxhbmVfbWF4X3dpZHRoOworCQlw
bGFuZS0+bWF4X2hlaWdodCA9IGljbF9wbGFuZV9tYXhfaGVpZ2h0OworCX0gZWxzZSBpZiAoSU5U
RUxfR0VOKGRldl9wcml2KSA+PSAxMCB8fCBJU19HRU1JTklMQUtFKGRldl9wcml2KSkgeworCQlw
bGFuZS0+bWF4X3dpZHRoID0gZ2xrX3BsYW5lX21heF93aWR0aDsKKwkJcGxhbmUtPm1heF9oZWln
aHQgPSBza2xfcGxhbmVfbWF4X2hlaWdodDsKKwl9IGVsc2UgeworCQlwbGFuZS0+bWF4X3dpZHRo
ID0gc2tsX3BsYW5lX21heF93aWR0aDsKKwkJcGxhbmUtPm1heF9oZWlnaHQgPSBza2xfcGxhbmVf
bWF4X2hlaWdodDsKKwl9CisKKwlwbGFuZS0+bWF4X3N0cmlkZSA9IHNrbF9wbGFuZV9tYXhfc3Ry
aWRlOworCXBsYW5lLT51cGRhdGVfcGxhbmUgPSBza2xfdXBkYXRlX3BsYW5lOworCXBsYW5lLT5k
aXNhYmxlX3BsYW5lID0gc2tsX2Rpc2FibGVfcGxhbmU7CisJcGxhbmUtPmdldF9od19zdGF0ZSA9
IHNrbF9wbGFuZV9nZXRfaHdfc3RhdGU7CisJcGxhbmUtPmNoZWNrX3BsYW5lID0gc2tsX3BsYW5l
X2NoZWNrOworCXBsYW5lLT5taW5fY2RjbGsgPSBza2xfcGxhbmVfbWluX2NkY2xrOworCisJaWYg
KHBsYW5lX2lkID09IFBMQU5FX1BSSU1BUlkpIHsKKwkJcGxhbmUtPm5lZWRfYXN5bmNfZmxpcF9k
aXNhYmxlX3dhID0gSVNfR0VOX1JBTkdFKGRldl9wcml2LCA5LCAxMCk7CisJCXBsYW5lLT5hc3lu
Y19mbGlwID0gc2tsX3BsYW5lX2FzeW5jX2ZsaXA7CisJCXBsYW5lLT5lbmFibGVfZmxpcF9kb25l
ID0gc2tsX3BsYW5lX2VuYWJsZV9mbGlwX2RvbmU7CisJCXBsYW5lLT5kaXNhYmxlX2ZsaXBfZG9u
ZSA9IHNrbF9wbGFuZV9kaXNhYmxlX2ZsaXBfZG9uZTsKKwl9CisKKwlpZiAoSU5URUxfR0VOKGRl
dl9wcml2KSA+PSAxMSkKKwkJZm9ybWF0cyA9IGljbF9nZXRfcGxhbmVfZm9ybWF0cyhkZXZfcHJp
diwgcGlwZSwKKwkJCQkJCXBsYW5lX2lkLCAmbnVtX2Zvcm1hdHMpOworCWVsc2UgaWYgKElOVEVM
X0dFTihkZXZfcHJpdikgPj0gMTAgfHwgSVNfR0VNSU5JTEFLRShkZXZfcHJpdikpCisJCWZvcm1h
dHMgPSBnbGtfZ2V0X3BsYW5lX2Zvcm1hdHMoZGV2X3ByaXYsIHBpcGUsCisJCQkJCQlwbGFuZV9p
ZCwgJm51bV9mb3JtYXRzKTsKKwllbHNlCisJCWZvcm1hdHMgPSBza2xfZ2V0X3BsYW5lX2Zvcm1h
dHMoZGV2X3ByaXYsIHBpcGUsCisJCQkJCQlwbGFuZV9pZCwgJm51bV9mb3JtYXRzKTsKKworCXBs
YW5lLT5oYXNfY2NzID0gc2tsX3BsYW5lX2hhc19jY3MoZGV2X3ByaXYsIHBpcGUsIHBsYW5lX2lk
KTsKKwlpZiAoSU5URUxfR0VOKGRldl9wcml2KSA+PSAxMikgeworCQltb2RpZmllcnMgPSBnZW4x
Ml9nZXRfcGxhbmVfbW9kaWZpZXJzKGRldl9wcml2LCBwbGFuZV9pZCk7CisJCXBsYW5lX2Z1bmNz
ID0gJmdlbjEyX3BsYW5lX2Z1bmNzOworCX0gZWxzZSB7CisJCWlmIChwbGFuZS0+aGFzX2NjcykK
KwkJCW1vZGlmaWVycyA9IHNrbF9wbGFuZV9mb3JtYXRfbW9kaWZpZXJzX2NjczsKKwkJZWxzZQor
CQkJbW9kaWZpZXJzID0gc2tsX3BsYW5lX2Zvcm1hdF9tb2RpZmllcnNfbm9jY3M7CisJCXBsYW5l
X2Z1bmNzID0gJnNrbF9wbGFuZV9mdW5jczsKKwl9CisKKwlpZiAocGxhbmVfaWQgPT0gUExBTkVf
UFJJTUFSWSkKKwkJcGxhbmVfdHlwZSA9IERSTV9QTEFORV9UWVBFX1BSSU1BUlk7CisJZWxzZQor
CQlwbGFuZV90eXBlID0gRFJNX1BMQU5FX1RZUEVfT1ZFUkxBWTsKKworCXJldCA9IGRybV91bml2
ZXJzYWxfcGxhbmVfaW5pdCgmZGV2X3ByaXYtPmRybSwgJnBsYW5lLT5iYXNlLAorCQkJCSAgICAg
ICAwLCBwbGFuZV9mdW5jcywKKwkJCQkgICAgICAgZm9ybWF0cywgbnVtX2Zvcm1hdHMsIG1vZGlm
aWVycywKKwkJCQkgICAgICAgcGxhbmVfdHlwZSwKKwkJCQkgICAgICAgInBsYW5lICVkJWMiLCBw
bGFuZV9pZCArIDEsCisJCQkJICAgICAgIHBpcGVfbmFtZShwaXBlKSk7CisJaWYgKHJldCkKKwkJ
Z290byBmYWlsOworCisJc3VwcG9ydGVkX3JvdGF0aW9ucyA9CisJCURSTV9NT0RFX1JPVEFURV8w
IHwgRFJNX01PREVfUk9UQVRFXzkwIHwKKwkJRFJNX01PREVfUk9UQVRFXzE4MCB8IERSTV9NT0RF
X1JPVEFURV8yNzA7CisKKwlpZiAoSU5URUxfR0VOKGRldl9wcml2KSA+PSAxMCkKKwkJc3VwcG9y
dGVkX3JvdGF0aW9ucyB8PSBEUk1fTU9ERV9SRUZMRUNUX1g7CisKKwlkcm1fcGxhbmVfY3JlYXRl
X3JvdGF0aW9uX3Byb3BlcnR5KCZwbGFuZS0+YmFzZSwKKwkJCQkJICAgRFJNX01PREVfUk9UQVRF
XzAsCisJCQkJCSAgIHN1cHBvcnRlZF9yb3RhdGlvbnMpOworCisJc3VwcG9ydGVkX2NzYyA9IEJJ
VChEUk1fQ09MT1JfWUNCQ1JfQlQ2MDEpIHwgQklUKERSTV9DT0xPUl9ZQ0JDUl9CVDcwOSk7CisK
KwlpZiAoSU5URUxfR0VOKGRldl9wcml2KSA+PSAxMCB8fCBJU19HRU1JTklMQUtFKGRldl9wcml2
KSkKKwkJc3VwcG9ydGVkX2NzYyB8PSBCSVQoRFJNX0NPTE9SX1lDQkNSX0JUMjAyMCk7CisKKwlk
cm1fcGxhbmVfY3JlYXRlX2NvbG9yX3Byb3BlcnRpZXMoJnBsYW5lLT5iYXNlLAorCQkJCQkgIHN1
cHBvcnRlZF9jc2MsCisJCQkJCSAgQklUKERSTV9DT0xPUl9ZQ0JDUl9MSU1JVEVEX1JBTkdFKSB8
CisJCQkJCSAgQklUKERSTV9DT0xPUl9ZQ0JDUl9GVUxMX1JBTkdFKSwKKwkJCQkJICBEUk1fQ09M
T1JfWUNCQ1JfQlQ3MDksCisJCQkJCSAgRFJNX0NPTE9SX1lDQkNSX0xJTUlURURfUkFOR0UpOwor
CisJZHJtX3BsYW5lX2NyZWF0ZV9hbHBoYV9wcm9wZXJ0eSgmcGxhbmUtPmJhc2UpOworCWRybV9w
bGFuZV9jcmVhdGVfYmxlbmRfbW9kZV9wcm9wZXJ0eSgmcGxhbmUtPmJhc2UsCisJCQkJCSAgICAg
QklUKERSTV9NT0RFX0JMRU5EX1BJWEVMX05PTkUpIHwKKwkJCQkJICAgICBCSVQoRFJNX01PREVf
QkxFTkRfUFJFTVVMVEkpIHwKKwkJCQkJICAgICBCSVQoRFJNX01PREVfQkxFTkRfQ09WRVJBR0Up
KTsKKworCWRybV9wbGFuZV9jcmVhdGVfenBvc19pbW11dGFibGVfcHJvcGVydHkoJnBsYW5lLT5i
YXNlLCBwbGFuZV9pZCk7CisKKwlpZiAoSU5URUxfR0VOKGRldl9wcml2KSA+PSAxMikKKwkJZHJt
X3BsYW5lX2VuYWJsZV9mYl9kYW1hZ2VfY2xpcHMoJnBsYW5lLT5iYXNlKTsKKworCWlmIChJTlRF
TF9HRU4oZGV2X3ByaXYpID49IDEwKQorCQlkcm1fcGxhbmVfY3JlYXRlX3NjYWxpbmdfZmlsdGVy
X3Byb3BlcnR5KCZwbGFuZS0+YmFzZSwKKwkJCQkJCUJJVChEUk1fU0NBTElOR19GSUxURVJfREVG
QVVMVCkgfAorCQkJCQkJQklUKERSTV9TQ0FMSU5HX0ZJTFRFUl9ORUFSRVNUX05FSUdIQk9SKSk7
CisKKwlkcm1fcGxhbmVfaGVscGVyX2FkZCgmcGxhbmUtPmJhc2UsICZpbnRlbF9wbGFuZV9oZWxw
ZXJfZnVuY3MpOworCisJcmV0dXJuIHBsYW5lOworCitmYWlsOgorCWludGVsX3BsYW5lX2ZyZWUo
cGxhbmUpOworCisJcmV0dXJuIEVSUl9QVFIocmV0KTsKK30KKwordm9pZAorc2tsX2dldF9pbml0
aWFsX3BsYW5lX2NvbmZpZyhzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YywKKwkJCSAgICAgc3RydWN0
IGludGVsX2luaXRpYWxfcGxhbmVfY29uZmlnICpwbGFuZV9jb25maWcpCit7CisJc3RydWN0IGlu
dGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUgPSB0b19pbnRlbF9jcnRjX3N0YXRlKGNydGMtPmJh
c2Uuc3RhdGUpOworCXN0cnVjdCBkcm1fZGV2aWNlICpkZXYgPSBjcnRjLT5iYXNlLmRldjsKKwlz
dHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGRldik7CisJc3RydWN0
IGludGVsX3BsYW5lICpwbGFuZSA9IHRvX2ludGVsX3BsYW5lKGNydGMtPmJhc2UucHJpbWFyeSk7
CisJZW51bSBwbGFuZV9pZCBwbGFuZV9pZCA9IHBsYW5lLT5pZDsKKwllbnVtIHBpcGUgcGlwZTsK
Kwl1MzIgdmFsLCBiYXNlLCBvZmZzZXQsIHN0cmlkZV9tdWx0LCB0aWxpbmcsIGFscGhhOworCWlu
dCBmb3VyY2MsIHBpeGVsX2Zvcm1hdDsKKwl1bnNpZ25lZCBpbnQgYWxpZ25lZF9oZWlnaHQ7CisJ
c3RydWN0IGRybV9mcmFtZWJ1ZmZlciAqZmI7CisJc3RydWN0IGludGVsX2ZyYW1lYnVmZmVyICpp
bnRlbF9mYjsKKworCWlmICghcGxhbmUtPmdldF9od19zdGF0ZShwbGFuZSwgJnBpcGUpKQorCQly
ZXR1cm47CisKKwlkcm1fV0FSTl9PTihkZXYsIHBpcGUgIT0gY3J0Yy0+cGlwZSk7CisKKwlpZiAo
Y3J0Y19zdGF0ZS0+Ymlnam9pbmVyKSB7CisJCWRybV9kYmdfa21zKCZkZXZfcHJpdi0+ZHJtLAor
CQkJICAgICJVbnN1cHBvcnRlZCBiaWdqb2luZXIgY29uZmlndXJhdGlvbiBmb3IgaW5pdGlhbCBG
QlxuIik7CisJCXJldHVybjsKKwl9CisKKwlpbnRlbF9mYiA9IGt6YWxsb2Moc2l6ZW9mKCppbnRl
bF9mYiksIEdGUF9LRVJORUwpOworCWlmICghaW50ZWxfZmIpIHsKKwkJZHJtX2RiZ19rbXMoJmRl
dl9wcml2LT5kcm0sICJmYWlsZWQgdG8gYWxsb2MgZmJcbiIpOworCQlyZXR1cm47CisJfQorCisJ
ZmIgPSAmaW50ZWxfZmItPmJhc2U7CisKKwlmYi0+ZGV2ID0gZGV2OworCisJdmFsID0gaW50ZWxf
ZGVfcmVhZChkZXZfcHJpdiwgUExBTkVfQ1RMKHBpcGUsIHBsYW5lX2lkKSk7CisKKwlpZiAoSU5U
RUxfR0VOKGRldl9wcml2KSA+PSAxMSkKKwkJcGl4ZWxfZm9ybWF0ID0gdmFsICYgSUNMX1BMQU5F
X0NUTF9GT1JNQVRfTUFTSzsKKwllbHNlCisJCXBpeGVsX2Zvcm1hdCA9IHZhbCAmIFBMQU5FX0NU
TF9GT1JNQVRfTUFTSzsKKworCWlmIChJTlRFTF9HRU4oZGV2X3ByaXYpID49IDEwIHx8IElTX0dF
TUlOSUxBS0UoZGV2X3ByaXYpKSB7CisJCWFscGhhID0gaW50ZWxfZGVfcmVhZChkZXZfcHJpdiwK
KwkJCQkgICAgICBQTEFORV9DT0xPUl9DVEwocGlwZSwgcGxhbmVfaWQpKTsKKwkJYWxwaGEgJj0g
UExBTkVfQ09MT1JfQUxQSEFfTUFTSzsKKwl9IGVsc2UgeworCQlhbHBoYSA9IHZhbCAmIFBMQU5F
X0NUTF9BTFBIQV9NQVNLOworCX0KKworCWZvdXJjYyA9IHNrbF9mb3JtYXRfdG9fZm91cmNjKHBp
eGVsX2Zvcm1hdCwKKwkJCQkgICAgICB2YWwgJiBQTEFORV9DVExfT1JERVJfUkdCWCwgYWxwaGEp
OworCWZiLT5mb3JtYXQgPSBkcm1fZm9ybWF0X2luZm8oZm91cmNjKTsKKworCXRpbGluZyA9IHZh
bCAmIFBMQU5FX0NUTF9USUxFRF9NQVNLOworCXN3aXRjaCAodGlsaW5nKSB7CisJY2FzZSBQTEFO
RV9DVExfVElMRURfTElORUFSOgorCQlmYi0+bW9kaWZpZXIgPSBEUk1fRk9STUFUX01PRF9MSU5F
QVI7CisJCWJyZWFrOworCWNhc2UgUExBTkVfQ1RMX1RJTEVEX1g6CisJCXBsYW5lX2NvbmZpZy0+
dGlsaW5nID0gSTkxNV9USUxJTkdfWDsKKwkJZmItPm1vZGlmaWVyID0gSTkxNV9GT1JNQVRfTU9E
X1hfVElMRUQ7CisJCWJyZWFrOworCWNhc2UgUExBTkVfQ1RMX1RJTEVEX1k6CisJCXBsYW5lX2Nv
bmZpZy0+dGlsaW5nID0gSTkxNV9USUxJTkdfWTsKKwkJaWYgKHZhbCAmIFBMQU5FX0NUTF9SRU5E
RVJfREVDT01QUkVTU0lPTl9FTkFCTEUpCisJCQlmYi0+bW9kaWZpZXIgPSBJTlRFTF9HRU4oZGV2
X3ByaXYpID49IDEyID8KKwkJCQlJOTE1X0ZPUk1BVF9NT0RfWV9USUxFRF9HRU4xMl9SQ19DQ1Mg
OgorCQkJCUk5MTVfRk9STUFUX01PRF9ZX1RJTEVEX0NDUzsKKwkJZWxzZSBpZiAodmFsICYgUExB
TkVfQ1RMX01FRElBX0RFQ09NUFJFU1NJT05fRU5BQkxFKQorCQkJZmItPm1vZGlmaWVyID0gSTkx
NV9GT1JNQVRfTU9EX1lfVElMRURfR0VOMTJfTUNfQ0NTOworCQllbHNlCisJCQlmYi0+bW9kaWZp
ZXIgPSBJOTE1X0ZPUk1BVF9NT0RfWV9USUxFRDsKKwkJYnJlYWs7CisJY2FzZSBQTEFORV9DVExf
VElMRURfWUY6CisJCWlmICh2YWwgJiBQTEFORV9DVExfUkVOREVSX0RFQ09NUFJFU1NJT05fRU5B
QkxFKQorCQkJZmItPm1vZGlmaWVyID0gSTkxNV9GT1JNQVRfTU9EX1lmX1RJTEVEX0NDUzsKKwkJ
ZWxzZQorCQkJZmItPm1vZGlmaWVyID0gSTkxNV9GT1JNQVRfTU9EX1lmX1RJTEVEOworCQlicmVh
azsKKwlkZWZhdWx0OgorCQlNSVNTSU5HX0NBU0UodGlsaW5nKTsKKwkJZ290byBlcnJvcjsKKwl9
CisKKwkvKgorCSAqIERSTV9NT0RFX1JPVEFURV8gaXMgY291bnRlciBjbG9ja3dpc2UgdG8gc3Rh
eSBjb21wYXRpYmxlIHdpdGggWHJhbmRyCisJICogd2hpbGUgaTkxNSBIVyByb3RhdGlvbiBpcyBj
bG9ja3dpc2UsIHRoYXRzIHdoeSB0aGlzIHN3YXBwaW5nLgorCSAqLworCXN3aXRjaCAodmFsICYg
UExBTkVfQ1RMX1JPVEFURV9NQVNLKSB7CisJY2FzZSBQTEFORV9DVExfUk9UQVRFXzA6CisJCXBs
YW5lX2NvbmZpZy0+cm90YXRpb24gPSBEUk1fTU9ERV9ST1RBVEVfMDsKKwkJYnJlYWs7CisJY2Fz
ZSBQTEFORV9DVExfUk9UQVRFXzkwOgorCQlwbGFuZV9jb25maWctPnJvdGF0aW9uID0gRFJNX01P
REVfUk9UQVRFXzI3MDsKKwkJYnJlYWs7CisJY2FzZSBQTEFORV9DVExfUk9UQVRFXzE4MDoKKwkJ
cGxhbmVfY29uZmlnLT5yb3RhdGlvbiA9IERSTV9NT0RFX1JPVEFURV8xODA7CisJCWJyZWFrOwor
CWNhc2UgUExBTkVfQ1RMX1JPVEFURV8yNzA6CisJCXBsYW5lX2NvbmZpZy0+cm90YXRpb24gPSBE
Uk1fTU9ERV9ST1RBVEVfOTA7CisJCWJyZWFrOworCX0KKworCWlmIChJTlRFTF9HRU4oZGV2X3By
aXYpID49IDEwICYmCisJICAgIHZhbCAmIFBMQU5FX0NUTF9GTElQX0hPUklaT05UQUwpCisJCXBs
YW5lX2NvbmZpZy0+cm90YXRpb24gfD0gRFJNX01PREVfUkVGTEVDVF9YOworCisJLyogOTAvMjcw
IGRlZ3JlZSByb3RhdGlvbiB3b3VsZCByZXF1aXJlIGV4dHJhIHdvcmsgKi8KKwlpZiAoZHJtX3Jv
dGF0aW9uXzkwX29yXzI3MChwbGFuZV9jb25maWctPnJvdGF0aW9uKSkKKwkJZ290byBlcnJvcjsK
KworCWJhc2UgPSBpbnRlbF9kZV9yZWFkKGRldl9wcml2LCBQTEFORV9TVVJGKHBpcGUsIHBsYW5l
X2lkKSkgJiAweGZmZmZmMDAwOworCXBsYW5lX2NvbmZpZy0+YmFzZSA9IGJhc2U7CisKKwlvZmZz
ZXQgPSBpbnRlbF9kZV9yZWFkKGRldl9wcml2LCBQTEFORV9PRkZTRVQocGlwZSwgcGxhbmVfaWQp
KTsKKworCXZhbCA9IGludGVsX2RlX3JlYWQoZGV2X3ByaXYsIFBMQU5FX1NJWkUocGlwZSwgcGxh
bmVfaWQpKTsKKwlmYi0+aGVpZ2h0ID0gKCh2YWwgPj4gMTYpICYgMHhmZmZmKSArIDE7CisJZmIt
PndpZHRoID0gKCh2YWwgPj4gMCkgJiAweGZmZmYpICsgMTsKKworCXZhbCA9IGludGVsX2RlX3Jl
YWQoZGV2X3ByaXYsIFBMQU5FX1NUUklERShwaXBlLCBwbGFuZV9pZCkpOworCXN0cmlkZV9tdWx0
ID0gc2tsX3BsYW5lX3N0cmlkZV9tdWx0KGZiLCAwLCBEUk1fTU9ERV9ST1RBVEVfMCk7CisJZmIt
PnBpdGNoZXNbMF0gPSAodmFsICYgMHgzZmYpICogc3RyaWRlX211bHQ7CisKKwlhbGlnbmVkX2hl
aWdodCA9IGludGVsX2ZiX2FsaWduX2hlaWdodChmYiwgMCwgZmItPmhlaWdodCk7CisKKwlwbGFu
ZV9jb25maWctPnNpemUgPSBmYi0+cGl0Y2hlc1swXSAqIGFsaWduZWRfaGVpZ2h0OworCisJZHJt
X2RiZ19rbXMoJmRldl9wcml2LT5kcm0sCisJCSAgICAiJXMvJXMgd2l0aCBmYjogc2l6ZT0lZHgl
ZEAlZCwgb2Zmc2V0PSV4LCBwaXRjaCAlZCwgc2l6ZSAweCV4XG4iLAorCQkgICAgY3J0Yy0+YmFz
ZS5uYW1lLCBwbGFuZS0+YmFzZS5uYW1lLCBmYi0+d2lkdGgsIGZiLT5oZWlnaHQsCisJCSAgICBm
Yi0+Zm9ybWF0LT5jcHBbMF0gKiA4LCBiYXNlLCBmYi0+cGl0Y2hlc1swXSwKKwkJICAgIHBsYW5l
X2NvbmZpZy0+c2l6ZSk7CisKKwlwbGFuZV9jb25maWctPmZiID0gaW50ZWxfZmI7CisJcmV0dXJu
OworCitlcnJvcjoKKwlrZnJlZShpbnRlbF9mYik7Cit9CisKZGlmZiAtLWdpdCBhL2RyaXZlcnMv
Z3B1L2RybS9pOTE1L2Rpc3BsYXkvc2tsX3VuaXZlcnNhbF9wbGFuZS5oIGIvZHJpdmVycy9ncHUv
ZHJtL2k5MTUvZGlzcGxheS9za2xfdW5pdmVyc2FsX3BsYW5lLmgKbmV3IGZpbGUgbW9kZSAxMDA2
NDQKaW5kZXggMDAwMDAwMDAwMDAwLi43MGViNTAxMGNkMjgKLS0tIC9kZXYvbnVsbAorKysgYi9k
cml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L3NrbF91bml2ZXJzYWxfcGxhbmUuaApAQCAtMCww
ICsxLDMzIEBACisvKiBTUERYLUxpY2Vuc2UtSWRlbnRpZmllcjogTUlUICovCisvKgorICogQ29w
eXJpZ2h0IMKpIDIwMjAgSW50ZWwgQ29ycG9yYXRpb24KKyAqLworCisjaWZuZGVmIF9TS0xfVU5J
VkVSU0FMX1BMQU5FX0hfCisjZGVmaW5lIF9TS0xfVU5JVkVSU0FMX1BMQU5FX0hfCisKKyNpbmNs
dWRlIDxsaW51eC90eXBlcy5oPgorCitzdHJ1Y3QgZHJtX2ZyYW1lYnVmZmVyOworc3RydWN0IGRy
bV9pOTE1X3ByaXZhdGU7CitzdHJ1Y3QgaW50ZWxfY3J0YzsKK3N0cnVjdCBpbnRlbF9pbml0aWFs
X3BsYW5lX2NvbmZpZzsKK3N0cnVjdCBpbnRlbF9wbGFuZV9zdGF0ZTsKKworZW51bSBwaXBlOwor
ZW51bSBwbGFuZV9pZDsKKworc3RydWN0IGludGVsX3BsYW5lICoKK3NrbF91bml2ZXJzYWxfcGxh
bmVfY3JlYXRlKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKKwkJCSAgIGVudW0g
cGlwZSBwaXBlLCBlbnVtIHBsYW5lX2lkIHBsYW5lX2lkKTsKKwordm9pZCBza2xfZ2V0X2luaXRp
YWxfcGxhbmVfY29uZmlnKHN0cnVjdCBpbnRlbF9jcnRjICpjcnRjLAorCQkJCSAgc3RydWN0IGlu
dGVsX2luaXRpYWxfcGxhbmVfY29uZmlnICpwbGFuZV9jb25maWcpOworCitpbnQgc2tsX2Zvcm1h
dF90b19mb3VyY2MoaW50IGZvcm1hdCwgYm9vbCByZ2Jfb3JkZXIsIGJvb2wgYWxwaGEpOworCitp
bnQgc2tsX2Njc190b19tYWluX3BsYW5lKGNvbnN0IHN0cnVjdCBkcm1fZnJhbWVidWZmZXIgKmZi
LCBpbnQgY2NzX3BsYW5lKTsKK2ludCBza2xfY2FsY19tYWluX3N1cmZhY2Vfb2Zmc2V0KGNvbnN0
IHN0cnVjdCBpbnRlbF9wbGFuZV9zdGF0ZSAqcGxhbmVfc3RhdGUsCisJCQkJIGludCAqeCwgaW50
ICp5LCB1MzIgKm9mZnNldCk7CisKKyNlbmRpZgpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJt
L2k5MTUvaW50ZWxfcG0uYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2ludGVsX3BtLmMKaW5kZXgg
YzU4ZTUwNzc1OTBkLi44YzQyZmE1MWMwZjYgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9p
OTE1L2ludGVsX3BtLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50ZWxfcG0uYwpAQCAt
MzgsNiArMzgsNyBAQAogI2luY2x1ZGUgImRpc3BsYXkvaW50ZWxfZGlzcGxheV90eXBlcy5oIgog
I2luY2x1ZGUgImRpc3BsYXkvaW50ZWxfZmJjLmgiCiAjaW5jbHVkZSAiZGlzcGxheS9pbnRlbF9z
cHJpdGUuaCIKKyNpbmNsdWRlICJkaXNwbGF5L3NrbF91bml2ZXJzYWxfcGxhbmUuaCIKIAogI2lu
Y2x1ZGUgImd0L2ludGVsX2xsYy5oIgogCi0tIAoyLjIwLjEKCl9fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fCkludGVsLWdmeCBtYWlsaW5nIGxpc3QKSW50ZWwt
Z2Z4QGxpc3RzLmZyZWVkZXNrdG9wLm9yZwpodHRwczovL2xpc3RzLmZyZWVkZXNrdG9wLm9yZy9t
YWlsbWFuL2xpc3RpbmZvL2ludGVsLWdmeAo=

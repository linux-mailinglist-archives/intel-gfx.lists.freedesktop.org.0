Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 288AF98B48
	for <lists+intel-gfx@lfdr.de>; Thu, 22 Aug 2019 08:16:21 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 2EDC56E420;
	Thu, 22 Aug 2019 06:16:19 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from fireflyinternet.com (mail.fireflyinternet.com [109.228.58.192])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 1B63A6E420
 for <intel-gfx@lists.freedesktop.org>; Thu, 22 Aug 2019 06:16:17 +0000 (UTC)
X-Default-Received-SPF: pass (skip=forwardok (res=PASS))
 x-ip-name=78.156.65.138; 
Received: from haswell.alporthouse.com (unverified [78.156.65.138]) 
 by fireflyinternet.com (Firefly Internet (M1)) with ESMTP id 18221705-1500050 
 for multiple; Thu, 22 Aug 2019 07:16:00 +0100
From: Chris Wilson <chris@chris-wilson.co.uk>
To: intel-gfx@lists.freedesktop.org
Date: Thu, 22 Aug 2019 07:15:57 +0100
Message-Id: <20190822061557.18402-1-chris@chris-wilson.co.uk>
X-Mailer: git-send-email 2.23.0
In-Reply-To: <20190822060914.2671-3-chris@chris-wilson.co.uk>
References: <20190822060914.2671-3-chris@chris-wilson.co.uk>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH] drm/i915: Replace i915_vma_put_fence()
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Cc: Matthew Auld <matthew.auld@intel.com>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

QXZvaWQgY2FsbGluZyBpOTE1X3ZtYV9wdXRfZmVuY2UoKSBieSB1c2luZyBvdXIgYWx0ZXJuYXRl
IHBhdGhzIHRoYXQKYmluZCBhIHNlY29uZGFyeSB2bWEgYXZvaWRpbmcgdGhlIG9yaWdpbmFsIGZl
bmNlZCB2bWEuIEZvciB0aGUgZmV3Cmluc3RhbmNlcyB3aGVyZSB3ZSBuZWVkIHRvIHJlbGVhc2Ug
dGhlIGZlbmNlIChpLmUuIG9uIGJpbmRpbmcgd2hlbiB0aGUKR0dUVCByYW5nZSBiZWNvbWVzIGlu
dmFsaWQpLCByZXBsYWNlIHRoZSBwdXRfZmVuY2Ugd2l0aCBhIHJldm9rZV9mZW5jZS4KClNpZ25l
ZC1vZmYtYnk6IENocmlzIFdpbHNvbiA8Y2hyaXNAY2hyaXMtd2lsc29uLmNvLnVrPgpSZXZpZXdl
ZC1ieTogTWF0dGhldyBBdWxkIDxtYXR0aGV3LmF1bGRAaW50ZWwuY29tPgotLS0KIGRyaXZlcnMv
Z3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfb3ZlcmxheS5jICB8ICA0IC0tLQogZHJpdmVycy9n
cHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX2RvbWFpbi5jICAgIHwgMzUgKysrKysrKysrKysrKy0t
LS0tCiAuLi4vZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9leGVjYnVmZmVyLmMgICAgfCAgOSAr
Ky0tLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9nZW0uYyAgICAgICAgICAgICAgIHwgMzYg
KysrKysrKystLS0tLS0tLS0tLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9nZW1fZmVuY2Vf
cmVnLmMgICAgIHwgMTYgKysrLS0tLS0tCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3ZtYS5j
ICAgICAgICAgICAgICAgfCAgNCArKy0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfdm1hLmgg
ICAgICAgICAgICAgICB8ICA0ICstLQogNyBmaWxlcyBjaGFuZ2VkLCA1MyBpbnNlcnRpb25zKCsp
LCA1NSBkZWxldGlvbnMoLSkKCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNw
bGF5L2ludGVsX292ZXJsYXkuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxf
b3ZlcmxheS5jCmluZGV4IGVjYTQxYzRhNWFhNi4uMjllZGZjMzQzNzE2IDEwMDY0NAotLS0gYS9k
cml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX292ZXJsYXkuYworKysgYi9kcml2ZXJz
L2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX292ZXJsYXkuYwpAQCAtNzcwLDEwICs3NzAsNiBA
QCBzdGF0aWMgaW50IGludGVsX292ZXJsYXlfZG9fcHV0X2ltYWdlKHN0cnVjdCBpbnRlbF9vdmVy
bGF5ICpvdmVybGF5LAogCX0KIAlpbnRlbF9mcm9udGJ1ZmZlcl9mbHVzaChuZXdfYm8tPmZyb250
YnVmZmVyLCBPUklHSU5fRElSVFlGQik7CiAKLQlyZXQgPSBpOTE1X3ZtYV9wdXRfZmVuY2Uodm1h
KTsKLQlpZiAocmV0KQotCQlnb3RvIG91dF91bnBpbjsKLQogCWlmICghb3ZlcmxheS0+YWN0aXZl
KSB7CiAJCXUzMiBvY29uZmlnOwogCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9n
ZW0vaTkxNV9nZW1fZG9tYWluLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1f
ZG9tYWluLmMKaW5kZXggYTFhZmMyNjkwZTllLi45YzU4ZThmYWMxZDkgMTAwNjQ0Ci0tLSBhL2Ry
aXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9kb21haW4uYworKysgYi9kcml2ZXJzL2dw
dS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fZG9tYWluLmMKQEAgLTIyMSw2ICsyMjEsOCBAQCBpbnQg
aTkxNV9nZW1fb2JqZWN0X3NldF9jYWNoZV9sZXZlbChzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVj
dCAqb2JqLAogCSAqIHN0YXRlIGFuZCBzbyBpbnZvbHZlcyBsZXNzIHdvcmsuCiAJICovCiAJaWYg
KGF0b21pY19yZWFkKCZvYmotPmJpbmRfY291bnQpKSB7CisJCXN0cnVjdCBkcm1faTkxNV9wcml2
YXRlICppOTE1ID0gdG9faTkxNShvYmotPmJhc2UuZGV2KTsKKwogCQkvKiBCZWZvcmUgd2UgY2hh
bmdlIHRoZSBQVEUsIHRoZSBHUFUgbXVzdCBub3QgYmUgYWNjZXNzaW5nIGl0LgogCQkgKiBJZiB3
ZSB3YWl0IHVwb24gdGhlIG9iamVjdCwgd2Uga25vdyB0aGF0IGFsbCB0aGUgYm91bmQKIAkJICog
Vk1BIGFyZSBubyBsb25nZXIgYWN0aXZlLgpAQCAtMjMyLDE4ICsyMzQsMzAgQEAgaW50IGk5MTVf
Z2VtX29iamVjdF9zZXRfY2FjaGVfbGV2ZWwoc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9i
aiwKIAkJaWYgKHJldCkKIAkJCXJldHVybiByZXQ7CiAKLQkJaWYgKCFIQVNfTExDKHRvX2k5MTUo
b2JqLT5iYXNlLmRldikpICYmCi0JCSAgICBjYWNoZV9sZXZlbCAhPSBJOTE1X0NBQ0hFX05PTkUp
IHsKLQkJCS8qIEFjY2VzcyB0byBzbm9vcGFibGUgcGFnZXMgdGhyb3VnaCB0aGUgR1RUIGlzCisJ
CWlmICghSEFTX0xMQyhpOTE1KSAmJiBjYWNoZV9sZXZlbCAhPSBJOTE1X0NBQ0hFX05PTkUpIHsK
KwkJCWludGVsX3dha2VyZWZfdCB3YWtlcmVmID0KKwkJCQlpbnRlbF9ydW50aW1lX3BtX2dldCgm
aTkxNS0+cnVudGltZV9wbSk7CisKKwkJCS8qCisJCQkgKiBBY2Nlc3MgdG8gc25vb3BhYmxlIHBh
Z2VzIHRocm91Z2ggdGhlIEdUVCBpcwogCQkJICogaW5jb2hlcmVudCBhbmQgb24gc29tZSBtYWNo
aW5lcyBjYXVzZXMgYSBoYXJkCiAJCQkgKiBsb2NrdXAuIFJlbGlucXVpc2ggdGhlIENQVSBtbWFw
aW5nIHRvIGZvcmNlCiAJCQkgKiB1c2Vyc3BhY2UgdG8gcmVmYXVsdCBpbiB0aGUgcGFnZXMgYW5k
IHdlIGNhbgogCQkJICogdGhlbiBkb3VibGUgY2hlY2sgaWYgdGhlIEdUVCBtYXBwaW5nIGlzIHN0
aWxsCiAJCQkgKiB2YWxpZCBmb3IgdGhhdCBwb2ludGVyIGFjY2Vzcy4KIAkJCSAqLwotCQkJaTkx
NV9nZW1fb2JqZWN0X3JlbGVhc2VfbW1hcChvYmopOworCQkJcmV0ID0gbXV0ZXhfbG9ja19pbnRl
cnJ1cHRpYmxlKCZpOTE1LT5nZ3R0LnZtLm11dGV4KTsKKwkJCWlmIChyZXQpIHsKKwkJCQlpbnRl
bF9ydW50aW1lX3BtX3B1dCgmaTkxNS0+cnVudGltZV9wbSwKKwkJCQkJCSAgICAgd2FrZXJlZik7
CisJCQkJcmV0dXJuIHJldDsKKwkJCX0KIAotCQkJLyogQXMgd2Ugbm8gbG9uZ2VyIG5lZWQgYSBm
ZW5jZSBmb3IgR1RUIGFjY2VzcywKKwkJCWlmIChvYmotPnVzZXJmYXVsdF9jb3VudCkKKwkJCQlf
X2k5MTVfZ2VtX29iamVjdF9yZWxlYXNlX21tYXAob2JqKTsKKworCQkJLyoKKwkJCSAqIEFzIHdl
IG5vIGxvbmdlciBuZWVkIGEgZmVuY2UgZm9yIEdUVCBhY2Nlc3MsCiAJCQkgKiB3ZSBjYW4gcmVs
aW5xdWlzaCBpdCBub3cgKGFuZCBzbyBwcmV2ZW50IGhhdmluZwogCQkJICogdG8gc3RlYWwgYSBm
ZW5jZSBmcm9tIHNvbWVvbmUgZWxzZSBvbiB0aGUgbmV4dAogCQkJICogZmVuY2UgcmVxdWVzdCku
IE5vdGUgR1BVIGFjdGl2aXR5IHdvdWxkIGhhdmUKQEAgLTI1MSwxMiArMjY1LDE3IEBAIGludCBp
OTE1X2dlbV9vYmplY3Rfc2V0X2NhY2hlX2xldmVsKHN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0
ICpvYmosCiAJCQkgKiBzdXBwb3NlZCB0byBiZSBsaW5lYXIuCiAJCQkgKi8KIAkJCWZvcl9lYWNo
X2dndHRfdm1hKHZtYSwgb2JqKSB7Ci0JCQkJcmV0ID0gaTkxNV92bWFfcHV0X2ZlbmNlKHZtYSk7
CisJCQkJcmV0ID0gaTkxNV92bWFfcmV2b2tlX2ZlbmNlKHZtYSk7CiAJCQkJaWYgKHJldCkKLQkJ
CQkJcmV0dXJuIHJldDsKKwkJCQkJYnJlYWs7CiAJCQl9CisJCQltdXRleF91bmxvY2soJmk5MTUt
PmdndHQudm0ubXV0ZXgpOworCQkJaW50ZWxfcnVudGltZV9wbV9wdXQoJmk5MTUtPnJ1bnRpbWVf
cG0sIHdha2VyZWYpOworCQkJaWYgKHJldCkKKwkJCQlyZXR1cm4gcmV0OwogCQl9IGVsc2Ugewot
CQkJLyogV2UgZWl0aGVyIGhhdmUgaW5jb2hlcmVudCBiYWNraW5nIHN0b3JlIGFuZAorCQkJLyoK
KwkJCSAqIFdlIGVpdGhlciBoYXZlIGluY29oZXJlbnQgYmFja2luZyBzdG9yZSBhbmQKIAkJCSAq
IHNvIG5vIEdUVCBhY2Nlc3Mgb3IgdGhlIGFyY2hpdGVjdHVyZSBpcyBmdWxseQogCQkJICogY29o
ZXJlbnQuIEluIHN1Y2ggY2FzZXMsIGV4aXN0aW5nIEdUVCBtbWFwcwogCQkJICogaWdub3JlIHRo
ZSBjYWNoZSBiaXQgaW4gdGhlIFBURSBhbmQgd2UgY2FuCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dw
dS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fZXhlY2J1ZmZlci5jIGIvZHJpdmVycy9ncHUvZHJtL2k5
MTUvZ2VtL2k5MTVfZ2VtX2V4ZWNidWZmZXIuYwppbmRleCAyZGNhMjk2MmM3M2EuLmI1ZjY5Mzcz
NjllYSAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX2V4ZWNi
dWZmZXIuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fZXhlY2J1ZmZl
ci5jCkBAIC0xMDI0LDYgKzEwMjQsOSBAQCBzdGF0aWMgdm9pZCAqcmVsb2NfaW9tYXAoc3RydWN0
IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iaiwKIAkJc3RydWN0IGk5MTVfdm1hICp2bWE7CiAJCWlu
dCBlcnI7CiAKKwkJaWYgKGk5MTVfZ2VtX29iamVjdF9pc190aWxlZChvYmopKQorCQkJcmV0dXJu
IEVSUl9QVFIoLUVJTlZBTCk7CisKIAkJaWYgKHVzZV9jcHVfcmVsb2MoY2FjaGUsIG9iaikpCiAJ
CQlyZXR1cm4gTlVMTDsKIApAQCAtMTA0NywxMiArMTA1MCw2IEBAIHN0YXRpYyB2b2lkICpyZWxv
Y19pb21hcChzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2JqLAogCQkJaWYgKGVycikgLyog
bm8gaW5hY3RpdmUgYXBlcnR1cmUgc3BhY2UsIHVzZSBjcHUgcmVsb2MgKi8KIAkJCQlyZXR1cm4g
TlVMTDsKIAkJfSBlbHNlIHsKLQkJCWVyciA9IGk5MTVfdm1hX3B1dF9mZW5jZSh2bWEpOwotCQkJ
aWYgKGVycikgewotCQkJCWk5MTVfdm1hX3VucGluKHZtYSk7Ci0JCQkJcmV0dXJuIEVSUl9QVFIo
ZXJyKTsKLQkJCX0KLQogCQkJY2FjaGUtPm5vZGUuc3RhcnQgPSB2bWEtPm5vZGUuc3RhcnQ7CiAJ
CQljYWNoZS0+bm9kZS5tbSA9ICh2b2lkICopdm1hOwogCQl9CmRpZmYgLS1naXQgYS9kcml2ZXJz
L2dwdS9kcm0vaTkxNS9pOTE1X2dlbS5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9nZW0u
YwppbmRleCA2ODk3NjY4OWQ1NjkuLmViMzFiNjlhMzE2YSAxMDA2NDQKLS0tIGEvZHJpdmVycy9n
cHUvZHJtL2k5MTUvaTkxNV9nZW0uYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2dl
bS5jCkBAIC0zNDMsMjAgKzM0MywxNiBAQCBpOTE1X2dlbV9ndHRfcHJlYWQoc3RydWN0IGRybV9p
OTE1X2dlbV9vYmplY3QgKm9iaiwKIAkJcmV0dXJuIHJldDsKIAogCXdha2VyZWYgPSBpbnRlbF9y
dW50aW1lX3BtX2dldCgmaTkxNS0+cnVudGltZV9wbSk7Ci0Jdm1hID0gaTkxNV9nZW1fb2JqZWN0
X2dndHRfcGluKG9iaiwgTlVMTCwgMCwgMCwKLQkJCQkgICAgICAgUElOX01BUFBBQkxFIHwKLQkJ
CQkgICAgICAgUElOX05PTkJMT0NLIC8qIE5PV0FSTiAqLyB8Ci0JCQkJICAgICAgIFBJTl9OT0VW
SUNUKTsKKwl2bWEgPSBFUlJfUFRSKC1FTk9ERVYpOworCWlmICghaTkxNV9nZW1fb2JqZWN0X2lz
X3RpbGVkKG9iaikpCisJCXZtYSA9IGk5MTVfZ2VtX29iamVjdF9nZ3R0X3BpbihvYmosIE5VTEws
IDAsIDAsCisJCQkJCSAgICAgICBQSU5fTUFQUEFCTEUgfAorCQkJCQkgICAgICAgUElOX05PTkJM
T0NLIC8qIE5PV0FSTiAqLyB8CisJCQkJCSAgICAgICBQSU5fTk9FVklDVCk7CiAJaWYgKCFJU19F
UlIodm1hKSkgewogCQlub2RlLnN0YXJ0ID0gaTkxNV9nZ3R0X29mZnNldCh2bWEpOwogCQlub2Rl
LmFsbG9jYXRlZCA9IGZhbHNlOwotCQlyZXQgPSBpOTE1X3ZtYV9wdXRfZmVuY2Uodm1hKTsKLQkJ
aWYgKHJldCkgewotCQkJaTkxNV92bWFfdW5waW4odm1hKTsKLQkJCXZtYSA9IEVSUl9QVFIocmV0
KTsKLQkJfQotCX0KLQlpZiAoSVNfRVJSKHZtYSkpIHsKKwl9IGVsc2UgewogCQlyZXQgPSBpbnNl
cnRfbWFwcGFibGVfbm9kZShnZ3R0LCAmbm9kZSwgUEFHRV9TSVpFKTsKIAkJaWYgKHJldCkKIAkJ
CWdvdG8gb3V0X3VubG9jazsKQEAgLTU1NywyMCArNTUzLDE2IEBAIGk5MTVfZ2VtX2d0dF9wd3Jp
dGVfZmFzdChzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2JqLAogCQl3YWtlcmVmID0gaW50
ZWxfcnVudGltZV9wbV9nZXQocnBtKTsKIAl9CiAKLQl2bWEgPSBpOTE1X2dlbV9vYmplY3RfZ2d0
dF9waW4ob2JqLCBOVUxMLCAwLCAwLAotCQkJCSAgICAgICBQSU5fTUFQUEFCTEUgfAotCQkJCSAg
ICAgICBQSU5fTk9OQkxPQ0sgLyogTk9XQVJOICovIHwKLQkJCQkgICAgICAgUElOX05PRVZJQ1Qp
OworCXZtYSA9IEVSUl9QVFIoLUVOT0RFVik7CisJaWYgKCFpOTE1X2dlbV9vYmplY3RfaXNfdGls
ZWQob2JqKSkKKwkJdm1hID0gaTkxNV9nZW1fb2JqZWN0X2dndHRfcGluKG9iaiwgTlVMTCwgMCwg
MCwKKwkJCQkJICAgICAgIFBJTl9NQVBQQUJMRSB8CisJCQkJCSAgICAgICBQSU5fTk9OQkxPQ0sg
LyogTk9XQVJOICovIHwKKwkJCQkJICAgICAgIFBJTl9OT0VWSUNUKTsKIAlpZiAoIUlTX0VSUih2
bWEpKSB7CiAJCW5vZGUuc3RhcnQgPSBpOTE1X2dndHRfb2Zmc2V0KHZtYSk7CiAJCW5vZGUuYWxs
b2NhdGVkID0gZmFsc2U7Ci0JCXJldCA9IGk5MTVfdm1hX3B1dF9mZW5jZSh2bWEpOwotCQlpZiAo
cmV0KSB7Ci0JCQlpOTE1X3ZtYV91bnBpbih2bWEpOwotCQkJdm1hID0gRVJSX1BUUihyZXQpOwot
CQl9Ci0JfQotCWlmIChJU19FUlIodm1hKSkgeworCX0gZWxzZSB7CiAJCXJldCA9IGluc2VydF9t
YXBwYWJsZV9ub2RlKGdndHQsICZub2RlLCBQQUdFX1NJWkUpOwogCQlpZiAocmV0KQogCQkJZ290
byBvdXRfcnBtOwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9nZW1fZmVu
Y2VfcmVnLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2dlbV9mZW5jZV9yZWcuYwppbmRl
eCA2YTMzYTBiYjk3YTkuLjYxNWE5ZjRlZjMwYyAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJt
L2k5MTUvaTkxNV9nZW1fZmVuY2VfcmVnLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkx
NV9nZW1fZmVuY2VfcmVnLmMKQEAgLTI4Nyw3ICsyODcsNyBAQCBzdGF0aWMgaW50IGZlbmNlX3Vw
ZGF0ZShzdHJ1Y3QgaTkxNV9mZW5jZV9yZWcgKmZlbmNlLAogfQogCiAvKioKLSAqIGk5MTVfdm1h
X3B1dF9mZW5jZSAtIGZvcmNlLXJlbW92ZSBmZW5jZSBmb3IgYSBWTUEKKyAqIGk5MTVfdm1hX3Jl
dm9rZV9mZW5jZSAtIGZvcmNlLXJlbW92ZSBmZW5jZSBmb3IgYSBWTUEKICAqIEB2bWE6IHZtYSB0
byBtYXAgbGluZWFybHkgKG5vdCB0aHJvdWdoIGEgZmVuY2UgcmVnKQogICoKICAqIFRoaXMgZnVu
Y3Rpb24gZm9yY2UtcmVtb3ZlcyBhbnkgZmVuY2UgZnJvbSB0aGUgZ2l2ZW4gb2JqZWN0LCB3aGlj
aCBpcyB1c2VmdWwKQEAgLTI5NywyNiArMjk3LDE4IEBAIHN0YXRpYyBpbnQgZmVuY2VfdXBkYXRl
KHN0cnVjdCBpOTE1X2ZlbmNlX3JlZyAqZmVuY2UsCiAgKgogICogMCBvbiBzdWNjZXNzLCBuZWdh
dGl2ZSBlcnJvciBjb2RlIG9uIGZhaWx1cmUuCiAgKi8KLWludCBpOTE1X3ZtYV9wdXRfZmVuY2Uo
c3RydWN0IGk5MTVfdm1hICp2bWEpCitpbnQgaTkxNV92bWFfcmV2b2tlX2ZlbmNlKHN0cnVjdCBp
OTE1X3ZtYSAqdm1hKQogewotCXN0cnVjdCBpOTE1X2dndHQgKmdndHQgPSBpOTE1X3ZtX3RvX2dn
dHQodm1hLT52bSk7CiAJc3RydWN0IGk5MTVfZmVuY2VfcmVnICpmZW5jZSA9IHZtYS0+ZmVuY2U7
Ci0JaW50IGVycjsKIAorCWxvY2tkZXBfYXNzZXJ0X2hlbGQoJnZtYS0+dm0tPm11dGV4KTsKIAlp
ZiAoIWZlbmNlKQogCQlyZXR1cm4gMDsKIAogCWlmIChhdG9taWNfcmVhZCgmZmVuY2UtPnBpbl9j
b3VudCkpCiAJCXJldHVybiAtRUJVU1k7CiAKLQllcnIgPSBtdXRleF9sb2NrX2ludGVycnVwdGli
bGUoJmdndHQtPnZtLm11dGV4KTsKLQlpZiAoZXJyKQotCQlyZXR1cm4gZXJyOwotCi0JZXJyID0g
ZmVuY2VfdXBkYXRlKGZlbmNlLCBOVUxMKTsKLQltdXRleF91bmxvY2soJmdndHQtPnZtLm11dGV4
KTsKLQotCXJldHVybiBlcnI7CisJcmV0dXJuIGZlbmNlX3VwZGF0ZShmZW5jZSwgTlVMTCk7CiB9
CiAKIHN0YXRpYyBzdHJ1Y3QgaTkxNV9mZW5jZV9yZWcgKmZlbmNlX2ZpbmQoc3RydWN0IGRybV9p
OTE1X3ByaXZhdGUgKmk5MTUpCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1
X3ZtYS5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV92bWEuYwppbmRleCA5ODQwY2IyZjcw
YjkuLmUwZTY3N2IyYTNhOSAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV92
bWEuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3ZtYS5jCkBAIC05ODIsNyArOTgy
LDkgQEAgaW50IGk5MTVfdm1hX3VuYmluZChzdHJ1Y3QgaTkxNV92bWEgKnZtYSkKIAkJR0VNX0JV
R19PTihpOTE1X3ZtYV9oYXNfZ2d0dF93cml0ZSh2bWEpKTsKIAogCQkvKiByZWxlYXNlIHRoZSBm
ZW5jZSByZWcgX2FmdGVyXyBmbHVzaGluZyAqLwotCQlyZXQgPSBpOTE1X3ZtYV9wdXRfZmVuY2Uo
dm1hKTsKKwkJbXV0ZXhfbG9jaygmdm1hLT52bS0+bXV0ZXgpOworCQlyZXQgPSBpOTE1X3ZtYV9y
ZXZva2VfZmVuY2Uodm1hKTsKKwkJbXV0ZXhfdW5sb2NrKCZ2bWEtPnZtLT5tdXRleCk7CiAJCWlm
IChyZXQpCiAJCQlyZXR1cm4gcmV0OwogCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkx
NS9pOTE1X3ZtYS5oIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV92bWEuaAppbmRleCBjZjZj
MDQzNzA5MWQuLjg4OWZjN2NiOTEwYSAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUv
aTkxNV92bWEuaAorKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3ZtYS5oCkBAIC00MjEs
OCArNDIxLDggQEAgc3RhdGljIGlubGluZSBzdHJ1Y3QgcGFnZSAqaTkxNV92bWFfZmlyc3RfcGFn
ZShzdHJ1Y3QgaTkxNV92bWEgKnZtYSkKICAqCiAgKiBUcnVlIGlmIHRoZSB2bWEgaGFzIGEgZmVu
Y2UsIGZhbHNlIG90aGVyd2lzZS4KICAqLwotaW50IGk5MTVfdm1hX3Bpbl9mZW5jZShzdHJ1Y3Qg
aTkxNV92bWEgKnZtYSk7Ci1pbnQgX19tdXN0X2NoZWNrIGk5MTVfdm1hX3B1dF9mZW5jZShzdHJ1
Y3QgaTkxNV92bWEgKnZtYSk7CitpbnQgX19tdXN0X2NoZWNrIGk5MTVfdm1hX3Bpbl9mZW5jZShz
dHJ1Y3QgaTkxNV92bWEgKnZtYSk7CitpbnQgX19tdXN0X2NoZWNrIGk5MTVfdm1hX3Jldm9rZV9m
ZW5jZShzdHJ1Y3QgaTkxNV92bWEgKnZtYSk7CiAKIHN0YXRpYyBpbmxpbmUgdm9pZCBfX2k5MTVf
dm1hX3VucGluX2ZlbmNlKHN0cnVjdCBpOTE1X3ZtYSAqdm1hKQogewotLSAKMi4yMy4wCgpfX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fXwpJbnRlbC1nZnggbWFp
bGluZyBsaXN0CkludGVsLWdmeEBsaXN0cy5mcmVlZGVza3RvcC5vcmcKaHR0cHM6Ly9saXN0cy5m
cmVlZGVza3RvcC5vcmcvbWFpbG1hbi9saXN0aW5mby9pbnRlbC1nZng=

Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 971FF82500
	for <lists+intel-gfx@lfdr.de>; Mon,  5 Aug 2019 20:40:08 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id C7E1A89C5E;
	Mon,  5 Aug 2019 18:40:06 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from fireflyinternet.com (mail.fireflyinternet.com [109.228.58.192])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 75D8689C52
 for <intel-gfx@lists.freedesktop.org>; Mon,  5 Aug 2019 18:40:05 +0000 (UTC)
X-Default-Received-SPF: pass (skip=forwardok (res=PASS))
 x-ip-name=78.156.65.138; 
Received: from haswell.alporthouse.com (unverified [78.156.65.138]) 
 by fireflyinternet.com (Firefly Internet (M1)) with ESMTP id 17896498-1500050 
 for multiple; Mon, 05 Aug 2019 19:39:44 +0100
From: Chris Wilson <chris@chris-wilson.co.uk>
To: intel-gfx@lists.freedesktop.org
Date: Mon,  5 Aug 2019 19:39:43 +0100
Message-Id: <20190805183943.24063-1-chris@chris-wilson.co.uk>
X-Mailer: git-send-email 2.23.0.rc1
In-Reply-To: <20190805094333.17600-1-chris@chris-wilson.co.uk>
References: <20190805094333.17600-1-chris@chris-wilson.co.uk>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH v3] drm/i915: Defer final intel_wakeref_put to
 process context
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

QXMgd2UgbmVlZCB0byBhY3F1aXJlIGEgbXV0ZXggdG8gc2VyaWFsaXNlIHRoZSBmaW5hbAppbnRl
bF93YWtlcmVmX3B1dCwgd2UgbmVlZCB0byBlbnN1cmUgdGhhdCB3ZSBhcmUgaW4gcHJvY2VzcyBj
b250ZXh0IGF0CnRoYXQgdGltZS4gSG93ZXZlciwgd2Ugd2FudCB0byBhbGxvdyBvcGVyYXRpb24g
b24gdGhlIGludGVsX3dha2VyZWYgZnJvbQppbnNpZGUgdGltZXIgYW5kIG90aGVyIGhhcmRpcnEg
Y29udGV4dCwgd2hpY2ggbWVhbnMgdGhhdCBuZWVkIHRvIGRlZmVyCnRoYXQgZmluYWwgcHV0IHRv
IGEgd29ya3F1ZXVlLgoKSW5zaWRlIHRoZSBmaW5hbCB3YWtlcmVmIHB1dHMsIHdlIGFyZSBzYWZl
IHRvIG9wZXJhdGUgaW4gYW55IGNvbnRleHQsIGFzCndlIGFyZSBzaW1wbHkgbWFya2luZyB1cCB0
aGUgSFcgYW5kIHN0YXRlIHRyYWNraW5nIGZvciB0aGUgcG90ZW50aWFsCnNsZWVwLiBJdCdzIG9u
bHkgdGhlIHNlcmlhbGlzYXRpb24gd2l0aCB0aGUgcG90ZW50aWFsIHNsZWVwaW5nIGdldHRpbmcK
dGhhdCByZXF1aXJlcyBjYXJlZnVsIHdhaXQgYXZvaWRhbmNlLiBUaGlzIGFsbG93cyB1cyB0byBy
ZXRhaW4gdGhlCmltbWVkaWF0ZSBwcm9jZXNzaW5nIGFzIGJlZm9yZSAod2Ugb25seSBuZWVkIHRv
IHNsZWVwIG92ZXIgdGhlIHNhbWUKcmFjZXMgYXMgdGhlIGN1cnJlbnQgbXV0ZXhfbG9jaykuCgp2
MjogQWRkIGEgc2VsZnRlc3QgdG8gZW5zdXJlIHdlIGV4ZXJjaXNlIHRoZSBjb2RlIHdoaWxlIGxv
Y2tkZXAgd2F0Y2hlcy4KdjM6IFRoYXQgdGVzdCB3YXMgZXh0cmVtZWx5IGxvdWQgYW5kIGNvbXBs
YWluZWQgYWJvdXQgbWFueSB0aGluZ3MhCgpCdWd6aWxsYTogaHR0cHM6Ly9idWdzLmZyZWVkZXNr
dG9wLm9yZy9zaG93X2J1Zy5jZ2k/aWQ9MTExMjk1CkZpeGVzOiAxODM5ODkwNGNhOWUgKCJkcm0v
aTkxNTogT25seSByZWNvdmVyIGFjdGl2ZSBlbmdpbmVzIikKRml4ZXM6IDUxZmJkOGRlODdkYyAo
ImRybS9pOTE1L3BtdTogQXRvbWljYWxseSBhY3F1aXJlIHRoZSBndF9wbSB3YWtlcmVmIikKU2ln
bmVkLW9mZi1ieTogQ2hyaXMgV2lsc29uIDxjaHJpc0BjaHJpcy13aWxzb24uY28udWs+CkNjOiBU
dnJ0a28gVXJzdWxpbiA8dHZydGtvLnVyc3VsaW5AaW50ZWwuY29tPgpDYzogTWlrYSBLdW9wcGFs
YSA8bWlrYS5rdW9wcGFsYUBsaW51eC5pbnRlbC5jb20+Ci0tLQpHaXQgYWRkIGJlZm9yZSBzZW5k
IQotLS0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9wbS5jICAgICAgICB8IDEz
ICstLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfZW5naW5lX2NzLmMgICAgIHwgIDEg
KwogZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfZW5naW5lX3BtLmMgICAgIHwgMzggKysr
LS0tLS0tCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9lbmdpbmVfcG0uaCAgICAgfCAx
OCArKy0tCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9ndF9wbS5jICAgICAgICAgfCAy
OCArKystLS0tCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9ndF9wbS5oICAgICAgICAg
fCAyMiArKysrLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfbHJjLmMgICAgICAgICAg
IHwgIDQgKy0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L3NlbGZ0ZXN0X2VuZ2luZS5jICAgICB8
IDI4ICsrKysrKysKIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L3NlbGZ0ZXN0X2VuZ2luZS5oICAg
ICB8IDE0ICsrKysKIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L3NlbGZ0ZXN0X2VuZ2luZV9wbS5j
ICB8IDgzICsrKysrKysrKysrKysrKysrKysKIC4uLi9ncHUvZHJtL2k5MTUvZ3QvdWMvaW50ZWxf
Z3VjX3N1Ym1pc3Npb24uYyB8ICA0ICstCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2RlYnVn
ZnMuYyAgICAgICAgICAgfCAgNCArCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2dlbS5jICAg
ICAgICAgICAgICAgfCAyNiArLS0tLS0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2ludGVsX3dha2Vy
ZWYuYyAgICAgICAgICB8IDgyICsrKysrKysrKysrKystLS0tLQogZHJpdmVycy9ncHUvZHJtL2k5
MTUvaW50ZWxfd2FrZXJlZi5oICAgICAgICAgIHwgNjIgKysrKysrKysrLS0tLS0KIC4uLi9kcm0v
aTkxNS9zZWxmdGVzdHMvaTkxNV9saXZlX3NlbGZ0ZXN0cy5oICB8ICA1ICstCiAxNiBmaWxlcyBj
aGFuZ2VkLCAzMDEgaW5zZXJ0aW9ucygrKSwgMTMxIGRlbGV0aW9ucygtKQogY3JlYXRlIG1vZGUg
MTAwNjQ0IGRyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L3NlbGZ0ZXN0X2VuZ2luZS5jCiBjcmVhdGUg
bW9kZSAxMDA2NDQgZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qvc2VsZnRlc3RfZW5naW5lLmgKIGNy
ZWF0ZSBtb2RlIDEwMDY0NCBkcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9zZWxmdGVzdF9lbmdpbmVf
cG0uYwoKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9wbS5j
IGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX3BtLmMKaW5kZXggNzI5MjI3MDNh
ZjQ5Li4xN2UzNjE4MjQxYzUgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9p
OTE1X2dlbV9wbS5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9wbS5j
CkBAIC0xMzAsNyArMTMwLDkgQEAgc3RhdGljIGJvb2wgc3dpdGNoX3RvX2tlcm5lbF9jb250ZXh0
X3N5bmMoc3RydWN0IGludGVsX2d0ICpndCkKIAkJfQogCX0gd2hpbGUgKGk5MTVfcmV0aXJlX3Jl
cXVlc3RzKGd0LT5pOTE1KSAmJiByZXN1bHQpOwogCi0JR0VNX0JVR19PTihndC0+YXdha2UpOwor
CWlmIChpbnRlbF9ndF9wbV93YWl0X2Zvcl9pZGxlKGd0KSkKKwkJcmVzdWx0ID0gZmFsc2U7CisK
IAlyZXR1cm4gcmVzdWx0OwogfQogCkBAIC0xNjEsMTMgKzE2Myw2IEBAIHZvaWQgaTkxNV9nZW1f
c3VzcGVuZChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkKIAogCW11dGV4X3VubG9jaygm
aTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CiAKLQkvKgotCSAqIEFzc2VydCB0aGF0IHdlIHN1Y2Nl
c3NmdWxseSBmbHVzaGVkIGFsbCB0aGUgd29yayBhbmQKLQkgKiByZXNldCB0aGUgR1BVIGJhY2sg
dG8gaXRzIGlkbGUsIGxvdyBwb3dlciBzdGF0ZS4KLQkgKi8KLQlHRU1fQlVHX09OKGk5MTUtPmd0
LmF3YWtlKTsKLQlmbHVzaF93b3JrKCZpOTE1LT5nZW0uaWRsZV93b3JrKTsKLQogCWNhbmNlbF9k
ZWxheWVkX3dvcmtfc3luYygmaTkxNS0+Z3QuaGFuZ2NoZWNrLndvcmspOwogCiAJaTkxNV9nZW1f
ZHJhaW5fZnJlZWRfb2JqZWN0cyhpOTE1KTsKQEAgLTI0NCw4ICsyMzksNiBAQCB2b2lkIGk5MTVf
Z2VtX3Jlc3VtZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkKIHsKIAlHRU1fVFJBQ0Uo
IlxuIik7CiAKLQlXQVJOX09OKGk5MTUtPmd0LmF3YWtlKTsKLQogCW11dGV4X2xvY2soJmk5MTUt
PmRybS5zdHJ1Y3RfbXV0ZXgpOwogCWludGVsX3VuY29yZV9mb3JjZXdha2VfZ2V0KCZpOTE1LT51
bmNvcmUsIEZPUkNFV0FLRV9BTEwpOwogCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkx
NS9ndC9pbnRlbF9lbmdpbmVfY3MuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2Vu
Z2luZV9jcy5jCmluZGV4IGE5MWYxNTcxN2NjMS4uNDE0YjBkYmIzYTIwIDEwMDY0NAotLS0gYS9k
cml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9lbmdpbmVfY3MuYworKysgYi9kcml2ZXJzL2dw
dS9kcm0vaTkxNS9ndC9pbnRlbF9lbmdpbmVfY3MuYwpAQCAtMTY3Miw1ICsxNjcyLDYgQEAgaW50
ZWxfZW5naW5lX2ZpbmRfYWN0aXZlX3JlcXVlc3Qoc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5n
aW5lKQogfQogCiAjaWYgSVNfRU5BQkxFRChDT05GSUdfRFJNX0k5MTVfU0VMRlRFU1QpCisjaW5j
bHVkZSAic2VsZnRlc3RfZW5naW5lLmMiCiAjaW5jbHVkZSAic2VsZnRlc3RfZW5naW5lX2NzLmMi
CiAjZW5kaWYKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2VuZ2lu
ZV9wbS5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfZW5naW5lX3BtLmMKaW5kZXgg
MDMzNjIwNDk4OGQ2Li42YjE1ZTMzMzVkZDYgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9p
OTE1L2d0L2ludGVsX2VuZ2luZV9wbS5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2lu
dGVsX2VuZ2luZV9wbS5jCkBAIC0zNywyOCArMzcsNiBAQCBzdGF0aWMgaW50IF9fZW5naW5lX3Vu
cGFyayhzdHJ1Y3QgaW50ZWxfd2FrZXJlZiAqd2YpCiAJcmV0dXJuIDA7CiB9CiAKLXZvaWQgaW50
ZWxfZW5naW5lX3BtX2dldChzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmUpCi17Ci0JaW50
ZWxfd2FrZXJlZl9nZXQoJmVuZ2luZS0+aTkxNS0+cnVudGltZV9wbSwgJmVuZ2luZS0+d2FrZXJl
ZiwgX19lbmdpbmVfdW5wYXJrKTsKLX0KLQotdm9pZCBpbnRlbF9lbmdpbmVfcGFyayhzdHJ1Y3Qg
aW50ZWxfZW5naW5lX2NzICplbmdpbmUpCi17Ci0JLyoKLQkgKiBXZSBhcmUgY29tbWl0dGVkIG5v
dyB0byBwYXJraW5nIHRoaXMgZW5naW5lLCBtYWtlIHN1cmUgdGhlcmUKLQkgKiB3aWxsIGJlIG5v
IG1vcmUgaW50ZXJydXB0cyBhcnJpdmluZyBsYXRlciBhbmQgdGhlIGVuZ2luZQotCSAqIGlzIHRy
dWx5IGlkbGUuCi0JICovCi0JaWYgKHdhaXRfZm9yKGludGVsX2VuZ2luZV9pc19pZGxlKGVuZ2lu
ZSksIDEwKSkgewotCQlzdHJ1Y3QgZHJtX3ByaW50ZXIgcCA9IGRybV9kZWJ1Z19wcmludGVyKF9f
ZnVuY19fKTsKLQotCQlkZXZfZXJyKGVuZ2luZS0+aTkxNS0+ZHJtLmRldiwKLQkJCSIlcyBpcyBu
b3QgaWRsZSBiZWZvcmUgcGFya2luZ1xuIiwKLQkJCWVuZ2luZS0+bmFtZSk7Ci0JCWludGVsX2Vu
Z2luZV9kdW1wKGVuZ2luZSwgJnAsIE5VTEwpOwotCX0KLX0KLQogc3RhdGljIGJvb2wgc3dpdGNo
X3RvX2tlcm5lbF9jb250ZXh0KHN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZSkKIHsKIAlz
dHJ1Y3QgaTkxNV9yZXF1ZXN0ICpycTsKQEAgLTEzNiwxMiArMTE0LDE4IEBAIHN0YXRpYyBpbnQg
X19lbmdpbmVfcGFyayhzdHJ1Y3QgaW50ZWxfd2FrZXJlZiAqd2YpCiAJcmV0dXJuIDA7CiB9CiAK
LXZvaWQgaW50ZWxfZW5naW5lX3BtX3B1dChzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmUp
Ci17Ci0JaW50ZWxfd2FrZXJlZl9wdXQoJmVuZ2luZS0+aTkxNS0+cnVudGltZV9wbSwgJmVuZ2lu
ZS0+d2FrZXJlZiwgX19lbmdpbmVfcGFyayk7Ci19CitzdGF0aWMgY29uc3Qgc3RydWN0IGludGVs
X3dha2VyZWZfb3BzIHdmX29wcyA9IHsKKwkuZ2V0ID0gX19lbmdpbmVfdW5wYXJrLAorCS5wdXQg
PSBfX2VuZ2luZV9wYXJrLAorfTsKIAogdm9pZCBpbnRlbF9lbmdpbmVfaW5pdF9fcG0oc3RydWN0
IGludGVsX2VuZ2luZV9jcyAqZW5naW5lKQogewotCWludGVsX3dha2VyZWZfaW5pdCgmZW5naW5l
LT53YWtlcmVmKTsKKwlzdHJ1Y3QgaW50ZWxfcnVudGltZV9wbSAqcnBtID0gJmVuZ2luZS0+aTkx
NS0+cnVudGltZV9wbTsKKworCWludGVsX3dha2VyZWZfaW5pdCgmZW5naW5lLT53YWtlcmVmLCBy
cG0sICZ3Zl9vcHMpOwogfQorCisjaWYgSVNfRU5BQkxFRChDT05GSUdfRFJNX0k5MTVfU0VMRlRF
U1QpCisjaW5jbHVkZSAic2VsZnRlc3RfZW5naW5lX3BtLmMiCisjZW5kaWYKZGlmZiAtLWdpdCBh
L2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2VuZ2luZV9wbS5oIGIvZHJpdmVycy9ncHUv
ZHJtL2k5MTUvZ3QvaW50ZWxfZW5naW5lX3BtLmgKaW5kZXggMDE1YWM3MmQ3YWQwLi43MzljNTBm
ZWZjZWYgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2VuZ2luZV9w
bS5oCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2VuZ2luZV9wbS5oCkBAIC0x
MCwyNCArMTAsMjYgQEAKICNpbmNsdWRlICJpbnRlbF9lbmdpbmVfdHlwZXMuaCIKICNpbmNsdWRl
ICJpbnRlbF93YWtlcmVmLmgiCiAKLXN0cnVjdCBkcm1faTkxNV9wcml2YXRlOwotCi12b2lkIGlu
dGVsX2VuZ2luZV9wbV9nZXQoc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lKTsKLXZvaWQg
aW50ZWxfZW5naW5lX3BtX3B1dChzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmUpOwotCiBz
dGF0aWMgaW5saW5lIGJvb2wKIGludGVsX2VuZ2luZV9wbV9pc19hd2FrZShjb25zdCBzdHJ1Y3Qg
aW50ZWxfZW5naW5lX2NzICplbmdpbmUpCiB7CiAJcmV0dXJuIGludGVsX3dha2VyZWZfaXNfYWN0
aXZlKCZlbmdpbmUtPndha2VyZWYpOwogfQogCi1zdGF0aWMgaW5saW5lIGJvb2wKLWludGVsX2Vu
Z2luZV9wbV9nZXRfaWZfYXdha2Uoc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lKQorc3Rh
dGljIGlubGluZSB2b2lkIGludGVsX2VuZ2luZV9wbV9nZXQoc3RydWN0IGludGVsX2VuZ2luZV9j
cyAqZW5naW5lKQoreworCWludGVsX3dha2VyZWZfZ2V0KCZlbmdpbmUtPndha2VyZWYpOworfQor
CitzdGF0aWMgaW5saW5lIGJvb2wgaW50ZWxfZW5naW5lX3BtX2dldF9pZl9hd2FrZShzdHJ1Y3Qg
aW50ZWxfZW5naW5lX2NzICplbmdpbmUpCiB7CiAJcmV0dXJuIGludGVsX3dha2VyZWZfZ2V0X2lm
X2FjdGl2ZSgmZW5naW5lLT53YWtlcmVmKTsKIH0KIAotdm9pZCBpbnRlbF9lbmdpbmVfcGFyayhz
dHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmUpOworc3RhdGljIGlubGluZSB2b2lkIGludGVs
X2VuZ2luZV9wbV9wdXQoc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lKQoreworCWludGVs
X3dha2VyZWZfcHV0KCZlbmdpbmUtPndha2VyZWYpOworfQogCiB2b2lkIGludGVsX2VuZ2luZV9p
bml0X19wbShzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmUpOwogCmRpZmYgLS1naXQgYS9k
cml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9ndF9wbS5jIGIvZHJpdmVycy9ncHUvZHJtL2k5
MTUvZ3QvaW50ZWxfZ3RfcG0uYwppbmRleCA2Yzg5NzAyNzFhN2YuLjEzNjNlMDY5ZWM4MyAxMDA2
NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfZ3RfcG0uYworKysgYi9kcml2
ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9ndF9wbS5jCkBAIC0xNyw3ICsxNyw3IEBAIHN0YXRp
YyB2b2lkIHBtX25vdGlmeShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwgaW50IHN0YXRl
KQogCWJsb2NraW5nX25vdGlmaWVyX2NhbGxfY2hhaW4oJmk5MTUtPmd0LnBtX25vdGlmaWNhdGlv
bnMsIHN0YXRlLCBpOTE1KTsKIH0KIAotc3RhdGljIGludCBpbnRlbF9ndF91bnBhcmsoc3RydWN0
IGludGVsX3dha2VyZWYgKndmKQorc3RhdGljIGludCBfX2d0X3VucGFyayhzdHJ1Y3QgaW50ZWxf
d2FrZXJlZiAqd2YpCiB7CiAJc3RydWN0IGludGVsX2d0ICpndCA9IGNvbnRhaW5lcl9vZih3Ziwg
dHlwZW9mKCpndCksIHdha2VyZWYpOwogCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0g
Z3QtPmk5MTU7CkBAIC01MywxNCArNTMsNyBAQCBzdGF0aWMgaW50IGludGVsX2d0X3VucGFyayhz
dHJ1Y3QgaW50ZWxfd2FrZXJlZiAqd2YpCiAJcmV0dXJuIDA7CiB9CiAKLXZvaWQgaW50ZWxfZ3Rf
cG1fZ2V0KHN0cnVjdCBpbnRlbF9ndCAqZ3QpCi17Ci0Jc3RydWN0IGludGVsX3J1bnRpbWVfcG0g
KnJwbSA9ICZndC0+aTkxNS0+cnVudGltZV9wbTsKLQotCWludGVsX3dha2VyZWZfZ2V0KHJwbSwg
Jmd0LT53YWtlcmVmLCBpbnRlbF9ndF91bnBhcmspOwotfQotCi1zdGF0aWMgaW50IGludGVsX2d0
X3Bhcmsoc3RydWN0IGludGVsX3dha2VyZWYgKndmKQorc3RhdGljIGludCBfX2d0X3Bhcmsoc3Ry
dWN0IGludGVsX3dha2VyZWYgKndmKQogewogCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1
ID0KIAkJY29udGFpbmVyX29mKHdmLCB0eXBlb2YoKmk5MTUpLCBndC53YWtlcmVmKTsKQEAgLTc0
LDIyICs2NywyNSBAQCBzdGF0aWMgaW50IGludGVsX2d0X3Bhcmsoc3RydWN0IGludGVsX3dha2Vy
ZWYgKndmKQogCWlmIChJTlRFTF9HRU4oaTkxNSkgPj0gNikKIAkJZ2VuNl9ycHNfaWRsZShpOTE1
KTsKIAorCS8qIEV2ZXJ5dGhpbmcgc3dpdGNoZWQgb2ZmLCBmbHVzaCBhbnkgcmVzaWR1YWwgaW50
ZXJydXB0IGp1c3QgaW4gY2FzZSAqLworCWludGVsX3N5bmNocm9uaXplX2lycShpOTE1KTsKKwog
CUdFTV9CVUdfT04oIXdha2VyZWYpOwogCWludGVsX2Rpc3BsYXlfcG93ZXJfcHV0KGk5MTUsIFBP
V0VSX0RPTUFJTl9HVF9JUlEsIHdha2VyZWYpOwogCiAJcmV0dXJuIDA7CiB9CiAKLXZvaWQgaW50
ZWxfZ3RfcG1fcHV0KHN0cnVjdCBpbnRlbF9ndCAqZ3QpCi17Ci0Jc3RydWN0IGludGVsX3J1bnRp
bWVfcG0gKnJwbSA9ICZndC0+aTkxNS0+cnVudGltZV9wbTsKLQotCWludGVsX3dha2VyZWZfcHV0
KHJwbSwgJmd0LT53YWtlcmVmLCBpbnRlbF9ndF9wYXJrKTsKLX0KK3N0YXRpYyBjb25zdCBzdHJ1
Y3QgaW50ZWxfd2FrZXJlZl9vcHMgd2Zfb3BzID0geworCS5nZXQgPSBfX2d0X3VucGFyaywKKwku
cHV0ID0gX19ndF9wYXJrLAorCS5mbGFncyA9IElOVEVMX1dBS0VSRUZfUFVUX0FTWU5DLAorfTsK
IAogdm9pZCBpbnRlbF9ndF9wbV9pbml0X2Vhcmx5KHN0cnVjdCBpbnRlbF9ndCAqZ3QpCiB7Ci0J
aW50ZWxfd2FrZXJlZl9pbml0KCZndC0+d2FrZXJlZik7CisJaW50ZWxfd2FrZXJlZl9pbml0KCZn
dC0+d2FrZXJlZiwgJmd0LT5pOTE1LT5ydW50aW1lX3BtLCAmd2Zfb3BzKTsKKwogCUJMT0NLSU5H
X0lOSVRfTk9USUZJRVJfSEVBRCgmZ3QtPnBtX25vdGlmaWNhdGlvbnMpOwogfQogCmRpZmYgLS1n
aXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9ndF9wbS5oIGIvZHJpdmVycy9ncHUv
ZHJtL2k5MTUvZ3QvaW50ZWxfZ3RfcG0uaAppbmRleCBlOGExOGQ0YjI3YzkuLjU3NjMzZjUzOGRk
YiAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfZ3RfcG0uaAorKysg
Yi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9ndF9wbS5oCkBAIC0xNywxNCArMTcsMzIg
QEAgZW51bSB7CiAJSU5URUxfR1RfUEFSSywKIH07CiAKLXZvaWQgaW50ZWxfZ3RfcG1fZ2V0KHN0
cnVjdCBpbnRlbF9ndCAqZ3QpOwotdm9pZCBpbnRlbF9ndF9wbV9wdXQoc3RydWN0IGludGVsX2d0
ICpndCk7CitzdGF0aWMgaW5saW5lIGJvb2wKK2ludGVsX2d0X3BtX2lzX2F3YWtlKGNvbnN0IHN0
cnVjdCBpbnRlbF9ndCAqZ3QpCit7CisJcmV0dXJuIGludGVsX3dha2VyZWZfaXNfYWN0aXZlKCZn
dC0+d2FrZXJlZik7Cit9CisKK3N0YXRpYyBpbmxpbmUgdm9pZCBpbnRlbF9ndF9wbV9nZXQoc3Ry
dWN0IGludGVsX2d0ICpndCkKK3sKKwlpbnRlbF93YWtlcmVmX2dldCgmZ3QtPndha2VyZWYpOwor
fQogCiBzdGF0aWMgaW5saW5lIGJvb2wgaW50ZWxfZ3RfcG1fZ2V0X2lmX2F3YWtlKHN0cnVjdCBp
bnRlbF9ndCAqZ3QpCiB7CiAJcmV0dXJuIGludGVsX3dha2VyZWZfZ2V0X2lmX2FjdGl2ZSgmZ3Qt
Pndha2VyZWYpOwogfQogCitzdGF0aWMgaW5saW5lIHZvaWQgaW50ZWxfZ3RfcG1fcHV0KHN0cnVj
dCBpbnRlbF9ndCAqZ3QpCit7CisJaW50ZWxfd2FrZXJlZl9wdXQoJmd0LT53YWtlcmVmKTsKK30K
Kworc3RhdGljIGlubGluZSBpbnQgaW50ZWxfZ3RfcG1fd2FpdF9mb3JfaWRsZShzdHJ1Y3QgaW50
ZWxfZ3QgKmd0KQoreworCXJldHVybiBpbnRlbF93YWtlcmVmX3dhaXRfZm9yX2lkbGUoJmd0LT53
YWtlcmVmKTsKK30KKwogdm9pZCBpbnRlbF9ndF9wbV9pbml0X2Vhcmx5KHN0cnVjdCBpbnRlbF9n
dCAqZ3QpOwogCiB2b2lkIGludGVsX2d0X3Nhbml0aXplKHN0cnVjdCBpbnRlbF9ndCAqZ3QsIGJv
b2wgZm9yY2UpOwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfbHJj
LmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9scmMuYwppbmRleCAyMzJmNDBmY2I0
OTAuLjFhMDExNjc1MWQxOSAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50
ZWxfbHJjLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfbHJjLmMKQEAgLTEz
OSw2ICsxMzksNyBAQAogI2luY2x1ZGUgImk5MTVfdmdwdS5oIgogI2luY2x1ZGUgImludGVsX2Vu
Z2luZV9wbS5oIgogI2luY2x1ZGUgImludGVsX2d0LmgiCisjaW5jbHVkZSAiaW50ZWxfZ3RfcG0u
aCIKICNpbmNsdWRlICJpbnRlbF9scmNfcmVnLmgiCiAjaW5jbHVkZSAiaW50ZWxfbW9jcy5oIgog
I2luY2x1ZGUgImludGVsX3Jlc2V0LmgiCkBAIC01NTYsNiArNTU3LDcgQEAgZXhlY2xpc3RzX3Nj
aGVkdWxlX2luKHN0cnVjdCBpOTE1X3JlcXVlc3QgKnJxLCBpbnQgaWR4KQogCQlpbnRlbF9jb250
ZXh0X2dldChjZSk7CiAJCWNlLT5pbmZsaWdodCA9IHJxLT5lbmdpbmU7CiAKKwkJaW50ZWxfZ3Rf
cG1fZ2V0KGNlLT5pbmZsaWdodC0+Z3QpOwogCQlleGVjbGlzdHNfY29udGV4dF9zdGF0dXNfY2hh
bmdlKHJxLCBJTlRFTF9DT05URVhUX1NDSEVEVUxFX0lOKTsKIAkJaW50ZWxfZW5naW5lX2NvbnRl
eHRfaW4oY2UtPmluZmxpZ2h0KTsKIAl9CkBAIC01ODgsNiArNTkwLDcgQEAgZXhlY2xpc3RzX3Nj
aGVkdWxlX291dChzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpycSkKIAlpZiAoIWludGVsX2NvbnRleHRf
aW5mbGlnaHRfY291bnQoY2UpKSB7CiAJCWludGVsX2VuZ2luZV9jb250ZXh0X291dChjZS0+aW5m
bGlnaHQpOwogCQlleGVjbGlzdHNfY29udGV4dF9zdGF0dXNfY2hhbmdlKHJxLCBJTlRFTF9DT05U
RVhUX1NDSEVEVUxFX09VVCk7CisJCWludGVsX2d0X3BtX3B1dChjZS0+aW5mbGlnaHQtPmd0KTsK
IAogCQkvKgogCQkgKiBJZiB0aGlzIGlzIHBhcnQgb2YgYSB2aXJ0dWFsIGVuZ2luZSwgaXRzIG5l
eHQgcmVxdWVzdCBtYXkKQEAgLTI3MTksNyArMjcyMiw2IEBAIHN0YXRpYyB1MzIgKmdlbjhfZW1p
dF9maW5pX2JyZWFkY3J1bWJfcmNzKHN0cnVjdCBpOTE1X3JlcXVlc3QgKnJlcXVlc3QsIHUzMiAq
Y3MpCiBzdGF0aWMgdm9pZCBleGVjbGlzdHNfcGFyayhzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICpl
bmdpbmUpCiB7CiAJZGVsX3RpbWVyX3N5bmMoJmVuZ2luZS0+ZXhlY2xpc3RzLnRpbWVyKTsKLQlp
bnRlbF9lbmdpbmVfcGFyayhlbmdpbmUpOwogfQogCiB2b2lkIGludGVsX2V4ZWNsaXN0c19zZXRf
ZGVmYXVsdF9zdWJtaXNzaW9uKHN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZSkKZGlmZiAt
LWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L3NlbGZ0ZXN0X2VuZ2luZS5jIGIvZHJpdmVy
cy9ncHUvZHJtL2k5MTUvZ3Qvc2VsZnRlc3RfZW5naW5lLmMKbmV3IGZpbGUgbW9kZSAxMDA2NDQK
aW5kZXggMDAwMDAwMDAwMDAwLi5mNjViMTE4ZTI2MWQKLS0tIC9kZXYvbnVsbAorKysgYi9kcml2
ZXJzL2dwdS9kcm0vaTkxNS9ndC9zZWxmdGVzdF9lbmdpbmUuYwpAQCAtMCwwICsxLDI4IEBACisv
KgorICogU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEdQTC0yLjAKKyAqCisgKiBDb3B5cmlnaHQg
wqkgMjAxOCBJbnRlbCBDb3Jwb3JhdGlvbgorICovCisKKyNpbmNsdWRlICJpOTE1X3NlbGZ0ZXN0
LmgiCisjaW5jbHVkZSAic2VsZnRlc3RfZW5naW5lLmgiCisKK2ludCBpbnRlbF9lbmdpbmVfbGl2
ZV9zZWxmdGVzdHMoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpCit7CisJc3RhdGljIGlu
dCAoKiBjb25zdCB0ZXN0c1tdKShzdHJ1Y3QgaW50ZWxfZ3QgKikgPSB7CisJCWxpdmVfZW5naW5l
X3BtX3NlbGZ0ZXN0cywKKwkJTlVMTCwKKwl9OworCXN0cnVjdCBpbnRlbF9ndCAqZ3QgPSAmaTkx
NS0+Z3Q7CisJdHlwZW9mKCp0ZXN0cykgKmZuOworCisJZm9yIChmbiA9IHRlc3RzOyAqZm47IGZu
KyspIHsKKwkJaW50IGVycjsKKworCQllcnIgPSAoKmZuKShndCk7CisJCWlmIChlcnIpCisJCQly
ZXR1cm4gZXJyOworCX0KKworCXJldHVybiAwOworfQpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUv
ZHJtL2k5MTUvZ3Qvc2VsZnRlc3RfZW5naW5lLmggYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9z
ZWxmdGVzdF9lbmdpbmUuaApuZXcgZmlsZSBtb2RlIDEwMDY0NAppbmRleCAwMDAwMDAwMDAwMDAu
LmFiMzJkMDllYzVhMQotLS0gL2Rldi9udWxsCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0
L3NlbGZ0ZXN0X2VuZ2luZS5oCkBAIC0wLDAgKzEsMTQgQEAKKy8qCisgKiBTUERYLUxpY2Vuc2Ut
SWRlbnRpZmllcjogR1BMLTIuMAorICoKKyAqIENvcHlyaWdodCDCqSAyMDE5IEludGVsIENvcnBv
cmF0aW9uCisgKi8KKworI2lmbmRlZiBTRUxGVEVTVF9FTkdJTkVfSAorI2RlZmluZSBTRUxGVEVT
VF9FTkdJTkVfSAorCitzdHJ1Y3QgaW50ZWxfZ3Q7CisKK2ludCBsaXZlX2VuZ2luZV9wbV9zZWxm
dGVzdHMoc3RydWN0IGludGVsX2d0ICpndCk7CisKKyNlbmRpZgpkaWZmIC0tZ2l0IGEvZHJpdmVy
cy9ncHUvZHJtL2k5MTUvZ3Qvc2VsZnRlc3RfZW5naW5lX3BtLmMgYi9kcml2ZXJzL2dwdS9kcm0v
aTkxNS9ndC9zZWxmdGVzdF9lbmdpbmVfcG0uYwpuZXcgZmlsZSBtb2RlIDEwMDY0NAppbmRleCAw
MDAwMDAwMDAwMDAuLjc1YzE5NzYxMjcwNQotLS0gL2Rldi9udWxsCisrKyBiL2RyaXZlcnMvZ3B1
L2RybS9pOTE1L2d0L3NlbGZ0ZXN0X2VuZ2luZV9wbS5jCkBAIC0wLDAgKzEsODMgQEAKKy8qCisg
KiBTUERYLUxpY2Vuc2UtSWRlbnRpZmllcjogR1BMLTIuMAorICoKKyAqIENvcHlyaWdodCDCqSAy
MDE4IEludGVsIENvcnBvcmF0aW9uCisgKi8KKworI2luY2x1ZGUgImk5MTVfc2VsZnRlc3QuaCIK
KyNpbmNsdWRlICJzZWxmdGVzdF9lbmdpbmUuaCIKKyNpbmNsdWRlICJzZWxmdGVzdHMvaWd0X2F0
b21pYy5oIgorCitzdGF0aWMgaW50IGxpdmVfZW5naW5lX3BtKHZvaWQgKmFyZykKK3sKKwlzdHJ1
Y3QgaW50ZWxfZ3QgKmd0ID0gYXJnOworCXN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZTsK
KwllbnVtIGludGVsX2VuZ2luZV9pZCBpZDsKKworCS8qCisJICogQ2hlY2sgd2UgY2FuIGNhbGwg
aW50ZWxfZW5naW5lX3BtX3B1dCBmcm9tIGFueSBjb250ZXh0LiBObworCSAqIGZhaWx1cmVzIGFy
ZSByZXBvcnRlZCBkaXJlY3RseSwgYnV0IGlmIHdlIG1lc3MgdXAgbG9ja2RlcCBzaG91bGQKKwkg
KiB0ZWxsIHVzLgorCSAqLworCWlmIChpbnRlbF9ndF9wbV93YWl0X2Zvcl9pZGxlKGd0KSkgewor
CQlwcl9lcnIoIlVuYWJsZSB0byBmbHVzaCBHVCBwbSBiZWZvcmUgdGVzdFxuIik7CisJCXJldHVy
biAtRUJVU1k7CisJfQorCisJR0VNX0JVR19PTihpbnRlbF9ndF9wbV9pc19hd2FrZShndCkpOwor
CWZvcl9lYWNoX2VuZ2luZShlbmdpbmUsIGd0LT5pOTE1LCBpZCkgeworCQljb25zdCB0eXBlb2Yo
KmlndF9hdG9taWNfcGhhc2VzKSAqcDsKKworCQlmb3IgKHAgPSBpZ3RfYXRvbWljX3BoYXNlczsg
cC0+bmFtZTsgcCsrKSB7CisJCQkvKgorCQkJICogQWNxdWlzaXRpb24gaXMgYWx3YXlzIHN5bmNo
cm9ub3VzLCBleGNlcHQgaWYgd2UKKwkJCSAqIGtub3cgdGhhdCB0aGUgZW5naW5lIGlzIGFscmVh
ZHkgYXdhbGUsIGluIHdoaWNoCisJCQkgKiB3ZSBzaG91bGQgdXNlIGludGVsX2VuZ2luZV9wbV9n
ZXRfaWZfYXdha2UoKSB0bworCQkJICogYXRvbWljYWxseSBncmFiIHRoZSB3YWtlcmVmLgorCQkJ
ICoKKwkJCSAqIEluIHByYWN0aWNlLAorCQkJICogICAgaW50ZWxfZW5naW5lX3BtX2dldCgpOwor
CQkJICogICAgaW50ZWxfZW5naW5lX3BtX3B1dCgpOworCQkJICogb2NjdXJzIGluIG9uZSB0aHJl
YWQsIHdoaWxlIHNpbXVsdGFuZW91c2x5CisJCQkgKiAgICBpbnRlbF9lbmdpbmVfcG1fZ2V0X2lm
X2F3YWtlKCk7CisJCQkgKiAgICBpbnRlbF9lbmdpbmVfcG1fcHV0KCk7CisJCQkgKiBvY2N1cnMg
aW4gYXRvbWljIGNvbnRleHQgaW4gYW5vdGhlci4KKwkJCSAqLworCQkJR0VNX0JVR19PTihpbnRl
bF9lbmdpbmVfcG1faXNfYXdha2UoZW5naW5lKSk7CisJCQlpbnRlbF9lbmdpbmVfcG1fZ2V0KGVu
Z2luZSk7CisKKwkJCXAtPmNyaXRpY2FsX3NlY3Rpb25fYmVnaW4oKTsKKwkJCWlmICghaW50ZWxf
ZW5naW5lX3BtX2dldF9pZl9hd2FrZShlbmdpbmUpKQorCQkJCXByX2VycigiaW50ZWxfZW5naW5l
X3BtX2dldF9pZl9hd2FrZSglcykgZmFpbGVkIHVuZGVyICVzXG4iLAorCQkJCSAgICAgICBlbmdp
bmUtPm5hbWUsIHAtPm5hbWUpOworCQkJZWxzZQorCQkJCWludGVsX2VuZ2luZV9wbV9wdXQoZW5n
aW5lKTsKKwkJCWludGVsX2VuZ2luZV9wbV9wdXQoZW5naW5lKTsKKwkJCXAtPmNyaXRpY2FsX3Nl
Y3Rpb25fZW5kKCk7CisKKwkJCS8qIGVuZ2luZSB3YWtlcmVmIGlzIHN5bmMgKGluc3RhbnQpICov
CisJCQlpZiAoaW50ZWxfZW5naW5lX3BtX2lzX2F3YWtlKGVuZ2luZSkpIHsKKwkJCQlwcl9lcnIo
IiVzIGlzIHN0aWxsIGF3YWtlIGFmdGVyIGZsdXNoaW5nIHBtXG4iLAorCQkJCSAgICAgICBlbmdp
bmUtPm5hbWUpOworCQkJCXJldHVybiAtRUlOVkFMOworCQkJfQorCisJCQkvKiBndCB3YWtlcmVm
IGlzIGFzeW5jIChkZWZlcnJlZCB0byB3b3JrcXVldWUpICovCisJCQlpZiAoaW50ZWxfZ3RfcG1f
d2FpdF9mb3JfaWRsZShndCkpIHsKKwkJCQlwcl9lcnIoIkdUIGZhaWxlZCB0byBpZGxlXG4iKTsK
KwkJCQlyZXR1cm4gLUVJTlZBTDsKKwkJCX0KKwkJfQorCX0KKworCXJldHVybiAwOworfQorCitp
bnQgbGl2ZV9lbmdpbmVfcG1fc2VsZnRlc3RzKHN0cnVjdCBpbnRlbF9ndCAqZ3QpCit7CisJc3Rh
dGljIGNvbnN0IHN0cnVjdCBpOTE1X3N1YnRlc3QgdGVzdHNbXSA9IHsKKwkJU1VCVEVTVChsaXZl
X2VuZ2luZV9wbSksCisJfTsKKworCXJldHVybiBpbnRlbF9ndF9saXZlX3N1YnRlc3RzKHRlc3Rz
LCBndCk7Cit9CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC91Yy9pbnRlbF9n
dWNfc3VibWlzc2lvbi5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvdWMvaW50ZWxfZ3VjX3N1
Ym1pc3Npb24uYwppbmRleCA0MTI4OTIwOTZkYWEuLjQ5Nzg2ZTdhNjQ3YSAxMDA2NDQKLS0tIGEv
ZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvdWMvaW50ZWxfZ3VjX3N1Ym1pc3Npb24uYworKysgYi9k
cml2ZXJzL2dwdS9kcm0vaTkxNS9ndC91Yy9pbnRlbF9ndWNfc3VibWlzc2lvbi5jCkBAIC0yOSw2
ICsyOSw3IEBACiAjaW5jbHVkZSAiZ3QvaW50ZWxfY29udGV4dC5oIgogI2luY2x1ZGUgImd0L2lu
dGVsX2VuZ2luZV9wbS5oIgogI2luY2x1ZGUgImd0L2ludGVsX2d0LmgiCisjaW5jbHVkZSAiZ3Qv
aW50ZWxfZ3RfcG0uaCIKICNpbmNsdWRlICJndC9pbnRlbF9scmNfcmVnLmgiCiAjaW5jbHVkZSAi
aW50ZWxfZ3VjX3N1Ym1pc3Npb24uaCIKIApAQCAtNTM3LDYgKzUzOCw3IEBAIHN0YXRpYyBzdHJ1
Y3QgaTkxNV9yZXF1ZXN0ICpzY2hlZHVsZV9pbihzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpycSwgaW50
IGlkeCkKIAlpZiAoIXJxLT5od19jb250ZXh0LT5pbmZsaWdodCkKIAkJcnEtPmh3X2NvbnRleHQt
PmluZmxpZ2h0ID0gcnEtPmVuZ2luZTsKIAlpbnRlbF9jb250ZXh0X2luZmxpZ2h0X2luYyhycS0+
aHdfY29udGV4dCk7CisJaW50ZWxfZ3RfcG1fZ2V0KHJxLT5lbmdpbmUtPmd0KTsKIAogCXJldHVy
biBpOTE1X3JlcXVlc3RfZ2V0KHJxKTsKIH0KQEAgLTU0OSw2ICs1NTEsNyBAQCBzdGF0aWMgdm9p
ZCBzY2hlZHVsZV9vdXQoc3RydWN0IGk5MTVfcmVxdWVzdCAqcnEpCiAJaWYgKCFpbnRlbF9jb250
ZXh0X2luZmxpZ2h0X2NvdW50KHJxLT5od19jb250ZXh0KSkKIAkJcnEtPmh3X2NvbnRleHQtPmlu
ZmxpZ2h0ID0gTlVMTDsKIAorCWludGVsX2d0X3BtX3B1dChycS0+ZW5naW5lLT5ndCk7CiAJaTkx
NV9yZXF1ZXN0X3B1dChycSk7CiB9CiAKQEAgLTEwNzYsNyArMTA3OSw2IEBAIHN0YXRpYyB2b2lk
IGd1Y19pbnRlcnJ1cHRzX3JlbGVhc2Uoc3RydWN0IGludGVsX2d0ICpndCkKIAogc3RhdGljIHZv
aWQgZ3VjX3N1Ym1pc3Npb25fcGFyayhzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmUpCiB7
Ci0JaW50ZWxfZW5naW5lX3BhcmsoZW5naW5lKTsKIAlpbnRlbF9lbmdpbmVfdW5waW5fYnJlYWRj
cnVtYnNfaXJxKGVuZ2luZSk7CiAJZW5naW5lLT5mbGFncyAmPSB+STkxNV9FTkdJTkVfTkVFRFNf
QlJFQURDUlVNQl9UQVNLTEVUOwogfQpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUv
aTkxNV9kZWJ1Z2ZzLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2RlYnVnZnMuYwppbmRl
eCA4OTUzMzM2ZjJhZTUuLmVhM2JhMjY2MmE5ZSAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJt
L2k5MTUvaTkxNV9kZWJ1Z2ZzLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9kZWJ1
Z2ZzLmMKQEAgLTM5LDYgKzM5LDcgQEAKICNpbmNsdWRlICJkaXNwbGF5L2ludGVsX3Bzci5oIgog
CiAjaW5jbHVkZSAiZ2VtL2k5MTVfZ2VtX2NvbnRleHQuaCIKKyNpbmNsdWRlICJndC9pbnRlbF9n
dF9wbS5oIgogI2luY2x1ZGUgImd0L2ludGVsX3Jlc2V0LmgiCiAjaW5jbHVkZSAiZ3QvdWMvaW50
ZWxfZ3VjX3N1Ym1pc3Npb24uaCIKIApAQCAtMzY2NSw2ICszNjY2LDkgQEAgaTkxNV9kcm9wX2Nh
Y2hlc19zZXQodm9pZCAqZGF0YSwgdTY0IHZhbCkKIAkJCQkJCSAgICAgSTkxNV9XQUlUX0xPQ0tF
RCwKIAkJCQkJCSAgICAgTUFYX1NDSEVEVUxFX1RJTUVPVVQpOwogCisJCWlmIChyZXQgPT0gMCAm
JiB2YWwgJiBEUk9QX0lETEUpCisJCQlyZXQgPSBpbnRlbF9ndF9wbV93YWl0X2Zvcl9pZGxlKCZp
OTE1LT5ndCk7CisKIAkJaWYgKHZhbCAmIERST1BfUkVUSVJFKQogCQkJaTkxNV9yZXRpcmVfcmVx
dWVzdHMoaTkxNSk7CiAKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZ2Vt
LmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2dlbS5jCmluZGV4IGViMzRmM2U1YTc0ZC4u
NWVhY2VjYmQ3MDAyIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2dlbS5j
CisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZ2VtLmMKQEAgLTg5MywxOSArODkzLDYg
QEAgdm9pZCBpOTE1X2dlbV9ydW50aW1lX3N1c3BlbmQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUg
Kmk5MTUpCiAJfQogfQogCi1zdGF0aWMgaW50IHdhaXRfZm9yX2VuZ2luZXMoc3RydWN0IGludGVs
X2d0ICpndCkKLXsKLQlpZiAod2FpdF9mb3IoaW50ZWxfZW5naW5lc19hcmVfaWRsZShndCksIEk5
MTVfSURMRV9FTkdJTkVTX1RJTUVPVVQpKSB7Ci0JCWRldl9lcnIoZ3QtPmk5MTUtPmRybS5kZXYs
Ci0JCQkiRmFpbGVkIHRvIGlkbGUgZW5naW5lcywgZGVjbGFyaW5nIHdlZGdlZCFcbiIpOwotCQlH
RU1fVFJBQ0VfRFVNUCgpOwotCQlpbnRlbF9ndF9zZXRfd2VkZ2VkKGd0KTsKLQkJcmV0dXJuIC1F
SU87Ci0JfQotCi0JcmV0dXJuIDA7Ci19Ci0KIHN0YXRpYyBsb25nCiB3YWl0X2Zvcl90aW1lbGlu
ZXMoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUsCiAJCSAgIHVuc2lnbmVkIGludCBmbGFn
cywgbG9uZyB0aW1lb3V0KQpAQCAtOTUzLDI3ICs5NDAsMjAgQEAgaW50IGk5MTVfZ2VtX3dhaXRf
Zm9yX2lkbGUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUsCiAJCQkgICB1bnNpZ25lZCBp
bnQgZmxhZ3MsIGxvbmcgdGltZW91dCkKIHsKIAkvKiBJZiB0aGUgZGV2aWNlIGlzIGFzbGVlcCwg
d2UgaGF2ZSBubyByZXF1ZXN0cyBvdXRzdGFuZGluZyAqLwotCWlmICghUkVBRF9PTkNFKGk5MTUt
Pmd0LmF3YWtlKSkKKwlpZiAoIWludGVsX2d0X3BtX2lzX2F3YWtlKCZpOTE1LT5ndCkpCiAJCXJl
dHVybiAwOwogCi0JR0VNX1RSQUNFKCJmbGFncz0leCAoJXMpLCB0aW1lb3V0PSVsZCVzLCBhd2Fr
ZT89JXNcbiIsCisJR0VNX1RSQUNFKCJmbGFncz0leCAoJXMpLCB0aW1lb3V0PSVsZCVzXG4iLAog
CQkgIGZsYWdzLCBmbGFncyAmIEk5MTVfV0FJVF9MT0NLRUQgPyAibG9ja2VkIiA6ICJ1bmxvY2tl
ZCIsCi0JCSAgdGltZW91dCwgdGltZW91dCA9PSBNQVhfU0NIRURVTEVfVElNRU9VVCA/ICIgKGZv
cmV2ZXIpIiA6ICIiLAotCQkgIHllc25vKGk5MTUtPmd0LmF3YWtlKSk7CisJCSAgdGltZW91dCwg
dGltZW91dCA9PSBNQVhfU0NIRURVTEVfVElNRU9VVCA/ICIgKGZvcmV2ZXIpIiA6ICIiKTsKIAog
CXRpbWVvdXQgPSB3YWl0X2Zvcl90aW1lbGluZXMoaTkxNSwgZmxhZ3MsIHRpbWVvdXQpOwogCWlm
ICh0aW1lb3V0IDwgMCkKIAkJcmV0dXJuIHRpbWVvdXQ7CiAKIAlpZiAoZmxhZ3MgJiBJOTE1X1dB
SVRfTE9DS0VEKSB7Ci0JCWludCBlcnI7Ci0KIAkJbG9ja2RlcF9hc3NlcnRfaGVsZCgmaTkxNS0+
ZHJtLnN0cnVjdF9tdXRleCk7CiAKLQkJZXJyID0gd2FpdF9mb3JfZW5naW5lcygmaTkxNS0+Z3Qp
OwotCQlpZiAoZXJyKQotCQkJcmV0dXJuIGVycjsKLQogCQlpOTE1X3JldGlyZV9yZXF1ZXN0cyhp
OTE1KTsKIAl9CiAKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2ludGVsX3dha2Vy
ZWYuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2ludGVsX3dha2VyZWYuYwppbmRleCAwNmJkOGIy
MTVjYzIuLmQ0NDQzZTgxYzFjOCAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50
ZWxfd2FrZXJlZi5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2ludGVsX3dha2VyZWYuYwpA
QCAtNCwyNSArNCwyNSBAQAogICogQ29weXJpZ2h0IMKpIDIwMTkgSW50ZWwgQ29ycG9yYXRpb24K
ICAqLwogCisjaW5jbHVkZSA8bGludXgvd2FpdF9iaXQuaD4KKwogI2luY2x1ZGUgImludGVsX3J1
bnRpbWVfcG0uaCIKICNpbmNsdWRlICJpbnRlbF93YWtlcmVmLmgiCiAKLXN0YXRpYyB2b2lkIHJw
bV9nZXQoc3RydWN0IGludGVsX3J1bnRpbWVfcG0gKnJwbSwgc3RydWN0IGludGVsX3dha2VyZWYg
KndmKQorc3RhdGljIHZvaWQgcnBtX2dldChzdHJ1Y3QgaW50ZWxfd2FrZXJlZiAqd2YpCiB7Ci0J
d2YtPndha2VyZWYgPSBpbnRlbF9ydW50aW1lX3BtX2dldChycG0pOworCXdmLT53YWtlcmVmID0g
aW50ZWxfcnVudGltZV9wbV9nZXQod2YtPnJwbSk7CiB9CiAKLXN0YXRpYyB2b2lkIHJwbV9wdXQo
c3RydWN0IGludGVsX3J1bnRpbWVfcG0gKnJwbSwgc3RydWN0IGludGVsX3dha2VyZWYgKndmKQor
c3RhdGljIHZvaWQgcnBtX3B1dChzdHJ1Y3QgaW50ZWxfd2FrZXJlZiAqd2YpCiB7CiAJaW50ZWxf
d2FrZXJlZl90IHdha2VyZWYgPSBmZXRjaF9hbmRfemVybygmd2YtPndha2VyZWYpOwogCi0JaW50
ZWxfcnVudGltZV9wbV9wdXQocnBtLCB3YWtlcmVmKTsKKwlpbnRlbF9ydW50aW1lX3BtX3B1dCh3
Zi0+cnBtLCB3YWtlcmVmKTsKIAlJTlRFTF9XQUtFUkVGX0JVR19PTighd2FrZXJlZik7CiB9CiAK
LWludCBfX2ludGVsX3dha2VyZWZfZ2V0X2ZpcnN0KHN0cnVjdCBpbnRlbF9ydW50aW1lX3BtICpy
cG0sCi0JCQkgICAgICBzdHJ1Y3QgaW50ZWxfd2FrZXJlZiAqd2YsCi0JCQkgICAgICBpbnQgKCpm
bikoc3RydWN0IGludGVsX3dha2VyZWYgKndmKSkKK2ludCBfX2ludGVsX3dha2VyZWZfZ2V0X2Zp
cnN0KHN0cnVjdCBpbnRlbF93YWtlcmVmICp3ZikKIHsKIAkvKgogCSAqIFRyZWF0IGdldC9wdXQg
YXMgZGlmZmVyZW50IHN1YmNsYXNzZXMsIGFzIHdlIG1heSBuZWVkIHRvIHJ1bgpAQCAtMzQsMTEg
KzM0LDExIEBAIGludCBfX2ludGVsX3dha2VyZWZfZ2V0X2ZpcnN0KHN0cnVjdCBpbnRlbF9ydW50
aW1lX3BtICpycG0sCiAJaWYgKCFhdG9taWNfcmVhZCgmd2YtPmNvdW50KSkgewogCQlpbnQgZXJy
OwogCi0JCXJwbV9nZXQocnBtLCB3Zik7CisJCXJwbV9nZXQod2YpOwogCi0JCWVyciA9IGZuKHdm
KTsKKwkJZXJyID0gd2YtPm9wcy0+Z2V0KHdmKTsKIAkJaWYgKHVubGlrZWx5KGVycikpIHsKLQkJ
CXJwbV9wdXQocnBtLCB3Zik7CisJCQlycG1fcHV0KHdmKTsKIAkJCW11dGV4X3VubG9jaygmd2Yt
Pm11dGV4KTsKIAkJCXJldHVybiBlcnI7CiAJCX0KQEAgLTUyLDI3ICs1Miw2NyBAQCBpbnQgX19p
bnRlbF93YWtlcmVmX2dldF9maXJzdChzdHJ1Y3QgaW50ZWxfcnVudGltZV9wbSAqcnBtLAogCXJl
dHVybiAwOwogfQogCi1pbnQgX19pbnRlbF93YWtlcmVmX3B1dF9sYXN0KHN0cnVjdCBpbnRlbF9y
dW50aW1lX3BtICpycG0sCi0JCQkgICAgIHN0cnVjdCBpbnRlbF93YWtlcmVmICp3ZiwKLQkJCSAg
ICAgaW50ICgqZm4pKHN0cnVjdCBpbnRlbF93YWtlcmVmICp3ZikpCitzdGF0aWMgdm9pZCBfX19f
aW50ZWxfd2FrZXJlZl9wdXRfbGFzdChzdHJ1Y3QgaW50ZWxfd2FrZXJlZiAqd2YpCiB7Ci0JaW50
IGVycjsKKwlpZiAoIWF0b21pY19kZWNfYW5kX3Rlc3QoJndmLT5jb3VudCkpCisJCWdvdG8gdW5s
b2NrOworCisJaWYgKGxpa2VseSghd2YtPm9wcy0+cHV0KHdmKSkpIHsKKwkJcnBtX3B1dCh3Zik7
CisJCXdha2VfdXBfdmFyKCZ3Zi0+d2FrZXJlZik7CisJfSBlbHNlIHsKKwkJLyogb3BzLT5wdXQo
KSBtdXN0IHNjaGVkdWxlIGl0cyBvd24gcmVsZWFzZSBvbiBkZWZlcnJhbCAqLworCQlhdG9taWNf
c2V0X3JlbGVhc2UoJndmLT5jb3VudCwgMSk7CisJfQogCi0JZXJyID0gZm4od2YpOwotCWlmIChs
aWtlbHkoIWVycikpCi0JCXJwbV9wdXQocnBtLCB3Zik7Ci0JZWxzZQotCQlhdG9taWNfaW5jKCZ3
Zi0+Y291bnQpOwordW5sb2NrOgogCW11dGV4X3VubG9jaygmd2YtPm11dGV4KTsKK30KKwordm9p
ZCBfX2ludGVsX3dha2VyZWZfcHV0X2xhc3Qoc3RydWN0IGludGVsX3dha2VyZWYgKndmKQorewor
CUlOVEVMX1dBS0VSRUZfQlVHX09OKHdvcmtfcGVuZGluZygmd2YtPndvcmspKTsKIAotCXJldHVy
biBlcnI7CisJLyogQXNzdW1lIHdlIGFyZSBub3QgaW4gcHJvY2VzcyBjb250ZXh0IGFuZCBzbyBj
YW5ub3Qgc2xlZXAuICovCisJaWYgKHdmLT5vcHMtPmZsYWdzICYgSU5URUxfV0FLRVJFRl9QVVRf
QVNZTkMgfHwKKwkgICAgIW11dGV4X3RyeWxvY2soJndmLT5tdXRleCkpIHsKKwkJc2NoZWR1bGVf
d29yaygmd2YtPndvcmspOworCQlyZXR1cm47CisJfQorCisJX19fX2ludGVsX3dha2VyZWZfcHV0
X2xhc3Qod2YpOwogfQogCi12b2lkIF9faW50ZWxfd2FrZXJlZl9pbml0KHN0cnVjdCBpbnRlbF93
YWtlcmVmICp3Ziwgc3RydWN0IGxvY2tfY2xhc3Nfa2V5ICprZXkpCitzdGF0aWMgdm9pZCBfX2lu
dGVsX3dha2VyZWZfcHV0X3dvcmsoc3RydWN0IHdvcmtfc3RydWN0ICp3cmspCiB7CisJc3RydWN0
IGludGVsX3dha2VyZWYgKndmID0gY29udGFpbmVyX29mKHdyaywgdHlwZW9mKCp3ZiksIHdvcmsp
OworCisJaWYgKGF0b21pY19hZGRfdW5sZXNzKCZ3Zi0+Y291bnQsIC0xLCAxKSkKKwkJcmV0dXJu
OworCisJbXV0ZXhfbG9jaygmd2YtPm11dGV4KTsKKwlfX19faW50ZWxfd2FrZXJlZl9wdXRfbGFz
dCh3Zik7Cit9CisKK3ZvaWQgX19pbnRlbF93YWtlcmVmX2luaXQoc3RydWN0IGludGVsX3dha2Vy
ZWYgKndmLAorCQkJICBzdHJ1Y3QgaW50ZWxfcnVudGltZV9wbSAqcnBtLAorCQkJICBjb25zdCBz
dHJ1Y3QgaW50ZWxfd2FrZXJlZl9vcHMgKm9wcywKKwkJCSAgc3RydWN0IGxvY2tfY2xhc3Nfa2V5
ICprZXkpCit7CisJd2YtPnJwbSA9IHJwbTsKKwl3Zi0+b3BzID0gb3BzOworCiAJX19tdXRleF9p
bml0KCZ3Zi0+bXV0ZXgsICJ3YWtlcmVmIiwga2V5KTsKIAlhdG9taWNfc2V0KCZ3Zi0+Y291bnQs
IDApOwogCXdmLT53YWtlcmVmID0gMDsKKworCUlOSVRfV09SSygmd2YtPndvcmssIF9faW50ZWxf
d2FrZXJlZl9wdXRfd29yayk7Cit9CisKK2ludCBpbnRlbF93YWtlcmVmX3dhaXRfZm9yX2lkbGUo
c3RydWN0IGludGVsX3dha2VyZWYgKndmKQoreworCXJldHVybiB3YWl0X3Zhcl9ldmVudF9raWxs
YWJsZSgmd2YtPndha2VyZWYsCisJCQkJICAgICAgICFpbnRlbF93YWtlcmVmX2lzX2FjdGl2ZSh3
ZikpOwogfQogCiBzdGF0aWMgdm9pZCB3YWtlcmVmX2F1dG9fdGltZW91dChzdHJ1Y3QgdGltZXJf
bGlzdCAqdCkKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2ludGVsX3dha2VyZWYu
aCBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2ludGVsX3dha2VyZWYuaAppbmRleCAxZDZmNTk4NmU0
ZTUuLjUzNWEzYTEyODY0YiAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50ZWxf
d2FrZXJlZi5oCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2ludGVsX3dha2VyZWYuaApAQCAt
OCwxMCArOCwxMiBAQAogI2RlZmluZSBJTlRFTF9XQUtFUkVGX0gKIAogI2luY2x1ZGUgPGxpbnV4
L2F0b21pYy5oPgorI2luY2x1ZGUgPGxpbnV4L2JpdHMuaD4KICNpbmNsdWRlIDxsaW51eC9tdXRl
eC5oPgogI2luY2x1ZGUgPGxpbnV4L3JlZmNvdW50Lmg+CiAjaW5jbHVkZSA8bGludXgvc3RhY2tk
ZXBvdC5oPgogI2luY2x1ZGUgPGxpbnV4L3RpbWVyLmg+CisjaW5jbHVkZSA8bGludXgvd29ya3F1
ZXVlLmg+CiAKICNpZiBJU19FTkFCTEVEKENPTkZJR19EUk1fSTkxNV9ERUJVRykKICNkZWZpbmUg
SU5URUxfV0FLRVJFRl9CVUdfT04oZXhwcikgQlVHX09OKGV4cHIpCkBAIC0yMCwyOSArMjIsNDIg
QEAKICNlbmRpZgogCiBzdHJ1Y3QgaW50ZWxfcnVudGltZV9wbTsKK3N0cnVjdCBpbnRlbF93YWtl
cmVmOwogCiB0eXBlZGVmIGRlcG90X3N0YWNrX2hhbmRsZV90IGludGVsX3dha2VyZWZfdDsKIAor
c3RydWN0IGludGVsX3dha2VyZWZfb3BzIHsKKwlpbnQgKCpnZXQpKHN0cnVjdCBpbnRlbF93YWtl
cmVmICp3Zik7CisJaW50ICgqcHV0KShzdHJ1Y3QgaW50ZWxfd2FrZXJlZiAqd2YpOworCisJdW5z
aWduZWQgbG9uZyBmbGFnczsKKyNkZWZpbmUgSU5URUxfV0FLRVJFRl9QVVRfQVNZTkMgQklUKDAp
Cit9OworCiBzdHJ1Y3QgaW50ZWxfd2FrZXJlZiB7CiAJYXRvbWljX3QgY291bnQ7CiAJc3RydWN0
IG11dGV4IG11dGV4OworCiAJaW50ZWxfd2FrZXJlZl90IHdha2VyZWY7CisKKwlzdHJ1Y3QgaW50
ZWxfcnVudGltZV9wbSAqcnBtOworCWNvbnN0IHN0cnVjdCBpbnRlbF93YWtlcmVmX29wcyAqb3Bz
OworCisJc3RydWN0IHdvcmtfc3RydWN0IHdvcms7CiB9OwogCiB2b2lkIF9faW50ZWxfd2FrZXJl
Zl9pbml0KHN0cnVjdCBpbnRlbF93YWtlcmVmICp3ZiwKKwkJCSAgc3RydWN0IGludGVsX3J1bnRp
bWVfcG0gKnJwbSwKKwkJCSAgY29uc3Qgc3RydWN0IGludGVsX3dha2VyZWZfb3BzICpvcHMsCiAJ
CQkgIHN0cnVjdCBsb2NrX2NsYXNzX2tleSAqa2V5KTsKLSNkZWZpbmUgaW50ZWxfd2FrZXJlZl9p
bml0KHdmKSBkbyB7CQkJCQlcCisjZGVmaW5lIGludGVsX3dha2VyZWZfaW5pdCh3ZiwgcnBtLCBv
cHMpIGRvIHsJCQkJXAogCXN0YXRpYyBzdHJ1Y3QgbG9ja19jbGFzc19rZXkgX19rZXk7CQkJCVwK
IAkJCQkJCQkJCVwKLQlfX2ludGVsX3dha2VyZWZfaW5pdCgod2YpLCAmX19rZXkpOwkJCQlcCisJ
X19pbnRlbF93YWtlcmVmX2luaXQoKHdmKSwgKHJwbSksIChvcHMpLCAmX19rZXkpOwkJXAogfSB3
aGlsZSAoMCkKIAotaW50IF9faW50ZWxfd2FrZXJlZl9nZXRfZmlyc3Qoc3RydWN0IGludGVsX3J1
bnRpbWVfcG0gKnJwbSwKLQkJCSAgICAgIHN0cnVjdCBpbnRlbF93YWtlcmVmICp3ZiwKLQkJCSAg
ICAgIGludCAoKmZuKShzdHJ1Y3QgaW50ZWxfd2FrZXJlZiAqd2YpKTsKLWludCBfX2ludGVsX3dh
a2VyZWZfcHV0X2xhc3Qoc3RydWN0IGludGVsX3J1bnRpbWVfcG0gKnJwbSwKLQkJCSAgICAgc3Ry
dWN0IGludGVsX3dha2VyZWYgKndmLAotCQkJICAgICBpbnQgKCpmbikoc3RydWN0IGludGVsX3dh
a2VyZWYgKndmKSk7CitpbnQgX19pbnRlbF93YWtlcmVmX2dldF9maXJzdChzdHJ1Y3QgaW50ZWxf
d2FrZXJlZiAqd2YpOwordm9pZCBfX2ludGVsX3dha2VyZWZfcHV0X2xhc3Qoc3RydWN0IGludGVs
X3dha2VyZWYgKndmKTsKIAogLyoqCiAgKiBpbnRlbF93YWtlcmVmX2dldDogQWNxdWlyZSB0aGUg
d2FrZXJlZgpAQCAtNjEsMTIgKzc2LDEwIEBAIGludCBfX2ludGVsX3dha2VyZWZfcHV0X2xhc3Qo
c3RydWN0IGludGVsX3J1bnRpbWVfcG0gKnJwbSwKICAqIGNvZGUgb3RoZXJ3aXNlLgogICovCiBz
dGF0aWMgaW5saW5lIGludAotaW50ZWxfd2FrZXJlZl9nZXQoc3RydWN0IGludGVsX3J1bnRpbWVf
cG0gKnJwbSwKLQkJICBzdHJ1Y3QgaW50ZWxfd2FrZXJlZiAqd2YsCi0JCSAgaW50ICgqZm4pKHN0
cnVjdCBpbnRlbF93YWtlcmVmICp3ZikpCitpbnRlbF93YWtlcmVmX2dldChzdHJ1Y3QgaW50ZWxf
d2FrZXJlZiAqd2YpCiB7CiAJaWYgKHVubGlrZWx5KCFhdG9taWNfaW5jX25vdF96ZXJvKCZ3Zi0+
Y291bnQpKSkKLQkJcmV0dXJuIF9faW50ZWxfd2FrZXJlZl9nZXRfZmlyc3QocnBtLCB3ZiwgZm4p
OworCQlyZXR1cm4gX19pbnRlbF93YWtlcmVmX2dldF9maXJzdCh3Zik7CiAKIAlyZXR1cm4gMDsK
IH0KQEAgLTEwMiwxNiArMTE1LDEyIEBAIGludGVsX3dha2VyZWZfZ2V0X2lmX2FjdGl2ZShzdHJ1
Y3QgaW50ZWxfd2FrZXJlZiAqd2YpCiAgKiBSZXR1cm5zOiAwIGlmIHRoZSB3YWtlcmVmIHdhcyBy
ZWxlYXNlZCBzdWNjZXNzZnVsbHksIG9yIGEgbmVnYXRpdmUgZXJyb3IKICAqIGNvZGUgb3RoZXJ3
aXNlLgogICovCi1zdGF0aWMgaW5saW5lIGludAotaW50ZWxfd2FrZXJlZl9wdXQoc3RydWN0IGlu
dGVsX3J1bnRpbWVfcG0gKnJwbSwKLQkJICBzdHJ1Y3QgaW50ZWxfd2FrZXJlZiAqd2YsCi0JCSAg
aW50ICgqZm4pKHN0cnVjdCBpbnRlbF93YWtlcmVmICp3ZikpCitzdGF0aWMgaW5saW5lIHZvaWQK
K2ludGVsX3dha2VyZWZfcHV0KHN0cnVjdCBpbnRlbF93YWtlcmVmICp3ZikKIHsKIAlJTlRFTF9X
QUtFUkVGX0JVR19PTihhdG9taWNfcmVhZCgmd2YtPmNvdW50KSA8PSAwKTsKLQlpZiAoYXRvbWlj
X2RlY19hbmRfbXV0ZXhfbG9jaygmd2YtPmNvdW50LCAmd2YtPm11dGV4KSkKLQkJcmV0dXJuIF9f
aW50ZWxfd2FrZXJlZl9wdXRfbGFzdChycG0sIHdmLCBmbik7Ci0KLQlyZXR1cm4gMDsKKwlpZiAo
dW5saWtlbHkoIWF0b21pY19hZGRfdW5sZXNzKCZ3Zi0+Y291bnQsIC0xLCAxKSkpCisJCV9faW50
ZWxfd2FrZXJlZl9wdXRfbGFzdCh3Zik7CiB9CiAKIC8qKgpAQCAtMTU0LDYgKzE2MywxOSBAQCBp
bnRlbF93YWtlcmVmX2lzX2FjdGl2ZShjb25zdCBzdHJ1Y3QgaW50ZWxfd2FrZXJlZiAqd2YpCiAJ
cmV0dXJuIFJFQURfT05DRSh3Zi0+d2FrZXJlZik7CiB9CiAKKy8qKgorICogaW50ZWxfd2FrZXJl
Zl93YWl0X2Zvcl9pZGxlOiBXYWl0IHVudGlsIHRoZSB3YWtlcmVmIGlzIGlkbGUKKyAqIEB3Zjog
dGhlIHdha2VyZWYKKyAqCisgKiBXYWl0IGZvciB0aGUgZWFybGllciBhc3luY2hyb25vdXMgcmVs
ZWFzZSBvZiB0aGUgd2FrZXJlZi4gTm90ZQorICogdGhpcyB3aWxsIHdhaXQgZm9yIGFueSB0aGly
ZCBwYXJ0eSBhcyB3ZWxsLCBzbyBtYWtlIHN1cmUgeW91IG9ubHkgd2FpdAorICogd2hlbiB5b3Ug
aGF2ZSBjb250cm9sIG92ZXIgdGhlIHdha2VyZWYgYW5kIHRydXN0IG5vIG9uZSBlbHNlIGlzIGFj
cXVpcmluZworICogaXQuCisgKgorICogUmV0dXJuOiAwIG9uIHN1Y2Nlc3MsIGVycm9yIGNvZGUg
aWYga2lsbGVkLgorICovCitpbnQgaW50ZWxfd2FrZXJlZl93YWl0X2Zvcl9pZGxlKHN0cnVjdCBp
bnRlbF93YWtlcmVmICp3Zik7CisKIHN0cnVjdCBpbnRlbF93YWtlcmVmX2F1dG8gewogCXN0cnVj
dCBpbnRlbF9ydW50aW1lX3BtICpycG07CiAJc3RydWN0IHRpbWVyX2xpc3QgdGltZXI7CmRpZmYg
LS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMvaTkxNV9saXZlX3NlbGZ0ZXN0
cy5oIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvc2VsZnRlc3RzL2k5MTVfbGl2ZV9zZWxmdGVzdHMu
aAppbmRleCBhODQxZDNmOWJlZGMuLjFjY2YwZjczMWFjMCAxMDA2NDQKLS0tIGEvZHJpdmVycy9n
cHUvZHJtL2k5MTUvc2VsZnRlc3RzL2k5MTVfbGl2ZV9zZWxmdGVzdHMuaAorKysgYi9kcml2ZXJz
L2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMvaTkxNV9saXZlX3NlbGZ0ZXN0cy5oCkBAIC0xMiwxMCAr
MTIsMTEgQEAKIHNlbGZ0ZXN0KHNhbml0eWNoZWNrLCBpOTE1X2xpdmVfc2FuaXR5Y2hlY2spIC8q
IGtlZXAgZmlyc3QgKGlndCBzZWxmY2hlY2spICovCiBzZWxmdGVzdCh1bmNvcmUsIGludGVsX3Vu
Y29yZV9saXZlX3NlbGZ0ZXN0cykKIHNlbGZ0ZXN0KHdvcmthcm91bmRzLCBpbnRlbF93b3JrYXJv
dW5kc19saXZlX3NlbGZ0ZXN0cykKLXNlbGZ0ZXN0KHRpbWVsaW5lcywgaW50ZWxfdGltZWxpbmVf
bGl2ZV9zZWxmdGVzdHMpCitzZWxmdGVzdChndF9lbmdpbmVzLCBpbnRlbF9lbmdpbmVfbGl2ZV9z
ZWxmdGVzdHMpCitzZWxmdGVzdChndF90aW1lbGluZXMsIGludGVsX3RpbWVsaW5lX2xpdmVfc2Vs
ZnRlc3RzKQorc2VsZnRlc3QoZ3RfY29udGV4dHMsIGludGVsX2NvbnRleHRfbGl2ZV9zZWxmdGVz
dHMpCiBzZWxmdGVzdChyZXF1ZXN0cywgaTkxNV9yZXF1ZXN0X2xpdmVfc2VsZnRlc3RzKQogc2Vs
ZnRlc3QoYWN0aXZlLCBpOTE1X2FjdGl2ZV9saXZlX3NlbGZ0ZXN0cykKLXNlbGZ0ZXN0KGd0X2Nv
bnRleHRzLCBpbnRlbF9jb250ZXh0X2xpdmVfc2VsZnRlc3RzKQogc2VsZnRlc3Qob2JqZWN0cywg
aTkxNV9nZW1fb2JqZWN0X2xpdmVfc2VsZnRlc3RzKQogc2VsZnRlc3QobW1hbiwgaTkxNV9nZW1f
bW1hbl9saXZlX3NlbGZ0ZXN0cykKIHNlbGZ0ZXN0KGRtYWJ1ZiwgaTkxNV9nZW1fZG1hYnVmX2xp
dmVfc2VsZnRlc3RzKQotLSAKMi4yMy4wLnJjMQoKX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX18KSW50ZWwtZ2Z4IG1haWxpbmcgbGlzdApJbnRlbC1nZnhAbGlz
dHMuZnJlZWRlc2t0b3Aub3JnCmh0dHBzOi8vbGlzdHMuZnJlZWRlc2t0b3Aub3JnL21haWxtYW4v
bGlzdGluZm8vaW50ZWwtZ2Z4

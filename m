Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 4812CCBBF2
	for <lists+intel-gfx@lfdr.de>; Fri,  4 Oct 2019 15:40:48 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 455356EB8C;
	Fri,  4 Oct 2019 13:40:42 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from fireflyinternet.com (mail.fireflyinternet.com [109.228.58.192])
 by gabe.freedesktop.org (Postfix) with ESMTPS id B0A206EB87
 for <intel-gfx@lists.freedesktop.org>; Fri,  4 Oct 2019 13:40:39 +0000 (UTC)
X-Default-Received-SPF: pass (skip=forwardok (res=PASS))
 x-ip-name=78.156.65.138; 
Received: from haswell.alporthouse.com (unverified [78.156.65.138]) 
 by fireflyinternet.com (Firefly Internet (M1)) with ESMTP id 18723957-1500050 
 for multiple; Fri, 04 Oct 2019 14:40:18 +0100
From: Chris Wilson <chris@chris-wilson.co.uk>
To: intel-gfx@lists.freedesktop.org
Date: Fri,  4 Oct 2019 14:40:02 +0100
Message-Id: <20191004134015.13204-8-chris@chris-wilson.co.uk>
X-Mailer: git-send-email 2.23.0
In-Reply-To: <20191004134015.13204-1-chris@chris-wilson.co.uk>
References: <20191004134015.13204-1-chris@chris-wilson.co.uk>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH 07/20] drm/i915: Drop struct_mutex from around
 i915_retire_requests()
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

V2UgZG9uJ3QgbmVlZCB0byBob2xkIHN0cnVjdF9tdXRleCBub3cgZm9yIHJldGlyaW5nIHJlcXVl
c3RzLCBzbyBkcm9wIGl0CmZyb20gaTkxNV9yZXRpcmVfcmVxdWVzdHMoKSBhbmQgaTkxNV9nZW1f
d2FpdF9mb3JfaWRsZSgpLCBmaW5hbGx5CnJlbW92aW5nIEk5MTVfV0FJVF9MT0NLRUQgZm9yIGdv
b2QuCgpTaWduZWQtb2ZmLWJ5OiBDaHJpcyBXaWxzb24gPGNocmlzQGNocmlzLXdpbHNvbi5jby51
az4KUmV2aWV3ZWQtYnk6IFR2cnRrbyBVcnN1bGluIDx0dnJ0a28udXJzdWxpbkBpbnRlbC5jb20+
Ci0tLQogLi4uL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fY2xpZW50X2JsdC5jICAgIHwgICA3
ICstCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fY29udGV4dC5jICAgfCAgMjAg
Ky0tCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fcG0uYyAgICAgICAgfCAgNDUg
KystLS0tCiAuLi4vaTkxNS9nZW0vc2VsZnRlc3RzL2k5MTVfZ2VtX2NvaGVyZW5jeS5jICAgfCAg
NDAgKysrLS0KIC4uLi9kcm0vaTkxNS9nZW0vc2VsZnRlc3RzL2k5MTVfZ2VtX2NvbnRleHQuYyB8
ICAxOCArLS0KIC4uLi9kcm0vaTkxNS9nZW0vc2VsZnRlc3RzL2k5MTVfZ2VtX21tYW4uYyAgICB8
ICAgNiArLQogLi4uL2k5MTUvZ2VtL3NlbGZ0ZXN0cy9pOTE1X2dlbV9vYmplY3RfYmx0LmMgIHwg
ICA0IC0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2d0X3BtLmMgICAgICAgICB8ICAy
OCArLS0tCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9zZWxmdGVzdF9jb250ZXh0LmMgICAgfCAg
IDQgKy0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L3NlbGZ0ZXN0X2hhbmdjaGVjay5jICB8ICA4
OSArKy0tLS0tLS0tLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qvc2VsZnRlc3RfbHJjLmMgICAg
ICAgIHwgIDIzICsrLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qvc2VsZnRlc3RfdGltZWxpbmUu
YyAgIHwgIDkxICsrKysrLS0tLS0tCiAuLi4vZ3B1L2RybS9pOTE1L2d0L3NlbGZ0ZXN0X3dvcmth
cm91bmRzLmMgICAgfCAgIDYgKy0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZGVidWdmcy5j
ICAgICAgICAgICB8ICA0MiArKy0tLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9nZW0uYyAg
ICAgICAgICAgICAgIHwgIDE5ICstLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9yZXF1ZXN0
LmggICAgICAgICAgIHwgICA3ICstCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMvaTkx
NV9hY3RpdmUuYyAgfCAgIDggKy0KIC4uLi9ncHUvZHJtL2k5MTUvc2VsZnRlc3RzL2k5MTVfZ2Vt
X2V2aWN0LmMgICB8ICAgMiArLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvc2VsZnRlc3RzL2k5MTVf
Z2VtX2d0dC5jIHwgICA2ICstCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMvaTkxNV9y
ZXF1ZXN0LmMgfCAxNTEgKysrKystLS0tLS0tLS0tLS0tCiAuLi4vZ3B1L2RybS9pOTE1L3NlbGZ0
ZXN0cy9pOTE1X3NlbGZ0ZXN0LmMgICAgfCAgIDggKy0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L3Nl
bGZ0ZXN0cy9pOTE1X3ZtYS5jICAgICB8ICAgNCAtCiAuLi4vZ3B1L2RybS9pOTE1L3NlbGZ0ZXN0
cy9pZ3RfZmx1c2hfdGVzdC5jICAgfCAgMzAgKystLQogLi4uL2dwdS9kcm0vaTkxNS9zZWxmdGVz
dHMvaWd0X2ZsdXNoX3Rlc3QuaCAgIHwgICAyICstCiAuLi4vZ3B1L2RybS9pOTE1L3NlbGZ0ZXN0
cy9pZ3RfbGl2ZV90ZXN0LmMgICAgfCAgIDkgKy0KIC4uLi9ncHUvZHJtL2k5MTUvc2VsZnRlc3Rz
L21vY2tfZ2VtX2RldmljZS5jICB8ICAgNCAtCiAyNiBmaWxlcyBjaGFuZ2VkLCAyMTMgaW5zZXJ0
aW9ucygrKSwgNDYwIGRlbGV0aW9ucygtKQoKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9p
OTE1L2dlbS9pOTE1X2dlbV9jbGllbnRfYmx0LmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0v
aTkxNV9nZW1fY2xpZW50X2JsdC5jCmluZGV4IGMxZmNhNTcyOGU2ZS4uODEzNjZhYTQ4MTJiIDEw
MDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fY2xpZW50X2JsdC5j
CisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9jbGllbnRfYmx0LmMKQEAg
LTE1NSw3ICsxNTUsNiBAQCBzdGF0aWMgdm9pZCBjbGVhcl9wYWdlc19kbWFfZmVuY2VfY2Ioc3Ry
dWN0IGRtYV9mZW5jZSAqZmVuY2UsCiBzdGF0aWMgdm9pZCBjbGVhcl9wYWdlc193b3JrZXIoc3Ry
dWN0IHdvcmtfc3RydWN0ICp3b3JrKQogewogCXN0cnVjdCBjbGVhcl9wYWdlc193b3JrICp3ID0g
Y29udGFpbmVyX29mKHdvcmssIHR5cGVvZigqdyksIHdvcmspOwotCXN0cnVjdCBkcm1faTkxNV9w
cml2YXRlICppOTE1ID0gdy0+Y2UtPmVuZ2luZS0+aTkxNTsKIAlzdHJ1Y3QgZHJtX2k5MTVfZ2Vt
X29iamVjdCAqb2JqID0gdy0+c2xlZXZlLT52bWEtPm9iajsKIAlzdHJ1Y3QgaTkxNV92bWEgKnZt
YSA9IHctPnNsZWV2ZS0+dm1hOwogCXN0cnVjdCBpOTE1X3JlcXVlc3QgKnJxOwpAQCAtMTczLDEx
ICsxNzIsOSBAQCBzdGF0aWMgdm9pZCBjbGVhcl9wYWdlc193b3JrZXIoc3RydWN0IHdvcmtfc3Ry
dWN0ICp3b3JrKQogCW9iai0+cmVhZF9kb21haW5zID0gSTkxNV9HRU1fR1BVX0RPTUFJTlM7CiAJ
b2JqLT53cml0ZV9kb21haW4gPSAwOwogCi0JLyogWFhYOiB3ZSBuZWVkIHRvIGtpbGwgdGhpcyAq
LwotCW11dGV4X2xvY2soJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwogCWVyciA9IGk5MTVfdm1h
X3Bpbih2bWEsIDAsIDAsIFBJTl9VU0VSKTsKIAlpZiAodW5saWtlbHkoZXJyKSkKLQkJZ290byBv
dXRfdW5sb2NrOworCQlnb3RvIG91dF9zaWduYWw7CiAKIAliYXRjaCA9IGludGVsX2VtaXRfdm1h
X2ZpbGxfYmx0KHctPmNlLCB2bWEsIHctPnZhbHVlKTsKIAlpZiAoSVNfRVJSKGJhdGNoKSkgewpA
QCAtMjI5LDggKzIyNiw2IEBAIHN0YXRpYyB2b2lkIGNsZWFyX3BhZ2VzX3dvcmtlcihzdHJ1Y3Qg
d29ya19zdHJ1Y3QgKndvcmspCiAJaW50ZWxfZW1pdF92bWFfcmVsZWFzZSh3LT5jZSwgYmF0Y2gp
Owogb3V0X3VucGluOgogCWk5MTVfdm1hX3VucGluKHZtYSk7Ci1vdXRfdW5sb2NrOgotCW11dGV4
X3VubG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CiBvdXRfc2lnbmFsOgogCWlmICh1bmxp
a2VseShlcnIpKSB7CiAJCWRtYV9mZW5jZV9zZXRfZXJyb3IoJnctPmRtYSwgZXJyKTsKZGlmZiAt
LWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9jb250ZXh0LmMgYi9kcml2
ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fY29udGV4dC5jCmluZGV4IDlkODVhYWI2OGQz
NC4uMGFiNDE2ODg3ZmMyIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkx
NV9nZW1fY29udGV4dC5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9j
b250ZXh0LmMKQEAgLTExNTksOCArMTE1OSw3IEBAIGdlbjhfbW9kaWZ5X3JwY3Moc3RydWN0IGlu
dGVsX2NvbnRleHQgKmNlLCBzdHJ1Y3QgaW50ZWxfc3NldSBzc2V1KQogfQogCiBzdGF0aWMgaW50
Ci1fX2ludGVsX2NvbnRleHRfcmVjb25maWd1cmVfc3NldShzdHJ1Y3QgaW50ZWxfY29udGV4dCAq
Y2UsCi0JCQkJIHN0cnVjdCBpbnRlbF9zc2V1IHNzZXUpCitpbnRlbF9jb250ZXh0X3JlY29uZmln
dXJlX3NzZXUoc3RydWN0IGludGVsX2NvbnRleHQgKmNlLCBzdHJ1Y3QgaW50ZWxfc3NldSBzc2V1
KQogewogCWludCByZXQ7CiAKQEAgLTExODMsMjMgKzExODIsNiBAQCBfX2ludGVsX2NvbnRleHRf
cmVjb25maWd1cmVfc3NldShzdHJ1Y3QgaW50ZWxfY29udGV4dCAqY2UsCiAJcmV0dXJuIHJldDsK
IH0KIAotc3RhdGljIGludAotaW50ZWxfY29udGV4dF9yZWNvbmZpZ3VyZV9zc2V1KHN0cnVjdCBp
bnRlbF9jb250ZXh0ICpjZSwgc3RydWN0IGludGVsX3NzZXUgc3NldSkKLXsKLQlzdHJ1Y3QgZHJt
X2k5MTVfcHJpdmF0ZSAqaTkxNSA9IGNlLT5lbmdpbmUtPmk5MTU7Ci0JaW50IHJldDsKLQotCXJl
dCA9IG11dGV4X2xvY2tfaW50ZXJydXB0aWJsZSgmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7Ci0J
aWYgKHJldCkKLQkJcmV0dXJuIHJldDsKLQotCXJldCA9IF9faW50ZWxfY29udGV4dF9yZWNvbmZp
Z3VyZV9zc2V1KGNlLCBzc2V1KTsKLQotCW11dGV4X3VubG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9t
dXRleCk7Ci0KLQlyZXR1cm4gcmV0OwotfQotCiBzdGF0aWMgaW50CiB1c2VyX3RvX2NvbnRleHRf
c3NldShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwKIAkJICAgICBjb25zdCBzdHJ1Y3Qg
ZHJtX2k5MTVfZ2VtX2NvbnRleHRfcGFyYW1fc3NldSAqdXNlciwKZGlmZiAtLWdpdCBhL2RyaXZl
cnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9wbS5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUv
Z2VtL2k5MTVfZ2VtX3BtLmMKaW5kZXggNTE4MGIyZWUxY2I3Li4yZGRjM2FlYWFjOWQgMTAwNjQ0
Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9wbS5jCisrKyBiL2RyaXZl
cnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9wbS5jCkBAIC00OCwxMSArNDgsNyBAQCBzdGF0
aWMgdm9pZCByZXRpcmVfd29ya19oYW5kbGVyKHN0cnVjdCB3b3JrX3N0cnVjdCAqd29yaykKIAlz
dHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9CiAJCWNvbnRhaW5lcl9vZih3b3JrLCB0eXBl
b2YoKmk5MTUpLCBnZW0ucmV0aXJlX3dvcmsud29yayk7CiAKLQkvKiBDb21lIGJhY2sgbGF0ZXIg
aWYgdGhlIGRldmljZSBpcyBidXN5Li4uICovCi0JaWYgKG11dGV4X3RyeWxvY2soJmk5MTUtPmRy
bS5zdHJ1Y3RfbXV0ZXgpKSB7Ci0JCWk5MTVfcmV0aXJlX3JlcXVlc3RzKGk5MTUpOwotCQltdXRl
eF91bmxvY2soJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwotCX0KKwlpOTE1X3JldGlyZV9yZXF1
ZXN0cyhpOTE1KTsKIAogCXF1ZXVlX2RlbGF5ZWRfd29yayhpOTE1LT53cSwKIAkJCSAgICZpOTE1
LT5nZW0ucmV0aXJlX3dvcmssCkBAIC04NiwyNiArODIsMjMgQEAgc3RhdGljIGJvb2wgc3dpdGNo
X3RvX2tlcm5lbF9jb250ZXh0X3N5bmMoc3RydWN0IGludGVsX2d0ICpndCkKIHsKIAlib29sIHJl
c3VsdCA9ICFpbnRlbF9ndF9pc193ZWRnZWQoZ3QpOwogCi0JZG8gewotCQlpZiAoaTkxNV9nZW1f
d2FpdF9mb3JfaWRsZShndC0+aTkxNSwKLQkJCQkJICAgSTkxNV9XQUlUX0xPQ0tFRCB8Ci0JCQkJ
CSAgIEk5MTVfV0FJVF9GT1JfSURMRV9CT09TVCwKLQkJCQkJICAgSTkxNV9HRU1fSURMRV9USU1F
T1VUKSA9PSAtRVRJTUUpIHsKLQkJCS8qIFhYWCBoaWRlIHdhcm5pbmcgZnJvbSBnZW1fZWlvICov
Ci0JCQlpZiAoaTkxNV9tb2RwYXJhbXMucmVzZXQpIHsKLQkJCQlkZXZfZXJyKGd0LT5pOTE1LT5k
cm0uZGV2LAotCQkJCQkiRmFpbGVkIHRvIGlkbGUgZW5naW5lcywgZGVjbGFyaW5nIHdlZGdlZCFc
biIpOwotCQkJCUdFTV9UUkFDRV9EVU1QKCk7Ci0JCQl9Ci0KLQkJCS8qCi0JCQkgKiBGb3JjaWJs
eSBjYW5jZWwgb3V0c3RhbmRpbmcgd29yayBhbmQgbGVhdmUKLQkJCSAqIHRoZSBncHUgcXVpZXQu
Ci0JCQkgKi8KLQkJCWludGVsX2d0X3NldF93ZWRnZWQoZ3QpOwotCQkJcmVzdWx0ID0gZmFsc2U7
CisJaWYgKGk5MTVfZ2VtX3dhaXRfZm9yX2lkbGUoZ3QtPmk5MTUsCisJCQkJICAgSTkxNV9XQUlU
X0ZPUl9JRExFX0JPT1NULAorCQkJCSAgIEk5MTVfR0VNX0lETEVfVElNRU9VVCkgPT0gLUVUSU1F
KSB7CisJCS8qIFhYWCBoaWRlIHdhcm5pbmcgZnJvbSBnZW1fZWlvICovCisJCWlmIChpOTE1X21v
ZHBhcmFtcy5yZXNldCkgeworCQkJZGV2X2VycihndC0+aTkxNS0+ZHJtLmRldiwKKwkJCQkiRmFp
bGVkIHRvIGlkbGUgZW5naW5lcywgZGVjbGFyaW5nIHdlZGdlZCFcbiIpOworCQkJR0VNX1RSQUNF
X0RVTVAoKTsKIAkJfQotCX0gd2hpbGUgKGk5MTVfcmV0aXJlX3JlcXVlc3RzKGd0LT5pOTE1KSAm
JiByZXN1bHQpOworCisJCS8qCisJCSAqIEZvcmNpYmx5IGNhbmNlbCBvdXRzdGFuZGluZyB3b3Jr
IGFuZCBsZWF2ZQorCQkgKiB0aGUgZ3B1IHF1aWV0LgorCQkgKi8KKwkJaW50ZWxfZ3Rfc2V0X3dl
ZGdlZChndCk7CisJCXJlc3VsdCA9IGZhbHNlOworCX0KIAogCWlmIChpbnRlbF9ndF9wbV93YWl0
X2Zvcl9pZGxlKGd0KSkKIAkJcmVzdWx0ID0gZmFsc2U7CkBAIC0xNDUsOCArMTM4LDYgQEAgdm9p
ZCBpOTE1X2dlbV9zdXNwZW5kKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KQogCiAJdXNl
cl9mb3JjZXdha2UoJmk5MTUtPmd0LCB0cnVlKTsKIAotCW11dGV4X2xvY2soJmk5MTUtPmRybS5z
dHJ1Y3RfbXV0ZXgpOwotCiAJLyoKIAkgKiBXZSBoYXZlIHRvIGZsdXNoIGFsbCB0aGUgZXhlY3V0
aW5nIGNvbnRleHRzIHRvIG1haW4gbWVtb3J5IHNvCiAJICogdGhhdCB0aGV5IGNhbiBzYXZlZCBp
biB0aGUgaGliZXJuYXRpb24gaW1hZ2UuIFRvIGVuc3VyZSB0aGUgbGFzdApAQCAtMTU4LDggKzE0
OSw2IEBAIHZvaWQgaTkxNV9nZW1fc3VzcGVuZChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkx
NSkKIAkgKi8KIAlzd2l0Y2hfdG9fa2VybmVsX2NvbnRleHRfc3luYygmaTkxNS0+Z3QpOwogCi0J
bXV0ZXhfdW5sb2NrKCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsKLQogCWNhbmNlbF9kZWxheWVk
X3dvcmtfc3luYygmaTkxNS0+Z3QuaGFuZ2NoZWNrLndvcmspOwogCiAJaTkxNV9nZW1fZHJhaW5f
ZnJlZWRfb2JqZWN0cyhpOTE1KTsKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dl
bS9zZWxmdGVzdHMvaTkxNV9nZW1fY29oZXJlbmN5LmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9n
ZW0vc2VsZnRlc3RzL2k5MTVfZ2VtX2NvaGVyZW5jeS5jCmluZGV4IDBmZjdhODlhYWRjYS4uNTQ5
ODEwZjcwYWViIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vc2VsZnRlc3Rz
L2k5MTVfZ2VtX2NvaGVyZW5jeS5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9zZWxm
dGVzdHMvaTkxNV9nZW1fY29oZXJlbmN5LmMKQEAgLTcsNiArNyw3IEBACiAjaW5jbHVkZSA8bGlu
dXgvcHJpbWVfbnVtYmVycy5oPgogCiAjaW5jbHVkZSAiZ3QvaW50ZWxfZ3QuaCIKKyNpbmNsdWRl
ICJndC9pbnRlbF9ndF9wbS5oIgogCiAjaW5jbHVkZSAiaTkxNV9zZWxmdGVzdC5oIgogI2luY2x1
ZGUgInNlbGZ0ZXN0cy9pOTE1X3JhbmRvbS5oIgpAQCAtNzgsNyArNzksNyBAQCBzdGF0aWMgaW50
IGd0dF9zZXQoc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iaiwKIHsKIAlzdHJ1Y3QgaTkx
NV92bWEgKnZtYTsKIAl1MzIgX19pb21lbSAqbWFwOwotCWludCBlcnI7CisJaW50IGVyciA9IDA7
CiAKIAlpOTE1X2dlbV9vYmplY3RfbG9jayhvYmopOwogCWVyciA9IGk5MTVfZ2VtX29iamVjdF9z
ZXRfdG9fZ3R0X2RvbWFpbihvYmosIHRydWUpOwpAQCAtOTAsMTUgKzkxLDIxIEBAIHN0YXRpYyBp
bnQgZ3R0X3NldChzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2JqLAogCWlmIChJU19FUlIo
dm1hKSkKIAkJcmV0dXJuIFBUUl9FUlIodm1hKTsKIAorCWludGVsX2d0X3BtX2dldCh2bWEtPnZt
LT5ndCk7CisKIAltYXAgPSBpOTE1X3ZtYV9waW5faW9tYXAodm1hKTsKIAlpOTE1X3ZtYV91bnBp
bih2bWEpOwotCWlmIChJU19FUlIobWFwKSkKLQkJcmV0dXJuIFBUUl9FUlIobWFwKTsKKwlpZiAo
SVNfRVJSKG1hcCkpIHsKKwkJZXJyID0gUFRSX0VSUihtYXApOworCQlnb3RvIG91dF9ycG07CisJ
fQogCiAJaW93cml0ZTMyKHYsICZtYXBbb2Zmc2V0IC8gc2l6ZW9mKCptYXApXSk7CiAJaTkxNV92
bWFfdW5waW5faW9tYXAodm1hKTsKIAotCXJldHVybiAwOworb3V0X3JwbToKKwlpbnRlbF9ndF9w
bV9wdXQodm1hLT52bS0+Z3QpOworCXJldHVybiBlcnI7CiB9CiAKIHN0YXRpYyBpbnQgZ3R0X2dl
dChzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2JqLApAQCAtMTA3LDcgKzExNCw3IEBAIHN0
YXRpYyBpbnQgZ3R0X2dldChzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2JqLAogewogCXN0
cnVjdCBpOTE1X3ZtYSAqdm1hOwogCXUzMiBfX2lvbWVtICptYXA7Ci0JaW50IGVycjsKKwlpbnQg
ZXJyID0gMDsKIAogCWk5MTVfZ2VtX29iamVjdF9sb2NrKG9iaik7CiAJZXJyID0gaTkxNV9nZW1f
b2JqZWN0X3NldF90b19ndHRfZG9tYWluKG9iaiwgZmFsc2UpOwpAQCAtMTE5LDE1ICsxMjYsMjEg
QEAgc3RhdGljIGludCBndHRfZ2V0KHN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmosCiAJ
aWYgKElTX0VSUih2bWEpKQogCQlyZXR1cm4gUFRSX0VSUih2bWEpOwogCisJaW50ZWxfZ3RfcG1f
Z2V0KHZtYS0+dm0tPmd0KTsKKwogCW1hcCA9IGk5MTVfdm1hX3Bpbl9pb21hcCh2bWEpOwogCWk5
MTVfdm1hX3VucGluKHZtYSk7Ci0JaWYgKElTX0VSUihtYXApKQotCQlyZXR1cm4gUFRSX0VSUiht
YXApOworCWlmIChJU19FUlIobWFwKSkgeworCQllcnIgPSBQVFJfRVJSKG1hcCk7CisJCWdvdG8g
b3V0X3JwbTsKKwl9CiAKIAkqdiA9IGlvcmVhZDMyKCZtYXBbb2Zmc2V0IC8gc2l6ZW9mKCptYXAp
XSk7CiAJaTkxNV92bWFfdW5waW5faW9tYXAodm1hKTsKIAotCXJldHVybiAwOworb3V0X3JwbToK
KwlpbnRlbF9ndF9wbV9wdXQodm1hLT52bS0+Z3QpOworCXJldHVybiBlcnI7CiB9CiAKIHN0YXRp
YyBpbnQgd2Nfc2V0KHN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmosCkBAIC0yODAsNyAr
MjkzLDYgQEAgc3RhdGljIGludCBpZ3RfZ2VtX2NvaGVyZW5jeSh2b2lkICphcmcpCiAJc3RydWN0
IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSBhcmc7CiAJY29uc3Qgc3RydWN0IGlndF9jb2hlcmVu
Y3lfbW9kZSAqcmVhZCwgKndyaXRlLCAqb3ZlcjsKIAlzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVj
dCAqb2JqOwotCWludGVsX3dha2VyZWZfdCB3YWtlcmVmOwogCXVuc2lnbmVkIGxvbmcgY291bnQs
IG47CiAJdTMyICpvZmZzZXRzLCAqdmFsdWVzOwogCWludCBlcnIgPSAwOwpAQCAtMjk5LDggKzMx
MSw2IEBAIHN0YXRpYyBpbnQgaWd0X2dlbV9jb2hlcmVuY3kodm9pZCAqYXJnKQogCiAJdmFsdWVz
ID0gb2Zmc2V0cyArIG5jYWNoZWxpbmVzOwogCi0JbXV0ZXhfbG9jaygmaTkxNS0+ZHJtLnN0cnVj
dF9tdXRleCk7Ci0Jd2FrZXJlZiA9IGludGVsX3J1bnRpbWVfcG1fZ2V0KCZpOTE1LT5ydW50aW1l
X3BtKTsKIAlmb3IgKG92ZXIgPSBpZ3RfY29oZXJlbmN5X21vZGU7IG92ZXItPm5hbWU7IG92ZXIr
KykgewogCQlpZiAoIW92ZXItPnNldCkKIAkJCWNvbnRpbnVlOwpAQCAtMzI2LDcgKzMzNiw3IEBA
IHN0YXRpYyBpbnQgaWd0X2dlbV9jb2hlcmVuY3kodm9pZCAqYXJnKQogCQkJCQlvYmogPSBpOTE1
X2dlbV9vYmplY3RfY3JlYXRlX2ludGVybmFsKGk5MTUsIFBBR0VfU0laRSk7CiAJCQkJCWlmIChJ
U19FUlIob2JqKSkgewogCQkJCQkJZXJyID0gUFRSX0VSUihvYmopOwotCQkJCQkJZ290byB1bmxv
Y2s7CisJCQkJCQlnb3RvIGZyZWU7CiAJCQkJCX0KIAogCQkJCQlpOTE1X3JhbmRvbV9yZW9yZGVy
KG9mZnNldHMsIG5jYWNoZWxpbmVzLCAmcHJuZyk7CkBAIC0zNzcsMTUgKzM4NywxMyBAQCBzdGF0
aWMgaW50IGlndF9nZW1fY29oZXJlbmN5KHZvaWQgKmFyZykKIAkJCX0KIAkJfQogCX0KLXVubG9j
azoKLQlpbnRlbF9ydW50aW1lX3BtX3B1dCgmaTkxNS0+cnVudGltZV9wbSwgd2FrZXJlZik7Ci0J
bXV0ZXhfdW5sb2NrKCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsKK2ZyZWU6CiAJa2ZyZWUob2Zm
c2V0cyk7CiAJcmV0dXJuIGVycjsKIAogcHV0X29iamVjdDoKIAlpOTE1X2dlbV9vYmplY3RfcHV0
KG9iaik7Ci0JZ290byB1bmxvY2s7CisJZ290byBmcmVlOwogfQogCiBpbnQgaTkxNV9nZW1fY29o
ZXJlbmN5X2xpdmVfc2VsZnRlc3RzKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KQpkaWZm
IC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL3NlbGZ0ZXN0cy9pOTE1X2dlbV9jb250
ZXh0LmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vc2VsZnRlc3RzL2k5MTVfZ2VtX2NvbnRl
eHQuYwppbmRleCA4ZWJhMGQzYTMxZGUuLmY1NDAyYWFkOWI1YSAxMDA2NDQKLS0tIGEvZHJpdmVy
cy9ncHUvZHJtL2k5MTUvZ2VtL3NlbGZ0ZXN0cy9pOTE1X2dlbV9jb250ZXh0LmMKKysrIGIvZHJp
dmVycy9ncHUvZHJtL2k5MTUvZ2VtL3NlbGZ0ZXN0cy9pOTE1X2dlbV9jb250ZXh0LmMKQEAgLTE2
NCw3ICsxNjQsNiBAQCBzdHJ1Y3QgcGFyYWxsZWxfc3dpdGNoIHsKIHN0YXRpYyBpbnQgX19saXZl
X3BhcmFsbGVsX3N3aXRjaDEodm9pZCAqZGF0YSkKIHsKIAlzdHJ1Y3QgcGFyYWxsZWxfc3dpdGNo
ICphcmcgPSBkYXRhOwotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0gYXJnLT5jZVsw
XS0+ZW5naW5lLT5pOTE1OwogCUlHVF9USU1FT1VUKGVuZF90aW1lKTsKIAl1bnNpZ25lZCBsb25n
IGNvdW50OwogCkBAIC0xNzYsMTYgKzE3NSwxMiBAQCBzdGF0aWMgaW50IF9fbGl2ZV9wYXJhbGxl
bF9zd2l0Y2gxKHZvaWQgKmRhdGEpCiAJCWZvciAobiA9IDA7IG4gPCBBUlJBWV9TSVpFKGFyZy0+
Y2UpOyBuKyspIHsKIAkJCWk5MTVfcmVxdWVzdF9wdXQocnEpOwogCi0JCQltdXRleF9sb2NrKCZp
OTE1LT5kcm0uc3RydWN0X211dGV4KTsKIAkJCXJxID0gaTkxNV9yZXF1ZXN0X2NyZWF0ZShhcmct
PmNlW25dKTsKLQkJCWlmIChJU19FUlIocnEpKSB7Ci0JCQkJbXV0ZXhfdW5sb2NrKCZpOTE1LT5k
cm0uc3RydWN0X211dGV4KTsKKwkJCWlmIChJU19FUlIocnEpKQogCQkJCXJldHVybiBQVFJfRVJS
KHJxKTsKLQkJCX0KIAogCQkJaTkxNV9yZXF1ZXN0X2dldChycSk7CiAJCQlpOTE1X3JlcXVlc3Rf
YWRkKHJxKTsKLQkJCW11dGV4X3VubG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CiAJCX0K
IAogCQllcnIgPSAwOwpAQCAtMjA1LDcgKzIwMCw2IEBAIHN0YXRpYyBpbnQgX19saXZlX3BhcmFs
bGVsX3N3aXRjaDEodm9pZCAqZGF0YSkKIHN0YXRpYyBpbnQgX19saXZlX3BhcmFsbGVsX3N3aXRj
aE4odm9pZCAqZGF0YSkKIHsKIAlzdHJ1Y3QgcGFyYWxsZWxfc3dpdGNoICphcmcgPSBkYXRhOwot
CXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0gYXJnLT5jZVswXS0+ZW5naW5lLT5pOTE1
OwogCUlHVF9USU1FT1VUKGVuZF90aW1lKTsKIAl1bnNpZ25lZCBsb25nIGNvdW50OwogCWludCBu
OwpAQCAtMjE1LDE1ICsyMDksMTEgQEAgc3RhdGljIGludCBfX2xpdmVfcGFyYWxsZWxfc3dpdGNo
Tih2b2lkICpkYXRhKQogCQlmb3IgKG4gPSAwOyBuIDwgQVJSQVlfU0laRShhcmctPmNlKTsgbisr
KSB7CiAJCQlzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpycTsKIAotCQkJbXV0ZXhfbG9jaygmaTkxNS0+
ZHJtLnN0cnVjdF9tdXRleCk7CiAJCQlycSA9IGk5MTVfcmVxdWVzdF9jcmVhdGUoYXJnLT5jZVtu
XSk7Ci0JCQlpZiAoSVNfRVJSKHJxKSkgewotCQkJCW11dGV4X3VubG9jaygmaTkxNS0+ZHJtLnN0
cnVjdF9tdXRleCk7CisJCQlpZiAoSVNfRVJSKHJxKSkKIAkJCQlyZXR1cm4gUFRSX0VSUihycSk7
Ci0JCQl9CiAKIAkJCWk5MTVfcmVxdWVzdF9hZGQocnEpOwotCQkJbXV0ZXhfdW5sb2NrKCZpOTE1
LT5kcm0uc3RydWN0X211dGV4KTsKIAkJfQogCiAJCWNvdW50Kys7CkBAIC0xMTczLDcgKzExNjMs
NyBAQCBfX3NzZXVfdGVzdChjb25zdCBjaGFyICpuYW1lLAogCWlmIChyZXQpCiAJCXJldHVybiBy
ZXQ7CiAKLQlyZXQgPSBfX2ludGVsX2NvbnRleHRfcmVjb25maWd1cmVfc3NldShjZSwgc3NldSk7
CisJcmV0ID0gaW50ZWxfY29udGV4dF9yZWNvbmZpZ3VyZV9zc2V1KGNlLCBzc2V1KTsKIAlpZiAo
cmV0KQogCQlnb3RvIG91dF9zcGluOwogCkBAIC0xMjc3LDcgKzEyNjcsNyBAQCBfX2lndF9jdHhf
c3NldShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwKIAkJZ290byBvdXRfZmFpbDsKIAog
b3V0X2ZhaWw6Ci0JaWYgKGlndF9mbHVzaF90ZXN0KGk5MTUsIEk5MTVfV0FJVF9MT0NLRUQpKQor
CWlmIChpZ3RfZmx1c2hfdGVzdChpOTE1KSkKIAkJcmV0ID0gLUVJTzsKIAogCWludGVsX2NvbnRl
eHRfdW5waW4oY2UpOwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL3NlbGZ0
ZXN0cy9pOTE1X2dlbV9tbWFuLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vc2VsZnRlc3Rz
L2k5MTVfZ2VtX21tYW4uYwppbmRleCAzNmFjYTFjMTcyZTcuLjg1NmI4ZTQ2N2VlOCAxMDA2NDQK
LS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL3NlbGZ0ZXN0cy9pOTE1X2dlbV9tbWFuLmMK
KysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL3NlbGZ0ZXN0cy9pOTE1X2dlbV9tbWFuLmMK
QEAgLTU4MSwxMiArNTgxLDggQEAgc3RhdGljIHZvaWQgZGlzYWJsZV9yZXRpcmVfd29ya2VyKHN0
cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KQogCiBzdGF0aWMgdm9pZCByZXN0b3JlX3JldGly
ZV93b3JrZXIoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpCiB7CisJaWd0X2ZsdXNoX3Rl
c3QoaTkxNSk7CiAJaW50ZWxfZ3RfcG1fcHV0KCZpOTE1LT5ndCk7Ci0KLQltdXRleF9sb2NrKCZp
OTE1LT5kcm0uc3RydWN0X211dGV4KTsKLQlpZ3RfZmx1c2hfdGVzdChpOTE1LCBJOTE1X1dBSVRf
TE9DS0VEKTsKLQltdXRleF91bmxvY2soJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwotCiAJaTkx
NV9nZW1fZHJpdmVyX3JlZ2lzdGVyX19zaHJpbmtlcihpOTE1KTsKIH0KIApkaWZmIC0tZ2l0IGEv
ZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL3NlbGZ0ZXN0cy9pOTE1X2dlbV9vYmplY3RfYmx0LmMg
Yi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vc2VsZnRlc3RzL2k5MTVfZ2VtX29iamVjdF9ibHQu
YwppbmRleCBjMjFkNzQ3ZTdkMDUuLjllYzU1YjNhMzgxNSAxMDA2NDQKLS0tIGEvZHJpdmVycy9n
cHUvZHJtL2k5MTUvZ2VtL3NlbGZ0ZXN0cy9pOTE1X2dlbV9vYmplY3RfYmx0LmMKKysrIGIvZHJp
dmVycy9ncHUvZHJtL2k5MTUvZ2VtL3NlbGZ0ZXN0cy9pOTE1X2dlbV9vYmplY3RfYmx0LmMKQEAg
LTY1LDkgKzY1LDcgQEAgc3RhdGljIGludCBpZ3RfZmlsbF9ibHQodm9pZCAqYXJnKQogCQlpZiAo
IShvYmotPmNhY2hlX2NvaGVyZW50ICYgSTkxNV9CT19DQUNIRV9DT0hFUkVOVF9GT1JfV1JJVEUp
KQogCQkJb2JqLT5jYWNoZV9kaXJ0eSA9IHRydWU7CiAKLQkJbXV0ZXhfbG9jaygmaTkxNS0+ZHJt
LnN0cnVjdF9tdXRleCk7CiAJCWVyciA9IGk5MTVfZ2VtX29iamVjdF9maWxsX2JsdChvYmosIGNl
LCB2YWwpOwotCQltdXRleF91bmxvY2soJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwogCQlpZiAo
ZXJyKQogCQkJZ290byBlcnJfdW5waW47CiAKQEAgLTE2Niw5ICsxNjQsNyBAQCBzdGF0aWMgaW50
IGlndF9jb3B5X2JsdCh2b2lkICphcmcpCiAJCWlmICghKGRzdC0+Y2FjaGVfY29oZXJlbnQgJiBJ
OTE1X0JPX0NBQ0hFX0NPSEVSRU5UX0ZPUl9XUklURSkpCiAJCQlkc3QtPmNhY2hlX2RpcnR5ID0g
dHJ1ZTsKIAotCQltdXRleF9sb2NrKCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsKIAkJZXJyID0g
aTkxNV9nZW1fb2JqZWN0X2NvcHlfYmx0KHNyYywgZHN0LCBjZSk7Ci0JCW11dGV4X3VubG9jaygm
aTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CiAJCWlmIChlcnIpCiAJCQlnb3RvIGVycl91bnBpbjsK
IApkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfZ3RfcG0uYyBiL2Ry
aXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2d0X3BtLmMKaW5kZXggMjlmYTFkYWJiYzJlLi5k
NGNlZmRkMzg0MzEgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2d0
X3BtLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfZ3RfcG0uYwpAQCAtMTk2
LDI2ICsxOTYsMTQgQEAgaW50IGludGVsX2d0X3Jlc3VtZShzdHJ1Y3QgaW50ZWxfZ3QgKmd0KQog
CiBzdGF0aWMgdm9pZCB3YWl0X2Zvcl9pZGxlKHN0cnVjdCBpbnRlbF9ndCAqZ3QpCiB7Ci0JbXV0
ZXhfbG9jaygmZ3QtPmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOyAvKiBYWFggKi8KLQlkbyB7Ci0J
CWlmIChpOTE1X2dlbV93YWl0X2Zvcl9pZGxlKGd0LT5pOTE1LAotCQkJCQkgICBJOTE1X1dBSVRf
TE9DS0VELAotCQkJCQkgICBJOTE1X0dFTV9JRExFX1RJTUVPVVQpID09IC1FVElNRSkgewotCQkJ
LyogWFhYIGhpZGUgd2FybmluZyBmcm9tIGdlbV9laW8gKi8KLQkJCWlmIChpOTE1X21vZHBhcmFt
cy5yZXNldCkgewotCQkJCWRldl9lcnIoZ3QtPmk5MTUtPmRybS5kZXYsCi0JCQkJCSJGYWlsZWQg
dG8gaWRsZSBlbmdpbmVzLCBkZWNsYXJpbmcgd2VkZ2VkIVxuIik7Ci0JCQkJR0VNX1RSQUNFX0RV
TVAoKTsKLQkJCX0KLQotCQkJLyoKLQkJCSAqIEZvcmNpYmx5IGNhbmNlbCBvdXRzdGFuZGluZyB3
b3JrIGFuZCBsZWF2ZQotCQkJICogdGhlIGdwdSBxdWlldC4KLQkJCSAqLwotCQkJaW50ZWxfZ3Rf
c2V0X3dlZGdlZChndCk7Ci0JCX0KLQl9IHdoaWxlIChpOTE1X3JldGlyZV9yZXF1ZXN0cyhndC0+
aTkxNSkpOwotCW11dGV4X3VubG9jaygmZ3QtPmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOworCWlm
IChpOTE1X2dlbV93YWl0X2Zvcl9pZGxlKGd0LT5pOTE1LCAwLAorCQkJCSAgIEk5MTVfR0VNX0lE
TEVfVElNRU9VVCkgPT0gLUVUSU1FKSB7CisJCS8qCisJCSAqIEZvcmNpYmx5IGNhbmNlbCBvdXRz
dGFuZGluZyB3b3JrIGFuZCBsZWF2ZQorCQkgKiB0aGUgZ3B1IHF1aWV0LgorCQkgKi8KKwkJaW50
ZWxfZ3Rfc2V0X3dlZGdlZChndCk7CisJfQogCiAJaW50ZWxfZ3RfcG1fd2FpdF9mb3JfaWRsZShn
dCk7CiB9CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9zZWxmdGVzdF9jb250
ZXh0LmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9zZWxmdGVzdF9jb250ZXh0LmMKaW5kZXgg
ZTZiY2JlN2FiNWUxLi44NmNmZmJiMGE5Y2IgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9p
OTE1L2d0L3NlbGZ0ZXN0X2NvbnRleHQuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9z
ZWxmdGVzdF9jb250ZXh0LmMKQEAgLTMxOCw3ICszMTgsNyBAQCBzdGF0aWMgaW50IGxpdmVfYWN0
aXZlX2NvbnRleHQodm9pZCAqYXJnKQogCQlpZiAoZXJyKQogCQkJYnJlYWs7CiAKLQkJZXJyID0g
aWd0X2ZsdXNoX3Rlc3QoZ3QtPmk5MTUsIEk5MTVfV0FJVF9MT0NLRUQpOworCQllcnIgPSBpZ3Rf
Zmx1c2hfdGVzdChndC0+aTkxNSk7CiAJCWlmIChlcnIpCiAJCQlicmVhazsKIAl9CkBAIC00MzEs
NyArNDMxLDcgQEAgc3RhdGljIGludCBsaXZlX3JlbW90ZV9jb250ZXh0KHZvaWQgKmFyZykKIAkJ
aWYgKGVycikKIAkJCWJyZWFrOwogCi0JCWVyciA9IGlndF9mbHVzaF90ZXN0KGd0LT5pOTE1LCBJ
OTE1X1dBSVRfTE9DS0VEKTsKKwkJZXJyID0gaWd0X2ZsdXNoX3Rlc3QoZ3QtPmk5MTUpOwogCQlp
ZiAoZXJyKQogCQkJYnJlYWs7CiAJfQpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUv
Z3Qvc2VsZnRlc3RfaGFuZ2NoZWNrLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9zZWxmdGVz
dF9oYW5nY2hlY2suYwppbmRleCBkM2JlZTlmODgwMDguLmZmYmIzZDIzYjg4NyAxMDA2NDQKLS0t
IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qvc2VsZnRlc3RfaGFuZ2NoZWNrLmMKKysrIGIvZHJp
dmVycy9ncHUvZHJtL2k5MTUvZ3Qvc2VsZnRlc3RfaGFuZ2NoZWNrLmMKQEAgLTU4LDcgKzU4LDkg
QEAgc3RhdGljIGludCBoYW5nX2luaXQoc3RydWN0IGhhbmcgKmgsIHN0cnVjdCBpbnRlbF9ndCAq
Z3QpCiAJbWVtc2V0KGgsIDAsIHNpemVvZigqaCkpOwogCWgtPmd0ID0gZ3Q7CiAKKwltdXRleF9s
b2NrKCZndC0+aTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CiAJaC0+Y3R4ID0ga2VybmVsX2NvbnRl
eHQoZ3QtPmk5MTUpOworCW11dGV4X3VubG9jaygmZ3QtPmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgp
OwogCWlmIChJU19FUlIoaC0+Y3R4KSkKIAkJcmV0dXJuIFBUUl9FUlIoaC0+Y3R4KTsKIApAQCAt
Mjg1LDcgKzI4Nyw3IEBAIHN0YXRpYyB2b2lkIGhhbmdfZmluaShzdHJ1Y3QgaGFuZyAqaCkKIAog
CWtlcm5lbF9jb250ZXh0X2Nsb3NlKGgtPmN0eCk7CiAKLQlpZ3RfZmx1c2hfdGVzdChoLT5ndC0+
aTkxNSwgSTkxNV9XQUlUX0xPQ0tFRCk7CisJaWd0X2ZsdXNoX3Rlc3QoaC0+Z3QtPmk5MTUpOwog
fQogCiBzdGF0aWMgYm9vbCB3YWl0X3VudGlsX3J1bm5pbmcoc3RydWN0IGhhbmcgKmgsIHN0cnVj
dCBpOTE1X3JlcXVlc3QgKnJxKQpAQCAtMzA5LDEwICszMTEsOSBAQCBzdGF0aWMgaW50IGlndF9o
YW5nX3Nhbml0eWNoZWNrKHZvaWQgKmFyZykKIAogCS8qIEJhc2ljIGNoZWNrIHRoYXQgd2UgY2Fu
IGV4ZWN1dGUgb3VyIGhhbmdpbmcgYmF0Y2ggKi8KIAotCW11dGV4X2xvY2soJmd0LT5pOTE1LT5k
cm0uc3RydWN0X211dGV4KTsKIAllcnIgPSBoYW5nX2luaXQoJmgsIGd0KTsKIAlpZiAoZXJyKQot
CQlnb3RvIHVubG9jazsKKwkJcmV0dXJuIGVycjsKIAogCWZvcl9lYWNoX2VuZ2luZShlbmdpbmUs
IGd0LT5pOTE1LCBpZCkgewogCQlzdHJ1Y3QgaW50ZWxfd2VkZ2VfbWUgdzsKQEAgLTM1NSw4ICsz
NTYsNiBAQCBzdGF0aWMgaW50IGlndF9oYW5nX3Nhbml0eWNoZWNrKHZvaWQgKmFyZykKIAogZmlu
aToKIAloYW5nX2ZpbmkoJmgpOwotdW5sb2NrOgotCW11dGV4X3VubG9jaygmZ3QtPmk5MTUtPmRy
bS5zdHJ1Y3RfbXV0ZXgpOwogCXJldHVybiBlcnI7CiB9CiAKQEAgLTM5NSw4ICszOTQsNiBAQCBz
dGF0aWMgaW50IGlndF9yZXNldF9ub3Aodm9pZCAqYXJnKQogCXJlc2V0X2NvdW50ID0gaTkxNV9y
ZXNldF9jb3VudChnbG9iYWwpOwogCWNvdW50ID0gMDsKIAlkbyB7Ci0JCW11dGV4X2xvY2soJmd0
LT5pOTE1LT5kcm0uc3RydWN0X211dGV4KTsKLQogCQlmb3JfZWFjaF9lbmdpbmUoZW5naW5lLCBn
dC0+aTkxNSwgaWQpIHsKIAkJCWludCBpOwogCkBAIC00MTcsNyArNDE0LDYgQEAgc3RhdGljIGlu
dCBpZ3RfcmVzZXRfbm9wKHZvaWQgKmFyZykKIAkJaW50ZWxfZ3RfcmVzZXQoZ3QsIEFMTF9FTkdJ
TkVTLCBOVUxMKTsKIAkJaWd0X2dsb2JhbF9yZXNldF91bmxvY2soZ3QpOwogCi0JCW11dGV4X3Vu
bG9jaygmZ3QtPmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwogCQlpZiAoaW50ZWxfZ3RfaXNfd2Vk
Z2VkKGd0KSkgewogCQkJZXJyID0gLUVJTzsKIAkJCWJyZWFrOwpAQCAtNDI5LDE2ICs0MjUsMTMg
QEAgc3RhdGljIGludCBpZ3RfcmVzZXRfbm9wKHZvaWQgKmFyZykKIAkJCWJyZWFrOwogCQl9CiAK
LQkJZXJyID0gaWd0X2ZsdXNoX3Rlc3QoZ3QtPmk5MTUsIDApOworCQllcnIgPSBpZ3RfZmx1c2hf
dGVzdChndC0+aTkxNSk7CiAJCWlmIChlcnIpCiAJCQlicmVhazsKIAl9IHdoaWxlICh0aW1lX2Jl
Zm9yZShqaWZmaWVzLCBlbmRfdGltZSkpOwogCXByX2luZm8oIiVzOiAlZCByZXNldHNcbiIsIF9f
ZnVuY19fLCBjb3VudCk7CiAKLQltdXRleF9sb2NrKCZndC0+aTkxNS0+ZHJtLnN0cnVjdF9tdXRl
eCk7Ci0JZXJyID0gaWd0X2ZsdXNoX3Rlc3QoZ3QtPmk5MTUsIEk5MTVfV0FJVF9MT0NLRUQpOwot
CW11dGV4X3VubG9jaygmZ3QtPmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwotCisJZXJyID0gaWd0
X2ZsdXNoX3Rlc3QoZ3QtPmk5MTUpOwogb3V0OgogCW1vY2tfZmlsZV9mcmVlKGd0LT5pOTE1LCBm
aWxlKTsKIAlpZiAoaW50ZWxfZ3RfaXNfd2VkZ2VkKGd0KSkKQEAgLTQ5NCw3ICs0ODcsNiBAQCBz
dGF0aWMgaW50IGlndF9yZXNldF9ub3BfZW5naW5lKHZvaWQgKmFyZykKIAkJCQlicmVhazsKIAkJ
CX0KIAotCQkJbXV0ZXhfbG9jaygmZ3QtPmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwogCQkJZm9y
IChpID0gMDsgaSA8IDE2OyBpKyspIHsKIAkJCQlzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpycTsKIApA
QCAtNTA3LDcgKzQ5OSw2IEBAIHN0YXRpYyBpbnQgaWd0X3Jlc2V0X25vcF9lbmdpbmUodm9pZCAq
YXJnKQogCQkJCWk5MTVfcmVxdWVzdF9hZGQocnEpOwogCQkJfQogCQkJZXJyID0gaW50ZWxfZW5n
aW5lX3Jlc2V0KGVuZ2luZSwgTlVMTCk7Ci0JCQltdXRleF91bmxvY2soJmd0LT5pOTE1LT5kcm0u
c3RydWN0X211dGV4KTsKIAkJCWlmIChlcnIpIHsKIAkJCQlwcl9lcnIoImk5MTVfcmVzZXRfZW5n
aW5lIGZhaWxlZFxuIik7CiAJCQkJYnJlYWs7CkBAIC01MzMsMTUgKzUyNCwxMiBAQCBzdGF0aWMg
aW50IGlndF9yZXNldF9ub3BfZW5naW5lKHZvaWQgKmFyZykKIAkJaWYgKGVycikKIAkJCWJyZWFr
OwogCi0JCWVyciA9IGlndF9mbHVzaF90ZXN0KGd0LT5pOTE1LCAwKTsKKwkJZXJyID0gaWd0X2Zs
dXNoX3Rlc3QoZ3QtPmk5MTUpOwogCQlpZiAoZXJyKQogCQkJYnJlYWs7CiAJfQogCi0JbXV0ZXhf
bG9jaygmZ3QtPmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwotCWVyciA9IGlndF9mbHVzaF90ZXN0
KGd0LT5pOTE1LCBJOTE1X1dBSVRfTE9DS0VEKTsKLQltdXRleF91bmxvY2soJmd0LT5pOTE1LT5k
cm0uc3RydWN0X211dGV4KTsKLQorCWVyciA9IGlndF9mbHVzaF90ZXN0KGd0LT5pOTE1KTsKIG91
dDoKIAltb2NrX2ZpbGVfZnJlZShndC0+aTkxNSwgZmlsZSk7CiAJaWYgKGludGVsX2d0X2lzX3dl
ZGdlZChndCkpCkBAIC01NjMsOSArNTUxLDcgQEAgc3RhdGljIGludCBfX2lndF9yZXNldF9lbmdp
bmUoc3RydWN0IGludGVsX2d0ICpndCwgYm9vbCBhY3RpdmUpCiAJCXJldHVybiAwOwogCiAJaWYg
KGFjdGl2ZSkgewotCQltdXRleF9sb2NrKCZndC0+aTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CiAJ
CWVyciA9IGhhbmdfaW5pdCgmaCwgZ3QpOwotCQltdXRleF91bmxvY2soJmd0LT5pOTE1LT5kcm0u
c3RydWN0X211dGV4KTsKIAkJaWYgKGVycikKIAkJCXJldHVybiBlcnI7CiAJfQpAQCAtNTkzLDE3
ICs1NzksMTQgQEAgc3RhdGljIGludCBfX2lndF9yZXNldF9lbmdpbmUoc3RydWN0IGludGVsX2d0
ICpndCwgYm9vbCBhY3RpdmUpCiAJCQlpZiAoYWN0aXZlKSB7CiAJCQkJc3RydWN0IGk5MTVfcmVx
dWVzdCAqcnE7CiAKLQkJCQltdXRleF9sb2NrKCZndC0+aTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7
CiAJCQkJcnEgPSBoYW5nX2NyZWF0ZV9yZXF1ZXN0KCZoLCBlbmdpbmUpOwogCQkJCWlmIChJU19F
UlIocnEpKSB7CiAJCQkJCWVyciA9IFBUUl9FUlIocnEpOwotCQkJCQltdXRleF91bmxvY2soJmd0
LT5pOTE1LT5kcm0uc3RydWN0X211dGV4KTsKIAkJCQkJYnJlYWs7CiAJCQkJfQogCiAJCQkJaTkx
NV9yZXF1ZXN0X2dldChycSk7CiAJCQkJaTkxNV9yZXF1ZXN0X2FkZChycSk7Ci0JCQkJbXV0ZXhf
dW5sb2NrKCZndC0+aTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CiAKIAkJCQlpZiAoIXdhaXRfdW50
aWxfcnVubmluZygmaCwgcnEpKSB7CiAJCQkJCXN0cnVjdCBkcm1fcHJpbnRlciBwID0gZHJtX2lu
Zm9fcHJpbnRlcihndC0+aTkxNS0+ZHJtLmRldik7CkBAIC02NDcsNyArNjMwLDcgQEAgc3RhdGlj
IGludCBfX2lndF9yZXNldF9lbmdpbmUoc3RydWN0IGludGVsX2d0ICpndCwgYm9vbCBhY3RpdmUp
CiAJCWlmIChlcnIpCiAJCQlicmVhazsKIAotCQllcnIgPSBpZ3RfZmx1c2hfdGVzdChndC0+aTkx
NSwgMCk7CisJCWVyciA9IGlndF9mbHVzaF90ZXN0KGd0LT5pOTE1KTsKIAkJaWYgKGVycikKIAkJ
CWJyZWFrOwogCX0KQEAgLTY1NSwxMSArNjM4LDggQEAgc3RhdGljIGludCBfX2lndF9yZXNldF9l
bmdpbmUoc3RydWN0IGludGVsX2d0ICpndCwgYm9vbCBhY3RpdmUpCiAJaWYgKGludGVsX2d0X2lz
X3dlZGdlZChndCkpCiAJCWVyciA9IC1FSU87CiAKLQlpZiAoYWN0aXZlKSB7Ci0JCW11dGV4X2xv
Y2soJmd0LT5pOTE1LT5kcm0uc3RydWN0X211dGV4KTsKKwlpZiAoYWN0aXZlKQogCQloYW5nX2Zp
bmkoJmgpOwotCQltdXRleF91bmxvY2soJmd0LT5pOTE1LT5kcm0uc3RydWN0X211dGV4KTsKLQl9
CiAKIAlyZXR1cm4gZXJyOwogfQpAQCAtNzQxLDEwICs3MjEsOCBAQCBzdGF0aWMgaW50IGFjdGl2
ZV9lbmdpbmUodm9pZCAqZGF0YSkKIAkJc3RydWN0IGk5MTVfcmVxdWVzdCAqb2xkID0gcnFbaWR4
XTsKIAkJc3RydWN0IGk5MTVfcmVxdWVzdCAqbmV3OwogCi0JCW11dGV4X2xvY2soJmVuZ2luZS0+
aTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CiAJCW5ldyA9IGlndF9yZXF1ZXN0X2FsbG9jKGN0eFtp
ZHhdLCBlbmdpbmUpOwogCQlpZiAoSVNfRVJSKG5ldykpIHsKLQkJCW11dGV4X3VubG9jaygmZW5n
aW5lLT5pOTE1LT5kcm0uc3RydWN0X211dGV4KTsKIAkJCWVyciA9IFBUUl9FUlIobmV3KTsKIAkJ
CWJyZWFrOwogCQl9CkBAIC03NTUsNyArNzMzLDYgQEAgc3RhdGljIGludCBhY3RpdmVfZW5naW5l
KHZvaWQgKmRhdGEpCiAKIAkJcnFbaWR4XSA9IGk5MTVfcmVxdWVzdF9nZXQobmV3KTsKIAkJaTkx
NV9yZXF1ZXN0X2FkZChuZXcpOwotCQltdXRleF91bmxvY2soJmVuZ2luZS0+aTkxNS0+ZHJtLnN0
cnVjdF9tdXRleCk7CiAKIAkJZXJyID0gYWN0aXZlX3JlcXVlc3RfcHV0KG9sZCk7CiAJCWlmIChl
cnIpCkBAIC03OTUsOSArNzcyLDcgQEAgc3RhdGljIGludCBfX2lndF9yZXNldF9lbmdpbmVzKHN0
cnVjdCBpbnRlbF9ndCAqZ3QsCiAJCXJldHVybiAwOwogCiAJaWYgKGZsYWdzICYgVEVTVF9BQ1RJ
VkUpIHsKLQkJbXV0ZXhfbG9jaygmZ3QtPmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwogCQllcnIg
PSBoYW5nX2luaXQoJmgsIGd0KTsKLQkJbXV0ZXhfdW5sb2NrKCZndC0+aTkxNS0+ZHJtLnN0cnVj
dF9tdXRleCk7CiAJCWlmIChlcnIpCiAJCQlyZXR1cm4gZXJyOwogCkBAIC04NTUsMTcgKzgzMCwx
NCBAQCBzdGF0aWMgaW50IF9faWd0X3Jlc2V0X2VuZ2luZXMoc3RydWN0IGludGVsX2d0ICpndCwK
IAkJCXN0cnVjdCBpOTE1X3JlcXVlc3QgKnJxID0gTlVMTDsKIAogCQkJaWYgKGZsYWdzICYgVEVT
VF9BQ1RJVkUpIHsKLQkJCQltdXRleF9sb2NrKCZndC0+aTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7
CiAJCQkJcnEgPSBoYW5nX2NyZWF0ZV9yZXF1ZXN0KCZoLCBlbmdpbmUpOwogCQkJCWlmIChJU19F
UlIocnEpKSB7CiAJCQkJCWVyciA9IFBUUl9FUlIocnEpOwotCQkJCQltdXRleF91bmxvY2soJmd0
LT5pOTE1LT5kcm0uc3RydWN0X211dGV4KTsKIAkJCQkJYnJlYWs7CiAJCQkJfQogCiAJCQkJaTkx
NV9yZXF1ZXN0X2dldChycSk7CiAJCQkJaTkxNV9yZXF1ZXN0X2FkZChycSk7Ci0JCQkJbXV0ZXhf
dW5sb2NrKCZndC0+aTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CiAKIAkJCQlpZiAoIXdhaXRfdW50
aWxfcnVubmluZygmaCwgcnEpKSB7CiAJCQkJCXN0cnVjdCBkcm1fcHJpbnRlciBwID0gZHJtX2lu
Zm9fcHJpbnRlcihndC0+aTkxNS0+ZHJtLmRldik7CkBAIC05NzcsOSArOTQ5LDcgQEAgc3RhdGlj
IGludCBfX2lndF9yZXNldF9lbmdpbmVzKHN0cnVjdCBpbnRlbF9ndCAqZ3QsCiAJCWlmIChlcnIp
CiAJCQlicmVhazsKIAotCQltdXRleF9sb2NrKCZndC0+aTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7
Ci0JCWVyciA9IGlndF9mbHVzaF90ZXN0KGd0LT5pOTE1LCBJOTE1X1dBSVRfTE9DS0VEKTsKLQkJ
bXV0ZXhfdW5sb2NrKCZndC0+aTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CisJCWVyciA9IGlndF9m
bHVzaF90ZXN0KGd0LT5pOTE1KTsKIAkJaWYgKGVycikKIAkJCWJyZWFrOwogCX0KQEAgLTk4Nywx
MSArOTU3LDggQEAgc3RhdGljIGludCBfX2lndF9yZXNldF9lbmdpbmVzKHN0cnVjdCBpbnRlbF9n
dCAqZ3QsCiAJaWYgKGludGVsX2d0X2lzX3dlZGdlZChndCkpCiAJCWVyciA9IC1FSU87CiAKLQlp
ZiAoZmxhZ3MgJiBURVNUX0FDVElWRSkgewotCQltdXRleF9sb2NrKCZndC0+aTkxNS0+ZHJtLnN0
cnVjdF9tdXRleCk7CisJaWYgKGZsYWdzICYgVEVTVF9BQ1RJVkUpCiAJCWhhbmdfZmluaSgmaCk7
Ci0JCW11dGV4X3VubG9jaygmZ3QtPmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwotCX0KIAogCXJl
dHVybiBlcnI7CiB9CkBAIC0xMDYxLDcgKzEwMjgsNiBAQCBzdGF0aWMgaW50IGlndF9yZXNldF93
YWl0KHZvaWQgKmFyZykKIAogCWlndF9nbG9iYWxfcmVzZXRfbG9jayhndCk7CiAKLQltdXRleF9s
b2NrKCZndC0+aTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CiAJZXJyID0gaGFuZ19pbml0KCZoLCBn
dCk7CiAJaWYgKGVycikKIAkJZ290byB1bmxvY2s7CkBAIC0xMTA5LDcgKzEwNzUsNiBAQCBzdGF0
aWMgaW50IGlndF9yZXNldF93YWl0KHZvaWQgKmFyZykKIGZpbmk6CiAJaGFuZ19maW5pKCZoKTsK
IHVubG9jazoKLQltdXRleF91bmxvY2soJmd0LT5pOTE1LT5kcm0uc3RydWN0X211dGV4KTsKIAlp
Z3RfZ2xvYmFsX3Jlc2V0X3VubG9jayhndCk7CiAKIAlpZiAoaW50ZWxfZ3RfaXNfd2VkZ2VkKGd0
KSkKQEAgLTExODksMTAgKzExNTQsOSBAQCBzdGF0aWMgaW50IF9faWd0X3Jlc2V0X2V2aWN0X3Zt
YShzdHJ1Y3QgaW50ZWxfZ3QgKmd0LAogCiAJLyogQ2hlY2sgdGhhdCB3ZSBjYW4gcmVjb3ZlciBh
biB1bmJpbmQgc3R1Y2sgb24gYSBoYW5naW5nIHJlcXVlc3QgKi8KIAotCW11dGV4X2xvY2soJmd0
LT5pOTE1LT5kcm0uc3RydWN0X211dGV4KTsKIAllcnIgPSBoYW5nX2luaXQoJmgsIGd0KTsKIAlp
ZiAoZXJyKQotCQlnb3RvIHVubG9jazsKKwkJcmV0dXJuIGVycjsKIAogCW9iaiA9IGk5MTVfZ2Vt
X29iamVjdF9jcmVhdGVfaW50ZXJuYWwoZ3QtPmk5MTUsIFNaXzFNKTsKIAlpZiAoSVNfRVJSKG9i
aikpIHsKQEAgLTEyNTUsOCArMTIxOSw2IEBAIHN0YXRpYyBpbnQgX19pZ3RfcmVzZXRfZXZpY3Rf
dm1hKHN0cnVjdCBpbnRlbF9ndCAqZ3QsCiAJaWYgKGVycikKIAkJZ290byBvdXRfcnE7CiAKLQlt
dXRleF91bmxvY2soJmd0LT5pOTE1LT5kcm0uc3RydWN0X211dGV4KTsKLQogCWlmICghd2FpdF91
bnRpbF9ydW5uaW5nKCZoLCBycSkpIHsKIAkJc3RydWN0IGRybV9wcmludGVyIHAgPSBkcm1faW5m
b19wcmludGVyKGd0LT5pOTE1LT5kcm0uZGV2KTsKIApAQCAtMTMwNSwxNiArMTI2NywxMiBAQCBz
dGF0aWMgaW50IF9faWd0X3Jlc2V0X2V2aWN0X3ZtYShzdHJ1Y3QgaW50ZWxfZ3QgKmd0LAogCQlw
dXRfdGFza19zdHJ1Y3QodHNrKTsKIAl9CiAKLQltdXRleF9sb2NrKCZndC0+aTkxNS0+ZHJtLnN0
cnVjdF9tdXRleCk7CiBvdXRfcnE6CiAJaTkxNV9yZXF1ZXN0X3B1dChycSk7CiBvdXRfb2JqOgog
CWk5MTVfZ2VtX29iamVjdF9wdXQob2JqKTsKIGZpbmk6CiAJaGFuZ19maW5pKCZoKTsKLXVubG9j
azoKLQltdXRleF91bmxvY2soJmd0LT5pOTE1LT5kcm0uc3RydWN0X211dGV4KTsKLQogCWlmIChp
bnRlbF9ndF9pc193ZWRnZWQoZ3QpKQogCQlyZXR1cm4gLUVJTzsKIApAQCAtMTM5Niw3ICsxMzU0
LDYgQEAgc3RhdGljIGludCBpZ3RfcmVzZXRfcXVldWUodm9pZCAqYXJnKQogCiAJaWd0X2dsb2Jh
bF9yZXNldF9sb2NrKGd0KTsKIAotCW11dGV4X2xvY2soJmd0LT5pOTE1LT5kcm0uc3RydWN0X211
dGV4KTsKIAllcnIgPSBoYW5nX2luaXQoJmgsIGd0KTsKIAlpZiAoZXJyKQogCQlnb3RvIHVubG9j
azsKQEAgLTE1MTEsNyArMTQ2OCw3IEBAIHN0YXRpYyBpbnQgaWd0X3Jlc2V0X3F1ZXVlKHZvaWQg
KmFyZykKIAogCQlpOTE1X3JlcXVlc3RfcHV0KHByZXYpOwogCi0JCWVyciA9IGlndF9mbHVzaF90
ZXN0KGd0LT5pOTE1LCBJOTE1X1dBSVRfTE9DS0VEKTsKKwkJZXJyID0gaWd0X2ZsdXNoX3Rlc3Qo
Z3QtPmk5MTUpOwogCQlpZiAoZXJyKQogCQkJYnJlYWs7CiAJfQpAQCAtMTUxOSw3ICsxNDc2LDYg
QEAgc3RhdGljIGludCBpZ3RfcmVzZXRfcXVldWUodm9pZCAqYXJnKQogZmluaToKIAloYW5nX2Zp
bmkoJmgpOwogdW5sb2NrOgotCW11dGV4X3VubG9jaygmZ3QtPmk5MTUtPmRybS5zdHJ1Y3RfbXV0
ZXgpOwogCWlndF9nbG9iYWxfcmVzZXRfdW5sb2NrKGd0KTsKIAogCWlmIChpbnRlbF9ndF9pc193
ZWRnZWQoZ3QpKQpAQCAtMTU0NiwxMSArMTUwMiw5IEBAIHN0YXRpYyBpbnQgaWd0X2hhbmRsZV9l
cnJvcih2b2lkICphcmcpCiAJaWYgKCFlbmdpbmUgfHwgIWludGVsX2VuZ2luZV9jYW5fc3RvcmVf
ZHdvcmQoZW5naW5lKSkKIAkJcmV0dXJuIDA7CiAKLQltdXRleF9sb2NrKCZndC0+aTkxNS0+ZHJt
LnN0cnVjdF9tdXRleCk7Ci0KIAllcnIgPSBoYW5nX2luaXQoJmgsIGd0KTsKIAlpZiAoZXJyKQot
CQlnb3RvIGVycl91bmxvY2s7CisJCXJldHVybiBlcnI7CiAKIAlycSA9IGhhbmdfY3JlYXRlX3Jl
cXVlc3QoJmgsIGVuZ2luZSk7CiAJaWYgKElTX0VSUihycSkpIHsKQEAgLTE1NzQsOCArMTUyOCw2
IEBAIHN0YXRpYyBpbnQgaWd0X2hhbmRsZV9lcnJvcih2b2lkICphcmcpCiAJCWdvdG8gZXJyX3Jl
cXVlc3Q7CiAJfQogCi0JbXV0ZXhfdW5sb2NrKCZndC0+aTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7
Ci0KIAkvKiBUZW1wb3JhcmlseSBkaXNhYmxlIGVycm9yIGNhcHR1cmUgKi8KIAllcnJvciA9IHhj
aGcoJmdsb2JhbC0+Zmlyc3RfZXJyb3IsICh2b2lkICopLTEpOwogCkBAIC0xNTgzLDggKzE1MzUs
NiBAQCBzdGF0aWMgaW50IGlndF9oYW5kbGVfZXJyb3Iodm9pZCAqYXJnKQogCiAJeGNoZygmZ2xv
YmFsLT5maXJzdF9lcnJvciwgZXJyb3IpOwogCi0JbXV0ZXhfbG9jaygmZ3QtPmk5MTUtPmRybS5z
dHJ1Y3RfbXV0ZXgpOwotCiAJaWYgKHJxLT5mZW5jZS5lcnJvciAhPSAtRUlPKSB7CiAJCXByX2Vy
cigiR3VpbHR5IHJlcXVlc3Qgbm90IGlkZW50aWZpZWQhXG4iKTsKIAkJZXJyID0gLUVJTlZBTDsK
QEAgLTE1OTUsOCArMTU0NSw2IEBAIHN0YXRpYyBpbnQgaWd0X2hhbmRsZV9lcnJvcih2b2lkICph
cmcpCiAJaTkxNV9yZXF1ZXN0X3B1dChycSk7CiBlcnJfZmluaToKIAloYW5nX2ZpbmkoJmgpOwot
ZXJyX3VubG9jazoKLQltdXRleF91bmxvY2soJmd0LT5pOTE1LT5kcm0uc3RydWN0X211dGV4KTsK
IAlyZXR1cm4gZXJyOwogfQogCkBAIC0xNjg5LDcgKzE2MzcsNiBAQCBzdGF0aWMgaW50IGlndF9y
ZXNldF9lbmdpbmVzX2F0b21pYyh2b2lkICphcmcpCiAJCXJldHVybiAwOwogCiAJaWd0X2dsb2Jh
bF9yZXNldF9sb2NrKGd0KTsKLQltdXRleF9sb2NrKCZndC0+aTkxNS0+ZHJtLnN0cnVjdF9tdXRl
eCk7CiAKIAkvKiBGbHVzaCBhbnkgcmVxdWVzdHMgYmVmb3JlIHdlIGdldCBzdGFydGVkIGFuZCBj
aGVjayBiYXNpY3MgKi8KIAlpZiAoIWlndF9mb3JjZV9yZXNldChndCkpCkBAIC0xNzA5LDkgKzE2
NTYsNyBAQCBzdGF0aWMgaW50IGlndF9yZXNldF9lbmdpbmVzX2F0b21pYyh2b2lkICphcmcpCiBv
dXQ6CiAJLyogQXMgd2UgcG9rZSBhcm91bmQgdGhlIGd1dHMsIGRvIGEgZnVsbCByZXNldCBiZWZv
cmUgY29udGludWluZy4gKi8KIAlpZ3RfZm9yY2VfcmVzZXQoZ3QpOwotCiB1bmxvY2s6Ci0JbXV0
ZXhfdW5sb2NrKCZndC0+aTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CiAJaWd0X2dsb2JhbF9yZXNl
dF91bmxvY2soZ3QpOwogCiAJcmV0dXJuIGVycjsKQEAgLTE3NTEsMTAgKzE2OTYsNiBAQCBpbnQg
aW50ZWxfaGFuZ2NoZWNrX2xpdmVfc2VsZnRlc3RzKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpp
OTE1KQogCiAJZXJyID0gaW50ZWxfZ3RfbGl2ZV9zdWJ0ZXN0cyh0ZXN0cywgZ3QpOwogCi0JbXV0
ZXhfbG9jaygmZ3QtPmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwotCWlndF9mbHVzaF90ZXN0KGd0
LT5pOTE1LCBJOTE1X1dBSVRfTE9DS0VEKTsKLQltdXRleF91bmxvY2soJmd0LT5pOTE1LT5kcm0u
c3RydWN0X211dGV4KTsKLQogCWk5MTVfbW9kcGFyYW1zLmVuYWJsZV9oYW5nY2hlY2sgPSBzYXZl
ZF9oYW5nY2hlY2s7CiAJaW50ZWxfcnVudGltZV9wbV9wdXQoJmd0LT5pOTE1LT5ydW50aW1lX3Bt
LCB3YWtlcmVmKTsKIApkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qvc2VsZnRl
c3RfbHJjLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9zZWxmdGVzdF9scmMuYwppbmRleCBk
ZDI1NjM2YWJjNWIuLjA0YzFjZjU3MzY0MiAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5
MTUvZ3Qvc2VsZnRlc3RfbHJjLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qvc2VsZnRl
c3RfbHJjLmMKQEAgLTYxLDcgKzYxLDcgQEAgc3RhdGljIGludCBsaXZlX3Nhbml0eWNoZWNrKHZv
aWQgKmFyZykKIAkJfQogCiAJCWlndF9zcGlubmVyX2VuZCgmc3Bpbik7Ci0JCWlmIChpZ3RfZmx1
c2hfdGVzdChpOTE1LCBJOTE1X1dBSVRfTE9DS0VEKSkgeworCQlpZiAoaWd0X2ZsdXNoX3Rlc3Qo
aTkxNSkpIHsKIAkJCWVyciA9IC1FSU87CiAJCQlnb3RvIGVycl9jdHg7CiAJCX0KQEAgLTM4NCw4
ICszODQsNyBAQCBzbGljZV9zZW1hcGhvcmVfcXVldWUoc3RydWN0IGludGVsX2VuZ2luZV9jcyAq
b3V0ZXIsCiAJaWYgKGVycikKIAkJZ290byBvdXQ7CiAKLQlpZiAoaTkxNV9yZXF1ZXN0X3dhaXQo
aGVhZCwKLQkJCSAgICAgIEk5MTVfV0FJVF9MT0NLRUQsCisJaWYgKGk5MTVfcmVxdWVzdF93YWl0
KGhlYWQsIDAsCiAJCQkgICAgICAyICogUlVOVElNRV9JTkZPKG91dGVyLT5pOTE1KS0+bnVtX2Vu
Z2luZXMgKiAoY291bnQgKyAyKSAqIChjb3VudCArIDMpKSA8IDApIHsKIAkJcHJfZXJyKCJGYWls
ZWQgdG8gc2xpY2UgYWxvbmcgc2VtYXBob3JlIGNoYWluIG9mIGxlbmd0aCAoJWQsICVkKSFcbiIs
CiAJCSAgICAgICBjb3VudCwgbik7CkBAIC00NTcsNyArNDU2LDcgQEAgc3RhdGljIGludCBsaXZl
X3RpbWVzbGljZV9wcmVlbXB0KHZvaWQgKmFyZykKIAkJCWlmIChlcnIpCiAJCQkJZ290byBlcnJf
cGluOwogCi0JCQlpZiAoaWd0X2ZsdXNoX3Rlc3QoaTkxNSwgSTkxNV9XQUlUX0xPQ0tFRCkpIHsK
KwkJCWlmIChpZ3RfZmx1c2hfdGVzdChpOTE1KSkgewogCQkJCWVyciA9IC1FSU87CiAJCQkJZ290
byBlcnJfcGluOwogCQkJfQpAQCAtMTAxMCw3ICsxMDA5LDcgQEAgc3RhdGljIGludCBsaXZlX25v
cHJlZW1wdCh2b2lkICphcmcpCiAJCQlnb3RvIGVycl93ZWRnZWQ7CiAJCX0KIAotCQlpZiAoaWd0
X2ZsdXNoX3Rlc3QoaTkxNSwgSTkxNV9XQUlUX0xPQ0tFRCkpCisJCWlmIChpZ3RfZmx1c2hfdGVz
dChpOTE1KSkKIAkJCWdvdG8gZXJyX3dlZGdlZDsKIAl9CiAKQEAgLTEwNzUsNyArMTA3NCw3IEBA
IHN0YXRpYyBpbnQgbGl2ZV9zdXBwcmVzc19zZWxmX3ByZWVtcHQodm9pZCAqYXJnKQogCQlpZiAo
IWludGVsX2VuZ2luZV9oYXNfcHJlZW1wdGlvbihlbmdpbmUpKQogCQkJY29udGludWU7CiAKLQkJ
aWYgKGlndF9mbHVzaF90ZXN0KGk5MTUsIEk5MTVfV0FJVF9MT0NLRUQpKQorCQlpZiAoaWd0X2Zs
dXNoX3Rlc3QoaTkxNSkpCiAJCQlnb3RvIGVycl93ZWRnZWQ7CiAKIAkJaW50ZWxfZW5naW5lX3Bt
X2dldChlbmdpbmUpOwpAQCAtMTEzNiw3ICsxMTM1LDcgQEAgc3RhdGljIGludCBsaXZlX3N1cHBy
ZXNzX3NlbGZfcHJlZW1wdCh2b2lkICphcmcpCiAJCX0KIAogCQlpbnRlbF9lbmdpbmVfcG1fcHV0
KGVuZ2luZSk7Ci0JCWlmIChpZ3RfZmx1c2hfdGVzdChpOTE1LCBJOTE1X1dBSVRfTE9DS0VEKSkK
KwkJaWYgKGlndF9mbHVzaF90ZXN0KGk5MTUpKQogCQkJZ290byBlcnJfd2VkZ2VkOwogCX0KIApA
QCAtMTI5Nyw3ICsxMjk2LDcgQEAgc3RhdGljIGludCBsaXZlX3N1cHByZXNzX3dhaXRfcHJlZW1w
dCh2b2lkICphcmcpCiAJCQlmb3IgKGkgPSAwOyBpIDwgQVJSQVlfU0laRShjbGllbnQpOyBpKysp
CiAJCQkJaWd0X3NwaW5uZXJfZW5kKCZjbGllbnRbaV0uc3Bpbik7CiAKLQkJCWlmIChpZ3RfZmx1
c2hfdGVzdChpOTE1LCBJOTE1X1dBSVRfTE9DS0VEKSkKKwkJCWlmIChpZ3RfZmx1c2hfdGVzdChp
OTE1KSkKIAkJCQlnb3RvIGVycl93ZWRnZWQ7CiAKIAkJCWlmIChlbmdpbmUtPmV4ZWNsaXN0cy5w
cmVlbXB0X2hhbmcuY291bnQpIHsKQEAgLTE1NzYsNyArMTU3NSw3IEBAIHN0YXRpYyBpbnQgbGl2
ZV9wcmVlbXB0X2hhbmcodm9pZCAqYXJnKQogCiAJCWlndF9zcGlubmVyX2VuZCgmc3Bpbl9oaSk7
CiAJCWlndF9zcGlubmVyX2VuZCgmc3Bpbl9sbyk7Ci0JCWlmIChpZ3RfZmx1c2hfdGVzdChpOTE1
LCBJOTE1X1dBSVRfTE9DS0VEKSkgeworCQlpZiAoaWd0X2ZsdXNoX3Rlc3QoaTkxNSkpIHsKIAkJ
CWVyciA9IC1FSU87CiAJCQlnb3RvIGVycl9jdHhfbG87CiAJCX0KQEAgLTE5NzMsNyArMTk3Miw3
IEBAIHN0YXRpYyBpbnQgbm9wX3ZpcnR1YWxfZW5naW5lKHN0cnVjdCBkcm1faTkxNV9wcml2YXRl
ICppOTE1LAogCQlwcmltZSwgZGl2NjRfdTY0KGt0aW1lX3RvX25zKHRpbWVzWzFdKSwgcHJpbWUp
KTsKIAogb3V0OgotCWlmIChpZ3RfZmx1c2hfdGVzdChpOTE1LCBJOTE1X1dBSVRfTE9DS0VEKSkK
KwlpZiAoaWd0X2ZsdXNoX3Rlc3QoaTkxNSkpCiAJCWVyciA9IC1FSU87CiAKIAlmb3IgKG5jID0g
MDsgbmMgPCBuY3R4OyBuYysrKSB7CkBAIC0yMTE4LDcgKzIxMTcsNyBAQCBzdGF0aWMgaW50IG1h
c2tfdmlydHVhbF9lbmdpbmUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUsCiAJCWdvdG8g
b3V0OwogCiBvdXQ6Ci0JaWYgKGlndF9mbHVzaF90ZXN0KGk5MTUsIEk5MTVfV0FJVF9MT0NLRUQp
KQorCWlmIChpZ3RfZmx1c2hfdGVzdChpOTE1KSkKIAkJZXJyID0gLUVJTzsKIAogCWZvciAobiA9
IDA7IG4gPCBuc2libGluZzsgbisrKQpAQCAtMjI5Niw3ICsyMjk1LDcgQEAgc3RhdGljIGludCBi
b25kX3ZpcnR1YWxfZW5naW5lKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LAogb3V0Ogog
CWZvciAobiA9IDA7ICFJU19FUlIocnFbbl0pOyBuKyspCiAJCWk5MTVfcmVxdWVzdF9wdXQocnFb
bl0pOwotCWlmIChpZ3RfZmx1c2hfdGVzdChpOTE1LCBJOTE1X1dBSVRfTE9DS0VEKSkKKwlpZiAo
aWd0X2ZsdXNoX3Rlc3QoaTkxNSkpCiAJCWVyciA9IC1FSU87CiAKIAlrZXJuZWxfY29udGV4dF9j
bG9zZShjdHgpOwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qvc2VsZnRlc3Rf
dGltZWxpbmUuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L3NlbGZ0ZXN0X3RpbWVsaW5lLmMK
aW5kZXggMzIxNDgxNDAzMTY1Li4xNmFiZmFiZjA4YzcgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1
L2RybS9pOTE1L2d0L3NlbGZ0ZXN0X3RpbWVsaW5lLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5
MTUvZ3Qvc2VsZnRlc3RfdGltZWxpbmUuYwpAQCAtNiw3ICs2LDcgQEAKIAogI2luY2x1ZGUgPGxp
bnV4L3ByaW1lX251bWJlcnMuaD4KIAotI2luY2x1ZGUgImdlbS9pOTE1X2dlbV9wbS5oIgorI2lu
Y2x1ZGUgImludGVsX2VuZ2luZV9wbS5oIgogI2luY2x1ZGUgImludGVsX2d0LmgiCiAKICNpbmNs
dWRlICIuLi9zZWxmdGVzdHMvaTkxNV9yYW5kb20uaCIKQEAgLTEzNiw3ICsxMzYsNiBAQCBzdGF0
aWMgaW50IG1vY2tfaHdzcF9mcmVlbGlzdCh2b2lkICphcmcpCiAJCWdvdG8gZXJyX3B1dDsKIAl9
CiAKLQltdXRleF9sb2NrKCZzdGF0ZS5pOTE1LT5kcm0uc3RydWN0X211dGV4KTsKIAlmb3IgKHAg
PSBwaGFzZXM7IHAtPm5hbWU7IHArKykgewogCQlwcl9kZWJ1ZygiJXMoJXMpXG4iLCBfX2Z1bmNf
XywgcC0+bmFtZSk7CiAJCWZvcl9lYWNoX3ByaW1lX251bWJlcl9mcm9tKG5hLCAxLCAyICogQ0FD
SEVMSU5FU19QRVJfUEFHRSkgewpAQCAtMTQ5LDcgKzE0OCw2IEBAIHN0YXRpYyBpbnQgbW9ja19o
d3NwX2ZyZWVsaXN0KHZvaWQgKmFyZykKIG91dDoKIAlmb3IgKG5hID0gMDsgbmEgPCBzdGF0ZS5t
YXg7IG5hKyspCiAJCV9fbW9ja19od3NwX3JlY29yZCgmc3RhdGUsIG5hLCBOVUxMKTsKLQltdXRl
eF91bmxvY2soJnN0YXRlLmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwogCWtmcmVlKHN0YXRlLmhp
c3RvcnkpOwogZXJyX3B1dDoKIAlkcm1fZGV2X3B1dCgmc3RhdGUuaTkxNS0+ZHJtKTsKQEAgLTQ0
OSw4ICs0NDcsNiBAQCB0bF93cml0ZShzdHJ1Y3QgaW50ZWxfdGltZWxpbmUgKnRsLCBzdHJ1Y3Qg
aW50ZWxfZW5naW5lX2NzICplbmdpbmUsIHUzMiB2YWx1ZSkKIAlzdHJ1Y3QgaTkxNV9yZXF1ZXN0
ICpycTsKIAlpbnQgZXJyOwogCi0JbG9ja2RlcF9hc3NlcnRfaGVsZCgmdGwtPmd0LT5pOTE1LT5k
cm0uc3RydWN0X211dGV4KTsgLyogbGF6eSBycSByZWZzICovCi0KIAllcnIgPSBpbnRlbF90aW1l
bGluZV9waW4odGwpOwogCWlmIChlcnIpIHsKIAkJcnEgPSBFUlJfUFRSKGVycik7CkBAIC00NjEs
MTAgKzQ1NywxNCBAQCB0bF93cml0ZShzdHJ1Y3QgaW50ZWxfdGltZWxpbmUgKnRsLCBzdHJ1Y3Qg
aW50ZWxfZW5naW5lX2NzICplbmdpbmUsIHUzMiB2YWx1ZSkKIAlpZiAoSVNfRVJSKHJxKSkKIAkJ
Z290byBvdXRfdW5waW47CiAKKwlpOTE1X3JlcXVlc3RfZ2V0KHJxKTsKKwogCWVyciA9IGVtaXRf
Z2d0dF9zdG9yZV9kdyhycSwgdGwtPmh3c3Bfb2Zmc2V0LCB2YWx1ZSk7CiAJaTkxNV9yZXF1ZXN0
X2FkZChycSk7Ci0JaWYgKGVycikKKwlpZiAoZXJyKSB7CisJCWk5MTVfcmVxdWVzdF9wdXQocnEp
OwogCQlycSA9IEVSUl9QVFIoZXJyKTsKKwl9CiAKIG91dF91bnBpbjoKIAlpbnRlbF90aW1lbGlu
ZV91bnBpbih0bCk7CkBAIC01MDAsNyArNTAwLDYgQEAgc3RhdGljIGludCBsaXZlX2h3c3BfZW5n
aW5lKHZvaWQgKmFyZykKIAlzdHJ1Y3QgaW50ZWxfdGltZWxpbmUgKip0aW1lbGluZXM7CiAJc3Ry
dWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lOwogCWVudW0gaW50ZWxfZW5naW5lX2lkIGlkOwot
CWludGVsX3dha2VyZWZfdCB3YWtlcmVmOwogCXVuc2lnbmVkIGxvbmcgY291bnQsIG47CiAJaW50
IGVyciA9IDA7CiAKQEAgLTUxNSwxNCArNTE0LDEzIEBAIHN0YXRpYyBpbnQgbGl2ZV9od3NwX2Vu
Z2luZSh2b2lkICphcmcpCiAJaWYgKCF0aW1lbGluZXMpCiAJCXJldHVybiAtRU5PTUVNOwogCi0J
bXV0ZXhfbG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7Ci0Jd2FrZXJlZiA9IGludGVsX3J1
bnRpbWVfcG1fZ2V0KCZpOTE1LT5ydW50aW1lX3BtKTsKLQogCWNvdW50ID0gMDsKIAlmb3JfZWFj
aF9lbmdpbmUoZW5naW5lLCBpOTE1LCBpZCkgewogCQlpZiAoIWludGVsX2VuZ2luZV9jYW5fc3Rv
cmVfZHdvcmQoZW5naW5lKSkKIAkJCWNvbnRpbnVlOwogCisJCWludGVsX2VuZ2luZV9wbV9nZXQo
ZW5naW5lKTsKKwogCQlmb3IgKG4gPSAwOyBuIDwgTlVNX1RJTUVMSU5FUzsgbisrKSB7CiAJCQlz
dHJ1Y3QgaW50ZWxfdGltZWxpbmUgKnRsOwogCQkJc3RydWN0IGk5MTVfcmVxdWVzdCAqcnE7CkBA
IC01MzAsMjIgKzUyOCwyNiBAQCBzdGF0aWMgaW50IGxpdmVfaHdzcF9lbmdpbmUodm9pZCAqYXJn
KQogCQkJdGwgPSBjaGVja2VkX2ludGVsX3RpbWVsaW5lX2NyZWF0ZShpOTE1KTsKIAkJCWlmIChJ
U19FUlIodGwpKSB7CiAJCQkJZXJyID0gUFRSX0VSUih0bCk7Ci0JCQkJZ290byBvdXQ7CisJCQkJ
YnJlYWs7CiAJCQl9CiAKIAkJCXJxID0gdGxfd3JpdGUodGwsIGVuZ2luZSwgY291bnQpOwogCQkJ
aWYgKElTX0VSUihycSkpIHsKIAkJCQlpbnRlbF90aW1lbGluZV9wdXQodGwpOwogCQkJCWVyciA9
IFBUUl9FUlIocnEpOwotCQkJCWdvdG8gb3V0OworCQkJCWJyZWFrOwogCQkJfQogCiAJCQl0aW1l
bGluZXNbY291bnQrK10gPSB0bDsKKwkJCWk5MTVfcmVxdWVzdF9wdXQocnEpOwogCQl9CisKKwkJ
aW50ZWxfZW5naW5lX3BtX3B1dChlbmdpbmUpOworCQlpZiAoZXJyKQorCQkJYnJlYWs7CiAJfQog
Ci1vdXQ6Ci0JaWYgKGlndF9mbHVzaF90ZXN0KGk5MTUsIEk5MTVfV0FJVF9MT0NLRUQpKQorCWlm
IChpZ3RfZmx1c2hfdGVzdChpOTE1KSkKIAkJZXJyID0gLUVJTzsKIAogCWZvciAobiA9IDA7IG4g
PCBjb3VudDsgbisrKSB7CkBAIC01NTksMTEgKzU2MSw3IEBAIHN0YXRpYyBpbnQgbGl2ZV9od3Nw
X2VuZ2luZSh2b2lkICphcmcpCiAJCWludGVsX3RpbWVsaW5lX3B1dCh0bCk7CiAJfQogCi0JaW50
ZWxfcnVudGltZV9wbV9wdXQoJmk5MTUtPnJ1bnRpbWVfcG0sIHdha2VyZWYpOwotCW11dGV4X3Vu
bG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7Ci0KIAlrdmZyZWUodGltZWxpbmVzKTsKLQog
CXJldHVybiBlcnI7CiAjdW5kZWYgTlVNX1RJTUVMSU5FUwogfQpAQCAtNTc1LDcgKzU3Myw2IEBA
IHN0YXRpYyBpbnQgbGl2ZV9od3NwX2FsdGVybmF0ZSh2b2lkICphcmcpCiAJc3RydWN0IGludGVs
X3RpbWVsaW5lICoqdGltZWxpbmVzOwogCXN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZTsK
IAllbnVtIGludGVsX2VuZ2luZV9pZCBpZDsKLQlpbnRlbF93YWtlcmVmX3Qgd2FrZXJlZjsKIAl1
bnNpZ25lZCBsb25nIGNvdW50LCBuOwogCWludCBlcnIgPSAwOwogCkBAIC01OTEsOSArNTg4LDYg
QEAgc3RhdGljIGludCBsaXZlX2h3c3BfYWx0ZXJuYXRlKHZvaWQgKmFyZykKIAlpZiAoIXRpbWVs
aW5lcykKIAkJcmV0dXJuIC1FTk9NRU07CiAKLQltdXRleF9sb2NrKCZpOTE1LT5kcm0uc3RydWN0
X211dGV4KTsKLQl3YWtlcmVmID0gaW50ZWxfcnVudGltZV9wbV9nZXQoJmk5MTUtPnJ1bnRpbWVf
cG0pOwotCiAJY291bnQgPSAwOwogCWZvciAobiA9IDA7IG4gPCBOVU1fVElNRUxJTkVTOyBuKysp
IHsKIAkJZm9yX2VhY2hfZW5naW5lKGVuZ2luZSwgaTkxNSwgaWQpIHsKQEAgLTYwNSwxMSArNTk5
LDE0IEBAIHN0YXRpYyBpbnQgbGl2ZV9od3NwX2FsdGVybmF0ZSh2b2lkICphcmcpCiAKIAkJCXRs
ID0gY2hlY2tlZF9pbnRlbF90aW1lbGluZV9jcmVhdGUoaTkxNSk7CiAJCQlpZiAoSVNfRVJSKHRs
KSkgeworCQkJCWludGVsX2VuZ2luZV9wbV9wdXQoZW5naW5lKTsKIAkJCQllcnIgPSBQVFJfRVJS
KHRsKTsKIAkJCQlnb3RvIG91dDsKIAkJCX0KIAorCQkJaW50ZWxfZW5naW5lX3BtX2dldChlbmdp
bmUpOwogCQkJcnEgPSB0bF93cml0ZSh0bCwgZW5naW5lLCBjb3VudCk7CisJCQlpbnRlbF9lbmdp
bmVfcG1fcHV0KGVuZ2luZSk7CiAJCQlpZiAoSVNfRVJSKHJxKSkgewogCQkJCWludGVsX3RpbWVs
aW5lX3B1dCh0bCk7CiAJCQkJZXJyID0gUFRSX0VSUihycSk7CkBAIC02MTcsMTEgKzYxNCwxMiBA
QCBzdGF0aWMgaW50IGxpdmVfaHdzcF9hbHRlcm5hdGUodm9pZCAqYXJnKQogCQkJfQogCiAJCQl0
aW1lbGluZXNbY291bnQrK10gPSB0bDsKKwkJCWk5MTVfcmVxdWVzdF9wdXQocnEpOwogCQl9CiAJ
fQogCiBvdXQ6Ci0JaWYgKGlndF9mbHVzaF90ZXN0KGk5MTUsIEk5MTVfV0FJVF9MT0NLRUQpKQor
CWlmIChpZ3RfZmx1c2hfdGVzdChpOTE1KSkKIAkJZXJyID0gLUVJTzsKIAogCWZvciAobiA9IDA7
IG4gPCBjb3VudDsgbisrKSB7CkBAIC02MzUsMTEgKzYzMyw3IEBAIHN0YXRpYyBpbnQgbGl2ZV9o
d3NwX2FsdGVybmF0ZSh2b2lkICphcmcpCiAJCWludGVsX3RpbWVsaW5lX3B1dCh0bCk7CiAJfQog
Ci0JaW50ZWxfcnVudGltZV9wbV9wdXQoJmk5MTUtPnJ1bnRpbWVfcG0sIHdha2VyZWYpOwotCW11
dGV4X3VubG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7Ci0KIAlrdmZyZWUodGltZWxpbmVz
KTsKLQogCXJldHVybiBlcnI7CiAjdW5kZWYgTlVNX1RJTUVMSU5FUwogfQpAQCAtNjUwLDcgKzY0
NCw2IEBAIHN0YXRpYyBpbnQgbGl2ZV9od3NwX3dyYXAodm9pZCAqYXJnKQogCXN0cnVjdCBpbnRl
bF9lbmdpbmVfY3MgKmVuZ2luZTsKIAlzdHJ1Y3QgaW50ZWxfdGltZWxpbmUgKnRsOwogCWVudW0g
aW50ZWxfZW5naW5lX2lkIGlkOwotCWludGVsX3dha2VyZWZfdCB3YWtlcmVmOwogCWludCBlcnIg
PSAwOwogCiAJLyoKQEAgLTY1OCwxNCArNjUxLDEwIEBAIHN0YXRpYyBpbnQgbGl2ZV9od3NwX3dy
YXAodm9pZCAqYXJnKQogCSAqIGZvcmVpZ24gR1BVIHJlZmVyZW5jZXMuCiAJICovCiAKLQltdXRl
eF9sb2NrKCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsKLQl3YWtlcmVmID0gaW50ZWxfcnVudGlt
ZV9wbV9nZXQoJmk5MTUtPnJ1bnRpbWVfcG0pOwotCiAJdGwgPSBpbnRlbF90aW1lbGluZV9jcmVh
dGUoJmk5MTUtPmd0LCBOVUxMKTsKLQlpZiAoSVNfRVJSKHRsKSkgewotCQllcnIgPSBQVFJfRVJS
KHRsKTsKLQkJZ290byBvdXRfcnBtOwotCX0KKwlpZiAoSVNfRVJSKHRsKSkKKwkJcmV0dXJuIFBU
Ul9FUlIodGwpOworCiAJaWYgKCF0bC0+aGFzX2luaXRpYWxfYnJlYWRjcnVtYiB8fCAhdGwtPmh3
c3BfY2FjaGVsaW5lKQogCQlnb3RvIG91dF9mcmVlOwogCkBAIC02ODEsNyArNjcwLDkgQEAgc3Rh
dGljIGludCBsaXZlX2h3c3Bfd3JhcCh2b2lkICphcmcpCiAJCWlmICghaW50ZWxfZW5naW5lX2Nh
bl9zdG9yZV9kd29yZChlbmdpbmUpKQogCQkJY29udGludWU7CiAKKwkJaW50ZWxfZW5naW5lX3Bt
X2dldChlbmdpbmUpOwogCQlycSA9IGk5MTVfcmVxdWVzdF9jcmVhdGUoZW5naW5lLT5rZXJuZWxf
Y29udGV4dCk7CisJCWludGVsX2VuZ2luZV9wbV9wdXQoZW5naW5lKTsKIAkJaWYgKElTX0VSUihy
cSkpIHsKIAkJCWVyciA9IFBUUl9FUlIocnEpOwogCQkJZ290byBvdXQ7CkBAIC03NDcsMTYgKzcz
OCwxMiBAQCBzdGF0aWMgaW50IGxpdmVfaHdzcF93cmFwKHZvaWQgKmFyZykKIAl9CiAKIG91dDoK
LQlpZiAoaWd0X2ZsdXNoX3Rlc3QoaTkxNSwgSTkxNV9XQUlUX0xPQ0tFRCkpCisJaWYgKGlndF9m
bHVzaF90ZXN0KGk5MTUpKQogCQllcnIgPSAtRUlPOwogCiAJaW50ZWxfdGltZWxpbmVfdW5waW4o
dGwpOwogb3V0X2ZyZWU6CiAJaW50ZWxfdGltZWxpbmVfcHV0KHRsKTsKLW91dF9ycG06Ci0JaW50
ZWxfcnVudGltZV9wbV9wdXQoJmk5MTUtPnJ1bnRpbWVfcG0sIHdha2VyZWYpOwotCW11dGV4X3Vu
bG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7Ci0KIAlyZXR1cm4gZXJyOwogfQogCkBAIC03
NjUsNyArNzUyLDYgQEAgc3RhdGljIGludCBsaXZlX2h3c3BfcmVjeWNsZSh2b2lkICphcmcpCiAJ
c3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSBhcmc7CiAJc3RydWN0IGludGVsX2VuZ2lu
ZV9jcyAqZW5naW5lOwogCWVudW0gaW50ZWxfZW5naW5lX2lkIGlkOwotCWludGVsX3dha2VyZWZf
dCB3YWtlcmVmOwogCXVuc2lnbmVkIGxvbmcgY291bnQ7CiAJaW50IGVyciA9IDA7CiAKQEAgLTc3
NSw5ICs3NjEsNiBAQCBzdGF0aWMgaW50IGxpdmVfaHdzcF9yZWN5Y2xlKHZvaWQgKmFyZykKIAkg
KiB3YW50IHRvIGNvbmZ1c2Ugb3Vyc2VsdmVzIG9yIHRoZSBHUFUuCiAJICovCiAKLQltdXRleF9s
b2NrKCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsKLQl3YWtlcmVmID0gaW50ZWxfcnVudGltZV9w
bV9nZXQoJmk5MTUtPnJ1bnRpbWVfcG0pOwotCiAJY291bnQgPSAwOwogCWZvcl9lYWNoX2VuZ2lu
ZShlbmdpbmUsIGk5MTUsIGlkKSB7CiAJCUlHVF9USU1FT1VUKGVuZF90aW1lKTsKQEAgLTc4NSw2
ICs3NjgsOCBAQCBzdGF0aWMgaW50IGxpdmVfaHdzcF9yZWN5Y2xlKHZvaWQgKmFyZykKIAkJaWYg
KCFpbnRlbF9lbmdpbmVfY2FuX3N0b3JlX2R3b3JkKGVuZ2luZSkpCiAJCQljb250aW51ZTsKIAor
CQlpbnRlbF9lbmdpbmVfcG1fZ2V0KGVuZ2luZSk7CisKIAkJZG8gewogCQkJc3RydWN0IGludGVs
X3RpbWVsaW5lICp0bDsKIAkJCXN0cnVjdCBpOTE1X3JlcXVlc3QgKnJxOwpAQCAtNzkyLDIxICs3
NzcsMjIgQEAgc3RhdGljIGludCBsaXZlX2h3c3BfcmVjeWNsZSh2b2lkICphcmcpCiAJCQl0bCA9
IGNoZWNrZWRfaW50ZWxfdGltZWxpbmVfY3JlYXRlKGk5MTUpOwogCQkJaWYgKElTX0VSUih0bCkp
IHsKIAkJCQllcnIgPSBQVFJfRVJSKHRsKTsKLQkJCQlnb3RvIG91dDsKKwkJCQlicmVhazsKIAkJ
CX0KIAogCQkJcnEgPSB0bF93cml0ZSh0bCwgZW5naW5lLCBjb3VudCk7CiAJCQlpZiAoSVNfRVJS
KHJxKSkgewogCQkJCWludGVsX3RpbWVsaW5lX3B1dCh0bCk7CiAJCQkJZXJyID0gUFRSX0VSUihy
cSk7Ci0JCQkJZ290byBvdXQ7CisJCQkJYnJlYWs7CiAJCQl9CiAKIAkJCWlmIChpOTE1X3JlcXVl
c3Rfd2FpdChycSwgMCwgSFogLyA1KSA8IDApIHsKIAkJCQlwcl9lcnIoIldhaXQgZm9yIHRpbWVs
aW5lIHdyaXRlcyB0aW1lZCBvdXQhXG4iKTsKKwkJCQlpOTE1X3JlcXVlc3RfcHV0KHJxKTsKIAkJ
CQlpbnRlbF90aW1lbGluZV9wdXQodGwpOwogCQkJCWVyciA9IC1FSU87Ci0JCQkJZ290byBvdXQ7
CisJCQkJYnJlYWs7CiAJCQl9CiAKIAkJCWlmICgqdGwtPmh3c3Bfc2Vxbm8gIT0gY291bnQpIHsK
QEAgLTgxNSwxNyArODAxLDE4IEBAIHN0YXRpYyBpbnQgbGl2ZV9od3NwX3JlY3ljbGUodm9pZCAq
YXJnKQogCQkJCWVyciA9IC1FSU5WQUw7CiAJCQl9CiAKKwkJCWk5MTVfcmVxdWVzdF9wdXQocnEp
OwogCQkJaW50ZWxfdGltZWxpbmVfcHV0KHRsKTsKIAkJCWNvdW50Kys7CiAKIAkJCWlmIChlcnIp
Ci0JCQkJZ290byBvdXQ7CisJCQkJYnJlYWs7CiAJCX0gd2hpbGUgKCFfX2lndF90aW1lb3V0KGVu
ZF90aW1lLCBOVUxMKSk7Ci0JfQogCi1vdXQ6Ci0JaW50ZWxfcnVudGltZV9wbV9wdXQoJmk5MTUt
PnJ1bnRpbWVfcG0sIHdha2VyZWYpOwotCW11dGV4X3VubG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9t
dXRleCk7CisJCWludGVsX2VuZ2luZV9wbV9wdXQoZW5naW5lKTsKKwkJaWYgKGVycikKKwkJCWJy
ZWFrOworCX0KIAogCXJldHVybiBlcnI7CiB9CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0v
aTkxNS9ndC9zZWxmdGVzdF93b3JrYXJvdW5kcy5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qv
c2VsZnRlc3Rfd29ya2Fyb3VuZHMuYwppbmRleCBkNDBjZTA3MDliZmYuLjRlZTJlMmJhYmQwZCAx
MDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qvc2VsZnRlc3Rfd29ya2Fyb3VuZHMu
YworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9zZWxmdGVzdF93b3JrYXJvdW5kcy5jCkBA
IC02NzYsNyArNjc2LDcgQEAgc3RhdGljIGludCBjaGVja19kaXJ0eV93aGl0ZWxpc3Qoc3RydWN0
IGk5MTVfZ2VtX2NvbnRleHQgKmN0eCwKIAkJCWJyZWFrOwogCX0KIAotCWlmIChpZ3RfZmx1c2hf
dGVzdChjdHgtPmk5MTUsIEk5MTVfV0FJVF9MT0NLRUQpKQorCWlmIChpZ3RfZmx1c2hfdGVzdChj
dHgtPmk5MTUpKQogCQllcnIgPSAtRUlPOwogb3V0X2JhdGNoOgogCWk5MTVfdm1hX3VucGluX2Fu
ZF9yZWxlYXNlKCZiYXRjaCwgMCk7CkBAIC0xMDkwLDcgKzEwOTAsNyBAQCBzdGF0aWMgaW50IGxp
dmVfaXNvbGF0ZWRfd2hpdGVsaXN0KHZvaWQgKmFyZykKIAkJa2VybmVsX2NvbnRleHRfY2xvc2Uo
Y2xpZW50W2ldLmN0eCk7CiAJfQogCi0JaWYgKGlndF9mbHVzaF90ZXN0KGk5MTUsIEk5MTVfV0FJ
VF9MT0NLRUQpKQorCWlmIChpZ3RfZmx1c2hfdGVzdChpOTE1KSkKIAkJZXJyID0gLUVJTzsKIAog
CXJldHVybiBlcnI7CkBAIC0xMjQ4LDcgKzEyNDgsNyBAQCBsaXZlX2VuZ2luZV9yZXNldF93b3Jr
YXJvdW5kcyh2b2lkICphcmcpCiAJaWd0X2dsb2JhbF9yZXNldF91bmxvY2soJmk5MTUtPmd0KTsK
IAlrZXJuZWxfY29udGV4dF9jbG9zZShjdHgpOwogCi0JaWd0X2ZsdXNoX3Rlc3QoaTkxNSwgSTkx
NV9XQUlUX0xPQ0tFRCk7CisJaWd0X2ZsdXNoX3Rlc3QoaTkxNSk7CiAKIAlyZXR1cm4gcmV0Owog
fQpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9kZWJ1Z2ZzLmMgYi9kcml2
ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2RlYnVnZnMuYwppbmRleCBmZWM5ZmI3Y2MzODQuLjM4NTI4
OTg5NTEwNyAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9kZWJ1Z2ZzLmMK
KysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9kZWJ1Z2ZzLmMKQEAgLTM2MjEsNiArMzYy
MSw3IEBAIHN0YXRpYyBpbnQKIGk5MTVfZHJvcF9jYWNoZXNfc2V0KHZvaWQgKmRhdGEsIHU2NCB2
YWwpCiB7CiAJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSBkYXRhOworCWludCByZXQ7
CiAKIAlEUk1fREVCVUcoIkRyb3BwaW5nIGNhY2hlczogMHglMDhsbHggWzB4JTA4bGx4XVxuIiwK
IAkJICB2YWwsIHZhbCAmIERST1BfQUxMKTsKQEAgLTM2MzAsNDAgKzM2MzEsMjEgQEAgaTkxNV9k
cm9wX2NhY2hlc19zZXQodm9pZCAqZGF0YSwgdTY0IHZhbCkKIAkJICAgICBJOTE1X0lETEVfRU5H
SU5FU19USU1FT1VUKSkKIAkJaW50ZWxfZ3Rfc2V0X3dlZGdlZCgmaTkxNS0+Z3QpOwogCi0JLyog
Tm8gbmVlZCB0byBjaGVjayBhbmQgd2FpdCBmb3IgZ3B1IHJlc2V0cywgb25seSBsaWJkcm0gYXV0
by1yZXN0YXJ0cwotCSAqIG9uIGlvY3RscyBvbiAtRUFHQUlOLiAqLwotCWlmICh2YWwgJiAoRFJP
UF9BQ1RJVkUgfCBEUk9QX0lETEUgfCBEUk9QX1JFVElSRSB8IERST1BfUkVTRVRfU0VRTk8pKSB7
Ci0JCWludCByZXQ7CisJaWYgKHZhbCAmIERST1BfUkVUSVJFKQorCQlpOTE1X3JldGlyZV9yZXF1
ZXN0cyhpOTE1KTsKIAotCQlyZXQgPSBtdXRleF9sb2NrX2ludGVycnVwdGlibGUoJmk5MTUtPmRy
bS5zdHJ1Y3RfbXV0ZXgpOworCWlmICh2YWwgJiAoRFJPUF9JRExFIHwgRFJPUF9BQ1RJVkUpKSB7
CisJCXJldCA9IGk5MTVfZ2VtX3dhaXRfZm9yX2lkbGUoaTkxNSwKKwkJCQkJICAgICBJOTE1X1dB
SVRfSU5URVJSVVBUSUJMRSwKKwkJCQkJICAgICBNQVhfU0NIRURVTEVfVElNRU9VVCk7CiAJCWlm
IChyZXQpCiAJCQlyZXR1cm4gcmV0OworCX0KIAotCQkvKgotCQkgKiBUbyBmaW5pc2ggdGhlIGZs
dXNoIG9mIHRoZSBpZGxlX3dvcmtlciwgd2UgbXVzdCBjb21wbGV0ZQotCQkgKiB0aGUgc3dpdGNo
LXRvLWtlcm5lbC1jb250ZXh0LCB3aGljaCByZXF1aXJlcyBhIGRvdWJsZQotCQkgKiBwYXNzIHRo
cm91Z2ggd2FpdF9mb3JfaWRsZTogZmlyc3QgcXVldWVzIHRoZSBzd2l0Y2gsCi0JCSAqIHNlY29u
ZCB3YWl0cyBmb3IgdGhlIHN3aXRjaC4KLQkJICovCi0JCWlmIChyZXQgPT0gMCAmJiB2YWwgJiAo
RFJPUF9JRExFIHwgRFJPUF9BQ1RJVkUpKQotCQkJcmV0ID0gaTkxNV9nZW1fd2FpdF9mb3JfaWRs
ZShpOTE1LAotCQkJCQkJICAgICBJOTE1X1dBSVRfSU5URVJSVVBUSUJMRSB8Ci0JCQkJCQkgICAg
IEk5MTVfV0FJVF9MT0NLRUQsCi0JCQkJCQkgICAgIE1BWF9TQ0hFRFVMRV9USU1FT1VUKTsKLQot
CQlpZiAocmV0ID09IDAgJiYgdmFsICYgRFJPUF9JRExFKQotCQkJcmV0ID0gaTkxNV9nZW1fd2Fp
dF9mb3JfaWRsZShpOTE1LAotCQkJCQkJICAgICBJOTE1X1dBSVRfSU5URVJSVVBUSUJMRSB8Ci0J
CQkJCQkgICAgIEk5MTVfV0FJVF9MT0NLRUQsCi0JCQkJCQkgICAgIE1BWF9TQ0hFRFVMRV9USU1F
T1VUKTsKLQotCQlpZiAodmFsICYgRFJPUF9SRVRJUkUpCi0JCQlpOTE1X3JldGlyZV9yZXF1ZXN0
cyhpOTE1KTsKLQotCQltdXRleF91bmxvY2soJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwotCi0J
CWlmIChyZXQgPT0gMCAmJiB2YWwgJiBEUk9QX0lETEUpCi0JCQlyZXQgPSBpbnRlbF9ndF9wbV93
YWl0X2Zvcl9pZGxlKCZpOTE1LT5ndCk7CisJaWYgKHZhbCAmIERST1BfSURMRSkgeworCQlyZXQg
PSBpbnRlbF9ndF9wbV93YWl0X2Zvcl9pZGxlKCZpOTE1LT5ndCk7CisJCWlmIChyZXQpCisJCQly
ZXR1cm4gcmV0OwogCX0KIAogCWlmICh2YWwgJiBEUk9QX1JFU0VUX0FDVElWRSAmJiBpbnRlbF9n
dF90ZXJtaW5hbGx5X3dlZGdlZCgmaTkxNS0+Z3QpKQpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUv
ZHJtL2k5MTUvaTkxNV9nZW0uYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZ2VtLmMKaW5k
ZXggNjQ4OTA2MjdkNjM4Li5lNGM1NTNkOWFhMDcgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2Ry
bS9pOTE1L2k5MTVfZ2VtLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9nZW0uYwpA
QCAtOTQ1LDE5ICs5NDUsMTYgQEAgaW50IGk5MTVfZ2VtX3dhaXRfZm9yX2lkbGUoc3RydWN0IGRy
bV9pOTE1X3ByaXZhdGUgKmk5MTUsCiAJaWYgKCFpbnRlbF9ndF9wbV9pc19hd2FrZShndCkpCiAJ
CXJldHVybiAwOwogCi0JR0VNX1RSQUNFKCJmbGFncz0leCAoJXMpLCB0aW1lb3V0PSVsZCVzXG4i
LAotCQkgIGZsYWdzLCBmbGFncyAmIEk5MTVfV0FJVF9MT0NLRUQgPyAibG9ja2VkIiA6ICJ1bmxv
Y2tlZCIsCi0JCSAgdGltZW91dCwgdGltZW91dCA9PSBNQVhfU0NIRURVTEVfVElNRU9VVCA/ICIg
KGZvcmV2ZXIpIiA6ICIiKTsKLQotCXRpbWVvdXQgPSB3YWl0X2Zvcl90aW1lbGluZXMoZ3QsIGZs
YWdzLCB0aW1lb3V0KTsKLQlpZiAodGltZW91dCA8IDApCi0JCXJldHVybiB0aW1lb3V0OworCWRv
IHsKKwkJdGltZW91dCA9IHdhaXRfZm9yX3RpbWVsaW5lcyhndCwgZmxhZ3MsIHRpbWVvdXQpOwor
CQlpZiAodGltZW91dCA8IDApCisJCQlyZXR1cm4gdGltZW91dDsKIAotCWlmIChmbGFncyAmIEk5
MTVfV0FJVF9MT0NLRUQpIHsKLQkJbG9ja2RlcF9hc3NlcnRfaGVsZCgmaTkxNS0+ZHJtLnN0cnVj
dF9tdXRleCk7CisJCWNvbmRfcmVzY2hlZCgpOworCQlpZiAoc2lnbmFsX3BlbmRpbmcoY3VycmVu
dCkpCisJCQlyZXR1cm4gLUVJTlRSOwogCi0JCWk5MTVfcmV0aXJlX3JlcXVlc3RzKGk5MTUpOwot
CX0KKwl9IHdoaWxlIChpOTE1X3JldGlyZV9yZXF1ZXN0cyhpOTE1KSk7CiAKIAlyZXR1cm4gMDsK
IH0KZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfcmVxdWVzdC5oIGIvZHJp
dmVycy9ncHUvZHJtL2k5MTUvaTkxNV9yZXF1ZXN0LmgKaW5kZXggOTFhODg1YzM2YzZiLi42MjFm
YjMzY2RhMzAgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfcmVxdWVzdC5o
CisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfcmVxdWVzdC5oCkBAIC0zMDgsMTAgKzMw
OCw5IEBAIGxvbmcgaTkxNV9yZXF1ZXN0X3dhaXQoc3RydWN0IGk5MTVfcmVxdWVzdCAqcnEsCiAJ
CSAgICAgICBsb25nIHRpbWVvdXQpCiAJX19hdHRyaWJ1dGVfXygobm9ubnVsbCgxKSkpOwogI2Rl
ZmluZSBJOTE1X1dBSVRfSU5URVJSVVBUSUJMRQlCSVQoMCkKLSNkZWZpbmUgSTkxNV9XQUlUX0xP
Q0tFRAlCSVQoMSkgLyogc3RydWN0X211dGV4IGhlbGQsIGhhbmRsZSBHUFUgcmVzZXQgKi8KLSNk
ZWZpbmUgSTkxNV9XQUlUX1BSSU9SSVRZCUJJVCgyKSAvKiBzbWFsbCBwcmlvcml0eSBidW1wIGZv
ciB0aGUgcmVxdWVzdCAqLwotI2RlZmluZSBJOTE1X1dBSVRfQUxMCQlCSVQoMykgLyogdXNlZCBi
eSBpOTE1X2dlbV9vYmplY3Rfd2FpdCgpICovCi0jZGVmaW5lIEk5MTVfV0FJVF9GT1JfSURMRV9C
T09TVCBCSVQoNCkKKyNkZWZpbmUgSTkxNV9XQUlUX1BSSU9SSVRZCUJJVCgxKSAvKiBzbWFsbCBw
cmlvcml0eSBidW1wIGZvciB0aGUgcmVxdWVzdCAqLworI2RlZmluZSBJOTE1X1dBSVRfQUxMCQlC
SVQoMikgLyogdXNlZCBieSBpOTE1X2dlbV9vYmplY3Rfd2FpdCgpICovCisjZGVmaW5lIEk5MTVf
V0FJVF9GT1JfSURMRV9CT09TVCBCSVQoMykKIAogc3RhdGljIGlubGluZSBib29sIGk5MTVfcmVx
dWVzdF9zaWduYWxlZChjb25zdCBzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpycSkKIHsKZGlmZiAtLWdp
dCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L3NlbGZ0ZXN0cy9pOTE1X2FjdGl2ZS5jIGIvZHJpdmVy
cy9ncHUvZHJtL2k5MTUvc2VsZnRlc3RzL2k5MTVfYWN0aXZlLmMKaW5kZXggMmNjNzFiY2Y4ODRm
Li4yNjgxOTJiNTYxM2IgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L3NlbGZ0ZXN0
cy9pOTE1X2FjdGl2ZS5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L3NlbGZ0ZXN0cy9pOTE1
X2FjdGl2ZS5jCkBAIC0xNjIsMTAgKzE2Miw4IEBAIHN0YXRpYyBpbnQgbGl2ZV9hY3RpdmVfd2Fp
dCh2b2lkICphcmcpCiAKIAlfX2xpdmVfcHV0KGFjdGl2ZSk7CiAKLQltdXRleF9sb2NrKCZpOTE1
LT5kcm0uc3RydWN0X211dGV4KTsKLQlpZiAoaWd0X2ZsdXNoX3Rlc3QoaTkxNSwgSTkxNV9XQUlU
X0xPQ0tFRCkpCisJaWYgKGlndF9mbHVzaF90ZXN0KGk5MTUpKQogCQllcnIgPSAtRUlPOwotCW11
dGV4X3VubG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CiAKIAlyZXR1cm4gZXJyOwogfQpA
QCAtMTgzLDEwICsxODEsOCBAQCBzdGF0aWMgaW50IGxpdmVfYWN0aXZlX3JldGlyZSh2b2lkICph
cmcpCiAJCXJldHVybiBQVFJfRVJSKGFjdGl2ZSk7CiAKIAkvKiB3YWl0cyBmb3IgJiByZXRpcmVz
IGFsbCByZXF1ZXN0cyAqLwotCW11dGV4X2xvY2soJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwot
CWlmIChpZ3RfZmx1c2hfdGVzdChpOTE1LCBJOTE1X1dBSVRfTE9DS0VEKSkKKwlpZiAoaWd0X2Zs
dXNoX3Rlc3QoaTkxNSkpCiAJCWVyciA9IC1FSU87Ci0JbXV0ZXhfdW5sb2NrKCZpOTE1LT5kcm0u
c3RydWN0X211dGV4KTsKIAogCWlmICghUkVBRF9PTkNFKGFjdGl2ZS0+cmV0aXJlZCkpIHsKIAkJ
cHJfZXJyKCJpOTE1X2FjdGl2ZSBub3QgcmV0aXJlZCBhZnRlciBmbHVzaGluZyFcbiIpOwpkaWZm
IC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvc2VsZnRlc3RzL2k5MTVfZ2VtX2V2aWN0LmMg
Yi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMvaTkxNV9nZW1fZXZpY3QuYwppbmRleCA3
NWE0Njk1YjgyYmIuLjUyZDJkZjg0MzE0OCAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5
MTUvc2VsZnRlc3RzL2k5MTVfZ2VtX2V2aWN0LmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUv
c2VsZnRlc3RzL2k5MTVfZ2VtX2V2aWN0LmMKQEAgLTUyMyw3ICs1MjMsNyBAQCBzdGF0aWMgaW50
IGlndF9ldmljdF9jb250ZXh0cyh2b2lkICphcmcpCiAKIAltdXRleF9sb2NrKCZpOTE1LT5nZ3R0
LnZtLm11dGV4KTsKIG91dF9sb2NrZWQ6Ci0JaWYgKGlndF9mbHVzaF90ZXN0KGk5MTUsIEk5MTVf
V0FJVF9MT0NLRUQpKQorCWlmIChpZ3RfZmx1c2hfdGVzdChpOTE1KSkKIAkJZXJyID0gLUVJTzsK
IAl3aGlsZSAocmVzZXJ2ZWQpIHsKIAkJc3RydWN0IHJlc2VydmVkICpuZXh0ID0gcmVzZXJ2ZWQt
Pm5leHQ7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMvaTkxNV9n
ZW1fZ3R0LmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMvaTkxNV9nZW1fZ3R0LmMK
aW5kZXggMDI3NDliYmZkMGNmLi5lNDBlNmNmYTUxZjEgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1
L2RybS9pOTE1L3NlbGZ0ZXN0cy9pOTE1X2dlbV9ndHQuYworKysgYi9kcml2ZXJzL2dwdS9kcm0v
aTkxNS9zZWxmdGVzdHMvaTkxNV9nZW1fZ3R0LmMKQEAgLTE3MDUsMTIgKzE3MDUsOCBAQCBpbnQg
aTkxNV9nZW1fZ3R0X21vY2tfc2VsZnRlc3RzKHZvaWQpCiAKIAllcnIgPSBpOTE1X3N1YnRlc3Rz
KHRlc3RzLCBnZ3R0KTsKIAotCW11dGV4X2xvY2soJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwog
CW1vY2tfZGV2aWNlX2ZsdXNoKGk5MTUpOwotCW11dGV4X3VubG9jaygmaTkxNS0+ZHJtLnN0cnVj
dF9tdXRleCk7Ci0KIAlpOTE1X2dlbV9kcmFpbl9mcmVlZF9vYmplY3RzKGk5MTUpOwotCiAJbW9j
a19maW5pX2dndHQoZ2d0dCk7CiAJa2ZyZWUoZ2d0dCk7CiBvdXRfcHV0OgpAQCAtMjAwNiw3ICsy
MDAyLDcgQEAgc3RhdGljIGludCBpZ3RfY3NfdGxiKHZvaWQgKmFyZykKIAkJfQogCX0KIGVuZDoK
LQlpZiAoaWd0X2ZsdXNoX3Rlc3QoaTkxNSwgSTkxNV9XQUlUX0xPQ0tFRCkpCisJaWYgKGlndF9m
bHVzaF90ZXN0KGk5MTUpKQogCQllcnIgPSAtRUlPOwogCWk5MTVfZ2VtX2NvbnRleHRfdW5sb2Nr
X2VuZ2luZXMoY3R4KTsKIAlpOTE1X2dlbV9vYmplY3RfdW5waW5fbWFwKG91dCk7CmRpZmYgLS1n
aXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMvaTkxNV9yZXF1ZXN0LmMgYi9kcml2
ZXJzL2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMvaTkxNV9yZXF1ZXN0LmMKaW5kZXggZWIxNzVkYTQ4
NTQ3Li5kN2Q2OGM2YTZiZDUgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L3NlbGZ0
ZXN0cy9pOTE1X3JlcXVlc3QuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMv
aTkxNV9yZXF1ZXN0LmMKQEAgLTQxLDIxICs0MSwxNiBAQCBzdGF0aWMgaW50IGlndF9hZGRfcmVx
dWVzdCh2b2lkICphcmcpCiB7CiAJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSBhcmc7
CiAJc3RydWN0IGk5MTVfcmVxdWVzdCAqcmVxdWVzdDsKLQlpbnQgZXJyID0gLUVOT01FTTsKIAog
CS8qIEJhc2ljIHByZWxpbWluYXJ5IHRlc3QgdG8gY3JlYXRlIGEgcmVxdWVzdCBhbmQgbGV0IGl0
IGxvb3NlISAqLwogCi0JbXV0ZXhfbG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CiAJcmVx
dWVzdCA9IG1vY2tfcmVxdWVzdChpOTE1LT5lbmdpbmVbUkNTMF0tPmtlcm5lbF9jb250ZXh0LCBI
WiAvIDEwKTsKIAlpZiAoIXJlcXVlc3QpCi0JCWdvdG8gb3V0X3VubG9jazsKKwkJcmV0dXJuIC1F
Tk9NRU07CiAKIAlpOTE1X3JlcXVlc3RfYWRkKHJlcXVlc3QpOwogCi0JZXJyID0gMDsKLW91dF91
bmxvY2s6Ci0JbXV0ZXhfdW5sb2NrKCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsKLQlyZXR1cm4g
ZXJyOworCXJldHVybiAwOwogfQogCiBzdGF0aWMgaW50IGlndF93YWl0X3JlcXVlc3Qodm9pZCAq
YXJnKQpAQCAtNjcsMTIgKzYyLDEwIEBAIHN0YXRpYyBpbnQgaWd0X3dhaXRfcmVxdWVzdCh2b2lk
ICphcmcpCiAKIAkvKiBTdWJtaXQgYSByZXF1ZXN0LCB0aGVuIHdhaXQgdXBvbiBpdCAqLwogCi0J
bXV0ZXhfbG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CiAJcmVxdWVzdCA9IG1vY2tfcmVx
dWVzdChpOTE1LT5lbmdpbmVbUkNTMF0tPmtlcm5lbF9jb250ZXh0LCBUKTsKLQlpZiAoIXJlcXVl
c3QpIHsKLQkJZXJyID0gLUVOT01FTTsKLQkJZ290byBvdXRfdW5sb2NrOwotCX0KKwlpZiAoIXJl
cXVlc3QpCisJCXJldHVybiAtRU5PTUVNOworCiAJaTkxNV9yZXF1ZXN0X2dldChyZXF1ZXN0KTsK
IAogCWlmIChpOTE1X3JlcXVlc3Rfd2FpdChyZXF1ZXN0LCAwLCAwKSAhPSAtRVRJTUUpIHsKQEAg
LTEyNSw5ICsxMTgsNyBAQCBzdGF0aWMgaW50IGlndF93YWl0X3JlcXVlc3Qodm9pZCAqYXJnKQog
CWVyciA9IDA7CiBvdXRfcmVxdWVzdDoKIAlpOTE1X3JlcXVlc3RfcHV0KHJlcXVlc3QpOwotb3V0
X3VubG9jazoKIAltb2NrX2RldmljZV9mbHVzaChpOTE1KTsKLQltdXRleF91bmxvY2soJmk5MTUt
PmRybS5zdHJ1Y3RfbXV0ZXgpOwogCXJldHVybiBlcnI7CiB9CiAKQEAgLTE0MCw1MiArMTMxLDQ1
IEBAIHN0YXRpYyBpbnQgaWd0X2ZlbmNlX3dhaXQodm9pZCAqYXJnKQogCiAJLyogU3VibWl0IGEg
cmVxdWVzdCwgdHJlYXQgaXQgYXMgYSBmZW5jZSBhbmQgd2FpdCB1cG9uIGl0ICovCiAKLQltdXRl
eF9sb2NrKCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsKIAlyZXF1ZXN0ID0gbW9ja19yZXF1ZXN0
KGk5MTUtPmVuZ2luZVtSQ1MwXS0+a2VybmVsX2NvbnRleHQsIFQpOwotCWlmICghcmVxdWVzdCkg
ewotCQllcnIgPSAtRU5PTUVNOwotCQlnb3RvIG91dF9sb2NrZWQ7Ci0JfQorCWlmICghcmVxdWVz
dCkKKwkJcmV0dXJuIC1FTk9NRU07CiAKIAlpZiAoZG1hX2ZlbmNlX3dhaXRfdGltZW91dCgmcmVx
dWVzdC0+ZmVuY2UsIGZhbHNlLCBUKSAhPSAtRVRJTUUpIHsKIAkJcHJfZXJyKCJmZW5jZSB3YWl0
IHN1Y2Nlc3MgYmVmb3JlIHN1Ym1pdCAoZXhwZWN0ZWQgdGltZW91dCkhXG4iKTsKLQkJZ290byBv
dXRfbG9ja2VkOworCQlnb3RvIG91dDsKIAl9CiAKIAlpOTE1X3JlcXVlc3RfYWRkKHJlcXVlc3Qp
OwotCW11dGV4X3VubG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CiAKIAlpZiAoZG1hX2Zl
bmNlX2lzX3NpZ25hbGVkKCZyZXF1ZXN0LT5mZW5jZSkpIHsKIAkJcHJfZXJyKCJmZW5jZSBzaWdu
YWxlZCBpbW1lZGlhdGVseSFcbiIpOwotCQlnb3RvIG91dF9kZXZpY2U7CisJCWdvdG8gb3V0Owog
CX0KIAogCWlmIChkbWFfZmVuY2Vfd2FpdF90aW1lb3V0KCZyZXF1ZXN0LT5mZW5jZSwgZmFsc2Us
IFQgLyAyKSAhPSAtRVRJTUUpIHsKIAkJcHJfZXJyKCJmZW5jZSB3YWl0IHN1Y2Nlc3MgYWZ0ZXIg
c3VibWl0IChleHBlY3RlZCB0aW1lb3V0KSFcbiIpOwotCQlnb3RvIG91dF9kZXZpY2U7CisJCWdv
dG8gb3V0OwogCX0KIAogCWlmIChkbWFfZmVuY2Vfd2FpdF90aW1lb3V0KCZyZXF1ZXN0LT5mZW5j
ZSwgZmFsc2UsIFQpIDw9IDApIHsKIAkJcHJfZXJyKCJmZW5jZSB3YWl0IHRpbWVkIG91dCAoZXhw
ZWN0ZWQgc3VjY2VzcykhXG4iKTsKLQkJZ290byBvdXRfZGV2aWNlOworCQlnb3RvIG91dDsKIAl9
CiAKIAlpZiAoIWRtYV9mZW5jZV9pc19zaWduYWxlZCgmcmVxdWVzdC0+ZmVuY2UpKSB7CiAJCXBy
X2VycigiZmVuY2UgdW5zaWduYWxlZCBhZnRlciB3YWl0aW5nIVxuIik7Ci0JCWdvdG8gb3V0X2Rl
dmljZTsKKwkJZ290byBvdXQ7CiAJfQogCiAJaWYgKGRtYV9mZW5jZV93YWl0X3RpbWVvdXQoJnJl
cXVlc3QtPmZlbmNlLCBmYWxzZSwgVCkgPD0gMCkgewogCQlwcl9lcnIoImZlbmNlIHdhaXQgdGlt
ZWQgb3V0IHdoZW4gY29tcGxldGUgKGV4cGVjdGVkIHN1Y2Nlc3MpIVxuIik7Ci0JCWdvdG8gb3V0
X2RldmljZTsKKwkJZ290byBvdXQ7CiAJfQogCiAJZXJyID0gMDsKLW91dF9kZXZpY2U6Ci0JbXV0
ZXhfbG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7Ci1vdXRfbG9ja2VkOgorb3V0OgogCW1v
Y2tfZGV2aWNlX2ZsdXNoKGk5MTUpOwotCW11dGV4X3VubG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9t
dXRleCk7CiAJcmV0dXJuIGVycjsKIH0KIApAQCAtMTk5LDYgKzE4Myw4IEBAIHN0YXRpYyBpbnQg
aWd0X3JlcXVlc3RfcmV3aW5kKHZvaWQgKmFyZykKIAogCW11dGV4X2xvY2soJmk5MTUtPmRybS5z
dHJ1Y3RfbXV0ZXgpOwogCWN0eFswXSA9IG1vY2tfY29udGV4dChpOTE1LCAiQSIpOworCW11dGV4
X3VubG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CisKIAljZSA9IGk5MTVfZ2VtX2NvbnRl
eHRfZ2V0X2VuZ2luZShjdHhbMF0sIFJDUzApOwogCUdFTV9CVUdfT04oSVNfRVJSKGNlKSk7CiAJ
cmVxdWVzdCA9IG1vY2tfcmVxdWVzdChjZSwgMiAqIEhaKTsKQEAgLTIxMSw3ICsxOTcsMTAgQEAg
c3RhdGljIGludCBpZ3RfcmVxdWVzdF9yZXdpbmQodm9pZCAqYXJnKQogCWk5MTVfcmVxdWVzdF9n
ZXQocmVxdWVzdCk7CiAJaTkxNV9yZXF1ZXN0X2FkZChyZXF1ZXN0KTsKIAorCW11dGV4X2xvY2so
Jmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwogCWN0eFsxXSA9IG1vY2tfY29udGV4dChpOTE1LCAi
QiIpOworCW11dGV4X3VubG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CisKIAljZSA9IGk5
MTVfZ2VtX2NvbnRleHRfZ2V0X2VuZ2luZShjdHhbMV0sIFJDUzApOwogCUdFTV9CVUdfT04oSVNf
RVJSKGNlKSk7CiAJdmlwID0gbW9ja19yZXF1ZXN0KGNlLCAwKTsKQEAgLTIzMyw3ICsyMjIsNiBA
QCBzdGF0aWMgaW50IGlndF9yZXF1ZXN0X3Jld2luZCh2b2lkICphcmcpCiAJcmVxdWVzdC0+ZW5n
aW5lLT5zdWJtaXRfcmVxdWVzdChyZXF1ZXN0KTsKIAlyY3VfcmVhZF91bmxvY2soKTsKIAotCW11
dGV4X3VubG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CiAKIAlpZiAoaTkxNV9yZXF1ZXN0
X3dhaXQodmlwLCAwLCBIWikgPT0gLUVUSU1FKSB7CiAJCXByX2VycigidGltZWQgb3V0IHdhaXRp
bmcgZm9yIGhpZ2ggcHJpb3JpdHkgcmVxdWVzdFxuIik7CkBAIC0yNDgsMTQgKzIzNiwxMiBAQCBz
dGF0aWMgaW50IGlndF9yZXF1ZXN0X3Jld2luZCh2b2lkICphcmcpCiAJZXJyID0gMDsKIGVycjoK
IAlpOTE1X3JlcXVlc3RfcHV0KHZpcCk7Ci0JbXV0ZXhfbG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9t
dXRleCk7CiBlcnJfY29udGV4dF8xOgogCW1vY2tfY29udGV4dF9jbG9zZShjdHhbMV0pOwogCWk5
MTVfcmVxdWVzdF9wdXQocmVxdWVzdCk7CiBlcnJfY29udGV4dF8wOgogCW1vY2tfY29udGV4dF9j
bG9zZShjdHhbMF0pOwogCW1vY2tfZGV2aWNlX2ZsdXNoKGk5MTUpOwotCW11dGV4X3VubG9jaygm
aTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CiAJcmV0dXJuIGVycjsKIH0KIApAQCAtMjgyLDcgKzI2
OCw2IEBAIF9fbGl2ZV9yZXF1ZXN0X2FsbG9jKHN0cnVjdCBpbnRlbF9jb250ZXh0ICpjZSkKIHN0
YXRpYyBpbnQgX19pZ3RfYnJlYWRjcnVtYnNfc21va2V0ZXN0KHZvaWQgKmFyZykKIHsKIAlzdHJ1
Y3Qgc21va2V0ZXN0ICp0ID0gYXJnOwotCXN0cnVjdCBtdXRleCAqIGNvbnN0IEJLTCA9ICZ0LT5l
bmdpbmUtPmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXg7CiAJY29uc3QgdW5zaWduZWQgaW50IG1heF9i
YXRjaCA9IG1pbih0LT5uY29udGV4dHMsIHQtPm1heF9iYXRjaCkgLSAxOwogCWNvbnN0IHVuc2ln
bmVkIGludCB0b3RhbCA9IDQgKiB0LT5uY29udGV4dHMgKyAxOwogCXVuc2lnbmVkIGludCBudW1f
d2FpdHMgPSAwLCBudW1fZmVuY2VzID0gMDsKQEAgLTMzNywxNCArMzIyLDExIEBAIHN0YXRpYyBp
bnQgX19pZ3RfYnJlYWRjcnVtYnNfc21va2V0ZXN0KHZvaWQgKmFyZykKIAkJCXN0cnVjdCBpOTE1
X3JlcXVlc3QgKnJxOwogCQkJc3RydWN0IGludGVsX2NvbnRleHQgKmNlOwogCi0JCQltdXRleF9s
b2NrKEJLTCk7Ci0KIAkJCWNlID0gaTkxNV9nZW1fY29udGV4dF9nZXRfZW5naW5lKGN0eCwgdC0+
ZW5naW5lLT5sZWdhY3lfaWR4KTsKIAkJCUdFTV9CVUdfT04oSVNfRVJSKGNlKSk7CiAJCQlycSA9
IHQtPnJlcXVlc3RfYWxsb2MoY2UpOwogCQkJaW50ZWxfY29udGV4dF9wdXQoY2UpOwogCQkJaWYg
KElTX0VSUihycSkpIHsKLQkJCQltdXRleF91bmxvY2soQktMKTsKIAkJCQllcnIgPSBQVFJfRVJS
KHJxKTsKIAkJCQljb3VudCA9IG47CiAJCQkJYnJlYWs7CkBAIC0zNTcsOCArMzM5LDYgQEAgc3Rh
dGljIGludCBfX2lndF9icmVhZGNydW1ic19zbW9rZXRlc3Qodm9pZCAqYXJnKQogCQkJcmVxdWVz
dHNbbl0gPSBpOTE1X3JlcXVlc3RfZ2V0KHJxKTsKIAkJCWk5MTVfcmVxdWVzdF9hZGQocnEpOwog
Ci0JCQltdXRleF91bmxvY2soQktMKTsKLQogCQkJaWYgKGVyciA+PSAwKQogCQkJCWVyciA9IGk5
MTVfc3dfZmVuY2VfYXdhaXRfZG1hX2ZlbmNlKHdhaXQsCiAJCQkJCQkJCSAgICAmcnEtPmZlbmNl
LApAQCAtNDU3LDE1ICs0MzcsMTUgQEAgc3RhdGljIGludCBtb2NrX2JyZWFkY3J1bWJzX3Ntb2tl
dGVzdCh2b2lkICphcmcpCiAJCWdvdG8gb3V0X3RocmVhZHM7CiAJfQogCi0JbXV0ZXhfbG9jaygm
dC5lbmdpbmUtPmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwogCWZvciAobiA9IDA7IG4gPCB0Lm5j
b250ZXh0czsgbisrKSB7CisJCW11dGV4X2xvY2soJnQuZW5naW5lLT5pOTE1LT5kcm0uc3RydWN0
X211dGV4KTsKIAkJdC5jb250ZXh0c1tuXSA9IG1vY2tfY29udGV4dCh0LmVuZ2luZS0+aTkxNSwg
Im1vY2siKTsKKwkJbXV0ZXhfdW5sb2NrKCZ0LmVuZ2luZS0+aTkxNS0+ZHJtLnN0cnVjdF9tdXRl
eCk7CiAJCWlmICghdC5jb250ZXh0c1tuXSkgewogCQkJcmV0ID0gLUVOT01FTTsKIAkJCWdvdG8g
b3V0X2NvbnRleHRzOwogCQl9CiAJfQotCW11dGV4X3VubG9jaygmdC5lbmdpbmUtPmk5MTUtPmRy
bS5zdHJ1Y3RfbXV0ZXgpOwogCiAJZm9yIChuID0gMDsgbiA8IG5jcHVzOyBuKyspIHsKIAkJdGhy
ZWFkc1tuXSA9IGt0aHJlYWRfcnVuKF9faWd0X2JyZWFkY3J1bWJzX3Ntb2tldGVzdCwKQEAgLTQ5
NSwxOCArNDc1LDE1IEBAIHN0YXRpYyBpbnQgbW9ja19icmVhZGNydW1ic19zbW9rZXRlc3Qodm9p
ZCAqYXJnKQogCQlhdG9taWNfbG9uZ19yZWFkKCZ0Lm51bV9mZW5jZXMpLAogCQluY3B1cyk7CiAK
LQltdXRleF9sb2NrKCZ0LmVuZ2luZS0+aTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CiBvdXRfY29u
dGV4dHM6CiAJZm9yIChuID0gMDsgbiA8IHQubmNvbnRleHRzOyBuKyspIHsKIAkJaWYgKCF0LmNv
bnRleHRzW25dKQogCQkJYnJlYWs7CiAJCW1vY2tfY29udGV4dF9jbG9zZSh0LmNvbnRleHRzW25d
KTsKIAl9Ci0JbXV0ZXhfdW5sb2NrKCZ0LmVuZ2luZS0+aTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7
CiAJa2ZyZWUodC5jb250ZXh0cyk7CiBvdXRfdGhyZWFkczoKIAlrZnJlZSh0aHJlYWRzKTsKLQog
CXJldHVybiByZXQ7CiB9CiAKQEAgLTUzOSw3ICs1MTYsNiBAQCBzdGF0aWMgaW50IGxpdmVfbm9w
X3JlcXVlc3Qodm9pZCAqYXJnKQogewogCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0g
YXJnOwogCXN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZTsKLQlpbnRlbF93YWtlcmVmX3Qg
d2FrZXJlZjsKIAlzdHJ1Y3QgaWd0X2xpdmVfdGVzdCB0OwogCXVuc2lnbmVkIGludCBpZDsKIAlp
bnQgZXJyID0gLUVOT0RFVjsKQEAgLTU0OSwyOCArNTI1LDI1IEBAIHN0YXRpYyBpbnQgbGl2ZV9u
b3BfcmVxdWVzdCh2b2lkICphcmcpCiAJICogdGhlIG92ZXJoZWFkIG9mIHN1Ym1pdHRpbmcgcmVx
dWVzdHMgdG8gdGhlIGhhcmR3YXJlLgogCSAqLwogCi0JbXV0ZXhfbG9jaygmaTkxNS0+ZHJtLnN0
cnVjdF9tdXRleCk7Ci0Jd2FrZXJlZiA9IGludGVsX3J1bnRpbWVfcG1fZ2V0KCZpOTE1LT5ydW50
aW1lX3BtKTsKLQogCWZvcl9lYWNoX2VuZ2luZShlbmdpbmUsIGk5MTUsIGlkKSB7Ci0JCXN0cnVj
dCBpOTE1X3JlcXVlc3QgKnJlcXVlc3QgPSBOVUxMOwogCQl1bnNpZ25lZCBsb25nIG4sIHByaW1l
OwogCQlJR1RfVElNRU9VVChlbmRfdGltZSk7CiAJCWt0aW1lX3QgdGltZXNbMl0gPSB7fTsKIAog
CQllcnIgPSBpZ3RfbGl2ZV90ZXN0X2JlZ2luKCZ0LCBpOTE1LCBfX2Z1bmNfXywgZW5naW5lLT5u
YW1lKTsKIAkJaWYgKGVycikKLQkJCWdvdG8gb3V0X3VubG9jazsKKwkJCXJldHVybiBlcnI7CiAK
IAkJZm9yX2VhY2hfcHJpbWVfbnVtYmVyX2Zyb20ocHJpbWUsIDEsIDgxOTIpIHsKKwkJCXN0cnVj
dCBpOTE1X3JlcXVlc3QgKnJlcXVlc3QgPSBOVUxMOworCiAJCQl0aW1lc1sxXSA9IGt0aW1lX2dl
dF9yYXcoKTsKIAogCQkJZm9yIChuID0gMDsgbiA8IHByaW1lOyBuKyspIHsKKwkJCQlpOTE1X3Jl
cXVlc3RfcHV0KHJlcXVlc3QpOwogCQkJCXJlcXVlc3QgPSBpOTE1X3JlcXVlc3RfY3JlYXRlKGVu
Z2luZS0+a2VybmVsX2NvbnRleHQpOwotCQkJCWlmIChJU19FUlIocmVxdWVzdCkpIHsKLQkJCQkJ
ZXJyID0gUFRSX0VSUihyZXF1ZXN0KTsKLQkJCQkJZ290byBvdXRfdW5sb2NrOwotCQkJCX0KKwkJ
CQlpZiAoSVNfRVJSKHJlcXVlc3QpKQorCQkJCQlyZXR1cm4gUFRSX0VSUihyZXF1ZXN0KTsKIAog
CQkJCS8qIFRoaXMgc3BhY2UgaXMgbGVmdCBpbnRlbnRpb25hbGx5IGJsYW5rLgogCQkJCSAqCkBA
IC01ODUsOSArNTU4LDExIEBAIHN0YXRpYyBpbnQgbGl2ZV9ub3BfcmVxdWVzdCh2b2lkICphcmcp
CiAJCQkJICogZm9yIGxhdGVuY3kuCiAJCQkJICovCiAKKwkJCQlpOTE1X3JlcXVlc3RfZ2V0KHJl
cXVlc3QpOwogCQkJCWk5MTVfcmVxdWVzdF9hZGQocmVxdWVzdCk7CiAJCQl9CiAJCQlpOTE1X3Jl
cXVlc3Rfd2FpdChyZXF1ZXN0LCAwLCBNQVhfU0NIRURVTEVfVElNRU9VVCk7CisJCQlpOTE1X3Jl
cXVlc3RfcHV0KHJlcXVlc3QpOwogCiAJCQl0aW1lc1sxXSA9IGt0aW1lX3N1YihrdGltZV9nZXRf
cmF3KCksIHRpbWVzWzFdKTsKIAkJCWlmIChwcmltZSA9PSAxKQpAQCAtNTk5LDcgKzU3NCw3IEBA
IHN0YXRpYyBpbnQgbGl2ZV9ub3BfcmVxdWVzdCh2b2lkICphcmcpCiAKIAkJZXJyID0gaWd0X2xp
dmVfdGVzdF9lbmQoJnQpOwogCQlpZiAoZXJyKQotCQkJZ290byBvdXRfdW5sb2NrOworCQkJcmV0
dXJuIGVycjsKIAogCQlwcl9pbmZvKCJSZXF1ZXN0IGxhdGVuY2llcyBvbiAlczogMSA9ICVsbHVu
cywgJWx1ID0gJWxsdW5zXG4iLAogCQkJZW5naW5lLT5uYW1lLApAQCAtNjA3LDkgKzU4Miw2IEBA
IHN0YXRpYyBpbnQgbGl2ZV9ub3BfcmVxdWVzdCh2b2lkICphcmcpCiAJCQlwcmltZSwgZGl2NjRf
dTY0KGt0aW1lX3RvX25zKHRpbWVzWzFdKSwgcHJpbWUpKTsKIAl9CiAKLW91dF91bmxvY2s6Ci0J
aW50ZWxfcnVudGltZV9wbV9wdXQoJmk5MTUtPnJ1bnRpbWVfcG0sIHdha2VyZWYpOwotCW11dGV4
X3VubG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CiAJcmV0dXJuIGVycjsKIH0KIApAQCAt
Njc5LDYgKzY1MSw3IEBAIGVtcHR5X3JlcXVlc3Qoc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5n
aW5lLAogCWlmIChlcnIpCiAJCWdvdG8gb3V0X3JlcXVlc3Q7CiAKKwlpOTE1X3JlcXVlc3RfZ2V0
KHJlcXVlc3QpOwogb3V0X3JlcXVlc3Q6CiAJaTkxNV9yZXF1ZXN0X2FkZChyZXF1ZXN0KTsKIAly
ZXR1cm4gZXJyID8gRVJSX1BUUihlcnIpIDogcmVxdWVzdDsKQEAgLTY4OCw3ICs2NjEsNiBAQCBz
dGF0aWMgaW50IGxpdmVfZW1wdHlfcmVxdWVzdCh2b2lkICphcmcpCiB7CiAJc3RydWN0IGRybV9p
OTE1X3ByaXZhdGUgKmk5MTUgPSBhcmc7CiAJc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5l
OwotCWludGVsX3dha2VyZWZfdCB3YWtlcmVmOwogCXN0cnVjdCBpZ3RfbGl2ZV90ZXN0IHQ7CiAJ
c3RydWN0IGk5MTVfdm1hICpiYXRjaDsKIAl1bnNpZ25lZCBpbnQgaWQ7CkBAIC02OTksMTQgKzY3
MSw5IEBAIHN0YXRpYyBpbnQgbGl2ZV9lbXB0eV9yZXF1ZXN0KHZvaWQgKmFyZykKIAkgKiB0aGUg
b3ZlcmhlYWQgb2Ygc3VibWl0dGluZyByZXF1ZXN0cyB0byB0aGUgaGFyZHdhcmUuCiAJICovCiAK
LQltdXRleF9sb2NrKCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsKLQl3YWtlcmVmID0gaW50ZWxf
cnVudGltZV9wbV9nZXQoJmk5MTUtPnJ1bnRpbWVfcG0pOwotCiAJYmF0Y2ggPSBlbXB0eV9iYXRj
aChpOTE1KTsKLQlpZiAoSVNfRVJSKGJhdGNoKSkgewotCQllcnIgPSBQVFJfRVJSKGJhdGNoKTsK
LQkJZ290byBvdXRfdW5sb2NrOwotCX0KKwlpZiAoSVNfRVJSKGJhdGNoKSkKKwkJcmV0dXJuIFBU
Ul9FUlIoYmF0Y2gpOwogCiAJZm9yX2VhY2hfZW5naW5lKGVuZ2luZSwgaTkxNSwgaWQpIHsKIAkJ
SUdUX1RJTUVPVVQoZW5kX3RpbWUpOwpAQCAtNzMwLDYgKzY5Nyw3IEBAIHN0YXRpYyBpbnQgbGl2
ZV9lbXB0eV9yZXF1ZXN0KHZvaWQgKmFyZykKIAkJCXRpbWVzWzFdID0ga3RpbWVfZ2V0X3Jhdygp
OwogCiAJCQlmb3IgKG4gPSAwOyBuIDwgcHJpbWU7IG4rKykgeworCQkJCWk5MTVfcmVxdWVzdF9w
dXQocmVxdWVzdCk7CiAJCQkJcmVxdWVzdCA9IGVtcHR5X3JlcXVlc3QoZW5naW5lLCBiYXRjaCk7
CiAJCQkJaWYgKElTX0VSUihyZXF1ZXN0KSkgewogCQkJCQllcnIgPSBQVFJfRVJSKHJlcXVlc3Qp
OwpAQCAtNzQ1LDYgKzcxMyw3IEBAIHN0YXRpYyBpbnQgbGl2ZV9lbXB0eV9yZXF1ZXN0KHZvaWQg
KmFyZykKIAkJCWlmIChfX2lndF90aW1lb3V0KGVuZF90aW1lLCBOVUxMKSkKIAkJCQlicmVhazsK
IAkJfQorCQlpOTE1X3JlcXVlc3RfcHV0KHJlcXVlc3QpOwogCiAJCWVyciA9IGlndF9saXZlX3Rl
c3RfZW5kKCZ0KTsKIAkJaWYgKGVycikKQEAgLTc1OSw5ICs3MjgsNiBAQCBzdGF0aWMgaW50IGxp
dmVfZW1wdHlfcmVxdWVzdCh2b2lkICphcmcpCiBvdXRfYmF0Y2g6CiAJaTkxNV92bWFfdW5waW4o
YmF0Y2gpOwogCWk5MTVfdm1hX3B1dChiYXRjaCk7Ci1vdXRfdW5sb2NrOgotCWludGVsX3J1bnRp
bWVfcG1fcHV0KCZpOTE1LT5ydW50aW1lX3BtLCB3YWtlcmVmKTsKLQltdXRleF91bmxvY2soJmk5
MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwogCXJldHVybiBlcnI7CiB9CiAKQEAgLTg0MSw3ICs4MDcs
NiBAQCBzdGF0aWMgaW50IGxpdmVfYWxsX2VuZ2luZXModm9pZCAqYXJnKQogCXN0cnVjdCBkcm1f
aTkxNV9wcml2YXRlICppOTE1ID0gYXJnOwogCXN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2lu
ZTsKIAlzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpyZXF1ZXN0W0k5MTVfTlVNX0VOR0lORVNdOwotCWlu
dGVsX3dha2VyZWZfdCB3YWtlcmVmOwogCXN0cnVjdCBpZ3RfbGl2ZV90ZXN0IHQ7CiAJc3RydWN0
IGk5MTVfdm1hICpiYXRjaDsKIAl1bnNpZ25lZCBpbnQgaWQ7CkBAIC04NTIsMTggKzgxNywxNSBA
QCBzdGF0aWMgaW50IGxpdmVfYWxsX2VuZ2luZXModm9pZCAqYXJnKQogCSAqIGJsb2NrIGRvaW5n
IHNvLCBhbmQgdGhhdCB0aGV5IGRvbid0IGNvbXBsZXRlIHRvbyBzb29uLgogCSAqLwogCi0JbXV0
ZXhfbG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7Ci0Jd2FrZXJlZiA9IGludGVsX3J1bnRp
bWVfcG1fZ2V0KCZpOTE1LT5ydW50aW1lX3BtKTsKLQogCWVyciA9IGlndF9saXZlX3Rlc3RfYmVn
aW4oJnQsIGk5MTUsIF9fZnVuY19fLCAiIik7CiAJaWYgKGVycikKLQkJZ290byBvdXRfdW5sb2Nr
OworCQlyZXR1cm4gZXJyOwogCiAJYmF0Y2ggPSByZWN1cnNpdmVfYmF0Y2goaTkxNSk7CiAJaWYg
KElTX0VSUihiYXRjaCkpIHsKIAkJZXJyID0gUFRSX0VSUihiYXRjaCk7CiAJCXByX2VycigiJXM6
IFVuYWJsZSB0byBjcmVhdGUgYmF0Y2gsIGVycj0lZFxuIiwgX19mdW5jX18sIGVycik7Ci0JCWdv
dG8gb3V0X3VubG9jazsKKwkJcmV0dXJuIGVycjsKIAl9CiAKIAlmb3JfZWFjaF9lbmdpbmUoZW5n
aW5lLCBpOTE1LCBpZCkgewpAQCAtOTMzLDkgKzg5NSw2IEBAIHN0YXRpYyBpbnQgbGl2ZV9hbGxf
ZW5naW5lcyh2b2lkICphcmcpCiAJCQlpOTE1X3JlcXVlc3RfcHV0KHJlcXVlc3RbaWRdKTsKIAlp
OTE1X3ZtYV91bnBpbihiYXRjaCk7CiAJaTkxNV92bWFfcHV0KGJhdGNoKTsKLW91dF91bmxvY2s6
Ci0JaW50ZWxfcnVudGltZV9wbV9wdXQoJmk5MTUtPnJ1bnRpbWVfcG0sIHdha2VyZWYpOwotCW11
dGV4X3VubG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CiAJcmV0dXJuIGVycjsKIH0KIApA
QCAtOTQ1LDcgKzkwNCw2IEBAIHN0YXRpYyBpbnQgbGl2ZV9zZXF1ZW50aWFsX2VuZ2luZXModm9p
ZCAqYXJnKQogCXN0cnVjdCBpOTE1X3JlcXVlc3QgKnJlcXVlc3RbSTkxNV9OVU1fRU5HSU5FU10g
PSB7fTsKIAlzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpwcmV2ID0gTlVMTDsKIAlzdHJ1Y3QgaW50ZWxf
ZW5naW5lX2NzICplbmdpbmU7Ci0JaW50ZWxfd2FrZXJlZl90IHdha2VyZWY7CiAJc3RydWN0IGln
dF9saXZlX3Rlc3QgdDsKIAl1bnNpZ25lZCBpbnQgaWQ7CiAJaW50IGVycjsKQEAgLTk1NiwxMiAr
OTE0LDkgQEAgc3RhdGljIGludCBsaXZlX3NlcXVlbnRpYWxfZW5naW5lcyh2b2lkICphcmcpCiAJ
ICogdGhleSBhcmUgcnVubmluZyBvbiBpbmRlcGVuZGVudCBlbmdpbmVzLgogCSAqLwogCi0JbXV0
ZXhfbG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7Ci0Jd2FrZXJlZiA9IGludGVsX3J1bnRp
bWVfcG1fZ2V0KCZpOTE1LT5ydW50aW1lX3BtKTsKLQogCWVyciA9IGlndF9saXZlX3Rlc3RfYmVn
aW4oJnQsIGk5MTUsIF9fZnVuY19fLCAiIik7CiAJaWYgKGVycikKLQkJZ290byBvdXRfdW5sb2Nr
OworCQlyZXR1cm4gZXJyOwogCiAJZm9yX2VhY2hfZW5naW5lKGVuZ2luZSwgaTkxNSwgaWQpIHsK
IAkJc3RydWN0IGk5MTVfdm1hICpiYXRjaDsKQEAgLTk3MSw3ICs5MjYsNyBAQCBzdGF0aWMgaW50
IGxpdmVfc2VxdWVudGlhbF9lbmdpbmVzKHZvaWQgKmFyZykKIAkJCWVyciA9IFBUUl9FUlIoYmF0
Y2gpOwogCQkJcHJfZXJyKCIlczogVW5hYmxlIHRvIGNyZWF0ZSBiYXRjaCBmb3IgJXMsIGVycj0l
ZFxuIiwKIAkJCSAgICAgICBfX2Z1bmNfXywgZW5naW5lLT5uYW1lLCBlcnIpOwotCQkJZ290byBv
dXRfdW5sb2NrOworCQkJcmV0dXJuIGVycjsKIAkJfQogCiAJCXJlcXVlc3RbaWRdID0gaTkxNV9y
ZXF1ZXN0X2NyZWF0ZShlbmdpbmUtPmtlcm5lbF9jb250ZXh0KTsKQEAgLTEwNjMsOSArMTAxOCw2
IEBAIHN0YXRpYyBpbnQgbGl2ZV9zZXF1ZW50aWFsX2VuZ2luZXModm9pZCAqYXJnKQogCQlpOTE1
X3ZtYV9wdXQocmVxdWVzdFtpZF0tPmJhdGNoKTsKIAkJaTkxNV9yZXF1ZXN0X3B1dChyZXF1ZXN0
W2lkXSk7CiAJfQotb3V0X3VubG9jazoKLQlpbnRlbF9ydW50aW1lX3BtX3B1dCgmaTkxNS0+cnVu
dGltZV9wbSwgd2FrZXJlZik7Ci0JbXV0ZXhfdW5sb2NrKCZpOTE1LT5kcm0uc3RydWN0X211dGV4
KTsKIAlyZXR1cm4gZXJyOwogfQogCkBAIC0xMDgwLDE2ICsxMDMyLDEyIEBAIHN0YXRpYyBpbnQg
X19saXZlX3BhcmFsbGVsX2VuZ2luZTEodm9pZCAqYXJnKQogCQlzdHJ1Y3QgaTkxNV9yZXF1ZXN0
ICpycTsKIAkJaW50IGVycjsKIAotCQltdXRleF9sb2NrKCZlbmdpbmUtPmk5MTUtPmRybS5zdHJ1
Y3RfbXV0ZXgpOwogCQlycSA9IGk5MTVfcmVxdWVzdF9jcmVhdGUoZW5naW5lLT5rZXJuZWxfY29u
dGV4dCk7Ci0JCWlmIChJU19FUlIocnEpKSB7Ci0JCQltdXRleF91bmxvY2soJmVuZ2luZS0+aTkx
NS0+ZHJtLnN0cnVjdF9tdXRleCk7CisJCWlmIChJU19FUlIocnEpKQogCQkJcmV0dXJuIFBUUl9F
UlIocnEpOwotCQl9CiAKIAkJaTkxNV9yZXF1ZXN0X2dldChycSk7CiAJCWk5MTVfcmVxdWVzdF9h
ZGQocnEpOwotCQltdXRleF91bmxvY2soJmVuZ2luZS0+aTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7
CiAKIAkJZXJyID0gMDsKIAkJaWYgKGk5MTVfcmVxdWVzdF93YWl0KHJxLCAwLCBIWiAvIDUpIDwg
MCkKQEAgLTExMTUsMTYgKzEwNjMsMTEgQEAgc3RhdGljIGludCBfX2xpdmVfcGFyYWxsZWxfZW5n
aW5lTih2b2lkICphcmcpCiAJZG8gewogCQlzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpycTsKIAotCQlt
dXRleF9sb2NrKCZlbmdpbmUtPmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwogCQlycSA9IGk5MTVf
cmVxdWVzdF9jcmVhdGUoZW5naW5lLT5rZXJuZWxfY29udGV4dCk7Ci0JCWlmIChJU19FUlIocnEp
KSB7Ci0JCQltdXRleF91bmxvY2soJmVuZ2luZS0+aTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CisJ
CWlmIChJU19FUlIocnEpKQogCQkJcmV0dXJuIFBUUl9FUlIocnEpOwotCQl9CiAKIAkJaTkxNV9y
ZXF1ZXN0X2FkZChycSk7Ci0JCW11dGV4X3VubG9jaygmZW5naW5lLT5pOTE1LT5kcm0uc3RydWN0
X211dGV4KTsKLQogCQljb3VudCsrOwogCX0gd2hpbGUgKCFfX2lndF90aW1lb3V0KGVuZF90aW1l
LCBOVUxMKSk7CiAKQEAgLTExNTQsOSArMTA5Nyw3IEBAIHN0YXRpYyBpbnQgbGl2ZV9wYXJhbGxl
bF9lbmdpbmVzKHZvaWQgKmFyZykKIAkJc3RydWN0IHRhc2tfc3RydWN0ICp0c2tbSTkxNV9OVU1f
RU5HSU5FU10gPSB7fTsKIAkJc3RydWN0IGlndF9saXZlX3Rlc3QgdDsKIAotCQltdXRleF9sb2Nr
KCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsKIAkJZXJyID0gaWd0X2xpdmVfdGVzdF9iZWdpbigm
dCwgaTkxNSwgX19mdW5jX18sICIiKTsKLQkJbXV0ZXhfdW5sb2NrKCZpOTE1LT5kcm0uc3RydWN0
X211dGV4KTsKIAkJaWYgKGVycikKIAkJCWJyZWFrOwogCkBAIC0xMTg0LDEwICsxMTI1LDggQEAg
c3RhdGljIGludCBsaXZlX3BhcmFsbGVsX2VuZ2luZXModm9pZCAqYXJnKQogCQkJcHV0X3Rhc2tf
c3RydWN0KHRza1tpZF0pOwogCQl9CiAKLQkJbXV0ZXhfbG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9t
dXRleCk7CiAJCWlmIChpZ3RfbGl2ZV90ZXN0X2VuZCgmdCkpCiAJCQllcnIgPSAtRUlPOwotCQlt
dXRleF91bmxvY2soJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwogCX0KIAogCXJldHVybiBlcnI7
CkBAIC0xMjgwLDkgKzEyMTksMTAgQEAgc3RhdGljIGludCBsaXZlX2JyZWFkY3J1bWJzX3Ntb2tl
dGVzdCh2b2lkICphcmcpCiAJCWdvdG8gb3V0X3RocmVhZHM7CiAJfQogCi0JbXV0ZXhfbG9jaygm
aTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CiAJZm9yIChuID0gMDsgbiA8IHRbMF0ubmNvbnRleHRz
OyBuKyspIHsKKwkJbXV0ZXhfbG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CiAJCXRbMF0u
Y29udGV4dHNbbl0gPSBsaXZlX2NvbnRleHQoaTkxNSwgZmlsZSk7CisJCW11dGV4X3VubG9jaygm
aTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CiAJCWlmICghdFswXS5jb250ZXh0c1tuXSkgewogCQkJ
cmV0ID0gLUVOT01FTTsKIAkJCWdvdG8gb3V0X2NvbnRleHRzOwpAQCAtMTI5OSw3ICsxMjM5LDYg
QEAgc3RhdGljIGludCBsaXZlX2JyZWFkY3J1bWJzX3Ntb2tldGVzdCh2b2lkICphcmcpCiAJCXRb
aWRdLm1heF9iYXRjaCA9IG1heF9iYXRjaGVzKHRbMF0uY29udGV4dHNbMF0sIGVuZ2luZSk7CiAJ
CWlmICh0W2lkXS5tYXhfYmF0Y2ggPCAwKSB7CiAJCQlyZXQgPSB0W2lkXS5tYXhfYmF0Y2g7Ci0J
CQltdXRleF91bmxvY2soJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwogCQkJZ290byBvdXRfZmx1
c2g7CiAJCX0KIAkJLyogT25lIHJpbmcgaW50ZXJsZWF2ZWQgYmV0d2VlbiByZXF1ZXN0cyBmcm9t
IGFsbCBjcHVzICovCkBAIC0xMzE0LDcgKzEyNTMsNiBAQCBzdGF0aWMgaW50IGxpdmVfYnJlYWRj
cnVtYnNfc21va2V0ZXN0KHZvaWQgKmFyZykKIAkJCQkJICAmdFtpZF0sICJpZ3QvJWQuJWQiLCBp
ZCwgbik7CiAJCQlpZiAoSVNfRVJSKHRzaykpIHsKIAkJCQlyZXQgPSBQVFJfRVJSKHRzayk7Ci0J
CQkJbXV0ZXhfdW5sb2NrKCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsKIAkJCQlnb3RvIG91dF9m
bHVzaDsKIAkJCX0KIApAQCAtMTMyMiw3ICsxMjYwLDYgQEAgc3RhdGljIGludCBsaXZlX2JyZWFk
Y3J1bWJzX3Ntb2tldGVzdCh2b2lkICphcmcpCiAJCQl0aHJlYWRzW2lkICogbmNwdXMgKyBuXSA9
IHRzazsKIAkJfQogCX0KLQltdXRleF91bmxvY2soJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwog
CiAJbXNsZWVwKGppZmZpZXNfdG9fbXNlY3MoaTkxNV9zZWxmdGVzdC50aW1lb3V0X2ppZmZpZXMp
KTsKIApAQCAtMTM1MCwxMCArMTI4Nyw4IEBAIHN0YXRpYyBpbnQgbGl2ZV9icmVhZGNydW1ic19z
bW9rZXRlc3Qodm9pZCAqYXJnKQogCXByX2luZm8oIkNvbXBsZXRlZCAlbHUgd2FpdHMgZm9yICVs
dSBmZW5jZXMgYWNyb3NzICVkIGVuZ2luZXMgYW5kICVkIGNwdXNcbiIsCiAJCW51bV93YWl0cywg
bnVtX2ZlbmNlcywgUlVOVElNRV9JTkZPKGk5MTUpLT5udW1fZW5naW5lcywgbmNwdXMpOwogCi0J
bXV0ZXhfbG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CiAJcmV0ID0gaWd0X2xpdmVfdGVz
dF9lbmQoJmxpdmUpID86IHJldDsKIG91dF9jb250ZXh0czoKLQltdXRleF91bmxvY2soJmk5MTUt
PmRybS5zdHJ1Y3RfbXV0ZXgpOwogCWtmcmVlKHRbMF0uY29udGV4dHMpOwogb3V0X3RocmVhZHM6
CiAJa2ZyZWUodGhyZWFkcyk7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9zZWxm
dGVzdHMvaTkxNV9zZWxmdGVzdC5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvc2VsZnRlc3RzL2k5
MTVfc2VsZnRlc3QuYwppbmRleCA0MzhlYTBlYWE0MTYuLjgyNWE4Mjg2Y2JlOCAxMDA2NDQKLS0t
IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvc2VsZnRlc3RzL2k5MTVfc2VsZnRlc3QuYworKysgYi9k
cml2ZXJzL2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMvaTkxNV9zZWxmdGVzdC5jCkBAIC0yNjMsMTAg
KzI2Myw4IEBAIGludCBfX2k5MTVfbGl2ZV90ZWFyZG93bihpbnQgZXJyLCB2b2lkICpkYXRhKQog
ewogCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0gZGF0YTsKIAotCW11dGV4X2xvY2so
Jmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwotCWlmIChpZ3RfZmx1c2hfdGVzdChpOTE1LCBJOTE1
X1dBSVRfTE9DS0VEKSkKKwlpZiAoaWd0X2ZsdXNoX3Rlc3QoaTkxNSkpCiAJCWVyciA9IC1FSU87
Ci0JbXV0ZXhfdW5sb2NrKCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsKIAogCWk5MTVfZ2VtX2Ry
YWluX2ZyZWVkX29iamVjdHMoaTkxNSk7CiAKQEAgLTI4NCwxMCArMjgyLDggQEAgaW50IF9faW50
ZWxfZ3RfbGl2ZV90ZWFyZG93bihpbnQgZXJyLCB2b2lkICpkYXRhKQogewogCXN0cnVjdCBpbnRl
bF9ndCAqZ3QgPSBkYXRhOwogCi0JbXV0ZXhfbG9jaygmZ3QtPmk5MTUtPmRybS5zdHJ1Y3RfbXV0
ZXgpOwotCWlmIChpZ3RfZmx1c2hfdGVzdChndC0+aTkxNSwgSTkxNV9XQUlUX0xPQ0tFRCkpCisJ
aWYgKGlndF9mbHVzaF90ZXN0KGd0LT5pOTE1KSkKIAkJZXJyID0gLUVJTzsKLQltdXRleF91bmxv
Y2soJmd0LT5pOTE1LT5kcm0uc3RydWN0X211dGV4KTsKIAogCWk5MTVfZ2VtX2RyYWluX2ZyZWVk
X29iamVjdHMoZ3QtPmk5MTUpOwogCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9z
ZWxmdGVzdHMvaTkxNV92bWEuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L3NlbGZ0ZXN0cy9pOTE1
X3ZtYS5jCmluZGV4IDBlNGY2NjMxMmIzOS4uMWM5ZGIwOGY3YzI4IDEwMDY0NAotLS0gYS9kcml2
ZXJzL2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMvaTkxNV92bWEuYworKysgYi9kcml2ZXJzL2dwdS9k
cm0vaTkxNS9zZWxmdGVzdHMvaTkxNV92bWEuYwpAQCAtODMzLDEyICs4MzMsOCBAQCBpbnQgaTkx
NV92bWFfbW9ja19zZWxmdGVzdHModm9pZCkKIAogCWVyciA9IGk5MTVfc3VidGVzdHModGVzdHMs
IGdndHQpOwogCi0JbXV0ZXhfbG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CiAJbW9ja19k
ZXZpY2VfZmx1c2goaTkxNSk7Ci0JbXV0ZXhfdW5sb2NrKCZpOTE1LT5kcm0uc3RydWN0X211dGV4
KTsKLQogCWk5MTVfZ2VtX2RyYWluX2ZyZWVkX29iamVjdHMoaTkxNSk7Ci0KIAltb2NrX2Zpbmlf
Z2d0dChnZ3R0KTsKIAlrZnJlZShnZ3R0KTsKIG91dF9wdXQ6CmRpZmYgLS1naXQgYS9kcml2ZXJz
L2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMvaWd0X2ZsdXNoX3Rlc3QuYyBiL2RyaXZlcnMvZ3B1L2Ry
bS9pOTE1L3NlbGZ0ZXN0cy9pZ3RfZmx1c2hfdGVzdC5jCmluZGV4IGQzYjVlYjQwMmQzMy4uMmE1
ZmJlNDZlYTlmIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMvaWd0
X2ZsdXNoX3Rlc3QuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMvaWd0X2Zs
dXNoX3Rlc3QuYwpAQCAtMTIsMzEgKzEyLDI1IEBACiAKICNpbmNsdWRlICJpZ3RfZmx1c2hfdGVz
dC5oIgogCi1pbnQgaWd0X2ZsdXNoX3Rlc3Qoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUs
IHVuc2lnbmVkIGludCBmbGFncykKK2ludCBpZ3RfZmx1c2hfdGVzdChzdHJ1Y3QgZHJtX2k5MTVf
cHJpdmF0ZSAqaTkxNSkKIHsKIAlpbnQgcmV0ID0gaW50ZWxfZ3RfaXNfd2VkZ2VkKCZpOTE1LT5n
dCkgPyAtRUlPIDogMDsKLQlpbnQgcmVwZWF0ID0gISEoZmxhZ3MgJiBJOTE1X1dBSVRfTE9DS0VE
KTsKIAogCWNvbmRfcmVzY2hlZCgpOwogCi0JZG8gewotCQlpZiAoaTkxNV9nZW1fd2FpdF9mb3Jf
aWRsZShpOTE1LCBmbGFncywgSFogLyA1KSA9PSAtRVRJTUUpIHsKLQkJCXByX2VycigiJXBTIHRp
bWVkIG91dCwgY2FuY2VsbGluZyBhbGwgZnVydGhlciB0ZXN0aW5nLlxuIiwKLQkJCSAgICAgICBf
X2J1aWx0aW5fcmV0dXJuX2FkZHJlc3MoMCkpOworCWk5MTVfcmV0aXJlX3JlcXVlc3RzKGk5MTUp
OworCWlmIChpOTE1X2dlbV93YWl0X2Zvcl9pZGxlKGk5MTUsIDAsIEhaIC8gNSkgPT0gLUVUSU1F
KSB7CisJCXByX2VycigiJXBTIHRpbWVkIG91dCwgY2FuY2VsbGluZyBhbGwgZnVydGhlciB0ZXN0
aW5nLlxuIiwKKwkJICAgICAgIF9fYnVpbHRpbl9yZXR1cm5fYWRkcmVzcygwKSk7CiAKLQkJCUdF
TV9UUkFDRSgiJXBTIHRpbWVkIG91dC5cbiIsCi0JCQkJICBfX2J1aWx0aW5fcmV0dXJuX2FkZHJl
c3MoMCkpOwotCQkJR0VNX1RSQUNFX0RVTVAoKTsKKwkJR0VNX1RSQUNFKCIlcFMgdGltZWQgb3V0
LlxuIiwKKwkJCSAgX19idWlsdGluX3JldHVybl9hZGRyZXNzKDApKTsKKwkJR0VNX1RSQUNFX0RV
TVAoKTsKIAotCQkJaW50ZWxfZ3Rfc2V0X3dlZGdlZCgmaTkxNS0+Z3QpOwotCQkJcmVwZWF0ID0g
MDsKLQkJCXJldCA9IC1FSU87Ci0JCX0KLQotCQkvKiBFbnN1cmUgd2UgYWxzbyBmbHVzaCBhZnRl
ciB3ZWRnaW5nLiAqLwotCQlpZiAoZmxhZ3MgJiBJOTE1X1dBSVRfTE9DS0VEKQotCQkJaTkxNV9y
ZXRpcmVfcmVxdWVzdHMoaTkxNSk7Ci0JfSB3aGlsZSAocmVwZWF0LS0pOworCQlpbnRlbF9ndF9z
ZXRfd2VkZ2VkKCZpOTE1LT5ndCk7CisJCXJldCA9IC1FSU87CisJfQorCWk5MTVfcmV0aXJlX3Jl
cXVlc3RzKGk5MTUpOwogCiAJcmV0dXJuIHJldDsKIH0KZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1
L2RybS9pOTE1L3NlbGZ0ZXN0cy9pZ3RfZmx1c2hfdGVzdC5oIGIvZHJpdmVycy9ncHUvZHJtL2k5
MTUvc2VsZnRlc3RzL2lndF9mbHVzaF90ZXN0LmgKaW5kZXggNjNlMDA5OTI3YzQzLi43NTQxZmE3
NGU2NDEgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L3NlbGZ0ZXN0cy9pZ3RfZmx1
c2hfdGVzdC5oCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L3NlbGZ0ZXN0cy9pZ3RfZmx1c2hf
dGVzdC5oCkBAIC05LDYgKzksNiBAQAogCiBzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZTsKIAotaW50
IGlndF9mbHVzaF90ZXN0KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LCB1bnNpZ25lZCBp
bnQgZmxhZ3MpOworaW50IGlndF9mbHVzaF90ZXN0KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpp
OTE1KTsKIAogI2VuZGlmIC8qIElHVF9GTFVTSF9URVNUX0ggKi8KZGlmZiAtLWdpdCBhL2RyaXZl
cnMvZ3B1L2RybS9pOTE1L3NlbGZ0ZXN0cy9pZ3RfbGl2ZV90ZXN0LmMgYi9kcml2ZXJzL2dwdS9k
cm0vaTkxNS9zZWxmdGVzdHMvaWd0X2xpdmVfdGVzdC5jCmluZGV4IDNlOTAyNzYxY2QxNi4uMDRh
NmY4OGZkZjY0IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMvaWd0
X2xpdmVfdGVzdC5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L3NlbGZ0ZXN0cy9pZ3RfbGl2
ZV90ZXN0LmMKQEAgLTE5LDE1ICsxOSwxMiBAQCBpbnQgaWd0X2xpdmVfdGVzdF9iZWdpbihzdHJ1
Y3QgaWd0X2xpdmVfdGVzdCAqdCwKIAllbnVtIGludGVsX2VuZ2luZV9pZCBpZDsKIAlpbnQgZXJy
OwogCi0JbG9ja2RlcF9hc3NlcnRfaGVsZCgmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7Ci0KIAl0
LT5pOTE1ID0gaTkxNTsKIAl0LT5mdW5jID0gZnVuYzsKIAl0LT5uYW1lID0gbmFtZTsKIAogCWVy
ciA9IGk5MTVfZ2VtX3dhaXRfZm9yX2lkbGUoaTkxNSwKLQkJCQkgICAgIEk5MTVfV0FJVF9JTlRF
UlJVUFRJQkxFIHwKLQkJCQkgICAgIEk5MTVfV0FJVF9MT0NLRUQsCisJCQkJICAgICBJOTE1X1dB
SVRfSU5URVJSVVBUSUJMRSwKIAkJCQkgICAgIE1BWF9TQ0hFRFVMRV9USU1FT1VUKTsKIAlpZiAo
ZXJyKSB7CiAJCXByX2VycigiJXMoJXMpOiBmYWlsZWQgdG8gaWRsZSBiZWZvcmUsIHdpdGggZXJy
PSVkISIsCkBAIC01MCw5ICs0Nyw3IEBAIGludCBpZ3RfbGl2ZV90ZXN0X2VuZChzdHJ1Y3QgaWd0
X2xpdmVfdGVzdCAqdCkKIAlzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmU7CiAJZW51bSBp
bnRlbF9lbmdpbmVfaWQgaWQ7CiAKLQlsb2NrZGVwX2Fzc2VydF9oZWxkKCZpOTE1LT5kcm0uc3Ry
dWN0X211dGV4KTsKLQotCWlmIChpZ3RfZmx1c2hfdGVzdChpOTE1LCBJOTE1X1dBSVRfTE9DS0VE
KSkKKwlpZiAoaWd0X2ZsdXNoX3Rlc3QoaTkxNSkpCiAJCXJldHVybiAtRUlPOwogCiAJaWYgKHQt
PnJlc2V0X2dsb2JhbCAhPSBpOTE1X3Jlc2V0X2NvdW50KCZpOTE1LT5ncHVfZXJyb3IpKSB7CmRp
ZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMvbW9ja19nZW1fZGV2aWNl
LmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMvbW9ja19nZW1fZGV2aWNlLmMKaW5k
ZXggMjQ0ODA2NzgyMmFmLi42MjJiYjIxMjc0NTMgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2Ry
bS9pOTE1L3NlbGZ0ZXN0cy9tb2NrX2dlbV9kZXZpY2UuYworKysgYi9kcml2ZXJzL2dwdS9kcm0v
aTkxNS9zZWxmdGVzdHMvbW9ja19nZW1fZGV2aWNlLmMKQEAgLTQxLDggKzQxLDYgQEAgdm9pZCBt
b2NrX2RldmljZV9mbHVzaChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkKIAlzdHJ1Y3Qg
aW50ZWxfZW5naW5lX2NzICplbmdpbmU7CiAJZW51bSBpbnRlbF9lbmdpbmVfaWQgaWQ7CiAKLQls
b2NrZGVwX2Fzc2VydF9oZWxkKCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsKLQogCWRvIHsKIAkJ
Zm9yX2VhY2hfZW5naW5lKGVuZ2luZSwgaTkxNSwgaWQpCiAJCQltb2NrX2VuZ2luZV9mbHVzaChl
bmdpbmUpOwpAQCAtNTUsOSArNTMsNyBAQCBzdGF0aWMgdm9pZCBtb2NrX2RldmljZV9yZWxlYXNl
KHN0cnVjdCBkcm1fZGV2aWNlICpkZXYpCiAJc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5l
OwogCWVudW0gaW50ZWxfZW5naW5lX2lkIGlkOwogCi0JbXV0ZXhfbG9jaygmaTkxNS0+ZHJtLnN0
cnVjdF9tdXRleCk7CiAJbW9ja19kZXZpY2VfZmx1c2goaTkxNSk7Ci0JbXV0ZXhfdW5sb2NrKCZp
OTE1LT5kcm0uc3RydWN0X211dGV4KTsKIAogCWZsdXNoX3dvcmsoJmk5MTUtPmdlbS5pZGxlX3dv
cmspOwogCWk5MTVfZ2VtX2RyYWluX3dvcmtxdWV1ZShpOTE1KTsKLS0gCjIuMjMuMAoKX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX18KSW50ZWwtZ2Z4IG1haWxp
bmcgbGlzdApJbnRlbC1nZnhAbGlzdHMuZnJlZWRlc2t0b3Aub3JnCmh0dHBzOi8vbGlzdHMuZnJl
ZWRlc2t0b3Aub3JnL21haWxtYW4vbGlzdGluZm8vaW50ZWwtZ2Z4

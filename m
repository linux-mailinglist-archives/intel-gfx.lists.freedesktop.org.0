Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id DACAE115015
	for <lists+intel-gfx@lfdr.de>; Fri,  6 Dec 2019 12:57:14 +0100 (CET)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 9A6CE6F9DA;
	Fri,  6 Dec 2019 11:57:12 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from mga07.intel.com (mga07.intel.com [134.134.136.100])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 14BF36F9DA
 for <intel-gfx@lists.freedesktop.org>; Fri,  6 Dec 2019 11:57:10 +0000 (UTC)
X-Amp-Result: SKIPPED(no attachment in message)
X-Amp-File-Uploaded: False
Received: from orsmga001.jf.intel.com ([10.7.209.18])
 by orsmga105.jf.intel.com with ESMTP/TLS/DHE-RSA-AES256-GCM-SHA384;
 06 Dec 2019 03:57:10 -0800
X-ExtLoop1: 1
X-IronPort-AV: E=Sophos;i="5.69,284,1571727600"; d="scan'208";a="294839321"
Received: from cliu38-mobl3.sh.intel.com (HELO 286ab234718b.sh.intel.com)
 ([10.239.147.26])
 by orsmga001.jf.intel.com with ESMTP; 06 Dec 2019 03:57:09 -0800
From: Chuansheng Liu <chuansheng.liu@intel.com>
To: intel-gfx@lists.freedesktop.org
Date: Fri,  6 Dec 2019 11:56:35 +0000
Message-Id: <20191206115635.46931-1-chuansheng.liu@intel.com>
X-Mailer: git-send-email 2.17.1
Subject: [Intel-gfx] [PATCH] drm/i915: Fix the use-after-free between
 i915_active_ref and __active_retire
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
MIME-Version: 1.0
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

V2UgZWFzaWx5IGhpdCBkcm0vaTkxNSBwYW5pYyBvbiBUR0wgd2hlbiBydW5uaW5nIGdsbWFyazIs
IGFuZCBmaW5hbGx5CmNhdWdodCB0aGUgcmFjZSBjb25kaXRpb24gb2YgdXNlLWFmdGVyLWZyZWUg
d2l0aCBlbmFibGluZyBLQVNBTi4KClRoZSBjYWxsIHN0YWNrIGlzIGJlbG93Ogo9PT0KWyAgNTM0
LjQ3MjY3NV0gQlVHOiBLQVNBTjogdXNlLWFmdGVyLWZyZWUgaW4gX19pOTE1X2FjdGl2ZV9mZW5j
ZV9zZXQrMHgyNmQvMHgzZDAgW2k5MTVdClsgIDUzNC40NzI2NzldIFdyaXRlIG9mIHNpemUgOCBh
dCBhZGRyIGZmZmY4ODgzZjAzNzIzODggYnkgdGFzayBnbG1hcmsyLzMxOTkKClsgIDUzNC40NzI2
ODRdIENQVTogMyBQSUQ6IDMxOTkgQ29tbTogZ2xtYXJrMiBUYWludGVkOiBHICAgICBVICAgICAg
RSAgICAgNS40LjAtcmM4ICM4ClsgIDUzNC40NzI2ODddIENhbGwgVHJhY2U6ClsgIDUzNC40NzI2
OTNdICBkdW1wX3N0YWNrKzB4OTUvMHhkNQpbICA1MzQuNDcyNzIyXSAgPyBfX2k5MTVfYWN0aXZl
X2ZlbmNlX3NldCsweDI2ZC8weDNkMCBbaTkxNV0KWyAgNTM0LjQ3MjcyN10gIHByaW50X2FkZHJl
c3NfZGVzY3JpcHRpb24uY29uc3Rwcm9wLjUrMHgyMC8weDMyMApbICA1MzQuNDcyNzUxXSAgPyBf
X2k5MTVfYWN0aXZlX2ZlbmNlX3NldCsweDI2ZC8weDNkMCBbaTkxNV0KWyAgNTM0LjQ3Mjc5Ml0g
ID8gX19pOTE1X2FjdGl2ZV9mZW5jZV9zZXQrMHgyNmQvMHgzZDAgW2k5MTVdClsgIDUzNC40NzI3
OTRdICBfX2thc2FuX3JlcG9ydCsweDE0OS8weDE4YwpbICA1MzQuNDcyNzk4XSAgPyBfcmF3X3Nw
aW5fbG9jaysweDEvMHhkMApbICA1MzQuNDcyODIwXSAgPyBfX2k5MTVfYWN0aXZlX2ZlbmNlX3Nl
dCsweDI2ZC8weDNkMCBbaTkxNV0KWyAgNTM0LjQ3MjgyMl0gIGthc2FuX3JlcG9ydCsweDEyLzB4
MjAKWyAgNTM0LjQ3MjgyNV0gIF9fYXNhbl9yZXBvcnRfc3RvcmU4X25vYWJvcnQrMHgxNy8weDIw
ClsgIDUzNC40NzI4NDddICBfX2k5MTVfYWN0aXZlX2ZlbmNlX3NldCsweDI2ZC8weDNkMCBbaTkx
NV0KWyAgNTM0LjQ3Mjg3MF0gIGk5MTVfYWN0aXZlX3JlZisweDJjOC8weDUzMCBbaTkxNV0KWyAg
NTM0LjQ3Mjg3NF0gID8gZG1hX3Jlc3ZfYWRkX3NoYXJlZF9mZW5jZSsweDI5MS8weDQ2MApbICA1
MzQuNDcyOTAyXSAgX19pOTE1X3ZtYV9tb3ZlX3RvX2FjdGl2ZSsweDU2LzB4NzAgW2k5MTVdClsg
IDUzNC40NzI5MjddICBpOTE1X3ZtYV9tb3ZlX3RvX2FjdGl2ZSsweDU0LzB4NDIwIFtpOTE1XQpb
ICA1MzQuNDcyOTMxXSAgPyBtdXRleF91bmxvY2srMHgyMi8weDQwClsgIDUzNC40NzI5NTddICBp
OTE1X2dlbV9kb19leGVjYnVmZmVyKzB4MWQ0NS8weDNlMjAgW2k5MTVdClsgIDUzNC40NzI5NTld
ICA/IF9fa21hbGxvY19ub2RlKzB4MTJjLzB4MzUwClsgIDUzNC40NzI5ODNdICA/IGViX3JlbG9j
YXRlX3Nsb3crMHhiNDAvMHhiNDAgW2k5MTVdClsgIDUzNC40NzI5ODVdICA/IF9yYXdfd3JpdGVf
dHJ5bG9jaysweDExMC8weDExMApbICA1MzQuNDcyOTg3XSAgPyBnZXRfcGFydGlhbF9ub2RlLmlz
cmEuNzIrMHg1MS8weDI2MApbICA1MzQuNDcyOTkxXSAgPyB1bml4X3N0cmVhbV9yZWFkX2dlbmVy
aWMrMHg1ODMvMHgxYTgwClsgIDUzNC40NzI5OTRdICA/IF9fX3NsYWJfYWxsb2MrMHgxZDgvMHg1
NTAKWyAgNTM0LjQ3Mjk5OF0gID8ga3ZtYWxsb2Nfbm9kZSsweDMxLzB4ODAKWyAgNTM0LjQ3MzAw
MF0gID8ga2FzYW5fdW5wb2lzb25fc2hhZG93KzB4MzUvMHg1MApbICA1MzQuNDczMDAyXSAgPyBf
cmF3X3NwaW5fbG9jaysweDdiLzB4ZDAKWyAgNTM0LjQ3MzAwNF0gID8gcmFkaXhfdHJlZV9sb29r
dXArMHhkLzB4MTAKWyAgNTM0LjQ3MzAwNl0gID8gaWRyX2ZpbmQrMHgzYi8weDYwClsgIDUzNC40
NzMwMjldICBpOTE1X2dlbV9leGVjYnVmZmVyMl9pb2N0bCsweDYzNC8weDhhMCBbaTkxNV0KWyAg
NTM0LjQ3MzA1Ml0gID8gaTkxNV9nZW1fZXhlY2J1ZmZlcl9pb2N0bCsweGQ1MC8weGQ1MCBbaTkx
NV0KWyAgNTM0LjQ3MzA1NF0gID8gdW5peF9zdHJlYW1fcmVjdm1zZysweDk3LzB4ZDAKWyAgNTM0
LjQ3MzA1Nl0gID8gdW5peF9zdHJlYW1fc3BsaWNlX3JlYWQrMHgxYzAvMHgxYzAKWyAgNTM0LjQ3
MzA1OF0gID8gX191bml4X2luc2VydF9zb2NrZXQrMHgxODAvMHgxODAKWyAgNTM0LjQ3MzA4MV0g
ID8gaTkxNV9nZW1fZXhlY2J1ZmZlcl9pb2N0bCsweGQ1MC8weGQ1MCBbaTkxNV0KWyAgNTM0LjQ3
MzA5NF0gIGRybV9pb2N0bF9rZXJuZWwrMHgxZWQvMHgyYjAgW2RybV0KWyAgNTM0LjQ3MzEwM10g
ID8gZHJtX3NldHZlcnNpb24rMHg4YzAvMHg4YzAgW2RybV0KWyAgNTM0LjQ3MzEwNl0gID8gX19r
YXNhbl9jaGVja193cml0ZSsweDE0LzB4MjAKWyAgNTM0LjQ3MzExNV0gIGRybV9pb2N0bCsweDY4
Yi8weGFhMCBbZHJtXQouLi4KClsgIDUzNC40NzMyMzldIEFsbG9jYXRlZCBieSB0YXNrIDMxOTk6
ClsgIDUzNC40NzMyNDFdICBzYXZlX3N0YWNrKzB4MjEvMHg5MApbICA1MzQuNDczMjQzXSAgX19r
YXNhbl9rbWFsbG9jLmNvbnN0cHJvcC44KzB4YTcvMHhkMApbICA1MzQuNDczMjQ1XSAga2FzYW5f
c2xhYl9hbGxvYysweDExLzB4MjAKWyAgNTM0LjQ3MzI0Nl0gIGttZW1fY2FjaGVfYWxsb2MrMHhj
ZS8weDI0MApbICA1MzQuNDczMjczXSAgaTkxNV9hY3RpdmVfcmVmKzB4YzIvMHg1MzAgW2k5MTVd
ClsgIDUzNC40NzMzMDJdICBfX2k5MTVfdm1hX21vdmVfdG9fYWN0aXZlKzB4NTYvMHg3MCBbaTkx
NV0KWyAgNTM0LjQ3MzMyOF0gIGk5MTVfdm1hX21vdmVfdG9fYWN0aXZlKzB4NTQvMHg0MjAgW2k5
MTVdClsgIDUzNC40NzMzNTVdICBpOTE1X2dlbV9kb19leGVjYnVmZmVyKzB4MWQ0NS8weDNlMjAg
W2k5MTVdClsgIDUzNC40NzMzODFdICBpOTE1X2dlbV9leGVjYnVmZmVyMl9pb2N0bCsweDYzNC8w
eDhhMCBbaTkxNV0KWyAgNTM0LjQ3MzM5Ml0gIGRybV9pb2N0bF9rZXJuZWwrMHgxZWQvMHgyYjAg
W2RybV0KWyAgNTM0LjQ3MzQwMl0gIGRybV9pb2N0bCsweDY4Yi8weGFhMCBbZHJtXQpbICA1MzQu
NDczNDA0XSAgZG9fdmZzX2lvY3RsKzB4MTlhLzB4ZjEwClsgIDUzNC40NzM0MDVdICBrc3lzX2lv
Y3RsKzB4NzUvMHg4MApbICA1MzQuNDczNDA3XSAgX194NjRfc3lzX2lvY3RsKzB4NzMvMHhiMApb
ICA1MzQuNDczNDA4XSAgZG9fc3lzY2FsbF82NCsweDlmLzB4M2EwClsgIDUzNC40NzM0MTBdICBl
bnRyeV9TWVNDQUxMXzY0X2FmdGVyX2h3ZnJhbWUrMHg0NC8weGE5CgpbICA1MzQuNDczNDEyXSBG
cmVlZCBieSB0YXNrIDA6ClsgIDUzNC40NzM0MTRdICBzYXZlX3N0YWNrKzB4MjEvMHg5MApbICA1
MzQuNDczNDE1XSAgX19rYXNhbl9zbGFiX2ZyZWUrMHgxMzcvMHgxOTAKWyAgNTM0LjQ3MzQxN10g
IGthc2FuX3NsYWJfZnJlZSsweGUvMHgxMApbICA1MzQuNDczNDE4XSAga21lbV9jYWNoZV9mcmVl
KzB4ZWIvMHgyYzAKWyAgNTM0LjQ3MzQ0NF0gIF9fYWN0aXZlX3JldGlyZSsweDFmMi8weDI0MCBb
aTkxNV0KWyAgNTM0LjQ3MzQ3MV0gIGFjdGl2ZV9yZXRpcmUrMHgxM2IvMHgxYjAgW2k5MTVdClsg
IDUzNC40NzM0OTZdICBub2RlX3JldGlyZSsweDU0LzB4ODAgW2k5MTVdClsgIDUzNC40NzM1MjNd
ICBpbnRlbF9lbmdpbmVfYnJlYWRjcnVtYnNfaXJxKzB4NWYwLzB4ZDEwIFtpOTE1XQpbICA1MzQu
NDczNTQ5XSAgY3NfaXJxX2hhbmRsZXIrMHg2Ni8weGIwIFtpOTE1XQpbICA1MzQuNDczNTc1XSAg
Z2VuMTFfZ3RfaXJxX2hhbmRsZXIrMHgyNmMvMHg0MDAgW2k5MTVdClsgIDUzNC40NzM2MDBdICBn
ZW4xMV9pcnFfaGFuZGxlcisweGMzLzB4MjUwIFtpOTE1XQpbICA1MzQuNDczNjAzXSAgX19oYW5k
bGVfaXJxX2V2ZW50X3BlcmNwdSsweGUwLzB4NGMwClsgIDUzNC40NzM2MDVdICBoYW5kbGVfaXJx
X2V2ZW50X3BlcmNwdSsweDcxLzB4MTQwClsgIDUzNC40NzM2MDZdICBoYW5kbGVfaXJxX2V2ZW50
KzB4YWQvMHgxNDAKWyAgNTM0LjQ3MzYwOF0gIGhhbmRsZV9lZGdlX2lycSsweDFmNi8weDc4MApb
ICA1MzQuNDczNjEwXSAgZG9fSVJRKzB4OWYvMHgxZjAKClsgIDUzNC40NzM2MTJdIFRoZSBidWdn
eSBhZGRyZXNzIGJlbG9uZ3MgdG8gdGhlIG9iamVjdCBhdCBmZmZmODg4M2YwMzcyMzgwCiAgICAg
ICAgICAgICAgICB3aGljaCBiZWxvbmdzIHRvIHRoZSBjYWNoZSBhY3RpdmVfbm9kZSBvZiBzaXpl
IDcyClsgIDUzNC40NzM2MTVdIFRoZSBidWdneSBhZGRyZXNzIGlzIGxvY2F0ZWQgOCBieXRlcyBp
bnNpZGUgb2YKCj09PQoKVGhlIHJhY2Ugc2NlbmVyaW8gaXMgbGlrZToKSW5pdGlhbGx5IHJlZi0+
Y291bnQgaXMgMSwgaW50ZXJydXB0IGhhbmRsZXIgaXMgdHJ5aW5nIHRvIGZyZWUgdGhlCm5vZGUu
Cgo9PT0KQ1BVQSBpbiBpbnRlcnJ1cHQgY29udGV4dCAgICAgICAgICAgICAgICBDUFVCIGluIGk5
MTVfZ2VtX2V4ZWNidWZmZXIyX2lvY3RsCl9fYWN0aXZlX3JldGlyZSAtLT4KICBzcGluX2xvY2so
JnJlZi0+dHJlZV9sb2NrKQogIGRlY3JlYXNlIHJlZi0+Y291bnQgdG8gMAogICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgIGk5MTVfYWN0aXZlX3JlZiAtLT4KICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGluY3JlYXNlIHJlZi0+Y291bnQgdG8g
MQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKGk5MTVfYWN0aXZl
X2FjcXVpcmUpCgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZ2V0
IHRoZSBkaXJ0eSByZWYtPmNhY2hlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAoUkVBRF9PTkNFKHJlZi0+Y2FjaGUpKQoKICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGUgZGlydHkgbm9kZQoKICBzZXQgcmVmLT5j
YWNoZSB0byBOVUxMCiAgc3Bpbl91bmxvY2soJnJlZi0+dHJlZV9sb2NrKQogIGZyZWUgdGhlIG5v
ZGUKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBoaXQgdXNlLWFm
dGVyLWZyZWUgaW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
IF9faTkxNV9hY3RpdmVfZmVuY2Vfc2V0KCkKCj09PQoKSGVyZSB3ZSBuZWVkIHRvIHVzZSBzcGlu
bG9jayByZWYtPnRyZWVfbG9jayB0byBwcm90ZWN0IHRoZSBhY2Nlc3MKb2YgUkVBRF9PTkNFKHJl
Zi0+Y2FjaGUpLCB0aGVuIHRoZSByYWNlIHNjZW5lcmlvIGNhbiBiZSByZXNvbHZlZC4KCndpdGgg
dGhpcyBwYXRjaCwgaXQgcGFzc2VkIG91ciBzdHJlc3MgdGVzdCBmb3IgYSB2ZXJ5IGxvbmcgdGlt
ZS4KClNpZ25lZC1vZmYtYnk6IENodWFuc2hlbmcgTGl1IDxjaHVhbnNoZW5nLmxpdUBpbnRlbC5j
b20+Ci0tLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9hY3RpdmUuYyB8IDMgKysrCiAxIGZp
bGUgY2hhbmdlZCwgMyBpbnNlcnRpb25zKCspCgpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJt
L2k5MTUvaTkxNV9hY3RpdmUuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfYWN0aXZlLmMK
aW5kZXggZGNhMTVhY2U4OGY2Li4zZDY4YjkxMGU5NDkgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1
L2RybS9pOTE1L2k5MTVfYWN0aXZlLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9h
Y3RpdmUuYwpAQCAtMjE0LDcgKzIxNCwxMCBAQCBhY3RpdmVfaW5zdGFuY2Uoc3RydWN0IGk5MTVf
YWN0aXZlICpyZWYsIHN0cnVjdCBpbnRlbF90aW1lbGluZSAqdGwpCiAJICogYWZ0ZXIgdGhlIHBy
ZXZpb3VzIGFjdGl2aXR5IGhhcyBiZWVuIHJldGlyZWQsIG9yIGlmIGl0IG1hdGNoZXMgdGhlCiAJ
ICogY3VycmVudCB0aW1lbGluZS4KIAkgKi8KKwlzcGluX2xvY2tfaXJxKCZyZWYtPnRyZWVfbG9j
ayk7CiAJbm9kZSA9IFJFQURfT05DRShyZWYtPmNhY2hlKTsKKwlzcGluX3VubG9ja19pcnEoJnJl
Zi0+dHJlZV9sb2NrKTsKKwogCWlmIChub2RlICYmIG5vZGUtPnRpbWVsaW5lID09IGlkeCkKIAkJ
cmV0dXJuICZub2RlLT5iYXNlOwogCi0tIAoyLjE3LjEKCl9fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fCkludGVsLWdmeCBtYWlsaW5nIGxpc3QKSW50ZWwtZ2Z4
QGxpc3RzLmZyZWVkZXNrdG9wLm9yZwpodHRwczovL2xpc3RzLmZyZWVkZXNrdG9wLm9yZy9tYWls
bWFuL2xpc3RpbmZvL2ludGVsLWdmeA==

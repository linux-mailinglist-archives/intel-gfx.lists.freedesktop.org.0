Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id BCE258A875
	for <lists+intel-gfx@lfdr.de>; Mon, 12 Aug 2019 22:36:45 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 7D3AE6E5DA;
	Mon, 12 Aug 2019 20:36:43 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from fireflyinternet.com (mail.fireflyinternet.com [109.228.58.192])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 8C8EF6E5DA
 for <intel-gfx@lists.freedesktop.org>; Mon, 12 Aug 2019 20:36:41 +0000 (UTC)
X-Default-Received-SPF: pass (skip=forwardok (res=PASS))
 x-ip-name=78.156.65.138; 
Received: from haswell.alporthouse.com (unverified [78.156.65.138]) 
 by fireflyinternet.com (Firefly Internet (M1)) with ESMTP id 17974480-1500050 
 for multiple; Mon, 12 Aug 2019 21:36:28 +0100
From: Chris Wilson <chris@chris-wilson.co.uk>
To: intel-gfx@lists.freedesktop.org
Date: Mon, 12 Aug 2019 21:36:26 +0100
Message-Id: <20190812203626.3948-1-chris@chris-wilson.co.uk>
X-Mailer: git-send-email 2.23.0.rc1
In-Reply-To: <bd7578ee-ca93-00ef-91ea-73de9affbe00@intel.com>
References: <bd7578ee-ca93-00ef-91ea-73de9affbe00@intel.com>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH] drm/i915/guc: Use a local cancel_port_requests
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

U2luY2UgZXhlY2xpc3RzIGFuZCB0aGUgZ3VjIGhhdmUgZGl2ZXJnZWQgaW4gdGhlaXIgcG9ydCB0
cmFja2luZywgd2UKY2Fubm90IHNpbXBseSByZXVzZSB0aGUgZXhlY2xpc3RzIGNhbmNlbGxhdGlv
biBjb2RlIGFzIGl0IGxlYWRzIHRvCnVuYmFsYW5jZWQgcmVmZXJlbmNlIGNvdW50aW5nLiBVc2Ug
YSBsb2NhbCwgc2ltcGxlciByb3V0aW5lIGZvciB0aGUgZ3VjLgoKU2lnbmVkLW9mZi1ieTogQ2hy
aXMgV2lsc29uIDxjaHJpc0BjaHJpcy13aWxzb24uY28udWs+CkNjOiBEYW5pZWxlIENlcmFvbG8g
U3B1cmlvIDxkYW5pZWxlLmNlcmFvbG9zcHVyaW9AaW50ZWwuY29tPgpSZXZpZXdlZC1ieTogRGFu
aWVsZSBDZXJhb2xvIFNwdXJpbyA8ZGFuaWVsZS5jZXJhb2xvc3B1cmlvQGludGVsLmNvbT4KLS0t
CkFkZCByZW1pbmRlcnMgdGhhdCB3ZSBvbmx5IHVzZSB0aGUgZXhlY2xpc3RzLT5pbmZsaWdodCBx
dWV1ZSBjdXJyZW50bHkuCi0tLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfZW5naW5l
LmggICAgICAgIHwgIDMgLS0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2xyYy5jICAg
ICAgICAgICB8ICA2ICstLQogLi4uL2dwdS9kcm0vaTkxNS9ndC91Yy9pbnRlbF9ndWNfc3VibWlz
c2lvbi5jIHwgMzcgKysrKysrKysrKysrKystLS0tLQogMyBmaWxlcyBjaGFuZ2VkLCAzMCBpbnNl
cnRpb25zKCspLCAxNiBkZWxldGlvbnMoLSkKCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0v
aTkxNS9ndC9pbnRlbF9lbmdpbmUuaCBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2Vu
Z2luZS5oCmluZGV4IGUxMjI4YjBlNTc3Zi4uNGI2YTFjZjgwNzA2IDEwMDY0NAotLS0gYS9kcml2
ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9lbmdpbmUuaAorKysgYi9kcml2ZXJzL2dwdS9kcm0v
aTkxNS9ndC9pbnRlbF9lbmdpbmUuaApAQCAtMTM2LDkgKzEzNiw2IEBAIGV4ZWNsaXN0c19hY3Rp
dmUoY29uc3Qgc3RydWN0IGludGVsX2VuZ2luZV9leGVjbGlzdHMgKmV4ZWNsaXN0cykKIAlyZXR1
cm4gUkVBRF9PTkNFKCpleGVjbGlzdHMtPmFjdGl2ZSk7CiB9CiAKLXZvaWQKLWV4ZWNsaXN0c19j
YW5jZWxfcG9ydF9yZXF1ZXN0cyhzdHJ1Y3QgaW50ZWxfZW5naW5lX2V4ZWNsaXN0cyAqIGNvbnN0
IGV4ZWNsaXN0cyk7Ci0KIHN0cnVjdCBpOTE1X3JlcXVlc3QgKgogZXhlY2xpc3RzX3Vud2luZF9p
bmNvbXBsZXRlX3JlcXVlc3RzKHN0cnVjdCBpbnRlbF9lbmdpbmVfZXhlY2xpc3RzICpleGVjbGlz
dHMpOwogCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9scmMuYyBi
L2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2xyYy5jCmluZGV4IGI5NzA0N2Q1OGQzZC4u
NWMyNmM0YWUxMzliIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9s
cmMuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9scmMuYwpAQCAtMTI5Nyw4
ICsxMjk3LDggQEAgc3RhdGljIHZvaWQgZXhlY2xpc3RzX2RlcXVldWUoc3RydWN0IGludGVsX2Vu
Z2luZV9jcyAqZW5naW5lKQogCX0KIH0KIAotdm9pZAotZXhlY2xpc3RzX2NhbmNlbF9wb3J0X3Jl
cXVlc3RzKHN0cnVjdCBpbnRlbF9lbmdpbmVfZXhlY2xpc3RzICogY29uc3QgZXhlY2xpc3RzKQor
c3RhdGljIHZvaWQKK2NhbmNlbF9wb3J0X3JlcXVlc3RzKHN0cnVjdCBpbnRlbF9lbmdpbmVfZXhl
Y2xpc3RzICogY29uc3QgZXhlY2xpc3RzKQogewogCXN0cnVjdCBpOTE1X3JlcXVlc3QgKiBjb25z
dCAqcG9ydCwgKnJxOwogCkBAIC0yMzU1LDcgKzIzNTUsNyBAQCBzdGF0aWMgdm9pZCBfX2V4ZWNs
aXN0c19yZXNldChzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmUsIGJvb2wgc3RhbGxlZCkK
IAogdW53aW5kOgogCS8qIFB1c2ggYmFjayBhbnkgaW5jb21wbGV0ZSByZXF1ZXN0cyBmb3IgcmVw
bGF5IGFmdGVyIHRoZSByZXNldC4gKi8KLQlleGVjbGlzdHNfY2FuY2VsX3BvcnRfcmVxdWVzdHMo
ZXhlY2xpc3RzKTsKKwljYW5jZWxfcG9ydF9yZXF1ZXN0cyhleGVjbGlzdHMpOwogCV9fdW53aW5k
X2luY29tcGxldGVfcmVxdWVzdHMoZW5naW5lKTsKIH0KIApkaWZmIC0tZ2l0IGEvZHJpdmVycy9n
cHUvZHJtL2k5MTUvZ3QvdWMvaW50ZWxfZ3VjX3N1Ym1pc3Npb24uYyBiL2RyaXZlcnMvZ3B1L2Ry
bS9pOTE1L2d0L3VjL2ludGVsX2d1Y19zdWJtaXNzaW9uLmMKaW5kZXggNDQ5Y2E2MzU3MDE4Li4y
NjkxODI2MWQ2MGQgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L3VjL2ludGVs
X2d1Y19zdWJtaXNzaW9uLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvdWMvaW50ZWxf
Z3VjX3N1Ym1pc3Npb24uYwpAQCAtNTE3LDExICs1MTcsMTQgQEAgc3RhdGljIHN0cnVjdCBpOTE1
X3JlcXVlc3QgKnNjaGVkdWxlX2luKHN0cnVjdCBpOTE1X3JlcXVlc3QgKnJxLCBpbnQgaWR4KQog
ewogCXRyYWNlX2k5MTVfcmVxdWVzdF9pbihycSwgaWR4KTsKIAotCWlmICghcnEtPmh3X2NvbnRl
eHQtPmluZmxpZ2h0KQotCQlycS0+aHdfY29udGV4dC0+aW5mbGlnaHQgPSBycS0+ZW5naW5lOwot
CWludGVsX2NvbnRleHRfaW5mbGlnaHRfaW5jKHJxLT5od19jb250ZXh0KTsKLQlpbnRlbF9ndF9w
bV9nZXQocnEtPmVuZ2luZS0+Z3QpOworCS8qCisJICogQ3VycmVudGx5IHdlIGFyZSBub3QgdHJh
Y2tpbmcgdGhlIHJxLT5jb250ZXh0IGJlaW5nIGluZmxpZ2h0CisJICogKGNlLT5pbmZsaWdodCA9
IHJxLT5lbmdpbmUpLiBJdCBpcyBvbmx5IHVzZWQgYnkgdGhlIGV4ZWNsaXN0cworCSAqIGJhY2tl
bmQgYXQgdGhlIG1vbWVudCwgYSBzaW1pbGFyIGNvdW50aW5nIHN0cmF0ZWd5IHdvdWxkIGJlCisJ
ICogcmVxdWlyZWQgaWYgd2UgZ2VuZXJhbGlzZSB0aGUgaW5mbGlnaHQgdHJhY2tpbmcuCisJICov
CiAKKwlpbnRlbF9ndF9wbV9nZXQocnEtPmVuZ2luZS0+Z3QpOwogCXJldHVybiBpOTE1X3JlcXVl
c3RfZ2V0KHJxKTsKIH0KIApAQCAtNTI5LDEwICs1MzIsNiBAQCBzdGF0aWMgdm9pZCBzY2hlZHVs
ZV9vdXQoc3RydWN0IGk5MTVfcmVxdWVzdCAqcnEpCiB7CiAJdHJhY2VfaTkxNV9yZXF1ZXN0X291
dChycSk7CiAKLQlpbnRlbF9jb250ZXh0X2luZmxpZ2h0X2RlYyhycS0+aHdfY29udGV4dCk7Ci0J
aWYgKCFpbnRlbF9jb250ZXh0X2luZmxpZ2h0X2NvdW50KHJxLT5od19jb250ZXh0KSkKLQkJcnEt
Pmh3X2NvbnRleHQtPmluZmxpZ2h0ID0gTlVMTDsKLQogCWludGVsX2d0X3BtX3B1dChycS0+ZW5n
aW5lLT5ndCk7CiAJaTkxNV9yZXF1ZXN0X3B1dChycSk7CiB9CkBAIC01NTYsNiArNTU1LDExIEBA
IHN0YXRpYyB2b2lkIF9fZ3VjX2RlcXVldWUoc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5l
KQogCQlsYXN0ID0gTlVMTDsKIAl9CiAKKwkvKgorCSAqIFdlIHdyaXRlIGRpcmVjdGx5IGludG8g
dGhlIGV4ZWNsaXN0cy0+aW5mbGlnaHQgcXVldWUgYW5kIGRvbid0IHVzZQorCSAqIHRoZSBleGVj
bGlzdHMtPnBlbmRpbmcgcXVldWUsIGFzIHdlIGRvbid0IGhhdmUgYSBkaXN0aW5jdCBzd2l0Y2gK
KwkgKiBldmVudC4KKwkgKi8KIAlwb3J0ID0gZmlyc3Q7CiAJd2hpbGUgKChyYiA9IHJiX2ZpcnN0
X2NhY2hlZCgmZXhlY2xpc3RzLT5xdWV1ZSkpKSB7CiAJCXN0cnVjdCBpOTE1X3ByaW9saXN0ICpw
ID0gdG9fcHJpb2xpc3QocmIpOwpAQCAtNjM2LDYgKzY0MCwxOSBAQCBzdGF0aWMgdm9pZCBndWNf
cmVzZXRfcHJlcGFyZShzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmUpCiAJX190YXNrbGV0
X2Rpc2FibGVfc3luY19vbmNlKCZleGVjbGlzdHMtPnRhc2tsZXQpOwogfQogCitzdGF0aWMgdm9p
ZAorY2FuY2VsX3BvcnRfcmVxdWVzdHMoc3RydWN0IGludGVsX2VuZ2luZV9leGVjbGlzdHMgKiBj
b25zdCBleGVjbGlzdHMpCit7CisJc3RydWN0IGk5MTVfcmVxdWVzdCAqIGNvbnN0ICpwb3J0LCAq
cnE7CisKKwkvKiBOb3RlIHdlIGFyZSBvbmx5IHVzaW5nIHRoZSBpbmZsaWdodCBhbmQgbm90IHRo
ZSBwZW5kaW5nIHF1ZXVlICovCisKKwlmb3IgKHBvcnQgPSBleGVjbGlzdHMtPmFjdGl2ZTsgKHJx
ID0gKnBvcnQpOyBwb3J0KyspCisJCXNjaGVkdWxlX291dChycSk7CisJZXhlY2xpc3RzLT5hY3Rp
dmUgPQorCQltZW1zZXQoZXhlY2xpc3RzLT5pbmZsaWdodCwgMCwgc2l6ZW9mKGV4ZWNsaXN0cy0+
aW5mbGlnaHQpKTsKK30KKwogc3RhdGljIHZvaWQgZ3VjX3Jlc2V0KHN0cnVjdCBpbnRlbF9lbmdp
bmVfY3MgKmVuZ2luZSwgYm9vbCBzdGFsbGVkKQogewogCXN0cnVjdCBpbnRlbF9lbmdpbmVfZXhl
Y2xpc3RzICogY29uc3QgZXhlY2xpc3RzID0gJmVuZ2luZS0+ZXhlY2xpc3RzOwpAQCAtNjQ0LDcg
KzY2MSw3IEBAIHN0YXRpYyB2b2lkIGd1Y19yZXNldChzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICpl
bmdpbmUsIGJvb2wgc3RhbGxlZCkKIAogCXNwaW5fbG9ja19pcnFzYXZlKCZlbmdpbmUtPmFjdGl2
ZS5sb2NrLCBmbGFncyk7CiAKLQlleGVjbGlzdHNfY2FuY2VsX3BvcnRfcmVxdWVzdHMoZXhlY2xp
c3RzKTsKKwljYW5jZWxfcG9ydF9yZXF1ZXN0cyhleGVjbGlzdHMpOwogCiAJLyogUHVzaCBiYWNr
IGFueSBpbmNvbXBsZXRlIHJlcXVlc3RzIGZvciByZXBsYXkgYWZ0ZXIgdGhlIHJlc2V0LiAqLwog
CXJxID0gZXhlY2xpc3RzX3Vud2luZF9pbmNvbXBsZXRlX3JlcXVlc3RzKGV4ZWNsaXN0cyk7CkBA
IC02ODcsNyArNzA0LDcgQEAgc3RhdGljIHZvaWQgZ3VjX2NhbmNlbF9yZXF1ZXN0cyhzdHJ1Y3Qg
aW50ZWxfZW5naW5lX2NzICplbmdpbmUpCiAJc3Bpbl9sb2NrX2lycXNhdmUoJmVuZ2luZS0+YWN0
aXZlLmxvY2ssIGZsYWdzKTsKIAogCS8qIENhbmNlbCB0aGUgcmVxdWVzdHMgb24gdGhlIEhXIGFu
ZCBjbGVhciB0aGUgRUxTUCB0cmFja2VyLiAqLwotCWV4ZWNsaXN0c19jYW5jZWxfcG9ydF9yZXF1
ZXN0cyhleGVjbGlzdHMpOworCWNhbmNlbF9wb3J0X3JlcXVlc3RzKGV4ZWNsaXN0cyk7CiAKIAkv
KiBNYXJrIGFsbCBleGVjdXRpbmcgcmVxdWVzdHMgYXMgc2tpcHBlZC4gKi8KIAlsaXN0X2Zvcl9l
YWNoX2VudHJ5KHJxLCAmZW5naW5lLT5hY3RpdmUucmVxdWVzdHMsIHNjaGVkLmxpbmspIHsKLS0g
CjIuMjMuMC5yYzEKCl9fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fCkludGVsLWdmeCBtYWlsaW5nIGxpc3QKSW50ZWwtZ2Z4QGxpc3RzLmZyZWVkZXNrdG9wLm9y
ZwpodHRwczovL2xpc3RzLmZyZWVkZXNrdG9wLm9yZy9tYWlsbWFuL2xpc3RpbmZvL2ludGVsLWdm
eA==
